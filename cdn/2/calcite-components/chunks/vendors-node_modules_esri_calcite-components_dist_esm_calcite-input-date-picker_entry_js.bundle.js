"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_esri_calcite-components_dist_esm_calcite-input-date-picker_entry_js"],{

/***/ "./node_modules/@esri/calcite-components/dist/esm/calcite-input-date-picker.entry.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/esm/calcite-input-date-picker.entry.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   calcite_input_date_picker: () => (/* binding */ InputDatePicker)
/* harmony export */ });
/* harmony import */ var _index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-86faef9c.js */ "./node_modules/@esri/calcite-components/dist/esm/index-86faef9c.js");
/* harmony import */ var _utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils-ad0af80b.js */ "./node_modules/@esri/calcite-components/dist/esm/utils-ad0af80b.js");
/* harmony import */ var _dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dom-ed00a585.js */ "./node_modules/@esri/calcite-components/dist/esm/dom-ed00a585.js");
/* harmony import */ var _floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./floating-ui-e25cfa90.js */ "./node_modules/@esri/calcite-components/dist/esm/floating-ui-e25cfa90.js");
/* harmony import */ var _form_4876c9e5_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./form-4876c9e5.js */ "./node_modules/@esri/calcite-components/dist/esm/form-4876c9e5.js");
/* harmony import */ var _interactive_cbd8a6dc_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./interactive-cbd8a6dc.js */ "./node_modules/@esri/calcite-components/dist/esm/interactive-cbd8a6dc.js");
/* harmony import */ var _key_61f82ddb_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./key-61f82ddb.js */ "./node_modules/@esri/calcite-components/dist/esm/key-61f82ddb.js");
/* harmony import */ var _label_1c285d41_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./label-1c285d41.js */ "./node_modules/@esri/calcite-components/dist/esm/label-1c285d41.js");
/* harmony import */ var _loadable_b17396e0_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./loadable-b17396e0.js */ "./node_modules/@esri/calcite-components/dist/esm/loadable-b17396e0.js");
/* harmony import */ var _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-6e783cf0.js */ "./node_modules/@esri/calcite-components/dist/esm/locale-6e783cf0.js");
/* harmony import */ var _openCloseComponent_48db6daf_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./openCloseComponent-48db6daf.js */ "./node_modules/@esri/calcite-components/dist/esm/openCloseComponent-48db6daf.js");
/* harmony import */ var _t9n_0bcdca54_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./t9n-0bcdca54.js */ "./node_modules/@esri/calcite-components/dist/esm/t9n-0bcdca54.js");
/* harmony import */ var _focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./focusTrapComponent-aee15b41.js */ "./node_modules/@esri/calcite-components/dist/esm/focusTrapComponent-aee15b41.js");
/* harmony import */ var _guid_21fecfa4_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./guid-21fecfa4.js */ "./node_modules/@esri/calcite-components/dist/esm/guid-21fecfa4.js");
/* harmony import */ var _component_f94cab72_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./component-f94cab72.js */ "./node_modules/@esri/calcite-components/dist/esm/component-f94cab72.js");
/* harmony import */ var _resources_cf82388c_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./resources-cf82388c.js */ "./node_modules/@esri/calcite-components/dist/esm/resources-cf82388c.js");
/* harmony import */ var _debounce_85958bb1_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./debounce-85958bb1.js */ "./node_modules/@esri/calcite-components/dist/esm/debounce-85958bb1.js");
/* harmony import */ var _browser_ece29da7_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./browser-ece29da7.js */ "./node_modules/@esri/calcite-components/dist/esm/browser-ece29da7.js");
/* harmony import */ var _observers_71d332db_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./observers-71d332db.js */ "./node_modules/@esri/calcite-components/dist/esm/observers-71d332db.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.0.0
 */




















const CSS = {
  assistiveText: "assistive-text",
  menu: "menu-container",
  menuActive: "menu-container--active",
  toggleIcon: "toggle-icon",
};

/**
 * Specifies if an ISO string date (YYYY-MM-DD) has two digit year.
 *
 * @param {string} value
 * @returns {boolean}
 */
function isTwoDigitYear(value) {
  if (!value) {
    return false;
  }
  const { year } = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.d)(value);
  return Number(year) < 100;
}
/**
 * Returns a normalized year to current century from a given two digit year number.
 *
 * @param {number} twoDigitYear
 * @returns {string}
 */
function normalizeToCurrentCentury(twoDigitYear) {
  const currentYear = new Date().getFullYear();
  const normalizedYear = Math.floor(currentYear / 100) * 100 + twoDigitYear;
  return normalizedYear;
}

const inputDatePickerCss = ":host{--calcite-icon-size:1rem;--calcite-spacing-eighth:0.125rem;--calcite-spacing-quarter:0.25rem;--calcite-spacing-half:0.5rem;--calcite-spacing-three-quarters:0.75rem;--calcite-spacing:1rem;--calcite-spacing-plus-quarter:1.25rem;--calcite-spacing-plus-half:1.5rem;--calcite-spacing-double:2rem;--calcite-menu-min-width:10rem;--calcite-header-min-height:3rem;--calcite-footer-min-height:3rem}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:inline-block;inline-size:100%;overflow:visible;vertical-align:top;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}:host .menu-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:transform, visibility, opacity;opacity:0;box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);z-index:var(--calcite-z-index);border-radius:0.25rem}:host .menu-container[data-placement^=bottom] .calcite-floating-ui-anim{transform:translateY(-5px)}:host .menu-container[data-placement^=top] .calcite-floating-ui-anim{transform:translateY(5px)}:host .menu-container[data-placement^=left] .calcite-floating-ui-anim{transform:translateX(5px)}:host .menu-container[data-placement^=right] .calcite-floating-ui-anim{transform:translateX(-5px)}:host .menu-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;transform:translate(0)}:host([scale=s]){--calcite-toggle-spacing:0.5rem;--calcite-internal-input-text-input-padding-inline-end:calc(var(--calcite-toggle-spacing) + 1rem)}:host([scale=m]){--calcite-toggle-spacing:0.75rem;--calcite-internal-input-text-input-padding-inline-end:calc(var(--calcite-toggle-spacing) + 1.5rem)}:host([scale=l]){--calcite-toggle-spacing:1rem;--calcite-internal-input-text-input-padding-inline-end:calc(var(--calcite-toggle-spacing) + 2rem)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.calendar-picker-wrapper{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transform:translate3d(0, 0, 0)}.input-wrapper{position:relative}.toggle-icon{position:absolute;display:flex;cursor:pointer;align-items:center;inset-inline-end:0;inset-block:0;padding-inline:var(--calcite-toggle-spacing)}:host([range]) .input-container{display:flex}:host([range]) .input-wrapper{flex:1 1 auto}:host([range]) .horizontal-arrow-container{display:flex;align-items:center;border-width:1px;border-inline-start-width:0px;border-inline-end-width:0px;border-style:solid;border-color:var(--calcite-color-border-input);background-color:var(--calcite-color-background);padding-block:0px;padding-inline:0.25rem}:host([range][layout=vertical]) .input-wrapper{inline-size:100%}:host([range][layout=vertical]) .input-container{flex-direction:column;align-items:flex-start}:host([range][layout=vertical]) .calendar-picker-wrapper--end{transform:translate3d(0, 0, 0)}:host([range][layout=vertical]) .vertical-arrow-container{inset-block-start:1.5rem;position:absolute;z-index:var(--calcite-z-index);margin-inline:1px;background-color:var(--calcite-color-foreground-1);padding-inline:0.625rem;inset-inline-start:0}.menu-container{--calcite-floating-ui-z-index:var(--calcite-z-index-dropdown);display:block;position:absolute;z-index:var(--calcite-floating-ui-z-index);visibility:hidden}.menu-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:transform, visibility, opacity;opacity:0;box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);z-index:var(--calcite-z-index);border-radius:0.25rem}.menu-container[data-placement^=bottom] .calcite-floating-ui-anim{transform:translateY(-5px)}.menu-container[data-placement^=top] .calcite-floating-ui-anim{transform:translateY(5px)}.menu-container[data-placement^=left] .calcite-floating-ui-anim{transform:translateX(5px)}.menu-container[data-placement^=right] .calcite-floating-ui-anim{transform:translateX(-5px)}.menu-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;transform:translate(0)}:host([open]) .menu-container{visibility:visible}.menu-container--active{visibility:visible}.input .calcite-input__wrapper{margin-block-start:0px}:host([range][layout=vertical][scale=m]) .vertical-arrow-container{inset-block-start:1.5rem;padding-inline-start:0.75rem}:host([range][layout=vertical][scale=m]) .vertical-arrow-container calcite-icon{block-size:0.75rem;inline-size:0.75rem;min-inline-size:0px}:host([range][layout=vertical][scale=l]) .vertical-arrow-container{inset-block-start:2.25rem;padding-inline:0.875rem}:host([range][layout=vertical][open]) .vertical-arrow-container{display:none}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}";

const InputDatePicker = class {
  constructor(hostRef) {
    (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.calciteInputDatePickerChange = (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "calciteInputDatePickerChange", 6);
    this.calciteInputDatePickerBeforeClose = (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "calciteInputDatePickerBeforeClose", 6);
    this.calciteInputDatePickerClose = (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "calciteInputDatePickerClose", 6);
    this.calciteInputDatePickerBeforeOpen = (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "calciteInputDatePickerBeforeOpen", 6);
    this.calciteInputDatePickerOpen = (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "calciteInputDatePickerOpen", 6);
    this.calciteInternalInputInputHandler = (event) => {
      const target = event.target;
      const value = target.value;
      const parsedValue = this.parseNumerals(value);
      const formattedValue = this.formatNumerals(parsedValue);
      target.value = formattedValue;
      const { year } = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.a)(value, this.localeData);
      if (year && year.length < 4) {
        return;
      }
      const date = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.b)(value, this.localeData);
      if ((0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.i)(date, this.min, this.max)) {
        this.datePickerActiveDate = date;
      }
    };
    this.calciteInternalInputBlurHandler = () => {
      this.commitValue();
    };
    this.dialogId = `date-picker-dialog--${(0,_guid_21fecfa4_js__WEBPACK_IMPORTED_MODULE_13__.g)()}`;
    this.focusOnOpen = false;
    this.lastBlurredInput = "none";
    this.userChangedValue = false;
    this.openTransitionProp = "opacity";
    this.valueAsDateChangedExternally = false;
    this.placeholderTextId = `calcite-input-date-picker-placeholder-${(0,_guid_21fecfa4_js__WEBPACK_IMPORTED_MODULE_13__.g)()}`;
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    this.onInputWrapperClick = () => {
      if (this.range && this.lastBlurredInput !== "none" && this.open) ;
      else {
        this.open = !this.open;
      }
      this.lastBlurredInput = "none";
    };
    this.setFilteredPlacements = () => {
      const { el, flipPlacements } = this;
      this.filteredFlipPlacements = flipPlacements
        ? (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.f)(flipPlacements, el)
        : null;
    };
    this.setTransitionEl = (el) => {
      this.transitionEl = el;
    };
    this.setStartInput = (el) => {
      this.startInput = el;
    };
    this.setEndInput = (el) => {
      this.endInput = el;
    };
    this.deactivate = () => {
      this.open = false;
      this.lastBlurredInput = "none";
    };
    this.keyDownHandler = (event) => {
      const { defaultPrevented, key } = event;
      if (defaultPrevented) {
        return;
      }
      if (key === "Enter") {
        this.commitValue();
        if (this.shouldFocusRangeEnd()) {
          this.endInput?.setFocus();
        }
        else if (this.shouldFocusRangeStart()) {
          this.startInput?.setFocus();
        }
        if ((0,_form_4876c9e5_js__WEBPACK_IMPORTED_MODULE_4__.s)(this)) {
          event.preventDefault();
          this.restoreInputFocus();
        }
      }
      else if (key === "ArrowDown") {
        this.open = true;
        this.focusOnOpen = true;
        event.preventDefault();
      }
      else if (key === "Escape") {
        this.open = false;
        event.preventDefault();
        this.restoreInputFocus();
      }
    };
    this.startInputFocus = () => {
      this.focusedInput = "start";
    };
    this.startEndInputFocus = (event) => {
      const blurredEl = event.relatedTarget;
      this.lastBlurredInput =
        blurredEl === this.startInput ? "start" : blurredEl === this.endInput ? "end" : "none";
    };
    this.endInputFocus = () => {
      this.focusedInput = "end";
    };
    this.setFloatingEl = (el) => {
      this.floatingEl = el;
      (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.c)(this, this.referenceEl, this.floatingEl);
    };
    this.setStartWrapper = (el) => {
      this.startWrapper = el;
      this.setReferenceEl();
    };
    this.setEndWrapper = (el) => {
      this.endWrapper = el;
      this.setReferenceEl();
    };
    this.setDatePickerRef = (el) => {
      this.datePickerEl = el;
      (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.c)(this, {
        focusTrapEl: el,
        focusTrapOptions: {
          initialFocus: false,
          setReturnFocus: false,
        },
      });
    };
    /**
     * Event handler for when the selected date changes
     *
     * @param event CalciteDatePicker custom change event
     */
    this.handleDateChange = (event) => {
      if (this.range) {
        return;
      }
      event.stopPropagation();
      this.setValue(event.target.valueAsDate);
      this.localizeInputValues();
      this.restoreInputFocus();
    };
    this.handleDateRangeChange = (event) => {
      if (!this.range) {
        return;
      }
      event.stopPropagation();
      const value = event.target.valueAsDate;
      this.setRangeValue(value);
      this.localizeInputValues();
      this.restoreInputFocus();
    };
    this.setInputValue = (newValue, input = "start") => {
      const inputEl = this[`${input}Input`];
      if (!inputEl) {
        return;
      }
      inputEl.value = newValue;
    };
    this.setRangeValue = (valueAsDate) => {
      if (!this.range) {
        return;
      }
      const { value: oldValue } = this;
      const oldValueIsArray = Array.isArray(oldValue);
      const valueIsArray = Array.isArray(valueAsDate);
      const newStartDate = valueIsArray ? valueAsDate[0] : null;
      let newStartDateISO = valueIsArray ? (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(newStartDate) : "";
      if (newStartDateISO) {
        newStartDateISO = this.getNormalizedDate(newStartDateISO);
      }
      const newEndDate = valueIsArray ? valueAsDate[1] : null;
      let newEndDateISO = valueIsArray ? (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(newEndDate) : "";
      if (newEndDateISO) {
        newEndDateISO = this.getNormalizedDate(newEndDateISO);
      }
      const newValue = newStartDateISO || newEndDateISO ? [newStartDateISO, newEndDateISO] : "";
      if (newValue === oldValue) {
        return;
      }
      this.userChangedValue = true;
      this.value = newValue;
      this.valueAsDate = newValue ? (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.g)(newValue) : undefined;
      const changeEvent = this.calciteInputDatePickerChange.emit();
      if (changeEvent && changeEvent.defaultPrevented) {
        this.value = oldValue;
        if (oldValueIsArray) {
          this.setInputValue(oldValue[0], "start");
          this.setInputValue(oldValue[1], "end");
        }
        else {
          this.value = oldValue;
          this.setInputValue(oldValue);
        }
      }
    };
    this.setValue = (value) => {
      if (this.range) {
        return;
      }
      const oldValue = this.value;
      let newValue = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(value);
      newValue = this.getNormalizedDate(newValue);
      if (newValue === oldValue) {
        return;
      }
      this.userChangedValue = true;
      this.valueAsDate = newValue ? (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(newValue) : undefined;
      this.value = newValue || "";
      const changeEvent = this.calciteInputDatePickerChange.emit();
      if (changeEvent.defaultPrevented) {
        this.value = oldValue;
        this.setInputValue(oldValue);
      }
    };
    this.commonDateSeparators = [".", "-", "/"];
    this.formatNumerals = (value) => value
      ? value
        .split("")
        .map((char) => this.commonDateSeparators?.includes(char)
        ? this.localeData?.separator
        : _key_61f82ddb_js__WEBPACK_IMPORTED_MODULE_6__.n?.includes(char)
          ? _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.n?.numberFormatter?.format(Number(char))
          : char)
        .join("")
      : "";
    this.parseNumerals = (value) => value
      ? value
        .split("")
        .map((char) => _key_61f82ddb_js__WEBPACK_IMPORTED_MODULE_6__.n.includes(char) ? _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.n.delocalize(char) : char)
        .join("")
      : "";
    this.disabled = false;
    this.focusTrapDisabled = false;
    this.form = undefined;
    this.readOnly = false;
    this.value = "";
    this.flipPlacements = undefined;
    this.headingLevel = undefined;
    this.valueAsDate = undefined;
    this.messageOverrides = undefined;
    this.messages = undefined;
    this.minAsDate = undefined;
    this.maxAsDate = undefined;
    this.min = undefined;
    this.max = undefined;
    this.open = false;
    this.name = undefined;
    this.numberingSystem = undefined;
    this.scale = "m";
    this.status = "idle";
    this.placement = _floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.d;
    this.range = false;
    this.required = false;
    this.overlayPositioning = "absolute";
    this.proximitySelectionDisabled = false;
    this.layout = "horizontal";
    this.datePickerActiveDate = undefined;
    this.defaultMessages = undefined;
    this.effectiveLocale = "";
    this.focusedInput = "start";
    this.localeData = undefined;
  }
  handleFocusTrapDisabled(focusTrapDisabled) {
    if (!this.open) {
      return;
    }
    focusTrapDisabled ? (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.d)(this) : (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.a)(this);
  }
  handleDisabledAndReadOnlyChange(value) {
    if (!value) {
      this.open = false;
    }
  }
  valueWatcher(newValue) {
    if (!this.userChangedValue) {
      let newValueAsDate;
      if (Array.isArray(newValue)) {
        newValueAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.g)(newValue);
      }
      else if (newValue) {
        newValueAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(newValue);
      }
      else {
        newValueAsDate = undefined;
      }
      if (!this.valueAsDateChangedExternally && newValueAsDate !== this.valueAsDate) {
        this.valueAsDate = newValueAsDate;
      }
      this.localizeInputValues();
    }
    this.userChangedValue = false;
  }
  valueAsDateWatcher(valueAsDate) {
    this.datePickerActiveDate = valueAsDate;
    const newValue = this.range && Array.isArray(valueAsDate)
      ? [(0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(valueAsDate[0]), (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(valueAsDate[1])]
      : (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(valueAsDate);
    if (this.value !== newValue) {
      this.valueAsDateChangedExternally = true;
      this.value = newValue;
      this.valueAsDateChangedExternally = false;
    }
  }
  flipPlacementsHandler() {
    this.setFilteredPlacements();
    this.reposition(true);
  }
  onMessagesChange() {
    /* wired up by t9n util */
  }
  onMinChanged(min) {
    if (min) {
      this.minAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(min);
    }
  }
  onMaxChanged(max) {
    if (max) {
      this.maxAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(max);
    }
  }
  openHandler() {
    (0,_openCloseComponent_48db6daf_js__WEBPACK_IMPORTED_MODULE_10__.o)(this);
    if (this.disabled || this.readOnly) {
      this.open = false;
      return;
    }
  }
  overlayPositioningHandler() {
    this.reposition(true);
  }
  //--------------------------------------------------------------------------
  //
  //  Event Listeners
  //
  //--------------------------------------------------------------------------
  calciteDaySelectHandler() {
    if (this.shouldFocusRangeStart() || this.shouldFocusRangeEnd()) {
      return;
    }
    this.open = false;
  }
  // --------------------------------------------------------------------------
  //
  //  Public Methods
  //
  // --------------------------------------------------------------------------
  /** Sets focus on the component. */
  async setFocus() {
    await (0,_loadable_b17396e0_js__WEBPACK_IMPORTED_MODULE_8__.c)(this);
    this.el.focus();
  }
  /**
   * Updates the position of the component.
   *
   * @param delayed
   */
  async reposition(delayed = false) {
    const { floatingEl, referenceEl, placement, overlayPositioning, filteredFlipPlacements } = this;
    return (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.r)(this, {
      floatingEl,
      referenceEl,
      overlayPositioning,
      placement,
      flipPlacements: filteredFlipPlacements,
      type: "menu",
    }, delayed);
  }
  // --------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  // --------------------------------------------------------------------------
  connectedCallback() {
    (0,_interactive_cbd8a6dc_js__WEBPACK_IMPORTED_MODULE_5__.c)(this);
    (0,_locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.c)(this);
    const { open } = this;
    open && this.openHandler();
    if (Array.isArray(this.value)) {
      this.valueAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.value);
    }
    else if (this.value) {
      try {
        this.valueAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(this.value);
      }
      catch (error) {
        this.warnAboutInvalidValue(this.value);
        this.value = "";
      }
    }
    else if (this.range && this.valueAsDate) {
      this.setRangeValue(this.valueAsDate);
    }
    if (this.min) {
      this.minAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(this.min);
    }
    if (this.max) {
      this.maxAsDate = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(this.max);
    }
    (0,_label_1c285d41_js__WEBPACK_IMPORTED_MODULE_7__.c)(this);
    (0,_form_4876c9e5_js__WEBPACK_IMPORTED_MODULE_4__.c)(this);
    (0,_t9n_0bcdca54_js__WEBPACK_IMPORTED_MODULE_11__.c)(this);
    this.setFilteredPlacements();
    this.reposition(true);
    _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.n.numberFormatOptions = {
      numberingSystem: this.numberingSystem,
      locale: this.effectiveLocale,
      useGrouping: false,
    };
    if (this.open) {
      (0,_openCloseComponent_48db6daf_js__WEBPACK_IMPORTED_MODULE_10__.o)(this);
    }
    (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.c)(this, this.referenceEl, this.floatingEl);
  }
  async componentWillLoad() {
    (0,_loadable_b17396e0_js__WEBPACK_IMPORTED_MODULE_8__.s)(this);
    await Promise.all([this.loadLocaleData(), (0,_t9n_0bcdca54_js__WEBPACK_IMPORTED_MODULE_11__.s)(this)]);
    this.onMinChanged(this.min);
    this.onMaxChanged(this.max);
  }
  componentDidLoad() {
    (0,_loadable_b17396e0_js__WEBPACK_IMPORTED_MODULE_8__.a)(this);
    this.localizeInputValues();
    this.reposition(true);
  }
  disconnectedCallback() {
    (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.d)(this);
    (0,_interactive_cbd8a6dc_js__WEBPACK_IMPORTED_MODULE_5__.d)(this);
    (0,_label_1c285d41_js__WEBPACK_IMPORTED_MODULE_7__.d)(this);
    (0,_form_4876c9e5_js__WEBPACK_IMPORTED_MODULE_4__.d)(this);
    (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.a)(this, this.referenceEl, this.floatingEl);
    (0,_locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.d)(this);
    (0,_t9n_0bcdca54_js__WEBPACK_IMPORTED_MODULE_11__.d)(this);
  }
  componentDidRender() {
    (0,_interactive_cbd8a6dc_js__WEBPACK_IMPORTED_MODULE_5__.u)(this);
  }
  render() {
    const { disabled, effectiveLocale, messages, numberingSystem, readOnly } = this;
    _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.n.numberFormatOptions = {
      numberingSystem,
      locale: effectiveLocale,
      useGrouping: false,
    };
    return ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.H, { onBlur: this.deactivate, onKeyDown: this.keyDownHandler }, this.localeData && ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "input-container" }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "input-wrapper", onClick: this.onInputWrapperClick,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setStartWrapper }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-text", { "aria-autocomplete": "none", "aria-controls": this.dialogId, "aria-describedby": this.placeholderTextId, "aria-expanded": (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_2__.t)(this.open), "aria-haspopup": "dialog", class: `input ${this.layout === "vertical" && this.range ? `no-bottom-border` : ``}`, disabled: disabled, icon: "calendar", onCalciteInputTextInput: this.calciteInternalInputInputHandler, onCalciteInternalInputTextBlur: this.calciteInternalInputBlurHandler, onCalciteInternalInputTextFocus: this.startInputFocus, onFocus: this.startEndInputFocus, placeholder: this.localeData?.placeholder, readOnly: readOnly, role: "combobox", scale: this.scale, status: this.status,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setStartInput }), !this.readOnly && this.renderToggleIcon(this.open && this.focusedInput === "start"), (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { "aria-hidden": "true", class: CSS.assistiveText, id: this.placeholderTextId }, "Date Format: ", this.localeData?.placeholder)), (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-hidden": (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_2__.t)(!this.open), "aria-label": messages.chooseDate, "aria-live": "polite", "aria-modal": "true", class: {
        [CSS.menu]: true,
        [CSS.menuActive]: this.open,
      }, id: this.dialogId, role: "dialog",
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setFloatingEl }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
        ["calendar-picker-wrapper"]: true,
        ["calendar-picker-wrapper--end"]: this.focusedInput === "end",
        [_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.F.animation]: true,
        [_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.F.animationActive]: this.open,
      },
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setTransitionEl }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-date-picker", { activeDate: this.datePickerActiveDate, activeRange: this.focusedInput, headingLevel: this.headingLevel, max: this.max, maxAsDate: this.maxAsDate, messageOverrides: this.messageOverrides, min: this.min, minAsDate: this.minAsDate, numberingSystem: numberingSystem, onCalciteDatePickerChange: this.handleDateChange, onCalciteDatePickerRangeChange: this.handleDateRangeChange, proximitySelectionDisabled: this.proximitySelectionDisabled, range: this.range, scale: this.scale, tabIndex: this.open ? undefined : -1, valueAsDate: this.valueAsDate,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setDatePickerRef }))), this.range && this.layout === "horizontal" && ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "horizontal-arrow-container" }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { flipRtl: true, icon: "arrow-right", scale: (0,_component_f94cab72_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.scale) }))), this.range && this.layout === "vertical" && this.scale !== "s" && ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "vertical-arrow-container" }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "arrow-down", scale: (0,_component_f94cab72_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.scale) }))), this.range && ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "input-wrapper", onClick: this.onInputWrapperClick,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setEndWrapper }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-text", { "aria-autocomplete": "none", "aria-controls": this.dialogId, "aria-expanded": (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_2__.t)(this.open), "aria-haspopup": "dialog", class: {
        input: true,
        "border-top-color-one": this.layout === "vertical" && this.range,
      }, disabled: disabled, icon: "calendar", onCalciteInputTextInput: this.calciteInternalInputInputHandler, onCalciteInternalInputTextBlur: this.calciteInternalInputBlurHandler, onCalciteInternalInputTextFocus: this.endInputFocus, onFocus: this.startEndInputFocus, placeholder: this.localeData?.placeholder, readOnly: readOnly, role: "combobox", scale: this.scale, status: this.status,
      // eslint-disable-next-line react/jsx-sort-props -- ref should be last so node attrs/props are in sync (see https://github.com/Esri/calcite-design-system/pull/6530)
      ref: this.setEndInput }), !this.readOnly && this.renderToggleIcon(this.open && this.focusedInput === "end"))))), (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)(_form_4876c9e5_js__WEBPACK_IMPORTED_MODULE_4__.H, { component: this })));
  }
  renderToggleIcon(open) {
    return ((0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.toggleIcon }, (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: open ? "chevron-up" : "chevron-down", scale: (0,_component_f94cab72_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.scale) })));
  }
  setReferenceEl() {
    const { focusedInput, layout, endWrapper, startWrapper } = this;
    this.referenceEl =
      focusedInput === "end" || layout === "vertical"
        ? endWrapper || startWrapper
        : startWrapper || endWrapper;
    requestAnimationFrame(() => (0,_floating_ui_e25cfa90_js__WEBPACK_IMPORTED_MODULE_3__.c)(this, this.referenceEl, this.floatingEl));
  }
  onLabelClick() {
    this.setFocus();
  }
  onBeforeOpen() {
    this.reposition(true);
    this.calciteInputDatePickerBeforeOpen.emit();
  }
  onOpen() {
    (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.a)(this, {
      onActivate: () => {
        if (this.focusOnOpen) {
          this.datePickerEl.setFocus();
          this.focusOnOpen = false;
        }
      },
    });
    this.calciteInputDatePickerOpen.emit();
  }
  onBeforeClose() {
    this.calciteInputDatePickerBeforeClose.emit();
  }
  onClose() {
    this.calciteInputDatePickerClose.emit();
    (0,_focusTrapComponent_aee15b41_js__WEBPACK_IMPORTED_MODULE_12__.d)(this);
    this.restoreInputFocus();
    this.focusOnOpen = false;
    this.datePickerEl.reset();
    this.reposition(true);
  }
  commitValue() {
    const { focusedInput, value } = this;
    const focusedInputName = `${focusedInput}Input`;
    const focusedInputValue = this[focusedInputName].value;
    const date = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.b)(focusedInputValue, this.localeData);
    const dateAsISO = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.c)(date);
    const valueIsArray = Array.isArray(value);
    if (this.range) {
      const focusedInputValueIndex = focusedInput === "start" ? 0 : 1;
      if (valueIsArray) {
        if (dateAsISO === value[focusedInputValueIndex]) {
          return;
        }
        if (date) {
          this.setRangeValue([
            focusedInput === "start" ? date : (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[0]),
            focusedInput === "end" ? date : (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[1]),
          ]);
          this.localizeInputValues();
        }
        else {
          this.setRangeValue([
            focusedInput === "end" && (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[0]),
            focusedInput === "start" && (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[1]),
          ]);
        }
      }
      else {
        if (date) {
          this.setRangeValue([
            focusedInput === "start" ? date : (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[0]),
            focusedInput === "end" ? date : (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.e)(value[1]),
          ]);
          this.localizeInputValues();
        }
      }
    }
    else {
      if (dateAsISO === value) {
        return;
      }
      this.setValue(date);
      this.localizeInputValues();
    }
  }
  async loadLocaleData() {
    _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.n.numberFormatOptions = {
      numberingSystem: this.numberingSystem,
      locale: this.effectiveLocale,
      useGrouping: false,
    };
    this.localeData = await (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.f)(this.effectiveLocale);
    this.localizeInputValues();
  }
  shouldFocusRangeStart() {
    const startValue = this.value[0];
    const endValue = this.value[1];
    return !!(endValue && !startValue && this.focusedInput === "end" && this.startInput);
  }
  shouldFocusRangeEnd() {
    const startValue = this.value[0];
    const endValue = this.value[1];
    return !!(startValue && !endValue && this.focusedInput === "start" && this.endInput);
  }
  restoreInputFocus() {
    if (!this.range) {
      this.startInput.setFocus();
      return;
    }
    const focusedInput = this.focusedInput === "start" ? this.startInput : this.endInput;
    focusedInput.setFocus();
  }
  localizeInputValues() {
    const date = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.h)((this.range
      ? (Array.isArray(this.valueAsDate) && this.valueAsDate[0]) || undefined
      : this.valueAsDate), this.minAsDate, this.maxAsDate);
    const endDate = this.range
      ? (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.h)((Array.isArray(this.valueAsDate) && this.valueAsDate[1]) || undefined, this.minAsDate, this.maxAsDate)
      : null;
    const formattingOptions = {
      // we explicitly set numberingSystem to prevent the browser-inferred value
      // see https://github.com/Esri/calcite-design-system/issues/3079#issuecomment-1168964195 for more info
      numberingSystem: _locale_6e783cf0_js__WEBPACK_IMPORTED_MODULE_9__.b,
    };
    const localizedDate = date && this.formatNumerals(date.toLocaleDateString(this.effectiveLocale, formattingOptions));
    const localizedEndDate = endDate &&
      this.formatNumerals(endDate.toLocaleDateString(this.effectiveLocale, formattingOptions));
    this.setInputValue(localizedDate ?? "", "start");
    this.setInputValue((this.range && localizedEndDate) ?? "", "end");
  }
  warnAboutInvalidValue(value) {
    console.warn(`The specified value "${value}" does not conform to the required format, "YYYY-MM-DD".`);
  }
  getNormalizedDate(value) {
    if (!value) {
      return "";
    }
    if (!isTwoDigitYear(value)) {
      return value;
    }
    const { day, month, year } = (0,_utils_ad0af80b_js__WEBPACK_IMPORTED_MODULE_1__.d)(value);
    const normalizedYear = normalizeToCurrentCentury(Number(year));
    return `${normalizedYear}-${month}-${day}`;
  }
  static get delegatesFocus() { return true; }
  static get assetsDirs() { return ["assets"]; }
  get el() { return (0,_index_86faef9c_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
  static get watchers() { return {
    "focusTrapDisabled": ["handleFocusTrapDisabled"],
    "disabled": ["handleDisabledAndReadOnlyChange"],
    "readOnly": ["handleDisabledAndReadOnlyChange"],
    "value": ["valueWatcher"],
    "valueAsDate": ["valueAsDateWatcher"],
    "flipPlacements": ["flipPlacementsHandler"],
    "messageOverrides": ["onMessagesChange"],
    "min": ["onMinChanged"],
    "max": ["onMaxChanged"],
    "open": ["openHandler"],
    "overlayPositioning": ["overlayPositioningHandler"],
    "layout": ["setReferenceEl"],
    "focusedInput": ["setReferenceEl"],
    "effectiveLocale": ["loadLocaleData"]
  }; }
};
InputDatePicker.style = inputDatePickerCss;



//# sourceMappingURL=calcite-input-date-picker.entry.js.map

/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/esm/label-1c285d41.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/esm/label-1c285d41.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ associateExplicitLabelToUnlabeledComponent),
/* harmony export */   b: () => (/* binding */ labelDisconnectedEvent),
/* harmony export */   c: () => (/* binding */ connectLabel),
/* harmony export */   d: () => (/* binding */ disconnectLabel),
/* harmony export */   g: () => (/* binding */ getLabelText),
/* harmony export */   l: () => (/* binding */ labelConnectedEvent)
/* harmony export */ });
/* harmony import */ var _dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-ed00a585.js */ "./node_modules/@esri/calcite-components/dist/esm/dom-ed00a585.js");
/* harmony import */ var _component_f94cab72_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./component-f94cab72.js */ "./node_modules/@esri/calcite-components/dist/esm/component-f94cab72.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.0.0
 */



/**
 * Exported for testing purposes only
 *
 * @internal
 */
const labelClickEvent = "calciteInternalLabelClick";
const labelConnectedEvent = "calciteInternalLabelConnected";
const labelDisconnectedEvent = "calciteInternalLabelDisconnected";
const labelTagName = "calcite-label";
const labelToLabelables = new WeakMap();
const onLabelClickMap = new WeakMap();
const onLabelConnectedMap = new WeakMap();
const onLabelDisconnectedMap = new WeakMap();
const unlabeledComponents = new Set();
const findLabelForComponent = (componentEl) => {
  const { id } = componentEl;
  const forLabel = id && (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_0__.q)(componentEl, { selector: `${labelTagName}[for="${id}"]` });
  if (forLabel) {
    return forLabel;
  }
  const parentLabel = (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_0__.c)(componentEl, labelTagName);
  if (!parentLabel ||
    // labelable components within other custom elements are not considered labelable
    hasAncestorCustomElements(parentLabel, componentEl)) {
    return null;
  }
  return parentLabel;
};
function hasAncestorCustomElements(label, componentEl) {
  let traversedElements;
  const customElementAncestorCheckEventType = "custom-element-ancestor-check";
  const listener = (event) => {
    event.stopImmediatePropagation();
    const composedPath = event.composedPath();
    traversedElements = composedPath.slice(composedPath.indexOf(componentEl), composedPath.indexOf(label));
  };
  label.addEventListener(customElementAncestorCheckEventType, listener, { once: true });
  componentEl.dispatchEvent(new CustomEvent(customElementAncestorCheckEventType, { composed: true, bubbles: true }));
  label.removeEventListener(customElementAncestorCheckEventType, listener);
  const ancestorCustomElements = traversedElements
    .filter((el) => el !== componentEl && el !== label)
    .filter((el) => el.tagName?.includes("-"));
  return ancestorCustomElements.length > 0;
}
/**
 * Helper to set up label interactions on connectedCallback.
 *
 * @param component
 */
function connectLabel(component) {
  if (!component) {
    return;
  }
  const labelEl = findLabelForComponent(component.el);
  if ((onLabelClickMap.has(labelEl) && labelEl === component.labelEl) ||
    (!labelEl && unlabeledComponents.has(component))) {
    return;
  }
  const boundOnLabelDisconnected = onLabelDisconnected.bind(component);
  if (labelEl) {
    component.labelEl = labelEl;
    const labelables = labelToLabelables.get(labelEl) || [];
    labelables.push(component);
    labelToLabelables.set(labelEl, labelables.sort(sortByDOMOrder));
    if (!onLabelClickMap.has(component.labelEl)) {
      onLabelClickMap.set(component.labelEl, onLabelClick);
      component.labelEl.addEventListener(labelClickEvent, onLabelClick);
    }
    unlabeledComponents.delete(component);
    document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));
    onLabelDisconnectedMap.set(component, boundOnLabelDisconnected);
    document.addEventListener(labelDisconnectedEvent, boundOnLabelDisconnected);
  }
  else if (!unlabeledComponents.has(component)) {
    boundOnLabelDisconnected();
    document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));
  }
}
/**
 * Helper to tear down label interactions on disconnectedCallback on labelable components.
 *
 * @param component
 */
function disconnectLabel(component) {
  if (!component) {
    return;
  }
  unlabeledComponents.delete(component);
  document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));
  document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));
  onLabelConnectedMap.delete(component);
  onLabelDisconnectedMap.delete(component);
  if (!component.labelEl) {
    return;
  }
  const labelables = labelToLabelables.get(component.labelEl);
  if (labelables.length === 1) {
    component.labelEl.removeEventListener(labelClickEvent, onLabelClickMap.get(component.labelEl));
    onLabelClickMap.delete(component.labelEl);
  }
  labelToLabelables.set(component.labelEl, labelables.filter((labelable) => labelable !== component).sort(sortByDOMOrder));
  component.labelEl = null;
}
function sortByDOMOrder(a, b) {
  return (0,_dom_ed00a585_js__WEBPACK_IMPORTED_MODULE_0__.k)(a.el, b.el) ? -1 : 1;
}
/**
 * Helper to get the label text from a component.
 *
 * @param component
 */
function getLabelText(component) {
  return component.label || component.labelEl?.textContent?.trim() || "";
}
function onLabelClick(event) {
  const labelClickTarget = event.detail.sourceEvent.target;
  const labelables = labelToLabelables.get(this);
  const clickedLabelable = labelables.find((labelable) => labelable.el === labelClickTarget);
  const labelableChildClicked = labelables.includes(clickedLabelable);
  if (labelableChildClicked) {
    // no need to forward click as labelable will receive focus
    return;
  }
  const firstLabelable = labelables[0];
  if (firstLabelable.disabled) {
    return;
  }
  firstLabelable.onLabelClick(event);
}
function onLabelConnected() {
  if (unlabeledComponents.has(this)) {
    connectLabel(this);
  }
}
function onLabelDisconnected() {
  unlabeledComponents.add(this);
  const boundOnLabelConnected = onLabelConnectedMap.get(this) || onLabelConnected.bind(this);
  onLabelConnectedMap.set(this, boundOnLabelConnected);
  document.addEventListener(labelConnectedEvent, boundOnLabelConnected);
}
/**
 * Helper to associate an explicit label (i.e., using `for`) with a labelable component that does not have an associated label.
 *
 * @param label - the label element
 */
async function associateExplicitLabelToUnlabeledComponent(label) {
  await (0,_component_f94cab72_js__WEBPACK_IMPORTED_MODULE_1__.c)(label);
  const alreadyLabeled = labelToLabelables.has(label);
  if (alreadyLabeled) {
    return;
  }
  const forComponentEl = label.ownerDocument?.getElementById(label.for);
  if (!forComponentEl) {
    return;
  }
  requestAnimationFrame(() => {
    for (const labelable of unlabeledComponents) {
      if (labelable.el === forComponentEl) {
        connectLabel(labelable);
        break;
      }
    }
  });
}



//# sourceMappingURL=label-1c285d41.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY2l0ZS1jb21wb25lbnRzL2NodW5rcy92ZW5kb3JzLW5vZGVfbW9kdWxlc19lc3JpX2NhbGNpdGUtY29tcG9uZW50c19kaXN0X2VzbV9jYWxjaXRlLWlucHV0LWRhdGUtcGlja2VyX2VudHJ5X2pzLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDa0k7QUFDeEw7QUFDb0k7QUFDckU7QUFDTTtBQUN4RTtBQUMwQjtBQUN5QztBQUN5QjtBQUM3RDtBQUNtQjtBQUNxQjtBQUM1RTtBQUNhO0FBQzNCO0FBQ0Q7QUFDRDtBQUNFOztBQUVqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxPQUFPLEVBQUUscURBQWdCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0MseUJBQXlCLGtDQUFrQyxrQ0FBa0MsOEJBQThCLHlDQUF5Qyx1QkFBdUIsdUNBQXVDLG1DQUFtQyw4QkFBOEIsK0JBQStCLGlDQUFpQyxpQ0FBaUMsa0JBQWtCLGVBQWUseUJBQXlCLGlCQUFpQix3Q0FBd0MsbURBQW1ELG9CQUFvQixNQUFNLGtCQUFrQixxQkFBcUIsaUJBQWlCLGlCQUFpQixtQkFBbUIsc0JBQXNCLDhCQUE4Qix1R0FBdUcsZ0RBQWdELGtCQUFrQixpREFBaUQsbURBQW1ELFVBQVUsMENBQTBDLCtCQUErQixzQkFBc0Isd0VBQXdFLDJCQUEyQixxRUFBcUUsMEJBQTBCLHNFQUFzRSwwQkFBMEIsdUVBQXVFLDJCQUEyQix3RUFBd0UsVUFBVSx1QkFBdUIsaUJBQWlCLGdDQUFnQyxrR0FBa0csaUJBQWlCLGlDQUFp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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsbURBQVE7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEseURBQWdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFOEs7O0FBRTlLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL25vZGVfbW9kdWxlcy9AZXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvZGlzdC9lc20vY2FsY2l0ZS1pbnB1dC1kYXRlLXBpY2tlci5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy9kaXN0L2VzbS9sYWJlbC0xYzI4NWQ0MS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL2Jsb2IvbWFpbi9MSUNFTlNFLm1kIGZvciBkZXRhaWxzLlxuICogdjIuMC4wXG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBnIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTg2ZmFlZjljLmpzJztcbmltcG9ydCB7IGQgYXMgZGF0ZVBhcnRzRnJvbUlTTywgYSBhcyBkYXRlUGFydHNGcm9tTG9jYWxpemVkU3RyaW5nLCBiIGFzIGRhdGVGcm9tTG9jYWxpemVkU3RyaW5nLCBpIGFzIGluUmFuZ2UsIGMgYXMgZGF0ZVRvSVNPLCBnIGFzIGdldFZhbHVlQXNEYXRlUmFuZ2UsIGUgYXMgZGF0ZUZyb21JU08sIGYgYXMgZ2V0TG9jYWxlRGF0YSwgaCBhcyBkYXRlRnJvbVJhbmdlIH0gZnJvbSAnLi91dGlscy1hZDBhZjgwYi5qcyc7XG5pbXBvcnQgeyB0IGFzIHRvQXJpYUJvb2xlYW4gfSBmcm9tICcuL2RvbS1lZDAwYTU4NS5qcyc7XG5pbXBvcnQgeyBmIGFzIGZpbHRlckNvbXB1dGVkUGxhY2VtZW50cywgYyBhcyBjb25uZWN0RmxvYXRpbmdVSSwgZCBhcyBkZWZhdWx0TWVudVBsYWNlbWVudCwgciBhcyByZXBvc2l0aW9uLCBhIGFzIGRpc2Nvbm5lY3RGbG9hdGluZ1VJLCBGIGFzIEZsb2F0aW5nQ1NTIH0gZnJvbSAnLi9mbG9hdGluZy11aS1lMjVjZmE5MC5qcyc7XG5pbXBvcnQgeyBzIGFzIHN1Ym1pdEZvcm0sIGMgYXMgY29ubmVjdEZvcm0sIGQgYXMgZGlzY29ubmVjdEZvcm0sIEggYXMgSGlkZGVuRm9ybUlucHV0U2xvdCB9IGZyb20gJy4vZm9ybS00ODc2YzllNS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbm5lY3RJbnRlcmFjdGl2ZSwgZCBhcyBkaXNjb25uZWN0SW50ZXJhY3RpdmUsIHUgYXMgdXBkYXRlSG9zdEludGVyYWN0aW9uIH0gZnJvbSAnLi9pbnRlcmFjdGl2ZS1jYmQ4YTZkYy5qcyc7XG5pbXBvcnQgeyBuIGFzIG51bWJlcktleXMgfSBmcm9tICcuL2tleS02MWY4MmRkYi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbm5lY3RMYWJlbCwgZCBhcyBkaXNjb25uZWN0TGFiZWwgfSBmcm9tICcuL2xhYmVsLTFjMjg1ZDQxLmpzJztcbmltcG9ydCB7IGMgYXMgY29tcG9uZW50Rm9jdXNhYmxlLCBzIGFzIHNldFVwTG9hZGFibGVDb21wb25lbnQsIGEgYXMgc2V0Q29tcG9uZW50TG9hZGVkIH0gZnJvbSAnLi9sb2FkYWJsZS1iMTczOTZlMC5qcyc7XG5pbXBvcnQgeyBuIGFzIG51bWJlclN0cmluZ0Zvcm1hdHRlciwgYyBhcyBjb25uZWN0TG9jYWxpemVkLCBkIGFzIGRpc2Nvbm5lY3RMb2NhbGl6ZWQsIGIgYXMgZGVmYXVsdE51bWJlcmluZ1N5c3RlbSB9IGZyb20gJy4vbG9jYWxlLTZlNzgzY2YwLmpzJztcbmltcG9ydCB7IG8gYXMgb25Ub2dnbGVPcGVuQ2xvc2VDb21wb25lbnQgfSBmcm9tICcuL29wZW5DbG9zZUNvbXBvbmVudC00OGRiNmRhZi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbm5lY3RNZXNzYWdlcywgcyBhcyBzZXRVcE1lc3NhZ2VzLCBkIGFzIGRpc2Nvbm5lY3RNZXNzYWdlcyB9IGZyb20gJy4vdDluLTBiY2RjYTU0LmpzJztcbmltcG9ydCB7IGMgYXMgY29ubmVjdEZvY3VzVHJhcCwgZCBhcyBkZWFjdGl2YXRlRm9jdXNUcmFwLCBhIGFzIGFjdGl2YXRlRm9jdXNUcmFwIH0gZnJvbSAnLi9mb2N1c1RyYXBDb21wb25lbnQtYWVlMTViNDEuanMnO1xuaW1wb3J0IHsgZyBhcyBndWlkIH0gZnJvbSAnLi9ndWlkLTIxZmVjZmE0LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0SWNvblNjYWxlIH0gZnJvbSAnLi9jb21wb25lbnQtZjk0Y2FiNzIuanMnO1xuaW1wb3J0ICcuL3Jlc291cmNlcy1jZjgyMzg4Yy5qcyc7XG5pbXBvcnQgJy4vZGVib3VuY2UtODU5NThiYjEuanMnO1xuaW1wb3J0ICcuL2Jyb3dzZXItZWNlMjlkYTcuanMnO1xuaW1wb3J0ICcuL29ic2VydmVycy03MWQzMzJkYi5qcyc7XG5cbmNvbnN0IENTUyA9IHtcbiAgYXNzaXN0aXZlVGV4dDogXCJhc3Npc3RpdmUtdGV4dFwiLFxuICBtZW51OiBcIm1lbnUtY29udGFpbmVyXCIsXG4gIG1lbnVBY3RpdmU6IFwibWVudS1jb250YWluZXItLWFjdGl2ZVwiLFxuICB0b2dnbGVJY29uOiBcInRvZ2dsZS1pY29uXCIsXG59O1xuXG4vKipcbiAqIFNwZWNpZmllcyBpZiBhbiBJU08gc3RyaW5nIGRhdGUgKFlZWVktTU0tREQpIGhhcyB0d28gZGlnaXQgeWVhci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpc1R3b0RpZ2l0WWVhcih2YWx1ZSkge1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHsgeWVhciB9ID0gZGF0ZVBhcnRzRnJvbUlTTyh2YWx1ZSk7XG4gIHJldHVybiBOdW1iZXIoeWVhcikgPCAxMDA7XG59XG4vKipcbiAqIFJldHVybnMgYSBub3JtYWxpemVkIHllYXIgdG8gY3VycmVudCBjZW50dXJ5IGZyb20gYSBnaXZlbiB0d28gZGlnaXQgeWVhciBudW1iZXIuXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IHR3b0RpZ2l0WWVhclxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gbm9ybWFsaXplVG9DdXJyZW50Q2VudHVyeSh0d29EaWdpdFllYXIpIHtcbiAgY29uc3QgY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XG4gIGNvbnN0IG5vcm1hbGl6ZWRZZWFyID0gTWF0aC5mbG9vcihjdXJyZW50WWVhciAvIDEwMCkgKiAxMDAgKyB0d29EaWdpdFllYXI7XG4gIHJldHVybiBub3JtYWxpemVkWWVhcjtcbn1cblxuY29uc3QgaW5wdXREYXRlUGlja2VyQ3NzID0gXCI6aG9zdHstLWNhbGNpdGUtaWNvbi1zaXplOjFyZW07LS1jYWxjaXRlLXNwYWNpbmctZWlnaHRoOjAuMTI1cmVtOy0tY2FsY2l0ZS1zcGFjaW5nLXF1YXJ0ZXI6MC4yNXJlbTstLWNhbGNpdGUtc3BhY2luZy1oYWxmOjAuNXJlbTstLWNhbGNpdGUtc3BhY2luZy10aHJlZS1xdWFydGVyczowLjc1cmVtOy0tY2FsY2l0ZS1zcGFjaW5nOjFyZW07LS1jYWxjaXRlLXNwYWNpbmctcGx1cy1xdWFydGVyOjEuMjVyZW07LS1jYWxjaXRlLXNwYWNpbmctcGx1cy1oYWxmOjEuNXJlbTstLWNhbGNpdGUtc3BhY2luZy1kb3VibGU6MnJlbTstLWNhbGNpdGUtbWVudS1taW4td2lkdGg6MTByZW07LS1jYWxjaXRlLWhlYWRlci1taW4taGVpZ2h0OjNyZW07LS1jYWxjaXRlLWZvb3Rlci1taW4taGVpZ2h0OjNyZW19Omhvc3QoW2Rpc2FibGVkXSl7Y3Vyc29yOmRlZmF1bHQ7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmU7b3BhY2l0eTp2YXIoLS1jYWxjaXRlLW9wYWNpdHktZGlzYWJsZWQpfTpob3N0KFtkaXNhYmxlZF0pICosOmhvc3QoW2Rpc2FibGVkXSkgOjpzbG90dGVkKCope3BvaW50ZXItZXZlbnRzOm5vbmV9Omhvc3R7cG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTppbmxpbmUtYmxvY2s7aW5saW5lLXNpemU6MTAwJTtvdmVyZmxvdzp2aXNpYmxlO3ZlcnRpY2FsLWFsaWduOnRvcDstLXR3LXNoYWRvdzowIDAgIzAwMDA7LS10dy1zaGFkb3ctY29sb3JlZDowIDAgIzAwMDA7Ym94LXNoYWRvdzp2YXIoLS10dy1yaW5nLW9mZnNldC1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXJpbmctc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1zaGFkb3cpfTpob3N0IC5tZW51LWNvbnRhaW5lciAuY2FsY2l0ZS1mbG9hdGluZy11aS1hbmlte3Bvc2l0aW9uOnJlbGF0aXZlO3RyYW5zaXRpb246dmFyKC0tY2FsY2l0ZS1mbG9hdGluZy11aS10cmFuc2l0aW9uKTt0cmFuc2l0aW9uLXByb3BlcnR5OnRyYW5zZm9ybSwgdmlzaWJpbGl0eSwgb3BhY2l0eTtvcGFjaXR5OjA7Ym94LXNoYWRvdzowIDAgMTZweCAwIHJnYmEoMCwgMCwgMCwgMC4xNik7ei1pbmRleDp2YXIoLS1jYWxjaXRlLXotaW5kZXgpO2JvcmRlci1yYWRpdXM6MC4yNXJlbX06aG9zdCAubWVudS1jb250YWluZXJbZGF0YS1wbGFjZW1lbnRePWJvdHRvbV0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtNXB4KX06aG9zdCAubWVudS1jb250YWluZXJbZGF0YS1wbGFjZW1lbnRePXRvcF0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWSg1cHgpfTpob3N0IC5tZW51LWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF49bGVmdF0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWCg1cHgpfTpob3N0IC5tZW51LWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF49cmlnaHRdIC5jYWxjaXRlLWZsb2F0aW5nLXVpLWFuaW17dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTVweCl9Omhvc3QgLm1lbnUtY29udGFpbmVyW2RhdGEtcGxhY2VtZW50XSAuY2FsY2l0ZS1mbG9hdGluZy11aS1hbmltLS1hY3RpdmV7b3BhY2l0eToxO3RyYW5zZm9ybTp0cmFuc2xhdGUoMCl9Omhvc3QoW3NjYWxlPXNdKXstLWNhbGNpdGUtdG9nZ2xlLXNwYWNpbmc6MC41cmVtOy0tY2FsY2l0ZS1pbnRlcm5hbC1pbnB1dC10ZXh0LWlucHV0LXBhZGRpbmctaW5saW5lLWVuZDpjYWxjKHZhcigtLWNhbGNpdGUtdG9nZ2xlLXNwYWNpbmcpICsgMXJlbSl9Omhvc3QoW3NjYWxlPW1dKXstLWNhbGNpdGUtdG9nZ2xlLXNwYWNpbmc6MC43NXJlbTstLWNhbGNpdGUtaW50ZXJuYWwtaW5wdXQtdGV4dC1pbnB1dC1wYWRkaW5nLWlubGluZS1lbmQ6Y2FsYyh2YXIoLS1jYWxjaXRlLXRvZ2dsZS1zcGFjaW5nKSArIDEuNXJlbSl9Omhvc3QoW3NjYWxlPWxdKXstLWNhbGNpdGUtdG9nZ2xlLXNwYWNpbmc6MXJlbTstLWNhbGNpdGUtaW50ZXJuYWwtaW5wdXQtdGV4dC1pbnB1dC1wYWRkaW5nLWlubGluZS1lbmQ6Y2FsYyh2YXIoLS1jYWxjaXRlLXRvZ2dsZS1zcGFjaW5nKSArIDJyZW0pfTpob3N0KFtkaXNhYmxlZF0pIDo6c2xvdHRlZChbY2FsY2l0ZS1oeWRyYXRlZF1bZGlzYWJsZWRdKSw6aG9zdChbZGlzYWJsZWRdKSBbY2FsY2l0ZS1oeWRyYXRlZF1bZGlzYWJsZWRde29wYWNpdHk6MX0uY2FsZW5kYXItcGlja2VyLXdyYXBwZXJ7LS10dy1zaGFkb3c6MCAwICMwMDAwOy0tdHctc2hhZG93LWNvbG9yZWQ6MCAwICMwMDAwO2JveC1zaGFkb3c6dmFyKC0tdHctcmluZy1vZmZzZXQtc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1yaW5nLXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctc2hhZG93KTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMCwgMCl9LmlucHV0LXdyYXBwZXJ7cG9zaXRpb246cmVsYXRpdmV9LnRvZ2dsZS1pY29ue3Bvc2l0aW9uOmFic29sdXRlO2Rpc3BsYXk6ZmxleDtjdXJzb3I6cG9pbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7aW5zZXQtaW5saW5lLWVuZDowO2luc2V0LWJsb2NrOjA7cGFkZGluZy1pbmxpbmU6dmFyKC0tY2FsY2l0ZS10b2dnbGUtc3BhY2luZyl9Omhvc3QoW3JhbmdlXSkgLmlucHV0LWNvbnRhaW5lcntkaXNwbGF5OmZsZXh9Omhvc3QoW3JhbmdlXSkgLmlucHV0LXdyYXBwZXJ7ZmxleDoxIDEgYXV0b306aG9zdChbcmFuZ2VdKSAuaG9yaXpvbnRhbC1hcnJvdy1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtib3JkZXItd2lkdGg6MXB4O2JvcmRlci1pbmxpbmUtc3RhcnQtd2lkdGg6MHB4O2JvcmRlci1pbmxpbmUtZW5kLXdpZHRoOjBweDtib3JkZXItc3R5bGU6c29saWQ7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLWlucHV0KTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7cGFkZGluZy1ibG9jazowcHg7cGFkZGluZy1pbmxpbmU6MC4yNXJlbX06aG9zdChbcmFuZ2VdW2xheW91dD12ZXJ0aWNhbF0pIC5pbnB1dC13cmFwcGVye2lubGluZS1zaXplOjEwMCV9Omhvc3QoW3JhbmdlXVtsYXlvdXQ9dmVydGljYWxdKSAuaW5wdXQtY29udGFpbmVye2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpmbGV4LXN0YXJ0fTpob3N0KFtyYW5nZV1bbGF5b3V0PXZlcnRpY2FsXSkgLmNhbGVuZGFyLXBpY2tlci13cmFwcGVyLS1lbmR7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsIDAsIDApfTpob3N0KFtyYW5nZV1bbGF5b3V0PXZlcnRpY2FsXSkgLnZlcnRpY2FsLWFycm93LWNvbnRhaW5lcntpbnNldC1ibG9jay1zdGFydDoxLjVyZW07cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDp2YXIoLS1jYWxjaXRlLXotaW5kZXgpO21hcmdpbi1pbmxpbmU6MXB4O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO3BhZGRpbmctaW5saW5lOjAuNjI1cmVtO2luc2V0LWlubGluZS1zdGFydDowfS5tZW51LWNvbnRhaW5lcnstLWNhbGNpdGUtZmxvYXRpbmctdWktei1pbmRleDp2YXIoLS1jYWxjaXRlLXotaW5kZXgtZHJvcGRvd24pO2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDp2YXIoLS1jYWxjaXRlLWZsb2F0aW5nLXVpLXotaW5kZXgpO3Zpc2liaWxpdHk6aGlkZGVufS5tZW51LWNvbnRhaW5lciAuY2FsY2l0ZS1mbG9hdGluZy11aS1hbmlte3Bvc2l0aW9uOnJlbGF0aXZlO3RyYW5zaXRpb246dmFyKC0tY2FsY2l0ZS1mbG9hdGluZy11aS10cmFuc2l0aW9uKTt0cmFuc2l0aW9uLXByb3BlcnR5OnRyYW5zZm9ybSwgdmlzaWJpbGl0eSwgb3BhY2l0eTtvcGFjaXR5OjA7Ym94LXNoYWRvdzowIDAgMTZweCAwIHJnYmEoMCwgMCwgMCwgMC4xNik7ei1pbmRleDp2YXIoLS1jYWxjaXRlLXotaW5kZXgpO2JvcmRlci1yYWRpdXM6MC4yNXJlbX0ubWVudS1jb250YWluZXJbZGF0YS1wbGFjZW1lbnRePWJvdHRvbV0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtNXB4KX0ubWVudS1jb250YWluZXJbZGF0YS1wbGFjZW1lbnRePXRvcF0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWSg1cHgpfS5tZW51LWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF49bGVmdF0gLmNhbGNpdGUtZmxvYXRpbmctdWktYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlWCg1cHgpfS5tZW51LWNvbnRhaW5lcltkYXRhLXBsYWNlbWVudF49cmlnaHRdIC5jYWxjaXRlLWZsb2F0aW5nLXVpLWFuaW17dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTVweCl9Lm1lbnUtY29udGFpbmVyW2RhdGEtcGxhY2VtZW50XSAuY2FsY2l0ZS1mbG9hdGluZy11aS1hbmltLS1hY3RpdmV7b3BhY2l0eToxO3RyYW5zZm9ybTp0cmFuc2xhdGUoMCl9Omhvc3QoW29wZW5dKSAubWVudS1jb250YWluZXJ7dmlzaWJpbGl0eTp2aXNpYmxlfS5tZW51LWNvbnRhaW5lci0tYWN0aXZle3Zpc2liaWxpdHk6dmlzaWJsZX0uaW5wdXQgLmNhbGNpdGUtaW5wdXRfX3dyYXBwZXJ7bWFyZ2luLWJsb2NrLXN0YXJ0OjBweH06aG9zdChbcmFuZ2VdW2xheW91dD12ZXJ0aWNhbF1bc2NhbGU9bV0pIC52ZXJ0aWNhbC1hcnJvdy1jb250YWluZXJ7aW5zZXQtYmxvY2stc3RhcnQ6MS41cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjAuNzVyZW19Omhvc3QoW3JhbmdlXVtsYXlvdXQ9dmVydGljYWxdW3NjYWxlPW1dKSAudmVydGljYWwtYXJyb3ctY29udGFpbmVyIGNhbGNpdGUtaWNvbntibG9jay1zaXplOjAuNzVyZW07aW5saW5lLXNpemU6MC43NXJlbTttaW4taW5saW5lLXNpemU6MHB4fTpob3N0KFtyYW5nZV1bbGF5b3V0PXZlcnRpY2FsXVtzY2FsZT1sXSkgLnZlcnRpY2FsLWFycm93LWNvbnRhaW5lcntpbnNldC1ibG9jay1zdGFydDoyLjI1cmVtO3BhZGRpbmctaW5saW5lOjAuODc1cmVtfTpob3N0KFtyYW5nZV1bbGF5b3V0PXZlcnRpY2FsXVtvcGVuXSkgLnZlcnRpY2FsLWFycm93LWNvbnRhaW5lcntkaXNwbGF5Om5vbmV9OjpzbG90dGVkKGlucHV0W3Nsb3Q9aGlkZGVuLWZvcm0taW5wdXRdKXttYXJnaW46MCAhaW1wb3J0YW50O29wYWNpdHk6MCAhaW1wb3J0YW50O291dGxpbmU6bm9uZSAhaW1wb3J0YW50O3BhZGRpbmc6MCAhaW1wb3J0YW50O3Bvc2l0aW9uOmFic29sdXRlICFpbXBvcnRhbnQ7aW5zZXQ6MCAhaW1wb3J0YW50O3RyYW5zZm9ybTpub25lICFpbXBvcnRhbnQ7LXdlYmtpdC1hcHBlYXJhbmNlOm5vbmUgIWltcG9ydGFudDt6LWluZGV4Oi0xICFpbXBvcnRhbnR9LmFzc2lzdGl2ZS10ZXh0e3Bvc2l0aW9uOmFic29sdXRlO2lubGluZS1zaXplOjFweDtibG9jay1zaXplOjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9Omhvc3QoW2hpZGRlbl0pe2Rpc3BsYXk6bm9uZX1baGlkZGVuXXtkaXNwbGF5Om5vbmV9XCI7XG5cbmNvbnN0IElucHV0RGF0ZVBpY2tlciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5jYWxjaXRlSW5wdXREYXRlUGlja2VyQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlSW5wdXREYXRlUGlja2VyQ2hhbmdlXCIsIDYpO1xuICAgIHRoaXMuY2FsY2l0ZUlucHV0RGF0ZVBpY2tlckJlZm9yZUNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlSW5wdXREYXRlUGlja2VyQmVmb3JlQ2xvc2VcIiwgNik7XG4gICAgdGhpcy5jYWxjaXRlSW5wdXREYXRlUGlja2VyQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNhbGNpdGVJbnB1dERhdGVQaWNrZXJDbG9zZVwiLCA2KTtcbiAgICB0aGlzLmNhbGNpdGVJbnB1dERhdGVQaWNrZXJCZWZvcmVPcGVuID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlSW5wdXREYXRlUGlja2VyQmVmb3JlT3BlblwiLCA2KTtcbiAgICB0aGlzLmNhbGNpdGVJbnB1dERhdGVQaWNrZXJPcGVuID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYWxjaXRlSW5wdXREYXRlUGlja2VyT3BlblwiLCA2KTtcbiAgICB0aGlzLmNhbGNpdGVJbnRlcm5hbElucHV0SW5wdXRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRhcmdldC52YWx1ZTtcbiAgICAgIGNvbnN0IHBhcnNlZFZhbHVlID0gdGhpcy5wYXJzZU51bWVyYWxzKHZhbHVlKTtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gdGhpcy5mb3JtYXROdW1lcmFscyhwYXJzZWRWYWx1ZSk7XG4gICAgICB0YXJnZXQudmFsdWUgPSBmb3JtYXR0ZWRWYWx1ZTtcbiAgICAgIGNvbnN0IHsgeWVhciB9ID0gZGF0ZVBhcnRzRnJvbUxvY2FsaXplZFN0cmluZyh2YWx1ZSwgdGhpcy5sb2NhbGVEYXRhKTtcbiAgICAgIGlmICh5ZWFyICYmIHllYXIubGVuZ3RoIDwgNCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRlID0gZGF0ZUZyb21Mb2NhbGl6ZWRTdHJpbmcodmFsdWUsIHRoaXMubG9jYWxlRGF0YSk7XG4gICAgICBpZiAoaW5SYW5nZShkYXRlLCB0aGlzLm1pbiwgdGhpcy5tYXgpKSB7XG4gICAgICAgIHRoaXMuZGF0ZVBpY2tlckFjdGl2ZURhdGUgPSBkYXRlO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jYWxjaXRlSW50ZXJuYWxJbnB1dEJsdXJIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgdGhpcy5jb21taXRWYWx1ZSgpO1xuICAgIH07XG4gICAgdGhpcy5kaWFsb2dJZCA9IGBkYXRlLXBpY2tlci1kaWFsb2ctLSR7Z3VpZCgpfWA7XG4gICAgdGhpcy5mb2N1c09uT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMubGFzdEJsdXJyZWRJbnB1dCA9IFwibm9uZVwiO1xuICAgIHRoaXMudXNlckNoYW5nZWRWYWx1ZSA9IGZhbHNlO1xuICAgIHRoaXMub3BlblRyYW5zaXRpb25Qcm9wID0gXCJvcGFjaXR5XCI7XG4gICAgdGhpcy52YWx1ZUFzRGF0ZUNoYW5nZWRFeHRlcm5hbGx5ID0gZmFsc2U7XG4gICAgdGhpcy5wbGFjZWhvbGRlclRleHRJZCA9IGBjYWxjaXRlLWlucHV0LWRhdGUtcGlja2VyLXBsYWNlaG9sZGVyLSR7Z3VpZCgpfWA7XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMub25JbnB1dFdyYXBwZXJDbGljayA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnJhbmdlICYmIHRoaXMubGFzdEJsdXJyZWRJbnB1dCAhPT0gXCJub25lXCIgJiYgdGhpcy5vcGVuKSA7XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGVuID0gIXRoaXMub3BlbjtcbiAgICAgIH1cbiAgICAgIHRoaXMubGFzdEJsdXJyZWRJbnB1dCA9IFwibm9uZVwiO1xuICAgIH07XG4gICAgdGhpcy5zZXRGaWx0ZXJlZFBsYWNlbWVudHMgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7IGVsLCBmbGlwUGxhY2VtZW50cyB9ID0gdGhpcztcbiAgICAgIHRoaXMuZmlsdGVyZWRGbGlwUGxhY2VtZW50cyA9IGZsaXBQbGFjZW1lbnRzXG4gICAgICAgID8gZmlsdGVyQ29tcHV0ZWRQbGFjZW1lbnRzKGZsaXBQbGFjZW1lbnRzLCBlbClcbiAgICAgICAgOiBudWxsO1xuICAgIH07XG4gICAgdGhpcy5zZXRUcmFuc2l0aW9uRWwgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMudHJhbnNpdGlvbkVsID0gZWw7XG4gICAgfTtcbiAgICB0aGlzLnNldFN0YXJ0SW5wdXQgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMuc3RhcnRJbnB1dCA9IGVsO1xuICAgIH07XG4gICAgdGhpcy5zZXRFbmRJbnB1dCA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5lbmRJbnB1dCA9IGVsO1xuICAgIH07XG4gICAgdGhpcy5kZWFjdGl2YXRlID0gKCkgPT4ge1xuICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICB0aGlzLmxhc3RCbHVycmVkSW5wdXQgPSBcIm5vbmVcIjtcbiAgICB9O1xuICAgIHRoaXMua2V5RG93bkhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHsgZGVmYXVsdFByZXZlbnRlZCwga2V5IH0gPSBldmVudDtcbiAgICAgIGlmIChkZWZhdWx0UHJldmVudGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICB0aGlzLmNvbW1pdFZhbHVlKCk7XG4gICAgICAgIGlmICh0aGlzLnNob3VsZEZvY3VzUmFuZ2VFbmQoKSkge1xuICAgICAgICAgIHRoaXMuZW5kSW5wdXQ/LnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zaG91bGRGb2N1c1JhbmdlU3RhcnQoKSkge1xuICAgICAgICAgIHRoaXMuc3RhcnRJbnB1dD8uc2V0Rm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3VibWl0Rm9ybSh0aGlzKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdGhpcy5yZXN0b3JlSW5wdXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChrZXkgPT09IFwiQXJyb3dEb3duXCIpIHtcbiAgICAgICAgdGhpcy5vcGVuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5mb2N1c09uT3BlbiA9IHRydWU7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChrZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMucmVzdG9yZUlucHV0Rm9jdXMoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuc3RhcnRJbnB1dEZvY3VzID0gKCkgPT4ge1xuICAgICAgdGhpcy5mb2N1c2VkSW5wdXQgPSBcInN0YXJ0XCI7XG4gICAgfTtcbiAgICB0aGlzLnN0YXJ0RW5kSW5wdXRGb2N1cyA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3QgYmx1cnJlZEVsID0gZXZlbnQucmVsYXRlZFRhcmdldDtcbiAgICAgIHRoaXMubGFzdEJsdXJyZWRJbnB1dCA9XG4gICAgICAgIGJsdXJyZWRFbCA9PT0gdGhpcy5zdGFydElucHV0ID8gXCJzdGFydFwiIDogYmx1cnJlZEVsID09PSB0aGlzLmVuZElucHV0ID8gXCJlbmRcIiA6IFwibm9uZVwiO1xuICAgIH07XG4gICAgdGhpcy5lbmRJbnB1dEZvY3VzID0gKCkgPT4ge1xuICAgICAgdGhpcy5mb2N1c2VkSW5wdXQgPSBcImVuZFwiO1xuICAgIH07XG4gICAgdGhpcy5zZXRGbG9hdGluZ0VsID0gKGVsKSA9PiB7XG4gICAgICB0aGlzLmZsb2F0aW5nRWwgPSBlbDtcbiAgICAgIGNvbm5lY3RGbG9hdGluZ1VJKHRoaXMsIHRoaXMucmVmZXJlbmNlRWwsIHRoaXMuZmxvYXRpbmdFbCk7XG4gICAgfTtcbiAgICB0aGlzLnNldFN0YXJ0V3JhcHBlciA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5zdGFydFdyYXBwZXIgPSBlbDtcbiAgICAgIHRoaXMuc2V0UmVmZXJlbmNlRWwoKTtcbiAgICB9O1xuICAgIHRoaXMuc2V0RW5kV3JhcHBlciA9IChlbCkgPT4ge1xuICAgICAgdGhpcy5lbmRXcmFwcGVyID0gZWw7XG4gICAgICB0aGlzLnNldFJlZmVyZW5jZUVsKCk7XG4gICAgfTtcbiAgICB0aGlzLnNldERhdGVQaWNrZXJSZWYgPSAoZWwpID0+IHtcbiAgICAgIHRoaXMuZGF0ZVBpY2tlckVsID0gZWw7XG4gICAgICBjb25uZWN0Rm9jdXNUcmFwKHRoaXMsIHtcbiAgICAgICAgZm9jdXNUcmFwRWw6IGVsLFxuICAgICAgICBmb2N1c1RyYXBPcHRpb25zOiB7XG4gICAgICAgICAgaW5pdGlhbEZvY3VzOiBmYWxzZSxcbiAgICAgICAgICBzZXRSZXR1cm5Gb2N1czogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEV2ZW50IGhhbmRsZXIgZm9yIHdoZW4gdGhlIHNlbGVjdGVkIGRhdGUgY2hhbmdlc1xuICAgICAqXG4gICAgICogQHBhcmFtIGV2ZW50IENhbGNpdGVEYXRlUGlja2VyIGN1c3RvbSBjaGFuZ2UgZXZlbnRcbiAgICAgKi9cbiAgICB0aGlzLmhhbmRsZURhdGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLnJhbmdlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5zZXRWYWx1ZShldmVudC50YXJnZXQudmFsdWVBc0RhdGUpO1xuICAgICAgdGhpcy5sb2NhbGl6ZUlucHV0VmFsdWVzKCk7XG4gICAgICB0aGlzLnJlc3RvcmVJbnB1dEZvY3VzKCk7XG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZURhdGVSYW5nZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLnJhbmdlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgdmFsdWUgPSBldmVudC50YXJnZXQudmFsdWVBc0RhdGU7XG4gICAgICB0aGlzLnNldFJhbmdlVmFsdWUodmFsdWUpO1xuICAgICAgdGhpcy5sb2NhbGl6ZUlucHV0VmFsdWVzKCk7XG4gICAgICB0aGlzLnJlc3RvcmVJbnB1dEZvY3VzKCk7XG4gICAgfTtcbiAgICB0aGlzLnNldElucHV0VmFsdWUgPSAobmV3VmFsdWUsIGlucHV0ID0gXCJzdGFydFwiKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dEVsID0gdGhpc1tgJHtpbnB1dH1JbnB1dGBdO1xuICAgICAgaWYgKCFpbnB1dEVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlucHV0RWwudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB9O1xuICAgIHRoaXMuc2V0UmFuZ2VWYWx1ZSA9ICh2YWx1ZUFzRGF0ZSkgPT4ge1xuICAgICAgaWYgKCF0aGlzLnJhbmdlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgdmFsdWU6IG9sZFZhbHVlIH0gPSB0aGlzO1xuICAgICAgY29uc3Qgb2xkVmFsdWVJc0FycmF5ID0gQXJyYXkuaXNBcnJheShvbGRWYWx1ZSk7XG4gICAgICBjb25zdCB2YWx1ZUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHZhbHVlQXNEYXRlKTtcbiAgICAgIGNvbnN0IG5ld1N0YXJ0RGF0ZSA9IHZhbHVlSXNBcnJheSA/IHZhbHVlQXNEYXRlWzBdIDogbnVsbDtcbiAgICAgIGxldCBuZXdTdGFydERhdGVJU08gPSB2YWx1ZUlzQXJyYXkgPyBkYXRlVG9JU08obmV3U3RhcnREYXRlKSA6IFwiXCI7XG4gICAgICBpZiAobmV3U3RhcnREYXRlSVNPKSB7XG4gICAgICAgIG5ld1N0YXJ0RGF0ZUlTTyA9IHRoaXMuZ2V0Tm9ybWFsaXplZERhdGUobmV3U3RhcnREYXRlSVNPKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld0VuZERhdGUgPSB2YWx1ZUlzQXJyYXkgPyB2YWx1ZUFzRGF0ZVsxXSA6IG51bGw7XG4gICAgICBsZXQgbmV3RW5kRGF0ZUlTTyA9IHZhbHVlSXNBcnJheSA/IGRhdGVUb0lTTyhuZXdFbmREYXRlKSA6IFwiXCI7XG4gICAgICBpZiAobmV3RW5kRGF0ZUlTTykge1xuICAgICAgICBuZXdFbmREYXRlSVNPID0gdGhpcy5nZXROb3JtYWxpemVkRGF0ZShuZXdFbmREYXRlSVNPKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gbmV3U3RhcnREYXRlSVNPIHx8IG5ld0VuZERhdGVJU08gPyBbbmV3U3RhcnREYXRlSVNPLCBuZXdFbmREYXRlSVNPXSA6IFwiXCI7XG4gICAgICBpZiAobmV3VmFsdWUgPT09IG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudXNlckNoYW5nZWRWYWx1ZSA9IHRydWU7XG4gICAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICB0aGlzLnZhbHVlQXNEYXRlID0gbmV3VmFsdWUgPyBnZXRWYWx1ZUFzRGF0ZVJhbmdlKG5ld1ZhbHVlKSA6IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IGNoYW5nZUV2ZW50ID0gdGhpcy5jYWxjaXRlSW5wdXREYXRlUGlja2VyQ2hhbmdlLmVtaXQoKTtcbiAgICAgIGlmIChjaGFuZ2VFdmVudCAmJiBjaGFuZ2VFdmVudC5kZWZhdWx0UHJldmVudGVkKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBvbGRWYWx1ZTtcbiAgICAgICAgaWYgKG9sZFZhbHVlSXNBcnJheSkge1xuICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShvbGRWYWx1ZVswXSwgXCJzdGFydFwiKTtcbiAgICAgICAgICB0aGlzLnNldElucHV0VmFsdWUob2xkVmFsdWVbMV0sIFwiZW5kXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBvbGRWYWx1ZTtcbiAgICAgICAgICB0aGlzLnNldElucHV0VmFsdWUob2xkVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnNldFZhbHVlID0gKHZhbHVlKSA9PiB7XG4gICAgICBpZiAodGhpcy5yYW5nZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgICBsZXQgbmV3VmFsdWUgPSBkYXRlVG9JU08odmFsdWUpO1xuICAgICAgbmV3VmFsdWUgPSB0aGlzLmdldE5vcm1hbGl6ZWREYXRlKG5ld1ZhbHVlKTtcbiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy51c2VyQ2hhbmdlZFZhbHVlID0gdHJ1ZTtcbiAgICAgIHRoaXMudmFsdWVBc0RhdGUgPSBuZXdWYWx1ZSA/IGRhdGVGcm9tSVNPKG5ld1ZhbHVlKSA6IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZSB8fCBcIlwiO1xuICAgICAgY29uc3QgY2hhbmdlRXZlbnQgPSB0aGlzLmNhbGNpdGVJbnB1dERhdGVQaWNrZXJDaGFuZ2UuZW1pdCgpO1xuICAgICAgaWYgKGNoYW5nZUV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IG9sZFZhbHVlO1xuICAgICAgICB0aGlzLnNldElucHV0VmFsdWUob2xkVmFsdWUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5jb21tb25EYXRlU2VwYXJhdG9ycyA9IFtcIi5cIiwgXCItXCIsIFwiL1wiXTtcbiAgICB0aGlzLmZvcm1hdE51bWVyYWxzID0gKHZhbHVlKSA9PiB2YWx1ZVxuICAgICAgPyB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCJcIilcbiAgICAgICAgLm1hcCgoY2hhcikgPT4gdGhpcy5jb21tb25EYXRlU2VwYXJhdG9ycz8uaW5jbHVkZXMoY2hhcilcbiAgICAgICAgPyB0aGlzLmxvY2FsZURhdGE/LnNlcGFyYXRvclxuICAgICAgICA6IG51bWJlcktleXM/LmluY2x1ZGVzKGNoYXIpXG4gICAgICAgICAgPyBudW1iZXJTdHJpbmdGb3JtYXR0ZXI/Lm51bWJlckZvcm1hdHRlcj8uZm9ybWF0KE51bWJlcihjaGFyKSlcbiAgICAgICAgICA6IGNoYXIpXG4gICAgICAgIC5qb2luKFwiXCIpXG4gICAgICA6IFwiXCI7XG4gICAgdGhpcy5wYXJzZU51bWVyYWxzID0gKHZhbHVlKSA9PiB2YWx1ZVxuICAgICAgPyB2YWx1ZVxuICAgICAgICAuc3BsaXQoXCJcIilcbiAgICAgICAgLm1hcCgoY2hhcikgPT4gbnVtYmVyS2V5cy5pbmNsdWRlcyhjaGFyKSA/IG51bWJlclN0cmluZ0Zvcm1hdHRlci5kZWxvY2FsaXplKGNoYXIpIDogY2hhcilcbiAgICAgICAgLmpvaW4oXCJcIilcbiAgICAgIDogXCJcIjtcbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5mb2N1c1RyYXBEaXNhYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMuZm9ybSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgdGhpcy52YWx1ZSA9IFwiXCI7XG4gICAgdGhpcy5mbGlwUGxhY2VtZW50cyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmhlYWRpbmdMZXZlbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnZhbHVlQXNEYXRlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWVzc2FnZU92ZXJyaWRlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm1lc3NhZ2VzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWluQXNEYXRlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWF4QXNEYXRlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWluID0gdW5kZWZpbmVkO1xuICAgIHRoaXMubWF4ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMubmFtZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm51bWJlcmluZ1N5c3RlbSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNjYWxlID0gXCJtXCI7XG4gICAgdGhpcy5zdGF0dXMgPSBcImlkbGVcIjtcbiAgICB0aGlzLnBsYWNlbWVudCA9IGRlZmF1bHRNZW51UGxhY2VtZW50O1xuICAgIHRoaXMucmFuZ2UgPSBmYWxzZTtcbiAgICB0aGlzLnJlcXVpcmVkID0gZmFsc2U7XG4gICAgdGhpcy5vdmVybGF5UG9zaXRpb25pbmcgPSBcImFic29sdXRlXCI7XG4gICAgdGhpcy5wcm94aW1pdHlTZWxlY3Rpb25EaXNhYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMubGF5b3V0ID0gXCJob3Jpem9udGFsXCI7XG4gICAgdGhpcy5kYXRlUGlja2VyQWN0aXZlRGF0ZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRlZmF1bHRNZXNzYWdlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVmZmVjdGl2ZUxvY2FsZSA9IFwiXCI7XG4gICAgdGhpcy5mb2N1c2VkSW5wdXQgPSBcInN0YXJ0XCI7XG4gICAgdGhpcy5sb2NhbGVEYXRhID0gdW5kZWZpbmVkO1xuICB9XG4gIGhhbmRsZUZvY3VzVHJhcERpc2FibGVkKGZvY3VzVHJhcERpc2FibGVkKSB7XG4gICAgaWYgKCF0aGlzLm9wZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9jdXNUcmFwRGlzYWJsZWQgPyBkZWFjdGl2YXRlRm9jdXNUcmFwKHRoaXMpIDogYWN0aXZhdGVGb2N1c1RyYXAodGhpcyk7XG4gIH1cbiAgaGFuZGxlRGlzYWJsZWRBbmRSZWFkT25seUNoYW5nZSh2YWx1ZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICB2YWx1ZVdhdGNoZXIobmV3VmFsdWUpIHtcbiAgICBpZiAoIXRoaXMudXNlckNoYW5nZWRWYWx1ZSkge1xuICAgICAgbGV0IG5ld1ZhbHVlQXNEYXRlO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlQXNEYXRlID0gZ2V0VmFsdWVBc0RhdGVSYW5nZShuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICBuZXdWYWx1ZUFzRGF0ZSA9IGRhdGVGcm9tSVNPKG5ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBuZXdWYWx1ZUFzRGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy52YWx1ZUFzRGF0ZUNoYW5nZWRFeHRlcm5hbGx5ICYmIG5ld1ZhbHVlQXNEYXRlICE9PSB0aGlzLnZhbHVlQXNEYXRlKSB7XG4gICAgICAgIHRoaXMudmFsdWVBc0RhdGUgPSBuZXdWYWx1ZUFzRGF0ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMubG9jYWxpemVJbnB1dFZhbHVlcygpO1xuICAgIH1cbiAgICB0aGlzLnVzZXJDaGFuZ2VkVmFsdWUgPSBmYWxzZTtcbiAgfVxuICB2YWx1ZUFzRGF0ZVdhdGNoZXIodmFsdWVBc0RhdGUpIHtcbiAgICB0aGlzLmRhdGVQaWNrZXJBY3RpdmVEYXRlID0gdmFsdWVBc0RhdGU7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0aGlzLnJhbmdlICYmIEFycmF5LmlzQXJyYXkodmFsdWVBc0RhdGUpXG4gICAgICA/IFtkYXRlVG9JU08odmFsdWVBc0RhdGVbMF0pLCBkYXRlVG9JU08odmFsdWVBc0RhdGVbMV0pXVxuICAgICAgOiBkYXRlVG9JU08odmFsdWVBc0RhdGUpO1xuICAgIGlmICh0aGlzLnZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgdGhpcy52YWx1ZUFzRGF0ZUNoYW5nZWRFeHRlcm5hbGx5ID0gdHJ1ZTtcbiAgICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgIHRoaXMudmFsdWVBc0RhdGVDaGFuZ2VkRXh0ZXJuYWxseSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICBmbGlwUGxhY2VtZW50c0hhbmRsZXIoKSB7XG4gICAgdGhpcy5zZXRGaWx0ZXJlZFBsYWNlbWVudHMoKTtcbiAgICB0aGlzLnJlcG9zaXRpb24odHJ1ZSk7XG4gIH1cbiAgb25NZXNzYWdlc0NoYW5nZSgpIHtcbiAgICAvKiB3aXJlZCB1cCBieSB0OW4gdXRpbCAqL1xuICB9XG4gIG9uTWluQ2hhbmdlZChtaW4pIHtcbiAgICBpZiAobWluKSB7XG4gICAgICB0aGlzLm1pbkFzRGF0ZSA9IGRhdGVGcm9tSVNPKG1pbik7XG4gICAgfVxuICB9XG4gIG9uTWF4Q2hhbmdlZChtYXgpIHtcbiAgICBpZiAobWF4KSB7XG4gICAgICB0aGlzLm1heEFzRGF0ZSA9IGRhdGVGcm9tSVNPKG1heCk7XG4gICAgfVxuICB9XG4gIG9wZW5IYW5kbGVyKCkge1xuICAgIG9uVG9nZ2xlT3BlbkNsb3NlQ29tcG9uZW50KHRoaXMpO1xuICAgIGlmICh0aGlzLmRpc2FibGVkIHx8IHRoaXMucmVhZE9ubHkpIHtcbiAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBvdmVybGF5UG9zaXRpb25pbmdIYW5kbGVyKCkge1xuICAgIHRoaXMucmVwb3NpdGlvbih0cnVlKTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIC8vICBFdmVudCBMaXN0ZW5lcnNcbiAgLy9cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjYWxjaXRlRGF5U2VsZWN0SGFuZGxlcigpIHtcbiAgICBpZiAodGhpcy5zaG91bGRGb2N1c1JhbmdlU3RhcnQoKSB8fCB0aGlzLnNob3VsZEZvY3VzUmFuZ2VFbmQoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgUHVibGljIE1ldGhvZHNcbiAgLy9cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqIFNldHMgZm9jdXMgb24gdGhlIGNvbXBvbmVudC4gKi9cbiAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgYXdhaXQgY29tcG9uZW50Rm9jdXNhYmxlKHRoaXMpO1xuICAgIHRoaXMuZWwuZm9jdXMoKTtcbiAgfVxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGRlbGF5ZWRcbiAgICovXG4gIGFzeW5jIHJlcG9zaXRpb24oZGVsYXllZCA9IGZhbHNlKSB7XG4gICAgY29uc3QgeyBmbG9hdGluZ0VsLCByZWZlcmVuY2VFbCwgcGxhY2VtZW50LCBvdmVybGF5UG9zaXRpb25pbmcsIGZpbHRlcmVkRmxpcFBsYWNlbWVudHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIHJlcG9zaXRpb24odGhpcywge1xuICAgICAgZmxvYXRpbmdFbCxcbiAgICAgIHJlZmVyZW5jZUVsLFxuICAgICAgb3ZlcmxheVBvc2l0aW9uaW5nLFxuICAgICAgcGxhY2VtZW50LFxuICAgICAgZmxpcFBsYWNlbWVudHM6IGZpbHRlcmVkRmxpcFBsYWNlbWVudHMsXG4gICAgICB0eXBlOiBcIm1lbnVcIixcbiAgICB9LCBkZWxheWVkKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvLyAgTGlmZWN5Y2xlXG4gIC8vXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIGNvbm5lY3RJbnRlcmFjdGl2ZSh0aGlzKTtcbiAgICBjb25uZWN0TG9jYWxpemVkKHRoaXMpO1xuICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcztcbiAgICBvcGVuICYmIHRoaXMub3BlbkhhbmRsZXIoKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkge1xuICAgICAgdGhpcy52YWx1ZUFzRGF0ZSA9IGdldFZhbHVlQXNEYXRlUmFuZ2UodGhpcy52YWx1ZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMudmFsdWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMudmFsdWVBc0RhdGUgPSBkYXRlRnJvbUlTTyh0aGlzLnZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLndhcm5BYm91dEludmFsaWRWYWx1ZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IFwiXCI7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMucmFuZ2UgJiYgdGhpcy52YWx1ZUFzRGF0ZSkge1xuICAgICAgdGhpcy5zZXRSYW5nZVZhbHVlKHRoaXMudmFsdWVBc0RhdGUpO1xuICAgIH1cbiAgICBpZiAodGhpcy5taW4pIHtcbiAgICAgIHRoaXMubWluQXNEYXRlID0gZGF0ZUZyb21JU08odGhpcy5taW4pO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXgpIHtcbiAgICAgIHRoaXMubWF4QXNEYXRlID0gZGF0ZUZyb21JU08odGhpcy5tYXgpO1xuICAgIH1cbiAgICBjb25uZWN0TGFiZWwodGhpcyk7XG4gICAgY29ubmVjdEZvcm0odGhpcyk7XG4gICAgY29ubmVjdE1lc3NhZ2VzKHRoaXMpO1xuICAgIHRoaXMuc2V0RmlsdGVyZWRQbGFjZW1lbnRzKCk7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICAgIG51bWJlclN0cmluZ0Zvcm1hdHRlci5udW1iZXJGb3JtYXRPcHRpb25zID0ge1xuICAgICAgbnVtYmVyaW5nU3lzdGVtOiB0aGlzLm51bWJlcmluZ1N5c3RlbSxcbiAgICAgIGxvY2FsZTogdGhpcy5lZmZlY3RpdmVMb2NhbGUsXG4gICAgICB1c2VHcm91cGluZzogZmFsc2UsXG4gICAgfTtcbiAgICBpZiAodGhpcy5vcGVuKSB7XG4gICAgICBvblRvZ2dsZU9wZW5DbG9zZUNvbXBvbmVudCh0aGlzKTtcbiAgICB9XG4gICAgY29ubmVjdEZsb2F0aW5nVUkodGhpcywgdGhpcy5yZWZlcmVuY2VFbCwgdGhpcy5mbG9hdGluZ0VsKTtcbiAgfVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBzZXRVcExvYWRhYmxlQ29tcG9uZW50KHRoaXMpO1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmxvYWRMb2NhbGVEYXRhKCksIHNldFVwTWVzc2FnZXModGhpcyldKTtcbiAgICB0aGlzLm9uTWluQ2hhbmdlZCh0aGlzLm1pbik7XG4gICAgdGhpcy5vbk1heENoYW5nZWQodGhpcy5tYXgpO1xuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgc2V0Q29tcG9uZW50TG9hZGVkKHRoaXMpO1xuICAgIHRoaXMubG9jYWxpemVJbnB1dFZhbHVlcygpO1xuICAgIHRoaXMucmVwb3NpdGlvbih0cnVlKTtcbiAgfVxuICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBkZWFjdGl2YXRlRm9jdXNUcmFwKHRoaXMpO1xuICAgIGRpc2Nvbm5lY3RJbnRlcmFjdGl2ZSh0aGlzKTtcbiAgICBkaXNjb25uZWN0TGFiZWwodGhpcyk7XG4gICAgZGlzY29ubmVjdEZvcm0odGhpcyk7XG4gICAgZGlzY29ubmVjdEZsb2F0aW5nVUkodGhpcywgdGhpcy5yZWZlcmVuY2VFbCwgdGhpcy5mbG9hdGluZ0VsKTtcbiAgICBkaXNjb25uZWN0TG9jYWxpemVkKHRoaXMpO1xuICAgIGRpc2Nvbm5lY3RNZXNzYWdlcyh0aGlzKTtcbiAgfVxuICBjb21wb25lbnREaWRSZW5kZXIoKSB7XG4gICAgdXBkYXRlSG9zdEludGVyYWN0aW9uKHRoaXMpO1xuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGRpc2FibGVkLCBlZmZlY3RpdmVMb2NhbGUsIG1lc3NhZ2VzLCBudW1iZXJpbmdTeXN0ZW0sIHJlYWRPbmx5IH0gPSB0aGlzO1xuICAgIG51bWJlclN0cmluZ0Zvcm1hdHRlci5udW1iZXJGb3JtYXRPcHRpb25zID0ge1xuICAgICAgbnVtYmVyaW5nU3lzdGVtLFxuICAgICAgbG9jYWxlOiBlZmZlY3RpdmVMb2NhbGUsXG4gICAgICB1c2VHcm91cGluZzogZmFsc2UsXG4gICAgfTtcbiAgICByZXR1cm4gKGgoSG9zdCwgeyBvbkJsdXI6IHRoaXMuZGVhY3RpdmF0ZSwgb25LZXlEb3duOiB0aGlzLmtleURvd25IYW5kbGVyIH0sIHRoaXMubG9jYWxlRGF0YSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImlucHV0LWNvbnRhaW5lclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbnB1dC13cmFwcGVyXCIsIG9uQ2xpY2s6IHRoaXMub25JbnB1dFdyYXBwZXJDbGljayxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gtc29ydC1wcm9wcyAtLSByZWYgc2hvdWxkIGJlIGxhc3Qgc28gbm9kZSBhdHRycy9wcm9wcyBhcmUgaW4gc3luYyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9wdWxsLzY1MzApXG4gICAgICByZWY6IHRoaXMuc2V0U3RhcnRXcmFwcGVyIH0sIGgoXCJjYWxjaXRlLWlucHV0LXRleHRcIiwgeyBcImFyaWEtYXV0b2NvbXBsZXRlXCI6IFwibm9uZVwiLCBcImFyaWEtY29udHJvbHNcIjogdGhpcy5kaWFsb2dJZCwgXCJhcmlhLWRlc2NyaWJlZGJ5XCI6IHRoaXMucGxhY2Vob2xkZXJUZXh0SWQsIFwiYXJpYS1leHBhbmRlZFwiOiB0b0FyaWFCb29sZWFuKHRoaXMub3BlbiksIFwiYXJpYS1oYXNwb3B1cFwiOiBcImRpYWxvZ1wiLCBjbGFzczogYGlucHV0ICR7dGhpcy5sYXlvdXQgPT09IFwidmVydGljYWxcIiAmJiB0aGlzLnJhbmdlID8gYG5vLWJvdHRvbS1ib3JkZXJgIDogYGB9YCwgZGlzYWJsZWQ6IGRpc2FibGVkLCBpY29uOiBcImNhbGVuZGFyXCIsIG9uQ2FsY2l0ZUlucHV0VGV4dElucHV0OiB0aGlzLmNhbGNpdGVJbnRlcm5hbElucHV0SW5wdXRIYW5kbGVyLCBvbkNhbGNpdGVJbnRlcm5hbElucHV0VGV4dEJsdXI6IHRoaXMuY2FsY2l0ZUludGVybmFsSW5wdXRCbHVySGFuZGxlciwgb25DYWxjaXRlSW50ZXJuYWxJbnB1dFRleHRGb2N1czogdGhpcy5zdGFydElucHV0Rm9jdXMsIG9uRm9jdXM6IHRoaXMuc3RhcnRFbmRJbnB1dEZvY3VzLCBwbGFjZWhvbGRlcjogdGhpcy5sb2NhbGVEYXRhPy5wbGFjZWhvbGRlciwgcmVhZE9ubHk6IHJlYWRPbmx5LCByb2xlOiBcImNvbWJvYm94XCIsIHNjYWxlOiB0aGlzLnNjYWxlLCBzdGF0dXM6IHRoaXMuc3RhdHVzLFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2pzeC1zb3J0LXByb3BzIC0tIHJlZiBzaG91bGQgYmUgbGFzdCBzbyBub2RlIGF0dHJzL3Byb3BzIGFyZSBpbiBzeW5jIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL3B1bGwvNjUzMClcbiAgICAgIHJlZjogdGhpcy5zZXRTdGFydElucHV0IH0pLCAhdGhpcy5yZWFkT25seSAmJiB0aGlzLnJlbmRlclRvZ2dsZUljb24odGhpcy5vcGVuICYmIHRoaXMuZm9jdXNlZElucHV0ID09PSBcInN0YXJ0XCIpLCBoKFwic3BhblwiLCB7IFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIGNsYXNzOiBDU1MuYXNzaXN0aXZlVGV4dCwgaWQ6IHRoaXMucGxhY2Vob2xkZXJUZXh0SWQgfSwgXCJEYXRlIEZvcm1hdDogXCIsIHRoaXMubG9jYWxlRGF0YT8ucGxhY2Vob2xkZXIpKSwgaChcImRpdlwiLCB7IFwiYXJpYS1oaWRkZW5cIjogdG9BcmlhQm9vbGVhbighdGhpcy5vcGVuKSwgXCJhcmlhLWxhYmVsXCI6IG1lc3NhZ2VzLmNob29zZURhdGUsIFwiYXJpYS1saXZlXCI6IFwicG9saXRlXCIsIFwiYXJpYS1tb2RhbFwiOiBcInRydWVcIiwgY2xhc3M6IHtcbiAgICAgICAgW0NTUy5tZW51XTogdHJ1ZSxcbiAgICAgICAgW0NTUy5tZW51QWN0aXZlXTogdGhpcy5vcGVuLFxuICAgICAgfSwgaWQ6IHRoaXMuZGlhbG9nSWQsIHJvbGU6IFwiZGlhbG9nXCIsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiB0aGlzLnNldEZsb2F0aW5nRWwgfSwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgIFtcImNhbGVuZGFyLXBpY2tlci13cmFwcGVyXCJdOiB0cnVlLFxuICAgICAgICBbXCJjYWxlbmRhci1waWNrZXItd3JhcHBlci0tZW5kXCJdOiB0aGlzLmZvY3VzZWRJbnB1dCA9PT0gXCJlbmRcIixcbiAgICAgICAgW0Zsb2F0aW5nQ1NTLmFuaW1hdGlvbl06IHRydWUsXG4gICAgICAgIFtGbG9hdGluZ0NTUy5hbmltYXRpb25BY3RpdmVdOiB0aGlzLm9wZW4sXG4gICAgICB9LFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2pzeC1zb3J0LXByb3BzIC0tIHJlZiBzaG91bGQgYmUgbGFzdCBzbyBub2RlIGF0dHJzL3Byb3BzIGFyZSBpbiBzeW5jIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL3B1bGwvNjUzMClcbiAgICAgIHJlZjogdGhpcy5zZXRUcmFuc2l0aW9uRWwgfSwgaChcImNhbGNpdGUtZGF0ZS1waWNrZXJcIiwgeyBhY3RpdmVEYXRlOiB0aGlzLmRhdGVQaWNrZXJBY3RpdmVEYXRlLCBhY3RpdmVSYW5nZTogdGhpcy5mb2N1c2VkSW5wdXQsIGhlYWRpbmdMZXZlbDogdGhpcy5oZWFkaW5nTGV2ZWwsIG1heDogdGhpcy5tYXgsIG1heEFzRGF0ZTogdGhpcy5tYXhBc0RhdGUsIG1lc3NhZ2VPdmVycmlkZXM6IHRoaXMubWVzc2FnZU92ZXJyaWRlcywgbWluOiB0aGlzLm1pbiwgbWluQXNEYXRlOiB0aGlzLm1pbkFzRGF0ZSwgbnVtYmVyaW5nU3lzdGVtOiBudW1iZXJpbmdTeXN0ZW0sIG9uQ2FsY2l0ZURhdGVQaWNrZXJDaGFuZ2U6IHRoaXMuaGFuZGxlRGF0ZUNoYW5nZSwgb25DYWxjaXRlRGF0ZVBpY2tlclJhbmdlQ2hhbmdlOiB0aGlzLmhhbmRsZURhdGVSYW5nZUNoYW5nZSwgcHJveGltaXR5U2VsZWN0aW9uRGlzYWJsZWQ6IHRoaXMucHJveGltaXR5U2VsZWN0aW9uRGlzYWJsZWQsIHJhbmdlOiB0aGlzLnJhbmdlLCBzY2FsZTogdGhpcy5zY2FsZSwgdGFiSW5kZXg6IHRoaXMub3BlbiA/IHVuZGVmaW5lZCA6IC0xLCB2YWx1ZUFzRGF0ZTogdGhpcy52YWx1ZUFzRGF0ZSxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gtc29ydC1wcm9wcyAtLSByZWYgc2hvdWxkIGJlIGxhc3Qgc28gbm9kZSBhdHRycy9wcm9wcyBhcmUgaW4gc3luYyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9wdWxsLzY1MzApXG4gICAgICByZWY6IHRoaXMuc2V0RGF0ZVBpY2tlclJlZiB9KSkpLCB0aGlzLnJhbmdlICYmIHRoaXMubGF5b3V0ID09PSBcImhvcml6b250YWxcIiAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImhvcml6b250YWwtYXJyb3ctY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGZsaXBSdGw6IHRydWUsIGljb246IFwiYXJyb3ctcmlnaHRcIiwgc2NhbGU6IGdldEljb25TY2FsZSh0aGlzLnNjYWxlKSB9KSkpLCB0aGlzLnJhbmdlICYmIHRoaXMubGF5b3V0ID09PSBcInZlcnRpY2FsXCIgJiYgdGhpcy5zY2FsZSAhPT0gXCJzXCIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJ2ZXJ0aWNhbC1hcnJvdy1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJhcnJvdy1kb3duXCIsIHNjYWxlOiBnZXRJY29uU2NhbGUodGhpcy5zY2FsZSkgfSkpKSwgdGhpcy5yYW5nZSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImlucHV0LXdyYXBwZXJcIiwgb25DbGljazogdGhpcy5vbklucHV0V3JhcHBlckNsaWNrLFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2pzeC1zb3J0LXByb3BzIC0tIHJlZiBzaG91bGQgYmUgbGFzdCBzbyBub2RlIGF0dHJzL3Byb3BzIGFyZSBpbiBzeW5jIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL3B1bGwvNjUzMClcbiAgICAgIHJlZjogdGhpcy5zZXRFbmRXcmFwcGVyIH0sIGgoXCJjYWxjaXRlLWlucHV0LXRleHRcIiwgeyBcImFyaWEtYXV0b2NvbXBsZXRlXCI6IFwibm9uZVwiLCBcImFyaWEtY29udHJvbHNcIjogdGhpcy5kaWFsb2dJZCwgXCJhcmlhLWV4cGFuZGVkXCI6IHRvQXJpYUJvb2xlYW4odGhpcy5vcGVuKSwgXCJhcmlhLWhhc3BvcHVwXCI6IFwiZGlhbG9nXCIsIGNsYXNzOiB7XG4gICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICBcImJvcmRlci10b3AtY29sb3Itb25lXCI6IHRoaXMubGF5b3V0ID09PSBcInZlcnRpY2FsXCIgJiYgdGhpcy5yYW5nZSxcbiAgICAgIH0sIGRpc2FibGVkOiBkaXNhYmxlZCwgaWNvbjogXCJjYWxlbmRhclwiLCBvbkNhbGNpdGVJbnB1dFRleHRJbnB1dDogdGhpcy5jYWxjaXRlSW50ZXJuYWxJbnB1dElucHV0SGFuZGxlciwgb25DYWxjaXRlSW50ZXJuYWxJbnB1dFRleHRCbHVyOiB0aGlzLmNhbGNpdGVJbnRlcm5hbElucHV0Qmx1ckhhbmRsZXIsIG9uQ2FsY2l0ZUludGVybmFsSW5wdXRUZXh0Rm9jdXM6IHRoaXMuZW5kSW5wdXRGb2N1cywgb25Gb2N1czogdGhpcy5zdGFydEVuZElucHV0Rm9jdXMsIHBsYWNlaG9sZGVyOiB0aGlzLmxvY2FsZURhdGE/LnBsYWNlaG9sZGVyLCByZWFkT25seTogcmVhZE9ubHksIHJvbGU6IFwiY29tYm9ib3hcIiwgc2NhbGU6IHRoaXMuc2NhbGUsIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvanN4LXNvcnQtcHJvcHMgLS0gcmVmIHNob3VsZCBiZSBsYXN0IHNvIG5vZGUgYXR0cnMvcHJvcHMgYXJlIGluIHN5bmMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vcHVsbC82NTMwKVxuICAgICAgcmVmOiB0aGlzLnNldEVuZElucHV0IH0pLCAhdGhpcy5yZWFkT25seSAmJiB0aGlzLnJlbmRlclRvZ2dsZUljb24odGhpcy5vcGVuICYmIHRoaXMuZm9jdXNlZElucHV0ID09PSBcImVuZFwiKSkpKSksIGgoSGlkZGVuRm9ybUlucHV0U2xvdCwgeyBjb21wb25lbnQ6IHRoaXMgfSkpKTtcbiAgfVxuICByZW5kZXJUb2dnbGVJY29uKG9wZW4pIHtcbiAgICByZXR1cm4gKGgoXCJzcGFuXCIsIHsgY2xhc3M6IENTUy50b2dnbGVJY29uIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBvcGVuID8gXCJjaGV2cm9uLXVwXCIgOiBcImNoZXZyb24tZG93blwiLCBzY2FsZTogZ2V0SWNvblNjYWxlKHRoaXMuc2NhbGUpIH0pKSk7XG4gIH1cbiAgc2V0UmVmZXJlbmNlRWwoKSB7XG4gICAgY29uc3QgeyBmb2N1c2VkSW5wdXQsIGxheW91dCwgZW5kV3JhcHBlciwgc3RhcnRXcmFwcGVyIH0gPSB0aGlzO1xuICAgIHRoaXMucmVmZXJlbmNlRWwgPVxuICAgICAgZm9jdXNlZElucHV0ID09PSBcImVuZFwiIHx8IGxheW91dCA9PT0gXCJ2ZXJ0aWNhbFwiXG4gICAgICAgID8gZW5kV3JhcHBlciB8fCBzdGFydFdyYXBwZXJcbiAgICAgICAgOiBzdGFydFdyYXBwZXIgfHwgZW5kV3JhcHBlcjtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gY29ubmVjdEZsb2F0aW5nVUkodGhpcywgdGhpcy5yZWZlcmVuY2VFbCwgdGhpcy5mbG9hdGluZ0VsKSk7XG4gIH1cbiAgb25MYWJlbENsaWNrKCkge1xuICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgfVxuICBvbkJlZm9yZU9wZW4oKSB7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICAgIHRoaXMuY2FsY2l0ZUlucHV0RGF0ZVBpY2tlckJlZm9yZU9wZW4uZW1pdCgpO1xuICB9XG4gIG9uT3BlbigpIHtcbiAgICBhY3RpdmF0ZUZvY3VzVHJhcCh0aGlzLCB7XG4gICAgICBvbkFjdGl2YXRlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmZvY3VzT25PcGVuKSB7XG4gICAgICAgICAgdGhpcy5kYXRlUGlja2VyRWwuc2V0Rm9jdXMoKTtcbiAgICAgICAgICB0aGlzLmZvY3VzT25PcGVuID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5jYWxjaXRlSW5wdXREYXRlUGlja2VyT3Blbi5lbWl0KCk7XG4gIH1cbiAgb25CZWZvcmVDbG9zZSgpIHtcbiAgICB0aGlzLmNhbGNpdGVJbnB1dERhdGVQaWNrZXJCZWZvcmVDbG9zZS5lbWl0KCk7XG4gIH1cbiAgb25DbG9zZSgpIHtcbiAgICB0aGlzLmNhbGNpdGVJbnB1dERhdGVQaWNrZXJDbG9zZS5lbWl0KCk7XG4gICAgZGVhY3RpdmF0ZUZvY3VzVHJhcCh0aGlzKTtcbiAgICB0aGlzLnJlc3RvcmVJbnB1dEZvY3VzKCk7XG4gICAgdGhpcy5mb2N1c09uT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuZGF0ZVBpY2tlckVsLnJlc2V0KCk7XG4gICAgdGhpcy5yZXBvc2l0aW9uKHRydWUpO1xuICB9XG4gIGNvbW1pdFZhbHVlKCkge1xuICAgIGNvbnN0IHsgZm9jdXNlZElucHV0LCB2YWx1ZSB9ID0gdGhpcztcbiAgICBjb25zdCBmb2N1c2VkSW5wdXROYW1lID0gYCR7Zm9jdXNlZElucHV0fUlucHV0YDtcbiAgICBjb25zdCBmb2N1c2VkSW5wdXRWYWx1ZSA9IHRoaXNbZm9jdXNlZElucHV0TmFtZV0udmFsdWU7XG4gICAgY29uc3QgZGF0ZSA9IGRhdGVGcm9tTG9jYWxpemVkU3RyaW5nKGZvY3VzZWRJbnB1dFZhbHVlLCB0aGlzLmxvY2FsZURhdGEpO1xuICAgIGNvbnN0IGRhdGVBc0lTTyA9IGRhdGVUb0lTTyhkYXRlKTtcbiAgICBjb25zdCB2YWx1ZUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHZhbHVlKTtcbiAgICBpZiAodGhpcy5yYW5nZSkge1xuICAgICAgY29uc3QgZm9jdXNlZElucHV0VmFsdWVJbmRleCA9IGZvY3VzZWRJbnB1dCA9PT0gXCJzdGFydFwiID8gMCA6IDE7XG4gICAgICBpZiAodmFsdWVJc0FycmF5KSB7XG4gICAgICAgIGlmIChkYXRlQXNJU08gPT09IHZhbHVlW2ZvY3VzZWRJbnB1dFZhbHVlSW5kZXhdKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRlKSB7XG4gICAgICAgICAgdGhpcy5zZXRSYW5nZVZhbHVlKFtcbiAgICAgICAgICAgIGZvY3VzZWRJbnB1dCA9PT0gXCJzdGFydFwiID8gZGF0ZSA6IGRhdGVGcm9tSVNPKHZhbHVlWzBdKSxcbiAgICAgICAgICAgIGZvY3VzZWRJbnB1dCA9PT0gXCJlbmRcIiA/IGRhdGUgOiBkYXRlRnJvbUlTTyh2YWx1ZVsxXSksXG4gICAgICAgICAgXSk7XG4gICAgICAgICAgdGhpcy5sb2NhbGl6ZUlucHV0VmFsdWVzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZXRSYW5nZVZhbHVlKFtcbiAgICAgICAgICAgIGZvY3VzZWRJbnB1dCA9PT0gXCJlbmRcIiAmJiBkYXRlRnJvbUlTTyh2YWx1ZVswXSksXG4gICAgICAgICAgICBmb2N1c2VkSW5wdXQgPT09IFwic3RhcnRcIiAmJiBkYXRlRnJvbUlTTyh2YWx1ZVsxXSksXG4gICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgIHRoaXMuc2V0UmFuZ2VWYWx1ZShbXG4gICAgICAgICAgICBmb2N1c2VkSW5wdXQgPT09IFwic3RhcnRcIiA/IGRhdGUgOiBkYXRlRnJvbUlTTyh2YWx1ZVswXSksXG4gICAgICAgICAgICBmb2N1c2VkSW5wdXQgPT09IFwiZW5kXCIgPyBkYXRlIDogZGF0ZUZyb21JU08odmFsdWVbMV0pLFxuICAgICAgICAgIF0pO1xuICAgICAgICAgIHRoaXMubG9jYWxpemVJbnB1dFZhbHVlcygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGRhdGVBc0lTTyA9PT0gdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRWYWx1ZShkYXRlKTtcbiAgICAgIHRoaXMubG9jYWxpemVJbnB1dFZhbHVlcygpO1xuICAgIH1cbiAgfVxuICBhc3luYyBsb2FkTG9jYWxlRGF0YSgpIHtcbiAgICBudW1iZXJTdHJpbmdGb3JtYXR0ZXIubnVtYmVyRm9ybWF0T3B0aW9ucyA9IHtcbiAgICAgIG51bWJlcmluZ1N5c3RlbTogdGhpcy5udW1iZXJpbmdTeXN0ZW0sXG4gICAgICBsb2NhbGU6IHRoaXMuZWZmZWN0aXZlTG9jYWxlLFxuICAgICAgdXNlR3JvdXBpbmc6IGZhbHNlLFxuICAgIH07XG4gICAgdGhpcy5sb2NhbGVEYXRhID0gYXdhaXQgZ2V0TG9jYWxlRGF0YSh0aGlzLmVmZmVjdGl2ZUxvY2FsZSk7XG4gICAgdGhpcy5sb2NhbGl6ZUlucHV0VmFsdWVzKCk7XG4gIH1cbiAgc2hvdWxkRm9jdXNSYW5nZVN0YXJ0KCkge1xuICAgIGNvbnN0IHN0YXJ0VmFsdWUgPSB0aGlzLnZhbHVlWzBdO1xuICAgIGNvbnN0IGVuZFZhbHVlID0gdGhpcy52YWx1ZVsxXTtcbiAgICByZXR1cm4gISEoZW5kVmFsdWUgJiYgIXN0YXJ0VmFsdWUgJiYgdGhpcy5mb2N1c2VkSW5wdXQgPT09IFwiZW5kXCIgJiYgdGhpcy5zdGFydElucHV0KTtcbiAgfVxuICBzaG91bGRGb2N1c1JhbmdlRW5kKCkge1xuICAgIGNvbnN0IHN0YXJ0VmFsdWUgPSB0aGlzLnZhbHVlWzBdO1xuICAgIGNvbnN0IGVuZFZhbHVlID0gdGhpcy52YWx1ZVsxXTtcbiAgICByZXR1cm4gISEoc3RhcnRWYWx1ZSAmJiAhZW5kVmFsdWUgJiYgdGhpcy5mb2N1c2VkSW5wdXQgPT09IFwic3RhcnRcIiAmJiB0aGlzLmVuZElucHV0KTtcbiAgfVxuICByZXN0b3JlSW5wdXRGb2N1cygpIHtcbiAgICBpZiAoIXRoaXMucmFuZ2UpIHtcbiAgICAgIHRoaXMuc3RhcnRJbnB1dC5zZXRGb2N1cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBmb2N1c2VkSW5wdXQgPSB0aGlzLmZvY3VzZWRJbnB1dCA9PT0gXCJzdGFydFwiID8gdGhpcy5zdGFydElucHV0IDogdGhpcy5lbmRJbnB1dDtcbiAgICBmb2N1c2VkSW5wdXQuc2V0Rm9jdXMoKTtcbiAgfVxuICBsb2NhbGl6ZUlucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGRhdGUgPSBkYXRlRnJvbVJhbmdlKCh0aGlzLnJhbmdlXG4gICAgICA/IChBcnJheS5pc0FycmF5KHRoaXMudmFsdWVBc0RhdGUpICYmIHRoaXMudmFsdWVBc0RhdGVbMF0pIHx8IHVuZGVmaW5lZFxuICAgICAgOiB0aGlzLnZhbHVlQXNEYXRlKSwgdGhpcy5taW5Bc0RhdGUsIHRoaXMubWF4QXNEYXRlKTtcbiAgICBjb25zdCBlbmREYXRlID0gdGhpcy5yYW5nZVxuICAgICAgPyBkYXRlRnJvbVJhbmdlKChBcnJheS5pc0FycmF5KHRoaXMudmFsdWVBc0RhdGUpICYmIHRoaXMudmFsdWVBc0RhdGVbMV0pIHx8IHVuZGVmaW5lZCwgdGhpcy5taW5Bc0RhdGUsIHRoaXMubWF4QXNEYXRlKVxuICAgICAgOiBudWxsO1xuICAgIGNvbnN0IGZvcm1hdHRpbmdPcHRpb25zID0ge1xuICAgICAgLy8gd2UgZXhwbGljaXRseSBzZXQgbnVtYmVyaW5nU3lzdGVtIHRvIHByZXZlbnQgdGhlIGJyb3dzZXItaW5mZXJyZWQgdmFsdWVcbiAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vaXNzdWVzLzMwNzkjaXNzdWVjb21tZW50LTExNjg5NjQxOTUgZm9yIG1vcmUgaW5mb1xuICAgICAgbnVtYmVyaW5nU3lzdGVtOiBkZWZhdWx0TnVtYmVyaW5nU3lzdGVtLFxuICAgIH07XG4gICAgY29uc3QgbG9jYWxpemVkRGF0ZSA9IGRhdGUgJiYgdGhpcy5mb3JtYXROdW1lcmFscyhkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZyh0aGlzLmVmZmVjdGl2ZUxvY2FsZSwgZm9ybWF0dGluZ09wdGlvbnMpKTtcbiAgICBjb25zdCBsb2NhbGl6ZWRFbmREYXRlID0gZW5kRGF0ZSAmJlxuICAgICAgdGhpcy5mb3JtYXROdW1lcmFscyhlbmREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZyh0aGlzLmVmZmVjdGl2ZUxvY2FsZSwgZm9ybWF0dGluZ09wdGlvbnMpKTtcbiAgICB0aGlzLnNldElucHV0VmFsdWUobG9jYWxpemVkRGF0ZSA/PyBcIlwiLCBcInN0YXJ0XCIpO1xuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSgodGhpcy5yYW5nZSAmJiBsb2NhbGl6ZWRFbmREYXRlKSA/PyBcIlwiLCBcImVuZFwiKTtcbiAgfVxuICB3YXJuQWJvdXRJbnZhbGlkVmFsdWUodmFsdWUpIHtcbiAgICBjb25zb2xlLndhcm4oYFRoZSBzcGVjaWZpZWQgdmFsdWUgXCIke3ZhbHVlfVwiIGRvZXMgbm90IGNvbmZvcm0gdG8gdGhlIHJlcXVpcmVkIGZvcm1hdCwgXCJZWVlZLU1NLUREXCIuYCk7XG4gIH1cbiAgZ2V0Tm9ybWFsaXplZERhdGUodmFsdWUpIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKCFpc1R3b0RpZ2l0WWVhcih2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgY29uc3QgeyBkYXksIG1vbnRoLCB5ZWFyIH0gPSBkYXRlUGFydHNGcm9tSVNPKHZhbHVlKTtcbiAgICBjb25zdCBub3JtYWxpemVkWWVhciA9IG5vcm1hbGl6ZVRvQ3VycmVudENlbnR1cnkoTnVtYmVyKHllYXIpKTtcbiAgICByZXR1cm4gYCR7bm9ybWFsaXplZFllYXJ9LSR7bW9udGh9LSR7ZGF5fWA7XG4gIH1cbiAgc3RhdGljIGdldCBkZWxlZ2F0ZXNGb2N1cygpIHsgcmV0dXJuIHRydWU7IH1cbiAgc3RhdGljIGdldCBhc3NldHNEaXJzKCkgeyByZXR1cm4gW1wiYXNzZXRzXCJdOyB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImZvY3VzVHJhcERpc2FibGVkXCI6IFtcImhhbmRsZUZvY3VzVHJhcERpc2FibGVkXCJdLFxuICAgIFwiZGlzYWJsZWRcIjogW1wiaGFuZGxlRGlzYWJsZWRBbmRSZWFkT25seUNoYW5nZVwiXSxcbiAgICBcInJlYWRPbmx5XCI6IFtcImhhbmRsZURpc2FibGVkQW5kUmVhZE9ubHlDaGFuZ2VcIl0sXG4gICAgXCJ2YWx1ZVwiOiBbXCJ2YWx1ZVdhdGNoZXJcIl0sXG4gICAgXCJ2YWx1ZUFzRGF0ZVwiOiBbXCJ2YWx1ZUFzRGF0ZVdhdGNoZXJcIl0sXG4gICAgXCJmbGlwUGxhY2VtZW50c1wiOiBbXCJmbGlwUGxhY2VtZW50c0hhbmRsZXJcIl0sXG4gICAgXCJtZXNzYWdlT3ZlcnJpZGVzXCI6IFtcIm9uTWVzc2FnZXNDaGFuZ2VcIl0sXG4gICAgXCJtaW5cIjogW1wib25NaW5DaGFuZ2VkXCJdLFxuICAgIFwibWF4XCI6IFtcIm9uTWF4Q2hhbmdlZFwiXSxcbiAgICBcIm9wZW5cIjogW1wib3BlbkhhbmRsZXJcIl0sXG4gICAgXCJvdmVybGF5UG9zaXRpb25pbmdcIjogW1wib3ZlcmxheVBvc2l0aW9uaW5nSGFuZGxlclwiXSxcbiAgICBcImxheW91dFwiOiBbXCJzZXRSZWZlcmVuY2VFbFwiXSxcbiAgICBcImZvY3VzZWRJbnB1dFwiOiBbXCJzZXRSZWZlcmVuY2VFbFwiXSxcbiAgICBcImVmZmVjdGl2ZUxvY2FsZVwiOiBbXCJsb2FkTG9jYWxlRGF0YVwiXVxuICB9OyB9XG59O1xuSW5wdXREYXRlUGlja2VyLnN0eWxlID0gaW5wdXREYXRlUGlja2VyQ3NzO1xuXG5leHBvcnQgeyBJbnB1dERhdGVQaWNrZXIgYXMgY2FsY2l0ZV9pbnB1dF9kYXRlX3BpY2tlciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYWxjaXRlLWlucHV0LWRhdGUtcGlja2VyLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vYmxvYi9tYWluL0xJQ0VOU0UubWQgZm9yIGRldGFpbHMuXG4gKiB2Mi4wLjBcbiAqL1xuaW1wb3J0IHsgayBhcyBpc0JlZm9yZSwgcSBhcyBxdWVyeUVsZW1lbnRSb290cywgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS1lZDAwYTU4NS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbXBvbmVudE9uUmVhZHkgfSBmcm9tICcuL2NvbXBvbmVudC1mOTRjYWI3Mi5qcyc7XG5cbi8qKlxuICogRXhwb3J0ZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seVxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCBsYWJlbENsaWNrRXZlbnQgPSBcImNhbGNpdGVJbnRlcm5hbExhYmVsQ2xpY2tcIjtcbmNvbnN0IGxhYmVsQ29ubmVjdGVkRXZlbnQgPSBcImNhbGNpdGVJbnRlcm5hbExhYmVsQ29ubmVjdGVkXCI7XG5jb25zdCBsYWJlbERpc2Nvbm5lY3RlZEV2ZW50ID0gXCJjYWxjaXRlSW50ZXJuYWxMYWJlbERpc2Nvbm5lY3RlZFwiO1xuY29uc3QgbGFiZWxUYWdOYW1lID0gXCJjYWxjaXRlLWxhYmVsXCI7XG5jb25zdCBsYWJlbFRvTGFiZWxhYmxlcyA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCBvbkxhYmVsQ2xpY2tNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3Qgb25MYWJlbENvbm5lY3RlZE1hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCBvbkxhYmVsRGlzY29ubmVjdGVkTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHVubGFiZWxlZENvbXBvbmVudHMgPSBuZXcgU2V0KCk7XG5jb25zdCBmaW5kTGFiZWxGb3JDb21wb25lbnQgPSAoY29tcG9uZW50RWwpID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gY29tcG9uZW50RWw7XG4gIGNvbnN0IGZvckxhYmVsID0gaWQgJiYgcXVlcnlFbGVtZW50Um9vdHMoY29tcG9uZW50RWwsIHsgc2VsZWN0b3I6IGAke2xhYmVsVGFnTmFtZX1bZm9yPVwiJHtpZH1cIl1gIH0pO1xuICBpZiAoZm9yTGFiZWwpIHtcbiAgICByZXR1cm4gZm9yTGFiZWw7XG4gIH1cbiAgY29uc3QgcGFyZW50TGFiZWwgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoY29tcG9uZW50RWwsIGxhYmVsVGFnTmFtZSk7XG4gIGlmICghcGFyZW50TGFiZWwgfHxcbiAgICAvLyBsYWJlbGFibGUgY29tcG9uZW50cyB3aXRoaW4gb3RoZXIgY3VzdG9tIGVsZW1lbnRzIGFyZSBub3QgY29uc2lkZXJlZCBsYWJlbGFibGVcbiAgICBoYXNBbmNlc3RvckN1c3RvbUVsZW1lbnRzKHBhcmVudExhYmVsLCBjb21wb25lbnRFbCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gcGFyZW50TGFiZWw7XG59O1xuZnVuY3Rpb24gaGFzQW5jZXN0b3JDdXN0b21FbGVtZW50cyhsYWJlbCwgY29tcG9uZW50RWwpIHtcbiAgbGV0IHRyYXZlcnNlZEVsZW1lbnRzO1xuICBjb25zdCBjdXN0b21FbGVtZW50QW5jZXN0b3JDaGVja0V2ZW50VHlwZSA9IFwiY3VzdG9tLWVsZW1lbnQtYW5jZXN0b3ItY2hlY2tcIjtcbiAgY29uc3QgbGlzdGVuZXIgPSAoZXZlbnQpID0+IHtcbiAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICBjb25zdCBjb21wb3NlZFBhdGggPSBldmVudC5jb21wb3NlZFBhdGgoKTtcbiAgICB0cmF2ZXJzZWRFbGVtZW50cyA9IGNvbXBvc2VkUGF0aC5zbGljZShjb21wb3NlZFBhdGguaW5kZXhPZihjb21wb25lbnRFbCksIGNvbXBvc2VkUGF0aC5pbmRleE9mKGxhYmVsKSk7XG4gIH07XG4gIGxhYmVsLmFkZEV2ZW50TGlzdGVuZXIoY3VzdG9tRWxlbWVudEFuY2VzdG9yQ2hlY2tFdmVudFR5cGUsIGxpc3RlbmVyLCB7IG9uY2U6IHRydWUgfSk7XG4gIGNvbXBvbmVudEVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KGN1c3RvbUVsZW1lbnRBbmNlc3RvckNoZWNrRXZlbnRUeXBlLCB7IGNvbXBvc2VkOiB0cnVlLCBidWJibGVzOiB0cnVlIH0pKTtcbiAgbGFiZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihjdXN0b21FbGVtZW50QW5jZXN0b3JDaGVja0V2ZW50VHlwZSwgbGlzdGVuZXIpO1xuICBjb25zdCBhbmNlc3RvckN1c3RvbUVsZW1lbnRzID0gdHJhdmVyc2VkRWxlbWVudHNcbiAgICAuZmlsdGVyKChlbCkgPT4gZWwgIT09IGNvbXBvbmVudEVsICYmIGVsICE9PSBsYWJlbClcbiAgICAuZmlsdGVyKChlbCkgPT4gZWwudGFnTmFtZT8uaW5jbHVkZXMoXCItXCIpKTtcbiAgcmV0dXJuIGFuY2VzdG9yQ3VzdG9tRWxlbWVudHMubGVuZ3RoID4gMDtcbn1cbi8qKlxuICogSGVscGVyIHRvIHNldCB1cCBsYWJlbCBpbnRlcmFjdGlvbnMgb24gY29ubmVjdGVkQ2FsbGJhY2suXG4gKlxuICogQHBhcmFtIGNvbXBvbmVudFxuICovXG5mdW5jdGlvbiBjb25uZWN0TGFiZWwoY29tcG9uZW50KSB7XG4gIGlmICghY29tcG9uZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGxhYmVsRWwgPSBmaW5kTGFiZWxGb3JDb21wb25lbnQoY29tcG9uZW50LmVsKTtcbiAgaWYgKChvbkxhYmVsQ2xpY2tNYXAuaGFzKGxhYmVsRWwpICYmIGxhYmVsRWwgPT09IGNvbXBvbmVudC5sYWJlbEVsKSB8fFxuICAgICghbGFiZWxFbCAmJiB1bmxhYmVsZWRDb21wb25lbnRzLmhhcyhjb21wb25lbnQpKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBib3VuZE9uTGFiZWxEaXNjb25uZWN0ZWQgPSBvbkxhYmVsRGlzY29ubmVjdGVkLmJpbmQoY29tcG9uZW50KTtcbiAgaWYgKGxhYmVsRWwpIHtcbiAgICBjb21wb25lbnQubGFiZWxFbCA9IGxhYmVsRWw7XG4gICAgY29uc3QgbGFiZWxhYmxlcyA9IGxhYmVsVG9MYWJlbGFibGVzLmdldChsYWJlbEVsKSB8fCBbXTtcbiAgICBsYWJlbGFibGVzLnB1c2goY29tcG9uZW50KTtcbiAgICBsYWJlbFRvTGFiZWxhYmxlcy5zZXQobGFiZWxFbCwgbGFiZWxhYmxlcy5zb3J0KHNvcnRCeURPTU9yZGVyKSk7XG4gICAgaWYgKCFvbkxhYmVsQ2xpY2tNYXAuaGFzKGNvbXBvbmVudC5sYWJlbEVsKSkge1xuICAgICAgb25MYWJlbENsaWNrTWFwLnNldChjb21wb25lbnQubGFiZWxFbCwgb25MYWJlbENsaWNrKTtcbiAgICAgIGNvbXBvbmVudC5sYWJlbEVsLmFkZEV2ZW50TGlzdGVuZXIobGFiZWxDbGlja0V2ZW50LCBvbkxhYmVsQ2xpY2spO1xuICAgIH1cbiAgICB1bmxhYmVsZWRDb21wb25lbnRzLmRlbGV0ZShjb21wb25lbnQpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIobGFiZWxDb25uZWN0ZWRFdmVudCwgb25MYWJlbENvbm5lY3RlZE1hcC5nZXQoY29tcG9uZW50KSk7XG4gICAgb25MYWJlbERpc2Nvbm5lY3RlZE1hcC5zZXQoY29tcG9uZW50LCBib3VuZE9uTGFiZWxEaXNjb25uZWN0ZWQpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIobGFiZWxEaXNjb25uZWN0ZWRFdmVudCwgYm91bmRPbkxhYmVsRGlzY29ubmVjdGVkKTtcbiAgfVxuICBlbHNlIGlmICghdW5sYWJlbGVkQ29tcG9uZW50cy5oYXMoY29tcG9uZW50KSkge1xuICAgIGJvdW5kT25MYWJlbERpc2Nvbm5lY3RlZCgpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIobGFiZWxEaXNjb25uZWN0ZWRFdmVudCwgb25MYWJlbERpc2Nvbm5lY3RlZE1hcC5nZXQoY29tcG9uZW50KSk7XG4gIH1cbn1cbi8qKlxuICogSGVscGVyIHRvIHRlYXIgZG93biBsYWJlbCBpbnRlcmFjdGlvbnMgb24gZGlzY29ubmVjdGVkQ2FsbGJhY2sgb24gbGFiZWxhYmxlIGNvbXBvbmVudHMuXG4gKlxuICogQHBhcmFtIGNvbXBvbmVudFxuICovXG5mdW5jdGlvbiBkaXNjb25uZWN0TGFiZWwoY29tcG9uZW50KSB7XG4gIGlmICghY29tcG9uZW50KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHVubGFiZWxlZENvbXBvbmVudHMuZGVsZXRlKGNvbXBvbmVudCk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIobGFiZWxDb25uZWN0ZWRFdmVudCwgb25MYWJlbENvbm5lY3RlZE1hcC5nZXQoY29tcG9uZW50KSk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIobGFiZWxEaXNjb25uZWN0ZWRFdmVudCwgb25MYWJlbERpc2Nvbm5lY3RlZE1hcC5nZXQoY29tcG9uZW50KSk7XG4gIG9uTGFiZWxDb25uZWN0ZWRNYXAuZGVsZXRlKGNvbXBvbmVudCk7XG4gIG9uTGFiZWxEaXNjb25uZWN0ZWRNYXAuZGVsZXRlKGNvbXBvbmVudCk7XG4gIGlmICghY29tcG9uZW50LmxhYmVsRWwpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgbGFiZWxhYmxlcyA9IGxhYmVsVG9MYWJlbGFibGVzLmdldChjb21wb25lbnQubGFiZWxFbCk7XG4gIGlmIChsYWJlbGFibGVzLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbXBvbmVudC5sYWJlbEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIobGFiZWxDbGlja0V2ZW50LCBvbkxhYmVsQ2xpY2tNYXAuZ2V0KGNvbXBvbmVudC5sYWJlbEVsKSk7XG4gICAgb25MYWJlbENsaWNrTWFwLmRlbGV0ZShjb21wb25lbnQubGFiZWxFbCk7XG4gIH1cbiAgbGFiZWxUb0xhYmVsYWJsZXMuc2V0KGNvbXBvbmVudC5sYWJlbEVsLCBsYWJlbGFibGVzLmZpbHRlcigobGFiZWxhYmxlKSA9PiBsYWJlbGFibGUgIT09IGNvbXBvbmVudCkuc29ydChzb3J0QnlET01PcmRlcikpO1xuICBjb21wb25lbnQubGFiZWxFbCA9IG51bGw7XG59XG5mdW5jdGlvbiBzb3J0QnlET01PcmRlcihhLCBiKSB7XG4gIHJldHVybiBpc0JlZm9yZShhLmVsLCBiLmVsKSA/IC0xIDogMTtcbn1cbi8qKlxuICogSGVscGVyIHRvIGdldCB0aGUgbGFiZWwgdGV4dCBmcm9tIGEgY29tcG9uZW50LlxuICpcbiAqIEBwYXJhbSBjb21wb25lbnRcbiAqL1xuZnVuY3Rpb24gZ2V0TGFiZWxUZXh0KGNvbXBvbmVudCkge1xuICByZXR1cm4gY29tcG9uZW50LmxhYmVsIHx8IGNvbXBvbmVudC5sYWJlbEVsPy50ZXh0Q29udGVudD8udHJpbSgpIHx8IFwiXCI7XG59XG5mdW5jdGlvbiBvbkxhYmVsQ2xpY2soZXZlbnQpIHtcbiAgY29uc3QgbGFiZWxDbGlja1RhcmdldCA9IGV2ZW50LmRldGFpbC5zb3VyY2VFdmVudC50YXJnZXQ7XG4gIGNvbnN0IGxhYmVsYWJsZXMgPSBsYWJlbFRvTGFiZWxhYmxlcy5nZXQodGhpcyk7XG4gIGNvbnN0IGNsaWNrZWRMYWJlbGFibGUgPSBsYWJlbGFibGVzLmZpbmQoKGxhYmVsYWJsZSkgPT4gbGFiZWxhYmxlLmVsID09PSBsYWJlbENsaWNrVGFyZ2V0KTtcbiAgY29uc3QgbGFiZWxhYmxlQ2hpbGRDbGlja2VkID0gbGFiZWxhYmxlcy5pbmNsdWRlcyhjbGlja2VkTGFiZWxhYmxlKTtcbiAgaWYgKGxhYmVsYWJsZUNoaWxkQ2xpY2tlZCkge1xuICAgIC8vIG5vIG5lZWQgdG8gZm9yd2FyZCBjbGljayBhcyBsYWJlbGFibGUgd2lsbCByZWNlaXZlIGZvY3VzXG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGZpcnN0TGFiZWxhYmxlID0gbGFiZWxhYmxlc1swXTtcbiAgaWYgKGZpcnN0TGFiZWxhYmxlLmRpc2FibGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZpcnN0TGFiZWxhYmxlLm9uTGFiZWxDbGljayhldmVudCk7XG59XG5mdW5jdGlvbiBvbkxhYmVsQ29ubmVjdGVkKCkge1xuICBpZiAodW5sYWJlbGVkQ29tcG9uZW50cy5oYXModGhpcykpIHtcbiAgICBjb25uZWN0TGFiZWwodGhpcyk7XG4gIH1cbn1cbmZ1bmN0aW9uIG9uTGFiZWxEaXNjb25uZWN0ZWQoKSB7XG4gIHVubGFiZWxlZENvbXBvbmVudHMuYWRkKHRoaXMpO1xuICBjb25zdCBib3VuZE9uTGFiZWxDb25uZWN0ZWQgPSBvbkxhYmVsQ29ubmVjdGVkTWFwLmdldCh0aGlzKSB8fCBvbkxhYmVsQ29ubmVjdGVkLmJpbmQodGhpcyk7XG4gIG9uTGFiZWxDb25uZWN0ZWRNYXAuc2V0KHRoaXMsIGJvdW5kT25MYWJlbENvbm5lY3RlZCk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIobGFiZWxDb25uZWN0ZWRFdmVudCwgYm91bmRPbkxhYmVsQ29ubmVjdGVkKTtcbn1cbi8qKlxuICogSGVscGVyIHRvIGFzc29jaWF0ZSBhbiBleHBsaWNpdCBsYWJlbCAoaS5lLiwgdXNpbmcgYGZvcmApIHdpdGggYSBsYWJlbGFibGUgY29tcG9uZW50IHRoYXQgZG9lcyBub3QgaGF2ZSBhbiBhc3NvY2lhdGVkIGxhYmVsLlxuICpcbiAqIEBwYXJhbSBsYWJlbCAtIHRoZSBsYWJlbCBlbGVtZW50XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFzc29jaWF0ZUV4cGxpY2l0TGFiZWxUb1VubGFiZWxlZENvbXBvbmVudChsYWJlbCkge1xuICBhd2FpdCBjb21wb25lbnRPblJlYWR5KGxhYmVsKTtcbiAgY29uc3QgYWxyZWFkeUxhYmVsZWQgPSBsYWJlbFRvTGFiZWxhYmxlcy5oYXMobGFiZWwpO1xuICBpZiAoYWxyZWFkeUxhYmVsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgZm9yQ29tcG9uZW50RWwgPSBsYWJlbC5vd25lckRvY3VtZW50Py5nZXRFbGVtZW50QnlJZChsYWJlbC5mb3IpO1xuICBpZiAoIWZvckNvbXBvbmVudEVsKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgZm9yIChjb25zdCBsYWJlbGFibGUgb2YgdW5sYWJlbGVkQ29tcG9uZW50cykge1xuICAgICAgaWYgKGxhYmVsYWJsZS5lbCA9PT0gZm9yQ29tcG9uZW50RWwpIHtcbiAgICAgICAgY29ubmVjdExhYmVsKGxhYmVsYWJsZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCB7IGFzc29jaWF0ZUV4cGxpY2l0TGFiZWxUb1VubGFiZWxlZENvbXBvbmVudCBhcyBhLCBsYWJlbERpc2Nvbm5lY3RlZEV2ZW50IGFzIGIsIGNvbm5lY3RMYWJlbCBhcyBjLCBkaXNjb25uZWN0TGFiZWwgYXMgZCwgZ2V0TGFiZWxUZXh0IGFzIGcsIGxhYmVsQ29ubmVjdGVkRXZlbnQgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYWJlbC0xYzI4NWQ0MS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=