"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_server-dcb06c"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const addItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    typeKeywords: [],
    customParameters: [],
    analyzedLocationTypes: [],
    allowStoredAuth: true,
    isSecured: null,
    checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;



//# sourceMappingURL=add-item-dbbe2f57.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ formatFileName),
/* harmony export */   f: () => (/* binding */ formatTags),
/* harmony export */   s: () => (/* binding */ streamPromises)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const formatFileName = (title) => (title === null || title === void 0 ? void 0 : title.replace(/(\s+|:)/g, "_")) || "";
const formatTags = (tags) => {
    const cleanTags = (tagObj) => {
        return tagObj
            .split(",")
            .map((tag) => tag.trim())
            .filter((tag) => tag);
    };
    if (!tags) {
        return [];
    }
    else if (typeof tags === "string") {
        return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.b)(cleanTags(tags));
    }
    else {
        return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.b)(tags.flatMap((tag) => {
            return [...cleanTags(tag)];
        }));
    }
};
const resolveOnFirstPromise = async (promiseList) => {
    return new Promise((resolve, reject) => {
        for (let i = 0; i < promiseList.length; i++) {
            promiseList[i]
                .then((result) => {
                const newArr = [...promiseList];
                newArr.splice(i, 1);
                resolve({ remainingPromises: newArr, result });
            })
                .catch(reject);
        }
    });
};
/**
 * Similar to Promise.all but will resolve on the first promise that resolves then continuously swap out the resolved promise with the next promise in the list
 * @param getNextPromise A function that returns the next promise to resolve
 */
async function streamPromises(getNextPromise, options) {
    var _a, _b;
    const results = [];
    const { getBatchSize, onPromiseCompleted, onPromiseThrow, shouldContinue } = options !== null && options !== void 0 ? options : {};
    let remainingPromises = [];
    for (let i = 0; i < ((_a = getBatchSize === null || getBatchSize === void 0 ? void 0 : getBatchSize()) !== null && _a !== void 0 ? _a : 1); i++) {
        try {
            const nextElement = getNextPromise();
            nextElement && remainingPromises.push(nextElement);
        }
        catch (e) {
            onPromiseThrow === null || onPromiseThrow === void 0 ? void 0 : onPromiseThrow(e);
        }
    }
    let lastResult = null;
    while (remainingPromises.length > 0 && (!shouldContinue || shouldContinue(lastResult))) {
        try {
            const { remainingPromises: _remainingPromises, result } = await resolveOnFirstPromise(remainingPromises);
            remainingPromises = _remainingPromises;
            lastResult = result;
            !!result && results.push(result);
            onPromiseCompleted === null || onPromiseCompleted === void 0 ? void 0 : onPromiseCompleted(result);
            // Update batch size after the new result is bubbled up
            const batchSize = (_b = getBatchSize === null || getBatchSize === void 0 ? void 0 : getBatchSize()) !== null && _b !== void 0 ? _b : 1;
            while (remainingPromises.length < batchSize) {
                const nextElement = getNextPromise();
                nextElement && remainingPromises.push(nextElement);
                if (nextElement == null) {
                    break;
                }
            }
        }
        catch (e) {
            onPromiseThrow === null || onPromiseThrow === void 0 ? void 0 : onPromiseThrow(e);
        }
    }
    return results;
}



//# sourceMappingURL=functional-81373f6d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ itemPropertiesStore),
/* harmony export */   i: () => (/* binding */ itemPropertiesState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const itemPropertiesStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    title: "",
    snippet: "",
    tags: [],
    categories: []
});
const itemPropertiesState = itemPropertiesStore.state;



//# sourceMappingURL=item-properties-10491b2e.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getItem),
/* harmony export */   b: () => (/* binding */ sendAddItemRequest),
/* harmony export */   c: () => (/* binding */ searchForExistingItemUrlByName),
/* harmony export */   d: () => (/* binding */ deleteItem),
/* harmony export */   e: () => (/* binding */ addThumbnailToItem),
/* harmony export */   f: () => (/* binding */ formatItemProperties),
/* harmony export */   g: () => (/* binding */ getItemUrl),
/* harmony export */   h: () => (/* binding */ getAddItemParameters),
/* harmony export */   i: () => (/* binding */ createForm),
/* harmony export */   j: () => (/* binding */ commitItem),
/* harmony export */   k: () => (/* binding */ getAddItemUrl),
/* harmony export */   l: () => (/* binding */ cancelItem),
/* harmony export */   m: () => (/* binding */ moveItem),
/* harmony export */   n: () => (/* binding */ getItemData),
/* harmony export */   s: () => (/* binding */ searchExistingItem),
/* harmony export */   u: () => (/* binding */ updateItem)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */









function formatItemProperties({ title, snippet, tags }) {
    return {
        title,
        snippet,
        tags: (0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_6__.f)(tags).join(",")
    };
}
const getAddItemParameters = (itemPropertiesProps, addItemProps) => {
    var _a;
    const { file, type, extension, dataUrl, properties, typeKeywords: extraTypeKeywords } = addItemProps;
    const formattedItemProperties = formatItemProperties(itemPropertiesProps);
    const typeKeywords = [
        ...(_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_7__.a[type]) === null || _a === void 0 ? void 0 : _a.typeKeywords,
        ...(extraTypeKeywords ? [extraTypeKeywords] : []),
        extension
    ].join(", ");
    const baseRequestState = Object.assign({ type, extension }, (properties ? { properties: JSON.stringify(properties) } : {}));
    // We can't just encode URL since url from Drive have Bearer in the encoder will break that
    // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/41617
    const additionalRequestState = file
        ? { file }
        : { dataUrl: dataUrl.includes(`httpHeaders={"Authorization"`) ? dataUrl : encodeURI(dataUrl) };
    return Object.assign(Object.assign(Object.assign(Object.assign({}, baseRequestState), additionalRequestState), formattedItemProperties), { typeKeywords });
};
const createForm = (formatItemProps, addItemProps) => {
    const formProperties = getAddItemParameters(formatItemProps, addItemProps);
    const addAsUniqueFile = !!addItemProps.addAsUniqueFile;
    const form = new FormData();
    form.append("f", "json");
    form.append("async", "true");
    Object.keys(formProperties).forEach((property) => {
        if (addAsUniqueFile && property === "file") {
            const fileName = addItemProps.fileName;
            form.append(property, formProperties[property], fileName);
        }
        else {
            form.append(property, formProperties[property]);
        }
    });
    return form;
};
function isSpecialFolder(folder) {
    return ["all", "recycle"].includes(folder.id) || folder.id === folder.username;
}
const getAddItemUrl = (user, folder) => {
    const folderUrl = (folder === null || folder === void 0 ? void 0 : folder.id) && !isSpecialFolder(folder) ? `/${folder.id}` : "";
    return `${user.userContentUrl}${folderUrl}/addItem`;
};

const getItemUrl = (itemId, portal) => `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}`;
const getItem = async (itemId, portal) => {
    try {
        const url = getItemUrl(itemId, portal);
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url) };
    }
    catch (error) {
        console.warn("error getting item", error);
        return { error: { code: "unhandledError" } };
    }
};
const addThumbnailToItem = async (itemId, thumbnailInfo) => {
    const formData = new FormData();
    switch (thumbnailInfo.type) {
        case "base64":
            formData.append("data", thumbnailInfo.data);
            break;
        case "url":
            formData.append("url", thumbnailInfo.url);
            break;
        case "file":
            formData.append("file", thumbnailInfo.file);
            break;
    }
    formData.append("f", "json");
    formData.append("token", (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal));
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.d)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}content/users/${_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user.username}/items/${itemId}/updateThumbnail`, formData, {}, "post");
};
async function moveItem(itemId, folder) {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    const url = `${user.userContentUrl}/moveItems`;
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items: itemId, folder }, {}, "post");
}
async function deleteItem(itemId, { permanentDelete = false } = {}) {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    const url = `${user.userContentUrl}/items/${itemId}/delete`;
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { permanentDelete }, {}, "post");
}
async function updateItem(itemId, updateObj, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const userContentUrl = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append"
        ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.existingItem.itemOwner.userContentUrl
        : user.userContentUrl; // TODO: ! Use fetchUser if itemOwner is not available
    const url = `${userContentUrl}/items/${itemId}/update`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, updateObj, {}, "post");
}
const getItemData = (itemId, portal) => {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}/data`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url);
};
const commitItem = async (itemId, addItemProps) => {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    const url = `${user.userContentUrl}/items/${itemId}/commit`;
    const form = createForm(_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i, addItemProps);
    form.delete("file");
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.d)(url, form, {}, "post");
    return response;
};
const cancelItem = async (itemId) => {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    const url = `${user.userContentUrl}/items/${itemId}/cancel`;
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, {}, "post");
    return response;
};
/** Send processed item to the server */
const sendAddItemRequest = async (item) => {
    const url = getAddItemUrl(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.folder);
    const formattedItemProperties = formatItemProperties(_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i);
    const isUrlRequestParameters = (item) => item.url && !!item.serviceInfo;
    const requestItem = Object.assign({}, item);
    // Remove redundant properties
    delete requestItem.initialFolders;
    delete requestItem.initialTitle;
    delete requestItem.newItemMode;
    delete requestItem.serviceInfo;
    delete requestItem.allowStoredAuth;
    delete requestItem.isSecured;
    delete requestItem.checkAuth;
    delete requestItem.agsType;
    delete requestItem.developerCredentialsType;
    delete requestItem.applicationEnvironment;
    delete requestItem.apiKeyReferrerUrls;
    delete requestItem.developerCredentialsRedirectUrls;
    delete requestItem.developerPrivileges;
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, Object.assign(Object.assign(Object.assign(Object.assign({}, requestItem), (isUrlRequestParameters(item) ? { serviceInfo: JSON.stringify(item.serviceInfo) } : {})), { typeKeywords: JSON.stringify(item.typeKeywords) }), formattedItemProperties), {}, "post");
};
async function searchExistingItem(title, type, folder, extension, user, portal) {
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    const folderId = !folder || folder.id === user.username ? "root" : folder.id;
    const basename = title.replace(`.${extension}`, "");
    // TODO: refine this existing item search so it doesn't return a false positive when the same item is found
    // in the case of feature collections, they have a type of Feature Layer,
    // so it will match itself as you're also publishing a feature layer. (#36658)
    // for now we'll just skip this validation in this case
    // Additionally, non-published Excel files are already created and just need to be updated
    // so the existing item found here is the item that needs to be updated
    if (extension === "featurecollection" || type === "Microsoft Excel") {
        return null;
    }
    const queryList = [
        `title: "${basename}"`,
        `type: "${type}"`,
        `owner: "${user.username}"`,
        `ownerfolder: "${folderId}"`
    ];
    const searchResults = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}search`, {
        filter: queryList.join(" AND "),
        num: 1
    });
    return (searchResults === null || searchResults === void 0 ? void 0 : searchResults.total) > 0
        ? {
            num: searchResults.num,
            itemURLList: searchResults.results.map((item) => (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__.g)(item.id, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.config.baseUrl))
        }
        : null;
}
async function searchForExistingItemUrlByName(name, itemType) {
    const nameToCheck = (0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_6__.a)(name);
    const { user, config, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const { folder } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i;
    const folderId = !folder || folder.id === user.username ? "root" : folder.id;
    const queryList = [`owner: "${user.username}"`, `ownerfolder: "${folderId}"`];
    if (itemType) {
        queryList.push(`type: "${itemType}"`);
    }
    const MAX_QUERY_ITEM = 100;
    const MAX_RETRY = 10;
    let resultItem;
    let curStart = 1;
    for (let retry = 0; retry < MAX_RETRY && !resultItem && curStart > -1; retry++) {
        const { nextStart, results } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`, {
            [portal.isPortal ? "q" : "filter"]: queryList.join(" AND "),
            num: MAX_QUERY_ITEM,
            start: curStart
        });
        resultItem = results.find((item) => item.name === nameToCheck);
        curStart = nextStart;
    }
    return resultItem ? (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__.g)(resultItem.id, config.baseUrl) : null;
}



//# sourceMappingURL=server-item-8d384796.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const uiStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    nextText: "next",
    workflow: "content",
    scale: "m",
    disableScroll: false,
    featureFlags: {}
});
const uiStoreState = uiStore.state;



//# sourceMappingURL=ui-bca7bcd1.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fc2VydmVyLWRjYjA2Yy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOztBQUVoRzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDdUQ7O0FBRXZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMERBQU07QUFDckI7QUFDQTtBQUNBLGVBQWUsMERBQU07QUFDckI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isd0JBQXdCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG1DQUFtQztBQUM3RCxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtRUFBbUU7QUFDL0U7QUFDQSxvQkFBb0IsNEhBQTRIO0FBQ2hKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0RBQWdEO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFFOztBQUVyRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDcEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ21FOztBQUVuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFXO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRTJDOztBQUUzQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FkZC1pdGVtLWRiYmUyZjU3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Z1bmN0aW9uYWwtODEzNzNmNmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS0zNTM1NTUyZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pdGVtLXByb3BlcnRpZXMtMTA0OTFiMmUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc2VydmVyLWl0ZW0tOGQzODQ3OTYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdWktYmNhN2JjZDEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICB0eXBlS2V5d29yZHM6IFtdLFxuICAgIGN1c3RvbVBhcmFtZXRlcnM6IFtdLFxuICAgIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gICAgYWxsb3dTdG9yZWRBdXRoOiB0cnVlLFxuICAgIGlzU2VjdXJlZDogbnVsbCxcbiAgICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZGQtaXRlbS1kYmJlMmY1Ny5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGIgYXMgdW5pcXVlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcblxuY29uc3QgZm9ybWF0RmlsZU5hbWUgPSAodGl0bGUpID0+ICh0aXRsZSA9PT0gbnVsbCB8fCB0aXRsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGl0bGUucmVwbGFjZSgvKFxccyt8OikvZywgXCJfXCIpKSB8fCBcIlwiO1xuY29uc3QgZm9ybWF0VGFncyA9ICh0YWdzKSA9PiB7XG4gICAgY29uc3QgY2xlYW5UYWdzID0gKHRhZ09iaikgPT4ge1xuICAgICAgICByZXR1cm4gdGFnT2JqXG4gICAgICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgICAubWFwKCh0YWcpID0+IHRhZy50cmltKCkpXG4gICAgICAgICAgICAuZmlsdGVyKCh0YWcpID0+IHRhZyk7XG4gICAgfTtcbiAgICBpZiAoIXRhZ3MpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgdGFncyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gdW5pcXVlKGNsZWFuVGFncyh0YWdzKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gdW5pcXVlKHRhZ3MuZmxhdE1hcCgodGFnKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gWy4uLmNsZWFuVGFncyh0YWcpXTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn07XG5jb25zdCByZXNvbHZlT25GaXJzdFByb21pc2UgPSBhc3luYyAocHJvbWlzZUxpc3QpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb21pc2VMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBwcm9taXNlTGlzdFtpXVxuICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBcnIgPSBbLi4ucHJvbWlzZUxpc3RdO1xuICAgICAgICAgICAgICAgIG5ld0Fyci5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHJlbWFpbmluZ1Byb21pc2VzOiBuZXdBcnIsIHJlc3VsdCB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKHJlamVjdCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG4vKipcbiAqIFNpbWlsYXIgdG8gUHJvbWlzZS5hbGwgYnV0IHdpbGwgcmVzb2x2ZSBvbiB0aGUgZmlyc3QgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRoZW4gY29udGludW91c2x5IHN3YXAgb3V0IHRoZSByZXNvbHZlZCBwcm9taXNlIHdpdGggdGhlIG5leHQgcHJvbWlzZSBpbiB0aGUgbGlzdFxuICogQHBhcmFtIGdldE5leHRQcm9taXNlIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBuZXh0IHByb21pc2UgdG8gcmVzb2x2ZVxuICovXG5hc3luYyBmdW5jdGlvbiBzdHJlYW1Qcm9taXNlcyhnZXROZXh0UHJvbWlzZSwgb3B0aW9ucykge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIGNvbnN0IHsgZ2V0QmF0Y2hTaXplLCBvblByb21pc2VDb21wbGV0ZWQsIG9uUHJvbWlzZVRocm93LCBzaG91bGRDb250aW51ZSB9ID0gb3B0aW9ucyAhPT0gbnVsbCAmJiBvcHRpb25zICE9PSB2b2lkIDAgPyBvcHRpb25zIDoge307XG4gICAgbGV0IHJlbWFpbmluZ1Byb21pc2VzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAoKF9hID0gZ2V0QmF0Y2hTaXplID09PSBudWxsIHx8IGdldEJhdGNoU2l6ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ2V0QmF0Y2hTaXplKCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDEpOyBpKyspIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG5leHRFbGVtZW50ID0gZ2V0TmV4dFByb21pc2UoKTtcbiAgICAgICAgICAgIG5leHRFbGVtZW50ICYmIHJlbWFpbmluZ1Byb21pc2VzLnB1c2gobmV4dEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvblByb21pc2VUaHJvdyA9PT0gbnVsbCB8fCBvblByb21pc2VUaHJvdyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb25Qcm9taXNlVGhyb3coZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IGxhc3RSZXN1bHQgPSBudWxsO1xuICAgIHdoaWxlIChyZW1haW5pbmdQcm9taXNlcy5sZW5ndGggPiAwICYmICghc2hvdWxkQ29udGludWUgfHwgc2hvdWxkQ29udGludWUobGFzdFJlc3VsdCkpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHJlbWFpbmluZ1Byb21pc2VzOiBfcmVtYWluaW5nUHJvbWlzZXMsIHJlc3VsdCB9ID0gYXdhaXQgcmVzb2x2ZU9uRmlyc3RQcm9taXNlKHJlbWFpbmluZ1Byb21pc2VzKTtcbiAgICAgICAgICAgIHJlbWFpbmluZ1Byb21pc2VzID0gX3JlbWFpbmluZ1Byb21pc2VzO1xuICAgICAgICAgICAgbGFzdFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgICAgICEhcmVzdWx0ICYmIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgb25Qcm9taXNlQ29tcGxldGVkID09PSBudWxsIHx8IG9uUHJvbWlzZUNvbXBsZXRlZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogb25Qcm9taXNlQ29tcGxldGVkKHJlc3VsdCk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgYmF0Y2ggc2l6ZSBhZnRlciB0aGUgbmV3IHJlc3VsdCBpcyBidWJibGVkIHVwXG4gICAgICAgICAgICBjb25zdCBiYXRjaFNpemUgPSAoX2IgPSBnZXRCYXRjaFNpemUgPT09IG51bGwgfHwgZ2V0QmF0Y2hTaXplID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZXRCYXRjaFNpemUoKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMTtcbiAgICAgICAgICAgIHdoaWxlIChyZW1haW5pbmdQcm9taXNlcy5sZW5ndGggPCBiYXRjaFNpemUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0RWxlbWVudCA9IGdldE5leHRQcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgbmV4dEVsZW1lbnQgJiYgcmVtYWluaW5nUHJvbWlzZXMucHVzaChuZXh0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRFbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvblByb21pc2VUaHJvdyA9PT0gbnVsbCB8fCBvblByb21pc2VUaHJvdyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb25Qcm9taXNlVGhyb3coZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmV4cG9ydCB7IGZvcm1hdEZpbGVOYW1lIGFzIGEsIGZvcm1hdFRhZ3MgYXMgZiwgc3RyZWFtUHJvbWlzZXMgYXMgcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1mdW5jdGlvbmFsLTgxMzczZjZkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nIH0gZnJvbSAnLi91cmwtNGMzYWU1NGMuanMnO1xuXG5mdW5jdGlvbiBpc0VzcmkoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gaXRlbS5vd25lcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlc3JpXCIpKTtcbn1cbmZ1bmN0aW9uIGlzUHJlbWl1bShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIENyZWRpdHNcIikpO1xufVxuZnVuY3Rpb24gaXNTdWJzY3JpYmVyKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgU3Vic2NyaXB0aW9uXCIpKTtcbn1cbmZ1bmN0aW9uIGlzT3duZXIoaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpdGVtLm93bmVyID09PSB1c2VyLnVzZXJuYW1lO1xufVxuLyoqXG4gKiBDYW4gdGhlIHVzZXIgdXBkYXRlIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW0oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikgfHwgaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJ1cGRhdGVcIjtcbn1cbi8qKlxuICogSXMgdGhlIHVzZXIgZWl0aGVyIGFuIG93bmVyIG9yIGFkbWluIG9mIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGlzT3duZXIoaXRlbSwgdXNlcikgfHwgaXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG59XG4vKipcbiAqIERvZXMgdGhlIHVzZXIgaGF2ZSBhZG1pbiBjYXBhYmlsaXRpZXMgb24gdGhpcyBpdGVtXG4gKi9cbmZ1bmN0aW9uIGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gaWYgdGhpcyBmbGFnIGlzIGFscmVhZHkgc2V0IChwcm9iYWJseSBob21lIGFwcCksIHVzZSBpdFxuICAgIGlmIChpdGVtLmlzQWRtaW4gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gISFpdGVtLmlzQWRtaW47XG4gICAgfVxuICAgIGNvbnN0IGl0ZW1Pd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3QgaXRlbUNvbnRyb2xBZG1pbiA9IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwiYWRtaW5cIjtcbiAgICBjb25zdCBlc3JpVXNlcnMgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCIsIFwiZXNyaV9kZW1vZ3JhcGhpY3NcIiwgXCJlc3JpX2JvdW5kYXJpZXNcIl07XG4gICAgaWYgKCgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSAmJlxuICAgICAgICAhaXNPd25lcihpdGVtLCB1c2VyKSAmJlxuICAgICAgICBpdGVtQ29udHJvbEFkbWluICYmXG4gICAgICAgIGl0ZW1Pd25lci5pbmNsdWRlcyhcImVzcmlfXCIpICYmXG4gICAgICAgIC8vIHBvcnRhbCBpbmNvcnJlY3RseSByZXR1cm5zIFwiaXRlbUNvbnRyb2w9XCJhZG1pblwiIGZvciBlc3JpIG93bmVkIGl0ZW1zXG4gICAgICAgICFlc3JpVXNlcnMuaW5jbHVkZXMoaXRlbU93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBpdGVtQ29udHJvbEFkbWluO1xufVxuY29uc3QgaXRlbXNCZWxvbmdUb1VzZXJPcmcgPSAoaXRlbXMsIHVzZXIpID0+IHtcbiAgICByZXR1cm4gISF1c2VyLm9yZ0lkICYmIGl0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtLmlzT3JnSXRlbSk7XG59O1xuY29uc3QgZ2V0SXRlbUhvbWVBcHBVcmwgPSAoaXRlbUlkLCBiYXNlVXJsKSA9PiBgJHthZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nKGJhc2VVcmwpfWl0ZW0uaHRtbD9pZD0ke2l0ZW1JZH1gO1xuXG5leHBvcnQgeyBpc1N1YnNjcmliZXIgYXMgYSwgaXNQcmVtaXVtIGFzIGIsIGNhblVwZGF0ZUl0ZW0gYXMgYywgaXRlbXNCZWxvbmdUb1VzZXJPcmcgYXMgZCwgZ2V0SXRlbUhvbWVBcHBVcmwgYXMgZywgaXNPd25lciBhcyBpLCB1c2VySXNJdGVtQWRtaW4gYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pdGVtLTM1MzU1NTJkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuXG5jb25zdCBpdGVtUHJvcGVydGllc1N0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIHRpdGxlOiBcIlwiLFxuICAgIHNuaXBwZXQ6IFwiXCIsXG4gICAgdGFnczogW10sXG4gICAgY2F0ZWdvcmllczogW11cbn0pO1xuY29uc3QgaXRlbVByb3BlcnRpZXNTdGF0ZSA9IGl0ZW1Qcm9wZXJ0aWVzU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGl0ZW1Qcm9wZXJ0aWVzU3RvcmUgYXMgYSwgaXRlbVByb3BlcnRpZXNTdGF0ZSBhcyBpIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWl0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCwgZCBhcyBmb3JtUmVxdWVzdCwgZSBhcyBnZXRUb2tlbiB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEl0ZW1Ib21lQXBwVXJsIH0gZnJvbSAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSB9IGZyb20gJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtYXRUYWdzLCBhIGFzIGZvcm1hdEZpbGVOYW1lIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTgxMzczZjZkLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcblxuZnVuY3Rpb24gZm9ybWF0SXRlbVByb3BlcnRpZXMoeyB0aXRsZSwgc25pcHBldCwgdGFncyB9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIHNuaXBwZXQsXG4gICAgICAgIHRhZ3M6IGZvcm1hdFRhZ3ModGFncykuam9pbihcIixcIilcbiAgICB9O1xufVxuY29uc3QgZ2V0QWRkSXRlbVBhcmFtZXRlcnMgPSAoaXRlbVByb3BlcnRpZXNQcm9wcywgYWRkSXRlbVByb3BzKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgZmlsZSwgdHlwZSwgZXh0ZW5zaW9uLCBkYXRhVXJsLCBwcm9wZXJ0aWVzLCB0eXBlS2V5d29yZHM6IGV4dHJhVHlwZUtleXdvcmRzIH0gPSBhZGRJdGVtUHJvcHM7XG4gICAgY29uc3QgZm9ybWF0dGVkSXRlbVByb3BlcnRpZXMgPSBmb3JtYXRJdGVtUHJvcGVydGllcyhpdGVtUHJvcGVydGllc1Byb3BzKTtcbiAgICBjb25zdCB0eXBlS2V5d29yZHMgPSBbXG4gICAgICAgIC4uLihfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGVLZXl3b3JkcyxcbiAgICAgICAgLi4uKGV4dHJhVHlwZUtleXdvcmRzID8gW2V4dHJhVHlwZUtleXdvcmRzXSA6IFtdKSxcbiAgICAgICAgZXh0ZW5zaW9uXG4gICAgXS5qb2luKFwiLCBcIik7XG4gICAgY29uc3QgYmFzZVJlcXVlc3RTdGF0ZSA9IE9iamVjdC5hc3NpZ24oeyB0eXBlLCBleHRlbnNpb24gfSwgKHByb3BlcnRpZXMgPyB7IHByb3BlcnRpZXM6IEpTT04uc3RyaW5naWZ5KHByb3BlcnRpZXMpIH0gOiB7fSkpO1xuICAgIC8vIFdlIGNhbid0IGp1c3QgZW5jb2RlIFVSTCBzaW5jZSB1cmwgZnJvbSBEcml2ZSBoYXZlIEJlYXJlciBpbiB0aGUgZW5jb2RlciB3aWxsIGJyZWFrIHRoYXRcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDE2MTdcbiAgICBjb25zdCBhZGRpdGlvbmFsUmVxdWVzdFN0YXRlID0gZmlsZVxuICAgICAgICA/IHsgZmlsZSB9XG4gICAgICAgIDogeyBkYXRhVXJsOiBkYXRhVXJsLmluY2x1ZGVzKGBodHRwSGVhZGVycz17XCJBdXRob3JpemF0aW9uXCJgKSA/IGRhdGFVcmwgOiBlbmNvZGVVUkkoZGF0YVVybCkgfTtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgYmFzZVJlcXVlc3RTdGF0ZSksIGFkZGl0aW9uYWxSZXF1ZXN0U3RhdGUpLCBmb3JtYXR0ZWRJdGVtUHJvcGVydGllcyksIHsgdHlwZUtleXdvcmRzIH0pO1xufTtcbmNvbnN0IGNyZWF0ZUZvcm0gPSAoZm9ybWF0SXRlbVByb3BzLCBhZGRJdGVtUHJvcHMpID0+IHtcbiAgICBjb25zdCBmb3JtUHJvcGVydGllcyA9IGdldEFkZEl0ZW1QYXJhbWV0ZXJzKGZvcm1hdEl0ZW1Qcm9wcywgYWRkSXRlbVByb3BzKTtcbiAgICBjb25zdCBhZGRBc1VuaXF1ZUZpbGUgPSAhIWFkZEl0ZW1Qcm9wcy5hZGRBc1VuaXF1ZUZpbGU7XG4gICAgY29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgIGZvcm0uYXBwZW5kKFwiZlwiLCBcImpzb25cIik7XG4gICAgZm9ybS5hcHBlbmQoXCJhc3luY1wiLCBcInRydWVcIik7XG4gICAgT2JqZWN0LmtleXMoZm9ybVByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5KSA9PiB7XG4gICAgICAgIGlmIChhZGRBc1VuaXF1ZUZpbGUgJiYgcHJvcGVydHkgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGFkZEl0ZW1Qcm9wcy5maWxlTmFtZTtcbiAgICAgICAgICAgIGZvcm0uYXBwZW5kKHByb3BlcnR5LCBmb3JtUHJvcGVydGllc1twcm9wZXJ0eV0sIGZpbGVOYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvcm0uYXBwZW5kKHByb3BlcnR5LCBmb3JtUHJvcGVydGllc1twcm9wZXJ0eV0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm07XG59O1xuZnVuY3Rpb24gaXNTcGVjaWFsRm9sZGVyKGZvbGRlcikge1xuICAgIHJldHVybiBbXCJhbGxcIiwgXCJyZWN5Y2xlXCJdLmluY2x1ZGVzKGZvbGRlci5pZCkgfHwgZm9sZGVyLmlkID09PSBmb2xkZXIudXNlcm5hbWU7XG59XG5jb25zdCBnZXRBZGRJdGVtVXJsID0gKHVzZXIsIGZvbGRlcikgPT4ge1xuICAgIGNvbnN0IGZvbGRlclVybCA9IChmb2xkZXIgPT09IG51bGwgfHwgZm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmb2xkZXIuaWQpICYmICFpc1NwZWNpYWxGb2xkZXIoZm9sZGVyKSA/IGAvJHtmb2xkZXIuaWR9YCA6IFwiXCI7XG4gICAgcmV0dXJuIGAke3VzZXIudXNlckNvbnRlbnRVcmx9JHtmb2xkZXJVcmx9L2FkZEl0ZW1gO1xufTtcblxuY29uc3QgZ2V0SXRlbVVybCA9IChpdGVtSWQsIHBvcnRhbCkgPT4gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb250ZW50L2l0ZW1zLyR7aXRlbUlkfWA7XG5jb25zdCBnZXRJdGVtID0gYXN5bmMgKGl0ZW1JZCwgcG9ydGFsKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXJsID0gZ2V0SXRlbVVybChpdGVtSWQsIHBvcnRhbCk7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogYXdhaXQgcmVxdWVzdCh1cmwpIH07XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJlcnJvciBnZXR0aW5nIGl0ZW1cIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5jb25zdCBhZGRUaHVtYm5haWxUb0l0ZW0gPSBhc3luYyAoaXRlbUlkLCB0aHVtYm5haWxJbmZvKSA9PiB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBzd2l0Y2ggKHRodW1ibmFpbEluZm8udHlwZSkge1xuICAgICAgICBjYXNlIFwiYmFzZTY0XCI6XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkYXRhXCIsIHRodW1ibmFpbEluZm8uZGF0YSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInVybFwiOlxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwidXJsXCIsIHRodW1ibmFpbEluZm8udXJsKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZmlsZVwiOlxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCB0aHVtYm5haWxJbmZvLmZpbGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGZvcm1EYXRhLmFwcGVuZChcImZcIiwgXCJqc29uXCIpO1xuICAgIGZvcm1EYXRhLmFwcGVuZChcInRva2VuXCIsIGdldFRva2VuKGNvbmZpZ1N0YXRlLnBvcnRhbCkpO1xuICAgIHJldHVybiBhd2FpdCBmb3JtUmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfWNvbnRlbnQvdXNlcnMvJHtjb25maWdTdGF0ZS51c2VyLnVzZXJuYW1lfS9pdGVtcy8ke2l0ZW1JZH0vdXBkYXRlVGh1bWJuYWlsYCwgZm9ybURhdGEsIHt9LCBcInBvc3RcIik7XG59O1xuYXN5bmMgZnVuY3Rpb24gbW92ZUl0ZW0oaXRlbUlkLCBmb2xkZXIpIHtcbiAgICBjb25zdCB1c2VyID0gY29uZmlnU3RhdGUudXNlcjtcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9tb3ZlSXRlbXNgO1xuICAgIHJldHVybiBhd2FpdCByZXF1ZXN0KHVybCwgeyBpdGVtczogaXRlbUlkLCBmb2xkZXIgfSwge30sIFwicG9zdFwiKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUl0ZW0oaXRlbUlkLCB7IHBlcm1hbmVudERlbGV0ZSA9IGZhbHNlIH0gPSB7fSkge1xuICAgIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZS51c2VyO1xuICAgIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbUlkfS9kZWxldGVgO1xuICAgIHJldHVybiBhd2FpdCByZXF1ZXN0KHVybCwgeyBwZXJtYW5lbnREZWxldGUgfSwge30sIFwicG9zdFwiKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUl0ZW0oaXRlbUlkLCB1cGRhdGVPYmosIHBvcnRhbFVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICAgIGNvbnN0IHVzZXJDb250ZW50VXJsID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcImFwcGVuZFwiXG4gICAgICAgID8gYWRkSXRlbVN0YXRlLmV4aXN0aW5nSXRlbS5pdGVtT3duZXIudXNlckNvbnRlbnRVcmxcbiAgICAgICAgOiB1c2VyLnVzZXJDb250ZW50VXJsOyAvLyBUT0RPOiAhIFVzZSBmZXRjaFVzZXIgaWYgaXRlbU93bmVyIGlzIG5vdCBhdmFpbGFibGVcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyQ29udGVudFVybH0vaXRlbXMvJHtpdGVtSWR9L3VwZGF0ZWA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB1cGRhdGVPYmosIHt9LCBcInBvc3RcIik7XG59XG5jb25zdCBnZXRJdGVtRGF0YSA9IChpdGVtSWQsIHBvcnRhbCkgPT4ge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC9pdGVtcy8ke2l0ZW1JZH0vZGF0YWA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsKTtcbn07XG5jb25zdCBjb21taXRJdGVtID0gYXN5bmMgKGl0ZW1JZCwgYWRkSXRlbVByb3BzKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7dXNlci51c2VyQ29udGVudFVybH0vaXRlbXMvJHtpdGVtSWR9L2NvbW1pdGA7XG4gICAgY29uc3QgZm9ybSA9IGNyZWF0ZUZvcm0oaXRlbVByb3BlcnRpZXNTdGF0ZSwgYWRkSXRlbVByb3BzKTtcbiAgICBmb3JtLmRlbGV0ZShcImZpbGVcIik7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmb3JtUmVxdWVzdCh1cmwsIGZvcm0sIHt9LCBcInBvc3RcIik7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbmNvbnN0IGNhbmNlbEl0ZW0gPSBhc3luYyAoaXRlbUlkKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7dXNlci51c2VyQ29udGVudFVybH0vaXRlbXMvJHtpdGVtSWR9L2NhbmNlbGA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwge30sIHt9LCBcInBvc3RcIik7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufTtcbi8qKiBTZW5kIHByb2Nlc3NlZCBpdGVtIHRvIHRoZSBzZXJ2ZXIgKi9cbmNvbnN0IHNlbmRBZGRJdGVtUmVxdWVzdCA9IGFzeW5jIChpdGVtKSA9PiB7XG4gICAgY29uc3QgdXJsID0gZ2V0QWRkSXRlbVVybChjb25maWdTdGF0ZS51c2VyLCBpdGVtUHJvcGVydGllc1N0YXRlLmZvbGRlcik7XG4gICAgY29uc3QgZm9ybWF0dGVkSXRlbVByb3BlcnRpZXMgPSBmb3JtYXRJdGVtUHJvcGVydGllcyhpdGVtUHJvcGVydGllc1N0YXRlKTtcbiAgICBjb25zdCBpc1VybFJlcXVlc3RQYXJhbWV0ZXJzID0gKGl0ZW0pID0+IGl0ZW0udXJsICYmICEhaXRlbS5zZXJ2aWNlSW5mbztcbiAgICBjb25zdCByZXF1ZXN0SXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW0pO1xuICAgIC8vIFJlbW92ZSByZWR1bmRhbnQgcHJvcGVydGllc1xuICAgIGRlbGV0ZSByZXF1ZXN0SXRlbS5pbml0aWFsRm9sZGVycztcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uaW5pdGlhbFRpdGxlO1xuICAgIGRlbGV0ZSByZXF1ZXN0SXRlbS5uZXdJdGVtTW9kZTtcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uc2VydmljZUluZm87XG4gICAgZGVsZXRlIHJlcXVlc3RJdGVtLmFsbG93U3RvcmVkQXV0aDtcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uaXNTZWN1cmVkO1xuICAgIGRlbGV0ZSByZXF1ZXN0SXRlbS5jaGVja0F1dGg7XG4gICAgZGVsZXRlIHJlcXVlc3RJdGVtLmFnc1R5cGU7XG4gICAgZGVsZXRlIHJlcXVlc3RJdGVtLmRldmVsb3BlckNyZWRlbnRpYWxzVHlwZTtcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uYXBwbGljYXRpb25FbnZpcm9ubWVudDtcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uYXBpS2V5UmVmZXJyZXJVcmxzO1xuICAgIGRlbGV0ZSByZXF1ZXN0SXRlbS5kZXZlbG9wZXJDcmVkZW50aWFsc1JlZGlyZWN0VXJscztcbiAgICBkZWxldGUgcmVxdWVzdEl0ZW0uZGV2ZWxvcGVyUHJpdmlsZWdlcztcbiAgICByZXR1cm4gYXdhaXQgcmVxdWVzdCh1cmwsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlcXVlc3RJdGVtKSwgKGlzVXJsUmVxdWVzdFBhcmFtZXRlcnMoaXRlbSkgPyB7IHNlcnZpY2VJbmZvOiBKU09OLnN0cmluZ2lmeShpdGVtLnNlcnZpY2VJbmZvKSB9IDoge30pKSwgeyB0eXBlS2V5d29yZHM6IEpTT04uc3RyaW5naWZ5KGl0ZW0udHlwZUtleXdvcmRzKSB9KSwgZm9ybWF0dGVkSXRlbVByb3BlcnRpZXMpLCB7fSwgXCJwb3N0XCIpO1xufTtcbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaEV4aXN0aW5nSXRlbSh0aXRsZSwgdHlwZSwgZm9sZGVyLCBleHRlbnNpb24sIHVzZXIsIHBvcnRhbCkge1xuICAgIHVzZXIgIT09IG51bGwgJiYgdXNlciAhPT0gdm9pZCAwID8gdXNlciA6ICh1c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgcG9ydGFsICE9PSBudWxsICYmIHBvcnRhbCAhPT0gdm9pZCAwID8gcG9ydGFsIDogKHBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgY29uc3QgZm9sZGVySWQgPSAhZm9sZGVyIHx8IGZvbGRlci5pZCA9PT0gdXNlci51c2VybmFtZSA/IFwicm9vdFwiIDogZm9sZGVyLmlkO1xuICAgIGNvbnN0IGJhc2VuYW1lID0gdGl0bGUucmVwbGFjZShgLiR7ZXh0ZW5zaW9ufWAsIFwiXCIpO1xuICAgIC8vIFRPRE86IHJlZmluZSB0aGlzIGV4aXN0aW5nIGl0ZW0gc2VhcmNoIHNvIGl0IGRvZXNuJ3QgcmV0dXJuIGEgZmFsc2UgcG9zaXRpdmUgd2hlbiB0aGUgc2FtZSBpdGVtIGlzIGZvdW5kXG4gICAgLy8gaW4gdGhlIGNhc2Ugb2YgZmVhdHVyZSBjb2xsZWN0aW9ucywgdGhleSBoYXZlIGEgdHlwZSBvZiBGZWF0dXJlIExheWVyLFxuICAgIC8vIHNvIGl0IHdpbGwgbWF0Y2ggaXRzZWxmIGFzIHlvdSdyZSBhbHNvIHB1Ymxpc2hpbmcgYSBmZWF0dXJlIGxheWVyLiAoIzM2NjU4KVxuICAgIC8vIGZvciBub3cgd2UnbGwganVzdCBza2lwIHRoaXMgdmFsaWRhdGlvbiBpbiB0aGlzIGNhc2VcbiAgICAvLyBBZGRpdGlvbmFsbHksIG5vbi1wdWJsaXNoZWQgRXhjZWwgZmlsZXMgYXJlIGFscmVhZHkgY3JlYXRlZCBhbmQganVzdCBuZWVkIHRvIGJlIHVwZGF0ZWRcbiAgICAvLyBzbyB0aGUgZXhpc3RpbmcgaXRlbSBmb3VuZCBoZXJlIGlzIHRoZSBpdGVtIHRoYXQgbmVlZHMgdG8gYmUgdXBkYXRlZFxuICAgIGlmIChleHRlbnNpb24gPT09IFwiZmVhdHVyZWNvbGxlY3Rpb25cIiB8fCB0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBxdWVyeUxpc3QgPSBbXG4gICAgICAgIGB0aXRsZTogXCIke2Jhc2VuYW1lfVwiYCxcbiAgICAgICAgYHR5cGU6IFwiJHt0eXBlfVwiYCxcbiAgICAgICAgYG93bmVyOiBcIiR7dXNlci51c2VybmFtZX1cImAsXG4gICAgICAgIGBvd25lcmZvbGRlcjogXCIke2ZvbGRlcklkfVwiYFxuICAgIF07XG4gICAgY29uc3Qgc2VhcmNoUmVzdWx0cyA9IGF3YWl0IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1zZWFyY2hgLCB7XG4gICAgICAgIGZpbHRlcjogcXVlcnlMaXN0LmpvaW4oXCIgQU5EIFwiKSxcbiAgICAgICAgbnVtOiAxXG4gICAgfSk7XG4gICAgcmV0dXJuIChzZWFyY2hSZXN1bHRzID09PSBudWxsIHx8IHNlYXJjaFJlc3VsdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlYXJjaFJlc3VsdHMudG90YWwpID4gMFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIG51bTogc2VhcmNoUmVzdWx0cy5udW0sXG4gICAgICAgICAgICBpdGVtVVJMTGlzdDogc2VhcmNoUmVzdWx0cy5yZXN1bHRzLm1hcCgoaXRlbSkgPT4gZ2V0SXRlbUhvbWVBcHBVcmwoaXRlbS5pZCwgY29uZmlnU3RhdGUuY29uZmlnLmJhc2VVcmwpKVxuICAgICAgICB9XG4gICAgICAgIDogbnVsbDtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaEZvckV4aXN0aW5nSXRlbVVybEJ5TmFtZShuYW1lLCBpdGVtVHlwZSkge1xuICAgIGNvbnN0IG5hbWVUb0NoZWNrID0gZm9ybWF0RmlsZU5hbWUobmFtZSk7XG4gICAgY29uc3QgeyB1c2VyLCBjb25maWcsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgeyBmb2xkZXIgfSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGU7XG4gICAgY29uc3QgZm9sZGVySWQgPSAhZm9sZGVyIHx8IGZvbGRlci5pZCA9PT0gdXNlci51c2VybmFtZSA/IFwicm9vdFwiIDogZm9sZGVyLmlkO1xuICAgIGNvbnN0IHF1ZXJ5TGlzdCA9IFtgb3duZXI6IFwiJHt1c2VyLnVzZXJuYW1lfVwiYCwgYG93bmVyZm9sZGVyOiBcIiR7Zm9sZGVySWR9XCJgXTtcbiAgICBpZiAoaXRlbVR5cGUpIHtcbiAgICAgICAgcXVlcnlMaXN0LnB1c2goYHR5cGU6IFwiJHtpdGVtVHlwZX1cImApO1xuICAgIH1cbiAgICBjb25zdCBNQVhfUVVFUllfSVRFTSA9IDEwMDtcbiAgICBjb25zdCBNQVhfUkVUUlkgPSAxMDtcbiAgICBsZXQgcmVzdWx0SXRlbTtcbiAgICBsZXQgY3VyU3RhcnQgPSAxO1xuICAgIGZvciAobGV0IHJldHJ5ID0gMDsgcmV0cnkgPCBNQVhfUkVUUlkgJiYgIXJlc3VsdEl0ZW0gJiYgY3VyU3RhcnQgPiAtMTsgcmV0cnkrKykge1xuICAgICAgICBjb25zdCB7IG5leHRTdGFydCwgcmVzdWx0cyB9ID0gYXdhaXQgcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfXNlYXJjaGAsIHtcbiAgICAgICAgICAgIFtwb3J0YWwuaXNQb3J0YWwgPyBcInFcIiA6IFwiZmlsdGVyXCJdOiBxdWVyeUxpc3Quam9pbihcIiBBTkQgXCIpLFxuICAgICAgICAgICAgbnVtOiBNQVhfUVVFUllfSVRFTSxcbiAgICAgICAgICAgIHN0YXJ0OiBjdXJTdGFydFxuICAgICAgICB9KTtcbiAgICAgICAgcmVzdWx0SXRlbSA9IHJlc3VsdHMuZmluZCgoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBuYW1lVG9DaGVjayk7XG4gICAgICAgIGN1clN0YXJ0ID0gbmV4dFN0YXJ0O1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0SXRlbSA/IGdldEl0ZW1Ib21lQXBwVXJsKHJlc3VsdEl0ZW0uaWQsIGNvbmZpZy5iYXNlVXJsKSA6IG51bGw7XG59XG5cbmV4cG9ydCB7IGdldEl0ZW0gYXMgYSwgc2VuZEFkZEl0ZW1SZXF1ZXN0IGFzIGIsIHNlYXJjaEZvckV4aXN0aW5nSXRlbVVybEJ5TmFtZSBhcyBjLCBkZWxldGVJdGVtIGFzIGQsIGFkZFRodW1ibmFpbFRvSXRlbSBhcyBlLCBmb3JtYXRJdGVtUHJvcGVydGllcyBhcyBmLCBnZXRJdGVtVXJsIGFzIGcsIGdldEFkZEl0ZW1QYXJhbWV0ZXJzIGFzIGgsIGNyZWF0ZUZvcm0gYXMgaSwgY29tbWl0SXRlbSBhcyBqLCBnZXRBZGRJdGVtVXJsIGFzIGssIGNhbmNlbEl0ZW0gYXMgbCwgbW92ZUl0ZW0gYXMgbSwgZ2V0SXRlbURhdGEgYXMgbiwgc2VhcmNoRXhpc3RpbmdJdGVtIGFzIHMsIHVwZGF0ZUl0ZW0gYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgdWlTdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICBuZXh0VGV4dDogXCJuZXh0XCIsXG4gICAgd29ya2Zsb3c6IFwiY29udGVudFwiLFxuICAgIHNjYWxlOiBcIm1cIixcbiAgICBkaXNhYmxlU2Nyb2xsOiBmYWxzZSxcbiAgICBmZWF0dXJlRmxhZ3M6IHt9XG59KTtcbmNvbnN0IHVpU3RvcmVTdGF0ZSA9IHVpU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IHVpU3RvcmUgYXMgYSwgdWlTdG9yZVN0YXRlIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dWktYmNhN2JjZDEuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9