"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3d0215"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-delete-items-recycle-disabled_2.entry.js":
/*!*****************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-delete-items-recycle-disabled_2.entry.js ***!
  \*****************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_delete_items_recycle_disabled: () => (/* binding */ ArcgisDeleteItemsRecycleDisabled),
/* harmony export */   arcgis_delete_items_recycle_enabled: () => (/* binding */ ArcgisDeleteItemsRecycleEnabled)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _delete_items_32d24534_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./delete-items-32d24534.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/delete-items-32d24534.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */











const STORE_LOOKUP = new Map();
function getDeleteItemsStore(el) {
    function getStore(el, tag) {
        const existingStore = STORE_LOOKUP.get(el);
        if (existingStore) {
            return existingStore;
        }
        const element = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, tag);
        if (element) {
            STORE_LOOKUP.set(el, element.store);
            return element.store;
        }
        return null;
    }
    return getStore(el, "arcgis-delete-items");
}

const arcgisDeleteItemsRecycleDisabledCss = ":host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}";

const ArcgisDeleteItemsRecycleDisabled = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.renderRecycle = () => {
            const { unprotectedItems } = this.buckets;
            switch (this.mode) {
                case "PROTECTED":
                case "PROTECTED_UNPROTECTED":
                    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.i18n.cantDelete), unprotectedItems.length > 0 && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.i18n.proceed)));
                case "UNPROTECTED":
                default:
                    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.i18n.areYouSure[this.buckets.unprotectedItems.length > 1 ? "multiple" : "single"]));
            }
        };
        this.buckets = undefined;
        this.mode = undefined;
    }
    async componentWillLoad() {
        this.store = getDeleteItemsStore(this.el);
        this.i18n = this.store.state.i18n;
    }
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderRecycle());
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisDeleteItemsRecycleDisabled.style = arcgisDeleteItemsRecycleDisabledCss;

const arcgisDeleteItemsRecycleEnabledCss = ":host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}.selected-items{margin-bottom:2rem;font-size:var(--calcite-font-size-0)}.divider{margin-left:0px;margin-right:0px;margin-top:1rem;margin-bottom:0px;border-style:none;border-top:1px solid #ccc}.more-options__container{display:flex;flex-direction:column;align-items:flex-start}.more-options__button{margin-top:2rem;margin-bottom:1rem}.override{display:flex;flex-direction:column}.override__description{margin-bottom:1rem}arcgis-items-summary:not(:first-of-type){margin-top:2rem}";

const ArcgisDeleteItemsRecycleEnabled = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisDeleteItemsPermanentlyDeleteOverride = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisDeleteItemsPermanentlyDeleteOverride", 7);
        this.renderUnrecyclableBucket = () => {
            const { i18n, items, isPermanentlyDeleteBucketDisabled } = this;
            const { protectedItems, unprotectedItems, unrecyclableItems } = this.buckets;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", { icon: "trash", disabled: isPermanentlyDeleteBucketDisabled }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.summary.permanentlyDelete), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { popoverId: "unrecyclable-bucket", summaryGroups: [
                    {
                        items: unrecyclableItems,
                        heading: i18n.summary.permanentDelete.group.notSupported
                    }
                ] })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "description" }, i18n.summary.permanentDelete.notSupported[items.length === 1 ? "single" : "multiple"]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "link" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { "icon-end": "launch", href: /* TODO: "${unsupportedItemsHelpLink}"*/ "", target: "_blank" }, i18n.learnMore)), !(unprotectedItems.length === 0 && protectedItems.length === 0) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions", class: "enabled" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", appearance: "outline", onClick: () => {
                    this.isPermanentlyDeleteBucketDisabled = !isPermanentlyDeleteBucketDisabled;
                } }, isPermanentlyDeleteBucketDisabled ? i18n.summary.select : i18n.summary.deselect)))), (unprotectedItems.length > 0 || protectedItems.length > 0) && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("hr", { class: "divider" })));
        };
        this.renderUnprotectedBucket = () => {
            const { i18n, items } = this;
            const { unprotectedItems } = this.buckets;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", { icon: "recycle-bin" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.summary.willBeRecycled), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { popoverId: "unprotected-bucket", summaryGroups: [{ items: unprotectedItems }] })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "description" }, i18n.summary.canBeRecovered[items.length === 1 ? "single" : "multiple"].replace("${days}", `${_delete_items_32d24534_js__WEBPACK_IMPORTED_MODULE_2__.D}`))));
        };
        this.renderProtectedBucket = () => {
            const { i18n } = this;
            const { protectedItems } = this.buckets;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", { icon: "security" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.summary.cannotBeDeleted), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { popoverId: "protected-bucket", summaryGroups: [
                    { items: protectedItems, heading: i18n.summary.protectedGroup.deleteProtected }
                ] })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "description" }, i18n.summary.cannotDelete.all)));
        };
        this.renderPermanentlyDeleteAllOverride = () => {
            const { i18n } = this;
            const { unprotectedItems, unrecyclableItems } = this.buckets;
            const deleteOverriddenBucket = [...unprotectedItems, ...unrecyclableItems];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "override" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "override__description" }, i18n.deleteOverride[deleteOverriddenBucket.length > 0 ? "multiple" : "single"]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", { icon: "trash" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.summary.permanentlyDelete), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { label: i18n.summary.permanentlyDelete, popoverId: "permanently-delete-override-bucket", summaryGroups: [{ items: deleteOverriddenBucket }] })))));
        };
        this.renderMoreOptions = () => {
            const { i18n, isMoreOptionsExpanded, isAllSameDeleteMode, buckets, items, mode, primaryAction, arcgisDeleteItemsPermanentlyDeleteOverride } = this;
            const { unprotectedItems, unrecyclableItems } = buckets;
            if (mode === "PROTECTED" || primaryAction === "PERMANENTLY_DELETE") {
                return null;
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "more-options__container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "more-options__button", scale: "s", iconEnd: isMoreOptionsExpanded ? "minus" : "plus", appearance: "transparent", onClick: () => {
                    this.isMoreOptionsExpanded = !isMoreOptionsExpanded;
                }, onKeyDown: (e) => {
                    if (["Enter", " "].includes(e.key)) {
                        this.isMoreOptionsExpanded = !isMoreOptionsExpanded;
                    }
                } }, isMoreOptionsExpanded ? i18n.hideOptions : i18n.moreOptions), isMoreOptionsExpanded && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { kind: "danger", scale: "s", appearance: "transparent", iconStart: "trash", onClick: () => {
                    this.permanentlyDeleteOverridden = true;
                    arcgisDeleteItemsPermanentlyDeleteOverride.emit();
                } }, isAllSameDeleteMode
                ? i18n.deletePermanently
                : i18n.summary.deleteXPermanently
                    .replace("${subset}", `${unprotectedItems.length + unrecyclableItems.length}`)
                    .replace("${total}", `${items.length}`)))));
        };
        this.buckets = undefined;
        this.mode = undefined;
        this.primaryAction = undefined;
        this.items = undefined;
        this.permanentlyDeleteOverridden = undefined;
        this.showSelectedItemsCount = true;
        this.isPermanentlyDeleteBucketDisabled = undefined;
        this.isMoreOptionsExpanded = undefined;
    }
    async componentWillLoad() {
        this.store = getDeleteItemsStore(this.el);
        this.i18n = this.store.state.i18n;
        const singleDeleteModes = ["PROTECTED", "UNPROTECTED", "UNRECYCLABLE"];
        this.isAllSameDeleteMode = singleDeleteModes.includes(this.mode);
    }
    render() {
        const { i18n, items, isPermanentlyDeleteBucketDisabled, permanentlyDeleteOverridden, isAllSameDeleteMode, showSelectedItemsCount, renderPermanentlyDeleteAllOverride, renderUnrecyclableBucket, renderUnprotectedBucket, renderProtectedBucket, renderMoreOptions } = this;
        const { protectedItems, unprotectedItems, unrecyclableItems } = this.buckets;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, permanentlyDeleteOverridden ? (renderPermanentlyDeleteAllOverride()) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, showSelectedItemsCount && !isAllSameDeleteMode && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "selected-items" }, `${i18n.summary.selectedItems} ${items.length - (isPermanentlyDeleteBucketDisabled ? unrecyclableItems.length : 0)}`)), unrecyclableItems.length > 0 && renderUnrecyclableBucket(), unprotectedItems.length > 0 && renderUnprotectedBucket(), protectedItems.length > 0 && renderProtectedBucket(), renderMoreOptions()))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisDeleteItemsRecycleEnabled.style = arcgisDeleteItemsRecycleEnabledCss;



//# sourceMappingURL=arcgis-delete-items-recycle-disabled_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getServiceUrlResponse),
/* harmony export */   g: () => (/* binding */ getRelatedItems),
/* harmony export */   i: () => (/* binding */ isHostedService),
/* harmony export */   r: () => (/* binding */ requestFetch)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



/** Work-around since using `request` directly will trigger unwanted toast on the Home App if the layer is unavailable */
const requestFetch = async (url, portal, options = {}) => {
    const { body, usePost, addTokenManually, api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.api, customToken } = options;
    const data = new URLSearchParams();
    if (body) {
        Object.entries(body).forEach(([key, value]) => {
            if (value !== undefined) {
                data.append(key, value);
            }
        });
    }
    const urlToSend = new URL(url);
    urlToSend.searchParams.append("f", "json");
    if (customToken) {
        urlToSend.searchParams.append("token", customToken);
    }
    else {
        const token = addTokenManually === false ? null : await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.h)(portal, api);
        if (token) {
            urlToSend.searchParams.append("token", token);
        }
    }
    const response = await fetch(urlToSend.toString(), {
        body: usePost ? data : undefined,
        method: usePost ? "POST" : "GET"
    });
    const result = await response.json();
    const error = result.error;
    if (error) {
        throw typeof error === "string" ? new Error(error) : error;
    }
    return result;
};

/**
 * Send a request to get data for `url`. This request will not include a token to avoid token leak
 */
const getServiceUrlResponse = async (url, portal) => {
    var _a;
    try {
        return { result: await requestFetch(url, portal, { addTokenManually: false }) };
    }
    catch (error) {
        const tokenRequiredMessage = "token required";
        if ((_a = error === null || error === void 0 ? void 0 : error.message) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(tokenRequiredMessage)) {
            return { error: { code: "tokenRequired" } };
        }
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function getRelatedItems(itemId, portal, { relationshipType, direction }) {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}/relatedItems`;
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { relationshipType, direction });
}

const isHostedService = (typeKeywords, type) => type === "Feature Service" && typeKeywords.includes("Hosted Service");



//# sourceMappingURL=service-8c2c4241.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTNkMDIxNS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM0SDtBQUNqRDtBQUNMO0FBQ3ZDO0FBQ0Q7QUFDSztBQUNMO0FBQ0Q7QUFDRjtBQUNPOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixtREFBaUM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtREFBbUQsYUFBYSxzQkFBc0Isc0NBQXNDOztBQUU1SDtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEI7QUFDQSxvQkFBb0IsbUJBQW1CO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixxREFBQyxDQUFDLGlEQUFRLFFBQVEscURBQUMscUVBQXFFLHFEQUFDO0FBQ3JIO0FBQ0E7QUFDQSw0QkFBNEIscURBQUM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLHFEQUFDLENBQUMsaURBQUk7QUFDckI7QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEM7QUFDQTs7QUFFQSxrREFBa0QsYUFBYSxzQkFBc0Isc0NBQXNDLGdCQUFnQixtQkFBbUIscUNBQXFDLFNBQVMsZ0JBQWdCLGlCQUFpQixnQkFBZ0Isa0JBQWtCLGtCQUFrQiwwQkFBMEIseUJBQXlCLGFBQWEsc0JBQXNCLHVCQUF1QixzQkFBc0IsZ0JBQWdCLG1CQUFtQixVQUFVLGFBQWEsc0JBQXNCLHVCQUF1QixtQkFBbUIseUNBQXlDLGdCQUFnQjs7QUFFdmxCO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QiwwREFBMEQscURBQVc7QUFDckU7QUFDQSxvQkFBb0IsaURBQWlEO0FBQ3JFLG9CQUFvQixz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MENBQTBDLHlCQUF5QjtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixTQUFTO0FBQzlCO0FBQ0E7QUFDQSxpQkFBaUIsU0FBUztBQUMxQjtBQUNBO0FBQ0EsaURBQWlELDZCQUE2QjtBQUM5RSxtQkFBbUIsc0RBQWMsU0FBUyxnQkFBZ0IsT0FBTztBQUNqRSxpQkFBaUIsc0RBQU8sUUFBUSw2QkFBNkI7QUFDN0Q7O0FBRUE7O0FBRXFHOztBQUVyRyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1kZWxldGUtaXRlbXMtcmVjeWNsZS1kaXNhYmxlZF8yLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3NlcnZpY2UtOGMyYzQyNDEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIEYgYXMgRnJhZ21lbnQsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBjIGFzIGNyZWF0ZUV2ZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IEQgYXMgREFZU19JTl9SRUNZQ0xFX0JJTiB9IGZyb20gJy4vZGVsZXRlLWl0ZW1zLTMyZDI0NTM0LmpzJztcbmltcG9ydCAnLi9zZXJ2aWNlLThjMmM0MjQxLmpzJztcbmltcG9ydCAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuXG5jb25zdCBTVE9SRV9MT09LVVAgPSBuZXcgTWFwKCk7XG5mdW5jdGlvbiBnZXREZWxldGVJdGVtc1N0b3JlKGVsKSB7XG4gICAgZnVuY3Rpb24gZ2V0U3RvcmUoZWwsIHRhZykge1xuICAgICAgICBjb25zdCBleGlzdGluZ1N0b3JlID0gU1RPUkVfTE9PS1VQLmdldChlbCk7XG4gICAgICAgIGlmIChleGlzdGluZ1N0b3JlKSB7XG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdTdG9yZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlbGVtZW50ID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCB0YWcpO1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgU1RPUkVfTE9PS1VQLnNldChlbCwgZWxlbWVudC5zdG9yZSk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zdG9yZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGdldFN0b3JlKGVsLCBcImFyY2dpcy1kZWxldGUtaXRlbXNcIik7XG59XG5cbmNvbnN0IGFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZURpc2FibGVkQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMSl9XCI7XG5cbmNvbnN0IEFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZURpc2FibGVkID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5yZW5kZXJSZWN5Y2xlID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB1bnByb3RlY3RlZEl0ZW1zIH0gPSB0aGlzLmJ1Y2tldHM7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMubW9kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJQUk9URUNURURcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiUFJPVEVDVEVEX1VOUFJPVEVDVEVEXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcInNwYW5cIiwgbnVsbCwgdGhpcy5pMThuLmNhbnREZWxldGUpLCB1bnByb3RlY3RlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgaChcInNwYW5cIiwgbnVsbCwgdGhpcy5pMThuLnByb2NlZWQpKSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcIlVOUFJPVEVDVEVEXCI6XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwic3BhblwiLCBudWxsLCB0aGlzLmkxOG4uYXJlWW91U3VyZVt0aGlzLmJ1Y2tldHMudW5wcm90ZWN0ZWRJdGVtcy5sZW5ndGggPiAxID8gXCJtdWx0aXBsZVwiIDogXCJzaW5nbGVcIl0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5idWNrZXRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1vZGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0RGVsZXRlSXRlbXNTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiBoKEhvc3QsIG51bGwsIHRoaXMucmVuZGVyUmVjeWNsZSgpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZURpc2FibGVkLnN0eWxlID0gYXJjZ2lzRGVsZXRlSXRlbXNSZWN5Y2xlRGlzYWJsZWRDc3M7XG5cbmNvbnN0IGFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZUVuYWJsZWRDc3MgPSBcIjpob3N0e2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Zm9udC1zaXplOnZhcigtLWNhbGNpdGUtZm9udC1zaXplLS0xKX0uc2VsZWN0ZWQtaXRlbXN7bWFyZ2luLWJvdHRvbToycmVtO2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0wKX0uZGl2aWRlcnttYXJnaW4tbGVmdDowcHg7bWFyZ2luLXJpZ2h0OjBweDttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbTowcHg7Ym9yZGVyLXN0eWxlOm5vbmU7Ym9yZGVyLXRvcDoxcHggc29saWQgI2NjY30ubW9yZS1vcHRpb25zX19jb250YWluZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpmbGV4LXN0YXJ0fS5tb3JlLW9wdGlvbnNfX2J1dHRvbnttYXJnaW4tdG9wOjJyZW07bWFyZ2luLWJvdHRvbToxcmVtfS5vdmVycmlkZXtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5vdmVycmlkZV9fZGVzY3JpcHRpb257bWFyZ2luLWJvdHRvbToxcmVtfWFyY2dpcy1pdGVtcy1zdW1tYXJ5Om5vdCg6Zmlyc3Qtb2YtdHlwZSl7bWFyZ2luLXRvcDoycmVtfVwiO1xuXG5jb25zdCBBcmNnaXNEZWxldGVJdGVtc1JlY3ljbGVFbmFibGVkID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNEZWxldGVJdGVtc1Blcm1hbmVudGx5RGVsZXRlT3ZlcnJpZGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0RlbGV0ZUl0ZW1zUGVybWFuZW50bHlEZWxldGVPdmVycmlkZVwiLCA3KTtcbiAgICAgICAgdGhpcy5yZW5kZXJVbnJlY3ljbGFibGVCdWNrZXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4sIGl0ZW1zLCBpc1Blcm1hbmVudGx5RGVsZXRlQnVja2V0RGlzYWJsZWQgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHByb3RlY3RlZEl0ZW1zLCB1bnByb3RlY3RlZEl0ZW1zLCB1bnJlY3ljbGFibGVJdGVtcyB9ID0gdGhpcy5idWNrZXRzO1xuICAgICAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnlcIiwgeyBpY29uOiBcInRyYXNoXCIsIGRpc2FibGVkOiBpc1Blcm1hbmVudGx5RGVsZXRlQnVja2V0RGlzYWJsZWQgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBoKFwic3BhblwiLCBudWxsLCBpMThuLnN1bW1hcnkucGVybWFuZW50bHlEZWxldGUpLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnktYnVja2V0XCIsIHsgcG9wb3ZlcklkOiBcInVucmVjeWNsYWJsZS1idWNrZXRcIiwgc3VtbWFyeUdyb3VwczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogdW5yZWN5Y2xhYmxlSXRlbXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkaW5nOiBpMThuLnN1bW1hcnkucGVybWFuZW50RGVsZXRlLmdyb3VwLm5vdFN1cHBvcnRlZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImRlc2NyaXB0aW9uXCIgfSwgaTE4bi5zdW1tYXJ5LnBlcm1hbmVudERlbGV0ZS5ub3RTdXBwb3J0ZWRbaXRlbXMubGVuZ3RoID09PSAxID8gXCJzaW5nbGVcIiA6IFwibXVsdGlwbGVcIl0pLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJsaW5rXCIgfSwgaChcImNhbGNpdGUtbGlua1wiLCB7IFwiaWNvbi1lbmRcIjogXCJsYXVuY2hcIiwgaHJlZjogLyogVE9ETzogXCIke3Vuc3VwcG9ydGVkSXRlbXNIZWxwTGlua31cIiovIFwiXCIsIHRhcmdldDogXCJfYmxhbmtcIiB9LCBpMThuLmxlYXJuTW9yZSkpLCAhKHVucHJvdGVjdGVkSXRlbXMubGVuZ3RoID09PSAwICYmIHByb3RlY3RlZEl0ZW1zLmxlbmd0aCA9PT0gMCkgJiYgKGgoXCJkaXZcIiwgeyBzbG90OiBcImFjdGlvbnNcIiwgY2xhc3M6IFwiZW5hYmxlZFwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNjYWxlOiBcInNcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1Blcm1hbmVudGx5RGVsZXRlQnVja2V0RGlzYWJsZWQgPSAhaXNQZXJtYW5lbnRseURlbGV0ZUJ1Y2tldERpc2FibGVkO1xuICAgICAgICAgICAgICAgIH0gfSwgaXNQZXJtYW5lbnRseURlbGV0ZUJ1Y2tldERpc2FibGVkID8gaTE4bi5zdW1tYXJ5LnNlbGVjdCA6IGkxOG4uc3VtbWFyeS5kZXNlbGVjdCkpKSksICh1bnByb3RlY3RlZEl0ZW1zLmxlbmd0aCA+IDAgfHwgcHJvdGVjdGVkSXRlbXMubGVuZ3RoID4gMCkgJiYgaChcImhyXCIsIHsgY2xhc3M6IFwiZGl2aWRlclwiIH0pKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyVW5wcm90ZWN0ZWRCdWNrZXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4sIGl0ZW1zIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyB1bnByb3RlY3RlZEl0ZW1zIH0gPSB0aGlzLmJ1Y2tldHM7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbXMtc3VtbWFyeVwiLCB7IGljb246IFwicmVjeWNsZS1iaW5cIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIGgoXCJzcGFuXCIsIG51bGwsIGkxOG4uc3VtbWFyeS53aWxsQmVSZWN5Y2xlZCksIGgoXCJhcmNnaXMtaXRlbXMtc3VtbWFyeS1idWNrZXRcIiwgeyBwb3BvdmVySWQ6IFwidW5wcm90ZWN0ZWQtYnVja2V0XCIsIHN1bW1hcnlHcm91cHM6IFt7IGl0ZW1zOiB1bnByb3RlY3RlZEl0ZW1zIH1dIH0pKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiZGVzY3JpcHRpb25cIiB9LCBpMThuLnN1bW1hcnkuY2FuQmVSZWNvdmVyZWRbaXRlbXMubGVuZ3RoID09PSAxID8gXCJzaW5nbGVcIiA6IFwibXVsdGlwbGVcIl0ucmVwbGFjZShcIiR7ZGF5c31cIiwgYCR7REFZU19JTl9SRUNZQ0xFX0JJTn1gKSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW5kZXJQcm90ZWN0ZWRCdWNrZXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHByb3RlY3RlZEl0ZW1zIH0gPSB0aGlzLmJ1Y2tldHM7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbXMtc3VtbWFyeVwiLCB7IGljb246IFwic2VjdXJpdHlcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIGgoXCJzcGFuXCIsIG51bGwsIGkxOG4uc3VtbWFyeS5jYW5ub3RCZURlbGV0ZWQpLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnktYnVja2V0XCIsIHsgcG9wb3ZlcklkOiBcInByb3RlY3RlZC1idWNrZXRcIiwgc3VtbWFyeUdyb3VwczogW1xuICAgICAgICAgICAgICAgICAgICB7IGl0ZW1zOiBwcm90ZWN0ZWRJdGVtcywgaGVhZGluZzogaTE4bi5zdW1tYXJ5LnByb3RlY3RlZEdyb3VwLmRlbGV0ZVByb3RlY3RlZCB9XG4gICAgICAgICAgICAgICAgXSB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImRlc2NyaXB0aW9uXCIgfSwgaTE4bi5zdW1tYXJ5LmNhbm5vdERlbGV0ZS5hbGwpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyUGVybWFuZW50bHlEZWxldGVBbGxPdmVycmlkZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaTE4biB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgdW5wcm90ZWN0ZWRJdGVtcywgdW5yZWN5Y2xhYmxlSXRlbXMgfSA9IHRoaXMuYnVja2V0cztcbiAgICAgICAgICAgIGNvbnN0IGRlbGV0ZU92ZXJyaWRkZW5CdWNrZXQgPSBbLi4udW5wcm90ZWN0ZWRJdGVtcywgLi4udW5yZWN5Y2xhYmxlSXRlbXNdO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwib3ZlcnJpZGVcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcIm92ZXJyaWRlX19kZXNjcmlwdGlvblwiIH0sIGkxOG4uZGVsZXRlT3ZlcnJpZGVbZGVsZXRlT3ZlcnJpZGRlbkJ1Y2tldC5sZW5ndGggPiAwID8gXCJtdWx0aXBsZVwiIDogXCJzaW5nbGVcIl0pLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnlcIiwgeyBpY29uOiBcInRyYXNoXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBoKFwic3BhblwiLCBudWxsLCBpMThuLnN1bW1hcnkucGVybWFuZW50bHlEZWxldGUpLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnktYnVja2V0XCIsIHsgbGFiZWw6IGkxOG4uc3VtbWFyeS5wZXJtYW5lbnRseURlbGV0ZSwgcG9wb3ZlcklkOiBcInBlcm1hbmVudGx5LWRlbGV0ZS1vdmVycmlkZS1idWNrZXRcIiwgc3VtbWFyeUdyb3VwczogW3sgaXRlbXM6IGRlbGV0ZU92ZXJyaWRkZW5CdWNrZXQgfV0gfSkpKSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlck1vcmVPcHRpb25zID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpMThuLCBpc01vcmVPcHRpb25zRXhwYW5kZWQsIGlzQWxsU2FtZURlbGV0ZU1vZGUsIGJ1Y2tldHMsIGl0ZW1zLCBtb2RlLCBwcmltYXJ5QWN0aW9uLCBhcmNnaXNEZWxldGVJdGVtc1Blcm1hbmVudGx5RGVsZXRlT3ZlcnJpZGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHVucHJvdGVjdGVkSXRlbXMsIHVucmVjeWNsYWJsZUl0ZW1zIH0gPSBidWNrZXRzO1xuICAgICAgICAgICAgaWYgKG1vZGUgPT09IFwiUFJPVEVDVEVEXCIgfHwgcHJpbWFyeUFjdGlvbiA9PT0gXCJQRVJNQU5FTlRMWV9ERUxFVEVcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibW9yZS1vcHRpb25zX19jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJtb3JlLW9wdGlvbnNfX2J1dHRvblwiLCBzY2FsZTogXCJzXCIsIGljb25FbmQ6IGlzTW9yZU9wdGlvbnNFeHBhbmRlZCA/IFwibWludXNcIiA6IFwicGx1c1wiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc01vcmVPcHRpb25zRXhwYW5kZWQgPSAhaXNNb3JlT3B0aW9uc0V4cGFuZGVkO1xuICAgICAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFtcIkVudGVyXCIsIFwiIFwiXS5pbmNsdWRlcyhlLmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNNb3JlT3B0aW9uc0V4cGFuZGVkID0gIWlzTW9yZU9wdGlvbnNFeHBhbmRlZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gfSwgaXNNb3JlT3B0aW9uc0V4cGFuZGVkID8gaTE4bi5oaWRlT3B0aW9ucyA6IGkxOG4ubW9yZU9wdGlvbnMpLCBpc01vcmVPcHRpb25zRXhwYW5kZWQgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGtpbmQ6IFwiZGFuZ2VyXCIsIHNjYWxlOiBcInNcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uU3RhcnQ6IFwidHJhc2hcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcm1hbmVudGx5RGVsZXRlT3ZlcnJpZGRlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGFyY2dpc0RlbGV0ZUl0ZW1zUGVybWFuZW50bHlEZWxldGVPdmVycmlkZS5lbWl0KCk7XG4gICAgICAgICAgICAgICAgfSB9LCBpc0FsbFNhbWVEZWxldGVNb2RlXG4gICAgICAgICAgICAgICAgPyBpMThuLmRlbGV0ZVBlcm1hbmVudGx5XG4gICAgICAgICAgICAgICAgOiBpMThuLnN1bW1hcnkuZGVsZXRlWFBlcm1hbmVudGx5XG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiJHtzdWJzZXR9XCIsIGAke3VucHJvdGVjdGVkSXRlbXMubGVuZ3RoICsgdW5yZWN5Y2xhYmxlSXRlbXMubGVuZ3RofWApXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiJHt0b3RhbH1cIiwgYCR7aXRlbXMubGVuZ3RofWApKSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5idWNrZXRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1vZGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHJpbWFyeUFjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pdGVtcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wZXJtYW5lbnRseURlbGV0ZU92ZXJyaWRkZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd1NlbGVjdGVkSXRlbXNDb3VudCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNQZXJtYW5lbnRseURlbGV0ZUJ1Y2tldERpc2FibGVkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzTW9yZU9wdGlvbnNFeHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXREZWxldGVJdGVtc1N0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG47XG4gICAgICAgIGNvbnN0IHNpbmdsZURlbGV0ZU1vZGVzID0gW1wiUFJPVEVDVEVEXCIsIFwiVU5QUk9URUNURURcIiwgXCJVTlJFQ1lDTEFCTEVcIl07XG4gICAgICAgIHRoaXMuaXNBbGxTYW1lRGVsZXRlTW9kZSA9IHNpbmdsZURlbGV0ZU1vZGVzLmluY2x1ZGVzKHRoaXMubW9kZSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBpdGVtcywgaXNQZXJtYW5lbnRseURlbGV0ZUJ1Y2tldERpc2FibGVkLCBwZXJtYW5lbnRseURlbGV0ZU92ZXJyaWRkZW4sIGlzQWxsU2FtZURlbGV0ZU1vZGUsIHNob3dTZWxlY3RlZEl0ZW1zQ291bnQsIHJlbmRlclBlcm1hbmVudGx5RGVsZXRlQWxsT3ZlcnJpZGUsIHJlbmRlclVucmVjeWNsYWJsZUJ1Y2tldCwgcmVuZGVyVW5wcm90ZWN0ZWRCdWNrZXQsIHJlbmRlclByb3RlY3RlZEJ1Y2tldCwgcmVuZGVyTW9yZU9wdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgcHJvdGVjdGVkSXRlbXMsIHVucHJvdGVjdGVkSXRlbXMsIHVucmVjeWNsYWJsZUl0ZW1zIH0gPSB0aGlzLmJ1Y2tldHM7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBwZXJtYW5lbnRseURlbGV0ZU92ZXJyaWRkZW4gPyAocmVuZGVyUGVybWFuZW50bHlEZWxldGVBbGxPdmVycmlkZSgpKSA6IChoKEZyYWdtZW50LCBudWxsLCBzaG93U2VsZWN0ZWRJdGVtc0NvdW50ICYmICFpc0FsbFNhbWVEZWxldGVNb2RlICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiBcInNlbGVjdGVkLWl0ZW1zXCIgfSwgYCR7aTE4bi5zdW1tYXJ5LnNlbGVjdGVkSXRlbXN9ICR7aXRlbXMubGVuZ3RoIC0gKGlzUGVybWFuZW50bHlEZWxldGVCdWNrZXREaXNhYmxlZCA/IHVucmVjeWNsYWJsZUl0ZW1zLmxlbmd0aCA6IDApfWApKSwgdW5yZWN5Y2xhYmxlSXRlbXMubGVuZ3RoID4gMCAmJiByZW5kZXJVbnJlY3ljbGFibGVCdWNrZXQoKSwgdW5wcm90ZWN0ZWRJdGVtcy5sZW5ndGggPiAwICYmIHJlbmRlclVucHJvdGVjdGVkQnVja2V0KCksIHByb3RlY3RlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgcmVuZGVyUHJvdGVjdGVkQnVja2V0KCksIHJlbmRlck1vcmVPcHRpb25zKCkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzRGVsZXRlSXRlbXNSZWN5Y2xlRW5hYmxlZC5zdHlsZSA9IGFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZUVuYWJsZWRDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0RlbGV0ZUl0ZW1zUmVjeWNsZURpc2FibGVkIGFzIGFyY2dpc19kZWxldGVfaXRlbXNfcmVjeWNsZV9kaXNhYmxlZCwgQXJjZ2lzRGVsZXRlSXRlbXNSZWN5Y2xlRW5hYmxlZCBhcyBhcmNnaXNfZGVsZXRlX2l0ZW1zX3JlY3ljbGVfZW5hYmxlZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtZGVsZXRlLWl0ZW1zLXJlY3ljbGUtZGlzYWJsZWRfMi5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGggYXMgZ2V0UG9ydGFsVG9rZW4sIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5cbi8qKiBXb3JrLWFyb3VuZCBzaW5jZSB1c2luZyBgcmVxdWVzdGAgZGlyZWN0bHkgd2lsbCB0cmlnZ2VyIHVud2FudGVkIHRvYXN0IG9uIHRoZSBIb21lIEFwcCBpZiB0aGUgbGF5ZXIgaXMgdW5hdmFpbGFibGUgKi9cbmNvbnN0IHJlcXVlc3RGZXRjaCA9IGFzeW5jICh1cmwsIHBvcnRhbCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgY29uc3QgeyBib2R5LCB1c2VQb3N0LCBhZGRUb2tlbk1hbnVhbGx5LCBhcGkgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUuYXBpLCBjdXN0b21Ub2tlbiB9ID0gb3B0aW9ucztcbiAgICBjb25zdCBkYXRhID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xuICAgIGlmIChib2R5KSB7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGJvZHkpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHVybFRvU2VuZCA9IG5ldyBVUkwodXJsKTtcbiAgICB1cmxUb1NlbmQuc2VhcmNoUGFyYW1zLmFwcGVuZChcImZcIiwgXCJqc29uXCIpO1xuICAgIGlmIChjdXN0b21Ub2tlbikge1xuICAgICAgICB1cmxUb1NlbmQuc2VhcmNoUGFyYW1zLmFwcGVuZChcInRva2VuXCIsIGN1c3RvbVRva2VuKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gYWRkVG9rZW5NYW51YWxseSA9PT0gZmFsc2UgPyBudWxsIDogYXdhaXQgZ2V0UG9ydGFsVG9rZW4ocG9ydGFsLCBhcGkpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHVybFRvU2VuZC5zZWFyY2hQYXJhbXMuYXBwZW5kKFwidG9rZW5cIiwgdG9rZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsVG9TZW5kLnRvU3RyaW5nKCksIHtcbiAgICAgICAgYm9keTogdXNlUG9zdCA/IGRhdGEgOiB1bmRlZmluZWQsXG4gICAgICAgIG1ldGhvZDogdXNlUG9zdCA/IFwiUE9TVFwiIDogXCJHRVRcIlxuICAgIH0pO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBjb25zdCBlcnJvciA9IHJlc3VsdC5lcnJvcjtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgdHlwZW9mIGVycm9yID09PSBcInN0cmluZ1wiID8gbmV3IEVycm9yKGVycm9yKSA6IGVycm9yO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxuLyoqXG4gKiBTZW5kIGEgcmVxdWVzdCB0byBnZXQgZGF0YSBmb3IgYHVybGAuIFRoaXMgcmVxdWVzdCB3aWxsIG5vdCBpbmNsdWRlIGEgdG9rZW4gdG8gYXZvaWQgdG9rZW4gbGVha1xuICovXG5jb25zdCBnZXRTZXJ2aWNlVXJsUmVzcG9uc2UgPSBhc3luYyAodXJsLCBwb3J0YWwpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBhd2FpdCByZXF1ZXN0RmV0Y2godXJsLCBwb3J0YWwsIHsgYWRkVG9rZW5NYW51YWxseTogZmFsc2UgfSkgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IHRva2VuUmVxdWlyZWRNZXNzYWdlID0gXCJ0b2tlbiByZXF1aXJlZFwiO1xuICAgICAgICBpZiAoKF9hID0gZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRva2VuUmVxdWlyZWRNZXNzYWdlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ0b2tlblJlcXVpcmVkXCIgfSB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5hc3luYyBmdW5jdGlvbiBnZXRSZWxhdGVkSXRlbXMoaXRlbUlkLCBwb3J0YWwsIHsgcmVsYXRpb25zaGlwVHlwZSwgZGlyZWN0aW9uIH0pIHtcbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfWNvbnRlbnQvaXRlbXMvJHtpdGVtSWR9L3JlbGF0ZWRJdGVtc2A7XG4gICAgcmV0dXJuIGF3YWl0IHJlcXVlc3QodXJsLCB7IHJlbGF0aW9uc2hpcFR5cGUsIGRpcmVjdGlvbiB9KTtcbn1cblxuY29uc3QgaXNIb3N0ZWRTZXJ2aWNlID0gKHR5cGVLZXl3b3JkcywgdHlwZSkgPT4gdHlwZSA9PT0gXCJGZWF0dXJlIFNlcnZpY2VcIiAmJiB0eXBlS2V5d29yZHMuaW5jbHVkZXMoXCJIb3N0ZWQgU2VydmljZVwiKTtcblxuZXhwb3J0IHsgZ2V0U2VydmljZVVybFJlc3BvbnNlIGFzIGEsIGdldFJlbGF0ZWRJdGVtcyBhcyBnLCBpc0hvc3RlZFNlcnZpY2UgYXMgaSwgcmVxdWVzdEZldGNoIGFzIHIgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VydmljZS04YzJjNDI0MS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=