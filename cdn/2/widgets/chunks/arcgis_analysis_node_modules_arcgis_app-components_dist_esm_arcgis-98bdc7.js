"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-98bdc7"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-share.entry.js":
/*!********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-share.entry.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_share: () => (/* binding */ ArcgisItemShare)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./services-66aee31b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-66aee31b.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils-f4f44b88.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-f4f44b88.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */























const arcgisItemShareCss = ".stage{height:100%}.group-browser-modal{--calcite-modal-width:1080px;--calcite-modal-content-padding:0;--calcite-modal-height:min(800px, 80vh)}.hidden{display:none}.section:not(:last-child){margin-bottom:2rem}calcite-flow{height:100%}.content-container{margin-top:0.5rem}.active-but-not-selected{position:relative;z-index:2}.tile-select-wrapper{position:relative}.share-hint{display:flex;align-items:center;position:absolute;font-size:0.875rem;inset-inline-end:0.5rem;top:0.5rem;z-index:3}.share-hint>p{margin-bottom:0px;margin-inline-start:0.5rem;margin-top:2px}.information-text{font-weight:500;margin-top:0px;margin-bottom:0px;margin-top:0.5rem;font-size:0.875rem}.group-item-counter{font-size:0.875rem;margin-top:0px;margin-bottom:0px}.revert-single-group-cta:first-child,.group-item-counter:first-child{margin-inline-start:0.5rem}";

const ArcgisItemShare = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.initialShareLevels = [];
        this.initialSelectedGroupData = [];
        /**
         * Selected by all items, some items or no items
         *
         * Used to determine if we should show the revert button on each group card
         *  */
        this.initialSelectedGroupDataLookup = {};
        this.showOptions = false;
        this.shareLevelOptions = ["private", "org", "public"];
        this.possibleShareLevelOptions = [
            "private",
            "org",
            "public"
        ];
        this.shareLevelIcon = {
            private: "user",
            org: "organization",
            public: "globe"
        };
        this.isPublicUser = false;
        this.hasItemBlockedFromPublic = false;
        this.hasPrivateItem = false;
        this.shareMode = "default";
        this.hasIndoorsSpaces = false;
        this.sharingDetailToEmit = null;
        this.didUpdateSharingDetail = false;
        this.shareItemResult = null;
        this.handleNewShareResult = async () => {
            const { items, portal, shareItemResult: { newShareLevel, newGroupShared }, 
            // This should already have the latest update
            selectedGroupData } = this;
            // * Reset item to get ready for the review sharing state
            let newItems = [...items];
            if (newShareLevel != null) {
                newItems = items.map((item) => {
                    if (newShareLevel !== "private") {
                        return Object.assign(Object.assign({}, item), { access: newShareLevel });
                    }
                    // If the new level is private but the item is currently shared to a group,
                    //  we need to make sure it's marked as "shared" instead of "private"
                    const isItemCurrentlySharedToGroups = selectedGroupData === null || selectedGroupData === void 0 ? void 0 : selectedGroupData.some(({ selectedByItemIds }) => selectedByItemIds.includes(item.id));
                    return Object.assign(Object.assign({}, item), { access: isItemCurrentlySharedToGroups ? "shared" : "private" });
                });
            }
            // If we're not sharing to any group, we need to make sure every "shared" item is marked as "private"
            if (!(selectedGroupData === null || selectedGroupData === void 0 ? void 0 : selectedGroupData.length)) {
                newItems = newItems.map((item) => 
                // TODO: test that this even works in 4.x. Can you spread a portal item like this?
                item.access === "shared" ? Object.assign(Object.assign({}, item), { access: "private" }) : item);
            }
            // And vice versa if we're (fully) sharing to at least one new group
            if (newGroupShared.length) {
                newItems = newItems.map((item) => item.access === "private" ? Object.assign(Object.assign({}, item), { access: "shared" }) : item);
            }
            this.items = newItems;
            // * Analyze and decide whether we should show the dep check dialog
            const analyzeResults = await Promise.all(newItems.map((item) => (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__.a)(item, portal)));
            const newShareDetail = analyzeResults.reduce((acc, { result }) => {
                if (result) {
                    Object.keys(result).forEach((key) => {
                        acc[key] = [...acc[key], ...result[key]];
                    });
                }
                return acc;
            }, Object.assign({}, _utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.D));
            this.sharingDetail = newShareDetail;
            // The watch for `hasSharingIssue` will be automatically triggered next
        };
        // * Other utils and renders
        this.updateSharing = async () => {
            var _a;
            this.loadingText = this.i18n.updatingInfo;
            this.isLoading = true;
            const { items, selectedShareLevels, initialSelectedGroupData, selectedGroupData, portal, user, isShareLevelDirty, checkItemPDCIssue, confirmedPDC } = this;
            const { shareGroupIds, unshareGroupIds } = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.g)(initialSelectedGroupData, selectedGroupData);
            if (!confirmedPDC && !(await checkItemPDCIssue())) {
                return;
            }
            // ! This assume that all items have the same share level once the user choose something
            const newShareLevel = isShareLevelDirty || items.length === 1 ? selectedShareLevels[0] : null;
            // Need to unshare first in case the user is public
            // (public user can only share to group if the share level is public)
            const unsharePromise = unshareGroupIds.length
                ? (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__.u)(items.map((item) => item.id), unshareGroupIds, { portal, user })
                : undefined;
            const sharePromise = shareGroupIds.length || isShareLevelDirty
                ? (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__.b)(items, newShareLevel, shareGroupIds, { portal, user })
                : undefined;
            const [shareResult] = await Promise.all([sharePromise, unsharePromise]);
            // ! We don't set loading to false in case the consumers want to keep loading
            // They can remove the modal completely
            // * ---
            const shareItemResult = {
                // TODO: hair splitting this since different items can lead to different results
                newGroupShared: shareGroupIds.filter((id) => !(shareResult === null || shareResult === void 0 ? void 0 : shareResult.result.some(({ notSharedWith }) => notSharedWith.includes(id)))),
                newGroupUnshared: unshareGroupIds,
                newShareLevel,
                shareErrors: (_a = shareResult === null || shareResult === void 0 ? void 0 : shareResult.result.filter(({ error }) => error).map(({ itemId }) => {
                    return { item: items.find((curItem) => curItem.id === itemId), code: "notSharedWith" };
                })) !== null && _a !== void 0 ? _a : []
            };
            this.shareItemResult = shareItemResult;
            this.handleNewShareResult();
        };
        this.checkItemPDCIssue = async () => {
            const { items, portal, isShareLevelDirty, selectedShareLevels } = this;
            const hostedItems = items.filter((item) => (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_6__.i)(item.typeKeywords, item.type));
            // ! If the share level is dirty, this means the share level is selected to something else
            //  meaning all the share level is converged to the same level since that's the only use case
            const publicOptionSelected = isShareLevelDirty && selectedShareLevels[0] === "public";
            /**
             * if we have hosted services and we're sharing publicly, check for editable layers and warn user
             * WebGIS/arcgis-portal-app#27002, WebGIS/arcgis-portal-app#26285
             */
            if (hostedItems.length > 0 && publicOptionSelected) {
                this.isLoading = true;
                const editableCheck = await Promise.all(hostedItems.map((item) => (0,_item_c58ffced_js__WEBPACK_IMPORTED_MODULE_7__.i)(item, portal)));
                this.isLoading = false;
                const editableItems = hostedItems.filter((_, index) => editableCheck[index]);
                if (editableItems.length) {
                    const publicDataCollectionDisabled = !editableItems.every((item) => item.typeKeywords.includes("Public Data Collection"));
                    this.confirmationDialogType = publicDataCollectionDisabled
                        ? "publicDataCollectionDisabled"
                        : "publicDataCollectionEnabled";
                    return false;
                }
            }
            return true;
        };
        this.handleNewPendingSelectedGroups = (newGroups) => {
            const { items, pendingGroupBrowserData, selectedGroupData } = this;
            const curSelectedGroupLookup = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.a)(pendingGroupBrowserData.groupData, (groupData) => ({
                key: groupData.group.id,
                data: groupData
            }));
            const allItemIds = items.map((item) => item.id);
            const newSelectedGroupData = newGroups.map((group) => {
                // If the group was previously selected, use the previous data
                //  else set selectedByItemIds to all items' ids
                const prevGroupData = curSelectedGroupLookup[group.id];
                if (prevGroupData) {
                    return prevGroupData;
                }
                return { group, selectedByItemIds: allItemIds };
            });
            this.pendingGroupBrowserData = {
                groupData: newSelectedGroupData,
                groupDataLookup: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.a)(newSelectedGroupData, (groupData) => ({
                    key: groupData.group.id,
                    data: true
                })),
                groupCount: newSelectedGroupData.reduce((acc, cur) => {
                    acc[cur.group.id] = cur.selectedByItemIds.length;
                    return acc;
                }, {}),
                isDirty: (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.i)(newSelectedGroupData, selectedGroupData)
            };
        };
        this.revertShareLevel = () => {
            this.selectedShareLevels = [...this.initialShareLevels];
        };
        this.setShareLevel = (newShareLevel) => {
            this.selectedShareLevels = this.selectedShareLevels.map(() => newShareLevel);
        };
        this.revertGroupData = () => {
            this.selectedGroupData = [...this.initialSelectedGroupData];
        };
        this.revertPendingGroupData = (groupId) => {
            const { initialSelectedGroupData, pendingGroupBrowserData, handleNewPendingSelectedGroups } = this;
            const initialGroupData = initialSelectedGroupData.find(({ group }) => group.id === groupId);
            const curGroupData = pendingGroupBrowserData.groupData;
            const curSelectedGroupData = curGroupData.find(({ group }) => group.id === groupId);
            let newGroupData = [];
            if (!initialGroupData) {
                // This means initially we don't have this group
                newGroupData = curGroupData.filter(({ group }) => group.id !== groupId);
            }
            else if (!curSelectedGroupData) {
                // This means we removed the group
                newGroupData = [...curGroupData, initialGroupData];
            }
            else {
                newGroupData = curGroupData.map((groupData) => {
                    if (groupData.group.id !== groupId) {
                        return groupData;
                    }
                    return initialGroupData;
                });
            }
            handleNewPendingSelectedGroups(newGroupData.map(({ group }) => group));
        };
        this.applyPendingGroupData = () => {
            this.selectedGroupData = [...this.pendingGroupBrowserData.groupData];
            this.unBrowseGroups();
        };
        this.closeDialog = (event) => {
            var _a, _b;
            // Stop the close event from arcgis-dependency-check from propagating
            event === null || event === void 0 ? void 0 : event.stopPropagation();
            const { workflowCancel, currentStep } = this;
            if (currentStep !== "finish") {
                workflowCancel.emit({
                    newShareLevel: (_b = (_a = this.shareItemResult) === null || _a === void 0 ? void 0 : _a.newShareLevel) !== null && _b !== void 0 ? _b : null,
                    cancelAtStep: currentStep
                });
            }
        };
        this.unBrowseGroups = () => {
            this.isBrowsingGroups = false;
        };
        this.renderGroupBrowser = () => {
            const { api, i18n, user, portal, config, pendingGroupBrowserData, browserPagination, browserGroups, handleNewPendingSelectedGroups, isBrowsingGroups, isPublicUser, items, shareMode, groupBrowserQ, initialSelectedGroupDataLookup, revertPendingGroupData, hasIndoorsSpaces, groupBrowserAllUsers, groupBrowserSearchUsername, hasPrivateItem } = this;
            const totalItemCount = items.length;
            const showFilterByUsers = shareMode === "admin" && !hasPrivateItem && groupBrowserAllUsers.length > 1;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser", { view: "compact", class: { hidden: !isBrowsingGroups }, config: config, user: user, api: api, portal: portal, selection: "multiple", searchUser: groupBrowserSearchUsername, selectedGroups: pendingGroupBrowserData.groupData.map((data) => data.group), hasIndoorsSpaces: hasIndoorsSpaces, q: groupBrowserQ, onArcgisGroupBrowserUpdate: (e) => {
                    const { results, num, start, total } = e.detail;
                    // TODO: remove this assert
                    this.browserGroups = results;
                    this.browserPagination = { start, num, total };
                }, onArcgisGroupBrowserLoading: () => {
                    this.browserGroups = [];
                }, onArcgisGroupBrowserSelect: (e) => handleNewPendingSelectedGroups(e.detail) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-top-bar", { slot: "top-bar", "filter-toggle": true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-search", { slot: "search", term: "" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-sort", { slot: "sort" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filters", { slot: "filters" }, showFilterByUsers && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-groups-by-user", { searchUsernames: groupBrowserAllUsers.map((user) => user.username), searchUsername: groupBrowserSearchUsername, onArcgisGroupBrowserUsernamesFilter: (event) => {
                    this.groupBrowserSearchUsername = event.detail;
                } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-owner", { searchUsername: groupBrowserSearchUsername }), !isPublicUser && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-membership", null), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-member-org", null), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-special-groups", null))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-date", { property: "modified" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-filter-date", { property: "created" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-content", { slot: "content", class: "js-content" }, (browserGroups || []).map((group) => {
                const groupId = group.id;
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-group-card", { key: groupId, user: user, portal: portal, i18n: i18n, group: group, groupCount: pendingGroupBrowserData.groupCount, initialSelectedGroupDataLookup: initialSelectedGroupDataLookup, selectedGroupDataLookup: pendingGroupBrowserData.groupDataLookup, totalItemCount: totalItemCount, onRevertClick: () => {
                        // By opening the group browser, the public user already have
                        //  to switch the share to PUBLIC already so there is no need
                        //  to spin up the confirmation modal
                        revertPendingGroupData(groupId);
                    } }));
            })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-pagination", { slot: "pagination", class: "js-pagination", total: browserPagination === null || browserPagination === void 0 ? void 0 : browserPagination.total, start: browserPagination === null || browserPagination === void 0 ? void 0 : browserPagination.start, num: browserPagination === null || browserPagination === void 0 ? void 0 : browserPagination.num })));
        };
        this.renderShareSelectGroup = () => {
            const { config, hasItemBlockedFromPublic, hasSingleShareLevel, i18n, initialSelectedGroupData, isBrowsingGroups, isLoading, isPublicUser, isShareLevelDirty, items, loadingText, portal, possibleShareLevelOptions, revertGroupData, revertShareLevel, selectedGroupData, selectedShareLevels, setShareLevel, shareLevelCount, shareLevelIcon, shareLevelOptions, shareMode, showOptions, user, hasPrivateItem } = this;
            const totalItemCount = items.length;
            const totalItemCountStr = totalItemCount.toString();
            const disabledText = hasItemBlockedFromPublic
                ? i18n.sharingLimitedItemDisclaimer
                : i18n.cannotShareToLevelDisclaimer;
            return (
            // ! Hidden instead of unmount to prevent data refetch
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { hidden: isBrowsingGroups } }, isLoading && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: loadingText }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.shareLevel.title, headerSideContent: isShareLevelDirty && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", iconStart: "reset", disabled: isLoading, onClick: () => {
                        // if a public user tries to revert item levels
                        // and the initial share level includes at least one private item
                        // and those items have also been shared to groups
                        // display a warning modal
                        if ((0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.c)(user, items, selectedGroupData)) {
                            this.confirmationDialogType = "publicAccountRevertShareLevel";
                            return;
                        }
                        revertShareLevel();
                    } }, i18n.revert)) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, showOptions &&
                _utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.d.map((option) => {
                    const cannotSelect = !possibleShareLevelOptions.includes(option);
                    if (cannotSelect && isPublicUser) {
                        // We only want to hide the option for public user
                        //  in other cases, we just want to disable them
                        return null;
                    }
                    const itemCount = shareLevelCount[option] + (option === "private" ? shareLevelCount.shared : 0);
                    const hasItemInCategory = itemCount > 0;
                    const itemCountStr = itemCount.toString();
                    const title = i18n.shareLevel.level[option].title;
                    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "tile-select-wrapper", key: option }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: hasSingleShareLevel && hasItemInCategory, heading: title, "aria-label": cannotSelect ? disabledText : undefined, description: i18n.shareLevel.level[option][
                        // public users have a different text description for the "everyone" share level (WebGIS/arcgis-portal-app#26405)
                        isPublicUser && option === "public"
                            ? "descriptionPublicUser"
                            : "description"], name: "dev-cred-create-mode", inputEnabled: true, width: "full", type: "radio", value: option, icon: shareLevelIcon[option], disabled: isLoading || cannotSelect, class: {
                            "active-but-not-selected": hasItemInCategory && !hasSingleShareLevel
                        }, onCalciteTileSelectChange: (e) => {
                            const newShareLevel = e.target.value;
                            // if a public user tries to set item(s) to private
                            // and the items are shared to groups
                            // display a warning modal
                            if (
                            // Portal doesn't have the concept of public account https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/46911
                            !portal.isPortal &&
                                (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.e)(user, newShareLevel, selectedGroupData)) {
                                this.confirmationDialogType = "publicAccountSetShareToPrivate";
                                return;
                            }
                            setShareLevel(newShareLevel);
                        } }), !hasSingleShareLevel && hasItemInCategory && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "share-hint" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: i18n.shareCountLabel, paddedContent: true, placement: "bottom-end", overlayPositioning: "fixed" }, i18n.shareCountTooltip
                        .replace("${shareLevel}", title)
                        .replace("${numItem}", itemCountStr)
                        .replace("${totalItem}", totalItemCountStr)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", null, i18n.shareCountHint
                        .replace("${numItem}", itemCountStr)
                        .replace("${totalItem}", totalItemCountStr))))));
                })), showOptions && possibleShareLevelOptions.length < shareLevelOptions.length && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text" }, i18n.sharingLimitedDisclaimer)), (!showOptions || !possibleShareLevelOptions.length) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text" }, i18n.noShareDisclaimer)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-group", { items: items, user: user, portal: portal, config: config, shareMode: shareMode, i18n: i18n.shareGroup, isLoading: isLoading, onEditGroupClick: () => {
                    // Public account needs to share item to public before sharing to groups
                    if ((0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.s)(user, selectedShareLevels)) {
                        this.confirmationDialogType = "publicAccountOpenGroupBrowser";
                        return;
                    }
                    this.isBrowsingGroups = true;
                }, onAnalyzeUserGroupComplete: (e) => {
                    const { initialSelectedGroups: selectedGroupData, userGroupLookup, allUsers, searchUsername } = e.detail;
                    this.initialSelectedGroupData = selectedGroupData;
                    this.selectedGroupData = selectedGroupData;
                    this.initialSelectedGroupDataLookup = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.a)(selectedGroupData, ({ group, selectedByItemIds }) => ({
                        key: group.id,
                        data: selectedByItemIds.length === 0
                            ? "none"
                            : selectedByItemIds.length === totalItemCount
                                ? "all"
                                : "indeterminate"
                    }));
                    this.groupBrowserSearchUsername = searchUsername;
                    this.groupBrowserAllUsers = allUsers;
                    this.groupBrowserQ = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.a)({
                        shareMode,
                        currentUsername: searchUsername,
                        user,
                        userGroupLookup,
                        isPrivate: hasPrivateItem
                    });
                }, onDirtyChange: (e) => (this.isSelectedGroupsDirty = e.detail), onRemoveClick: () => (this.selectedGroupData = []), onRevertClick: () => {
                    if ((0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.b)(user, selectedShareLevels, initialSelectedGroupData)) {
                        this.confirmationDialogType = "publicAccountRevertGroup";
                        return;
                    }
                    revertGroupData();
                }, selectedGroupData: selectedGroupData }))));
        };
        this.renderShareModal = () => {
            const { closeDialog, i18n, isLoading, updateSharing, isShareLevelDirty, isSelectedGroupsDirty, isBrowsingGroups, applyPendingGroupData, unBrowseGroups, renderShareSelectGroup, renderGroupBrowser, currentStep, hasSharingIssue, pendingGroupBrowserData } = this;
            const hasChanges = isShareLevelDirty || isSelectedGroupsDirty;
            return ((currentStep === "share" || hasSharingIssue === null) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { onCalciteModalClose: closeDialog,
                // ! Don't use the condition directly here or the `onCalciteModalClose` will be triggered
                open: true, widthScale: isBrowsingGroups ? "m" : "s", outsideCloseDisabled: true, escapeDisabled: true, class: { "group-browser-modal": isBrowsingGroups } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header" }, i18n[isBrowsingGroups ? "titleGroup" : "title"]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "stage" }, renderGroupBrowser(), renderShareSelectGroup()), !isBrowsingGroups ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "outline", kind: "brand", "data-id": "cancelButton", onClick: () => closeDialog(), width: "full" }, i18n.cancel), hasChanges && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "solid", kind: "brand", "data-id": "nextButton", onClick: updateSharing, width: "full", disabled: isLoading }, i18n.save)))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "outline", kind: "brand", "data-id": "cancelButton", onClick: unBrowseGroups, width: "full" }, i18n.cancel), pendingGroupBrowserData.isDirty && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "solid", kind: "brand", onClick: applyPendingGroupData, width: "full" }, i18n.apply)))))));
        };
        this.renderDepCheckModal = () => {
            const { api, config, portal, user, items, closeDialog, hasSharingIssue, sharingDetail } = this;
            return (hasSharingIssue && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-dependency-check", { api: api, items: items.map((item) => ({ item })), portal: portal, user: user, config: config,
                // ! Don't use the condition directly here or the `onCalciteModalClose` will be triggered
                isActive: true, preProcessedSharingDetail: sharingDetail, onWorkflowCancel: closeDialog, onWorkflowComplete: (event) => {
                    event.stopPropagation();
                    this.didUpdateSharingDetail = true;
                    // We don't call this since we just want to close the modal
                    //  but if we want to show any underlying issue after recheck, we can enable it
                    // checkSharingIssue(selectedItems);
                    // Revert sharing detail to trigger the end state
                    this.sharingDetailToEmit = Object.assign({}, sharingDetail);
                    this.sharingDetail = Object.assign({}, _utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.D);
                } })));
        };
        this.renderConfirmationDialog = () => {
            const { confirmationDialogType } = this;
            if (!confirmationDialogType) {
                return null;
            }
            const { i18n, isLoading, revertShareLevel, setShareLevel, revertGroupData } = this;
            const { title, description } = i18n.shareWarning[confirmationDialogType];
            const isPDCDisabledError = confirmationDialogType === "publicDataCollectionDisabled";
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { onCalciteModalClose: (event) => {
                    event.stopPropagation();
                    this.confirmationDialogType = null;
                }, open: !!this.confirmationDialogType, widthScale: "s", outsideCloseDisabled: true, escapeDisabled: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content" }, description), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: isPDCDisabledError ? "solid" : "outline", kind: "brand", "data-id": "cancelButton", onClick: () => (this.confirmationDialogType = null), width: "full" }, i18n[isPDCDisabledError ? "ok" : "cancel"]), !isPDCDisabledError && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "solid", kind: "brand", "data-id": "nextButton", onClick: () => {
                    switch (confirmationDialogType) {
                        case "publicAccountOpenGroupBrowser":
                            setShareLevel("public");
                            this.isBrowsingGroups = true;
                            break;
                        case "publicAccountSetShareToPrivate":
                            setShareLevel("private");
                            this.selectedGroupData = [];
                            break;
                        case "publicAccountRevertShareLevel":
                            revertShareLevel();
                            this.selectedGroupData = [];
                            break;
                        case "publicAccountRevertGroup":
                            setShareLevel("public");
                            revertGroupData();
                            break;
                        case "publicDataCollectionEnabled":
                            this.confirmedPDC = true;
                            this.updateSharing();
                            break;
                    }
                    this.confirmationDialogType = null;
                }, width: "full", disabled: isLoading }, i18n.update))));
        };
        this.api = undefined;
        this.user = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.items = undefined;
        this.hasTrustedOrgs = false;
        this.isLoading = undefined;
        this.selectedShareLevels = [];
        this.isShareLevelDirty = false;
        this.shareLevelCount = {
            private: 0,
            shared: 0,
            org: 0,
            public: 0
        };
        this.hasSingleShareLevel = false;
        this.selectedGroupData = [];
        this.isSelectedGroupsDirty = false;
        this.loadingText = null;
        this.isBrowsingGroups = false;
        this.confirmationDialogType = null;
        this.confirmedPDC = false;
        this.browserPagination = undefined;
        this.browserGroups = [];
        this.pendingGroupBrowserData = {
            groupData: [],
            groupDataLookup: {},
            groupCount: {},
            isDirty: false
        };
        this.groupBrowserQ = "";
        this.groupBrowserSearchUsername = "";
        this.groupBrowserAllUsers = [];
        this.currentStep = "share";
        this.sharingDetail = null;
        this.hasSharingIssue = null;
    }
    handleIsBrowsingGroupsChange() {
        if (this.isBrowsingGroups) {
            this.handleNewPendingSelectedGroups(this.selectedGroupData.map(({ group }) => group));
        }
    }
    handleShareLevelChange() {
        const { selectedShareLevels, initialShareLevels, selectedGroupData, items } = this;
        this.isShareLevelDirty = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.f)(selectedShareLevels, initialShareLevels, items, selectedGroupData);
        this.shareLevelCount = selectedShareLevels.reduce((acc, cur) => {
            acc[cur]++;
            return acc;
        }, { private: 0, shared: 0, org: 0, public: 0 });
        this.hasSingleShareLevel = selectedShareLevels.every((cur) => cur === selectedShareLevels[0]);
    }
    async componentWillLoad() {
        var _a;
        this.items = this.items.map((item) => { var _a; return (_a = item.sourceJSON) !== null && _a !== void 0 ? _a : item; });
        const { items, portal, user, el } = this;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__.g)(el);
        this.i18n = locale[0];
        // This assume that once the loading text changes to updatingInfo,
        //  it will not change back to retrievingInfo
        this.loadingText = this.i18n.retrievingInfo;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = this.api;
        this.isPublicUser = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_5__.a)(user);
        this.initialShareLevels = items.map((item) => item.access);
        this.selectedShareLevels = [...this.initialShareLevels];
        this.possibleShareLevelOptions = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.h)(user, items, portal);
        const shareMode = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_8__.j)(items, user, portal);
        this.showOptions = shareMode !== "group";
        this.shareMode = shareMode;
        this.hasPrivateItem = items.some((item) => item.access === "private");
        const subscriptionInfo = (portal === null || portal === void 0 ? void 0 : portal.subscriptionInfo) || ((_a = portal === null || portal === void 0 ? void 0 : portal.sourceJSON) === null || _a === void 0 ? void 0 : _a.subscriptionInfo);
        this.hasItemBlockedFromPublic =
            items.some(_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__.c) ||
                ((0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_5__.i)(subscriptionInfo) && items.some(_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_1__.d));
        this.hasIndoorsSpaces = items.some((item) => { var _a; return (_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("EditExtensionIndoorsSpaces"); });
    }
    handleSharingDetailChange() {
        const { sharingDetail } = this;
        this.hasSharingIssue =
            sharingDetail !== null
                ? Object.keys(sharingDetail).some((detailType) => sharingDetail[detailType].length > 0)
                : null;
    }
    handleHasSharingIssueChange() {
        const { hasSharingIssue } = this;
        if (hasSharingIssue) {
            this.currentStep = "review-sharing";
        }
        else if (hasSharingIssue === false) {
            this.currentStep = "finish";
        }
    }
    handleCurrentStepChange() {
        var _a, _b;
        const { currentStep, didUpdateSharingDetail, workflowComplete, sharingDetailToEmit, shareItemResult } = this;
        if (currentStep !== "finish") {
            return;
        }
        const didUpdateDependentLayersSharing = didUpdateSharingDetail;
        workflowComplete.emit({
            // No point in updating dep layers if the users didn't go through review sharing flow
            dependentLayersWithSourceItems: didUpdateDependentLayersSharing && sharingDetailToEmit
                ? Object.values(sharingDetailToEmit).reduce((acc, itemSharingDetailResults) => {
                    acc.push(...itemSharingDetailResults.map(({ layer, sourceItem }) => ({
                        layer,
                        sourceItem
                    })));
                    return acc;
                }, [])
                : [],
            newShareLevel: (_a = shareItemResult === null || shareItemResult === void 0 ? void 0 : shareItemResult.newShareLevel) !== null && _a !== void 0 ? _a : null,
            shareErrors: (_b = shareItemResult === null || shareItemResult === void 0 ? void 0 : shareItemResult.shareErrors) !== null && _b !== void 0 ? _b : [],
            didUpdateDependentLayersSharing
        });
    }
    render() {
        const { renderShareModal, renderDepCheckModal, renderConfirmationDialog } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, renderShareModal(), renderDepCheckModal(), renderConfirmationDialog()));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "isBrowsingGroups": ["handleIsBrowsingGroupsChange"],
        "selectedShareLevels": ["handleShareLevelChange"],
        "sharingDetail": ["handleSharingDetailChange"],
        "hasSharingIssue": ["handleHasSharingIssueChange"],
        "currentStep": ["handleCurrentStepChange"]
    }; }
};
ArcgisItemShare.style = arcgisItemShareCss;



//# sourceMappingURL=arcgis-item-share.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTk4YmRjNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ2lIO0FBQ3FFO0FBQzlIO0FBQ1M7QUFDSztBQUNTO0FBQ2xCO0FBQ0o7QUFDa1U7QUFDeFY7QUFDTDtBQUNLO0FBQ1I7QUFDQztBQUNXO0FBQ1Y7QUFDRztBQUNOO0FBQ1E7QUFDQTtBQUNQO0FBQ1M7O0FBRXBDLG1DQUFtQyxZQUFZLHFCQUFxQiw2QkFBNkIsa0NBQWtDLHdDQUF3QyxRQUFRLGFBQWEsMEJBQTBCLG1CQUFtQixhQUFhLFlBQVksbUJBQW1CLGtCQUFrQix5QkFBeUIsa0JBQWtCLFVBQVUscUJBQXFCLGtCQUFrQixZQUFZLGFBQWEsbUJBQW1CLGtCQUFrQixtQkFBbUIsd0JBQXdCLFdBQVcsVUFBVSxjQUFjLGtCQUFrQiwyQkFBMkIsZUFBZSxrQkFBa0IsZ0JBQWdCLGVBQWUsa0JBQWtCLGtCQUFrQixtQkFBbUIsb0JBQW9CLG1CQUFtQixlQUFlLGtCQUFrQixxRUFBcUUsMkJBQTJCOztBQUUvMUI7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDhCQUE4QixxREFBVztBQUN6QyxnQ0FBZ0MscURBQVc7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixrQ0FBa0MsK0JBQStCO0FBQ3JGO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsV0FBVyx1QkFBdUI7QUFDL0Y7QUFDQTtBQUNB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O0FBQ2hMO0FBQ0E7QUFDQSxnQkFBZ0IsZ0JBQWdCO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixrQkFBa0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDhGQUE4RjtBQUM5RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLG1CQUFtQjtBQUNuRjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxnQkFBZ0Isa0VBQWtFO0FBQ2xGLGdCQUFnQixxREFBQyxDQUFDLGlEQUFRO0FBQzFCO0FBQ0EsZUFBZSxPQUFPLHFEQUFVO0FBQ2hDLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVnRDs7QUFFaEQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaXRlbS1zaGFyZS5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFuYWx5emVTaGFyaW5nRGV0YWlsLCB1IGFzIHVuc2hhcmVJdGVtcywgYiBhcyBzaGFyZUl0ZW1zLCBjIGFzIGlzQmxvY2tlZEZyb21TaGFyaW5nVG9QdWJsaWMsIGQgYXMgaXNCbG9ja2VkRnJvbURldmVsb3BlclNoYXJpbmdUb1B1YmxpYyB9IGZyb20gJy4vc2VydmljZXMtNjZhZWUzMWIuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IGEgYXMgYXJyYXlUb0xvb2t1cE1hcCB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciwgaSBhcyBpc0RldmVsb3BlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzSG9zdGVkU2VydmljZSB9IGZyb20gJy4vc2VydmljZS04YzJjNDI0MS5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzRWRpdGFibGVJdGVtIH0gZnJvbSAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCB7IEQgYXMgREVGQVVMVF9TSEFSSU5HX0RFVEFJTCwgZyBhcyBnZXRJdGVtc0FuZEdyb3Vwc1RvVXBkYXRlU2hhcmUsIGkgYXMgaXNTZWxlY3RlZEdyb3VwRGF0YURpcnR5LCBzIGFzIHNob3dFZGl0R3JvdXBXYXJuaW5nLCBhIGFzIGdldFVzZXJuYW1lUXVlcnksIGIgYXMgc2hvd1JldmVydEdyb3VwV2FybmluZywgYyBhcyBzaG93UmV2ZXJ0U2hhcmVMZXZlbFdhcm5pbmcsIGQgYXMgREVGQVVMVF9TSEFSRV9MRVZFTFMsIGUgYXMgc2hvd1NoYXJlTGV2ZWxDaGFuZ2VXYXJuaW5nLCBmIGFzIGlzU2hhcmVMZXZlbERpcnR5LCBoIGFzIGdldFBvc3NpYmxlU2hhcmVMZXZlbCwgaiBhcyBnZXRTaGFyZU1vZGUgfSBmcm9tICcuL3V0aWxzLWY0ZjQ0Yjg4LmpzJztcbmltcG9ydCAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCAnLi9pdGVtLXByb3BlcnRpZXMtMTA0OTFiMmUuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtODEzNzNmNmQuanMnO1xuaW1wb3J0ICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcblxuY29uc3QgYXJjZ2lzSXRlbVNoYXJlQ3NzID0gXCIuc3RhZ2V7aGVpZ2h0OjEwMCV9Lmdyb3VwLWJyb3dzZXItbW9kYWx7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjEwODBweDstLWNhbGNpdGUtbW9kYWwtY29udGVudC1wYWRkaW5nOjA7LS1jYWxjaXRlLW1vZGFsLWhlaWdodDptaW4oODAwcHgsIDgwdmgpfS5oaWRkZW57ZGlzcGxheTpub25lfS5zZWN0aW9uOm5vdCg6bGFzdC1jaGlsZCl7bWFyZ2luLWJvdHRvbToycmVtfWNhbGNpdGUtZmxvd3toZWlnaHQ6MTAwJX0uY29udGVudC1jb250YWluZXJ7bWFyZ2luLXRvcDowLjVyZW19LmFjdGl2ZS1idXQtbm90LXNlbGVjdGVke3Bvc2l0aW9uOnJlbGF0aXZlO3otaW5kZXg6Mn0udGlsZS1zZWxlY3Qtd3JhcHBlcntwb3NpdGlvbjpyZWxhdGl2ZX0uc2hhcmUtaGludHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3Bvc2l0aW9uOmFic29sdXRlO2ZvbnQtc2l6ZTowLjg3NXJlbTtpbnNldC1pbmxpbmUtZW5kOjAuNXJlbTt0b3A6MC41cmVtO3otaW5kZXg6M30uc2hhcmUtaGludD5we21hcmdpbi1ib3R0b206MHB4O21hcmdpbi1pbmxpbmUtc3RhcnQ6MC41cmVtO21hcmdpbi10b3A6MnB4fS5pbmZvcm1hdGlvbi10ZXh0e2ZvbnQtd2VpZ2h0OjUwMDttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tdG9wOjAuNXJlbTtmb250LXNpemU6MC44NzVyZW19Lmdyb3VwLWl0ZW0tY291bnRlcntmb250LXNpemU6MC44NzVyZW07bWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHh9LnJldmVydC1zaW5nbGUtZ3JvdXAtY3RhOmZpcnN0LWNoaWxkLC5ncm91cC1pdGVtLWNvdW50ZXI6Zmlyc3QtY2hpbGR7bWFyZ2luLWlubGluZS1zdGFydDowLjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1TaGFyZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q2FuY2VsXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMuaW5pdGlhbFNoYXJlTGV2ZWxzID0gW107XG4gICAgICAgIHRoaXMuaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZWxlY3RlZCBieSBhbGwgaXRlbXMsIHNvbWUgaXRlbXMgb3Igbm8gaXRlbXNcbiAgICAgICAgICpcbiAgICAgICAgICogVXNlZCB0byBkZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIHNob3cgdGhlIHJldmVydCBidXR0b24gb24gZWFjaCBncm91cCBjYXJkXG4gICAgICAgICAqICAqL1xuICAgICAgICB0aGlzLmluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YUxvb2t1cCA9IHt9O1xuICAgICAgICB0aGlzLnNob3dPcHRpb25zID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hhcmVMZXZlbE9wdGlvbnMgPSBbXCJwcml2YXRlXCIsIFwib3JnXCIsIFwicHVibGljXCJdO1xuICAgICAgICB0aGlzLnBvc3NpYmxlU2hhcmVMZXZlbE9wdGlvbnMgPSBbXG4gICAgICAgICAgICBcInByaXZhdGVcIixcbiAgICAgICAgICAgIFwib3JnXCIsXG4gICAgICAgICAgICBcInB1YmxpY1wiXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuc2hhcmVMZXZlbEljb24gPSB7XG4gICAgICAgICAgICBwcml2YXRlOiBcInVzZXJcIixcbiAgICAgICAgICAgIG9yZzogXCJvcmdhbml6YXRpb25cIixcbiAgICAgICAgICAgIHB1YmxpYzogXCJnbG9iZVwiXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXNQdWJsaWNVc2VyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGFzSXRlbUJsb2NrZWRGcm9tUHVibGljID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGFzUHJpdmF0ZUl0ZW0gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaGFyZU1vZGUgPSBcImRlZmF1bHRcIjtcbiAgICAgICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hhcmluZ0RldGFpbFRvRW1pdCA9IG51bGw7XG4gICAgICAgIHRoaXMuZGlkVXBkYXRlU2hhcmluZ0RldGFpbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNoYXJlSXRlbVJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMuaGFuZGxlTmV3U2hhcmVSZXN1bHQgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGl0ZW1zLCBwb3J0YWwsIHNoYXJlSXRlbVJlc3VsdDogeyBuZXdTaGFyZUxldmVsLCBuZXdHcm91cFNoYXJlZCB9LCBcbiAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIGFscmVhZHkgaGF2ZSB0aGUgbGF0ZXN0IHVwZGF0ZVxuICAgICAgICAgICAgc2VsZWN0ZWRHcm91cERhdGEgfSA9IHRoaXM7XG4gICAgICAgICAgICAvLyAqIFJlc2V0IGl0ZW0gdG8gZ2V0IHJlYWR5IGZvciB0aGUgcmV2aWV3IHNoYXJpbmcgc3RhdGVcbiAgICAgICAgICAgIGxldCBuZXdJdGVtcyA9IFsuLi5pdGVtc107XG4gICAgICAgICAgICBpZiAobmV3U2hhcmVMZXZlbCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbmV3SXRlbXMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1NoYXJlTGV2ZWwgIT09IFwicHJpdmF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpdGVtKSwgeyBhY2Nlc3M6IG5ld1NoYXJlTGV2ZWwgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5ldyBsZXZlbCBpcyBwcml2YXRlIGJ1dCB0aGUgaXRlbSBpcyBjdXJyZW50bHkgc2hhcmVkIHRvIGEgZ3JvdXAsXG4gICAgICAgICAgICAgICAgICAgIC8vICB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSBpdCdzIG1hcmtlZCBhcyBcInNoYXJlZFwiIGluc3RlYWQgb2YgXCJwcml2YXRlXCJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNJdGVtQ3VycmVudGx5U2hhcmVkVG9Hcm91cHMgPSBzZWxlY3RlZEdyb3VwRGF0YSA9PT0gbnVsbCB8fCBzZWxlY3RlZEdyb3VwRGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRHcm91cERhdGEuc29tZSgoeyBzZWxlY3RlZEJ5SXRlbUlkcyB9KSA9PiBzZWxlY3RlZEJ5SXRlbUlkcy5pbmNsdWRlcyhpdGVtLmlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGl0ZW0pLCB7IGFjY2VzczogaXNJdGVtQ3VycmVudGx5U2hhcmVkVG9Hcm91cHMgPyBcInNoYXJlZFwiIDogXCJwcml2YXRlXCIgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSdyZSBub3Qgc2hhcmluZyB0byBhbnkgZ3JvdXAsIHdlIG5lZWQgdG8gbWFrZSBzdXJlIGV2ZXJ5IFwic2hhcmVkXCIgaXRlbSBpcyBtYXJrZWQgYXMgXCJwcml2YXRlXCJcbiAgICAgICAgICAgIGlmICghKHNlbGVjdGVkR3JvdXBEYXRhID09PSBudWxsIHx8IHNlbGVjdGVkR3JvdXBEYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEdyb3VwRGF0YS5sZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgbmV3SXRlbXMgPSBuZXdJdGVtcy5tYXAoKGl0ZW0pID0+IFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IHRlc3QgdGhhdCB0aGlzIGV2ZW4gd29ya3MgaW4gNC54LiBDYW4geW91IHNwcmVhZCBhIHBvcnRhbCBpdGVtIGxpa2UgdGhpcz9cbiAgICAgICAgICAgICAgICBpdGVtLmFjY2VzcyA9PT0gXCJzaGFyZWRcIiA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgaXRlbSksIHsgYWNjZXNzOiBcInByaXZhdGVcIiB9KSA6IGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQW5kIHZpY2UgdmVyc2EgaWYgd2UncmUgKGZ1bGx5KSBzaGFyaW5nIHRvIGF0IGxlYXN0IG9uZSBuZXcgZ3JvdXBcbiAgICAgICAgICAgIGlmIChuZXdHcm91cFNoYXJlZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBuZXdJdGVtcyA9IG5ld0l0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5hY2Nlc3MgPT09IFwicHJpdmF0ZVwiID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpdGVtKSwgeyBhY2Nlc3M6IFwic2hhcmVkXCIgfSkgOiBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBuZXdJdGVtcztcbiAgICAgICAgICAgIC8vICogQW5hbHl6ZSBhbmQgZGVjaWRlIHdoZXRoZXIgd2Ugc2hvdWxkIHNob3cgdGhlIGRlcCBjaGVjayBkaWFsb2dcbiAgICAgICAgICAgIGNvbnN0IGFuYWx5emVSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwobmV3SXRlbXMubWFwKChpdGVtKSA9PiBhbmFseXplU2hhcmluZ0RldGFpbChpdGVtLCBwb3J0YWwpKSk7XG4gICAgICAgICAgICBjb25zdCBuZXdTaGFyZURldGFpbCA9IGFuYWx5emVSZXN1bHRzLnJlZHVjZSgoYWNjLCB7IHJlc3VsdCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjW2tleV0gPSBbLi4uYWNjW2tleV0sIC4uLnJlc3VsdFtrZXldXTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICB9LCBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NIQVJJTkdfREVUQUlMKSk7XG4gICAgICAgICAgICB0aGlzLnNoYXJpbmdEZXRhaWwgPSBuZXdTaGFyZURldGFpbDtcbiAgICAgICAgICAgIC8vIFRoZSB3YXRjaCBmb3IgYGhhc1NoYXJpbmdJc3N1ZWAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHRyaWdnZXJlZCBuZXh0XG4gICAgICAgIH07XG4gICAgICAgIC8vICogT3RoZXIgdXRpbHMgYW5kIHJlbmRlcnNcbiAgICAgICAgdGhpcy51cGRhdGVTaGFyaW5nID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nVGV4dCA9IHRoaXMuaTE4bi51cGRhdGluZ0luZm87XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCB7IGl0ZW1zLCBzZWxlY3RlZFNoYXJlTGV2ZWxzLCBpbml0aWFsU2VsZWN0ZWRHcm91cERhdGEsIHNlbGVjdGVkR3JvdXBEYXRhLCBwb3J0YWwsIHVzZXIsIGlzU2hhcmVMZXZlbERpcnR5LCBjaGVja0l0ZW1QRENJc3N1ZSwgY29uZmlybWVkUERDIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBzaGFyZUdyb3VwSWRzLCB1bnNoYXJlR3JvdXBJZHMgfSA9IGdldEl0ZW1zQW5kR3JvdXBzVG9VcGRhdGVTaGFyZShpbml0aWFsU2VsZWN0ZWRHcm91cERhdGEsIHNlbGVjdGVkR3JvdXBEYXRhKTtcbiAgICAgICAgICAgIGlmICghY29uZmlybWVkUERDICYmICEoYXdhaXQgY2hlY2tJdGVtUERDSXNzdWUoKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAhIFRoaXMgYXNzdW1lIHRoYXQgYWxsIGl0ZW1zIGhhdmUgdGhlIHNhbWUgc2hhcmUgbGV2ZWwgb25jZSB0aGUgdXNlciBjaG9vc2Ugc29tZXRoaW5nXG4gICAgICAgICAgICBjb25zdCBuZXdTaGFyZUxldmVsID0gaXNTaGFyZUxldmVsRGlydHkgfHwgaXRlbXMubGVuZ3RoID09PSAxID8gc2VsZWN0ZWRTaGFyZUxldmVsc1swXSA6IG51bGw7XG4gICAgICAgICAgICAvLyBOZWVkIHRvIHVuc2hhcmUgZmlyc3QgaW4gY2FzZSB0aGUgdXNlciBpcyBwdWJsaWNcbiAgICAgICAgICAgIC8vIChwdWJsaWMgdXNlciBjYW4gb25seSBzaGFyZSB0byBncm91cCBpZiB0aGUgc2hhcmUgbGV2ZWwgaXMgcHVibGljKVxuICAgICAgICAgICAgY29uc3QgdW5zaGFyZVByb21pc2UgPSB1bnNoYXJlR3JvdXBJZHMubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyB1bnNoYXJlSXRlbXMoaXRlbXMubWFwKChpdGVtKSA9PiBpdGVtLmlkKSwgdW5zaGFyZUdyb3VwSWRzLCB7IHBvcnRhbCwgdXNlciB9KVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgY29uc3Qgc2hhcmVQcm9taXNlID0gc2hhcmVHcm91cElkcy5sZW5ndGggfHwgaXNTaGFyZUxldmVsRGlydHlcbiAgICAgICAgICAgICAgICA/IHNoYXJlSXRlbXMoaXRlbXMsIG5ld1NoYXJlTGV2ZWwsIHNoYXJlR3JvdXBJZHMsIHsgcG9ydGFsLCB1c2VyIH0pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBjb25zdCBbc2hhcmVSZXN1bHRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3NoYXJlUHJvbWlzZSwgdW5zaGFyZVByb21pc2VdKTtcbiAgICAgICAgICAgIC8vICEgV2UgZG9uJ3Qgc2V0IGxvYWRpbmcgdG8gZmFsc2UgaW4gY2FzZSB0aGUgY29uc3VtZXJzIHdhbnQgdG8ga2VlcCBsb2FkaW5nXG4gICAgICAgICAgICAvLyBUaGV5IGNhbiByZW1vdmUgdGhlIG1vZGFsIGNvbXBsZXRlbHlcbiAgICAgICAgICAgIC8vICogLS0tXG4gICAgICAgICAgICBjb25zdCBzaGFyZUl0ZW1SZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogaGFpciBzcGxpdHRpbmcgdGhpcyBzaW5jZSBkaWZmZXJlbnQgaXRlbXMgY2FuIGxlYWQgdG8gZGlmZmVyZW50IHJlc3VsdHNcbiAgICAgICAgICAgICAgICBuZXdHcm91cFNoYXJlZDogc2hhcmVHcm91cElkcy5maWx0ZXIoKGlkKSA9PiAhKHNoYXJlUmVzdWx0ID09PSBudWxsIHx8IHNoYXJlUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaGFyZVJlc3VsdC5yZXN1bHQuc29tZSgoeyBub3RTaGFyZWRXaXRoIH0pID0+IG5vdFNoYXJlZFdpdGguaW5jbHVkZXMoaWQpKSkpLFxuICAgICAgICAgICAgICAgIG5ld0dyb3VwVW5zaGFyZWQ6IHVuc2hhcmVHcm91cElkcyxcbiAgICAgICAgICAgICAgICBuZXdTaGFyZUxldmVsLFxuICAgICAgICAgICAgICAgIHNoYXJlRXJyb3JzOiAoX2EgPSBzaGFyZVJlc3VsdCA9PT0gbnVsbCB8fCBzaGFyZVJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2hhcmVSZXN1bHQucmVzdWx0LmZpbHRlcigoeyBlcnJvciB9KSA9PiBlcnJvcikubWFwKCh7IGl0ZW1JZCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGl0ZW06IGl0ZW1zLmZpbmQoKGN1ckl0ZW0pID0+IGN1ckl0ZW0uaWQgPT09IGl0ZW1JZCksIGNvZGU6IFwibm90U2hhcmVkV2l0aFwiIH07XG4gICAgICAgICAgICAgICAgfSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zaGFyZUl0ZW1SZXN1bHQgPSBzaGFyZUl0ZW1SZXN1bHQ7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZU5ld1NoYXJlUmVzdWx0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2hlY2tJdGVtUERDSXNzdWUgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGl0ZW1zLCBwb3J0YWwsIGlzU2hhcmVMZXZlbERpcnR5LCBzZWxlY3RlZFNoYXJlTGV2ZWxzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgaG9zdGVkSXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGlzSG9zdGVkU2VydmljZShpdGVtLnR5cGVLZXl3b3JkcywgaXRlbS50eXBlKSk7XG4gICAgICAgICAgICAvLyAhIElmIHRoZSBzaGFyZSBsZXZlbCBpcyBkaXJ0eSwgdGhpcyBtZWFucyB0aGUgc2hhcmUgbGV2ZWwgaXMgc2VsZWN0ZWQgdG8gc29tZXRoaW5nIGVsc2VcbiAgICAgICAgICAgIC8vICBtZWFuaW5nIGFsbCB0aGUgc2hhcmUgbGV2ZWwgaXMgY29udmVyZ2VkIHRvIHRoZSBzYW1lIGxldmVsIHNpbmNlIHRoYXQncyB0aGUgb25seSB1c2UgY2FzZVxuICAgICAgICAgICAgY29uc3QgcHVibGljT3B0aW9uU2VsZWN0ZWQgPSBpc1NoYXJlTGV2ZWxEaXJ0eSAmJiBzZWxlY3RlZFNoYXJlTGV2ZWxzWzBdID09PSBcInB1YmxpY1wiO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBpZiB3ZSBoYXZlIGhvc3RlZCBzZXJ2aWNlcyBhbmQgd2UncmUgc2hhcmluZyBwdWJsaWNseSwgY2hlY2sgZm9yIGVkaXRhYmxlIGxheWVycyBhbmQgd2FybiB1c2VyXG4gICAgICAgICAgICAgKiBXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMjcwMDIsIFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMyNjI4NVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAoaG9zdGVkSXRlbXMubGVuZ3RoID4gMCAmJiBwdWJsaWNPcHRpb25TZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlZGl0YWJsZUNoZWNrID0gYXdhaXQgUHJvbWlzZS5hbGwoaG9zdGVkSXRlbXMubWFwKChpdGVtKSA9PiBpc0VkaXRhYmxlSXRlbShpdGVtLCBwb3J0YWwpKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlZGl0YWJsZUl0ZW1zID0gaG9zdGVkSXRlbXMuZmlsdGVyKChfLCBpbmRleCkgPT4gZWRpdGFibGVDaGVja1tpbmRleF0pO1xuICAgICAgICAgICAgICAgIGlmIChlZGl0YWJsZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwdWJsaWNEYXRhQ29sbGVjdGlvbkRpc2FibGVkID0gIWVkaXRhYmxlSXRlbXMuZXZlcnkoKGl0ZW0pID0+IGl0ZW0udHlwZUtleXdvcmRzLmluY2x1ZGVzKFwiUHVibGljIERhdGEgQ29sbGVjdGlvblwiKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlybWF0aW9uRGlhbG9nVHlwZSA9IHB1YmxpY0RhdGFDb2xsZWN0aW9uRGlzYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gXCJwdWJsaWNEYXRhQ29sbGVjdGlvbkRpc2FibGVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogXCJwdWJsaWNEYXRhQ29sbGVjdGlvbkVuYWJsZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZU5ld1BlbmRpbmdTZWxlY3RlZEdyb3VwcyA9IChuZXdHcm91cHMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaXRlbXMsIHBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLCBzZWxlY3RlZEdyb3VwRGF0YSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGN1clNlbGVjdGVkR3JvdXBMb29rdXAgPSBhcnJheVRvTG9va3VwTWFwKHBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLmdyb3VwRGF0YSwgKGdyb3VwRGF0YSkgPT4gKHtcbiAgICAgICAgICAgICAgICBrZXk6IGdyb3VwRGF0YS5ncm91cC5pZCxcbiAgICAgICAgICAgICAgICBkYXRhOiBncm91cERhdGFcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGFsbEl0ZW1JZHMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpO1xuICAgICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRHcm91cERhdGEgPSBuZXdHcm91cHMubWFwKChncm91cCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBncm91cCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZCwgdXNlIHRoZSBwcmV2aW91cyBkYXRhXG4gICAgICAgICAgICAgICAgLy8gIGVsc2Ugc2V0IHNlbGVjdGVkQnlJdGVtSWRzIHRvIGFsbCBpdGVtcycgaWRzXG4gICAgICAgICAgICAgICAgY29uc3QgcHJldkdyb3VwRGF0YSA9IGN1clNlbGVjdGVkR3JvdXBMb29rdXBbZ3JvdXAuaWRdO1xuICAgICAgICAgICAgICAgIGlmIChwcmV2R3JvdXBEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2R3JvdXBEYXRhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4geyBncm91cCwgc2VsZWN0ZWRCeUl0ZW1JZHM6IGFsbEl0ZW1JZHMgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5wZW5kaW5nR3JvdXBCcm93c2VyRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBncm91cERhdGE6IG5ld1NlbGVjdGVkR3JvdXBEYXRhLFxuICAgICAgICAgICAgICAgIGdyb3VwRGF0YUxvb2t1cDogYXJyYXlUb0xvb2t1cE1hcChuZXdTZWxlY3RlZEdyb3VwRGF0YSwgKGdyb3VwRGF0YSkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAga2V5OiBncm91cERhdGEuZ3JvdXAuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHRydWVcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgZ3JvdXBDb3VudDogbmV3U2VsZWN0ZWRHcm91cERhdGEucmVkdWNlKChhY2MsIGN1cikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhY2NbY3VyLmdyb3VwLmlkXSA9IGN1ci5zZWxlY3RlZEJ5SXRlbUlkcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICAgICAgfSwge30pLFxuICAgICAgICAgICAgICAgIGlzRGlydHk6IGlzU2VsZWN0ZWRHcm91cERhdGFEaXJ0eShuZXdTZWxlY3RlZEdyb3VwRGF0YSwgc2VsZWN0ZWRHcm91cERhdGEpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJldmVydFNoYXJlTGV2ZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2hhcmVMZXZlbHMgPSBbLi4udGhpcy5pbml0aWFsU2hhcmVMZXZlbHNdO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNldFNoYXJlTGV2ZWwgPSAobmV3U2hhcmVMZXZlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNoYXJlTGV2ZWxzID0gdGhpcy5zZWxlY3RlZFNoYXJlTGV2ZWxzLm1hcCgoKSA9PiBuZXdTaGFyZUxldmVsKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZXZlcnRHcm91cERhdGEgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBEYXRhID0gWy4uLnRoaXMuaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhXTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZXZlcnRQZW5kaW5nR3JvdXBEYXRhID0gKGdyb3VwSWQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhLCBwZW5kaW5nR3JvdXBCcm93c2VyRGF0YSwgaGFuZGxlTmV3UGVuZGluZ1NlbGVjdGVkR3JvdXBzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbEdyb3VwRGF0YSA9IGluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YS5maW5kKCh7IGdyb3VwIH0pID0+IGdyb3VwLmlkID09PSBncm91cElkKTtcbiAgICAgICAgICAgIGNvbnN0IGN1ckdyb3VwRGF0YSA9IHBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLmdyb3VwRGF0YTtcbiAgICAgICAgICAgIGNvbnN0IGN1clNlbGVjdGVkR3JvdXBEYXRhID0gY3VyR3JvdXBEYXRhLmZpbmQoKHsgZ3JvdXAgfSkgPT4gZ3JvdXAuaWQgPT09IGdyb3VwSWQpO1xuICAgICAgICAgICAgbGV0IG5ld0dyb3VwRGF0YSA9IFtdO1xuICAgICAgICAgICAgaWYgKCFpbml0aWFsR3JvdXBEYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyBpbml0aWFsbHkgd2UgZG9uJ3QgaGF2ZSB0aGlzIGdyb3VwXG4gICAgICAgICAgICAgICAgbmV3R3JvdXBEYXRhID0gY3VyR3JvdXBEYXRhLmZpbHRlcigoeyBncm91cCB9KSA9PiBncm91cC5pZCAhPT0gZ3JvdXBJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghY3VyU2VsZWN0ZWRHcm91cERhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHdlIHJlbW92ZWQgdGhlIGdyb3VwXG4gICAgICAgICAgICAgICAgbmV3R3JvdXBEYXRhID0gWy4uLmN1ckdyb3VwRGF0YSwgaW5pdGlhbEdyb3VwRGF0YV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdHcm91cERhdGEgPSBjdXJHcm91cERhdGEubWFwKChncm91cERhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3VwRGF0YS5ncm91cC5pZCAhPT0gZ3JvdXBJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdyb3VwRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdGlhbEdyb3VwRGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhhbmRsZU5ld1BlbmRpbmdTZWxlY3RlZEdyb3VwcyhuZXdHcm91cERhdGEubWFwKCh7IGdyb3VwIH0pID0+IGdyb3VwKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYXBwbHlQZW5kaW5nR3JvdXBEYXRhID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwRGF0YSA9IFsuLi50aGlzLnBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLmdyb3VwRGF0YV07XG4gICAgICAgICAgICB0aGlzLnVuQnJvd3NlR3JvdXBzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2cgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAvLyBTdG9wIHRoZSBjbG9zZSBldmVudCBmcm9tIGFyY2dpcy1kZXBlbmRlbmN5LWNoZWNrIGZyb20gcHJvcGFnYXRpbmdcbiAgICAgICAgICAgIGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHsgd29ya2Zsb3dDYW5jZWwsIGN1cnJlbnRTdGVwIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGVwICE9PSBcImZpbmlzaFwiKSB7XG4gICAgICAgICAgICAgICAgd29ya2Zsb3dDYW5jZWwuZW1pdCh7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoYXJlTGV2ZWw6IChfYiA9IChfYSA9IHRoaXMuc2hhcmVJdGVtUmVzdWx0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmV3U2hhcmVMZXZlbCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQXRTdGVwOiBjdXJyZW50U3RlcFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVuQnJvd3NlR3JvdXBzID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0Jyb3dzaW5nR3JvdXBzID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyR3JvdXBCcm93c2VyID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBhcGksIGkxOG4sIHVzZXIsIHBvcnRhbCwgY29uZmlnLCBwZW5kaW5nR3JvdXBCcm93c2VyRGF0YSwgYnJvd3NlclBhZ2luYXRpb24sIGJyb3dzZXJHcm91cHMsIGhhbmRsZU5ld1BlbmRpbmdTZWxlY3RlZEdyb3VwcywgaXNCcm93c2luZ0dyb3VwcywgaXNQdWJsaWNVc2VyLCBpdGVtcywgc2hhcmVNb2RlLCBncm91cEJyb3dzZXJRLCBpbml0aWFsU2VsZWN0ZWRHcm91cERhdGFMb29rdXAsIHJldmVydFBlbmRpbmdHcm91cERhdGEsIGhhc0luZG9vcnNTcGFjZXMsIGdyb3VwQnJvd3NlckFsbFVzZXJzLCBncm91cEJyb3dzZXJTZWFyY2hVc2VybmFtZSwgaGFzUHJpdmF0ZUl0ZW0gfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB0b3RhbEl0ZW1Db3VudCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHNob3dGaWx0ZXJCeVVzZXJzID0gc2hhcmVNb2RlID09PSBcImFkbWluXCIgJiYgIWhhc1ByaXZhdGVJdGVtICYmIGdyb3VwQnJvd3NlckFsbFVzZXJzLmxlbmd0aCA+IDE7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtZ3JvdXAtYnJvd3NlclwiLCB7IHZpZXc6IFwiY29tcGFjdFwiLCBjbGFzczogeyBoaWRkZW46ICFpc0Jyb3dzaW5nR3JvdXBzIH0sIGNvbmZpZzogY29uZmlnLCB1c2VyOiB1c2VyLCBhcGk6IGFwaSwgcG9ydGFsOiBwb3J0YWwsIHNlbGVjdGlvbjogXCJtdWx0aXBsZVwiLCBzZWFyY2hVc2VyOiBncm91cEJyb3dzZXJTZWFyY2hVc2VybmFtZSwgc2VsZWN0ZWRHcm91cHM6IHBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLmdyb3VwRGF0YS5tYXAoKGRhdGEpID0+IGRhdGEuZ3JvdXApLCBoYXNJbmRvb3JzU3BhY2VzOiBoYXNJbmRvb3JzU3BhY2VzLCBxOiBncm91cEJyb3dzZXJRLCBvbkFyY2dpc0dyb3VwQnJvd3NlclVwZGF0ZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyByZXN1bHRzLCBudW0sIHN0YXJ0LCB0b3RhbCB9ID0gZS5kZXRhaWw7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIGFzc2VydFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJHcm91cHMgPSByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJQYWdpbmF0aW9uID0geyBzdGFydCwgbnVtLCB0b3RhbCB9O1xuICAgICAgICAgICAgICAgIH0sIG9uQXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJHcm91cHMgPSBbXTtcbiAgICAgICAgICAgICAgICB9LCBvbkFyY2dpc0dyb3VwQnJvd3NlclNlbGVjdDogKGUpID0+IGhhbmRsZU5ld1BlbmRpbmdTZWxlY3RlZEdyb3VwcyhlLmRldGFpbCkgfSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLXRvcC1iYXJcIiwgeyBzbG90OiBcInRvcC1iYXJcIiwgXCJmaWx0ZXItdG9nZ2xlXCI6IHRydWUgfSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLXNlYXJjaFwiLCB7IHNsb3Q6IFwic2VhcmNoXCIsIHRlcm06IFwiXCIgfSkpLCBoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItc29ydFwiLCB7IHNsb3Q6IFwic29ydFwiIH0pLCBoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItZmlsdGVyc1wiLCB7IHNsb3Q6IFwiZmlsdGVyc1wiIH0sIHNob3dGaWx0ZXJCeVVzZXJzICYmIChoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItZmlsdGVyLWdyb3Vwcy1ieS11c2VyXCIsIHsgc2VhcmNoVXNlcm5hbWVzOiBncm91cEJyb3dzZXJBbGxVc2Vycy5tYXAoKHVzZXIpID0+IHVzZXIudXNlcm5hbWUpLCBzZWFyY2hVc2VybmFtZTogZ3JvdXBCcm93c2VyU2VhcmNoVXNlcm5hbWUsIG9uQXJjZ2lzR3JvdXBCcm93c2VyVXNlcm5hbWVzRmlsdGVyOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cEJyb3dzZXJTZWFyY2hVc2VybmFtZSA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgICAgICAgICB9IH0pKSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLWZpbHRlci1vd25lclwiLCB7IHNlYXJjaFVzZXJuYW1lOiBncm91cEJyb3dzZXJTZWFyY2hVc2VybmFtZSB9KSwgIWlzUHVibGljVXNlciAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLWZpbHRlci1tZW1iZXJzaGlwXCIsIG51bGwpLCBoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItZmlsdGVyLW1lbWJlci1vcmdcIiwgbnVsbCksIGgoXCJhcmNnaXMtZ3JvdXAtYnJvd3Nlci1maWx0ZXItc3BlY2lhbC1ncm91cHNcIiwgbnVsbCkpKSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLWZpbHRlci1kYXRlXCIsIHsgcHJvcGVydHk6IFwibW9kaWZpZWRcIiB9KSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLWZpbHRlci1kYXRlXCIsIHsgcHJvcGVydHk6IFwiY3JlYXRlZFwiIH0pKSwgaChcImFyY2dpcy1ncm91cC1icm93c2VyLWNvbnRlbnRcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwianMtY29udGVudFwiIH0sIChicm93c2VyR3JvdXBzIHx8IFtdKS5tYXAoKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBJZCA9IGdyb3VwLmlkO1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImFyY2dpcy1pdGVtLXNoYXJlLWdyb3VwLWNhcmRcIiwgeyBrZXk6IGdyb3VwSWQsIHVzZXI6IHVzZXIsIHBvcnRhbDogcG9ydGFsLCBpMThuOiBpMThuLCBncm91cDogZ3JvdXAsIGdyb3VwQ291bnQ6IHBlbmRpbmdHcm91cEJyb3dzZXJEYXRhLmdyb3VwQ291bnQsIGluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YUxvb2t1cDogaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhTG9va3VwLCBzZWxlY3RlZEdyb3VwRGF0YUxvb2t1cDogcGVuZGluZ0dyb3VwQnJvd3NlckRhdGEuZ3JvdXBEYXRhTG9va3VwLCB0b3RhbEl0ZW1Db3VudDogdG90YWxJdGVtQ291bnQsIG9uUmV2ZXJ0Q2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ5IG9wZW5pbmcgdGhlIGdyb3VwIGJyb3dzZXIsIHRoZSBwdWJsaWMgdXNlciBhbHJlYWR5IGhhdmVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICB0byBzd2l0Y2ggdGhlIHNoYXJlIHRvIFBVQkxJQyBhbHJlYWR5IHNvIHRoZXJlIGlzIG5vIG5lZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICB0byBzcGluIHVwIHRoZSBjb25maXJtYXRpb24gbW9kYWxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVydFBlbmRpbmdHcm91cERhdGEoZ3JvdXBJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICAgICAgfSkpLCBoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItcGFnaW5hdGlvblwiLCB7IHNsb3Q6IFwicGFnaW5hdGlvblwiLCBjbGFzczogXCJqcy1wYWdpbmF0aW9uXCIsIHRvdGFsOiBicm93c2VyUGFnaW5hdGlvbiA9PT0gbnVsbCB8fCBicm93c2VyUGFnaW5hdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYnJvd3NlclBhZ2luYXRpb24udG90YWwsIHN0YXJ0OiBicm93c2VyUGFnaW5hdGlvbiA9PT0gbnVsbCB8fCBicm93c2VyUGFnaW5hdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYnJvd3NlclBhZ2luYXRpb24uc3RhcnQsIG51bTogYnJvd3NlclBhZ2luYXRpb24gPT09IG51bGwgfHwgYnJvd3NlclBhZ2luYXRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGJyb3dzZXJQYWdpbmF0aW9uLm51bSB9KSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlclNoYXJlU2VsZWN0R3JvdXAgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNvbmZpZywgaGFzSXRlbUJsb2NrZWRGcm9tUHVibGljLCBoYXNTaW5nbGVTaGFyZUxldmVsLCBpMThuLCBpbml0aWFsU2VsZWN0ZWRHcm91cERhdGEsIGlzQnJvd3NpbmdHcm91cHMsIGlzTG9hZGluZywgaXNQdWJsaWNVc2VyLCBpc1NoYXJlTGV2ZWxEaXJ0eSwgaXRlbXMsIGxvYWRpbmdUZXh0LCBwb3J0YWwsIHBvc3NpYmxlU2hhcmVMZXZlbE9wdGlvbnMsIHJldmVydEdyb3VwRGF0YSwgcmV2ZXJ0U2hhcmVMZXZlbCwgc2VsZWN0ZWRHcm91cERhdGEsIHNlbGVjdGVkU2hhcmVMZXZlbHMsIHNldFNoYXJlTGV2ZWwsIHNoYXJlTGV2ZWxDb3VudCwgc2hhcmVMZXZlbEljb24sIHNoYXJlTGV2ZWxPcHRpb25zLCBzaGFyZU1vZGUsIHNob3dPcHRpb25zLCB1c2VyLCBoYXNQcml2YXRlSXRlbSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsSXRlbUNvdW50ID0gaXRlbXMubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgdG90YWxJdGVtQ291bnRTdHIgPSB0b3RhbEl0ZW1Db3VudC50b1N0cmluZygpO1xuICAgICAgICAgICAgY29uc3QgZGlzYWJsZWRUZXh0ID0gaGFzSXRlbUJsb2NrZWRGcm9tUHVibGljXG4gICAgICAgICAgICAgICAgPyBpMThuLnNoYXJpbmdMaW1pdGVkSXRlbURpc2NsYWltZXJcbiAgICAgICAgICAgICAgICA6IGkxOG4uY2Fubm90U2hhcmVUb0xldmVsRGlzY2xhaW1lcjtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAvLyAhIEhpZGRlbiBpbnN0ZWFkIG9mIHVubW91bnQgdG8gcHJldmVudCBkYXRhIHJlZmV0Y2hcbiAgICAgICAgICAgIGgoXCJkaXZcIiwgeyBjbGFzczogeyBoaWRkZW46IGlzQnJvd3NpbmdHcm91cHMgfSB9LCBpc0xvYWRpbmcgJiYgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyBhY3RpdmU6IGlzTG9hZGluZywgdGV4dDogbG9hZGluZ1RleHQgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi5zaGFyZUxldmVsLnRpdGxlLCBoZWFkZXJTaWRlQ29udGVudDogaXNTaGFyZUxldmVsRGlydHkgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgaWNvblN0YXJ0OiBcInJlc2V0XCIsIGRpc2FibGVkOiBpc0xvYWRpbmcsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGEgcHVibGljIHVzZXIgdHJpZXMgdG8gcmV2ZXJ0IGl0ZW0gbGV2ZWxzXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdGhlIGluaXRpYWwgc2hhcmUgbGV2ZWwgaW5jbHVkZXMgYXQgbGVhc3Qgb25lIHByaXZhdGUgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRob3NlIGl0ZW1zIGhhdmUgYWxzbyBiZWVuIHNoYXJlZCB0byBncm91cHNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgYSB3YXJuaW5nIG1vZGFsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd1JldmVydFNoYXJlTGV2ZWxXYXJuaW5nKHVzZXIsIGl0ZW1zLCBzZWxlY3RlZEdyb3VwRGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpcm1hdGlvbkRpYWxvZ1R5cGUgPSBcInB1YmxpY0FjY291bnRSZXZlcnRTaGFyZUxldmVsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2hhcmVMZXZlbCgpO1xuICAgICAgICAgICAgICAgICAgICB9IH0sIGkxOG4ucmV2ZXJ0KSkgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250ZW50LWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIsIGNsYXNzOiBcInRpbGUtc2VsZWN0XCIgfSwgc2hvd09wdGlvbnMgJiZcbiAgICAgICAgICAgICAgICBERUZBVUxUX1NIQVJFX0xFVkVMUy5tYXAoKG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW5ub3RTZWxlY3QgPSAhcG9zc2libGVTaGFyZUxldmVsT3B0aW9ucy5pbmNsdWRlcyhvcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2Fubm90U2VsZWN0ICYmIGlzUHVibGljVXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugb25seSB3YW50IHRvIGhpZGUgdGhlIG9wdGlvbiBmb3IgcHVibGljIHVzZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICBpbiBvdGhlciBjYXNlcywgd2UganVzdCB3YW50IHRvIGRpc2FibGUgdGhlbVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbUNvdW50ID0gc2hhcmVMZXZlbENvdW50W29wdGlvbl0gKyAob3B0aW9uID09PSBcInByaXZhdGVcIiA/IHNoYXJlTGV2ZWxDb3VudC5zaGFyZWQgOiAwKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzSXRlbUluQ2F0ZWdvcnkgPSBpdGVtQ291bnQgPiAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtQ291bnRTdHIgPSBpdGVtQ291bnQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBpMThuLnNoYXJlTGV2ZWwubGV2ZWxbb3B0aW9uXS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGlsZS1zZWxlY3Qtd3JhcHBlclwiLCBrZXk6IG9wdGlvbiB9LCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGNoZWNrZWQ6IGhhc1NpbmdsZVNoYXJlTGV2ZWwgJiYgaGFzSXRlbUluQ2F0ZWdvcnksIGhlYWRpbmc6IHRpdGxlLCBcImFyaWEtbGFiZWxcIjogY2Fubm90U2VsZWN0ID8gZGlzYWJsZWRUZXh0IDogdW5kZWZpbmVkLCBkZXNjcmlwdGlvbjogaTE4bi5zaGFyZUxldmVsLmxldmVsW29wdGlvbl1bXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwdWJsaWMgdXNlcnMgaGF2ZSBhIGRpZmZlcmVudCB0ZXh0IGRlc2NyaXB0aW9uIGZvciB0aGUgXCJldmVyeW9uZVwiIHNoYXJlIGxldmVsIChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMjY0MDUpXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1B1YmxpY1VzZXIgJiYgb3B0aW9uID09PSBcInB1YmxpY1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBcImRlc2NyaXB0aW9uUHVibGljVXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBcImRlc2NyaXB0aW9uXCJdLCBuYW1lOiBcImRldi1jcmVkLWNyZWF0ZS1tb2RlXCIsIGlucHV0RW5hYmxlZDogdHJ1ZSwgd2lkdGg6IFwiZnVsbFwiLCB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiBvcHRpb24sIGljb246IHNoYXJlTGV2ZWxJY29uW29wdGlvbl0sIGRpc2FibGVkOiBpc0xvYWRpbmcgfHwgY2Fubm90U2VsZWN0LCBjbGFzczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0aXZlLWJ1dC1ub3Qtc2VsZWN0ZWRcIjogaGFzSXRlbUluQ2F0ZWdvcnkgJiYgIWhhc1NpbmdsZVNoYXJlTGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZVRpbGVTZWxlY3RDaGFuZ2U6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3U2hhcmVMZXZlbCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGEgcHVibGljIHVzZXIgdHJpZXMgdG8gc2V0IGl0ZW0ocykgdG8gcHJpdmF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgaXRlbXMgYXJlIHNoYXJlZCB0byBncm91cHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNwbGF5IGEgd2FybmluZyBtb2RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQb3J0YWwgZG9lc24ndCBoYXZlIHRoZSBjb25jZXB0IG9mIHB1YmxpYyBhY2NvdW50IGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy80NjkxMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFwb3J0YWwuaXNQb3J0YWwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1NoYXJlTGV2ZWxDaGFuZ2VXYXJuaW5nKHVzZXIsIG5ld1NoYXJlTGV2ZWwsIHNlbGVjdGVkR3JvdXBEYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpcm1hdGlvbkRpYWxvZ1R5cGUgPSBcInB1YmxpY0FjY291bnRTZXRTaGFyZVRvUHJpdmF0ZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNoYXJlTGV2ZWwobmV3U2hhcmVMZXZlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IH0pLCAhaGFzU2luZ2xlU2hhcmVMZXZlbCAmJiBoYXNJdGVtSW5DYXRlZ29yeSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNoYXJlLWhpbnRcIiB9LCBoKFwiYXJjZ2lzLWluZm9ybWF0aW9uXCIsIHsgbGFiZWw6IGkxOG4uc2hhcmVDb3VudExhYmVsLCBwYWRkZWRDb250ZW50OiB0cnVlLCBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiB9LCBpMThuLnNoYXJlQ291bnRUb29sdGlwXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZShcIiR7c2hhcmVMZXZlbH1cIiwgdGl0bGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZShcIiR7bnVtSXRlbX1cIiwgaXRlbUNvdW50U3RyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoXCIke3RvdGFsSXRlbX1cIiwgdG90YWxJdGVtQ291bnRTdHIpKSwgaChcInBcIiwgbnVsbCwgaTE4bi5zaGFyZUNvdW50SGludFxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoXCIke251bUl0ZW19XCIsIGl0ZW1Db3VudFN0cilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiJHt0b3RhbEl0ZW19XCIsIHRvdGFsSXRlbUNvdW50U3RyKSkpKSkpO1xuICAgICAgICAgICAgICAgIH0pKSwgc2hvd09wdGlvbnMgJiYgcG9zc2libGVTaGFyZUxldmVsT3B0aW9ucy5sZW5ndGggPCBzaGFyZUxldmVsT3B0aW9ucy5sZW5ndGggJiYgKGgoXCJwXCIsIHsgY2xhc3M6IFwiaW5mb3JtYXRpb24tdGV4dFwiIH0sIGkxOG4uc2hhcmluZ0xpbWl0ZWREaXNjbGFpbWVyKSksICghc2hvd09wdGlvbnMgfHwgIXBvc3NpYmxlU2hhcmVMZXZlbE9wdGlvbnMubGVuZ3RoKSAmJiAoaChcInBcIiwgeyBjbGFzczogXCJpbmZvcm1hdGlvbi10ZXh0XCIgfSwgaTE4bi5ub1NoYXJlRGlzY2xhaW1lcikpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgaChcImFyY2dpcy1pdGVtLXNoYXJlLWdyb3VwXCIsIHsgaXRlbXM6IGl0ZW1zLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCwgY29uZmlnOiBjb25maWcsIHNoYXJlTW9kZTogc2hhcmVNb2RlLCBpMThuOiBpMThuLnNoYXJlR3JvdXAsIGlzTG9hZGluZzogaXNMb2FkaW5nLCBvbkVkaXRHcm91cENsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFB1YmxpYyBhY2NvdW50IG5lZWRzIHRvIHNoYXJlIGl0ZW0gdG8gcHVibGljIGJlZm9yZSBzaGFyaW5nIHRvIGdyb3Vwc1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd0VkaXRHcm91cFdhcm5pbmcodXNlciwgc2VsZWN0ZWRTaGFyZUxldmVscykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlybWF0aW9uRGlhbG9nVHlwZSA9IFwicHVibGljQWNjb3VudE9wZW5Hcm91cEJyb3dzZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQnJvd3NpbmdHcm91cHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0sIG9uQW5hbHl6ZVVzZXJHcm91cENvbXBsZXRlOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGluaXRpYWxTZWxlY3RlZEdyb3Vwczogc2VsZWN0ZWRHcm91cERhdGEsIHVzZXJHcm91cExvb2t1cCwgYWxsVXNlcnMsIHNlYXJjaFVzZXJuYW1lIH0gPSBlLmRldGFpbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsU2VsZWN0ZWRHcm91cERhdGEgPSBzZWxlY3RlZEdyb3VwRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwRGF0YSA9IHNlbGVjdGVkR3JvdXBEYXRhO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxTZWxlY3RlZEdyb3VwRGF0YUxvb2t1cCA9IGFycmF5VG9Mb29rdXBNYXAoc2VsZWN0ZWRHcm91cERhdGEsICh7IGdyb3VwLCBzZWxlY3RlZEJ5SXRlbUlkcyB9KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBncm91cC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNlbGVjdGVkQnlJdGVtSWRzLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gXCJub25lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHNlbGVjdGVkQnlJdGVtSWRzLmxlbmd0aCA9PT0gdG90YWxJdGVtQ291bnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBcImFsbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogXCJpbmRldGVybWluYXRlXCJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyb3VwQnJvd3NlclNlYXJjaFVzZXJuYW1lID0gc2VhcmNoVXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBCcm93c2VyQWxsVXNlcnMgPSBhbGxVc2VycztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cEJyb3dzZXJRID0gZ2V0VXNlcm5hbWVRdWVyeSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFyZU1vZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlcm5hbWU6IHNlYXJjaFVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJHcm91cExvb2t1cCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzUHJpdmF0ZTogaGFzUHJpdmF0ZUl0ZW1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgb25EaXJ0eUNoYW5nZTogKGUpID0+ICh0aGlzLmlzU2VsZWN0ZWRHcm91cHNEaXJ0eSA9IGUuZGV0YWlsKSwgb25SZW1vdmVDbGljazogKCkgPT4gKHRoaXMuc2VsZWN0ZWRHcm91cERhdGEgPSBbXSksIG9uUmV2ZXJ0Q2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dSZXZlcnRHcm91cFdhcm5pbmcodXNlciwgc2VsZWN0ZWRTaGFyZUxldmVscywgaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maXJtYXRpb25EaWFsb2dUeXBlID0gXCJwdWJsaWNBY2NvdW50UmV2ZXJ0R3JvdXBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXZlcnRHcm91cERhdGEoKTtcbiAgICAgICAgICAgICAgICB9LCBzZWxlY3RlZEdyb3VwRGF0YTogc2VsZWN0ZWRHcm91cERhdGEgfSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyU2hhcmVNb2RhbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY2xvc2VEaWFsb2csIGkxOG4sIGlzTG9hZGluZywgdXBkYXRlU2hhcmluZywgaXNTaGFyZUxldmVsRGlydHksIGlzU2VsZWN0ZWRHcm91cHNEaXJ0eSwgaXNCcm93c2luZ0dyb3VwcywgYXBwbHlQZW5kaW5nR3JvdXBEYXRhLCB1bkJyb3dzZUdyb3VwcywgcmVuZGVyU2hhcmVTZWxlY3RHcm91cCwgcmVuZGVyR3JvdXBCcm93c2VyLCBjdXJyZW50U3RlcCwgaGFzU2hhcmluZ0lzc3VlLCBwZW5kaW5nR3JvdXBCcm93c2VyRGF0YSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGhhc0NoYW5nZXMgPSBpc1NoYXJlTGV2ZWxEaXJ0eSB8fCBpc1NlbGVjdGVkR3JvdXBzRGlydHk7XG4gICAgICAgICAgICByZXR1cm4gKChjdXJyZW50U3RlcCA9PT0gXCJzaGFyZVwiIHx8IGhhc1NoYXJpbmdJc3N1ZSA9PT0gbnVsbCkgJiYgKGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgb25DYWxjaXRlTW9kYWxDbG9zZTogY2xvc2VEaWFsb2csXG4gICAgICAgICAgICAgICAgLy8gISBEb24ndCB1c2UgdGhlIGNvbmRpdGlvbiBkaXJlY3RseSBoZXJlIG9yIHRoZSBgb25DYWxjaXRlTW9kYWxDbG9zZWAgd2lsbCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICBvcGVuOiB0cnVlLCB3aWR0aFNjYWxlOiBpc0Jyb3dzaW5nR3JvdXBzID8gXCJtXCIgOiBcInNcIiwgb3V0c2lkZUNsb3NlRGlzYWJsZWQ6IHRydWUsIGVzY2FwZURpc2FibGVkOiB0cnVlLCBjbGFzczogeyBcImdyb3VwLWJyb3dzZXItbW9kYWxcIjogaXNCcm93c2luZ0dyb3VwcyB9IH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiIH0sIGkxOG5baXNCcm93c2luZ0dyb3VwcyA/IFwidGl0bGVHcm91cFwiIDogXCJ0aXRsZVwiXSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwic3RhZ2VcIiB9LCByZW5kZXJHcm91cEJyb3dzZXIoKSwgcmVuZGVyU2hhcmVTZWxlY3RHcm91cCgpKSwgIWlzQnJvd3NpbmdHcm91cHMgPyAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZVwiLCBraW5kOiBcImJyYW5kXCIsIFwiZGF0YS1pZFwiOiBcImNhbmNlbEJ1dHRvblwiLCBvbkNsaWNrOiAoKSA9PiBjbG9zZURpYWxvZygpLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bi5jYW5jZWwpLCBoYXNDaGFuZ2VzICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIGtpbmQ6IFwiYnJhbmRcIiwgXCJkYXRhLWlkXCI6IFwibmV4dEJ1dHRvblwiLCBvbkNsaWNrOiB1cGRhdGVTaGFyaW5nLCB3aWR0aDogXCJmdWxsXCIsIGRpc2FibGVkOiBpc0xvYWRpbmcgfSwgaTE4bi5zYXZlKSkpKSA6IChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lXCIsIGtpbmQ6IFwiYnJhbmRcIiwgXCJkYXRhLWlkXCI6IFwiY2FuY2VsQnV0dG9uXCIsIG9uQ2xpY2s6IHVuQnJvd3NlR3JvdXBzLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bi5jYW5jZWwpLCBwZW5kaW5nR3JvdXBCcm93c2VyRGF0YS5pc0RpcnR5ICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIGtpbmQ6IFwiYnJhbmRcIiwgb25DbGljazogYXBwbHlQZW5kaW5nR3JvdXBEYXRhLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bi5hcHBseSkpKSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyRGVwQ2hlY2tNb2RhbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgYXBpLCBjb25maWcsIHBvcnRhbCwgdXNlciwgaXRlbXMsIGNsb3NlRGlhbG9nLCBoYXNTaGFyaW5nSXNzdWUsIHNoYXJpbmdEZXRhaWwgfSA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gKGhhc1NoYXJpbmdJc3N1ZSAmJiAoaChcImFyY2dpcy1kZXBlbmRlbmN5LWNoZWNrXCIsIHsgYXBpOiBhcGksIGl0ZW1zOiBpdGVtcy5tYXAoKGl0ZW0pID0+ICh7IGl0ZW0gfSkpLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgY29uZmlnOiBjb25maWcsXG4gICAgICAgICAgICAgICAgLy8gISBEb24ndCB1c2UgdGhlIGNvbmRpdGlvbiBkaXJlY3RseSBoZXJlIG9yIHRoZSBgb25DYWxjaXRlTW9kYWxDbG9zZWAgd2lsbCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSwgcHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbDogc2hhcmluZ0RldGFpbCwgb25Xb3JrZmxvd0NhbmNlbDogY2xvc2VEaWFsb2csIG9uV29ya2Zsb3dDb21wbGV0ZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpZFVwZGF0ZVNoYXJpbmdEZXRhaWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBjYWxsIHRoaXMgc2luY2Ugd2UganVzdCB3YW50IHRvIGNsb3NlIHRoZSBtb2RhbFxuICAgICAgICAgICAgICAgICAgICAvLyAgYnV0IGlmIHdlIHdhbnQgdG8gc2hvdyBhbnkgdW5kZXJseWluZyBpc3N1ZSBhZnRlciByZWNoZWNrLCB3ZSBjYW4gZW5hYmxlIGl0XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrU2hhcmluZ0lzc3VlKHNlbGVjdGVkSXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZXZlcnQgc2hhcmluZyBkZXRhaWwgdG8gdHJpZ2dlciB0aGUgZW5kIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcmluZ0RldGFpbFRvRW1pdCA9IE9iamVjdC5hc3NpZ24oe30sIHNoYXJpbmdEZXRhaWwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYXJpbmdEZXRhaWwgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NIQVJJTkdfREVUQUlMKTtcbiAgICAgICAgICAgICAgICB9IH0pKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyQ29uZmlybWF0aW9uRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjb25maXJtYXRpb25EaWFsb2dUeXBlIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKCFjb25maXJtYXRpb25EaWFsb2dUeXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4sIGlzTG9hZGluZywgcmV2ZXJ0U2hhcmVMZXZlbCwgc2V0U2hhcmVMZXZlbCwgcmV2ZXJ0R3JvdXBEYXRhIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24gfSA9IGkxOG4uc2hhcmVXYXJuaW5nW2NvbmZpcm1hdGlvbkRpYWxvZ1R5cGVdO1xuICAgICAgICAgICAgY29uc3QgaXNQRENEaXNhYmxlZEVycm9yID0gY29uZmlybWF0aW9uRGlhbG9nVHlwZSA9PT0gXCJwdWJsaWNEYXRhQ29sbGVjdGlvbkRpc2FibGVkXCI7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgb25DYWxjaXRlTW9kYWxDbG9zZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpcm1hdGlvbkRpYWxvZ1R5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sIG9wZW46ICEhdGhpcy5jb25maXJtYXRpb25EaWFsb2dUeXBlLCB3aWR0aFNjYWxlOiBcInNcIiwgb3V0c2lkZUNsb3NlRGlzYWJsZWQ6IHRydWUsIGVzY2FwZURpc2FibGVkOiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCB0aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiB9LCBkZXNjcmlwdGlvbiksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwicHJpbWFyeVwiLCBhcHBlYXJhbmNlOiBpc1BEQ0Rpc2FibGVkRXJyb3IgPyBcInNvbGlkXCIgOiBcIm91dGxpbmVcIiwga2luZDogXCJicmFuZFwiLCBcImRhdGEtaWRcIjogXCJjYW5jZWxCdXR0b25cIiwgb25DbGljazogKCkgPT4gKHRoaXMuY29uZmlybWF0aW9uRGlhbG9nVHlwZSA9IG51bGwpLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bltpc1BEQ0Rpc2FibGVkRXJyb3IgPyBcIm9rXCIgOiBcImNhbmNlbFwiXSksICFpc1BEQ0Rpc2FibGVkRXJyb3IgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwic2Vjb25kYXJ5XCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwga2luZDogXCJicmFuZFwiLCBcImRhdGEtaWRcIjogXCJuZXh0QnV0dG9uXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjb25maXJtYXRpb25EaWFsb2dUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicHVibGljQWNjb3VudE9wZW5Hcm91cEJyb3dzZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTaGFyZUxldmVsKFwicHVibGljXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNCcm93c2luZ0dyb3VwcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicHVibGljQWNjb3VudFNldFNoYXJlVG9Qcml2YXRlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2hhcmVMZXZlbChcInByaXZhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwRGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInB1YmxpY0FjY291bnRSZXZlcnRTaGFyZUxldmVsXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2hhcmVMZXZlbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cERhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwdWJsaWNBY2NvdW50UmV2ZXJ0R3JvdXBcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTaGFyZUxldmVsKFwicHVibGljXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmVydEdyb3VwRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInB1YmxpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlybWVkUERDID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNoYXJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpcm1hdGlvbkRpYWxvZ1R5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6IGlzTG9hZGluZyB9LCBpMThuLnVwZGF0ZSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pdGVtcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oYXNUcnVzdGVkT3JncyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFNoYXJlTGV2ZWxzID0gW107XG4gICAgICAgIHRoaXMuaXNTaGFyZUxldmVsRGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaGFyZUxldmVsQ291bnQgPSB7XG4gICAgICAgICAgICBwcml2YXRlOiAwLFxuICAgICAgICAgICAgc2hhcmVkOiAwLFxuICAgICAgICAgICAgb3JnOiAwLFxuICAgICAgICAgICAgcHVibGljOiAwXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFzU2luZ2xlU2hhcmVMZXZlbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBEYXRhID0gW107XG4gICAgICAgIHRoaXMuaXNTZWxlY3RlZEdyb3Vwc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGluZ1RleHQgPSBudWxsO1xuICAgICAgICB0aGlzLmlzQnJvd3NpbmdHcm91cHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb25maXJtYXRpb25EaWFsb2dUeXBlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jb25maXJtZWRQREMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5icm93c2VyUGFnaW5hdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5icm93c2VyR3JvdXBzID0gW107XG4gICAgICAgIHRoaXMucGVuZGluZ0dyb3VwQnJvd3NlckRhdGEgPSB7XG4gICAgICAgICAgICBncm91cERhdGE6IFtdLFxuICAgICAgICAgICAgZ3JvdXBEYXRhTG9va3VwOiB7fSxcbiAgICAgICAgICAgIGdyb3VwQ291bnQ6IHt9LFxuICAgICAgICAgICAgaXNEaXJ0eTogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ncm91cEJyb3dzZXJRID0gXCJcIjtcbiAgICAgICAgdGhpcy5ncm91cEJyb3dzZXJTZWFyY2hVc2VybmFtZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZ3JvdXBCcm93c2VyQWxsVXNlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IFwic2hhcmVcIjtcbiAgICAgICAgdGhpcy5zaGFyaW5nRGV0YWlsID0gbnVsbDtcbiAgICAgICAgdGhpcy5oYXNTaGFyaW5nSXNzdWUgPSBudWxsO1xuICAgIH1cbiAgICBoYW5kbGVJc0Jyb3dzaW5nR3JvdXBzQ2hhbmdlKCkge1xuICAgICAgICBpZiAodGhpcy5pc0Jyb3dzaW5nR3JvdXBzKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZU5ld1BlbmRpbmdTZWxlY3RlZEdyb3Vwcyh0aGlzLnNlbGVjdGVkR3JvdXBEYXRhLm1hcCgoeyBncm91cCB9KSA9PiBncm91cCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVNoYXJlTGV2ZWxDaGFuZ2UoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRTaGFyZUxldmVscywgaW5pdGlhbFNoYXJlTGV2ZWxzLCBzZWxlY3RlZEdyb3VwRGF0YSwgaXRlbXMgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMuaXNTaGFyZUxldmVsRGlydHkgPSBpc1NoYXJlTGV2ZWxEaXJ0eShzZWxlY3RlZFNoYXJlTGV2ZWxzLCBpbml0aWFsU2hhcmVMZXZlbHMsIGl0ZW1zLCBzZWxlY3RlZEdyb3VwRGF0YSk7XG4gICAgICAgIHRoaXMuc2hhcmVMZXZlbENvdW50ID0gc2VsZWN0ZWRTaGFyZUxldmVscy5yZWR1Y2UoKGFjYywgY3VyKSA9PiB7XG4gICAgICAgICAgICBhY2NbY3VyXSsrO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwgeyBwcml2YXRlOiAwLCBzaGFyZWQ6IDAsIG9yZzogMCwgcHVibGljOiAwIH0pO1xuICAgICAgICB0aGlzLmhhc1NpbmdsZVNoYXJlTGV2ZWwgPSBzZWxlY3RlZFNoYXJlTGV2ZWxzLmV2ZXJ5KChjdXIpID0+IGN1ciA9PT0gc2VsZWN0ZWRTaGFyZUxldmVsc1swXSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLml0ZW1zLm1hcCgoaXRlbSkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBpdGVtLnNvdXJjZUpTT04pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGl0ZW07IH0pO1xuICAgICAgICBjb25zdCB7IGl0ZW1zLCBwb3J0YWwsIHVzZXIsIGVsIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICAvLyBUaGlzIGFzc3VtZSB0aGF0IG9uY2UgdGhlIGxvYWRpbmcgdGV4dCBjaGFuZ2VzIHRvIHVwZGF0aW5nSW5mbyxcbiAgICAgICAgLy8gIGl0IHdpbGwgbm90IGNoYW5nZSBiYWNrIHRvIHJldHJpZXZpbmdJbmZvXG4gICAgICAgIHRoaXMubG9hZGluZ1RleHQgPSB0aGlzLmkxOG4ucmV0cmlldmluZ0luZm87XG4gICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpO1xuICAgICAgICB0aGlzLmlzUHVibGljVXNlciA9IGlzUHVibGljVXNlcih1c2VyKTtcbiAgICAgICAgdGhpcy5pbml0aWFsU2hhcmVMZXZlbHMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uYWNjZXNzKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFNoYXJlTGV2ZWxzID0gWy4uLnRoaXMuaW5pdGlhbFNoYXJlTGV2ZWxzXTtcbiAgICAgICAgdGhpcy5wb3NzaWJsZVNoYXJlTGV2ZWxPcHRpb25zID0gZ2V0UG9zc2libGVTaGFyZUxldmVsKHVzZXIsIGl0ZW1zLCBwb3J0YWwpO1xuICAgICAgICBjb25zdCBzaGFyZU1vZGUgPSBnZXRTaGFyZU1vZGUoaXRlbXMsIHVzZXIsIHBvcnRhbCk7XG4gICAgICAgIHRoaXMuc2hvd09wdGlvbnMgPSBzaGFyZU1vZGUgIT09IFwiZ3JvdXBcIjtcbiAgICAgICAgdGhpcy5zaGFyZU1vZGUgPSBzaGFyZU1vZGU7XG4gICAgICAgIHRoaXMuaGFzUHJpdmF0ZUl0ZW0gPSBpdGVtcy5zb21lKChpdGVtKSA9PiBpdGVtLmFjY2VzcyA9PT0gXCJwcml2YXRlXCIpO1xuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb25JbmZvID0gKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5zdWJzY3JpcHRpb25JbmZvKSB8fCAoKF9hID0gcG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdWJzY3JpcHRpb25JbmZvKTtcbiAgICAgICAgdGhpcy5oYXNJdGVtQmxvY2tlZEZyb21QdWJsaWMgPVxuICAgICAgICAgICAgaXRlbXMuc29tZShpc0Jsb2NrZWRGcm9tU2hhcmluZ1RvUHVibGljKSB8fFxuICAgICAgICAgICAgICAgIChpc0RldmVsb3BlcihzdWJzY3JpcHRpb25JbmZvKSAmJiBpdGVtcy5zb21lKGlzQmxvY2tlZEZyb21EZXZlbG9wZXJTaGFyaW5nVG9QdWJsaWMpKTtcbiAgICAgICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gaXRlbXMuc29tZSgoaXRlbSkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiRWRpdEV4dGVuc2lvbkluZG9vcnNTcGFjZXNcIik7IH0pO1xuICAgIH1cbiAgICBoYW5kbGVTaGFyaW5nRGV0YWlsQ2hhbmdlKCkge1xuICAgICAgICBjb25zdCB7IHNoYXJpbmdEZXRhaWwgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMuaGFzU2hhcmluZ0lzc3VlID1cbiAgICAgICAgICAgIHNoYXJpbmdEZXRhaWwgIT09IG51bGxcbiAgICAgICAgICAgICAgICA/IE9iamVjdC5rZXlzKHNoYXJpbmdEZXRhaWwpLnNvbWUoKGRldGFpbFR5cGUpID0+IHNoYXJpbmdEZXRhaWxbZGV0YWlsVHlwZV0ubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgfVxuICAgIGhhbmRsZUhhc1NoYXJpbmdJc3N1ZUNoYW5nZSgpIHtcbiAgICAgICAgY29uc3QgeyBoYXNTaGFyaW5nSXNzdWUgfSA9IHRoaXM7XG4gICAgICAgIGlmIChoYXNTaGFyaW5nSXNzdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0ZXAgPSBcInJldmlldy1zaGFyaW5nXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaGFzU2hhcmluZ0lzc3VlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RlcCA9IFwiZmluaXNoXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQ3VycmVudFN0ZXBDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgY3VycmVudFN0ZXAsIGRpZFVwZGF0ZVNoYXJpbmdEZXRhaWwsIHdvcmtmbG93Q29tcGxldGUsIHNoYXJpbmdEZXRhaWxUb0VtaXQsIHNoYXJlSXRlbVJlc3VsdCB9ID0gdGhpcztcbiAgICAgICAgaWYgKGN1cnJlbnRTdGVwICE9PSBcImZpbmlzaFwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGlkVXBkYXRlRGVwZW5kZW50TGF5ZXJzU2hhcmluZyA9IGRpZFVwZGF0ZVNoYXJpbmdEZXRhaWw7XG4gICAgICAgIHdvcmtmbG93Q29tcGxldGUuZW1pdCh7XG4gICAgICAgICAgICAvLyBObyBwb2ludCBpbiB1cGRhdGluZyBkZXAgbGF5ZXJzIGlmIHRoZSB1c2VycyBkaWRuJ3QgZ28gdGhyb3VnaCByZXZpZXcgc2hhcmluZyBmbG93XG4gICAgICAgICAgICBkZXBlbmRlbnRMYXllcnNXaXRoU291cmNlSXRlbXM6IGRpZFVwZGF0ZURlcGVuZGVudExheWVyc1NoYXJpbmcgJiYgc2hhcmluZ0RldGFpbFRvRW1pdFxuICAgICAgICAgICAgICAgID8gT2JqZWN0LnZhbHVlcyhzaGFyaW5nRGV0YWlsVG9FbWl0KS5yZWR1Y2UoKGFjYywgaXRlbVNoYXJpbmdEZXRhaWxSZXN1bHRzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKC4uLml0ZW1TaGFyaW5nRGV0YWlsUmVzdWx0cy5tYXAoKHsgbGF5ZXIsIHNvdXJjZUl0ZW0gfSkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSXRlbVxuICAgICAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgICAgIH0sIFtdKVxuICAgICAgICAgICAgICAgIDogW10sXG4gICAgICAgICAgICBuZXdTaGFyZUxldmVsOiAoX2EgPSBzaGFyZUl0ZW1SZXN1bHQgPT09IG51bGwgfHwgc2hhcmVJdGVtUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaGFyZUl0ZW1SZXN1bHQubmV3U2hhcmVMZXZlbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbCxcbiAgICAgICAgICAgIHNoYXJlRXJyb3JzOiAoX2IgPSBzaGFyZUl0ZW1SZXN1bHQgPT09IG51bGwgfHwgc2hhcmVJdGVtUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaGFyZUl0ZW1SZXN1bHQuc2hhcmVFcnJvcnMpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdLFxuICAgICAgICAgICAgZGlkVXBkYXRlRGVwZW5kZW50TGF5ZXJzU2hhcmluZ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHJlbmRlclNoYXJlTW9kYWwsIHJlbmRlckRlcENoZWNrTW9kYWwsIHJlbmRlckNvbmZpcm1hdGlvbkRpYWxvZyB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCByZW5kZXJTaGFyZU1vZGFsKCksIHJlbmRlckRlcENoZWNrTW9kYWwoKSwgcmVuZGVyQ29uZmlybWF0aW9uRGlhbG9nKCkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiaXNCcm93c2luZ0dyb3Vwc1wiOiBbXCJoYW5kbGVJc0Jyb3dzaW5nR3JvdXBzQ2hhbmdlXCJdLFxuICAgICAgICBcInNlbGVjdGVkU2hhcmVMZXZlbHNcIjogW1wiaGFuZGxlU2hhcmVMZXZlbENoYW5nZVwiXSxcbiAgICAgICAgXCJzaGFyaW5nRGV0YWlsXCI6IFtcImhhbmRsZVNoYXJpbmdEZXRhaWxDaGFuZ2VcIl0sXG4gICAgICAgIFwiaGFzU2hhcmluZ0lzc3VlXCI6IFtcImhhbmRsZUhhc1NoYXJpbmdJc3N1ZUNoYW5nZVwiXSxcbiAgICAgICAgXCJjdXJyZW50U3RlcFwiOiBbXCJoYW5kbGVDdXJyZW50U3RlcENoYW5nZVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNJdGVtU2hhcmUuc3R5bGUgPSBhcmNnaXNJdGVtU2hhcmVDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0l0ZW1TaGFyZSBhcyBhcmNnaXNfaXRlbV9zaGFyZSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaXRlbS1zaGFyZS5lbnRyeS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=