"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-af57d3"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-color-size-slider_3.entry.js":
/*!*******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-color-size-slider_3.entry.js ***!
  \*******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_color_size_slider: () => (/* binding */ ArcgisSmartMappingColorSizeSlider),
/* harmony export */   arcgis_smart_mapping_symbol_pair_button: () => (/* binding */ ArcgisSmartMappingSymbolPairButton),
/* harmony export */   arcgis_smart_mapping_symbol_pair_popover: () => (/* binding */ ArcgisSmartMappingSymbolPairPopover)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./date-79c7d93c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _precision_06a73672_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./precision-06a73672.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/precision-06a73672.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./slider-e162e136.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/slider-e162e136.js");
/* harmony import */ var _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./colorSizeUnivariant-d266ac7c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSizeUnivariant-d266ac7c.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./color-d6da0a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-d6da0a9a.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
















const arcgisSmartMappingColorSizeSliderCss = ".slider-box{height:320px}.slider-box .esri-color-size-slider,.slider-box .esri-binary-color-size-slider{min-width:200px}.slider-box .esri-color-size-slider .esri-slider .esri-slider__content,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-color-size-slider__histogram-container,.slider-box .esri-binary-color-size-slider__histogram-container{width:85px}.slider-box .esri-color-size-slider .esri-slider .esri-slider__label,.slider-box .esri-color-size-slider .esri-slider .esri-slider__min,.slider-box .esri-color-size-slider .esri-slider .esri-slider__max,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__label,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__min,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-color-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-color-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-color-size-slider .esri-slider .esri-slider__max:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-binary-color-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}";

const ArcgisSmartMappingColorSizeSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingColorSizeSliderChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingColorSizeSliderChange", 7);
        this.arcgisSmartMappingColorSizeSliderError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingColorSizeSliderError", 7);
        /**
         * Necessary for tracking stops for non-classed sliders,
         * whose values are updated immediately even given incorrect inputs.
         */
        this.currentColorStopValues = [];
        this.currentSizeStopSizes = [];
        this.zigzagClick = false;
        this.styleSheetStatus = "not-loaded";
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.sliderZoomed = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Calls
    //
    //--------------------------------------------------------------------------
    async updateStatistics() {
        var _a;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statistics = null;
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.histogram = null;
        (_a = this.colorSizeSlider) === null || _a === void 0 ? void 0 : _a.destroy();
        this.colorSizeSlider = undefined;
        this.sliderZoomed = false;
        this.getStatistics();
    }
    // -------------------------------------------------------------------
    //
    // Lifecycle
    //
    // -------------------------------------------------------------------
    componentWillLoad() {
        this.getStatistics();
    }
    componentDidLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("link", { rel: "stylesheet", href: `${config.jsapiUrl}/themes/light/main.css`, onLoad: () => {
                this.styleSheetStatus = "loaded";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, onError: () => {
                this.styleSheetStatus = "failed";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.styleSheetStatus === "loaded"
            ? this.renderColorSizeSlider()
            : this.styleSheetStatus === "not-loaded"
                ? this.renderColorSizeSliderLoading()
                : null));
    }
    renderColorSizeSlider() {
        var _a, _b, _c, _d;
        const { histogramStatus, statistics, statisticsStatus, sliderZoomed } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED || statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING) {
            if (this.colorSizeSlider) {
                this.colorSizeSlider.destroy();
                this.colorSizeSlider = undefined;
            }
        }
        else if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS ||
            (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS && !this.colorSizeSlider)) {
            return this.renderColorSizeSliderLoading();
        }
        else {
            const ok = this.prepareColorSizeSlider();
            let disableZoomButton = false;
            if (colorVisVar && !sliderZoomed) {
                const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
                const stops = (0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__.g)();
                const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(stops, (_a = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue) !== null && _a !== void 0 ? _a : statistics.min, (_b = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : statistics.max);
                if ((zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.minMaxSame) ||
                    (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.max))) {
                    disableZoomButton = true;
                    if (this.zoomButtonNode) {
                        this.zoomButtonNode.disabled = true;
                    }
                }
            }
            else if (sizeVisVar && !sliderZoomed) {
                const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
                const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(isAboveAndBelow
                    ? sizeVisVar.stops
                    : [{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], (_c = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _c !== void 0 ? _c : statistics.min, (_d = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _d !== void 0 ? _d : statistics.max);
                if (zoomOptions.minMaxSame ||
                    (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.max))) {
                    disableZoomButton = true;
                    if (this.zoomButtonNode) {
                        this.zoomButtonNode.disabled = true;
                    }
                }
            }
            if (colorVisVar) {
                this.currentColorStopValues = colorVisVar.stops.map((stop) => stop.value);
            }
            if (sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.stops) {
                this.currentSizeStopSizes = sizeVisVar.stops.map((stop) => stop.size);
            }
            if (ok || this.colorSizeSlider) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.colorSizeSlider.dataRange), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box-buttons-front" }, this.renderInvertButton(), sizeVisVar && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderZoomButton(disableZoomButton), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderResetButton()))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                        if (node) {
                            this.afterColorSizeSliderCreate(node);
                        }
                    } })));
            }
            else {
                return this.renderColorSizeSliderLoading();
            }
        }
    }
    renderColorSizeSliderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderInvertButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.colorSizeSlider.invertSlider, icon: "arrowUpDown", onClick: () => this.handleInvertSlider() }));
    }
    renderZoomButton(disableZoomButton) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { sliderZoomed } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.colorSizeSlider.zoomSlider, icon: sliderZoomed ? "magnifyingGlassMinus" : "magnifyingGlassPlus", disabled: disableZoomButton, onClick: () => this.handleZoomSlider(), ref: (node) => {
                if (node) {
                    this.zoomButtonNode = node;
                }
            } }));
    }
    renderResetButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.colorSizeSlider.resetSlider, icon: "undo", onClick: () => this.handleResetSlider() }));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    prepareColorSizeSlider() {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        const { statistics, histogram, histogramStatus, sliderZoomed } = this;
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        const fieldInfo = this.getFieldInfo();
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
        let handleInfo, min, max;
        if (authColorVisVar) {
            handleInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aD)(authColorVisVar.theme, colorVisVar.stops, true);
            min = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue;
            max = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue;
        }
        else {
            min = (_a = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _a !== void 0 ? _a : statistics.min;
            max = (_b = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : statistics.max;
        }
        ({ min, max } = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)({ min, max }));
        const slider = this.colorSizeSlider;
        if (this.colorSizeSlider &&
            ((colorVisVar && slider.style) || (!colorVisVar && !slider.style))) {
            (_c = this.colorSizeSlider) === null || _c === void 0 ? void 0 : _c.destroy();
            this.colorSizeSlider = undefined;
        }
        if (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return false;
        }
        if (!this.colorSizeSlider) {
            this.colorSliderBars = [];
            let config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max
            };
            if (isAboveAndBelow) {
                config.primaryHandleEnabled = true;
                config.persistSizeRangeEnabled = true;
            }
            if (isDateField) {
                config.hasTimeData = true;
                (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.a)(config, mapView.timeZone);
            }
            if (colorVisVar) {
                config = Object.assign(Object.assign({}, config), handleInfo);
                config.stops = (0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__.g)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_5__.g)(colorVisVar.stops);
                config.histogramConfig.barCreatedFunction =
                    histogram && _slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.b.bind(this, config, histogram, this.colorSliderBars);
                this.colorSizeSlider = new modules.ColorSizeSlider(config);
                (0,_slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.u)(this.colorSizeSlider, this.colorSliderBars);
            }
            else {
                config.style = {
                    trackBelowFillColor: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[0].symbol) ||
                        new modules.esriColor([0, 0, 0, 0.5]),
                    trackAboveFillColor: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[1].symbol) ||
                        new modules.esriColor([0, 0, 0, 0.5])
                };
                config.stops = sizeVisVar.stops;
                config.handlesSyncedToPrimary = false;
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_5__.g)(config.stops);
                this.colorSizeSlider = new modules.BinaryColorSizeSlider(config);
            }
            this.createColorSizeSliderChangeEvents();
        }
        else {
            const slider = this.colorSizeSlider;
            if (((_d = slider.slider) === null || _d === void 0 ? void 0 : _d.state) === "dragging") {
                return true;
            }
            let config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max
            };
            if (colorVisVar) {
                config = Object.assign(Object.assign({}, config), handleInfo);
                config.stops = (0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__.g)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_5__.g)(config.stops);
                config.hasTimeData = isDateField && !isAgeRenderer;
                if (isDateField) {
                    (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.a)(config, mapView.timeZone);
                }
                if (sliderZoomed) {
                    /**
                     * clicking a zigzag already updates the internal slider zoomOptions;
                     * setting them here again would incorrectly override a user's decision
                     * to manually zoom out one side of the slider.
                     */
                    if (!this.zigzagClick) {
                        config.zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(colorVisVar.stops, (_e = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue) !== null && _e !== void 0 ? _e : statistics.min, (_f = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue) !== null && _f !== void 0 ? _f : statistics.max);
                    }
                }
                else {
                    config.zoomOptions = null;
                }
                config.histogramConfig.barCreatedFunction =
                    histogram && _slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.b.bind(this, colorVisVar, histogram, this.colorSliderBars);
                (0,_slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.u)(this.colorSizeSlider, this.colorSliderBars, config, histogram);
            }
            else {
                config.style = {
                    trackBelowFillColor: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[0].symbol) ||
                        new modules.esriColor([0, 0, 0, 0.5]),
                    trackAboveFillColor: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[1].symbol) ||
                        new modules.esriColor([0, 0, 0, 0.5])
                };
                config.stops = sizeVisVar.stops;
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_5__.g)(config.stops);
                if (sliderZoomed) {
                    /**
                     * clicking a zigzag already updates the internal slider zoomOptions;
                     * setting them here again would incorrectly override a user's decision
                     * to manually zoom out one side of the slider.
                     */
                    if (!this.zigzagClick) {
                        config.zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(isAboveAndBelow
                            ? sizeVisVar.stops
                            : [{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], (_g = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _g !== void 0 ? _g : statistics.min, (_h = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _h !== void 0 ? _h : statistics.max);
                    }
                }
                else {
                    config.zoomOptions = null;
                }
            }
            if (this.sliderZoomed && this.adjustedZoomOptions && !this.zigzagClick) {
                config.zoomOptions = this.adjustedZoomOptions;
                /**
                 * handles edge cases where the slider is zoomed, handles have been manually modified,
                 * and a user executes a label change. This prevents zoom options from changing and preserves
                 * the histogram display.
                 */
                if (this.zoomAdjustment === "min") {
                    this.colorSizeSlider.slider.min = config.zoomOptions.min;
                    config.zoomOptions.min = null;
                }
                else {
                    this.colorSizeSlider.slider.max = config.zoomOptions.max;
                    config.zoomOptions.max = null;
                }
            }
            this.adjustedZoomOptions = null;
            this.zoomAdjustment = null;
            this.colorSizeSlider.set(config);
            this.zigzagClick = false;
        }
        return (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.colorSizeSlider);
    }
    handleInvertSlider() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (colorVisVar) {
            let colors = colorVisVar.stops.map((colorStop) => {
                return colorStop.color;
            });
            colors = colors.reverse();
            colorVisVar.stops.forEach((colorStop, idx) => {
                colorStop.color = colors[idx];
            });
        }
        else {
            const color = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[0].symbol);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(renderer.classBreakInfos[0].symbol, (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(renderer.classBreakInfos[1].symbol));
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(renderer.classBreakInfos[1].symbol, color);
        }
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        [sizeVisVar.minSize, sizeVisVar.maxSize] = [sizeVisVar.maxSize, sizeVisVar.minSize];
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        this.arcgisSmartMappingColorSizeSliderChange.emit();
    }
    handleZoomSlider(zoomed) {
        var _a, _b, _c, _d;
        if (this.histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return;
        }
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        this.sliderZoomed = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomed) ? zoomed : !this.sliderZoomed;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (!sizeVisVar) {
            this.sliderZoomed = false;
        }
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        const fieldInfo = this.getFieldInfo();
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const zoomOptions = this.sliderZoomed
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(isAboveAndBelow
                ? sizeVisVar.stops
                : [{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], (_a = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _a !== void 0 ? _a : statistics.min, (_b = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : statistics.max)
            : null;
        this.getHistogram(fieldInfo, normalizationField, statistics, (zoomOptions && zoomOptions.min) || ((_c = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _c !== void 0 ? _c : statistics.min), (zoomOptions && zoomOptions.max) || ((_d = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _d !== void 0 ? _d : statistics.max));
    }
    handleResetSlider() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        this.sliderZoomed = false;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const fieldInfo = this.getFieldInfo();
        const normalizationField = colorVisVar
            ? colorVisVar.normalizationField
            : renderer.normalizationField;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)((0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__.a)({
            fieldInfos: [fieldInfo],
            normalizationField: sizeVisVar.normalizationField,
            theme: authInfo.univariateTheme,
            isContinuous: !!colorVisVar,
            noReuse: true,
            discardMinMax: true
        }), this.flowItemNode).then((result) => {
            var _a;
            if (((_a = result.statistics) === null || _a === void 0 ? void 0 : _a.count) === 0) {
                // field has no values
                // make up some basic statistics so we show a slider
                const [defaultMin, defaultMax] = this.getDefaultDataRange(fieldInfo);
                const min = (authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue) || defaultMin;
                const max = (authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue) || defaultMax;
                result.statistics.min = min;
                result.statistics.max = max;
                result.statistics.avg = (max + min) / 2;
                this.statistics = result.statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
            }
            else if (result.statistics &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(result.statistics.min) &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(result.statistics.max) &&
                result.statistics.min <= result.statistics.max) {
                this.statistics = result.statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, result.statistics, result.statistics.min, result.statistics.max);
            }
            else {
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            }
            if (authColorVisVar) {
                authColorVisVar.minSliderValue = this.statistics.min;
                authColorVisVar.maxSliderValue = this.statistics.max;
            }
            authSizeVisVar.minSliderValue = this.statistics.min;
            authSizeVisVar.maxSliderValue = this.statistics.max;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        }, (error) => this.arcgisSmartMappingColorSizeSliderError.emit(error));
    }
    afterColorSizeSliderCreate(node) {
        const divNode = document.createElement("div");
        node.appendChild(divNode);
        if (this.colorSizeSlider && !this.colorSizeSlider.container) {
            this.colorSizeSlider.container = divNode;
        }
    }
    getStatistics() {
        /**
         * Handles the following:
         *  1.) Retrieving statistics on slider load
         *  2.) Retrieving updated statistics after changing normalization field or theme
         */
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        let min;
        let max;
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        min = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue;
        max = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        if (!this.statistics) {
            modules
                .summaryStatistics({
                layer,
                view: mapView,
                field: fieldInfo.field,
                valueExpression: fieldInfo.expression,
                normalizationField,
                forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
            })
                .then((statistics) => {
                if (statistics.count === 0) {
                    // field has no values
                    // make up some basic statistics so we can show a slider
                    const [defaultMin, defaultMax] = this.getDefaultDataRange(fieldInfo);
                    const min = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) || defaultMin;
                    const max = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) || defaultMax;
                    statistics.min = min;
                    statistics.max = max;
                    statistics.avg = (max + min) / 2;
                    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(authSizeVisVar.minSliderValue)) {
                        authSizeVisVar.minSliderValue = min;
                        authSizeVisVar.maxSliderValue = max;
                    }
                }
                else if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.avg) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.min) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.max)) {
                    // statistics unusable
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                    return;
                }
                statistics = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)(statistics);
                min = min !== null && min !== void 0 ? min : statistics.min;
                max = max !== null && max !== void 0 ? max : statistics.max;
                this.statistics = statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
            }, (error) => {
                console.log(error);
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            });
        }
    }
    getHistogram(fieldInfo, normalizationField, statistics, min, max) {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        statistics = statistics || this.statistics;
        if (!statistics || statistics.count === 0) {
            return;
        }
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        modules
            .histogram({
            layer: layer,
            view: mapView,
            field: fieldInfo.field,
            valueExpression: fieldInfo.expression,
            numBins: 50,
            minValue: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) ? min : statistics.min,
            maxValue: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) ? max : statistics.max,
            normalizationField,
            forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
        })
            .then((histogram) => {
            this.histogram = histogram;
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
        }, () => {
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
        });
    }
    onMinMaxChange(min, max, changing) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.univariateTheme) === "above-and-below";
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.stops) {
            min = Math.min(min, colorVisVar.stops[0].value);
            max = Math.max(max, colorVisVar.stops[colorVisVar.stops.length - 1].value);
        }
        if (isAboveAndBelow) {
            min = Math.min(min, sizeVisVar.stops[0].value);
            max = Math.max(max, sizeVisVar.stops[sizeVisVar.stops.length - 1].value);
            sizeVisVar.stops.forEach((stop, idx) => {
                stop.size = this.currentSizeStopSizes[idx];
            });
        }
        this.handleMinMaxChange(min, max, changing);
    }
    handleMinMaxChange(min, max, changing) {
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color") || {};
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size") || {};
        // update only the label that the user is changing
        if (changing === "min") {
            authColorVisVar.minSliderValue = min;
            authSizeVisVar.minSliderValue = min;
        }
        else {
            authColorVisVar.maxSliderValue = max;
            authSizeVisVar.maxSliderValue = max;
        }
        // determine if label updates merit zooming or not
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.stops, authColorVisVar.minSliderValue, authColorVisVar.maxSliderValue);
        // handles zoom button display for non-classed color sliders
        if (this.zoomButtonNode) {
            if (this.sliderZoomed) {
                this.zoomButtonNode.disabled = false;
            }
            else if (!zoomOptions ||
                zoomOptions.minMaxSame ||
                (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.max))) {
                this.zoomButtonNode.disabled = true;
            }
            else {
                this.zoomButtonNode.disabled = false;
            }
        }
        // zoom adjustment
        if (this.sliderZoomed) {
            this.adjustedZoomOptions = this.colorSizeSlider.zoomOptions;
            if (changing === "min") {
                this.adjustedZoomOptions.min = min;
                this.zoomAdjustment = "min";
            }
            else {
                this.adjustedZoomOptions.max = max;
                this.zoomAdjustment = "max";
            }
        }
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
        (0,_slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.u)(this.colorSizeSlider, this.colorSliderBars, colorVisVar, this.histogram);
        if (min === authColorVisVar.minSliderValue && max === authColorVisVar.maxSliderValue) {
            this.sliderZoomed = false;
        }
        renderer.authoringInfo.classificationMethod = "manual";
        this.arcgisSmartMappingColorSizeSliderChange.emit();
    }
    createColorSizeSliderChangeEvents() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        const fieldInfo = this.getFieldInfo();
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        if (!this.colorSizeSlider) {
            return;
        }
        // handles zigzag click
        this.colorSizeSlider.watch("zoomOptions", (newValue, oldValue) => {
            if (this.sliderZoomed &&
                (((oldValue === null || oldValue === void 0 ? void 0 : oldValue.min) && !(newValue === null || newValue === void 0 ? void 0 : newValue.min)) || ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.max) && !(newValue === null || newValue === void 0 ? void 0 : newValue.max)))) {
                this.zigzagClick = true;
                this.handleZigzagClick(newValue);
            }
        });
        this.colorSizeSlider.on("min-change", (info) => {
            if (info.value > this.currentColorStopValues[0]) {
                this.colorSizeSlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentColorStopValues[idx];
                });
                this.onMinMaxChange(this.currentColorStopValues[0], this.colorSizeSlider.slider.max, "min");
            }
            else {
                this.onMinMaxChange(info.value, this.colorSizeSlider.slider.max, "min");
            }
        });
        this.colorSizeSlider.on("max-change", (info) => {
            if (info.value < this.currentColorStopValues[this.currentColorStopValues.length - 1]) {
                this.colorSizeSlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentColorStopValues[idx];
                });
                this.onMinMaxChange(this.colorSizeSlider.slider.min, this.currentColorStopValues[this.currentColorStopValues.length - 1], "max");
            }
            else {
                this.onMinMaxChange(this.colorSizeSlider.slider.min, info.value, "max");
            }
        });
        this.colorSizeSlider.on("thumb-change", (info) => {
            if (sizeVisVar) {
                if (isDateField && !isAgeRenderer && info.value === 0) {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    return;
                }
                this.updateRendererStops(this.colorSizeSlider.stops);
            }
        });
        this.colorSizeSlider.on("thumb-drag", () => {
            if (sizeVisVar) {
                const stops = this.colorSizeSlider.stops;
                this.updateRendererStops(stops);
            }
        });
        this.colorSizeSlider.on("segment-drag", () => {
            this.updateRendererStops(this.colorSizeSlider.stops);
        });
    }
    updateRendererStops(stops) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        if (sizeVisVar.stops) {
            sizeVisVar.stops.forEach((stop, idx) => {
                stop.value = stops[idx].value;
                stop.size = stops[idx].size;
                stop.label = "";
            });
        }
        else {
            sizeVisVar.minDataValue = stops[0].value;
            sizeVisVar.maxDataValue = stops[stops.length - 1].value;
        }
        if (colorVisVar) {
            colorVisVar.stops.forEach((stop, idx) => {
                stop.value = stops[idx].value;
                stop.color = stops[idx].color;
                stop.label = "";
            });
        }
        this.currentColorStopValues = stops.map((stop) => stop.value);
        this.currentSizeStopSizes = stops.map((stop) => stop.size);
        if (renderer.classBreakInfos.length === 2) {
            renderer.classBreakInfos[0].maxValue = stops[2].value;
            renderer.classBreakInfos[1].minValue = stops[2].value;
        }
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(isAboveAndBelow
            ? sizeVisVar.stops
            : [{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue, authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue);
        if (this.sliderZoomed) {
            this.zoomButtonNode.disabled = false;
        }
        else if (!zoomOptions ||
            zoomOptions.minMaxSame ||
            (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.max))) {
            this.zoomButtonNode.disabled = true;
        }
        else {
            this.zoomButtonNode.disabled = false;
        }
        (0,_slider_e162e136_js__WEBPACK_IMPORTED_MODULE_7__.u)(this.colorSizeSlider, this.colorSliderBars);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    getDefaultDataRange(fieldInfo) {
        if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE) {
            const year = new Date().getFullYear();
            return [new Date(`1/1/${year}`).getTime(), new Date(`12/31/${year}`).getTime()];
        }
        else {
            return [0, 100];
        }
    }
    getFieldInfo() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(sizeVisVar ? sizeVisVar.field : renderer.field);
        const fieldInfo = {
            field: (sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.field) || renderer.field,
            expression: (sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.valueExpression) || renderer.valueExpression,
            expressionTitle: (sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.valueExpressionTitle) || renderer.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        return fieldInfo;
    }
    handleZigzagClick(newValue) {
        var _a, _b;
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        this.getHistogram(fieldInfo, normalizationField, statistics, (_a = newValue === null || newValue === void 0 ? void 0 : newValue.min) !== null && _a !== void 0 ? _a : authSizeVisVar.minSliderValue, (_b = newValue === null || newValue === void 0 ? void 0 : newValue.max) !== null && _b !== void 0 ? _b : authSizeVisVar.maxSliderValue);
        if (!newValue) {
            this.sliderZoomed = false;
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingColorSizeSlider.style = arcgisSmartMappingColorSizeSliderCss;

const arcgisSmartMappingSymbolPairButtonCss = ".symbol-pair-name{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);outline-color:var(--calcite-color-foreground-3);outline-width:1px;outline-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.symbol-pair-name:hover{outline-width:2px}.symbol-pair-name:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}";

const ArcgisSmartMappingSymbolPairButton = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingSymbolPairButtonChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolPairButtonChange", 7);
        this.arcgisSmartMappingSymbolPairButtonBeforeOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolPairButtonBeforeOpen", 7);
        this.arcgisSmartMappingSymbolPairButtonError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolPairButtonError", 7);
        this.symbolPairPopoverOpen = false;
    }
    arcgisSmartMappingClosePopoversHandler() {
        var _a;
        this.symbolPairPopoverOpen = false;
        if (this.symbolPairPopoverNode) {
            (_a = this.symbolPairPopoverNode.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.symbolPairPopoverNode);
            this.symbolPairPopoverNode = null;
        }
    }
    //--------------------------------------------------------------------------
    //
    // Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
        this.allSymbolPairs = [
            ["single", strings.symbolPairButton.singleSymbol],
            ["circle", strings.symbolPairButton.circles],
            ["square", strings.symbolPairButton.squares],
            ["caret", strings.symbolPairButton.chevrons],
            ["circle-caret", strings.symbolPairButton.circlesChevrons],
            ["arrow", strings.symbolPairButton.arrows],
            ["circle-arrow", strings.symbolPairButton.circleArrows],
            ["plus-minus", strings.symbolPairButton.plusMinus],
            ["circle-plus-minus", strings.symbolPairButton.circlePlusMinus],
            ["happy-sad", strings.symbolPairButton.faces],
            ["triangle", strings.symbolPairButton.triangles],
            ["thumb", strings.symbolPairButton.thumbs]
        ];
    }
    //--------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const symbolStyle = authInfo.univariateSymbolStyle;
        let symbolPairName = strings.symbolPairButton.singleSymbol;
        this.allSymbolPairs.forEach((symbolPair) => {
            if (symbolStyle === symbolPair[0]) {
                symbolPairName = symbolPair[1];
            }
        });
        if (symbolStyle === "custom") {
            symbolPairName = strings.symbolPairButton.custom;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.symbolPairButton.symbolPair, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { ref: (node) => (this.symbolPairButtonNode = node), scale: "m", alignment: "icon-end-space-between", iconEnd: "chevron-down", appearance: "outline-fill", width: "full", tabindex: "0", role: "button", kind: "neutral", "aria-haspopup": "true", label: strings.symbolPairButton.symbolPair, onClick: () => this.symbolPairPopoverOpen ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)() : this.handleSymbolPairClick() }, symbolPairName)));
    }
    //--------------------------------------------------------------------------
    //
    // Private Methods
    //
    //--------------------------------------------------------------------------
    handleSymbolPairClick() {
        this.arcgisSmartMappingSymbolPairButtonBeforeOpen.emit();
        const symbolPicker = document.createElement("arcgis-smart-mapping-symbol-pair-popover");
        this.symbolPairPopoverNode = symbolPicker;
        symbolPicker.popoverProps = {
            refElement: this.flowItemNode,
            placement: "leading",
            offsetDistance: 0,
            overlayPositioning: "absolute",
            flipDisabled: false,
            triggerDisabled: false
        };
        symbolPicker.symbolPairs = this.allSymbolPairs;
        symbolPicker.addEventListener("arcgisSmartMappingSymbolPairPopoverClose", () => this.closePopover());
        symbolPicker.addEventListener("arcgisSmartMappingSymbolPairPopoverChange", (event) => {
            const symbolStyle = event.detail;
            this.closePopover();
            const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)((0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_8__.a)({ symbolStyle: symbolStyle }), this.flowItemNode).then((result) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.arcgisSmartMappingSymbolPairButtonChange.emit();
            }, (error) => this.arcgisSmartMappingSymbolPairButtonError.emit(error));
        });
        document.body.appendChild(symbolPicker);
        this.symbolPairPopoverOpen = true;
    }
    closePopover() {
        var _a;
        this.symbolPairPopoverOpen = false;
        if (this.symbolPairPopoverNode) {
            (_a = this.symbolPairPopoverNode.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.symbolPairPopoverNode);
            this.symbolPairPopoverNode = null;
            setTimeout(() => this.symbolPairButtonNode.setFocus(), 300);
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingSymbolPairButton.style = arcgisSmartMappingSymbolPairButtonCss;

const ArcgisSmartMappingSymbolPairPopover = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingSymbolPairPopoverClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolPairPopoverClose", 7);
        this.arcgisSmartMappingSymbolPairPopoverChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolPairPopoverChange", 7);
        this.resizeObserver = new ResizeObserver((boundingRects) => {
            const panel = boundingRects.pop();
            this.popoverWidth = panel.contentRect.width * 1.05;
            this.offsetDistance = -Math.round(this.popoverProps.refElement.getBoundingClientRect().width * 1.025);
        });
        this.popoverProps = undefined;
        this.symbolPairs = undefined;
        this.popoverWidth = undefined;
    }
    // --------------------------------------------------------------------------
    //
    //  Public Calls
    //
    // --------------------------------------------------------------------------
    async setFocus() {
        this.calcitePopoverNode.setFocus();
    }
    // --------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    // --------------------------------------------------------------------------
    componentDidLoad() {
        requestAnimationFrame(() => this.calcitePopoverNode.setFocus());
        this.resizeObserver.observe(this.popoverProps.refElement);
    }
    disconnectedCallback() {
        this.resizeObserver.unobserve(this.popoverProps.refElement);
    }
    // --------------------------------------------------------------------------
    //
    // Render  Methods
    //
    // --------------------------------------------------------------------------
    render() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const props = this.popoverProps;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { ref: (node) => (this.calcitePopoverNode = node), dir: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.isRTL ? "rtl" : "ltr", placement: "leading-start", open: true, heading: strings.symbolPairButton.symbolPair, closable: true, pointerDisabled: true, referenceElement: props.refElement, offsetDistance: this.offsetDistance, offsetSkidding: 105, overlayPositioning: props.overlayPositioning, triggerDisabled: props.triggerDisabled, label: strings.symbolPairButton.symbolPair, onCalcitePopoverClose: () => this.arcgisSmartMappingSymbolPairPopoverClose.emit(), style: { width: `${this.popoverWidth}px` } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { selectionMode: "single-persist" }, this.renderItems()))));
    }
    renderItems() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const symbolStyle = authInfo.univariateSymbolStyle || "single";
        const items = [];
        this.symbolPairs.forEach((symbolPair) => {
            items.push(this.renderItem(symbolPair[0], symbolPair[1], symbolStyle === symbolPair[0]));
        });
        return items;
    }
    renderItem(symbolType, label, isSelected) {
        const imagePath = symbolType.charAt(0).toUpperCase() + symbolType.slice(1) + ".svg";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { label: label, selected: isSelected, onClick: () => this.arcgisSmartMappingSymbolPairPopoverChange.emit(symbolType), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.arcgisSmartMappingSymbolPairPopoverChange.emit(symbolType);
                }
            } }, symbolType !== "single" ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", slot: "actions-end", text: "symbol-pair-symbols" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { style: {
                width: "32px",
                height: "32px",
                backgroundImage: `url(${(0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/arcgis-smart-mapping-symbol-pair-images/`)}${imagePath})`
            } }))) : null));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};



//# sourceMappingURL=arcgis-smart-mapping-color-size-slider_3.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addDateFormatFunctions),
/* harmony export */   b: () => (/* binding */ utcToTimePicker),
/* harmony export */   d: () => (/* binding */ datePickerToUTC),
/* harmony export */   u: () => (/* binding */ utcToDatePicker)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function addDateFormatFunctions(config, timeZone) {
    config.labelFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputParseFunction = (value) => {
        return mapTZToUTC(Date.parse(value), timeZone);
    };
}
function utcToDatePicker(value, timeZone) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // console.log("utcToDatePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function utcToTimePicker(value, timeZone, addSeconds) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // str = "2023-09-20T13:06:00.000Z"
    str = addSeconds ? str.substring(11, 19) : str.substring(11, 16);
    // console.log("utcToTimePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function datePickerToUTC(dateString, timeZone) {
    // date is in map timezone
    // we need a UTC UNIX timestamp
    let date = new Date(dateString);
    // this is read as current time; toISOString() would reaturn UTC time (e.g. +7 hours from pacific)
    // fix the offset
    date = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
    // date now contains the user's entered time
    let value;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        value = date.getTime() + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        value = date.getTime();
    }
    else {
        // add difference between map time and UTC
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        value = date.getTime() + diff;
    }
    // console.log("datePickerToUTC", date.toISOString(), " -> ", new Date(value).toISOString());
    return value;
}
function mapTZToUTC(value, timeZone) {
    if (!value) {
        return value;
    }
    // value is in map timezone
    // we need a UTC timestamp
    let newValue;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        const date = new Date();
        newValue = value + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        newValue = value;
    }
    else {
        // add difference between map time and UTC
        const date = new Date();
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        newValue = value + diff;
    }
    console.log("mapTZToUTC", value, " - ", new Date(value).toISOString(), " - ", new Date(newValue).toISOString());
    return newValue;
}
function getDateDisplayString(value, timeZone, dateFormat) {
    const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    let str;
    if (timeZone === "unknown") {
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone: "utc", timeZoneName: "shortOffset" }));
    }
    else {
        // known issues with formatting it-CH
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone }));
    }
    // console.log("getDateDisplayString", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}



//# sourceMappingURL=date-79c7d93c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/slider-e162e136.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/slider-e162e136.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   b: () => (/* binding */ barCreatedFunction),
/* harmony export */   u: () => (/* binding */ updateHistogramColors)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function barCreatedFunction(colorVisVarOrBreaks, histogram, sliderBars, idx, element) {
    const color = (colorVisVarOrBreaks === null || colorVisVarOrBreaks === void 0 ? void 0 : colorVisVarOrBreaks.length)
        ? getColorForValueClassed(colorVisVarOrBreaks, histogram.bins[idx])
        : getColorForValue(colorVisVarOrBreaks.stops, histogram.bins[idx]);
    color && element.setAttribute("fill", color.toHex());
    color && element.setAttribute("opacity", `${Math.max(color.a, 0.2)}`);
    sliderBars.push(element);
}
function updateHistogramColors(slider, sliderBars, colorVisVarOrBreaks, histogram) {
    sliderBars === null || sliderBars === void 0 ? void 0 : sliderBars.forEach((element, index) => {
        const bin = (histogram || slider.histogramConfig).bins[index];
        const color = slider.breaks
            ? getColorForValueClassed(colorVisVarOrBreaks || slider.breaks, bin)
            : getColorForValue((colorVisVarOrBreaks || slider)
                .stops, bin);
        color && element.setAttribute("fill", color.toHex());
        color && element.setAttribute("opacity", `${Math.max(color.a, 0.2)}`);
    });
}
function getColorForValue(stops, bin) {
    // infers the color for a given value
    // based on the stops from a ColorVariable
    const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    if (!bin) {
        return;
    }
    const value = (bin.maxValue - bin.minValue) / 2 + bin.minValue;
    let minStop = stops[0];
    let maxStop = stops[stops.length - 1];
    const minStopValue = minStop.value;
    const maxStopValue = maxStop.value;
    if (value < minStopValue) {
        return minStop.color;
    }
    if (value > maxStopValue) {
        return maxStop.color;
    }
    const exactMatches = stops.filter((stop) => stop.value === value);
    if (exactMatches.length > 0) {
        return exactMatches[0].color;
    }
    minStop = null;
    maxStop = null;
    stops.forEach((stop, i) => {
        if (!minStop && !maxStop && stop.value >= value) {
            minStop = stops[i - 1];
            maxStop = stop;
        }
    });
    const weightedPosition = (value - minStop.value) / (maxStop.value - minStop.value);
    return modules.esriColor.blendColors(minStop.color, maxStop.color, weightedPosition);
}
function getColorForValueClassed(breaks, bin) {
    // infers the color for a given value
    // based on the classBreakInfo
    if (!bin) {
        return;
    }
    const value = (bin.maxValue - bin.minValue) / 2 + bin.minValue;
    let minBreak = breaks[0];
    let maxBreak = breaks[breaks.length - 1];
    if (value < minBreak.min || value > maxBreak.max) {
        return undefined;
    }
    const exactMatches = breaks.filter((b) => b.min === value);
    if (exactMatches.length > 0) {
        return exactMatches[0].color;
    }
    minBreak = breaks[breaks.length - 1];
    maxBreak = null;
    breaks.forEach((b, i) => {
        if (!maxBreak && b.min >= value) {
            minBreak = breaks[i - 1];
            maxBreak = b;
        }
    });
    return minBreak.color;
}



//# sourceMappingURL=slider-e162e136.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWFmNTdkMy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNpSztBQUMwUDtBQUMxVjtBQUNMO0FBQ3pCO0FBQzZCO0FBQzdCO0FBQ3dEO0FBQzBDO0FBQ2pHO0FBQ1Q7QUFDRztBQUNEO0FBQ1U7QUFDVjs7QUFFN0IsMERBQTBELGFBQWEsK0VBQStFLGdCQUFnQixxSkFBcUosYUFBYSx5SEFBeUgsV0FBVywyYUFBMmEsMEJBQTBCLCtjQUErYyxzQkFBc0IseUJBQXlCLHFCQUFxQixVQUFVLDBCQUEwQixhQUFhOztBQUVyOUM7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHVEQUF1RCxxREFBVztBQUNsRSxzREFBc0QscURBQVc7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiwrREFBTTtBQUNyQyxnQ0FBZ0MsK0RBQU07QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLCtEQUFNO0FBQ3RDO0FBQ0EsK0JBQStCLCtEQUFNO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixtRUFBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixTQUFTLEVBQUUsK0RBQWlCO0FBQzVDLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsV0FBVyw0QkFBNEIsZ0JBQWdCO0FBQ3RGO0FBQ0EsZ0JBQWdCLHFEQUFXO0FBQzNCLGFBQWE7QUFDYjtBQUNBLGdCQUFnQixxREFBVztBQUMzQixlQUFlO0FB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TDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksVUFBVSxFQUFFLCtEQUFpQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRStEOztBQUUvRCIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zbWFydC1tYXBwaW5nLWNvbG9yLXNpemUtc2xpZGVyXzMuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZGF0ZS03OWM3ZDkzYy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zbGlkZXItZTE2MmUxMzYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGYgYXMgZm9yY2VVcGRhdGUsIEggYXMgSG9zdCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50LCBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYiBhcyBzdGF0dXMsIEYgYXMgZmluZFBhcmVudE5vZGUsIGEgYXMgZ2V0VmlzVmFyLCBwIGFzIGdldEF1dGhWaXNWYXIsIGFjIGFzIGlzRGVmaW5lZCwgZyBhcyBnZXRSZW5kZXJlclR5cGUsIGFkIGFzIHZhbGlkYXRlTWluTWF4LCB0IGFzIGdldFN5bWJvbENvbG9yLCBhQyBhcyBnZXRab29tT3B0aW9ucywgciBhcyBhcHBseVN5bWJvbENvbG9yLCBhYiBhcyB1cGRhdGVSZW5kZXJlciwgdyBhcyBzaW1wbGVGaWVsZFR5cGVzLCB1IGFzIGdldEZpZWxkLCBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlLCBoIGFzIGdldFJlbmRlcmVyLCBhRCBhcyBnZXRIYW5kbGVJbmZvLCBFIGFzIGNsb3NlUG9wb3ZlcnMsIGUgYXMgYXBwbHlSZW5kZXJlciB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMgfSBmcm9tICcuL2RhdGUtNzljN2Q5M2MuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0V3JhcHBlciB9IGZyb20gJy4vbG9hZGluZy02OTEzOTkwNy5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRTdG9wUHJlY2lzaW9uIH0gZnJvbSAnLi9wcmVjaXNpb24tMDZhNzM2NzIuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGIgYXMgYmFyQ3JlYXRlZEZ1bmN0aW9uLCB1IGFzIHVwZGF0ZUhpc3RvZ3JhbUNvbG9ycyB9IGZyb20gJy4vc2xpZGVyLWUxNjJlMTM2LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0Q29sb3JTaXplU2xpZGVyU3RvcHMsIGEgYXMgY3JlYXRlQ29sb3JTaXplVW5pdmFyaWF0ZVJlbmRlcmVyRnJvbUV4aXN0aW5nIH0gZnJvbSAnLi9jb2xvclNpemVVbml2YXJpYW50LWQyNjZhYzdjLmpzJztcbmltcG9ydCAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCAnLi9jb2xvci1kNmRhMGE5YS5qcyc7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlckNzcyA9IFwiLnNsaWRlci1ib3h7aGVpZ2h0OjMyMHB4fS5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNpemUtc2xpZGVyLC5zbGlkZXItYm94IC5lc3JpLWJpbmFyeS1jb2xvci1zaXplLXNsaWRlcnttaW4td2lkdGg6MjAwcHh9LnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fY29udGVudCwuc2xpZGVyLWJveCAuZXNyaS1iaW5hcnktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fY29udGVudHtoZWlnaHQ6MTc1cHh9LnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXJfX2hpc3RvZ3JhbS1jb250YWluZXIsLnNsaWRlci1ib3ggLmVzcmktYmluYXJ5LWNvbG9yLXNpemUtc2xpZGVyX19oaXN0b2dyYW0tY29udGFpbmVye3dpZHRoOjg1cHh9LnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWwsLnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWluLC5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21heCwuc2xpZGVyLWJveCAuZXNyaS1iaW5hcnktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWwsLnNsaWRlci1ib3ggLmVzcmktYmluYXJ5LWNvbG9yLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbiwuc2xpZGVyLWJveCAuZXNyaS1iaW5hcnktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWF4e3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9LnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWw6aG92ZXIsLnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWluOmhvdmVyLC5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21heDpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1iaW5hcnktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWw6aG92ZXIsLnNsaWRlci1ib3ggLmVzcmktYmluYXJ5LWNvbG9yLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbjpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1iaW5hcnktY29sb3Itc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWF4OmhvdmVye2JvcmRlcjoxcHggc29saWQgI2JiYjtiYWNrZ3JvdW5kLWNvbG9yOiNmM2YzZjM7dGV4dC1kZWNvcmF0aW9uOm5vbmU7ei1pbmRleDoxfS5zbGlkZXItYm94LWJ1dHRvbnMtZnJvbnR7ZGlzcGxheTpmbGV4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdDb2xvclNpemVTbGlkZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nQ29sb3JTaXplU2xpZGVyQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlckVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdDb2xvclNpemVTbGlkZXJFcnJvclwiLCA3KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5lY2Vzc2FyeSBmb3IgdHJhY2tpbmcgc3RvcHMgZm9yIG5vbi1jbGFzc2VkIHNsaWRlcnMsXG4gICAgICAgICAqIHdob3NlIHZhbHVlcyBhcmUgdXBkYXRlZCBpbW1lZGlhdGVseSBldmVuIGdpdmVuIGluY29ycmVjdCBpbnB1dHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmN1cnJlbnRDb2xvclN0b3BWYWx1ZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2l6ZVN0b3BTaXplcyA9IFtdO1xuICAgICAgICB0aGlzLnppZ3phZ0NsaWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibm90LWxvYWRlZFwiO1xuICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5NSVNTSU5HO1xuICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBDYWxsc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHVwZGF0ZVN0YXRpc3RpY3MoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IG51bGw7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtID0gbnVsbDtcbiAgICAgICAgKF9hID0gdGhpcy5jb2xvclNpemVTbGlkZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdldFN0YXRpc3RpY3MoKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuZ2V0U3RhdGlzdGljcygpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjb25maWcgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImxpbmtcIiwgeyByZWw6IFwic3R5bGVzaGVldFwiLCBocmVmOiBgJHtjb25maWcuanNhcGlVcmx9L3RoZW1lcy9saWdodC9tYWluLmNzc2AsIG9uTG9hZDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibG9hZGVkXCI7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9LCBvbkVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID0gXCJmYWlsZWRcIjtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSksIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJsb2FkZWRcIlxuICAgICAgICAgICAgPyB0aGlzLnJlbmRlckNvbG9yU2l6ZVNsaWRlcigpXG4gICAgICAgICAgICA6IHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJub3QtbG9hZGVkXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMucmVuZGVyQ29sb3JTaXplU2xpZGVyTG9hZGluZygpXG4gICAgICAgICAgICAgICAgOiBudWxsKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2l6ZVNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICBjb25zdCB7IGhpc3RvZ3JhbVN0YXR1cywgc3RhdGlzdGljcywgc3RhdGlzdGljc1N0YXR1cywgc2xpZGVyWm9vbWVkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgaXNBYm92ZUFuZEJlbG93ID0gYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lID09PSBcImFib3ZlLWFuZC1iZWxvd1wiO1xuICAgICAgICBpZiAoc3RhdGlzdGljc1N0YXR1cyA9PT0gc3RhdHVzLkZBSUxFRCB8fCBzdGF0aXN0aWNzU3RhdHVzID09PSBzdGF0dXMuTUlTU0lORykge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29sb3JTaXplU2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xvclNpemVTbGlkZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5JTl9QUk9HUkVTUyB8fFxuICAgICAgICAgICAgKGhpc3RvZ3JhbVN0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTICYmICF0aGlzLmNvbG9yU2l6ZVNsaWRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckNvbG9yU2l6ZVNsaWRlckxvYWRpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG9rID0gdGhpcy5wcmVwYXJlQ29sb3JTaXplU2xpZGVyKCk7XG4gICAgICAgICAgICBsZXQgZGlzYWJsZVpvb21CdXR0b24gPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChjb2xvclZpc1ZhciAmJiAhc2xpZGVyWm9vbWVkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXV0aENvbG9yVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9wcyA9IGdldENvbG9yU2l6ZVNsaWRlclN0b3BzKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgem9vbU9wdGlvbnMgPSBnZXRab29tT3B0aW9ucyhzdG9wcywgKF9hID0gYXV0aENvbG9yVmlzVmFyID09PSBudWxsIHx8IGF1dGhDb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdGF0aXN0aWNzLm1pbiwgKF9iID0gYXV0aENvbG9yVmlzVmFyID09PSBudWxsIHx8IGF1dGhDb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBzdGF0aXN0aWNzLm1heCk7XG4gICAgICAgICAgICAgICAgaWYgKCh6b29tT3B0aW9ucyA9PT0gbnVsbCB8fCB6b29tT3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogem9vbU9wdGlvbnMubWluTWF4U2FtZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKCFpc0RlZmluZWQoem9vbU9wdGlvbnMgPT09IG51bGwgfHwgem9vbU9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHpvb21PcHRpb25zLm1pbikgJiYgIWlzRGVmaW5lZCh6b29tT3B0aW9ucyA9PT0gbnVsbCB8fCB6b29tT3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogem9vbU9wdGlvbnMubWF4KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZVpvb21CdXR0b24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy56b29tQnV0dG9uTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzaXplVmlzVmFyICYmICFzbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKGlzQWJvdmVBbmRCZWxvd1xuICAgICAgICAgICAgICAgICAgICA/IHNpemVWaXNWYXIuc3RvcHNcbiAgICAgICAgICAgICAgICAgICAgOiBbeyB2YWx1ZTogc2l6ZVZpc1Zhci5taW5EYXRhVmFsdWUgfSwgeyB2YWx1ZTogc2l6ZVZpc1Zhci5tYXhEYXRhVmFsdWUgfV0sIChfYyA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogc3RhdGlzdGljcy5taW4sIChfZCA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogc3RhdGlzdGljcy5tYXgpO1xuICAgICAgICAgICAgICAgIGlmICh6b29tT3B0aW9ucy5taW5NYXhTYW1lIHx8XG4gICAgICAgICAgICAgICAgICAgICghaXNEZWZpbmVkKHpvb21PcHRpb25zLm1pbikgJiYgIWlzRGVmaW5lZCh6b29tT3B0aW9ucy5tYXgpKSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlWm9vbUJ1dHRvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnpvb21CdXR0b25Ob2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudENvbG9yU3RvcFZhbHVlcyA9IGNvbG9yVmlzVmFyLnN0b3BzLm1hcCgoc3RvcCkgPT4gc3RvcC52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBzaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaXplVmlzVmFyLnN0b3BzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2l6ZVN0b3BTaXplcyA9IHNpemVWaXNWYXIuc3RvcHMubWFwKChzdG9wKSA9PiBzdG9wLnNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9rIHx8IHRoaXMuY29sb3JTaXplU2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2xpZGVyLWJveFwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MuY29sb3JTaXplU2xpZGVyLmRhdGFSYW5nZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItYm94LWJ1dHRvbnMtZnJvbnRcIiB9LCB0aGlzLnJlbmRlckludmVydEJ1dHRvbigpLCBzaXplVmlzVmFyICYmIChoKEZyYWdtZW50LCBudWxsLCBoKFwiZGl2XCIsIG51bGwsIFwiXFx1MDBBMFwiKSwgdGhpcy5yZW5kZXJab29tQnV0dG9uKGRpc2FibGVab29tQnV0dG9uKSwgaChcImRpdlwiLCBudWxsLCBcIlxcdTAwQTBcIiksIHRoaXMucmVuZGVyUmVzZXRCdXR0b24oKSkpKSwgaChcImRpdlwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNvbG9yU2l6ZVNsaWRlckNyZWF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQ29sb3JTaXplU2xpZGVyTG9hZGluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2l6ZVNsaWRlckxvYWRpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5sb2FkaW5nIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckludmVydEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jb2xvclNpemVTbGlkZXIuaW52ZXJ0U2xpZGVyLCBpY29uOiBcImFycm93VXBEb3duXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlSW52ZXJ0U2xpZGVyKCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJab29tQnV0dG9uKGRpc2FibGVab29tQnV0dG9uKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgc2xpZGVyWm9vbWVkIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmNvbG9yU2l6ZVNsaWRlci56b29tU2xpZGVyLCBpY29uOiBzbGlkZXJab29tZWQgPyBcIm1hZ25pZnlpbmdHbGFzc01pbnVzXCIgOiBcIm1hZ25pZnlpbmdHbGFzc1BsdXNcIiwgZGlzYWJsZWQ6IGRpc2FibGVab29tQnV0dG9uLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVpvb21TbGlkZXIoKSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJSZXNldEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jb2xvclNpemVTbGlkZXIucmVzZXRTbGlkZXIsIGljb246IFwidW5kb1wiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVJlc2V0U2xpZGVyKCkgfSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcHJlcGFyZUNvbG9yU2l6ZVNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCBoaXN0b2dyYW0sIGhpc3RvZ3JhbVN0YXR1cywgc2xpZGVyWm9vbWVkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IGF1dGhJbmZvLnVuaXZhcmlhdGVUaGVtZSA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmdldEZpZWxkSW5mbygpO1xuICAgICAgICBjb25zdCBpc0RhdGVGaWVsZCA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGxldCBoYW5kbGVJbmZvLCBtaW4sIG1heDtcbiAgICAgICAgaWYgKGF1dGhDb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgaGFuZGxlSW5mbyA9IGdldEhhbmRsZUluZm8oYXV0aENvbG9yVmlzVmFyLnRoZW1lLCBjb2xvclZpc1Zhci5zdG9wcywgdHJ1ZSk7XG4gICAgICAgICAgICBtaW4gPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgICAgICBtYXggPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWF4U2xpZGVyVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtaW4gPSAoX2EgPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHN0YXRpc3RpY3MubWluO1xuICAgICAgICAgICAgbWF4ID0gKF9iID0gYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBzdGF0aXN0aWNzLm1heDtcbiAgICAgICAgfVxuICAgICAgICAoeyBtaW4sIG1heCB9ID0gdmFsaWRhdGVNaW5NYXgoeyBtaW4sIG1heCB9KSk7XG4gICAgICAgIGNvbnN0IHNsaWRlciA9IHRoaXMuY29sb3JTaXplU2xpZGVyO1xuICAgICAgICBpZiAodGhpcy5jb2xvclNpemVTbGlkZXIgJiZcbiAgICAgICAgICAgICgoY29sb3JWaXNWYXIgJiYgc2xpZGVyLnN0eWxlKSB8fCAoIWNvbG9yVmlzVmFyICYmICFzbGlkZXIuc3R5bGUpKSkge1xuICAgICAgICAgICAgKF9jID0gdGhpcy5jb2xvclNpemVTbGlkZXIpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGlzdG9ncmFtU3RhdHVzID09PSBzdGF0dXMuSU5fUFJPR1JFU1MpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY29sb3JTaXplU2xpZGVyKSB7XG4gICAgICAgICAgICB0aGlzLmNvbG9yU2xpZGVyQmFycyA9IFtdO1xuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBoaXN0b2dyYW1Db25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgYmluczogaGlzdG9ncmFtID09PSBudWxsIHx8IGhpc3RvZ3JhbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaGlzdG9ncmFtLmJpbnMsXG4gICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2U6IE1hdGgucm91bmQoc3RhdGlzdGljcy5hdmcgKiAxMCkgLyAxMCxcbiAgICAgICAgICAgICAgICAgICAgc3RhbmRhcmREZXZpYXRpb246IHN0YXRpc3RpY3Muc3RkZGV2LFxuICAgICAgICAgICAgICAgICAgICBzdGFuZGFyZERldmlhdGlvbkNvdW50OiAxXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtaW46IG1pbiAhPT0gbnVsbCAmJiBtaW4gIT09IHZvaWQgMCA/IG1pbiA6IHN0YXRpc3RpY3MubWluLFxuICAgICAgICAgICAgICAgIG1heDogbWF4ICE9PSBudWxsICYmIG1heCAhPT0gdm9pZCAwID8gbWF4IDogc3RhdGlzdGljcy5tYXhcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoaXNBYm92ZUFuZEJlbG93KSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnByaW1hcnlIYW5kbGVFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25maWcucGVyc2lzdFNpemVSYW5nZUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRGF0ZUZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhhc1RpbWVEYXRhID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBhZGREYXRlRm9ybWF0RnVuY3Rpb25zKGNvbmZpZywgbWFwVmlldy50aW1lWm9uZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgICAgICBjb25maWcgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyksIGhhbmRsZUluZm8pO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5zdG9wcyA9IGdldENvbG9yU2l6ZVNsaWRlclN0b3BzKCk7XG4gICAgICAgICAgICAgICAgY29uZmlnLnByZWNpc2lvbiA9IGdldFN0b3BQcmVjaXNpb24oY29sb3JWaXNWYXIuc3RvcHMpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oaXN0b2dyYW1Db25maWcuYmFyQ3JlYXRlZEZ1bmN0aW9uID1cbiAgICAgICAgICAgICAgICAgICAgaGlzdG9ncmFtICYmIGJhckNyZWF0ZWRGdW5jdGlvbi5iaW5kKHRoaXMsIGNvbmZpZywgaGlzdG9ncmFtLCB0aGlzLmNvbG9yU2xpZGVyQmFycyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xvclNpemVTbGlkZXIgPSBuZXcgbW9kdWxlcy5Db2xvclNpemVTbGlkZXIoY29uZmlnKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVIaXN0b2dyYW1Db2xvcnModGhpcy5jb2xvclNpemVTbGlkZXIsIHRoaXMuY29sb3JTbGlkZXJCYXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5zdHlsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tCZWxvd0ZpbGxDb2xvcjogZ2V0U3ltYm9sQ29sb3IocmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLnN5bWJvbCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcihbMCwgMCwgMCwgMC41XSksXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrQWJvdmVGaWxsQ29sb3I6IGdldFN5bWJvbENvbG9yKHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1sxXS5zeW1ib2wpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoWzAsIDAsIDAsIDAuNV0pXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25maWcuc3RvcHMgPSBzaXplVmlzVmFyLnN0b3BzO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oYW5kbGVzU3luY2VkVG9QcmltYXJ5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29uZmlnLnByZWNpc2lvbiA9IGdldFN0b3BQcmVjaXNpb24oY29uZmlnLnN0b3BzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlciA9IG5ldyBtb2R1bGVzLkJpbmFyeUNvbG9yU2l6ZVNsaWRlcihjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDb2xvclNpemVTbGlkZXJDaGFuZ2VFdmVudHMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNsaWRlciA9IHRoaXMuY29sb3JTaXplU2xpZGVyO1xuICAgICAgICAgICAgaWYgKCgoX2QgPSBzbGlkZXIuc2xpZGVyKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3RhdGUpID09PSBcImRyYWdnaW5nXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgaGlzdG9ncmFtQ29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIGJpbnM6IGhpc3RvZ3JhbSA9PT0gbnVsbCB8fCBoaXN0b2dyYW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhpc3RvZ3JhbS5iaW5zLFxuICAgICAgICAgICAgICAgICAgICBhdmVyYWdlOiBNYXRoLnJvdW5kKHN0YXRpc3RpY3MuYXZnICogMTApIC8gMTAsXG4gICAgICAgICAgICAgICAgICAgIHN0YW5kYXJkRGV2aWF0aW9uOiBzdGF0aXN0aWNzLnN0ZGRldixcbiAgICAgICAgICAgICAgICAgICAgc3RhbmRhcmREZXZpYXRpb25Db3VudDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWluOiBtaW4gIT09IG51bGwgJiYgbWluICE9PSB2b2lkIDAgPyBtaW4gOiBzdGF0aXN0aWNzLm1pbixcbiAgICAgICAgICAgICAgICBtYXg6IG1heCAhPT0gbnVsbCAmJiBtYXggIT09IHZvaWQgMCA/IG1heCA6IHN0YXRpc3RpY3MubWF4XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGNvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBjb25maWcpLCBoYW5kbGVJbmZvKTtcbiAgICAgICAgICAgICAgICBjb25maWcuc3RvcHMgPSBnZXRDb2xvclNpemVTbGlkZXJTdG9wcygpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5wcmVjaXNpb24gPSBnZXRTdG9wUHJlY2lzaW9uKGNvbmZpZy5zdG9wcyk7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhhc1RpbWVEYXRhID0gaXNEYXRlRmllbGQgJiYgIWlzQWdlUmVuZGVyZXI7XG4gICAgICAgICAgICAgICAgaWYgKGlzRGF0ZUZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMoY29uZmlnLCBtYXBWaWV3LnRpbWVab25lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogY2xpY2tpbmcgYSB6aWd6YWcgYWxyZWFkeSB1cGRhdGVzIHRoZSBpbnRlcm5hbCBzbGlkZXIgem9vbU9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgICAqIHNldHRpbmcgdGhlbSBoZXJlIGFnYWluIHdvdWxkIGluY29ycmVjdGx5IG92ZXJyaWRlIGEgdXNlcidzIGRlY2lzaW9uXG4gICAgICAgICAgICAgICAgICAgICAqIHRvIG1hbnVhbGx5IHpvb20gb3V0IG9uZSBzaWRlIG9mIHRoZSBzbGlkZXIuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuemlnemFnQ2xpY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKGNvbG9yVmlzVmFyLnN0b3BzLCAoX2UgPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IHN0YXRpc3RpY3MubWluLCAoX2YgPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWF4U2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IHN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uZmlnLmhpc3RvZ3JhbUNvbmZpZy5iYXJDcmVhdGVkRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgICAgICBoaXN0b2dyYW0gJiYgYmFyQ3JlYXRlZEZ1bmN0aW9uLmJpbmQodGhpcywgY29sb3JWaXNWYXIsIGhpc3RvZ3JhbSwgdGhpcy5jb2xvclNsaWRlckJhcnMpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZUhpc3RvZ3JhbUNvbG9ycyh0aGlzLmNvbG9yU2l6ZVNsaWRlciwgdGhpcy5jb2xvclNsaWRlckJhcnMsIGNvbmZpZywgaGlzdG9ncmFtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5zdHlsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tCZWxvd0ZpbGxDb2xvcjogZ2V0U3ltYm9sQ29sb3IocmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLnN5bWJvbCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcihbMCwgMCwgMCwgMC41XSksXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrQWJvdmVGaWxsQ29sb3I6IGdldFN5bWJvbENvbG9yKHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1sxXS5zeW1ib2wpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoWzAsIDAsIDAsIDAuNV0pXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25maWcuc3RvcHMgPSBzaXplVmlzVmFyLnN0b3BzO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5wcmVjaXNpb24gPSBnZXRTdG9wUHJlY2lzaW9uKGNvbmZpZy5zdG9wcyk7XG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogY2xpY2tpbmcgYSB6aWd6YWcgYWxyZWFkeSB1cGRhdGVzIHRoZSBpbnRlcm5hbCBzbGlkZXIgem9vbU9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgICAqIHNldHRpbmcgdGhlbSBoZXJlIGFnYWluIHdvdWxkIGluY29ycmVjdGx5IG92ZXJyaWRlIGEgdXNlcidzIGRlY2lzaW9uXG4gICAgICAgICAgICAgICAgICAgICAqIHRvIG1hbnVhbGx5IHpvb20gb3V0IG9uZSBzaWRlIG9mIHRoZSBzbGlkZXIuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuemlnemFnQ2xpY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKGlzQWJvdmVBbmRCZWxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gc2l6ZVZpc1Zhci5zdG9wc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogW3sgdmFsdWU6IHNpemVWaXNWYXIubWluRGF0YVZhbHVlIH0sIHsgdmFsdWU6IHNpemVWaXNWYXIubWF4RGF0YVZhbHVlIH1dLCAoX2cgPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9nICE9PSB2b2lkIDAgPyBfZyA6IHN0YXRpc3RpY3MubWluLCAoX2ggPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9oICE9PSB2b2lkIDAgPyBfaCA6IHN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQgJiYgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zICYmICF0aGlzLnppZ3phZ0NsaWNrKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zID0gdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zO1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGhhbmRsZXMgZWRnZSBjYXNlcyB3aGVyZSB0aGUgc2xpZGVyIGlzIHpvb21lZCwgaGFuZGxlcyBoYXZlIGJlZW4gbWFudWFsbHkgbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICogYW5kIGEgdXNlciBleGVjdXRlcyBhIGxhYmVsIGNoYW5nZS4gVGhpcyBwcmV2ZW50cyB6b29tIG9wdGlvbnMgZnJvbSBjaGFuZ2luZyBhbmQgcHJlc2VydmVzXG4gICAgICAgICAgICAgICAgICogdGhlIGhpc3RvZ3JhbSBkaXNwbGF5LlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnpvb21BZGp1c3RtZW50ID09PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLnNsaWRlci5taW4gPSBjb25maWcuem9vbU9wdGlvbnMubWluO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuem9vbU9wdGlvbnMubWluID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLnNsaWRlci5tYXggPSBjb25maWcuem9vbU9wdGlvbnMubWF4O1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuem9vbU9wdGlvbnMubWF4ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmFkanVzdGVkWm9vbU9wdGlvbnMgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy56b29tQWRqdXN0bWVudCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlci5zZXQoY29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuemlnemFnQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNEZWZpbmVkKHRoaXMuY29sb3JTaXplU2xpZGVyKTtcbiAgICB9XG4gICAgaGFuZGxlSW52ZXJ0U2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBpZiAoY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIGxldCBjb2xvcnMgPSBjb2xvclZpc1Zhci5zdG9wcy5tYXAoKGNvbG9yU3RvcCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclN0b3AuY29sb3I7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbG9ycyA9IGNvbG9ycy5yZXZlcnNlKCk7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wcy5mb3JFYWNoKChjb2xvclN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbG9yU3RvcC5jb2xvciA9IGNvbG9yc1tpZHhdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjb2xvciA9IGdldFN5bWJvbENvbG9yKHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5zeW1ib2wpO1xuICAgICAgICAgICAgYXBwbHlTeW1ib2xDb2xvcihyZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbMF0uc3ltYm9sLCBnZXRTeW1ib2xDb2xvcihyZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbMV0uc3ltYm9sKSk7XG4gICAgICAgICAgICBhcHBseVN5bWJvbENvbG9yKHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1sxXS5zeW1ib2wsIGNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIFtzaXplVmlzVmFyLm1pblNpemUsIHNpemVWaXNWYXIubWF4U2l6ZV0gPSBbc2l6ZVZpc1Zhci5tYXhTaXplLCBzaXplVmlzVmFyLm1pblNpemVdO1xuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDb2xvclNpemVTbGlkZXJDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBoYW5kbGVab29tU2xpZGVyKHpvb21lZCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGlmICh0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgaXNBYm92ZUFuZEJlbG93ID0gYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lID09PSBcImFib3ZlLWFuZC1iZWxvd1wiO1xuICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGlzRGVmaW5lZCh6b29tZWQpID8gem9vbWVkIDogIXRoaXMuc2xpZGVyWm9vbWVkO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmICghc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub3JtYWxpemF0aW9uRmllbGQgPSBzaXplVmlzVmFyXG4gICAgICAgICAgICA/IHNpemVWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkXG4gICAgICAgICAgICA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZDtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHpvb21PcHRpb25zID0gdGhpcy5zbGlkZXJab29tZWRcbiAgICAgICAgICAgID8gZ2V0Wm9vbU9wdGlvbnMoaXNBYm92ZUFuZEJlbG93XG4gICAgICAgICAgICAgICAgPyBzaXplVmlzVmFyLnN0b3BzXG4gICAgICAgICAgICAgICAgOiBbeyB2YWx1ZTogc2l6ZVZpc1Zhci5taW5EYXRhVmFsdWUgfSwgeyB2YWx1ZTogc2l6ZVZpc1Zhci5tYXhEYXRhVmFsdWUgfV0sIChfYSA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogc3RhdGlzdGljcy5taW4sIChfYiA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogc3RhdGlzdGljcy5tYXgpXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCAoem9vbU9wdGlvbnMgJiYgem9vbU9wdGlvbnMubWluKSB8fCAoKF9jID0gYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBzdGF0aXN0aWNzLm1pbiksICh6b29tT3B0aW9ucyAmJiB6b29tT3B0aW9ucy5tYXgpIHx8ICgoX2QgPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IHN0YXRpc3RpY3MubWF4KSk7XG4gICAgfVxuICAgIGhhbmRsZVJlc2V0U2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aENvbG9yVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHRoaXMuZ2V0RmllbGRJbmZvKCk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IGNvbG9yVmlzVmFyXG4gICAgICAgICAgICA/IGNvbG9yVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yU2l6ZVVuaXZhcmlhdGVSZW5kZXJlckZyb21FeGlzdGluZyh7XG4gICAgICAgICAgICBmaWVsZEluZm9zOiBbZmllbGRJbmZvXSxcbiAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZDogc2l6ZVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQsXG4gICAgICAgICAgICB0aGVtZTogYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lLFxuICAgICAgICAgICAgaXNDb250aW51b3VzOiAhIWNvbG9yVmlzVmFyLFxuICAgICAgICAgICAgbm9SZXVzZTogdHJ1ZSxcbiAgICAgICAgICAgIGRpc2NhcmRNaW5NYXg6IHRydWVcbiAgICAgICAgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGlmICgoKF9hID0gcmVzdWx0LnN0YXRpc3RpY3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb3VudCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBmaWVsZCBoYXMgbm8gdmFsdWVzXG4gICAgICAgICAgICAgICAgLy8gbWFrZSB1cCBzb21lIGJhc2ljIHN0YXRpc3RpY3Mgc28gd2Ugc2hvdyBhIHNsaWRlclxuICAgICAgICAgICAgICAgIGNvbnN0IFtkZWZhdWx0TWluLCBkZWZhdWx0TWF4XSA9IHRoaXMuZ2V0RGVmYXVsdERhdGFSYW5nZShmaWVsZEluZm8pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IChhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUpIHx8IGRlZmF1bHRNaW47XG4gICAgICAgICAgICAgICAgY29uc3QgbWF4ID0gKGF1dGhDb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoQ29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhDb2xvclZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgfHwgZGVmYXVsdE1heDtcbiAgICAgICAgICAgICAgICByZXN1bHQuc3RhdGlzdGljcy5taW4gPSBtaW47XG4gICAgICAgICAgICAgICAgcmVzdWx0LnN0YXRpc3RpY3MubWF4ID0gbWF4O1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0aXN0aWNzLmF2ZyA9IChtYXggKyBtaW4pIC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSByZXN1bHQuc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5zdGF0aXN0aWNzICYmXG4gICAgICAgICAgICAgICAgaXNEZWZpbmVkKHJlc3VsdC5zdGF0aXN0aWNzLm1pbikgJiZcbiAgICAgICAgICAgICAgICBpc0RlZmluZWQocmVzdWx0LnN0YXRpc3RpY3MubWF4KSAmJlxuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiA8PSByZXN1bHQuc3RhdGlzdGljcy5tYXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSByZXN1bHQuc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgcmVzdWx0LnN0YXRpc3RpY3MsIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiwgcmVzdWx0LnN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXV0aENvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgYXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlID0gdGhpcy5zdGF0aXN0aWNzLm1pbjtcbiAgICAgICAgICAgICAgICBhdXRoQ29sb3JWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSB0aGlzLnN0YXRpc3RpY3MubWF4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUgPSB0aGlzLnN0YXRpc3RpY3MubWluO1xuICAgICAgICAgICAgYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSB0aGlzLnN0YXRpc3RpY3MubWF4O1xuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlckVycm9yLmVtaXQoZXJyb3IpKTtcbiAgICB9XG4gICAgYWZ0ZXJDb2xvclNpemVTbGlkZXJDcmVhdGUobm9kZSkge1xuICAgICAgICBjb25zdCBkaXZOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChkaXZOb2RlKTtcbiAgICAgICAgaWYgKHRoaXMuY29sb3JTaXplU2xpZGVyICYmICF0aGlzLmNvbG9yU2l6ZVNsaWRlci5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0U3RhdGlzdGljcygpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGZvbGxvd2luZzpcbiAgICAgICAgICogIDEuKSBSZXRyaWV2aW5nIHN0YXRpc3RpY3Mgb24gc2xpZGVyIGxvYWRcbiAgICAgICAgICogIDIuKSBSZXRyaWV2aW5nIHVwZGF0ZWQgc3RhdGlzdGljcyBhZnRlciBjaGFuZ2luZyBub3JtYWxpemF0aW9uIGZpZWxkIG9yIHRoZW1lXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGF1dGhTaXplVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBsZXQgbWluO1xuICAgICAgICBsZXQgbWF4O1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmdldEZpZWxkSW5mbygpO1xuICAgICAgICBjb25zdCBub3JtYWxpemF0aW9uRmllbGQgPSBzaXplVmlzVmFyXG4gICAgICAgICAgICA/IHNpemVWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkXG4gICAgICAgICAgICA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZDtcbiAgICAgICAgbWluID0gYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlO1xuICAgICAgICBtYXggPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRpc3RpY3MpIHtcbiAgICAgICAgICAgIG1vZHVsZXNcbiAgICAgICAgICAgICAgICAuc3VtbWFyeVN0YXRpc3RpY3Moe1xuICAgICAgICAgICAgICAgIGxheWVyLFxuICAgICAgICAgICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgICAgICB2YWx1ZUV4cHJlc3Npb246IGZpZWxkSW5mby5leHByZXNzaW9uLFxuICAgICAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZCxcbiAgICAgICAgICAgICAgICBmb3JCaW5uaW5nOiBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigoc3RhdGlzdGljcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0aXN0aWNzLmNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpZWxkIGhhcyBubyB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSB1cCBzb21lIGJhc2ljIHN0YXRpc3RpY3Mgc28gd2UgY2FuIHNob3cgYSBzbGlkZXJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2RlZmF1bHRNaW4sIGRlZmF1bHRNYXhdID0gdGhpcy5nZXREZWZhdWx0RGF0YVJhbmdlKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IChhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpIHx8IGRlZmF1bHRNaW47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IChhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpIHx8IGRlZmF1bHRNYXg7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MubWluID0gbWluO1xuICAgICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzLm1heCA9IG1heDtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGlzdGljcy5hdmcgPSAobWF4ICsgbWluKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNEZWZpbmVkKGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUgPSBtaW47XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSA9IG1heDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNEZWZpbmVkKHN0YXRpc3RpY3MuYXZnKSB8fFxuICAgICAgICAgICAgICAgICAgICAhaXNEZWZpbmVkKHN0YXRpc3RpY3MubWluKSB8fFxuICAgICAgICAgICAgICAgICAgICAhaXNEZWZpbmVkKHN0YXRpc3RpY3MubWF4KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzdGF0aXN0aWNzIHVudXNhYmxlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhdGlzdGljcyA9IHZhbGlkYXRlTWluTWF4KHN0YXRpc3RpY3MpO1xuICAgICAgICAgICAgICAgIG1pbiA9IG1pbiAhPT0gbnVsbCAmJiBtaW4gIT09IHZvaWQgMCA/IG1pbiA6IHN0YXRpc3RpY3MubWluO1xuICAgICAgICAgICAgICAgIG1heCA9IG1heCAhPT0gbnVsbCAmJiBtYXggIT09IHZvaWQgMCA/IG1heCA6IHN0YXRpc3RpY3MubWF4O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IHN0YXRpc3RpY3M7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLlNVQ0NFU1M7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRIaXN0b2dyYW0oZmllbGRJbmZvLCBub3JtYWxpemF0aW9uRmllbGQsIHN0YXRpc3RpY3MsIG1pbiwgbWF4KTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIHN0YXRpc3RpY3MgPSBzdGF0aXN0aWNzIHx8IHRoaXMuc3RhdGlzdGljcztcbiAgICAgICAgaWYgKCFzdGF0aXN0aWNzIHx8IHN0YXRpc3RpY3MuY291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgbW9kdWxlc1xuICAgICAgICAgICAgLmhpc3RvZ3JhbSh7XG4gICAgICAgICAgICBsYXllcjogbGF5ZXIsXG4gICAgICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgIHZhbHVlRXhwcmVzc2lvbjogZmllbGRJbmZvLmV4cHJlc3Npb24sXG4gICAgICAgICAgICBudW1CaW5zOiA1MCxcbiAgICAgICAgICAgIG1pblZhbHVlOiBpc0RlZmluZWQobWluKSA/IG1pbiA6IHN0YXRpc3RpY3MubWluLFxuICAgICAgICAgICAgbWF4VmFsdWU6IGlzRGVmaW5lZChtYXgpID8gbWF4IDogc3RhdGlzdGljcy5tYXgsXG4gICAgICAgICAgICBub3JtYWxpemF0aW9uRmllbGQsXG4gICAgICAgICAgICBmb3JCaW5uaW5nOiBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGhpc3RvZ3JhbSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oaXN0b2dyYW0gPSBoaXN0b2dyYW07XG4gICAgICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvbk1pbk1heENoYW5nZShtaW4sIG1heCwgY2hhbmdpbmcpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lKSA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgaWYgKGNvbG9yVmlzVmFyID09PSBudWxsIHx8IGNvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2xvclZpc1Zhci5zdG9wcykge1xuICAgICAgICAgICAgbWluID0gTWF0aC5taW4obWluLCBjb2xvclZpc1Zhci5zdG9wc1swXS52YWx1ZSk7XG4gICAgICAgICAgICBtYXggPSBNYXRoLm1heChtYXgsIGNvbG9yVmlzVmFyLnN0b3BzW2NvbG9yVmlzVmFyLnN0b3BzLmxlbmd0aCAtIDFdLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNBYm92ZUFuZEJlbG93KSB7XG4gICAgICAgICAgICBtaW4gPSBNYXRoLm1pbihtaW4sIHNpemVWaXNWYXIuc3RvcHNbMF0udmFsdWUpO1xuICAgICAgICAgICAgbWF4ID0gTWF0aC5tYXgobWF4LCBzaXplVmlzVmFyLnN0b3BzW3NpemVWaXNWYXIuc3RvcHMubGVuZ3RoIC0gMV0udmFsdWUpO1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICBzdG9wLnNpemUgPSB0aGlzLmN1cnJlbnRTaXplU3RvcFNpemVzW2lkeF07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhbmRsZU1pbk1heENoYW5nZShtaW4sIG1heCwgY2hhbmdpbmcpO1xuICAgIH1cbiAgICBoYW5kbGVNaW5NYXhDaGFuZ2UobWluLCBtYXgsIGNoYW5naW5nKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBhdXRoQ29sb3JWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpIHx8IHt9O1xuICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKSB8fCB7fTtcbiAgICAgICAgLy8gdXBkYXRlIG9ubHkgdGhlIGxhYmVsIHRoYXQgdGhlIHVzZXIgaXMgY2hhbmdpbmdcbiAgICAgICAgaWYgKGNoYW5naW5nID09PSBcIm1pblwiKSB7XG4gICAgICAgICAgICBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUgPSBtaW47XG4gICAgICAgICAgICBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSA9IG1pbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGF1dGhDb2xvclZpc1Zhci5tYXhTbGlkZXJWYWx1ZSA9IG1heDtcbiAgICAgICAgICAgIGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlID0gbWF4O1xuICAgICAgICB9XG4gICAgICAgIC8vIGRldGVybWluZSBpZiBsYWJlbCB1cGRhdGVzIG1lcml0IHpvb21pbmcgb3Igbm90XG4gICAgICAgIGNvbnN0IHpvb21PcHRpb25zID0gZ2V0Wm9vbU9wdGlvbnMoY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLnN0b3BzLCBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUsIGF1dGhDb2xvclZpc1Zhci5tYXhTbGlkZXJWYWx1ZSk7XG4gICAgICAgIC8vIGhhbmRsZXMgem9vbSBidXR0b24gZGlzcGxheSBmb3Igbm9uLWNsYXNzZWQgY29sb3Igc2xpZGVyc1xuICAgICAgICBpZiAodGhpcy56b29tQnV0dG9uTm9kZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVyWm9vbWVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXpvb21PcHRpb25zIHx8XG4gICAgICAgICAgICAgICAgem9vbU9wdGlvbnMubWluTWF4U2FtZSB8fFxuICAgICAgICAgICAgICAgICghaXNEZWZpbmVkKHpvb21PcHRpb25zLm1pbikgJiYgIWlzRGVmaW5lZCh6b29tT3B0aW9ucy5tYXgpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHpvb20gYWRqdXN0bWVudFxuICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucyA9IHRoaXMuY29sb3JTaXplU2xpZGVyLnpvb21PcHRpb25zO1xuICAgICAgICAgICAgaWYgKGNoYW5naW5nID09PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zLm1pbiA9IG1pbjtcbiAgICAgICAgICAgICAgICB0aGlzLnpvb21BZGp1c3RtZW50ID0gXCJtaW5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucy5tYXggPSBtYXg7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQWRqdXN0bWVudCA9IFwibWF4XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gc2l6ZVZpc1ZhclxuICAgICAgICAgICAgPyBzaXplVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCk7XG4gICAgICAgIHVwZGF0ZUhpc3RvZ3JhbUNvbG9ycyh0aGlzLmNvbG9yU2l6ZVNsaWRlciwgdGhpcy5jb2xvclNsaWRlckJhcnMsIGNvbG9yVmlzVmFyLCB0aGlzLmhpc3RvZ3JhbSk7XG4gICAgICAgIGlmIChtaW4gPT09IGF1dGhDb2xvclZpc1Zhci5taW5TbGlkZXJWYWx1ZSAmJiBtYXggPT09IGF1dGhDb2xvclZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kID0gXCJtYW51YWxcIjtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDb2xvclNpemVTbGlkZXJDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBjcmVhdGVDb2xvclNpemVTbGlkZXJDaGFuZ2VFdmVudHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmdldEZpZWxkSW5mbygpO1xuICAgICAgICBjb25zdCBpc0RhdGVGaWVsZCA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgaWYgKCF0aGlzLmNvbG9yU2l6ZVNsaWRlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhhbmRsZXMgemlnemFnIGNsaWNrXG4gICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLndhdGNoKFwiem9vbU9wdGlvbnNcIiwgKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVyWm9vbWVkICYmXG4gICAgICAgICAgICAgICAgKCgob2xkVmFsdWUgPT09IG51bGwgfHwgb2xkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9sZFZhbHVlLm1pbikgJiYgIShuZXdWYWx1ZSA9PT0gbnVsbCB8fCBuZXdWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV3VmFsdWUubWluKSkgfHwgKChvbGRWYWx1ZSA9PT0gbnVsbCB8fCBvbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2xkVmFsdWUubWF4KSAmJiAhKG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5tYXgpKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnppZ3phZ0NsaWNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVppZ3phZ0NsaWNrKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLm9uKFwibWluLWNoYW5nZVwiLCAoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPiB0aGlzLmN1cnJlbnRDb2xvclN0b3BWYWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IHRoaXMuY3VycmVudENvbG9yU3RvcFZhbHVlc1tpZHhdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UodGhpcy5jdXJyZW50Q29sb3JTdG9wVmFsdWVzWzBdLCB0aGlzLmNvbG9yU2l6ZVNsaWRlci5zbGlkZXIubWF4LCBcIm1pblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UoaW5mby52YWx1ZSwgdGhpcy5jb2xvclNpemVTbGlkZXIuc2xpZGVyLm1heCwgXCJtaW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlci5vbihcIm1heC1jaGFuZ2VcIiwgKGluZm8pID0+IHtcbiAgICAgICAgICAgIGlmIChpbmZvLnZhbHVlIDwgdGhpcy5jdXJyZW50Q29sb3JTdG9wVmFsdWVzW3RoaXMuY3VycmVudENvbG9yU3RvcFZhbHVlcy5sZW5ndGggLSAxXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JTaXplU2xpZGVyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzdG9wLnZhbHVlID0gdGhpcy5jdXJyZW50Q29sb3JTdG9wVmFsdWVzW2lkeF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLmNvbG9yU2l6ZVNsaWRlci5zbGlkZXIubWluLCB0aGlzLmN1cnJlbnRDb2xvclN0b3BWYWx1ZXNbdGhpcy5jdXJyZW50Q29sb3JTdG9wVmFsdWVzLmxlbmd0aCAtIDFdLCBcIm1heFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UodGhpcy5jb2xvclNpemVTbGlkZXIuc2xpZGVyLm1pbiwgaW5mby52YWx1ZSwgXCJtYXhcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbG9yU2l6ZVNsaWRlci5vbihcInRodW1iLWNoYW5nZVwiLCAoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKHNpemVWaXNWYXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNEYXRlRmllbGQgJiYgIWlzQWdlUmVuZGVyZXIgJiYgaW5mby52YWx1ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHModGhpcy5jb2xvclNpemVTbGlkZXIuc3RvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb2xvclNpemVTbGlkZXIub24oXCJ0aHVtYi1kcmFnXCIsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcHMgPSB0aGlzLmNvbG9yU2l6ZVNsaWRlci5zdG9wcztcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb2xvclNpemVTbGlkZXIub24oXCJzZWdtZW50LWRyYWdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVSZW5kZXJlclN0b3BzKHRoaXMuY29sb3JTaXplU2xpZGVyLnN0b3BzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBpc0Fib3ZlQW5kQmVsb3cgPSBhdXRoSW5mby51bml2YXJpYXRlVGhlbWUgPT09IFwiYWJvdmUtYW5kLWJlbG93XCI7XG4gICAgICAgIGlmIChzaXplVmlzVmFyLnN0b3BzKSB7XG4gICAgICAgICAgICBzaXplVmlzVmFyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIHN0b3AudmFsdWUgPSBzdG9wc1tpZHhdLnZhbHVlO1xuICAgICAgICAgICAgICAgIHN0b3Auc2l6ZSA9IHN0b3BzW2lkeF0uc2l6ZTtcbiAgICAgICAgICAgICAgICBzdG9wLmxhYmVsID0gXCJcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5taW5EYXRhVmFsdWUgPSBzdG9wc1swXS52YWx1ZTtcbiAgICAgICAgICAgIHNpemVWaXNWYXIubWF4RGF0YVZhbHVlID0gc3RvcHNbc3RvcHMubGVuZ3RoIC0gMV0udmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICBzdG9wLnZhbHVlID0gc3RvcHNbaWR4XS52YWx1ZTtcbiAgICAgICAgICAgICAgICBzdG9wLmNvbG9yID0gc3RvcHNbaWR4XS5jb2xvcjtcbiAgICAgICAgICAgICAgICBzdG9wLmxhYmVsID0gXCJcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3VycmVudENvbG9yU3RvcFZhbHVlcyA9IHN0b3BzLm1hcCgoc3RvcCkgPT4gc3RvcC52YWx1ZSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNpemVTdG9wU2l6ZXMgPSBzdG9wcy5tYXAoKHN0b3ApID0+IHN0b3Auc2l6ZSk7XG4gICAgICAgIGlmIChyZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbMF0ubWF4VmFsdWUgPSBzdG9wc1syXS52YWx1ZTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1sxXS5taW5WYWx1ZSA9IHN0b3BzWzJdLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHpvb21PcHRpb25zID0gZ2V0Wm9vbU9wdGlvbnMoaXNBYm92ZUFuZEJlbG93XG4gICAgICAgICAgICA/IHNpemVWaXNWYXIuc3RvcHNcbiAgICAgICAgICAgIDogW3sgdmFsdWU6IHNpemVWaXNWYXIubWluRGF0YVZhbHVlIH0sIHsgdmFsdWU6IHNpemVWaXNWYXIubWF4RGF0YVZhbHVlIH1dLCBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUsIGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSk7XG4gICAgICAgIGlmICh0aGlzLnNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF6b29tT3B0aW9ucyB8fFxuICAgICAgICAgICAgem9vbU9wdGlvbnMubWluTWF4U2FtZSB8fFxuICAgICAgICAgICAgKCFpc0RlZmluZWQoem9vbU9wdGlvbnMubWluKSAmJiAhaXNEZWZpbmVkKHpvb21PcHRpb25zLm1heCkpKSB7XG4gICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVIaXN0b2dyYW1Db2xvcnModGhpcy5jb2xvclNpemVTbGlkZXIsIHRoaXMuY29sb3JTbGlkZXJCYXJzKTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgZ2V0RGVmYXVsdERhdGFSYW5nZShmaWVsZEluZm8pIHtcbiAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSkge1xuICAgICAgICAgICAgY29uc3QgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIHJldHVybiBbbmV3IERhdGUoYDEvMS8ke3llYXJ9YCkuZ2V0VGltZSgpLCBuZXcgRGF0ZShgMTIvMzEvJHt5ZWFyfWApLmdldFRpbWUoKV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gWzAsIDEwMF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RmllbGRJbmZvKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZChzaXplVmlzVmFyID8gc2l6ZVZpc1Zhci5maWVsZCA6IHJlbmRlcmVyLmZpZWxkKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0ge1xuICAgICAgICAgICAgZmllbGQ6IChzaXplVmlzVmFyID09PSBudWxsIHx8IHNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpemVWaXNWYXIuZmllbGQpIHx8IHJlbmRlcmVyLmZpZWxkLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogKHNpemVWaXNWYXIgPT09IG51bGwgfHwgc2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2l6ZVZpc1Zhci52YWx1ZUV4cHJlc3Npb24pIHx8IHJlbmRlcmVyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogKHNpemVWaXNWYXIgPT09IG51bGwgfHwgc2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2l6ZVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSkgfHwgcmVuZGVyZXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZpZWxkSW5mbztcbiAgICB9XG4gICAgaGFuZGxlWmlnemFnQ2xpY2sobmV3VmFsdWUpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHRoaXMuZ2V0RmllbGRJbmZvKCk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IHNpemVWaXNWYXJcbiAgICAgICAgICAgID8gc2l6ZVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgICAgIDogcmVuZGVyZXIubm9ybWFsaXphdGlvbkZpZWxkO1xuICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgc3RhdGlzdGljcywgKF9hID0gbmV3VmFsdWUgPT09IG51bGwgfHwgbmV3VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5ld1ZhbHVlLm1pbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUsIChfYiA9IG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5tYXgpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgaWYgKCFuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nQ29sb3JTaXplU2xpZGVyLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nQ29sb3JTaXplU2xpZGVyQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQ3NzID0gXCIuc3ltYm9sLXBhaXItbmFtZXtkaXNwbGF5OmZsZXg7cGFkZGluZzo2cHg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO2JvcmRlci1yYWRpdXM6MDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7b3V0bGluZS1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7b3V0bGluZS13aWR0aDoxcHg7b3V0bGluZS1zdHlsZTpzb2xpZDtib3gtc2hhZG93OnRyYW5zcGFyZW50IDBweCAwcHggMHB4IDFweCBpbnNldH0uc3ltYm9sLXBhaXItbmFtZTpob3ZlcntvdXRsaW5lLXdpZHRoOjJweH0uc3ltYm9sLXBhaXItbmFtZTpmb2N1c3tib3gtc2hhZG93Omluc2V0IDAgMCAwIDJweCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCk7b3V0bGluZS1vZmZzZXQ6MnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJCdXR0b25CZWZvcmVPcGVuID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQmVmb3JlT3BlblwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJCdXR0b25FcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy5zeW1ib2xQYWlyUG9wb3Zlck9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgYXJjZ2lzU21hcnRNYXBwaW5nQ2xvc2VQb3BvdmVyc0hhbmRsZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zeW1ib2xQYWlyUG9wb3Zlck9wZW4gPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuc3ltYm9sUGFpclBvcG92ZXJOb2RlKSB7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLnN5bWJvbFBhaXJQb3BvdmVyTm9kZS5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlQ2hpbGQodGhpcy5zeW1ib2xQYWlyUG9wb3Zlck5vZGUpO1xuICAgICAgICAgICAgdGhpcy5zeW1ib2xQYWlyUG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgICAgIHRoaXMuYWxsU3ltYm9sUGFpcnMgPSBbXG4gICAgICAgICAgICBbXCJzaW5nbGVcIiwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLnNpbmdsZVN5bWJvbF0sXG4gICAgICAgICAgICBbXCJjaXJjbGVcIiwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLmNpcmNsZXNdLFxuICAgICAgICAgICAgW1wic3F1YXJlXCIsIHN0cmluZ3Muc3ltYm9sUGFpckJ1dHRvbi5zcXVhcmVzXSxcbiAgICAgICAgICAgIFtcImNhcmV0XCIsIHN0cmluZ3Muc3ltYm9sUGFpckJ1dHRvbi5jaGV2cm9uc10sXG4gICAgICAgICAgICBbXCJjaXJjbGUtY2FyZXRcIiwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLmNpcmNsZXNDaGV2cm9uc10sXG4gICAgICAgICAgICBbXCJhcnJvd1wiLCBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uYXJyb3dzXSxcbiAgICAgICAgICAgIFtcImNpcmNsZS1hcnJvd1wiLCBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uY2lyY2xlQXJyb3dzXSxcbiAgICAgICAgICAgIFtcInBsdXMtbWludXNcIiwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLnBsdXNNaW51c10sXG4gICAgICAgICAgICBbXCJjaXJjbGUtcGx1cy1taW51c1wiLCBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uY2lyY2xlUGx1c01pbnVzXSxcbiAgICAgICAgICAgIFtcImhhcHB5LXNhZFwiLCBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uZmFjZXNdLFxuICAgICAgICAgICAgW1widHJpYW5nbGVcIiwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLnRyaWFuZ2xlc10sXG4gICAgICAgICAgICBbXCJ0aHVtYlwiLCBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24udGh1bWJzXVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IHN5bWJvbFN0eWxlID0gYXV0aEluZm8udW5pdmFyaWF0ZVN5bWJvbFN0eWxlO1xuICAgICAgICBsZXQgc3ltYm9sUGFpck5hbWUgPSBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uc2luZ2xlU3ltYm9sO1xuICAgICAgICB0aGlzLmFsbFN5bWJvbFBhaXJzLmZvckVhY2goKHN5bWJvbFBhaXIpID0+IHtcbiAgICAgICAgICAgIGlmIChzeW1ib2xTdHlsZSA9PT0gc3ltYm9sUGFpclswXSkge1xuICAgICAgICAgICAgICAgIHN5bWJvbFBhaXJOYW1lID0gc3ltYm9sUGFpclsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzeW1ib2xTdHlsZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgc3ltYm9sUGFpck5hbWUgPSBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uY3VzdG9tO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLnN5bWJvbFBhaXIsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLnN5bWJvbFBhaXJCdXR0b25Ob2RlID0gbm9kZSksIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgaWNvbkVuZDogXCJjaGV2cm9uLWRvd25cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiZnVsbFwiLCB0YWJpbmRleDogXCIwXCIsIHJvbGU6IFwiYnV0dG9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBcImFyaWEtaGFzcG9wdXBcIjogXCJ0cnVlXCIsIGxhYmVsOiBzdHJpbmdzLnN5bWJvbFBhaXJCdXR0b24uc3ltYm9sUGFpciwgb25DbGljazogKCkgPT4gdGhpcy5zeW1ib2xQYWlyUG9wb3Zlck9wZW4gPyBjbG9zZVBvcG92ZXJzKCkgOiB0aGlzLmhhbmRsZVN5bWJvbFBhaXJDbGljaygpIH0sIHN5bWJvbFBhaXJOYW1lKSkpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBQcml2YXRlIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBoYW5kbGVTeW1ib2xQYWlyQ2xpY2soKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sUGFpckJ1dHRvbkJlZm9yZU9wZW4uZW1pdCgpO1xuICAgICAgICBjb25zdCBzeW1ib2xQaWNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLXBhaXItcG9wb3ZlclwiKTtcbiAgICAgICAgdGhpcy5zeW1ib2xQYWlyUG9wb3Zlck5vZGUgPSBzeW1ib2xQaWNrZXI7XG4gICAgICAgIHN5bWJvbFBpY2tlci5wb3BvdmVyUHJvcHMgPSB7XG4gICAgICAgICAgICByZWZFbGVtZW50OiB0aGlzLmZsb3dJdGVtTm9kZSxcbiAgICAgICAgICAgIHBsYWNlbWVudDogXCJsZWFkaW5nXCIsXG4gICAgICAgICAgICBvZmZzZXREaXN0YW5jZTogMCxcbiAgICAgICAgICAgIG92ZXJsYXlQb3NpdGlvbmluZzogXCJhYnNvbHV0ZVwiLFxuICAgICAgICAgICAgZmxpcERpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHRyaWdnZXJEaXNhYmxlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgc3ltYm9sUGlja2VyLnN5bWJvbFBhaXJzID0gdGhpcy5hbGxTeW1ib2xQYWlycztcbiAgICAgICAgc3ltYm9sUGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyUG9wb3ZlckNsb3NlXCIsICgpID0+IHRoaXMuY2xvc2VQb3BvdmVyKCkpO1xuICAgICAgICBzeW1ib2xQaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJQb3BvdmVyQ2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3ltYm9sU3R5bGUgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICB0aGlzLmNsb3NlUG9wb3ZlcigpO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICByZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvclNpemVVbml2YXJpYXRlUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBzeW1ib2xTdHlsZTogc3ltYm9sU3R5bGUgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQ2hhbmdlLmVtaXQoKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uRXJyb3IuZW1pdChlcnJvcikpO1xuICAgICAgICB9KTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzeW1ib2xQaWNrZXIpO1xuICAgICAgICB0aGlzLnN5bWJvbFBhaXJQb3BvdmVyT3BlbiA9IHRydWU7XG4gICAgfVxuICAgIGNsb3NlUG9wb3ZlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLnN5bWJvbFBhaXJQb3BvdmVyT3BlbiA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5zeW1ib2xQYWlyUG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuc3ltYm9sUGFpclBvcG92ZXJOb2RlLnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmVDaGlsZCh0aGlzLnN5bWJvbFBhaXJQb3BvdmVyTm9kZSk7XG4gICAgICAgICAgICB0aGlzLnN5bWJvbFBhaXJQb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc3ltYm9sUGFpckJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSwgMzAwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sUGFpckJ1dHRvbi5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJCdXR0b25Dc3M7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJQb3BvdmVyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyUG9wb3ZlckNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyUG9wb3ZlckNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJQb3BvdmVyQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyUG9wb3ZlckNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5yZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoYm91bmRpbmdSZWN0cykgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFuZWwgPSBib3VuZGluZ1JlY3RzLnBvcCgpO1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyV2lkdGggPSBwYW5lbC5jb250ZW50UmVjdC53aWR0aCAqIDEuMDU7XG4gICAgICAgICAgICB0aGlzLm9mZnNldERpc3RhbmNlID0gLU1hdGgucm91bmQodGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAqIDEuMDI1KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9wb3ZlclByb3BzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN5bWJvbFBhaXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcG92ZXJXaWR0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgQ2FsbHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHRoaXMuY2FsY2l0ZVBvcG92ZXJOb2RlLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmNhbGNpdGVQb3BvdmVyTm9kZS5zZXRGb2N1cygpKTtcbiAgICAgICAgdGhpcy5yZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMucG9wb3ZlclByb3BzLnJlZkVsZW1lbnQpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy5yZXNpemVPYnNlcnZlci51bm9ic2VydmUodGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kZXIgIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBwcm9wcyA9IHRoaXMucG9wb3ZlclByb3BzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLmNhbGNpdGVQb3BvdmVyTm9kZSA9IG5vZGUpLCBkaXI6IHNtYXJ0TWFwcGluZ1N0YXRlLmlzUlRMID8gXCJydGxcIiA6IFwibHRyXCIsIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsIG9wZW46IHRydWUsIGhlYWRpbmc6IHN0cmluZ3Muc3ltYm9sUGFpckJ1dHRvbi5zeW1ib2xQYWlyLCBjbG9zYWJsZTogdHJ1ZSwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiBwcm9wcy5yZWZFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogdGhpcy5vZmZzZXREaXN0YW5jZSwgb2Zmc2V0U2tpZGRpbmc6IDEwNSwgb3ZlcmxheVBvc2l0aW9uaW5nOiBwcm9wcy5vdmVybGF5UG9zaXRpb25pbmcsIHRyaWdnZXJEaXNhYmxlZDogcHJvcHMudHJpZ2dlckRpc2FibGVkLCBsYWJlbDogc3RyaW5ncy5zeW1ib2xQYWlyQnV0dG9uLnN5bWJvbFBhaXIsIG9uQ2FsY2l0ZVBvcG92ZXJDbG9zZTogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyUG9wb3ZlckNsb3NlLmVtaXQoKSwgc3R5bGU6IHsgd2lkdGg6IGAke3RoaXMucG9wb3ZlcldpZHRofXB4YCB9IH0sIGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZS1wZXJzaXN0XCIgfSwgdGhpcy5yZW5kZXJJdGVtcygpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVySXRlbXMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBzeW1ib2xTdHlsZSA9IGF1dGhJbmZvLnVuaXZhcmlhdGVTeW1ib2xTdHlsZSB8fCBcInNpbmdsZVwiO1xuICAgICAgICBjb25zdCBpdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnN5bWJvbFBhaXJzLmZvckVhY2goKHN5bWJvbFBhaXIpID0+IHtcbiAgICAgICAgICAgIGl0ZW1zLnB1c2godGhpcy5yZW5kZXJJdGVtKHN5bWJvbFBhaXJbMF0sIHN5bWJvbFBhaXJbMV0sIHN5bWJvbFN0eWxlID09PSBzeW1ib2xQYWlyWzBdKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaXRlbXM7XG4gICAgfVxuICAgIHJlbmRlckl0ZW0oc3ltYm9sVHlwZSwgbGFiZWwsIGlzU2VsZWN0ZWQpIHtcbiAgICAgICAgY29uc3QgaW1hZ2VQYXRoID0gc3ltYm9sVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN5bWJvbFR5cGUuc2xpY2UoMSkgKyBcIi5zdmdcIjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBsYWJlbDogbGFiZWwsIHNlbGVjdGVkOiBpc1NlbGVjdGVkLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJQb3BvdmVyQ2hhbmdlLmVtaXQoc3ltYm9sVHlwZSksIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sUGFpclBvcG92ZXJDaGFuZ2UuZW1pdChzeW1ib2xUeXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIHN5bWJvbFR5cGUgIT09IFwic2luZ2xlXCIgPyAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2NhbGU6IFwic1wiLCBzbG90OiBcImFjdGlvbnMtZW5kXCIsIHRleHQ6IFwic3ltYm9sLXBhaXItc3ltYm9sc1wiIH0sIGgoXCJkaXZcIiwgeyBzdHlsZToge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjMycHhcIixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFwiMzJweFwiLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogYHVybCgke2dldEFzc2V0UGF0aChgLi9hc3NldHMvYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLXBhaXItaW1hZ2VzL2ApfSR7aW1hZ2VQYXRofSlgXG4gICAgICAgICAgICB9IH0pKSkgOiBudWxsKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmV4cG9ydCB7IEFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlciBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19jb2xvcl9zaXplX3NsaWRlciwgQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sUGFpckJ1dHRvbiBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19zeW1ib2xfcGFpcl9idXR0b24sIEFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJQb3BvdmVyIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3N5bWJvbF9wYWlyX3BvcG92ZXIgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctY29sb3Itc2l6ZS1zbGlkZXJfMy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHMgYXMgc21hcnRNYXBwaW5nU3RhdGUgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5cbmZ1bmN0aW9uIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMoY29uZmlnLCB0aW1lWm9uZSkge1xuICAgIGNvbmZpZy5sYWJlbEZvcm1hdEZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBnZXREYXRlRGlzcGxheVN0cmluZyh2YWx1ZSwgdGltZVpvbmUsIFwic2hvcnQtZGF0ZVwiKTtcbiAgICB9O1xuICAgIGNvbmZpZy5pbnB1dEZvcm1hdEZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBnZXREYXRlRGlzcGxheVN0cmluZyh2YWx1ZSwgdGltZVpvbmUsIFwic2hvcnQtZGF0ZVwiKTtcbiAgICB9O1xuICAgIGNvbmZpZy5pbnB1dFBhcnNlRnVuY3Rpb24gPSAodmFsdWUpID0+IHtcbiAgICAgICAgcmV0dXJuIG1hcFRaVG9VVEMoRGF0ZS5wYXJzZSh2YWx1ZSksIHRpbWVab25lKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gdXRjVG9EYXRlUGlja2VyKHZhbHVlLCB0aW1lWm9uZSkge1xuICAgIC8vIGRhdGUgaXMgaW4gVVRDXG4gICAgLy8gd2UgbmVlZCBhIG1hcCB0aW1lem9uZVxuICAgIGxldCBzdHI7XG4gICAgaWYgKCF0aW1lWm9uZSB8fCB0aW1lWm9uZSA9PT0gXCJzeXN0ZW1cIikge1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbWFwRGF0ZVN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmUgfSk7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKG5ldyBEYXRlKG1hcERhdGVTdHIpLmdldFRpbWUoKSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJ1dGNUb0RhdGVQaWNrZXJcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgc3RyKTtcbiAgICByZXR1cm4gc3RyO1xufVxuZnVuY3Rpb24gdXRjVG9UaW1lUGlja2VyKHZhbHVlLCB0aW1lWm9uZSwgYWRkU2Vjb25kcykge1xuICAgIC8vIGRhdGUgaXMgaW4gVVRDXG4gICAgLy8gd2UgbmVlZCBhIG1hcCB0aW1lem9uZVxuICAgIGxldCBzdHI7XG4gICAgaWYgKCF0aW1lWm9uZSB8fCB0aW1lWm9uZSA9PT0gXCJzeXN0ZW1cIikge1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbWFwRGF0ZVN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmUgfSk7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKG5ldyBEYXRlKG1hcERhdGVTdHIpLmdldFRpbWUoKSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgLy8gc3RyID0gXCIyMDIzLTA5LTIwVDEzOjA2OjAwLjAwMFpcIlxuICAgIHN0ciA9IGFkZFNlY29uZHMgPyBzdHIuc3Vic3RyaW5nKDExLCAxOSkgOiBzdHIuc3Vic3RyaW5nKDExLCAxNik7XG4gICAgLy8gY29uc29sZS5sb2coXCJ1dGNUb1RpbWVQaWNrZXJcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgc3RyKTtcbiAgICByZXR1cm4gc3RyO1xufVxuZnVuY3Rpb24gZGF0ZVBpY2tlclRvVVRDKGRhdGVTdHJpbmcsIHRpbWVab25lKSB7XG4gICAgLy8gZGF0ZSBpcyBpbiBtYXAgdGltZXpvbmVcbiAgICAvLyB3ZSBuZWVkIGEgVVRDIFVOSVggdGltZXN0YW1wXG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKTtcbiAgICAvLyB0aGlzIGlzIHJlYWQgYXMgY3VycmVudCB0aW1lOyB0b0lTT1N0cmluZygpIHdvdWxkIHJlYXR1cm4gVVRDIHRpbWUgKGUuZy4gKzcgaG91cnMgZnJvbSBwYWNpZmljKVxuICAgIC8vIGZpeCB0aGUgb2Zmc2V0XG4gICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpIC0gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApO1xuICAgIC8vIGRhdGUgbm93IGNvbnRhaW5zIHRoZSB1c2VyJ3MgZW50ZXJlZCB0aW1lXG4gICAgbGV0IHZhbHVlO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgLy8gYWRkIGRpZmZlcmVuY2UgYmV0d2VlbiBsb2NhbCB0aW1lIGFuZCBVVENcbiAgICAgICAgdmFsdWUgPSBkYXRlLmdldFRpbWUoKSArIGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aW1lWm9uZSA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgLy8gdGFrZSB3aGF0IHlvdSBnZXRcbiAgICAgICAgdmFsdWUgPSBkYXRlLmdldFRpbWUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIGFkZCBkaWZmZXJlbmNlIGJldHdlZW4gbWFwIHRpbWUgYW5kIFVUQ1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoZGF0ZS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmU6IFwidXRjXCIgfSkpLmdldFRpbWUoKSAtXG4gICAgICAgICAgICBuZXcgRGF0ZShkYXRlLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZSB9KSkuZ2V0VGltZSgpO1xuICAgICAgICB2YWx1ZSA9IGRhdGUuZ2V0VGltZSgpICsgZGlmZjtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJkYXRlUGlja2VyVG9VVENcIiwgZGF0ZS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgbmV3IERhdGUodmFsdWUpLnRvSVNPU3RyaW5nKCkpO1xuICAgIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIG1hcFRaVG9VVEModmFsdWUsIHRpbWVab25lKSB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIC8vIHZhbHVlIGlzIGluIG1hcCB0aW1lem9uZVxuICAgIC8vIHdlIG5lZWQgYSBVVEMgdGltZXN0YW1wXG4gICAgbGV0IG5ld1ZhbHVlO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgLy8gYWRkIGRpZmZlcmVuY2UgYmV0d2VlbiBsb2NhbCB0aW1lIGFuZCBVVENcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWUgKyBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIC8vIHRha2Ugd2hhdCB5b3UgZ2V0XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBhZGQgZGlmZmVyZW5jZSBiZXR3ZWVuIG1hcCB0aW1lIGFuZCBVVENcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBuZXcgRGF0ZShkYXRlLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZTogXCJ1dGNcIiB9KSkuZ2V0VGltZSgpIC1cbiAgICAgICAgICAgIG5ldyBEYXRlKGRhdGUudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7IHRpbWVab25lIH0pKS5nZXRUaW1lKCk7XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWUgKyBkaWZmO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIm1hcFRaVG9VVENcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtIFwiLCBuZXcgRGF0ZShuZXdWYWx1ZSkudG9JU09TdHJpbmcoKSk7XG4gICAgcmV0dXJuIG5ld1ZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0RGF0ZURpc3BsYXlTdHJpbmcodmFsdWUsIHRpbWVab25lLCBkYXRlRm9ybWF0KSB7XG4gICAgY29uc3QgeyBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBsZXQgc3RyO1xuICAgIGlmICh0aW1lWm9uZSA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgc3RyID0gbW9kdWxlcy5pbnRsLmZvcm1hdERhdGUodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhkYXRlRm9ybWF0IHx8IFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpKSwgeyB0aW1lWm9uZTogXCJ1dGNcIiwgdGltZVpvbmVOYW1lOiBcInNob3J0T2Zmc2V0XCIgfSkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8ga25vd24gaXNzdWVzIHdpdGggZm9ybWF0dGluZyBpdC1DSFxuICAgICAgICBzdHIgPSBtb2R1bGVzLmludGwuZm9ybWF0RGF0ZSh2YWx1ZSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBtb2R1bGVzLmludGwuY29udmVydERhdGVGb3JtYXRUb0ludGxPcHRpb25zKGRhdGVGb3JtYXQgfHwgXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIikpLCB7IHRpbWVab25lIH0pKTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJnZXREYXRlRGlzcGxheVN0cmluZ1wiLCB2YWx1ZSwgXCIgLSBcIiwgbmV3IERhdGUodmFsdWUpLnRvSVNPU3RyaW5nKCksIFwiIC0+IFwiLCBzdHIpO1xuICAgIHJldHVybiBzdHI7XG59XG5cbmV4cG9ydCB7IGFkZERhdGVGb3JtYXRGdW5jdGlvbnMgYXMgYSwgdXRjVG9UaW1lUGlja2VyIGFzIGIsIGRhdGVQaWNrZXJUb1VUQyBhcyBkLCB1dGNUb0RhdGVQaWNrZXIgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRlLTc5YzdkOTNjLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcblxuZnVuY3Rpb24gYmFyQ3JlYXRlZEZ1bmN0aW9uKGNvbG9yVmlzVmFyT3JCcmVha3MsIGhpc3RvZ3JhbSwgc2xpZGVyQmFycywgaWR4LCBlbGVtZW50KSB7XG4gICAgY29uc3QgY29sb3IgPSAoY29sb3JWaXNWYXJPckJyZWFrcyA9PT0gbnVsbCB8fCBjb2xvclZpc1Zhck9yQnJlYWtzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2xvclZpc1Zhck9yQnJlYWtzLmxlbmd0aClcbiAgICAgICAgPyBnZXRDb2xvckZvclZhbHVlQ2xhc3NlZChjb2xvclZpc1Zhck9yQnJlYWtzLCBoaXN0b2dyYW0uYmluc1tpZHhdKVxuICAgICAgICA6IGdldENvbG9yRm9yVmFsdWUoY29sb3JWaXNWYXJPckJyZWFrcy5zdG9wcywgaGlzdG9ncmFtLmJpbnNbaWR4XSk7XG4gICAgY29sb3IgJiYgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIGNvbG9yLnRvSGV4KCkpO1xuICAgIGNvbG9yICYmIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwib3BhY2l0eVwiLCBgJHtNYXRoLm1heChjb2xvci5hLCAwLjIpfWApO1xuICAgIHNsaWRlckJhcnMucHVzaChlbGVtZW50KTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZUhpc3RvZ3JhbUNvbG9ycyhzbGlkZXIsIHNsaWRlckJhcnMsIGNvbG9yVmlzVmFyT3JCcmVha3MsIGhpc3RvZ3JhbSkge1xuICAgIHNsaWRlckJhcnMgPT09IG51bGwgfHwgc2xpZGVyQmFycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2xpZGVyQmFycy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBiaW4gPSAoaGlzdG9ncmFtIHx8IHNsaWRlci5oaXN0b2dyYW1Db25maWcpLmJpbnNbaW5kZXhdO1xuICAgICAgICBjb25zdCBjb2xvciA9IHNsaWRlci5icmVha3NcbiAgICAgICAgICAgID8gZ2V0Q29sb3JGb3JWYWx1ZUNsYXNzZWQoY29sb3JWaXNWYXJPckJyZWFrcyB8fCBzbGlkZXIuYnJlYWtzLCBiaW4pXG4gICAgICAgICAgICA6IGdldENvbG9yRm9yVmFsdWUoKGNvbG9yVmlzVmFyT3JCcmVha3MgfHwgc2xpZGVyKVxuICAgICAgICAgICAgICAgIC5zdG9wcywgYmluKTtcbiAgICAgICAgY29sb3IgJiYgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIGNvbG9yLnRvSGV4KCkpO1xuICAgICAgICBjb2xvciAmJiBlbGVtZW50LnNldEF0dHJpYnV0ZShcIm9wYWNpdHlcIiwgYCR7TWF0aC5tYXgoY29sb3IuYSwgMC4yKX1gKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldENvbG9yRm9yVmFsdWUoc3RvcHMsIGJpbikge1xuICAgIC8vIGluZmVycyB0aGUgY29sb3IgZm9yIGEgZ2l2ZW4gdmFsdWVcbiAgICAvLyBiYXNlZCBvbiB0aGUgc3RvcHMgZnJvbSBhIENvbG9yVmFyaWFibGVcbiAgICBjb25zdCB7IG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGlmICghYmluKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSAoYmluLm1heFZhbHVlIC0gYmluLm1pblZhbHVlKSAvIDIgKyBiaW4ubWluVmFsdWU7XG4gICAgbGV0IG1pblN0b3AgPSBzdG9wc1swXTtcbiAgICBsZXQgbWF4U3RvcCA9IHN0b3BzW3N0b3BzLmxlbmd0aCAtIDFdO1xuICAgIGNvbnN0IG1pblN0b3BWYWx1ZSA9IG1pblN0b3AudmFsdWU7XG4gICAgY29uc3QgbWF4U3RvcFZhbHVlID0gbWF4U3RvcC52YWx1ZTtcbiAgICBpZiAodmFsdWUgPCBtaW5TdG9wVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG1pblN0b3AuY29sb3I7XG4gICAgfVxuICAgIGlmICh2YWx1ZSA+IG1heFN0b3BWYWx1ZSkge1xuICAgICAgICByZXR1cm4gbWF4U3RvcC5jb2xvcjtcbiAgICB9XG4gICAgY29uc3QgZXhhY3RNYXRjaGVzID0gc3RvcHMuZmlsdGVyKChzdG9wKSA9PiBzdG9wLnZhbHVlID09PSB2YWx1ZSk7XG4gICAgaWYgKGV4YWN0TWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBleGFjdE1hdGNoZXNbMF0uY29sb3I7XG4gICAgfVxuICAgIG1pblN0b3AgPSBudWxsO1xuICAgIG1heFN0b3AgPSBudWxsO1xuICAgIHN0b3BzLmZvckVhY2goKHN0b3AsIGkpID0+IHtcbiAgICAgICAgaWYgKCFtaW5TdG9wICYmICFtYXhTdG9wICYmIHN0b3AudmFsdWUgPj0gdmFsdWUpIHtcbiAgICAgICAgICAgIG1pblN0b3AgPSBzdG9wc1tpIC0gMV07XG4gICAgICAgICAgICBtYXhTdG9wID0gc3RvcDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHdlaWdodGVkUG9zaXRpb24gPSAodmFsdWUgLSBtaW5TdG9wLnZhbHVlKSAvIChtYXhTdG9wLnZhbHVlIC0gbWluU3RvcC52YWx1ZSk7XG4gICAgcmV0dXJuIG1vZHVsZXMuZXNyaUNvbG9yLmJsZW5kQ29sb3JzKG1pblN0b3AuY29sb3IsIG1heFN0b3AuY29sb3IsIHdlaWdodGVkUG9zaXRpb24pO1xufVxuZnVuY3Rpb24gZ2V0Q29sb3JGb3JWYWx1ZUNsYXNzZWQoYnJlYWtzLCBiaW4pIHtcbiAgICAvLyBpbmZlcnMgdGhlIGNvbG9yIGZvciBhIGdpdmVuIHZhbHVlXG4gICAgLy8gYmFzZWQgb24gdGhlIGNsYXNzQnJlYWtJbmZvXG4gICAgaWYgKCFiaW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB2YWx1ZSA9IChiaW4ubWF4VmFsdWUgLSBiaW4ubWluVmFsdWUpIC8gMiArIGJpbi5taW5WYWx1ZTtcbiAgICBsZXQgbWluQnJlYWsgPSBicmVha3NbMF07XG4gICAgbGV0IG1heEJyZWFrID0gYnJlYWtzW2JyZWFrcy5sZW5ndGggLSAxXTtcbiAgICBpZiAodmFsdWUgPCBtaW5CcmVhay5taW4gfHwgdmFsdWUgPiBtYXhCcmVhay5tYXgpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29uc3QgZXhhY3RNYXRjaGVzID0gYnJlYWtzLmZpbHRlcigoYikgPT4gYi5taW4gPT09IHZhbHVlKTtcbiAgICBpZiAoZXhhY3RNYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIGV4YWN0TWF0Y2hlc1swXS5jb2xvcjtcbiAgICB9XG4gICAgbWluQnJlYWsgPSBicmVha3NbYnJlYWtzLmxlbmd0aCAtIDFdO1xuICAgIG1heEJyZWFrID0gbnVsbDtcbiAgICBicmVha3MuZm9yRWFjaCgoYiwgaSkgPT4ge1xuICAgICAgICBpZiAoIW1heEJyZWFrICYmIGIubWluID49IHZhbHVlKSB7XG4gICAgICAgICAgICBtaW5CcmVhayA9IGJyZWFrc1tpIC0gMV07XG4gICAgICAgICAgICBtYXhCcmVhayA9IGI7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWluQnJlYWsuY29sb3I7XG59XG5cbmV4cG9ydCB7IGJhckNyZWF0ZWRGdW5jdGlvbiBhcyBiLCB1cGRhdGVIaXN0b2dyYW1Db2xvcnMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zbGlkZXItZTE2MmUxMzYuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9