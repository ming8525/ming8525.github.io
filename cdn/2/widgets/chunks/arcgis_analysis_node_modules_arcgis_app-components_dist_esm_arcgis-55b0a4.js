"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-55b0a4"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-locator-select.entry.js":
/*!***************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-locator-select.entry.js ***!
  \***************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_locator_select: () => (/* binding */ ArcgisNewItemPagesLocatorSelect)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


































const locatorTypes = ["locator-view", "locator"];

const arcgisNewItemPagesLocatorSelectCss = ".tile-select:not(:last-child){margin-bottom:1.5rem}.custom-parameter-container{margin-top:1.5rem}";

const ArcgisNewItemPagesLocatorSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.handleAuthSwitchChange = (event) => {
            this.storeAuth = event.detail;
        };
        this.handleNewUrl = async (args) => {
            const { type, url } = args;
            this.type = type;
            this.locatorUrl = url;
            this.isSecured = null;
            this.error = null;
            if (!!url) {
                this.allowStoredAuth = false;
                this.storeAuth = false;
                // Fetch data to check if we need auth or not
                this.loading = true;
                await this.getServiceInfo(false);
                this.loading = false;
            }
        };
        this.selectedLocatorType = "locator-view";
        this.locatorUrl = "";
        this.type = undefined;
        this.loading = false;
        this.error = null;
        this.canPublishLocatorView = true;
        this.allowStoredAuth = false;
        this.storeAuth = false;
        this.isSecured = null;
        this.serviceInfo = null;
        this.itemType = undefined;
    }
    async componentWillLoad() {
        var _a;
        const globalI18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_6__.u.i18n;
        this.i18n = globalI18n.locatorSelect;
        this.urlTypeI18n = globalI18n.urlType;
        this.urlI18n = globalI18n.url;
        this.allowStoredAuth = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.allowStoredAuth;
        this.storeAuth = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth;
        this.isSecured = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.isSecured;
        this.itemType = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.type;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        this.canPublishLocatorView = (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_3__.i)(user, portal);
        this.selectedLocatorType = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.locatorType) !== null && _a !== void 0 ? _a : "locator-view";
        if (!this.canPublishLocatorView) {
            this.selectedLocatorType = "locator";
        }
        if (this.selectedLocatorType === "locator") {
            this.locatorUrl = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.url;
        }
    }
    async handleNext() {
        const { selectedLocatorType, urlI18n, locatorUrl, allowStoredAuth } = this;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.locatorType = selectedLocatorType;
        if (selectedLocatorType === "locator-view") {
            const url = await (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_3__.q)();
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.newItemMode = "create";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.type = "Geocoding Service";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.typeKeywords = ["Geocoding filter"];
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.thumbnailURL = "https://static.arcgis.com/images/desktopapp.png";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.createAsServiceProxy = true;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.url = url;
        }
        else {
            if (!locatorUrl) {
                this.inputRef.focusMainInput();
                this.error = urlI18n.invalidUrl;
                return;
            }
            const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
            const { error, result } = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_8__.g)((0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_8__.f)(locatorUrl, portal.allSSL), portal.isPortal);
            // TODO: double check service info OR don't clear error if service info is invalid;
            // currently invalid geocoders will still allow next
            if (error) {
                this.error = urlI18n[error.code];
                return;
            }
            if (result !== "Geocoding Service") {
                this.error = urlI18n.invalidUrl;
                return;
            }
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.url = locatorUrl;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.type = "Geocoding Service";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.newItemMode = "url";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.allowStoredAuth = allowStoredAuth;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth = this.storeAuth;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.isSecured = this.isSecured;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.serviceInfo = this.serviceInfo;
            if (this.storeAuth) {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.checkAuth = true;
            }
            if (this.allowStoredAuth && !this.storeAuth) {
                // Fetch again to trigger the sign in modal
                this.loading = true;
                const success = await this.getServiceInfo(true);
                this.loading = false;
                if (!success) {
                    return;
                }
            }
        }
        if (this.allowStoredAuth && this.storeAuth) {
            this.newItemUpdatePage.emit("auth");
        }
        else {
            this.newItemUpdatePage.emit("itemProperties");
        }
    }
    async getServiceInfo(checkAuth = false) {
        // TODO: think of a way to generalize this with `pages-url-type`
        const { urlTypeI18n, locatorUrl, type } = this;
        const { error, result } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__.n)({
            url: locatorUrl,
            customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.customParameters,
            type,
            checkAuth,
            // TODO: refactor this once we refactor the switch handle
            storeAuth: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth
        });
        if (error || !result) {
            if ((error === null || error === void 0 ? void 0 : error.message) === "does not point to a GIS server") {
                this.error = urlTypeI18n.serviceNotGIS;
            }
            else if ((error === null || error === void 0 ? void 0 : error.code) === "serviceNotExist") {
                this.error = urlTypeI18n.serviceNotExist;
            }
            else if ((error === null || error === void 0 ? void 0 : error.code) === "unsupportedWFSVersion") {
                this.error = urlTypeI18n.unsupportedWFSVersion;
            }
            else {
                this.error = urlTypeI18n[error === null || error === void 0 ? void 0 : error.code] || urlTypeI18n.serviceNotExist;
            }
            return false;
        }
        const { tags, title, isSecured, allowStoredAuth, serviceInfo } = result;
        this.allowStoredAuth = allowStoredAuth;
        this.isSecured = isSecured;
        this.serviceInfo = serviceInfo;
        if (tags) {
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_2__.i.tags = tags;
        }
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_2__.i.title = (title === null || title === void 0 ? void 0 : title.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_7__.s, "")) || "";
        return true;
    }
    render() {
        const { error, i18n, urlTypeI18n, loading, selectedLocatorType, locatorUrl, canPublishLocatorView, isSecured, allowStoredAuth, itemType } = this;
        const { config: { helpBase, helpMap } } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        // TODO: add auth stuff
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, canPublishLocatorView && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.heading }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, locatorTypes.map((type) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: selectedLocatorType === type, heading: i18n.options[type].title, description: i18n.options[type].description, name: "tile-layer-type", "input-enabled": true, width: "full", type: "radio", value: type, onCalciteTileSelectChange: () => (this.selectedLocatorType = type) })))))), selectedLocatorType === "locator" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.url.heading, content: i18n.url.description }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-url", { url: locatorUrl, inputTitle: " ", placeholder: "https://myserver.com/arcgis/rest/services/folder/service/GeocodeServer",
            // TODO: debounce this
            onNewItemUrlChange: (event) => this.handleNewUrl(event.detail), ref: (ele) => (this.inputRef = ele) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "custom-parameter-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameters", { itemType: itemType })), allowStoredAuth && !!isSecured && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { onSwitchChange: this.handleAuthSwitchChange, header: urlTypeI18n.storeAuth, headerLink: {
                text: urlTypeI18n.learnMore,
                href: `${helpBase}${helpMap["120000597"]}`
            }, defaultChecked: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_5__.a.storeAuth })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: loading, text: urlTypeI18n.getServiceInfo }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: !!error, description: error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesLocatorSelect.style = arcgisNewItemPagesLocatorSelectCss;



//# sourceMappingURL=arcgis-new-item-pages-locator-select.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTU1YjBhNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDaUg7QUFDekQ7QUFDaUI7QUFDc0I7QUFDMUI7QUFDVjtBQUNOO0FBQ1k7QUFDRztBQUN2QztBQUNDO0FBQ0s7QUFDRDtBQUNBO0FBQ047QUFDUztBQUNUO0FBQ0s7QUFDRjtBQUNIO0FBQ0M7QUFDRjtBQUNHO0FBQ0g7QUFDQztBQUNPO0FBQ0Q7QUFDQTtBQUNHO0FBQ1Y7QUFDQztBQUNDO0FBQ0U7O0FBRS9COztBQUVBLDBFQUEwRSxxQkFBcUIsNEJBQTRCLGtCQUFrQjs7QUFFN0k7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLGlDQUFpQyxxREFBVztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixZQUFZO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw4Q0FBWTtBQUN2QztBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isb0RBQVk7QUFDM0MseUJBQXlCLG9EQUFZO0FBQ3JDLHlCQUF5QixvREFBWTtBQUNyQyx3QkFBd0Isb0RBQVk7QUFDcEMsZ0JBQWdCLGVBQWUsRUFBRSxrREFBVztBQUM1QyxxQ0FBcUMsMERBQW9CO0FBQ3pELHlDQUF5QyxvREFBWTtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixvREFBWTtBQUMxQztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNERBQTREO0FBQzVFLFFBQVEsb0RBQVk7QUFDcEI7QUFDQSw4QkFBOEIsMERBQW1CO0FBQ2pELFlBQVksb0RBQVk7QUFDeEIsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCLFlBQVksb0RBQVk7QUFDeEIsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVMsRUFBRSxrREFBVztBQUMxQyxvQkFBb0IsZ0JBQWdCLEVBQUUsbURBQVUsQ0FBQyxtREFBUztBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0RBQVk7QUFDeEIsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCLFlBQVksb0RBQVk7QUFDeEIsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCLFlBQVksb0RBQVk7QUFDeEI7QUFDQSxnQkFBZ0Isb0RBQVk7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixnQ0FBZ0M7QUFDaEQsZ0JBQWdCLGdCQUFnQixRQUFRLDZEQUFpQjtBQUN6RDtBQUNBLDhCQUE4QixvREFBWTtBQUMxQztBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsb0RBQVk7QUFDbkMsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix1REFBdUQ7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJEQUFtQjtBQUMvQjtBQUNBLFFBQVEsMkRBQW1CLHNFQUFzRSwrQ0FBdUI7QUFDeEg7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGtJQUFrSTtBQUNsSixnQkFBZ0IsVUFBVSxzQkFBc0IsRUFBRSxrREFBVztBQUM3RDtBQUNBLGdCQUFnQixxREFBQyx3Q0FBd0MscURBQUMsQ0FBQyxpREFBUSxRQUFRLHFEQUFDLGtDQUFrQyxzQkFBc0IsR0FBRyxxREFBQyxnQ0FBZ0MsMENBQTBDLDhCQUE4QixxREFBQywwQkFBMEIsc1JBQXNSLDhDQUE4QyxxREFBQyxDQUFDLGlEQUFRLFFBQVEscURBQUMsa0NBQWtDLHlEQUF5RCxHQUFHLHFEQUFDLDBCQUEwQjtBQUMzdEI7QUFDQSxpSEFBaUgsR0FBRyxxREFBQyxVQUFVLHFDQUFxQyxFQUFFLHFEQUFDLHdDQUF3QyxvQkFBb0IsdUNBQXVDLHFEQUFDLGtDQUFrQztBQUM3UztBQUNBLHlCQUF5QixTQUFTLEVBQUUscUJBQXFCO0FBQ3pELGFBQWEsa0JBQWtCLG9EQUFZLFlBQVksTUFBTSxxREFBQyw2QkFBNkIsbURBQW1ELEdBQUcscURBQUMsNEJBQTRCLGdGQUFnRjtBQUM5UDtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQztBQUNBOztBQUVtRjs7QUFFbkYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtbG9jYXRvci1zZWxlY3QuZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEYgYXMgRnJhZ21lbnQsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSB9IGZyb20gJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCB7IGkgYXMgY2FuQ3JlYXRlTG9jYXRvclZpZXcsIHEgYXMgZ2V0V29ybGRHZW9jb2RlclVybCB9IGZyb20gJy4vcHJpdmlsZWdlcy03NDYzOWRhZS5qcyc7XG5pbXBvcnQgeyBuIGFzIGdldFVybFNlcnZpY2VJbmZvIH0gZnJvbSAnLi9mZWF0dXJlLWxheWVyLTU3M2JiNDczLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0IHsgcyBhcyBzcGVjaWFsQ2hhcmFjdGVyc1JlZ0V4cCB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0VXJsVHlwZSwgZiBhcyBmb3JtYXRVcmwgfSBmcm9tICcuL3VybC0zNTg3NWExMC5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItNzlmYjMwMmMuanMnO1xuaW1wb3J0ICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0ICcuL3RodW1ibmFpbC1iY2I4OWU2OS5qcyc7XG5pbXBvcnQgJy4vc2VydmljZS04YzJjNDI0MS5qcyc7XG5pbXBvcnQgJy4vdXNlci0zZWE2OWMzYS5qcyc7XG5pbXBvcnQgJy4vcXVlcnktZDYyNjYwZDQuanMnO1xuaW1wb3J0ICcuL2FwaS0yZTNhMTM2Zi5qcyc7XG5pbXBvcnQgJy4vc3RyaW5nLTU4YTVmZWYzLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2l0ZW0tYzU4ZmZjZWQuanMnO1xuaW1wb3J0ICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTgxMzczZjZkLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTE3YjY0OTQ2LmpzJztcbmltcG9ydCAnLi9hZ3MtZWI0NThhMDMuanMnO1xuaW1wb3J0ICcuL2ZpbGUtYmY4YWI5MGYuanMnO1xuaW1wb3J0ICcuL3N0b3JlLTZhODhlNmM1LmpzJztcbmltcG9ydCAnLi9zdG9yYWdlLTAzNTNhNzY5LmpzJztcblxuY29uc3QgbG9jYXRvclR5cGVzID0gW1wibG9jYXRvci12aWV3XCIsIFwibG9jYXRvclwiXTtcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzTG9jYXRvclNlbGVjdENzcyA9IFwiLnRpbGUtc2VsZWN0Om5vdCg6bGFzdC1jaGlsZCl7bWFyZ2luLWJvdHRvbToxLjVyZW19LmN1c3RvbS1wYXJhbWV0ZXItY29udGFpbmVye21hcmdpbi10b3A6MS41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNMb2NhdG9yU2VsZWN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFuZGxlQXV0aFN3aXRjaENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdG9yZUF1dGggPSBldmVudC5kZXRhaWw7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlTmV3VXJsID0gYXN5bmMgKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgdHlwZSwgdXJsIH0gPSBhcmdzO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMubG9jYXRvclVybCA9IHVybDtcbiAgICAgICAgICAgIHRoaXMuaXNTZWN1cmVkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCEhdXJsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxvd1N0b3JlZEF1dGggPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlQXV0aCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIEZldGNoIGRhdGEgdG8gY2hlY2sgaWYgd2UgbmVlZCBhdXRoIG9yIG5vdFxuICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRTZXJ2aWNlSW5mbyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdG9yVHlwZSA9IFwibG9jYXRvci12aWV3XCI7XG4gICAgICAgIHRoaXMubG9jYXRvclVybCA9IFwiXCI7XG4gICAgICAgIHRoaXMudHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgICB0aGlzLmNhblB1Ymxpc2hMb2NhdG9yVmlldyA9IHRydWU7XG4gICAgICAgIHRoaXMuYWxsb3dTdG9yZWRBdXRoID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcmVBdXRoID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNTZWN1cmVkID0gbnVsbDtcbiAgICAgICAgdGhpcy5zZXJ2aWNlSW5mbyA9IG51bGw7XG4gICAgICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGdsb2JhbEkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bjtcbiAgICAgICAgdGhpcy5pMThuID0gZ2xvYmFsSTE4bi5sb2NhdG9yU2VsZWN0O1xuICAgICAgICB0aGlzLnVybFR5cGVJMThuID0gZ2xvYmFsSTE4bi51cmxUeXBlO1xuICAgICAgICB0aGlzLnVybEkxOG4gPSBnbG9iYWxJMThuLnVybDtcbiAgICAgICAgdGhpcy5hbGxvd1N0b3JlZEF1dGggPSBhZGRJdGVtU3RhdGUuYWxsb3dTdG9yZWRBdXRoO1xuICAgICAgICB0aGlzLnN0b3JlQXV0aCA9IGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGg7XG4gICAgICAgIHRoaXMuaXNTZWN1cmVkID0gYWRkSXRlbVN0YXRlLmlzU2VjdXJlZDtcbiAgICAgICAgdGhpcy5pdGVtVHlwZSA9IGFkZEl0ZW1TdGF0ZS50eXBlO1xuICAgICAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIHRoaXMuY2FuUHVibGlzaExvY2F0b3JWaWV3ID0gY2FuQ3JlYXRlTG9jYXRvclZpZXcodXNlciwgcG9ydGFsKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0b3JUeXBlID0gKF9hID0gYWRkSXRlbVN0YXRlLmxvY2F0b3JUeXBlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcImxvY2F0b3Itdmlld1wiO1xuICAgICAgICBpZiAoIXRoaXMuY2FuUHVibGlzaExvY2F0b3JWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRvclR5cGUgPSBcImxvY2F0b3JcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZExvY2F0b3JUeXBlID09PSBcImxvY2F0b3JcIikge1xuICAgICAgICAgICAgdGhpcy5sb2NhdG9yVXJsID0gYWRkSXRlbVN0YXRlLnVybDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkTG9jYXRvclR5cGUsIHVybEkxOG4sIGxvY2F0b3JVcmwsIGFsbG93U3RvcmVkQXV0aCB9ID0gdGhpcztcbiAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0b3JUeXBlID0gc2VsZWN0ZWRMb2NhdG9yVHlwZTtcbiAgICAgICAgaWYgKHNlbGVjdGVkTG9jYXRvclR5cGUgPT09IFwibG9jYXRvci12aWV3XCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGdldFdvcmxkR2VvY29kZXJVcmwoKTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiY3JlYXRlXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IFwiR2VvY29kaW5nIFNlcnZpY2VcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSBbXCJHZW9jb2RpbmcgZmlsdGVyXCJdO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRodW1ibmFpbFVSTCA9IFwiaHR0cHM6Ly9zdGF0aWMuYXJjZ2lzLmNvbS9pbWFnZXMvZGVza3RvcGFwcC5wbmdcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jcmVhdGVBc1NlcnZpY2VQcm94eSA9IHRydWU7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudXJsID0gdXJsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFsb2NhdG9yVXJsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5mb2N1c01haW5JbnB1dCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB1cmxJMThuLmludmFsaWRVcmw7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBlcnJvciwgcmVzdWx0IH0gPSBnZXRVcmxUeXBlKGZvcm1hdFVybChsb2NhdG9yVXJsLCBwb3J0YWwuYWxsU1NMKSwgcG9ydGFsLmlzUG9ydGFsKTtcbiAgICAgICAgICAgIC8vIFRPRE86IGRvdWJsZSBjaGVjayBzZXJ2aWNlIGluZm8gT1IgZG9uJ3QgY2xlYXIgZXJyb3IgaWYgc2VydmljZSBpbmZvIGlzIGludmFsaWQ7XG4gICAgICAgICAgICAvLyBjdXJyZW50bHkgaW52YWxpZCBnZW9jb2RlcnMgd2lsbCBzdGlsbCBhbGxvdyBuZXh0XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gdXJsSTE4bltlcnJvci5jb2RlXTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSBcIkdlb2NvZGluZyBTZXJ2aWNlXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gdXJsSTE4bi5pbnZhbGlkVXJsO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS51cmwgPSBsb2NhdG9yVXJsO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBcIkdlb2NvZGluZyBTZXJ2aWNlXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcInVybFwiO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFsbG93U3RvcmVkQXV0aCA9IGFsbG93U3RvcmVkQXV0aDtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGggPSB0aGlzLnN0b3JlQXV0aDtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5pc1NlY3VyZWQgPSB0aGlzLmlzU2VjdXJlZDtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlSW5mbyA9IHRoaXMuc2VydmljZUluZm87XG4gICAgICAgICAgICBpZiAodGhpcy5zdG9yZUF1dGgpIHtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuY2hlY2tBdXRoID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFsbG93U3RvcmVkQXV0aCAmJiAhdGhpcy5zdG9yZUF1dGgpIHtcbiAgICAgICAgICAgICAgICAvLyBGZXRjaCBhZ2FpbiB0byB0cmlnZ2VyIHRoZSBzaWduIGluIG1vZGFsXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5nZXRTZXJ2aWNlSW5mbyh0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hbGxvd1N0b3JlZEF1dGggJiYgdGhpcy5zdG9yZUF1dGgpIHtcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImF1dGhcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBnZXRTZXJ2aWNlSW5mbyhjaGVja0F1dGggPSBmYWxzZSkge1xuICAgICAgICAvLyBUT0RPOiB0aGluayBvZiBhIHdheSB0byBnZW5lcmFsaXplIHRoaXMgd2l0aCBgcGFnZXMtdXJsLXR5cGVgXG4gICAgICAgIGNvbnN0IHsgdXJsVHlwZUkxOG4sIGxvY2F0b3JVcmwsIHR5cGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IsIHJlc3VsdCB9ID0gYXdhaXQgZ2V0VXJsU2VydmljZUluZm8oe1xuICAgICAgICAgICAgdXJsOiBsb2NhdG9yVXJsLFxuICAgICAgICAgICAgY3VzdG9tUGFyYW1ldGVyczogYWRkSXRlbVN0YXRlLmN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgY2hlY2tBdXRoLFxuICAgICAgICAgICAgLy8gVE9ETzogcmVmYWN0b3IgdGhpcyBvbmNlIHdlIHJlZmFjdG9yIHRoZSBzd2l0Y2ggaGFuZGxlXG4gICAgICAgICAgICBzdG9yZUF1dGg6IGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGhcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvciB8fCAhcmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAoKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSA9PT0gXCJkb2VzIG5vdCBwb2ludCB0byBhIEdJUyBzZXJ2ZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB1cmxUeXBlSTE4bi5zZXJ2aWNlTm90R0lTO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSA9PT0gXCJzZXJ2aWNlTm90RXhpc3RcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB1cmxUeXBlSTE4bi5zZXJ2aWNlTm90RXhpc3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmNvZGUpID09PSBcInVuc3VwcG9ydGVkV0ZTVmVyc2lvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IHVybFR5cGVJMThuLnVuc3VwcG9ydGVkV0ZTVmVyc2lvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB1cmxUeXBlSTE4bltlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZV0gfHwgdXJsVHlwZUkxOG4uc2VydmljZU5vdEV4aXN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdGFncywgdGl0bGUsIGlzU2VjdXJlZCwgYWxsb3dTdG9yZWRBdXRoLCBzZXJ2aWNlSW5mbyB9ID0gcmVzdWx0O1xuICAgICAgICB0aGlzLmFsbG93U3RvcmVkQXV0aCA9IGFsbG93U3RvcmVkQXV0aDtcbiAgICAgICAgdGhpcy5pc1NlY3VyZWQgPSBpc1NlY3VyZWQ7XG4gICAgICAgIHRoaXMuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgICAgaWYgKHRhZ3MpIHtcbiAgICAgICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyA9IHRhZ3M7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9ICh0aXRsZSA9PT0gbnVsbCB8fCB0aXRsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGl0bGUucmVwbGFjZShzcGVjaWFsQ2hhcmFjdGVyc1JlZ0V4cCwgXCJcIikpIHx8IFwiXCI7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IsIGkxOG4sIHVybFR5cGVJMThuLCBsb2FkaW5nLCBzZWxlY3RlZExvY2F0b3JUeXBlLCBsb2NhdG9yVXJsLCBjYW5QdWJsaXNoTG9jYXRvclZpZXcsIGlzU2VjdXJlZCwgYWxsb3dTdG9yZWRBdXRoLCBpdGVtVHlwZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjb25maWc6IHsgaGVscEJhc2UsIGhlbHBNYXAgfSB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIC8vIFRPRE86IGFkZCBhdXRoIHN0dWZmXG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBjYW5QdWJsaXNoTG9jYXRvclZpZXcgJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBoZWFkZXI6IGkxOG4uaGVhZGluZyB9KSwgaChcImNhbGNpdGUtdGlsZS1zZWxlY3QtZ3JvdXBcIiwgeyBsYXlvdXQ6IFwidmVydGljYWxcIiwgY2xhc3M6IFwidGlsZS1zZWxlY3RcIiB9LCBsb2NhdG9yVHlwZXMubWFwKCh0eXBlKSA9PiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBjaGVja2VkOiBzZWxlY3RlZExvY2F0b3JUeXBlID09PSB0eXBlLCBoZWFkaW5nOiBpMThuLm9wdGlvbnNbdHlwZV0udGl0bGUsIGRlc2NyaXB0aW9uOiBpMThuLm9wdGlvbnNbdHlwZV0uZGVzY3JpcHRpb24sIG5hbWU6IFwidGlsZS1sYXllci10eXBlXCIsIFwiaW5wdXQtZW5hYmxlZFwiOiB0cnVlLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IHR5cGUsIG9uQ2FsY2l0ZVRpbGVTZWxlY3RDaGFuZ2U6ICgpID0+ICh0aGlzLnNlbGVjdGVkTG9jYXRvclR5cGUgPSB0eXBlKSB9KSkpKSkpLCBzZWxlY3RlZExvY2F0b3JUeXBlID09PSBcImxvY2F0b3JcIiAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi51cmwuaGVhZGluZywgY29udGVudDogaTE4bi51cmwuZGVzY3JpcHRpb24gfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tdXJsXCIsIHsgdXJsOiBsb2NhdG9yVXJsLCBpbnB1dFRpdGxlOiBcIiBcIiwgcGxhY2Vob2xkZXI6IFwiaHR0cHM6Ly9teXNlcnZlci5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXMvZm9sZGVyL3NlcnZpY2UvR2VvY29kZVNlcnZlclwiLFxuICAgICAgICAgICAgLy8gVE9ETzogZGVib3VuY2UgdGhpc1xuICAgICAgICAgICAgb25OZXdJdGVtVXJsQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlTmV3VXJsKGV2ZW50LmRldGFpbCksIHJlZjogKGVsZSkgPT4gKHRoaXMuaW5wdXRSZWYgPSBlbGUpIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY3VzdG9tLXBhcmFtZXRlci1jb250YWluZXJcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWN1c3RvbS1wYXJhbWV0ZXJzXCIsIHsgaXRlbVR5cGU6IGl0ZW1UeXBlIH0pKSwgYWxsb3dTdG9yZWRBdXRoICYmICEhaXNTZWN1cmVkICYmIChoKFwiYXJjZ2lzLW5ldy1pdGVtLXN3aXRjaC1jYXJkXCIsIHsgb25Td2l0Y2hDaGFuZ2U6IHRoaXMuaGFuZGxlQXV0aFN3aXRjaENoYW5nZSwgaGVhZGVyOiB1cmxUeXBlSTE4bi5zdG9yZUF1dGgsIGhlYWRlckxpbms6IHtcbiAgICAgICAgICAgICAgICB0ZXh0OiB1cmxUeXBlSTE4bi5sZWFybk1vcmUsXG4gICAgICAgICAgICAgICAgaHJlZjogYCR7aGVscEJhc2V9JHtoZWxwTWFwW1wiMTIwMDAwNTk3XCJdfWBcbiAgICAgICAgICAgIH0sIGRlZmF1bHRDaGVja2VkOiBhZGRJdGVtU3RhdGUuc3RvcmVBdXRoIH0pKSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IGFjdGl2ZTogbG9hZGluZywgdGV4dDogdXJsVHlwZUkxOG4uZ2V0U2VydmljZUluZm8gfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBhY3RpdmU6ICEhZXJyb3IsIGRlc2NyaXB0aW9uOiBlcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0xvY2F0b3JTZWxlY3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNMb2NhdG9yU2VsZWN0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtUGFnZXNMb2NhdG9yU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19sb2NhdG9yX3NlbGVjdCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtbG9jYXRvci1zZWxlY3QuZW50cnkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9