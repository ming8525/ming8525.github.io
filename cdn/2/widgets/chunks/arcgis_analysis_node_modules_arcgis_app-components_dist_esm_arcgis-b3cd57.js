"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b3cd57"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-age_8.entry.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-age_8.entry.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_age: () => (/* binding */ ArcgisSmartMappingAge),
/* harmony export */   arcgis_smart_mapping_classify: () => (/* binding */ ArcgisSmartMappingClassify),
/* harmony export */   arcgis_smart_mapping_divided_by: () => (/* binding */ ArcgisSmartMappingDividedBy),
/* harmony export */   arcgis_smart_mapping_info_popover: () => (/* binding */ ArcgisSmartMappingInfoPopover),
/* harmony export */   arcgis_smart_mapping_panels_size: () => (/* binding */ ArcgisSmartMappingPanelsSize),
/* harmony export */   arcgis_smart_mapping_size_range_slider: () => (/* binding */ ArcgisSmartMappingSizeRangeSlider),
/* harmony export */   arcgis_smart_mapping_size_slider: () => (/* binding */ ArcgisSmartMappingSizeSlider),
/* harmony export */   arcgis_smart_mapping_tile: () => (/* binding */ ArcgisSmartMappingTile)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./date-79c7d93c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./color-d6da0a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-d6da0a9a.js");
/* harmony import */ var _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./colorSize-ce0ccdeb.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSize-ce0ccdeb.js");
/* harmony import */ var _typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./typeSize-9d4c5d28.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/typeSize-9d4c5d28.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./precision-06a73672.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/precision-06a73672.js");
/* harmony import */ var _symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./symbolStyler-04635b2b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolStyler-04635b2b.js");
/* harmony import */ var _relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./relationship-b72d7d97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/relationship-b72d7d97.js");
/* harmony import */ var _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./colorSizeUnivariant-d266ac7c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSizeUnivariant-d266ac7c.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./predominance-a1a2d74d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js");
/* harmony import */ var _chart_097ec280_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./chart-097ec280.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/chart-097ec280.js");
/* harmony import */ var _popover_721f7ba2_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./popover-721f7ba2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js");
/* harmony import */ var _raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./raster-renderer-a62f152c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-renderer-a62f152c.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./type-0ace5d2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-0ace5d2e.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


























const arcgisSmartMappingAgeCss = ".field-select-fixed{background-color:#f6f6f6;padding:6px 6px;justify-content:space-between;align-items:center;color:#333333;margin:0;transition:box-shadow 250ms ease-in-out;box-shadow:0 0 0 1px #e0e0e0;height:auto;line-height:1.25;overflow-wrap:anywhere}.variable-date-date{width:100%}.variable-date-time{width:100%;margin-top:5px}.variable-field-radio{display:flex;justify-content:space-between}.to-flip-wrapper{display:flex;justify-content:space-between}.to-label{display:flex;align-items:center;margin-top:10px}.units-label{margin-top:6px}.to-field{margin-top:-10px}.from-field{margin-top:-8px;margin-bottom:6px}.units-select{margin-bottom:10px}";

const ArcgisSmartMappingAge = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingAgeChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingAgeChange", 7);
        this.arcgisSmartMappingAgeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingAgeError", 7);
        this.rendererSubtype = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer, fields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const selectedDateField = fields.filter((field) => field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE &&
            field.layerField.name === authVisVar.field);
        this.restDateFields = fields.filter((field) => field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE && field !== selectedDateField[0]);
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    //--------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderFrom(), this.renderTo(), this.renderUnits()));
    }
    renderFrom() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { field, startTime } = authVisVar;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.age.from), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "from-field" }, field === startTime ? this.rendererStaticField() : this.rendererAgeField())));
    }
    renderTo() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { field, endTime } = authVisVar;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "to-flip-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "to-label" }, strings.age.to), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { hasOutline: false, text: strings.age.flip, icon: "arrowUpDown", onClick: () => this.handleFlip() }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "to-field" }, field === endTime ? this.rendererStaticField() : this.rendererAgeField())));
    }
    rendererStaticField() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(authVisVar.field);
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-select-fixed" }, fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.label);
    }
    rendererAgeField() {
        var _a, _b;
        const { strings, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { field, startTime, endTime } = authVisVar;
        const value = startTime === field ? endTime : startTime;
        const isField = typeof value === "string";
        const alias = ((_a = this.restDateFields[0]) === null || _a === void 0 ? void 0 : _a.layerField.alias) || ((_b = this.restDateFields[0]) === null || _b === void 0 ? void 0 : _b.layerField.name);
        let fieldInfo;
        if (isField) {
            fieldInfo = {
                field: value,
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE
            };
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.restDateFields.length ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { class: "variable-field-radio", name: "variableType", onCalciteRadioButtonGroupChange: (event) => {
                this.handleTypeChange(event.target.selectedItem.value);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { key: isField ? `age-variable-radio-field-${Math.random()}` : undefined, checked: isField, value: "field" }), strings.age.field), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { key: !isField ? `age-variable-radio-date-${Math.random()}` : undefined, checked: !isField, value: "date" }), strings.age.customDate))) : null, isField ? (this.restDateFields.length > 1 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { fieldList: this.restDateFields, selectedField: fieldInfo, mode: "simple", hideLabel: true, popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingAttributeInputChange: (event) => {
                if (event.detail) {
                    const newFieldName = event.detail.field;
                    this.createRendererUpdateCall(field === startTime ? { endTime: newFieldName } : { startTime: newFieldName });
                }
            }, ref: (node) => {
                if (node) {
                    this.rendererAgeFieldNode = node;
                }
            } })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-select-fixed" }, alias))) : (this.rendererAgeFieldDate())));
    }
    renderUnits() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { units } = authVisVar;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "units-label" }, strings.age.units, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { class: "units-select", width: "full", label: strings.age.units, onCalciteSelectChange: (event) => this.handleUnitChange(event), value: units, ref: (node) => (this.unitsNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "seconds", label: strings.age.seconds, selected: units === "seconds" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "minutes", label: strings.age.minutes, selected: units === "minutes" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "hours", label: strings.age.hours, selected: units === "hours" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "days", label: strings.age.days, selected: units === "days" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "months", label: strings.age.months, selected: units === "months" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "years", label: strings.age.years, selected: units === "years" }))));
    }
    rendererAgeFieldDate() {
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { units, field, startTime, endTime } = authVisVar;
        const value = startTime === field ? endTime : startTime;
        const isField = typeof value === "string";
        const dateString = !isField ? (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.u)(value, mapView.timeZone) : undefined;
        const showTime = ["seconds", "minutes", "hours"].indexOf(units) > -1;
        const timeString = !isField && showTime
            ? (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.b)(value, mapView.timeZone, units === "seconds")
            : undefined;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-date-picker", { scale: "s",
            // TODO: use "valueAsDate" instead of "value" once we determine why "onCalciteInputDatePickerChange"
            //       fires too early, causing a panel re-render that does not actually change anything
            // valueAsDate={date}
            value: dateString, class: "variable-date-date", ref: (node) => {
                if (node) {
                    this.datePickerNode = node;
                }
            }, onCalciteInputDatePickerChange: () => this.handleDateChange() }), showTime ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-time-picker", { key: `${units}-${value}`, step: units === "seconds" ? 1 : 60, scale: "s", value: timeString, class: "variable-date-time", ref: (node) => {
                if (node) {
                    this.timePickerNode = node;
                }
            }, onCalciteInputTimePickerChange: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__.d)(() => this.handleTimeChange(), 750) })) : null));
    }
    createRendererUpdateCall(options) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        let updateCall;
        if (rendererType === "color-age") {
            updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.d;
        }
        else if (rendererType === "size-age") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
        }
        else if (rendererType === "color-age-size") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.h;
        }
        else if (rendererType === "color-size-age") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.i;
        }
        else {
            updateCall = _typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_8__.b;
        }
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall(options, this.rendererSubtype), this.flowItemNode).then((result) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingAgeChange.emit();
        }, (error) => {
            // handles resetting Calcite components to their pre-error values
            this.rendererAgeFieldNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rendererAgeFieldNode);
            const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
            const authVisVar = this.rendererSubtype === "color"
                ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
                : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
            const { units, field, startTime, endTime } = authVisVar;
            const value = startTime === field ? endTime : startTime;
            const isField = typeof value === "string";
            const showTime = ["seconds", "minutes", "hours"].indexOf(units) > -1;
            const dateString = !isField
                ? (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.u)(value, mapView.timeZone)
                : undefined;
            const timeString = !isField && showTime
                ? (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.b)(value, mapView.timeZone, units === "seconds")
                : undefined;
            if (this.datePickerNode) {
                this.datePickerNode.value = dateString;
            }
            if (this.timePickerNode) {
                this.timePickerNode.value = timeString;
            }
            this.unitsNode.value = units;
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingAgeError.emit(error);
        });
    }
    //--------------------------------------------------------------------------
    //
    // Private Methods
    //
    //--------------------------------------------------------------------------
    handleUnitChange(event) {
        const updatedUnits = event.target.selectedOption.value;
        const options = { units: updatedUnits };
        this.createRendererUpdateCall(options);
    }
    handleTypeChange(type) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { field, startTime } = authVisVar;
        const newType = type === "field" ? this.restDateFields[0].layerField.name : new Date().getTime();
        this.createRendererUpdateCall(field === startTime ? { endTime: newType } : { startTime: newType });
    }
    handleDateChange() {
        var _a;
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const dateString = this.datePickerNode.value;
        if (!dateString) {
            return;
        }
        const timeString = ((_a = this.timePickerNode) === null || _a === void 0 ? void 0 : _a.value) || "00:00:00";
        const utcTimestamp = (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.d)(`${dateString}T${timeString}`, mapView.timeZone);
        const { field, startTime } = authVisVar;
        const options = {};
        if (field === startTime) {
            options.endTime = utcTimestamp;
        }
        else {
            options.startTime = utcTimestamp;
        }
        this.createRendererUpdateCall(options);
    }
    handleTimeChange() {
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { field, startTime } = authVisVar;
        let timeString = this.timePickerNode.value;
        // startTime and endTime are in UTC
        // timeString is in map time
        // date-picker is in map time
        const dateString = this.datePickerNode.value;
        const utcTimestamp = (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.d)(`${dateString}T${timeString}`, mapView.timeZone);
        const options = {};
        if (field === startTime) {
            options.endTime = utcTimestamp;
        }
        else {
            options.startTime = utcTimestamp;
        }
        this.createRendererUpdateCall(options);
    }
    handleFlip() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authVisVar = this.rendererSubtype === "color"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const { startTime, endTime } = authVisVar;
        const options = {
            startTime: endTime,
            endTime: startTime
        };
        this.createRendererUpdateCall(options);
        // Workaround for neither button being checked after flip
        this.createRendererUpdateCall(options);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingAge.style = arcgisSmartMappingAgeCss;

const arcgisSmartMappingClassifyCss = ".classify-block-section{border-top:1px solid #e0e0e0;overflow-wrap:anywhere}.block-section-padding{padding-top:6px}.symbol-is-white{background-color:#f0f0f0}.hidden{display:none}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.label,.symbol-container{padding-top:5px;padding-bottom:5px}.selected{outline:1px solid var(--calcite-color-brand)}.method-button-content{padding-top:8px}";

const ArcgisSmartMappingClassify = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingClassifyChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingClassifyChange", 7);
        this.arcgisSmartMappingClassifyError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingClassifyError", 7);
        this.inputNodes = [];
        this.labelNodes = [];
        this.symbolNodes = [];
        this.popoversOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { strings, layer, mapImageSublayer, supportsArcade } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const hasVisVar = colorVisVar || sizeVisVar;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { class: "classify-block-section", text: strings.classify.classifyData, open: !hasVisVar, toggleDisplay: mapImageSublayer && !supportsArcade ? "button" : "switch", ref: (node) => {
                this.classifyBlockSectionNode = node;
                if (!mapImageSublayer || supportsArcade) {
                    node.addEventListener("calciteBlockSectionToggle", (event) => {
                        event.stopImmediatePropagation();
                        this.handleClassifyToggle(event);
                    });
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-section-padding" }, !hasVisVar && this.renderMethod(), !hasVisVar && this.renderClasses(), !hasVisVar && this.renderStdDev(), !hasVisVar && this.renderRoundClasses(), !hasVisVar && this.renderValues())));
    }
    renderMethod() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-method-button", { key: renderer.authoringInfo.classificationMethod, showStdDev: true, onArcgisSmartMappingMethodButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingMethodButtonChange: (event) => {
                const node = event.target;
                this.precisionValue = null;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                if (event.detail === "manual") {
                    const authInfo = renderer.authoringInfo;
                    if (authInfo.classificationMethod === "standard-deviation") {
                        renderer.classBreakInfos.forEach((classBreakInfo, idx) => {
                            const prefix = idx > 0 ? "> " : "";
                            classBreakInfo.label = `${prefix} ${classBreakInfo.minValue.toLocaleString()} - ${classBreakInfo.maxValue.toLocaleString()}`;
                        });
                    }
                    authInfo.classificationMethod = "manual";
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    setTimeout(() => this.methodButtonNode.setFocus(), 300);
                }
                else {
                    const updateCall = rendererType === "color"
                        ? _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.e
                        : _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.k;
                    (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ classificationMethod: event.detail }), this.flowItemNode).then((result) => {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                        this.arcgisSmartMappingClassifyChange.emit();
                        setTimeout(() => this.methodButtonNode.setFocus(), 300);
                    }, (error) => {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
                        this.arcgisSmartMappingClassifyError.emit(error);
                    });
                }
            }, ref: (node) => {
                if (node) {
                    this.methodButtonNode = node;
                }
            } }));
    }
    renderClasses() {
        const { strings, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const numClasses = renderer.classBreakInfos.length;
        const authInfo = renderer.authoringInfo;
        if (authInfo.classificationMethod === "standard-deviation") {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.classify.classifyClasses, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { tabindex: "0", value: `${numClasses}`, min: 1, max: 10, step: 1, scale: "s", onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__.d)(() => {
                const value = parseInt(this.classesNode.value);
                if (value === numClasses) {
                    return;
                }
                if (!value || value < this.classesNode.min || value > this.classesNode.max) {
                    this.classesChangeHandle = setTimeout(() => this.handleClassesChange(), 3000);
                }
                else {
                    clearTimeout(this.classesChangeHandle);
                    this.handleClassesChange();
                }
            }, 300), ref: (node) => {
                if (node) {
                    this.classesNode = node;
                }
            } })));
    }
    renderStdDev() {
        const { strings, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const authInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer).authoringInfo;
        const stddev = authInfo.standardDeviationInterval || 1;
        if (authInfo.classificationMethod !== "standard-deviation") {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.classify.classifyStdDevIntervals, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", tabindex: "0", role: "button", label: strings.classify.classifyStdDevIntervals, onCalciteSelectChange: (event) => this.handleStdDevChange(event), value: `${stddev}`, ref: (node) => (this.stdDevSelectNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "0.5", label: "0.5", selected: stddev === 0.5 }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "1", label: "1", selected: stddev === 1 }))));
    }
    renderRoundClasses() {
        var _a;
        const { strings, layer, locale } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        if (authInfo.classificationMethod === "standard-deviation") {
            return null;
        }
        const lastPrecision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.a)();
        const firstOption = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "select", label: strings.classify.selectAnOption });
        if (!this.precisionValue) {
            this.precisionValue = (_a = lastPrecision.toString().split(".")[1]) === null || _a === void 0 ? void 0 : _a.length;
        }
        const precisionValues = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.b)(this.precisionValue);
        const options = precisionValues.map((value) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: `${value}`, label: `${value.toLocaleString(locale, {
                    maximumSignificantDigits: 15
                })}`, disabled: lastPrecision >= value, selected: lastPrecision === value }));
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.classify.classifyRoundClasses, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", label: strings.classify.classifyRoundClasses, onCalciteSelectChange: (event) => this.handleRoundClassesChange(event) }, [firstOption, ...options])));
    }
    renderValues() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.labelNodes = [];
        this.inputNodes = [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, renderer.classBreakInfos
            .map((classBreakInfo, idx) => {
            return this.renderValue(classBreakInfo, idx);
        })
            .reverse()));
    }
    renderValue(classBreakInfo, idx) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-container", slot: "actions-start" }, this.renderSymbolNode(classBreakInfo, idx)), this.renderTextNode(classBreakInfo, idx)));
    }
    renderSymbolNode(classBreakInfo, idx) {
        const { strings, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let symbol = renderer.classBreakInfos[idx].symbol.clone();
        const symbolNodeClasses = {
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol),
            symbol: true
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, tabindex: "0", "aria-label": strings.classify.accessibility.editSymbolFor.replace("${value}", classBreakInfo.label), "aria-haspopup": "true", ref: (node) => {
                if (node) {
                    this.symbolNodes.unshift(node);
                }
            }, onClick: () => {
                if (this.popoverNode) {
                    this.symbolNodes[this.selectedPopoverIdx].classList.remove("selected");
                    if (this.selectedPopoverIdx === idx) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                        this.popoverNode = null;
                        this.selectedPopoverIdx = null;
                    }
                    else {
                        this.selectedPopoverIdx = idx;
                        this.handleValueSymbolClick(idx);
                    }
                }
                else {
                    this.selectedPopoverIdx = idx;
                    this.handleValueSymbolClick(idx);
                }
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.handleValueSymbolClick(idx);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                if (node) {
                    this.afterCreateValueSymbol(node, idx);
                }
            } })));
    }
    renderTextNode(classBreakInfo, idx) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "label", slot: "content", tabindex: "0", ref: (node) => {
                if (node) {
                    this.labelNodes.unshift(node);
                }
            }, "aria-label": strings.classify.accessibility.editLabelFor.replace("${value}", classBreakInfo.label), onClick: (event) => this.handleLabelEdit(idx, event), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    this.handleLabelEdit(idx, event);
                }
            } }, classBreakInfo.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { slot: "content", class: "hidden", scale: "s", tabindex: "0", ref: (node) => {
                if (node) {
                    this.inputNodes.unshift(node);
                }
            }, value: classBreakInfo.label, onCalciteInputChange: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onFocusout: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onKeyDown: (event) => {
                event.stopPropagation();
                if (event.key === "Escape" || event.key === "Enter") {
                    this.inputNodes[idx].classList.add("hidden");
                    const input = event.currentTarget;
                    input.value = classBreakInfo.label || "";
                    input.disabled = true;
                    this.handleValueTextChange(idx, event);
                    this.labelNodes[idx].classList.remove("hidden");
                    input.disabled = false;
                    setTimeout(() => this.labelNodes[idx].focus(), 300);
                }
            } })));
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    afterCreateValueSymbol(node, idx) {
        var _a;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let symbol = renderer.classBreakInfos[idx].symbol.clone();
        while ((_a = node === null || node === void 0 ? void 0 : node.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            node.removeChild(node.childNodes[0]);
        }
        const { symbolUtils } = modules;
        if (symbol) {
            symbolUtils
                .renderPreviewHTML(symbol, {
                size: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ar)(symbol),
                symbolConfig: symbol.type === "cim" && symbol.data.symbol.type === "CIMPolygonSymbol"
                    ? { isSquareFill: true }
                    : undefined
            })
                .then((element) => node === null || node === void 0 ? void 0 : node.appendChild(element));
        }
    }
    handleClassifyToggle(event) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const updateCall = event.currentTarget.open
            ? rendererType === "color"
                ? _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.e
                : _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.k
            : rendererType === "color"
                ? _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.b
                : _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({}), this.flowItemNode).then((result) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingClassifyChange.emit({ closePopovers: true, toggle: true });
        }, (error) => {
            this.classifyBlockSectionNode.open = !this.classifyBlockSectionNode.open;
            this.arcgisSmartMappingClassifyError.emit(error);
        });
    }
    handleClassesChange() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const value = Math.min(Math.max(parseInt(this.classesNode.value), 1), 10) || 5;
        if (`${value}` !== this.classesNode.value) {
            this.classesNode.value = `${value}`;
        }
        const updateCall = rendererType === "color"
            ? _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.e
            : _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.k;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ numClasses: value }), this.flowItemNode).then((result) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            this.arcgisSmartMappingClassifyChange.emit({ classesChange: true });
        }, (error) => {
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
            this.classesNode.value = `${renderer.classBreakInfos.length}`;
            this.arcgisSmartMappingClassifyError.emit(error);
        });
    }
    handleStdDevChange(event) {
        const node = event.currentTarget;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const updateCall = rendererType === "color"
            ? _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.e
            : _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.k;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ standardDeviationInterval: parseFloat(node.value) }), this.flowItemNode).then((result) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingClassifyChange.emit();
        }, (error) => {
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
            const authInfo = renderer.authoringInfo;
            const stddev = authInfo.standardDeviationInterval || 1;
            this.stdDevSelectNode.value = `${stddev}`;
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingClassifyError.emit(error);
        });
    }
    handleRoundClassesChange(event) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const node = event.currentTarget;
        if (node.value === "select") {
            return;
        }
        (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.u)(parseFloat(node.value));
        authInfo.classificationMethod = "manual";
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        this.arcgisSmartMappingClassifyChange.emit({ closePopovers: true });
    }
    handleLabelEdit(idx, event) {
        let inputNode = this.inputNodes[idx];
        inputNode.classList.remove("hidden");
        inputNode.setFocus();
        event.target.classList.add("hidden");
    }
    handleValueSymbolClick(idx) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.c)({
            referenceElement: this.flowItemNode,
            heading: strings.styler.symbolStyle
        });
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.r)(popoverNode);
            setTimeout(() => {
                this.symbolNodes[idx].focus();
                this.popoverNode = null;
                this.symbolNodes[idx].classList.remove("selected");
            }, 300);
        });
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.r)(popoverNode);
            setTimeout(() => {
                this.popoverNode = null;
                this.symbolNodes[idx].classList.remove("selected");
            }, 300);
        });
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.classedSymbolSelectedIdx = idx;
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.g)({
            popoverNode: popoverNode,
            onChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.arcgisSmartMappingClassifyChange.emit({ symbolChange: true });
            }
        });
        this.popoverNode = popoverNode;
        this.symbolNodes[idx].classList.add("selected");
    }
    handleValueTextChange(idx, event) {
        const node = event.currentTarget;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        renderer.classBreakInfos[idx].label = node.value;
        this.labelNodes[idx].textContent = node.value;
        this.inputNodes[idx].value = node.value;
        /* workaround to allow "empty" labels (otherwise, the classify label
        will stay empty but the legend label will assume its default value) */
        if (node.value === "") {
            const classBreak = renderer.classBreakInfos[idx];
            const prefix = idx > 0 ? "> " : "";
            classBreak.label = `${prefix} ${classBreak.minValue.toLocaleString()} - ${classBreak.maxValue.toLocaleString()}`;
            this.labelNodes[idx].textContent = classBreak.label;
            this.inputNodes[idx].value = classBreak.label;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingClassify.style = arcgisSmartMappingClassifyCss;

const ArcgisSmartMappingDividedBy = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingDividedByChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingDividedByChange", 7);
        this.arcgisSmartMappingDividedByError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingDividedByError", 7);
        this.rendererSubtype = undefined;
        this.normalizationField = undefined;
        this.fieldPos = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, fields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const authInfo = renderer.authoringInfo;
        const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, this.rendererSubtype);
        const isRelationshipPanel = rendererType === "relationship" || this.rendererSubtype === "relationship";
        const currentField = isRelationshipPanel
            ? this.fieldPos === 0
                ? authInfo.field1.field
                : authInfo.field2.field
            : fieldInfo
                ? fieldInfo.field
                : renderer.field;
        const normalizationField = isRelationshipPanel
            ? this.fieldPos === 0
                ? authInfo.field1.normalizationField
                : authInfo.field2.normalizationField
            : fieldInfo
                ? fieldInfo.normalizationField
                : renderer.normalizationField;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { fieldList: fields.filter((field) => field.layerField.name !== currentField &&
                field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER), popoverReferenceElement: this.flowItemNode, label: strings.transparency.dividedBy, mode: "remove", selectedField: normalizationField
                ? {
                    field: normalizationField,
                    simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
                }
                : null, onArcgisSmartMappingAttributeInputChange: (event) => {
                if (event.detail) {
                    const fieldInfo = event.detail;
                    this.normalize(fieldInfo.field);
                }
                else {
                    this.normalize(null);
                }
            } }));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    normalize(normalizationField) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const authInfo = renderer.authoringInfo;
        const isUnivariate = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "univariate-color-size";
        const isClassBreaksColor = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "class-breaks-color";
        const isClassBreaksSize = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "class-breaks-size";
        const isRelationshipPanel = rendererType === "relationship" || this.rendererSubtype === "relationship";
        let updateCall;
        if (isClassBreaksColor) {
            updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.e;
        }
        else if (isClassBreaksSize) {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.k;
        }
        else if (isUnivariate) {
            updateCall = _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_13__.a;
        }
        else if (this.rendererSubtype === "color") {
            updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.b;
            if (["color-age", "color-age-size"].indexOf(rendererType) > -1) {
                updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.d;
            }
        }
        else if (this.rendererSubtype === "size") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
            if (["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1) {
                updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
            }
        }
        else if (isRelationshipPanel) {
            updateCall = _relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_12__.a;
        }
        const options = {};
        if (isRelationshipPanel) {
            this.fieldPos === 0
                ? (options.normalizationField1 = normalizationField)
                : (options.normalizationField2 = normalizationField);
        }
        else {
            options.normalizationField = normalizationField;
        }
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall(options, this.rendererSubtype), this.flowItemNode).then((result) => {
            if (isUnivariate || isClassBreaksColor || isClassBreaksSize || isRelationshipPanel) {
                if (rendererType === "relationship-size") {
                    // keep background style
                    result.renderer.backgroundFillSymbol = renderer.backgroundFillSymbol;
                    // keep size variable
                    const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
                    const sizeAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
                    result.renderer.visualVariables = result.renderer.visualVariables || [];
                    result.renderer.visualVariables.push(sizeVisVar);
                    result.renderer.authoringInfo = result.renderer.authoringInfo || {};
                    result.renderer.authoringInfo.visualVariables =
                        result.renderer.authoringInfo.visualVariables || [];
                    result.renderer.authoringInfo.visualVariables.push(sizeAuthVisVar);
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
            }
            else if (this.rendererSubtype === "color") {
                if (["color-size", "color-age-size", "color-size-age"].indexOf(rendererType) > -1) {
                    this.switchOutVisualVariable(result);
                }
                else {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                }
            }
            else if (this.rendererSubtype === "size") {
                if ([
                    "color-size",
                    "color-age-size",
                    "color-size-age",
                    "type-size",
                    "type-size-age",
                    "relationship-size"
                ].indexOf(rendererType) > -1) {
                    this.switchOutVisualVariable(result);
                }
                else {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                }
            }
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.arcgisSmartMappingDividedByChange.emit();
        }, (error) => this.arcgisSmartMappingDividedByError.emit(error));
    }
    switchOutVisualVariable(result) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, this.rendererSubtype) || [];
        const visVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, this.rendererSubtype);
        renderer.visualVariables.push(visVar);
        renderer.authoringInfo.visualVariables =
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.o)(renderer, this.rendererSubtype) || [];
        const authVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, this.rendererSubtype);
        authVisVar && renderer.authoringInfo.visualVariables.push(authVisVar);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.Q)(renderer);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisSmartMappingInfoPopoverCss = ".info{padding:10px;background-color:white}.info-popover{max-width:320px}.info-help{padding-top:10px;justify-content:flex-end;display:flex}.info-help-button{display:flex;flex-flow:row-reverse}";

const ArcgisSmartMappingInfoPopover = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingInfoPopoverClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingInfoPopoverClose", 7);
        this.arcgisSmartMappingInfoPopoverDisconnected = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingInfoPopoverDisconnected", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        this.documentTabHandler = undefined;
        this.documentClickHandler = undefined;
        this.panelScrollHandler = undefined;
        // --------------------------------------------------------------------------
        //
        //  Private methods
        //
        // --------------------------------------------------------------------------
        this.onOpen = () => { requestAnimationFrame(() => { var _a; return (_a = this.panelNode) === null || _a === void 0 ? void 0 : _a.setFocus(); }); };
        this.props = undefined;
        this.referenceElement = undefined;
        this.open = false;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    async setFocus() {
        var _a;
        (_a = this.panelNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    async setOpen(open) {
        var _a;
        if (this.popoverNode) {
            this.popoverNode.open = open;
            if (open) {
                (_a = this.panelNode) === null || _a === void 0 ? void 0 : _a.setFocus();
                this.popoverNode.reposition();
            }
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    disconnectedCallback() {
        // in case popover got removed by just removing node from DOM
        this.arcgisSmartMappingInfoPopoverDisconnected.emit();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { props, referenceElement, open } = this;
        const { title, moreInfo, helpId } = props;
        const { config, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { helpBase, helpMap } = config;
        const header = strings.tile.info.title.replace("${title}", title);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout arcgis-smart-mapping-popover" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { open: open, placement: "auto", offsetSkidding: 5, label: "", referenceElement: referenceElement, class: "info-popover", onCalcitePopoverOpen: this.onOpen, ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: header, closable: true, ref: (node) => (this.panelNode = node), onCalcitePanelClose: () => {
                this.arcgisSmartMappingInfoPopoverClose.emit();
                // focus on info icon; wait so enter key doesn't re-open it
                setTimeout(() => referenceElement.parentElement.focus(), 300);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, moreInfo), helpId && helpMap ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-help" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "solid", label: strings.tile.info.learnMore, class: "info-help-button", slot: "footer", onClick: () => {
                window.open(`${helpBase}${helpMap[helpId]}`, "_blank");
            } }, strings.tile.info.learnMore))) : null)))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingInfoPopover.style = arcgisSmartMappingInfoPopoverCss;

const arcgisSmartMappingPanelsSizeCss = ":host{width:100%}.flow-item{height:100%}.size-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";

const ArcgisSmartMappingPanelsSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSizeClose", 7);
        this.arcgisSmartMappingPanelsSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSizeBackClick", 7);
        this.arcgisSmartMappingPanelsSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSizeError", 7);
        this.rangeSliderWatchHandles = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsSizeClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRenderer, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.j)(originalRenderer, originalFeatureReduction);
            this.arcgisSmartMappingPanelsSizeClose.emit("cancel");
        };
        this.hideTransparency = false;
        this.hideRotation = false;
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.visualizationOpen = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.originalRenderer = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        /* window.onresize = () => {
            // for transparency inputs
            forceUpdate(this.hostElement);
          }; */
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_14__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsSizeBackClick.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        var _a, _b;
        const { visualizationOpen, hideTransparency, hideRotation } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        const isExpressionRenderer = ["chart-size", "predominance-size"].indexOf(rendererType) > -1;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const fieldName = sizeVisVar
            ? sizeVisVar.field
                ? (_a = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(sizeVisVar.field)) === null || _a === void 0 ? void 0 : _a.label
                : sizeVisVar.valueExpressionTitle || strings.expression
            : renderer.field
                ? (_b = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(renderer.field)) === null || _b === void 0 ? void 0 : _b.label
                : renderer.valueExpressionTitle || strings.expression;
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)((sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.field) || renderer.field);
        const isDate = (field === null || field === void 0 ? void 0 : field.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        const isChart = rendererType === "chart-size";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "size-block", key: "size-visualization", heading: isAgeRenderer
                ? strings.panels.size.sizeAgeStyle
                : isDate
                    ? strings.panels.size.sizeStyleDate
                    : isChart
                        ? strings.panels.size.sizeStyleChart
                        : strings.panels.size.sizeStyle, collapsible: !hideTransparency || !hideRotation, open: visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, !isAgeRenderer && !isExpressionRenderer ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "attribute-name" }, fieldName)) : null, this.renderAge(), this.renderTheme(), this.renderDividedBy(), this.renderSymbol(), this.renderSizeSlider(), this.renderSizeRange(), this.renderBackgroundStyle(), this.renderDefaultSymbol(), this.renderShowInLegend(), this.renderClassify())));
    }
    renderAge() {
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["size-age", "color-size-age"].indexOf(rendererType) > -1;
        if (!isAgeRenderer) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-age", { rendererSubtype: "size", onArcgisSmartMappingAgeChange: () => this.sliderNode.updateStatistics(), onArcgisSmartMappingAgeError: (event) => this.arcgisSmartMappingPanelsSizeError.emit(event.detail) }));
    }
    renderTheme() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (!sizeVisVar) {
            return null;
        }
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (["chart-size", "predominance-size"].indexOf(rendererType) > -1) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-theme-button", { ref: (node) => (this.themeButtonNode = node), rendererSubtype: "size", onArcgisSmartMappingThemeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingThemeButtonChange: (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                let updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
                if (["size-age", "color-size-age"].indexOf(rendererType) > -1) {
                    updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
                }
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({
                    theme: event.detail,
                    discardMinMax: true
                }), this.flowItemNode).then((result) => {
                    renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "size") || [];
                    renderer.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, "size"));
                    renderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.o)(renderer, "size") || [];
                    renderer.authoringInfo.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, "size"));
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    this.themeButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    if (this.sliderNode) {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                        this.sliderNode.updateStatistics();
                    }
                }, (error) => {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    this.arcgisSmartMappingPanelsSizeError.emit(error);
                });
            } }));
    }
    renderDividedBy() {
        const { layer, fields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["size-age", "color-size-age"].indexOf(rendererType) > -1;
        if (isAgeRenderer) {
            return null;
        }
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.I)(fields);
        if (counts.number < 2) {
            return null;
        }
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (sizeVisVar) {
            const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(sizeVisVar.field);
            const fieldInfo = {
                field: sizeVisVar.field,
                expression: sizeVisVar.valueExpression,
                expressionTitle: sizeVisVar.valueExpressionTitle,
                simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
            };
            if (fieldInfo.expression || fieldInfo.simpleFieldType !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER) {
                return null;
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-divided-by", { rendererSubtype: "size", normalizationField: sizeVisVar ? sizeVisVar.normalizationField : renderer.normalizationField, onArcgisSmartMappingDividedByChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode.updateStatistics();
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
            }, onArcgisSmartMappingDividedByError: (event) => this.arcgisSmartMappingPanelsSizeError.emit(event.detail) }));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (renderer.type === "pie-chart") {
            return null;
        }
        const symbol = this.getSymbol();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, type: "size", ref: (node) => {
                if (node) {
                    this.symbolButtonNode = node;
                }
            }, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderSizeSlider() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-size-slider", { ref: (node) => {
                if (node) {
                    this.sliderNode = node;
                }
            }, onArcgisSmartMappingSizeSliderChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
            }, onArcgisSmartMappingSizeSliderError: (event) => this.arcgisSmartMappingPanelsSizeError.emit(event.detail) }));
    }
    renderSizeRange() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-size-range-slider", { onArcgisSmartMappingSizeRangeSliderError: (event) => this.arcgisSmartMappingPanelsSizeError.emit(event.detail) }));
    }
    renderBackgroundStyle() {
        const { mapImageSublayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (mapImageSublayer &&
            ["predominance-size", "type-size", "relationship-size"].indexOf(rendererType) > -1) {
            return null;
        }
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", null);
    }
    renderDefaultSymbol() {
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (["chart", "chart-size"].indexOf(rendererType) > -1) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-default-symbol", { ref: (node) => {
                if (node) {
                    this.defaultSymbolNode = node;
                }
            }, onArcgisSmartMappingDefaultSymbolBeforeToggle: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingDefaultSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode) }));
    }
    renderShowInLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (!sizeVisVar) {
            return null;
        }
        const legendOptions = sizeVisVar.legendOptions;
        const isChecked = !legendOptions || legendOptions.showLegend !== false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "legend-toggle-padding" }, strings.panels.size.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    renderClassify() {
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const fieldInfo = this.getFieldInfo();
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        if (rendererType !== "size" || isDateField || isAgeRenderer) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-classify", { ref: (node) => (this.classifyNode = node), onArcgisSmartMappingClassifyChange: (event) => {
                const instructions = event.detail;
                ((instructions === null || instructions === void 0 ? void 0 : instructions.closePopovers) || (instructions === null || instructions === void 0 ? void 0 : instructions.classesChange)) && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                if ((instructions === null || instructions === void 0 ? void 0 : instructions.toggle) ||
                    (!(instructions === null || instructions === void 0 ? void 0 : instructions.symbolChange) && !(instructions === null || instructions === void 0 ? void 0 : instructions.closePopovers))) {
                    this.sliderNode.updateStatistics();
                }
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
                this.symbolButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
                this.defaultSymbolNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.defaultSymbolNode);
            }, onArcgisSmartMappingClassifyError: (event) => this.arcgisSmartMappingPanelsSizeError.emit(event.detail) }));
    }
    renderTransparency() {
        const { hideTransparency } = this;
        if (hideTransparency) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsSizeError.emit(detail) }));
    }
    renderRotation() {
        const { hideRotation } = this;
        if (hideRotation) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, ref: (node) => (this.rotationNode = node), onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsSizeError.emit(detail) }));
    }
    getSymbol() {
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer).type === "class-breaks"
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer)
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const infos = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer).type === "class-breaks"
            ? renderer.classBreakInfos
            : renderer.uniqueValueInfos;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        let symbol;
        if ([
            "color-size",
            "color-age-size",
            "color-size-age",
            "type-size",
            "type-size-age",
            "predominance-size",
            "relationship-size"
        ].indexOf(rendererType) > -1) {
            symbol = infos.length
                ? infos[0].symbol.clone()
                : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType);
            // make the symbol grey like in the legend
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(symbol, new modules.esriColor({ r: 149, g: 149, b: 149, a: 1 }));
        }
        else {
            symbol = infos.length
                ? infos[infos.length - 1].symbol.clone()
                : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType);
        }
        return symbol;
    }
    handleIncludeInLegendToggle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const legendOptions = sizeVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                sizeVisVar.legendOptions = undefined;
            }
        }
        else {
            sizeVisVar.legendOptions = legendOptions || {};
            sizeVisVar.legendOptions.showLegend = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    getFieldInfo() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const fieldInfos = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.f)(layer);
        const fieldInfo = ["color-size", "color-age-size", "color-size-age", "type-size", "type-size-age"].indexOf(rendererType) > -1 && fieldInfos.length > 1
            ? fieldInfos[1]
            : rendererType === "relationship-size"
                ? fieldInfos[2]
                : fieldInfos[0];
        return fieldInfo;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsSize.style = arcgisSmartMappingPanelsSizeCss;

const arcgisSmartMappingSizeRangeSliderCss = ".size-range-block{border-bottom:1px solid #e0e0e0}.range-slider{height:40px;background-color:transparent;position:relative;width:95%;margin:15px auto 0 auto}.size-range{display:flex;justify-content:space-between;margin-bottom:15px}.size-range-item{width:48%;display:flex;flex-flow:column;justify-content:space-between}.esri-slider__label{text-decoration:underline}.esri-slider__label:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}";

const ArcgisSmartMappingSizeRangeSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingSizeRangeSliderError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSizeRangeSliderError", 7);
        this.rangeSliderWatchHandles = [];
    }
    // -------------------------------------------------------------------
    //
    // Lifecycle
    //
    // -------------------------------------------------------------------
    componentDidLoad() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin", `<link rel="stylesheet" href="${config.jsapiUrl}/themes/light/main.css" />`);
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { layer, mapImageSublayer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const isAboveAndBelow = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.univariateTheme) === "above-and-below";
        const isNull = sizeVisVar ? !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(sizeVisVar.minSize) : false;
        const isNumber = sizeVisVar ? typeof sizeVisVar.minSize === "number" : false;
        const isAutomatic = !isNull && !isNumber;
        let [lowValue, highValue] = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.h)();
        [lowValue, highValue] = [Math.round(lowValue / 0.75), Math.round(highValue / 0.75)];
        if (lowValue > highValue) {
            [lowValue, highValue] = [highValue, lowValue];
        }
        if (!this.rangeSliderNode) {
            const config = {
                min: Math.max(1, Math.min(1, lowValue - 10)),
                max: Math.min(highValue + 10, 100),
                values: [lowValue, highValue],
                visibleElements: {
                    labels: true
                },
                precision: 0,
                labelInputsEnabled: true,
                labelFormatFunction: (value) => {
                    return value.toFixed(0);
                }
            };
            this.rangeSliderNode = new modules.Slider(config);
        }
        else {
            if (lowValue !== this.rangeSliderNode.values[0] ||
                highValue !== this.rangeSliderNode.values[1] ||
                !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.rangeSliderNode.values[1])) {
                const config = {
                    min: Math.max(1, Math.min(1, lowValue - 10)),
                    max: Math.min(highValue + 10, 100),
                    values: [lowValue, highValue]
                };
                this.rangeSliderNode.set(config);
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "size-range-block" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.sizeRangeSlider.sizeRange), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "range-slider range-slider-bottom-label", ref: (node) => {
                if (node) {
                    this.afterSizeRangeCreate(node);
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: "ltr", class: "size-range" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "size-range-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { value: `${lowValue}`, min: 1, max: 100, step: 1, scale: "s", suffixText: strings.sizeRangeSlider.px, ref: (node) => {
                if (node) {
                    this.minRangeNode = node;
                }
            }, onCalciteInputNumberInput: () => {
                var _a;
                const values = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
                const newMinimumSize = parseInt(this.minRangeNode.value);
                if (this.minRangeNode.value && newMinimumSize > 0 && newMinimumSize < values[1]) {
                    clearTimeout(this.minWatchHandle);
                    const value = Math.min(newMinimumSize, 100);
                    this.minRangeNode.value = `${value}`;
                    const ptValues = [value * 0.75, values[1] * 0.75];
                    this.rangeSliderNode.values = [parseInt(this.minRangeNode.value), values[1]];
                    this.handleSizeRangeValuesChange(ptValues);
                }
                else {
                    this.minWatchHandle = setTimeout(() => {
                        var _a;
                        const updatedValues = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
                        this.minRangeNode.value = `${updatedValues[0]}`;
                        const ptValues = [updatedValues[0] * 0.75, updatedValues[1] * 0.75];
                        this.handleSizeRangeValuesChange(ptValues);
                    }, 3000);
                }
            }, label: strings.sizeRangeSlider.min })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "size-range-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { value: `${highValue}`, min: 1, max: 100, step: 1, scale: "s", suffixText: strings.sizeRangeSlider.px, ref: (node) => {
                if (node) {
                    this.maxRangeNode = node;
                }
            }, onCalciteInputNumberInput: () => {
                var _a;
                const values = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
                const newMaximumSize = parseInt(this.maxRangeNode.value);
                if (this.maxRangeNode.value &&
                    newMaximumSize > values[0] &&
                    newMaximumSize < 101) {
                    clearTimeout(this.maxWatchHandle);
                    const value = Math.min(newMaximumSize, 100);
                    this.maxRangeNode.value = `${value}`;
                    const ptValues = [values[0] * 0.75, value * 0.75];
                    this.rangeSliderNode.values = [values[0], parseInt(this.maxRangeNode.value)];
                    this.handleSizeRangeValuesChange(ptValues);
                }
                else {
                    this.maxWatchHandle = setTimeout(() => {
                        var _a;
                        const updatedValues = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
                        this.maxRangeNode.value = `${updatedValues[1]}`;
                        const ptValues = [updatedValues[0] * 0.75, updatedValues[1] * 0.75];
                        this.handleSizeRangeValuesChange(ptValues);
                    }, 3000);
                }
            }, label: strings.sizeRangeSlider.min }))), sizeVisVar && !isAboveAndBelow && !mapImageSublayer && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s", layout: "inline", class: "size-range-bottom-border" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { scale: "s", checked: isAutomatic, onCalciteCheckboxChange: (event) => this.handleSizeRangeChange(event.target.checked ? "automatic" : "fixed"), ref: (node) => (this.adjustSizeNode = node) }), strings.sizeRangeSlider.adjustSizeAutomatically)))));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    handleSizeRangeValuesChange(ptValues) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const classBreakInfos = renderer.classBreakInfos;
        const currentMinSize = sizeVisVar
            ? sizeVisVar.minSize / 0.75
            : classBreakInfos[0].symbol.size / 0.75;
        const currentMaxSize = sizeVisVar
            ? sizeVisVar.maxSize / 0.75
            : classBreakInfos[classBreakInfos.length - 1].symbol.size / 0.75;
        const lowerBound = ptValues[0] / 0.75;
        const upperBound = ptValues[1] / 0.75;
        if (currentMinSize === lowerBound && currentMaxSize === upperBound) {
            return;
        }
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.s)(ptValues);
        this.maxRangeNode.min = lowerBound + this.maxRangeNode.step;
        this.minRangeNode.max = upperBound - this.minRangeNode.step;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    afterSizeRangeCreate(node) {
        if (!this.rangeSliderNode.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.rangeSliderNode.container = divNode;
            this.createRangeSliderChangeEvents();
        }
    }
    createRangeSliderChangeEvents() {
        const { mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!this.rangeSliderNode) {
            return;
        }
        this.rangeSliderNode.on("thumb-change", (sliderNodeInfo) => {
            var _a;
            const values = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
            if (sliderNodeInfo.index === 0) {
                if (values[0] >= values[1]) {
                    values[0] = sliderNodeInfo.oldValue;
                }
            }
            else if (sliderNodeInfo.index === 1) {
                if (values[1] <= values[0]) {
                    values[1] = sliderNodeInfo.oldValue;
                }
            }
            this.minRangeNode.value = `${values[0]}`;
            this.maxRangeNode.value = `${values[1]}`;
            const ptValues = [values[0] * 0.75, values[1] * 0.75];
            this.handleSizeRangeValuesChange(ptValues);
        });
        this.rangeSliderNode.on("thumb-drag", (sliderNodeInfo) => {
            var _a;
            const values = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
            if (sliderNodeInfo.index === 0) {
                if (values[0] >= values[1]) {
                    values[0] = values[0] - 1;
                    return;
                }
            }
            else if (sliderNodeInfo.index === 1) {
                if (values[1] <= values[0]) {
                    values[1] = values[1] + 1;
                    return;
                }
            }
            this.minRangeNode.value = `${values[0]}`;
            this.maxRangeNode.value = `${values[1]}`;
            const ptValues = [values[0] * 0.75, values[1] * 0.75];
            this.handleSizeRangeValuesChange(ptValues);
        });
        this.rangeSliderNode.on("segment-drag", () => {
            var _a;
            const values = (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.values;
            this.minRangeNode.value = `${values[0]}`;
            this.maxRangeNode.value = `${values[1]}`;
            const ptValues = [values[0] * 0.75, values[1] * 0.75];
            this.handleSizeRangeValuesChange(ptValues);
        });
        this.rangeSliderWatchHandles.push(mapView.watch("scale", () => {
            var _a;
            let [lowValue, highValue] = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.h)();
            [lowValue, highValue] = [Math.round(lowValue / 0.75), Math.round(highValue / 0.75)];
            (_a = this.rangeSliderNode) === null || _a === void 0 ? void 0 : _a.set({
                values: [lowValue, highValue],
                min: Math.max(1, Math.min(1, lowValue - 10)),
                max: Math.min(highValue + 10, 100)
            });
            this.minRangeNode.value = this.rangeSliderNode.values[0].toString();
            this.maxRangeNode.value = this.rangeSliderNode.values[1].toString();
        }));
    }
    handleSizeRangeChange(type) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (type === "fixed") {
            let stops = sizeVisVar.minSize.stops;
            if (!stops) {
                return;
            }
            [sizeVisVar.minSize, sizeVisVar.maxSize] = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_11__.h)();
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        }
        else {
            const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
            let updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
            if (rendererType === "predominance-size") {
                updateCall = _predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_15__.a;
            }
            else if (rendererType === "chart-size") {
                updateCall = _chart_097ec280_js__WEBPACK_IMPORTED_MODULE_16__.a;
            }
            else if (["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1) {
                updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
            }
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ sizeOptimizationEnabled: true }), this.flowItemNode).then((result) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, (error) => {
                // handles keeping the "adjust size automatically" button unchecked when renderer re-creation occurs
                this.adjustSizeNode.checked = false;
                this.arcgisSmartMappingSizeRangeSliderError.emit(error);
            });
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingSizeRangeSlider.style = arcgisSmartMappingSizeRangeSliderCss;

const arcgisSmartMappingSizeSliderCss = ".slider-box{height:320px}.slider-box .esri-size-slider,.slider-box .esri-classed-size-slider{min-width:200px}.slider-box .esri-size-slider .esri-slider .esri-slider__content,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-size-slider__histogram-container,.slider-box .esri-classed-size-slider__histogram-container{width:85px}.slider-box .esri-size-slider .esri-slider .esri-slider__label,.slider-box .esri-size-slider .esri-slider .esri-slider__min,.slider-box .esri-size-slider .esri-slider .esri-slider__max,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__label,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__min,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-size-slider .esri-slider .esri-slider__max:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-classed-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}";

const ArcgisSmartMappingSizeSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingSizeSliderChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSizeSliderChange", 7);
        this.arcgisSmartMappingSizeSliderError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSizeSliderError", 7);
        /**
         * Necessary for tracking stops for non-classed sliders,
         * whose values are updated immediately even given incorrect inputs.
         * Classed sliders do not have this issue, but we handle them
         * identically for logical parity.
         */
        this.currentStopValues = [];
        this.currentBreakValues = [];
        this.zigzagClick = false;
        this.styleSheetStatus = "not-loaded";
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.sliderZoomed = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Calls
    //
    //--------------------------------------------------------------------------
    async updateStatistics() {
        var _a;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statistics = null;
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.histogram = null;
        (_a = this.sizeSlider) === null || _a === void 0 ? void 0 : _a.destroy();
        this.sizeSlider = undefined;
        this.sliderZoomed = false;
        this.getStatistics();
    }
    // -------------------------------------------------------------------
    //
    // Lifecycle
    //
    // -------------------------------------------------------------------
    componentWillLoad() {
        this.getStatistics();
    }
    componentDidLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("link", { rel: "stylesheet", href: `${config.jsapiUrl}/themes/light/main.css`, onLoad: () => {
                this.styleSheetStatus = "loaded";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, onError: () => {
                this.styleSheetStatus = "failed";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.styleSheetStatus === "loaded"
            ? this.renderSizeSlider()
            : this.styleSheetStatus === "not-loaded"
                ? this.renderSizeSliderLoading()
                : null));
    }
    renderSizeSlider() {
        const { statisticsStatus, histogramStatus, sliderZoomed } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED ||
            statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING ||
            (sizeVisVar && sizeVisVar.stops && sizeVisVar.stops.length === 1) ||
            (!sizeVisVar && renderer.classBreakInfos.length === 1)) {
            if (this.sizeSlider) {
                this.sizeSlider.destroy();
                this.sizeSlider = undefined;
            }
        }
        else if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS ||
            (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS && !this.sizeSlider)) {
            return this.renderSizeSliderLoading();
        }
        else {
            const ok = this.prepareSizeSlider();
            let disableZoomButton = false;
            if (sizeVisVar && !sliderZoomed) {
                const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
                const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
                const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)([{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue, authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue);
                if ((zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.minMaxSame) ||
                    (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.max))) {
                    disableZoomButton = true;
                    if (this.zoomButtonNode) {
                        this.zoomButtonNode.disabled = true;
                    }
                }
            }
            if (sizeVisVar) {
                this.currentStopValues = [sizeVisVar.minDataValue, sizeVisVar.maxDataValue];
            }
            else {
                this.currentBreakValues = renderer.classBreakInfos.map((classBreakInfo) => ({
                    min: classBreakInfo.minValue,
                    max: classBreakInfo.maxValue
                }));
            }
            if (ok || this.sizeSlider) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.size.dataRange), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box-buttons-front" }, this.renderInvertButton(), sizeVisVar && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderZoomButton(disableZoomButton), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderResetButton()))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                        if (node) {
                            this.afterSizeSliderCreate(node);
                        }
                    } })));
            }
            else {
                return this.renderSizeSliderLoading();
            }
        }
    }
    renderSizeSliderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderInvertButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.panels.size.invertSlider, icon: "arrowUpDown", onClick: () => this.handleInvertSlider() }));
    }
    renderZoomButton(disableZoomButton) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { sliderZoomed } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.panels.size.zoomSlider, icon: sliderZoomed ? "magnifyingGlassMinus" : "magnifyingGlassPlus", disabled: disableZoomButton, onClick: () => this.handleZoomSlider(), ref: (node) => (this.zoomButtonNode = node) }));
    }
    renderResetButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.panels.size.resetSlider, icon: "undo", onClick: () => this.handleResetSlider() }));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    prepareSizeSlider() {
        var _a, _b;
        const { statistics, histogram, histogramStatus, sliderZoomed } = this;
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        const infos = renderer.type === "class-breaks" ? renderer.classBreakInfos : renderer.uniqueValueInfos;
        const fieldInfo = this.getFieldInfo();
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const fillColor = [
            "color-size",
            "color-age-size",
            "color-size-age",
            "type-size",
            "type-size-age",
            "predominance-size",
            "chart-size",
            "relationship-size"
        ].indexOf(rendererType) === -1
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(infos[infos.length - 1].symbol)
            : null;
        let min, max;
        if (authSizeVisVar) {
            min = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue;
            max = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue;
        }
        else {
            min = infos[0].minValue;
            max = infos[infos.length - 1].maxValue;
        }
        ({ min, max } = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)({ min, max }));
        if (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return false;
        }
        if (!this.sizeSlider ||
            (sizeVisVar && this.sizeSlider.breaks) ||
            (!sizeVisVar && this.sizeSlider.stops)) {
            (_a = this.sizeSlider) === null || _a === void 0 ? void 0 : _a.destroy();
            const config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max,
                style: fillColor
                    ? {
                        trackFillColor: fillColor ? fillColor : null
                    }
                    : null
            };
            if (sizeVisVar) {
                if (isDateField && !isAgeRenderer) {
                    config.hasTimeData = true;
                    (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.a)(config, mapView.timeZone);
                }
                config.stops = (0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.l)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.g)(config.stops);
                this.sizeSlider = new modules.SizeSlider(config);
            }
            else {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                config.histogramConfig.min = renderer.classBreakInfos[0].minValue;
                config.histogramConfig.max =
                    renderer.classBreakInfos[renderer.classBreakInfos.length - 1].maxValue;
                this.sliderZoomed = false;
                config.breaks = (0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.m)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.g)(config.breaks);
                this.sizeSlider = new modules.ClassedSizeSlider(config);
            }
            this.createSizeSliderChangeEvents();
        }
        else {
            const slider = this.sizeSlider;
            if (((_b = slider.slider) === null || _b === void 0 ? void 0 : _b.state) === "dragging") {
                return true;
            }
            const config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max,
                style: fillColor
                    ? {
                        trackFillColor: fillColor ? fillColor : null
                    }
                    : null
            };
            if (sizeVisVar) {
                config.stops = (0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.l)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.g)(config.stops);
                config.hasTimeData = isDateField && !isAgeRenderer;
                if (isDateField && !isAgeRenderer) {
                    (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_2__.a)(config, mapView.timeZone);
                }
                if (sliderZoomed) {
                    /**
                     * clicking a zigzag already updates the internal slider zoomOptions;
                     * setting them here again would incorrectly override a user's decision
                     * to manually zoom out one side of the slider.
                     */
                    if (!this.zigzagClick) {
                        config.zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)([{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue, authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue);
                    }
                }
                else {
                    config.zoomOptions = null;
                }
            }
            else {
                config.breaks = (0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.m)();
                config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_10__.g)(config.breaks);
            }
            if (this.sliderZoomed && this.adjustedZoomOptions && !this.zigzagClick) {
                config.zoomOptions = this.adjustedZoomOptions;
                /**
                 * handles edge cases where the slider is zoomed, handles have been manually modified,
                 * and a user executes a label change. This prevents zoom options from changing and preserves
                 * the histogram display.
                 */
                if (this.zoomAdjustment === "min") {
                    this.sizeSlider.slider.min = config.zoomOptions.min;
                    config.zoomOptions.min = null;
                }
                else {
                    this.sizeSlider.slider.max = config.zoomOptions.max;
                    config.zoomOptions.max = null;
                }
            }
            this.adjustedZoomOptions = null;
            this.zoomAdjustment = null;
            this.sizeSlider.set(config);
            this.zigzagClick = false;
        }
        return (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.sizeSlider);
    }
    handleInvertSlider() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (sizeVisVar) {
            [sizeVisVar.minSize, sizeVisVar.maxSize] = [sizeVisVar.maxSize, sizeVisVar.minSize];
        }
        else {
            const sizes = renderer.classBreakInfos.map((info) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.T)(info.symbol));
            sizes.reverse();
            renderer.classBreakInfos.forEach((info, idx) => {
                const sym = info.symbol;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.U)(sym, sizes[idx]);
            });
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        this.arcgisSmartMappingSizeSliderChange.emit();
    }
    handleZoomSlider(zoomed) {
        var _a, _b, _c, _d;
        if (this.histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return;
        }
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.sliderZoomed = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomed) ? zoomed : !this.sliderZoomed;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (!sizeVisVar) {
            this.sliderZoomed = false;
        }
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        const fieldInfo = this.getFieldInfo();
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const zoomOptions = this.sliderZoomed
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)([{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], (_a = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _a !== void 0 ? _a : statistics.min, (_b = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : statistics.max)
            : null;
        this.getHistogram(fieldInfo, normalizationField, statistics, (zoomOptions && zoomOptions.min) || ((_c = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) !== null && _c !== void 0 ? _c : statistics.min), (zoomOptions && zoomOptions.max) || ((_d = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) !== null && _d !== void 0 ? _d : statistics.max));
    }
    handleResetSlider() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        this.sliderZoomed = false;
        let sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const theme = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.theme;
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        let updateCall;
        if (["size", "predominance-size", "relationship-size", "chart-size"].indexOf(rendererType) > -1) {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
        }
        else if (rendererType === "size-age") {
            fieldInfo.field = authSizeVisVar.field;
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
        }
        else if (rendererType === "color-size-age") {
            fieldInfo.field = authSizeVisVar.field;
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.i;
        }
        else if (rendererType === "color-age-size") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.h;
        }
        else if (rendererType === "color-size") {
            updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.j;
        }
        else if (rendererType === "type-size") {
            updateCall = _typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_8__.d;
        }
        else if (rendererType === "type-size-age") {
            fieldInfo.field = authSizeVisVar.field;
            updateCall = _typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_8__.b;
        }
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({
            fieldInfos: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.f)(layer),
            normalizationField: normalizationField,
            sizeOptimizationEnabled: typeof sizeVisVar.minSize === "object",
            noReuse: true,
            theme,
            discardMinMax: true
        }, "size"), this.flowItemNode).then((result) => {
            var _a;
            if (((_a = result.statistics) === null || _a === void 0 ? void 0 : _a.count) === 0) {
                const [defaultMin, defaultMax] = this.getDefaultDataRange(fieldInfo);
                const min = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) || defaultMin;
                const max = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) || defaultMax;
                result.statistics.min = min;
                result.statistics.max = max;
                result.statistics.avg = (max + min) / 2;
                this.statistics = result.statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
            }
            else if (result.statistics &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(result.statistics.min) &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(result.statistics.max) &&
                result.statistics.min <= result.statistics.max) {
                this.statistics = result.statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, result.statistics, result.statistics.min, result.statistics.max);
            }
            else {
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            }
            authSizeVisVar.minSliderValue = this.statistics.min;
            authSizeVisVar.maxSliderValue = this.statistics.max;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        }, (error) => this.arcgisSmartMappingSizeSliderError.emit(error));
    }
    afterSizeSliderCreate(node) {
        if (!this.sizeSlider.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.sizeSlider.container = divNode;
        }
    }
    getStatistics() {
        /**
         * Handles the following:
         *  1.) Retrieving statistics on slider load
         *  2.) Retrieving updated statistics after changing age, normalization field, theme, or classify method/number of classes
         */
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let min;
        let max;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        min = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue;
        max = authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue;
        // handles equal interval behavior
        const authInfo = renderer.authoringInfo;
        if ((authInfo === null || authInfo === void 0 ? void 0 : authInfo.classificationMethod) === "equal-interval") {
            const classBreaks = renderer.classBreakInfos;
            min = classBreaks[0].minValue;
            max = classBreaks[classBreaks.length - 1].maxValue;
        }
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        if (!this.statistics) {
            modules
                .summaryStatistics({
                layer,
                view: mapView,
                field: fieldInfo.field,
                valueExpression: fieldInfo.expression,
                normalizationField,
                forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
            })
                .then((statistics) => {
                if (statistics.count === 0) {
                    // field has no values
                    // make up some basic statistics so we can show a slider
                    const [defaultMin, defaultMax] = this.getDefaultDataRange(fieldInfo);
                    const min = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue) || defaultMin;
                    const max = (authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue) || defaultMax;
                    statistics.min = min;
                    statistics.max = max;
                    statistics.avg = (max + min) / 2;
                    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(authSizeVisVar.minSliderValue)) {
                        authSizeVisVar.minSliderValue = min;
                        authSizeVisVar.maxSliderValue = max;
                    }
                }
                else if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.avg) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.min) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics.max)) {
                    // statistics unusable
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                    return;
                }
                statistics = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)(statistics);
                min = min !== null && min !== void 0 ? min : statistics.min;
                max = max !== null && max !== void 0 ? max : statistics.max;
                this.statistics = statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
            }, (error) => {
                console.log(error);
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            });
        }
    }
    getHistogram(fieldInfo, normalizationField, statistics, min, max) {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        statistics = statistics || this.statistics;
        if (!statistics || statistics.count === 0) {
            return;
        }
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        modules
            .histogram({
            layer: layer,
            view: mapView,
            field: fieldInfo.field,
            valueExpression: fieldInfo.expression,
            numBins: 50,
            minValue: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) ? min : statistics.min,
            maxValue: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) ? max : statistics.max,
            normalizationField,
            forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
        })
            .then((histogram) => {
            this.histogram = histogram;
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
        }, () => {
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
        });
    }
    onMinMaxChange(min, max, changing) {
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size") || {};
        if (!sizeVisVar) {
            let minClassBreak = renderer.classBreakInfos[0];
            let maxClassBreak = renderer.classBreakInfos[renderer.classBreakInfos.length - 1];
            minClassBreak.minValue = min;
            minClassBreak.label = `${minClassBreak.minValue.toLocaleString({
                maximumSignificantDigits: 15
            })} - ${minClassBreak.maxValue.toLocaleString({ maximumSignificantDigits: 15 })}`;
            maxClassBreak.maxValue = max;
            maxClassBreak.label = `${maxClassBreak.minValue.toLocaleString({
                maximumSignificantDigits: 15
            })} - ${maxClassBreak.maxValue.toLocaleString({ maximumSignificantDigits: 15 })}`;
        }
        // update only the label that the user is changing
        changing === "min"
            ? (authSizeVisVar.minSliderValue = min)
            : (authSizeVisVar.maxSliderValue = max);
        // determine if label updates merit zooming or not
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)([{ value: sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.minDataValue }, { value: sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.maxDataValue }], authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue, authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue);
        // handles zoom button display for non-classed color sliders
        if (this.zoomButtonNode) {
            if (this.sliderZoomed) {
                this.zoomButtonNode.disabled = false;
            }
            else if (!zoomOptions ||
                zoomOptions.minMaxSame ||
                (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.max))) {
                this.zoomButtonNode.disabled = true;
            }
            else {
                this.zoomButtonNode.disabled = false;
            }
        }
        // zoom adjustment
        if (this.sliderZoomed) {
            this.adjustedZoomOptions = this.sizeSlider.zoomOptions;
            if (changing === "min") {
                this.adjustedZoomOptions.min = min;
                this.zoomAdjustment = "min";
            }
            else {
                this.adjustedZoomOptions.max = max;
                this.zoomAdjustment = "max";
            }
        }
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
        if (min === authSizeVisVar.minSliderValue && max === authSizeVisVar.maxSliderValue) {
            this.sliderZoomed = false;
        }
        renderer.authoringInfo.classificationMethod = "manual";
        this.arcgisSmartMappingSizeSliderChange.emit();
    }
    createSizeSliderChangeEvents() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const isAgeRenderer = ["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1;
        const fieldInfo = this.getFieldInfo();
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        if (!this.sizeSlider) {
            return;
        }
        // handles zigzag click
        this.sizeSlider.watch("zoomOptions", (newValue, oldValue) => {
            if (this.sliderZoomed &&
                (((oldValue === null || oldValue === void 0 ? void 0 : oldValue.min) && !(newValue === null || newValue === void 0 ? void 0 : newValue.min)) || ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.max) && !(newValue === null || newValue === void 0 ? void 0 : newValue.max)))) {
                this.zigzagClick = true;
                this.handleZigzagClick(newValue);
            }
        });
        this.sizeSlider.on("min-change", (info) => {
            if (sizeVisVar) {
                if (info.value > this.currentStopValues[0]) {
                    this.sizeSlider.stops.forEach((stop, idx) => {
                        stop.value = this.currentStopValues[idx];
                    });
                    this.onMinMaxChange(this.currentStopValues[0], this.sizeSlider.slider.max, "min");
                }
                else {
                    this.onMinMaxChange(info.value, this.sizeSlider.slider.max, "min");
                }
            }
            else {
                if (info.value > this.currentBreakValues[0].max) {
                    this.onMinMaxChange(this.currentBreakValues[0].max, this.sizeSlider.slider.max, "min");
                }
                else {
                    this.onMinMaxChange(info.value, this.sizeSlider.slider.max, "min");
                }
            }
        });
        this.sizeSlider.on("max-change", (info) => {
            if (sizeVisVar) {
                if (info.value < this.currentStopValues[this.currentStopValues.length - 1]) {
                    this.sizeSlider.stops.forEach((stop, idx) => {
                        stop.value = this.currentStopValues[idx];
                    });
                    this.onMinMaxChange(this.sizeSlider.slider.min, this.currentStopValues[this.currentStopValues.length - 1], "max");
                }
                else {
                    this.onMinMaxChange(this.sizeSlider.slider.min, info.value, "max");
                }
            }
            else {
                if (info.value < this.currentBreakValues[this.currentBreakValues.length - 1].min) {
                    this.onMinMaxChange(this.sizeSlider.slider.min, this.currentBreakValues[this.currentBreakValues.length - 1].min, "max");
                }
                else {
                    this.onMinMaxChange(this.sizeSlider.slider.min, info.value, "max");
                }
            }
        });
        this.sizeSlider.on("thumb-change", (info) => {
            if (sizeVisVar) {
                const slider = this.sizeSlider;
                const stops = slider.stops;
                if (isDateField && !isAgeRenderer && info.value === 0) {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    return;
                }
                this.updateRendererStops(stops);
            }
            else {
                this.updateRendererBreaks(this.sizeSlider.breaks);
            }
        });
        this.sizeSlider.on("thumb-drag", () => {
            if (sizeVisVar) {
                const stops = this.sizeSlider.stops;
                this.updateRendererStops(stops);
            }
            else {
                this.updateRendererBreaks(this.sizeSlider.breaks);
            }
        });
        this.sizeSlider.on("segment-drag", () => {
            const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
            if (sizeVisVar) {
                const slider = this.sizeSlider;
                const stops = slider.stops;
                this.updateRendererStops(stops);
            }
        });
    }
    updateRendererStops(stops) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        if (sizeVisVar.stops) {
            // TODO JSAPI bug #21896
            if (stops.length === 5) {
                stops[0].label = `< ${stops[0].value}`;
                stops[1].label = `${stops[1].value}`;
                stops[2].label = `${stops[2].value}`;
                stops[3].label = `${stops[3].value}`;
                stops[4].label = `> ${stops[4].value}`;
            }
            sizeVisVar.stops = stops;
        }
        else {
            sizeVisVar.minDataValue = stops[0].value;
            sizeVisVar.maxDataValue = stops[1].value;
        }
        this.currentStopValues = stops.map((stop) => stop.value);
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)([{ value: sizeVisVar.minDataValue }, { value: sizeVisVar.maxDataValue }], authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.minSliderValue, authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.maxSliderValue);
        if (this.sliderZoomed) {
            this.zoomButtonNode.disabled = false;
        }
        else if (!zoomOptions ||
            zoomOptions.minMaxSame ||
            (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.min) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(zoomOptions.max))) {
            this.zoomButtonNode.disabled = true;
        }
        else {
            this.zoomButtonNode.disabled = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    updateRendererBreaks(breaks) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        renderer.authoringInfo.classificationMethod = "manual";
        renderer.classBreakInfos.forEach((classBreakInfo, idx) => {
            if (classBreakInfo.minValue !== breaks[idx].min ||
                classBreakInfo.maxValue !== breaks[idx].max) {
                classBreakInfo.minValue = breaks[idx].min;
                classBreakInfo.maxValue = breaks[idx].max;
                const prefix = idx > 0 ? "> " : "";
                classBreakInfo.label = `${prefix} ${classBreakInfo.minValue.toLocaleString()} - ${classBreakInfo.maxValue.toLocaleString()}`;
                this.currentBreakValues[idx].min = breaks[idx].min;
                this.currentBreakValues[idx].max = breaks[idx].max;
            }
        });
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        this.arcgisSmartMappingSizeSliderChange.emit();
    }
    getDefaultDataRange(fieldInfo) {
        if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE) {
            const year = new Date().getFullYear();
            return [new Date(`1/1/${year}`).getTime(), new Date(`12/31/${year}`).getTime()];
        }
        else {
            return [0, 100];
        }
    }
    getFieldInfo() {
        var _a, _b;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const fieldInfos = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.f)(layer);
        const fieldInfo = ["color-size", "color-age-size", "color-size-age", "type-size", "type-size-age"].indexOf(rendererType) > -1 && fieldInfos.length > 1
            ? fieldInfos[1]
            : rendererType === "relationship-size"
                ? fieldInfos[2]
                : fieldInfos[0];
        fieldInfo.expression = (_a = sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.valueExpression) !== null && _a !== void 0 ? _a : null;
        fieldInfo.expressionTitle = (_b = sizeVisVar === null || sizeVisVar === void 0 ? void 0 : sizeVisVar.valueExpressionTitle) !== null && _b !== void 0 ? _b : null;
        return fieldInfo;
    }
    handleZigzagClick(newValue) {
        var _a, _b;
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "size");
        const fieldInfo = this.getFieldInfo();
        const normalizationField = sizeVisVar
            ? sizeVisVar.normalizationField
            : renderer.normalizationField;
        this.getHistogram(fieldInfo, normalizationField, statistics, (_a = newValue === null || newValue === void 0 ? void 0 : newValue.min) !== null && _a !== void 0 ? _a : authSizeVisVar.minSliderValue, (_b = newValue === null || newValue === void 0 ? void 0 : newValue.max) !== null && _b !== void 0 ? _b : authSizeVisVar.maxSliderValue);
        if (!newValue) {
            this.sliderZoomed = false;
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingSizeSlider.style = arcgisSmartMappingSizeSliderCss;

function getTileInfo(type, tileType) {
    var _a;
    const { layer, selectedFields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
    let styleTileType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.i)(layer) ? "raster" : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.D)(layer);
    if (styleTileType === "multipoint") {
        styleTileType = "point";
    }
    let fieldCount = selectedFields.length;
    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(fieldCount)) {
        // the tiles for combination renderers
        fieldCount = 1;
    }
    const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.i)(layer) ? (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_18__.g)() : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
    let isFirstFieldDate = false;
    let isSecondFieldDate = false;
    if (selectedFields.length) {
        isFirstFieldDate =
            selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE ||
                ((_a = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[0].field)) === null || _a === void 0 ? void 0 : _a.layerField).type === "date-only";
        isSecondFieldDate = isFirstFieldDate;
        if (selectedFields.length > 1) {
            isSecondFieldDate = selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        }
    }
    /*
    colorAge,sizeAge,type_SizeAge
    color_SizeAge,colorDate_SizeAge,colorAge_Size,colorAge_SizeDate
    heatMap
    */
    switch (type) {
        case "simple":
            return {
                title: strings.tile.simpleStyle,
                //css: CSS.simpleTile,
                moreInfo: strings.tile.tooltips.location,
                helpId: "120003675",
                imageFile: `${styleTileType}/Simple.png`
            };
        case "color":
            return {
                title: isFirstFieldDate ? strings.tile.colorStyleDate : strings.tile.colorStyle,
                subText: tileType !== "gallery" ? selectedFields[0].expressionTitle || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[0].field).label : "",
                //css: CSS.colorTile,
                moreInfo: isFirstFieldDate ? strings.tile.tooltips.colorDate : strings.tile.tooltips.color,
                helpId: isFirstFieldDate ? "120003262" : "120003251",
                imageFile: `${styleTileType}/Color.png`
            };
        case "size":
            // for color-size the size tile only has the one size field
            return {
                title: rendererType === "chart-size" && tileType != "gallery"
                    ? strings.tile.sizeStyleChart
                    : (fieldCount === 1 && isFirstFieldDate) || (fieldCount === 2 && isSecondFieldDate)
                        ? strings.tile.sizeStyleDate
                        : strings.tile.sizeStyle,
                subText: tileType !== "gallery"
                    ? rendererType === "chart-size" || rendererType === "predominance-size"
                        ? strings.sumOfCategories
                        : selectedFields[1].expressionTitle || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[1].field).label
                    : "",
                //css: rendererType === "chart-size" ? CSS.chartSizeSizeTile : CSS.sizeTile,
                moreInfo: rendererType === "predominance-size"
                    ? strings.tile.tooltips.sizeForPredominance
                    : //: rendererType === "chart-size"
                        //? strings.tile.tooltips.sizeForChart
                        (fieldCount === 1 && isFirstFieldDate) || (fieldCount === 2 && isSecondFieldDate)
                            ? strings.tile.tooltips.sizeDate
                            : strings.tile.tooltips.size,
                helpId: (fieldCount === 1 && isFirstFieldDate) || (fieldCount === 2 && isSecondFieldDate) ? "120003263" : "120003252",
                imageFile: rendererType === "chart-size" && tileType != "gallery"
                    ? `${styleTileType}/ChartSizeSize.jpg`
                    : `${styleTileType}/Size.png`
            };
        case "type":
            return {
                title: isFirstFieldDate ? strings.tile.typeStyleDate : strings.tile.typeStyle,
                subText: tileType !== "gallery" && ["type-size", "type-size-age"].indexOf(rendererType) > -1
                    ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[0].field).label
                    : "",
                moreInfo: isFirstFieldDate ? strings.tile.tooltips.typeDate : strings.tile.tooltips.type,
                helpId: isFirstFieldDate ? "120003266" : "120003260",
                imageFile: `${styleTileType}/Type.png`
            };
        case "color-age":
            return {
                title: strings.tile.colorAgeStyle,
                subText: tileType !== "gallery" ? selectedFields[0].expressionTitle || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[0].field).label : "",
                //css: CSS.colorAgeTile,
                moreInfo: strings.tile.tooltips.colorAge,
                helpId: "120003264",
                imageFile: `${styleTileType}/Color_Age.png`
            };
        case "size-age":
            return {
                title: strings.tile.sizeAgeStyle,
                subText: tileType !== "gallery" ? selectedFields[1].expressionTitle || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[1].field).label : "",
                //css: CSS.sizeAgeTile,
                moreInfo: strings.tile.tooltips.sizeAge,
                helpId: "120003265",
                imageFile: `${styleTileType}/Size_Age.png`
            };
        case "color-size":
            return {
                title: strings.tile.colorSizeStyle,
                //css: CSS.colorSizeTile,
                moreInfo: isFirstFieldDate
                    ? isSecondFieldDate
                        ? strings.tile.tooltips.colorDate_SizeDate
                        : strings.tile.tooltips.colorDate_Size
                    : isSecondFieldDate
                        ? strings.tile.tooltips.color_SizeDate
                        : strings.tile.tooltips.color_Size,
                helpId: "120003254",
                imageFile: `${styleTileType}/ColorSize.png`
            };
        case "color-age-size":
            return {
                title: strings.tile.colorAgeSizeStyle,
                //css: CSS.colorAgeSizeTile,
                moreInfo: strings.tile.tooltips.colorAge_Size,
                helpId: "120003267",
                imageFile: `${styleTileType}/ColorSize_Age.png`
            };
        case "color-size-age":
            return {
                title: strings.tile.colorSizeAgeStyle,
                //css: CSS.colorSizeAgeTile,
                moreInfo: strings.tile.tooltips.color_SizeAge,
                helpId: "120003267",
                imageFile: `${styleTileType}/ColorSize_Age.png`
            };
        /* case "color-age-size-age":
          return {
            title: strings.tile.colorAgeSizeAgeStyle,
            //css: CSS.colorAgeSizeAgeTile,
            moreInfo: strings.tile.tooltips.colorAge_SizeAge,
            helpId: "120003267",
            imageFile:`${styleTileType}/ColorSize_Age.png`
          }; */
        case "type-size":
            return {
                title: strings.tile.typeSizeStyle,
                //css: CSS.typeSizeTile,
                moreInfo: isFirstFieldDate
                    ? strings.tile.tooltips.typeDate_Size
                    : isSecondFieldDate
                        ? strings.tile.tooltips.type_SizeDate
                        : strings.tile.tooltips.type_Size,
                helpId: "120003261",
                imageFile: `${styleTileType}/TypeSize.png`
            };
        case "type-size-age":
            return {
                title: strings.tile.typeSizeAgeStyle,
                //css: CSS.typeSizeAgeTile,
                moreInfo: strings.tile.tooltips.type_SizeAge,
                helpId: "120003268",
                imageFile: `${styleTileType}/TypeSize_Age.png`
            };
        case "dot-density":
            return {
                title: strings.tile.dotDensityStyle,
                //css: CSS.dotDensityTile,
                moreInfo: strings.tile.tooltips.dotDensity,
                helpId: "120003253",
                imageFile: `${styleTileType}/DotDensity.png`
            };
        case "heatmap":
            return {
                title: strings.tile.heatmapStyle,
                //css: CSS.heatmapTile,
                moreInfo: strings.tile.tooltips.heatMap,
                helpId: "120003250",
                imageFile: `${styleTileType}/HeatMap.png`
            };
        case "relationship":
            return {
                title: strings.tile.relationshipStyle,
                subText: tileType !== "gallery" && rendererType === "relationship-size"
                    ? [(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[0].field).label, (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[1].field).label]
                    : "",
                moreInfo: strings.tile.tooltips.relationship,
                helpId: "120003258",
                imageFile: `${styleTileType}/Relationship.png`
            };
        case "relationship-size":
            return {
                title: strings.tile.relationshipSizeStyle,
                //css: CSS.relationshipSizeTile,
                moreInfo: strings.tile.tooltips.relationshipSize,
                helpId: "120003259",
                imageFile: `${styleTileType}/RelationshipSize.png`
            };
        case "predominance":
            return {
                title: strings.tile.predominanceStyle,
                //css: CSS.predominanceTile,
                moreInfo: strings.tile.tooltips.predominance,
                helpId: "120003256",
                imageFile: `${styleTileType}/Predominance.png`
            };
        case "predominance-size":
            return {
                title: strings.tile.predominanceSizeStyle,
                //css: CSS.predominanceSizeTile,
                moreInfo: strings.tile.tooltips.predominanceSize,
                helpId: "120003257",
                imageFile: `${styleTileType}/PredominanceSize.png`
            };
        case "chart":
            return {
                title: rendererType === "chart-size" && tileType !== "gallery"
                    ? strings.tile.chartStyleColor
                    : strings.tile.chartStyle,
                //css: CSS.chartTile,
                moreInfo: strings.tile.tooltips.chart,
                helpId: "120003729",
                imageFile: `${styleTileType}/Chart.jpg`
            };
        case "chart-size":
            return {
                title: strings.tile.chartSizeStyle,
                //css: CSS.chartSizeTile,
                moreInfo: strings.tile.tooltips.chartSize,
                helpId: "120003730",
                imageFile: `${styleTileType}/ChartSize.jpg`
            };
        case "compare":
            return {
                title: strings.tile.compareStyle,
                //css: CSS.compareTile,
                moreInfo: strings.tile.tooltips.compare,
                helpId: "120003255",
                imageFile: `${styleTileType}/Ratio.png`
            };
        case "raster-stretch":
            return {
                title: strings.tile.symbologyStretchStyle,
                //css: CSS.stretchTile,
                moreInfo: strings.tile.tooltips.stretch,
                helpId: "120003269",
                imageFile: `${styleTileType}/stretch.png`
            };
        case "raster-rgb":
            return {
                title: strings.tile.symbologyRGBStyle,
                //css: CSS.rgbTile,
                moreInfo: strings.tile.tooltips.rgb,
                helpId: "120003270",
                imageFile: `${styleTileType}/rgb.png`
            };
        case "raster-unique-value":
            return {
                title: strings.tile.symbologyUniqueValuesStyle,
                //css: CSS.uniqueValuesTile,
                moreInfo: strings.tile.tooltips.uniqueValues,
                helpId: "120003271",
                imageFile: `${styleTileType}/uniqueValues.png`
            };
        case "raster-shaded-relief":
            return {
                title: strings.tile.symbologyShadedReliefStyle,
                //css: CSS.shadedReliefTile,
                moreInfo: strings.tile.tooltips.shadedRelief,
                helpId: "120003273",
                imageFile: `${styleTileType}/shadedRelief.png`
            };
        case "raster-vector-field":
            return {
                title: strings.tile.symbologyVectorFieldStyle,
                //css: CSS.vectorFieldTile,
                moreInfo: strings.tile.tooltips.vectorField,
                helpId: "120003275",
                imageFile: `${styleTileType}/vectorField.png`
            };
        case "raster-colormap":
            return {
                title: strings.tile.symbologyColormapStyle,
                //css: CSS.colormapTile,
                moreInfo: strings.tile.tooltips.colormap,
                helpId: "120003274",
                imageFile: `${styleTileType}/colormap.png`
            };
        case "raster-class-breaks":
            return {
                title: strings.tile.symbologyClassBreaksStyle,
                //css: CSS.classBreaksTile,
                moreInfo: strings.tile.tooltips.classify,
                helpId: "120003272",
                imageFile: `${styleTileType}/classBreaks.png`
            };
        case "raster-flow":
            return {
                title: strings.tile.rasterFlowStyle,
                //css: CSS.flowTile,
                moreInfo: strings.tile.tooltips.flow,
                helpId: "120003676",
                imageFile: `${styleTileType}/flow.png`
            };
    }
}

const arcgisSmartMappingTileCss = ".tile{background-color:white;position:relative;margin:6px;cursor:pointer;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0;transition:box-shadow 125ms ease-in-out}.tile:hover{z-index:5;box-shadow:0 1px 0 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.tile:focus{outline:2px solid var(--calcite-color-brand)}.tile-selected{box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px var(--calcite-color-brand)}.tile-selected:focus{box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 2px var(--calcite-color-brand)}.tile-selected:hover{z-index:5;box-shadow:0 1px 0 2px rgba(0, 0, 0, 0.05), 0 0 0 1px var(--calcite-color-brand)}.tile-check{position:absolute;top:10px;right:10px}.tile-check.rtl{right:auto;left:10px}.style-link{padding:9px 9px}.style-link-icon{margin-top:-1px}.style-link-text{margin-right:10px}.style-link-text.rtl{margin-right:0;margin-left:10px}.style-link-title{font-weight:bold;padding-bottom:5px}.style-link-title.info{display:flex}.style-link-sub-text{font-size:80%;padding:0 0 6px 0;font-weight:normal}.style-link-options{color:#0079c1;display:flex;flex-direction:row nowrap}.style-link-options svg{fill:#0079c1}.tile-image{height:100px;width:100%;background-size:cover;display:flex;align-items:center;justify-content:center}.tile-image-selected{height:68px;background-size:auto 100px}.style-sub-text{font-size:80%;padding:0 0 6px 0}.style-link-info{height:18px}";

const ArcgisSmartMappingTile = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingTileSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingTileSelect", 7);
        this.arcgisSmartMappingTileOptions = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingTileOptions", 7);
        this.arcgisSmartMappingTileError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingTileError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        this.documentClickHandler = undefined;
        this.panelScrollHandler = undefined;
        this.keyupEventHandler = (event) => {
            const { selected } = this;
            if (event.key === " " || event.key === "Enter") {
                event.stopPropagation();
                this.removeInfoPopover();
                // use latest handler on props
                selected
                    ? this.arcgisSmartMappingTileOptions.emit()
                    : this.arcgisSmartMappingTileSelect.emit();
                event.preventDefault();
            }
        };
        this.keydownEventHandler = (event) => {
            if (event.key === " ") {
                // don't scroll panel
                event.stopPropagation();
                event.preventDefault();
            }
        };
        this.clickEventHandler = (event) => {
            var _a, _b;
            const { selected } = this;
            if (((_a = event === null || event === void 0 ? void 0 : event.target) === null || _a === void 0 ? void 0 : _a.nodeName) === "CALCITE-CHECKBOX") {
                // user clicked on checkbox; we handled this below
                return;
            }
            if (((_b = event === null || event === void 0 ? void 0 : event.target) === null || _b === void 0 ? void 0 : _b.nodeName) === "ARCGIS-SMART-MAPPING-THEME-BUTTON") {
                return;
            }
            event.stopPropagation();
            this.removeInfoPopover();
            // use latest handler on props
            selected ? this.arcgisSmartMappingTileOptions.emit() : this.arcgisSmartMappingTileSelect.emit();
            event.preventDefault();
        };
        this.checkboxChangeHandler = (event) => {
            const { selected } = this;
            event.preventDefault();
            const node = event.target;
            if (!node.checked) {
                // we don't allow users to uncheck the box
                node.checked = true;
            }
            else {
                this.removeInfoPopover();
                // use latest handler on props
                selected
                    ? this.arcgisSmartMappingTileOptions.emit()
                    : this.arcgisSmartMappingTileSelect.emit();
            }
        };
        this.tileType = undefined;
        this.type = undefined;
        this.selected = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    /**
     * Set focus on tile
     */
    async setFocus() {
        requestAnimationFrame(() => { var _a; return (_a = this.tileNode) === null || _a === void 0 ? void 0 : _a.focus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.tileInfo = getTileInfo(this.type, this.tileType);
    }
    componentDidLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    disconnectedCallback() {
        this.removeInfoPopover();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { selected, tileInfo, tileType } = this;
        const { title, imageFile } = tileInfo;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.hostElement) === "rtl";
        const styleTileClasses = {
            tile: true,
            "tile-selected": selected
        };
        const styleTileImageClasses = {
            "tile-image": true,
            "tile-image-selected": tileType === "gallery" && selected
        };
        const styleTileCheckClasses = {
            "tile-check": true,
            rtl: rtl
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { "aria-label": `${title} ${selected ? strings.tile.styleOptions : strings.tile.selectStyle}`, "aria-selected": selected, role: "button", tabindex: "0" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: styleTileClasses, tabindex: "0", ref: (element) => {
                this.tileNode = element;
                this.addTileListeners(element);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: styleTileImageClasses, style: {
                backgroundImage: `url(${(0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/arcgis-smart-mapping-thumbnails/`)}${imageFile})`
            }, "aria-hidden": "true" }), tileType === "gallery" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: styleTileCheckClasses, "aria-label": "", "aria-hidden": "true" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { name: "style-tile-check-name", checked: selected, tabindex: "-1", ref: (element) => this.addCheckboxListener(element) }))), this.renderTileLink())));
    }
    renderTheme() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { tileType, type } = this;
        if (layer.type === "imagery" || layer.type === "imagery-tile") {
            return null;
        }
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (rendererType === "chart-size") {
            return null;
        }
        if (["color", "size", "color-age", "size-age", "color-size"].indexOf(type) === -1) {
            return null;
        }
        if ([
            "color",
            "size",
            "color-age",
            "size-age",
            "color-size",
            "color-age-size",
            "color-size-age",
            "type-size",
            "type-size-age",
            "relationship-size"
        ].indexOf(rendererType) === -1) {
            return null;
        }
        if (tileType === "gallery" &&
            [
                "type-size",
                "relationship-size",
                "color-age-size",
                "color-size-age",
                "type-size-age"
            ].indexOf(rendererType) > -1) {
            return null;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isUnivariate = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "univariate-color-size";
        if (tileType === "gallery" && rendererType === "color-size" && !isUnivariate) {
            // bivariate Color+Size
            return null;
        }
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (tileType === "gallery" && rendererType === "color" && !colorVisVar) {
            // classed color
            return null;
        }
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (tileType === "gallery" && rendererType === "size" && !sizeVisVar) {
            // classed size
            return null;
        }
        const rendererSubtype = type === "color-age"
            ? "color"
            : type === "size-age"
                ? "size"
                : type === "color-size"
                    ? "colorSize"
                    : type;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-theme-button", { ref: (node) => (this.themeButtonNode = node), rendererSubtype: rendererSubtype, buttonVersion: "minimal", onArcgisSmartMappingThemeButtonChange: (event) => this.changeTheme(event) }));
    }
    changeTheme(event) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const { type } = this;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isUnivariate = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "univariate-color-size";
        if ((type === "color" || type === "color-age") &&
            ["color", "color-age", "color-size", "color-age-size", "color-size-age"].indexOf(rendererType) > -1) {
            let updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.b;
            if (["color-age", "color-age-size"].indexOf(rendererType) > -1) {
                updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_6__.d;
            }
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ theme: event.detail }), this.flowItemNode).then((result) => {
                if (["color-size", "color-age-size", "color-size-age"].indexOf(rendererType) > -1) {
                    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                    renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "color") || [];
                    renderer.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, "color"));
                    renderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.o)(renderer, "color") || [];
                    renderer.authoringInfo.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, "color"));
                }
                else {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
            }, (error) => this.arcgisSmartMappingTileError.emit(error));
        }
        else if ((type === "size" || type === "size-age") &&
            [
                "size",
                "size-age",
                "color-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "relationship-size"
            ].indexOf(rendererType) > -1) {
            let updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.f;
            if (["size-age", "color-size-age", "type-size-age"].indexOf(rendererType) > -1) {
                updateCall = _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_7__.g;
            }
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(updateCall({ theme: event.detail }), this.flowItemNode).then((result) => {
                if (["size", "size-age"].indexOf(rendererType) === -1) {
                    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                    renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "size") || [];
                    renderer.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, "size"));
                    renderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.o)(renderer, "size") || [];
                    renderer.authoringInfo.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, "size"));
                }
                else {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
            }, (error) => this.arcgisSmartMappingTileError.emit(error));
        }
        else if (type === "color-size" && isUnivariate) {
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)((0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_13__.a)({ theme: event.detail }), this.flowItemNode).then((result) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
            }, (error) => this.arcgisSmartMappingTileError.emit(error));
        }
    }
    renderTileLink() {
        const { selected, tileInfo, tileType } = this;
        const { title, subText } = tileInfo;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.hostElement) === "rtl";
        const styleLinkTextClasses = {
            "style-link-text": true,
            rtl: rtl
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "style-link", "aria-label": title }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `style-link-title ${tileType === "gallery" ? "info" : ""}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: styleLinkTextClasses, "aria-hidden": "true" }, title), tileType === "gallery" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { class: "style-link-info", tabindex: "0", scale: "s", icon: "information", compact: true, onClick: (event) => this.handleInfoClick(event), text: strings.tile.moreInfo, ref: (element) => {
                this.infoIconNode = element;
                element.addEventListener("keyup", (event) => {
                    event.stopPropagation();
                    if (event.key === " " || (!this.infoPopoverNode && event.key === "Enter")) {
                        this.handleInfoClick(event);
                    }
                });
                element.addEventListener("keydown", (event) => {
                    if (event.key === " ") {
                        // prevent panel from scrolling
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            } })), tileType !== "gallery" && subText && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "style-link-sub-text" }, typeof subText === "string" ? subText : subText.map((t) => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, t))))), (selected || tileType !== "gallery") && this.renderTheme(), (selected || tileType !== "gallery") && this.renderStyleOptions()));
    }
    renderStyleOptions() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        // event handling for button click is handled as tile click
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", width: "full", scale: "s", label: strings.tile.styleOptions }, strings.tile.styleOptions));
    }
    // --------------------------------------------------------------------------
    //
    //  Private Methods
    //
    // --------------------------------------------------------------------------
    handleInfoClick(event) {
        // don't execute the event on the entire tile
        event.stopPropagation();
        const { tileInfo, flowItemNode } = this;
        const { title, moreInfo, helpId } = tileInfo;
        const { config, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.removeInfoPopover();
        this.infoPopoverNode = document.createElement("arcgis-smart-mapping-info-popover");
        this.infoPopoverNode.props = {
            title,
            moreInfo,
            helpId,
            config,
            flowItemNode,
            strings
        };
        this.infoPopoverNode.referenceElement = this.infoIconNode;
        this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverClose", (event) => {
            event.stopPropagation();
            this.removeInfoPopover();
            setTimeout(() => this.infoIconNode.setFocus(), 200);
        });
        this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverDisconnected", (event) => {
            event.stopPropagation();
            this.removeInfoPopover();
        });
        document.body.appendChild(this.infoPopoverNode);
        this.infoPopoverNode.setOpen(true);
        // need to wait until it's all visible
        setTimeout(() => this.infoPopoverNode.setFocus(), 100);
        setTimeout(() => {
            // close popover when clicking outside
            this.documentClickHandler = (event) => {
                if (!(0,_popover_721f7ba2_js__WEBPACK_IMPORTED_MODULE_17__.i)(event.target)) {
                    this.removeInfoPopover();
                    setTimeout(() => this.infoIconNode.setFocus(), 200);
                }
            };
            document.addEventListener("click", this.documentClickHandler);
            // click handler is not called when clicking or scrolling panel scrollbars
            this.panelScrollHandler = () => {
                this.removeInfoPopover();
            };
            flowItemNode === null || flowItemNode === void 0 ? void 0 : flowItemNode.addEventListener("calciteFlowItemScroll", this.panelScrollHandler);
        }, 100);
    }
    removeInfoPopover() {
        const { flowItemNode } = this;
        // close popovers
        document.body
            .querySelectorAll(".arcgis-smart-mapping-popover")
            .forEach((node) => document.body.removeChild(node));
        this.infoPopoverNode = null;
        if (this.documentClickHandler) {
            document.removeEventListener("click", this.documentClickHandler);
            this.documentClickHandler = undefined;
        }
        if (this.panelScrollHandler) {
            flowItemNode === null || flowItemNode === void 0 ? void 0 : flowItemNode.removeEventListener("calciteFlowItemScroll", this.panelScrollHandler);
            this.panelScrollHandler = undefined;
        }
    }
    addTileListeners(element) {
        element.addEventListener("keyup", this.keyupEventHandler);
        element.addEventListener("keydown", this.keydownEventHandler);
        element.addEventListener("click", this.clickEventHandler);
    }
    addCheckboxListener(element) {
        element.addEventListener("calciteCheckboxChange", this.checkboxChangeHandler);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingTile.style = arcgisSmartMappingTileCss;



//# sourceMappingURL=arcgis-smart-mapping-age_8.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addDateFormatFunctions),
/* harmony export */   b: () => (/* binding */ utcToTimePicker),
/* harmony export */   d: () => (/* binding */ datePickerToUTC),
/* harmony export */   u: () => (/* binding */ utcToDatePicker)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function addDateFormatFunctions(config, timeZone) {
    config.labelFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputParseFunction = (value) => {
        return mapTZToUTC(Date.parse(value), timeZone);
    };
}
function utcToDatePicker(value, timeZone) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // console.log("utcToDatePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function utcToTimePicker(value, timeZone, addSeconds) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // str = "2023-09-20T13:06:00.000Z"
    str = addSeconds ? str.substring(11, 19) : str.substring(11, 16);
    // console.log("utcToTimePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function datePickerToUTC(dateString, timeZone) {
    // date is in map timezone
    // we need a UTC UNIX timestamp
    let date = new Date(dateString);
    // this is read as current time; toISOString() would reaturn UTC time (e.g. +7 hours from pacific)
    // fix the offset
    date = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
    // date now contains the user's entered time
    let value;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        value = date.getTime() + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        value = date.getTime();
    }
    else {
        // add difference between map time and UTC
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        value = date.getTime() + diff;
    }
    // console.log("datePickerToUTC", date.toISOString(), " -> ", new Date(value).toISOString());
    return value;
}
function mapTZToUTC(value, timeZone) {
    if (!value) {
        return value;
    }
    // value is in map timezone
    // we need a UTC timestamp
    let newValue;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        const date = new Date();
        newValue = value + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        newValue = value;
    }
    else {
        // add difference between map time and UTC
        const date = new Date();
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        newValue = value + diff;
    }
    console.log("mapTZToUTC", value, " - ", new Date(value).toISOString(), " - ", new Date(newValue).toISOString());
    return newValue;
}
function getDateDisplayString(value, timeZone, dateFormat) {
    const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    let str;
    if (timeZone === "unknown") {
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone: "utc", timeZoneName: "shortOffset" }));
    }
    else {
        // known issues with formatting it-CH
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone }));
    }
    // console.log("getDateDisplayString", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}



//# sourceMappingURL=date-79c7d93c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
    let timeout;
    let status = "idle";
    function flush(...args) {
        status = "flushed";
        return debounced(...args);
    }
    function invoke(...args) {
        status = "invoked";
        return debounced(...args);
    }
    function cancel(...args) {
        status = "cancelled";
        return debounced(...args);
    }
    function getStatus() {
        return status;
    }
    const debounced = (...args) => new Promise((resolve) => {
        switch (status) {
            case "flushed":
                status = "idle";
                if (timeout) {
                    clearTimeout(timeout);
                    resolve(fn(...args));
                }
                else {
                    resolve(null);
                }
                break;
            case "invoked":
                clearTimeout(timeout);
                status = "idle";
                resolve(fn(...args));
                break;
            case "cancelled":
                clearTimeout(timeout);
                status = "idle";
                resolve(null);
                break;
            default:
                if (timeout) {
                    clearTimeout(timeout);
                }
                status = "pending";
                timeout = setTimeout(() => {
                    status = "idle";
                    return resolve(fn(...args));
                }, delay);
                break;
        }
    });
    debounced.flush = flush;
    debounced.invoke = invoke;
    debounced.cancel = cancel;
    debounced.getStatus = getStatus;
    return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
    let timeout;
    return (...args) => new Promise((resolve) => {
        if (timeout) {
            return;
        }
        timeout = setTimeout(() => {
            clearTimeout(timeout);
            timeout = undefined;
            resolve(fn(...args));
        }, delay);
    });
};
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
    await Promise.all([promise, timeout(minDelay)]);
    return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
    const { key, data } = getKeyAndItem(item);
    return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
    const resultArr = [];
    const lookupMap = {};
    myArr.forEach((item) => {
        const id = getItemId(item);
        if (lookupMap[id] == null) {
            lookupMap[id] = item;
            resultArr.push(item);
        }
    });
    return resultArr;
}
function unique(myArr) {
    const primitives = { boolean: {}, number: {}, string: {} };
    const objs = [];
    return myArr.filter((item) => {
        let type = typeof item;
        if (type in primitives) {
            return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
        }
        else {
            return objs.indexOf(item) >= 0 ? false : objs.push(item);
        }
    });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));



//# sourceMappingURL=functional-44de8fcf.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   i: () => (/* binding */ isInsideInfoPopoverNode)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function isInsideInfoPopoverNode(node) {
    if ((node === null || node === void 0 ? void 0 : node.tagName) === "ARCGIS-SMART-MAPPING-INFO-POPOVER") {
        return true;
    }
    else {
        let parentNode = node === null || node === void 0 ? void 0 : node.parentElement;
        while (parentNode) {
            if (parentNode.tagName === "ARCGIS-SMART-MAPPING-INFO-POPOVER") {
                return true;
            }
            else {
                parentNode = parentNode.parentElement;
            }
        }
    }
    return false;
}



//# sourceMappingURL=popover-721f7ba2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-renderer-a62f152c.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-renderer-a62f152c.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ applyRasterRenderer),
/* harmony export */   g: () => (/* binding */ getRasterRendererType),
/* harmony export */   n: () => (/* binding */ normalizeColorRamp)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function getRasterRendererType() {
    var _a, _b;
    const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    switch ((_a = layer === null || layer === void 0 ? void 0 : layer.renderer) === null || _a === void 0 ? void 0 : _a.type) {
        case "flow":
            return "raster-flow";
        case "vector-field":
            return "raster-vector-field";
        case "class-breaks":
            return "raster-class-breaks";
        case "unique-value":
            return "raster-unique-value";
        case "raster-stretch":
            return (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.k)(layer) ? "raster-rgb" : "raster-stretch";
        case "raster-shaded-relief":
            return "raster-shaded-relief";
        default:
            return (_b = layer.renderer) === null || _b === void 0 ? void 0 : _b.type;
    }
}
// TODO: add other raster renderer types
function applyRasterRenderer(renderer, layer) {
    if ("renderer" in layer) {
        layer.renderer = renderer;
    }
}
function normalizeColorRamp(colorRamp) {
    const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    if (!colorRamp) {
        return [
            new modules.esriColor([0, 0, 0, 1]),
            new modules.esriColor([50, 50, 50, 1]),
            new modules.esriColor([73, 73, 73, 1]),
            new modules.esriColor([140, 140, 140, 1]),
            new modules.esriColor([255, 255, 255, 1])
        ];
    }
    if ((colorRamp === null || colorRamp === void 0 ? void 0 : colorRamp.type) !== "multipart") {
        return [colorRamp.fromColor, colorRamp.toColor];
    }
    const colorRamps = colorRamp.colorRamps;
    const colors = colorRamps.map((colorRamp) => colorRamp.fromColor);
    colors.push(colorRamps[colorRamps.length - 1].toColor);
    return colors;
}



//# sourceMappingURL=raster-renderer-a62f152c.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWIzY2Q1Ny5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNpSztBQUM0akI7QUFDMWxCO0FBQ3ZFO0FBQ3pCO0FBQ0E7QUFDOEg7QUFDd0w7QUFDNU47QUFDcEU7QUFDZ0c7QUFDK0I7QUFDL0Y7QUFDYztBQUNyQjtBQUNPO0FBQ2Q7QUFDTjtBQUNNO0FBQzdDO0FBQ0g7QUFDRTtBQUNVO0FBQ1g7QUFDSTs7QUFFaEMsc0RBQXNELHlCQUF5QixnQkFBZ0IsOEJBQThCLG1CQUFtQixjQUFjLFNBQVMsd0NBQXdDLDZCQUE2QixZQUFZLGlCQUFpQix1QkFBdUIsb0JBQW9CLFdBQVcsb0JBQW9CLFdBQVcsZUFBZSxzQkFBc0IsYUFBYSw4QkFBOEIsaUJBQWlCLGFBQWEsOEJBQThCLFVBQVUsYUFBYSxtQkFBbUIsZ0JBQWdCLGFBQWEsZUFBZSxVQUFVLGlCQUFpQixZQUFZLGdCQUFnQixrQkFBa0IsY0FBYyxtQkFBbUI7O0FBRTFxQjtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsMkNBQTJDLHFEQUFXO0FBQ3RELDBDQUEwQyxxREFBVztBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGdCQUFnQixFQUFFLCtEQUFpQjtBQUNuRCx5QkFBeUIsbUVBQVc7QUFDcEM7QUFDQSxjQUFjLG1FQUFhO0FBQzNCLGNBQWMsbUVBQWE7QUFDM0IscUZBQXFGLCtEQUFnQjtBQUNyRztBQUNBLGlGQUFpRiwrREFBZ0I7QUFDakcsNEJBQTRCLG1FQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLENBQUMsaURBQUk7QUFDdEI7QUFDQTtB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LHNCQUFzQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEI7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixXQUFXLFlBQVk7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRWlNOztBQUVqTTs7Ozs7Ozs7Ozs7Ozs7QUMvSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV3Qzs7QUFFeEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDcUc7QUFDbEU7QUFDQTs7QUFFbkM7QUFDQTtBQUNBLFlBQVksaUJBQWlCLEVBQUUsK0RBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsbUVBQW1CO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxVQUFVLEVBQUUsK0RBQWlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXlGOztBQUV6RiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zbWFydC1tYXBwaW5nLWFnZV84LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2RhdGUtNzljN2Q5M2MuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9wb3BvdmVyLTcyMWY3YmEyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3Jhc3Rlci1yZW5kZXJlci1hNjJmMTUyYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBkIGFzIGdldEVsZW1lbnQsIGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBwIGFzIGdldEF1dGhWaXNWYXIsIHcgYXMgc2ltcGxlRmllbGRUeXBlcywgRiBhcyBmaW5kUGFyZW50Tm9kZSwgdSBhcyBnZXRGaWVsZCwgZyBhcyBnZXRSZW5kZXJlclR5cGUsIGUgYXMgYXBwbHlSZW5kZXJlciwgYWIgYXMgdXBkYXRlUmVuZGVyZXIsIHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGggYXMgZ2V0UmVuZGVyZXIsIGEgYXMgZ2V0VmlzVmFyLCBhcSBhcyBpc1N5bWJvbEFsbW9zdFdoaXRlLCBFIGFzIGNsb3NlUG9wb3ZlcnMsIGFyIGFzIGdldFJlbmRlclByZXZpZXdTaXplLCBuIGFzIGdldFZpc1ZhcnNFeGNlcHQsIG8gYXMgZ2V0QXV0aFZpc1ZhcnNFeGNlcHQsIFEgYXMgZml4Tm9ybWFsaXphdGlvbkZpZWxkLCBqIGFzIGFwcGx5UmVuZGVyZXJUb0FsbCwgYWEgYXMgaXNUb3BGbG93SXRlbSwgSSBhcyBnZXRMYXllckZpZWxkVHlwZUNvdW50LCBTIGFzIGdldERlZmF1bHRTeW1ib2wsIHIgYXMgYXBwbHlTeW1ib2xDb2xvciwgZiBhcyBnZXRSZW5kZXJlckZpZWxkSW5mb3MsIGFjIGFzIGlzRGVmaW5lZCwgYiBhcyBzdGF0dXMsIHQgYXMgZ2V0U3ltYm9sQ29sb3IsIGFkIGFzIHZhbGlkYXRlTWluTWF4LCBUIGFzIGdldFN5bWJvbFNpemUsIFUgYXMgYXBwbHlTeW1ib2xTaXplLCBhQyBhcyBnZXRab29tT3B0aW9ucywgaSBhcyBpc1Jhc3RlckxheWVyLCBEIGFzIGdldEdlb21ldHJ5VHlwZSB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgeyB1IGFzIHV0Y1RvRGF0ZVBpY2tlciwgYiBhcyB1dGNUb1RpbWVQaWNrZXIsIGQgYXMgZGF0ZVBpY2tlclRvVVRDLCBhIGFzIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMgfSBmcm9tICcuL2RhdGUtNzljN2Q5M2MuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0V3JhcHBlciB9IGZyb20gJy4vbG9hZGluZy02OTEzOTkwNy5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGQgYXMgY3JlYXRlQ29sb3JBZ2VSZW5kZXJlckZyb21FeGlzdGluZywgZSBhcyBjcmVhdGVDbGFzc2VkQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZywgYiBhcyBjcmVhdGVDb2xvclJlbmRlcmVyRnJvbUV4aXN0aW5nIH0gZnJvbSAnLi9jb2xvci1kNmRhMGE5YS5qcyc7XG5pbXBvcnQgeyBnIGFzIGNyZWF0ZVNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZywgaCBhcyBjcmVhdGVDb2xvckFnZVNpemVSZW5kZXJlckZyb21FeGlzdGluZywgaSBhcyBjcmVhdGVDb2xvclNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZywgayBhcyBjcmVhdGVDbGFzc2VkU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nLCBmIGFzIGNyZWF0ZVNpemVSZW5kZXJlckZyb21FeGlzdGluZywgbCBhcyBnZXRTaXplU2xpZGVyU3RvcHMsIG0gYXMgZ2V0Q2xhc3NCcmVha3NTaXplcywgaiBhcyBjcmVhdGVDb2xvclNpemVSZW5kZXJlckZyb21FeGlzdGluZyB9IGZyb20gJy4vY29sb3JTaXplLWNlMGNjZGViLmpzJztcbmltcG9ydCB7IGIgYXMgY3JlYXRlVHlwZVNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZywgZCBhcyBjcmVhdGVUeXBlU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nIH0gZnJvbSAnLi90eXBlU2l6ZS05ZDRjNWQyOC5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlYm91bmNlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0Q3VycmVudFByZWNpc2lvblZhbHVlLCBiIGFzIGJ1aWxkUHJlY2lzaW9uc0xpc3QsIHUgYXMgdXBkYXRlVmFsdWVzV2l0aFByZWNpc2lvbiwgZyBhcyBnZXRTdG9wUHJlY2lzaW9uIH0gZnJvbSAnLi9wcmVjaXNpb24tMDZhNzM2NzIuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTeW1ib2xTdHlsZXJQb3BvdmVyLCByIGFzIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIsIGcgYXMgYnVpbGRTeW1ib2xTdHlsZXJGb3JDbGFzc2VkLCBoIGFzIGdldFJhbmdlVmFsdWVzLCBzIGFzIHNldFJhbmdlVmFsdWVzIH0gZnJvbSAnLi9zeW1ib2xTdHlsZXItMDQ2MzViMmIuanMnO1xuaW1wb3J0IHsgYSBhcyBjcmVhdGVSZWxhdGlvbnNoaXBSZW5kZXJlckZyb21FeGlzdGluZyB9IGZyb20gJy4vcmVsYXRpb25zaGlwLWI3MmQ3ZDk3LmpzJztcbmltcG9ydCB7IGEgYXMgY3JlYXRlQ29sb3JTaXplVW5pdmFyaWF0ZVJlbmRlcmVyRnJvbUV4aXN0aW5nIH0gZnJvbSAnLi9jb2xvclNpemVVbml2YXJpYW50LWQyNjZhYzdjLmpzJztcbmltcG9ydCB7IEMgYXMgQ1NTX1VUSUxJVFksIGcgYXMgZ2V0RWxlbWVudERpciB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXJGcm9tRXhpc3RpbmcgfSBmcm9tICcuL3ByZWRvbWluYW5jZS1hMWEyZDc0ZC5qcyc7XG5pbXBvcnQgeyBhIGFzIGNyZWF0ZUNoYXJ0UmVuZGVyZXJGcm9tRXhpc3RpbmcgfSBmcm9tICcuL2NoYXJ0LTA5N2VjMjgwLmpzJztcbmltcG9ydCB7IGkgYXMgaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUgfSBmcm9tICcuL3BvcG92ZXItNzIxZjdiYTIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRSYXN0ZXJSZW5kZXJlclR5cGUgfSBmcm9tICcuL3Jhc3Rlci1yZW5kZXJlci1hNjJmMTUyYy5qcyc7XG5pbXBvcnQgJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuaW1wb3J0ICcuL3R5cGUtMGFjZTVkMmUuanMnO1xuaW1wb3J0ICcuL2xvY2F0aW9uLWUyNmI1MzlmLmpzJztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nQWdlQ3NzID0gXCIuZmllbGQtc2VsZWN0LWZpeGVke2JhY2tncm91bmQtY29sb3I6I2Y2ZjZmNjtwYWRkaW5nOjZweCA2cHg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO2NvbG9yOiMzMzMzMzM7bWFyZ2luOjA7dHJhbnNpdGlvbjpib3gtc2hhZG93IDI1MG1zIGVhc2UtaW4tb3V0O2JveC1zaGFkb3c6MCAwIDAgMXB4ICNlMGUwZTA7aGVpZ2h0OmF1dG87bGluZS1oZWlnaHQ6MS4yNTtvdmVyZmxvdy13cmFwOmFueXdoZXJlfS52YXJpYWJsZS1kYXRlLWRhdGV7d2lkdGg6MTAwJX0udmFyaWFibGUtZGF0ZS10aW1le3dpZHRoOjEwMCU7bWFyZ2luLXRvcDo1cHh9LnZhcmlhYmxlLWZpZWxkLXJhZGlve2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0udG8tZmxpcC13cmFwcGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0udG8tbGFiZWx7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW4tdG9wOjEwcHh9LnVuaXRzLWxhYmVse21hcmdpbi10b3A6NnB4fS50by1maWVsZHttYXJnaW4tdG9wOi0xMHB4fS5mcm9tLWZpZWxke21hcmdpbi10b3A6LThweDttYXJnaW4tYm90dG9tOjZweH0udW5pdHMtc2VsZWN0e21hcmdpbi1ib3R0b206MTBweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nQWdlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdBZ2VDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ0FnZUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdBZ2VFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nQWdlRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMucmVuZGVyZXJTdWJ0eXBlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIGZpZWxkcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoVmlzVmFyID0gdGhpcy5yZW5kZXJlclN1YnR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgPyBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpXG4gICAgICAgICAgICA6IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWREYXRlRmllbGQgPSBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gZmllbGQuc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgJiZcbiAgICAgICAgICAgIGZpZWxkLmxheWVyRmllbGQubmFtZSA9PT0gYXV0aFZpc1Zhci5maWVsZCk7XG4gICAgICAgIHRoaXMucmVzdERhdGVGaWVsZHMgPSBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gZmllbGQuc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgJiYgZmllbGQgIT09IHNlbGVjdGVkRGF0ZUZpZWxkWzBdKTtcbiAgICAgICAgdGhpcy5mbG93SXRlbU5vZGUgPSBmaW5kUGFyZW50Tm9kZSh0aGlzLmhvc3RFbGVtZW50LCBcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIHRoaXMucmVuZGVyRnJvbSgpLCB0aGlzLnJlbmRlclRvKCksIHRoaXMucmVuZGVyVW5pdHMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJGcm9tKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCB7IGZpZWxkLCBzdGFydFRpbWUgfSA9IGF1dGhWaXNWYXI7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5hZ2UuZnJvbSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmcm9tLWZpZWxkXCIgfSwgZmllbGQgPT09IHN0YXJ0VGltZSA/IHRoaXMucmVuZGVyZXJTdGF0aWNGaWVsZCgpIDogdGhpcy5yZW5kZXJlckFnZUZpZWxkKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclRvKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCB7IGZpZWxkLCBlbmRUaW1lIH0gPSBhdXRoVmlzVmFyO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0by1mbGlwLXdyYXBwZXJcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG8tbGFiZWxcIiB9LCBzdHJpbmdzLmFnZS50byksIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hY3Rpb25cIiwgeyBoYXNPdXRsaW5lOiBmYWxzZSwgdGV4dDogc3RyaW5ncy5hZ2UuZmxpcCwgaWNvbjogXCJhcnJvd1VwRG93blwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZUZsaXAoKSB9KSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG8tZmllbGRcIiB9LCBmaWVsZCA9PT0gZW5kVGltZSA/IHRoaXMucmVuZGVyZXJTdGF0aWNGaWVsZCgpIDogdGhpcy5yZW5kZXJlckFnZUZpZWxkKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlcmVyU3RhdGljRmllbGQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aFZpc1ZhciA9IHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcImNvbG9yXCJcbiAgICAgICAgICAgID8gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKVxuICAgICAgICAgICAgOiBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGdldEZpZWxkKGF1dGhWaXNWYXIuZmllbGQpO1xuICAgICAgICByZXR1cm4gaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkLXNlbGVjdC1maXhlZFwiIH0sIGZpZWxkSW5mbyA9PT0gbnVsbCB8fCBmaWVsZEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkSW5mby5sYWJlbCk7XG4gICAgfVxuICAgIHJlbmRlcmVyQWdlRmllbGQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aFZpc1ZhciA9IHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcImNvbG9yXCJcbiAgICAgICAgICAgID8gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKVxuICAgICAgICAgICAgOiBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHsgZmllbGQsIHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gYXV0aFZpc1ZhcjtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBzdGFydFRpbWUgPT09IGZpZWxkID8gZW5kVGltZSA6IHN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNGaWVsZCA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIjtcbiAgICAgICAgY29uc3QgYWxpYXMgPSAoKF9hID0gdGhpcy5yZXN0RGF0ZUZpZWxkc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxheWVyRmllbGQuYWxpYXMpIHx8ICgoX2IgPSB0aGlzLnJlc3REYXRlRmllbGRzWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGF5ZXJGaWVsZC5uYW1lKTtcbiAgICAgICAgbGV0IGZpZWxkSW5mbztcbiAgICAgICAgaWYgKGlzRmllbGQpIHtcbiAgICAgICAgICAgIGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgICAgICBmaWVsZDogdmFsdWUsXG4gICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLkRBVEVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIHRoaXMucmVzdERhdGVGaWVsZHMubGVuZ3RoID8gKGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvbi1ncm91cFwiLCB7IGNsYXNzOiBcInZhcmlhYmxlLWZpZWxkLXJhZGlvXCIsIG5hbWU6IFwidmFyaWFibGVUeXBlXCIsIG9uQ2FsY2l0ZVJhZGlvQnV0dG9uR3JvdXBDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVHlwZUNoYW5nZShldmVudC50YXJnZXQuc2VsZWN0ZWRJdGVtLnZhbHVlKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lXCIgfSwgaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uXCIsIHsga2V5OiBpc0ZpZWxkID8gYGFnZS12YXJpYWJsZS1yYWRpby1maWVsZC0ke01hdGgucmFuZG9tKCl9YCA6IHVuZGVmaW5lZCwgY2hlY2tlZDogaXNGaWVsZCwgdmFsdWU6IFwiZmllbGRcIiB9KSwgc3RyaW5ncy5hZ2UuZmllbGQpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiB9LCBoKFwiY2FsY2l0ZS1yYWRpby1idXR0b25cIiwgeyBrZXk6ICFpc0ZpZWxkID8gYGFnZS12YXJpYWJsZS1yYWRpby1kYXRlLSR7TWF0aC5yYW5kb20oKX1gIDogdW5kZWZpbmVkLCBjaGVja2VkOiAhaXNGaWVsZCwgdmFsdWU6IFwiZGF0ZVwiIH0pLCBzdHJpbmdzLmFnZS5jdXN0b21EYXRlKSkpIDogbnVsbCwgaXNGaWVsZCA/ICh0aGlzLnJlc3REYXRlRmllbGRzLmxlbmd0aCA+IDEgPyAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWF0dHJpYnV0ZS1pbnB1dFwiLCB7IGZpZWxkTGlzdDogdGhpcy5yZXN0RGF0ZUZpZWxkcywgc2VsZWN0ZWRGaWVsZDogZmllbGRJbmZvLCBtb2RlOiBcInNpbXBsZVwiLCBoaWRlTGFiZWw6IHRydWUsIHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50OiB0aGlzLmZsb3dJdGVtTm9kZSwgb25BcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdGaWVsZE5hbWUgPSBldmVudC5kZXRhaWwuZmllbGQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlUmVuZGVyZXJVcGRhdGVDYWxsKGZpZWxkID09PSBzdGFydFRpbWUgPyB7IGVuZFRpbWU6IG5ld0ZpZWxkTmFtZSB9IDogeyBzdGFydFRpbWU6IG5ld0ZpZWxkTmFtZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlckFnZUZpZWxkTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkLXNlbGVjdC1maXhlZFwiIH0sIGFsaWFzKSkpIDogKHRoaXMucmVuZGVyZXJBZ2VGaWVsZERhdGUoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVW5pdHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aFZpc1ZhciA9IHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcImNvbG9yXCJcbiAgICAgICAgICAgID8gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKVxuICAgICAgICAgICAgOiBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHsgdW5pdHMgfSA9IGF1dGhWaXNWYXI7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJ1bml0cy1sYWJlbFwiIH0sIHN0cmluZ3MuYWdlLnVuaXRzLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBjbGFzczogXCJ1bml0cy1zZWxlY3RcIiwgd2lkdGg6IFwiZnVsbFwiLCBsYWJlbDogc3RyaW5ncy5hZ2UudW5pdHMsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZVVuaXRDaGFuZ2UoZXZlbnQpLCB2YWx1ZTogdW5pdHMsIHJlZjogKG5vZGUpID0+ICh0aGlzLnVuaXRzTm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcInNlY29uZHNcIiwgbGFiZWw6IHN0cmluZ3MuYWdlLnNlY29uZHMsIHNlbGVjdGVkOiB1bml0cyA9PT0gXCJzZWNvbmRzXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcIm1pbnV0ZXNcIiwgbGFiZWw6IHN0cmluZ3MuYWdlLm1pbnV0ZXMsIHNlbGVjdGVkOiB1bml0cyA9PT0gXCJtaW51dGVzXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcImhvdXJzXCIsIGxhYmVsOiBzdHJpbmdzLmFnZS5ob3Vycywgc2VsZWN0ZWQ6IHVuaXRzID09PSBcImhvdXJzXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcImRheXNcIiwgbGFiZWw6IHN0cmluZ3MuYWdlLmRheXMsIHNlbGVjdGVkOiB1bml0cyA9PT0gXCJkYXlzXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcIm1vbnRoc1wiLCBsYWJlbDogc3RyaW5ncy5hZ2UubW9udGhzLCBzZWxlY3RlZDogdW5pdHMgPT09IFwibW9udGhzXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcInllYXJzXCIsIGxhYmVsOiBzdHJpbmdzLmFnZS55ZWFycywgc2VsZWN0ZWQ6IHVuaXRzID09PSBcInllYXJzXCIgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlcmVyQWdlRmllbGREYXRlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3IH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCB7IHVuaXRzLCBmaWVsZCwgc3RhcnRUaW1lLCBlbmRUaW1lIH0gPSBhdXRoVmlzVmFyO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHN0YXJ0VGltZSA9PT0gZmllbGQgPyBlbmRUaW1lIDogc3RhcnRUaW1lO1xuICAgICAgICBjb25zdCBpc0ZpZWxkID0gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiO1xuICAgICAgICBjb25zdCBkYXRlU3RyaW5nID0gIWlzRmllbGQgPyB1dGNUb0RhdGVQaWNrZXIodmFsdWUsIG1hcFZpZXcudGltZVpvbmUpIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBzaG93VGltZSA9IFtcInNlY29uZHNcIiwgXCJtaW51dGVzXCIsIFwiaG91cnNcIl0uaW5kZXhPZih1bml0cykgPiAtMTtcbiAgICAgICAgY29uc3QgdGltZVN0cmluZyA9ICFpc0ZpZWxkICYmIHNob3dUaW1lXG4gICAgICAgICAgICA/IHV0Y1RvVGltZVBpY2tlcih2YWx1ZSwgbWFwVmlldy50aW1lWm9uZSwgdW5pdHMgPT09IFwic2Vjb25kc1wiKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtaW5wdXQtZGF0ZS1waWNrZXJcIiwgeyBzY2FsZTogXCJzXCIsXG4gICAgICAgICAgICAvLyBUT0RPOiB1c2UgXCJ2YWx1ZUFzRGF0ZVwiIGluc3RlYWQgb2YgXCJ2YWx1ZVwiIG9uY2Ugd2UgZGV0ZXJtaW5lIHdoeSBcIm9uQ2FsY2l0ZUlucHV0RGF0ZVBpY2tlckNoYW5nZVwiXG4gICAgICAgICAgICAvLyAgICAgICBmaXJlcyB0b28gZWFybHksIGNhdXNpbmcgYSBwYW5lbCByZS1yZW5kZXIgdGhhdCBkb2VzIG5vdCBhY3R1YWxseSBjaGFuZ2UgYW55dGhpbmdcbiAgICAgICAgICAgIC8vIHZhbHVlQXNEYXRlPXtkYXRlfVxuICAgICAgICAgICAgdmFsdWU6IGRhdGVTdHJpbmcsIGNsYXNzOiBcInZhcmlhYmxlLWRhdGUtZGF0ZVwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlUGlja2VyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25DYWxjaXRlSW5wdXREYXRlUGlja2VyQ2hhbmdlOiAoKSA9PiB0aGlzLmhhbmRsZURhdGVDaGFuZ2UoKSB9KSwgc2hvd1RpbWUgPyAoaChcImNhbGNpdGUtaW5wdXQtdGltZS1waWNrZXJcIiwgeyBrZXk6IGAke3VuaXRzfS0ke3ZhbHVlfWAsIHN0ZXA6IHVuaXRzID09PSBcInNlY29uZHNcIiA/IDEgOiA2MCwgc2NhbGU6IFwic1wiLCB2YWx1ZTogdGltZVN0cmluZywgY2xhc3M6IFwidmFyaWFibGUtZGF0ZS10aW1lXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVQaWNrZXJOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVJbnB1dFRpbWVQaWNrZXJDaGFuZ2U6IGRlYm91bmNlKCgpID0+IHRoaXMuaGFuZGxlVGltZUNoYW5nZSgpLCA3NTApIH0pKSA6IG51bGwpKTtcbiAgICB9XG4gICAgY3JlYXRlUmVuZGVyZXJVcGRhdGVDYWxsKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBsZXQgdXBkYXRlQ2FsbDtcbiAgICAgICAgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJjb2xvci1hZ2VcIikge1xuICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yQWdlUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcInNpemUtYWdlXCIpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVTaXplQWdlUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yLWFnZS1zaXplXCIpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDb2xvckFnZVNpemVSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3Itc2l6ZS1hZ2VcIikge1xuICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yU2l6ZUFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZVR5cGVTaXplQWdlUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdFdyYXBwZXIodXBkYXRlQ2FsbChvcHRpb25zLCB0aGlzLnJlbmRlcmVyU3VidHlwZSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0FnZUNoYW5nZS5lbWl0KCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgLy8gaGFuZGxlcyByZXNldHRpbmcgQ2FsY2l0ZSBjb21wb25lbnRzIHRvIHRoZWlyIHByZS1lcnJvciB2YWx1ZXNcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXJBZ2VGaWVsZE5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yZW5kZXJlckFnZUZpZWxkTm9kZSk7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3IH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgYXV0aFZpc1ZhciA9IHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcImNvbG9yXCJcbiAgICAgICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgICAgICA6IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgdW5pdHMsIGZpZWxkLCBzdGFydFRpbWUsIGVuZFRpbWUgfSA9IGF1dGhWaXNWYXI7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHN0YXJ0VGltZSA9PT0gZmllbGQgPyBlbmRUaW1lIDogc3RhcnRUaW1lO1xuICAgICAgICAgICAgY29uc3QgaXNGaWVsZCA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIjtcbiAgICAgICAgICAgIGNvbnN0IHNob3dUaW1lID0gW1wic2Vjb25kc1wiLCBcIm1pbnV0ZXNcIiwgXCJob3Vyc1wiXS5pbmRleE9mKHVuaXRzKSA+IC0xO1xuICAgICAgICAgICAgY29uc3QgZGF0ZVN0cmluZyA9ICFpc0ZpZWxkXG4gICAgICAgICAgICAgICAgPyB1dGNUb0RhdGVQaWNrZXIodmFsdWUsIG1hcFZpZXcudGltZVpvbmUpXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBjb25zdCB0aW1lU3RyaW5nID0gIWlzRmllbGQgJiYgc2hvd1RpbWVcbiAgICAgICAgICAgICAgICA/IHV0Y1RvVGltZVBpY2tlcih2YWx1ZSwgbWFwVmlldy50aW1lWm9uZSwgdW5pdHMgPT09IFwic2Vjb25kc1wiKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGF0ZVBpY2tlck5vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVQaWNrZXJOb2RlLnZhbHVlID0gZGF0ZVN0cmluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVQaWNrZXJOb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lUGlja2VyTm9kZS52YWx1ZSA9IHRpbWVTdHJpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVuaXRzTm9kZS52YWx1ZSA9IHVuaXRzO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0FnZUVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgaGFuZGxlVW5pdENoYW5nZShldmVudCkge1xuICAgICAgICBjb25zdCB1cGRhdGVkVW5pdHMgPSBldmVudC50YXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWU7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IHVuaXRzOiB1cGRhdGVkVW5pdHMgfTtcbiAgICAgICAgdGhpcy5jcmVhdGVSZW5kZXJlclVwZGF0ZUNhbGwob3B0aW9ucyk7XG4gICAgfVxuICAgIGhhbmRsZVR5cGVDaGFuZ2UodHlwZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCB7IGZpZWxkLCBzdGFydFRpbWUgfSA9IGF1dGhWaXNWYXI7XG4gICAgICAgIGNvbnN0IG5ld1R5cGUgPSB0eXBlID09PSBcImZpZWxkXCIgPyB0aGlzLnJlc3REYXRlRmllbGRzWzBdLmxheWVyRmllbGQubmFtZSA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLmNyZWF0ZVJlbmRlcmVyVXBkYXRlQ2FsbChmaWVsZCA9PT0gc3RhcnRUaW1lID8geyBlbmRUaW1lOiBuZXdUeXBlIH0gOiB7IHN0YXJ0VGltZTogbmV3VHlwZSB9KTtcbiAgICB9XG4gICAgaGFuZGxlRGF0ZUNoYW5nZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3IH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBkYXRlU3RyaW5nID0gdGhpcy5kYXRlUGlja2VyTm9kZS52YWx1ZTtcbiAgICAgICAgaWYgKCFkYXRlU3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGltZVN0cmluZyA9ICgoX2EgPSB0aGlzLnRpbWVQaWNrZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWUpIHx8IFwiMDA6MDA6MDBcIjtcbiAgICAgICAgY29uc3QgdXRjVGltZXN0YW1wID0gZGF0ZVBpY2tlclRvVVRDKGAke2RhdGVTdHJpbmd9VCR7dGltZVN0cmluZ31gLCBtYXBWaWV3LnRpbWVab25lKTtcbiAgICAgICAgY29uc3QgeyBmaWVsZCwgc3RhcnRUaW1lIH0gPSBhdXRoVmlzVmFyO1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge307XG4gICAgICAgIGlmIChmaWVsZCA9PT0gc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICBvcHRpb25zLmVuZFRpbWUgPSB1dGNUaW1lc3RhbXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvcHRpb25zLnN0YXJ0VGltZSA9IHV0Y1RpbWVzdGFtcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNyZWF0ZVJlbmRlcmVyVXBkYXRlQ2FsbChvcHRpb25zKTtcbiAgICB9XG4gICAgaGFuZGxlVGltZUNoYW5nZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwVmlldyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoVmlzVmFyID0gdGhpcy5yZW5kZXJlclN1YnR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgPyBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpXG4gICAgICAgICAgICA6IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgeyBmaWVsZCwgc3RhcnRUaW1lIH0gPSBhdXRoVmlzVmFyO1xuICAgICAgICBsZXQgdGltZVN0cmluZyA9IHRoaXMudGltZVBpY2tlck5vZGUudmFsdWU7XG4gICAgICAgIC8vIHN0YXJ0VGltZSBhbmQgZW5kVGltZSBhcmUgaW4gVVRDXG4gICAgICAgIC8vIHRpbWVTdHJpbmcgaXMgaW4gbWFwIHRpbWVcbiAgICAgICAgLy8gZGF0ZS1waWNrZXIgaXMgaW4gbWFwIHRpbWVcbiAgICAgICAgY29uc3QgZGF0ZVN0cmluZyA9IHRoaXMuZGF0ZVBpY2tlck5vZGUudmFsdWU7XG4gICAgICAgIGNvbnN0IHV0Y1RpbWVzdGFtcCA9IGRhdGVQaWNrZXJUb1VUQyhgJHtkYXRlU3RyaW5nfVQke3RpbWVTdHJpbmd9YCwgbWFwVmlldy50aW1lWm9uZSk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICAgICAgaWYgKGZpZWxkID09PSBzdGFydFRpbWUpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuZW5kVGltZSA9IHV0Y1RpbWVzdGFtcDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG9wdGlvbnMuc3RhcnRUaW1lID0gdXRjVGltZXN0YW1wO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3JlYXRlUmVuZGVyZXJVcGRhdGVDYWxsKG9wdGlvbnMpO1xuICAgIH1cbiAgICBoYW5kbGVGbGlwKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhWaXNWYXIgPSB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIilcbiAgICAgICAgICAgIDogZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCB7IHN0YXJ0VGltZSwgZW5kVGltZSB9ID0gYXV0aFZpc1ZhcjtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHN0YXJ0VGltZTogZW5kVGltZSxcbiAgICAgICAgICAgIGVuZFRpbWU6IHN0YXJ0VGltZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZVJlbmRlcmVyVXBkYXRlQ2FsbChvcHRpb25zKTtcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgbmVpdGhlciBidXR0b24gYmVpbmcgY2hlY2tlZCBhZnRlciBmbGlwXG4gICAgICAgIHRoaXMuY3JlYXRlUmVuZGVyZXJVcGRhdGVDYWxsKG9wdGlvbnMpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nQWdlLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nQWdlQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNzcyA9IFwiLmNsYXNzaWZ5LWJsb2NrLXNlY3Rpb257Ym9yZGVyLXRvcDoxcHggc29saWQgI2UwZTBlMDtvdmVyZmxvdy13cmFwOmFueXdoZXJlfS5ibG9jay1zZWN0aW9uLXBhZGRpbmd7cGFkZGluZy10b3A6NnB4fS5zeW1ib2wtaXMtd2hpdGV7YmFja2dyb3VuZC1jb2xvcjojZjBmMGYwfS5oaWRkZW57ZGlzcGxheTpub25lfS5sYWJlbDpmb2N1cywuc3ltYm9sOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5sYWJlbCwuc3ltYm9sLWNvbnRhaW5lcntwYWRkaW5nLXRvcDo1cHg7cGFkZGluZy1ib3R0b206NXB4fS5zZWxlY3RlZHtvdXRsaW5lOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0ubWV0aG9kLWJ1dHRvbi1jb250ZW50e3BhZGRpbmctdG9wOjhweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnkgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NsYXNzaWZ5Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuc3ltYm9sTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5wb3BvdmVyc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3VwcG9ydHNBcmNhZGUgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgaGFzVmlzVmFyID0gY29sb3JWaXNWYXIgfHwgc2l6ZVZpc1ZhcjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9jay1zZWN0aW9uXCIsIHsgY2xhc3M6IFwiY2xhc3NpZnktYmxvY2stc2VjdGlvblwiLCB0ZXh0OiBzdHJpbmdzLmNsYXNzaWZ5LmNsYXNzaWZ5RGF0YSwgb3BlbjogIWhhc1Zpc1ZhciwgdG9nZ2xlRGlzcGxheTogbWFwSW1hZ2VTdWJsYXllciAmJiAhc3VwcG9ydHNBcmNhZGUgPyBcImJ1dHRvblwiIDogXCJzd2l0Y2hcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NpZnlCbG9ja1NlY3Rpb25Ob2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICBpZiAoIW1hcEltYWdlU3VibGF5ZXIgfHwgc3VwcG9ydHNBcmNhZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKFwiY2FsY2l0ZUJsb2NrU2VjdGlvblRvZ2dsZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDbGFzc2lmeVRvZ2dsZShldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImJsb2NrLXNlY3Rpb24tcGFkZGluZ1wiIH0sICFoYXNWaXNWYXIgJiYgdGhpcy5yZW5kZXJNZXRob2QoKSwgIWhhc1Zpc1ZhciAmJiB0aGlzLnJlbmRlckNsYXNzZXMoKSwgIWhhc1Zpc1ZhciAmJiB0aGlzLnJlbmRlclN0ZERldigpLCAhaGFzVmlzVmFyICYmIHRoaXMucmVuZGVyUm91bmRDbGFzc2VzKCksICFoYXNWaXNWYXIgJiYgdGhpcy5yZW5kZXJWYWx1ZXMoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTWV0aG9kKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1tZXRob2QtYnV0dG9uXCIsIHsga2V5OiByZW5kZXJlci5hdXRob3JpbmdJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kLCBzaG93U3RkRGV2OiB0cnVlLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkJlZm9yZU9wZW46ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdNZXRob2RCdXR0b25DaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5wcmVjaXNpb25WYWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRldGFpbCA9PT0gXCJtYW51YWxcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9PT0gXCJzdGFuZGFyZC1kZXZpYXRpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmZvckVhY2goKGNsYXNzQnJlYWtJbmZvLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSBpZHggPiAwID8gXCI+IFwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0JyZWFrSW5mby5sYWJlbCA9IGAke3ByZWZpeH0gJHtjbGFzc0JyZWFrSW5mby5taW5WYWx1ZS50b0xvY2FsZVN0cmluZygpfSAtICR7Y2xhc3NCcmVha0luZm8ubWF4VmFsdWUudG9Mb2NhbGVTdHJpbmcoKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXV0aEluZm8uY2xhc3NpZmljYXRpb25NZXRob2QgPSBcIm1hbnVhbFwiO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLm1ldGhvZEJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSByZW5kZXJlclR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyBjcmVhdGVDbGFzc2VkQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBjcmVhdGVDbGFzc2VkU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVDYWxsKHsgY2xhc3NpZmljYXRpb25NZXRob2Q6IGV2ZW50LmRldGFpbCB9KSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlDaGFuZ2UuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLm1ldGhvZEJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlFcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kQnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckNsYXNzZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgbnVtQ2xhc3NlcyA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgaWYgKGF1dGhJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kID09PSBcInN0YW5kYXJkLWRldmlhdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MuY2xhc3NpZnkuY2xhc3NpZnlDbGFzc2VzLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyB0YWJpbmRleDogXCIwXCIsIHZhbHVlOiBgJHtudW1DbGFzc2VzfWAsIG1pbjogMSwgbWF4OiAxMCwgc3RlcDogMSwgc2NhbGU6IFwic1wiLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludCh0aGlzLmNsYXNzZXNOb2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bUNsYXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlIDwgdGhpcy5jbGFzc2VzTm9kZS5taW4gfHwgdmFsdWUgPiB0aGlzLmNsYXNzZXNOb2RlLm1heCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzZXNDaGFuZ2VIYW5kbGUgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlQ2xhc3Nlc0NoYW5nZSgpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsYXNzZXNDaGFuZ2VIYW5kbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsYXNzZXNDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAzMDApLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc2VzTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJTdGREZXYoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IGdldFJlbmRlcmVyKGxheWVyKS5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBzdGRkZXYgPSBhdXRoSW5mby5zdGFuZGFyZERldmlhdGlvbkludGVydmFsIHx8IDE7XG4gICAgICAgIGlmIChhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCAhPT0gXCJzdGFuZGFyZC1kZXZpYXRpb25cIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLmNsYXNzaWZ5LmNsYXNzaWZ5U3RkRGV2SW50ZXJ2YWxzLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyB3aWR0aDogXCJmdWxsXCIsIHRhYmluZGV4OiBcIjBcIiwgcm9sZTogXCJidXR0b25cIiwgbGFiZWw6IHN0cmluZ3MuY2xhc3NpZnkuY2xhc3NpZnlTdGREZXZJbnRlcnZhbHMsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZVN0ZERldkNoYW5nZShldmVudCksIHZhbHVlOiBgJHtzdGRkZXZ9YCwgcmVmOiAobm9kZSkgPT4gKHRoaXMuc3RkRGV2U2VsZWN0Tm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcIjAuNVwiLCBsYWJlbDogXCIwLjVcIiwgc2VsZWN0ZWQ6IHN0ZGRldiA9PT0gMC41IH0pLCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogXCIxXCIsIGxhYmVsOiBcIjFcIiwgc2VsZWN0ZWQ6IHN0ZGRldiA9PT0gMSB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyUm91bmRDbGFzc2VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIsIGxvY2FsZSB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGlmIChhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9PT0gXCJzdGFuZGFyZC1kZXZpYXRpb25cIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGFzdFByZWNpc2lvbiA9IGdldEN1cnJlbnRQcmVjaXNpb25WYWx1ZSgpO1xuICAgICAgICBjb25zdCBmaXJzdE9wdGlvbiA9IGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcInNlbGVjdFwiLCBsYWJlbDogc3RyaW5ncy5jbGFzc2lmeS5zZWxlY3RBbk9wdGlvbiB9KTtcbiAgICAgICAgaWYgKCF0aGlzLnByZWNpc2lvblZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnByZWNpc2lvblZhbHVlID0gKF9hID0gbGFzdFByZWNpc2lvbi50b1N0cmluZygpLnNwbGl0KFwiLlwiKVsxXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmVjaXNpb25WYWx1ZXMgPSBidWlsZFByZWNpc2lvbnNMaXN0KHRoaXMucHJlY2lzaW9uVmFsdWUpO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gcHJlY2lzaW9uVmFsdWVzLm1hcCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGAke3ZhbHVlfWAsIGxhYmVsOiBgJHt2YWx1ZS50b0xvY2FsZVN0cmluZyhsb2NhbGUsIHtcbiAgICAgICAgICAgICAgICAgICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiAxNVxuICAgICAgICAgICAgICAgIH0pfWAsIGRpc2FibGVkOiBsYXN0UHJlY2lzaW9uID49IHZhbHVlLCBzZWxlY3RlZDogbGFzdFByZWNpc2lvbiA9PT0gdmFsdWUgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLmNsYXNzaWZ5LmNsYXNzaWZ5Um91bmRDbGFzc2VzLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyB3aWR0aDogXCJmdWxsXCIsIGxhYmVsOiBzdHJpbmdzLmNsYXNzaWZ5LmNsYXNzaWZ5Um91bmRDbGFzc2VzLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IChldmVudCkgPT4gdGhpcy5oYW5kbGVSb3VuZENsYXNzZXNDaGFuZ2UoZXZlbnQpIH0sIFtmaXJzdE9wdGlvbiwgLi4ub3B0aW9uc10pKSk7XG4gICAgfVxuICAgIHJlbmRlclZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLmxhYmVsTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5pbnB1dE5vZGVzID0gW107XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdFwiLCBudWxsLCByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NcbiAgICAgICAgICAgIC5tYXAoKGNsYXNzQnJlYWtJbmZvLCBpZHgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclZhbHVlKGNsYXNzQnJlYWtJbmZvLCBpZHgpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLnJldmVyc2UoKSkpO1xuICAgIH1cbiAgICByZW5kZXJWYWx1ZShjbGFzc0JyZWFrSW5mbywgaWR4KSB7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzeW1ib2wtY29udGFpbmVyXCIsIHNsb3Q6IFwiYWN0aW9ucy1zdGFydFwiIH0sIHRoaXMucmVuZGVyU3ltYm9sTm9kZShjbGFzc0JyZWFrSW5mbywgaWR4KSksIHRoaXMucmVuZGVyVGV4dE5vZGUoY2xhc3NCcmVha0luZm8sIGlkeCkpKTtcbiAgICB9XG4gICAgcmVuZGVyU3ltYm9sTm9kZShjbGFzc0JyZWFrSW5mbywgaWR4KSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgbGV0IHN5bWJvbCA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1tpZHhdLnN5bWJvbC5jbG9uZSgpO1xuICAgICAgICBjb25zdCBzeW1ib2xOb2RlQ2xhc3NlcyA9IHtcbiAgICAgICAgICAgIFwic3ltYm9sLWlzLXdoaXRlXCI6IGlzU3ltYm9sQWxtb3N0V2hpdGUoc3ltYm9sKSxcbiAgICAgICAgICAgIHN5bWJvbDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogc3ltYm9sTm9kZUNsYXNzZXMsIHRhYmluZGV4OiBcIjBcIiwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MuY2xhc3NpZnkuYWNjZXNzaWJpbGl0eS5lZGl0U3ltYm9sRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBjbGFzc0JyZWFrSW5mby5sYWJlbCksIFwiYXJpYS1oYXNwb3B1cFwiOiBcInRydWVcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXMudW5zaGlmdChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xOb2Rlc1t0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPT09IGlkeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IGlkeDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpZHgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IGlkeDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGlkeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGlkeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVWYWx1ZVN5bWJvbChub2RlLCBpZHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVGV4dE5vZGUoY2xhc3NCcmVha0luZm8sIGlkeCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJsYWJlbFwiLCBzbG90OiBcImNvbnRlbnRcIiwgdGFiaW5kZXg6IFwiMFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzLnVuc2hpZnQobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MuY2xhc3NpZnkuYWNjZXNzaWJpbGl0eS5lZGl0TGFiZWxGb3IucmVwbGFjZShcIiR7dmFsdWV9XCIsIGNsYXNzQnJlYWtJbmZvLmxhYmVsKSwgb25DbGljazogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUxhYmVsRWRpdChpZHgsIGV2ZW50KSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUxhYmVsRWRpdChpZHgsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGNsYXNzQnJlYWtJbmZvLmxhYmVsKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwiaGlkZGVuXCIsIHNjYWxlOiBcInNcIiwgdGFiaW5kZXg6IFwiMFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzLnVuc2hpZnQobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdmFsdWU6IGNsYXNzQnJlYWtJbmZvLmxhYmVsLCBvbkNhbGNpdGVJbnB1dENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgfSwgb25Gb2N1c291dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpZHhdLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBjbGFzc0JyZWFrSW5mby5sYWJlbCB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMubGFiZWxOb2Rlc1tpZHhdLmZvY3VzKCksIDMwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYWZ0ZXJDcmVhdGVWYWx1ZVN5bWJvbChub2RlLCBpZHgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGxldCBzeW1ib2wgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbaWR4XS5zeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgd2hpbGUgKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5jaGlsZE5vZGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzeW1ib2xVdGlscyB9ID0gbW9kdWxlcztcbiAgICAgICAgaWYgKHN5bWJvbCkge1xuICAgICAgICAgICAgc3ltYm9sVXRpbHNcbiAgICAgICAgICAgICAgICAucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogZ2V0UmVuZGVyUHJldmlld1NpemUoc3ltYm9sKSxcbiAgICAgICAgICAgICAgICBzeW1ib2xDb25maWc6IHN5bWJvbC50eXBlID09PSBcImNpbVwiICYmIHN5bWJvbC5kYXRhLnN5bWJvbC50eXBlID09PSBcIkNJTVBvbHlnb25TeW1ib2xcIlxuICAgICAgICAgICAgICAgICAgICA/IHsgaXNTcXVhcmVGaWxsOiB0cnVlIH1cbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKGVsZW1lbnQpID0+IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5hcHBlbmRDaGlsZChlbGVtZW50KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQ2xhc3NpZnlUb2dnbGUoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCB1cGRhdGVDYWxsID0gZXZlbnQuY3VycmVudFRhcmdldC5vcGVuXG4gICAgICAgICAgICA/IHJlbmRlcmVyVHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICAgICAgPyBjcmVhdGVDbGFzc2VkQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZ1xuICAgICAgICAgICAgICAgIDogY3JlYXRlQ2xhc3NlZFNpemVSZW5kZXJlckZyb21FeGlzdGluZ1xuICAgICAgICAgICAgOiByZW5kZXJlclR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgICAgID8gY3JlYXRlQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZ1xuICAgICAgICAgICAgICAgIDogY3JlYXRlU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVDYWxsKHt9KSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlDaGFuZ2UuZW1pdCh7IGNsb3NlUG9wb3ZlcnM6IHRydWUsIHRvZ2dsZTogdHJ1ZSB9KTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzaWZ5QmxvY2tTZWN0aW9uTm9kZS5vcGVuID0gIXRoaXMuY2xhc3NpZnlCbG9ja1NlY3Rpb25Ob2RlLm9wZW47XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NsYXNzaWZ5RXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVDbGFzc2VzQ2hhbmdlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5taW4oTWF0aC5tYXgocGFyc2VJbnQodGhpcy5jbGFzc2VzTm9kZS52YWx1ZSksIDEpLCAxMCkgfHwgNTtcbiAgICAgICAgaWYgKGAke3ZhbHVlfWAgIT09IHRoaXMuY2xhc3Nlc05vZGUudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3Nlc05vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSByZW5kZXJlclR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgPyBjcmVhdGVDbGFzc2VkQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZ1xuICAgICAgICAgICAgOiBjcmVhdGVDbGFzc2VkU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVDYWxsKHsgbnVtQ2xhc3NlczogdmFsdWUgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNoYW5nZS5lbWl0KHsgY2xhc3Nlc0NoYW5nZTogdHJ1ZSB9KTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgICAgIHRoaXMuY2xhc3Nlc05vZGUudmFsdWUgPSBgJHtyZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubGVuZ3RofWA7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NsYXNzaWZ5RXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVTdGREZXZDaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgdXBkYXRlQ2FsbCA9IHJlbmRlcmVyVHlwZSA9PT0gXCJjb2xvclwiXG4gICAgICAgICAgICA/IGNyZWF0ZUNsYXNzZWRDb2xvclJlbmRlcmVyRnJvbUV4aXN0aW5nXG4gICAgICAgICAgICA6IGNyZWF0ZUNsYXNzZWRTaXplUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIHJlcXVlc3RXcmFwcGVyKHVwZGF0ZUNhbGwoeyBzdGFuZGFyZERldmlhdGlvbkludGVydmFsOiBwYXJzZUZsb2F0KG5vZGUudmFsdWUpIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBhcHBseVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNoYW5nZS5lbWl0KCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgICAgICBjb25zdCBzdGRkZXYgPSBhdXRoSW5mby5zdGFuZGFyZERldmlhdGlvbkludGVydmFsIHx8IDE7XG4gICAgICAgICAgICB0aGlzLnN0ZERldlNlbGVjdE5vZGUudmFsdWUgPSBgJHtzdGRkZXZ9YDtcbiAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlUm91bmRDbGFzc2VzQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgaWYgKG5vZGUudmFsdWUgPT09IFwic2VsZWN0XCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVWYWx1ZXNXaXRoUHJlY2lzaW9uKHBhcnNlRmxvYXQobm9kZS52YWx1ZSkpO1xuICAgICAgICBhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlDaGFuZ2UuZW1pdCh7IGNsb3NlUG9wb3ZlcnM6IHRydWUgfSk7XG4gICAgfVxuICAgIGhhbmRsZUxhYmVsRWRpdChpZHgsIGV2ZW50KSB7XG4gICAgICAgIGxldCBpbnB1dE5vZGUgPSB0aGlzLmlucHV0Tm9kZXNbaWR4XTtcbiAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgIGlucHV0Tm9kZS5zZXRGb2N1cygpO1xuICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpZHgpIHtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBwb3BvdmVyTm9kZSA9IGNyZWF0ZVN5bWJvbFN0eWxlclBvcG92ZXIoe1xuICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsXG4gICAgICAgICAgICBoZWFkaW5nOiBzdHJpbmdzLnN0eWxlci5zeW1ib2xTdHlsZVxuICAgICAgICB9KTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHBvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXNbaWR4XS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9KTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJEaXNjb25uZWN0ZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcmVtb3ZlU3ltYm9sU3R5bGVyUG9wb3Zlcihwb3BvdmVyTm9kZSk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJOb2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbE5vZGVzW2lkeF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLmNsYXNzZWRTeW1ib2xTZWxlY3RlZElkeCA9IGlkeDtcbiAgICAgICAgYnVpbGRTeW1ib2xTdHlsZXJGb3JDbGFzc2VkKHtcbiAgICAgICAgICAgIHBvcG92ZXJOb2RlOiBwb3BvdmVyTm9kZSxcbiAgICAgICAgICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0NsYXNzaWZ5Q2hhbmdlLmVtaXQoeyBzeW1ib2xDaGFuZ2U6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvcG92ZXJOb2RlID0gcG9wb3Zlck5vZGU7XG4gICAgICAgIHRoaXMuc3ltYm9sTm9kZXNbaWR4XS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgfVxuICAgIGhhbmRsZVZhbHVlVGV4dENoYW5nZShpZHgsIGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1tpZHhdLmxhYmVsID0gbm9kZS52YWx1ZTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2lkeF0udGV4dENvbnRlbnQgPSBub2RlLnZhbHVlO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaWR4XS52YWx1ZSA9IG5vZGUudmFsdWU7XG4gICAgICAgIC8qIHdvcmthcm91bmQgdG8gYWxsb3cgXCJlbXB0eVwiIGxhYmVscyAob3RoZXJ3aXNlLCB0aGUgY2xhc3NpZnkgbGFiZWxcbiAgICAgICAgd2lsbCBzdGF5IGVtcHR5IGJ1dCB0aGUgbGVnZW5kIGxhYmVsIHdpbGwgYXNzdW1lIGl0cyBkZWZhdWx0IHZhbHVlKSAqL1xuICAgICAgICBpZiAobm9kZS52YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NCcmVhayA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1tpZHhdO1xuICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gaWR4ID4gMCA/IFwiPiBcIiA6IFwiXCI7XG4gICAgICAgICAgICBjbGFzc0JyZWFrLmxhYmVsID0gYCR7cHJlZml4fSAke2NsYXNzQnJlYWsubWluVmFsdWUudG9Mb2NhbGVTdHJpbmcoKX0gLSAke2NsYXNzQnJlYWsubWF4VmFsdWUudG9Mb2NhbGVTdHJpbmcoKX1gO1xuICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2lkeF0udGV4dENvbnRlbnQgPSBjbGFzc0JyZWFrLmxhYmVsO1xuICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0udmFsdWUgPSBjbGFzc0JyZWFrLmxhYmVsO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnkuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNzcztcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdEaXZpZGVkQnlDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ0RpdmlkZWRCeUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdEaXZpZGVkQnlFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5RXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMucmVuZGVyZXJTdWJ0eXBlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5vcm1hbGl6YXRpb25GaWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWVsZFBvcyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIGZpZWxkcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBnZXRWaXNWYXIocmVuZGVyZXIsIHRoaXMucmVuZGVyZXJTdWJ0eXBlKTtcbiAgICAgICAgY29uc3QgaXNSZWxhdGlvbnNoaXBQYW5lbCA9IHJlbmRlcmVyVHlwZSA9PT0gXCJyZWxhdGlvbnNoaXBcIiB8fCB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJyZWxhdGlvbnNoaXBcIjtcbiAgICAgICAgY29uc3QgY3VycmVudEZpZWxkID0gaXNSZWxhdGlvbnNoaXBQYW5lbFxuICAgICAgICAgICAgPyB0aGlzLmZpZWxkUG9zID09PSAwXG4gICAgICAgICAgICAgICAgPyBhdXRoSW5mby5maWVsZDEuZmllbGRcbiAgICAgICAgICAgICAgICA6IGF1dGhJbmZvLmZpZWxkMi5maWVsZFxuICAgICAgICAgICAgOiBmaWVsZEluZm9cbiAgICAgICAgICAgICAgICA/IGZpZWxkSW5mby5maWVsZFxuICAgICAgICAgICAgICAgIDogcmVuZGVyZXIuZmllbGQ7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IGlzUmVsYXRpb25zaGlwUGFuZWxcbiAgICAgICAgICAgID8gdGhpcy5maWVsZFBvcyA9PT0gMFxuICAgICAgICAgICAgICAgID8gYXV0aEluZm8uZmllbGQxLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgICAgIDogYXV0aEluZm8uZmllbGQyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiBmaWVsZEluZm9cbiAgICAgICAgICAgICAgICA/IGZpZWxkSW5mby5ub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgICAgICAgICA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZDtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYXR0cmlidXRlLWlucHV0XCIsIHsgZmllbGRMaXN0OiBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gZmllbGQubGF5ZXJGaWVsZC5uYW1lICE9PSBjdXJyZW50RmllbGQgJiZcbiAgICAgICAgICAgICAgICBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSKSwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBsYWJlbDogc3RyaW5ncy50cmFuc3BhcmVuY3kuZGl2aWRlZEJ5LCBtb2RlOiBcInJlbW92ZVwiLCBzZWxlY3RlZEZpZWxkOiBub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IG5vcm1hbGl6YXRpb25GaWVsZCxcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IG51bGwsIG9uQXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRJbmZvID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZShmaWVsZEluZm8uZmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3JtYWxpemUobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIG5vcm1hbGl6ZShub3JtYWxpemF0aW9uRmllbGQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBpc1VuaXZhcmlhdGUgPSAoYXV0aEluZm8gPT09IG51bGwgfHwgYXV0aEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhJbmZvLnR5cGUpID09PSBcInVuaXZhcmlhdGUtY29sb3Itc2l6ZVwiO1xuICAgICAgICBjb25zdCBpc0NsYXNzQnJlYWtzQ29sb3IgPSAoYXV0aEluZm8gPT09IG51bGwgfHwgYXV0aEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhJbmZvLnR5cGUpID09PSBcImNsYXNzLWJyZWFrcy1jb2xvclwiO1xuICAgICAgICBjb25zdCBpc0NsYXNzQnJlYWtzU2l6ZSA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udHlwZSkgPT09IFwiY2xhc3MtYnJlYWtzLXNpemVcIjtcbiAgICAgICAgY29uc3QgaXNSZWxhdGlvbnNoaXBQYW5lbCA9IHJlbmRlcmVyVHlwZSA9PT0gXCJyZWxhdGlvbnNoaXBcIiB8fCB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJyZWxhdGlvbnNoaXBcIjtcbiAgICAgICAgbGV0IHVwZGF0ZUNhbGw7XG4gICAgICAgIGlmIChpc0NsYXNzQnJlYWtzQ29sb3IpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDbGFzc2VkQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc0NsYXNzQnJlYWtzU2l6ZSkge1xuICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNsYXNzZWRTaXplUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNVbml2YXJpYXRlKSB7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlQ29sb3JTaXplVW5pdmFyaWF0ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcImNvbG9yXCIpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDb2xvclJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgaWYgKFtcImNvbG9yLWFnZVwiLCBcImNvbG9yLWFnZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yQWdlUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5yZW5kZXJlclN1YnR5cGUgPT09IFwic2l6ZVwiKSB7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgaWYgKFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZVNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc1JlbGF0aW9uc2hpcFBhbmVsKSB7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlUmVsYXRpb25zaGlwUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgICAgICBpZiAoaXNSZWxhdGlvbnNoaXBQYW5lbCkge1xuICAgICAgICAgICAgdGhpcy5maWVsZFBvcyA9PT0gMFxuICAgICAgICAgICAgICAgID8gKG9wdGlvbnMubm9ybWFsaXphdGlvbkZpZWxkMSA9IG5vcm1hbGl6YXRpb25GaWVsZClcbiAgICAgICAgICAgICAgICA6IChvcHRpb25zLm5vcm1hbGl6YXRpb25GaWVsZDIgPSBub3JtYWxpemF0aW9uRmllbGQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb3B0aW9ucy5ub3JtYWxpemF0aW9uRmllbGQgPSBub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdFdyYXBwZXIodXBkYXRlQ2FsbChvcHRpb25zLCB0aGlzLnJlbmRlcmVyU3VidHlwZSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChpc1VuaXZhcmlhdGUgfHwgaXNDbGFzc0JyZWFrc0NvbG9yIHx8IGlzQ2xhc3NCcmVha3NTaXplIHx8IGlzUmVsYXRpb25zaGlwUGFuZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcInJlbGF0aW9uc2hpcC1zaXplXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8ga2VlcCBiYWNrZ3JvdW5kIHN0eWxlXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5iYWNrZ3JvdW5kRmlsbFN5bWJvbCA9IHJlbmRlcmVyLmJhY2tncm91bmRGaWxsU3ltYm9sO1xuICAgICAgICAgICAgICAgICAgICAvLyBrZWVwIHNpemUgdmFyaWFibGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaXplQXV0aFZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IHJlc3VsdC5yZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci52aXN1YWxWYXJpYWJsZXMucHVzaChzaXplVmlzVmFyKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8gPSByZXN1bHQucmVuZGVyZXIuYXV0aG9yaW5nSW5mbyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzLnB1c2goc2l6ZUF1dGhWaXNWYXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5yZW5kZXJlclN1YnR5cGUgPT09IFwiY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGlmIChbXCJjb2xvci1zaXplXCIsIFwiY29sb3ItYWdlLXNpemVcIiwgXCJjb2xvci1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE91dFZpc3VhbFZhcmlhYmxlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcInNpemVcIikge1xuICAgICAgICAgICAgICAgIGlmIChbXG4gICAgICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIlxuICAgICAgICAgICAgICAgIF0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hPdXRWaXN1YWxWYXJpYWJsZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0RpdmlkZWRCeUNoYW5nZS5lbWl0KCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdEaXZpZGVkQnlFcnJvci5lbWl0KGVycm9yKSk7XG4gICAgfVxuICAgIHN3aXRjaE91dFZpc3VhbFZhcmlhYmxlKHJlc3VsdCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IGdldFZpc1ZhcnNFeGNlcHQocmVuZGVyZXIsIHRoaXMucmVuZGVyZXJTdWJ0eXBlKSB8fCBbXTtcbiAgICAgICAgY29uc3QgdmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgdGhpcy5yZW5kZXJlclN1YnR5cGUpO1xuICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMucHVzaCh2aXNWYXIpO1xuICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcyA9XG4gICAgICAgICAgICBnZXRBdXRoVmlzVmFyc0V4Y2VwdChyZW5kZXJlciwgdGhpcy5yZW5kZXJlclN1YnR5cGUpIHx8IFtdO1xuICAgICAgICBjb25zdCBhdXRoVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIHRoaXMucmVuZGVyZXJTdWJ0eXBlKTtcbiAgICAgICAgYXV0aFZpc1ZhciAmJiByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcy5wdXNoKGF1dGhWaXNWYXIpO1xuICAgICAgICBmaXhOb3JtYWxpemF0aW9uRmllbGQocmVuZGVyZXIpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdJbmZvUG9wb3ZlckNzcyA9IFwiLmluZm97cGFkZGluZzoxMHB4O2JhY2tncm91bmQtY29sb3I6d2hpdGV9LmluZm8tcG9wb3ZlcnttYXgtd2lkdGg6MzIwcHh9LmluZm8taGVscHtwYWRkaW5nLXRvcDoxMHB4O2p1c3RpZnktY29udGVudDpmbGV4LWVuZDtkaXNwbGF5OmZsZXh9LmluZm8taGVscC1idXR0b257ZGlzcGxheTpmbGV4O2ZsZXgtZmxvdzpyb3ctcmV2ZXJzZX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nSW5mb1BvcG92ZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nSW5mb1BvcG92ZXJEaXNjb25uZWN0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyRGlzY29ubmVjdGVkXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIFByb3BlcnRpZXNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmRvY3VtZW50VGFiSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wYW5lbFNjcm9sbEhhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5vbk9wZW4gPSAoKSA9PiB7IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMucGFuZWxOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7IH07XG4gICAgICAgIHRoaXMucHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVmZXJlbmNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBwdWJsaWMgY2FsbHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gICAgfVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMucGFuZWxOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgYXN5bmMgc2V0T3BlbihvcGVuKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUub3BlbiA9IG9wZW47XG4gICAgICAgICAgICBpZiAob3Blbikge1xuICAgICAgICAgICAgICAgIChfYSA9IHRoaXMucGFuZWxOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJOb2RlLnJlcG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIC8vIGluIGNhc2UgcG9wb3ZlciBnb3QgcmVtb3ZlZCBieSBqdXN0IHJlbW92aW5nIG5vZGUgZnJvbSBET01cbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdJbmZvUG9wb3ZlckRpc2Nvbm5lY3RlZC5lbWl0KCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMsIHJlZmVyZW5jZUVsZW1lbnQsIG9wZW4gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIG1vcmVJbmZvLCBoZWxwSWQgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaGVscEJhc2UsIGhlbHBNYXAgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgaGVhZGVyID0gc3RyaW5ncy50aWxlLmluZm8udGl0bGUucmVwbGFjZShcIiR7dGl0bGV9XCIsIHRpdGxlKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dCBhcmNnaXMtc21hcnQtbWFwcGluZy1wb3BvdmVyXCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IG9wZW46IG9wZW4sIHBsYWNlbWVudDogXCJhdXRvXCIsIG9mZnNldFNraWRkaW5nOiA1LCBsYWJlbDogXCJcIiwgcmVmZXJlbmNlRWxlbWVudDogcmVmZXJlbmNlRWxlbWVudCwgY2xhc3M6IFwiaW5mby1wb3BvdmVyXCIsIG9uQ2FsY2l0ZVBvcG92ZXJPcGVuOiB0aGlzLm9uT3BlbiwgcmVmOiAobm9kZSkgPT4gKHRoaXMucG9wb3Zlck5vZGUgPSBub2RlKSB9LCBoKFwiY2FsY2l0ZS1wYW5lbFwiLCB7IGhlYWRpbmc6IGhlYWRlciwgY2xvc2FibGU6IHRydWUsIHJlZjogKG5vZGUpID0+ICh0aGlzLnBhbmVsTm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVQYW5lbENsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdJbmZvUG9wb3ZlckNsb3NlLmVtaXQoKTtcbiAgICAgICAgICAgICAgICAvLyBmb2N1cyBvbiBpbmZvIGljb247IHdhaXQgc28gZW50ZXIga2V5IGRvZXNuJ3QgcmUtb3BlbiBpdFxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVmZXJlbmNlRWxlbWVudC5wYXJlbnRFbGVtZW50LmZvY3VzKCksIDMwMCk7XG4gICAgICAgICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmZvXCIgfSwgaChcImRpdlwiLCBudWxsLCBtb3JlSW5mbyksIGhlbHBJZCAmJiBoZWxwTWFwID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmZvLWhlbHBcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIGxhYmVsOiBzdHJpbmdzLnRpbGUuaW5mby5sZWFybk1vcmUsIGNsYXNzOiBcImluZm8taGVscC1idXR0b25cIiwgc2xvdDogXCJmb290ZXJcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGAke2hlbHBCYXNlfSR7aGVscE1hcFtoZWxwSWRdfWAsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgfSB9LCBzdHJpbmdzLnRpbGUuaW5mby5sZWFybk1vcmUpKSkgOiBudWxsKSkpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdJbmZvUG9wb3Zlci5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9LnNpemUtYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59LmF0dHJpYnV0ZS1uYW1le3dvcmQtYnJlYWs6YnJlYWstYWxsfS5sZWdlbmQtdG9nZ2xlLXBhZGRpbmd7cGFkZGluZy10b3A6MTJweDtwYWRkaW5nLWJvdHRvbToxMnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLnJhbmdlU2xpZGVyV2F0Y2hIYW5kbGVzID0gW107XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXIsIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVyLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQ2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oaWRlVHJhbnNwYXJlbmN5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVJvdGF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IHRydWU7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXIgPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAvKiB3aW5kb3cub25yZXNpemUgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBmb3IgdHJhbnNwYXJlbmN5IGlucHV0c1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgfTsgKi9cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBoaWRlTGF5ZXJUaXRsZSwgaXNSVEwsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IGxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUJhY2tDbGljay5lbWl0KCk7XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5KCksIHRoaXMucmVuZGVyUm90YXRpb24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgc3RhdGUgb2YgcGFuZWwgZG9lc24ndCBwb3NpdGlvbiBidXR0b25zIGNvcnJlY3RseVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoIWxheWVyKSB7XG4gICAgICAgICAgICAvLyBsb2FkaW5nIHN0YXRlIG9mIHBhbmVsIGRvZXNuJ3QgcG9zaXRpb24gYnV0dG9ucyBjb3JyZWN0bHlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgdmlzdWFsaXphdGlvbk9wZW4sIGhpZGVUcmFuc3BhcmVuY3ksIGhpZGVSb3RhdGlvbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBjb25zdCBpc0V4cHJlc3Npb25SZW5kZXJlciA9IFtcImNoYXJ0LXNpemVcIiwgXCJwcmVkb21pbmFuY2Utc2l6ZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBzaXplVmlzVmFyXG4gICAgICAgICAgICA/IHNpemVWaXNWYXIuZmllbGRcbiAgICAgICAgICAgICAgICA/IChfYSA9IGdldEZpZWxkKHNpemVWaXNWYXIuZmllbGQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGFiZWxcbiAgICAgICAgICAgICAgICA6IHNpemVWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUgfHwgc3RyaW5ncy5leHByZXNzaW9uXG4gICAgICAgICAgICA6IHJlbmRlcmVyLmZpZWxkXG4gICAgICAgICAgICAgICAgPyAoX2IgPSBnZXRGaWVsZChyZW5kZXJlci5maWVsZCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sYWJlbFxuICAgICAgICAgICAgICAgIDogcmVuZGVyZXIudmFsdWVFeHByZXNzaW9uVGl0bGUgfHwgc3RyaW5ncy5leHByZXNzaW9uO1xuICAgICAgICBjb25zdCBmaWVsZCA9IGdldEZpZWxkKChzaXplVmlzVmFyID09PSBudWxsIHx8IHNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpemVWaXNWYXIuZmllbGQpIHx8IHJlbmRlcmVyLmZpZWxkKTtcbiAgICAgICAgY29uc3QgaXNEYXRlID0gKGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC5zaW1wbGVGaWVsZFR5cGUpID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEU7XG4gICAgICAgIGNvbnN0IGlzQ2hhcnQgPSByZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwic2l6ZS1ibG9ja1wiLCBrZXk6IFwic2l6ZS12aXN1YWxpemF0aW9uXCIsIGhlYWRpbmc6IGlzQWdlUmVuZGVyZXJcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLnNpemUuc2l6ZUFnZVN0eWxlXG4gICAgICAgICAgICAgICAgOiBpc0RhdGVcbiAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnBhbmVscy5zaXplLnNpemVTdHlsZURhdGVcbiAgICAgICAgICAgICAgICAgICAgOiBpc0NoYXJ0XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLnNpemUuc2l6ZVN0eWxlQ2hhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc3RyaW5ncy5wYW5lbHMuc2l6ZS5zaXplU3R5bGUsIGNvbGxhcHNpYmxlOiAhaGlkZVRyYW5zcGFyZW5jeSB8fCAhaGlkZVJvdGF0aW9uLCBvcGVuOiB2aXN1YWxpemF0aW9uT3Blbiwgb25DYWxjaXRlQmxvY2tPcGVuOiAoKSA9PiAodGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IHRydWUpLCBvbkNhbGNpdGVCbG9ja0Nsb3NlOiAoKSA9PiAodGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IGZhbHNlKSB9LCBoKFwiZGl2XCIsIG51bGwsICFpc0FnZVJlbmRlcmVyICYmICFpc0V4cHJlc3Npb25SZW5kZXJlciA/IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImF0dHJpYnV0ZS1uYW1lXCIgfSwgZmllbGROYW1lKSkgOiBudWxsLCB0aGlzLnJlbmRlckFnZSgpLCB0aGlzLnJlbmRlclRoZW1lKCksIHRoaXMucmVuZGVyRGl2aWRlZEJ5KCksIHRoaXMucmVuZGVyU3ltYm9sKCksIHRoaXMucmVuZGVyU2l6ZVNsaWRlcigpLCB0aGlzLnJlbmRlclNpemVSYW5nZSgpLCB0aGlzLnJlbmRlckJhY2tncm91bmRTdHlsZSgpLCB0aGlzLnJlbmRlckRlZmF1bHRTeW1ib2woKSwgdGhpcy5yZW5kZXJTaG93SW5MZWdlbmQoKSwgdGhpcy5yZW5kZXJDbGFzc2lmeSgpKSkpO1xuICAgIH1cbiAgICByZW5kZXJBZ2UoKSB7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBpc0FnZVJlbmRlcmVyID0gW1wic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgaWYgKCFpc0FnZVJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hZ2VcIiwgeyByZW5kZXJlclN1YnR5cGU6IFwic2l6ZVwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0FnZUNoYW5nZTogKCkgPT4gdGhpcy5zbGlkZXJOb2RlLnVwZGF0ZVN0YXRpc3RpY3MoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdBZ2VFcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvci5lbWl0KGV2ZW50LmRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJUaGVtZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmICghc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGlmIChbXCJjaGFydC1zaXplXCIsIFwicHJlZG9taW5hbmNlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRoZW1lLWJ1dHRvblwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLnRoZW1lQnV0dG9uTm9kZSA9IG5vZGUpLCByZW5kZXJlclN1YnR5cGU6IFwic2l6ZVwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQmVmb3JlT3BlbjogKCkgPT4gY2xvc2VQb3BvdmVycygpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgICAgICAgICBsZXQgdXBkYXRlQ2FsbCA9IGNyZWF0ZVNpemVSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgICAgICAgICBpZiAoW1wic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlU2l6ZUFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVDYWxsKHtcbiAgICAgICAgICAgICAgICAgICAgdGhlbWU6IGV2ZW50LmRldGFpbCxcbiAgICAgICAgICAgICAgICAgICAgZGlzY2FyZE1pbk1heDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IGdldFZpc1ZhcnNFeGNlcHQocmVuZGVyZXIsIFwic2l6ZVwiKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2goZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMgPSBnZXRBdXRoVmlzVmFyc0V4Y2VwdChyZW5kZXJlciwgXCJzaXplXCIpIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcy5wdXNoKGdldEF1dGhWaXNWYXIocmVzdWx0LnJlbmRlcmVyLCBcInNpemVcIikpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aGVtZUJ1dHRvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy50aGVtZUJ1dHRvbk5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJOb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlLnVwZGF0ZVN0YXRpc3RpY3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnRoZW1lQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckRpdmlkZWRCeSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgZmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBpc0FnZVJlbmRlcmVyID0gW1wic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgaWYgKGlzQWdlUmVuZGVyZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IGdldExheWVyRmllbGRUeXBlQ291bnQoZmllbGRzKTtcbiAgICAgICAgaWYgKGNvdW50cy5udW1iZXIgPCAyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmIChzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZCA9IGdldEZpZWxkKHNpemVWaXNWYXIuZmllbGQpO1xuICAgICAgICAgICAgY29uc3QgZmllbGRJbmZvID0ge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBzaXplVmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHNpemVWaXNWYXIudmFsdWVFeHByZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogc2l6ZVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoZmllbGRJbmZvLmV4cHJlc3Npb24gfHwgZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSAhPT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1kaXZpZGVkLWJ5XCIsIHsgcmVuZGVyZXJTdWJ0eXBlOiBcInNpemVcIiwgbm9ybWFsaXphdGlvbkZpZWxkOiBzaXplVmlzVmFyID8gc2l6ZVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQsIG9uQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5Q2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlLnVwZGF0ZVN0YXRpc3RpY3MoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZ5Tm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmNsYXNzaWZ5Tm9kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0RpdmlkZWRCeUVycm9yOiAoZXZlbnQpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBpZiAocmVuZGVyZXIudHlwZSA9PT0gXCJwaWUtY2hhcnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3ltYm9sID0gdGhpcy5nZXRTeW1ib2woKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IHN5bWJvbDogc3ltYm9sLCB0eXBlOiBcInNpemVcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sQnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xCdXR0b25TeW1ib2xDaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZ5Tm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmNsYXNzaWZ5Tm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yb3RhdGlvbk5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNpemVTbGlkZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXNpemUtc2xpZGVyXCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc2lmeU5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5jbGFzc2lmeU5vZGUpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplRXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2l6ZVJhbmdlKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zaXplLXJhbmdlLXNsaWRlclwiLCB7IG9uQXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVJhbmdlU2xpZGVyRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplRXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQmFja2dyb3VuZFN0eWxlKCkge1xuICAgICAgICBjb25zdCB7IG1hcEltYWdlU3VibGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgaWYgKG1hcEltYWdlU3VibGF5ZXIgJiZcbiAgICAgICAgICAgIFtcInByZWRvbWluYW5jZS1zaXplXCIsIFwidHlwZS1zaXplXCIsIFwicmVsYXRpb25zaGlwLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYmFja2dyb3VuZC1zeW1ib2xcIiwgbnVsbCk7XG4gICAgfVxuICAgIHJlbmRlckRlZmF1bHRTeW1ib2woKSB7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBpZiAoW1wiY2hhcnRcIiwgXCJjaGFydC1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1kZWZhdWx0LXN5bWJvbFwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRTeW1ib2xOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xCZWZvcmVUb2dnbGU6ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sQ2hhbmdlOiAoKSA9PiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2hvd0luTGVnZW5kKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgaWYgKCFzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsZWdlbmRPcHRpb25zID0gc2l6ZVZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBjb25zdCBpc0NoZWNrZWQgPSAhbGVnZW5kT3B0aW9ucyB8fCBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgIT09IGZhbHNlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIsIGNsYXNzOiBcImxlZ2VuZC10b2dnbGUtcGFkZGluZ1wiIH0sIHN0cmluZ3MucGFuZWxzLnNpemUuaW5jbHVkZUluTGVnZW5kLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IGlzQ2hlY2tlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoKSA9PiB0aGlzLmhhbmRsZUluY2x1ZGVJbkxlZ2VuZFRvZ2dsZSgpIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNsYXNzaWZ5KCkge1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3QgaXNEYXRlRmllbGQgPSBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEU7XG4gICAgICAgIGNvbnN0IGlzQWdlUmVuZGVyZXIgPSBbXCJzaXplLWFnZVwiLCBcImNvbG9yLXNpemUtYWdlXCIsIFwidHlwZS1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgaWYgKHJlbmRlcmVyVHlwZSAhPT0gXCJzaXplXCIgfHwgaXNEYXRlRmllbGQgfHwgaXNBZ2VSZW5kZXJlcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctY2xhc3NpZnlcIiwgeyByZWY6IChub2RlKSA9PiAodGhpcy5jbGFzc2lmeU5vZGUgPSBub2RlKSwgb25BcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeUNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICAgICAgICAgICgoaW5zdHJ1Y3Rpb25zID09PSBudWxsIHx8IGluc3RydWN0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5zdHJ1Y3Rpb25zLmNsb3NlUG9wb3ZlcnMpIHx8IChpbnN0cnVjdGlvbnMgPT09IG51bGwgfHwgaW5zdHJ1Y3Rpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbnN0cnVjdGlvbnMuY2xhc3Nlc0NoYW5nZSkpICYmIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy50b2dnbGUpIHx8XG4gICAgICAgICAgICAgICAgICAgICghKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy5zeW1ib2xDaGFuZ2UpICYmICEoaW5zdHJ1Y3Rpb25zID09PSBudWxsIHx8IGluc3RydWN0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5zdHJ1Y3Rpb25zLmNsb3NlUG9wb3ZlcnMpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUudXBkYXRlU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZ5Tm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmNsYXNzaWZ5Tm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xCdXR0b25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc3ltYm9sQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmRlZmF1bHRTeW1ib2xOb2RlKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlFcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvci5lbWl0KGV2ZW50LmRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJUcmFuc3BhcmVuY3koKSB7XG4gICAgICAgIGNvbnN0IHsgaGlkZVRyYW5zcGFyZW5jeSB9ID0gdGhpcztcbiAgICAgICAgaWYgKGhpZGVUcmFuc3BhcmVuY3kpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdHJhbnNwYXJlbmN5XCIsIHsgb3BlbjogISFvcGFjaXR5VmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFRyYW5zcGFyZW5jeUVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgaGlkZVJvdGF0aW9uIH0gPSB0aGlzO1xuICAgICAgICBpZiAoaGlkZVJvdGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IHJvdGF0aW9uVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInJvdGF0aW9uXCIpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1yb3RhdGlvblwiLCB7IG9wZW46ICFvcGFjaXR5VmlzVmFyICYmICEhcm90YXRpb25WaXNWYXIsIHJlZjogKG5vZGUpID0+ICh0aGlzLnJvdGF0aW9uTm9kZSA9IG5vZGUpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICBnZXRTeW1ib2woKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKS50eXBlID09PSBcImNsYXNzLWJyZWFrc1wiXG4gICAgICAgICAgICA/IGdldFJlbmRlcmVyKGxheWVyKVxuICAgICAgICAgICAgOiBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGluZm9zID0gZ2V0UmVuZGVyZXIobGF5ZXIpLnR5cGUgPT09IFwiY2xhc3MtYnJlYWtzXCJcbiAgICAgICAgICAgID8gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zXG4gICAgICAgICAgICA6IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3M7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBsZXQgc3ltYm9sO1xuICAgICAgICBpZiAoW1xuICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICBcInR5cGUtc2l6ZVwiLFxuICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgc3ltYm9sID0gaW5mb3MubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBpbmZvc1swXS5zeW1ib2wuY2xvbmUoKVxuICAgICAgICAgICAgICAgIDogZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldywgcmVuZGVyZXJUeXBlKTtcbiAgICAgICAgICAgIC8vIG1ha2UgdGhlIHN5bWJvbCBncmV5IGxpa2UgaW4gdGhlIGxlZ2VuZFxuICAgICAgICAgICAgYXBwbHlTeW1ib2xDb2xvcihzeW1ib2wsIG5ldyBtb2R1bGVzLmVzcmlDb2xvcih7IHI6IDE0OSwgZzogMTQ5LCBiOiAxNDksIGE6IDEgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3ltYm9sID0gaW5mb3MubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBpbmZvc1tpbmZvcy5sZW5ndGggLSAxXS5zeW1ib2wuY2xvbmUoKVxuICAgICAgICAgICAgICAgIDogZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldywgcmVuZGVyZXJUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3ltYm9sO1xuICAgIH1cbiAgICBoYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBsZWdlbmRPcHRpb25zID0gc2l6ZVZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBpZiAobGVnZW5kT3B0aW9ucyAmJiBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAobGVnZW5kT3B0aW9ucy50aXRsZSkge1xuICAgICAgICAgICAgICAgIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXplVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaXplVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSBsZWdlbmRPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5sZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZm8oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvcyA9IGdldFJlbmRlcmVyRmllbGRJbmZvcyhsYXllcik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IFtcImNvbG9yLXNpemVcIiwgXCJjb2xvci1hZ2Utc2l6ZVwiLCBcImNvbG9yLXNpemUtYWdlXCIsIFwidHlwZS1zaXplXCIsIFwidHlwZS1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSAmJiBmaWVsZEluZm9zLmxlbmd0aCA+IDFcbiAgICAgICAgICAgID8gZmllbGRJbmZvc1sxXVxuICAgICAgICAgICAgOiByZW5kZXJlclR5cGUgPT09IFwicmVsYXRpb25zaGlwLXNpemVcIlxuICAgICAgICAgICAgICAgID8gZmllbGRJbmZvc1syXVxuICAgICAgICAgICAgICAgIDogZmllbGRJbmZvc1swXTtcbiAgICAgICAgcmV0dXJuIGZpZWxkSW5mbztcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemUuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXJDc3MgPSBcIi5zaXplLXJhbmdlLWJsb2Nre2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlMGUwZTB9LnJhbmdlLXNsaWRlcntoZWlnaHQ6NDBweDtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjk1JTttYXJnaW46MTVweCBhdXRvIDAgYXV0b30uc2l6ZS1yYW5nZXtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luLWJvdHRvbToxNXB4fS5zaXplLXJhbmdlLWl0ZW17d2lkdGg6NDglO2Rpc3BsYXk6ZmxleDtmbGV4LWZsb3c6Y29sdW1uO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5lc3JpLXNsaWRlcl9fbGFiZWx7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0uZXNyaS1zbGlkZXJfX2xhYmVsOmhvdmVye2JvcmRlcjoxcHggc29saWQgI2JiYjtiYWNrZ3JvdW5kLWNvbG9yOiNmM2YzZjM7dGV4dC1kZWNvcmF0aW9uOm5vbmU7ei1pbmRleDoxfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1NpemVSYW5nZVNsaWRlckVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXJFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy5yYW5nZVNsaWRlcldhdGNoSGFuZGxlcyA9IFtdO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGNvbmZpZyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5maXJzdEVsZW1lbnRDaGlsZC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmViZWdpblwiLCBgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIke2NvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzXCIgLz5gKTtcbiAgICAgICAgdGhpcy5mbG93SXRlbU5vZGUgPSBmaW5kUGFyZW50Tm9kZSh0aGlzLmhvc3RFbGVtZW50LCBcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lKSA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgY29uc3QgaXNOdWxsID0gc2l6ZVZpc1ZhciA/ICFpc0RlZmluZWQoc2l6ZVZpc1Zhci5taW5TaXplKSA6IGZhbHNlO1xuICAgICAgICBjb25zdCBpc051bWJlciA9IHNpemVWaXNWYXIgPyB0eXBlb2Ygc2l6ZVZpc1Zhci5taW5TaXplID09PSBcIm51bWJlclwiIDogZmFsc2U7XG4gICAgICAgIGNvbnN0IGlzQXV0b21hdGljID0gIWlzTnVsbCAmJiAhaXNOdW1iZXI7XG4gICAgICAgIGxldCBbbG93VmFsdWUsIGhpZ2hWYWx1ZV0gPSBnZXRSYW5nZVZhbHVlcygpO1xuICAgICAgICBbbG93VmFsdWUsIGhpZ2hWYWx1ZV0gPSBbTWF0aC5yb3VuZChsb3dWYWx1ZSAvIDAuNzUpLCBNYXRoLnJvdW5kKGhpZ2hWYWx1ZSAvIDAuNzUpXTtcbiAgICAgICAgaWYgKGxvd1ZhbHVlID4gaGlnaFZhbHVlKSB7XG4gICAgICAgICAgICBbbG93VmFsdWUsIGhpZ2hWYWx1ZV0gPSBbaGlnaFZhbHVlLCBsb3dWYWx1ZV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnJhbmdlU2xpZGVyTm9kZSkge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIG1pbjogTWF0aC5tYXgoMSwgTWF0aC5taW4oMSwgbG93VmFsdWUgLSAxMCkpLFxuICAgICAgICAgICAgICAgIG1heDogTWF0aC5taW4oaGlnaFZhbHVlICsgMTAsIDEwMCksXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbbG93VmFsdWUsIGhpZ2hWYWx1ZV0sXG4gICAgICAgICAgICAgICAgdmlzaWJsZUVsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsczogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAwLFxuICAgICAgICAgICAgICAgIGxhYmVsSW5wdXRzRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYWJlbEZvcm1hdEZ1bmN0aW9uOiAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucmFuZ2VTbGlkZXJOb2RlID0gbmV3IG1vZHVsZXMuU2xpZGVyKGNvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAobG93VmFsdWUgIT09IHRoaXMucmFuZ2VTbGlkZXJOb2RlLnZhbHVlc1swXSB8fFxuICAgICAgICAgICAgICAgIGhpZ2hWYWx1ZSAhPT0gdGhpcy5yYW5nZVNsaWRlck5vZGUudmFsdWVzWzFdIHx8XG4gICAgICAgICAgICAgICAgIWlzRGVmaW5lZCh0aGlzLnJhbmdlU2xpZGVyTm9kZS52YWx1ZXNbMV0pKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICBtaW46IE1hdGgubWF4KDEsIE1hdGgubWluKDEsIGxvd1ZhbHVlIC0gMTApKSxcbiAgICAgICAgICAgICAgICAgICAgbWF4OiBNYXRoLm1pbihoaWdoVmFsdWUgKyAxMCwgMTAwKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBbbG93VmFsdWUsIGhpZ2hWYWx1ZV1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMucmFuZ2VTbGlkZXJOb2RlLnNldChjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2l6ZS1yYW5nZS1ibG9ja1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3Muc2l6ZVJhbmdlU2xpZGVyLnNpemVSYW5nZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJyYW5nZS1zbGlkZXIgcmFuZ2Utc2xpZGVyLWJvdHRvbS1sYWJlbFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlclNpemVSYW5nZUNyZWF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pLCBoKFwiZGl2XCIsIHsgZGlyOiBcImx0clwiLCBjbGFzczogXCJzaXplLXJhbmdlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNpemUtcmFuZ2UtaXRlbVwiIH0sIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHZhbHVlOiBgJHtsb3dWYWx1ZX1gLCBtaW46IDEsIG1heDogMTAwLCBzdGVwOiAxLCBzY2FsZTogXCJzXCIsIHN1ZmZpeFRleHQ6IHN0cmluZ3Muc2l6ZVJhbmdlU2xpZGVyLnB4LCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5taW5SYW5nZU5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUlucHV0TnVtYmVySW5wdXQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gKF9hID0gdGhpcy5yYW5nZVNsaWRlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWx1ZXM7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3TWluaW11bVNpemUgPSBwYXJzZUludCh0aGlzLm1pblJhbmdlTm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWluUmFuZ2VOb2RlLnZhbHVlICYmIG5ld01pbmltdW1TaXplID4gMCAmJiBuZXdNaW5pbXVtU2l6ZSA8IHZhbHVlc1sxXSkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5taW5XYXRjaEhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5taW4obmV3TWluaW11bVNpemUsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWluUmFuZ2VOb2RlLnZhbHVlID0gYCR7dmFsdWV9YDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHRWYWx1ZXMgPSBbdmFsdWUgKiAwLjc1LCB2YWx1ZXNbMV0gKiAwLjc1XTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYW5nZVNsaWRlck5vZGUudmFsdWVzID0gW3BhcnNlSW50KHRoaXMubWluUmFuZ2VOb2RlLnZhbHVlKSwgdmFsdWVzWzFdXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaXplUmFuZ2VWYWx1ZXNDaGFuZ2UocHRWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5taW5XYXRjaEhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFZhbHVlcyA9IChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5taW5SYW5nZU5vZGUudmFsdWUgPSBgJHt1cGRhdGVkVmFsdWVzWzBdfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwdFZhbHVlcyA9IFt1cGRhdGVkVmFsdWVzWzBdICogMC43NSwgdXBkYXRlZFZhbHVlc1sxXSAqIDAuNzVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaXplUmFuZ2VWYWx1ZXNDaGFuZ2UocHRWYWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBsYWJlbDogc3RyaW5ncy5zaXplUmFuZ2VTbGlkZXIubWluIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNpemUtcmFuZ2UtaXRlbVwiIH0sIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHZhbHVlOiBgJHtoaWdoVmFsdWV9YCwgbWluOiAxLCBtYXg6IDEwMCwgc3RlcDogMSwgc2NhbGU6IFwic1wiLCBzdWZmaXhUZXh0OiBzdHJpbmdzLnNpemVSYW5nZVNsaWRlci5weCwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWF4UmFuZ2VOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVzO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld01heGltdW1TaXplID0gcGFyc2VJbnQodGhpcy5tYXhSYW5nZU5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1heFJhbmdlTm9kZS52YWx1ZSAmJlxuICAgICAgICAgICAgICAgICAgICBuZXdNYXhpbXVtU2l6ZSA+IHZhbHVlc1swXSAmJlxuICAgICAgICAgICAgICAgICAgICBuZXdNYXhpbXVtU2l6ZSA8IDEwMSkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5tYXhXYXRjaEhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5taW4obmV3TWF4aW11bVNpemUsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWF4UmFuZ2VOb2RlLnZhbHVlID0gYCR7dmFsdWV9YDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHRWYWx1ZXMgPSBbdmFsdWVzWzBdICogMC43NSwgdmFsdWUgKiAwLjc1XTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYW5nZVNsaWRlck5vZGUudmFsdWVzID0gW3ZhbHVlc1swXSwgcGFyc2VJbnQodGhpcy5tYXhSYW5nZU5vZGUudmFsdWUpXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaXplUmFuZ2VWYWx1ZXNDaGFuZ2UocHRWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXhXYXRjaEhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFZhbHVlcyA9IChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXhSYW5nZU5vZGUudmFsdWUgPSBgJHt1cGRhdGVkVmFsdWVzWzFdfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwdFZhbHVlcyA9IFt1cGRhdGVkVmFsdWVzWzBdICogMC43NSwgdXBkYXRlZFZhbHVlc1sxXSAqIDAuNzVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTaXplUmFuZ2VWYWx1ZXNDaGFuZ2UocHRWYWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBsYWJlbDogc3RyaW5ncy5zaXplUmFuZ2VTbGlkZXIubWluIH0pKSksIHNpemVWaXNWYXIgJiYgIWlzQWJvdmVBbmRCZWxvdyAmJiAhbWFwSW1hZ2VTdWJsYXllciAmJiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIsIGxheW91dDogXCJpbmxpbmVcIiwgY2xhc3M6IFwic2l6ZS1yYW5nZS1ib3R0b20tYm9yZGVyXCIgfSwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IGlzQXV0b21hdGljLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZVNpemVSYW5nZUNoYW5nZShldmVudC50YXJnZXQuY2hlY2tlZCA/IFwiYXV0b21hdGljXCIgOiBcImZpeGVkXCIpLCByZWY6IChub2RlKSA9PiAodGhpcy5hZGp1c3RTaXplTm9kZSA9IG5vZGUpIH0pLCBzdHJpbmdzLnNpemVSYW5nZVNsaWRlci5hZGp1c3RTaXplQXV0b21hdGljYWxseSkpKSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgaGFuZGxlU2l6ZVJhbmdlVmFsdWVzQ2hhbmdlKHB0VmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBjbGFzc0JyZWFrSW5mb3MgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3M7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNaW5TaXplID0gc2l6ZVZpc1ZhclxuICAgICAgICAgICAgPyBzaXplVmlzVmFyLm1pblNpemUgLyAwLjc1XG4gICAgICAgICAgICA6IGNsYXNzQnJlYWtJbmZvc1swXS5zeW1ib2wuc2l6ZSAvIDAuNzU7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNYXhTaXplID0gc2l6ZVZpc1ZhclxuICAgICAgICAgICAgPyBzaXplVmlzVmFyLm1heFNpemUgLyAwLjc1XG4gICAgICAgICAgICA6IGNsYXNzQnJlYWtJbmZvc1tjbGFzc0JyZWFrSW5mb3MubGVuZ3RoIC0gMV0uc3ltYm9sLnNpemUgLyAwLjc1O1xuICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gcHRWYWx1ZXNbMF0gLyAwLjc1O1xuICAgICAgICBjb25zdCB1cHBlckJvdW5kID0gcHRWYWx1ZXNbMV0gLyAwLjc1O1xuICAgICAgICBpZiAoY3VycmVudE1pblNpemUgPT09IGxvd2VyQm91bmQgJiYgY3VycmVudE1heFNpemUgPT09IHVwcGVyQm91bmQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZXRSYW5nZVZhbHVlcyhwdFZhbHVlcyk7XG4gICAgICAgIHRoaXMubWF4UmFuZ2VOb2RlLm1pbiA9IGxvd2VyQm91bmQgKyB0aGlzLm1heFJhbmdlTm9kZS5zdGVwO1xuICAgICAgICB0aGlzLm1pblJhbmdlTm9kZS5tYXggPSB1cHBlckJvdW5kIC0gdGhpcy5taW5SYW5nZU5vZGUuc3RlcDtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgYWZ0ZXJTaXplUmFuZ2VDcmVhdGUobm9kZSkge1xuICAgICAgICBpZiAoIXRoaXMucmFuZ2VTbGlkZXJOb2RlLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBub2RlLmFwcGVuZChkaXZOb2RlKTtcbiAgICAgICAgICAgIHRoaXMucmFuZ2VTbGlkZXJOb2RlLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVJhbmdlU2xpZGVyQ2hhbmdlRXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlUmFuZ2VTbGlkZXJDaGFuZ2VFdmVudHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbWFwVmlldyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghdGhpcy5yYW5nZVNsaWRlck5vZGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJhbmdlU2xpZGVyTm9kZS5vbihcInRodW1iLWNoYW5nZVwiLCAoc2xpZGVyTm9kZUluZm8pID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVzO1xuICAgICAgICAgICAgaWYgKHNsaWRlck5vZGVJbmZvLmluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlc1swXSA+PSB2YWx1ZXNbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzWzBdID0gc2xpZGVyTm9kZUluZm8ub2xkVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2xpZGVyTm9kZUluZm8uaW5kZXggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzWzFdIDw9IHZhbHVlc1swXSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbMV0gPSBzbGlkZXJOb2RlSW5mby5vbGRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1pblJhbmdlTm9kZS52YWx1ZSA9IGAke3ZhbHVlc1swXX1gO1xuICAgICAgICAgICAgdGhpcy5tYXhSYW5nZU5vZGUudmFsdWUgPSBgJHt2YWx1ZXNbMV19YDtcbiAgICAgICAgICAgIGNvbnN0IHB0VmFsdWVzID0gW3ZhbHVlc1swXSAqIDAuNzUsIHZhbHVlc1sxXSAqIDAuNzVdO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVTaXplUmFuZ2VWYWx1ZXNDaGFuZ2UocHRWYWx1ZXMpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yYW5nZVNsaWRlck5vZGUub24oXCJ0aHVtYi1kcmFnXCIsIChzbGlkZXJOb2RlSW5mbykgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gKF9hID0gdGhpcy5yYW5nZVNsaWRlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWx1ZXM7XG4gICAgICAgICAgICBpZiAoc2xpZGVyTm9kZUluZm8uaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzWzBdID49IHZhbHVlc1sxXSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbMF0gPSB2YWx1ZXNbMF0gLSAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2xpZGVyTm9kZUluZm8uaW5kZXggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzWzFdIDw9IHZhbHVlc1swXSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbMV0gPSB2YWx1ZXNbMV0gKyAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5taW5SYW5nZU5vZGUudmFsdWUgPSBgJHt2YWx1ZXNbMF19YDtcbiAgICAgICAgICAgIHRoaXMubWF4UmFuZ2VOb2RlLnZhbHVlID0gYCR7dmFsdWVzWzFdfWA7XG4gICAgICAgICAgICBjb25zdCBwdFZhbHVlcyA9IFt2YWx1ZXNbMF0gKiAwLjc1LCB2YWx1ZXNbMV0gKiAwLjc1XTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlU2l6ZVJhbmdlVmFsdWVzQ2hhbmdlKHB0VmFsdWVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmFuZ2VTbGlkZXJOb2RlLm9uKFwic2VnbWVudC1kcmFnXCIsICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVzO1xuICAgICAgICAgICAgdGhpcy5taW5SYW5nZU5vZGUudmFsdWUgPSBgJHt2YWx1ZXNbMF19YDtcbiAgICAgICAgICAgIHRoaXMubWF4UmFuZ2VOb2RlLnZhbHVlID0gYCR7dmFsdWVzWzFdfWA7XG4gICAgICAgICAgICBjb25zdCBwdFZhbHVlcyA9IFt2YWx1ZXNbMF0gKiAwLjc1LCB2YWx1ZXNbMV0gKiAwLjc1XTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlU2l6ZVJhbmdlVmFsdWVzQ2hhbmdlKHB0VmFsdWVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmFuZ2VTbGlkZXJXYXRjaEhhbmRsZXMucHVzaChtYXBWaWV3LndhdGNoKFwic2NhbGVcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgbGV0IFtsb3dWYWx1ZSwgaGlnaFZhbHVlXSA9IGdldFJhbmdlVmFsdWVzKCk7XG4gICAgICAgICAgICBbbG93VmFsdWUsIGhpZ2hWYWx1ZV0gPSBbTWF0aC5yb3VuZChsb3dWYWx1ZSAvIDAuNzUpLCBNYXRoLnJvdW5kKGhpZ2hWYWx1ZSAvIDAuNzUpXTtcbiAgICAgICAgICAgIChfYSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0KHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtsb3dWYWx1ZSwgaGlnaFZhbHVlXSxcbiAgICAgICAgICAgICAgICBtaW46IE1hdGgubWF4KDEsIE1hdGgubWluKDEsIGxvd1ZhbHVlIC0gMTApKSxcbiAgICAgICAgICAgICAgICBtYXg6IE1hdGgubWluKGhpZ2hWYWx1ZSArIDEwLCAxMDApXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubWluUmFuZ2VOb2RlLnZhbHVlID0gdGhpcy5yYW5nZVNsaWRlck5vZGUudmFsdWVzWzBdLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB0aGlzLm1heFJhbmdlTm9kZS52YWx1ZSA9IHRoaXMucmFuZ2VTbGlkZXJOb2RlLnZhbHVlc1sxXS50b1N0cmluZygpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGhhbmRsZVNpemVSYW5nZUNoYW5nZSh0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBpZiAodHlwZSA9PT0gXCJmaXhlZFwiKSB7XG4gICAgICAgICAgICBsZXQgc3RvcHMgPSBzaXplVmlzVmFyLm1pblNpemUuc3RvcHM7XG4gICAgICAgICAgICBpZiAoIXN0b3BzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgW3NpemVWaXNWYXIubWluU2l6ZSwgc2l6ZVZpc1Zhci5tYXhTaXplXSA9IGdldFJhbmdlVmFsdWVzKCk7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgICAgIGxldCB1cGRhdGVDYWxsID0gY3JlYXRlU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJwcmVkb21pbmFuY2Utc2l6ZVwiKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZVByZWRvbWluYW5jZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIikge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDaGFydFJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoW1wic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplLWFnZVwiLCBcInR5cGUtc2l6ZS1hZ2VcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlU2l6ZUFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVxdWVzdFdyYXBwZXIodXBkYXRlQ2FsbCh7IHNpemVPcHRpbWl6YXRpb25FbmFibGVkOiB0cnVlIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlcyBrZWVwaW5nIHRoZSBcImFkanVzdCBzaXplIGF1dG9tYXRpY2FsbHlcIiBidXR0b24gdW5jaGVja2VkIHdoZW4gcmVuZGVyZXIgcmUtY3JlYXRpb24gb2NjdXJzXG4gICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RTaXplTm9kZS5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXJFcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXIuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdTaXplUmFuZ2VTbGlkZXJDc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1NpemVTbGlkZXJDc3MgPSBcIi5zbGlkZXItYm94e2hlaWdodDozMjBweH0uc2xpZGVyLWJveCAuZXNyaS1zaXplLXNsaWRlciwuc2xpZGVyLWJveCAuZXNyaS1jbGFzc2VkLXNpemUtc2xpZGVye21pbi13aWR0aDoyMDBweH0uc2xpZGVyLWJveCAuZXNyaS1zaXplLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19jb250ZW50LC5zbGlkZXItYm94IC5lc3JpLWNsYXNzZWQtc2l6ZS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fY29udGVudHtoZWlnaHQ6MTc1cHh9LnNsaWRlci1ib3ggLmVzcmktc2l6ZS1zbGlkZXJfX2hpc3RvZ3JhbS1jb250YWluZXIsLnNsaWRlci1ib3ggLmVzcmktY2xhc3NlZC1zaXplLXNsaWRlcl9faGlzdG9ncmFtLWNvbnRhaW5lcnt3aWR0aDo4NXB4fS5zbGlkZXItYm94IC5lc3JpLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX2xhYmVsLC5zbGlkZXItYm94IC5lc3JpLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbiwuc2xpZGVyLWJveCAuZXNyaS1zaXplLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19tYXgsLnNsaWRlci1ib3ggLmVzcmktY2xhc3NlZC1zaXplLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19sYWJlbCwuc2xpZGVyLWJveCAuZXNyaS1jbGFzc2VkLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbiwuc2xpZGVyLWJveCAuZXNyaS1jbGFzc2VkLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21heHt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lfS5zbGlkZXItYm94IC5lc3JpLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX2xhYmVsOmhvdmVyLC5zbGlkZXItYm94IC5lc3JpLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbjpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1zaXplLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19tYXg6aG92ZXIsLnNsaWRlci1ib3ggLmVzcmktY2xhc3NlZC1zaXplLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19sYWJlbDpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1jbGFzc2VkLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbjpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1jbGFzc2VkLXNpemUtc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21heDpob3Zlcntib3JkZXI6MXB4IHNvbGlkICNiYmI7YmFja2dyb3VuZC1jb2xvcjojZjNmM2YzO3RleHQtZGVjb3JhdGlvbjpub25lO3otaW5kZXg6MX0uc2xpZGVyLWJveC1idXR0b25zLWZyb250e2Rpc3BsYXk6ZmxleH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlckNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1NpemVTbGlkZXJFcnJvclwiLCA3KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5lY2Vzc2FyeSBmb3IgdHJhY2tpbmcgc3RvcHMgZm9yIG5vbi1jbGFzc2VkIHNsaWRlcnMsXG4gICAgICAgICAqIHdob3NlIHZhbHVlcyBhcmUgdXBkYXRlZCBpbW1lZGlhdGVseSBldmVuIGdpdmVuIGluY29ycmVjdCBpbnB1dHMuXG4gICAgICAgICAqIENsYXNzZWQgc2xpZGVycyBkbyBub3QgaGF2ZSB0aGlzIGlzc3VlLCBidXQgd2UgaGFuZGxlIHRoZW1cbiAgICAgICAgICogaWRlbnRpY2FsbHkgZm9yIGxvZ2ljYWwgcGFyaXR5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jdXJyZW50U3RvcFZhbHVlcyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRCcmVha1ZhbHVlcyA9IFtdO1xuICAgICAgICB0aGlzLnppZ3phZ0NsaWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibm90LWxvYWRlZFwiO1xuICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5NSVNTSU5HO1xuICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBDYWxsc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHVwZGF0ZVN0YXRpc3RpY3MoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IG51bGw7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtID0gbnVsbDtcbiAgICAgICAgKF9hID0gdGhpcy5zaXplU2xpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnNpemVTbGlkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZ2V0U3RhdGlzdGljcygpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5nZXRTdGF0aXN0aWNzKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuZmxvd0l0ZW1Ob2RlID0gZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNvbmZpZyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwibGlua1wiLCB7IHJlbDogXCJzdHlsZXNoZWV0XCIsIGhyZWY6IGAke2NvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzYCwgb25Mb2FkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID0gXCJsb2FkZWRcIjtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0sIG9uRXJyb3I6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlU2hlZXRTdGF0dXMgPSBcImZhaWxlZFwiO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSwgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID09PSBcImxvYWRlZFwiXG4gICAgICAgICAgICA/IHRoaXMucmVuZGVyU2l6ZVNsaWRlcigpXG4gICAgICAgICAgICA6IHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJub3QtbG9hZGVkXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMucmVuZGVyU2l6ZVNsaWRlckxvYWRpbmcoKVxuICAgICAgICAgICAgICAgIDogbnVsbCkpO1xuICAgIH1cbiAgICByZW5kZXJTaXplU2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3NTdGF0dXMsIGhpc3RvZ3JhbVN0YXR1cywgc2xpZGVyWm9vbWVkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgaWYgKHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5GQUlMRUQgfHxcbiAgICAgICAgICAgIHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5NSVNTSU5HIHx8XG4gICAgICAgICAgICAoc2l6ZVZpc1ZhciAmJiBzaXplVmlzVmFyLnN0b3BzICYmIHNpemVWaXNWYXIuc3RvcHMubGVuZ3RoID09PSAxKSB8fFxuICAgICAgICAgICAgKCFzaXplVmlzVmFyICYmIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGggPT09IDEpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zaXplU2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaXplU2xpZGVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNpemVTbGlkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3RhdGlzdGljc1N0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTIHx8XG4gICAgICAgICAgICAoaGlzdG9ncmFtU3RhdHVzID09PSBzdGF0dXMuSU5fUFJPR1JFU1MgJiYgIXRoaXMuc2l6ZVNsaWRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclNpemVTbGlkZXJMb2FkaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvayA9IHRoaXMucHJlcGFyZVNpemVTbGlkZXIoKTtcbiAgICAgICAgICAgIGxldCBkaXNhYmxlWm9vbUJ1dHRvbiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHNpemVWaXNWYXIgJiYgIXNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKFt7IHZhbHVlOiBzaXplVmlzVmFyLm1pbkRhdGFWYWx1ZSB9LCB7IHZhbHVlOiBzaXplVmlzVmFyLm1heERhdGFWYWx1ZSB9XSwgYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlLCBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICgoem9vbU9wdGlvbnMgPT09IG51bGwgfHwgem9vbU9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHpvb21PcHRpb25zLm1pbk1heFNhbWUpIHx8XG4gICAgICAgICAgICAgICAgICAgICghaXNEZWZpbmVkKHpvb21PcHRpb25zID09PSBudWxsIHx8IHpvb21PcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiB6b29tT3B0aW9ucy5taW4pICYmICFpc0RlZmluZWQoem9vbU9wdGlvbnMgPT09IG51bGwgfHwgem9vbU9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHpvb21PcHRpb25zLm1heCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVab29tQnV0dG9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuem9vbUJ1dHRvbk5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNpemVWaXNWYXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzID0gW3NpemVWaXNWYXIubWluRGF0YVZhbHVlLCBzaXplVmlzVmFyLm1heERhdGFWYWx1ZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRCcmVha1ZhbHVlcyA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5tYXAoKGNsYXNzQnJlYWtJbmZvKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBtaW46IGNsYXNzQnJlYWtJbmZvLm1pblZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBtYXg6IGNsYXNzQnJlYWtJbmZvLm1heFZhbHVlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9rIHx8IHRoaXMuc2l6ZVNsaWRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zaXplLmRhdGFSYW5nZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItYm94LWJ1dHRvbnMtZnJvbnRcIiB9LCB0aGlzLnJlbmRlckludmVydEJ1dHRvbigpLCBzaXplVmlzVmFyICYmIChoKEZyYWdtZW50LCBudWxsLCBoKFwiZGl2XCIsIG51bGwsIFwiXFx1MDBBMFwiKSwgdGhpcy5yZW5kZXJab29tQnV0dG9uKGRpc2FibGVab29tQnV0dG9uKSwgaChcImRpdlwiLCBudWxsLCBcIlxcdTAwQTBcIiksIHRoaXMucmVuZGVyUmVzZXRCdXR0b24oKSkpKSwgaChcImRpdlwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlclNpemVTbGlkZXJDcmVhdGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gfSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclNpemVTbGlkZXJMb2FkaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyU2l6ZVNsaWRlckxvYWRpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5sb2FkaW5nIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckludmVydEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5wYW5lbHMuc2l6ZS5pbnZlcnRTbGlkZXIsIGljb246IFwiYXJyb3dVcERvd25cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVJbnZlcnRTbGlkZXIoKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclpvb21CdXR0b24oZGlzYWJsZVpvb21CdXR0b24pIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgeyBzbGlkZXJab29tZWQgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWFjdGlvblwiLCB7IHRleHQ6IHN0cmluZ3MucGFuZWxzLnNpemUuem9vbVNsaWRlciwgaWNvbjogc2xpZGVyWm9vbWVkID8gXCJtYWduaWZ5aW5nR2xhc3NNaW51c1wiIDogXCJtYWduaWZ5aW5nR2xhc3NQbHVzXCIsIGRpc2FibGVkOiBkaXNhYmxlWm9vbUJ1dHRvbiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVab29tU2xpZGVyKCksIHJlZjogKG5vZGUpID0+ICh0aGlzLnpvb21CdXR0b25Ob2RlID0gbm9kZSkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJSZXNldEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5wYW5lbHMuc2l6ZS5yZXNldFNsaWRlciwgaWNvbjogXCJ1bmRvXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlUmVzZXRTbGlkZXIoKSB9KSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBwcmVwYXJlU2l6ZVNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCBoaXN0b2dyYW0sIGhpc3RvZ3JhbVN0YXR1cywgc2xpZGVyWm9vbWVkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBpc0FnZVJlbmRlcmVyID0gW1wic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplLWFnZVwiLCBcInR5cGUtc2l6ZS1hZ2VcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTE7XG4gICAgICAgIGNvbnN0IGluZm9zID0gcmVuZGVyZXIudHlwZSA9PT0gXCJjbGFzcy1icmVha3NcIiA/IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcyA6IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3M7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHRoaXMuZ2V0RmllbGRJbmZvKCk7XG4gICAgICAgIGNvbnN0IGlzRGF0ZUZpZWxkID0gZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGF1dGhTaXplVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBmaWxsQ29sb3IgPSBbXG4gICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgIF0uaW5kZXhPZihyZW5kZXJlclR5cGUpID09PSAtMVxuICAgICAgICAgICAgPyBnZXRTeW1ib2xDb2xvcihpbmZvc1tpbmZvcy5sZW5ndGggLSAxXS5zeW1ib2wpXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGxldCBtaW4sIG1heDtcbiAgICAgICAgaWYgKGF1dGhTaXplVmlzVmFyKSB7XG4gICAgICAgICAgICBtaW4gPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgICAgICBtYXggPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtaW4gPSBpbmZvc1swXS5taW5WYWx1ZTtcbiAgICAgICAgICAgIG1heCA9IGluZm9zW2luZm9zLmxlbmd0aCAtIDFdLm1heFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgICh7IG1pbiwgbWF4IH0gPSB2YWxpZGF0ZU1pbk1heCh7IG1pbiwgbWF4IH0pKTtcbiAgICAgICAgaWYgKGhpc3RvZ3JhbVN0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNpemVTbGlkZXIgfHxcbiAgICAgICAgICAgIChzaXplVmlzVmFyICYmIHRoaXMuc2l6ZVNsaWRlci5icmVha3MpIHx8XG4gICAgICAgICAgICAoIXNpemVWaXNWYXIgJiYgdGhpcy5zaXplU2xpZGVyLnN0b3BzKSkge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5zaXplU2xpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVzdHJveSgpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGhpc3RvZ3JhbUNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICBiaW5zOiBoaXN0b2dyYW0gPT09IG51bGwgfHwgaGlzdG9ncmFtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoaXN0b2dyYW0uYmlucyxcbiAgICAgICAgICAgICAgICAgICAgYXZlcmFnZTogTWF0aC5yb3VuZChzdGF0aXN0aWNzLmF2ZyAqIDEwKSAvIDEwLFxuICAgICAgICAgICAgICAgICAgICBzdGFuZGFyZERldmlhdGlvbjogc3RhdGlzdGljcy5zdGRkZXYsXG4gICAgICAgICAgICAgICAgICAgIHN0YW5kYXJkRGV2aWF0aW9uQ291bnQ6IDFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1pbjogbWluICE9PSBudWxsICYmIG1pbiAhPT0gdm9pZCAwID8gbWluIDogc3RhdGlzdGljcy5taW4sXG4gICAgICAgICAgICAgICAgbWF4OiBtYXggIT09IG51bGwgJiYgbWF4ICE9PSB2b2lkIDAgPyBtYXggOiBzdGF0aXN0aWNzLm1heCxcbiAgICAgICAgICAgICAgICBzdHlsZTogZmlsbENvbG9yXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tGaWxsQ29sb3I6IGZpbGxDb2xvciA/IGZpbGxDb2xvciA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGlmIChpc0RhdGVGaWVsZCAmJiAhaXNBZ2VSZW5kZXJlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuaGFzVGltZURhdGEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhZGREYXRlRm9ybWF0RnVuY3Rpb25zKGNvbmZpZywgbWFwVmlldy50aW1lWm9uZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbmZpZy5zdG9wcyA9IGdldFNpemVTbGlkZXJTdG9wcygpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5wcmVjaXNpb24gPSBnZXRTdG9wUHJlY2lzaW9uKGNvbmZpZy5zdG9wcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zaXplU2xpZGVyID0gbmV3IG1vZHVsZXMuU2l6ZVNsaWRlcihjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhpc3RvZ3JhbUNvbmZpZy5taW4gPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbMF0ubWluVmFsdWU7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhpc3RvZ3JhbUNvbmZpZy5tYXggPVxuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmxlbmd0aCAtIDFdLm1heFZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29uZmlnLmJyZWFrcyA9IGdldENsYXNzQnJlYWtzU2l6ZXMoKTtcbiAgICAgICAgICAgICAgICBjb25maWcucHJlY2lzaW9uID0gZ2V0U3RvcFByZWNpc2lvbihjb25maWcuYnJlYWtzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNpemVTbGlkZXIgPSBuZXcgbW9kdWxlcy5DbGFzc2VkU2l6ZVNsaWRlcihjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jcmVhdGVTaXplU2xpZGVyQ2hhbmdlRXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzbGlkZXIgPSB0aGlzLnNpemVTbGlkZXI7XG4gICAgICAgICAgICBpZiAoKChfYiA9IHNsaWRlci5zbGlkZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdGF0ZSkgPT09IFwiZHJhZ2dpbmdcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGhpc3RvZ3JhbUNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICBiaW5zOiBoaXN0b2dyYW0gPT09IG51bGwgfHwgaGlzdG9ncmFtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoaXN0b2dyYW0uYmlucyxcbiAgICAgICAgICAgICAgICAgICAgYXZlcmFnZTogTWF0aC5yb3VuZChzdGF0aXN0aWNzLmF2ZyAqIDEwKSAvIDEwLFxuICAgICAgICAgICAgICAgICAgICBzdGFuZGFyZERldmlhdGlvbjogc3RhdGlzdGljcy5zdGRkZXYsXG4gICAgICAgICAgICAgICAgICAgIHN0YW5kYXJkRGV2aWF0aW9uQ291bnQ6IDFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1pbjogbWluICE9PSBudWxsICYmIG1pbiAhPT0gdm9pZCAwID8gbWluIDogc3RhdGlzdGljcy5taW4sXG4gICAgICAgICAgICAgICAgbWF4OiBtYXggIT09IG51bGwgJiYgbWF4ICE9PSB2b2lkIDAgPyBtYXggOiBzdGF0aXN0aWNzLm1heCxcbiAgICAgICAgICAgICAgICBzdHlsZTogZmlsbENvbG9yXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tGaWxsQ29sb3I6IGZpbGxDb2xvciA/IGZpbGxDb2xvciA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5zdG9wcyA9IGdldFNpemVTbGlkZXJTdG9wcygpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5wcmVjaXNpb24gPSBnZXRTdG9wUHJlY2lzaW9uKGNvbmZpZy5zdG9wcyk7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhhc1RpbWVEYXRhID0gaXNEYXRlRmllbGQgJiYgIWlzQWdlUmVuZGVyZXI7XG4gICAgICAgICAgICAgICAgaWYgKGlzRGF0ZUZpZWxkICYmICFpc0FnZVJlbmRlcmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMoY29uZmlnLCBtYXBWaWV3LnRpbWVab25lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogY2xpY2tpbmcgYSB6aWd6YWcgYWxyZWFkeSB1cGRhdGVzIHRoZSBpbnRlcm5hbCBzbGlkZXIgem9vbU9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgICAqIHNldHRpbmcgdGhlbSBoZXJlIGFnYWluIHdvdWxkIGluY29ycmVjdGx5IG92ZXJyaWRlIGEgdXNlcidzIGRlY2lzaW9uXG4gICAgICAgICAgICAgICAgICAgICAqIHRvIG1hbnVhbGx5IHpvb20gb3V0IG9uZSBzaWRlIG9mIHRoZSBzbGlkZXIuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuemlnemFnQ2xpY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKFt7IHZhbHVlOiBzaXplVmlzVmFyLm1pbkRhdGFWYWx1ZSB9LCB7IHZhbHVlOiBzaXplVmlzVmFyLm1heERhdGFWYWx1ZSB9XSwgYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlLCBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuem9vbU9wdGlvbnMgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5icmVha3MgPSBnZXRDbGFzc0JyZWFrc1NpemVzKCk7XG4gICAgICAgICAgICAgICAgY29uZmlnLnByZWNpc2lvbiA9IGdldFN0b3BQcmVjaXNpb24oY29uZmlnLmJyZWFrcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQgJiYgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zICYmICF0aGlzLnppZ3phZ0NsaWNrKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zID0gdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zO1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGhhbmRsZXMgZWRnZSBjYXNlcyB3aGVyZSB0aGUgc2xpZGVyIGlzIHpvb21lZCwgaGFuZGxlcyBoYXZlIGJlZW4gbWFudWFsbHkgbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICogYW5kIGEgdXNlciBleGVjdXRlcyBhIGxhYmVsIGNoYW5nZS4gVGhpcyBwcmV2ZW50cyB6b29tIG9wdGlvbnMgZnJvbSBjaGFuZ2luZyBhbmQgcHJlc2VydmVzXG4gICAgICAgICAgICAgICAgICogdGhlIGhpc3RvZ3JhbSBkaXNwbGF5LlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnpvb21BZGp1c3RtZW50ID09PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZVNsaWRlci5zbGlkZXIubWluID0gY29uZmlnLnpvb21PcHRpb25zLm1pbjtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zLm1pbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNpemVTbGlkZXIuc2xpZGVyLm1heCA9IGNvbmZpZy56b29tT3B0aW9ucy5tYXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucy5tYXggPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnpvb21BZGp1c3RtZW50ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuc2l6ZVNsaWRlci5zZXQoY29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuemlnemFnQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNEZWZpbmVkKHRoaXMuc2l6ZVNsaWRlcik7XG4gICAgfVxuICAgIGhhbmRsZUludmVydFNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmIChzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICBbc2l6ZVZpc1Zhci5taW5TaXplLCBzaXplVmlzVmFyLm1heFNpemVdID0gW3NpemVWaXNWYXIubWF4U2l6ZSwgc2l6ZVZpc1Zhci5taW5TaXplXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNpemVzID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLm1hcCgoaW5mbykgPT4gZ2V0U3ltYm9sU2l6ZShpbmZvLnN5bWJvbCkpO1xuICAgICAgICAgICAgc2l6ZXMucmV2ZXJzZSgpO1xuICAgICAgICAgICAgcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmZvckVhY2goKGluZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN5bSA9IGluZm8uc3ltYm9sO1xuICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sU2l6ZShzeW0sIHNpemVzW2lkeF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyQ2hhbmdlLmVtaXQoKTtcbiAgICB9XG4gICAgaGFuZGxlWm9vbVNsaWRlcih6b29tZWQpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICBpZiAodGhpcy5oaXN0b2dyYW1TdGF0dXMgPT09IHN0YXR1cy5JTl9QUk9HUkVTUykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGlzRGVmaW5lZCh6b29tZWQpID8gem9vbWVkIDogIXRoaXMuc2xpZGVyWm9vbWVkO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmICghc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub3JtYWxpemF0aW9uRmllbGQgPSBzaXplVmlzVmFyXG4gICAgICAgICAgICA/IHNpemVWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkXG4gICAgICAgICAgICA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZDtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHpvb21PcHRpb25zID0gdGhpcy5zbGlkZXJab29tZWRcbiAgICAgICAgICAgID8gZ2V0Wm9vbU9wdGlvbnMoW3sgdmFsdWU6IHNpemVWaXNWYXIubWluRGF0YVZhbHVlIH0sIHsgdmFsdWU6IHNpemVWaXNWYXIubWF4RGF0YVZhbHVlIH1dLCAoX2EgPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHN0YXRpc3RpY3MubWluLCAoX2IgPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHN0YXRpc3RpY3MubWF4KVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgc3RhdGlzdGljcywgKHpvb21PcHRpb25zICYmIHpvb21PcHRpb25zLm1pbikgfHwgKChfYyA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogc3RhdGlzdGljcy5taW4pLCAoem9vbU9wdGlvbnMgJiYgem9vbU9wdGlvbnMubWF4KSB8fCAoKF9kID0gYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBzdGF0aXN0aWNzLm1heCkpO1xuICAgIH1cbiAgICBoYW5kbGVSZXNldFNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHRoZW1lID0gYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLnRoZW1lO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmdldEZpZWxkSW5mbygpO1xuICAgICAgICBjb25zdCBub3JtYWxpemF0aW9uRmllbGQgPSBzaXplVmlzVmFyXG4gICAgICAgICAgICA/IHNpemVWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkXG4gICAgICAgICAgICA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZDtcbiAgICAgICAgbGV0IHVwZGF0ZUNhbGw7XG4gICAgICAgIGlmIChbXCJzaXplXCIsIFwicHJlZG9taW5hbmNlLXNpemVcIiwgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiLCBcImNoYXJ0LXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVTaXplUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcInNpemUtYWdlXCIpIHtcbiAgICAgICAgICAgIGZpZWxkSW5mby5maWVsZCA9IGF1dGhTaXplVmlzVmFyLmZpZWxkO1xuICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZVNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3Itc2l6ZS1hZ2VcIikge1xuICAgICAgICAgICAgZmllbGRJbmZvLmZpZWxkID0gYXV0aFNpemVWaXNWYXIuZmllbGQ7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlQ29sb3JTaXplQWdlUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yLWFnZS1zaXplXCIpIHtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDb2xvckFnZVNpemVSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3Itc2l6ZVwiKSB7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlQ29sb3JTaXplUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcInR5cGUtc2l6ZVwiKSB7XG4gICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlVHlwZVNpemVSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwidHlwZS1zaXplLWFnZVwiKSB7XG4gICAgICAgICAgICBmaWVsZEluZm8uZmllbGQgPSBhdXRoU2l6ZVZpc1Zhci5maWVsZDtcbiAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVUeXBlU2l6ZUFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RXcmFwcGVyKHVwZGF0ZUNhbGwoe1xuICAgICAgICAgICAgZmllbGRJbmZvczogZ2V0UmVuZGVyZXJGaWVsZEluZm9zKGxheWVyKSxcbiAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZDogbm9ybWFsaXphdGlvbkZpZWxkLFxuICAgICAgICAgICAgc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQ6IHR5cGVvZiBzaXplVmlzVmFyLm1pblNpemUgPT09IFwib2JqZWN0XCIsXG4gICAgICAgICAgICBub1JldXNlOiB0cnVlLFxuICAgICAgICAgICAgdGhlbWUsXG4gICAgICAgICAgICBkaXNjYXJkTWluTWF4OiB0cnVlXG4gICAgICAgIH0sIFwic2l6ZVwiKSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSByZXN1bHQuc3RhdGlzdGljcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvdW50KSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IFtkZWZhdWx0TWluLCBkZWZhdWx0TWF4XSA9IHRoaXMuZ2V0RGVmYXVsdERhdGFSYW5nZShmaWVsZEluZm8pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IChhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpIHx8IGRlZmF1bHRNaW47XG4gICAgICAgICAgICAgICAgY29uc3QgbWF4ID0gKGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgfHwgZGVmYXVsdE1heDtcbiAgICAgICAgICAgICAgICByZXN1bHQuc3RhdGlzdGljcy5taW4gPSBtaW47XG4gICAgICAgICAgICAgICAgcmVzdWx0LnN0YXRpc3RpY3MubWF4ID0gbWF4O1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0aXN0aWNzLmF2ZyA9IChtYXggKyBtaW4pIC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSByZXN1bHQuc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5zdGF0aXN0aWNzICYmXG4gICAgICAgICAgICAgICAgaXNEZWZpbmVkKHJlc3VsdC5zdGF0aXN0aWNzLm1pbikgJiZcbiAgICAgICAgICAgICAgICBpc0RlZmluZWQocmVzdWx0LnN0YXRpc3RpY3MubWF4KSAmJlxuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiA8PSByZXN1bHQuc3RhdGlzdGljcy5tYXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSByZXN1bHQuc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgcmVzdWx0LnN0YXRpc3RpY3MsIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiwgcmVzdWx0LnN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSA9IHRoaXMuc3RhdGlzdGljcy5taW47XG4gICAgICAgICAgICBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSA9IHRoaXMuc3RhdGlzdGljcy5tYXg7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlckVycm9yLmVtaXQoZXJyb3IpKTtcbiAgICB9XG4gICAgYWZ0ZXJTaXplU2xpZGVyQ3JlYXRlKG5vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNpemVTbGlkZXIuY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIG5vZGUuYXBwZW5kKGRpdk5vZGUpO1xuICAgICAgICAgICAgdGhpcy5zaXplU2xpZGVyLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0U3RhdGlzdGljcygpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGZvbGxvd2luZzpcbiAgICAgICAgICogIDEuKSBSZXRyaWV2aW5nIHN0YXRpc3RpY3Mgb24gc2xpZGVyIGxvYWRcbiAgICAgICAgICogIDIuKSBSZXRyaWV2aW5nIHVwZGF0ZWQgc3RhdGlzdGljcyBhZnRlciBjaGFuZ2luZyBhZ2UsIG5vcm1hbGl6YXRpb24gZmllbGQsIHRoZW1lLCBvciBjbGFzc2lmeSBtZXRob2QvbnVtYmVyIG9mIGNsYXNzZXNcbiAgICAgICAgICovXG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGxldCBtaW47XG4gICAgICAgIGxldCBtYXg7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gc2l6ZVZpc1ZhclxuICAgICAgICAgICAgPyBzaXplVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGNvbnN0IGF1dGhTaXplVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBtaW4gPSBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgIG1heCA9IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZTtcbiAgICAgICAgLy8gaGFuZGxlcyBlcXVhbCBpbnRlcnZhbCBiZWhhdmlvclxuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGlmICgoYXV0aEluZm8gPT09IG51bGwgfHwgYXV0aEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kKSA9PT0gXCJlcXVhbC1pbnRlcnZhbFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjbGFzc0JyZWFrcyA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcztcbiAgICAgICAgICAgIG1pbiA9IGNsYXNzQnJlYWtzWzBdLm1pblZhbHVlO1xuICAgICAgICAgICAgbWF4ID0gY2xhc3NCcmVha3NbY2xhc3NCcmVha3MubGVuZ3RoIC0gMV0ubWF4VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLklOX1BST0dSRVNTO1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGlzdGljcykge1xuICAgICAgICAgICAgbW9kdWxlc1xuICAgICAgICAgICAgICAgIC5zdW1tYXJ5U3RhdGlzdGljcyh7XG4gICAgICAgICAgICAgICAgbGF5ZXIsXG4gICAgICAgICAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRJbmZvLmZpZWxkLFxuICAgICAgICAgICAgICAgIHZhbHVlRXhwcmVzc2lvbjogZmllbGRJbmZvLmV4cHJlc3Npb24sXG4gICAgICAgICAgICAgICAgbm9ybWFsaXphdGlvbkZpZWxkLFxuICAgICAgICAgICAgICAgIGZvckJpbm5pbmc6IFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKChzdGF0aXN0aWNzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRpc3RpY3MuY291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmllbGQgaGFzIG5vIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHVwIHNvbWUgYmFzaWMgc3RhdGlzdGljcyBzbyB3ZSBjYW4gc2hvdyBhIHNsaWRlclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBbZGVmYXVsdE1pbiwgZGVmYXVsdE1heF0gPSB0aGlzLmdldERlZmF1bHREYXRhUmFuZ2UoZmllbGRJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluID0gKGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgfHwgZGVmYXVsdE1pbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4ID0gKGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgfHwgZGVmYXVsdE1heDtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGlzdGljcy5taW4gPSBtaW47XG4gICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MubWF4ID0gbWF4O1xuICAgICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzLmF2ZyA9IChtYXggKyBtaW4pIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0RlZmluZWQoYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSA9IG1pbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlID0gbWF4O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpc0RlZmluZWQoc3RhdGlzdGljcy5hdmcpIHx8XG4gICAgICAgICAgICAgICAgICAgICFpc0RlZmluZWQoc3RhdGlzdGljcy5taW4pIHx8XG4gICAgICAgICAgICAgICAgICAgICFpc0RlZmluZWQoc3RhdGlzdGljcy5tYXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0YXRpc3RpY3MgdW51c2FibGVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0aXN0aWNzID0gdmFsaWRhdGVNaW5NYXgoc3RhdGlzdGljcyk7XG4gICAgICAgICAgICAgICAgbWluID0gbWluICE9PSBudWxsICYmIG1pbiAhPT0gdm9pZCAwID8gbWluIDogc3RhdGlzdGljcy5taW47XG4gICAgICAgICAgICAgICAgbWF4ID0gbWF4ICE9PSBudWxsICYmIG1heCAhPT0gdm9pZCAwID8gbWF4IDogc3RhdGlzdGljcy5tYXg7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0gc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgc3RhdGlzdGljcywgbWluLCBtYXgpO1xuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRIaXN0b2dyYW0oZmllbGRJbmZvLCBub3JtYWxpemF0aW9uRmllbGQsIHN0YXRpc3RpY3MsIG1pbiwgbWF4KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgc3RhdGlzdGljcyA9IHN0YXRpc3RpY3MgfHwgdGhpcy5zdGF0aXN0aWNzO1xuICAgICAgICBpZiAoIXN0YXRpc3RpY3MgfHwgc3RhdGlzdGljcy5jb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLklOX1BST0dSRVNTO1xuICAgICAgICBtb2R1bGVzXG4gICAgICAgICAgICAuaGlzdG9ncmFtKHtcbiAgICAgICAgICAgIGxheWVyOiBsYXllcixcbiAgICAgICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgICAgICBmaWVsZDogZmllbGRJbmZvLmZpZWxkLFxuICAgICAgICAgICAgdmFsdWVFeHByZXNzaW9uOiBmaWVsZEluZm8uZXhwcmVzc2lvbixcbiAgICAgICAgICAgIG51bUJpbnM6IDUwLFxuICAgICAgICAgICAgbWluVmFsdWU6IGlzRGVmaW5lZChtaW4pID8gbWluIDogc3RhdGlzdGljcy5taW4sXG4gICAgICAgICAgICBtYXhWYWx1ZTogaXNEZWZpbmVkKG1heCkgPyBtYXggOiBzdGF0aXN0aWNzLm1heCxcbiAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZCxcbiAgICAgICAgICAgIGZvckJpbm5pbmc6IFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbigoaGlzdG9ncmFtKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhpc3RvZ3JhbSA9IGhpc3RvZ3JhbTtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLlNVQ0NFU1M7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9uTWluTWF4Q2hhbmdlKG1pbiwgbWF4LCBjaGFuZ2luZykge1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKSB8fCB7fTtcbiAgICAgICAgaWYgKCFzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICBsZXQgbWluQ2xhc3NCcmVhayA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXTtcbiAgICAgICAgICAgIGxldCBtYXhDbGFzc0JyZWFrID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zW3JlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIG1pbkNsYXNzQnJlYWsubWluVmFsdWUgPSBtaW47XG4gICAgICAgICAgICBtaW5DbGFzc0JyZWFrLmxhYmVsID0gYCR7bWluQ2xhc3NCcmVhay5taW5WYWx1ZS50b0xvY2FsZVN0cmluZyh7XG4gICAgICAgICAgICAgICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiAxNVxuICAgICAgICAgICAgfSl9IC0gJHttaW5DbGFzc0JyZWFrLm1heFZhbHVlLnRvTG9jYWxlU3RyaW5nKHsgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiAxNSB9KX1gO1xuICAgICAgICAgICAgbWF4Q2xhc3NCcmVhay5tYXhWYWx1ZSA9IG1heDtcbiAgICAgICAgICAgIG1heENsYXNzQnJlYWsubGFiZWwgPSBgJHttYXhDbGFzc0JyZWFrLm1pblZhbHVlLnRvTG9jYWxlU3RyaW5nKHtcbiAgICAgICAgICAgICAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IDE1XG4gICAgICAgICAgICB9KX0gLSAke21heENsYXNzQnJlYWsubWF4VmFsdWUudG9Mb2NhbGVTdHJpbmcoeyBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IDE1IH0pfWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXBkYXRlIG9ubHkgdGhlIGxhYmVsIHRoYXQgdGhlIHVzZXIgaXMgY2hhbmdpbmdcbiAgICAgICAgY2hhbmdpbmcgPT09IFwibWluXCJcbiAgICAgICAgICAgID8gKGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlID0gbWluKVxuICAgICAgICAgICAgOiAoYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSBtYXgpO1xuICAgICAgICAvLyBkZXRlcm1pbmUgaWYgbGFiZWwgdXBkYXRlcyBtZXJpdCB6b29taW5nIG9yIG5vdFxuICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKFt7IHZhbHVlOiBzaXplVmlzVmFyID09PSBudWxsIHx8IHNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpemVWaXNWYXIubWluRGF0YVZhbHVlIH0sIHsgdmFsdWU6IHNpemVWaXNWYXIgPT09IG51bGwgfHwgc2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2l6ZVZpc1Zhci5tYXhEYXRhVmFsdWUgfV0sIGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci5taW5TbGlkZXJWYWx1ZSwgYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgLy8gaGFuZGxlcyB6b29tIGJ1dHRvbiBkaXNwbGF5IGZvciBub24tY2xhc3NlZCBjb2xvciBzbGlkZXJzXG4gICAgICAgIGlmICh0aGlzLnpvb21CdXR0b25Ob2RlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghem9vbU9wdGlvbnMgfHxcbiAgICAgICAgICAgICAgICB6b29tT3B0aW9ucy5taW5NYXhTYW1lIHx8XG4gICAgICAgICAgICAgICAgKCFpc0RlZmluZWQoem9vbU9wdGlvbnMubWluKSAmJiAhaXNEZWZpbmVkKHpvb21PcHRpb25zLm1heCkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gem9vbSBhZGp1c3RtZW50XG4gICAgICAgIGlmICh0aGlzLnNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zID0gdGhpcy5zaXplU2xpZGVyLnpvb21PcHRpb25zO1xuICAgICAgICAgICAgaWYgKGNoYW5naW5nID09PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zLm1pbiA9IG1pbjtcbiAgICAgICAgICAgICAgICB0aGlzLnpvb21BZGp1c3RtZW50ID0gXCJtaW5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucy5tYXggPSBtYXg7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQWRqdXN0bWVudCA9IFwibWF4XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gc2l6ZVZpc1ZhclxuICAgICAgICAgICAgPyBzaXplVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCk7XG4gICAgICAgIGlmIChtaW4gPT09IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlICYmIG1heCA9PT0gYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlckNoYW5nZS5lbWl0KCk7XG4gICAgfVxuICAgIGNyZWF0ZVNpemVTbGlkZXJDaGFuZ2VFdmVudHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmdldEZpZWxkSW5mbygpO1xuICAgICAgICBjb25zdCBpc0RhdGVGaWVsZCA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgaWYgKCF0aGlzLnNpemVTbGlkZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBoYW5kbGVzIHppZ3phZyBjbGlja1xuICAgICAgICB0aGlzLnNpemVTbGlkZXIud2F0Y2goXCJ6b29tT3B0aW9uc1wiLCAobmV3VmFsdWUsIG9sZFZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQgJiZcbiAgICAgICAgICAgICAgICAoKChvbGRWYWx1ZSA9PT0gbnVsbCB8fCBvbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2xkVmFsdWUubWluKSAmJiAhKG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5taW4pKSB8fCAoKG9sZFZhbHVlID09PSBudWxsIHx8IG9sZFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvbGRWYWx1ZS5tYXgpICYmICEobmV3VmFsdWUgPT09IG51bGwgfHwgbmV3VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5ld1ZhbHVlLm1heCkpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuemlnemFnQ2xpY2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlWmlnemFnQ2xpY2sobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zaXplU2xpZGVyLm9uKFwibWluLWNoYW5nZVwiLCAoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKHNpemVWaXNWYXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby52YWx1ZSA+IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplU2xpZGVyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UodGhpcy5jdXJyZW50U3RvcFZhbHVlc1swXSwgdGhpcy5zaXplU2xpZGVyLnNsaWRlci5tYXgsIFwibWluXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZShpbmZvLnZhbHVlLCB0aGlzLnNpemVTbGlkZXIuc2xpZGVyLm1heCwgXCJtaW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPiB0aGlzLmN1cnJlbnRCcmVha1ZhbHVlc1swXS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLmN1cnJlbnRCcmVha1ZhbHVlc1swXS5tYXgsIHRoaXMuc2l6ZVNsaWRlci5zbGlkZXIubWF4LCBcIm1pblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UoaW5mby52YWx1ZSwgdGhpcy5zaXplU2xpZGVyLnNsaWRlci5tYXgsIFwibWluXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2l6ZVNsaWRlci5vbihcIm1heC1jaGFuZ2VcIiwgKGluZm8pID0+IHtcbiAgICAgICAgICAgIGlmIChzaXplVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPCB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzW3RoaXMuY3VycmVudFN0b3BWYWx1ZXMubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXplU2xpZGVyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UodGhpcy5zaXplU2xpZGVyLnNsaWRlci5taW4sIHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbdGhpcy5jdXJyZW50U3RvcFZhbHVlcy5sZW5ndGggLSAxXSwgXCJtYXhcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTWluTWF4Q2hhbmdlKHRoaXMuc2l6ZVNsaWRlci5zbGlkZXIubWluLCBpbmZvLnZhbHVlLCBcIm1heFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby52YWx1ZSA8IHRoaXMuY3VycmVudEJyZWFrVmFsdWVzW3RoaXMuY3VycmVudEJyZWFrVmFsdWVzLmxlbmd0aCAtIDFdLm1pbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTWluTWF4Q2hhbmdlKHRoaXMuc2l6ZVNsaWRlci5zbGlkZXIubWluLCB0aGlzLmN1cnJlbnRCcmVha1ZhbHVlc1t0aGlzLmN1cnJlbnRCcmVha1ZhbHVlcy5sZW5ndGggLSAxXS5taW4sIFwibWF4XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLnNpemVTbGlkZXIuc2xpZGVyLm1pbiwgaW5mby52YWx1ZSwgXCJtYXhcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zaXplU2xpZGVyLm9uKFwidGh1bWItY2hhbmdlXCIsIChpbmZvKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNsaWRlciA9IHRoaXMuc2l6ZVNsaWRlcjtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9wcyA9IHNsaWRlci5zdG9wcztcbiAgICAgICAgICAgICAgICBpZiAoaXNEYXRlRmllbGQgJiYgIWlzQWdlUmVuZGVyZXIgJiYgaW5mby52YWx1ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSZW5kZXJlckJyZWFrcyh0aGlzLnNpemVTbGlkZXIuYnJlYWtzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2l6ZVNsaWRlci5vbihcInRodW1iLWRyYWdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHNpemVWaXNWYXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9wcyA9IHRoaXMuc2l6ZVNsaWRlci5zdG9wcztcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSZW5kZXJlckJyZWFrcyh0aGlzLnNpemVTbGlkZXIuYnJlYWtzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2l6ZVNsaWRlci5vbihcInNlZ21lbnQtZHJhZ1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgICAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNsaWRlciA9IHRoaXMuc2l6ZVNsaWRlcjtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9wcyA9IHNsaWRlci5zdG9wcztcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdXBkYXRlUmVuZGVyZXJTdG9wcyhzdG9wcykge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmIChzaXplVmlzVmFyLnN0b3BzKSB7XG4gICAgICAgICAgICAvLyBUT0RPIEpTQVBJIGJ1ZyAjMjE4OTZcbiAgICAgICAgICAgIGlmIChzdG9wcy5sZW5ndGggPT09IDUpIHtcbiAgICAgICAgICAgICAgICBzdG9wc1swXS5sYWJlbCA9IGA8ICR7c3RvcHNbMF0udmFsdWV9YDtcbiAgICAgICAgICAgICAgICBzdG9wc1sxXS5sYWJlbCA9IGAke3N0b3BzWzFdLnZhbHVlfWA7XG4gICAgICAgICAgICAgICAgc3RvcHNbMl0ubGFiZWwgPSBgJHtzdG9wc1syXS52YWx1ZX1gO1xuICAgICAgICAgICAgICAgIHN0b3BzWzNdLmxhYmVsID0gYCR7c3RvcHNbM10udmFsdWV9YDtcbiAgICAgICAgICAgICAgICBzdG9wc1s0XS5sYWJlbCA9IGA+ICR7c3RvcHNbNF0udmFsdWV9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNpemVWaXNWYXIuc3RvcHMgPSBzdG9wcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNpemVWaXNWYXIubWluRGF0YVZhbHVlID0gc3RvcHNbMF0udmFsdWU7XG4gICAgICAgICAgICBzaXplVmlzVmFyLm1heERhdGFWYWx1ZSA9IHN0b3BzWzFdLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3VycmVudFN0b3BWYWx1ZXMgPSBzdG9wcy5tYXAoKHN0b3ApID0+IHN0b3AudmFsdWUpO1xuICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKFt7IHZhbHVlOiBzaXplVmlzVmFyLm1pbkRhdGFWYWx1ZSB9LCB7IHZhbHVlOiBzaXplVmlzVmFyLm1heERhdGFWYWx1ZSB9XSwgYXV0aFNpemVWaXNWYXIgPT09IG51bGwgfHwgYXV0aFNpemVWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlLCBhdXRoU2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoU2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghem9vbU9wdGlvbnMgfHxcbiAgICAgICAgICAgIHpvb21PcHRpb25zLm1pbk1heFNhbWUgfHxcbiAgICAgICAgICAgICghaXNEZWZpbmVkKHpvb21PcHRpb25zLm1pbikgJiYgIWlzRGVmaW5lZCh6b29tT3B0aW9ucy5tYXgpKSkge1xuICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgdXBkYXRlUmVuZGVyZXJCcmVha3MoYnJlYWtzKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5mb3JFYWNoKChjbGFzc0JyZWFrSW5mbywgaWR4KSA9PiB7XG4gICAgICAgICAgICBpZiAoY2xhc3NCcmVha0luZm8ubWluVmFsdWUgIT09IGJyZWFrc1tpZHhdLm1pbiB8fFxuICAgICAgICAgICAgICAgIGNsYXNzQnJlYWtJbmZvLm1heFZhbHVlICE9PSBicmVha3NbaWR4XS5tYXgpIHtcbiAgICAgICAgICAgICAgICBjbGFzc0JyZWFrSW5mby5taW5WYWx1ZSA9IGJyZWFrc1tpZHhdLm1pbjtcbiAgICAgICAgICAgICAgICBjbGFzc0JyZWFrSW5mby5tYXhWYWx1ZSA9IGJyZWFrc1tpZHhdLm1heDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSBpZHggPiAwID8gXCI+IFwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjbGFzc0JyZWFrSW5mby5sYWJlbCA9IGAke3ByZWZpeH0gJHtjbGFzc0JyZWFrSW5mby5taW5WYWx1ZS50b0xvY2FsZVN0cmluZygpfSAtICR7Y2xhc3NCcmVha0luZm8ubWF4VmFsdWUudG9Mb2NhbGVTdHJpbmcoKX1gO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEJyZWFrVmFsdWVzW2lkeF0ubWluID0gYnJlYWtzW2lkeF0ubWluO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEJyZWFrVmFsdWVzW2lkeF0ubWF4ID0gYnJlYWtzW2lkeF0ubWF4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyQ2hhbmdlLmVtaXQoKTtcbiAgICB9XG4gICAgZ2V0RGVmYXVsdERhdGFSYW5nZShmaWVsZEluZm8pIHtcbiAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSkge1xuICAgICAgICAgICAgY29uc3QgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIHJldHVybiBbbmV3IERhdGUoYDEvMS8ke3llYXJ9YCkuZ2V0VGltZSgpLCBuZXcgRGF0ZShgMTIvMzEvJHt5ZWFyfWApLmdldFRpbWUoKV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gWzAsIDEwMF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RmllbGRJbmZvKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mb3MgPSBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBbXCJjb2xvci1zaXplXCIsIFwiY29sb3ItYWdlLXNpemVcIiwgXCJjb2xvci1zaXplLWFnZVwiLCBcInR5cGUtc2l6ZVwiLCBcInR5cGUtc2l6ZS1hZ2VcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEgJiYgZmllbGRJbmZvcy5sZW5ndGggPiAxXG4gICAgICAgICAgICA/IGZpZWxkSW5mb3NbMV1cbiAgICAgICAgICAgIDogcmVuZGVyZXJUeXBlID09PSBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgICAgICA/IGZpZWxkSW5mb3NbMl1cbiAgICAgICAgICAgICAgICA6IGZpZWxkSW5mb3NbMF07XG4gICAgICAgIGZpZWxkSW5mby5leHByZXNzaW9uID0gKF9hID0gc2l6ZVZpc1ZhciA9PT0gbnVsbCB8fCBzaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaXplVmlzVmFyLnZhbHVlRXhwcmVzc2lvbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbDtcbiAgICAgICAgZmllbGRJbmZvLmV4cHJlc3Npb25UaXRsZSA9IChfYiA9IHNpemVWaXNWYXIgPT09IG51bGwgfHwgc2l6ZVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2l6ZVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIGZpZWxkSW5mbztcbiAgICB9XG4gICAgaGFuZGxlWmlnemFnQ2xpY2sobmV3VmFsdWUpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgY29uc3QgYXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHRoaXMuZ2V0RmllbGRJbmZvKCk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IHNpemVWaXNWYXJcbiAgICAgICAgICAgID8gc2l6ZVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgICAgIDogcmVuZGVyZXIubm9ybWFsaXphdGlvbkZpZWxkO1xuICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgc3RhdGlzdGljcywgKF9hID0gbmV3VmFsdWUgPT09IG51bGwgfHwgbmV3VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5ld1ZhbHVlLm1pbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWUsIChfYiA9IG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5tYXgpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGF1dGhTaXplVmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgaWYgKCFuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVNsaWRlci5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1NpemVTbGlkZXJDc3M7XG5cbmZ1bmN0aW9uIGdldFRpbGVJbmZvKHR5cGUsIHRpbGVUeXBlKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXIsIHNlbGVjdGVkRmllbGRzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBsZXQgc3R5bGVUaWxlVHlwZSA9IGlzUmFzdGVyTGF5ZXIobGF5ZXIpID8gXCJyYXN0ZXJcIiA6IGdldEdlb21ldHJ5VHlwZShsYXllcik7XG4gICAgaWYgKHN0eWxlVGlsZVR5cGUgPT09IFwibXVsdGlwb2ludFwiKSB7XG4gICAgICAgIHN0eWxlVGlsZVR5cGUgPSBcInBvaW50XCI7XG4gICAgfVxuICAgIGxldCBmaWVsZENvdW50ID0gc2VsZWN0ZWRGaWVsZHMubGVuZ3RoO1xuICAgIGlmICghaXNEZWZpbmVkKGZpZWxkQ291bnQpKSB7XG4gICAgICAgIC8vIHRoZSB0aWxlcyBmb3IgY29tYmluYXRpb24gcmVuZGVyZXJzXG4gICAgICAgIGZpZWxkQ291bnQgPSAxO1xuICAgIH1cbiAgICBjb25zdCByZW5kZXJlclR5cGUgPSBpc1Jhc3RlckxheWVyKGxheWVyKSA/IGdldFJhc3RlclJlbmRlcmVyVHlwZSgpIDogZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgbGV0IGlzRmlyc3RGaWVsZERhdGUgPSBmYWxzZTtcbiAgICBsZXQgaXNTZWNvbmRGaWVsZERhdGUgPSBmYWxzZTtcbiAgICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoKSB7XG4gICAgICAgIGlzRmlyc3RGaWVsZERhdGUgPVxuICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHNbMF0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgfHxcbiAgICAgICAgICAgICAgICAoKF9hID0gZ2V0RmllbGQoc2VsZWN0ZWRGaWVsZHNbMF0uZmllbGQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGF5ZXJGaWVsZCkudHlwZSA9PT0gXCJkYXRlLW9ubHlcIjtcbiAgICAgICAgaXNTZWNvbmRGaWVsZERhdGUgPSBpc0ZpcnN0RmllbGREYXRlO1xuICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgaXNTZWNvbmRGaWVsZERhdGUgPSBzZWxlY3RlZEZpZWxkc1sxXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKlxuICAgIGNvbG9yQWdlLHNpemVBZ2UsdHlwZV9TaXplQWdlXG4gICAgY29sb3JfU2l6ZUFnZSxjb2xvckRhdGVfU2l6ZUFnZSxjb2xvckFnZV9TaXplLGNvbG9yQWdlX1NpemVEYXRlXG4gICAgaGVhdE1hcFxuICAgICovXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgXCJzaW1wbGVcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5zaW1wbGVTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnNpbXBsZVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5sb2NhdGlvbixcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzNjc1XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9TaW1wbGUucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImNvbG9yXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBpc0ZpcnN0RmllbGREYXRlID8gc3RyaW5ncy50aWxlLmNvbG9yU3R5bGVEYXRlIDogc3RyaW5ncy50aWxlLmNvbG9yU3R5bGUsXG4gICAgICAgICAgICAgICAgc3ViVGV4dDogdGlsZVR5cGUgIT09IFwiZ2FsbGVyeVwiID8gc2VsZWN0ZWRGaWVsZHNbMF0uZXhwcmVzc2lvblRpdGxlIHx8IGdldEZpZWxkKHNlbGVjdGVkRmllbGRzWzBdLmZpZWxkKS5sYWJlbCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5jb2xvclRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IGlzRmlyc3RGaWVsZERhdGUgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMuY29sb3JEYXRlIDogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNvbG9yLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogaXNGaXJzdEZpZWxkRGF0ZSA/IFwiMTIwMDAzMjYyXCIgOiBcIjEyMDAwMzI1MVwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vQ29sb3IucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInNpemVcIjpcbiAgICAgICAgICAgIC8vIGZvciBjb2xvci1zaXplIHRoZSBzaXplIHRpbGUgb25seSBoYXMgdGhlIG9uZSBzaXplIGZpZWxkXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiByZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiICYmIHRpbGVUeXBlICE9IFwiZ2FsbGVyeVwiXG4gICAgICAgICAgICAgICAgICAgID8gc3RyaW5ncy50aWxlLnNpemVTdHlsZUNoYXJ0XG4gICAgICAgICAgICAgICAgICAgIDogKGZpZWxkQ291bnQgPT09IDEgJiYgaXNGaXJzdEZpZWxkRGF0ZSkgfHwgKGZpZWxkQ291bnQgPT09IDIgJiYgaXNTZWNvbmRGaWVsZERhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHN0cmluZ3MudGlsZS5zaXplU3R5bGVEYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHN0cmluZ3MudGlsZS5zaXplU3R5bGUsXG4gICAgICAgICAgICAgICAgc3ViVGV4dDogdGlsZVR5cGUgIT09IFwiZ2FsbGVyeVwiXG4gICAgICAgICAgICAgICAgICAgID8gcmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIiB8fCByZW5kZXJlclR5cGUgPT09IFwicHJlZG9taW5hbmNlLXNpemVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnN1bU9mQ2F0ZWdvcmllc1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBzZWxlY3RlZEZpZWxkc1sxXS5leHByZXNzaW9uVGl0bGUgfHwgZ2V0RmllbGQoc2VsZWN0ZWRGaWVsZHNbMV0uZmllbGQpLmxhYmVsXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIixcbiAgICAgICAgICAgICAgICAvL2NzczogcmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIiA/IENTUy5jaGFydFNpemVTaXplVGlsZSA6IENTUy5zaXplVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogcmVuZGVyZXJUeXBlID09PSBcInByZWRvbWluYW5jZS1zaXplXCJcbiAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMuc2l6ZUZvclByZWRvbWluYW5jZVxuICAgICAgICAgICAgICAgICAgICA6IC8vOiByZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAvLz8gc3RyaW5ncy50aWxlLnRvb2x0aXBzLnNpemVGb3JDaGFydFxuICAgICAgICAgICAgICAgICAgICAgICAgKGZpZWxkQ291bnQgPT09IDEgJiYgaXNGaXJzdEZpZWxkRGF0ZSkgfHwgKGZpZWxkQ291bnQgPT09IDIgJiYgaXNTZWNvbmRGaWVsZERhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMuc2l6ZURhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHN0cmluZ3MudGlsZS50b29sdGlwcy5zaXplLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogKGZpZWxkQ291bnQgPT09IDEgJiYgaXNGaXJzdEZpZWxkRGF0ZSkgfHwgKGZpZWxkQ291bnQgPT09IDIgJiYgaXNTZWNvbmRGaWVsZERhdGUpID8gXCIxMjAwMDMyNjNcIiA6IFwiMTIwMDAzMjUyXCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiByZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiICYmIHRpbGVUeXBlICE9IFwiZ2FsbGVyeVwiXG4gICAgICAgICAgICAgICAgICAgID8gYCR7c3R5bGVUaWxlVHlwZX0vQ2hhcnRTaXplU2l6ZS5qcGdgXG4gICAgICAgICAgICAgICAgICAgIDogYCR7c3R5bGVUaWxlVHlwZX0vU2l6ZS5wbmdgXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwidHlwZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogaXNGaXJzdEZpZWxkRGF0ZSA/IHN0cmluZ3MudGlsZS50eXBlU3R5bGVEYXRlIDogc3RyaW5ncy50aWxlLnR5cGVTdHlsZSxcbiAgICAgICAgICAgICAgICBzdWJUZXh0OiB0aWxlVHlwZSAhPT0gXCJnYWxsZXJ5XCIgJiYgW1widHlwZS1zaXplXCIsIFwidHlwZS1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMVxuICAgICAgICAgICAgICAgICAgICA/IGdldEZpZWxkKHNlbGVjdGVkRmllbGRzWzBdLmZpZWxkKS5sYWJlbFxuICAgICAgICAgICAgICAgICAgICA6IFwiXCIsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IGlzRmlyc3RGaWVsZERhdGUgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMudHlwZURhdGUgOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMudHlwZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IGlzRmlyc3RGaWVsZERhdGUgPyBcIjEyMDAwMzI2NlwiIDogXCIxMjAwMDMyNjBcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L1R5cGUucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImNvbG9yLWFnZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLmNvbG9yQWdlU3R5bGUsXG4gICAgICAgICAgICAgICAgc3ViVGV4dDogdGlsZVR5cGUgIT09IFwiZ2FsbGVyeVwiID8gc2VsZWN0ZWRGaWVsZHNbMF0uZXhwcmVzc2lvblRpdGxlIHx8IGdldEZpZWxkKHNlbGVjdGVkRmllbGRzWzBdLmZpZWxkKS5sYWJlbCA6IFwiXCIsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5jb2xvckFnZVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5jb2xvckFnZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzMjY0XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9Db2xvcl9BZ2UucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInNpemUtYWdlXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuc2l6ZUFnZVN0eWxlLFxuICAgICAgICAgICAgICAgIHN1YlRleHQ6IHRpbGVUeXBlICE9PSBcImdhbGxlcnlcIiA/IHNlbGVjdGVkRmllbGRzWzFdLmV4cHJlc3Npb25UaXRsZSB8fCBnZXRGaWVsZChzZWxlY3RlZEZpZWxkc1sxXS5maWVsZCkubGFiZWwgOiBcIlwiLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1Muc2l6ZUFnZVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5zaXplQWdlLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNjVcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L1NpemVfQWdlLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJjb2xvci1zaXplXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuY29sb3JTaXplU3R5bGUsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5jb2xvclNpemVUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBpc0ZpcnN0RmllbGREYXRlXG4gICAgICAgICAgICAgICAgICAgID8gaXNTZWNvbmRGaWVsZERhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgID8gc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNvbG9yRGF0ZV9TaXplRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMuY29sb3JEYXRlX1NpemVcbiAgICAgICAgICAgICAgICAgICAgOiBpc1NlY29uZEZpZWxkRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMuY29sb3JfU2l6ZURhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNvbG9yX1NpemUsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI1NFwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vQ29sb3JTaXplLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJjb2xvci1hZ2Utc2l6ZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLmNvbG9yQWdlU2l6ZVN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuY29sb3JBZ2VTaXplVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNvbG9yQWdlX1NpemUsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI2N1wiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vQ29sb3JTaXplX0FnZS5wbmdgXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwiY29sb3Itc2l6ZS1hZ2VcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5jb2xvclNpemVBZ2VTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLmNvbG9yU2l6ZUFnZVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5jb2xvcl9TaXplQWdlLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNjdcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L0NvbG9yU2l6ZV9BZ2UucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgLyogY2FzZSBcImNvbG9yLWFnZS1zaXplLWFnZVwiOlxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLmNvbG9yQWdlU2l6ZUFnZVN0eWxlLFxuICAgICAgICAgICAgLy9jc3M6IENTUy5jb2xvckFnZVNpemVBZ2VUaWxlLFxuICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5jb2xvckFnZV9TaXplQWdlLFxuICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI2N1wiLFxuICAgICAgICAgICAgaW1hZ2VGaWxlOmAke3N0eWxlVGlsZVR5cGV9L0NvbG9yU2l6ZV9BZ2UucG5nYFxuICAgICAgICAgIH07ICovXG4gICAgICAgIGNhc2UgXCJ0eXBlLXNpemVcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS50eXBlU2l6ZVN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MudHlwZVNpemVUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBpc0ZpcnN0RmllbGREYXRlXG4gICAgICAgICAgICAgICAgICAgID8gc3RyaW5ncy50aWxlLnRvb2x0aXBzLnR5cGVEYXRlX1NpemVcbiAgICAgICAgICAgICAgICAgICAgOiBpc1NlY29uZEZpZWxkRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRpbGUudG9vbHRpcHMudHlwZV9TaXplRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMudHlwZV9TaXplLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNjFcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L1R5cGVTaXplLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJ0eXBlLXNpemUtYWdlXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUudHlwZVNpemVBZ2VTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnR5cGVTaXplQWdlVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLnR5cGVfU2l6ZUFnZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzMjY4XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9UeXBlU2l6ZV9BZ2UucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImRvdC1kZW5zaXR5XCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuZG90RGVuc2l0eVN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuZG90RGVuc2l0eVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5kb3REZW5zaXR5LFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNTNcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L0RvdERlbnNpdHkucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImhlYXRtYXBcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5oZWF0bWFwU3R5bGUsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5oZWF0bWFwVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmhlYXRNYXAsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI1MFwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vSGVhdE1hcC5wbmdgXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwicmVsYXRpb25zaGlwXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUucmVsYXRpb25zaGlwU3R5bGUsXG4gICAgICAgICAgICAgICAgc3ViVGV4dDogdGlsZVR5cGUgIT09IFwiZ2FsbGVyeVwiICYmIHJlbmRlcmVyVHlwZSA9PT0gXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgICAgICAgICAgICAgID8gW2dldEZpZWxkKHNlbGVjdGVkRmllbGRzWzBdLmZpZWxkKS5sYWJlbCwgZ2V0RmllbGQoc2VsZWN0ZWRGaWVsZHNbMV0uZmllbGQpLmxhYmVsXVxuICAgICAgICAgICAgICAgICAgICA6IFwiXCIsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5yZWxhdGlvbnNoaXAsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI1OFwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vUmVsYXRpb25zaGlwLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLnJlbGF0aW9uc2hpcFNpemVTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnJlbGF0aW9uc2hpcFNpemVUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMucmVsYXRpb25zaGlwU2l6ZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzMjU5XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9SZWxhdGlvbnNoaXBTaXplLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2VcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5wcmVkb21pbmFuY2VTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnByZWRvbWluYW5jZVRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5wcmVkb21pbmFuY2UsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI1NlwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vUHJlZG9taW5hbmNlLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2Utc2l6ZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLnByZWRvbWluYW5jZVNpemVTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnByZWRvbWluYW5jZVNpemVUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMucHJlZG9taW5hbmNlU2l6ZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzMjU3XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9QcmVkb21pbmFuY2VTaXplLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJjaGFydFwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogcmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIiAmJiB0aWxlVHlwZSAhPT0gXCJnYWxsZXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRpbGUuY2hhcnRTdHlsZUNvbG9yXG4gICAgICAgICAgICAgICAgICAgIDogc3RyaW5ncy50aWxlLmNoYXJ0U3R5bGUsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5jaGFydFRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5jaGFydCxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzNzI5XCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9DaGFydC5qcGdgXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwiY2hhcnQtc2l6ZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aWxlLmNoYXJ0U2l6ZVN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuY2hhcnRTaXplVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNoYXJ0U2l6ZSxcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IFwiMTIwMDAzNzMwXCIsXG4gICAgICAgICAgICAgICAgaW1hZ2VGaWxlOiBgJHtzdHlsZVRpbGVUeXBlfS9DaGFydFNpemUuanBnYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImNvbXBhcmVcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5jb21wYXJlU3R5bGUsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy5jb21wYXJlVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLmNvbXBhcmUsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI1NVwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vUmF0aW8ucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInJhc3Rlci1zdHJldGNoXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuc3ltYm9sb2d5U3RyZXRjaFN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1Muc3RyZXRjaFRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5zdHJldGNoLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNjlcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L3N0cmV0Y2gucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInJhc3Rlci1yZ2JcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5zeW1ib2xvZ3lSR0JTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnJnYlRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5yZ2IsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI3MFwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vcmdiLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItdW5pcXVlLXZhbHVlXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuc3ltYm9sb2d5VW5pcXVlVmFsdWVzU3R5bGUsXG4gICAgICAgICAgICAgICAgLy9jc3M6IENTUy51bmlxdWVWYWx1ZXNUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMudW5pcXVlVmFsdWVzLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNzFcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L3VuaXF1ZVZhbHVlcy5wbmdgXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwicmFzdGVyLXNoYWRlZC1yZWxpZWZcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5zeW1ib2xvZ3lTaGFkZWRSZWxpZWZTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnNoYWRlZFJlbGllZlRpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5zaGFkZWRSZWxpZWYsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI3M1wiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vc2hhZGVkUmVsaWVmLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItdmVjdG9yLWZpZWxkXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUuc3ltYm9sb2d5VmVjdG9yRmllbGRTdHlsZSxcbiAgICAgICAgICAgICAgICAvL2NzczogQ1NTLnZlY3RvckZpZWxkVGlsZSxcbiAgICAgICAgICAgICAgICBtb3JlSW5mbzogc3RyaW5ncy50aWxlLnRvb2x0aXBzLnZlY3RvckZpZWxkLFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDMyNzVcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L3ZlY3RvckZpZWxkLnBuZ2BcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItY29sb3JtYXBcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5zeW1ib2xvZ3lDb2xvcm1hcFN0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuY29sb3JtYXBUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMuY29sb3JtYXAsXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI3NFwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vY29sb3JtYXAucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInJhc3Rlci1jbGFzcy1icmVha3NcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3MudGlsZS5zeW1ib2xvZ3lDbGFzc0JyZWFrc1N0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuY2xhc3NCcmVha3NUaWxlLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnRpbGUudG9vbHRpcHMuY2xhc3NpZnksXG4gICAgICAgICAgICAgICAgaGVscElkOiBcIjEyMDAwMzI3MlwiLFxuICAgICAgICAgICAgICAgIGltYWdlRmlsZTogYCR7c3R5bGVUaWxlVHlwZX0vY2xhc3NCcmVha3MucG5nYFxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcInJhc3Rlci1mbG93XCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRpbGUucmFzdGVyRmxvd1N0eWxlLFxuICAgICAgICAgICAgICAgIC8vY3NzOiBDU1MuZmxvd1RpbGUsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IHN0cmluZ3MudGlsZS50b29sdGlwcy5mbG93LFxuICAgICAgICAgICAgICAgIGhlbHBJZDogXCIxMjAwMDM2NzZcIixcbiAgICAgICAgICAgICAgICBpbWFnZUZpbGU6IGAke3N0eWxlVGlsZVR5cGV9L2Zsb3cucG5nYFxuICAgICAgICAgICAgfTtcbiAgICB9XG59XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVDc3MgPSBcIi50aWxle2JhY2tncm91bmQtY29sb3I6d2hpdGU7cG9zaXRpb246cmVsYXRpdmU7bWFyZ2luOjZweDtjdXJzb3I6cG9pbnRlcjtib3gtc2hhZG93OjAgMXB4IDEwcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4wNSksIDAgMCAwIDFweCAjZTBlMGUwO3RyYW5zaXRpb246Ym94LXNoYWRvdyAxMjVtcyBlYXNlLWluLW91dH0udGlsZTpob3Zlcnt6LWluZGV4OjU7Ym94LXNoYWRvdzowIDFweCAwIDJweCByZ2JhKDAsIDAsIDAsIDAuMDUpLCAwIDAgMCAxcHggI2UwZTBlMH0udGlsZTpmb2N1c3tvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0udGlsZS1zZWxlY3RlZHtib3gtc2hhZG93OjAgMXB4IDEwcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4wNSksIDAgMCAwIDFweCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0udGlsZS1zZWxlY3RlZDpmb2N1c3tib3gtc2hhZG93OjAgMXB4IDEwcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4wNSksIDAgMCAwIDJweCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0udGlsZS1zZWxlY3RlZDpob3Zlcnt6LWluZGV4OjU7Ym94LXNoYWRvdzowIDFweCAwIDJweCByZ2JhKDAsIDAsIDAsIDAuMDUpLCAwIDAgMCAxcHggdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9LnRpbGUtY2hlY2t7cG9zaXRpb246YWJzb2x1dGU7dG9wOjEwcHg7cmlnaHQ6MTBweH0udGlsZS1jaGVjay5ydGx7cmlnaHQ6YXV0bztsZWZ0OjEwcHh9LnN0eWxlLWxpbmt7cGFkZGluZzo5cHggOXB4fS5zdHlsZS1saW5rLWljb257bWFyZ2luLXRvcDotMXB4fS5zdHlsZS1saW5rLXRleHR7bWFyZ2luLXJpZ2h0OjEwcHh9LnN0eWxlLWxpbmstdGV4dC5ydGx7bWFyZ2luLXJpZ2h0OjA7bWFyZ2luLWxlZnQ6MTBweH0uc3R5bGUtbGluay10aXRsZXtmb250LXdlaWdodDpib2xkO3BhZGRpbmctYm90dG9tOjVweH0uc3R5bGUtbGluay10aXRsZS5pbmZve2Rpc3BsYXk6ZmxleH0uc3R5bGUtbGluay1zdWItdGV4dHtmb250LXNpemU6ODAlO3BhZGRpbmc6MCAwIDZweCAwO2ZvbnQtd2VpZ2h0Om5vcm1hbH0uc3R5bGUtbGluay1vcHRpb25ze2NvbG9yOiMwMDc5YzE7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdyBub3dyYXB9LnN0eWxlLWxpbmstb3B0aW9ucyBzdmd7ZmlsbDojMDA3OWMxfS50aWxlLWltYWdle2hlaWdodDoxMDBweDt3aWR0aDoxMDAlO2JhY2tncm91bmQtc2l6ZTpjb3ZlcjtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXJ9LnRpbGUtaW1hZ2Utc2VsZWN0ZWR7aGVpZ2h0OjY4cHg7YmFja2dyb3VuZC1zaXplOmF1dG8gMTAwcHh9LnN0eWxlLXN1Yi10ZXh0e2ZvbnQtc2l6ZTo4MCU7cGFkZGluZzowIDAgNnB4IDB9LnN0eWxlLWxpbmstaW5mb3toZWlnaHQ6MThweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nVGlsZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nVGlsZVNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nVGlsZVNlbGVjdFwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaWxlT3B0aW9ucyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnNcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nVGlsZUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdUaWxlRXJyb3JcIiwgNyk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgUHJvcGVydGllc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGFuZWxTY3JvbGxIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmtleXVwRXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGVkIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUluZm9Qb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgLy8gdXNlIGxhdGVzdCBoYW5kbGVyIG9uIHByb3BzXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zLmVtaXQoKVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nVGlsZVNlbGVjdC5lbWl0KCk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5rZXlkb3duRXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIikge1xuICAgICAgICAgICAgICAgIC8vIGRvbid0IHNjcm9sbCBwYW5lbFxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xpY2tFdmVudEhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGVkIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eubm9kZU5hbWUpID09PSBcIkNBTENJVEUtQ0hFQ0tCT1hcIikge1xuICAgICAgICAgICAgICAgIC8vIHVzZXIgY2xpY2tlZCBvbiBjaGVja2JveDsgd2UgaGFuZGxlZCB0aGlzIGJlbG93XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCgoX2IgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iubm9kZU5hbWUpID09PSBcIkFSQ0dJUy1TTUFSVC1NQVBQSU5HLVRIRU1FLUJVVFRPTlwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUluZm9Qb3BvdmVyKCk7XG4gICAgICAgICAgICAvLyB1c2UgbGF0ZXN0IGhhbmRsZXIgb24gcHJvcHNcbiAgICAgICAgICAgIHNlbGVjdGVkID8gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaWxlT3B0aW9ucy5lbWl0KCkgOiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVTZWxlY3QuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jaGVja2JveENoYW5nZUhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWQgfSA9IHRoaXM7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGlmICghbm9kZS5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgYWxsb3cgdXNlcnMgdG8gdW5jaGVjayB0aGUgYm94XG4gICAgICAgICAgICAgICAgbm9kZS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICAvLyB1c2UgbGF0ZXN0IGhhbmRsZXIgb24gcHJvcHNcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnMuZW1pdCgpXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0LmVtaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50aWxlVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50eXBlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvKipcbiAgICAgKiBTZXQgZm9jdXMgb24gdGlsZVxuICAgICAqL1xuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLnRpbGVOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy50aWxlSW5mbyA9IGdldFRpbGVJbmZvKHRoaXMudHlwZSwgdGhpcy50aWxlVHlwZSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuZmxvd0l0ZW1Ob2RlID0gZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlSW5mb1BvcG92ZXIoKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZCwgdGlsZUluZm8sIHRpbGVUeXBlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IHRpdGxlLCBpbWFnZUZpbGUgfSA9IHRpbGVJbmZvO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBydGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgICAgICBjb25zdCBzdHlsZVRpbGVDbGFzc2VzID0ge1xuICAgICAgICAgICAgdGlsZTogdHJ1ZSxcbiAgICAgICAgICAgIFwidGlsZS1zZWxlY3RlZFwiOiBzZWxlY3RlZFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzdHlsZVRpbGVJbWFnZUNsYXNzZXMgPSB7XG4gICAgICAgICAgICBcInRpbGUtaW1hZ2VcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwidGlsZS1pbWFnZS1zZWxlY3RlZFwiOiB0aWxlVHlwZSA9PT0gXCJnYWxsZXJ5XCIgJiYgc2VsZWN0ZWRcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc3R5bGVUaWxlQ2hlY2tDbGFzc2VzID0ge1xuICAgICAgICAgICAgXCJ0aWxlLWNoZWNrXCI6IHRydWUsXG4gICAgICAgICAgICBydGw6IHJ0bFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBcImFyaWEtbGFiZWxcIjogYCR7dGl0bGV9ICR7c2VsZWN0ZWQgPyBzdHJpbmdzLnRpbGUuc3R5bGVPcHRpb25zIDogc3RyaW5ncy50aWxlLnNlbGVjdFN0eWxlfWAsIFwiYXJpYS1zZWxlY3RlZFwiOiBzZWxlY3RlZCwgcm9sZTogXCJidXR0b25cIiwgdGFiaW5kZXg6IFwiMFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogc3R5bGVUaWxlQ2xhc3NlcywgdGFiaW5kZXg6IFwiMFwiLCByZWY6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50aWxlTm9kZSA9IGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRUaWxlTGlzdGVuZXJzKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IHN0eWxlVGlsZUltYWdlQ2xhc3Nlcywgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IGB1cmwoJHtnZXRBc3NldFBhdGgoYC4vYXNzZXRzL2FyY2dpcy1zbWFydC1tYXBwaW5nLXRodW1ibmFpbHMvYCl9JHtpbWFnZUZpbGV9KWBcbiAgICAgICAgICAgIH0sIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSksIHRpbGVUeXBlID09PSBcImdhbGxlcnlcIiAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBzdHlsZVRpbGVDaGVja0NsYXNzZXMsIFwiYXJpYS1sYWJlbFwiOiBcIlwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgbmFtZTogXCJzdHlsZS10aWxlLWNoZWNrLW5hbWVcIiwgY2hlY2tlZDogc2VsZWN0ZWQsIHRhYmluZGV4OiBcIi0xXCIsIHJlZjogKGVsZW1lbnQpID0+IHRoaXMuYWRkQ2hlY2tib3hMaXN0ZW5lcihlbGVtZW50KSB9KSkpLCB0aGlzLnJlbmRlclRpbGVMaW5rKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclRoZW1lKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgeyB0aWxlVHlwZSwgdHlwZSB9ID0gdGhpcztcbiAgICAgICAgaWYgKGxheWVyLnR5cGUgPT09IFwiaW1hZ2VyeVwiIHx8IGxheWVyLnR5cGUgPT09IFwiaW1hZ2VyeS10aWxlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFtcImNvbG9yXCIsIFwic2l6ZVwiLCBcImNvbG9yLWFnZVwiLCBcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZVwiXS5pbmRleE9mKHR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFtcbiAgICAgICAgICAgIFwiY29sb3JcIixcbiAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgIFwic2l6ZS1hZ2VcIixcbiAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgIF0uaW5kZXhPZihyZW5kZXJlclR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRpbGVUeXBlID09PSBcImdhbGxlcnlcIiAmJlxuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCJcbiAgICAgICAgICAgIF0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzVW5pdmFyaWF0ZSA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udHlwZSkgPT09IFwidW5pdmFyaWF0ZS1jb2xvci1zaXplXCI7XG4gICAgICAgIGlmICh0aWxlVHlwZSA9PT0gXCJnYWxsZXJ5XCIgJiYgcmVuZGVyZXJUeXBlID09PSBcImNvbG9yLXNpemVcIiAmJiAhaXNVbml2YXJpYXRlKSB7XG4gICAgICAgICAgICAvLyBiaXZhcmlhdGUgQ29sb3IrU2l6ZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmICh0aWxlVHlwZSA9PT0gXCJnYWxsZXJ5XCIgJiYgcmVuZGVyZXJUeXBlID09PSBcImNvbG9yXCIgJiYgIWNvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICAvLyBjbGFzc2VkIGNvbG9yXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGlmICh0aWxlVHlwZSA9PT0gXCJnYWxsZXJ5XCIgJiYgcmVuZGVyZXJUeXBlID09PSBcInNpemVcIiAmJiAhc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgLy8gY2xhc3NlZCBzaXplXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZW5kZXJlclN1YnR5cGUgPSB0eXBlID09PSBcImNvbG9yLWFnZVwiXG4gICAgICAgICAgICA/IFwiY29sb3JcIlxuICAgICAgICAgICAgOiB0eXBlID09PSBcInNpemUtYWdlXCJcbiAgICAgICAgICAgICAgICA/IFwic2l6ZVwiXG4gICAgICAgICAgICAgICAgOiB0eXBlID09PSBcImNvbG9yLXNpemVcIlxuICAgICAgICAgICAgICAgICAgICA/IFwiY29sb3JTaXplXCJcbiAgICAgICAgICAgICAgICAgICAgOiB0eXBlO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10aGVtZS1idXR0b25cIiwgeyByZWY6IChub2RlKSA9PiAodGhpcy50aGVtZUJ1dHRvbk5vZGUgPSBub2RlKSwgcmVuZGVyZXJTdWJ0eXBlOiByZW5kZXJlclN1YnR5cGUsIGJ1dHRvblZlcnNpb246IFwibWluaW1hbFwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuY2hhbmdlVGhlbWUoZXZlbnQpIH0pKTtcbiAgICB9XG4gICAgY2hhbmdlVGhlbWUoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCB7IHR5cGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzVW5pdmFyaWF0ZSA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udHlwZSkgPT09IFwidW5pdmFyaWF0ZS1jb2xvci1zaXplXCI7XG4gICAgICAgIGlmICgodHlwZSA9PT0gXCJjb2xvclwiIHx8IHR5cGUgPT09IFwiY29sb3ItYWdlXCIpICYmXG4gICAgICAgICAgICBbXCJjb2xvclwiLCBcImNvbG9yLWFnZVwiLCBcImNvbG9yLXNpemVcIiwgXCJjb2xvci1hZ2Utc2l6ZVwiLCBcImNvbG9yLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICBsZXQgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgICAgICBpZiAoW1wiY29sb3ItYWdlXCIsIFwiY29sb3ItYWdlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVDYWxsID0gY3JlYXRlQ29sb3JBZ2VSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKHVwZGF0ZUNhbGwoeyB0aGVtZTogZXZlbnQuZGV0YWlsIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKFtcImNvbG9yLXNpemVcIiwgXCJjb2xvci1hZ2Utc2l6ZVwiLCBcImNvbG9yLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlbmRlcmVyLCBcImNvbG9yXCIpIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMucHVzaChnZXRWaXNWYXIocmVzdWx0LnJlbmRlcmVyLCBcImNvbG9yXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMgPSBnZXRBdXRoVmlzVmFyc0V4Y2VwdChyZW5kZXJlciwgXCJjb2xvclwiKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMucHVzaChnZXRBdXRoVmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJjb2xvclwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMudGhlbWVCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaWxlRXJyb3IuZW1pdChlcnJvcikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCh0eXBlID09PSBcInNpemVcIiB8fCB0eXBlID09PSBcInNpemUtYWdlXCIpICYmXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIGxldCB1cGRhdGVDYWxsID0gY3JlYXRlU2l6ZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgaWYgKFtcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlQ2FsbCA9IGNyZWF0ZVNpemVBZ2VSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKHVwZGF0ZUNhbGwoeyB0aGVtZTogZXZlbnQuZGV0YWlsIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKFtcInNpemVcIiwgXCJzaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlbmRlcmVyLCBcInNpemVcIikgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKGdldFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIFwic2l6ZVwiKSk7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID0gZ2V0QXV0aFZpc1ZhcnNFeGNlcHQocmVuZGVyZXIsIFwic2l6ZVwiKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMucHVzaChnZXRBdXRoVmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy50aGVtZUJ1dHRvbk5vZGUpO1xuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVFcnJvci5lbWl0KGVycm9yKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJjb2xvci1zaXplXCIgJiYgaXNVbml2YXJpYXRlKSB7XG4gICAgICAgICAgICByZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvclNpemVVbml2YXJpYXRlUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyB0aGVtZTogZXZlbnQuZGV0YWlsIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMudGhlbWVCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaWxlRXJyb3IuZW1pdChlcnJvcikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlclRpbGVMaW5rKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkLCB0aWxlSW5mbywgdGlsZVR5cGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIHN1YlRleHQgfSA9IHRpbGVJbmZvO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBydGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgICAgICBjb25zdCBzdHlsZUxpbmtUZXh0Q2xhc3NlcyA9IHtcbiAgICAgICAgICAgIFwic3R5bGUtbGluay10ZXh0XCI6IHRydWUsXG4gICAgICAgICAgICBydGw6IHJ0bFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdHlsZS1saW5rXCIsIFwiYXJpYS1sYWJlbFwiOiB0aXRsZSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IGBzdHlsZS1saW5rLXRpdGxlICR7dGlsZVR5cGUgPT09IFwiZ2FsbGVyeVwiID8gXCJpbmZvXCIgOiBcIlwifWAgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBzdHlsZUxpbmtUZXh0Q2xhc3NlcywgXCJhcmlhLWhpZGRlblwiOiBcInRydWVcIiB9LCB0aXRsZSksIHRpbGVUeXBlID09PSBcImdhbGxlcnlcIiAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgY2xhc3M6IFwic3R5bGUtbGluay1pbmZvXCIsIHRhYmluZGV4OiBcIjBcIiwgc2NhbGU6IFwic1wiLCBpY29uOiBcImluZm9ybWF0aW9uXCIsIGNvbXBhY3Q6IHRydWUsIG9uQ2xpY2s6IChldmVudCkgPT4gdGhpcy5oYW5kbGVJbmZvQ2xpY2soZXZlbnQpLCB0ZXh0OiBzdHJpbmdzLnRpbGUubW9yZUluZm8sIHJlZjogKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmluZm9JY29uTm9kZSA9IGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCAoIXRoaXMuaW5mb1BvcG92ZXJOb2RlICYmIGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVJbmZvQ2xpY2soZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgcGFuZWwgZnJvbSBzY3JvbGxpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSksIHRpbGVUeXBlICE9PSBcImdhbGxlcnlcIiAmJiBzdWJUZXh0ICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3R5bGUtbGluay1zdWItdGV4dFwiIH0sIHR5cGVvZiBzdWJUZXh0ID09PSBcInN0cmluZ1wiID8gc3ViVGV4dCA6IHN1YlRleHQubWFwKCh0KSA9PiBoKFwiZGl2XCIsIG51bGwsIHQpKSkpKSwgKHNlbGVjdGVkIHx8IHRpbGVUeXBlICE9PSBcImdhbGxlcnlcIikgJiYgdGhpcy5yZW5kZXJUaGVtZSgpLCAoc2VsZWN0ZWQgfHwgdGlsZVR5cGUgIT09IFwiZ2FsbGVyeVwiKSAmJiB0aGlzLnJlbmRlclN0eWxlT3B0aW9ucygpKSk7XG4gICAgfVxuICAgIHJlbmRlclN0eWxlT3B0aW9ucygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgLy8gZXZlbnQgaGFuZGxpbmcgZm9yIGJ1dHRvbiBjbGljayBpcyBoYW5kbGVkIGFzIHRpbGUgY2xpY2tcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJmdWxsXCIsIHNjYWxlOiBcInNcIiwgbGFiZWw6IHN0cmluZ3MudGlsZS5zdHlsZU9wdGlvbnMgfSwgc3RyaW5ncy50aWxlLnN0eWxlT3B0aW9ucykpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBoYW5kbGVJbmZvQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgLy8gZG9uJ3QgZXhlY3V0ZSB0aGUgZXZlbnQgb24gdGhlIGVudGlyZSB0aWxlXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB7IHRpbGVJbmZvLCBmbG93SXRlbU5vZGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIG1vcmVJbmZvLCBoZWxwSWQgfSA9IHRpbGVJbmZvO1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHRoaXMucmVtb3ZlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgdGhpcy5pbmZvUG9wb3Zlck5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctaW5mby1wb3BvdmVyXCIpO1xuICAgICAgICB0aGlzLmluZm9Qb3BvdmVyTm9kZS5wcm9wcyA9IHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgbW9yZUluZm8sXG4gICAgICAgICAgICBoZWxwSWQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBmbG93SXRlbU5vZGUsXG4gICAgICAgICAgICBzdHJpbmdzXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaW5mb1BvcG92ZXJOb2RlLnJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLmluZm9JY29uTm9kZTtcbiAgICAgICAgdGhpcy5pbmZvUG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyQ2xvc2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5pbmZvSWNvbk5vZGUuc2V0Rm9jdXMoKSwgMjAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5mb1BvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdJbmZvUG9wb3ZlckRpc2Nvbm5lY3RlZFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVJbmZvUG9wb3ZlcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmluZm9Qb3BvdmVyTm9kZSk7XG4gICAgICAgIHRoaXMuaW5mb1BvcG92ZXJOb2RlLnNldE9wZW4odHJ1ZSk7XG4gICAgICAgIC8vIG5lZWQgdG8gd2FpdCB1bnRpbCBpdCdzIGFsbCB2aXNpYmxlXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5pbmZvUG9wb3Zlck5vZGUuc2V0Rm9jdXMoKSwgMTAwKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBjbG9zZSBwb3BvdmVyIHdoZW4gY2xpY2tpbmcgb3V0c2lkZVxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUluZm9Qb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5pbmZvSWNvbk5vZGUuc2V0Rm9jdXMoKSwgMjAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgLy8gY2xpY2sgaGFuZGxlciBpcyBub3QgY2FsbGVkIHdoZW4gY2xpY2tpbmcgb3Igc2Nyb2xsaW5nIHBhbmVsIHNjcm9sbGJhcnNcbiAgICAgICAgICAgIHRoaXMucGFuZWxTY3JvbGxIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmbG93SXRlbU5vZGUgPT09IG51bGwgfHwgZmxvd0l0ZW1Ob2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmbG93SXRlbU5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVGbG93SXRlbVNjcm9sbFwiLCB0aGlzLnBhbmVsU2Nyb2xsSGFuZGxlcik7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgfVxuICAgIHJlbW92ZUluZm9Qb3BvdmVyKCkge1xuICAgICAgICBjb25zdCB7IGZsb3dJdGVtTm9kZSB9ID0gdGhpcztcbiAgICAgICAgLy8gY2xvc2UgcG9wb3ZlcnNcbiAgICAgICAgZG9jdW1lbnQuYm9keVxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcG9wb3ZlclwiKVxuICAgICAgICAgICAgLmZvckVhY2goKG5vZGUpID0+IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobm9kZSkpO1xuICAgICAgICB0aGlzLmluZm9Qb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhbmVsU2Nyb2xsSGFuZGxlcikge1xuICAgICAgICAgICAgZmxvd0l0ZW1Ob2RlID09PSBudWxsIHx8IGZsb3dJdGVtTm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmxvd0l0ZW1Ob2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlRmxvd0l0ZW1TY3JvbGxcIiwgdGhpcy5wYW5lbFNjcm9sbEhhbmRsZXIpO1xuICAgICAgICAgICAgdGhpcy5wYW5lbFNjcm9sbEhhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkVGlsZUxpc3RlbmVycyhlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMua2V5dXBFdmVudEhhbmRsZXIpO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMua2V5ZG93bkV2ZW50SGFuZGxlcik7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xpY2tFdmVudEhhbmRsZXIpO1xuICAgIH1cbiAgICBhZGRDaGVja2JveExpc3RlbmVyKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2FsY2l0ZUNoZWNrYm94Q2hhbmdlXCIsIHRoaXMuY2hlY2tib3hDaGFuZ2VIYW5kbGVyKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGUuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdUaWxlQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNTbWFydE1hcHBpbmdBZ2UgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfYWdlLCBBcmNnaXNTbWFydE1hcHBpbmdDbGFzc2lmeSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19jbGFzc2lmeSwgQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5IGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX2RpdmlkZWRfYnksIEFyY2dpc1NtYXJ0TWFwcGluZ0luZm9Qb3BvdmVyIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX2luZm9fcG9wb3ZlciwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfc2l6ZSwgQXJjZ2lzU21hcnRNYXBwaW5nU2l6ZVJhbmdlU2xpZGVyIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3NpemVfcmFuZ2Vfc2xpZGVyLCBBcmNnaXNTbWFydE1hcHBpbmdTaXplU2xpZGVyIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3NpemVfc2xpZGVyLCBBcmNnaXNTbWFydE1hcHBpbmdUaWxlIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3RpbGUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWdlXzguZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuXG5mdW5jdGlvbiBhZGREYXRlRm9ybWF0RnVuY3Rpb25zKGNvbmZpZywgdGltZVpvbmUpIHtcbiAgICBjb25maWcubGFiZWxGb3JtYXRGdW5jdGlvbiA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICByZXR1cm4gZ2V0RGF0ZURpc3BsYXlTdHJpbmcodmFsdWUsIHRpbWVab25lLCBcInNob3J0LWRhdGVcIik7XG4gICAgfTtcbiAgICBjb25maWcuaW5wdXRGb3JtYXRGdW5jdGlvbiA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICByZXR1cm4gZ2V0RGF0ZURpc3BsYXlTdHJpbmcodmFsdWUsIHRpbWVab25lLCBcInNob3J0LWRhdGVcIik7XG4gICAgfTtcbiAgICBjb25maWcuaW5wdXRQYXJzZUZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBtYXBUWlRvVVRDKERhdGUucGFyc2UodmFsdWUpLCB0aW1lWm9uZSk7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIHV0Y1RvRGF0ZVBpY2tlcih2YWx1ZSwgdGltZVpvbmUpIHtcbiAgICAvLyBkYXRlIGlzIGluIFVUQ1xuICAgIC8vIHdlIG5lZWQgYSBtYXAgdGltZXpvbmVcbiAgICBsZXQgc3RyO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgc3RyID0gbmV3IERhdGUodmFsdWUgLSBkaWZmICogNjAwMDApLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbWVab25lID09PSBcInVua25vd25cIikge1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBuZXcgRGF0ZSgpLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIGNvbnN0IG1hcERhdGVTdHIgPSBuZXcgRGF0ZSh2YWx1ZSkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7IHRpbWVab25lIH0pO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZShuZXcgRGF0ZShtYXBEYXRlU3RyKS5nZXRUaW1lKCkgLSBkaWZmICogNjAwMDApLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKFwidXRjVG9EYXRlUGlja2VyXCIsIHZhbHVlLCBcIiAtIFwiLCBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKSwgXCIgLT4gXCIsIHN0cik7XG4gICAgcmV0dXJuIHN0cjtcbn1cbmZ1bmN0aW9uIHV0Y1RvVGltZVBpY2tlcih2YWx1ZSwgdGltZVpvbmUsIGFkZFNlY29uZHMpIHtcbiAgICAvLyBkYXRlIGlzIGluIFVUQ1xuICAgIC8vIHdlIG5lZWQgYSBtYXAgdGltZXpvbmVcbiAgICBsZXQgc3RyO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgc3RyID0gbmV3IERhdGUodmFsdWUgLSBkaWZmICogNjAwMDApLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbWVab25lID09PSBcInVua25vd25cIikge1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBuZXcgRGF0ZSgpLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIGNvbnN0IG1hcERhdGVTdHIgPSBuZXcgRGF0ZSh2YWx1ZSkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7IHRpbWVab25lIH0pO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZShuZXcgRGF0ZShtYXBEYXRlU3RyKS5nZXRUaW1lKCkgLSBkaWZmICogNjAwMDApLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIC8vIHN0ciA9IFwiMjAyMy0wOS0yMFQxMzowNjowMC4wMDBaXCJcbiAgICBzdHIgPSBhZGRTZWNvbmRzID8gc3RyLnN1YnN0cmluZygxMSwgMTkpIDogc3RyLnN1YnN0cmluZygxMSwgMTYpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwidXRjVG9UaW1lUGlja2VyXCIsIHZhbHVlLCBcIiAtIFwiLCBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKSwgXCIgLT4gXCIsIHN0cik7XG4gICAgcmV0dXJuIHN0cjtcbn1cbmZ1bmN0aW9uIGRhdGVQaWNrZXJUb1VUQyhkYXRlU3RyaW5nLCB0aW1lWm9uZSkge1xuICAgIC8vIGRhdGUgaXMgaW4gbWFwIHRpbWV6b25lXG4gICAgLy8gd2UgbmVlZCBhIFVUQyBVTklYIHRpbWVzdGFtcFxuICAgIGxldCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cmluZyk7XG4gICAgLy8gdGhpcyBpcyByZWFkIGFzIGN1cnJlbnQgdGltZTsgdG9JU09TdHJpbmcoKSB3b3VsZCByZWF0dXJuIFVUQyB0aW1lIChlLmcuICs3IGhvdXJzIGZyb20gcGFjaWZpYylcbiAgICAvLyBmaXggdGhlIG9mZnNldFxuICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTtcbiAgICAvLyBkYXRlIG5vdyBjb250YWlucyB0aGUgdXNlcidzIGVudGVyZWQgdGltZVxuICAgIGxldCB2YWx1ZTtcbiAgICBpZiAoIXRpbWVab25lIHx8IHRpbWVab25lID09PSBcInN5c3RlbVwiKSB7XG4gICAgICAgIC8vIGFkZCBkaWZmZXJlbmNlIGJldHdlZW4gbG9jYWwgdGltZSBhbmQgVVRDXG4gICAgICAgIHZhbHVlID0gZGF0ZS5nZXRUaW1lKCkgKyBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIC8vIHRha2Ugd2hhdCB5b3UgZ2V0XG4gICAgICAgIHZhbHVlID0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBhZGQgZGlmZmVyZW5jZSBiZXR3ZWVuIG1hcCB0aW1lIGFuZCBVVENcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKGRhdGUudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7IHRpbWVab25lOiBcInV0Y1wiIH0pKS5nZXRUaW1lKCkgLVxuICAgICAgICAgICAgbmV3IERhdGUoZGF0ZS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmUgfSkpLmdldFRpbWUoKTtcbiAgICAgICAgdmFsdWUgPSBkYXRlLmdldFRpbWUoKSArIGRpZmY7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKFwiZGF0ZVBpY2tlclRvVVRDXCIsIGRhdGUudG9JU09TdHJpbmcoKSwgXCIgLT4gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpKTtcbiAgICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBtYXBUWlRvVVRDKHZhbHVlLCB0aW1lWm9uZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvLyB2YWx1ZSBpcyBpbiBtYXAgdGltZXpvbmVcbiAgICAvLyB3ZSBuZWVkIGEgVVRDIHRpbWVzdGFtcFxuICAgIGxldCBuZXdWYWx1ZTtcbiAgICBpZiAoIXRpbWVab25lIHx8IHRpbWVab25lID09PSBcInN5c3RlbVwiKSB7XG4gICAgICAgIC8vIGFkZCBkaWZmZXJlbmNlIGJldHdlZW4gbG9jYWwgdGltZSBhbmQgVVRDXG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlICsgZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDA7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbWVab25lID09PSBcInVua25vd25cIikge1xuICAgICAgICAvLyB0YWtlIHdoYXQgeW91IGdldFxuICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gYWRkIGRpZmZlcmVuY2UgYmV0d2VlbiBtYXAgdGltZSBhbmQgVVRDXG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoZGF0ZS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmU6IFwidXRjXCIgfSkpLmdldFRpbWUoKSAtXG4gICAgICAgICAgICBuZXcgRGF0ZShkYXRlLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZSB9KSkuZ2V0VGltZSgpO1xuICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlICsgZGlmZjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCJtYXBUWlRvVVRDXCIsIHZhbHVlLCBcIiAtIFwiLCBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKSwgXCIgLSBcIiwgbmV3IERhdGUobmV3VmFsdWUpLnRvSVNPU3RyaW5nKCkpO1xuICAgIHJldHVybiBuZXdWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldERhdGVEaXNwbGF5U3RyaW5nKHZhbHVlLCB0aW1lWm9uZSwgZGF0ZUZvcm1hdCkge1xuICAgIGNvbnN0IHsgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgbGV0IHN0cjtcbiAgICBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHN0ciA9IG1vZHVsZXMuaW50bC5mb3JtYXREYXRlKHZhbHVlLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG1vZHVsZXMuaW50bC5jb252ZXJ0RGF0ZUZvcm1hdFRvSW50bE9wdGlvbnMoZGF0ZUZvcm1hdCB8fCBcInNob3J0LWRhdGUtc2hvcnQtdGltZVwiKSksIHsgdGltZVpvbmU6IFwidXRjXCIsIHRpbWVab25lTmFtZTogXCJzaG9ydE9mZnNldFwiIH0pKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIGtub3duIGlzc3VlcyB3aXRoIGZvcm1hdHRpbmcgaXQtQ0hcbiAgICAgICAgc3RyID0gbW9kdWxlcy5pbnRsLmZvcm1hdERhdGUodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhkYXRlRm9ybWF0IHx8IFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpKSwgeyB0aW1lWm9uZSB9KSk7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKFwiZ2V0RGF0ZURpc3BsYXlTdHJpbmdcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgc3RyKTtcbiAgICByZXR1cm4gc3RyO1xufVxuXG5leHBvcnQgeyBhZGREYXRlRm9ybWF0RnVuY3Rpb25zIGFzIGEsIHV0Y1RvVGltZVBpY2tlciBhcyBiLCBkYXRlUGlja2VyVG9VVEMgYXMgZCwgdXRjVG9EYXRlUGlja2VyIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0ZS03OWM3ZDkzYy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbi8qKlxuICogQ2FsbCBhIGZ1bmN0aW9uIG9ubHkgYWZ0ZXIgaXQgaGFzIG5vdCBiZWVuIGNhbGxlZCBmb3IgbiBtaWxsaXNlY29uZHNcbiAqIEBwYXJhbSBmbiAgICAtIGZ1bmN0aW9uIHRvIGNhbGxcbiAqIEBwYXJhbSBkZWxheSAtIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xuICovXG5jb25zdCBkZWJvdW5jZSA9IChmbiwgZGVsYXkpID0+IHtcbiAgICBsZXQgdGltZW91dDtcbiAgICBsZXQgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgZnVuY3Rpb24gZmx1c2goLi4uYXJncykge1xuICAgICAgICBzdGF0dXMgPSBcImZsdXNoZWRcIjtcbiAgICAgICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaW52b2tlKC4uLmFyZ3MpIHtcbiAgICAgICAgc3RhdHVzID0gXCJpbnZva2VkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNhbmNlbCguLi5hcmdzKSB7XG4gICAgICAgIHN0YXR1cyA9IFwiY2FuY2VsbGVkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFN0YXR1cygpIHtcbiAgICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICB9XG4gICAgY29uc3QgZGVib3VuY2VkID0gKC4uLmFyZ3MpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIFwiZmx1c2hlZFwiOlxuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJpbnZva2VkXCI6XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNhbmNlbGxlZFwiOlxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICB9LCBkZWxheSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBkZWJvdW5jZWQuZmx1c2ggPSBmbHVzaDtcbiAgICBkZWJvdW5jZWQuaW52b2tlID0gaW52b2tlO1xuICAgIGRlYm91bmNlZC5jYW5jZWwgPSBjYW5jZWw7XG4gICAgZGVib3VuY2VkLmdldFN0YXR1cyA9IGdldFN0YXR1cztcbiAgICByZXR1cm4gZGVib3VuY2VkO1xufTtcbi8qKlxuICogQ2FsbCBhIGZ1bmN0aW9uIG9ubHkgYWZ0ZXIgbiBtaWxsaXNlY29uZHMgaGF2ZSBlbGFwc2VkXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgdGhyb3R0bGUgPSAoZm4sIGRlbGF5KSA9PiB7XG4gICAgbGV0IHRpbWVvdXQ7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgIHRpbWVvdXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgfSwgZGVsYXkpO1xuICAgIH0pO1xufTtcbmZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCBcIlxcXFwkJlwiKTsgLy8gJCYgbWVhbnMgdGhlIHdob2xlIG1hdGNoZWQgc3RyaW5nXG59XG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogU2V0IGEgbWluaW11bSB0aW1lIGZvciBhIHByb21pc2UgdG8gcmVzb2x2ZSAodXNlZnVsIGZvciBwcmV2ZW50aW5nIGZsYXNoIG9mIGxvYWRlcnMpXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG1pbkRlbGF5KHByb21pc2UsIG1pbkRlbGF5KSB7XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoW3Byb21pc2UsIHRpbWVvdXQobWluRGVsYXkpXSk7XG4gICAgcmV0dXJuIHByb21pc2U7XG59XG4vKipcbiAqIEhlbHBlciBtZXRob2QgdG8gaW5saW5lIHNldFRpbWVvdXQgYXMgYW4gYXdhaXQgaW4gYXN5bmMgZnVuY3Rpb25zXG4gKi9cbmZ1bmN0aW9uIHRpbWVvdXQobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn1cbmNvbnN0IGFycmF5VG9Mb29rdXBNYXAgPSAoZGF0YUFyciwgZ2V0S2V5QW5kSXRlbSkgPT4gT2JqZWN0LmZyb21FbnRyaWVzKChkYXRhQXJyIHx8IFtdKS5tYXAoKGl0ZW0pID0+IHtcbiAgICBjb25zdCB7IGtleSwgZGF0YSB9ID0gZ2V0S2V5QW5kSXRlbShpdGVtKTtcbiAgICByZXR1cm4gW2tleSwgZGF0YV07XG59KSk7XG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdHdvIGFycmF5cyBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50c1xuICogYW5kIHdoZXRoZXIgdGhleSBjb250YWluIHRoZSBzYW1lIGVsZW1lbnRzXG4gKiByZWdhcmRsZXNzIG9mIG9yZGVyXG4gKi9cbmNvbnN0IGFycmF5c0FyZUVxdWl2YWxlbnQgPSAoYXJyMSwgYXJyMikgPT4gYXJyMS5sZW5ndGggPT09IGFycjIubGVuZ3RoICYmIGFycjEucmVkdWNlKChtZW1vLCBzdHIpID0+IG1lbW8gJiYgYXJyMi5pbmRleE9mKHN0cikgPiAtMSwgdHJ1ZSk7XG5mdW5jdGlvbiB1bmlxdWVCeShteUFyciwgZ2V0SXRlbUlkKSB7XG4gICAgY29uc3QgcmVzdWx0QXJyID0gW107XG4gICAgY29uc3QgbG9va3VwTWFwID0ge307XG4gICAgbXlBcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBpZCA9IGdldEl0ZW1JZChpdGVtKTtcbiAgICAgICAgaWYgKGxvb2t1cE1hcFtpZF0gPT0gbnVsbCkge1xuICAgICAgICAgICAgbG9va3VwTWFwW2lkXSA9IGl0ZW07XG4gICAgICAgICAgICByZXN1bHRBcnIucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHRBcnI7XG59XG5mdW5jdGlvbiB1bmlxdWUobXlBcnIpIHtcbiAgICBjb25zdCBwcmltaXRpdmVzID0geyBib29sZWFuOiB7fSwgbnVtYmVyOiB7fSwgc3RyaW5nOiB7fSB9O1xuICAgIGNvbnN0IG9ianMgPSBbXTtcbiAgICByZXR1cm4gbXlBcnIuZmlsdGVyKChpdGVtKSA9PiB7XG4gICAgICAgIGxldCB0eXBlID0gdHlwZW9mIGl0ZW07XG4gICAgICAgIGlmICh0eXBlIGluIHByaW1pdGl2ZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmltaXRpdmVzW3R5cGVdLmhhc093blByb3BlcnR5KGl0ZW0pID8gZmFsc2UgOiAocHJpbWl0aXZlc1t0eXBlXVtpdGVtXSA9IHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9ianMuaW5kZXhPZihpdGVtKSA+PSAwID8gZmFsc2UgOiBvYmpzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmNvbnN0IGNodW5rID0gKGFyciwgc2l6ZSkgPT4gWy4uLkFycmF5KE1hdGguY2VpbChhcnIubGVuZ3RoIC8gc2l6ZSkpXS5tYXAoKF8sIGkpID0+IGFyci5zbGljZShzaXplICogaSwgc2l6ZSArIHNpemUgKiBpKSk7XG5cbmV4cG9ydCB7IGFycmF5VG9Mb29rdXBNYXAgYXMgYSwgdW5pcXVlIGFzIGIsIHRocm90dGxlIGFzIGMsIGRlYm91bmNlIGFzIGQsIGVzY2FwZVJlZ0V4cCBhcyBlLCBhcnJheXNBcmVFcXVpdmFsZW50IGFzIGYsIGNodW5rIGFzIGcsIGlzRGVmaW5lZCBhcyBpLCBtaW5EZWxheSBhcyBtLCB0aW1lb3V0IGFzIHQsIHVuaXF1ZUJ5IGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZnVuY3Rpb25hbC00NGRlOGZjZi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmZ1bmN0aW9uIGlzSW5zaWRlSW5mb1BvcG92ZXJOb2RlKG5vZGUpIHtcbiAgICBpZiAoKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS50YWdOYW1lKSA9PT0gXCJBUkNHSVMtU01BUlQtTUFQUElORy1JTkZPLVBPUE9WRVJcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBwYXJlbnROb2RlID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIHdoaWxlIChwYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZS50YWdOYW1lID09PSBcIkFSQ0dJUy1TTUFSVC1NQVBQSU5HLUlORk8tUE9QT1ZFUlwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IHsgaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUgYXMgaSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wb3BvdmVyLTcyMWY3YmEyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgayBhcyBpc1Jhc3RlclJHQlJlbmRlcmVyLCBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuXG5mdW5jdGlvbiBnZXRSYXN0ZXJSZW5kZXJlclR5cGUoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgc3dpdGNoICgoX2EgPSBsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIucmVuZGVyZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJmbG93XCI6XG4gICAgICAgICAgICByZXR1cm4gXCJyYXN0ZXItZmxvd1wiO1xuICAgICAgICBjYXNlIFwidmVjdG9yLWZpZWxkXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJyYXN0ZXItdmVjdG9yLWZpZWxkXCI7XG4gICAgICAgIGNhc2UgXCJjbGFzcy1icmVha3NcIjpcbiAgICAgICAgICAgIHJldHVybiBcInJhc3Rlci1jbGFzcy1icmVha3NcIjtcbiAgICAgICAgY2FzZSBcInVuaXF1ZS12YWx1ZVwiOlxuICAgICAgICAgICAgcmV0dXJuIFwicmFzdGVyLXVuaXF1ZS12YWx1ZVwiO1xuICAgICAgICBjYXNlIFwicmFzdGVyLXN0cmV0Y2hcIjpcbiAgICAgICAgICAgIHJldHVybiBpc1Jhc3RlclJHQlJlbmRlcmVyKGxheWVyKSA/IFwicmFzdGVyLXJnYlwiIDogXCJyYXN0ZXItc3RyZXRjaFwiO1xuICAgICAgICBjYXNlIFwicmFzdGVyLXNoYWRlZC1yZWxpZWZcIjpcbiAgICAgICAgICAgIHJldHVybiBcInJhc3Rlci1zaGFkZWQtcmVsaWVmXCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gKF9iID0gbGF5ZXIucmVuZGVyZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlO1xuICAgIH1cbn1cbi8vIFRPRE86IGFkZCBvdGhlciByYXN0ZXIgcmVuZGVyZXIgdHlwZXNcbmZ1bmN0aW9uIGFwcGx5UmFzdGVyUmVuZGVyZXIocmVuZGVyZXIsIGxheWVyKSB7XG4gICAgaWYgKFwicmVuZGVyZXJcIiBpbiBsYXllcikge1xuICAgICAgICBsYXllci5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZUNvbG9yUmFtcChjb2xvclJhbXApIHtcbiAgICBjb25zdCB7IG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGlmICghY29sb3JSYW1wKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoWzAsIDAsIDAsIDFdKSxcbiAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcihbNTAsIDUwLCA1MCwgMV0pLFxuICAgICAgICAgICAgbmV3IG1vZHVsZXMuZXNyaUNvbG9yKFs3MywgNzMsIDczLCAxXSksXG4gICAgICAgICAgICBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoWzE0MCwgMTQwLCAxNDAsIDFdKSxcbiAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcihbMjU1LCAyNTUsIDI1NSwgMV0pXG4gICAgICAgIF07XG4gICAgfVxuICAgIGlmICgoY29sb3JSYW1wID09PSBudWxsIHx8IGNvbG9yUmFtcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JSYW1wLnR5cGUpICE9PSBcIm11bHRpcGFydFwiKSB7XG4gICAgICAgIHJldHVybiBbY29sb3JSYW1wLmZyb21Db2xvciwgY29sb3JSYW1wLnRvQ29sb3JdO1xuICAgIH1cbiAgICBjb25zdCBjb2xvclJhbXBzID0gY29sb3JSYW1wLmNvbG9yUmFtcHM7XG4gICAgY29uc3QgY29sb3JzID0gY29sb3JSYW1wcy5tYXAoKGNvbG9yUmFtcCkgPT4gY29sb3JSYW1wLmZyb21Db2xvcik7XG4gICAgY29sb3JzLnB1c2goY29sb3JSYW1wc1tjb2xvclJhbXBzLmxlbmd0aCAtIDFdLnRvQ29sb3IpO1xuICAgIHJldHVybiBjb2xvcnM7XG59XG5cbmV4cG9ydCB7IGFwcGx5UmFzdGVyUmVuZGVyZXIgYXMgYSwgZ2V0UmFzdGVyUmVuZGVyZXJUeXBlIGFzIGcsIG5vcm1hbGl6ZUNvbG9yUmFtcCBhcyBuIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJhc3Rlci1yZW5kZXJlci1hNjJmMTUyYy5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=