"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d2b4f9"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layers-and-tables-summary-popup.entry.js":
/*!*****************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layers-and-tables-summary-popup.entry.js ***!
  \*****************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_layers_and_tables_summary_popup: () => (/* binding */ ArcgisLayersAndTablesSummaryPopup)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _telemetry_49d4aa88_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./telemetry-49d4aa88.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-49d4aa88.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./services-5925c4b4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
















const layersAndTablesStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_2__.c)({});
const layersAndTablesState = layersAndTablesStore.state;

const arcgisLayersAndTablesSummaryPopupCss = ":host{max-width:100%}arcgis-layers-and-tables-summary:not(.hydrated){visibility:hidden}.popover-content{width:380px;min-height:6rem;background-color:var(--calcite-color-background)}.skeleton{margin:1rem;margin-bottom:3rem}@keyframes pulse{50%{opacity:.5}}.skeleton{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;padding:0.5rem;border:1px solid var(--calcite-color-border-2)}.skeleton-content{display:flex}.skeleton-left,.skeleton-right{height:1rem;width:1rem;background-color:var(--calcite-color-border-3)}.skeleton-main{margin-left:1rem;margin-right:1rem;flex:1 1 0%}.skeleton-title{height:1rem;background-color:var(--calcite-color-border-2)}.skeleton-subtitle{margin-top:0.25rem;height:1rem;background-color:var(--calcite-color-border-3)}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}.button{max-width:100%;cursor:pointer;border-style:none;padding:0px;outline:2px solid transparent;outline-offset:2px;transition-property:all;color:inherit;background:transparent;font-family:inherit;font-size:inherit;line-height:1.5}.button:focus{outline:2px solid var(--calcite-color-brand);outline-offset:4px}.button--border{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border:1px solid var(--calcite-color-foreground-3)}.button--border:focus{outline-offset:0}.button-text{pointer-events:none;display:flex}.button--icon{margin-inline-start:0.25rem;vertical-align:-3px}";

const ArcgisLayersAndTablesSummaryPopup = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.handleClick = async () => {
            var _a;
            const { layers, item } = this;
            (_a = this.button) === null || _a === void 0 ? void 0 : _a.focus();
            if (!layers) {
                this.loading = true;
            }
            if (!layersAndTablesState[item.id]) {
                layersAndTablesState[item.id] = this.fetchServiceInfo();
            }
            const response = await layersAndTablesState[item.id];
            if (response.error) {
                this.error = this.i18n.error;
                if (response.error.code === "serviceNotExist") {
                    this.error.message = this.i18n.error.noServiceMessage;
                }
            }
            if (response.result) {
                this.sublayers = (0,_services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_6__.s)(response.result, layers);
            }
            else {
                this.sublayers = layers;
            }
            this.loading = false;
            return;
        };
        this.handleWindowClick = ({ target }) => {
            if (this.el.contains(target)) {
                return;
            }
            else {
                this.popoverNode.open = false;
            }
        };
        this.handleKeyPress = ({ key }) => {
            switch (key) {
                case "Esc":
                case "Escape":
                    if (this.popoverNode) {
                        this.popoverNode.open = false;
                    }
                    break;
            }
        };
        this.api = 4;
        this.config = undefined;
        this.user = undefined;
        this.item = undefined;
        this.portal = undefined;
        this.layers = undefined;
        this.searchTerm = undefined;
        this.border = undefined;
        this.tooltip = undefined;
        this.telemetry = undefined;
        this.button = undefined;
        this.loading = true;
        this.error = undefined;
        this.sublayers = undefined;
    }
    async componentWillLoad() {
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
        this.i18n = locale[0];
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api = this.api;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal = this.portal;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.config = this.config;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user = this.user;
        if (!this.layers) {
            this.loading = true;
        }
    }
    async fetchServiceInfo() {
        const { item, portal, layers } = this;
        const response = await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.m)((0,_services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_6__.f)({ item, portal, layers, isSecure: false }), 500);
        return response;
    }
    render() {
        const { i18n, portal, user, item, handleClick, handleKeyPress, loading, searchTerm, error, tooltip, telemetry } = this;
        const layers = this.sublayers || this.layers;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { onFocusout: (e) => {
                if (!e.relatedTarget || this.el.contains(e.relatedTarget)) {
                    return;
                }
                else {
                    this.popoverNode.open = false;
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover-manager", { autoClose: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", Object.assign({ class: {
                button: true,
                "button--border": this.border
            }, ref: (el) => (this.button = el), onClick: handleClick, onTouchStart: handleClick, onKeyPress: handleKeyPress }, (tooltip ? { title: tooltip } : {})), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "button-text" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "caret-down", scale: "s", class: "button--icon" }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { ref: (el) => (this.popoverNode = el), label: i18n.layersAndTables, pointerDisabled: true, referenceElement: this.button, closable: true, class: "popover", placement: "bottom", overlayPositioning: "fixed", heading: i18n.layersAndTables, onCalcitePopoverOpen: () => {
                var _a;
                (_a = this.telemetry) === null || _a === void 0 ? void 0 : _a.logEvent({
                    category: "preview popup",
                    action: "click",
                    pageName: (0,_telemetry_49d4aa88_js__WEBPACK_IMPORTED_MODULE_4__.g)(),
                    pageUrl: window.location.href
                });
                window.addEventListener("click", this.handleWindowClick);
            }, onCalcitePopoverClose: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.d)(() => {
                var _a;
                (_a = this.telemetry) === null || _a === void 0 ? void 0 : _a.logEvent({
                    category: "preview popup",
                    action: "close",
                    pageName: (0,_telemetry_49d4aa88_js__WEBPACK_IMPORTED_MODULE_4__.g)(),
                    pageUrl: window.location.href
                });
                window.removeEventListener("click", this.handleWindowClick);
            }, 200) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "popover-content" }, loading ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-left" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-main" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-title" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-subtitle" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "skeleton-right" })))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-layers-and-tables-summary", { portal: portal, user: user, item: item, layers: layers, showMatched: searchTerm && !!this.layers, error: error,
            // @ts-ignore
            loading: !this.sublayers, telemetry: telemetry, onLayersAndTablesFocusEnd: () => {
                this.popoverNode.open = false;
            } })))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayersAndTablesSummaryPopup.style = arcgisLayersAndTablesSummaryPopupCss;



//# sourceMappingURL=arcgis-layers-and-tables-summary-popup.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLayer),
/* harmony export */   f: () => (/* binding */ fetchFeatureServiceInfo),
/* harmony export */   s: () => (/* binding */ setMatched)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function parseSublayer(sublayer, layers, isTable) {
    var _a, _b;
    return {
        description: sublayer.description,
        fieldAliases: (_a = sublayer.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
        fields: sublayer.fields,
        geometryType: isTable ? "table" : sublayer.geometryType,
        id: sublayer.id,
        title: sublayer.name,
        type: sublayer.type,
        matched: (_b = layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === sublayer.id)) === null || _b === void 0 ? void 0 : _b.matched
    };
}
function serverRequest(url, isSecure) {
    const { config } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const hosted = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_2__.a)(url);
    const requestOptions = Object.assign(Object.assign({ useProxy: false, timeout: config.isMultiTenant === false ? 60000 : 5000, addSSL: hosted }, (isSecure ? {} : { addTokenManually: false })), { usePost: true, disableIdentityLookup: true });
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, requestOptions, "post");
}
function getErrorCode(error) {
    var _a, _b;
    return (error === null || error === void 0 ? void 0 : error.code) || ((_b = (_a = error === null || error === void 0 ? void 0 : error.details) === null || _a === void 0 ? void 0 : _a.raw) === null || _b === void 0 ? void 0 : _b.code);
}
function serviceDoesNotExist(error) {
    const code = getErrorCode(error);
    return [404, 500].includes(code) || (error === null || error === void 0 ? void 0 : error.message) === "Invalid URL";
}
function shouldRetryWithToken(isSecure, error) {
    const code = getErrorCode(error);
    return !isSecure && ((code === 499 && (error === null || error === void 0 ? void 0 : error.message) === "Token Required") || code === 403) && !!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
}
async function fetchLayer(portal, id, url, isSecure) {
    const errorResult = { error: { code: "unhandledError" } };
    try {
        try {
            const result = await serverRequest(`${url}/${id}`, isSecure);
            return { result };
        }
        catch (error) {
            if (shouldRetryWithToken(isSecure, error)) {
                return fetchLayer(portal, id, url, true);
            }
            if (serviceDoesNotExist(error)) {
                errorResult.error.code = "serviceNotExist";
            }
            return errorResult;
        }
    }
    catch (error) {
        return errorResult;
    }
}
function filterLayers(layers, matchedLayers, data, isTable) {
    var _a, _b;
    const hasTables = data === null || data === void 0 ? void 0 : data.tables;
    const hasDefinedDataLayers = ((_a = data === null || data === void 0 ? void 0 : data.layers) === null || _a === void 0 ? void 0 : _a.length) > 0 || hasTables;
    const ids = [...((data === null || data === void 0 ? void 0 : data.layers) || []).map((layer) => layer.id), ...(_b = ((data === null || data === void 0 ? void 0 : data.tables) || [])) === null || _b === void 0 ? void 0 : _b.map((table) => table.id)];
    // if data has defined layers, only use layers in data, not the whole service (WebGIS/arcgis-portal-app#39768)
    // if data has defined layers, but no defined tables, allow all tables through (WebGIS/arcgis-portal-app#40067)
    const sublayers = (layers || [])
        .filter(({ id, type }) => !hasDefinedDataLayers || (type === "Table" && !hasTables) || ids.includes(id))
        .map((layer) => parseSublayer(layer, matchedLayers, isTable));
    return sublayers;
}
async function fetchLayers({ serviceInfo, item, layers, isSecure, data }) {
    var _a, _b;
    const { url } = item;
    if (!((_a = serviceInfo.layers) === null || _a === void 0 ? void 0 : _a.length) && !((_b = serviceInfo.tables) === null || _b === void 0 ? void 0 : _b.length) && (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.fields)) {
        return { result: [parseSublayer(serviceInfo, layers)] };
    }
    try {
        const { layers: sublayers, tables } = await serverRequest(`${url}/layers`, isSecure);
        return {
            result: [...filterLayers(sublayers, layers, data), ...filterLayers(tables, layers, data, true)].sort((a, b) => a.id - b.id)
        };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}
function setMatched(sublayers, matchedLayers) {
    return sublayers.map((sublayer) => {
        var _a;
        return Object.assign(Object.assign({}, sublayer), { matched: (_a = matchedLayers === null || matchedLayers === void 0 ? void 0 : matchedLayers.find((layer) => layer.id === sublayer.id)) === null || _a === void 0 ? void 0 : _a.matched });
    });
}
async function fetchFeatureServiceInfo({ item, portal, layers, isSecure, data, retry }) {
    var _a;
    const errorResult = { error: { code: "unhandledError" } };
    try {
        if (!data && !retry) {
            try {
                const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)(portal);
                const tokenParam = token ? `&token=${token}` : "";
                const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${item.id}/data?f=json${tokenParam}`;
                // Use fetch instead of request to stop redirects (WebGIS/arcgis-portal-app#40164)
                const response = await fetch(url);
                const text = await response.text();
                if (text) {
                    data = JSON.parse(text);
                }
                if (data === null || data === void 0 ? void 0 : data.error) {
                    // Treat this expired account as if the service doesn't exist (WebGIS/arcgis-portal-app#40163)
                    if (data.error.code === 403 && ((_a = data.error) === null || _a === void 0 ? void 0 : _a.messageCode) === "SB_0006") {
                        errorResult.error.code = "serviceNotExist";
                        return errorResult;
                    }
                }
            }
            catch (error) {
                // if we can't get item data, just move on
                data = null;
            }
        }
        if (item.type === "Feature Collection") {
            if (data === null || data === void 0 ? void 0 : data.layers) {
                return {
                    result: data.layers.map(({ layerDefinition }, id) => {
                        var _a;
                        return ({
                            description: "",
                            fields: layerDefinition.fields,
                            fieldAliases: (_a = layerDefinition.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
                            geometryType: layerDefinition.geometryType,
                            type: layerDefinition.type,
                            id,
                            matched: false,
                            title: layerDefinition.name
                        });
                    })
                };
            }
        }
        try {
            const { url } = item;
            const serviceInfo = await serverRequest(url, isSecure);
            return fetchLayers({
                serviceInfo,
                item,
                layers,
                isSecure,
                data
            });
        }
        catch (error) {
            if (shouldRetryWithToken(isSecure, error)) {
                return fetchFeatureServiceInfo({ item, portal, layers, data, isSecure: true });
            }
            if (serviceDoesNotExist(error)) {
                errorResult.error.code = "serviceNotExist";
            }
            return errorResult;
        }
    }
    catch (error) {
        return errorResult;
    }
}



//# sourceMappingURL=services-5925c4b4.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-49d4aa88.js":
/*!***************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/telemetry-49d4aa88.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getPageName)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function getPageName() {
    const { hash, pathname } = window.location;
    if (pathname.includes("group.html")) {
        return "group page";
    }
    if (pathname.includes("search.html")) {
        return "search result page";
    }
    switch (hash) {
        case "#favorites":
            return "favorites";
        case "#groups":
            return "my groups content";
        case "#organization":
            return "my org content";
        case "#livingAtlas":
            return "living atlas";
        default:
            return "my content";
    }
}



//# sourceMappingURL=telemetry-49d4aa88.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQyYjRmOS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDMkY7QUFDckI7QUFDZjtBQUNDO0FBQ0c7QUFDYTtBQUNlO0FBQzVEO0FBQ1M7QUFDRDtBQUNMO0FBQ0g7QUFDQTtBQUNJO0FBQ0o7O0FBRTNCLDZCQUE2QixxREFBVyxHQUFHO0FBQzNDOztBQUVBLG9EQUFvRCxlQUFlLGdEQUFnRCxrQkFBa0IsaUJBQWlCLFlBQVksZ0JBQWdCLGlEQUFpRCxVQUFVLFlBQVksbUJBQW1CLGlCQUFpQixJQUFJLFlBQVksVUFBVSx5REFBeUQsZUFBZSwrQ0FBK0Msa0JBQWtCLGFBQWEsK0JBQStCLFlBQVksV0FBVywrQ0FBK0MsZUFBZSxpQkFBaUIsa0JBQWtCLFlBQVksZ0JBQWdCLFlBQVksK0NBQStDLG1CQUFtQixtQkFBbUIsWUFBWSwrQ0FBK0MsaUJBQWlCLFFBQVEsVUFBVSxJQUFJLGFBQWEsUUFBUSxlQUFlLGVBQWUsa0JBQWtCLFlBQVksOEJBQThCLG1CQUFtQix3QkFBd0IsY0FBYyx1QkFBdUIsb0JBQW9CLGtCQUFrQixnQkFBZ0IsY0FBYyw2Q0FBNkMsbUJBQW1CLGdCQUFnQixvQkFBb0IscUJBQXFCLG9CQUFvQix1QkFBdUIsbURBQW1ELHNCQUFzQixpQkFBaUIsYUFBYSxvQkFBb0IsYUFBYSxjQUFjLDRCQUE0QixvQkFBb0I7O0FBRWg3QztBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEI7QUFDQTtBQUNBLG9CQUFvQixlQUFlO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyx3REFBVTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLGlCQUFpQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsNENBQTRDO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBFOztBQUUxRTs7Ozs7Ozs7Ozs7Ozs7QUN6S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaUJBQWlCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU0Qjs7QUFFNUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbGF5ZXJzLWFuZC10YWJsZXMtc3VtbWFyeS1wb3B1cC5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3NlcnZpY2VzLTU5MjVjNGI0LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3RlbGVtZXRyeS00OWQ0YWE4OC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFBhZ2VOYW1lIH0gZnJvbSAnLi90ZWxlbWV0cnktNDlkNGFhODguanMnO1xuaW1wb3J0IHsgbSBhcyBtaW5EZWxheSwgZCBhcyBkZWJvdW5jZSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBzIGFzIHNldE1hdGNoZWQsIGYgYXMgZmV0Y2hGZWF0dXJlU2VydmljZUluZm8gfSBmcm9tICcuL3NlcnZpY2VzLTU5MjVjNGI0LmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi91cmwtMzU4NzVhMTAuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0ICcuL2Fncy1lYjQ1OGEwMy5qcyc7XG5cbmNvbnN0IGxheWVyc0FuZFRhYmxlc1N0b3JlID0gY3JlYXRlU3RvcmUoe30pO1xuY29uc3QgbGF5ZXJzQW5kVGFibGVzU3RhdGUgPSBsYXllcnNBbmRUYWJsZXNTdG9yZS5zdGF0ZTtcblxuY29uc3QgYXJjZ2lzTGF5ZXJzQW5kVGFibGVzU3VtbWFyeVBvcHVwQ3NzID0gXCI6aG9zdHttYXgtd2lkdGg6MTAwJX1hcmNnaXMtbGF5ZXJzLWFuZC10YWJsZXMtc3VtbWFyeTpub3QoLmh5ZHJhdGVkKXt2aXNpYmlsaXR5OmhpZGRlbn0ucG9wb3Zlci1jb250ZW50e3dpZHRoOjM4MHB4O21pbi1oZWlnaHQ6NnJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCl9LnNrZWxldG9ue21hcmdpbjoxcmVtO21hcmdpbi1ib3R0b206M3JlbX1Aa2V5ZnJhbWVzIHB1bHNlezUwJXtvcGFjaXR5Oi41fX0uc2tlbGV0b257YW5pbWF0aW9uOnB1bHNlIDJzIGN1YmljLWJlemllcigwLjQsIDAsIDAuNiwgMSkgaW5maW5pdGU7cGFkZGluZzowLjVyZW07Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0yKX0uc2tlbGV0b24tY29udGVudHtkaXNwbGF5OmZsZXh9LnNrZWxldG9uLWxlZnQsLnNrZWxldG9uLXJpZ2h0e2hlaWdodDoxcmVtO3dpZHRoOjFyZW07YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0zKX0uc2tlbGV0b24tbWFpbnttYXJnaW4tbGVmdDoxcmVtO21hcmdpbi1yaWdodDoxcmVtO2ZsZXg6MSAxIDAlfS5za2VsZXRvbi10aXRsZXtoZWlnaHQ6MXJlbTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTIpfS5za2VsZXRvbi1zdWJ0aXRsZXttYXJnaW4tdG9wOjAuMjVyZW07aGVpZ2h0OjFyZW07YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0zKX1Aa2V5ZnJhbWVzIHB1bHNlezAlLDEwMCV7b3BhY2l0eToxfTUwJXtvcGFjaXR5OjAuNX19LmJ1dHRvbnttYXgtd2lkdGg6MTAwJTtjdXJzb3I6cG9pbnRlcjtib3JkZXItc3R5bGU6bm9uZTtwYWRkaW5nOjBweDtvdXRsaW5lOjJweCBzb2xpZCB0cmFuc3BhcmVudDtvdXRsaW5lLW9mZnNldDoycHg7dHJhbnNpdGlvbi1wcm9wZXJ0eTphbGw7Y29sb3I6aW5oZXJpdDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2ZvbnQtZmFtaWx5OmluaGVyaXQ7Zm9udC1zaXplOmluaGVyaXQ7bGluZS1oZWlnaHQ6MS41fS5idXR0b246Zm9jdXN7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCk7b3V0bGluZS1vZmZzZXQ6NHB4fS5idXR0b24tLWJvcmRlcntwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3BhZGRpbmctdG9wOjAuMjVyZW07cGFkZGluZy1ib3R0b206MC4yNXJlbTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKX0uYnV0dG9uLS1ib3JkZXI6Zm9jdXN7b3V0bGluZS1vZmZzZXQ6MH0uYnV0dG9uLXRleHR7cG9pbnRlci1ldmVudHM6bm9uZTtkaXNwbGF5OmZsZXh9LmJ1dHRvbi0taWNvbnttYXJnaW4taW5saW5lLXN0YXJ0OjAuMjVyZW07dmVydGljYWwtYWxpZ246LTNweH1cIjtcblxuY29uc3QgQXJjZ2lzTGF5ZXJzQW5kVGFibGVzU3VtbWFyeVBvcHVwID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5oYW5kbGVDbGljayA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXJzLCBpdGVtIH0gPSB0aGlzO1xuICAgICAgICAgICAgKF9hID0gdGhpcy5idXR0b24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb2N1cygpO1xuICAgICAgICAgICAgaWYgKCFsYXllcnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFsYXllcnNBbmRUYWJsZXNTdGF0ZVtpdGVtLmlkXSkge1xuICAgICAgICAgICAgICAgIGxheWVyc0FuZFRhYmxlc1N0YXRlW2l0ZW0uaWRdID0gdGhpcy5mZXRjaFNlcnZpY2VJbmZvKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGxheWVyc0FuZFRhYmxlc1N0YXRlW2l0ZW0uaWRdO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMuaTE4bi5lcnJvcjtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IuY29kZSA9PT0gXCJzZXJ2aWNlTm90RXhpc3RcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLm1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3Iubm9TZXJ2aWNlTWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdWJsYXllcnMgPSBzZXRNYXRjaGVkKHJlc3BvbnNlLnJlc3VsdCwgbGF5ZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VibGF5ZXJzID0gbGF5ZXJzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlV2luZG93Q2xpY2sgPSAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuZWwuY29udGFpbnModGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUtleVByZXNzID0gKHsga2V5IH0pID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIkVzY1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJFc2NhcGVcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFwaSA9IDQ7XG4gICAgICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYm9yZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudGVsZW1ldHJ5ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJ1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdWJsYXllcnMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpO1xuICAgICAgICBjb25maWdTdGF0ZS5wb3J0YWwgPSB0aGlzLnBvcnRhbDtcbiAgICAgICAgY29uZmlnU3RhdGUuY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgICAgIGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXI7XG4gICAgICAgIGlmICghdGhpcy5sYXllcnMpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgZmV0Y2hTZXJ2aWNlSW5mbygpIHtcbiAgICAgICAgY29uc3QgeyBpdGVtLCBwb3J0YWwsIGxheWVycyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtaW5EZWxheShmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7IGl0ZW0sIHBvcnRhbCwgbGF5ZXJzLCBpc1NlY3VyZTogZmFsc2UgfSksIDUwMCk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4sIHBvcnRhbCwgdXNlciwgaXRlbSwgaGFuZGxlQ2xpY2ssIGhhbmRsZUtleVByZXNzLCBsb2FkaW5nLCBzZWFyY2hUZXJtLCBlcnJvciwgdG9vbHRpcCwgdGVsZW1ldHJ5IH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBsYXllcnMgPSB0aGlzLnN1YmxheWVycyB8fCB0aGlzLmxheWVycztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgb25Gb2N1c291dDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWUucmVsYXRlZFRhcmdldCB8fCB0aGlzLmVsLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5vcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1wb3BvdmVyLW1hbmFnZXJcIiwgeyBhdXRvQ2xvc2U6IHRydWUgfSwgaChcImJ1dHRvblwiLCBPYmplY3QuYXNzaWduKHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBidXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgXCJidXR0b24tLWJvcmRlclwiOiB0aGlzLmJvcmRlclxuICAgICAgICAgICAgfSwgcmVmOiAoZWwpID0+ICh0aGlzLmJ1dHRvbiA9IGVsKSwgb25DbGljazogaGFuZGxlQ2xpY2ssIG9uVG91Y2hTdGFydDogaGFuZGxlQ2xpY2ssIG9uS2V5UHJlc3M6IGhhbmRsZUtleVByZXNzIH0sICh0b29sdGlwID8geyB0aXRsZTogdG9vbHRpcCB9IDoge30pKSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJidXR0b24tdGV4dFwiIH0sIGgoXCJzbG90XCIsIG51bGwpLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJjYXJldC1kb3duXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwiYnV0dG9uLS1pY29uXCIgfSkpKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IGVsKSwgbGFiZWw6IGkxOG4ubGF5ZXJzQW5kVGFibGVzLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuYnV0dG9uLCBjbG9zYWJsZTogdHJ1ZSwgY2xhc3M6IFwicG9wb3ZlclwiLCBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBoZWFkaW5nOiBpMThuLmxheWVyc0FuZFRhYmxlcywgb25DYWxjaXRlUG9wb3Zlck9wZW46ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgKF9hID0gdGhpcy50ZWxlbWV0cnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2dFdmVudCh7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcInByZXZpZXcgcG9wdXBcIixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcImNsaWNrXCIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOYW1lOiBnZXRQYWdlTmFtZSgpLFxuICAgICAgICAgICAgICAgICAgICBwYWdlVXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVQb3BvdmVyQ2xvc2U6IGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgKF9hID0gdGhpcy50ZWxlbWV0cnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2dFdmVudCh7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcInByZXZpZXcgcG9wdXBcIixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcImNsb3NlXCIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOYW1lOiBnZXRQYWdlTmFtZSgpLFxuICAgICAgICAgICAgICAgICAgICBwYWdlVXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgICAgICAgICB9LCAyMDApIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJwb3BvdmVyLWNvbnRlbnRcIiB9LCBsb2FkaW5nID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJza2VsZXRvblwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJza2VsZXRvbi1jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLWxlZnRcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLW1haW5cIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2tlbGV0b24tdGl0bGVcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZWxldG9uLXN1YnRpdGxlXCIgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2tlbGV0b24tcmlnaHRcIiB9KSkpKSA6IChoKFwiYXJjZ2lzLWxheWVycy1hbmQtdGFibGVzLXN1bW1hcnlcIiwgeyBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgaXRlbTogaXRlbSwgbGF5ZXJzOiBsYXllcnMsIHNob3dNYXRjaGVkOiBzZWFyY2hUZXJtICYmICEhdGhpcy5sYXllcnMsIGVycm9yOiBlcnJvcixcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGxvYWRpbmc6ICF0aGlzLnN1YmxheWVycywgdGVsZW1ldHJ5OiB0ZWxlbWV0cnksIG9uTGF5ZXJzQW5kVGFibGVzRm9jdXNFbmQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJOb2RlLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIH0gfSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNMYXllcnNBbmRUYWJsZXNTdW1tYXJ5UG9wdXAuc3R5bGUgPSBhcmNnaXNMYXllcnNBbmRUYWJsZXNTdW1tYXJ5UG9wdXBDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0xheWVyc0FuZFRhYmxlc1N1bW1hcnlQb3B1cCBhcyBhcmNnaXNfbGF5ZXJzX2FuZF90YWJsZXNfc3VtbWFyeV9wb3B1cCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbGF5ZXJzLWFuZC10YWJsZXMtc3VtbWFyeS1wb3B1cC5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlcXVlc3QsIGUgYXMgZ2V0VG9rZW4sIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgYSBhcyBpc0hvc3RlZFNlcnZpY2UgfSBmcm9tICcuL3VybC0zNTg3NWExMC5qcyc7XG5cbmZ1bmN0aW9uIHBhcnNlU3VibGF5ZXIoc3VibGF5ZXIsIGxheWVycywgaXNUYWJsZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGVzY3JpcHRpb246IHN1YmxheWVyLmRlc2NyaXB0aW9uLFxuICAgICAgICBmaWVsZEFsaWFzZXM6IChfYSA9IHN1YmxheWVyLmZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgoZmllbGQpID0+IGZpZWxkLmFsaWFzKSxcbiAgICAgICAgZmllbGRzOiBzdWJsYXllci5maWVsZHMsXG4gICAgICAgIGdlb21ldHJ5VHlwZTogaXNUYWJsZSA/IFwidGFibGVcIiA6IHN1YmxheWVyLmdlb21ldHJ5VHlwZSxcbiAgICAgICAgaWQ6IHN1YmxheWVyLmlkLFxuICAgICAgICB0aXRsZTogc3VibGF5ZXIubmFtZSxcbiAgICAgICAgdHlwZTogc3VibGF5ZXIudHlwZSxcbiAgICAgICAgbWF0Y2hlZDogKF9iID0gbGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5pZCA9PT0gc3VibGF5ZXIuaWQpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubWF0Y2hlZFxuICAgIH07XG59XG5mdW5jdGlvbiBzZXJ2ZXJSZXF1ZXN0KHVybCwgaXNTZWN1cmUpIHtcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgaG9zdGVkID0gaXNIb3N0ZWRTZXJ2aWNlKHVybCk7XG4gICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oeyB1c2VQcm94eTogZmFsc2UsIHRpbWVvdXQ6IGNvbmZpZy5pc011bHRpVGVuYW50ID09PSBmYWxzZSA/IDYwMDAwIDogNTAwMCwgYWRkU1NMOiBob3N0ZWQgfSwgKGlzU2VjdXJlID8ge30gOiB7IGFkZFRva2VuTWFudWFsbHk6IGZhbHNlIH0pKSwgeyB1c2VQb3N0OiB0cnVlLCBkaXNhYmxlSWRlbnRpdHlMb29rdXA6IHRydWUgfSk7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB7fSwgcmVxdWVzdE9wdGlvbnMsIFwicG9zdFwiKTtcbn1cbmZ1bmN0aW9uIGdldEVycm9yQ29kZShlcnJvcikge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZSkgfHwgKChfYiA9IChfYSA9IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5kZXRhaWxzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmF3KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY29kZSk7XG59XG5mdW5jdGlvbiBzZXJ2aWNlRG9lc05vdEV4aXN0KGVycm9yKSB7XG4gICAgY29uc3QgY29kZSA9IGdldEVycm9yQ29kZShlcnJvcik7XG4gICAgcmV0dXJuIFs0MDQsIDUwMF0uaW5jbHVkZXMoY29kZSkgfHwgKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSA9PT0gXCJJbnZhbGlkIFVSTFwiO1xufVxuZnVuY3Rpb24gc2hvdWxkUmV0cnlXaXRoVG9rZW4oaXNTZWN1cmUsIGVycm9yKSB7XG4gICAgY29uc3QgY29kZSA9IGdldEVycm9yQ29kZShlcnJvcik7XG4gICAgcmV0dXJuICFpc1NlY3VyZSAmJiAoKGNvZGUgPT09IDQ5OSAmJiAoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcIlRva2VuIFJlcXVpcmVkXCIpIHx8IGNvZGUgPT09IDQwMykgJiYgISFjb25maWdTdGF0ZS51c2VyO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIGlzU2VjdXJlKSB7XG4gICAgY29uc3QgZXJyb3JSZXN1bHQgPSB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgdHJ5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZlclJlcXVlc3QoYCR7dXJsfS8ke2lkfWAsIGlzU2VjdXJlKTtcbiAgICAgICAgICAgIHJldHVybiB7IHJlc3VsdCB9O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHNob3VsZFJldHJ5V2l0aFRva2VuKGlzU2VjdXJlLCBlcnJvcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hMYXllcihwb3J0YWwsIGlkLCB1cmwsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JSZXN1bHQuZXJyb3IuY29kZSA9IFwic2VydmljZU5vdEV4aXN0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZXJyb3JSZXN1bHQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICB9XG59XG5mdW5jdGlvbiBmaWx0ZXJMYXllcnMobGF5ZXJzLCBtYXRjaGVkTGF5ZXJzLCBkYXRhLCBpc1RhYmxlKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCBoYXNUYWJsZXMgPSBkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEudGFibGVzO1xuICAgIGNvbnN0IGhhc0RlZmluZWREYXRhTGF5ZXJzID0gKChfYSA9IGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5sYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCB8fCBoYXNUYWJsZXM7XG4gICAgY29uc3QgaWRzID0gWy4uLigoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgfHwgW10pLm1hcCgobGF5ZXIpID0+IGxheWVyLmlkKSwgLi4uKF9iID0gKChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEudGFibGVzKSB8fCBbXSkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5tYXAoKHRhYmxlKSA9PiB0YWJsZS5pZCldO1xuICAgIC8vIGlmIGRhdGEgaGFzIGRlZmluZWQgbGF5ZXJzLCBvbmx5IHVzZSBsYXllcnMgaW4gZGF0YSwgbm90IHRoZSB3aG9sZSBzZXJ2aWNlIChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMzk3NjgpXG4gICAgLy8gaWYgZGF0YSBoYXMgZGVmaW5lZCBsYXllcnMsIGJ1dCBubyBkZWZpbmVkIHRhYmxlcywgYWxsb3cgYWxsIHRhYmxlcyB0aHJvdWdoIChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjNDAwNjcpXG4gICAgY29uc3Qgc3VibGF5ZXJzID0gKGxheWVycyB8fCBbXSlcbiAgICAgICAgLmZpbHRlcigoeyBpZCwgdHlwZSB9KSA9PiAhaGFzRGVmaW5lZERhdGFMYXllcnMgfHwgKHR5cGUgPT09IFwiVGFibGVcIiAmJiAhaGFzVGFibGVzKSB8fCBpZHMuaW5jbHVkZXMoaWQpKVxuICAgICAgICAubWFwKChsYXllcikgPT4gcGFyc2VTdWJsYXllcihsYXllciwgbWF0Y2hlZExheWVycywgaXNUYWJsZSkpO1xuICAgIHJldHVybiBzdWJsYXllcnM7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaExheWVycyh7IHNlcnZpY2VJbmZvLCBpdGVtLCBsYXllcnMsIGlzU2VjdXJlLCBkYXRhIH0pIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgdXJsIH0gPSBpdGVtO1xuICAgIGlmICghKChfYSA9IHNlcnZpY2VJbmZvLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgJiYgISgoX2IgPSBzZXJ2aWNlSW5mby50YWJsZXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpICYmIChzZXJ2aWNlSW5mbyA9PT0gbnVsbCB8fCBzZXJ2aWNlSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZUluZm8uZmllbGRzKSkge1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IFtwYXJzZVN1YmxheWVyKHNlcnZpY2VJbmZvLCBsYXllcnMpXSB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGxheWVyczogc3VibGF5ZXJzLCB0YWJsZXMgfSA9IGF3YWl0IHNlcnZlclJlcXVlc3QoYCR7dXJsfS9sYXllcnNgLCBpc1NlY3VyZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN1bHQ6IFsuLi5maWx0ZXJMYXllcnMoc3VibGF5ZXJzLCBsYXllcnMsIGRhdGEpLCAuLi5maWx0ZXJMYXllcnModGFibGVzLCBsYXllcnMsIGRhdGEsIHRydWUpXS5zb3J0KChhLCBiKSA9PiBhLmlkIC0gYi5pZClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuZnVuY3Rpb24gc2V0TWF0Y2hlZChzdWJsYXllcnMsIG1hdGNoZWRMYXllcnMpIHtcbiAgICByZXR1cm4gc3VibGF5ZXJzLm1hcCgoc3VibGF5ZXIpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzdWJsYXllciksIHsgbWF0Y2hlZDogKF9hID0gbWF0Y2hlZExheWVycyA9PT0gbnVsbCB8fCBtYXRjaGVkTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXRjaGVkTGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5pZCA9PT0gc3VibGF5ZXIuaWQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWF0Y2hlZCB9KTtcbiAgICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoRmVhdHVyZVNlcnZpY2VJbmZvKHsgaXRlbSwgcG9ydGFsLCBsYXllcnMsIGlzU2VjdXJlLCBkYXRhLCByZXRyeSB9KSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGVycm9yUmVzdWx0ID0geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghZGF0YSAmJiAhcmV0cnkpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbihwb3J0YWwpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuUGFyYW0gPSB0b2tlbiA/IGAmdG9rZW49JHt0b2tlbn1gIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfWNvbnRlbnQvaXRlbXMvJHtpdGVtLmlkfS9kYXRhP2Y9anNvbiR7dG9rZW5QYXJhbX1gO1xuICAgICAgICAgICAgICAgIC8vIFVzZSBmZXRjaCBpbnN0ZWFkIG9mIHJlcXVlc3QgdG8gc3RvcCByZWRpcmVjdHMgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDE2NClcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBUcmVhdCB0aGlzIGV4cGlyZWQgYWNjb3VudCBhcyBpZiB0aGUgc2VydmljZSBkb2Vzbid0IGV4aXN0IChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjNDAxNjMpXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmVycm9yLmNvZGUgPT09IDQwMyAmJiAoKF9hID0gZGF0YS5lcnJvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1lc3NhZ2VDb2RlKSA9PT0gXCJTQl8wMDA2XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yUmVzdWx0LmVycm9yLmNvZGUgPSBcInNlcnZpY2VOb3RFeGlzdFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgd2UgY2FuJ3QgZ2V0IGl0ZW0gZGF0YSwganVzdCBtb3ZlIG9uXG4gICAgICAgICAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJGZWF0dXJlIENvbGxlY3Rpb25cIikge1xuICAgICAgICAgICAgaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5sYXllcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IGRhdGEubGF5ZXJzLm1hcCgoeyBsYXllckRlZmluaXRpb24gfSwgaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogbGF5ZXJEZWZpbml0aW9uLmZpZWxkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEFsaWFzZXM6IChfYSA9IGxheWVyRGVmaW5pdGlvbi5maWVsZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKGZpZWxkKSA9PiBmaWVsZC5hbGlhcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnlUeXBlOiBsYXllckRlZmluaXRpb24uZ2VvbWV0cnlUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGxheWVyRGVmaW5pdGlvbi50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBsYXllckRlZmluaXRpb24ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyB1cmwgfSA9IGl0ZW07XG4gICAgICAgICAgICBjb25zdCBzZXJ2aWNlSW5mbyA9IGF3YWl0IHNlcnZlclJlcXVlc3QodXJsLCBpc1NlY3VyZSk7XG4gICAgICAgICAgICByZXR1cm4gZmV0Y2hMYXllcnMoe1xuICAgICAgICAgICAgICAgIHNlcnZpY2VJbmZvLFxuICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgbGF5ZXJzLFxuICAgICAgICAgICAgICAgIGlzU2VjdXJlLFxuICAgICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKHNob3VsZFJldHJ5V2l0aFRva2VuKGlzU2VjdXJlLCBlcnJvcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hGZWF0dXJlU2VydmljZUluZm8oeyBpdGVtLCBwb3J0YWwsIGxheWVycywgZGF0YSwgaXNTZWN1cmU6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VydmljZURvZXNOb3RFeGlzdChlcnJvcikpIHtcbiAgICAgICAgICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZmV0Y2hMYXllciBhcyBhLCBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyBhcyBmLCBzZXRNYXRjaGVkIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VydmljZXMtNTkyNWM0YjQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5mdW5jdGlvbiBnZXRQYWdlTmFtZSgpIHtcbiAgICBjb25zdCB7IGhhc2gsIHBhdGhuYW1lIH0gPSB3aW5kb3cubG9jYXRpb247XG4gICAgaWYgKHBhdGhuYW1lLmluY2x1ZGVzKFwiZ3JvdXAuaHRtbFwiKSkge1xuICAgICAgICByZXR1cm4gXCJncm91cCBwYWdlXCI7XG4gICAgfVxuICAgIGlmIChwYXRobmFtZS5pbmNsdWRlcyhcInNlYXJjaC5odG1sXCIpKSB7XG4gICAgICAgIHJldHVybiBcInNlYXJjaCByZXN1bHQgcGFnZVwiO1xuICAgIH1cbiAgICBzd2l0Y2ggKGhhc2gpIHtcbiAgICAgICAgY2FzZSBcIiNmYXZvcml0ZXNcIjpcbiAgICAgICAgICAgIHJldHVybiBcImZhdm9yaXRlc1wiO1xuICAgICAgICBjYXNlIFwiI2dyb3Vwc1wiOlxuICAgICAgICAgICAgcmV0dXJuIFwibXkgZ3JvdXBzIGNvbnRlbnRcIjtcbiAgICAgICAgY2FzZSBcIiNvcmdhbml6YXRpb25cIjpcbiAgICAgICAgICAgIHJldHVybiBcIm15IG9yZyBjb250ZW50XCI7XG4gICAgICAgIGNhc2UgXCIjbGl2aW5nQXRsYXNcIjpcbiAgICAgICAgICAgIHJldHVybiBcImxpdmluZyBhdGxhc1wiO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIFwibXkgY29udGVudFwiO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZ2V0UGFnZU5hbWUgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD10ZWxlbWV0cnktNDlkNGFhODguanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9