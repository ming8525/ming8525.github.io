"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-4a244f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-raster-gallery.entry.js":
/*!*********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-raster-gallery.entry.js ***!
  \*********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_raster_gallery: () => (/* binding */ ArcgisSmartMappingPanelsRasterGallery)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./raster-renderer-a62f152c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-renderer-a62f152c.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./raster-flow-761a3470.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-flow-761a3470.js");
/* harmony import */ var _raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./raster-class-breaks-50c446bd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-class-breaks-50c446bd.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _raster_symbolStyler_9b32ef48_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./raster-symbolStyler-9b32ef48.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-symbolStyler-9b32ef48.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */















/**
 * creates a Shaded Relief renderer with default settings
 */
function createShadedReliefRenderer() {
    const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
    const layer = smLayer;
    const rasterFunction = layer.type === "imagery" ? layer.rasterFunction : undefined;
    return modules.RasterShadedReliefCreator.createRenderer({ layer, rasterFunction });
}

/**
 * creates a Colormap renderer with default settings
 */
async function createColormapRenderer() {
    const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
    const layer = smLayer;
    const rasterFunction = layer.type === "imagery" ? layer.rasterFunction : undefined;
    return modules.RasterColormapCreator.createRenderer({
        layer,
        rasterFunction
    }).then((result) => {
        result.renderer.colormapInfos.forEach((colormapInfo, idx) => {
            if (!colormapInfo.label) {
                // workaround for allowing empty labels. We keep values with no labels in our table for parity with Pro.
                result.renderer.colormapInfos[idx].label = " ";
            }
        });
        return Promise.resolve(result);
    });
}

function createCertainRasterRenderer(type, galleryRequestWrapper) {
    switch (type) {
        case "raster-flow":
            galleryRequestWrapper((0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_7__.c)());
            break;
        case "raster-vector-field":
            galleryRequestWrapper((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.a)());
            break;
        case "raster-stretch":
            galleryRequestWrapper((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a3)());
            break;
        case "raster-rgb":
            galleryRequestWrapper((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a2)());
            break;
        case "raster-shaded-relief":
            galleryRequestWrapper(createShadedReliefRenderer());
            break;
        case "raster-class-breaks":
            galleryRequestWrapper((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.c)());
            break;
        case "raster-colormap":
            galleryRequestWrapper(createColormapRenderer());
            break;
        case "raster-unique-value":
            galleryRequestWrapper((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a1)());
            break;
    }
}

const arcgisSmartMappingPanelsRasterGalleryCss = ".styles-msg-title{margin-top:12px;padding:6px;font-weight:bold;font-size:16px;display:flex}.styles-msg{font-size:var(--calcite-font-size--2)}";

const ArcgisSmartMappingPanelsRasterGallery = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterGalleryClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterGalleryClose", 7);
        this.arcgisSmartMappingPanelsRasterGalleryError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterGalleryError", 7);
        this.tileNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleSelectClick = (type) => {
            createCertainRasterRenderer(type, this.galleryRequestWrapper);
        };
        this.handleOptionsClick = (type) => {
            switch (type) {
                case "raster-class-breaks": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-class-breaks");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-colormap": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-colormap");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterColormapClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterColormapBackClick", () => this.focusSelectedTile());
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-flow": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-flow");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterFlowClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterFlowBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterFlowError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-rgb": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-rgb");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterRgbClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterRgbBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterRgbError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-shaded-relief": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-shaded-relief");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-stretch": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-stretch");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterStretchClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterStretchBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterStretchError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-unique-value": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-unique-value");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
                case "raster-vector-field": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-raster-vector-field");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldClose", () => {
                        this.flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldError", ({ detail }) => this.arcgisSmartMappingPanelsRasterGalleryError.emit(detail));
                    this.flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterGalleryClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj, originalEffect, originalBandCombination } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            layer.effect = originalEffect;
            layer.bandIds = originalBandCombination;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterGalleryClose.emit("cancel");
        };
        /*
         * Place panel in loading mode during renderer creation.
         */
        this.galleryRequestWrapper = (request) => {
            const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)(request, this.flowItemNode).then((result) => {
                const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer.clone(), layer);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, () => {
                this.arcgisSmartMappingPanelsRasterGalleryError.emit({
                    message: strings.panels.gallery.errors.changeRendererErrorMsg,
                    type: "warning"
                });
            });
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        await modules.smartMappingRasterUtils
            .getSupportedRendererInfo({ layer })
            .then((response) => {
            this.supportedRendererTypes = response.supportedTypes;
            if (!layer.renderer) {
                layer.renderer = response.defaultRenderer;
            }
            // save original renderer, effect, and band combination
            // TODO: add other raster renderer types
            this.originalRendererObj = layer.renderer;
            this.originalEffect = layer.effect;
            this.originalBandCombination = layer.bandIds || [];
        });
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    componentDidUpdate() {
        setTimeout(() => { var _a; return (_a = this.tileNodes[0]) === null || _a === void 0 ? void 0 : _a.setFocus(); }, 300);
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.rasterGallery.style, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.C.rtl]: isRTL
            }, closable: true, menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, ref: (node) => (this.flowItemNode = node) }, this.renderRasterGalleryContent())));
    }
    renderRasterGalleryContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.renderStyleOptions(), this.renderDoneButton(), this.renderCancelButton()));
    }
    renderStyleOptions() {
        const { modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        const supportedRendererTypes = modules.esriLang.clone(this.supportedRendererTypes);
        const orderedList = supportedRendererTypes.sort((supportedRendererType) => supportedRendererType === rendererType ? -1 : 1);
        const styleTiles = orderedList.map((style, idx) => {
            return this.renderStyleTile(style, idx);
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "styles-msg-title" }, strings.panels.rasterGallery.symbologyOptions), styleTiles));
    }
    renderStyleTile(type, idx) {
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { key: `tile-${type}`, tileType: "gallery", type: type, selected: type === rendererType, ref: (node) => {
                if (node) {
                    this.tileNodes[idx] = node;
                }
            }, onArcgisSmartMappingTileSelect: () => this.handleSelectClick(type), onArcgisSmartMappingTileOptions: () => this.handleOptionsClick(type) }));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => { var _a; return (_a = this.tileNodes[0]) === null || _a === void 0 ? void 0 : _a.setFocus(); }), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterGallery.style = arcgisSmartMappingPanelsRasterGalleryCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-raster-gallery.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTRhMjQ0Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM4STtBQUM2RDtBQUMvSTtBQUN6QjtBQUNBO0FBQ2tFO0FBQ3ZDO0FBQ007QUFDK0M7QUFDckY7QUFDSDtBQUNFO0FBQ1U7QUFDSTs7QUFFM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBCQUEwQixFQUFFLCtEQUFpQjtBQUN6RDtBQUNBO0FBQ0EsOERBQThELHVCQUF1QjtBQUNyRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMEJBQTBCLEVBQUUsK0RBQWlCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMkRBQWtCO0FBQ3BEO0FBQ0E7QUFDQSxrQ0FBa0MsbUVBQXlCO0FBQzNEO0FBQ0E7QUFDQSxrQ0FBa0Msb0VBQXFCO0FBQ3ZEO0FBQ0E7QUFDQSxrQ0FBa0Msb0VBQWlCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsbUVBQXlCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msb0VBQXlCO0FBQzNEO0FBQ0E7QUFDQTs7QUFFQSxvRUFBb0UsZ0JBQWdCLFlBQVksaUJBQWlCLGVBQWUsYUFBYSxZQUFZLHNDQUFzQzs7QUFFL0w7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDBEQUEwRCxxREFBVztBQUNyRSwwREFBMEQscURBQVc7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Qiw4R0FBOEc7QUFDcEo7QUFDQTtBQUNBLHVEQUF1RCxRQUFRLHFGQUFxRjtBQUNwSjtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRStGOztBQUUvRiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yYXN0ZXItZ2FsbGVyeS5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgZiBhcyBmb3JjZVVwZGF0ZSwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGExIGFzIGNyZWF0ZVVuaXF1ZVZhbHVlUmVuZGVyZXIsIGEyIGFzIGNyZWF0ZVJHQlJlbmRlcmVyLCBhMyBhcyBjcmVhdGVTdHJldGNoUmVuZGVyZXIsIGUgYXMgYXBwbHlSZW5kZXJlciwgRiBhcyBmaW5kUGFyZW50Tm9kZSB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3RXcmFwcGVyIH0gZnJvbSAnLi9sb2FkaW5nLTY5MTM5OTA3LmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0IHsgYSBhcyBhcHBseVJhc3RlclJlbmRlcmVyLCBnIGFzIGdldFJhc3RlclJlbmRlcmVyVHlwZSB9IGZyb20gJy4vcmFzdGVyLXJlbmRlcmVyLWE2MmYxNTJjLmpzJztcbmltcG9ydCB7IEMgYXMgQ1NTX1VUSUxJVFkgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUZsb3dSZW5kZXJlciB9IGZyb20gJy4vcmFzdGVyLWZsb3ctNzYxYTM0NzAuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVDbGFzc0JyZWFrc1JlbmRlcmVyLCBhIGFzIGNyZWF0ZVZlY3RvckZpZWxkUmVuZGVyZXIgfSBmcm9tICcuL3Jhc3Rlci1jbGFzcy1icmVha3MtNTBjNDQ2YmQuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCAnLi9yYXN0ZXItc3ltYm9sU3R5bGVyLTliMzJlZjQ4LmpzJztcblxuLyoqXG4gKiBjcmVhdGVzIGEgU2hhZGVkIFJlbGllZiByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqL1xuZnVuY3Rpb24gY3JlYXRlU2hhZGVkUmVsaWVmUmVuZGVyZXIoKSB7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIGNvbnN0IHJhc3RlckZ1bmN0aW9uID0gbGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5XCIgPyBsYXllci5yYXN0ZXJGdW5jdGlvbiA6IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbW9kdWxlcy5SYXN0ZXJTaGFkZWRSZWxpZWZDcmVhdG9yLmNyZWF0ZVJlbmRlcmVyKHsgbGF5ZXIsIHJhc3RlckZ1bmN0aW9uIH0pO1xufVxuXG4vKipcbiAqIGNyZWF0ZXMgYSBDb2xvcm1hcCByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29sb3JtYXBSZW5kZXJlcigpIHtcbiAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgY29uc3QgcmFzdGVyRnVuY3Rpb24gPSBsYXllci50eXBlID09PSBcImltYWdlcnlcIiA/IGxheWVyLnJhc3RlckZ1bmN0aW9uIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiBtb2R1bGVzLlJhc3RlckNvbG9ybWFwQ3JlYXRvci5jcmVhdGVSZW5kZXJlcih7XG4gICAgICAgIGxheWVyLFxuICAgICAgICByYXN0ZXJGdW5jdGlvblxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICByZXN1bHQucmVuZGVyZXIuY29sb3JtYXBJbmZvcy5mb3JFYWNoKChjb2xvcm1hcEluZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFjb2xvcm1hcEluZm8ubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciBhbGxvd2luZyBlbXB0eSBsYWJlbHMuIFdlIGtlZXAgdmFsdWVzIHdpdGggbm8gbGFiZWxzIGluIG91ciB0YWJsZSBmb3IgcGFyaXR5IHdpdGggUHJvLlxuICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5jb2xvcm1hcEluZm9zW2lkeF0ubGFiZWwgPSBcIiBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2VydGFpblJhc3RlclJlbmRlcmVyKHR5cGUsIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcikge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwicmFzdGVyLWZsb3dcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVGbG93UmVuZGVyZXIoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJhc3Rlci12ZWN0b3ItZmllbGRcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVWZWN0b3JGaWVsZFJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItc3RyZXRjaFwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVN0cmV0Y2hSZW5kZXJlcigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmFzdGVyLXJnYlwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVJHQlJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItc2hhZGVkLXJlbGllZlwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVNoYWRlZFJlbGllZlJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyYXN0ZXItY2xhc3MtYnJlYWtzXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ2xhc3NCcmVha3NSZW5kZXJlcigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmFzdGVyLWNvbG9ybWFwXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JtYXBSZW5kZXJlcigpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmFzdGVyLXVuaXF1ZS12YWx1ZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVVuaXF1ZVZhbHVlUmVuZGVyZXIoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckdhbGxlcnlDc3MgPSBcIi5zdHlsZXMtbXNnLXRpdGxle21hcmdpbi10b3A6MTJweDtwYWRkaW5nOjZweDtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNnB4O2Rpc3BsYXk6ZmxleH0uc3R5bGVzLW1zZ3tmb250LXNpemU6dmFyKC0tY2FsY2l0ZS1mb250LXNpemUtLTIpfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5Q2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckdhbGxlcnlDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5RXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckdhbGxlcnlFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy50aWxlTm9kZXMgPSBbXTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RDbGljayA9ICh0eXBlKSA9PiB7XG4gICAgICAgICAgICBjcmVhdGVDZXJ0YWluUmFzdGVyUmVuZGVyZXIodHlwZSwgdGhpcy5nYWxsZXJ5UmVxdWVzdFdyYXBwZXIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayA9ICh0eXBlKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicmFzdGVyLWNsYXNzLWJyZWFrc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yYXN0ZXItY2xhc3MtYnJlYWtzXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDbGFzc0JyZWFrc0JhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwicmFzdGVyLWNvbG9ybWFwXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJhc3Rlci1jb2xvcm1hcFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNvbG9ybWFwQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwicmFzdGVyLWZsb3dcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtcmFzdGVyLWZsb3dcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJGbG93Q2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0JhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0Vycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckdhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJyYXN0ZXItcmdiXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJhc3Rlci1yZ2JcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclJnYkVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckdhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJyYXN0ZXItc2hhZGVkLXJlbGllZlwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yYXN0ZXItc2hhZGVkLXJlbGllZlwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZkNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZkJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcInJhc3Rlci1zdHJldGNoXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJhc3Rlci1zdHJldGNoXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU3RyZXRjaENsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwicmFzdGVyLXVuaXF1ZS12YWx1ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yYXN0ZXItdW5pcXVlLXZhbHVlXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVW5pcXVlVmFsdWVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJVbmlxdWVWYWx1ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVW5pcXVlVmFsdWVFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwicmFzdGVyLXZlY3Rvci1maWVsZFwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yYXN0ZXItdmVjdG9yLWZpZWxkXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGRDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJWZWN0b3JGaWVsZEJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGRFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyR2FsbGVyeUNsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlck9iaiwgb3JpZ2luYWxFZmZlY3QsIG9yaWdpbmFsQmFuZENvbWJpbmF0aW9uIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBsYXllci5lZmZlY3QgPSBvcmlnaW5hbEVmZmVjdDtcbiAgICAgICAgICAgIGxheWVyLmJhbmRJZHMgPSBvcmlnaW5hbEJhbmRDb21iaW5hdGlvbjtcbiAgICAgICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIob3JpZ2luYWxSZW5kZXJlck9iaiwgbGF5ZXIpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5Q2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgLypcbiAgICAgICAgICogUGxhY2UgcGFuZWwgaW4gbG9hZGluZyBtb2RlIGR1cmluZyByZW5kZXJlciBjcmVhdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2FsbGVyeVJlcXVlc3RXcmFwcGVyID0gKHJlcXVlc3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICByZXF1ZXN0V3JhcHBlcihyZXF1ZXN0LCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIuY2xvbmUoKSwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyR2FsbGVyeUVycm9yLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LmVycm9ycy5jaGFuZ2VSZW5kZXJlckVycm9yTXNnLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGF3YWl0IG1vZHVsZXMuc21hcnRNYXBwaW5nUmFzdGVyVXRpbHNcbiAgICAgICAgICAgIC5nZXRTdXBwb3J0ZWRSZW5kZXJlckluZm8oeyBsYXllciB9KVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN1cHBvcnRlZFJlbmRlcmVyVHlwZXMgPSByZXNwb25zZS5zdXBwb3J0ZWRUeXBlcztcbiAgICAgICAgICAgIGlmICghbGF5ZXIucmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICBsYXllci5yZW5kZXJlciA9IHJlc3BvbnNlLmRlZmF1bHRSZW5kZXJlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXIsIGVmZmVjdCwgYW5kIGJhbmQgY29tYmluYXRpb25cbiAgICAgICAgICAgIC8vIFRPRE86IGFkZCBvdGhlciByYXN0ZXIgcmVuZGVyZXIgdHlwZXNcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlck9iaiA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEVmZmVjdCA9IGxheWVyLmVmZmVjdDtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxCYW5kQ29tYmluYXRpb24gPSBsYXllci5iYW5kSWRzIHx8IFtdO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mbG93Tm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93XCIpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLnRpbGVOb2Rlc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0sIDMwMCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpc1JUTCwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMucmFzdGVyR2FsbGVyeS5zdHlsZSwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IHRydWUsIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlclJhc3RlckdhbGxlcnlDb250ZW50KCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclJhc3RlckdhbGxlcnlDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIHRoaXMucmVuZGVyU3R5bGVPcHRpb25zKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSk7XG4gICAgfVxuICAgIHJlbmRlclN0eWxlT3B0aW9ucygpIHtcbiAgICAgICAgY29uc3QgeyBtb2R1bGVzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmFzdGVyUmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IHN1cHBvcnRlZFJlbmRlcmVyVHlwZXMgPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKHRoaXMuc3VwcG9ydGVkUmVuZGVyZXJUeXBlcyk7XG4gICAgICAgIGNvbnN0IG9yZGVyZWRMaXN0ID0gc3VwcG9ydGVkUmVuZGVyZXJUeXBlcy5zb3J0KChzdXBwb3J0ZWRSZW5kZXJlclR5cGUpID0+IHN1cHBvcnRlZFJlbmRlcmVyVHlwZSA9PT0gcmVuZGVyZXJUeXBlID8gLTEgOiAxKTtcbiAgICAgICAgY29uc3Qgc3R5bGVUaWxlcyA9IG9yZGVyZWRMaXN0Lm1hcCgoc3R5bGUsIGlkeCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyU3R5bGVUaWxlKHN0eWxlLCBpZHgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInN0eWxlcy1tc2ctdGl0bGVcIiB9LCBzdHJpbmdzLnBhbmVscy5yYXN0ZXJHYWxsZXJ5LnN5bWJvbG9neU9wdGlvbnMpLCBzdHlsZVRpbGVzKSk7XG4gICAgfVxuICAgIHJlbmRlclN0eWxlVGlsZSh0eXBlLCBpZHgpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmFzdGVyUmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRpbGVcIiwgeyBrZXk6IGB0aWxlLSR7dHlwZX1gLCB0aWxlVHlwZTogXCJnYWxsZXJ5XCIsIHR5cGU6IHR5cGUsIHNlbGVjdGVkOiB0eXBlID09PSByZW5kZXJlclR5cGUsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1tpZHhdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVTZWxlY3Q6ICgpID0+IHRoaXMuaGFuZGxlU2VsZWN0Q2xpY2sodHlwZSksIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnM6ICgpID0+IHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKHR5cGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIGZvY3VzU2VsZWN0ZWRUaWxlKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMudGlsZU5vZGVzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSksIDMwMCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJHYWxsZXJ5LnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyR2FsbGVyeUNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyR2FsbGVyeSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfcmFzdGVyX2dhbGxlcnkgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJhc3Rlci1nYWxsZXJ5LmVudHJ5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==