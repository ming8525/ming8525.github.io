"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f81c2f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-dependency-check_3.entry.js":
/*!****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-dependency-check_3.entry.js ***!
  \****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_dependency_check: () => (/* binding */ ArcgisDependencyCheck),
/* harmony export */   arcgis_item_share_group: () => (/* binding */ ArcgisItemShareGroup),
/* harmony export */   arcgis_item_share_group_card: () => (/* binding */ ArcgisItemShareGroupCard)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _types_a031c1da_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./types-a031c1da.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js");
/* harmony import */ var _services_66aee31b_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./services-66aee31b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-66aee31b.js");
/* harmony import */ var _utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils-f4f44b88.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-f4f44b88.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */

























const arcgisDependencyCheckCss = ".stage{height:100%;overflow:hidden;transform:translate(0, 0)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}calcite-modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px}.top-bar{font-weight:500;padding-left:1rem;padding-right:1rem;padding-top:1.5rem;padding-bottom:0.5rem;font-size:0.875rem}@media screen and (min-width: 1080px){.top-bar{padding-left:0px;padding-right:0px}}.top-notice{margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:1px solid var(--calcite-color-border-1)}.open-item{margin-inline-start:0.25rem;padding-inline-start:0.25rem;border-inline-start:1px solid var(--calcite-color-border-1)}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}.status-banner--info>calcite-icon{color:var(--calcite-color-status-info)}.compact-grid-content{--arcgis-item-browser-content-spacing:0.5rem}.preview-notice{margin-bottom:1rem}";

const ArcgisDependencyCheck = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.analyzeSharingDetail = async () => {
            let { preProcessedSharingDetail: newShareDetail, items, portal, i18n } = this;
            this.loadingText = "loadingInfo";
            let errorCode;
            if (!this.preProcessedSharingDetail) {
                const analyzeResults = await Promise.all(items.map(({ item, overrideLayers }) => (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_5__.a)(item, portal, overrideLayers, // TODO: remove this assertion when we have a proper type for layerType
                { clearDataCacheOnDone: false })));
                _services_66aee31b_js__WEBPACK_IMPORTED_MODULE_5__.e.forEach((type) => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.c)(type));
                newShareDetail = analyzeResults.reduce((acc, { error, result }) => {
                    // TODO: hair splitting this maybe
                    errorCode = error === null || error === void 0 ? void 0 : error.code;
                    if (result) {
                        Object.keys(result).forEach((key) => {
                            acc[key] = [...acc[key], ...result[key]];
                        });
                    }
                    return acc;
                }, {
                    needEditableLayers: [],
                    needPubliclyEditableLayers: [],
                    needDataCollectionLayers: [],
                    needsShareLevelUpdateLayers: [],
                    premiumLayers: [],
                    notEditableLayers: [],
                    needBDFSDatastoreUpdate: [],
                    needAuthentication: []
                });
            }
            this.sharingDetail = newShareDetail;
            if (!this.sharingDetail || errorCode === "dataNotAvailable") {
                this.errorMessage = i18n.unableToGetItem;
                return [];
            }
            return this.filterAndGetSharingDetails();
        };
        this.filterAndGetSharingDetails = () => {
            const { sharingDetail } = this;
            if (Object.keys(sharingDetail).every((key) => { var _a; return !((_a = sharingDetail[key]) === null || _a === void 0 ? void 0 : _a.length); })) {
                // No error to show
                return;
            }
            const { needEditableLayers, needsShareLevelUpdateLayers, needBDFSDatastoreUpdate } = sharingDetail;
            this.needsShareLevelUpdateLayers = needsShareLevelUpdateLayers;
            this.needEditableLayers = needEditableLayers;
            this.needBDFSDatastoreUpdate = needBDFSDatastoreUpdate;
            this.shareableItemCount = [
                ...needsShareLevelUpdateLayers,
                ...needEditableLayers,
                ...needBDFSDatastoreUpdate
            ].length;
            const displayItems = Object.keys(sharingDetail).reduce((acc, key) => {
                var _a;
                (_a = sharingDetail[key]) === null || _a === void 0 ? void 0 : _a.forEach((layer) => {
                    acc.push({ item: layer.sourceItem, state: key });
                });
                return acc;
            }, []);
            this.displayItems = displayItems;
            return displayItems;
        };
        this.closeDialog = () => {
            this.workflowCancel.emit();
        };
        this.updateSharing = async () => {
            const { needsShareLevelUpdateLayers, needEditableLayers, needBDFSDatastoreUpdate, portal, items } = this;
            this.isLoading = true;
            this.loadingText = "updatingSharing";
            const needsUpdateLayerInfo = [...needsShareLevelUpdateLayers, ...needEditableLayers];
            const updatedSourceItems = needsUpdateLayerInfo.map(({ sourceItem }) => sourceItem);
            const shouldUpdateShareLevel = needsUpdateLayerInfo.some(({ detail }) => detail.needsShareLevelUpdate);
            const newShareLevel = shouldUpdateShareLevel
                ? // ! This assume all items have the same level of access because that's the only use case right now
                    items[0].item.access
                : null;
            /**
             * BDFS and data store stuff ----------------------------------------
             * non-cloud - 2 types:
             * (1) Big Data File Share item and
             * (2) Data Store.
             *
             * cloud type - 3 types:
             * (1) Big Data File Share item,
             * (2) Data Store (Big Data File Share) and the
             * (3) Data Store (Cloud) items.
             *
             * If user shares the top level item - (1), the dependent data stores (2) and (3) needs to be shared first.
             * If uses share (2), the (3) needs to be shared first.
             * If user only want to share non-cloud (2) and cloud (3), they don’t need to worry about any independent items.
             *
             * That's why this is done first before the actual share call
             */
            const bdfsSourceItems = needBDFSDatastoreUpdate.map(({ sourceItem }) => sourceItem);
            const bdfsItemsToUpdate = bdfsSourceItems.filter((sourceItem) => !sourceItem.typeKeywords.includes("bigDataFileShare"));
            if (bdfsItemsToUpdate.length > 0) {
                await (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_5__.s)(bdfsItemsToUpdate, [], newShareLevel, portal);
            }
            const shouldUpdateGroup = needsUpdateLayerInfo.some(({ detail }) => detail.needsGroupUpdate) &&
                // people in groups can already see the item shared to org or public
                //  so there is no need to share to groups which can cause noises
                newShareLevel !== "public";
            if (!shouldUpdateShareLevel && !shouldUpdateGroup) {
                // The update button shouldn't even show up if there is nothing to update
                console.warn("Unexpected state: no need to update share level or group");
            }
            else {
                await (0,_services_66aee31b_js__WEBPACK_IMPORTED_MODULE_5__.s)(updatedSourceItems, items.map(({ item }) => item), newShareLevel, portal, shouldUpdateGroup);
            }
            this.isLoading = false;
            this.workflowComplete.emit({
                updatedSourceItems: [...updatedSourceItems, ...bdfsSourceItems],
                oldSharingDetail: this.sharingDetail
            });
        };
        this.getStatusInfoForLayerState = (state) => {
            const { helpBase, helpMap } = this.config;
            switch (state) {
                case "needEditableLayers":
                    return {
                        i18nKey: "sharingPDCEnabled",
                        kind: "info"
                    };
                case "needPubliclyEditableLayers":
                case "needDataCollectionLayers":
                    return {
                        i18nKey: "pdc",
                        kind: "danger",
                        link: `${helpBase}${helpMap === null || helpMap === void 0 ? void 0 : helpMap["120004130"]}`
                    };
                case "premiumLayers":
                    return {
                        i18nKey: "premium",
                        kind: "info",
                        link: "https://doc.arcgis.com/en/arcgis-online/reference/faq.htm#SHARE_SUBSCR_LYR"
                    };
                case "notEditableLayers":
                    return { i18nKey: "noPermission", kind: "danger" };
                case "needAuthentication":
                    return { i18nKey: "needsAuthentication", kind: "danger" };
                default:
                    return null;
            }
        };
        this.renderPreviewItemNotice = () => {
            const { previewItemState, getStatusInfoForLayerState, i18n } = this;
            const previewItemStatusInfo = previewItemState
                ? getStatusInfoForLayerState(previewItemState)
                : null;
            if (!previewItemStatusInfo) {
                return null;
            }
            const { i18nKey, kind, link } = previewItemStatusInfo;
            const needShareI18N = i18n.needShare;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, closable: false, scale: "m", kind: kind, slot: "preview-summary-top", class: "preview-notice" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, needShareI18N[i18nKey].panel), link &&
                i18nKey !== "noPermission" &&
                i18nKey !== "sharingPDCEnabled" &&
                i18nKey !== "needsAuthentication" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", href: link, target: "_blank", rel: "noopener" }, needShareI18N[i18nKey].learnMore))));
        };
        this.user = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.api = undefined;
        this.isActive = true;
        this.items = undefined;
        this.preProcessedSharingDetail = undefined;
        this.isLoading = undefined;
        this.sharingDetail = undefined;
        this.sections = [];
        this.needsShareLevelUpdateLayers = [];
        this.needEditableLayers = [];
        this.needBDFSDatastoreUpdate = [];
        this.displayItems = [];
        this.previewItemState = null;
        this.loadingText = "loadingInfo";
        this.errorMessage = null;
        this.shareableItemCount = 0;
    }
    async componentWillLoad() {
        this.items = this.items.map((itemInfo) => {
            var _a;
            return (Object.assign(Object.assign({}, itemInfo), { item: (_a = itemInfo.item.sourceJSON) !== null && _a !== void 0 ? _a : itemInfo.item }));
        });
        const { el } = this;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_3__.g)(el);
        this.i18n = locale[0];
    }
    handleNewPreProcessedSharingDetail() {
        var _a;
        (_a = this.itemBrowserRef) === null || _a === void 0 ? void 0 : _a.refresh();
    }
    componentDidLoad() {
        // Data processing will be handled by item browser on load below
    }
    render() {
        const { updateSharing, isActive, api, closeDialog, i18n, isLoading, loadingText, shareableItemCount, errorMessage, portal, user, config, analyzeSharingDetail, getStatusInfoForLayerState, displayItems, renderPreviewItemNotice } = this;
        const canUpdate = shareableItemCount > 0;
        const hasError = !!errorMessage;
        const needShareI18N = i18n.needShare;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { onCalciteModalClose: closeDialog, open: isActive, outsideCloseDisabled: true, escapeDisabled: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, i18n.updateSharing), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "stage" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { icon: true, open: hasError, label: errorMessage, kind: "danger", onCalciteAlertClose: () => (this.errorMessage = null) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, errorMessage)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: i18n[loadingText] }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser", { fetch: async () => {
                var _a;
                const displayItems = (_a = (await analyzeSharingDetail())) !== null && _a !== void 0 ? _a : [];
                return {
                    total: displayItems.length,
                    nextStart: 0,
                    num: displayItems.length,
                    start: 0,
                    results: displayItems.map(({ item }) => item)
                };
            }, onArcgisItemBrowserPreview: ({ detail: previewItem }) => {
                var _a, _b;
                if (!previewItem) {
                    this.previewItemState = null;
                }
                this.previewItemState =
                    (_b = (_a = displayItems.find(({ item }) => item.id === previewItem.id)) === null || _a === void 0 ? void 0 : _a.state) !== null && _b !== void 0 ? _b : null;
            }, hideContentTop: true, contentPaddedBottom: true, hidePreviewFooters: true, portal: portal, user: user, config: config, selection: "none", api: api, num: _types_a031c1da_js__WEBPACK_IMPORTED_MODULE_4__.a, ref: (ele) => (this.itemBrowserRef = ele) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-content", { class: "compact-grid-content", slot: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-bar" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-notice", innerHTML: i18n[portal.isPortal ? "noticeEnterprise" : "notice"] }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, i18n.canBeShared
            .replace("${count}", shareableItemCount.toString())
            .replace("${total}", displayItems.length.toString()))), displayItems.map(({ item, state }) => {
            const statusInfo = getStatusInfoForLayerState(state);
            const isInfoStatus = (statusInfo === null || statusInfo === void 0 ? void 0 : statusInfo.kind) === "info";
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card", { key: item.id, item: item, portal: portal, user: user, baseUrl: config.baseUrl, preview: "top", showOwner: true, showDateUpdated: true, showItemType: true, showSummary: true, showBadges: true }, statusInfo && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-top", class: {
                    "status-banner": true,
                    "status-banner--info": isInfoStatus
                } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: isInfoStatus ? "information" : "exclamationMarkTriangle", scale: "s" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, needShareI18N[statusInfo.i18nKey].notice))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-end", class: "open-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", appearance: "transparent", kind: "neutral", onClick: () => window.open((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__.g)(item.id, config.baseUrl), "_blank", "noopener") }, i18n.goToItem))));
        })), renderPreviewItemNotice())), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: canUpdate ? "outline" : "solid", kind: "brand", "data-id": "cancelButton", onClick: () => (this.isActive = false), width: "full" }, i18n[canUpdate ? "cancel" : "ok"]), canUpdate && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "solid", kind: "brand", "data-id": "nextButton", onClick: updateSharing, width: "full", disabled: isLoading }, i18n.update))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "preProcessedSharingDetail": ["handleNewPreProcessedSharingDetail"]
    }; }
};
ArcgisDependencyCheck.style = arcgisDependencyCheckCss;

const getUserGroups = async ({ items, portal, shareMode, user }) => {
    try {
        const itemOwner = await getItemOwner({ user, items, portal });
        // Useful in case we're admin trying to change the owner's item
        const allUsers = user.username === itemOwner.username ? [user] : [user, itemOwner];
        const userGroupLookup = await queryUserDetails({
            portal,
            user,
            shareMode,
            itemOwner
        });
        const groupResults = await Promise.all(allUsers.map((currentUser) => getAllGroupsForUser({ user: currentUser, portalUser: user, portal, shareMode, userGroupLookup, items })));
        const flattenedGroups = groupResults.flatMap((result) => result.result);
        const groupIds = flattenedGroups.map(({ id }) => id);
        const uniqueGroups = flattenedGroups.filter((group, i) => groupIds.indexOf(group.id) === i);
        return {
            result: {
                uniqueGroups,
                userGroupLookup,
                allUsers,
                searchUsername: user.username === itemOwner.username ? user.username : itemOwner.username
            }
        };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const MAX_GROUP_SEARCH = 100;
/** Fetch the group for the item that the user is also a part of */
const getItemGroups = async (itemIds, userGroupIds, portal) => {
    try {
        const itemGroupResponses = await Promise.all((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__.g)(userGroupIds, MAX_GROUP_SEARCH).map(async (groupIds) => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal)}/content/itemsgroups`, {
            items: itemIds.join(","),
            groups: groupIds.join(",")
        })));
        const result = {};
        itemGroupResponses.forEach((response) => {
            Object.keys(response).forEach((groupId) => {
                const group = response[groupId];
                if (!result[groupId]) {
                    result[groupId] = group;
                }
                else {
                    result[groupId].items = [...result[groupId].items, ...group.items];
                }
            });
        });
        return { result };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
/**
 * Given a user, get all of their groups using the groups search endpoint
 *
 * pseudocode:
 * get the first 100 groups (the max allowed by groups search endpoint)
 * if that accounts for all of a user's groups, return them
 * else, get all the other groups
 * (in parallel batched requests based on response.nextStart)
 * and return them
 */
const getAllGroupsForUser = async ({ user, portalUser, portal, shareMode, userGroupLookup, items }) => {
    var _a;
    const params = {
        q: (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__.a)({
            shareMode,
            currentUsername: portalUser.username,
            user,
            userGroupLookup,
            isPrivate: ((_a = items[0]) === null || _a === void 0 ? void 0 : _a.access) === "private"
        }),
        num: 100,
        searchUserAccess: "groupMember",
        searchUserName: user.username
    };
    try {
        const firstGroupSearchResult = await fetchGroups(portal, params);
        // if nextStart is -1, we've got all the groups.
        if (firstGroupSearchResult.nextStart === -1) {
            return { result: firstGroupSearchResult.results };
        }
        // if not, we'll have to make n more requests
        // we can do these in parallel, and concatenate them with Promise.all()
        const requestsNeeded = Math.ceil(firstGroupSearchResult.total / 100) - 1;
        const groupSearchPromises = [];
        for (let i = 0; i < requestsNeeded; i++) {
            groupSearchPromises.push(new Promise(async (innerResolve) => {
                const start = (i + 1) * 100 + 1;
                const innerResponse = await fetchGroups(portal, Object.assign(Object.assign({}, params), { start }));
                innerResolve(innerResponse.results);
            }));
        }
        const otherGroupSearchResults = (await Promise.all(groupSearchPromises)).flat();
        return { result: [...firstGroupSearchResult.results, ...otherGroupSearchResults] };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const fetchGroups = (portal, params) => (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_7__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.s)(portal)}/community/groups`, portal, {
    body: params,
    usePost: true
});
const getItemOwner = async ({ user, items, portal }) => {
    var _a;
    if ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_2__.d)(items, user) &&
        (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_10__.p)({ items, user, portal }) &&
        (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_10__.q)(user)) {
        const firstItem = items[0];
        return (_a = firstItem.itemOwner) !== null && _a !== void 0 ? _a : (await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_8__.f)(firstItem.owner, portal));
    }
    return user;
};
const queryUserDetails = async ({ user, portal, shareMode, itemOwner }) => {
    const userDetailResults = await Promise.all([
        (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_8__.f)(user.username, portal),
        // for admin case, we also fetch the item owner's group
        shareMode === "admin" && itemOwner.username !== user.username ? (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_8__.f)(itemOwner.username, portal) : null
    ]);
    return Object.assign({ [user.username]: userDetailResults[0].groups }, (!!userDetailResults[1] && { [itemOwner.username]: userDetailResults[1].groups }));
};

const arcgisItemShareGroupCss = ".content{display:flex;align-items:center;justify-content:space-between;margin-top:1rem}.information-text{font-size:0.875rem;margin-top:0px;margin-bottom:0px}.text-padding{margin-top:0.5rem}";

const ArcgisItemShareGroup = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.editGroupClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "editGroupClick", 7);
        this.dirtyChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dirtyChange", 7);
        this.analyzeUserGroupComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "analyzeUserGroupComplete", 7);
        this.removeClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "removeClick", 7);
        this.revertClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "revertClick", 7);
        this.hasGroups = false;
        this.user = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.items = undefined;
        this.shareMode = undefined;
        this.isLoading = undefined;
        this.i18n = undefined;
        this.selectedGroupData = [];
        this.initialSelectedGroups = [];
        this.canShareItemToGroup = false;
        this.isDirty = false;
        this.isSharingMixed = false;
    }
    handleSelectedGroupsChange(newList) {
        const { user, initialSelectedGroups, items } = this;
        this.canShareItemToGroup = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__.k)(newList, user);
        this.isDirty = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__.i)(newList, initialSelectedGroups);
        this.isSharingMixed = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__.l)(items, newList);
        this.dirtyChange.emit(this.isDirty);
    }
    async componentDidLoad() {
        const { user, portal, items, shareMode } = this;
        this.isLoading = true;
        // TODO: handle error
        const { result } = await getUserGroups({
            user,
            portal,
            items,
            shareMode
        });
        const { uniqueGroups: userGroups, userGroupLookup, searchUsername, allUsers } = result;
        const { result: itemGroupInfo } = await getItemGroups(items.map((item) => item.id), userGroups.map((group) => group.id), portal);
        const initialGroups = userGroups
            // Find the intersect of the groups that the user is a member of
            //  and the groups that the item is shared to
            .filter(({ id }) => !!itemGroupInfo[id])
            .map((group) => ({
            group,
            selectedByItemIds: items
                .filter(({ id }) => !!itemGroupInfo[group.id].items.find((item) => item.itemId === id))
                .map((item) => item.id)
        }));
        this.hasGroups = userGroups.length > 0;
        this.canShareItemToGroup = (0,_utils_f4f44b88_js__WEBPACK_IMPORTED_MODULE_6__.k)(initialGroups, user);
        this.initialSelectedGroups = initialGroups;
        this.isLoading = false;
        this.analyzeUserGroupComplete.emit({
            allUsers,
            initialSelectedGroups: initialGroups,
            userGroupLookup,
            searchUsername
        });
    }
    render() {
        const { i18n, isLoading, canShareItemToGroup, removeClick, revertClick, selectedGroupData, hasGroups, isDirty, isSharingMixed } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.title, headerSideContent: isDirty ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", iconStart: "reset", disabled: isLoading, onClick: () => revertClick.emit() }, i18n.revert)) : (selectedGroupData.length > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", iconStart: "x", disabled: isLoading, onClick: () => removeClick.emit() }, i18n.remove))) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "group-container" }, selectedGroupData.length > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail-stack", { groups: selectedGroupData.map(({ group }) => group) })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text" }, i18n[hasGroups ? "noneYet" : "noGroup"]))), hasGroups && canShareItemToGroup && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { iconStart: "group", appearance: "outline-fill", disabled: isLoading, onClick: () => this.editGroupClick.emit() }, i18n.edit))), !isLoading && isSharingMixed && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information-text text-padding" }, i18n.mixedGroupSharing))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "selectedGroupData": ["handleSelectedGroupsChange"]
    }; }
};
ArcgisItemShareGroup.style = arcgisItemShareGroupCss;

const arcgisItemShareGroupCardCss = ":host{display:contents}";

const ArcgisItemShareGroupCard = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.revertClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "revertClick", 7);
        this.user = undefined;
        this.portal = undefined;
        this.group = undefined;
        this.groupCount = undefined;
        this.initialSelectedGroupDataLookup = undefined;
        this.selectedGroupDataLookup = undefined;
        this.totalItemCount = undefined;
        this.i18n = undefined;
    }
    render() {
        const { group, groupCount, totalItemCount, initialSelectedGroupDataLookup, selectedGroupDataLookup, revertClick, portal, user, i18n } = this;
        const totalItemCountStr = totalItemCount.toString();
        const groupId = group.id;
        const curGroupCount = groupCount[group.id];
        let selectionType = "none";
        switch (true) {
            case curGroupCount < totalItemCount:
                selectionType = "indeterminate";
                break;
            case curGroupCount === totalItemCount:
                selectionType = "all";
                break;
        }
        const initialSelectionType = initialSelectedGroupDataLookup[groupId];
        /**
         * We can't just do initialSelectionType !== selectionType because
         *  initialSelectionType can be undefined if a group is not selected initially
         *  since we construct `initialSelectedGroupDataLookup` based on the pre-selected group
         *  and don't have the knowledge about other groups since they're from the API
         * So it will still show the revert button even if the group is not selected initially and selectionType === "none"
         *  without that condition
         */
        const isGroupSelectionChanged = (!!initialSelectionType || selectionType !== "none") &&
            initialSelectionType !== selectionType;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-card", { group: group, portal: portal, user: user, name: group.title, selected: !!selectedGroupDataLookup[groupId], indeterminate: selectionType === "indeterminate", selection: "multiple", preview: "action", view: "compact", showOwner: true, showDateUpdated: true, showSummary: true, key: groupId }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { slot: "content-end" }, curGroupCount && curGroupCount > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "group-item-counter" }, i18n[isGroupSelectionChanged ? "willShareCountHint" : "sharedCountHint"]
            .replace("${numItem}", curGroupCount.toLocaleString())
            .replace("${totalItem}", totalItemCountStr))), isGroupSelectionChanged && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "revert-single-group-cta", appearance: "transparent", onClick: (event) => {
                event.stopPropagation();
                revertClick.emit();
            } }, i18n.revert)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemShareGroupCard.style = arcgisItemShareGroupCardCss;



//# sourceMappingURL=arcgis-dependency-check_3.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   I: () => (/* binding */ ITEM_BROWSER_BUILT_IN_FILTERS),
/* harmony export */   a: () => (/* binding */ ITEM_BROWSER_MAX_ITEMS)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const ITEM_BROWSER_BUILT_IN_FILTERS = ["folder", "group", "contentType"];
const ITEM_BROWSER_MAX_ITEMS = 99999; // arbitrary large number so it show all items



//# sourceMappingURL=types-a031c1da.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getFolderFromId),
/* harmony export */   b: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   e: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders),
/* harmony export */   u: () => (/* binding */ updateFolder)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



async function fetchUser(username, portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
    var _a;
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return [];
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return null;
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return self.favGroupId;
}
function getUserContentUrl(user, portal) {
    var _a;
    return (_a = user === null || user === void 0 ? void 0 : user.userContentUrl) !== null && _a !== void 0 ? _a : `${portal === null || portal === void 0 ? void 0 : portal.restUrl}/content/users/${user.username}`;
}
async function getUserContent(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
    const url = getUserContentUrl(user, portal);
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { num: 1 });
    return Promise.resolve(response);
}
async function getFolders(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const { folders } = await getUserContent(user);
    const { username } = user;
    const sortedFolders = folders.sort((a, b) => a.title.localeCompare(b.title));
    // add the home folder as if it's in the list
    return [{ username, id: username, title: username, created: "now" }, ...sortedFolders];
}
async function getFolderFromId(folderId, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const folders = await getFolders(user);
    return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
    return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/createFolder`;
    const folderResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
    return folderResponse;
}
async function updateFolder(id, newTitle, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/${id}/updateFolder`;
    try {
        const result = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { newTitle }, {}, "post");
        return { result };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=user-3ea69c3a.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWY4MWMyZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNRO0FBQzlCO0FBQ2pCO0FBQ0o7QUFDZ0U7QUFDYTtBQUNyRjtBQUNOO0FBQ0U7QUFDNkM7QUFDaEU7QUFDTDtBQUNEO0FBQ0Y7QUFDQTtBQUNTO0FBQ0Q7QUFDSTtBQUNQO0FBQ047QUFDUTtBQUNBO0FBQ047O0FBRTVCLHlDQUF5QyxZQUFZLGdCQUFnQiwwQkFBMEIsc0NBQXNDLE9BQU8seUJBQXlCLGNBQWMsa0NBQWtDLDZCQUE2QixTQUFTLGdCQUFnQixrQkFBa0IsbUJBQW1CLG1CQUFtQixzQkFBc0IsbUJBQW1CLHNDQUFzQyxTQUFTLGlCQUFpQixtQkFBbUIsWUFBWSxzQkFBc0IsdUJBQXVCLHNEQUFzRCxXQUFXLDRCQUE0Qiw2QkFBNkIsNERBQTRELGVBQWUsYUFBYSxtQkFBbUIsa0JBQWtCLG1CQUFtQixvQkFBb0IsdUJBQXVCLGtCQUFrQixzREFBc0QsNEJBQTRCLHlCQUF5Qix5Q0FBeUMsb0JBQW9CLGVBQWUsa0NBQWtDLHVDQUF1QyxzQkFBc0IsNkNBQTZDLGdCQUFnQixtQkFBbUI7O0FBRXJxQztBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsOEJBQThCLHFEQUFXO0FBQ3pDLGdDQUFnQyxxREFBVztBQUMzQztBQUNBLGtCQUFrQixpRUFBaUU7QUFDbkY7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFLHNCQUFzQixLQUFLLHdEQUFvQjtBQUNySCxrQkFBa0IsNkJBQTZCO0FBQy9DLGdCQUFnQixvREFBeUIsbUJBQW1CLHNEQUFVO0FBQ3RFLCtEQUErRCxlQUFlO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFD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QUNBO0FBQ0E7QUFDQSxtRkFBbUYsa0RBQVcsd0NBQXdDLGtEQUFXO0FBQ2pKLG1CQUFtQix3QkFBd0Isa0RBQVcsU0FBUztBQUMvRCxpQ0FBaUMsc0RBQU8sUUFBUSxtQkFBbUIsSUFBSTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDakosbUJBQW1CLHdCQUF3QixrREFBVyxTQUFTLEdBQUcsR0FBRztBQUNyRTtBQUNBLDZCQUE2QixzREFBTyxRQUFRLFVBQVUsSUFBSTtBQUMxRCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQixTQUFTO0FBQzFCO0FBQ0E7O0FBRW9NOztBQUVwTSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1kZXBlbmRlbmN5LWNoZWNrXzMuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdHlwZXMtYTAzMWMxZGEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdXNlci0zZWE2OWMzYS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZCBhcyBnZXRFbGVtZW50LCBIIGFzIEhvc3QgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xlYXJDYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsLCBzIGFzIGdldFBvcnRhbFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRJdGVtSG9tZUFwcFVybCwgZCBhcyBpdGVtc0JlbG9uZ1RvVXNlck9yZyB9IGZyb20gJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBhIGFzIElURU1fQlJPV1NFUl9NQVhfSVRFTVMgfSBmcm9tICcuL3R5cGVzLWEwMzFjMWRhLmpzJztcbmltcG9ydCB7IGEgYXMgYW5hbHl6ZVNoYXJpbmdEZXRhaWwsIGUgYXMgZGVwZW5kZW5jeUNoZWNrQ2FjaGVUeXBlcywgcyBhcyBzaGFyZUl0ZW1zVG9TaGFyZWRHcm91cHMgfSBmcm9tICcuL3NlcnZpY2VzLTY2YWVlMzFiLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0VXNlcm5hbWVRdWVyeSwgayBhcyBjYW5TaGFyZUl0ZW1Ub0dyb3VwLCBpIGFzIGlzU2VsZWN0ZWRHcm91cERhdGFEaXJ0eSwgbCBhcyBjaGVja0lmU2hhcmluZ01peGVkIH0gZnJvbSAnLi91dGlscy1mNGY0NGI4OC5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3RGZXRjaCB9IGZyb20gJy4vc2VydmljZS04YzJjNDI0MS5qcyc7XG5pbXBvcnQgeyBmIGFzIGZldGNoVXNlciB9IGZyb20gJy4vdXNlci0zZWE2OWMzYS5qcyc7XG5pbXBvcnQgeyBnIGFzIGNodW5rIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IHAgYXMgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSwgcSBhcyBjYW5WaWV3T3RoZXJzT3JnSXRlbXMgfSBmcm9tICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtODEzNzNmNmQuanMnO1xuaW1wb3J0ICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuaW1wb3J0ICcuL2l0ZW0tYzU4ZmZjZWQuanMnO1xuXG5jb25zdCBhcmNnaXNEZXBlbmRlbmN5Q2hlY2tDc3MgPSBcIi5zdGFnZXtoZWlnaHQ6MTAwJTtvdmVyZmxvdzpoaWRkZW47dHJhbnNmb3JtOnRyYW5zbGF0ZSgwLCAwKX1AbWVkaWEgc2NyZWVuIGFuZCAobWluLXdpZHRoOiAxMDgwcHgpey5zdGFnZXtoZWlnaHQ6bWluKDcwMHB4LCA2MHZoKX19Y2FsY2l0ZS1tb2RhbHstLWNhbGNpdGUtbW9kYWwtY29udGVudC1wYWRkaW5nOjA7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjEwODBweH0udG9wLWJhcntmb250LXdlaWdodDo1MDA7cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtO3BhZGRpbmctdG9wOjEuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07Zm9udC1zaXplOjAuODc1cmVtfUBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDEwODBweCl7LnRvcC1iYXJ7cGFkZGluZy1sZWZ0OjBweDtwYWRkaW5nLXJpZ2h0OjBweH19LnRvcC1ub3RpY2V7bWFyZ2luLWJvdHRvbTowLjc1cmVtO3BhZGRpbmctYm90dG9tOjAuNzVyZW07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSl9Lm9wZW4taXRlbXttYXJnaW4taW5saW5lLXN0YXJ0OjAuMjVyZW07cGFkZGluZy1pbmxpbmUtc3RhcnQ6MC4yNXJlbTtib3JkZXItaW5saW5lLXN0YXJ0OjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xKX0uc3RhdHVzLWJhbm5lcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmctbGVmdDoxcmVtO3BhZGRpbmctcmlnaHQ6MXJlbTtwYWRkaW5nLXRvcDowLjI1cmVtO3BhZGRpbmctYm90dG9tOjAuMjVyZW07Zm9udC1zaXplOjAuNzVyZW07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMil9LnN0YXR1cy1iYW5uZXI+Y2FsY2l0ZS1pY29ue21hcmdpbi1pbmxpbmUtZW5kOjAuNXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1kYW5nZXIpfS5zdGF0dXMtYmFubmVyPnNwYW57bWFyZ2luLXRvcDoycHh9LnN0YXR1cy1iYW5uZXItLWluZm8+Y2FsY2l0ZS1pY29ue2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3Itc3RhdHVzLWluZm8pfS5jb21wYWN0LWdyaWQtY29udGVudHstLWFyY2dpcy1pdGVtLWJyb3dzZXItY29udGVudC1zcGFjaW5nOjAuNXJlbX0ucHJldmlldy1ub3RpY2V7bWFyZ2luLWJvdHRvbToxcmVtfVwiO1xuXG5jb25zdCBBcmNnaXNEZXBlbmRlbmN5Q2hlY2sgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q2FuY2VsID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NhbmNlbFwiLCA3KTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgICAgICB0aGlzLmFuYWx5emVTaGFyaW5nRGV0YWlsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IHsgcHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbDogbmV3U2hhcmVEZXRhaWwsIGl0ZW1zLCBwb3J0YWwsIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdUZXh0ID0gXCJsb2FkaW5nSW5mb1wiO1xuICAgICAgICAgICAgbGV0IGVycm9yQ29kZTtcbiAgICAgICAgICAgIGlmICghdGhpcy5wcmVQcm9jZXNzZWRTaGFyaW5nRGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYW5hbHl6ZVJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChpdGVtcy5tYXAoKHsgaXRlbSwgb3ZlcnJpZGVMYXllcnMgfSkgPT4gYW5hbHl6ZVNoYXJpbmdEZXRhaWwoaXRlbSwgcG9ydGFsLCBvdmVycmlkZUxheWVycywgLy8gVE9ETzogcmVtb3ZlIHRoaXMgYXNzZXJ0aW9uIHdoZW4gd2UgaGF2ZSBhIHByb3BlciB0eXBlIGZvciBsYXllclR5cGVcbiAgICAgICAgICAgICAgICB7IGNsZWFyRGF0YUNhY2hlT25Eb25lOiBmYWxzZSB9KSkpO1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3lDaGVja0NhY2hlVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4gY2xlYXJDYWNoZSh0eXBlKSk7XG4gICAgICAgICAgICAgICAgbmV3U2hhcmVEZXRhaWwgPSBhbmFseXplUmVzdWx0cy5yZWR1Y2UoKGFjYywgeyBlcnJvciwgcmVzdWx0IH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogaGFpciBzcGxpdHRpbmcgdGhpcyBtYXliZVxuICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGUgPSBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocmVzdWx0KS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2Nba2V5XSA9IFsuLi5hY2Nba2V5XSwgLi4ucmVzdWx0W2tleV1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIG5lZWRFZGl0YWJsZUxheWVyczogW10sXG4gICAgICAgICAgICAgICAgICAgIG5lZWRQdWJsaWNseUVkaXRhYmxlTGF5ZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbmVlZERhdGFDb2xsZWN0aW9uTGF5ZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcHJlbWl1bUxheWVyczogW10sXG4gICAgICAgICAgICAgICAgICAgIG5vdEVkaXRhYmxlTGF5ZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbmVlZEJERlNEYXRhc3RvcmVVcGRhdGU6IFtdLFxuICAgICAgICAgICAgICAgICAgICBuZWVkQXV0aGVudGljYXRpb246IFtdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNoYXJpbmdEZXRhaWwgPSBuZXdTaGFyZURldGFpbDtcbiAgICAgICAgICAgIGlmICghdGhpcy5zaGFyaW5nRGV0YWlsIHx8IGVycm9yQ29kZSA9PT0gXCJkYXRhTm90QXZhaWxhYmxlXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IGkxOG4udW5hYmxlVG9HZXRJdGVtO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlckFuZEdldFNoYXJpbmdEZXRhaWxzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlsdGVyQW5kR2V0U2hhcmluZ0RldGFpbHMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHNoYXJpbmdEZXRhaWwgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoc2hhcmluZ0RldGFpbCkuZXZlcnkoKGtleSkgPT4geyB2YXIgX2E7IHJldHVybiAhKChfYSA9IHNoYXJpbmdEZXRhaWxba2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCk7IH0pKSB7XG4gICAgICAgICAgICAgICAgLy8gTm8gZXJyb3IgdG8gc2hvd1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgbmVlZEVkaXRhYmxlTGF5ZXJzLCBuZWVkc1NoYXJlTGV2ZWxVcGRhdGVMYXllcnMsIG5lZWRCREZTRGF0YXN0b3JlVXBkYXRlIH0gPSBzaGFyaW5nRGV0YWlsO1xuICAgICAgICAgICAgdGhpcy5uZWVkc1NoYXJlTGV2ZWxVcGRhdGVMYXllcnMgPSBuZWVkc1NoYXJlTGV2ZWxVcGRhdGVMYXllcnM7XG4gICAgICAgICAgICB0aGlzLm5lZWRFZGl0YWJsZUxheWVycyA9IG5lZWRFZGl0YWJsZUxheWVycztcbiAgICAgICAgICAgIHRoaXMubmVlZEJERlNEYXRhc3RvcmVVcGRhdGUgPSBuZWVkQkRGU0RhdGFzdG9yZVVwZGF0ZTtcbiAgICAgICAgICAgIHRoaXMuc2hhcmVhYmxlSXRlbUNvdW50ID0gW1xuICAgICAgICAgICAgICAgIC4uLm5lZWRzU2hhcmVMZXZlbFVwZGF0ZUxheWVycyxcbiAgICAgICAgICAgICAgICAuLi5uZWVkRWRpdGFibGVMYXllcnMsXG4gICAgICAgICAgICAgICAgLi4ubmVlZEJERlNEYXRhc3RvcmVVcGRhdGVcbiAgICAgICAgICAgIF0ubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgZGlzcGxheUl0ZW1zID0gT2JqZWN0LmtleXMoc2hhcmluZ0RldGFpbCkucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAoX2EgPSBzaGFyaW5nRGV0YWlsW2tleV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhY2MucHVzaCh7IGl0ZW06IGxheWVyLnNvdXJjZUl0ZW0sIHN0YXRlOiBrZXkgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIFtdKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUl0ZW1zID0gZGlzcGxheUl0ZW1zO1xuICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXlJdGVtcztcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jbG9zZURpYWxvZyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwuZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZVNoYXJpbmcgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG5lZWRzU2hhcmVMZXZlbFVwZGF0ZUxheWVycywgbmVlZEVkaXRhYmxlTGF5ZXJzLCBuZWVkQkRGU0RhdGFzdG9yZVVwZGF0ZSwgcG9ydGFsLCBpdGVtcyB9ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1RleHQgPSBcInVwZGF0aW5nU2hhcmluZ1wiO1xuICAgICAgICAgICAgY29uc3QgbmVlZHNVcGRhdGVMYXllckluZm8gPSBbLi4ubmVlZHNTaGFyZUxldmVsVXBkYXRlTGF5ZXJzLCAuLi5uZWVkRWRpdGFibGVMYXllcnNdO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZFNvdXJjZUl0ZW1zID0gbmVlZHNVcGRhdGVMYXllckluZm8ubWFwKCh7IHNvdXJjZUl0ZW0gfSkgPT4gc291cmNlSXRlbSk7XG4gICAgICAgICAgICBjb25zdCBzaG91bGRVcGRhdGVTaGFyZUxldmVsID0gbmVlZHNVcGRhdGVMYXllckluZm8uc29tZSgoeyBkZXRhaWwgfSkgPT4gZGV0YWlsLm5lZWRzU2hhcmVMZXZlbFVwZGF0ZSk7XG4gICAgICAgICAgICBjb25zdCBuZXdTaGFyZUxldmVsID0gc2hvdWxkVXBkYXRlU2hhcmVMZXZlbFxuICAgICAgICAgICAgICAgID8gLy8gISBUaGlzIGFzc3VtZSBhbGwgaXRlbXMgaGF2ZSB0aGUgc2FtZSBsZXZlbCBvZiBhY2Nlc3MgYmVjYXVzZSB0aGF0J3MgdGhlIG9ubHkgdXNlIGNhc2UgcmlnaHQgbm93XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zWzBdLml0ZW0uYWNjZXNzXG4gICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBCREZTIGFuZCBkYXRhIHN0b3JlIHN0dWZmIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAqIG5vbi1jbG91ZCAtIDIgdHlwZXM6XG4gICAgICAgICAgICAgKiAoMSkgQmlnIERhdGEgRmlsZSBTaGFyZSBpdGVtIGFuZFxuICAgICAgICAgICAgICogKDIpIERhdGEgU3RvcmUuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogY2xvdWQgdHlwZSAtIDMgdHlwZXM6XG4gICAgICAgICAgICAgKiAoMSkgQmlnIERhdGEgRmlsZSBTaGFyZSBpdGVtLFxuICAgICAgICAgICAgICogKDIpIERhdGEgU3RvcmUgKEJpZyBEYXRhIEZpbGUgU2hhcmUpIGFuZCB0aGVcbiAgICAgICAgICAgICAqICgzKSBEYXRhIFN0b3JlIChDbG91ZCkgaXRlbXMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogSWYgdXNlciBzaGFyZXMgdGhlIHRvcCBsZXZlbCBpdGVtIC0gKDEpLCB0aGUgZGVwZW5kZW50IGRhdGEgc3RvcmVzICgyKSBhbmQgKDMpIG5lZWRzIHRvIGJlIHNoYXJlZCBmaXJzdC5cbiAgICAgICAgICAgICAqIElmIHVzZXMgc2hhcmUgKDIpLCB0aGUgKDMpIG5lZWRzIHRvIGJlIHNoYXJlZCBmaXJzdC5cbiAgICAgICAgICAgICAqIElmIHVzZXIgb25seSB3YW50IHRvIHNoYXJlIG5vbi1jbG91ZCAoMikgYW5kIGNsb3VkICgzKSwgdGhleSBkb27igJl0IG5lZWQgdG8gd29ycnkgYWJvdXQgYW55IGluZGVwZW5kZW50IGl0ZW1zLlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIFRoYXQncyB3aHkgdGhpcyBpcyBkb25lIGZpcnN0IGJlZm9yZSB0aGUgYWN0dWFsIHNoYXJlIGNhbGxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc3QgYmRmc1NvdXJjZUl0ZW1zID0gbmVlZEJERlNEYXRhc3RvcmVVcGRhdGUubWFwKCh7IHNvdXJjZUl0ZW0gfSkgPT4gc291cmNlSXRlbSk7XG4gICAgICAgICAgICBjb25zdCBiZGZzSXRlbXNUb1VwZGF0ZSA9IGJkZnNTb3VyY2VJdGVtcy5maWx0ZXIoKHNvdXJjZUl0ZW0pID0+ICFzb3VyY2VJdGVtLnR5cGVLZXl3b3Jkcy5pbmNsdWRlcyhcImJpZ0RhdGFGaWxlU2hhcmVcIikpO1xuICAgICAgICAgICAgaWYgKGJkZnNJdGVtc1RvVXBkYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzaGFyZUl0ZW1zVG9TaGFyZWRHcm91cHMoYmRmc0l0ZW1zVG9VcGRhdGUsIFtdLCBuZXdTaGFyZUxldmVsLCBwb3J0YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2hvdWxkVXBkYXRlR3JvdXAgPSBuZWVkc1VwZGF0ZUxheWVySW5mby5zb21lKCh7IGRldGFpbCB9KSA9PiBkZXRhaWwubmVlZHNHcm91cFVwZGF0ZSkgJiZcbiAgICAgICAgICAgICAgICAvLyBwZW9wbGUgaW4gZ3JvdXBzIGNhbiBhbHJlYWR5IHNlZSB0aGUgaXRlbSBzaGFyZWQgdG8gb3JnIG9yIHB1YmxpY1xuICAgICAgICAgICAgICAgIC8vICBzbyB0aGVyZSBpcyBubyBuZWVkIHRvIHNoYXJlIHRvIGdyb3VwcyB3aGljaCBjYW4gY2F1c2Ugbm9pc2VzXG4gICAgICAgICAgICAgICAgbmV3U2hhcmVMZXZlbCAhPT0gXCJwdWJsaWNcIjtcbiAgICAgICAgICAgIGlmICghc2hvdWxkVXBkYXRlU2hhcmVMZXZlbCAmJiAhc2hvdWxkVXBkYXRlR3JvdXApIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgdXBkYXRlIGJ1dHRvbiBzaG91bGRuJ3QgZXZlbiBzaG93IHVwIGlmIHRoZXJlIGlzIG5vdGhpbmcgdG8gdXBkYXRlXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5leHBlY3RlZCBzdGF0ZTogbm8gbmVlZCB0byB1cGRhdGUgc2hhcmUgbGV2ZWwgb3IgZ3JvdXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzaGFyZUl0ZW1zVG9TaGFyZWRHcm91cHModXBkYXRlZFNvdXJjZUl0ZW1zLCBpdGVtcy5tYXAoKHsgaXRlbSB9KSA9PiBpdGVtKSwgbmV3U2hhcmVMZXZlbCwgcG9ydGFsLCBzaG91bGRVcGRhdGVHcm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoe1xuICAgICAgICAgICAgICAgIHVwZGF0ZWRTb3VyY2VJdGVtczogWy4uLnVwZGF0ZWRTb3VyY2VJdGVtcywgLi4uYmRmc1NvdXJjZUl0ZW1zXSxcbiAgICAgICAgICAgICAgICBvbGRTaGFyaW5nRGV0YWlsOiB0aGlzLnNoYXJpbmdEZXRhaWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldFN0YXR1c0luZm9Gb3JMYXllclN0YXRlID0gKHN0YXRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBCYXNlLCBoZWxwTWFwIH0gPSB0aGlzLmNvbmZpZztcbiAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwibmVlZEVkaXRhYmxlTGF5ZXJzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpMThuS2V5OiBcInNoYXJpbmdQRENFbmFibGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kOiBcImluZm9cIlxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJuZWVkUHVibGljbHlFZGl0YWJsZUxheWVyc1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJuZWVkRGF0YUNvbGxlY3Rpb25MYXllcnNcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkxOG5LZXk6IFwicGRjXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kOiBcImRhbmdlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogYCR7aGVscEJhc2V9JHtoZWxwTWFwID09PSBudWxsIHx8IGhlbHBNYXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhlbHBNYXBbXCIxMjAwMDQxMzBcIl19YFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwcmVtaXVtTGF5ZXJzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpMThuS2V5OiBcInByZW1pdW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IFwiaW5mb1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogXCJodHRwczovL2RvYy5hcmNnaXMuY29tL2VuL2FyY2dpcy1vbmxpbmUvcmVmZXJlbmNlL2ZhcS5odG0jU0hBUkVfU1VCU0NSX0xZUlwiXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5vdEVkaXRhYmxlTGF5ZXJzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGkxOG5LZXk6IFwibm9QZXJtaXNzaW9uXCIsIGtpbmQ6IFwiZGFuZ2VyXCIgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibmVlZEF1dGhlbnRpY2F0aW9uXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGkxOG5LZXk6IFwibmVlZHNBdXRoZW50aWNhdGlvblwiLCBraW5kOiBcImRhbmdlclwiIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyUHJldmlld0l0ZW1Ob3RpY2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHByZXZpZXdJdGVtU3RhdGUsIGdldFN0YXR1c0luZm9Gb3JMYXllclN0YXRlLCBpMThuIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgcHJldmlld0l0ZW1TdGF0dXNJbmZvID0gcHJldmlld0l0ZW1TdGF0ZVxuICAgICAgICAgICAgICAgID8gZ2V0U3RhdHVzSW5mb0ZvckxheWVyU3RhdGUocHJldmlld0l0ZW1TdGF0ZSlcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICBpZiAoIXByZXZpZXdJdGVtU3RhdHVzSW5mbykge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBpMThuS2V5LCBraW5kLCBsaW5rIH0gPSBwcmV2aWV3SXRlbVN0YXR1c0luZm87XG4gICAgICAgICAgICBjb25zdCBuZWVkU2hhcmVJMThOID0gaTE4bi5uZWVkU2hhcmU7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IG9wZW46IHRydWUsIGNsb3NhYmxlOiBmYWxzZSwgc2NhbGU6IFwibVwiLCBraW5kOiBraW5kLCBzbG90OiBcInByZXZpZXctc3VtbWFyeS10b3BcIiwgY2xhc3M6IFwicHJldmlldy1ub3RpY2VcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgbmVlZFNoYXJlSTE4TltpMThuS2V5XS5wYW5lbCksIGxpbmsgJiZcbiAgICAgICAgICAgICAgICBpMThuS2V5ICE9PSBcIm5vUGVybWlzc2lvblwiICYmXG4gICAgICAgICAgICAgICAgaTE4bktleSAhPT0gXCJzaGFyaW5nUERDRW5hYmxlZFwiICYmXG4gICAgICAgICAgICAgICAgaTE4bktleSAhPT0gXCJuZWVkc0F1dGhlbnRpY2F0aW9uXCIgJiYgKGgoXCJjYWxjaXRlLWxpbmtcIiwgeyBzbG90OiBcImxpbmtcIiwgaHJlZjogbGluaywgdGFyZ2V0OiBcIl9ibGFua1wiLCByZWw6IFwibm9vcGVuZXJcIiB9LCBuZWVkU2hhcmVJMThOW2kxOG5LZXldLmxlYXJuTW9yZSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hhcmluZ0RldGFpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWN0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLm5lZWRzU2hhcmVMZXZlbFVwZGF0ZUxheWVycyA9IFtdO1xuICAgICAgICB0aGlzLm5lZWRFZGl0YWJsZUxheWVycyA9IFtdO1xuICAgICAgICB0aGlzLm5lZWRCREZTRGF0YXN0b3JlVXBkYXRlID0gW107XG4gICAgICAgIHRoaXMuZGlzcGxheUl0ZW1zID0gW107XG4gICAgICAgIHRoaXMucHJldmlld0l0ZW1TdGF0ZSA9IG51bGw7XG4gICAgICAgIHRoaXMubG9hZGluZ1RleHQgPSBcImxvYWRpbmdJbmZvXCI7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgdGhpcy5zaGFyZWFibGVJdGVtQ291bnQgPSAwO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMuaXRlbXMubWFwKChpdGVtSW5mbykgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGl0ZW1JbmZvKSwgeyBpdGVtOiAoX2EgPSBpdGVtSW5mby5pdGVtLnNvdXJjZUpTT04pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGl0ZW1JbmZvLml0ZW0gfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyBlbCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICB9XG4gICAgaGFuZGxlTmV3UHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLml0ZW1Ccm93c2VyUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVmcmVzaCgpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICAvLyBEYXRhIHByb2Nlc3Npbmcgd2lsbCBiZSBoYW5kbGVkIGJ5IGl0ZW0gYnJvd3NlciBvbiBsb2FkIGJlbG93XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB1cGRhdGVTaGFyaW5nLCBpc0FjdGl2ZSwgYXBpLCBjbG9zZURpYWxvZywgaTE4biwgaXNMb2FkaW5nLCBsb2FkaW5nVGV4dCwgc2hhcmVhYmxlSXRlbUNvdW50LCBlcnJvck1lc3NhZ2UsIHBvcnRhbCwgdXNlciwgY29uZmlnLCBhbmFseXplU2hhcmluZ0RldGFpbCwgZ2V0U3RhdHVzSW5mb0ZvckxheWVyU3RhdGUsIGRpc3BsYXlJdGVtcywgcmVuZGVyUHJldmlld0l0ZW1Ob3RpY2UgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGNhblVwZGF0ZSA9IHNoYXJlYWJsZUl0ZW1Db3VudCA+IDA7XG4gICAgICAgIGNvbnN0IGhhc0Vycm9yID0gISFlcnJvck1lc3NhZ2U7XG4gICAgICAgIGNvbnN0IG5lZWRTaGFyZUkxOE4gPSBpMThuLm5lZWRTaGFyZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1tb2RhbFwiLCB7IG9uQ2FsY2l0ZU1vZGFsQ2xvc2U6IGNsb3NlRGlhbG9nLCBvcGVuOiBpc0FjdGl2ZSwgb3V0c2lkZUNsb3NlRGlzYWJsZWQ6IHRydWUsIGVzY2FwZURpc2FibGVkOiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBpMThuLnVwZGF0ZVNoYXJpbmcpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50XCIsIGNsYXNzOiBcInN0YWdlXCIgfSwgaChcImNhbGNpdGUtYWxlcnRcIiwgeyBpY29uOiB0cnVlLCBvcGVuOiBoYXNFcnJvciwgbGFiZWw6IGVycm9yTWVzc2FnZSwga2luZDogXCJkYW5nZXJcIiwgb25DYWxjaXRlQWxlcnRDbG9zZTogKCkgPT4gKHRoaXMuZXJyb3JNZXNzYWdlID0gbnVsbCkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGVycm9yTWVzc2FnZSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IGFjdGl2ZTogaXNMb2FkaW5nLCB0ZXh0OiBpMThuW2xvYWRpbmdUZXh0XSB9KSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXJcIiwgeyBmZXRjaDogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5SXRlbXMgPSAoX2EgPSAoYXdhaXQgYW5hbHl6ZVNoYXJpbmdEZXRhaWwoKSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBkaXNwbGF5SXRlbXMubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICBuZXh0U3RhcnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG51bTogZGlzcGxheUl0ZW1zLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRpc3BsYXlJdGVtcy5tYXAoKHsgaXRlbSB9KSA9PiBpdGVtKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LCBvbkFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldzogKHsgZGV0YWlsOiBwcmV2aWV3SXRlbSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpZXdJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlld0l0ZW1TdGF0ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucHJldmlld0l0ZW1TdGF0ZSA9XG4gICAgICAgICAgICAgICAgICAgIChfYiA9IChfYSA9IGRpc3BsYXlJdGVtcy5maW5kKCh7IGl0ZW0gfSkgPT4gaXRlbS5pZCA9PT0gcHJldmlld0l0ZW0uaWQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7XG4gICAgICAgICAgICB9LCBoaWRlQ29udGVudFRvcDogdHJ1ZSwgY29udGVudFBhZGRlZEJvdHRvbTogdHJ1ZSwgaGlkZVByZXZpZXdGb290ZXJzOiB0cnVlLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgY29uZmlnOiBjb25maWcsIHNlbGVjdGlvbjogXCJub25lXCIsIGFwaTogYXBpLCBudW06IElURU1fQlJPV1NFUl9NQVhfSVRFTVMsIHJlZjogKGVsZSkgPT4gKHRoaXMuaXRlbUJyb3dzZXJSZWYgPSBlbGUpIH0sIGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLWNvbnRlbnRcIiwgeyBjbGFzczogXCJjb21wYWN0LWdyaWQtY29udGVudFwiLCBzbG90OiBcImNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG9wLWJhclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0b3Atbm90aWNlXCIsIGlubmVySFRNTDogaTE4bltwb3J0YWwuaXNQb3J0YWwgPyBcIm5vdGljZUVudGVycHJpc2VcIiA6IFwibm90aWNlXCJdIH0pLCBoKFwiZGl2XCIsIG51bGwsIGkxOG4uY2FuQmVTaGFyZWRcbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHtjb3VudH1cIiwgc2hhcmVhYmxlSXRlbUNvdW50LnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7dG90YWx9XCIsIGRpc3BsYXlJdGVtcy5sZW5ndGgudG9TdHJpbmcoKSkpKSwgZGlzcGxheUl0ZW1zLm1hcCgoeyBpdGVtLCBzdGF0ZSB9KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGF0dXNJbmZvID0gZ2V0U3RhdHVzSW5mb0ZvckxheWVyU3RhdGUoc3RhdGUpO1xuICAgICAgICAgICAgY29uc3QgaXNJbmZvU3RhdHVzID0gKHN0YXR1c0luZm8gPT09IG51bGwgfHwgc3RhdHVzSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhdHVzSW5mby5raW5kKSA9PT0gXCJpbmZvXCI7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLWNhcmRcIiwgeyBrZXk6IGl0ZW0uaWQsIGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsLCB1c2VyOiB1c2VyLCBiYXNlVXJsOiBjb25maWcuYmFzZVVybCwgcHJldmlldzogXCJ0b3BcIiwgc2hvd093bmVyOiB0cnVlLCBzaG93RGF0ZVVwZGF0ZWQ6IHRydWUsIHNob3dJdGVtVHlwZTogdHJ1ZSwgc2hvd1N1bW1hcnk6IHRydWUsIHNob3dCYWRnZXM6IHRydWUgfSwgc3RhdHVzSW5mbyAmJiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC10b3BcIiwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJzdGF0dXMtYmFubmVyXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIFwic3RhdHVzLWJhbm5lci0taW5mb1wiOiBpc0luZm9TdGF0dXNcbiAgICAgICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBpc0luZm9TdGF0dXMgPyBcImluZm9ybWF0aW9uXCIgOiBcImV4Y2xhbWF0aW9uTWFya1RyaWFuZ2xlXCIsIHNjYWxlOiBcInNcIiB9KSwgaChcInNwYW5cIiwgbnVsbCwgbmVlZFNoYXJlSTE4TltzdGF0dXNJbmZvLmkxOG5LZXldLm5vdGljZSkpKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiwgY2xhc3M6IFwib3Blbi1pdGVtXCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2NhbGU6IFwic1wiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBvbkNsaWNrOiAoKSA9PiB3aW5kb3cub3BlbihnZXRJdGVtSG9tZUFwcFVybChpdGVtLmlkLCBjb25maWcuYmFzZVVybCksIFwiX2JsYW5rXCIsIFwibm9vcGVuZXJcIikgfSwgaTE4bi5nb1RvSXRlbSkpKSk7XG4gICAgICAgIH0pKSwgcmVuZGVyUHJldmlld0l0ZW1Ob3RpY2UoKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgYXBwZWFyYW5jZTogY2FuVXBkYXRlID8gXCJvdXRsaW5lXCIgOiBcInNvbGlkXCIsIGtpbmQ6IFwiYnJhbmRcIiwgXCJkYXRhLWlkXCI6IFwiY2FuY2VsQnV0dG9uXCIsIG9uQ2xpY2s6ICgpID0+ICh0aGlzLmlzQWN0aXZlID0gZmFsc2UpLCB3aWR0aDogXCJmdWxsXCIgfSwgaTE4bltjYW5VcGRhdGUgPyBcImNhbmNlbFwiIDogXCJva1wiXSksIGNhblVwZGF0ZSAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJzZWNvbmRhcnlcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCBraW5kOiBcImJyYW5kXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogdXBkYXRlU2hhcmluZywgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogaXNMb2FkaW5nIH0sIGkxOG4udXBkYXRlKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwicHJlUHJvY2Vzc2VkU2hhcmluZ0RldGFpbFwiOiBbXCJoYW5kbGVOZXdQcmVQcm9jZXNzZWRTaGFyaW5nRGV0YWlsXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0RlcGVuZGVuY3lDaGVjay5zdHlsZSA9IGFyY2dpc0RlcGVuZGVuY3lDaGVja0NzcztcblxuY29uc3QgZ2V0VXNlckdyb3VwcyA9IGFzeW5jICh7IGl0ZW1zLCBwb3J0YWwsIHNoYXJlTW9kZSwgdXNlciB9KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXRlbU93bmVyID0gYXdhaXQgZ2V0SXRlbU93bmVyKHsgdXNlciwgaXRlbXMsIHBvcnRhbCB9KTtcbiAgICAgICAgLy8gVXNlZnVsIGluIGNhc2Ugd2UncmUgYWRtaW4gdHJ5aW5nIHRvIGNoYW5nZSB0aGUgb3duZXIncyBpdGVtXG4gICAgICAgIGNvbnN0IGFsbFVzZXJzID0gdXNlci51c2VybmFtZSA9PT0gaXRlbU93bmVyLnVzZXJuYW1lID8gW3VzZXJdIDogW3VzZXIsIGl0ZW1Pd25lcl07XG4gICAgICAgIGNvbnN0IHVzZXJHcm91cExvb2t1cCA9IGF3YWl0IHF1ZXJ5VXNlckRldGFpbHMoe1xuICAgICAgICAgICAgcG9ydGFsLFxuICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgIHNoYXJlTW9kZSxcbiAgICAgICAgICAgIGl0ZW1Pd25lclxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZ3JvdXBSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoYWxsVXNlcnMubWFwKChjdXJyZW50VXNlcikgPT4gZ2V0QWxsR3JvdXBzRm9yVXNlcih7IHVzZXI6IGN1cnJlbnRVc2VyLCBwb3J0YWxVc2VyOiB1c2VyLCBwb3J0YWwsIHNoYXJlTW9kZSwgdXNlckdyb3VwTG9va3VwLCBpdGVtcyB9KSkpO1xuICAgICAgICBjb25zdCBmbGF0dGVuZWRHcm91cHMgPSBncm91cFJlc3VsdHMuZmxhdE1hcCgocmVzdWx0KSA9PiByZXN1bHQucmVzdWx0KTtcbiAgICAgICAgY29uc3QgZ3JvdXBJZHMgPSBmbGF0dGVuZWRHcm91cHMubWFwKCh7IGlkIH0pID0+IGlkKTtcbiAgICAgICAgY29uc3QgdW5pcXVlR3JvdXBzID0gZmxhdHRlbmVkR3JvdXBzLmZpbHRlcigoZ3JvdXAsIGkpID0+IGdyb3VwSWRzLmluZGV4T2YoZ3JvdXAuaWQpID09PSBpKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3VsdDoge1xuICAgICAgICAgICAgICAgIHVuaXF1ZUdyb3VwcyxcbiAgICAgICAgICAgICAgICB1c2VyR3JvdXBMb29rdXAsXG4gICAgICAgICAgICAgICAgYWxsVXNlcnMsXG4gICAgICAgICAgICAgICAgc2VhcmNoVXNlcm5hbWU6IHVzZXIudXNlcm5hbWUgPT09IGl0ZW1Pd25lci51c2VybmFtZSA/IHVzZXIudXNlcm5hbWUgOiBpdGVtT3duZXIudXNlcm5hbWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5jb25zdCBNQVhfR1JPVVBfU0VBUkNIID0gMTAwO1xuLyoqIEZldGNoIHRoZSBncm91cCBmb3IgdGhlIGl0ZW0gdGhhdCB0aGUgdXNlciBpcyBhbHNvIGEgcGFydCBvZiAqL1xuY29uc3QgZ2V0SXRlbUdyb3VwcyA9IGFzeW5jIChpdGVtSWRzLCB1c2VyR3JvdXBJZHMsIHBvcnRhbCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGl0ZW1Hcm91cFJlc3BvbnNlcyA9IGF3YWl0IFByb21pc2UuYWxsKGNodW5rKHVzZXJHcm91cElkcywgTUFYX0dST1VQX1NFQVJDSCkubWFwKGFzeW5jIChncm91cElkcykgPT4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb250ZW50L2l0ZW1zZ3JvdXBzYCwge1xuICAgICAgICAgICAgaXRlbXM6IGl0ZW1JZHMuam9pbihcIixcIiksXG4gICAgICAgICAgICBncm91cHM6IGdyb3VwSWRzLmpvaW4oXCIsXCIpXG4gICAgICAgIH0pKSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgICAgICBpdGVtR3JvdXBSZXNwb25zZXMuZm9yRWFjaCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5mb3JFYWNoKChncm91cElkKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSByZXNwb25zZVtncm91cElkXTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdFtncm91cElkXSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbZ3JvdXBJZF0gPSBncm91cDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtncm91cElkXS5pdGVtcyA9IFsuLi5yZXN1bHRbZ3JvdXBJZF0uaXRlbXMsIC4uLmdyb3VwLml0ZW1zXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdCB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbi8qKlxuICogR2l2ZW4gYSB1c2VyLCBnZXQgYWxsIG9mIHRoZWlyIGdyb3VwcyB1c2luZyB0aGUgZ3JvdXBzIHNlYXJjaCBlbmRwb2ludFxuICpcbiAqIHBzZXVkb2NvZGU6XG4gKiBnZXQgdGhlIGZpcnN0IDEwMCBncm91cHMgKHRoZSBtYXggYWxsb3dlZCBieSBncm91cHMgc2VhcmNoIGVuZHBvaW50KVxuICogaWYgdGhhdCBhY2NvdW50cyBmb3IgYWxsIG9mIGEgdXNlcidzIGdyb3VwcywgcmV0dXJuIHRoZW1cbiAqIGVsc2UsIGdldCBhbGwgdGhlIG90aGVyIGdyb3Vwc1xuICogKGluIHBhcmFsbGVsIGJhdGNoZWQgcmVxdWVzdHMgYmFzZWQgb24gcmVzcG9uc2UubmV4dFN0YXJ0KVxuICogYW5kIHJldHVybiB0aGVtXG4gKi9cbmNvbnN0IGdldEFsbEdyb3Vwc0ZvclVzZXIgPSBhc3luYyAoeyB1c2VyLCBwb3J0YWxVc2VyLCBwb3J0YWwsIHNoYXJlTW9kZSwgdXNlckdyb3VwTG9va3VwLCBpdGVtcyB9KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcTogZ2V0VXNlcm5hbWVRdWVyeSh7XG4gICAgICAgICAgICBzaGFyZU1vZGUsXG4gICAgICAgICAgICBjdXJyZW50VXNlcm5hbWU6IHBvcnRhbFVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgdXNlckdyb3VwTG9va3VwLFxuICAgICAgICAgICAgaXNQcml2YXRlOiAoKF9hID0gaXRlbXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hY2Nlc3MpID09PSBcInByaXZhdGVcIlxuICAgICAgICB9KSxcbiAgICAgICAgbnVtOiAxMDAsXG4gICAgICAgIHNlYXJjaFVzZXJBY2Nlc3M6IFwiZ3JvdXBNZW1iZXJcIixcbiAgICAgICAgc2VhcmNoVXNlck5hbWU6IHVzZXIudXNlcm5hbWVcbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZpcnN0R3JvdXBTZWFyY2hSZXN1bHQgPSBhd2FpdCBmZXRjaEdyb3Vwcyhwb3J0YWwsIHBhcmFtcyk7XG4gICAgICAgIC8vIGlmIG5leHRTdGFydCBpcyAtMSwgd2UndmUgZ290IGFsbCB0aGUgZ3JvdXBzLlxuICAgICAgICBpZiAoZmlyc3RHcm91cFNlYXJjaFJlc3VsdC5uZXh0U3RhcnQgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4geyByZXN1bHQ6IGZpcnN0R3JvdXBTZWFyY2hSZXN1bHQucmVzdWx0cyB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIG5vdCwgd2UnbGwgaGF2ZSB0byBtYWtlIG4gbW9yZSByZXF1ZXN0c1xuICAgICAgICAvLyB3ZSBjYW4gZG8gdGhlc2UgaW4gcGFyYWxsZWwsIGFuZCBjb25jYXRlbmF0ZSB0aGVtIHdpdGggUHJvbWlzZS5hbGwoKVxuICAgICAgICBjb25zdCByZXF1ZXN0c05lZWRlZCA9IE1hdGguY2VpbChmaXJzdEdyb3VwU2VhcmNoUmVzdWx0LnRvdGFsIC8gMTAwKSAtIDE7XG4gICAgICAgIGNvbnN0IGdyb3VwU2VhcmNoUHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXF1ZXN0c05lZWRlZDsgaSsrKSB7XG4gICAgICAgICAgICBncm91cFNlYXJjaFByb21pc2VzLnB1c2gobmV3IFByb21pc2UoYXN5bmMgKGlubmVyUmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gKGkgKyAxKSAqIDEwMCArIDE7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5uZXJSZXNwb25zZSA9IGF3YWl0IGZldGNoR3JvdXBzKHBvcnRhbCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMpLCB7IHN0YXJ0IH0pKTtcbiAgICAgICAgICAgICAgICBpbm5lclJlc29sdmUoaW5uZXJSZXNwb25zZS5yZXN1bHRzKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvdGhlckdyb3VwU2VhcmNoUmVzdWx0cyA9IChhd2FpdCBQcm9taXNlLmFsbChncm91cFNlYXJjaFByb21pc2VzKSkuZmxhdCgpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IFsuLi5maXJzdEdyb3VwU2VhcmNoUmVzdWx0LnJlc3VsdHMsIC4uLm90aGVyR3JvdXBTZWFyY2hSZXN1bHRzXSB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmNvbnN0IGZldGNoR3JvdXBzID0gKHBvcnRhbCwgcGFyYW1zKSA9PiByZXF1ZXN0RmV0Y2goYCR7Z2V0UG9ydGFsUmVzdEJhc2VVcmwocG9ydGFsKX0vY29tbXVuaXR5L2dyb3Vwc2AsIHBvcnRhbCwge1xuICAgIGJvZHk6IHBhcmFtcyxcbiAgICB1c2VQb3N0OiB0cnVlXG59KTtcbmNvbnN0IGdldEl0ZW1Pd25lciA9IGFzeW5jICh7IHVzZXIsIGl0ZW1zLCBwb3J0YWwgfSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoaXRlbXNCZWxvbmdUb1VzZXJPcmcoaXRlbXMsIHVzZXIpICYmXG4gICAgICAgIGhhc0FkbWluU2hhcmVQcml2aWxlZ2UoeyBpdGVtcywgdXNlciwgcG9ydGFsIH0pICYmXG4gICAgICAgIGNhblZpZXdPdGhlcnNPcmdJdGVtcyh1c2VyKSkge1xuICAgICAgICBjb25zdCBmaXJzdEl0ZW0gPSBpdGVtc1swXTtcbiAgICAgICAgcmV0dXJuIChfYSA9IGZpcnN0SXRlbS5pdGVtT3duZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChhd2FpdCBmZXRjaFVzZXIoZmlyc3RJdGVtLm93bmVyLCBwb3J0YWwpKTtcbiAgICB9XG4gICAgcmV0dXJuIHVzZXI7XG59O1xuY29uc3QgcXVlcnlVc2VyRGV0YWlscyA9IGFzeW5jICh7IHVzZXIsIHBvcnRhbCwgc2hhcmVNb2RlLCBpdGVtT3duZXIgfSkgPT4ge1xuICAgIGNvbnN0IHVzZXJEZXRhaWxSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBmZXRjaFVzZXIodXNlci51c2VybmFtZSwgcG9ydGFsKSxcbiAgICAgICAgLy8gZm9yIGFkbWluIGNhc2UsIHdlIGFsc28gZmV0Y2ggdGhlIGl0ZW0gb3duZXIncyBncm91cFxuICAgICAgICBzaGFyZU1vZGUgPT09IFwiYWRtaW5cIiAmJiBpdGVtT3duZXIudXNlcm5hbWUgIT09IHVzZXIudXNlcm5hbWUgPyBmZXRjaFVzZXIoaXRlbU93bmVyLnVzZXJuYW1lLCBwb3J0YWwpIDogbnVsbFxuICAgIF0pO1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgW3VzZXIudXNlcm5hbWVdOiB1c2VyRGV0YWlsUmVzdWx0c1swXS5ncm91cHMgfSwgKCEhdXNlckRldGFpbFJlc3VsdHNbMV0gJiYgeyBbaXRlbU93bmVyLnVzZXJuYW1lXTogdXNlckRldGFpbFJlc3VsdHNbMV0uZ3JvdXBzIH0pKTtcbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1TaGFyZUdyb3VwQ3NzID0gXCIuY29udGVudHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi10b3A6MXJlbX0uaW5mb3JtYXRpb24tdGV4dHtmb250LXNpemU6MC44NzVyZW07bWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHh9LnRleHQtcGFkZGluZ3ttYXJnaW4tdG9wOjAuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbVNoYXJlR3JvdXAgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmVkaXRHcm91cENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJlZGl0R3JvdXBDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5kaXJ0eUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZGlydHlDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYW5hbHl6ZVVzZXJHcm91cENvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhbmFseXplVXNlckdyb3VwQ29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMucmVtb3ZlQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJlbW92ZUNsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLnJldmVydENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJyZXZlcnRDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5oYXNHcm91cHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hhcmVNb2RlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBEYXRhID0gW107XG4gICAgICAgIHRoaXMuaW5pdGlhbFNlbGVjdGVkR3JvdXBzID0gW107XG4gICAgICAgIHRoaXMuY2FuU2hhcmVJdGVtVG9Hcm91cCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1NoYXJpbmdNaXhlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBoYW5kbGVTZWxlY3RlZEdyb3Vwc0NoYW5nZShuZXdMaXN0KSB7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgaW5pdGlhbFNlbGVjdGVkR3JvdXBzLCBpdGVtcyB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5jYW5TaGFyZUl0ZW1Ub0dyb3VwID0gY2FuU2hhcmVJdGVtVG9Hcm91cChuZXdMaXN0LCB1c2VyKTtcbiAgICAgICAgdGhpcy5pc0RpcnR5ID0gaXNTZWxlY3RlZEdyb3VwRGF0YURpcnR5KG5ld0xpc3QsIGluaXRpYWxTZWxlY3RlZEdyb3Vwcyk7XG4gICAgICAgIHRoaXMuaXNTaGFyaW5nTWl4ZWQgPSBjaGVja0lmU2hhcmluZ01peGVkKGl0ZW1zLCBuZXdMaXN0KTtcbiAgICAgICAgdGhpcy5kaXJ0eUNoYW5nZS5lbWl0KHRoaXMuaXNEaXJ0eSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsLCBpdGVtcywgc2hhcmVNb2RlIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvclxuICAgICAgICBjb25zdCB7IHJlc3VsdCB9ID0gYXdhaXQgZ2V0VXNlckdyb3Vwcyh7XG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgcG9ydGFsLFxuICAgICAgICAgICAgaXRlbXMsXG4gICAgICAgICAgICBzaGFyZU1vZGVcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHsgdW5pcXVlR3JvdXBzOiB1c2VyR3JvdXBzLCB1c2VyR3JvdXBMb29rdXAsIHNlYXJjaFVzZXJuYW1lLCBhbGxVc2VycyB9ID0gcmVzdWx0O1xuICAgICAgICBjb25zdCB7IHJlc3VsdDogaXRlbUdyb3VwSW5mbyB9ID0gYXdhaXQgZ2V0SXRlbUdyb3VwcyhpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpLCB1c2VyR3JvdXBzLm1hcCgoZ3JvdXApID0+IGdyb3VwLmlkKSwgcG9ydGFsKTtcbiAgICAgICAgY29uc3QgaW5pdGlhbEdyb3VwcyA9IHVzZXJHcm91cHNcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIGludGVyc2VjdCBvZiB0aGUgZ3JvdXBzIHRoYXQgdGhlIHVzZXIgaXMgYSBtZW1iZXIgb2ZcbiAgICAgICAgICAgIC8vICBhbmQgdGhlIGdyb3VwcyB0aGF0IHRoZSBpdGVtIGlzIHNoYXJlZCB0b1xuICAgICAgICAgICAgLmZpbHRlcigoeyBpZCB9KSA9PiAhIWl0ZW1Hcm91cEluZm9baWRdKVxuICAgICAgICAgICAgLm1hcCgoZ3JvdXApID0+ICh7XG4gICAgICAgICAgICBncm91cCxcbiAgICAgICAgICAgIHNlbGVjdGVkQnlJdGVtSWRzOiBpdGVtc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHsgaWQgfSkgPT4gISFpdGVtR3JvdXBJbmZvW2dyb3VwLmlkXS5pdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLml0ZW1JZCA9PT0gaWQpKVxuICAgICAgICAgICAgICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpXG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5oYXNHcm91cHMgPSB1c2VyR3JvdXBzLmxlbmd0aCA+IDA7XG4gICAgICAgIHRoaXMuY2FuU2hhcmVJdGVtVG9Hcm91cCA9IGNhblNoYXJlSXRlbVRvR3JvdXAoaW5pdGlhbEdyb3VwcywgdXNlcik7XG4gICAgICAgIHRoaXMuaW5pdGlhbFNlbGVjdGVkR3JvdXBzID0gaW5pdGlhbEdyb3VwcztcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hbmFseXplVXNlckdyb3VwQ29tcGxldGUuZW1pdCh7XG4gICAgICAgICAgICBhbGxVc2VycyxcbiAgICAgICAgICAgIGluaXRpYWxTZWxlY3RlZEdyb3VwczogaW5pdGlhbEdyb3VwcyxcbiAgICAgICAgICAgIHVzZXJHcm91cExvb2t1cCxcbiAgICAgICAgICAgIHNlYXJjaFVzZXJuYW1lXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgaXNMb2FkaW5nLCBjYW5TaGFyZUl0ZW1Ub0dyb3VwLCByZW1vdmVDbGljaywgcmV2ZXJ0Q2xpY2ssIHNlbGVjdGVkR3JvdXBEYXRhLCBoYXNHcm91cHMsIGlzRGlydHksIGlzU2hhcmluZ01peGVkIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi50aXRsZSwgaGVhZGVyU2lkZUNvbnRlbnQ6IGlzRGlydHkgPyAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uU3RhcnQ6IFwicmVzZXRcIiwgZGlzYWJsZWQ6IGlzTG9hZGluZywgb25DbGljazogKCkgPT4gcmV2ZXJ0Q2xpY2suZW1pdCgpIH0sIGkxOG4ucmV2ZXJ0KSkgOiAoc2VsZWN0ZWRHcm91cERhdGEubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uU3RhcnQ6IFwieFwiLCBkaXNhYmxlZDogaXNMb2FkaW5nLCBvbkNsaWNrOiAoKSA9PiByZW1vdmVDbGljay5lbWl0KCkgfSwgaTE4bi5yZW1vdmUpKSkgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImdyb3VwLWNvbnRhaW5lclwiIH0sIHNlbGVjdGVkR3JvdXBEYXRhLmxlbmd0aCA+IDAgPyAoaChcImFyY2dpcy1ncm91cC10aHVtYm5haWwtc3RhY2tcIiwgeyBncm91cHM6IHNlbGVjdGVkR3JvdXBEYXRhLm1hcCgoeyBncm91cCB9KSA9PiBncm91cCkgfSkpIDogKGgoXCJwXCIsIHsgY2xhc3M6IFwiaW5mb3JtYXRpb24tdGV4dFwiIH0sIGkxOG5baGFzR3JvdXBzID8gXCJub25lWWV0XCIgOiBcIm5vR3JvdXBcIl0pKSksIGhhc0dyb3VwcyAmJiBjYW5TaGFyZUl0ZW1Ub0dyb3VwICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBpY29uU3RhcnQ6IFwiZ3JvdXBcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgZGlzYWJsZWQ6IGlzTG9hZGluZywgb25DbGljazogKCkgPT4gdGhpcy5lZGl0R3JvdXBDbGljay5lbWl0KCkgfSwgaTE4bi5lZGl0KSkpLCAhaXNMb2FkaW5nICYmIGlzU2hhcmluZ01peGVkICYmIChoKFwicFwiLCB7IGNsYXNzOiBcImluZm9ybWF0aW9uLXRleHQgdGV4dC1wYWRkaW5nXCIgfSwgaTE4bi5taXhlZEdyb3VwU2hhcmluZykpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInNlbGVjdGVkR3JvdXBEYXRhXCI6IFtcImhhbmRsZVNlbGVjdGVkR3JvdXBzQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0l0ZW1TaGFyZUdyb3VwLnN0eWxlID0gYXJjZ2lzSXRlbVNoYXJlR3JvdXBDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1TaGFyZUdyb3VwQ2FyZENzcyA9IFwiOmhvc3R7ZGlzcGxheTpjb250ZW50c31cIjtcblxuY29uc3QgQXJjZ2lzSXRlbVNoYXJlR3JvdXBDYXJkID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5yZXZlcnRDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmV2ZXJ0Q2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXBDb3VudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pbml0aWFsU2VsZWN0ZWRHcm91cERhdGFMb29rdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cERhdGFMb29rdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudG90YWxJdGVtQ291bnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGdyb3VwLCBncm91cENvdW50LCB0b3RhbEl0ZW1Db3VudCwgaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhTG9va3VwLCBzZWxlY3RlZEdyb3VwRGF0YUxvb2t1cCwgcmV2ZXJ0Q2xpY2ssIHBvcnRhbCwgdXNlciwgaTE4biB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgdG90YWxJdGVtQ291bnRTdHIgPSB0b3RhbEl0ZW1Db3VudC50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBncm91cElkID0gZ3JvdXAuaWQ7XG4gICAgICAgIGNvbnN0IGN1ckdyb3VwQ291bnQgPSBncm91cENvdW50W2dyb3VwLmlkXTtcbiAgICAgICAgbGV0IHNlbGVjdGlvblR5cGUgPSBcIm5vbmVcIjtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIGN1ckdyb3VwQ291bnQgPCB0b3RhbEl0ZW1Db3VudDpcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25UeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGN1ckdyb3VwQ291bnQgPT09IHRvdGFsSXRlbUNvdW50OlxuICAgICAgICAgICAgICAgIHNlbGVjdGlvblR5cGUgPSBcImFsbFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluaXRpYWxTZWxlY3Rpb25UeXBlID0gaW5pdGlhbFNlbGVjdGVkR3JvdXBEYXRhTG9va3VwW2dyb3VwSWRdO1xuICAgICAgICAvKipcbiAgICAgICAgICogV2UgY2FuJ3QganVzdCBkbyBpbml0aWFsU2VsZWN0aW9uVHlwZSAhPT0gc2VsZWN0aW9uVHlwZSBiZWNhdXNlXG4gICAgICAgICAqICBpbml0aWFsU2VsZWN0aW9uVHlwZSBjYW4gYmUgdW5kZWZpbmVkIGlmIGEgZ3JvdXAgaXMgbm90IHNlbGVjdGVkIGluaXRpYWxseVxuICAgICAgICAgKiAgc2luY2Ugd2UgY29uc3RydWN0IGBpbml0aWFsU2VsZWN0ZWRHcm91cERhdGFMb29rdXBgIGJhc2VkIG9uIHRoZSBwcmUtc2VsZWN0ZWQgZ3JvdXBcbiAgICAgICAgICogIGFuZCBkb24ndCBoYXZlIHRoZSBrbm93bGVkZ2UgYWJvdXQgb3RoZXIgZ3JvdXBzIHNpbmNlIHRoZXkncmUgZnJvbSB0aGUgQVBJXG4gICAgICAgICAqIFNvIGl0IHdpbGwgc3RpbGwgc2hvdyB0aGUgcmV2ZXJ0IGJ1dHRvbiBldmVuIGlmIHRoZSBncm91cCBpcyBub3Qgc2VsZWN0ZWQgaW5pdGlhbGx5IGFuZCBzZWxlY3Rpb25UeXBlID09PSBcIm5vbmVcIlxuICAgICAgICAgKiAgd2l0aG91dCB0aGF0IGNvbmRpdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgaXNHcm91cFNlbGVjdGlvbkNoYW5nZWQgPSAoISFpbml0aWFsU2VsZWN0aW9uVHlwZSB8fCBzZWxlY3Rpb25UeXBlICE9PSBcIm5vbmVcIikgJiZcbiAgICAgICAgICAgIGluaXRpYWxTZWxlY3Rpb25UeXBlICE9PSBzZWxlY3Rpb25UeXBlO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtZ3JvdXAtY2FyZFwiLCB7IGdyb3VwOiBncm91cCwgcG9ydGFsOiBwb3J0YWwsIHVzZXI6IHVzZXIsIG5hbWU6IGdyb3VwLnRpdGxlLCBzZWxlY3RlZDogISFzZWxlY3RlZEdyb3VwRGF0YUxvb2t1cFtncm91cElkXSwgaW5kZXRlcm1pbmF0ZTogc2VsZWN0aW9uVHlwZSA9PT0gXCJpbmRldGVybWluYXRlXCIsIHNlbGVjdGlvbjogXCJtdWx0aXBsZVwiLCBwcmV2aWV3OiBcImFjdGlvblwiLCB2aWV3OiBcImNvbXBhY3RcIiwgc2hvd093bmVyOiB0cnVlLCBzaG93RGF0ZVVwZGF0ZWQ6IHRydWUsIHNob3dTdW1tYXJ5OiB0cnVlLCBrZXk6IGdyb3VwSWQgfSwgaChcInNwYW5cIiwgeyBzbG90OiBcImNvbnRlbnQtZW5kXCIgfSwgY3VyR3JvdXBDb3VudCAmJiBjdXJHcm91cENvdW50ID4gMCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJncm91cC1pdGVtLWNvdW50ZXJcIiB9LCBpMThuW2lzR3JvdXBTZWxlY3Rpb25DaGFuZ2VkID8gXCJ3aWxsU2hhcmVDb3VudEhpbnRcIiA6IFwic2hhcmVkQ291bnRIaW50XCJdXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7bnVtSXRlbX1cIiwgY3VyR3JvdXBDb3VudC50b0xvY2FsZVN0cmluZygpKVxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke3RvdGFsSXRlbX1cIiwgdG90YWxJdGVtQ291bnRTdHIpKSksIGlzR3JvdXBTZWxlY3Rpb25DaGFuZ2VkICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJyZXZlcnQtc2luZ2xlLWdyb3VwLWN0YVwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHJldmVydENsaWNrLmVtaXQoKTtcbiAgICAgICAgICAgIH0gfSwgaTE4bi5yZXZlcnQpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1TaGFyZUdyb3VwQ2FyZC5zdHlsZSA9IGFyY2dpc0l0ZW1TaGFyZUdyb3VwQ2FyZENzcztcblxuZXhwb3J0IHsgQXJjZ2lzRGVwZW5kZW5jeUNoZWNrIGFzIGFyY2dpc19kZXBlbmRlbmN5X2NoZWNrLCBBcmNnaXNJdGVtU2hhcmVHcm91cCBhcyBhcmNnaXNfaXRlbV9zaGFyZV9ncm91cCwgQXJjZ2lzSXRlbVNoYXJlR3JvdXBDYXJkIGFzIGFyY2dpc19pdGVtX3NoYXJlX2dyb3VwX2NhcmQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWRlcGVuZGVuY3ktY2hlY2tfMy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IElURU1fQlJPV1NFUl9CVUlMVF9JTl9GSUxURVJTID0gW1wiZm9sZGVyXCIsIFwiZ3JvdXBcIiwgXCJjb250ZW50VHlwZVwiXTtcbmNvbnN0IElURU1fQlJPV1NFUl9NQVhfSVRFTVMgPSA5OTk5OTsgLy8gYXJiaXRyYXJ5IGxhcmdlIG51bWJlciBzbyBpdCBzaG93IGFsbCBpdGVtc1xuXG5leHBvcnQgeyBJVEVNX0JST1dTRVJfQlVJTFRfSU5fRklMVEVSUyBhcyBJLCBJVEVNX0JST1dTRVJfTUFYX0lURU1TIGFzIGEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dHlwZXMtYTAzMWMxZGEuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hVc2VyKHVzZXJuYW1lLCBwb3J0YWwpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvdXNlcnMvJHt1c2VybmFtZX1gKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU2VsZigpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfS9jb21tdW5pdHkvc2VsZmApO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcygpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHNlbGYgPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gZmV0Y2hTZWxmKCksIFwiY29tbXVuaXR5U2VsZlwiLCB1c2VyLnVzZXJuYW1lKTtcbiAgICByZXR1cm4gKF9hID0gc2VsZiA9PT0gbnVsbCB8fCBzZWxmID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxmLmdyb3VwcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG59XG5hc3luYyBmdW5jdGlvbiBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAoKSB7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaFNlbGYoKSwgXCJjb21tdW5pdHlTZWxmXCIsIHVzZXIudXNlcm5hbWUpO1xuICAgIHJldHVybiBzZWxmLmZhdkdyb3VwSWQ7XG59XG5mdW5jdGlvbiBnZXRVc2VyQ29udGVudFVybCh1c2VyLCBwb3J0YWwpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci51c2VyQ29udGVudFVybCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYCR7cG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnJlc3RVcmx9L2NvbnRlbnQvdXNlcnMvJHt1c2VyLnVzZXJuYW1lfWA7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyQ29udGVudChwb3J0YWxVc2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgICBjb25zdCBwb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgY29uc3QgdXJsID0gZ2V0VXNlckNvbnRlbnRVcmwodXNlciwgcG9ydGFsKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IG51bTogMSB9KTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlcnMocG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgeyBmb2xkZXJzIH0gPSBhd2FpdCBnZXRVc2VyQ29udGVudCh1c2VyKTtcbiAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSB1c2VyO1xuICAgIGNvbnN0IHNvcnRlZEZvbGRlcnMgPSBmb2xkZXJzLnNvcnQoKGEsIGIpID0+IGEudGl0bGUubG9jYWxlQ29tcGFyZShiLnRpdGxlKSk7XG4gICAgLy8gYWRkIHRoZSBob21lIGZvbGRlciBhcyBpZiBpdCdzIGluIHRoZSBsaXN0XG4gICAgcmV0dXJuIFt7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9LCAuLi5zb3J0ZWRGb2xkZXJzXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlckZyb21JZChmb2xkZXJJZCwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gICAgcmV0dXJuIGZvbGRlcnMuZmluZCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQgPT09IGZvbGRlcklkKTtcbn1cbmZ1bmN0aW9uIGdldEhvbWVGb2xkZXJGb3JVc2VyKHVzZXJuYW1lKSB7XG4gICAgcmV0dXJuIHsgdXNlcm5hbWUsIGlkOiB1c2VybmFtZSwgdGl0bGU6IHVzZXJuYW1lLCBjcmVhdGVkOiBcIm5vd1wiIH07XG59XG5hc3luYyBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoZm9sZGVyTmFtZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vY3JlYXRlRm9sZGVyYDtcbiAgICBjb25zdCBmb2xkZXJSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IHRpdGxlOiBmb2xkZXJOYW1lIH0sIHt9LCBcInBvc3RcIik7XG4gICAgcmV0dXJuIGZvbGRlclJlc3BvbnNlO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRm9sZGVyKGlkLCBuZXdUaXRsZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vJHtpZH0vdXBkYXRlRm9sZGVyYDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0KHVybCwgeyBuZXdUaXRsZSB9LCB7fSwgXCJwb3N0XCIpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBnZXRGb2xkZXJGcm9tSWQgYXMgYSwgZ2V0SG9tZUZvbGRlckZvclVzZXIgYXMgYiwgY3JlYXRlRm9sZGVyIGFzIGMsIGdldFNpZ25lZEluVXNlcnNHcm91cHMgYXMgZCwgZ2V0U2lnbmVkSW5Vc2Vyc0Zhdm9yaXRlc0dyb3VwIGFzIGUsIGZldGNoVXNlciBhcyBmLCBnZXRGb2xkZXJzIGFzIGcsIHVwZGF0ZUZvbGRlciBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZXItM2VhNjljM2EuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9