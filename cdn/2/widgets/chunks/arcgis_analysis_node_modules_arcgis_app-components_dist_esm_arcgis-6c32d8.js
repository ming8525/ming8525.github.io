"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6c32d8"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-field-pick-list_11.entry.js":
/*!******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-field-pick-list_11.entry.js ***!
  \******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_field_pick_list: () => (/* binding */ ArcgisSmartMappingFieldPickList),
/* harmony export */   arcgis_smart_mapping_panels_chart_size: () => (/* binding */ ArcgisSmartMappingPanelsChartSize),
/* harmony export */   arcgis_smart_mapping_panels_color_size: () => (/* binding */ ArcgisSmartMappingPanelsColorSize),
/* harmony export */   arcgis_smart_mapping_panels_color_size_univariate: () => (/* binding */ ArcgisSmartMappingPanelsColorSizeUnivariate),
/* harmony export */   arcgis_smart_mapping_panels_compare: () => (/* binding */ ArcgisSmartMappingPanelsCompare),
/* harmony export */   arcgis_smart_mapping_panels_dot_density: () => (/* binding */ ArcgisSmartMappingPanelsDotDensity),
/* harmony export */   arcgis_smart_mapping_panels_heatmap: () => (/* binding */ ArcgisSmartMappingPanelsHeatmap),
/* harmony export */   arcgis_smart_mapping_panels_predominance_size: () => (/* binding */ ArcgisSmartMappingPanelsPredominanceSize),
/* harmony export */   arcgis_smart_mapping_panels_relationship_size: () => (/* binding */ ArcgisSmartMappingPanelsRelationshipSize),
/* harmony export */   arcgis_smart_mapping_panels_simple: () => (/* binding */ ArcgisSmartMappingPanelsSimple),
/* harmony export */   arcgis_smart_mapping_panels_type_size: () => (/* binding */ ArcgisSmartMappingPanelsTypeSize)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./colorSizeUnivariant-d266ac7c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSizeUnivariant-d266ac7c.js");
/* harmony import */ var _symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./symbolStyler-04635b2b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolStyler-04635b2b.js");
/* harmony import */ var _heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./heatmap-75ffd452.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./color-d6da0a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-d6da0a9a.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
















function round(numbers, options) {
    let numbersCopy = numbers.slice(0), number, prev, next, digits, fractionDigits, fixedNumber = 0, fixedNumbers, i, j, found, index, pctTolerance = !options || options.tolerance == null ? 2 : options.tolerance, indexes = options && options.indexes, strictBounds = !options || options.strictBounds == null ? false : options.strictBounds;
    const numericAscending = (a, b) => {
        return a - b;
    };
    //console.log("Numbers: ", numbers);
    //console.log("Percent tolerance: ", pctTolerance);
    // Find stops that need to be rounded.
    if (indexes) {
        indexes.sort(numericAscending);
    }
    else {
        // Get indexes of all numbers.
        // All stop values will be rounded.
        indexes = [];
        for (i = 0; i < numbersCopy.length; i++) {
            indexes.push(i);
        }
    }
    //console.log("indexes: ", indexes);
    for (i = 0; i < indexes.length; i++) {
        index = indexes[i];
        number = numbersCopy[index];
        prev = index === 0 ? undefined : numbersCopy[index - 1];
        next = index === numbersCopy.length - 1 ? undefined : numbersCopy[index + 1];
        digits = getDigits(number);
        fractionDigits = digits.fractional;
        //console.log(number, digits, prev, next);
        // Let's reduce the precision of fractional numbers.
        if (fractionDigits) {
            j = 0;
            found = false;
            // Keep iterating until we find an optimal precision.
            while (j <= fractionDigits && !found) {
                fixedNumbers = getFixedNumbers(number, j);
                // Use the adjusted/fixed number only if it introduces minimal change
                // in the sequence.
                fixedNumber = strictBounds && i === 0 ? fixedNumbers[1] : fixedNumbers[0];
                found = hasMinimalChange(number, fixedNumber, prev, next, pctTolerance);
                j++;
            }
            if (found) {
                // Update the sequence with the fixed number so that the next number
                // in sequence can be adjusted based on it.
                numbersCopy[index] = fixedNumber;
            }
        }
    }
    //console.log("Fixed: ", numbersCopy);
    return numbersCopy;
}
function getDigits(number) {
    // Returns number of digits in the integer and fractional parts of the
    // given numeric value.
    const _reNumber = /^-?(\d+)(\.(\d+))?$/i;
    let numString = String(number), match = numString.match(_reNumber), retVal = {
        integer: 0,
        fractional: 0
    };
    if (match && match[1]) {
        retVal.integer = match[1].split("").length;
        // Integer digits can also be calculated using this logic:
        // var adjust = (num > 0) ? Math.floor(num) : Math.ceil(num);
        // adjust = Math.abs(adjust);
        // return Math.floor( Math.log(adjust) / Math.LN10 );
        retVal.fractional = match[3] ? match[3].split("").length : 0;
        // Fractional digits can also be calculated using this logic:
        //  var e = 1;
        //
        //  while (Math.round(number * e) / e !== number) {
        //    e *= 10;
        //  }
        //
        //  // Max precision returned seems to be 15
        //  return Math.round( Math.log(e) / Math.LN10 );
    }
    else if (numString.toLowerCase().indexOf("e") > -1) {
        // Number in exponential notation.
        // Ex: 1.4868420127616598e-7, 134e25, 134e-25 etc
        let parts = numString.split("e"), numericPart_ = parts[0], powerOfTen_ = parts[1], digits, isPosPower;
        if (numericPart_ && powerOfTen_) {
            // Convert strings to numbers.
            const numericPart = Number(numericPart_);
            let powerOfTen = Number(powerOfTen_);
            // Is the power positive?
            isPosPower = powerOfTen > 0;
            // Get the absolute value of power.
            if (!isPosPower) {
                powerOfTen = Math.abs(powerOfTen);
            }
            digits = getDigits(numericPart);
            // Update "digits" using powerOfTen value.
            if (isPosPower) {
                digits.integer += powerOfTen;
                if (powerOfTen > digits.fractional) {
                    digits.fractional = 0;
                }
                else {
                    digits.fractional -= powerOfTen;
                }
            }
            else {
                digits.fractional += powerOfTen;
                if (powerOfTen > digits.integer) {
                    digits.integer = 1;
                }
                else {
                    digits.integer -= powerOfTen;
                }
            }
            retVal = digits;
        }
    }
    return retVal;
}
function getFixedNumbers(number, fractionDigits) {
    let num1, num2;
    num1 = Number(number.toFixed(fractionDigits));
    if (num1 < number) {
        // num2 will be larger than num1/number
        num2 = num1 + 1 / Math.pow(10, fractionDigits);
    }
    else {
        // num2 will be smaller than num1/number
        num2 = num1;
        num1 = num1 - 1 / Math.pow(10, fractionDigits);
    }
    // Fix spurious floating point number precision.
    // Examples:
    //  0.3 - 0.1 = 0.19999999999999998
    //  0.2 + 0.1 = 0.30000000000000004
    // http://stackoverflow.com/questions/1458633/how-to-deal-with-floating-point-number-precision-in-javascript
    num1 = Number(num1.toFixed(fractionDigits));
    num2 = Number(num2.toFixed(fractionDigits));
    // Returns two numbers (equivalent to floor and ceil of the given number):
    // One less than the given number.
    // The other greater than the given number.
    // num1 is floor, num2 is ceil.
    return [num1, num2];
}
function hasMinimalChange(number, fixedNumber, prev, next, pctTolerance) {
    // Returns true if the given <fixedNumber> has changed minimally with
    // respect to the nearby numbers in the sequence given by <prev> and <next>.
    let change = getPctChange(number, fixedNumber, prev, next), prevOk, nextOk, isMinimal;
    //console.log(" ", change, fixedNumber);
    // It is considered minimal change if one of the following conditions is true:
    // 1. Change w.r.t <prev> is atmost <pctTolerance> AND
    //    Change w.r.t <next> is atmost <pctTolerance>
    // 2. Sum of change w.r.t <prev> and <next> is atmost twice the <pctTolerance>.
    prevOk = change.prev == null || change.prev <= pctTolerance;
    nextOk = change.next == null || change.next <= pctTolerance;
    isMinimal = (prevOk && nextOk) || change.prev + change.next <= 2 * pctTolerance;
    return isMinimal;
}
function getPctChange(number, fixedNumber, prev, next) {
    // Returns the absolute percent change of the given number
    // (after it has been changed to <fixedNumber>)
    // w.r.t its nearby numbers given as <prev> and <next>.
    let change = {
        prev: null,
        next: null
    }, oldDiff, newDiff, diffChange;
    if (prev != null) {
        oldDiff = number - prev;
        newDiff = fixedNumber - prev;
        diffChange = newDiff - oldDiff;
        change.prev = Math.floor(Math.abs((diffChange * 100) / oldDiff));
    }
    if (next != null) {
        oldDiff = next - number;
        newDiff = next - fixedNumber;
        diffChange = newDiff - oldDiff;
        change.next = Math.floor(Math.abs((diffChange * 100) / oldDiff));
    }
    return change;
}

const arcgisSmartMappingFieldPickListCss = ".popover{z-index:100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}";

const ArcgisSmartMappingFieldPickList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingFieldPickListClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingFieldPickListClose", 7);
        this.arcgisSmartMappingFieldPickListChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingFieldPickListChange", 7);
        this.arcgisSmartMappingFieldPickListSortByChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingFieldPickListSortByChange", 7);
        this.maxNumberFieldCount = 10;
        this.selectedFields = [];
        this.fields = undefined;
        this.fieldToReplace = undefined;
        this.popoverProps = undefined;
        this.singleEditMode = false;
        this.heading = undefined;
        this.okBtnText = undefined;
        this.filterPlaceholderText = undefined;
        this.lastSortBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.default;
        this.filterFields = null;
        this.isOpen = false;
        this.width = undefined;
    }
    // --------------------------------------------------------------------------
    //
    // Public Methods
    //
    // --------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    // --------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    // --------------------------------------------------------------------------
    async componentWillLoad() {
        var _a;
        this.isOpen = true;
        this.rendererFieldInfosMap = (_a = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields) === null || _a === void 0 ? void 0 : _a.reduce((map, fieldInfo) => {
            map[fieldInfo.field] = fieldInfo;
            return map;
        }, {});
    }
    componentDidLoad() {
        var _a;
        this.setUpObservers();
        (_a = this.resizeObserver) === null || _a === void 0 ? void 0 : _a.observe(this.popoverProps.refElement);
        const disabledListItems = this.checkDisabledListItems();
        disabledListItems.forEach((item) => this.listNode.removeChild(item));
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    disconnectedCallback() {
        var _a, _b;
        (_a = this.mutationObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
        (_b = this.resizeObserver) === null || _b === void 0 ? void 0 : _b.unobserve(this.popoverProps.refElement);
    }
    // --------------------------------------------------------------------------
    //
    // Render  Methods
    //
    // --------------------------------------------------------------------------
    render() {
        const props = this.popoverProps;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.isRTL ? "rtl" : "ltr", class: "popover", placement: props.placement || "leading-start", open: this.isOpen, pointerDisabled: true, referenceElement: props.refElement, offsetDistance: props.offsetDistance || -(props.popoverWidth || this.width) + 10, offsetSkidding: props.offsetSkidding || 0, overlayPositioning: props.overlayPositioning, triggerDisabled: props.triggerDisabled, label: this.heading ||
                (this.singleEditMode ? strings.replaceField : strings.fieldPickList.selectFields), ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (node) => (this.flowNode = node), style: {
                width: `${this.width || props.popoverWidth}px`
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { ref: (node) => (this.flowItemNode = node), class: "panel", heading: this.heading ||
                (this.singleEditMode ? strings.replaceField : strings.fieldPickList.selectFields), closable: true, onCalciteFlowItemClose: () => this.arcgisSmartMappingFieldPickListClose.emit() }, !this.singleEditMode && this.renderAddButton(), this.renderCancelButton(), this.renderList())))));
    }
    renderAddButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", appearance: "solid", width: "half", scale: "m", onClick: () => this.arcgisSmartMappingFieldPickListClose.emit({
                selectedFields: this.selectedFields
            }) }, this.okBtnText || strings.add));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", appearance: "outline-fill", width: this.singleEditMode ? "full" : "half", scale: "m", onClick: () => this.arcgisSmartMappingFieldPickListClose.emit() }, strings.cancel));
    }
    renderList() {
        var _a;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { selectionMode: this.singleEditMode ? "single-persist" : "multiple", ref: (node) => (this.listNode = node), class: "content", filterEnabled: this.fields.length >= 10, filterPlaceholder: (_a = this.filterPlaceholderText) !== null && _a !== void 0 ? _a : strings.fieldPickList.searchFields, onCalciteListFilter: () => {
                var _a, _b;
                this.filterFields = (_b = (_a = this.listNode) === null || _a === void 0 ? void 0 : _a.filteredItems) === null || _b === void 0 ? void 0 : _b.map((item) => {
                    return item.value;
                });
            } }, this.renderSortDropdown(), [...this.getSortedList()].map((field) => {
            return this.renderListItem(field);
        })));
    }
    renderListItem(field) {
        var _a;
        const { layer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const isBinningLayer = "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: field.layerField.name, label: field.label || field.layerField.name, "data-type": field.simpleFieldType, value: field.layerField.name, selected: this.singleEditMode && field.layerField.name === this.fieldToReplace.field, metadata: {
                label: field.label,
                fieldName: field.layerField.name
            }, onCalciteListItemSelect: () => {
                this.selectedFields = this.listNode.selectedItems.map((node) => node.value);
                if (this.singleEditMode) {
                    if (this.selectedFields[0] !== this.fieldToReplace.field) {
                        this.arcgisSmartMappingFieldPickListClose.emit({
                            selectedFields: this.selectedFields
                        });
                    }
                    return;
                }
                this.checkDisabledListItems();
                this.arcgisSmartMappingFieldPickListChange.emit({ selectedFields: this.selectedFields });
            } }, !isBinningLayer && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: strings.fieldPickList.info, scale: "s", icon: "information", onClick: (event) => {
                var _a;
                event.stopPropagation();
                const action = event.target;
                const fieldInfoFlowItem = document.createElement("calcite-flow-item");
                fieldInfoFlowItem.heading = (_a = field.label) !== null && _a !== void 0 ? _a : field.layerField.name;
                fieldInfoFlowItem.description = field.layerField.name;
                const fieldInfo = document.createElement("arcgis-field-info");
                fieldInfo.lang = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.fullLocale;
                fieldInfo.fieldName = field.layerField.name;
                fieldInfo.layer = layer;
                fieldInfo.view = mapView;
                fieldInfo.classList.add("content");
                fieldInfoFlowItem.appendChild(fieldInfo);
                fieldInfoFlowItem.addEventListener("calciteFlowItemBack", () => {
                    requestAnimationFrame(() => action.setFocus());
                    fieldInfoFlowItem.removeChild(fieldInfo);
                    this.flowNode.removeChild(fieldInfoFlowItem);
                });
                this.flowNode.appendChild(fieldInfoFlowItem);
                requestAnimationFrame(() => fieldInfoFlowItem.setFocus());
            } }))));
    }
    renderSortDropdown() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderSortMenu = this.fields.length > 10;
        if (!renderSortMenu) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-end", overlayPositioning: "fixed", slot: "filter-actions-end", ref: (node) => (this.dropdownNode = node), onCalciteDropdownOpen: () => {
                var _a;
                (_a = this.mutationObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.mutationObserver.observe(this.popoverNode, { attributes: true });
            }, onCalciteDropdownClose: () => { var _a; return (_a = this.mutationObserver) === null || _a === void 0 ? void 0 : _a.disconnect(); }, onCalciteDropdownSelect: () => {
                var _a;
                this.lastSortBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L[(_a = this.dropdownNode.selectedItems[0]) === null || _a === void 0 ? void 0 : _a.label];
                this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "trigger", text: strings.fieldPickList.sort, title: strings.fieldPickList.sort }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "sortDescending" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { label: _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.default, selected: this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.default }, strings.fieldPickList.default), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { label: _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.display, selected: this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.display }, strings.fieldPickList.displayName), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { label: _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.type, selected: this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.type }, strings.fieldPickList.type), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { label: _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.field, selected: this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.field }, strings.fieldPickList.fieldName))));
    }
    // --------------------------------------------------------------------------
    //
    // Private Methods
    //
    // --------------------------------------------------------------------------
    checkDisabledListItems() {
        if (!this.listNode) {
            return;
        }
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.C)();
        if (this.singleEditMode) {
            counts[this.fieldToReplace.simpleFieldType]--;
        }
        else {
            this.selectedFields.forEach((fieldName) => {
                const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(fieldName);
                if (field) {
                    const type = field.simpleFieldType;
                    switch (type) {
                        case "number":
                            counts.number++;
                            break;
                        case "string":
                            counts.string++;
                            break;
                        case "date":
                            counts.date++;
                            break;
                    }
                }
            });
        }
        const disabledListItems = [];
        this.listNode
            .querySelectorAll("calcite-list-item")
            .forEach((item) => this.enableListItem(item));
        if (_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.mapImageSublayer &&
            !_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.supportsArcade &&
            counts.number + counts.string + counts.date + counts.unknown === 1) {
            // max 1 field
            this.listNode
                .querySelectorAll(`[data-type="string"], [data-type="number"], [data-type="date"]`)
                .forEach((item) => {
                if (this.selectedFields.indexOf(item.value) === -1) {
                    this.disableListItem(item);
                    disabledListItems.push(item);
                }
            });
        }
        else if (_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.mapImageSublayer &&
            counts.number + counts.string + counts.date + counts.unknown === 1 &&
            counts.date === 1) {
            // max 1 date field
            this.listNode
                .querySelectorAll(`[data-type="date"]`)
                .forEach((item) => {
                if (this.selectedFields.indexOf(item.value) === -1) {
                    this.disableListItem(item);
                    disabledListItems.push(item);
                }
            });
        }
        else if (counts.string === 1) {
            // max 1 string field
            this.listNode
                .querySelectorAll(`[data-type="string"]`)
                .forEach((item) => {
                if (this.selectedFields.indexOf(item.value) === -1) {
                    this.disableListItem(item);
                    disabledListItems.push(item);
                }
            });
            if (counts.number === 1 || counts.date === 1 || counts.unknown === 1) {
                // max 1 number/date field if there is 1 string field
                this.listNode
                    .querySelectorAll(`[data-type="number"], [data-type="date"]`)
                    .forEach((item) => {
                    if (this.selectedFields.indexOf(item.value) === -1) {
                        this.disableListItem(item);
                        disabledListItems.push(item);
                    }
                });
            }
        }
        else if (counts.number + counts.date + counts.unknown > 1) {
            // we have at least 2 fields
            if ((counts.expression > 0 &&
                !(counts.expression === 1 &&
                    this.selectedFields.length === 3 &&
                    this.rendererFieldInfosMap[this.selectedFields[2]].expression)) ||
                (counts.date > 0 && counts.number === 2 && !this.singleEditMode) ||
                counts.date === 2 ||
                (_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.mapImageSublayer && counts.date > 0)) {
                // max 2 fields
                this.listNode
                    .querySelectorAll("calcite-list-item")
                    .forEach((item) => {
                    if (this.selectedFields.indexOf(item.value) === -1) {
                        this.disableListItem(item);
                        disabledListItems.push(item);
                    }
                });
            }
            else {
                // no more strings
                this.listNode
                    .querySelectorAll(`[data-type="string"]`)
                    .forEach((item) => {
                    this.disableListItem(item);
                    disabledListItems.push(item);
                    if (this.selectedFields.indexOf(item.value) > -1) {
                        // wrong combination
                        item.selected = false;
                    }
                });
                if (counts.number > 2 || _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.mapImageSublayer) {
                    // no more date field
                    this.listNode
                        .querySelectorAll(`[data-type="date"]`)
                        .forEach((item) => {
                        this.disableListItem(item);
                        disabledListItems.push(item);
                        if (this.selectedFields.indexOf(item.value) > -1) {
                            // wrong combination
                            item.selected = false;
                        }
                    });
                }
                if (counts.date === 1) {
                    // max one date field
                    this.listNode
                        .querySelectorAll(`[data-type="date"]`)
                        .forEach((item) => {
                        if (this.selectedFields.indexOf(item.value) === -1) {
                            this.disableListItem(item);
                            disabledListItems.push(item);
                        }
                    });
                }
                if (counts.number >= this.maxNumberFieldCount) {
                    // 10 number fields max
                    this.listNode
                        .querySelectorAll(`[data-type="number"], [data-type="date"]`)
                        .forEach((item) => {
                        if (this.selectedFields.indexOf(item.value) === -1) {
                            this.disableListItem(item);
                            disabledListItems.push(item);
                        }
                    });
                }
            }
        }
        return disabledListItems;
    }
    disableListItem(item) {
        item.disabled = true;
        const action = item.querySelector("calcite-action");
        if (action) {
            action.disabled = true;
        }
    }
    enableListItem(item) {
        item.disabled = false;
        const action = item.querySelector("calcite-action");
        if (action) {
            action.disabled = false;
        }
    }
    getSortedList() {
        const tempSorted = [...this.fields];
        if (this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.display) {
            tempSorted.sort((a, b) => a.layerField.alias.localeCompare(b.layerField.alias));
        }
        else if (this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.field) {
            tempSorted.sort((a, b) => a.layerField.name.localeCompare(b.layerField.name));
        }
        else if (this.lastSortBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__.L.type) {
            tempSorted.sort((a, b) => a.simpleFieldType.localeCompare(b.simpleFieldType));
        }
        return tempSorted;
    }
    setUpObservers() {
        this.mutationObserver = new MutationObserver((mutationList /* , mutationObserver */) => {
            for (const mutation of mutationList) {
                if (mutation.attributeName === "style") {
                    if (this.popoverNode.style.visibility === "hidden") {
                        this.dropdownNode.open = false;
                    }
                }
            }
        });
        this.resizeObserver = new ResizeObserver((entries) => {
            const last = entries.pop();
            this.width = last.contentRect.width * 1.05;
        });
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingFieldPickList.style = arcgisSmartMappingFieldPickListCss;

const arcgisSmartMappingPanelsChartSizeCss = ":host{width:100%}.flow-item{height:100%}";

const ArcgisSmartMappingPanelsChartSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsChartSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartSizeBackClick", 7);
        this.arcgisSmartMappingPanelsChartSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartSizeClose", 7);
        this.arcgisSmartMappingPanelsChartSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartSizeError", 7);
        this.tileNodes = [];
        //-------------------------------------------------------------------
        //
        //  Private Methods
        //
        //-------------------------------------------------------------------
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            switch (type) {
                case "size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsChartSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "chart": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-chart");
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartError", ({ detail }) => this.arcgisSmartMappingPanelsChartSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.lastClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, mapImageSublayer, layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), heading: strings.panels.styleOptions, description: title, menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, ref: (node) => (this.flowItemNode = node), onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsChartSizeBackClick.emit(), onCalciteFlowItemClose: () => this.arcgisSmartMappingPanelsChartSizeClose.emit() }, this.renderChartTile(), this.renderSizeTile(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderChartTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "chart", selected: this.lastClick === "chart", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "chart";
                this.handleOptionsClick("chart");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("chart"), ref: (node) => {
                if (node) {
                    this.tileNodes["chart"] = node;
                }
            } }));
    }
    renderSizeTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "size", selected: this.lastClick === "size", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "size";
                this.handleOptionsClick("size");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("size"), ref: (node) => {
                if (node) {
                    this.tileNodes["size"] = node;
                }
            } }));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: () => this.arcgisSmartMappingPanelsChartSizeClose.emit(), appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(this.originalRendererJSON, this.originalFeatureReduction);
                this.arcgisSmartMappingPanelsChartSizeClose.emit();
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => this.tileNodes[this.lastClick].setFocus()), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsChartSize.style = arcgisSmartMappingPanelsChartSizeCss;

const arcgisSmartMappingPanelsColorSizeCss = ":host{width:100%}.flow-item{height:100%}";

const ArcgisSmartMappingPanelsColorSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsColorSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeClose", 7);
        this.arcgisSmartMappingPanelsColorSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeBackClick", 7);
        this.arcgisSmartMappingPanelsColorSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeError", 7);
        this.tileNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            switch (type) {
                case "size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsColorSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "color": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-color");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorError", ({ detail }) => this.arcgisSmartMappingPanelsColorSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsColorSizeClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsColorSizeClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.lastClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsColorSizeBackClick.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderColorTile(), this.renderSizeTile(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderColorTile() {
        const { lastClick } = this;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
        const type = rendererType === "color-age-size" ? "color-age" : "color";
        const theme = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.J)("color");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { key: `tile-${type}-${theme}`, type: type, selected: lastClick === "color", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = type;
                this.handleOptionsClick("color");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("color"), onArcgisSmartMappingTileError: (event) => this.arcgisSmartMappingPanelsColorSizeError.emit(event.detail), ref: (node) => {
                if (node) {
                    this.tileNodes[type] = node;
                }
            } }));
    }
    renderSizeTile() {
        const { lastClick } = this;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
        const type = rendererType === "color-size-age" ? "size-age" : "size";
        const theme = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.J)("size");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { key: `tile-${type}-${theme}`, type: type, selected: lastClick === "size", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = type;
                this.handleOptionsClick("size");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("size"), onArcgisSmartMappingTileError: (event) => this.arcgisSmartMappingPanelsColorSizeError.emit(event.detail), ref: (node) => {
                if (node) {
                    this.tileNodes[type] = node;
                }
            } }));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsColorSizeError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsColorSizeError.emit(detail) }));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => this.tileNodes[this.lastClick].setFocus()), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsColorSize.style = arcgisSmartMappingPanelsColorSizeCss;

const arcgisSmartMappingPanelsColorSizeUnivariateCss = ":host{width:100%}.flow-item{height:100%}.color-size-univariate-block{overflow-x:hidden}.attribute-name{word-break:break-all}.symbol-above-and-below{display:flex;justify-content:space-between}.above-below-symbol-button{width:49%}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";

const ArcgisSmartMappingPanelsColorSizeUnivariate = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsColorSizeUnivariateClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeUnivariateClose", 7);
        this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeUnivariateBackClick", 7);
        this.arcgisSmartMappingPanelsColorSizeUnivariateError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorSizeUnivariateError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.visualizationOpen = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        var _a, _b;
        const { visualizationOpen } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const fieldName = colorVisVar
            ? colorVisVar.field
                ? (_a = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(colorVisVar.field)) === null || _a === void 0 ? void 0 : _a.label
                : colorVisVar.valueExpressionTitle || strings.expression
            : renderer.field
                ? (_b = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(renderer.field)) === null || _b === void 0 ? void 0 : _b.label
                : renderer.valueExpressionTitle || strings.expression;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "color-size-univariate-block", heading: strings.panels.colorSizeUnivariate.colorSizeStyle, collapsible: true, open: visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "attribute-name" }, fieldName), this.renderTheme(), this.renderDividedBy(), this.renderSymbolPairButton(), this.renderAboveAndBelowSymbols(), this.renderColorScheme(), this.renderSymbol(), this.renderColorSizeSlider(), this.renderSizeRange(), this.renderBackgroundStyle(), this.renderDefaultSymbol(), this.renderShowInLegend()));
    }
    renderTheme() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-theme-button", { ref: (node) => (this.themeButtonNode = node), rendererSubtype: "colorSize", onArcgisSmartMappingThemeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)(), onArcgisSmartMappingThemeButtonChange: (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                const authInfo = renderer.authoringInfo;
                const wasAboveAndBelow = authInfo.univariateTheme === "above-and-below";
                const isAboveAndBelow = event.detail === "above-and-below";
                let updateCall = _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_6__.a;
                if (!wasAboveAndBelow && isAboveAndBelow) {
                    updateCall = _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_6__.c;
                }
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_5__.r)(updateCall({
                    theme: event.detail,
                    fieldInfos: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.f)(layer),
                    discardMinMax: true
                }), this.flowItemNode).then((result) => {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.e)(result.renderer, layer);
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    this.themeButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sizeRangeSliderNode);
                    if (this.sliderNode) {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                        this.sliderNode.updateStatistics();
                    }
                }, (error) => {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(error);
                });
            } }));
    }
    renderDividedBy() {
        const { layer, fields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
        const isAgeRenderer = ["color-age", "color-age-size"].indexOf(rendererType) > -1;
        if (isAgeRenderer) {
            return null;
        }
        const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.f)(layer)[0];
        if (fieldInfo.expression || fieldInfo.simpleFieldType !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER) {
            return null;
        }
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.I)(fields);
        if (counts.number < 2) {
            return null;
        }
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-divided-by", { rendererSubtype: "color", normalizationField: (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.normalizationField) || renderer.normalizationField, onArcgisSmartMappingDividedByChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode.updateStatistics();
            }, onArcgisSmartMappingDividedByError: (event) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(event.detail) }));
    }
    renderSymbolPairButton() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.B)(layer)) {
            return null;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        if (!isAboveAndBelow) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-pair-button", { onArcgisSmartMappingSymbolPairButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)(), onArcgisSmartMappingSymbolPairButtonChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
                this.symbolButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
                this.symbolPairButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolPairButtonNode);
            }, onArcgisSmartMappingSymbolPairButtonError: (event) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(event.detail), ref: (node) => {
                if (node) {
                    this.symbolPairButtonNode = node;
                }
            } }));
    }
    renderAboveAndBelowSymbols() {
        var _a;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        if (!isAboveAndBelow) {
            return null;
        }
        const symbolStyle = authInfo.univariateSymbolStyle;
        if (!symbolStyle || ((_a = renderer.classBreakInfos) === null || _a === void 0 ? void 0 : _a.length) !== 2) {
            return null;
        }
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)((colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.field) || renderer.field);
        const isDate = (field === null || field === void 0 ? void 0 : field.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE;
        const aboveSymbol = renderer.classBreakInfos[1].symbol;
        const belowSymbol = renderer.classBreakInfos[0].symbol;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-above-and-below" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { class: "above-below-symbol-button", popoverReferenceElement: this.flowItemNode, symbol: belowSymbol, type: "below", label: isDate
                ? strings.panels.colorSizeUnivariate.before
                : strings.panels.colorSizeUnivariate.below, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.symbolPairButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolPairButtonNode);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { class: "above-below-symbol-button", popoverReferenceElement: this.flowItemNode, symbol: aboveSymbol, type: "above", label: isDate
                ? strings.panels.colorSizeUnivariate.after
                : strings.panels.colorSizeUnivariate.above, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.symbolPairButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolPairButtonNode);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } })));
    }
    renderColorScheme() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isAboveAndBelow = authInfo.univariateTheme === "above-and-below";
        if (!isAboveAndBelow) {
            return null;
        }
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.colorSizeUnivariate.colorScheme, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control", { scale: "s", width: "full", onCalciteSegmentedControlChange: (event) => {
                event.stopPropagation();
                this.handleColorSchemeChange(event.target.selectedItem.value);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { checked: !!colorVisVar, value: "continuous", ref: (node) => (this.continuousNode = node) }, strings.panels.colorSizeUnivariate.continuous), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { checked: !colorVisVar, value: "binary", ref: (node) => (this.binaryNode = node) }, strings.panels.colorSizeUnivariate.binary))));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const classBreakInfos = renderer.classBreakInfos;
        let colors;
        if (colorVisVar) {
            colors = colorVisVar.stops.map((stop) => {
                const color = stop.color.clone();
                color.a = 1;
                return color;
            });
        }
        else if (classBreakInfos === null || classBreakInfos === void 0 ? void 0 : classBreakInfos.length) {
            colors = classBreakInfos.map((classBreakInfo) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.t)(classBreakInfo.symbol));
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { colors: colors, type: "color-ramp", rampType: colorVisVar ? "continuous" : "discrete", ref: (node) => (this.symbolButtonNode = node), onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderColorSizeSlider() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-color-size-slider", { ref: (node) => {
                if (node) {
                    this.sliderNode = node;
                }
            }, onArcgisSmartMappingColorSizeSliderChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            }, onArcgisSmartMappingColorSizeSliderError: (event) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(event.detail) }));
    }
    renderSizeRange() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-size-range-slider", { onArcgisSmartMappingSizeRangeSliderError: (event) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(event.detail), ref: (node) => (this.sizeRangeSliderNode = node) }));
    }
    renderBackgroundStyle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.q)(layer) || ["color-size"].indexOf(rendererType) === -1) {
            return null;
        }
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", null);
    }
    renderDefaultSymbol() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-default-symbol", { ref: (node) => {
                if (node) {
                    this.defaultSymbolNode = node;
                }
            }, onArcgisSmartMappingDefaultSymbolBeforeToggle: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)(), onArcgisSmartMappingDefaultSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode) }));
    }
    renderShowInLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const legendOptions = colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.legendOptions;
        const isChecked = !legendOptions || legendOptions.showLegend !== false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "legend-toggle-padding", layout: "inline-space-between" }, strings.panels.colorSizeUnivariate.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, ref: (node) => (this.rotationNode = node), onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(detail) }));
    }
    handleColorSchemeChange(scheme) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_5__.r)((0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_6__.a)({ isContinuous: scheme === "continuous" }), this.flowItemNode).then((result) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.e)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
        }, (error) => {
            // handles checking the previously checked color scheme option; order matters when setting these!
            if (this.continuousNode.checked) {
                this.continuousNode.checked = false;
                this.binaryNode.checked = true;
            }
            else {
                this.binaryNode.checked = false;
                this.continuousNode.checked = true;
            }
            this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(error);
        });
    }
    handleIncludeInLegendToggle() {
        var _a;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "size");
        const legendOptions = sizeVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                sizeVisVar.legendOptions = undefined;
            }
            if ((_a = colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.legendOptions) === null || _a === void 0 ? void 0 : _a.title) {
                colorVisVar.legendOptions.showLegend = true;
            }
            else if (colorVisVar) {
                colorVisVar.legendOptions = undefined;
            }
        }
        else {
            sizeVisVar.legendOptions = legendOptions || {};
            sizeVisVar.legendOptions.showLegend = false;
            if (colorVisVar) {
                colorVisVar.legendOptions = legendOptions || {};
                colorVisVar.legendOptions.showLegend = false;
            }
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsColorSizeUnivariate.style = arcgisSmartMappingPanelsColorSizeUnivariateCss;

const arcgisSmartMappingPanelsCompareCss = ":host{width:100%}.flow-item{height:100%}.compare-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";

const ArcgisSmartMappingPanelsCompare = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsCompareClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsCompareClose", 7);
        this.arcgisSmartMappingPanelsCompareBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsCompareBackClick", 7);
        this.arcgisSmartMappingPanelsCompareError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsCompareError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsCompareClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsCompareClose.emit("cancel");
        };
        this.hideRotation = false;
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.MISSING;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.visualizationOpen = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.getStatistics();
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsCompareBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization(), this.renderRotation())));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const { visualizationOpen, hideRotation } = this;
        const hasOtherBlocks = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.A)(layer) && !hideRotation;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color");
        const field1 = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(colorVisVar.field);
        const field2 = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(colorVisVar.normalizationField);
        const title = (authColorVisVar.style === "ratio"
            ? strings.panels.compare.ratioTitle
            : authColorVisVar.style === "percent"
                ? strings.panels.compare.percentTitle
                : strings.panels.compare.percentTotalTitle)
            .replace(/\$\{field1\}/g, field1.label)
            .replace("${field2}", field2.label);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "compare-block", heading: strings.panels.compare.compareStyle, collapsible: hasOtherBlocks, open: visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, title), this.renderSymbol(), this.renderColorSlider(), this.renderLabels(), this.renderCenterAt(), this.renderDefaultSymbol(), this.renderShowInLegend()));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const classBreakInfos = renderer.classBreakInfos;
        const symbol = classBreakInfos[0].symbol;
        const colors = colorVisVar.stops.map((stop) => {
            const color = stop.color.clone();
            color.a = 1;
            return color;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, colors: colors, type: "color-ramp", rampType: "continuous", ref: (node) => {
                if (node) {
                    this.symbolButtonNode = node;
                }
            }, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderColorSlider() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-color-slider", { ref: (node) => {
                if (node) {
                    this.sliderNode = node;
                }
            }, onArcgisSmartMappingColorSliderChange: () => {
                const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
                const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color");
                const usePercent = authColorVisVar ? authColorVisVar.style === "percent" : false;
                const usePercentTotal = authColorVisVar
                    ? authColorVisVar.style === "percent-of-total"
                    : false;
                colorVisVar.stops[0].label = `< ${this.getStopLabel(colorVisVar.stops[0].value, usePercent, usePercentTotal)}`;
                colorVisVar.stops[2].label = `${this.getStopLabel(colorVisVar.stops[2].value, usePercent, usePercentTotal)}`;
                colorVisVar.stops[4].label = `> ${this.getStopLabel(colorVisVar.stops[4].value, usePercent, usePercentTotal)}`;
                if (this.segmentedControlNode) {
                    if (colorVisVar.stops[2].value === 1) {
                        this.equalNode.checked = true;
                        this.averageNode.checked = false;
                    }
                    else {
                        this.equalNode.checked = false;
                        this.averageNode.checked = true;
                    }
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            }, onArcgisSmartMappingColorSliderError: (event) => this.arcgisSmartMappingPanelsCompareError.emit(event.detail) }));
    }
    renderLabels() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color");
        const style = authColorVisVar ? authColorVisVar.style : undefined;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.compare.labels, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", role: "button", label: strings.panels.compare.labels, onCalciteSelectChange: (event) => this.handleLabelChange(event) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: strings.panels.compare.ratioLabel, label: strings.panels.compare.ratioLabel, selected: style === "ratio" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: strings.panels.compare.percentTotalLabel, label: strings.panels.compare.percentTotalLabel, selected: style === "percent-of-total" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: strings.panels.compare.percentLabel, label: strings.panels.compare.percentLabel, selected: style === "percent" }))));
    }
    renderCenterAt() {
        const { statistics, statisticsStatus } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (statisticsStatus !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.SUCCESS) {
            return null;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(statistics.min) ||
            !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(statistics.max) ||
            statistics.min >= 1 ||
            statistics.max <= 1) {
            return null;
        }
        const type = colorVisVar.stops[2].value === 1 ? "equal" : "average";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.compare.centerAt), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control", { scale: "s", width: "full", onCalciteSegmentedControlChange: (event) => {
                event.stopPropagation();
                this.handleCenterAtChange(event.target.selectedItem.value);
            }, ref: (node) => {
                if (node) {
                    this.segmentedControlNode = node;
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { checked: type === "equal", value: "equal", ref: (node) => {
                if (node) {
                    this.equalNode = node;
                }
            } }, strings.panels.compare.centerEqualValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { checked: type === "average", value: "average", ref: (node) => {
                if (node) {
                    this.averageNode = node;
                }
            } }, strings.panels.compare.centerAverageValue))));
    }
    renderDefaultSymbol() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-default-symbol", { ref: (node) => {
                if (node) {
                    this.defaultSymbolNode = node;
                }
            }, onArcgisSmartMappingDefaultSymbolBeforeToggle: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)(), onArcgisSmartMappingDefaultSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode) }));
    }
    renderShowInLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const legendOptions = colorVisVar.legendOptions;
        const isChecked = !legendOptions || legendOptions.showLegend !== false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "legend-toggle-padding", layout: "inline-space-between" }, strings.panels.compare.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, ref: (node) => (this.rotationNode = node), onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsCompareError.emit(detail) }));
    }
    handleLabelChange(event) {
        const node = event.currentTarget;
        const newLabel = node.value;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const style = newLabel === strings.panels.compare.ratioLabel
            ? "ratio"
            : newLabel === strings.panels.compare.percentTotalLabel
                ? "percent-of-total"
                : "percent";
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color");
        authColorVisVar.style = style;
        if (style === "percent") {
            colorVisVar.stops[0].label = `< ${this.getStopLabel(colorVisVar.stops[0].value, true, false)}`;
            colorVisVar.stops[2].label = this.getStopLabel(colorVisVar.stops[2].value, true, false);
            colorVisVar.stops[4].label = `> ${this.getStopLabel(colorVisVar.stops[4].value, true, false)}`;
        }
        else if (style === "percent-of-total") {
            colorVisVar.stops[0].label = `< ${this.getStopLabel(colorVisVar.stops[0].value, false, true)}`;
            colorVisVar.stops[2].label = this.getStopLabel(colorVisVar.stops[2].value, false, true);
            colorVisVar.stops[4].label = `> ${this.getStopLabel(colorVisVar.stops[4].value, false, true)}`;
        }
        else {
            colorVisVar.stops[0].label = `< ${this.getStopLabel(colorVisVar.stops[0].value, false, false)}`;
            colorVisVar.stops[2].label = this.getStopLabel(colorVisVar.stops[2].value, false, false);
            colorVisVar.stops[4].label = `> ${this.getStopLabel(colorVisVar.stops[4].value, false, false)}`;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    getStopLabel(val, usePercent, usePercentTotal) {
        if (usePercentTotal) {
            return `${Math.round((val / (1 + val)) * 10000) / 100}%`;
        }
        else if (usePercent) {
            return `${Math.round(val * 10000) / 100}%`;
        }
        else {
            return `${val}`;
        }
    }
    getStatistics() {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const layer = smLayer;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const fieldInfo = this.getFieldInfo();
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const normalizationField = colorVisVar
            ? colorVisVar.normalizationField
            : renderer.normalizationField;
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color") || {};
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.IN_PROGRESS;
        if (!this.statistics) {
            modules
                .summaryStatistics({
                layer,
                view: mapView,
                field: fieldInfo.field,
                valueExpression: fieldInfo.expression,
                normalizationField,
                forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
            })
                .then((statistics) => {
                if (statistics.count === 0) {
                    // field has no values
                    // make up some basic statistics so we can show a slider
                    const [defaultMin, defaultMax] = this.getDefaultDataRange(fieldInfo);
                    const min = authColorVisVar.minSliderValue || defaultMin;
                    const max = authColorVisVar.maxSliderValue || defaultMax;
                    statistics.min = min;
                    statistics.max = max;
                    statistics.avg = (max + min) / 2;
                    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(authColorVisVar.minSliderValue)) {
                        authColorVisVar.minSliderValue = min;
                        authColorVisVar.maxSliderValue = max;
                    }
                }
                else if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(statistics.avg) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(statistics.min) ||
                    !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(statistics.max)) {
                    // statistics unusable
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.FAILED;
                    return;
                }
                statistics = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ad)(statistics);
                this.statistics = statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.SUCCESS;
            }, (error) => {
                console.log(error);
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.FAILED;
            });
        }
    }
    getDefaultDataRange(fieldInfo) {
        if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE) {
            const year = new Date().getFullYear();
            return [new Date(`1/1/${year}`).getTime(), new Date(`12/31/${year}`).getTime()];
        }
        else {
            return [0, 100];
        }
    }
    getFieldInfo() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(colorVisVar ? colorVisVar.field : renderer.field);
        const fieldInfo = {
            field: (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.field) || renderer.field,
            expression: (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.valueExpression) || renderer.valueExpression,
            expressionTitle: (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.valueExpressionTitle) || renderer.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER
        };
        return fieldInfo;
    }
    handleCenterAtChange(type) {
        const { statistics, statisticsStatus } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (statisticsStatus !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.b.SUCCESS) {
            return;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(renderer, "color");
        const usePercent = authColorVisVar ? authColorVisVar.style === "percent" : false;
        const usePercentTotal = authColorVisVar ? authColorVisVar.style === "percent-of-total" : false;
        let values;
        if (type === "average") {
            const avg = statistics.avg;
            let minValue = Math.max(avg - statistics.stddev, statistics.min);
            let maxValue = Math.min(avg + statistics.stddev, statistics.max);
            if (statistics.count === 0) {
                minValue = statistics.min;
                maxValue = statistics.max;
            }
            values = round([minValue, maxValue]);
            minValue = values[0];
            maxValue = values[1];
            values = [
                Math.max(minValue, statistics.min),
                Math.max(minValue + (avg - minValue) / 2, statistics.min),
                avg,
                Math.min(avg + (maxValue - avg) / 2, statistics.max),
                Math.min(maxValue, statistics.max)
            ];
            values = round(values);
        }
        else {
            let minValue = Math.max(1 - statistics.stddev, statistics.min);
            let maxValue = Math.min(1 + statistics.stddev, statistics.max);
            values = round([minValue, maxValue]);
            minValue = values[0];
            maxValue = values[1];
            values = [
                Math.max(minValue, statistics.min),
                Math.max(minValue + (1 - minValue) / 2, statistics.min),
                1,
                Math.min(1 + (maxValue - 1) / 2, statistics.max),
                Math.min(maxValue, statistics.max)
            ];
            values = round(values);
        }
        colorVisVar.stops[0].value = values[0];
        colorVisVar.stops[0].label = `< ${this.getStopLabel(values[0], usePercent, usePercentTotal)}`;
        colorVisVar.stops[1].value = values[1];
        colorVisVar.stops[1].label = null;
        colorVisVar.stops[2].value = values[2];
        colorVisVar.stops[2].label = this.getStopLabel(values[2], usePercent, usePercentTotal);
        colorVisVar.stops[3].value = values[3];
        colorVisVar.stops[3].label = null;
        colorVisVar.stops[4].value = values[4];
        colorVisVar.stops[4].label = `> ${this.getStopLabel(values[4], usePercent, usePercentTotal)}`;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
        this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
    }
    handleIncludeInLegendToggle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "color");
        const legendOptions = colorVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                colorVisVar.legendOptions = undefined;
            }
        }
        else {
            colorVisVar.legendOptions = legendOptions || {};
            colorVisVar.legendOptions.showLegend = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsCompare.style = arcgisSmartMappingPanelsCompareCss;

const arcgisSmartMappingPanelsDotDensityCss = ":host{width:100%}.flow-item{height:100%}.dot-density-block{overflow-x:hidden}.hidden{display:none}img{width:16px;height:16px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{width:16px;height:16px;margin:2px}.top-margin{margin-block-start:var(--calcite-label-margin-bottom, 0.75rem)}.top-grey-border{border-top:1px solid #e0e0e0}.text-wrap{overflow-wrap:anywhere}.dot-value-content{display:flex;flex-direction:column}.dot-value-slider{width:100%;height:70px;position:relative;margin:0 auto 10px auto}.dot-value-slider.esri-slider--horizontal .esri-slider__tick-label{cursor:pointer}.dot-value-slider.slider-bottom-label .esri-slider__max,.dot-value-slider.slider-bottom-label .esri-slider__min{width:-moz-fit-content;width:fit-content;position:absolute;bottom:11px}.dot-value-slider.slider-bottom-label .esri-slider__max{right:0;text-align:right}.dot-value-slider.slider-bottom-label .esri-slider__min{left:0;text-align:left}.dot-value-slider.esri-slider--horizontal .esri-slider__label{text-decoration:underline}.dot-value-slider.esri-slider--horizontal .esri-slider__label:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}";

const ArcgisSmartMappingPanelsDotDensity = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsDotDensityBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsDotDensityBackClick", 7);
        this.arcgisSmartMappingPanelsDotDensityClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsDotDensityClose", 7);
        this.labelNodes = [];
        this.inputNodes = [];
        this.legendSwatchNodes = [];
        this.popoverSettings = {
            index: null,
            popoverNode: null
        };
        //-------------------------------------------------------------------
        //
        //  Private methods
        //
        //-------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsDotDensityClose.emit("save");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.dotValue = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.dotValue = renderer.dotValue;
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(renderer.referenceScale)) {
            // get dotValue that fits to current map scale
            this.dotValue = Math.round(renderer.calculateDotValue(mapView.scale));
            this.tickDotValue = this.dotValue;
        }
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
        const { config, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        this.mapViewWatchHandle = modules.reactiveUtils.watch(() => mapView.scale, (newScale) => {
            var _a;
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.layer);
            if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(renderer.referenceScale)) {
                let newDotValue = Math.round(renderer.calculateDotValue(newScale));
                this.dotValue = newDotValue;
                this.handleDotValueChange(this.dotValue);
                (_a = this.dotValueSlider) === null || _a === void 0 ? void 0 : _a.set({
                    values: [this.getSliderStepsPos(this.dotValue)]
                });
            }
        });
        this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin", `<link rel="stylesheet" href="${config.jsapiUrl}/themes/light/main.css" />`);
    }
    disconnectedCallback() {
        var _a, _b;
        (_a = this.dotWatchHandle) === null || _a === void 0 ? void 0 : _a.remove();
        (_b = this.mapViewWatchHandle) === null || _b === void 0 ? void 0 : _b.remove();
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, heading: strings.panels.dotDensity.styleOptions, description: title, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, ref: (node) => (this.flowItemNode = node), onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsDotDensityBackClick.emit() }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization())));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                const { originalRendererJSON, originalFeatureReduction } = this;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
                this.arcgisSmartMappingPanelsDotDensityClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "dot-density-block", heading: strings.panels.dotDensity.dotDensityStyle, open: true }, this.renderDotStyle(), this.renderLegend(), this.renderUnits(), this.renderDotValue(), this.renderDotSize(), this.renderBackgroundStyle(), this.renderOptions()));
    }
    renderDotStyle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colors = renderer.attributes.map((attribute) => attribute.color);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { type: "dot-density-ramp", rampType: "discrete", colors: colors, onArcgisSmartMappingSymbolButtonSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement) }));
    }
    renderLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.dotDensity.legend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: "top-grey-border", dragEnabled: true, onCalciteListOrderChange: (event) => {
                let items = Array.from(event.target.children);
                this.handleSortLegend(items);
            } }, renderer.attributes.map((attribute, index) => {
            return this.renderLegendItem(attribute, index);
        }))));
    }
    renderLegendItem(attribute, index) {
        const { layer, modules, selectedAttribute, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { value: attribute.field, key: `item-${attribute.field}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol", slot: "content-start", tabIndex: 0, role: "button", "aria-label": strings.panels.dotDensity.editSymbolFor.replace("${fieldName}", attribute.label), "aria-haspopup": "true", "aria-expanded": selectedAttribute == index, onClick: () => {
                var _a;
                if ((_a = this.popoverSettings) === null || _a === void 0 ? void 0 : _a.popoverNode) {
                    this.legendSwatchNodes[index].classList.remove("selected");
                    if (this.popoverSettings.index === index) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
                        this.popoverSettings.popoverNode = null;
                        this.popoverSettings.index = null;
                    }
                    else {
                        this.popoverSettings.index = index;
                        this.openSymbolStylerForLegendSwatch(index);
                    }
                }
                else {
                    this.popoverSettings.index = index;
                    this.openSymbolStylerForLegendSwatch(index);
                }
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.openSymbolStylerForLegendSwatch(index);
                }
            }, ref: (node) => (this.legendSwatchNodes[index] = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { src: modules.symbolUtils.renderDotDensityPreviewHTML(renderer, new modules.esriColor([attribute.color.r, attribute.color.g, attribute.color.b]), {
                swatchSize: 16
            }).src, "aria-hidden": "true" })), this.renderTextNode(attribute, index)));
    }
    renderTextNode(attribute, index) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": strings.panels.dotDensity.editLabelFor.replace("${fieldName}", attribute.label), class: "label text-wrap", slot: "content", tabIndex: 0, onClick: (event) => {
                event.target.classList.add("hidden");
                this.inputNodes[index].classList.remove("hidden");
                this.inputNodes[index].setFocus();
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    event.target.classList.add("hidden");
                    this.inputNodes[index].classList.remove("hidden");
                    this.inputNodes[index].setFocus();
                }
            }, ref: (node) => (this.labelNodes[index] = node) }, attribute.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: "hidden", slot: "content", tabIndex: 0, value: attribute.label, placeholder: attribute.label, onFocusout: (event) => {
                const node = event.target;
                this.handleLegendItemTextChange(index, node.value);
            }, onKeyDown: (event) => {
                event.stopPropagation();
                if (event.key === "Escape" || event.key === "Enter") {
                    event.preventDefault();
                    const node = event.currentTarget;
                    this.handleLegendItemTextChange(index, node.value);
                }
            }, ref: (node) => (this.inputNodes[index] = node) })));
    }
    renderUnits() {
        var _a;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.dotDensity.dotsRepresent, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { value: ((_a = renderer.legendOptions) === null || _a === void 0 ? void 0 : _a.unit) || "", onCalciteInputInput: (event) => {
                const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                const node = event.target;
                renderer.legendOptions = renderer.legendOptions || {};
                renderer.legendOptions.unit = node.value || "";
                this.updateDotValueEquation();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            } })));
    }
    renderDotValue() {
        var _a;
        const { layer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authoringInfo = renderer.authoringInfo;
        const { tickDotValue } = this;
        if (!authoringInfo) {
            return null;
        }
        const sliderValuesChanged = this.initSliderSteps();
        const tickConfigs = [
            {
                mode: "position",
                visibleElements: { labels: true },
                labelsVisible: true,
                values: [this.getSliderStepsPos(tickDotValue)],
                tickCreatedFunction: (_, tickElement, labelElement) => {
                    tickElement.onclick = () => {
                        var _a;
                        this.handleDotValueChange(tickDotValue);
                        (_a = this.dotValueSlider) === null || _a === void 0 ? void 0 : _a.set({
                            values: [this.getSliderStepsPos(tickDotValue)]
                        });
                    };
                    labelElement.onclick = () => {
                        var _a;
                        this.handleDotValueChange(tickDotValue);
                        (_a = this.dotValueSlider) === null || _a === void 0 ? void 0 : _a.set({
                            values: [this.getSliderStepsPos(tickDotValue)]
                        });
                    };
                }
            }
        ];
        if (!this.dotValueSlider) {
            const config = {
                min: 0,
                max: this.sliderSteps.length - 1,
                values: [this.getSliderStepsPos(this.dotValue)],
                visibleElements: {
                    labels: true,
                    rangeLabels: true
                },
                rangeLabelInputsEnabled: false,
                precision: 0,
                labelInputsEnabled: true,
                labelFormatFunction: (value) => this.sliderSteps[value],
                inputFormatFunction: (value) => this.sliderSteps[value],
                inputParseFunction: (value) => {
                    var _a, _b, _c;
                    let numValue = parseInt(value);
                    if (isNaN(numValue)) {
                        return this.dotValueSlider.values[0];
                    }
                    if (numValue === 0) {
                        numValue = 1;
                    }
                    if (this.sliderSteps.indexOf(numValue) === -1) {
                        // add tick
                        (_a = this.sliderSteps) === null || _a === void 0 ? void 0 : _a.push(numValue);
                        (_b = this.sliderSteps) === null || _b === void 0 ? void 0 : _b.sort((a, b) => a - b);
                        (_c = this.dotValueSlider) === null || _c === void 0 ? void 0 : _c.set({
                            max: this.sliderSteps.length - 1,
                            values: [this.getSliderStepsPos(numValue)]
                        });
                    }
                    return this.sliderSteps[this.getSliderStepsPos(numValue)];
                },
                tickConfigs
            };
            this.dotValueSlider = new modules.Slider(config);
            //TODO: fix issues with dot slider label change
            this.dotWatchHandle = this.dotValueSlider.watch("values", (values) => {
                this.dotValue = this.sliderSteps[values[0]];
                this.handleDotValueChange(this.dotValue);
            });
            // this.dotValueSlider.watch("labels", (labels: string[]) => {
            //   console.log('label change ==>', labels)
            //   this.dotValue = labels.values[0];
            //   this.handleDotValueChange(this.dotValue);
            //   this.dotValueSlider?.set({
            //     values: [this.getSliderStepsPos(this.dotValue)]
            //   });
            // })
            // this.dotValueSlider.on("thumb-change", (event: __esri.SliderThumbChangeEvent) => {
            //   console.log('thumb change event', event)
            //   this.dotValue = event.value;
            //   this.handleDotValueChange(this.dotValue);
            //   this.dotValueSlider?.set({
            //     values: [this.getSliderStepsPos(this.dotValue)]
            //   });
            // });
        }
        else {
            let config = {
                values: [this.getSliderStepsPos(this.dotValue)]
            };
            if (sliderValuesChanged ||
                this.dotValueSlider.tickConfigs[0].values[0] !== tickConfigs[0].values[0]) {
                config = {
                    min: 0,
                    max: this.sliderSteps.length - 1,
                    values: [this.getSliderStepsPos(this.dotValue)],
                    labelFormatFunction: (value) => {
                        return this.sliderSteps[value];
                    },
                    tickConfigs
                };
            }
            this.dotValueSlider.set(config);
        }
        const showSlider = authoringInfo.minSliderValue !== authoringInfo.maxSliderValue;
        const hasLongLabels = authoringInfo.minSliderValue.toString().length > 5 ||
            authoringInfo.maxSliderValue.toString().length > 5;
        if (!showSlider) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.dotDensity.dotValue, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "dot-value-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `slider dot-value-slider ${hasLongLabels ? "slider-bottom-label" : ""}`, ref: (node) => {
                setTimeout(() => {
                    if (this.dotValueSlider) {
                        this.dotValueSlider.container = node;
                    }
                }, 1);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "center", ref: (node) => (this.dotValueEquationNode = node) }, strings.panels.dotDensity.dotValueEquation
            .replace("${value}", this.dotValue.toString())
            .replace("${units}", ((_a = renderer.legendOptions) === null || _a === void 0 ? void 0 : _a.unit) || "")))));
    }
    renderDotSize() {
        const { layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (mapImageSublayer && layer.version < 11.1) {
            // not supported
            return;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.dotDensity.dotSize), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-slider-input", { min: 0.5, max: 4, values: [renderer.dotSize], precision: 1, suffixText: strings.panels.dotDensity.px, onArcgisSmartMappingSliderInputChange: (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                const newDotSize = event.detail;
                const currentDotSize = renderer.dotSize;
                if (newDotSize === currentDotSize) {
                    return;
                }
                renderer.dotSize = newDotSize;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            } })));
    }
    renderBackgroundStyle() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", { onArcgisSmartMappingBackgroundSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement) }));
    }
    renderOptions() {
        const { mapImageSublayer, mapView, layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "top-margin" }, strings.panels.dotDensity.varyDotByScale, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: renderer.referenceScale === mapView.scale, onCalciteSwitchChange: (event) => {
                const node = event.target;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                renderer.referenceScale = node.checked ? mapView.scale : undefined;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            } })), !mapImageSublayer && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, strings.panels.dotDensity.blendOverlappingColors, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: renderer.dotBlendingEnabled, onCalciteSwitchChange: (event) => {
                const node = event.target;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                renderer.dotBlendingEnabled = node.checked;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            } })))));
    }
    getSliderStepsPos(value) {
        let index = 0;
        this.sliderSteps.forEach((step, idx) => {
            if (value >= step) {
                index = idx;
            }
            else if (value - this.sliderSteps[index] > step - value) {
                // closer to upper value
                index = idx;
            }
        });
        return index;
    }
    handleLegendItemTextChange(index, label) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        if (!label.length) {
            let matchingInfo = this.originalRendererJSON.attributes.find((info) => info.field === renderer.attributes[index].field);
            label = matchingInfo.label;
        }
        renderer.attributes[index].label = label;
        this.inputNodes[index].classList.add("hidden");
        this.labelNodes[index].classList.remove("hidden");
        this.labelNodes[index].innerHTML = label;
        setTimeout(() => this.labelNodes[index].focus(), 300);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
    }
    handleDotValueChange(dotValue) {
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        let renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        renderer.dotValue = Math.round(dotValue);
        renderer.referenceScale = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ac)(renderer.referenceScale)
            ? mapView.scale
            : undefined;
        this.updateDotValueEquation();
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
    }
    handleSortLegend(items) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const attributes = renderer.attributes.map((attribute) => {
            return attribute.clone();
        });
        const itemValues = items.map((item) => item.value);
        attributes.sort((a, b) => itemValues.indexOf(a.field) - itemValues.indexOf(b.field));
        renderer.attributes = attributes;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    initSliderSteps() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const authoringInfo = renderer.authoringInfo;
        const min = authoringInfo.minSliderValue;
        const max = Math.max(authoringInfo.maxSliderValue, this.dotValue);
        if (this.sliderSteps && this.sliderSteps.indexOf(this.dotValue) > -1) {
            // current dot value is one of the steps
            return false;
        }
        const sliderIntervalCount = 80;
        const divider = 4;
        const range = max - min;
        let rangeSteps = range / Math.pow(2, sliderIntervalCount / divider - 1);
        rangeSteps = Math.max(rangeSteps, 1);
        const steps = [min];
        for (let i = 0; i < sliderIntervalCount - 1; i++) {
            let value = Math.round(min + Math.pow(2, i / divider) * rangeSteps);
            if (value < min + (i + 1)) {
                // make sure we move at least by 1
                value = min + (i + 1);
            }
            if (this.dotValue < value && this.dotValue > steps[steps.length - 1]) {
                // make sure current value is a stop
                steps.push(this.dotValue);
            }
            if (value >= max) {
                steps.push(max);
                break;
            }
            else {
                steps.push(value);
            }
        }
        this.sliderSteps = steps;
        return true;
    }
    openSymbolStylerForLegendSwatch(index) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
        const legendSwatchNode = this.legendSwatchNodes[index];
        const symbolStylerDiv = document.createElement("div");
        symbolStylerDiv.className = "symbol-styler-div";
        this.popoverSettings.popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.c)({
            referenceElement: this.flowItemNode,
            heading: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.strings.styler.symbolStyle
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(this.popoverSettings.popoverNode);
            setTimeout(() => legendSwatchNode === null || legendSwatchNode === void 0 ? void 0 : legendSwatchNode.focus(), 300);
            legendSwatchNode.classList.remove("selected");
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(this.popoverSettings.popoverNode);
            legendSwatchNode.classList.remove("selected");
            this.popoverSettings.popoverNode = null;
        });
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.b)({
            selectedAttribute: index,
            popoverNode: this.popoverSettings.popoverNode,
            onChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }
        });
        legendSwatchNode.classList.add("selected");
    }
    updateDotValueEquation() {
        var _a;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.dotValueEquationNode.innerHTML = strings.panels.dotDensity.dotValueEquation
            .replace("${value}", this.dotValue.toString())
            .replace("${units}", this.htmlEncode(((_a = renderer.legendOptions) === null || _a === void 0 ? void 0 : _a.unit) || ""));
    }
    htmlEncode(input) {
        const textArea = document.createElement("textarea");
        textArea.innerText = input;
        return textArea.innerHTML.split("<br>").join("\n");
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsDotDensity.style = arcgisSmartMappingPanelsDotDensityCss;

const arcgisSmartMappingPanelsHeatmapCss = ":host{width:100%}.flow-item{height:100%}.heatmap-block{overflow-x:hidden}.attribute-name{word-break:break-all}.slider-labels{display:flex;justify-content:space-between}.top-bottom-margin-small{margin:10px 0}.top-margin-medium{margin-top:18px}";

const ArcgisSmartMappingPanelsHeatmap = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsHeatmapClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsHeatmapClose", 7);
        this.arcgisSmartMappingPanelsHeatmapBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsHeatmapBackClick", 7);
        this.arcgisSmartMappingPanelsHeatmapError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsHeatmapError", 7);
        //-------------------------------------------------------------------
        //
        //  Private methods
        //
        //-------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
            this.arcgisSmartMappingPanelsHeatmapClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsHeatmapClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    disconnectedCallback() {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ae)();
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, heading: strings.panels.heatmap.styleOptions, description: title, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsHeatmapBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderVisualization() {
        var _a;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const fieldName = renderer.field ? (_a = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(renderer.field)) === null || _a === void 0 ? void 0 : _a.label : undefined;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "heatmap-block", heading: strings.panels.heatmap.heatmapStyle, open: true }, fieldName ? (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "attribute-name" }, fieldName) : null, this.renderSymbol(), this.renderHeatmapSlider(), this.renderSoftEdges(), this.renderInfluenceValue(), this.renderLock(), this.renderRegenerate()));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const colors = renderer.colorStops.map((colorStop) => {
            const color = colorStop.color.clone();
            color.a = 1;
            return color;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { type: "heatmap-ramp", rampType: "continuous", colors: colors, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            } }));
    }
    renderHeatmapSlider() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-heatmap-slider", { ref: (node) => {
                if (node) {
                    this.sliderNode = node;
                }
            } }));
    }
    renderSoftEdges() {
        var _a;
        // TODO: replace custom calcite-labels after custom label properties area added on calcite-slider
        const { strings, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const originalRenderer = modules.rendererJsonUtils.fromJSON(this.originalRendererJSON);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, " ", strings.panels.heatmap.softenEdges, " "), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { min: 0, max: 1, minLabel: strings.panels.heatmap.less, maxLabel: strings.panels.heatmap.more, step: 0.01, value: ((_a = originalRenderer.authoringInfo) === null || _a === void 0 ? void 0 : _a.fadeRatio) || 0, onCalciteSliderInput: (event) => {
                var _a;
                const node = event.target;
                const newFadeRatio = node.value;
                const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                if (((_a = renderer.authoringInfo) === null || _a === void 0 ? void 0 : _a.fadeRatio) === newFadeRatio) {
                    return;
                }
                const newRenderer = (0,_heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_8__.u)(newFadeRatio);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.e)(newRenderer, layer);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
                // update colors on slider
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-labels", "aria-hidden": "true" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.heatmap.less), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.heatmap.more))));
    }
    renderInfluenceValue() {
        // TODO: replace custom calcite-labels after custom label properties area added on calcite-slider
        const { strings, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const originalRenderer = modules.rendererJsonUtils.fromJSON(this.originalRendererJSON);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-bottom-margin-small" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.heatmap.areaOfInfluence), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { min: 1, max: 60, minLabel: strings.panels.heatmap.smaller, maxLabel: strings.panels.heatmap.larger, value: originalRenderer.radius || 0, onCalciteSliderInput: (event) => {
                const node = event.target;
                const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                renderer.radius = node.value || 10;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-labels", "aria-hidden": "true" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.heatmap.smaller), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.heatmap.larger))));
    }
    renderLock() {
        const { layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (mapImageSublayer) {
            // hide it until MS supports new webmap spec
            return;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const { referenceScale } = renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-margin-medium" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, strings.panels.heatmap.lock, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: !!referenceScale, onCalciteSwitchChange: () => {
                const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
                renderer.referenceScale = renderer.referenceScale ? 0 : mapView.scale;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
            }, ref: (node) => {
                this.calciteSwitchNode = node;
            }, onMouseOver: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.af)(this.calciteSwitchNode, strings.panels.heatmap.lockHelp), onMouseOut: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ae)(), onFocus: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.af)(this.calciteSwitchNode, strings.panels.heatmap.lockHelp), onFocusout: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ae)() }))));
    }
    renderRegenerate() {
        const { mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (mapImageSublayer) {
            // hide it until MS supports new webmap spec
            return;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-bottom-margin-small" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", width: "full", onClick: () => {
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_5__.r)((0,_heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_8__.a)(), this.flowItemNode).then(() => {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ab)();
                }, (error) => this.arcgisSmartMappingPanelsHeatmapError.emit(error));
            }, label: strings.panels.heatmap.regenerate }, strings.panels.heatmap.regenerate)));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsHeatmap.style = arcgisSmartMappingPanelsHeatmapCss;

const arcgisSmartMappingPanelsPredominanceSizeCss = ":host{width:100%}.flow-item{height:100%}";

const ArcgisSmartMappingPanelsPredominanceSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsPredominanceSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceSizeBackClick", 7);
        this.arcgisSmartMappingPanelsPredominanceSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceSizeClose", 7);
        this.arcgisSmartMappingPanelsPredominanceSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceSizeError", 7);
        this.tileNodes = [];
        //-------------------------------------------------------------------
        //
        //  Private Methods
        //
        //-------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("save");
        };
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            switch (type) {
                case "size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsPredominanceSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "predominance": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-predominance");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceError", ({ detail }) => this.arcgisSmartMappingPanelsPredominanceSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.lastClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle Methods
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { layer, hideLayerTitle, isRTL, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, heading: strings.panels.styleOptions, description: title, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, ref: (node) => (this.flowItemNode = node), onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsPredominanceSizeBackClick.emit() }, this.renderPredominanceTile(), this.renderSizeTile(), this.renderTransparency(), this.renderRotation(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderPredominanceTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "predominance", selected: false, onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "predominance";
                this.handleOptionsClick("predominance");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("predominance"), ref: (node) => {
                if (node) {
                    this.tileNodes["predominance"] = node;
                }
            } }));
    }
    renderSizeTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "size", selected: this.lastClick === "size", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "size";
                this.handleOptionsClick("size");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("size"), ref: (node) => {
                if (node) {
                    this.tileNodes["size"] = node;
                }
            } }));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsPredominanceSizeError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsPredominanceSizeError.emit(detail) }));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(this.originalRendererJSON, this.originalFeatureReduction);
                this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => this.tileNodes[this.lastClick].setFocus()), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsPredominanceSize.style = arcgisSmartMappingPanelsPredominanceSizeCss;

const arcgisSmartMappingPanelsRelationshipSizeCss = ":host{width:100%}.flow-item{height:100%}";

const ArcgisSmartMappingPanelsRelationshipSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRelationshipSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRelationshipSizeClose", 7);
        this.arcgisSmartMappingPanelsRelationshipSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRelationshipSizeBackClick", 7);
        this.arcgisSmartMappingPanelsRelationshipSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRelationshipSizeError", 7);
        this.tileNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            switch (type) {
                case "size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsRelationshipSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "relationship": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-relationship");
                    flowItem.hideTransparency = true;
                    flowItem.hideRotation = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipError", ({ detail }) => this.arcgisSmartMappingPanelsRelationshipSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.lastClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle Methods
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a;
        const { layer, mapImageSublayer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: title, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: () => this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"), onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsRelationshipSizeBackClick.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderRelationshipTile(), this.renderSizeTile(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: () => this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"), appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(this.originalRendererJSON, this.originalFeatureReduction);
                this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderRelationshipTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "relationship", selected: this.lastClick === "relationship", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "relationship";
                this.handleOptionsClick("relationship");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("relationship"), ref: (node) => {
                if (node) {
                    this.tileNodes["relationship"] = node;
                }
            } }));
    }
    renderSizeTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "size", selected: this.lastClick === "size", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "size";
                this.handleOptionsClick("size");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("size"), ref: (node) => {
                if (node) {
                    this.tileNodes["size"] = node;
                }
            } }));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsRelationshipSizeError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsRelationshipSizeError.emit(detail) }));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => this.tileNodes[this.lastClick].setFocus()), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRelationshipSize.style = arcgisSmartMappingPanelsRelationshipSizeCss;

const arcgisSmartMappingPanelsSimpleCss = ":host{width:100%}.flow-item{height:100%}.simple-block{overflow-x:hidden}";

const ArcgisSmartMappingPanelsSimple = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsSimpleClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSimpleClose", 7);
        this.arcgisSmartMappingPanelsSimpleBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSimpleBackClick", 7);
        this.arcgisSmartMappingPanelsSimpleError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsSimpleError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsSimpleClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRenderer, originalFeatureReduction } = this;
            const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            if (layer.type === "geo-rss") {
                layer.pointSymbol = originalRenderer[0];
                layer.lineSymbol = originalRenderer[1];
                layer.polygonSymbol = originalRenderer[2];
            }
            else {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRenderer, originalFeatureReduction);
            }
            this.arcgisSmartMappingPanelsSimpleClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a, _b;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (layer.type === "geo-rss" || layer.type === "wfs") {
            (_b = document.getElementById("simple-panel-dismiss-button")) === null || _b === void 0 ? void 0 : _b.setFocus();
        }
        else {
            document.getElementById("simple-panel").setFocus();
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.visualizationOpen = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (layer.type === "geo-rss") {
            const geoRSSLayer = layer;
            this.originalRenderer = [
                geoRSSLayer.pointSymbol.clone(),
                geoRSSLayer.lineSymbol.clone(),
                geoRSSLayer.polygonSymbol.clone()
            ];
        }
        else {
            // save original renderer
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
            this.originalRenderer = renderer.toJSON();
            this.originalFeatureReduction =
                "featureReduction" in layer && layer.featureReduction
                    ? modules.esriLang.clone(layer.featureReduction)
                    : undefined;
            await (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.d)();
        }
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.gallery.styles, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsSimpleBackClick.emit();
            }, ref: (node) => {
                this.flowItemNode = node;
            } }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        const { visualizationOpen } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "simple-block", heading: strings.panels.simple.simpleStyle, collapsible: layer.type === "geo-rss" ? false : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.ag)(), open: visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, layer.type === "geo-rss" ? this.renderGeoRssSymbols() : this.renderSymbol()));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const symbol = layer.renderer
            .symbol;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, type: "simple", onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderGeoRssSymbols() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderGeoRssSymbol("point"), this.renderGeoRssSymbol("line"), this.renderGeoRssSymbol("polygon")));
    }
    renderGeoRssSymbol(type) {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const geoRSSLayer = layer;
        let symbol = type === "point"
            ? geoRSSLayer.pointSymbol
            : type === "line"
                ? geoRSSLayer.lineSymbol
                : geoRSSLayer.polygonSymbol;
        const label = type === "point"
            ? strings.panels.simple.pointSymbolStyle
            : type === "line"
                ? strings.panels.simple.lineSymbolStyle
                : strings.panels.simple.polygonSymbolStyle;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, type: type === "point" ? "geo-rss-point" : type === "line" ? "geo-rss-line" : "geo-rss-polygon", label: label, onArcgisSmartMappingSymbolButtonSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement) }));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsSimpleError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, ref: (node) => (this.rotationNode = node), onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsSimpleError.emit(detail) }));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsSimple.style = arcgisSmartMappingPanelsSimpleCss;

const arcgisSmartMappingPanelsTypeSizeCss = ":host{width:100%}.flow-item{height:100%}";

const ArcgisSmartMappingPanelsTypeSize = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsTypeSizeBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsTypeSizeBackClick", 7);
        this.arcgisSmartMappingPanelsTypeSizeClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsTypeSizeClose", 7);
        this.arcgisSmartMappingPanelsTypeSizeError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsTypeSizeError", 7);
        this.tileNodes = [];
        //-------------------------------------------------------------------
        //
        //  Private Methods
        //
        //-------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
            this.arcgisSmartMappingPanelsTypeSizeClose.emit("save");
        };
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            switch (type) {
                case "size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.hideRotation = true;
                    flowItem.hideTransparency = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsTypeSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "type": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-type");
                    flowItem.hideRotation = true;
                    flowItem.hideTransparency = true;
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeError", ({ detail }) => this.arcgisSmartMappingPanelsTypeSizeError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.lastClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.aa)(this.hostElement), heading: strings.panels.styleOptions, description: title, menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, ref: (node) => (this.flowItemNode = node), onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsTypeSizeBackClick.emit(), onCalciteFlowItemClose: this.handleDone }, this.renderTypeTile(), this.renderSizeTile(), this.renderTransparency(), this.renderRotation(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderTypeTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "type", selected: this.lastClick === "type", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "type";
                this.handleOptionsClick("type");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("type"), ref: (node) => {
                if (node) {
                    this.tileNodes["type"] = node;
                }
            } }));
    }
    renderSizeTile() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { type: "size", selected: this.lastClick === "size", onArcgisSmartMappingTileSelect: () => {
                this.lastClick = "size";
                this.handleOptionsClick("size");
            }, onArcgisSmartMappingTileOptions: () => this.handleOptionsClick("size"), ref: (node) => {
                if (node) {
                    this.tileNodes["size"] = node;
                }
            } }));
    }
    renderTransparency() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsTypeSizeError.emit(detail) }));
    }
    renderRotation() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsTypeSizeError.emit(detail) }));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(this.originalRendererJSON, this.originalFeatureReduction);
                this.arcgisSmartMappingPanelsTypeSizeClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => this.tileNodes[this.lastClick].setFocus()), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsTypeSize.style = arcgisSmartMappingPanelsTypeSizeCss;



//# sourceMappingURL=arcgis-smart-mapping-field-pick-list_11.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ updateWithHeatmapStatistics),
/* harmony export */   c: () => (/* binding */ createHeatmapRenderer),
/* harmony export */   u: () => (/* binding */ updateHeatmapRendererwithFade)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * Updates the layer with a Heatmap renderer with default settings
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function createHeatmapRenderer(options) {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    options = options || {};
    if (rendererType === "heatmap") {
        options.radius = options.radius || renderer.radius;
        options.heatmapScheme = options.heatmapScheme || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.V)();
    }
    if ((_a = options.fieldInfos) === null || _a === void 0 ? void 0 : _a.length) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.O)([options.fieldInfos[0].field]);
    }
    return modules.HeatmapCreator.createRenderer({
        layer,
        view: mapView,
        field: options.fieldInfos && options.fieldInfos.length ? options.fieldInfos[0].field : null,
        radius: options.radius || 10,
        heatmapScheme: options.heatmapScheme || undefined
    });
}
/**
 * Updates the Heatmap renderer with a new fadeRatio
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param fadeRatio: new value
 */
function updateHeatmapRendererwithFade(fadeRatio) {
    const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    return modules.HeatmapCreator.updateRenderer({
        renderer,
        fadeRatio
    });
}
/**
 * Updates the layer with a new radius
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function updateWithHeatmapStatistics(options) {
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    options = options || {};
    // workaround for: This expression is not callable. Type 'heatmapStatistics' has no call signatures.ts(2349)
    //const _heatmapStatistics: any = modules.heatmapStatistics;
    return modules
        .heatmapStatistics({
        layer,
        view: mapView,
        field: renderer.field,
        radius: options.radius || renderer.radius || 10
    })
        .then((statistics) => {
        renderer.minDensity = statistics.min;
        renderer.maxDensity = statistics.max;
        return Promise.resolve(statistics);
    }, (error) => Promise.reject(error));
}



//# sourceMappingURL=heatmap-75ffd452.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTZjMzJkOC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzhJO0FBQ2pGO0FBQ3dsQjtBQUNsbkI7QUFDMkI7QUFDRjtBQUNtRjtBQUNPO0FBQ3pDO0FBQy9FO0FBQ0g7QUFDRTtBQUNVO0FBQ1Y7QUFDRzs7QUFFaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHdCQUF3QjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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bUMsRUFBRSwrREFBaUI7QUFDbEU7QUFDQSxxQkFBcUIsbUVBQVc7QUFDaEMseUJBQXlCLG1FQUFlO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxtRUFBaUI7QUFDMUU7QUFDQTtBQUNBLFFBQVEsbUVBQW9CO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpQkFBaUIsRUFBRSwrREFBaUI7QUFDaEQscUJBQXFCLG1FQUFXO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksbUNBQW1DLEVBQUUsK0RBQWlCO0FBQ2xFO0FBQ0EscUJBQXFCLG1FQUFXO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFNEc7O0FBRTVHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZmllbGQtcGljay1saXN0XzExLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2hlYXRtYXAtNzVmZmQ0NTIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBMIGFzIExhc3RTb3J0eUJ5IH0gZnJvbSAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlLCBDIGFzIGdldEZpZWxkVHlwZUNvdW50LCB1IGFzIGdldEZpZWxkLCBGIGFzIGZpbmRQYXJlbnROb2RlLCBhYSBhcyBpc1RvcEZsb3dJdGVtLCBoIGFzIGdldFJlbmRlcmVyLCBqIGFzIGFwcGx5UmVuZGVyZXJUb0FsbCwgZyBhcyBnZXRSZW5kZXJlclR5cGUsIEogYXMgZ2V0UmVuZGVyZXJUaGVtZSwgYSBhcyBnZXRWaXNWYXIsIGYgYXMgZ2V0UmVuZGVyZXJGaWVsZEluZm9zLCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIEkgYXMgZ2V0TGF5ZXJGaWVsZFR5cGVDb3VudCwgQiBhcyBpc1BvbHlsaW5lVHlwZSwgdCBhcyBnZXRTeW1ib2xDb2xvciwgcSBhcyBpc1BvbHlnb25UeXBlLCBlIGFzIGFwcGx5UmVuZGVyZXIsIGFiIGFzIHVwZGF0ZVJlbmRlcmVyLCBFIGFzIGNsb3NlUG9wb3ZlcnMsIGIgYXMgc3RhdHVzLCBwIGFzIGdldEF1dGhWaXNWYXIsIGFjIGFzIGlzRGVmaW5lZCwgYWQgYXMgdmFsaWRhdGVNaW5NYXgsIEEgYXMgaXNQb2ludFR5cGUsIGFlIGFzIHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAsIGFmIGFzIGFkZFNtYXJ0TWFwcGluZ1Rvb2x0aXAsIGQgYXMgYnVpbGRGaWVsZHNMaXN0LCBhZyBhcyBoYXNOdW1iZXJGaWVsZCB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgQyBhcyBDU1NfVVRJTElUWSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdFdyYXBwZXIgfSBmcm9tICcuL2xvYWRpbmctNjkxMzk5MDcuanMnO1xuaW1wb3J0IHsgYSBhcyBjcmVhdGVDb2xvclNpemVVbml2YXJpYXRlUmVuZGVyZXJGcm9tRXhpc3RpbmcsIGMgYXMgY3JlYXRlQ29sb3JTaXplVW5pdmFyaWF0ZVJlbmRlcmVyIH0gZnJvbSAnLi9jb2xvclNpemVVbml2YXJpYW50LWQyNjZhYzdjLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3ltYm9sU3R5bGVyUG9wb3ZlciwgciBhcyByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyLCBiIGFzIGJ1aWxkU3ltYm9sU3R5bGVyRm9yRG90RGVuc2l0eVZhbHVlIH0gZnJvbSAnLi9zeW1ib2xTdHlsZXItMDQ2MzViMmIuanMnO1xuaW1wb3J0IHsgdSBhcyB1cGRhdGVIZWF0bWFwUmVuZGVyZXJ3aXRoRmFkZSwgYSBhcyB1cGRhdGVXaXRoSGVhdG1hcFN0YXRpc3RpY3MgfSBmcm9tICcuL2hlYXRtYXAtNzVmZmQ0NTIuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCAnLi9jb2xvci1kNmRhMGE5YS5qcyc7XG5pbXBvcnQgJy4vbG9jYXRpb24tZTI2YjUzOWYuanMnO1xuXG5mdW5jdGlvbiByb3VuZChudW1iZXJzLCBvcHRpb25zKSB7XG4gICAgbGV0IG51bWJlcnNDb3B5ID0gbnVtYmVycy5zbGljZSgwKSwgbnVtYmVyLCBwcmV2LCBuZXh0LCBkaWdpdHMsIGZyYWN0aW9uRGlnaXRzLCBmaXhlZE51bWJlciA9IDAsIGZpeGVkTnVtYmVycywgaSwgaiwgZm91bmQsIGluZGV4LCBwY3RUb2xlcmFuY2UgPSAhb3B0aW9ucyB8fCBvcHRpb25zLnRvbGVyYW5jZSA9PSBudWxsID8gMiA6IG9wdGlvbnMudG9sZXJhbmNlLCBpbmRleGVzID0gb3B0aW9ucyAmJiBvcHRpb25zLmluZGV4ZXMsIHN0cmljdEJvdW5kcyA9ICFvcHRpb25zIHx8IG9wdGlvbnMuc3RyaWN0Qm91bmRzID09IG51bGwgPyBmYWxzZSA6IG9wdGlvbnMuc3RyaWN0Qm91bmRzO1xuICAgIGNvbnN0IG51bWVyaWNBc2NlbmRpbmcgPSAoYSwgYikgPT4ge1xuICAgICAgICByZXR1cm4gYSAtIGI7XG4gICAgfTtcbiAgICAvL2NvbnNvbGUubG9nKFwiTnVtYmVyczogXCIsIG51bWJlcnMpO1xuICAgIC8vY29uc29sZS5sb2coXCJQZXJjZW50IHRvbGVyYW5jZTogXCIsIHBjdFRvbGVyYW5jZSk7XG4gICAgLy8gRmluZCBzdG9wcyB0aGF0IG5lZWQgdG8gYmUgcm91bmRlZC5cbiAgICBpZiAoaW5kZXhlcykge1xuICAgICAgICBpbmRleGVzLnNvcnQobnVtZXJpY0FzY2VuZGluZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBHZXQgaW5kZXhlcyBvZiBhbGwgbnVtYmVycy5cbiAgICAgICAgLy8gQWxsIHN0b3AgdmFsdWVzIHdpbGwgYmUgcm91bmRlZC5cbiAgICAgICAgaW5kZXhlcyA9IFtdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtYmVyc0NvcHkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGluZGV4ZXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKFwiaW5kZXhlczogXCIsIGluZGV4ZXMpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGluZGV4ID0gaW5kZXhlc1tpXTtcbiAgICAgICAgbnVtYmVyID0gbnVtYmVyc0NvcHlbaW5kZXhdO1xuICAgICAgICBwcmV2ID0gaW5kZXggPT09IDAgPyB1bmRlZmluZWQgOiBudW1iZXJzQ29weVtpbmRleCAtIDFdO1xuICAgICAgICBuZXh0ID0gaW5kZXggPT09IG51bWJlcnNDb3B5Lmxlbmd0aCAtIDEgPyB1bmRlZmluZWQgOiBudW1iZXJzQ29weVtpbmRleCArIDFdO1xuICAgICAgICBkaWdpdHMgPSBnZXREaWdpdHMobnVtYmVyKTtcbiAgICAgICAgZnJhY3Rpb25EaWdpdHMgPSBkaWdpdHMuZnJhY3Rpb25hbDtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhudW1iZXIsIGRpZ2l0cywgcHJldiwgbmV4dCk7XG4gICAgICAgIC8vIExldCdzIHJlZHVjZSB0aGUgcHJlY2lzaW9uIG9mIGZyYWN0aW9uYWwgbnVtYmVycy5cbiAgICAgICAgaWYgKGZyYWN0aW9uRGlnaXRzKSB7XG4gICAgICAgICAgICBqID0gMDtcbiAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBLZWVwIGl0ZXJhdGluZyB1bnRpbCB3ZSBmaW5kIGFuIG9wdGltYWwgcHJlY2lzaW9uLlxuICAgICAgICAgICAgd2hpbGUgKGogPD0gZnJhY3Rpb25EaWdpdHMgJiYgIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgZml4ZWROdW1iZXJzID0gZ2V0Rml4ZWROdW1iZXJzKG51bWJlciwgaik7XG4gICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBhZGp1c3RlZC9maXhlZCBudW1iZXIgb25seSBpZiBpdCBpbnRyb2R1Y2VzIG1pbmltYWwgY2hhbmdlXG4gICAgICAgICAgICAgICAgLy8gaW4gdGhlIHNlcXVlbmNlLlxuICAgICAgICAgICAgICAgIGZpeGVkTnVtYmVyID0gc3RyaWN0Qm91bmRzICYmIGkgPT09IDAgPyBmaXhlZE51bWJlcnNbMV0gOiBmaXhlZE51bWJlcnNbMF07XG4gICAgICAgICAgICAgICAgZm91bmQgPSBoYXNNaW5pbWFsQ2hhbmdlKG51bWJlciwgZml4ZWROdW1iZXIsIHByZXYsIG5leHQsIHBjdFRvbGVyYW5jZSk7XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzZXF1ZW5jZSB3aXRoIHRoZSBmaXhlZCBudW1iZXIgc28gdGhhdCB0aGUgbmV4dCBudW1iZXJcbiAgICAgICAgICAgICAgICAvLyBpbiBzZXF1ZW5jZSBjYW4gYmUgYWRqdXN0ZWQgYmFzZWQgb24gaXQuXG4gICAgICAgICAgICAgICAgbnVtYmVyc0NvcHlbaW5kZXhdID0gZml4ZWROdW1iZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9jb25zb2xlLmxvZyhcIkZpeGVkOiBcIiwgbnVtYmVyc0NvcHkpO1xuICAgIHJldHVybiBudW1iZXJzQ29weTtcbn1cbmZ1bmN0aW9uIGdldERpZ2l0cyhudW1iZXIpIHtcbiAgICAvLyBSZXR1cm5zIG51bWJlciBvZiBkaWdpdHMgaW4gdGhlIGludGVnZXIgYW5kIGZyYWN0aW9uYWwgcGFydHMgb2YgdGhlXG4gICAgLy8gZ2l2ZW4gbnVtZXJpYyB2YWx1ZS5cbiAgICBjb25zdCBfcmVOdW1iZXIgPSAvXi0/KFxcZCspKFxcLihcXGQrKSk/JC9pO1xuICAgIGxldCBudW1TdHJpbmcgPSBTdHJpbmcobnVtYmVyKSwgbWF0Y2ggPSBudW1TdHJpbmcubWF0Y2goX3JlTnVtYmVyKSwgcmV0VmFsID0ge1xuICAgICAgICBpbnRlZ2VyOiAwLFxuICAgICAgICBmcmFjdGlvbmFsOiAwXG4gICAgfTtcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgICAgcmV0VmFsLmludGVnZXIgPSBtYXRjaFsxXS5zcGxpdChcIlwiKS5sZW5ndGg7XG4gICAgICAgIC8vIEludGVnZXIgZGlnaXRzIGNhbiBhbHNvIGJlIGNhbGN1bGF0ZWQgdXNpbmcgdGhpcyBsb2dpYzpcbiAgICAgICAgLy8gdmFyIGFkanVzdCA9IChudW0gPiAwKSA/IE1hdGguZmxvb3IobnVtKSA6IE1hdGguY2VpbChudW0pO1xuICAgICAgICAvLyBhZGp1c3QgPSBNYXRoLmFicyhhZGp1c3QpO1xuICAgICAgICAvLyByZXR1cm4gTWF0aC5mbG9vciggTWF0aC5sb2coYWRqdXN0KSAvIE1hdGguTE4xMCApO1xuICAgICAgICByZXRWYWwuZnJhY3Rpb25hbCA9IG1hdGNoWzNdID8gbWF0Y2hbM10uc3BsaXQoXCJcIikubGVuZ3RoIDogMDtcbiAgICAgICAgLy8gRnJhY3Rpb25hbCBkaWdpdHMgY2FuIGFsc28gYmUgY2FsY3VsYXRlZCB1c2luZyB0aGlzIGxvZ2ljOlxuICAgICAgICAvLyAgdmFyIGUgPSAxO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgd2hpbGUgKE1hdGgucm91bmQobnVtYmVyICogZSkgLyBlICE9PSBudW1iZXIpIHtcbiAgICAgICAgLy8gICAgZSAqPSAxMDtcbiAgICAgICAgLy8gIH1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIC8vIE1heCBwcmVjaXNpb24gcmV0dXJuZWQgc2VlbXMgdG8gYmUgMTVcbiAgICAgICAgLy8gIHJldHVybiBNYXRoLnJvdW5kKCBNYXRoLmxvZyhlKSAvIE1hdGguTE4xMCApO1xuICAgIH1cbiAgICBlbHNlIGlmIChudW1TdHJpbmcudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiZVwiKSA+IC0xKSB7XG4gICAgICAgIC8vIE51bWJlciBpbiBleHBvbmVudGlhbCBub3RhdGlvbi5cbiAgICAgICAgLy8gRXg6IDEuNDg2ODQyMDEyNzYxNjU5OGUtNywgMTM0ZTI1LCAxMzRlLTI1IGV0Y1xuICAgICAgICBsZXQgcGFydHMgPSBudW1TdHJpbmcuc3BsaXQoXCJlXCIpLCBudW1lcmljUGFydF8gPSBwYXJ0c1swXSwgcG93ZXJPZlRlbl8gPSBwYXJ0c1sxXSwgZGlnaXRzLCBpc1Bvc1Bvd2VyO1xuICAgICAgICBpZiAobnVtZXJpY1BhcnRfICYmIHBvd2VyT2ZUZW5fKSB7XG4gICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZ3MgdG8gbnVtYmVycy5cbiAgICAgICAgICAgIGNvbnN0IG51bWVyaWNQYXJ0ID0gTnVtYmVyKG51bWVyaWNQYXJ0Xyk7XG4gICAgICAgICAgICBsZXQgcG93ZXJPZlRlbiA9IE51bWJlcihwb3dlck9mVGVuXyk7XG4gICAgICAgICAgICAvLyBJcyB0aGUgcG93ZXIgcG9zaXRpdmU/XG4gICAgICAgICAgICBpc1Bvc1Bvd2VyID0gcG93ZXJPZlRlbiA+IDA7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGFic29sdXRlIHZhbHVlIG9mIHBvd2VyLlxuICAgICAgICAgICAgaWYgKCFpc1Bvc1Bvd2VyKSB7XG4gICAgICAgICAgICAgICAgcG93ZXJPZlRlbiA9IE1hdGguYWJzKHBvd2VyT2ZUZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlnaXRzID0gZ2V0RGlnaXRzKG51bWVyaWNQYXJ0KTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBcImRpZ2l0c1wiIHVzaW5nIHBvd2VyT2ZUZW4gdmFsdWUuXG4gICAgICAgICAgICBpZiAoaXNQb3NQb3dlcikge1xuICAgICAgICAgICAgICAgIGRpZ2l0cy5pbnRlZ2VyICs9IHBvd2VyT2ZUZW47XG4gICAgICAgICAgICAgICAgaWYgKHBvd2VyT2ZUZW4gPiBkaWdpdHMuZnJhY3Rpb25hbCkge1xuICAgICAgICAgICAgICAgICAgICBkaWdpdHMuZnJhY3Rpb25hbCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWdpdHMuZnJhY3Rpb25hbCAtPSBwb3dlck9mVGVuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRpZ2l0cy5mcmFjdGlvbmFsICs9IHBvd2VyT2ZUZW47XG4gICAgICAgICAgICAgICAgaWYgKHBvd2VyT2ZUZW4gPiBkaWdpdHMuaW50ZWdlcikge1xuICAgICAgICAgICAgICAgICAgICBkaWdpdHMuaW50ZWdlciA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWdpdHMuaW50ZWdlciAtPSBwb3dlck9mVGVuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldFZhbCA9IGRpZ2l0cztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmV0VmFsO1xufVxuZnVuY3Rpb24gZ2V0Rml4ZWROdW1iZXJzKG51bWJlciwgZnJhY3Rpb25EaWdpdHMpIHtcbiAgICBsZXQgbnVtMSwgbnVtMjtcbiAgICBudW0xID0gTnVtYmVyKG51bWJlci50b0ZpeGVkKGZyYWN0aW9uRGlnaXRzKSk7XG4gICAgaWYgKG51bTEgPCBudW1iZXIpIHtcbiAgICAgICAgLy8gbnVtMiB3aWxsIGJlIGxhcmdlciB0aGFuIG51bTEvbnVtYmVyXG4gICAgICAgIG51bTIgPSBudW0xICsgMSAvIE1hdGgucG93KDEwLCBmcmFjdGlvbkRpZ2l0cyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBudW0yIHdpbGwgYmUgc21hbGxlciB0aGFuIG51bTEvbnVtYmVyXG4gICAgICAgIG51bTIgPSBudW0xO1xuICAgICAgICBudW0xID0gbnVtMSAtIDEgLyBNYXRoLnBvdygxMCwgZnJhY3Rpb25EaWdpdHMpO1xuICAgIH1cbiAgICAvLyBGaXggc3B1cmlvdXMgZmxvYXRpbmcgcG9pbnQgbnVtYmVyIHByZWNpc2lvbi5cbiAgICAvLyBFeGFtcGxlczpcbiAgICAvLyAgMC4zIC0gMC4xID0gMC4xOTk5OTk5OTk5OTk5OTk5OFxuICAgIC8vICAwLjIgKyAwLjEgPSAwLjMwMDAwMDAwMDAwMDAwMDA0XG4gICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNDU4NjMzL2hvdy10by1kZWFsLXdpdGgtZmxvYXRpbmctcG9pbnQtbnVtYmVyLXByZWNpc2lvbi1pbi1qYXZhc2NyaXB0XG4gICAgbnVtMSA9IE51bWJlcihudW0xLnRvRml4ZWQoZnJhY3Rpb25EaWdpdHMpKTtcbiAgICBudW0yID0gTnVtYmVyKG51bTIudG9GaXhlZChmcmFjdGlvbkRpZ2l0cykpO1xuICAgIC8vIFJldHVybnMgdHdvIG51bWJlcnMgKGVxdWl2YWxlbnQgdG8gZmxvb3IgYW5kIGNlaWwgb2YgdGhlIGdpdmVuIG51bWJlcik6XG4gICAgLy8gT25lIGxlc3MgdGhhbiB0aGUgZ2l2ZW4gbnVtYmVyLlxuICAgIC8vIFRoZSBvdGhlciBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIG51bWJlci5cbiAgICAvLyBudW0xIGlzIGZsb29yLCBudW0yIGlzIGNlaWwuXG4gICAgcmV0dXJuIFtudW0xLCBudW0yXTtcbn1cbmZ1bmN0aW9uIGhhc01pbmltYWxDaGFuZ2UobnVtYmVyLCBmaXhlZE51bWJlciwgcHJldiwgbmV4dCwgcGN0VG9sZXJhbmNlKSB7XG4gICAgLy8gUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiA8Zml4ZWROdW1iZXI+IGhhcyBjaGFuZ2VkIG1pbmltYWxseSB3aXRoXG4gICAgLy8gcmVzcGVjdCB0byB0aGUgbmVhcmJ5IG51bWJlcnMgaW4gdGhlIHNlcXVlbmNlIGdpdmVuIGJ5IDxwcmV2PiBhbmQgPG5leHQ+LlxuICAgIGxldCBjaGFuZ2UgPSBnZXRQY3RDaGFuZ2UobnVtYmVyLCBmaXhlZE51bWJlciwgcHJldiwgbmV4dCksIHByZXZPaywgbmV4dE9rLCBpc01pbmltYWw7XG4gICAgLy9jb25zb2xlLmxvZyhcIiBcIiwgY2hhbmdlLCBmaXhlZE51bWJlcik7XG4gICAgLy8gSXQgaXMgY29uc2lkZXJlZCBtaW5pbWFsIGNoYW5nZSBpZiBvbmUgb2YgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGlzIHRydWU6XG4gICAgLy8gMS4gQ2hhbmdlIHcuci50IDxwcmV2PiBpcyBhdG1vc3QgPHBjdFRvbGVyYW5jZT4gQU5EXG4gICAgLy8gICAgQ2hhbmdlIHcuci50IDxuZXh0PiBpcyBhdG1vc3QgPHBjdFRvbGVyYW5jZT5cbiAgICAvLyAyLiBTdW0gb2YgY2hhbmdlIHcuci50IDxwcmV2PiBhbmQgPG5leHQ+IGlzIGF0bW9zdCB0d2ljZSB0aGUgPHBjdFRvbGVyYW5jZT4uXG4gICAgcHJldk9rID0gY2hhbmdlLnByZXYgPT0gbnVsbCB8fCBjaGFuZ2UucHJldiA8PSBwY3RUb2xlcmFuY2U7XG4gICAgbmV4dE9rID0gY2hhbmdlLm5leHQgPT0gbnVsbCB8fCBjaGFuZ2UubmV4dCA8PSBwY3RUb2xlcmFuY2U7XG4gICAgaXNNaW5pbWFsID0gKHByZXZPayAmJiBuZXh0T2spIHx8IGNoYW5nZS5wcmV2ICsgY2hhbmdlLm5leHQgPD0gMiAqIHBjdFRvbGVyYW5jZTtcbiAgICByZXR1cm4gaXNNaW5pbWFsO1xufVxuZnVuY3Rpb24gZ2V0UGN0Q2hhbmdlKG51bWJlciwgZml4ZWROdW1iZXIsIHByZXYsIG5leHQpIHtcbiAgICAvLyBSZXR1cm5zIHRoZSBhYnNvbHV0ZSBwZXJjZW50IGNoYW5nZSBvZiB0aGUgZ2l2ZW4gbnVtYmVyXG4gICAgLy8gKGFmdGVyIGl0IGhhcyBiZWVuIGNoYW5nZWQgdG8gPGZpeGVkTnVtYmVyPilcbiAgICAvLyB3LnIudCBpdHMgbmVhcmJ5IG51bWJlcnMgZ2l2ZW4gYXMgPHByZXY+IGFuZCA8bmV4dD4uXG4gICAgbGV0IGNoYW5nZSA9IHtcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbFxuICAgIH0sIG9sZERpZmYsIG5ld0RpZmYsIGRpZmZDaGFuZ2U7XG4gICAgaWYgKHByZXYgIT0gbnVsbCkge1xuICAgICAgICBvbGREaWZmID0gbnVtYmVyIC0gcHJldjtcbiAgICAgICAgbmV3RGlmZiA9IGZpeGVkTnVtYmVyIC0gcHJldjtcbiAgICAgICAgZGlmZkNoYW5nZSA9IG5ld0RpZmYgLSBvbGREaWZmO1xuICAgICAgICBjaGFuZ2UucHJldiA9IE1hdGguZmxvb3IoTWF0aC5hYnMoKGRpZmZDaGFuZ2UgKiAxMDApIC8gb2xkRGlmZikpO1xuICAgIH1cbiAgICBpZiAobmV4dCAhPSBudWxsKSB7XG4gICAgICAgIG9sZERpZmYgPSBuZXh0IC0gbnVtYmVyO1xuICAgICAgICBuZXdEaWZmID0gbmV4dCAtIGZpeGVkTnVtYmVyO1xuICAgICAgICBkaWZmQ2hhbmdlID0gbmV3RGlmZiAtIG9sZERpZmY7XG4gICAgICAgIGNoYW5nZS5uZXh0ID0gTWF0aC5mbG9vcihNYXRoLmFicygoZGlmZkNoYW5nZSAqIDEwMCkgLyBvbGREaWZmKSk7XG4gICAgfVxuICAgIHJldHVybiBjaGFuZ2U7XG59XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3RDc3MgPSBcIi5wb3BvdmVye3otaW5kZXg6MTAwfS5wYW5lbHttaW4taGVpZ2h0OjMwMHB4fS5jb250ZW50e21heC1oZWlnaHQ6NjB2aH0uc2VsZWN0aW9uLWJ1dHRvbi1kaXZ7cGFkZGluZzo0cHggMTBweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdENsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0Q2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLm1heE51bWJlckZpZWxkQ291bnQgPSAxMDtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkcyA9IFtdO1xuICAgICAgICB0aGlzLmZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWVsZFRvUmVwbGFjZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3BvdmVyUHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2luZ2xlRWRpdE1vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oZWFkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9rQnRuVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWx0ZXJQbGFjZWhvbGRlclRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5LmRlZmF1bHQ7XG4gICAgICAgIHRoaXMuZmlsdGVyRmllbGRzID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy53aWR0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgICAgIHRoaXMucmVuZGVyZXJGaWVsZEluZm9zTWFwID0gKF9hID0gc21hcnRNYXBwaW5nU3RhdGUuc2VsZWN0ZWRGaWVsZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZWR1Y2UoKG1hcCwgZmllbGRJbmZvKSA9PiB7XG4gICAgICAgICAgICBtYXBbZmllbGRJbmZvLmZpZWxkXSA9IGZpZWxkSW5mbztcbiAgICAgICAgICAgIHJldHVybiBtYXA7XG4gICAgICAgIH0sIHt9KTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLnNldFVwT2JzZXJ2ZXJzKCk7XG4gICAgICAgIChfYSA9IHRoaXMucmVzaXplT2JzZXJ2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYnNlcnZlKHRoaXMucG9wb3ZlclByb3BzLnJlZkVsZW1lbnQpO1xuICAgICAgICBjb25zdCBkaXNhYmxlZExpc3RJdGVtcyA9IHRoaXMuY2hlY2tEaXNhYmxlZExpc3RJdGVtcygpO1xuICAgICAgICBkaXNhYmxlZExpc3RJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB0aGlzLmxpc3ROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pKTtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIChfYSA9IHRoaXMubXV0YXRpb25PYnNlcnZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgKF9iID0gdGhpcy5yZXNpemVPYnNlcnZlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnVub2JzZXJ2ZSh0aGlzLnBvcG92ZXJQcm9wcy5yZWZFbGVtZW50KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFJlbmRlciAgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHByb3BzID0gdGhpcy5wb3BvdmVyUHJvcHM7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImpzLWFwcC1mbHlvdXRcIiB9LCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgZGlyOiBzbWFydE1hcHBpbmdTdGF0ZS5pc1JUTCA/IFwicnRsXCIgOiBcImx0clwiLCBjbGFzczogXCJwb3BvdmVyXCIsIHBsYWNlbWVudDogcHJvcHMucGxhY2VtZW50IHx8IFwibGVhZGluZy1zdGFydFwiLCBvcGVuOiB0aGlzLmlzT3BlbiwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiBwcm9wcy5yZWZFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogcHJvcHMub2Zmc2V0RGlzdGFuY2UgfHwgLShwcm9wcy5wb3BvdmVyV2lkdGggfHwgdGhpcy53aWR0aCkgKyAxMCwgb2Zmc2V0U2tpZGRpbmc6IHByb3BzLm9mZnNldFNraWRkaW5nIHx8IDAsIG92ZXJsYXlQb3NpdGlvbmluZzogcHJvcHMub3ZlcmxheVBvc2l0aW9uaW5nLCB0cmlnZ2VyRGlzYWJsZWQ6IHByb3BzLnRyaWdnZXJEaXNhYmxlZCwgbGFiZWw6IHRoaXMuaGVhZGluZyB8fFxuICAgICAgICAgICAgICAgICh0aGlzLnNpbmdsZUVkaXRNb2RlID8gc3RyaW5ncy5yZXBsYWNlRmllbGQgOiBzdHJpbmdzLmZpZWxkUGlja0xpc3Quc2VsZWN0RmllbGRzKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMucG9wb3Zlck5vZGUgPSBub2RlKSB9LCBoKFwiY2FsY2l0ZS1mbG93XCIsIHsgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd05vZGUgPSBub2RlKSwgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogYCR7dGhpcy53aWR0aCB8fCBwcm9wcy5wb3BvdmVyV2lkdGh9cHhgXG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpLCBjbGFzczogXCJwYW5lbFwiLCBoZWFkaW5nOiB0aGlzLmhlYWRpbmcgfHxcbiAgICAgICAgICAgICAgICAodGhpcy5zaW5nbGVFZGl0TW9kZSA/IHN0cmluZ3MucmVwbGFjZUZpZWxkIDogc3RyaW5ncy5maWVsZFBpY2tMaXN0LnNlbGVjdEZpZWxkcyksIGNsb3NhYmxlOiB0cnVlLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3RDbG9zZS5lbWl0KCkgfSwgIXRoaXMuc2luZ2xlRWRpdE1vZGUgJiYgdGhpcy5yZW5kZXJBZGRCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSwgdGhpcy5yZW5kZXJMaXN0KCkpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQWRkQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiLCBzY2FsZTogXCJtXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdENsb3NlLmVtaXQoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzOiB0aGlzLnNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICB9KSB9LCB0aGlzLm9rQnRuVGV4dCB8fCBzdHJpbmdzLmFkZCkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IHRoaXMuc2luZ2xlRWRpdE1vZGUgPyBcImZ1bGxcIiA6IFwiaGFsZlwiLCBzY2FsZTogXCJtXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRmllbGRQaWNrTGlzdENsb3NlLmVtaXQoKSB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICByZW5kZXJMaXN0KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdFwiLCB7IHNlbGVjdGlvbk1vZGU6IHRoaXMuc2luZ2xlRWRpdE1vZGUgPyBcInNpbmdsZS1wZXJzaXN0XCIgOiBcIm11bHRpcGxlXCIsIHJlZjogKG5vZGUpID0+ICh0aGlzLmxpc3ROb2RlID0gbm9kZSksIGNsYXNzOiBcImNvbnRlbnRcIiwgZmlsdGVyRW5hYmxlZDogdGhpcy5maWVsZHMubGVuZ3RoID49IDEwLCBmaWx0ZXJQbGFjZWhvbGRlcjogKF9hID0gdGhpcy5maWx0ZXJQbGFjZWhvbGRlclRleHQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHN0cmluZ3MuZmllbGRQaWNrTGlzdC5zZWFyY2hGaWVsZHMsIG9uQ2FsY2l0ZUxpc3RGaWx0ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyRmllbGRzID0gKF9iID0gKF9hID0gdGhpcy5saXN0Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbHRlcmVkSXRlbXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IH0sIHRoaXMucmVuZGVyU29ydERyb3Bkb3duKCksIFsuLi50aGlzLmdldFNvcnRlZExpc3QoKV0ubWFwKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdEl0ZW0oZmllbGQpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJMaXN0SXRlbShmaWVsZCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBpc0Jpbm5pbmdMYXllciA9IFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogZmllbGQubGF5ZXJGaWVsZC5uYW1lLCBsYWJlbDogZmllbGQubGFiZWwgfHwgZmllbGQubGF5ZXJGaWVsZC5uYW1lLCBcImRhdGEtdHlwZVwiOiBmaWVsZC5zaW1wbGVGaWVsZFR5cGUsIHZhbHVlOiBmaWVsZC5sYXllckZpZWxkLm5hbWUsIHNlbGVjdGVkOiB0aGlzLnNpbmdsZUVkaXRNb2RlICYmIGZpZWxkLmxheWVyRmllbGQubmFtZSA9PT0gdGhpcy5maWVsZFRvUmVwbGFjZS5maWVsZCwgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogZmllbGQubGFiZWwsXG4gICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5sYXllckZpZWxkLm5hbWVcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUxpc3RJdGVtU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkcyA9IHRoaXMubGlzdE5vZGUuc2VsZWN0ZWRJdGVtcy5tYXAoKG5vZGUpID0+IG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpbmdsZUVkaXRNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmllbGRzWzBdICE9PSB0aGlzLmZpZWxkVG9SZXBsYWNlLmZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3RDbG9zZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkczogdGhpcy5zZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrRGlzYWJsZWRMaXN0SXRlbXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3RDaGFuZ2UuZW1pdCh7IHNlbGVjdGVkRmllbGRzOiB0aGlzLnNlbGVjdGVkRmllbGRzIH0pO1xuICAgICAgICAgICAgfSB9LCAhaXNCaW5uaW5nTGF5ZXIgJiYgKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiwgdGV4dDogc3RyaW5ncy5maWVsZFBpY2tMaXN0LmluZm8sIHNjYWxlOiBcInNcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mb0Zsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mb0Zsb3dJdGVtLmhlYWRpbmcgPSAoX2EgPSBmaWVsZC5sYWJlbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmllbGQubGF5ZXJGaWVsZC5uYW1lO1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mb0Zsb3dJdGVtLmRlc2NyaXB0aW9uID0gZmllbGQubGF5ZXJGaWVsZC5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZmllbGQtaW5mb1wiKTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8ubGFuZyA9IHNtYXJ0TWFwcGluZ1N0YXRlLmZ1bGxMb2NhbGU7XG4gICAgICAgICAgICAgICAgZmllbGRJbmZvLmZpZWxkTmFtZSA9IGZpZWxkLmxheWVyRmllbGQubmFtZTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8ubGF5ZXIgPSBsYXllcjtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8udmlldyA9IG1hcFZpZXc7XG4gICAgICAgICAgICAgICAgZmllbGRJbmZvLmNsYXNzTGlzdC5hZGQoXCJjb250ZW50XCIpO1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mb0Zsb3dJdGVtLmFwcGVuZENoaWxkKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgZmllbGRJbmZvRmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVGbG93SXRlbUJhY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gYWN0aW9uLnNldEZvY3VzKCkpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9GbG93SXRlbS5yZW1vdmVDaGlsZChmaWVsZEluZm8pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLnJlbW92ZUNoaWxkKGZpZWxkSW5mb0Zsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dOb2RlLmFwcGVuZENoaWxkKGZpZWxkSW5mb0Zsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gZmllbGRJbmZvRmxvd0l0ZW0uc2V0Rm9jdXMoKSk7XG4gICAgICAgICAgICB9IH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJTb3J0RHJvcGRvd24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlclNvcnRNZW51ID0gdGhpcy5maWVsZHMubGVuZ3RoID4gMTA7XG4gICAgICAgIGlmICghcmVuZGVyU29ydE1lbnUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtZHJvcGRvd25cIiwgeyBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgc2xvdDogXCJmaWx0ZXItYWN0aW9ucy1lbmRcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZHJvcGRvd25Ob2RlID0gbm9kZSksIG9uQ2FsY2l0ZURyb3Bkb3duT3BlbjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyLm9ic2VydmUodGhpcy5wb3BvdmVyTm9kZSwgeyBhdHRyaWJ1dGVzOiB0cnVlIH0pO1xuICAgICAgICAgICAgfSwgb25DYWxjaXRlRHJvcGRvd25DbG9zZTogKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kaXNjb25uZWN0KCk7IH0sIG9uQ2FsY2l0ZURyb3Bkb3duU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5WyhfYSA9IHRoaXMuZHJvcGRvd25Ob2RlLnNlbGVjdGVkSXRlbXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYWJlbF07XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydEJ5KTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2xvdDogXCJ0cmlnZ2VyXCIsIHRleHQ6IHN0cmluZ3MuZmllbGRQaWNrTGlzdC5zb3J0LCB0aXRsZTogc3RyaW5ncy5maWVsZFBpY2tMaXN0LnNvcnQgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJzb3J0RGVzY2VuZGluZ1wiIH0pKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgbnVsbCwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IGxhYmVsOiBMYXN0U29ydHlCeS5kZWZhdWx0LCBzZWxlY3RlZDogdGhpcy5sYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS5kZWZhdWx0IH0sIHN0cmluZ3MuZmllbGRQaWNrTGlzdC5kZWZhdWx0KSwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IGxhYmVsOiBMYXN0U29ydHlCeS5kaXNwbGF5LCBzZWxlY3RlZDogdGhpcy5sYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS5kaXNwbGF5IH0sIHN0cmluZ3MuZmllbGRQaWNrTGlzdC5kaXNwbGF5TmFtZSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBsYWJlbDogTGFzdFNvcnR5QnkudHlwZSwgc2VsZWN0ZWQ6IHRoaXMubGFzdFNvcnRCeSA9PT0gTGFzdFNvcnR5QnkudHlwZSB9LCBzdHJpbmdzLmZpZWxkUGlja0xpc3QudHlwZSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBsYWJlbDogTGFzdFNvcnR5QnkuZmllbGQsIHNlbGVjdGVkOiB0aGlzLmxhc3RTb3J0QnkgPT09IExhc3RTb3J0eUJ5LmZpZWxkIH0sIHN0cmluZ3MuZmllbGRQaWNrTGlzdC5maWVsZE5hbWUpKSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNoZWNrRGlzYWJsZWRMaXN0SXRlbXMoKSB7XG4gICAgICAgIGlmICghdGhpcy5saXN0Tm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IGdldEZpZWxkVHlwZUNvdW50KCk7XG4gICAgICAgIGlmICh0aGlzLnNpbmdsZUVkaXRNb2RlKSB7XG4gICAgICAgICAgICBjb3VudHNbdGhpcy5maWVsZFRvUmVwbGFjZS5zaW1wbGVGaWVsZFR5cGVdLS07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRzLmZvckVhY2goKGZpZWxkTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQoZmllbGROYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGZpZWxkLnNpbXBsZUZpZWxkVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRzLm51bWJlcisrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cy5zdHJpbmcrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRzLmRhdGUrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpc2FibGVkTGlzdEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMubGlzdE5vZGVcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIilcbiAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB0aGlzLmVuYWJsZUxpc3RJdGVtKGl0ZW0pKTtcbiAgICAgICAgaWYgKHNtYXJ0TWFwcGluZ1N0YXRlLm1hcEltYWdlU3VibGF5ZXIgJiZcbiAgICAgICAgICAgICFzbWFydE1hcHBpbmdTdGF0ZS5zdXBwb3J0c0FyY2FkZSAmJlxuICAgICAgICAgICAgY291bnRzLm51bWJlciArIGNvdW50cy5zdHJpbmcgKyBjb3VudHMuZGF0ZSArIGNvdW50cy51bmtub3duID09PSAxKSB7XG4gICAgICAgICAgICAvLyBtYXggMSBmaWVsZFxuICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS10eXBlPVwic3RyaW5nXCJdLCBbZGF0YS10eXBlPVwibnVtYmVyXCJdLCBbZGF0YS10eXBlPVwiZGF0ZVwiXWApXG4gICAgICAgICAgICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5pbmRleE9mKGl0ZW0udmFsdWUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVMaXN0SXRlbShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRMaXN0SXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzbWFydE1hcHBpbmdTdGF0ZS5tYXBJbWFnZVN1YmxheWVyICYmXG4gICAgICAgICAgICBjb3VudHMubnVtYmVyICsgY291bnRzLnN0cmluZyArIGNvdW50cy5kYXRlICsgY291bnRzLnVua25vd24gPT09IDEgJiZcbiAgICAgICAgICAgIGNvdW50cy5kYXRlID09PSAxKSB7XG4gICAgICAgICAgICAvLyBtYXggMSBkYXRlIGZpZWxkXG4gICAgICAgICAgICB0aGlzLmxpc3ROb2RlXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLXR5cGU9XCJkYXRlXCJdYClcbiAgICAgICAgICAgICAgICAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmllbGRzLmluZGV4T2YoaXRlbS52YWx1ZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZExpc3RJdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvdW50cy5zdHJpbmcgPT09IDEpIHtcbiAgICAgICAgICAgIC8vIG1heCAxIHN0cmluZyBmaWVsZFxuICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS10eXBlPVwic3RyaW5nXCJdYClcbiAgICAgICAgICAgICAgICAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmllbGRzLmluZGV4T2YoaXRlbS52YWx1ZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZExpc3RJdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNvdW50cy5udW1iZXIgPT09IDEgfHwgY291bnRzLmRhdGUgPT09IDEgfHwgY291bnRzLnVua25vd24gPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBtYXggMSBudW1iZXIvZGF0ZSBmaWVsZCBpZiB0aGVyZSBpcyAxIHN0cmluZyBmaWVsZFxuICAgICAgICAgICAgICAgIHRoaXMubGlzdE5vZGVcbiAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLXR5cGU9XCJudW1iZXJcIl0sIFtkYXRhLXR5cGU9XCJkYXRlXCJdYClcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWVsZHMuaW5kZXhPZihpdGVtLnZhbHVlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRMaXN0SXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvdW50cy5udW1iZXIgKyBjb3VudHMuZGF0ZSArIGNvdW50cy51bmtub3duID4gMSkge1xuICAgICAgICAgICAgLy8gd2UgaGF2ZSBhdCBsZWFzdCAyIGZpZWxkc1xuICAgICAgICAgICAgaWYgKChjb3VudHMuZXhwcmVzc2lvbiA+IDAgJiZcbiAgICAgICAgICAgICAgICAhKGNvdW50cy5leHByZXNzaW9uID09PSAxICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAzICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXJGaWVsZEluZm9zTWFwW3RoaXMuc2VsZWN0ZWRGaWVsZHNbMl1dLmV4cHJlc3Npb24pKSB8fFxuICAgICAgICAgICAgICAgIChjb3VudHMuZGF0ZSA+IDAgJiYgY291bnRzLm51bWJlciA9PT0gMiAmJiAhdGhpcy5zaW5nbGVFZGl0TW9kZSkgfHxcbiAgICAgICAgICAgICAgICBjb3VudHMuZGF0ZSA9PT0gMiB8fFxuICAgICAgICAgICAgICAgIChzbWFydE1hcHBpbmdTdGF0ZS5tYXBJbWFnZVN1YmxheWVyICYmIGNvdW50cy5kYXRlID4gMCkpIHtcbiAgICAgICAgICAgICAgICAvLyBtYXggMiBmaWVsZHNcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3ROb2RlXG4gICAgICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIilcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRGaWVsZHMuaW5kZXhPZihpdGVtLnZhbHVlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRMaXN0SXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gbW9yZSBzdHJpbmdzXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChgW2RhdGEtdHlwZT1cInN0cmluZ1wiXWApXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZExpc3RJdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5pbmRleE9mKGl0ZW0udmFsdWUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdyb25nIGNvbWJpbmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoY291bnRzLm51bWJlciA+IDIgfHwgc21hcnRNYXBwaW5nU3RhdGUubWFwSW1hZ2VTdWJsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBubyBtb3JlIGRhdGUgZmllbGRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLXR5cGU9XCJkYXRlXCJdYClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVMaXN0SXRlbShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkTGlzdEl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5pbmRleE9mKGl0ZW0udmFsdWUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3cm9uZyBjb21iaW5hdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb3VudHMuZGF0ZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBtYXggb25lIGRhdGUgZmllbGRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLXR5cGU9XCJkYXRlXCJdYClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5pbmRleE9mKGl0ZW0udmFsdWUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkTGlzdEl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY291bnRzLm51bWJlciA+PSB0aGlzLm1heE51bWJlckZpZWxkQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gMTAgbnVtYmVyIGZpZWxkcyBtYXhcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0Tm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLXR5cGU9XCJudW1iZXJcIl0sIFtkYXRhLXR5cGU9XCJkYXRlXCJdYClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5pbmRleE9mKGl0ZW0udmFsdWUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxpc3RJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkTGlzdEl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlzYWJsZWRMaXN0SXRlbXM7XG4gICAgfVxuICAgIGRpc2FibGVMaXN0SXRlbShpdGVtKSB7XG4gICAgICAgIGl0ZW0uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLWFjdGlvblwiKTtcbiAgICAgICAgaWYgKGFjdGlvbikge1xuICAgICAgICAgICAgYWN0aW9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbmFibGVMaXN0SXRlbShpdGVtKSB7XG4gICAgICAgIGl0ZW0uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gaXRlbS5xdWVyeVNlbGVjdG9yKFwiY2FsY2l0ZS1hY3Rpb25cIik7XG4gICAgICAgIGlmIChhY3Rpb24pIHtcbiAgICAgICAgICAgIGFjdGlvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFNvcnRlZExpc3QoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBTb3J0ZWQgPSBbLi4udGhpcy5maWVsZHNdO1xuICAgICAgICBpZiAodGhpcy5sYXN0U29ydEJ5ID09PSBMYXN0U29ydHlCeS5kaXNwbGF5KSB7XG4gICAgICAgICAgICB0ZW1wU29ydGVkLnNvcnQoKGEsIGIpID0+IGEubGF5ZXJGaWVsZC5hbGlhcy5sb2NhbGVDb21wYXJlKGIubGF5ZXJGaWVsZC5hbGlhcykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdFNvcnRCeSA9PT0gTGFzdFNvcnR5QnkuZmllbGQpIHtcbiAgICAgICAgICAgIHRlbXBTb3J0ZWQuc29ydCgoYSwgYikgPT4gYS5sYXllckZpZWxkLm5hbWUubG9jYWxlQ29tcGFyZShiLmxheWVyRmllbGQubmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdFNvcnRCeSA9PT0gTGFzdFNvcnR5QnkudHlwZSkge1xuICAgICAgICAgICAgdGVtcFNvcnRlZC5zb3J0KChhLCBiKSA9PiBhLnNpbXBsZUZpZWxkVHlwZS5sb2NhbGVDb21wYXJlKGIuc2ltcGxlRmllbGRUeXBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRlbXBTb3J0ZWQ7XG4gICAgfVxuICAgIHNldFVwT2JzZXJ2ZXJzKCkge1xuICAgICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25MaXN0IC8qICwgbXV0YXRpb25PYnNlcnZlciAqLykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbkxpc3QpIHtcbiAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24uYXR0cmlidXRlTmFtZSA9PT0gXCJzdHlsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBvcG92ZXJOb2RlLnN0eWxlLnZpc2liaWxpdHkgPT09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd25Ob2RlLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxhc3QgPSBlbnRyaWVzLnBvcCgpO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IGxhc3QuY29udGVudFJlY3Qud2lkdGggKiAxLjA1O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3Quc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0Q3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydFNpemVDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydFNpemVCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0U2l6ZUJhY2tDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydFNpemVDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0U2l6ZUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLnRpbGVOb2RlcyA9IFtdO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2sgPSAodHlwZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBmbG93Tm9kZSB9ID0gdGhpcztcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaXplXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXNpemVcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmhpZGVUcmFuc3BhcmVuY3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlUm90YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcImNoYXJ0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWNoYXJ0XCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0RXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXJcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04gPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZsb3dOb2RlID0gZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3dcIik7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBoaWRlTGF5ZXJUaXRsZSwgaXNSVEwsIG1hcEltYWdlU3VibGF5ZXIsIGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBoaWRlTGF5ZXJUaXRsZSA/IHVuZGVmaW5lZCA6IChfYSA9IG1hcEltYWdlU3VibGF5ZXIgPT09IG51bGwgfHwgbWFwSW1hZ2VTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwSW1hZ2VTdWJsYXllci50aXRsZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGF5ZXIudGl0bGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246IHRpdGxlLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplQmFja0NsaWNrLmVtaXQoKSwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydFNpemVDbG9zZS5lbWl0KCkgfSwgdGhpcy5yZW5kZXJDaGFydFRpbGUoKSwgdGhpcy5yZW5kZXJTaXplVGlsZSgpLCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2hhcnRUaWxlKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10aWxlXCIsIHsgdHlwZTogXCJjaGFydFwiLCBzZWxlY3RlZDogdGhpcy5sYXN0Q2xpY2sgPT09IFwiY2hhcnRcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSBcImNoYXJ0XCI7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJjaGFydFwiKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnM6ICgpID0+IHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwiY2hhcnRcIiksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1tcImNoYXJ0XCJdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2l6ZVRpbGUoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRpbGVcIiwgeyB0eXBlOiBcInNpemVcIiwgc2VsZWN0ZWQ6IHRoaXMubGFzdENsaWNrID09PSBcInNpemVcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSBcInNpemVcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcInNpemVcIik7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zOiAoKSA9PiB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcInNpemVcIiksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1tcInNpemVcIl0gPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplQ2xvc2UuZW1pdCgpLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbCh0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OLCB0aGlzLm9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydFNpemVDbG9zZS5lbWl0KCk7XG4gICAgICAgICAgICB9LCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgZm9jdXNTZWxlY3RlZFRpbGUoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMudGlsZU5vZGVzW3RoaXMubGFzdENsaWNrXS5zZXRGb2N1cygpKSwgMzAwKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0U2l6ZS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0U2l6ZUNzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUJhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy50aWxlTm9kZXMgPSBbXTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2sgPSAodHlwZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBmbG93Tm9kZSB9ID0gdGhpcztcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaXplXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXNpemVcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmhpZGVUcmFuc3BhcmVuY3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlUm90YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvbG9yXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWNvbG9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlVHJhbnNwYXJlbmN5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVJvdGF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZURvbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBrZWVwIHRoZSBjdXJyZW50IHNldHRpbmdzIG9uIHRoZSBsYXllclxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJKU09OLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gfSA9IHRoaXM7XG4gICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwob3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUNsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiA9IHJlbmRlcmVyLnRvSlNPTigpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiA9XG4gICAgICAgICAgICBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgPyBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmxvd05vZGUgPSBmaW5kUGFyZW50Tm9kZSh0aGlzLmhvc3RFbGVtZW50LCBcImNhbGNpdGUtZmxvd1wiKTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBoaWRlTGF5ZXJUaXRsZSwgaXNSVEwsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IGxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplQmFja0NsaWNrLmVtaXQoKTtcbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpIH0sIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpLCB0aGlzLnJlbmRlckNvbG9yVGlsZSgpLCB0aGlzLnJlbmRlclNpemVUaWxlKCksIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5KCksIHRoaXMucmVuZGVyUm90YXRpb24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yVGlsZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXN0Q2xpY2sgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCB0eXBlID0gcmVuZGVyZXJUeXBlID09PSBcImNvbG9yLWFnZS1zaXplXCIgPyBcImNvbG9yLWFnZVwiIDogXCJjb2xvclwiO1xuICAgICAgICBjb25zdCB0aGVtZSA9IGdldFJlbmRlcmVyVGhlbWUoXCJjb2xvclwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdGlsZVwiLCB7IGtleTogYHRpbGUtJHt0eXBlfS0ke3RoZW1lfWAsIHR5cGU6IHR5cGUsIHNlbGVjdGVkOiBsYXN0Q2xpY2sgPT09IFwiY29sb3JcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSB0eXBlO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwiY29sb3JcIik7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zOiAoKSA9PiB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcImNvbG9yXCIpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVFcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGlsZU5vZGVzW3R5cGVdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2l6ZVRpbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGFzdENsaWNrIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgdHlwZSA9IHJlbmRlcmVyVHlwZSA9PT0gXCJjb2xvci1zaXplLWFnZVwiID8gXCJzaXplLWFnZVwiIDogXCJzaXplXCI7XG4gICAgICAgIGNvbnN0IHRoZW1lID0gZ2V0UmVuZGVyZXJUaGVtZShcInNpemVcIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRpbGVcIiwgeyBrZXk6IGB0aWxlLSR7dHlwZX0tJHt0aGVtZX1gLCB0eXBlOiB0eXBlLCBzZWxlY3RlZDogbGFzdENsaWNrID09PSBcInNpemVcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSB0eXBlO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwic2l6ZVwiKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnM6ICgpID0+IHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwic2l6ZVwiKSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVFcnJvci5lbWl0KGV2ZW50LmRldGFpbCksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1t0eXBlXSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclRyYW5zcGFyZW5jeSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRyYW5zcGFyZW5jeVwiLCB7IG9wZW46ICEhb3BhY2l0eVZpc1Zhciwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xUcmFuc3BhcmVuY3lFcnJvcjogKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJyb3RhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcm90YXRpb25cIiwgeyBvcGVuOiAhb3BhY2l0eVZpc1ZhciAmJiAhIXJvdGF0aW9uVmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUVycm9yLmVtaXQoZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIGZvY3VzU2VsZWN0ZWRUaWxlKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnRpbGVOb2Rlc1t0aGlzLmxhc3RDbGlja10uc2V0Rm9jdXMoKSksIDMwMCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemUuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVDc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX0uY29sb3Itc2l6ZS11bml2YXJpYXRlLWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5hdHRyaWJ1dGUtbmFtZXt3b3JkLWJyZWFrOmJyZWFrLWFsbH0uc3ltYm9sLWFib3ZlLWFuZC1iZWxvd3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmFib3ZlLWJlbG93LXN5bWJvbC1idXR0b257d2lkdGg6NDklfS5sZWdlbmQtdG9nZ2xlLXBhZGRpbmd7cGFkZGluZy10b3A6MTJweDtwYWRkaW5nLWJvdHRvbToxMnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUVycm9yXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmhhbmRsZURvbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJKU09OLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gfSA9IHRoaXM7XG4gICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwob3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSB0cnVlO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiA9IHJlbmRlcmVyLnRvSlNPTigpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiA9XG4gICAgICAgICAgICBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgPyBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiAhaGlkZUxheWVyVGl0bGUgPyBsYXllci50aXRsZSA6IHVuZGVmaW5lZCwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVCYWNrQ2xpY2suZW1pdCgpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCksIHRoaXMucmVuZGVyVmlzdWFsaXphdGlvbigpLCB0aGlzLnJlbmRlclRyYW5zcGFyZW5jeSgpLCB0aGlzLnJlbmRlclJvdGF0aW9uKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoIWxheWVyKSB7XG4gICAgICAgICAgICAvLyBsb2FkaW5nIHN0YXRlIG9mIHBhbmVsIGRvZXNuJ3QgcG9zaXRpb24gYnV0dG9ucyBjb3JyZWN0bHlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogdGhpcy5oYW5kbGVEb25lLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKCFsYXllcikge1xuICAgICAgICAgICAgLy8gbG9hZGluZyBzdGF0ZSBvZiBwYW5lbCBkb2Vzbid0IHBvc2l0aW9uIGJ1dHRvbnMgY29ycmVjdGx5XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IHZpc3VhbGl6YXRpb25PcGVuIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBjb2xvclZpc1ZhclxuICAgICAgICAgICAgPyBjb2xvclZpc1Zhci5maWVsZFxuICAgICAgICAgICAgICAgID8gKF9hID0gZ2V0RmllbGQoY29sb3JWaXNWYXIuZmllbGQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGFiZWxcbiAgICAgICAgICAgICAgICA6IGNvbG9yVmlzVmFyLnZhbHVlRXhwcmVzc2lvblRpdGxlIHx8IHN0cmluZ3MuZXhwcmVzc2lvblxuICAgICAgICAgICAgOiByZW5kZXJlci5maWVsZFxuICAgICAgICAgICAgICAgID8gKF9iID0gZ2V0RmllbGQocmVuZGVyZXIuZmllbGQpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGFiZWxcbiAgICAgICAgICAgICAgICA6IHJlbmRlcmVyLnZhbHVlRXhwcmVzc2lvblRpdGxlIHx8IHN0cmluZ3MuZXhwcmVzc2lvbjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNsYXNzOiBcImNvbG9yLXNpemUtdW5pdmFyaWF0ZS1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5jb2xvclNpemVVbml2YXJpYXRlLmNvbG9yU2l6ZVN0eWxlLCBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogdmlzdWFsaXphdGlvbk9wZW4sIG9uQ2FsY2l0ZUJsb2NrT3BlbjogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSB0cnVlKSwgb25DYWxjaXRlQmxvY2tDbG9zZTogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZSkgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJhdHRyaWJ1dGUtbmFtZVwiIH0sIGZpZWxkTmFtZSksIHRoaXMucmVuZGVyVGhlbWUoKSwgdGhpcy5yZW5kZXJEaXZpZGVkQnkoKSwgdGhpcy5yZW5kZXJTeW1ib2xQYWlyQnV0dG9uKCksIHRoaXMucmVuZGVyQWJvdmVBbmRCZWxvd1N5bWJvbHMoKSwgdGhpcy5yZW5kZXJDb2xvclNjaGVtZSgpLCB0aGlzLnJlbmRlclN5bWJvbCgpLCB0aGlzLnJlbmRlckNvbG9yU2l6ZVNsaWRlcigpLCB0aGlzLnJlbmRlclNpemVSYW5nZSgpLCB0aGlzLnJlbmRlckJhY2tncm91bmRTdHlsZSgpLCB0aGlzLnJlbmRlckRlZmF1bHRTeW1ib2woKSwgdGhpcy5yZW5kZXJTaG93SW5MZWdlbmQoKSkpO1xuICAgIH1cbiAgICByZW5kZXJUaGVtZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRoZW1lLWJ1dHRvblwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLnRoZW1lQnV0dG9uTm9kZSA9IG5vZGUpLCByZW5kZXJlclN1YnR5cGU6IFwiY29sb3JTaXplXCIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b25CZWZvcmVPcGVuOiAoKSA9PiBjbG9zZVBvcG92ZXJzKCksIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b25DaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgICAgICAgICBjb25zdCB3YXNBYm92ZUFuZEJlbG93ID0gYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lID09PSBcImFib3ZlLWFuZC1iZWxvd1wiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IGV2ZW50LmRldGFpbCA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgICAgICAgICBsZXQgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yU2l6ZVVuaXZhcmlhdGVSZW5kZXJlckZyb21FeGlzdGluZztcbiAgICAgICAgICAgICAgICBpZiAoIXdhc0Fib3ZlQW5kQmVsb3cgJiYgaXNBYm92ZUFuZEJlbG93KSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDb2xvclNpemVVbml2YXJpYXRlUmVuZGVyZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKHVwZGF0ZUNhbGwoe1xuICAgICAgICAgICAgICAgICAgICB0aGVtZTogZXZlbnQuZGV0YWlsLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpLFxuICAgICAgICAgICAgICAgICAgICBkaXNjYXJkTWluTWF4OiB0cnVlXG4gICAgICAgICAgICAgICAgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGhlbWVCdXR0b25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMudGhlbWVCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yb3RhdGlvbk5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnNpemVSYW5nZVNsaWRlck5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zbGlkZXJOb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlLnVwZGF0ZVN0YXRpc3RpY3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnRoZW1lQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckRpdmlkZWRCeSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgZmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBpc0FnZVJlbmRlcmVyID0gW1wiY29sb3ItYWdlXCIsIFwiY29sb3ItYWdlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTE7XG4gICAgICAgIGlmIChpc0FnZVJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpWzBdO1xuICAgICAgICBpZiAoZmllbGRJbmZvLmV4cHJlc3Npb24gfHwgZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSAhPT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IGdldExheWVyRmllbGRUeXBlQ291bnQoZmllbGRzKTtcbiAgICAgICAgaWYgKGNvdW50cy5udW1iZXIgPCAyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZGl2aWRlZC1ieVwiLCB7IHJlbmRlcmVyU3VidHlwZTogXCJjb2xvclwiLCBub3JtYWxpemF0aW9uRmllbGQ6IChjb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkKSB8fCByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQsIG9uQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5Q2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlLnVwZGF0ZVN0YXRpc3RpY3MoKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5RXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlRXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU3ltYm9sUGFpckJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmIChpc1BvbHlsaW5lVHlwZShsYXllcikpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IGF1dGhJbmZvLnVuaXZhcmlhdGVUaGVtZSA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgaWYgKCFpc0Fib3ZlQW5kQmVsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1wYWlyLWJ1dHRvblwiLCB7IG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sUGFpckJ1dHRvbkJlZm9yZU9wZW46ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xQYWlyQnV0dG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yb3RhdGlvbk5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sUGFpckJ1dHRvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zeW1ib2xQYWlyQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFBhaXJCdXR0b25FcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGVFcnJvci5lbWl0KGV2ZW50LmRldGFpbCksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbFBhaXJCdXR0b25Ob2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQWJvdmVBbmRCZWxvd1N5bWJvbHMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzQWJvdmVBbmRCZWxvdyA9IGF1dGhJbmZvLnVuaXZhcmlhdGVUaGVtZSA9PT0gXCJhYm92ZS1hbmQtYmVsb3dcIjtcbiAgICAgICAgaWYgKCFpc0Fib3ZlQW5kQmVsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN5bWJvbFN0eWxlID0gYXV0aEluZm8udW5pdmFyaWF0ZVN5bWJvbFN0eWxlO1xuICAgICAgICBpZiAoIXN5bWJvbFN0eWxlIHx8ICgoX2EgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpICE9PSAyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZCgoY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmZpZWxkKSB8fCByZW5kZXJlci5maWVsZCk7XG4gICAgICAgIGNvbnN0IGlzRGF0ZSA9IChmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQuc2ltcGxlRmllbGRUeXBlKSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFO1xuICAgICAgICBjb25zdCBhYm92ZVN5bWJvbCA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1sxXS5zeW1ib2w7XG4gICAgICAgIGNvbnN0IGJlbG93U3ltYm9sID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLnN5bWJvbDtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3ltYm9sLWFib3ZlLWFuZC1iZWxvd1wiIH0sIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgY2xhc3M6IFwiYWJvdmUtYmVsb3ctc3ltYm9sLWJ1dHRvblwiLCBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsIHN5bWJvbDogYmVsb3dTeW1ib2wsIHR5cGU6IFwiYmVsb3dcIiwgbGFiZWw6IGlzRGF0ZVxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuY29sb3JTaXplVW5pdmFyaWF0ZS5iZWZvcmVcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucGFuZWxzLmNvbG9yU2l6ZVVuaXZhcmlhdGUuYmVsb3csIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xQYWlyQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbFBhaXJCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnJvdGF0aW9uTm9kZSk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IGNsYXNzOiBcImFib3ZlLWJlbG93LXN5bWJvbC1idXR0b25cIiwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBzeW1ib2w6IGFib3ZlU3ltYm9sLCB0eXBlOiBcImFib3ZlXCIsIGxhYmVsOiBpc0RhdGVcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLmNvbG9yU2l6ZVVuaXZhcmlhdGUuYWZ0ZXJcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucGFuZWxzLmNvbG9yU2l6ZVVuaXZhcmlhdGUuYWJvdmUsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xQYWlyQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbFBhaXJCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnJvdGF0aW9uTm9kZSk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2NoZW1lKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgaXNBYm92ZUFuZEJlbG93ID0gYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lID09PSBcImFib3ZlLWFuZC1iZWxvd1wiO1xuICAgICAgICBpZiAoIWlzQWJvdmVBbmRCZWxvdykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuY29sb3JTaXplVW5pdmFyaWF0ZS5jb2xvclNjaGVtZSwgaChcImNhbGNpdGUtc2VnbWVudGVkLWNvbnRyb2xcIiwgeyBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DYWxjaXRlU2VnbWVudGVkQ29udHJvbENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDb2xvclNjaGVtZUNoYW5nZShldmVudC50YXJnZXQuc2VsZWN0ZWRJdGVtLnZhbHVlKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtc2VnbWVudGVkLWNvbnRyb2wtaXRlbVwiLCB7IGNoZWNrZWQ6ICEhY29sb3JWaXNWYXIsIHZhbHVlOiBcImNvbnRpbnVvdXNcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuY29udGludW91c05vZGUgPSBub2RlKSB9LCBzdHJpbmdzLnBhbmVscy5jb2xvclNpemVVbml2YXJpYXRlLmNvbnRpbnVvdXMpLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbC1pdGVtXCIsIHsgY2hlY2tlZDogIWNvbG9yVmlzVmFyLCB2YWx1ZTogXCJiaW5hcnlcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYmluYXJ5Tm9kZSA9IG5vZGUpIH0sIHN0cmluZ3MucGFuZWxzLmNvbG9yU2l6ZVVuaXZhcmlhdGUuYmluYXJ5KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyU3ltYm9sKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBjbGFzc0JyZWFrSW5mb3MgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3M7XG4gICAgICAgIGxldCBjb2xvcnM7XG4gICAgICAgIGlmIChjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgY29sb3JzID0gY29sb3JWaXNWYXIuc3RvcHMubWFwKChzdG9wKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBzdG9wLmNvbG9yLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgY29sb3IuYSA9IDE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2xhc3NCcmVha0luZm9zID09PSBudWxsIHx8IGNsYXNzQnJlYWtJbmZvcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xhc3NCcmVha0luZm9zLmxlbmd0aCkge1xuICAgICAgICAgICAgY29sb3JzID0gY2xhc3NCcmVha0luZm9zLm1hcCgoY2xhc3NCcmVha0luZm8pID0+IGdldFN5bWJvbENvbG9yKGNsYXNzQnJlYWtJbmZvLnN5bWJvbCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyBjb2xvcnM6IGNvbG9ycywgdHlwZTogXCJjb2xvci1yYW1wXCIsIHJhbXBUeXBlOiBjb2xvclZpc1ZhciA/IFwiY29udGludW91c1wiIDogXCJkaXNjcmV0ZVwiLCByZWY6IChub2RlKSA9PiAodGhpcy5zeW1ib2xCdXR0b25Ob2RlID0gbm9kZSksIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnJvdGF0aW9uTm9kZSk7XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JTaXplU2xpZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1jb2xvci1zaXplLXNsaWRlclwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nQ29sb3JTaXplU2xpZGVyQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2l6ZVNsaWRlckVycm9yOiAoZXZlbnQpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNpemVSYW5nZSgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc2l6ZS1yYW5nZS1zbGlkZXJcIiwgeyBvbkFyY2dpc1NtYXJ0TWFwcGluZ1NpemVSYW5nZVNsaWRlckVycm9yOiAoZXZlbnQpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuc2l6ZVJhbmdlU2xpZGVyTm9kZSA9IG5vZGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQmFja2dyb3VuZFN0eWxlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGlmICghaXNQb2x5Z29uVHlwZShsYXllcikgfHwgW1wiY29sb3Itc2l6ZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWJhY2tncm91bmQtc3ltYm9sXCIsIG51bGwpO1xuICAgIH1cbiAgICByZW5kZXJEZWZhdWx0U3ltYm9sKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1kZWZhdWx0LXN5bWJvbFwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRTeW1ib2xOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xCZWZvcmVUb2dnbGU6ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sQ2hhbmdlOiAoKSA9PiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2hvd0luTGVnZW5kKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBsZWdlbmRPcHRpb25zID0gY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9ICFsZWdlbmRPcHRpb25zIHx8IGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCAhPT0gZmFsc2U7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJsZWdlbmQtdG9nZ2xlLXBhZGRpbmdcIiwgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgc3RyaW5ncy5wYW5lbHMuY29sb3JTaXplVW5pdmFyaWF0ZS5pbmNsdWRlSW5MZWdlbmQsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogaXNDaGVja2VkLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6ICgpID0+IHRoaXMuaGFuZGxlSW5jbHVkZUluTGVnZW5kVG9nZ2xlKCkgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVHJhbnNwYXJlbmN5KCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdHJhbnNwYXJlbmN5XCIsIHsgb3BlbjogISFvcGFjaXR5VmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFRyYW5zcGFyZW5jeUVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJyb3RhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcm90YXRpb25cIiwgeyBvcGVuOiAhb3BhY2l0eVZpc1ZhciAmJiAhIXJvdGF0aW9uVmlzVmFyLCByZWY6IChub2RlKSA9PiAodGhpcy5yb3RhdGlvbk5vZGUgPSBub2RlKSwgb25BcmNnaXNTbWFydE1hcHBpbmdSb3RhdGlvbkVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgaGFuZGxlQ29sb3JTY2hlbWVDaGFuZ2Uoc2NoZW1lKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvclNpemVVbml2YXJpYXRlUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBpc0NvbnRpbnVvdXM6IHNjaGVtZSA9PT0gXCJjb250aW51b3VzXCIgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAvLyBoYW5kbGVzIGNoZWNraW5nIHRoZSBwcmV2aW91c2x5IGNoZWNrZWQgY29sb3Igc2NoZW1lIG9wdGlvbjsgb3JkZXIgbWF0dGVycyB3aGVuIHNldHRpbmcgdGhlc2UhXG4gICAgICAgICAgICBpZiAodGhpcy5jb250aW51b3VzTm9kZS5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250aW51b3VzTm9kZS5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5iaW5hcnlOb2RlLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iaW5hcnlOb2RlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRpbnVvdXNOb2RlLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlRXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBsZWdlbmRPcHRpb25zID0gc2l6ZVZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBpZiAobGVnZW5kT3B0aW9ucyAmJiBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAobGVnZW5kT3B0aW9ucy50aXRsZSkge1xuICAgICAgICAgICAgICAgIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXplVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKF9hID0gY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZSkge1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaXplVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSBsZWdlbmRPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5sZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSBsZWdlbmRPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVVbml2YXJpYXRlLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUNzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUNzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS5jb21wYXJlLWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5hdHRyaWJ1dGUtbmFtZXt3b3JkLWJyZWFrOmJyZWFrLWFsbH0ubGVnZW5kLXRvZ2dsZS1wYWRkaW5ne3BhZGRpbmctdG9wOjEycHg7cGFkZGluZy1ib3R0b206MTJweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb21wYXJlQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUJhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUJhY2tDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb21wYXJlRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbXBhcmVFcnJvclwiLCA3KTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUNsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVySlNPTiwgb3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUNsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGlkZVJvdGF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSB0cnVlO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiA9IHJlbmRlcmVyLnRvSlNPTigpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiA9XG4gICAgICAgICAgICBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgPyBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ2V0U3RhdGlzdGljcygpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIGhpZGVMYXllclRpdGxlLCBpc1JUTCwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogIWhpZGVMYXllclRpdGxlID8gbGF5ZXIudGl0bGUgOiB1bmRlZmluZWQsIGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6IHRoaXMuaGFuZGxlRG9uZSwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbXBhcmVCYWNrQ2xpY2suZW1pdCgpLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyUm90YXRpb24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgc3RhdGUgb2YgcGFuZWwgZG9lc24ndCBwb3NpdGlvbiBidXR0b25zIGNvcnJlY3RseVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoIWxheWVyKSB7XG4gICAgICAgICAgICAvLyBsb2FkaW5nIHN0YXRlIG9mIHBhbmVsIGRvZXNuJ3QgcG9zaXRpb24gYnV0dG9ucyBjb3JyZWN0bHlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB7IHZpc3VhbGl6YXRpb25PcGVuLCBoaWRlUm90YXRpb24gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGhhc090aGVyQmxvY2tzID0gaXNQb2ludFR5cGUobGF5ZXIpICYmICFoaWRlUm90YXRpb247XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgYXV0aENvbG9yVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgZmllbGQxID0gZ2V0RmllbGQoY29sb3JWaXNWYXIuZmllbGQpO1xuICAgICAgICBjb25zdCBmaWVsZDIgPSBnZXRGaWVsZChjb2xvclZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQpO1xuICAgICAgICBjb25zdCB0aXRsZSA9IChhdXRoQ29sb3JWaXNWYXIuc3R5bGUgPT09IFwicmF0aW9cIlxuICAgICAgICAgICAgPyBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnJhdGlvVGl0bGVcbiAgICAgICAgICAgIDogYXV0aENvbG9yVmlzVmFyLnN0eWxlID09PSBcInBlcmNlbnRcIlxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuY29tcGFyZS5wZXJjZW50VGl0bGVcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucGFuZWxzLmNvbXBhcmUucGVyY2VudFRvdGFsVGl0bGUpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwkXFx7ZmllbGQxXFx9L2csIGZpZWxkMS5sYWJlbClcbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHtmaWVsZDJ9XCIsIGZpZWxkMi5sYWJlbCk7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJjb21wYXJlLWJsb2NrXCIsIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLmNvbXBhcmUuY29tcGFyZVN0eWxlLCBjb2xsYXBzaWJsZTogaGFzT3RoZXJCbG9ja3MsIG9wZW46IHZpc3VhbGl6YXRpb25PcGVuLCBvbkNhbGNpdGVCbG9ja09wZW46ICgpID0+ICh0aGlzLnZpc3VhbGl6YXRpb25PcGVuID0gdHJ1ZSksIG9uQ2FsY2l0ZUJsb2NrQ2xvc2U6ICgpID0+ICh0aGlzLnZpc3VhbGl6YXRpb25PcGVuID0gZmFsc2UpIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRpdGxlKSwgdGhpcy5yZW5kZXJTeW1ib2woKSwgdGhpcy5yZW5kZXJDb2xvclNsaWRlcigpLCB0aGlzLnJlbmRlckxhYmVscygpLCB0aGlzLnJlbmRlckNlbnRlckF0KCksIHRoaXMucmVuZGVyRGVmYXVsdFN5bWJvbCgpLCB0aGlzLnJlbmRlclNob3dJbkxlZ2VuZCgpKSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgY2xhc3NCcmVha0luZm9zID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zO1xuICAgICAgICBjb25zdCBzeW1ib2wgPSBjbGFzc0JyZWFrSW5mb3NbMF0uc3ltYm9sO1xuICAgICAgICBjb25zdCBjb2xvcnMgPSBjb2xvclZpc1Zhci5zdG9wcy5tYXAoKHN0b3ApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3RvcC5jb2xvci5jbG9uZSgpO1xuICAgICAgICAgICAgY29sb3IuYSA9IDE7XG4gICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgc3ltYm9sOiBzeW1ib2wsIGNvbG9yczogY29sb3JzLCB0eXBlOiBcImNvbG9yLXJhbXBcIiwgcmFtcFR5cGU6IFwiY29udGludW91c1wiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xCdXR0b25Ob2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMucm90YXRpb25Ob2RlKTtcbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2xvclNsaWRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctY29sb3Itc2xpZGVyXCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdDb2xvclNsaWRlckNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdXNlUGVyY2VudCA9IGF1dGhDb2xvclZpc1ZhciA/IGF1dGhDb2xvclZpc1Zhci5zdHlsZSA9PT0gXCJwZXJjZW50XCIgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zdCB1c2VQZXJjZW50VG90YWwgPSBhdXRoQ29sb3JWaXNWYXJcbiAgICAgICAgICAgICAgICAgICAgPyBhdXRoQ29sb3JWaXNWYXIuc3R5bGUgPT09IFwicGVyY2VudC1vZi10b3RhbFwiXG4gICAgICAgICAgICAgICAgICAgIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMF0ubGFiZWwgPSBgPCAke3RoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzBdLnZhbHVlLCB1c2VQZXJjZW50LCB1c2VQZXJjZW50VG90YWwpfWA7XG4gICAgICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMl0ubGFiZWwgPSBgJHt0aGlzLmdldFN0b3BMYWJlbChjb2xvclZpc1Zhci5zdG9wc1syXS52YWx1ZSwgdXNlUGVyY2VudCwgdXNlUGVyY2VudFRvdGFsKX1gO1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzWzRdLmxhYmVsID0gYD4gJHt0aGlzLmdldFN0b3BMYWJlbChjb2xvclZpc1Zhci5zdG9wc1s0XS52YWx1ZSwgdXNlUGVyY2VudCwgdXNlUGVyY2VudFRvdGFsKX1gO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlZ21lbnRlZENvbnRyb2xOb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xvclZpc1Zhci5zdG9wc1syXS52YWx1ZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcXVhbE5vZGUuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF2ZXJhZ2VOb2RlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1YWxOb2RlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXZlcmFnZU5vZGUuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2xpZGVyRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb21wYXJlRXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyTGFiZWxzKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gYXV0aENvbG9yVmlzVmFyID8gYXV0aENvbG9yVmlzVmFyLnN0eWxlIDogdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmNvbXBhcmUubGFiZWxzLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyB3aWR0aDogXCJmdWxsXCIsIHJvbGU6IFwiYnV0dG9uXCIsIGxhYmVsOiBzdHJpbmdzLnBhbmVscy5jb21wYXJlLmxhYmVscywgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlTGFiZWxDaGFuZ2UoZXZlbnQpIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnJhdGlvTGFiZWwsIGxhYmVsOiBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnJhdGlvTGFiZWwsIHNlbGVjdGVkOiBzdHlsZSA9PT0gXCJyYXRpb1wiIH0pLCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogc3RyaW5ncy5wYW5lbHMuY29tcGFyZS5wZXJjZW50VG90YWxMYWJlbCwgbGFiZWw6IHN0cmluZ3MucGFuZWxzLmNvbXBhcmUucGVyY2VudFRvdGFsTGFiZWwsIHNlbGVjdGVkOiBzdHlsZSA9PT0gXCJwZXJjZW50LW9mLXRvdGFsXCIgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnBlcmNlbnRMYWJlbCwgbGFiZWw6IHN0cmluZ3MucGFuZWxzLmNvbXBhcmUucGVyY2VudExhYmVsLCBzZWxlY3RlZDogc3R5bGUgPT09IFwicGVyY2VudFwiIH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJDZW50ZXJBdCgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCBzdGF0aXN0aWNzU3RhdHVzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKHN0YXRpc3RpY3NTdGF0dXMgIT09IHN0YXR1cy5TVUNDRVNTKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmICghaXNEZWZpbmVkKHN0YXRpc3RpY3MubWluKSB8fFxuICAgICAgICAgICAgIWlzRGVmaW5lZChzdGF0aXN0aWNzLm1heCkgfHxcbiAgICAgICAgICAgIHN0YXRpc3RpY3MubWluID49IDEgfHxcbiAgICAgICAgICAgIHN0YXRpc3RpY3MubWF4IDw9IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHR5cGUgPSBjb2xvclZpc1Zhci5zdG9wc1syXS52YWx1ZSA9PT0gMSA/IFwiZXF1YWxcIiA6IFwiYXZlcmFnZVwiO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmNvbXBhcmUuY2VudGVyQXQpLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbFwiLCB7IHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiZnVsbFwiLCBvbkNhbGNpdGVTZWdtZW50ZWRDb250cm9sQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNlbnRlckF0Q2hhbmdlKGV2ZW50LnRhcmdldC5zZWxlY3RlZEl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudGVkQ29udHJvbE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtc2VnbWVudGVkLWNvbnRyb2wtaXRlbVwiLCB7IGNoZWNrZWQ6IHR5cGUgPT09IFwiZXF1YWxcIiwgdmFsdWU6IFwiZXF1YWxcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1YWxOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIHN0cmluZ3MucGFuZWxzLmNvbXBhcmUuY2VudGVyRXF1YWxWYWx1ZXMpLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbC1pdGVtXCIsIHsgY2hlY2tlZDogdHlwZSA9PT0gXCJhdmVyYWdlXCIsIHZhbHVlOiBcImF2ZXJhZ2VcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXZlcmFnZU5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgc3RyaW5ncy5wYW5lbHMuY29tcGFyZS5jZW50ZXJBdmVyYWdlVmFsdWUpKSkpO1xuICAgIH1cbiAgICByZW5kZXJEZWZhdWx0U3ltYm9sKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1kZWZhdWx0LXN5bWJvbFwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRTeW1ib2xOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xCZWZvcmVUb2dnbGU6ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sQ2hhbmdlOiAoKSA9PiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2hvd0luTGVnZW5kKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBsZWdlbmRPcHRpb25zID0gY29sb3JWaXNWYXIubGVnZW5kT3B0aW9ucztcbiAgICAgICAgY29uc3QgaXNDaGVja2VkID0gIWxlZ2VuZE9wdGlvbnMgfHwgbGVnZW5kT3B0aW9ucy5zaG93TGVnZW5kICE9PSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImxlZ2VuZC10b2dnbGUtcGFkZGluZ1wiLCBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiB9LCBzdHJpbmdzLnBhbmVscy5jb21wYXJlLmluY2x1ZGVJbkxlZ2VuZCwgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgc2NhbGU6IFwic1wiLCBjaGVja2VkOiBpc0NoZWNrZWQsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKCkgPT4gdGhpcy5oYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJSb3RhdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IHJvdGF0aW9uVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInJvdGF0aW9uXCIpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1yb3RhdGlvblwiLCB7IG9wZW46ICFvcGFjaXR5VmlzVmFyICYmICEhcm90YXRpb25WaXNWYXIsIHJlZjogKG5vZGUpID0+ICh0aGlzLnJvdGF0aW9uTm9kZSA9IG5vZGUpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbXBhcmVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVMYWJlbENoYW5nZShldmVudCkge1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgY29uc3QgbmV3TGFiZWwgPSBub2RlLnZhbHVlO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBzdHlsZSA9IG5ld0xhYmVsID09PSBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnJhdGlvTGFiZWxcbiAgICAgICAgICAgID8gXCJyYXRpb1wiXG4gICAgICAgICAgICA6IG5ld0xhYmVsID09PSBzdHJpbmdzLnBhbmVscy5jb21wYXJlLnBlcmNlbnRUb3RhbExhYmVsXG4gICAgICAgICAgICAgICAgPyBcInBlcmNlbnQtb2YtdG90YWxcIlxuICAgICAgICAgICAgICAgIDogXCJwZXJjZW50XCI7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGF1dGhDb2xvclZpc1Zhci5zdHlsZSA9IHN0eWxlO1xuICAgICAgICBpZiAoc3R5bGUgPT09IFwicGVyY2VudFwiKSB7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1swXS5sYWJlbCA9IGA8ICR7dGhpcy5nZXRTdG9wTGFiZWwoY29sb3JWaXNWYXIuc3RvcHNbMF0udmFsdWUsIHRydWUsIGZhbHNlKX1gO1xuICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMl0ubGFiZWwgPSB0aGlzLmdldFN0b3BMYWJlbChjb2xvclZpc1Zhci5zdG9wc1syXS52YWx1ZSwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbNF0ubGFiZWwgPSBgPiAke3RoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzRdLnZhbHVlLCB0cnVlLCBmYWxzZSl9YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzdHlsZSA9PT0gXCJwZXJjZW50LW9mLXRvdGFsXCIpIHtcbiAgICAgICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzWzBdLmxhYmVsID0gYDwgJHt0aGlzLmdldFN0b3BMYWJlbChjb2xvclZpc1Zhci5zdG9wc1swXS52YWx1ZSwgZmFsc2UsIHRydWUpfWA7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1syXS5sYWJlbCA9IHRoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzJdLnZhbHVlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1s0XS5sYWJlbCA9IGA+ICR7dGhpcy5nZXRTdG9wTGFiZWwoY29sb3JWaXNWYXIuc3RvcHNbNF0udmFsdWUsIGZhbHNlLCB0cnVlKX1gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMF0ubGFiZWwgPSBgPCAke3RoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzBdLnZhbHVlLCBmYWxzZSwgZmFsc2UpfWA7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1syXS5sYWJlbCA9IHRoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzJdLnZhbHVlLCBmYWxzZSwgZmFsc2UpO1xuICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbNF0ubGFiZWwgPSBgPiAke3RoaXMuZ2V0U3RvcExhYmVsKGNvbG9yVmlzVmFyLnN0b3BzWzRdLnZhbHVlLCBmYWxzZSwgZmFsc2UpfWA7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgfVxuICAgIGdldFN0b3BMYWJlbCh2YWwsIHVzZVBlcmNlbnQsIHVzZVBlcmNlbnRUb3RhbCkge1xuICAgICAgICBpZiAodXNlUGVyY2VudFRvdGFsKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5yb3VuZCgodmFsIC8gKDEgKyB2YWwpKSAqIDEwMDAwKSAvIDEwMH0lYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1c2VQZXJjZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5yb3VuZCh2YWwgKiAxMDAwMCkgLyAxMDB9JWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dmFsfWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0U3RhdGlzdGljcygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0gdGhpcy5nZXRGaWVsZEluZm8oKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IGNvbG9yVmlzVmFyXG4gICAgICAgICAgICA/IGNvbG9yVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIikgfHwge307XG4gICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRpc3RpY3MpIHtcbiAgICAgICAgICAgIG1vZHVsZXNcbiAgICAgICAgICAgICAgICAuc3VtbWFyeVN0YXRpc3RpY3Moe1xuICAgICAgICAgICAgICAgIGxheWVyLFxuICAgICAgICAgICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgICAgICB2YWx1ZUV4cHJlc3Npb246IGZpZWxkSW5mby5leHByZXNzaW9uLFxuICAgICAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZCxcbiAgICAgICAgICAgICAgICBmb3JCaW5uaW5nOiBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigoc3RhdGlzdGljcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0aXN0aWNzLmNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpZWxkIGhhcyBubyB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSB1cCBzb21lIGJhc2ljIHN0YXRpc3RpY3Mgc28gd2UgY2FuIHNob3cgYSBzbGlkZXJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2RlZmF1bHRNaW4sIGRlZmF1bHRNYXhdID0gdGhpcy5nZXREZWZhdWx0RGF0YVJhbmdlKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IGF1dGhDb2xvclZpc1Zhci5taW5TbGlkZXJWYWx1ZSB8fCBkZWZhdWx0TWluO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSBhdXRoQ29sb3JWaXNWYXIubWF4U2xpZGVyVmFsdWUgfHwgZGVmYXVsdE1heDtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGlzdGljcy5taW4gPSBtaW47XG4gICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MubWF4ID0gbWF4O1xuICAgICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzLmF2ZyA9IChtYXggKyBtaW4pIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0RlZmluZWQoYXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlID0gbWluO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlID0gbWF4O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpc0RlZmluZWQoc3RhdGlzdGljcy5hdmcpIHx8XG4gICAgICAgICAgICAgICAgICAgICFpc0RlZmluZWQoc3RhdGlzdGljcy5taW4pIHx8XG4gICAgICAgICAgICAgICAgICAgICFpc0RlZmluZWQoc3RhdGlzdGljcy5tYXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0YXRpc3RpY3MgdW51c2FibGVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0aXN0aWNzID0gdmFsaWRhdGVNaW5NYXgoc3RhdGlzdGljcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0gc3RhdGlzdGljcztcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RGVmYXVsdERhdGFSYW5nZShmaWVsZEluZm8pIHtcbiAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSkge1xuICAgICAgICAgICAgY29uc3QgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIHJldHVybiBbbmV3IERhdGUoYDEvMS8ke3llYXJ9YCkuZ2V0VGltZSgpLCBuZXcgRGF0ZShgMTIvMzEvJHt5ZWFyfWApLmdldFRpbWUoKV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gWzAsIDEwMF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RmllbGRJbmZvKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBmaWVsZCA9IGdldEZpZWxkKGNvbG9yVmlzVmFyID8gY29sb3JWaXNWYXIuZmllbGQgOiByZW5kZXJlci5maWVsZCk7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiAoY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmZpZWxkKSB8fCByZW5kZXJlci5maWVsZCxcbiAgICAgICAgICAgIGV4cHJlc3Npb246IChjb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JWaXNWYXIudmFsdWVFeHByZXNzaW9uKSB8fCByZW5kZXJlci52YWx1ZUV4cHJlc3Npb24sXG4gICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IChjb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUpIHx8IHJlbmRlcmVyLnZhbHVlRXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBmaWVsZCA/IGZpZWxkLnNpbXBsZUZpZWxkVHlwZSA6IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmaWVsZEluZm87XG4gICAgfVxuICAgIGhhbmRsZUNlbnRlckF0Q2hhbmdlKHR5cGUpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCBzdGF0aXN0aWNzU3RhdHVzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKHN0YXRpc3RpY3NTdGF0dXMgIT09IHN0YXR1cy5TVUNDRVNTKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBhdXRoQ29sb3JWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCB1c2VQZXJjZW50ID0gYXV0aENvbG9yVmlzVmFyID8gYXV0aENvbG9yVmlzVmFyLnN0eWxlID09PSBcInBlcmNlbnRcIiA6IGZhbHNlO1xuICAgICAgICBjb25zdCB1c2VQZXJjZW50VG90YWwgPSBhdXRoQ29sb3JWaXNWYXIgPyBhdXRoQ29sb3JWaXNWYXIuc3R5bGUgPT09IFwicGVyY2VudC1vZi10b3RhbFwiIDogZmFsc2U7XG4gICAgICAgIGxldCB2YWx1ZXM7XG4gICAgICAgIGlmICh0eXBlID09PSBcImF2ZXJhZ2VcIikge1xuICAgICAgICAgICAgY29uc3QgYXZnID0gc3RhdGlzdGljcy5hdmc7XG4gICAgICAgICAgICBsZXQgbWluVmFsdWUgPSBNYXRoLm1heChhdmcgLSBzdGF0aXN0aWNzLnN0ZGRldiwgc3RhdGlzdGljcy5taW4pO1xuICAgICAgICAgICAgbGV0IG1heFZhbHVlID0gTWF0aC5taW4oYXZnICsgc3RhdGlzdGljcy5zdGRkZXYsIHN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgIGlmIChzdGF0aXN0aWNzLmNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbWluVmFsdWUgPSBzdGF0aXN0aWNzLm1pbjtcbiAgICAgICAgICAgICAgICBtYXhWYWx1ZSA9IHN0YXRpc3RpY3MubWF4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWVzID0gcm91bmQoW21pblZhbHVlLCBtYXhWYWx1ZV0pO1xuICAgICAgICAgICAgbWluVmFsdWUgPSB2YWx1ZXNbMF07XG4gICAgICAgICAgICBtYXhWYWx1ZSA9IHZhbHVlc1sxXTtcbiAgICAgICAgICAgIHZhbHVlcyA9IFtcbiAgICAgICAgICAgICAgICBNYXRoLm1heChtaW5WYWx1ZSwgc3RhdGlzdGljcy5taW4pLFxuICAgICAgICAgICAgICAgIE1hdGgubWF4KG1pblZhbHVlICsgKGF2ZyAtIG1pblZhbHVlKSAvIDIsIHN0YXRpc3RpY3MubWluKSxcbiAgICAgICAgICAgICAgICBhdmcsXG4gICAgICAgICAgICAgICAgTWF0aC5taW4oYXZnICsgKG1heFZhbHVlIC0gYXZnKSAvIDIsIHN0YXRpc3RpY3MubWF4KSxcbiAgICAgICAgICAgICAgICBNYXRoLm1pbihtYXhWYWx1ZSwgc3RhdGlzdGljcy5tYXgpXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgdmFsdWVzID0gcm91bmQodmFsdWVzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBtaW5WYWx1ZSA9IE1hdGgubWF4KDEgLSBzdGF0aXN0aWNzLnN0ZGRldiwgc3RhdGlzdGljcy5taW4pO1xuICAgICAgICAgICAgbGV0IG1heFZhbHVlID0gTWF0aC5taW4oMSArIHN0YXRpc3RpY3Muc3RkZGV2LCBzdGF0aXN0aWNzLm1heCk7XG4gICAgICAgICAgICB2YWx1ZXMgPSByb3VuZChbbWluVmFsdWUsIG1heFZhbHVlXSk7XG4gICAgICAgICAgICBtaW5WYWx1ZSA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgIG1heFZhbHVlID0gdmFsdWVzWzFdO1xuICAgICAgICAgICAgdmFsdWVzID0gW1xuICAgICAgICAgICAgICAgIE1hdGgubWF4KG1pblZhbHVlLCBzdGF0aXN0aWNzLm1pbiksXG4gICAgICAgICAgICAgICAgTWF0aC5tYXgobWluVmFsdWUgKyAoMSAtIG1pblZhbHVlKSAvIDIsIHN0YXRpc3RpY3MubWluKSxcbiAgICAgICAgICAgICAgICAxLFxuICAgICAgICAgICAgICAgIE1hdGgubWluKDEgKyAobWF4VmFsdWUgLSAxKSAvIDIsIHN0YXRpc3RpY3MubWF4KSxcbiAgICAgICAgICAgICAgICBNYXRoLm1pbihtYXhWYWx1ZSwgc3RhdGlzdGljcy5tYXgpXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgdmFsdWVzID0gcm91bmQodmFsdWVzKTtcbiAgICAgICAgfVxuICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1swXS52YWx1ZSA9IHZhbHVlc1swXTtcbiAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMF0ubGFiZWwgPSBgPCAke3RoaXMuZ2V0U3RvcExhYmVsKHZhbHVlc1swXSwgdXNlUGVyY2VudCwgdXNlUGVyY2VudFRvdGFsKX1gO1xuICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1sxXS52YWx1ZSA9IHZhbHVlc1sxXTtcbiAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMV0ubGFiZWwgPSBudWxsO1xuICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1syXS52YWx1ZSA9IHZhbHVlc1syXTtcbiAgICAgICAgY29sb3JWaXNWYXIuc3RvcHNbMl0ubGFiZWwgPSB0aGlzLmdldFN0b3BMYWJlbCh2YWx1ZXNbMl0sIHVzZVBlcmNlbnQsIHVzZVBlcmNlbnRUb3RhbCk7XG4gICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzWzNdLnZhbHVlID0gdmFsdWVzWzNdO1xuICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1szXS5sYWJlbCA9IG51bGw7XG4gICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzWzRdLnZhbHVlID0gdmFsdWVzWzRdO1xuICAgICAgICBjb2xvclZpc1Zhci5zdG9wc1s0XS5sYWJlbCA9IGA+ICR7dGhpcy5nZXRTdG9wTGFiZWwodmFsdWVzWzRdLCB1c2VQZXJjZW50LCB1c2VQZXJjZW50VG90YWwpfWA7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc3ltYm9sQnV0dG9uTm9kZSk7XG4gICAgICAgIHRoaXMuc2xpZGVyTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgIH1cbiAgICBoYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IGxlZ2VuZE9wdGlvbnMgPSBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBpZiAobGVnZW5kT3B0aW9ucyAmJiBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAobGVnZW5kT3B0aW9ucy50aXRsZSkge1xuICAgICAgICAgICAgICAgIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29sb3JWaXNWYXIubGVnZW5kT3B0aW9ucyA9IGxlZ2VuZE9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbXBhcmVDc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX0uZG90LWRlbnNpdHktYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59LmhpZGRlbntkaXNwbGF5Om5vbmV9aW1ne3dpZHRoOjE2cHg7aGVpZ2h0OjE2cHh9LmxhYmVse2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMSk7cGFkZGluZy10b3A6NXB4O3BhZGRpbmctYm90dG9tOjVweH0ubGFiZWw6Zm9jdXMsLnN5bWJvbDpmb2N1c3tvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0uc2VsZWN0ZWR7b3V0bGluZToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9LnN5bWJvbHt3aWR0aDoxNnB4O2hlaWdodDoxNnB4O21hcmdpbjoycHh9LnRvcC1tYXJnaW57bWFyZ2luLWJsb2NrLXN0YXJ0OnZhcigtLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbSwgMC43NXJlbSl9LnRvcC1ncmV5LWJvcmRlcntib3JkZXItdG9wOjFweCBzb2xpZCAjZTBlMGUwfS50ZXh0LXdyYXB7b3ZlcmZsb3ctd3JhcDphbnl3aGVyZX0uZG90LXZhbHVlLWNvbnRlbnR7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0uZG90LXZhbHVlLXNsaWRlcnt3aWR0aDoxMDAlO2hlaWdodDo3MHB4O3Bvc2l0aW9uOnJlbGF0aXZlO21hcmdpbjowIGF1dG8gMTBweCBhdXRvfS5kb3QtdmFsdWUtc2xpZGVyLmVzcmktc2xpZGVyLS1ob3Jpem9udGFsIC5lc3JpLXNsaWRlcl9fdGljay1sYWJlbHtjdXJzb3I6cG9pbnRlcn0uZG90LXZhbHVlLXNsaWRlci5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWF4LC5kb3QtdmFsdWUtc2xpZGVyLnNsaWRlci1ib3R0b20tbGFiZWwgLmVzcmktc2xpZGVyX19taW57d2lkdGg6LW1vei1maXQtY29udGVudDt3aWR0aDpmaXQtY29udGVudDtwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206MTFweH0uZG90LXZhbHVlLXNsaWRlci5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWF4e3JpZ2h0OjA7dGV4dC1hbGlnbjpyaWdodH0uZG90LXZhbHVlLXNsaWRlci5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWlue2xlZnQ6MDt0ZXh0LWFsaWduOmxlZnR9LmRvdC12YWx1ZS1zbGlkZXIuZXNyaS1zbGlkZXItLWhvcml6b250YWwgLmVzcmktc2xpZGVyX19sYWJlbHt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lfS5kb3QtdmFsdWUtc2xpZGVyLmVzcmktc2xpZGVyLS1ob3Jpem9udGFsIC5lc3JpLXNsaWRlcl9fbGFiZWw6aG92ZXJ7Ym9yZGVyOjFweCBzb2xpZCAjYmJiO2JhY2tncm91bmQtY29sb3I6I2YzZjNmMzt0ZXh0LWRlY29yYXRpb246bm9uZTt6LWluZGV4OjF9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHkgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzRG90RGVuc2l0eUNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNEb3REZW5zaXR5Q2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMubGFiZWxOb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sZWdlbmRTd2F0Y2hOb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIGluZGV4OiBudWxsLFxuICAgICAgICAgICAgcG9wb3Zlck5vZGU6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51T3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5iZWZvcmVCYWNrID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRvdFZhbHVlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgdGhpcy5kb3RWYWx1ZSA9IHJlbmRlcmVyLmRvdFZhbHVlO1xuICAgICAgICBpZiAoaXNEZWZpbmVkKHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlKSkge1xuICAgICAgICAgICAgLy8gZ2V0IGRvdFZhbHVlIHRoYXQgZml0cyB0byBjdXJyZW50IG1hcCBzY2FsZVxuICAgICAgICAgICAgdGhpcy5kb3RWYWx1ZSA9IE1hdGgucm91bmQocmVuZGVyZXIuY2FsY3VsYXRlRG90VmFsdWUobWFwVmlldy5zY2FsZSkpO1xuICAgICAgICAgICAgdGhpcy50aWNrRG90VmFsdWUgPSB0aGlzLmRvdFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04gPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHRoaXMubWFwVmlld1dhdGNoSGFuZGxlID0gbW9kdWxlcy5yZWFjdGl2ZVV0aWxzLndhdGNoKCgpID0+IG1hcFZpZXcuc2NhbGUsIChuZXdTY2FsZSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihzbWFydE1hcHBpbmdTdGF0ZS5sYXllcik7XG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlKSkge1xuICAgICAgICAgICAgICAgIGxldCBuZXdEb3RWYWx1ZSA9IE1hdGgucm91bmQocmVuZGVyZXIuY2FsY3VsYXRlRG90VmFsdWUobmV3U2NhbGUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvdFZhbHVlID0gbmV3RG90VmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEb3RWYWx1ZUNoYW5nZSh0aGlzLmRvdFZhbHVlKTtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLmRvdFZhbHVlU2xpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aGlzLmRvdFZhbHVlKV1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5maXJzdEVsZW1lbnRDaGlsZC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmViZWdpblwiLCBgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIke2NvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzXCIgLz5gKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIChfYSA9IHRoaXMuZG90V2F0Y2hIYW5kbGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmUoKTtcbiAgICAgICAgKF9iID0gdGhpcy5tYXBWaWV3V2F0Y2hIYW5kbGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZW1vdmUoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGhpZGVMYXllclRpdGxlLCBpc1JUTCwgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGhpZGVMYXllclRpdGxlID8gdW5kZWZpbmVkIDogKF9hID0gbWFwSW1hZ2VTdWJsYXllciA9PT0gbnVsbCB8fCBtYXBJbWFnZVN1YmxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBJbWFnZVN1YmxheWVyLnRpdGxlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5kb3REZW5zaXR5LnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246IHRpdGxlLCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzRG90RGVuc2l0eUJhY2tDbGljay5lbWl0KCkgfSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCksIHRoaXMucmVuZGVyVmlzdWFsaXphdGlvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJKU09OLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gfSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVySlNPTiwgb3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgfSwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJkb3QtZGVuc2l0eS1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5kb3REZW5zaXR5LmRvdERlbnNpdHlTdHlsZSwgb3BlbjogdHJ1ZSB9LCB0aGlzLnJlbmRlckRvdFN0eWxlKCksIHRoaXMucmVuZGVyTGVnZW5kKCksIHRoaXMucmVuZGVyVW5pdHMoKSwgdGhpcy5yZW5kZXJEb3RWYWx1ZSgpLCB0aGlzLnJlbmRlckRvdFNpemUoKSwgdGhpcy5yZW5kZXJCYWNrZ3JvdW5kU3R5bGUoKSwgdGhpcy5yZW5kZXJPcHRpb25zKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG90U3R5bGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JzID0gcmVuZGVyZXIuYXR0cmlidXRlcy5tYXAoKGF0dHJpYnV0ZSkgPT4gYXR0cmlidXRlLmNvbG9yKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IHR5cGU6IFwiZG90LWRlbnNpdHktcmFtcFwiLCByYW1wVHlwZTogXCJkaXNjcmV0ZVwiLCBjb2xvcnM6IGNvbG9ycywgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xCdXR0b25TeW1ib2xDaGFuZ2U6ICgpID0+IGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyTGVnZW5kKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5sZWdlbmQsIGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBjbGFzczogXCJ0b3AtZ3JleS1ib3JkZXJcIiwgZHJhZ0VuYWJsZWQ6IHRydWUsIG9uQ2FsY2l0ZUxpc3RPcmRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU29ydExlZ2VuZChpdGVtcyk7XG4gICAgICAgICAgICB9IH0sIHJlbmRlcmVyLmF0dHJpYnV0ZXMubWFwKChhdHRyaWJ1dGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJMZWdlbmRJdGVtKGF0dHJpYnV0ZSwgaW5kZXgpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTGVnZW5kSXRlbShhdHRyaWJ1dGUsIGluZGV4KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMsIHNlbGVjdGVkQXR0cmlidXRlLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgdmFsdWU6IGF0dHJpYnV0ZS5maWVsZCwga2V5OiBgaXRlbS0ke2F0dHJpYnV0ZS5maWVsZH1gIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzeW1ib2xcIiwgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIHRhYkluZGV4OiAwLCByb2xlOiBcImJ1dHRvblwiLCBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5lZGl0U3ltYm9sRm9yLnJlcGxhY2UoXCIke2ZpZWxkTmFtZX1cIiwgYXR0cmlidXRlLmxhYmVsKSwgXCJhcmlhLWhhc3BvcHVwXCI6IFwidHJ1ZVwiLCBcImFyaWEtZXhwYW5kZWRcIjogc2VsZWN0ZWRBdHRyaWJ1dGUgPT0gaW5kZXgsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMucG9wb3ZlclNldHRpbmdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZWdlbmRTd2F0Y2hOb2Rlc1tpbmRleF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPT09IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5pbmRleCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuU3ltYm9sU3R5bGVyRm9yTGVnZW5kU3dhdGNoKGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuU3ltYm9sU3R5bGVyRm9yTGVnZW5kU3dhdGNoKGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5TeW1ib2xTdHlsZXJGb3JMZWdlbmRTd2F0Y2goaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLmxlZ2VuZFN3YXRjaE5vZGVzW2luZGV4XSA9IG5vZGUpIH0sIGgoXCJpbWdcIiwgeyBzcmM6IG1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyRG90RGVuc2l0eVByZXZpZXdIVE1MKHJlbmRlcmVyLCBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoW2F0dHJpYnV0ZS5jb2xvci5yLCBhdHRyaWJ1dGUuY29sb3IuZywgYXR0cmlidXRlLmNvbG9yLmJdKSwge1xuICAgICAgICAgICAgICAgIHN3YXRjaFNpemU6IDE2XG4gICAgICAgICAgICB9KS5zcmMsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSkpLCB0aGlzLnJlbmRlclRleHROb2RlKGF0dHJpYnV0ZSwgaW5kZXgpKSk7XG4gICAgfVxuICAgIHJlbmRlclRleHROb2RlKGF0dHJpYnV0ZSwgaW5kZXgpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwiZGl2XCIsIHsgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MucGFuZWxzLmRvdERlbnNpdHkuZWRpdExhYmVsRm9yLnJlcGxhY2UoXCIke2ZpZWxkTmFtZX1cIiwgYXR0cmlidXRlLmxhYmVsKSwgY2xhc3M6IFwibGFiZWwgdGV4dC13cmFwXCIsIHNsb3Q6IFwiY29udGVudFwiLCB0YWJJbmRleDogMCwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpbmRleF0uc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpbmRleF0uc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5sYWJlbE5vZGVzW2luZGV4XSA9IG5vZGUpIH0sIGF0dHJpYnV0ZS5sYWJlbCksIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgY2xhc3M6IFwiaGlkZGVuXCIsIHNsb3Q6IFwiY29udGVudFwiLCB0YWJJbmRleDogMCwgdmFsdWU6IGF0dHJpYnV0ZS5sYWJlbCwgcGxhY2Vob2xkZXI6IGF0dHJpYnV0ZS5sYWJlbCwgb25Gb2N1c291dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUxlZ2VuZEl0ZW1UZXh0Q2hhbmdlKGluZGV4LCBub2RlLnZhbHVlKTtcbiAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVMZWdlbmRJdGVtVGV4dENoYW5nZShpbmRleCwgbm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuaW5wdXROb2Rlc1tpbmRleF0gPSBub2RlKSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJVbml0cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5kb3RzUmVwcmVzZW50LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHZhbHVlOiAoKF9hID0gcmVuZGVyZXIubGVnZW5kT3B0aW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVuaXQpIHx8IFwiXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIubGVnZW5kT3B0aW9ucyA9IHJlbmRlcmVyLmxlZ2VuZE9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIubGVnZW5kT3B0aW9ucy51bml0ID0gbm9kZS52YWx1ZSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRG90VmFsdWVFcXVhdGlvbigpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckRvdFZhbHVlKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aG9yaW5nSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IHsgdGlja0RvdFZhbHVlIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIWF1dGhvcmluZ0luZm8pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNsaWRlclZhbHVlc0NoYW5nZWQgPSB0aGlzLmluaXRTbGlkZXJTdGVwcygpO1xuICAgICAgICBjb25zdCB0aWNrQ29uZmlncyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBtb2RlOiBcInBvc2l0aW9uXCIsXG4gICAgICAgICAgICAgICAgdmlzaWJsZUVsZW1lbnRzOiB7IGxhYmVsczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIGxhYmVsc1Zpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aWNrRG90VmFsdWUpXSxcbiAgICAgICAgICAgICAgICB0aWNrQ3JlYXRlZEZ1bmN0aW9uOiAoXywgdGlja0VsZW1lbnQsIGxhYmVsRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aWNrRWxlbWVudC5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEb3RWYWx1ZUNoYW5nZSh0aWNrRG90VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9hID0gdGhpcy5kb3RWYWx1ZVNsaWRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aWNrRG90VmFsdWUpXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEb3RWYWx1ZUNoYW5nZSh0aWNrRG90VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9hID0gdGhpcy5kb3RWYWx1ZVNsaWRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aWNrRG90VmFsdWUpXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgICAgICBpZiAoIXRoaXMuZG90VmFsdWVTbGlkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgbWF4OiB0aGlzLnNsaWRlclN0ZXBzLmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aGlzLmRvdFZhbHVlKV0sXG4gICAgICAgICAgICAgICAgdmlzaWJsZUVsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VMYWJlbHM6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJhbmdlTGFiZWxJbnB1dHNFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmVjaXNpb246IDAsXG4gICAgICAgICAgICAgICAgbGFiZWxJbnB1dHNFbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhYmVsRm9ybWF0RnVuY3Rpb246ICh2YWx1ZSkgPT4gdGhpcy5zbGlkZXJTdGVwc1t2YWx1ZV0sXG4gICAgICAgICAgICAgICAgaW5wdXRGb3JtYXRGdW5jdGlvbjogKHZhbHVlKSA9PiB0aGlzLnNsaWRlclN0ZXBzW3ZhbHVlXSxcbiAgICAgICAgICAgICAgICBpbnB1dFBhcnNlRnVuY3Rpb246ICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgICAgICAgICAgICAgbGV0IG51bVZhbHVlID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4obnVtVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kb3RWYWx1ZVNsaWRlci52YWx1ZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bVZhbHVlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1WYWx1ZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVyU3RlcHMuaW5kZXhPZihudW1WYWx1ZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgdGlja1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9hID0gdGhpcy5zbGlkZXJTdGVwcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnB1c2gobnVtVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9iID0gdGhpcy5zbGlkZXJTdGVwcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIChfYyA9IHRoaXMuZG90VmFsdWVTbGlkZXIpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heDogdGhpcy5zbGlkZXJTdGVwcy5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogW3RoaXMuZ2V0U2xpZGVyU3RlcHNQb3MobnVtVmFsdWUpXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2xpZGVyU3RlcHNbdGhpcy5nZXRTbGlkZXJTdGVwc1BvcyhudW1WYWx1ZSldO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGlja0NvbmZpZ3NcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmRvdFZhbHVlU2xpZGVyID0gbmV3IG1vZHVsZXMuU2xpZGVyKGNvbmZpZyk7XG4gICAgICAgICAgICAvL1RPRE86IGZpeCBpc3N1ZXMgd2l0aCBkb3Qgc2xpZGVyIGxhYmVsIGNoYW5nZVxuICAgICAgICAgICAgdGhpcy5kb3RXYXRjaEhhbmRsZSA9IHRoaXMuZG90VmFsdWVTbGlkZXIud2F0Y2goXCJ2YWx1ZXNcIiwgKHZhbHVlcykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZG90VmFsdWUgPSB0aGlzLnNsaWRlclN0ZXBzW3ZhbHVlc1swXV07XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEb3RWYWx1ZUNoYW5nZSh0aGlzLmRvdFZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gdGhpcy5kb3RWYWx1ZVNsaWRlci53YXRjaChcImxhYmVsc1wiLCAobGFiZWxzOiBzdHJpbmdbXSkgPT4ge1xuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZygnbGFiZWwgY2hhbmdlID09PicsIGxhYmVscylcbiAgICAgICAgICAgIC8vICAgdGhpcy5kb3RWYWx1ZSA9IGxhYmVscy52YWx1ZXNbMF07XG4gICAgICAgICAgICAvLyAgIHRoaXMuaGFuZGxlRG90VmFsdWVDaGFuZ2UodGhpcy5kb3RWYWx1ZSk7XG4gICAgICAgICAgICAvLyAgIHRoaXMuZG90VmFsdWVTbGlkZXI/LnNldCh7XG4gICAgICAgICAgICAvLyAgICAgdmFsdWVzOiBbdGhpcy5nZXRTbGlkZXJTdGVwc1Bvcyh0aGlzLmRvdFZhbHVlKV1cbiAgICAgICAgICAgIC8vICAgfSk7XG4gICAgICAgICAgICAvLyB9KVxuICAgICAgICAgICAgLy8gdGhpcy5kb3RWYWx1ZVNsaWRlci5vbihcInRodW1iLWNoYW5nZVwiLCAoZXZlbnQ6IF9fZXNyaS5TbGlkZXJUaHVtYkNoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCd0aHVtYiBjaGFuZ2UgZXZlbnQnLCBldmVudClcbiAgICAgICAgICAgIC8vICAgdGhpcy5kb3RWYWx1ZSA9IGV2ZW50LnZhbHVlO1xuICAgICAgICAgICAgLy8gICB0aGlzLmhhbmRsZURvdFZhbHVlQ2hhbmdlKHRoaXMuZG90VmFsdWUpO1xuICAgICAgICAgICAgLy8gICB0aGlzLmRvdFZhbHVlU2xpZGVyPy5zZXQoe1xuICAgICAgICAgICAgLy8gICAgIHZhbHVlczogW3RoaXMuZ2V0U2xpZGVyU3RlcHNQb3ModGhpcy5kb3RWYWx1ZSldXG4gICAgICAgICAgICAvLyAgIH0pO1xuICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlczogW3RoaXMuZ2V0U2xpZGVyU3RlcHNQb3ModGhpcy5kb3RWYWx1ZSldXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHNsaWRlclZhbHVlc0NoYW5nZWQgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmRvdFZhbHVlU2xpZGVyLnRpY2tDb25maWdzWzBdLnZhbHVlc1swXSAhPT0gdGlja0NvbmZpZ3NbMF0udmFsdWVzWzBdKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgICAgIG1heDogdGhpcy5zbGlkZXJTdGVwcy5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IFt0aGlzLmdldFNsaWRlclN0ZXBzUG9zKHRoaXMuZG90VmFsdWUpXSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxGb3JtYXRGdW5jdGlvbjogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zbGlkZXJTdGVwc1t2YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpY2tDb25maWdzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZG90VmFsdWVTbGlkZXIuc2V0KGNvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2hvd1NsaWRlciA9IGF1dGhvcmluZ0luZm8ubWluU2xpZGVyVmFsdWUgIT09IGF1dGhvcmluZ0luZm8ubWF4U2xpZGVyVmFsdWU7XG4gICAgICAgIGNvbnN0IGhhc0xvbmdMYWJlbHMgPSBhdXRob3JpbmdJbmZvLm1pblNsaWRlclZhbHVlLnRvU3RyaW5nKCkubGVuZ3RoID4gNSB8fFxuICAgICAgICAgICAgYXV0aG9yaW5nSW5mby5tYXhTbGlkZXJWYWx1ZS50b1N0cmluZygpLmxlbmd0aCA+IDU7XG4gICAgICAgIGlmICghc2hvd1NsaWRlcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5kb3REZW5zaXR5LmRvdFZhbHVlLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZG90LXZhbHVlLWNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IGBzbGlkZXIgZG90LXZhbHVlLXNsaWRlciAke2hhc0xvbmdMYWJlbHMgPyBcInNsaWRlci1ib3R0b20tbGFiZWxcIiA6IFwiXCJ9YCwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kb3RWYWx1ZVNsaWRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb3RWYWx1ZVNsaWRlci5jb250YWluZXIgPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGFsaWdubWVudDogXCJjZW50ZXJcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZG90VmFsdWVFcXVhdGlvbk5vZGUgPSBub2RlKSB9LCBzdHJpbmdzLnBhbmVscy5kb3REZW5zaXR5LmRvdFZhbHVlRXF1YXRpb25cbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHt2YWx1ZX1cIiwgdGhpcy5kb3RWYWx1ZS50b1N0cmluZygpKVxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke3VuaXRzfVwiLCAoKF9hID0gcmVuZGVyZXIubGVnZW5kT3B0aW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVuaXQpIHx8IFwiXCIpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG90U2l6ZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmIChtYXBJbWFnZVN1YmxheWVyICYmIGxheWVyLnZlcnNpb24gPCAxMS4xKSB7XG4gICAgICAgICAgICAvLyBub3Qgc3VwcG9ydGVkXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5kb3RTaXplKSwgaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXNsaWRlci1pbnB1dFwiLCB7IG1pbjogMC41LCBtYXg6IDQsIHZhbHVlczogW3JlbmRlcmVyLmRvdFNpemVdLCBwcmVjaXNpb246IDEsIHN1ZmZpeFRleHQ6IHN0cmluZ3MucGFuZWxzLmRvdERlbnNpdHkucHgsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU2xpZGVySW5wdXRDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RvdFNpemUgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERvdFNpemUgPSByZW5kZXJlci5kb3RTaXplO1xuICAgICAgICAgICAgICAgIGlmIChuZXdEb3RTaXplID09PSBjdXJyZW50RG90U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRvdFNpemUgPSBuZXdEb3RTaXplO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckJhY2tncm91bmRTdHlsZSgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYmFja2dyb3VuZC1zeW1ib2xcIiwgeyBvbkFyY2dpc1NtYXJ0TWFwcGluZ0JhY2tncm91bmRTeW1ib2xDaGFuZ2U6ICgpID0+IGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyT3B0aW9ucygpIHtcbiAgICAgICAgY29uc3QgeyBtYXBJbWFnZVN1YmxheWVyLCBtYXBWaWV3LCBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIsIGNsYXNzOiBcInRvcC1tYXJnaW5cIiB9LCBzdHJpbmdzLnBhbmVscy5kb3REZW5zaXR5LnZhcnlEb3RCeVNjYWxlLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlID09PSBtYXBWaWV3LnNjYWxlLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIucmVmZXJlbmNlU2NhbGUgPSBub2RlLmNoZWNrZWQgPyBtYXBWaWV3LnNjYWxlIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICB9IH0pKSwgIW1hcEltYWdlU3VibGF5ZXIgJiYgKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5ibGVuZE92ZXJsYXBwaW5nQ29sb3JzLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IHJlbmRlcmVyLmRvdEJsZW5kaW5nRW5hYmxlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRvdEJsZW5kaW5nRW5hYmxlZCA9IG5vZGUuY2hlY2tlZDtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgfSB9KSkpKSk7XG4gICAgfVxuICAgIGdldFNsaWRlclN0ZXBzUG9zKHZhbHVlKSB7XG4gICAgICAgIGxldCBpbmRleCA9IDA7XG4gICAgICAgIHRoaXMuc2xpZGVyU3RlcHMuZm9yRWFjaCgoc3RlcCwgaWR4KSA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPj0gc3RlcCkge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gaWR4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgLSB0aGlzLnNsaWRlclN0ZXBzW2luZGV4XSA+IHN0ZXAgLSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIC8vIGNsb3NlciB0byB1cHBlciB2YWx1ZVxuICAgICAgICAgICAgICAgIGluZGV4ID0gaWR4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cbiAgICBoYW5kbGVMZWdlbmRJdGVtVGV4dENoYW5nZShpbmRleCwgbGFiZWwpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBpZiAoIWxhYmVsLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IG1hdGNoaW5nSW5mbyA9IHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04uYXR0cmlidXRlcy5maW5kKChpbmZvKSA9PiBpbmZvLmZpZWxkID09PSByZW5kZXJlci5hdHRyaWJ1dGVzW2luZGV4XS5maWVsZCk7XG4gICAgICAgICAgICBsYWJlbCA9IG1hdGNoaW5nSW5mby5sYWJlbDtcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJlci5hdHRyaWJ1dGVzW2luZGV4XS5sYWJlbCA9IGxhYmVsO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIHRoaXMubGFiZWxOb2Rlc1tpbmRleF0uY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2luZGV4XS5pbm5lckhUTUwgPSBsYWJlbDtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmxhYmVsTm9kZXNbaW5kZXhdLmZvY3VzKCksIDMwMCk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZURvdFZhbHVlQ2hhbmdlKGRvdFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBsZXQgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHJlbmRlcmVyLmRvdFZhbHVlID0gTWF0aC5yb3VuZChkb3RWYWx1ZSk7XG4gICAgICAgIHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlID0gaXNEZWZpbmVkKHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlKVxuICAgICAgICAgICAgPyBtYXBWaWV3LnNjYWxlXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51cGRhdGVEb3RWYWx1ZUVxdWF0aW9uKCk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZVNvcnRMZWdlbmQoaXRlbXMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gcmVuZGVyZXIuYXR0cmlidXRlcy5tYXAoKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5jbG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaXRlbVZhbHVlcyA9IGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgIGF0dHJpYnV0ZXMuc29ydCgoYSwgYikgPT4gaXRlbVZhbHVlcy5pbmRleE9mKGEuZmllbGQpIC0gaXRlbVZhbHVlcy5pbmRleE9mKGIuZmllbGQpKTtcbiAgICAgICAgcmVuZGVyZXIuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBpbml0U2xpZGVyU3RlcHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aG9yaW5nSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IG1pbiA9IGF1dGhvcmluZ0luZm8ubWluU2xpZGVyVmFsdWU7XG4gICAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KGF1dGhvcmluZ0luZm8ubWF4U2xpZGVyVmFsdWUsIHRoaXMuZG90VmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5zbGlkZXJTdGVwcyAmJiB0aGlzLnNsaWRlclN0ZXBzLmluZGV4T2YodGhpcy5kb3RWYWx1ZSkgPiAtMSkge1xuICAgICAgICAgICAgLy8gY3VycmVudCBkb3QgdmFsdWUgaXMgb25lIG9mIHRoZSBzdGVwc1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNsaWRlckludGVydmFsQ291bnQgPSA4MDtcbiAgICAgICAgY29uc3QgZGl2aWRlciA9IDQ7XG4gICAgICAgIGNvbnN0IHJhbmdlID0gbWF4IC0gbWluO1xuICAgICAgICBsZXQgcmFuZ2VTdGVwcyA9IHJhbmdlIC8gTWF0aC5wb3coMiwgc2xpZGVySW50ZXJ2YWxDb3VudCAvIGRpdmlkZXIgLSAxKTtcbiAgICAgICAgcmFuZ2VTdGVwcyA9IE1hdGgubWF4KHJhbmdlU3RlcHMsIDEpO1xuICAgICAgICBjb25zdCBzdGVwcyA9IFttaW5dO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNsaWRlckludGVydmFsQ291bnQgLSAxOyBpKyspIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IE1hdGgucm91bmQobWluICsgTWF0aC5wb3coMiwgaSAvIGRpdmlkZXIpICogcmFuZ2VTdGVwcyk7XG4gICAgICAgICAgICBpZiAodmFsdWUgPCBtaW4gKyAoaSArIDEpKSB7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIG1vdmUgYXQgbGVhc3QgYnkgMVxuICAgICAgICAgICAgICAgIHZhbHVlID0gbWluICsgKGkgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmRvdFZhbHVlIDwgdmFsdWUgJiYgdGhpcy5kb3RWYWx1ZSA+IHN0ZXBzW3N0ZXBzLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGN1cnJlbnQgdmFsdWUgaXMgYSBzdG9wXG4gICAgICAgICAgICAgICAgc3RlcHMucHVzaCh0aGlzLmRvdFZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBtYXgpIHtcbiAgICAgICAgICAgICAgICBzdGVwcy5wdXNoKG1heCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdGVwcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNsaWRlclN0ZXBzID0gc3RlcHM7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBvcGVuU3ltYm9sU3R5bGVyRm9yTGVnZW5kU3dhdGNoKGluZGV4KSB7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgY29uc3QgbGVnZW5kU3dhdGNoTm9kZSA9IHRoaXMubGVnZW5kU3dhdGNoTm9kZXNbaW5kZXhdO1xuICAgICAgICBjb25zdCBzeW1ib2xTdHlsZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBzeW1ib2xTdHlsZXJEaXYuY2xhc3NOYW1lID0gXCJzeW1ib2wtc3R5bGVyLWRpdlwiO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IGNyZWF0ZVN5bWJvbFN0eWxlclBvcG92ZXIoe1xuICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsXG4gICAgICAgICAgICBoZWFkaW5nOiBzbWFydE1hcHBpbmdTdGF0ZS5zdHJpbmdzLnN0eWxlci5zeW1ib2xTdHlsZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gbGVnZW5kU3dhdGNoTm9kZSA9PT0gbnVsbCB8fCBsZWdlbmRTd2F0Y2hOb2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsZWdlbmRTd2F0Y2hOb2RlLmZvY3VzKCksIDMwMCk7XG4gICAgICAgICAgICBsZWdlbmRTd2F0Y2hOb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdTdHlsZXJQb3BvdmVyRGlzY29ubmVjdGVkXCIsICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIodGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUpO1xuICAgICAgICAgICAgbGVnZW5kU3dhdGNoTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgIH0pO1xuICAgICAgICBidWlsZFN5bWJvbFN0eWxlckZvckRvdERlbnNpdHlWYWx1ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEF0dHJpYnV0ZTogaW5kZXgsXG4gICAgICAgICAgICBwb3BvdmVyTm9kZTogdGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUsXG4gICAgICAgICAgICBvbkNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsZWdlbmRTd2F0Y2hOb2RlLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcbiAgICB9XG4gICAgdXBkYXRlRG90VmFsdWVFcXVhdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMuZG90VmFsdWVFcXVhdGlvbk5vZGUuaW5uZXJIVE1MID0gc3RyaW5ncy5wYW5lbHMuZG90RGVuc2l0eS5kb3RWYWx1ZUVxdWF0aW9uXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7dmFsdWV9XCIsIHRoaXMuZG90VmFsdWUudG9TdHJpbmcoKSlcbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHt1bml0c31cIiwgdGhpcy5odG1sRW5jb2RlKCgoX2EgPSByZW5kZXJlci5sZWdlbmRPcHRpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudW5pdCkgfHwgXCJcIikpO1xuICAgIH1cbiAgICBodG1sRW5jb2RlKGlucHV0KSB7XG4gICAgICAgIGNvbnN0IHRleHRBcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIpO1xuICAgICAgICB0ZXh0QXJlYS5pbm5lclRleHQgPSBpbnB1dDtcbiAgICAgICAgcmV0dXJuIHRleHRBcmVhLmlubmVySFRNTC5zcGxpdChcIjxicj5cIikuam9pbihcIlxcblwiKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHkuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNEb3REZW5zaXR5Q3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9LmhlYXRtYXAtYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59LmF0dHJpYnV0ZS1uYW1le3dvcmQtYnJlYWs6YnJlYWstYWxsfS5zbGlkZXItbGFiZWxze2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0udG9wLWJvdHRvbS1tYXJnaW4tc21hbGx7bWFyZ2luOjEwcHggMH0udG9wLW1hcmdpbi1tZWRpdW17bWFyZ2luLXRvcDoxOHB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXBDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXBFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzSGVhdG1hcEVycm9yXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzSGVhdG1hcENsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVySlNPTiwgb3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzSGVhdG1hcENsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04gPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCgpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gaGlkZUxheWVyVGl0bGUgPyB1bmRlZmluZWQgOiAoX2EgPSBtYXBJbWFnZVN1YmxheWVyID09PSBudWxsIHx8IG1hcEltYWdlU3VibGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hcEltYWdlU3VibGF5ZXIudGl0bGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLmhlYXRtYXAuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogdGl0bGUsIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6IHRoaXMuaGFuZGxlRG9uZSwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXBCYWNrQ2xpY2suZW1pdCgpLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlclZpc3VhbGl6YXRpb24oKSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgZmllbGROYW1lID0gcmVuZGVyZXIuZmllbGQgPyAoX2EgPSBnZXRGaWVsZChyZW5kZXJlci5maWVsZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYWJlbCA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNsYXNzOiBcImhlYXRtYXAtYmxvY2tcIiwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5oZWF0bWFwU3R5bGUsIG9wZW46IHRydWUgfSwgZmllbGROYW1lID8gaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJhdHRyaWJ1dGUtbmFtZVwiIH0sIGZpZWxkTmFtZSkgOiBudWxsLCB0aGlzLnJlbmRlclN5bWJvbCgpLCB0aGlzLnJlbmRlckhlYXRtYXBTbGlkZXIoKSwgdGhpcy5yZW5kZXJTb2Z0RWRnZXMoKSwgdGhpcy5yZW5kZXJJbmZsdWVuY2VWYWx1ZSgpLCB0aGlzLnJlbmRlckxvY2soKSwgdGhpcy5yZW5kZXJSZWdlbmVyYXRlKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyU3ltYm9sKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9ycyA9IHJlbmRlcmVyLmNvbG9yU3RvcHMubWFwKChjb2xvclN0b3ApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gY29sb3JTdG9wLmNvbG9yLmNsb25lKCk7XG4gICAgICAgICAgICBjb2xvci5hID0gMTtcbiAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyB0eXBlOiBcImhlYXRtYXAtcmFtcFwiLCByYW1wVHlwZTogXCJjb250aW51b3VzXCIsIGNvbG9yczogY29sb3JzLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckhlYXRtYXBTbGlkZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWhlYXRtYXAtc2xpZGVyXCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNvZnRFZGdlcygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBUT0RPOiByZXBsYWNlIGN1c3RvbSBjYWxjaXRlLWxhYmVscyBhZnRlciBjdXN0b20gbGFiZWwgcHJvcGVydGllcyBhcmVhIGFkZGVkIG9uIGNhbGNpdGUtc2xpZGVyXG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsUmVuZGVyZXIgPSBtb2R1bGVzLnJlbmRlcmVySnNvblV0aWxzLmZyb21KU09OKHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04pO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgXCIgXCIsIHN0cmluZ3MucGFuZWxzLmhlYXRtYXAuc29mdGVuRWRnZXMsIFwiIFwiKSwgaChcImNhbGNpdGUtc2xpZGVyXCIsIHsgbWluOiAwLCBtYXg6IDEsIG1pbkxhYmVsOiBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLmxlc3MsIG1heExhYmVsOiBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLm1vcmUsIHN0ZXA6IDAuMDEsIHZhbHVlOiAoKF9hID0gb3JpZ2luYWxSZW5kZXJlci5hdXRob3JpbmdJbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmFkZVJhdGlvKSB8fCAwLCBvbkNhbGNpdGVTbGlkZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RmFkZVJhdGlvID0gbm9kZS52YWx1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgICAgICAgICBpZiAoKChfYSA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mYWRlUmF0aW8pID09PSBuZXdGYWRlUmF0aW8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdSZW5kZXJlciA9IHVwZGF0ZUhlYXRtYXBSZW5kZXJlcndpdGhGYWRlKG5ld0ZhZGVSYXRpbyk7XG4gICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlcihuZXdSZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGNvbG9ycyBvbiBzbGlkZXJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgIH0gfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItbGFiZWxzXCIsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5sZXNzKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5tb3JlKSkpKTtcbiAgICB9XG4gICAgcmVuZGVySW5mbHVlbmNlVmFsdWUoKSB7XG4gICAgICAgIC8vIFRPRE86IHJlcGxhY2UgY3VzdG9tIGNhbGNpdGUtbGFiZWxzIGFmdGVyIGN1c3RvbSBsYWJlbCBwcm9wZXJ0aWVzIGFyZWEgYWRkZWQgb24gY2FsY2l0ZS1zbGlkZXJcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxSZW5kZXJlciA9IG1vZHVsZXMucmVuZGVyZXJKc29uVXRpbHMuZnJvbUpTT04odGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTik7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInRvcC1ib3R0b20tbWFyZ2luLXNtYWxsXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5hcmVhT2ZJbmZsdWVuY2UpLCBoKFwiY2FsY2l0ZS1zbGlkZXJcIiwgeyBtaW46IDEsIG1heDogNjAsIG1pbkxhYmVsOiBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLnNtYWxsZXIsIG1heExhYmVsOiBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLmxhcmdlciwgdmFsdWU6IG9yaWdpbmFsUmVuZGVyZXIucmFkaXVzIHx8IDAsIG9uQ2FsY2l0ZVNsaWRlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJhZGl1cyA9IG5vZGUudmFsdWUgfHwgMTA7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIH0gfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItbGFiZWxzXCIsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5zbWFsbGVyKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5sYXJnZXIpKSkpO1xuICAgIH1cbiAgICByZW5kZXJMb2NrKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBJbWFnZVN1YmxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKG1hcEltYWdlU3VibGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIGhpZGUgaXQgdW50aWwgTVMgc3VwcG9ydHMgbmV3IHdlYm1hcCBzcGVjXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHsgcmVmZXJlbmNlU2NhbGUgfSA9IHJlbmRlcmVyO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0b3AtbWFyZ2luLW1lZGl1bVwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5sb2NrLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6ICEhcmVmZXJlbmNlU2NhbGUsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlZmVyZW5jZVNjYWxlID0gcmVuZGVyZXIucmVmZXJlbmNlU2NhbGUgPyAwIDogbWFwVmlldy5zY2FsZTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY2l0ZVN3aXRjaE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+IGFkZFNtYXJ0TWFwcGluZ1Rvb2x0aXAodGhpcy5jYWxjaXRlU3dpdGNoTm9kZSwgc3RyaW5ncy5wYW5lbHMuaGVhdG1hcC5sb2NrSGVscCksIG9uTW91c2VPdXQ6ICgpID0+IHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAoKSwgb25Gb2N1czogKCkgPT4gYWRkU21hcnRNYXBwaW5nVG9vbHRpcCh0aGlzLmNhbGNpdGVTd2l0Y2hOb2RlLCBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLmxvY2tIZWxwKSwgb25Gb2N1c291dDogKCkgPT4gcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCgpIH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJSZWdlbmVyYXRlKCkge1xuICAgICAgICBjb25zdCB7IG1hcEltYWdlU3VibGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAobWFwSW1hZ2VTdWJsYXllcikge1xuICAgICAgICAgICAgLy8gaGlkZSBpdCB1bnRpbCBNUyBzdXBwb3J0cyBuZXcgd2VibWFwIHNwZWNcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0b3AtYm90dG9tLW1hcmdpbi1zbWFsbFwiIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVXaXRoSGVhdG1hcFN0YXRpc3RpY3MoKSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwRXJyb3IuZW1pdChlcnJvcikpO1xuICAgICAgICAgICAgfSwgbGFiZWw6IHN0cmluZ3MucGFuZWxzLmhlYXRtYXAucmVnZW5lcmF0ZSB9LCBzdHJpbmdzLnBhbmVscy5oZWF0bWFwLnJlZ2VuZXJhdGUpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzSGVhdG1hcENzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUNzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemVDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemVFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLnRpbGVOb2RlcyA9IFtdO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUNsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayA9ICh0eXBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3dOb2RlIH0gPSB0aGlzO1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInNpemVcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVRyYW5zcGFyZW5jeSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmhpZGVSb3RhdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcInByZWRvbWluYW5jZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1wcmVkb21pbmFuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmhpZGVUcmFuc3BhcmVuY3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlUm90YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFzdENsaWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXJcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04gPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZsb3dOb2RlID0gZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3dcIik7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciwgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBtYXBJbWFnZVN1YmxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBoaWRlTGF5ZXJUaXRsZSA/IHVuZGVmaW5lZCA6IChfYSA9IG1hcEltYWdlU3VibGF5ZXIgPT09IG51bGwgfHwgbWFwSW1hZ2VTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwSW1hZ2VTdWJsYXllci50aXRsZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGF5ZXIudGl0bGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogdGl0bGUsIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplQmFja0NsaWNrLmVtaXQoKSB9LCB0aGlzLnJlbmRlclByZWRvbWluYW5jZVRpbGUoKSwgdGhpcy5yZW5kZXJTaXplVGlsZSgpLCB0aGlzLnJlbmRlclRyYW5zcGFyZW5jeSgpLCB0aGlzLnJlbmRlclJvdGF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJQcmVkb21pbmFuY2VUaWxlKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10aWxlXCIsIHsgdHlwZTogXCJwcmVkb21pbmFuY2VcIiwgc2VsZWN0ZWQ6IGZhbHNlLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVTZWxlY3Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RDbGljayA9IFwicHJlZG9taW5hbmNlXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJwcmVkb21pbmFuY2VcIik7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zOiAoKSA9PiB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcInByZWRvbWluYW5jZVwiKSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGlsZU5vZGVzW1wicHJlZG9taW5hbmNlXCJdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2l6ZVRpbGUoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRpbGVcIiwgeyB0eXBlOiBcInNpemVcIiwgc2VsZWN0ZWQ6IHRoaXMubGFzdENsaWNrID09PSBcInNpemVcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSBcInNpemVcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcInNpemVcIik7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zOiAoKSA9PiB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayhcInNpemVcIiksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1tcInNpemVcIl0gPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJUcmFuc3BhcmVuY3koKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJvcGFjaXR5XCIpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10cmFuc3BhcmVuY3lcIiwgeyBvcGVuOiAhIW9wYWNpdHlWaXNWYXIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sVHJhbnNwYXJlbmN5RXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJSb3RhdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIoZ2V0UmVuZGVyZXIobGF5ZXIpLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IHJvdGF0aW9uVmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJyb3RhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcm90YXRpb25cIiwgeyBvcGVuOiAhb3BhY2l0eVZpc1ZhciAmJiAhIXJvdGF0aW9uVmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwodGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiwgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUNsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICB9LCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgZm9jdXNTZWxlY3RlZFRpbGUoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMudGlsZU5vZGVzW3RoaXMubGFzdENsaWNrXS5zZXRGb2N1cygpKSwgMzAwKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemUuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VTaXplQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBTaXplQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBTaXplRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMudGlsZU5vZGVzID0gW107XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrID0gKHR5cGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvd05vZGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwic2l6ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1zaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlVHJhbnNwYXJlbmN5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVJvdGF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwicmVsYXRpb25zaGlwXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJlbGF0aW9uc2hpcFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVRyYW5zcGFyZW5jeSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmhpZGVSb3RhdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OID0gcmVuZGVyZXIudG9KU09OKCk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uID1cbiAgICAgICAgICAgIFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmIGxheWVyLmZlYXR1cmVSZWR1Y3Rpb25cbiAgICAgICAgICAgICAgICA/IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUobGF5ZXIuZmVhdHVyZVJlZHVjdGlvbilcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5mbG93Tm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93XCIpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBoaWRlTGF5ZXJUaXRsZSA/IHVuZGVmaW5lZCA6IChfYSA9IG1hcEltYWdlU3VibGF5ZXIgPT09IG51bGwgfHwgbWFwSW1hZ2VTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwSW1hZ2VTdWJsYXllci50aXRsZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGF5ZXIudGl0bGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogdGl0bGUsIGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUNsb3NlLmVtaXQoXCJzYXZlXCIpLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVCYWNrQ2xpY2suZW1pdCgpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCksIHRoaXMucmVuZGVyUmVsYXRpb25zaGlwVGlsZSgpLCB0aGlzLnJlbmRlclNpemVUaWxlKCksIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5KCksIHRoaXMucmVuZGVyUm90YXRpb24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVDbG9zZS5lbWl0KFwic2F2ZVwiKSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwodGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiwgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUNsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICB9LCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgcmVuZGVyUmVsYXRpb25zaGlwVGlsZSgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdGlsZVwiLCB7IHR5cGU6IFwicmVsYXRpb25zaGlwXCIsIHNlbGVjdGVkOiB0aGlzLmxhc3RDbGljayA9PT0gXCJyZWxhdGlvbnNoaXBcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSBcInJlbGF0aW9uc2hpcFwiO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwicmVsYXRpb25zaGlwXCIpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlT3B0aW9uczogKCkgPT4gdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJyZWxhdGlvbnNoaXBcIiksIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVOb2Rlc1tcInJlbGF0aW9uc2hpcFwiXSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNpemVUaWxlKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10aWxlXCIsIHsgdHlwZTogXCJzaXplXCIsIHNlbGVjdGVkOiB0aGlzLmxhc3RDbGljayA9PT0gXCJzaXplXCIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZVNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdENsaWNrID0gXCJzaXplXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJzaXplXCIpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlT3B0aW9uczogKCkgPT4gdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJzaXplXCIpLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aWxlTm9kZXNbXCJzaXplXCJdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyVHJhbnNwYXJlbmN5KCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdHJhbnNwYXJlbmN5XCIsIHsgb3BlbjogISFvcGFjaXR5VmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFRyYW5zcGFyZW5jeUVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBTaXplRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJyb3RhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcm90YXRpb25cIiwgeyBvcGVuOiAhb3BhY2l0eVZpc1ZhciAmJiAhIXJvdGF0aW9uVmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICBmb2N1c1NlbGVjdGVkVGlsZSgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy50aWxlTm9kZXNbdGhpcy5sYXN0Q2xpY2tdLnNldEZvY3VzKCkpLCAzMDApO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVDc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZUNzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS5zaW1wbGUtYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZUNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZUJhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaW1wbGVFcnJvclwiLCA3KTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFJlbmRlcmVyLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIGlmIChsYXllci50eXBlID09PSBcImdlby1yc3NcIikge1xuICAgICAgICAgICAgICAgIGxheWVyLnBvaW50U3ltYm9sID0gb3JpZ2luYWxSZW5kZXJlclswXTtcbiAgICAgICAgICAgICAgICBsYXllci5saW5lU3ltYm9sID0gb3JpZ2luYWxSZW5kZXJlclsxXTtcbiAgICAgICAgICAgICAgICBsYXllci5wb2x5Z29uU3ltYm9sID0gb3JpZ2luYWxSZW5kZXJlclsyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVyLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaW1wbGVDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmIChsYXllci50eXBlID09PSBcImdlby1yc3NcIiB8fCBsYXllci50eXBlID09PSBcIndmc1wiKSB7XG4gICAgICAgICAgICAoX2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNpbXBsZS1wYW5lbC1kaXNtaXNzLWJ1dHRvblwiKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNpbXBsZS1wYW5lbFwiKS5zZXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IHRydWU7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJnZW8tcnNzXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGdlb1JTU0xheWVyID0gbGF5ZXI7XG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXIgPSBbXG4gICAgICAgICAgICAgICAgZ2VvUlNTTGF5ZXIucG9pbnRTeW1ib2wuY2xvbmUoKSxcbiAgICAgICAgICAgICAgICBnZW9SU1NMYXllci5saW5lU3ltYm9sLmNsb25lKCksXG4gICAgICAgICAgICAgICAgZ2VvUlNTTGF5ZXIucG9seWdvblN5bWJvbC5jbG9uZSgpXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXIgPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uID1cbiAgICAgICAgICAgICAgICBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGF3YWl0IGJ1aWxkRmllbGRzTGlzdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnN0eWxlcywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IGxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQmFja0NsaWNrLmVtaXQoKTtcbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICB9IH0sIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpLCB0aGlzLnJlbmRlclZpc3VhbGl6YXRpb24oKSwgdGhpcy5yZW5kZXJUcmFuc3BhcmVuY3koKSwgdGhpcy5yZW5kZXJSb3RhdGlvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKCFsYXllcikge1xuICAgICAgICAgICAgLy8gbG9hZGluZyBzdGF0ZSBvZiBwYW5lbCBkb2Vzbid0IHBvc2l0aW9uIGJ1dHRvbnMgY29ycmVjdGx5XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgc3RhdGUgb2YgcGFuZWwgZG9lc24ndCBwb3NpdGlvbiBidXR0b25zIGNvcnJlY3RseVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgcmVuZGVyVmlzdWFsaXphdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyB2aXN1YWxpemF0aW9uT3BlbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJzaW1wbGUtYmxvY2tcIiwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuc2ltcGxlLnNpbXBsZVN0eWxlLCBjb2xsYXBzaWJsZTogbGF5ZXIudHlwZSA9PT0gXCJnZW8tcnNzXCIgPyBmYWxzZSA6IGhhc051bWJlckZpZWxkKCksIG9wZW46IHZpc3VhbGl6YXRpb25PcGVuLCBvbkNhbGNpdGVCbG9ja09wZW46ICgpID0+ICh0aGlzLnZpc3VhbGl6YXRpb25PcGVuID0gdHJ1ZSksIG9uQ2FsY2l0ZUJsb2NrQ2xvc2U6ICgpID0+ICh0aGlzLnZpc3VhbGl6YXRpb25PcGVuID0gZmFsc2UpIH0sIGxheWVyLnR5cGUgPT09IFwiZ2VvLXJzc1wiID8gdGhpcy5yZW5kZXJHZW9Sc3NTeW1ib2xzKCkgOiB0aGlzLnJlbmRlclN5bWJvbCgpKSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHN5bWJvbCA9IGxheWVyLnJlbmRlcmVyXG4gICAgICAgICAgICAuc3ltYm9sO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgc3ltYm9sOiBzeW1ib2wsIHR5cGU6IFwic2ltcGxlXCIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yb3RhdGlvbk5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckdlb1Jzc1N5bWJvbHMoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCB0aGlzLnJlbmRlckdlb1Jzc1N5bWJvbChcInBvaW50XCIpLCB0aGlzLnJlbmRlckdlb1Jzc1N5bWJvbChcImxpbmVcIiksIHRoaXMucmVuZGVyR2VvUnNzU3ltYm9sKFwicG9seWdvblwiKSkpO1xuICAgIH1cbiAgICByZW5kZXJHZW9Sc3NTeW1ib2wodHlwZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgZ2VvUlNTTGF5ZXIgPSBsYXllcjtcbiAgICAgICAgbGV0IHN5bWJvbCA9IHR5cGUgPT09IFwicG9pbnRcIlxuICAgICAgICAgICAgPyBnZW9SU1NMYXllci5wb2ludFN5bWJvbFxuICAgICAgICAgICAgOiB0eXBlID09PSBcImxpbmVcIlxuICAgICAgICAgICAgICAgID8gZ2VvUlNTTGF5ZXIubGluZVN5bWJvbFxuICAgICAgICAgICAgICAgIDogZ2VvUlNTTGF5ZXIucG9seWdvblN5bWJvbDtcbiAgICAgICAgY29uc3QgbGFiZWwgPSB0eXBlID09PSBcInBvaW50XCJcbiAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuc2ltcGxlLnBvaW50U3ltYm9sU3R5bGVcbiAgICAgICAgICAgIDogdHlwZSA9PT0gXCJsaW5lXCJcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLnNpbXBsZS5saW5lU3ltYm9sU3R5bGVcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucGFuZWxzLnNpbXBsZS5wb2x5Z29uU3ltYm9sU3R5bGU7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyBzeW1ib2w6IHN5bWJvbCwgdHlwZTogdHlwZSA9PT0gXCJwb2ludFwiID8gXCJnZW8tcnNzLXBvaW50XCIgOiB0eXBlID09PSBcImxpbmVcIiA/IFwiZ2VvLXJzcy1saW5lXCIgOiBcImdlby1yc3MtcG9seWdvblwiLCBsYWJlbDogbGFiZWwsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclRyYW5zcGFyZW5jeSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRyYW5zcGFyZW5jeVwiLCB7IG9wZW46ICEhb3BhY2l0eVZpc1Zhciwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xUcmFuc3BhcmVuY3lFcnJvcjogKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlRXJyb3IuZW1pdChkZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJyb3RhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcm90YXRpb25cIiwgeyBvcGVuOiAhb3BhY2l0eVZpc1ZhciAmJiAhIXJvdGF0aW9uVmlzVmFyLCByZWY6IChub2RlKSA9PiAodGhpcy5yb3RhdGlvbk5vZGUgPSBub2RlKSwgb25BcmNnaXNTbWFydE1hcHBpbmdSb3RhdGlvbkVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaW1wbGVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlU2l6ZUNzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlU2l6ZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy50aWxlTm9kZXMgPSBbXTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIE1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrID0gKHR5cGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvd05vZGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwic2l6ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1zaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlUm90YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5oaWRlVHJhbnNwYXJlbmN5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplRXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcInR5cGVcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtdHlwZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVJvdGF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uaGlkZVRyYW5zcGFyZW5jeSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlU2l6ZUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFzdENsaWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OID0gcmVuZGVyZXIudG9KU09OKCk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uID1cbiAgICAgICAgICAgIFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmIGxheWVyLmZlYXR1cmVSZWR1Y3Rpb25cbiAgICAgICAgICAgICAgICA/IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUobGF5ZXIuZmVhdHVyZVJlZHVjdGlvbilcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5mbG93Tm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93XCIpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gaGlkZUxheWVyVGl0bGUgPyB1bmRlZmluZWQgOiAoX2EgPSBtYXBJbWFnZVN1YmxheWVyID09PSBudWxsIHx8IG1hcEltYWdlU3VibGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hcEltYWdlU3VibGF5ZXIudGl0bGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiB0aXRsZSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQmFja0NsaWNrLmVtaXQoKSwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lIH0sIHRoaXMucmVuZGVyVHlwZVRpbGUoKSwgdGhpcy5yZW5kZXJTaXplVGlsZSgpLCB0aGlzLnJlbmRlclRyYW5zcGFyZW5jeSgpLCB0aGlzLnJlbmRlclJvdGF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJUeXBlVGlsZSgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdGlsZVwiLCB7IHR5cGU6IFwidHlwZVwiLCBzZWxlY3RlZDogdGhpcy5sYXN0Q2xpY2sgPT09IFwidHlwZVwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVTZWxlY3Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RDbGljayA9IFwidHlwZVwiO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwidHlwZVwiKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZU9wdGlvbnM6ICgpID0+IHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrKFwidHlwZVwiKSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGlsZU5vZGVzW1widHlwZVwiXSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNpemVUaWxlKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10aWxlXCIsIHsgdHlwZTogXCJzaXplXCIsIHNlbGVjdGVkOiB0aGlzLmxhc3RDbGljayA9PT0gXCJzaXplXCIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nVGlsZVNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdENsaWNrID0gXCJzaXplXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJzaXplXCIpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlT3B0aW9uczogKCkgPT4gdGhpcy5oYW5kbGVPcHRpb25zQ2xpY2soXCJzaXplXCIpLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aWxlTm9kZXNbXCJzaXplXCJdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyVHJhbnNwYXJlbmN5KCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwib3BhY2l0eVwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdHJhbnNwYXJlbmN5XCIsIHsgb3BlbjogISFvcGFjaXR5VmlzVmFyLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFRyYW5zcGFyZW5jeUVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlU2l6ZUVycm9yLmVtaXQoZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3Qgcm90YXRpb25WaXNWYXIgPSBnZXRWaXNWYXIoZ2V0UmVuZGVyZXIobGF5ZXIpLCBcInJvdGF0aW9uXCIpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1yb3RhdGlvblwiLCB7IG9wZW46ICFvcGFjaXR5VmlzVmFyICYmICEhcm90YXRpb25WaXNWYXIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nUm90YXRpb25FcnJvcjogKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwodGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiwgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgfSwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIGZvY3VzU2VsZWN0ZWRUaWxlKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnRpbGVOb2Rlc1t0aGlzLmxhc3RDbGlja10uc2V0Rm9jdXMoKSksIDMwMCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNUeXBlU2l6ZS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0IGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX2ZpZWxkX3BpY2tfbGlzdCwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc19jaGFydF9zaXplLCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemUgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX2NvbG9yX3NpemUsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZVVuaXZhcmlhdGUgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX2NvbG9yX3NpemVfdW5pdmFyaWF0ZSwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfY29tcGFyZSwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzRG90RGVuc2l0eSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfZG90X2RlbnNpdHksIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXAgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX2hlYXRtYXAsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemUgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3ByZWRvbWluYW5jZV9zaXplLCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSZWxhdGlvbnNoaXBTaXplIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc19yZWxhdGlvbnNoaXBfc2l6ZSwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc19zaW1wbGUsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc190eXBlX3NpemUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctZmllbGQtcGljay1saXN0XzExLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSwgaCBhcyBnZXRSZW5kZXJlciwgZyBhcyBnZXRSZW5kZXJlclR5cGUsIFYgYXMgZmluZEhlYXRtYXBTY2hlbWUsIE8gYXMgYWRkRmllbGRzVG9PdXRGaWVsZHMgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5cbi8qKlxuICogVXBkYXRlcyB0aGUgbGF5ZXIgd2l0aCBhIEhlYXRtYXAgcmVuZGVyZXIgd2l0aCBkZWZhdWx0IHNldHRpbmdzXG4gKiBAcGFyYW0gcHJvcHM6IG11c3QgY29udGFpbiBsYXllciwgbWFwVmlldywgR2FsbGVyeUZpZWxkc1tdXG4gKiBAcGFyYW0gb3B0aW9uczogb3B0aW9uc1xuICovXG5mdW5jdGlvbiBjcmVhdGVIZWF0bWFwUmVuZGVyZXIob3B0aW9ucykge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJoZWF0bWFwXCIpIHtcbiAgICAgICAgb3B0aW9ucy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1cyB8fCByZW5kZXJlci5yYWRpdXM7XG4gICAgICAgIG9wdGlvbnMuaGVhdG1hcFNjaGVtZSA9IG9wdGlvbnMuaGVhdG1hcFNjaGVtZSB8fCBmaW5kSGVhdG1hcFNjaGVtZSgpO1xuICAgIH1cbiAgICBpZiAoKF9hID0gb3B0aW9ucy5maWVsZEluZm9zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgIGFkZEZpZWxkc1RvT3V0RmllbGRzKFtvcHRpb25zLmZpZWxkSW5mb3NbMF0uZmllbGRdKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vZHVsZXMuSGVhdG1hcENyZWF0b3IuY3JlYXRlUmVuZGVyZXIoe1xuICAgICAgICBsYXllcixcbiAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgZmllbGQ6IG9wdGlvbnMuZmllbGRJbmZvcyAmJiBvcHRpb25zLmZpZWxkSW5mb3MubGVuZ3RoID8gb3B0aW9ucy5maWVsZEluZm9zWzBdLmZpZWxkIDogbnVsbCxcbiAgICAgICAgcmFkaXVzOiBvcHRpb25zLnJhZGl1cyB8fCAxMCxcbiAgICAgICAgaGVhdG1hcFNjaGVtZTogb3B0aW9ucy5oZWF0bWFwU2NoZW1lIHx8IHVuZGVmaW5lZFxuICAgIH0pO1xufVxuLyoqXG4gKiBVcGRhdGVzIHRoZSBIZWF0bWFwIHJlbmRlcmVyIHdpdGggYSBuZXcgZmFkZVJhdGlvXG4gKiBAcGFyYW0gcHJvcHM6IG11c3QgY29udGFpbiBsYXllciwgbWFwVmlldywgR2FsbGVyeUZpZWxkc1tdXG4gKiBAcGFyYW0gZmFkZVJhdGlvOiBuZXcgdmFsdWVcbiAqL1xuZnVuY3Rpb24gdXBkYXRlSGVhdG1hcFJlbmRlcmVyd2l0aEZhZGUoZmFkZVJhdGlvKSB7XG4gICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgcmV0dXJuIG1vZHVsZXMuSGVhdG1hcENyZWF0b3IudXBkYXRlUmVuZGVyZXIoe1xuICAgICAgICByZW5kZXJlcixcbiAgICAgICAgZmFkZVJhdGlvXG4gICAgfSk7XG59XG4vKipcbiAqIFVwZGF0ZXMgdGhlIGxheWVyIHdpdGggYSBuZXcgcmFkaXVzXG4gKiBAcGFyYW0gcHJvcHM6IG11c3QgY29udGFpbiBsYXllciwgbWFwVmlldywgR2FsbGVyeUZpZWxkc1tdXG4gKiBAcGFyYW0gb3B0aW9uczogb3B0aW9uc1xuICovXG5mdW5jdGlvbiB1cGRhdGVXaXRoSGVhdG1hcFN0YXRpc3RpY3Mob3B0aW9ucykge1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAvLyB3b3JrYXJvdW5kIGZvcjogVGhpcyBleHByZXNzaW9uIGlzIG5vdCBjYWxsYWJsZS4gVHlwZSAnaGVhdG1hcFN0YXRpc3RpY3MnIGhhcyBubyBjYWxsIHNpZ25hdHVyZXMudHMoMjM0OSlcbiAgICAvL2NvbnN0IF9oZWF0bWFwU3RhdGlzdGljczogYW55ID0gbW9kdWxlcy5oZWF0bWFwU3RhdGlzdGljcztcbiAgICByZXR1cm4gbW9kdWxlc1xuICAgICAgICAuaGVhdG1hcFN0YXRpc3RpY3Moe1xuICAgICAgICBsYXllcixcbiAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgZmllbGQ6IHJlbmRlcmVyLmZpZWxkLFxuICAgICAgICByYWRpdXM6IG9wdGlvbnMucmFkaXVzIHx8IHJlbmRlcmVyLnJhZGl1cyB8fCAxMFxuICAgIH0pXG4gICAgICAgIC50aGVuKChzdGF0aXN0aWNzKSA9PiB7XG4gICAgICAgIHJlbmRlcmVyLm1pbkRlbnNpdHkgPSBzdGF0aXN0aWNzLm1pbjtcbiAgICAgICAgcmVuZGVyZXIubWF4RGVuc2l0eSA9IHN0YXRpc3RpY3MubWF4O1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0YXRpc3RpY3MpO1xuICAgIH0sIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbn1cblxuZXhwb3J0IHsgdXBkYXRlV2l0aEhlYXRtYXBTdGF0aXN0aWNzIGFzIGEsIGNyZWF0ZUhlYXRtYXBSZW5kZXJlciBhcyBjLCB1cGRhdGVIZWF0bWFwUmVuZGVyZXJ3aXRoRmFkZSBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWhlYXRtYXAtNzVmZmQ0NTIuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9