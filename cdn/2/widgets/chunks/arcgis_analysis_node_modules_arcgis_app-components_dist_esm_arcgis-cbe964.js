"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-cbe964"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-sketch_5.entry.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-sketch_5.entry.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_sketch: () => (/* binding */ ArcgisSketch),
/* harmony export */   arcgis_sketch_content: () => (/* binding */ ArcgisSketchContent),
/* harmony export */   arcgis_sketch_shortcuts: () => (/* binding */ ArcgisSketchShortcuts),
/* harmony export */   arcgis_sketch_snapping: () => (/* binding */ ArcgisSketchSnapping),
/* harmony export */   arcgis_sketch_tools: () => (/* binding */ ArcgisSketchTools)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./symbolUtils-f207d979.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolUtils-f207d979.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./fontUtil-bbe5d03d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/fontUtil-bbe5d03d.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */













const suggestedColorList = [
    "#ff4040",
    "#ff8202",
    "#faa83e",
    "#ffd159",
    "#73b566",
    "#008977",
    "#33e3c8",
    "#43abeb",
    "#4b64c9",
    "#9868ed",
    "#b055e6",
    "#db5181",
    "#e03b99",
    "#2b2b2b",
    "#bdbdbd",
    "#ffffff"
];
const savedColorList = [
    "#ffffff",
    "#bdbdbd",
    "#2b2b2b",
    "#e03b99",
    "#db5181",
    "#b055e6",
    "#9868ed",
    "#4b64c9",
    "#43abeb",
    "#33e3c8",
    "#008977",
    "#73b566",
    "#ffd159",
    "#faa83e",
    "#ff8202",
    "#ff4040"
];

function getGeometryTypeFromGraphic(currGraphic) {
    var _a, _b;
    switch ((_a = currGraphic === null || currGraphic === void 0 ? void 0 : currGraphic.geometry) === null || _a === void 0 ? void 0 : _a.type) {
        case "point":
            if (((_b = currGraphic === null || currGraphic === void 0 ? void 0 : currGraphic.symbol) === null || _b === void 0 ? void 0 : _b.type) === "text") {
                return "text";
            }
            else {
                return "point";
            }
        case "polyline":
            return "polyline";
        default:
            return "polygon";
    }
}

const saveSnappingToStorage = (snappingOptions, currentSnappingSessionStorageId) => {
    // get enabled layers and save object in session storage
    const featureSourcesIds = [
        ...new Set([...snappingOptions.featureSources.filter((source) => source.enabled).map((source) => source.layer.id)])
    ];
    const snappingObject = {
        enabled: snappingOptions.enabled,
        selfEnabled: snappingOptions.selfEnabled,
        featureEnabled: snappingOptions.featureEnabled,
        featureSourcesIds: featureSourcesIds
    };
    (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.a)(currentSnappingSessionStorageId, snappingObject, true);
};
const getSnappingOptions = (snappingSessionStorageIds, layer, mapView, SnappingOptions) => {
    const snapping = getSnappingFromStorage(snappingSessionStorageIds) || {
        enabled: true,
        selfEnabled: true,
        featureEnabled: true,
        featureSourcesIds: [layer.id]
    };
    return new SnappingOptions({
        enabled: snapping.enabled,
        selfEnabled: snapping.selfEnabled,
        featureEnabled: snapping.featureEnabled,
        featureSources: getFeatureSourcesFromLayerIds(mapView, snapping.featureSourcesIds)
    });
};
const getFeatureSourcesFromLayerIds = (mapView, layerIds) => {
    const featureSources = [];
    layerIds.forEach((layerId) => {
        mapView.map.allLayers.toArray().find((layer) => {
            if ((layer === null || layer === void 0 ? void 0 : layer.type) === "map-notes" && layer.id === layerId) {
                featureSources.push({ layer, enabled: true });
            }
        });
    });
    return featureSources;
};
const getSnappingFromStorage = (snappingSessionStorageIds) => {
    if (snappingSessionStorageIds) {
        return ((0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.b)(snappingSessionStorageIds.webmap, true) ||
            (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.b)(snappingSessionStorageIds.current, true) ||
            null);
    }
    return null;
};

class SVModel {
    constructor(mapNotesLayer, mapView, SketchViewModel, snappingOptions, tooltipOptions, onGraphicCreate, onGraphicUpdate) {
        this.mapNotesLayer = mapNotesLayer;
        this.mapView = mapView;
        // point
        this.sketchViewModelPoint = new SketchViewModel({
            layer: this.mapNotesLayer.pointLayer,
            view: this.mapView,
            defaultCreateOptions: { hasZ: false, mode: "hybrid" },
            updateOnGraphicClick: false,
            defaultUpdateOptions: { multipleSelectionEnabled: false },
            snappingOptions,
            tooltipOptions
        });
        this.sketchViewModelPoint.on("create", (event) => onGraphicCreate(event, this.sketchViewModelPoint));
        this.sketchViewModelPoint.on("update", (event) => onGraphicUpdate(event));
        // line
        this.sketchViewModelLine = new SketchViewModel({
            layer: this.mapNotesLayer.polylineLayer,
            view: this.mapView,
            defaultCreateOptions: { hasZ: false, mode: "hybrid" },
            updateOnGraphicClick: false,
            defaultUpdateOptions: { multipleSelectionEnabled: false },
            snappingOptions,
            tooltipOptions
        });
        this.sketchViewModelLine.on("create", (event) => onGraphicCreate(event, this.sketchViewModelLine));
        this.sketchViewModelLine.on("update", (event) => onGraphicUpdate(event));
        // polygon
        this.sketchViewModelPolygon = new SketchViewModel({
            layer: this.mapNotesLayer.polygonLayer,
            view: this.mapView,
            defaultCreateOptions: { hasZ: false, mode: "hybrid" },
            updateOnGraphicClick: false,
            defaultUpdateOptions: { multipleSelectionEnabled: false },
            snappingOptions,
            tooltipOptions
        });
        this.sketchViewModelPolygon.on("create", (event) => onGraphicCreate(event, this.sketchViewModelPolygon));
        this.sketchViewModelPolygon.on("update", (event) => onGraphicUpdate(event));
        // text
        this.sketchViewModelText = new SketchViewModel({
            layer: this.mapNotesLayer.textLayer,
            view: this.mapView,
            defaultCreateOptions: { hasZ: false, mode: "hybrid" },
            updateOnGraphicClick: false,
            defaultUpdateOptions: { multipleSelectionEnabled: false },
            snappingOptions,
            tooltipOptions
        });
        this.sketchViewModelText.on("create", (event) => onGraphicCreate(event, this.sketchViewModelText));
        this.sketchViewModelText.on("update", (event) => onGraphicUpdate(event));
    }
    delete() {
        this._deletePoint();
        this._deleteLine();
        this._deletePolygon();
        this._deleteText();
    }
    cancel() {
        this._cancelPoint();
        this._cancelLine();
        this._cancelPolygon();
        this._cancelText();
    }
    duplicate() {
        this._duplicatePoint();
        this._duplicateLine();
        this._duplicatePolygon();
        this._duplicateText();
    }
    updateOnGraphic(hitTest, update) {
        var _a;
        (_a = this.hitTestHandle) === null || _a === void 0 ? void 0 : _a.remove();
        if (hitTest) {
            this.hitTestHandle = this.mapView.on("click", async (event) => {
                const hitTestResults = await this.mapView.hitTest(event, {
                    include: this.mapNotesLayer
                });
                const results = hitTestResults.results;
                if (results.length) {
                    // sort by hit test order and choose the 1st result
                    const order = ["point", "polyline", "polygon"];
                    results.sort(function (a, b) {
                        return order.indexOf(a.graphic.geometry.type) - order.indexOf(b.graphic.geometry.type);
                    });
                    const currGraphic = results[0].graphic;
                    switch (currGraphic.layer) {
                        case this.mapNotesLayer.pointLayer:
                            this.updatePoint([currGraphic]);
                            break;
                        case this.mapNotesLayer.textLayer:
                            this.updateText([currGraphic]);
                            break;
                        case this.mapNotesLayer.polylineLayer:
                            this.updateLine([currGraphic]);
                            break;
                        case this.mapNotesLayer.polygonLayer:
                            this.updatePolygon([currGraphic]);
                        default:
                            return;
                    }
                }
                else {
                    if (update) {
                        update({ state: "complete" });
                    }
                }
            });
        }
    }
    destroy() {
        this._destroyPoint();
        this._destroyLine();
        this._destroyPolygon();
        this._destroyText();
    }
    getPointSVM() {
        return this.sketchViewModelPoint;
    }
    getPoint() {
        return this.sketchViewModelPoint.pointSymbol;
    }
    setPoint(symbol) {
        this.sketchViewModelPoint.pointSymbol = symbol;
    }
    createPoint() {
        this.sketchViewModelPoint.create("point");
    }
    updatePoint(graphics) {
        this.sketchViewModelPoint.update(graphics);
    }
    _deletePoint() {
        this.sketchViewModelPoint.delete();
    }
    _cancelPoint() {
        this.sketchViewModelPoint.cancel();
    }
    _duplicatePoint() {
        this.sketchViewModelPoint.duplicate();
    }
    _destroyPoint() {
        this.sketchViewModelPoint.destroy();
    }
    // line
    getLineSVM() {
        return this.sketchViewModelLine;
    }
    getLine() {
        return this.sketchViewModelLine.polylineSymbol;
    }
    setLine(symbol) {
        this.sketchViewModelLine.polylineSymbol = symbol;
    }
    createLine() {
        this.sketchViewModelLine.create("polyline");
    }
    updateLine(graphics) {
        this.sketchViewModelLine.update(graphics);
    }
    _deleteLine() {
        this.sketchViewModelLine.delete();
    }
    _cancelLine() {
        this.sketchViewModelLine.cancel();
    }
    _duplicateLine() {
        this.sketchViewModelLine.duplicate();
    }
    _destroyLine() {
        this.sketchViewModelLine.destroy();
    }
    // polygon
    getPolygonSVM() {
        return this.sketchViewModelPolygon;
    }
    getPolygon() {
        return this.sketchViewModelPolygon.polygonSymbol;
    }
    setPolygon(symbol) {
        this.sketchViewModelPolygon.polygonSymbol = symbol;
    }
    createPolygon(tool) {
        this.sketchViewModelPolygon.create(tool);
    }
    updatePolygon(graphics) {
        this.sketchViewModelPolygon.update(graphics);
    }
    _deletePolygon() {
        this.sketchViewModelPolygon.delete();
    }
    _cancelPolygon() {
        this.sketchViewModelPolygon.cancel();
    }
    _duplicatePolygon() {
        this.sketchViewModelPolygon.duplicate();
    }
    _destroyPolygon() {
        this.sketchViewModelPolygon.destroy();
    }
    // text
    getTextSVM() {
        return this.sketchViewModelText;
    }
    getText() {
        return this.sketchViewModelText.pointSymbol;
    }
    setText(symbol) {
        this.sketchViewModelText.pointSymbol = symbol;
    }
    createText() {
        this.sketchViewModelText.create("point");
    }
    updateText(graphics) {
        this.sketchViewModelText.update(graphics);
    }
    _deleteText() {
        this.sketchViewModelText.delete();
    }
    _cancelText() {
        this.sketchViewModelText.cancel();
    }
    _duplicateText() {
        this.sketchViewModelText.duplicate();
    }
    _destroyText() {
        this.sketchViewModelText.destroy();
    }
}

const defaultLineSymbol = async (mapView, ColorUtils) => {
    const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
    return {
        type: "simple-line",
        color: backgroundThemeColor === "light" ? [0, 0, 0] : [255, 255, 255],
        width: 1 * 0.75
    };
};
const defaultPolygonSymbol = async (mapView, ColorUtils) => {
    const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
    return {
        type: "simple-fill",
        color: backgroundThemeColor === "light" ? [0, 0, 0, 0.25] : [255, 255, 255, 0.25],
        style: "solid",
        outline: {
            color: backgroundThemeColor === "light" ? [0, 0, 0] : [255, 255, 255],
            width: 1 * 0.75
        }
    };
};
const defaultTextSymbol = async (mapView, ColorUtils, TextSymbol, text) => {
    const backgroundColor = await ColorUtils.getBackgroundColor(mapView);
    const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
    return new TextSymbol({
        text,
        color: backgroundThemeColor === "light"
            ? [0, 0, 0]
            : backgroundThemeColor === "dark"
                ? [255, 255, 255]
                : backgroundColor || [0, 0, 0],
        haloColor: null,
        haloSize: 1 * 0.75,
        font: {
            size: 22 * 0.75,
            family: "Arial",
            weight: "bold"
        },
        lineWidth: 512
    });
};
const defaultCimSymbol = async (CIMSymbol, mapView, ColorUtils) => {
    const backgroundThemeColor = await ColorUtils.getBackgroundColorTheme(mapView);
    return new CIMSymbol({
        data: {
            type: "CIMSymbolReference",
            symbol: {
                type: "CIMPointSymbol",
                symbolLayers: [
                    {
                        type: "CIMVectorMarker",
                        enable: true,
                        colorLocked: true,
                        anchorPoint: { x: 0, y: -1.75 },
                        anchorPointUnits: "Relative",
                        size: 5.7,
                        frame: { xmin: 0, ymin: 0, xmax: 84.3, ymax: 84.3 },
                        markerGraphics: [
                            {
                                type: "CIMMarkerGraphic",
                                geometry: {
                                    rings: [
                                        [
                                            [83.2, 32.5],
                                            [84.3, 40.7],
                                            [83.8, 48.9],
                                            [81.7, 56.9],
                                            [78.1, 64.3],
                                            [73, 70.9],
                                            [66.9, 76.4],
                                            [59.7, 80.5],
                                            [51.9, 83.2],
                                            [43.7, 84.3],
                                            [35.4, 83.8],
                                            [27.4, 81.7],
                                            [20, 78],
                                            [13.4, 73],
                                            [7.9, 66.8],
                                            [3.8, 59.7],
                                            [1.1, 51.9],
                                            [0, 43.7],
                                            [0.5, 35.4],
                                            [2.6, 27.4],
                                            [6.3, 20],
                                            [11.3, 13.4],
                                            [17.5, 7.9],
                                            [24.7, 3.8],
                                            [32.5, 1.1],
                                            [39.8, 0.1],
                                            [47.1, 0.3],
                                            [54.3, 1.8],
                                            [61.1, 4.5],
                                            [67.4, 8.4],
                                            [72.9, 13.3],
                                            [77.4, 19.1],
                                            [80.9, 25.5],
                                            [83.2, 32.5]
                                        ]
                                    ]
                                },
                                symbol: {
                                    type: "CIMPolygonSymbol",
                                    symbolLayers: [
                                        {
                                            type: "CIMSolidFill",
                                            enable: true,
                                            color: backgroundThemeColor === "light" ? [242, 242, 242, 255] : [255, 255, 255, 255]
                                        }
                                    ]
                                }
                            }
                        ],
                        scaleSymbolsProportionally: true,
                        respectFrame: true,
                        rotation: 0
                    },
                    {
                        type: "CIMVectorMarker",
                        enable: true,
                        anchorPoint: { x: 0, y: -0.5 },
                        anchorPointUnits: "Relative",
                        size: 15,
                        frame: { xmin: 0, ymin: 0, xmax: 197.7, ymax: 294.7 },
                        markerGraphics: [
                            {
                                type: "CIMMarkerGraphic",
                                geometry: {
                                    rings: [
                                        [
                                            [98.9, 0],
                                            [119.4, 23.2],
                                            [139.4, 49.3],
                                            [156.8, 75.2],
                                            [171.2, 100.8],
                                            [182.4, 125.3],
                                            [190.6, 148.8],
                                            [195.7, 171.4],
                                            [197.7, 192.9],
                                            [197.7, 195.8],
                                            [197.7, 200.3],
                                            [197.6, 202.5],
                                            [197.5, 204.8],
                                            [197.3, 207.1],
                                            [197, 209.4],
                                            [196.7, 211.7],
                                            [196.4, 214.1],
                                            [196, 216.4],
                                            [195.5, 218.7],
                                            [195, 221.1],
                                            [194.4, 223.4],
                                            [193.7, 225.8],
                                            [193, 228.1],
                                            [192.2, 230.5],
                                            [191.4, 232.8],
                                            [190.5, 235.1],
                                            [189.5, 237.5],
                                            [188.5, 239.7],
                                            [187.4, 242],
                                            [186.2, 244.3],
                                            [185, 246.5],
                                            [183.7, 248.7],
                                            [182.4, 250.9],
                                            [181, 253.1],
                                            [179.5, 255.2],
                                            [178, 257.3],
                                            [176.4, 259.4],
                                            [174.7, 261.4],
                                            [173.1, 263.3],
                                            [171.3, 265.3],
                                            [169.5, 267.2],
                                            [167.7, 269],
                                            [165.8, 270.8],
                                            [163.9, 272.5],
                                            [161.9, 274.2],
                                            [159.9, 275.8],
                                            [157.8, 277.4],
                                            [155.7, 278.9],
                                            [153.6, 280.4],
                                            [151.4, 281.7],
                                            [149.2, 283.1],
                                            [147, 284.4],
                                            [144.8, 285.6],
                                            [142.5, 286.7],
                                            [140.3, 287.8],
                                            [138, 288.8],
                                            [135.7, 289.8],
                                            [133.4, 290.7],
                                            [131, 291.5],
                                            [128.7, 292.3],
                                            [126.4, 293],
                                            [124, 293.6],
                                            [121.7, 294.2],
                                            [119.4, 294.7],
                                            [117, 295.2],
                                            [114.7, 295.6],
                                            [112.4, 296],
                                            [110.1, 296.3],
                                            [107.8, 296.5],
                                            [105.5, 296.7],
                                            [103.3, 296.8],
                                            [101.1, 296.9],
                                            [98.8, 296.9],
                                            [83.1, 295.7],
                                            [67.8, 292],
                                            [53.3, 285.9],
                                            [39.9, 277.5],
                                            [28.1, 267.2],
                                            [18, 255.1],
                                            [10, 241.5],
                                            [4.2, 226.9],
                                            [0.9, 211.5],
                                            [0, 195.8],
                                            [0.1, 192.9],
                                            [2.1, 171.4],
                                            [7.2, 148.8],
                                            [15.4, 125.3],
                                            [26.6, 100.8],
                                            [41, 75.2],
                                            [58.4, 49.3],
                                            [78.4, 23.2],
                                            [98.9, 0]
                                        ]
                                    ]
                                },
                                symbol: {
                                    type: "CIMPolygonSymbol",
                                    symbolLayers: [
                                        {
                                            type: "CIMSolidFill",
                                            enable: true,
                                            color: backgroundThemeColor === "light" ? [17, 26, 40, 255] : [186, 186, 186, 255]
                                        }
                                    ]
                                }
                            }
                        ],
                        scaleSymbolsProportionally: true,
                        respectFrame: true,
                        rotation: 0
                    }
                ],
                scaleX: 1,
                angleAlignment: "Display",
                angle: 0
            }
        }
    });
};
// https://devtopia.esri.com/WebGIS/arcgis-components/blob/master/src/smartMapping/_utils/symbol.ts
function getCimOutline(sym) {
    if (!isMVCompatibleCIM(sym)) {
        return;
    }
    const symbolLayers = sym.data.symbol.symbolLayers;
    const bgSymbolLayer = symbolLayers[symbolLayers.length - 1];
    const graphic = bgSymbolLayer.markerGraphics[0];
    return graphic.symbol.symbolLayers.find((symbolLayer) => symbolLayer.type === "CIMSolidStroke");
}
function getSymbolSize(symbol) {
    if (symbol.type === "cim") {
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.getCIMSymbolSize(symbol);
    }
    else if (symbol.type === "text") {
        return symbol.font.size;
    }
    else if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(symbol.size)) {
        return symbol.size;
    }
    return symbol.width;
}
function applySymbolSize(symbol, size) {
    if (symbol.type === "cim") {
        _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.scaleCIMSymbolTo(symbol, size);
    }
    else if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(symbol.size)) {
        symbol.size = size;
    }
    else {
        const ratio = symbol.height / symbol.width;
        symbol.width = size;
        symbol.height = symbol.width * ratio;
    }
}
function getSymbolRotation(symbol) {
    if (symbol.type === "cim") {
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.getCIMSymbolRotation(symbol, true);
    }
    else if (["simple-marker", "picture-marker"].indexOf(symbol.type) > -1) {
        return symbol.angle;
    }
    return;
}
function applySymbolRotation(symbol, angle) {
    if (!(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(angle)) {
        return;
    }
    if (symbol.type === "cim") {
        _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.applyCIMSymbolRotation(symbol, angle, true);
    }
    else if (["simple-marker", "picture-marker"].indexOf(symbol.type) > -1) {
        symbol.angle = angle;
    }
}
function getSymbolColor(symbol) {
    var _a, _b;
    return (symbol === null || symbol === void 0 ? void 0 : symbol.type) === "cim"
        ? _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.Color.fromJSON((_a = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.getCIMSymbolColor(symbol)) === null || _a === void 0 ? void 0 : _a.toJSON())
        : (symbol === null || symbol === void 0 ? void 0 : symbol.type) === "simple-marker" && ["x", "cross"].indexOf(symbol === null || symbol === void 0 ? void 0 : symbol.style) > -1
            ? (_b = symbol === null || symbol === void 0 ? void 0 : symbol.outline) === null || _b === void 0 ? void 0 : _b.color
            : symbol === null || symbol === void 0 ? void 0 : symbol.color;
}
function applySymbolColor(symbol, color) {
    if (symbol.type === "picture-marker") {
        return;
    }
    if (symbol.type === "cim") {
        _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_6__.e.cimSymbolUtils.applyCIMSymbolColor(symbol, color);
    }
    else if (symbol.type === "simple-marker" && symbol.style && ["cross", "x"].indexOf(symbol.style) > -1) {
        if (!symbol.outline) {
            symbol.outline = new __esri.SimpleLineSymbol();
        }
        symbol.outline.color = color;
    }
    else {
        symbol.color = color;
    }
}
function getSymbolOutline(symbol) {
    return (symbol === null || symbol === void 0 ? void 0 : symbol.type) === "cim" ? getCimLine(symbol) : symbol === null || symbol === void 0 ? void 0 : symbol.outline;
}
function applySymbolOutline(symbol, outline) {
    if (symbol.type === "cim") {
        symbol.data.symbol.symbolLayers.forEach((symbolLayer, idx) => {
            if (symbolLayer.type === "CIMSolidStroke") {
                symbol.data.symbol.symbolLayers[idx] = outline;
            }
        });
    }
    else {
        symbol.outline = outline;
    }
}
function isMVCompatibleCIM(sym) {
    var _a, _b, _c, _d, _e, _f;
    // -	Have one symbolLayer with a stroke and a fill (CIMVectorMarker) that is not colorLocked
    // -	Have two symbolLayers with a stroke and a fill (CIMVectorMarker)
    //    The smaller (first) symbolLayer is not colorLocked
    //    The second symbolLayer must have a greater size than the first
    const symbolLayers = sym.data.symbol.symbolLayers;
    if (symbolLayers.length === 1) {
        const symbolLayer = symbolLayers[0];
        if (symbolLayer.type !== "CIMVectorMarker" || symbolLayer.colorLocked) {
            return false;
        }
        const markerGraphicLayers = (_b = (_a = symbolLayer.markerGraphics[0]) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.symbolLayers;
        return symbolLayer.markerGraphics.length === 1 && hasUnlockedFillAndStroke(markerGraphicLayers);
    }
    else if (symbolLayers.length === 2) {
        const symbolLayer1 = symbolLayers[0];
        const symbolLayer2 = symbolLayers[1];
        if (symbolLayer1.type !== "CIMVectorMarker" ||
            symbolLayer2.type !== "CIMVectorMarker" ||
            symbolLayer1.colorLocked ||
            symbolLayer1.size > symbolLayer2.size) {
            return false;
        }
        const markerGraphicLayers1 = (_d = (_c = symbolLayer1.markerGraphics[0]) === null || _c === void 0 ? void 0 : _c.symbol) === null || _d === void 0 ? void 0 : _d.symbolLayers;
        const markerGraphicLayers2 = (_f = (_e = symbolLayer2.markerGraphics[0]) === null || _e === void 0 ? void 0 : _e.symbol) === null || _f === void 0 ? void 0 : _f.symbolLayers;
        return (symbolLayer1.markerGraphics.length === 1 &&
            symbolLayer2.markerGraphics.length === 1 &&
            hasUnlockedFillAndStroke(markerGraphicLayers1) &&
            hasFillAndStroke(markerGraphicLayers2));
    }
    return false;
}
function hasUnlockedFillAndStroke(symbolLayers) {
    return hasUnlockedFill(symbolLayers) && hasStroke(symbolLayers);
}
function hasFillAndStroke(symbolLayers) {
    return hasFill(symbolLayers) && hasStroke(symbolLayers);
}
function hasFill(symbolLayers) {
    return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((symbolLayer) => symbolLayer.type === "CIMSolidFill");
}
function hasUnlockedFill(symbolLayers) {
    return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((symbolLayer) => symbolLayer.type === "CIMSolidFill" && !symbolLayer.colorLocked);
}
function hasStroke(symbolLayers) {
    return symbolLayers === null || symbolLayers === void 0 ? void 0 : symbolLayers.find((symbolLayer) => symbolLayer.type === "CIMSolidStroke");
}
function getCimLine(symbol) {
    var _a, _b, _c;
    if (symbol.type === "picture-marker") {
        return;
    }
    if (((_a = symbol.data.symbol) === null || _a === void 0 ? void 0 : _a.type) === "CIMPointSymbol") {
        return undefined;
    }
    else if (((_b = symbol.data.symbol) === null || _b === void 0 ? void 0 : _b.type) === "CIMLineSymbol") {
        return getCimLineLine(symbol);
    }
    else if (((_c = symbol.data.symbol) === null || _c === void 0 ? void 0 : _c.type) === "CIMPolygonSymbol") {
        return getCimPolygonOutline(symbol);
    }
}
function getCimLineLine(symbol) {
    const symbolLayers = symbol.data.symbol.symbolLayers;
    return symbolLayers[0];
}
function getCimPolygonOutline(symbol) {
    // Assume the top stroke layer on polygons is an outline
    const symbolLayers = symbol.data.symbol.symbolLayers;
    return symbolLayers.find((symbolLayer) => symbolLayer.type === "CIMSolidStroke");
}

const saveSketchTooltipToStorage = (tooltipOptions, currentTooltipSessionStorageId) => {
    const tooltipObject = {
        enabled: tooltipOptions.enabled
    };
    (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.a)(currentTooltipSessionStorageId, tooltipObject, true);
};
const getSketchTooltipOptions = (sketchTooltipSessionStorageIds, SketchTooltipOptions) => {
    const sketchToolip = getSketchTooltipFromStorage(sketchTooltipSessionStorageIds) || {
        enabled: false
    };
    return new SketchTooltipOptions({
        enabled: sketchToolip.enabled
    });
};
const getSketchTooltipFromStorage = (sketchTooltipSessionStorageIds) => {
    if (sketchTooltipSessionStorageIds) {
        return ((0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.b)(sketchTooltipSessionStorageIds.webmap, true) ||
            (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.b)(sketchTooltipSessionStorageIds.current, true) ||
            null);
    }
    return null;
};

const sketchStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_7__.c)({
    mapView: null,
    portal: null,
    layer: null,
    strings: null,
    currentLanguage: "",
    sketchMessage: "",
    svModel: null,
    snappingOptions: null,
    sketchTooltipOptions: null,
    snappingSessionStorageIds: null,
    sketchTooltipSessionStorageIds: null
});
const sketchState = sketchStore.state;

const arcgisSketchCss = ":host{display:flex;flex:1 1 auto;overflow:hidden}.sketch-delete-button{padding:var(--arcgis-app-cap-spacing-third)}.snapping{display:flex;padding:var(--arcgis-app-cap-spacing-half);background-color:var(--arcgis-app-background)}.sketch-message{padding:var(--arcgis-app-cap-spacing-half)}.sketch-keyboard-button{margin-right:0.3em}.multiple-selection{margin:1.3em}.multiple-selection calcite-button{margin-top:0.3em}.arcgis--rtl .sketch-keyboard-button{margin-right:unset;margin-left:0.3em}";

const ArcgisSketch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.sketchUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchUpdated", 7);
        this.arcgisSketchDismissedChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchDismissedChange", 7);
        this.arcgisSketchAddToNewSketch = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchAddToNewSketch", 7);
        this.arcgisRecentColorsUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisRecentColorsUpdate", 7);
        this.internalSketchUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalSketchUpdated", 7);
        this.closeSketchPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchPopovers", 7);
        this.closePopupPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closePopupPopovers", 7);
        this.sketchContentReRender = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchContentReRender", 7);
        this.disableSketchPanel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableSketchPanel", 7);
        this.closeSketchSnappingPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchSnappingPopovers", 7);
        this.sketchActionOnSelectFeatures = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnSelectFeatures", 7);
        this.sketchMode = "update";
        this.escKey = false;
        this.keepSelectionMessage = "";
        this.keepSelectionTool = null;
        this.deleteInProgress = false;
        this.needsMapViewHandles = false;
        this.onGraphicUpdate = (event) => {
            var _a, _b;
            if (event.state === "start") {
                this.mapView.closePopup();
                if (this.multipleSelectedGraphics.length <= 1 &&
                    this.newSketchLayerFeatures.length <= 1 &&
                    event.graphics.length === 1) {
                    this.currentSketchInfo.graphics = [event.graphics[0]];
                    this.currentSketchInfo.symbol = this.currentSketchInfo.graphics[0]
                        .symbol;
                    // if multipleSelectedGraphics is 0, coming from single select
                    !this.multipleSelectedGraphics.length &&
                        this.multipleSelectedGraphics.push(this.currentSketchInfo.graphics[0]);
                    this.currentSketchInfo.tool = getGeometryTypeFromGraphic(this.currentSketchInfo.graphics[0]);
                    this.currentSketchInfo.popup = this.currentSketchInfo.graphics[0].popupTemplate;
                    this.currentSketchInfo.title =
                        ((_a = this.currentSketchInfo.graphics[0].attributes) === null || _a === void 0 ? void 0 : _a.title) || this.defaultGraphicTitle();
                    this.sketchContentReRender.emit();
                    this.showSketchContent = true;
                }
                else if (this.multipleSelectedGraphics.length || this.newSketchLayerFeatures.length) {
                    // bulk popup actions
                    this.currentSketchInfo.graphics = this.multipleSelectedGraphics.length
                        ? this.multipleSelectedGraphics
                        : this.newSketchLayerFeatures;
                    this.currentSketchInfo.symbol = this.currentSketchInfo.graphics[0]
                        .symbol;
                    this.currentSketchInfo.tool = getGeometryTypeFromGraphic(this.currentSketchInfo.graphics[0]);
                    const firstTitle = ((_b = this.currentSketchInfo.graphics[0].attributes) === null || _b === void 0 ? void 0 : _b.title) || this.defaultGraphicTitle();
                    const identicalTitles = this.currentSketchInfo.graphics.every((graphic) => { var _a; return ((_a = graphic.attributes) === null || _a === void 0 ? void 0 : _a.title) === firstTitle; });
                    const firstPopup = this.currentSketchInfo.graphics[0].popupTemplate;
                    const identicalPopups = this.currentSketchInfo.graphics.every((graphic) => JSON.stringify(graphic.popupTemplate) === JSON.stringify(firstPopup));
                    // editing bulk items should start with an empty popup and title, unless all titles/popups align
                    this.currentSketchInfo.title = identicalTitles ? firstTitle : null;
                    this.currentSketchInfo.popup = identicalPopups ? firstPopup : null;
                    this.sketchContentReRender.emit();
                    this.showSketchContent = true;
                }
                else {
                    this.sketchMessageHandler(null);
                }
            }
            if (event.state === "complete") {
                const { keepSelectionTool } = this;
                if (!keepSelectionTool) {
                    this.currentSketchInfo.graphics = null;
                    this.multipleSelectedGraphics = [];
                    this.closeSketchPopovers.emit();
                    this.internalSketchUpdated.emit();
                    this.sketchContentReRender.emit();
                }
                else {
                    !this.deleteInProgress && this.keepSelectToolSelection();
                }
            }
        };
        this.mapView = undefined;
        this.layer = undefined;
        this.portal = undefined;
        this.dismissible = false;
        this.snappingSessionStorageIds = undefined;
        this.sketchTooltipSessionStorageIds = undefined;
        this.activeSketchTool = undefined;
        this.sketchToolsToHide = [];
        this.hideSelectionTools = false;
        this.selectedSketchFeaturesFeatures = undefined;
        this.mapNotesFeature = null;
        this.showSketchToolsOnly = false;
        this.sketchToolsReferenceElement = undefined;
        this.currentSketchInfo = {
            tool: null,
            symbol: null,
            graphics: null,
            popup: null,
            title: null,
            sourceIds: {}
        };
        this.multipleSelectedGraphics = [];
        this.newSketchLayerFeatures = [];
        this.showSketchContent = true;
    }
    // Lifecycle Methods
    async componentWillLoad() {
        var _a;
        [this.strings, this.currentLanguage] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        await this.loadAllModules();
        this.initializeSessionStorageOptions();
        this.initializeSVModel();
        sketchState.svModel = this.svModel;
        sketchState.mapView = this.mapView;
        sketchState.layer = this.layer;
        sketchState.portal = this.portal;
        sketchState.strings = this.strings;
        sketchState.currentLanguage = this.currentLanguage;
        sketchState.snappingOptions = this.snappingOptions;
        sketchState.sketchTooltipOptions = this.sketchTooltipOptions;
        sketchState.snappingSessionStorageIds = this.snappingSessionStorageIds;
        sketchState.sketchTooltipSessionStorageIds = this.sketchTooltipSessionStorageIds;
        if (this.mapNotesFeature) {
            this.selectedSketchFeaturesFeatures = [this.mapNotesFeature];
        }
        if ((_a = this.selectedSketchFeaturesFeatures) === null || _a === void 0 ? void 0 : _a.length) {
            this.multipleSelectedGraphics = this.selectedSketchFeaturesFeatures.filter((graphic) => (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(graphic));
            this.currentSketchInfo.graphics = this.multipleSelectedGraphics;
            this.updateCurrentSketchInfo();
        }
    }
    componentDidLoad() {
        if (this.needsMapViewHandles) {
            this.mapView.focus();
            this.watchDeleteOnMapView(true);
            this.watchEscapeOnMapView(true);
        }
        // disable popup in the map view
        this.mapView.popupEnabled = false;
        // sketch tools
        this.createSketchTools();
    }
    disconnectedCallback() {
        var _a;
        this.watchEscapeOnMapView(false);
        this.watchDeleteOnMapView(false);
        this.svModel.updateOnGraphic(false);
        this.removeSketchShortcuts();
        (_a = this.selectorOperation) === null || _a === void 0 ? void 0 : _a.cancel();
    }
    // Events
    arcgisSketchActiveSymbolChangeHandler() {
        this.sketchContentReRender.emit();
    }
    closeSketchPopoversHandler() {
        this.closePopupPopovers.emit();
        this.sketchMessageHandler(null);
        this.showSketchContent = false;
        this.closeSketchSnappingPopovers.emit();
        this.removeSketchShortcuts();
        this.setFocus();
    }
    closeSketchSnappingPopoversHandler() {
        if (this.sketchSnappingEl) {
            document.body.removeChild(this.sketchSnappingEl);
            this.sketchSnappingEl = null;
            this.disableSketchPanel.emit(false);
        }
        this.setFocus();
    }
    disableSketchPanelHandler(event) {
        event.stopPropagation();
        this.sketchFlowItemEl.disabled = event.detail;
    }
    internalSketchUpdatedHandler(event) {
        event.stopPropagation();
        this.sketchUpdated.emit();
    }
    sketchGraphicUpdatesHandler(event) {
        var _a, _b, _c, _d, _e;
        event.stopPropagation();
        const graphicUpdates = event.detail;
        if (graphicUpdates.update) {
            // update recent colors for CIM symbols
            if (graphicUpdates.type === "symbol" && graphicUpdates.symbolSwitchFromRecent) {
                const newColor = (_a = getSymbolColor(this.currentSketchInfo.symbol.clone())) === null || _a === void 0 ? void 0 : _a.toHex();
                if (newColor) {
                    this.arcgisRecentColorsUpdate.emit(newColor);
                }
            }
            if (this.sketchMode === "update" && ((_b = this.currentSketchInfo.graphics) === null || _b === void 0 ? void 0 : _b.length)) {
                const isBulk = this.currentSketchInfo.graphics.length > 1;
                // get basis for comparison: original symbol is the first selected symbol pre-modification
                const originalSymbol = this.currentSketchInfo.graphics[0].symbol.clone();
                const newSymbol = this.currentSketchInfo.symbol.clone();
                const originalSymbolSize = getSymbolSize(originalSymbol);
                const originalSymbolRotation = getSymbolRotation(originalSymbol);
                const originalSymbolColor = getSymbolColor(originalSymbol);
                const originalSymbolOutline = getSymbolOutline(originalSymbol);
                const originalSymbolOutlineStyle = (_c = originalSymbol.outline) === null || _c === void 0 ? void 0 : _c.style;
                const originalSymbolStrokeStyle = originalSymbol.style;
                const newSymbolSize = getSymbolSize(newSymbol);
                const newSymbolRotation = getSymbolRotation(newSymbol);
                const newSymbolColor = getSymbolColor(newSymbol);
                const newSymbolOutline = getSymbolOutline(newSymbol);
                const newSymbolOutlineStyle = (_d = newSymbol.outline) === null || _d === void 0 ? void 0 : _d.style;
                const newSymbolStrokeStyle = newSymbol.style;
                this.currentSketchInfo.graphics.forEach((graphic, idx) => {
                    if (graphicUpdates.type === "title") {
                        if (graphic.attributes) {
                            this.currentSketchInfo.graphics[idx].attributes.title = this.currentSketchInfo.title;
                        }
                        else {
                            this.currentSketchInfo.graphics[idx].attributes = {
                                title: this.currentSketchInfo.title
                            };
                        }
                    }
                    if (graphicUpdates.type === "popup") {
                        this.currentSketchInfo.graphics[idx].popupTemplate = this.currentSketchInfo.popup;
                    }
                    if (graphicUpdates.type === "symbol") {
                        if (!isBulk || graphicUpdates.symbolSwitchFromRecent) {
                            this.currentSketchInfo.graphics[idx].symbol = this.currentSketchInfo.symbol.clone();
                        }
                        else if (graphicUpdates.symbolSwitch) {
                            // if we trigger a symbol change, we want to apply some of the old symbol's attributes to the new symbol
                            const newSymbol = this.currentSketchInfo.symbol.clone();
                            const currentSymbol = this.currentSketchInfo.graphics[idx].symbol.clone();
                            if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolSize(currentSymbol)) && (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolSize(newSymbol))) {
                                applySymbolSize(newSymbol, getSymbolSize(currentSymbol));
                            }
                            if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolRotation(currentSymbol)) &&
                                (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolRotation(newSymbol))) {
                                applySymbolRotation(newSymbol, getSymbolRotation(currentSymbol));
                            }
                            if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolColor(currentSymbol)) &&
                                (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(getSymbolColor(newSymbol))) {
                                applySymbolColor(newSymbol, getSymbolColor(currentSymbol));
                            }
                            this.currentSketchInfo.graphics[idx].symbol = newSymbol;
                        }
                        else {
                            // if we did not trigger a symbol change, we want to apply some of the new symbol's attributes to the old symbol
                            const currentSymbol = this.currentSketchInfo.graphics[idx].symbol.clone();
                            const newSymbol = this.currentSketchInfo.symbol.clone();
                            if (originalSymbolSize !== newSymbolSize) {
                                applySymbolSize(currentSymbol, getSymbolSize(newSymbol));
                            }
                            if (originalSymbolRotation !== newSymbolRotation) {
                                applySymbolRotation(currentSymbol, getSymbolRotation(newSymbol));
                            }
                            if (JSON.stringify(originalSymbolColor === null || originalSymbolColor === void 0 ? void 0 : originalSymbolColor.toJSON()) !==
                                JSON.stringify(newSymbolColor === null || newSymbolColor === void 0 ? void 0 : newSymbolColor.toJSON())) {
                                const currentColor = getSymbolColor(currentSymbol);
                                const updatedColor = getSymbolColor(newSymbol);
                                const isSameColorTransparency = originalSymbolColor.a === newSymbolColor.a;
                                if (isSameColorTransparency) {
                                    currentColor.r = updatedColor.r;
                                    currentColor.g = updatedColor.g;
                                    currentColor.b = updatedColor.b;
                                }
                                else {
                                    currentColor.a = updatedColor.a;
                                }
                                applySymbolColor(currentSymbol, currentColor);
                            }
                            if (JSON.stringify(originalSymbolOutline === null || originalSymbolOutline === void 0 ? void 0 : originalSymbolOutline.toJSON()) !==
                                JSON.stringify(newSymbolOutline === null || newSymbolOutline === void 0 ? void 0 : newSymbolOutline.toJSON())) {
                                const currentOutline = getSymbolOutline(currentSymbol);
                                const updatedOutline = getSymbolOutline(newSymbol);
                                const isSameOutlineTransparency = (originalSymbolOutline === null || originalSymbolOutline === void 0 ? void 0 : originalSymbolOutline.color.a) === (newSymbolOutline === null || newSymbolOutline === void 0 ? void 0 : newSymbolOutline.color.a);
                                const isSameOutlineWidth = (originalSymbolOutline === null || originalSymbolOutline === void 0 ? void 0 : originalSymbolOutline.width) === (newSymbolOutline === null || newSymbolOutline === void 0 ? void 0 : newSymbolOutline.width);
                                if (!isSameOutlineWidth) {
                                    currentOutline.width = updatedOutline.width;
                                }
                                else {
                                    if (isSameOutlineTransparency) {
                                        currentOutline.color.r = updatedOutline.color.r;
                                        currentOutline.color.g = updatedOutline.color.g;
                                        currentOutline.color.b = updatedOutline.color.b;
                                    }
                                    else {
                                        currentOutline.color.a = updatedOutline.color.a;
                                    }
                                }
                                applySymbolOutline(currentSymbol, currentOutline);
                            }
                            if (JSON.stringify(originalSymbolOutlineStyle) !== JSON.stringify(newSymbolOutlineStyle)) {
                                if (currentSymbol.outline) {
                                    currentSymbol.outline.style = newSymbolOutlineStyle;
                                }
                            }
                            if (JSON.stringify(originalSymbolStrokeStyle) !== JSON.stringify(newSymbolStrokeStyle)) {
                                currentSymbol.style = newSymbolStrokeStyle;
                            }
                            // text
                            if (graphicUpdates.textProp) {
                                switch (graphicUpdates.textProp) {
                                    case "text":
                                        currentSymbol.text = newSymbol.text;
                                        break;
                                    case "font":
                                        currentSymbol.font.family = newSymbol.font.family;
                                        currentSymbol.font.weight = newSymbol.font.weight;
                                        currentSymbol.font.style = newSymbol.font.style;
                                        break;
                                    case "font-size":
                                        currentSymbol.font.size = newSymbol.font.size;
                                        break;
                                    case "color":
                                        currentSymbol.color = newSymbol.color;
                                        break;
                                    case "rotation":
                                        currentSymbol.angle = newSymbol.angle;
                                        break;
                                    case "halo":
                                        currentSymbol.haloColor = newSymbol.haloColor;
                                        currentSymbol.haloSize = newSymbol.haloSize;
                                        break;
                                    case "halo-color":
                                        currentSymbol.haloColor = newSymbol.haloColor;
                                        break;
                                    case "halo-size":
                                        currentSymbol.haloSize = newSymbol.haloSize;
                                        break;
                                }
                            }
                            this.currentSketchInfo.graphics[idx].symbol = currentSymbol;
                        }
                    }
                });
            }
            else {
                if (this.tempCreatedGraphic) {
                    if (this.tempCreatedGraphic.attributes) {
                        this.tempCreatedGraphic.attributes.title = this.currentSketchInfo.title;
                    }
                    else {
                        this.tempCreatedGraphic.attributes = {
                            title: this.currentSketchInfo.title
                        };
                    }
                    this.tempCreatedGraphic.popupTemplate = this.currentSketchInfo.popup;
                    this.tempCreatedGraphic.symbol = this.currentSketchInfo.symbol;
                }
                if (this.currentSketchInfo.tool === "point") {
                    this.svModel.setPoint(this.currentSketchInfo.symbol);
                }
                else if (this.currentSketchInfo.tool === "text") {
                    this.svModel.setText(this.currentSketchInfo.symbol);
                }
                else if (this.currentSketchInfo.tool === "polyline") {
                    this.svModel.setLine(this.currentSketchInfo.symbol);
                }
                else if (["circle", "polygon", "rectangle"].indexOf(this.currentSketchInfo.tool) > -1) {
                    this.svModel.setPolygon(this.currentSketchInfo.symbol);
                }
            }
            // to refresh popup
            this.mapView.popup.features = [(_e = this.currentSketchInfo.graphics) === null || _e === void 0 ? void 0 : _e[0]];
        }
        if (graphicUpdates.close) {
            this.clearHighlightAndPopup();
            this.closeSketchPopovers.emit();
            this.svModel.cancel();
            this.svModel.updateOnGraphic(false);
            this.setFocus();
        }
        this.internalSketchUpdated.emit();
    }
    async sketchActionOnDrawFeaturesHandler({ detail: { tool, sketchMessage } }) {
        this.clearHighlightAndPopup();
        this.watchEscapeOnMapView(true);
        this.watchDeleteOnMapView(false);
        // close popover to reset when moving from update to continuous mode
        if (this.sketchMode === "update") {
            this.closeSketchPopovers.emit();
        }
        this.sketchMessageHandler(sketchMessage);
        this.sketchMode = "continuous";
        this.svModel.cancel();
        this.svModel.updateOnGraphic(false);
        this.tempCreatedGraphic = null;
        this.currentSketchInfo.graphics = null;
        this.currentSketchInfo.tool = tool;
        switch (tool) {
            case "point":
                this.svModel.setPoint((await defaultCimSymbol(this.CIMSymbol, this.mapView, this.ColorUtils)));
                this.currentSketchInfo.symbol = this.svModel.getPoint();
                this.svModel.createPoint();
                break;
            case "polyline":
                this.svModel.setLine(await defaultLineSymbol(this.mapView, this.ColorUtils));
                this.currentSketchInfo.symbol = this.svModel.getLine();
                this.svModel.createLine();
                break;
            case "polygon":
            case "rectangle":
            case "circle":
                this.svModel.setPolygon(await defaultPolygonSymbol(this.mapView, this.ColorUtils));
                this.currentSketchInfo.symbol = this.svModel.getPolygon();
                this.svModel.createPolygon(tool);
                break;
            case "text":
                this.svModel.setText((await defaultTextSymbol(this.mapView, this.ColorUtils, this.TextSymbol, this.strings.text)));
                this.currentSketchInfo.symbol = this.svModel.getText();
                this.svModel.createText();
                break;
        }
        this.currentSketchInfo.popup = null;
        this.currentSketchInfo.title = this.defaultGraphicTitle();
        this.sketchContentReRender.emit(tool);
        this.showSketchContent = true;
    }
    async sketchActionOnSelectFeaturesHandler({ detail: { sketchMessage, multipleSelectTool } }) {
        var _a;
        this.keepSelectionMessage = sketchMessage;
        this.keepSelectionTool = multipleSelectTool;
        this.clearHighlightAndPopup();
        this.watchEscapeOnMapView(false);
        this.watchDeleteOnMapView(false);
        this.closeSketchPopovers.emit();
        this.tempCreatedGraphic = null;
        this.currentSketchInfo.graphics = null;
        this.currentSketchInfo.symbol = null;
        this.currentSketchInfo.tool = null;
        this.multipleSelectedGraphics = [];
        this.svModel.cancel();
        this.sketchMode = "update";
        this.sketchMessageHandler(this.keepSelectionMessage);
        this.sketchContentReRender.emit();
        if (this.keepSelectionTool) {
            this.actionOnMultipleSelections(this.keepSelectionTool);
        }
        else {
            (_a = this.selectorOperation) === null || _a === void 0 ? void 0 : _a.cancel();
            this.svModel.updateOnGraphic(true);
        }
    }
    arcgisSketchPanelLoaderHandler(event) {
        event.stopPropagation();
        this.sketchFlowItemEl.loading = event.detail;
    }
    // Public Methods
    async done() {
        var _a, _b, _c;
        this.removeHighlight();
        if ((_a = this.snappingSessionStorageIds) === null || _a === void 0 ? void 0 : _a.current) {
            saveSnappingToStorage(this.snappingOptions, this.snappingSessionStorageIds.current);
        }
        if ((_b = this.sketchTooltipSessionStorageIds) === null || _b === void 0 ? void 0 : _b.current) {
            saveSketchTooltipToStorage(this.sketchTooltipOptions, this.sketchTooltipSessionStorageIds.current);
        }
        this.closeSketchPopovers.emit();
        this.svModel.destroy();
        (_c = this.sketchToolsEl) === null || _c === void 0 ? void 0 : _c.remove();
        this.sketchToolsEl = undefined;
        this.removeSketchShortcuts();
        // enable popup in the map view
        this.mapView.popupEnabled = true;
    }
    async activateLayer(layer, featuresToSelect) {
        var _a, _b;
        (_a = this.svModel) === null || _a === void 0 ? void 0 : _a.destroy();
        this.layer = layer;
        this.initializeSessionStorageOptions();
        this.initializeSVModel();
        if (featuresToSelect) {
            this.newSketchLayerFeatures = featuresToSelect.map((featureToSelect) => featureToSelect.clone());
        }
        if ((_b = this.newSketchLayerFeatures) === null || _b === void 0 ? void 0 : _b.length) {
            let tempPoint = [];
            let tempLine = [];
            let tempPolygon = [];
            let tempText = [];
            this.newSketchLayerFeatures.forEach((currGraphic) => {
                switch (getGeometryTypeFromGraphic(currGraphic)) {
                    case "polyline":
                        currGraphic.layer = this.layer.polylineLayer;
                        tempLine = [...tempLine, currGraphic];
                        break;
                    case "polygon":
                        currGraphic.layer = this.layer.polygonLayer;
                        tempPolygon = [...tempPolygon, currGraphic];
                        break;
                    case "text":
                        currGraphic.layer = this.layer.textLayer;
                        tempText = [...tempText, currGraphic];
                        break;
                    default:
                        currGraphic.layer = this.layer.pointLayer;
                        tempPoint = [...tempPoint, currGraphic];
                        break;
                }
            });
            this.currentSketchInfo.graphics = this.newSketchLayerFeatures;
            this.updateCurrentSketchInfo();
            // Timeout is required to correctly highlight graphics
            setTimeout(() => {
                tempPoint.length && this.svModel.updatePoint(tempPoint);
                tempLine.length && this.svModel.updateLine(tempLine);
                tempPolygon.length && this.svModel.updatePolygon(tempPolygon);
                tempText.length && this.svModel.updateText(tempText);
                this.sketchMode = "update";
            }, 300);
        }
    }
    async setFocus(focusId) {
        var _a;
        if (focusId === "dismiss-button") {
            (_a = this.dismissButtonEl) === null || _a === void 0 ? void 0 : _a.setFocus();
            return;
        }
    }
    async clearHighlights() {
        this.removeHighlight();
    }
    // Private Methods
    initializeSessionStorageOptions() {
        this.snappingOptions = getSnappingOptions(this.snappingSessionStorageIds, this.layer, this.mapView, this.SnappingOptions);
        this.sketchTooltipOptions = getSketchTooltipOptions(this.sketchTooltipSessionStorageIds, this.SketchTooltipOptions);
    }
    initializeSVModel() {
        this.svModel = new SVModel(this.layer, this.mapView, this.SketchViewModel, this.snappingOptions, this.sketchTooltipOptions, (event, sketchViewModel) => this.onGraphicCreate(event, sketchViewModel), this.onGraphicUpdate);
    }
    updateCurrentSketchInfo() {
        var _a;
        this.currentSketchInfo.symbol = this.currentSketchInfo.graphics[0]
            .symbol;
        this.currentSketchInfo.tool = getGeometryTypeFromGraphic(this.currentSketchInfo.graphics[0]);
        const firstTitle = ((_a = this.currentSketchInfo.graphics[0].attributes) === null || _a === void 0 ? void 0 : _a.title) || this.defaultGraphicTitle();
        const identicalTitles = this.currentSketchInfo.graphics.every((graphic) => { var _a; return ((_a = graphic.attributes) === null || _a === void 0 ? void 0 : _a.title) === firstTitle; });
        const firstPopup = this.currentSketchInfo.graphics[0].popupTemplate;
        const identicalPopups = this.currentSketchInfo.graphics.every((graphic) => JSON.stringify(graphic.popupTemplate) === JSON.stringify(firstPopup));
        // editing bulk items should start with an empty popup and title, unless all titles/popups align
        this.currentSketchInfo.title = identicalTitles ? firstTitle : null;
        this.currentSketchInfo.popup = identicalPopups ? firstPopup : null;
        this.showSketchContent = true;
        this.svModel.updateOnGraphic(true, this.onGraphicUpdate);
        this.needsMapViewHandles = true;
    }
    async updateSketchTools() {
        if (this.sketchToolsEl) {
            this.sketchToolsEl.sketchToolsToHide = this.sketchToolsToHide;
            this.sketchToolsEl.hideSelectionTools = this.hideSelectionTools;
            this.sketchToolsEl.activeSketchTool = this.activeSketchTool;
        }
    }
    createSketchTools() {
        var _a;
        this.sketchToolsEl = document.createElement("arcgis-sketch-tools");
        this.sketchToolsEl.sketchToolsToHide = this.sketchToolsToHide;
        this.sketchToolsEl.activeSketchTool = this.activeSketchTool;
        this.sketchToolsEl.hideSelectionTools = this.hideSelectionTools;
        this.sketchToolsEl.refElement = (_a = this.sketchToolsReferenceElement) !== null && _a !== void 0 ? _a : this.hostElement;
        if (this.selectedSketchFeaturesFeatures) {
            this.sketchToolsEl.mapNotesFeatures = this.selectedSketchFeaturesFeatures;
        }
        document.body.appendChild(this.sketchToolsEl);
        if (this.sketchContentEl && !this.sketchContentEl.symbolStylerRefElement) {
            this.sketchContentEl.symbolStylerRefElement = this.dismissButtonEl;
        }
    }
    async loadAllModules() {
        [
            this.SketchViewModel,
            this.TextSymbol,
            this.ColorUtils,
            this.CIMSymbol,
            this.SnappingOptions,
            this.SketchTooltipOptions,
            this.SelectionOperation
        ] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__.l)([
            "esri/widgets/Sketch/SketchViewModel",
            "esri/symbols/TextSymbol",
            "esri/views/support/colorUtils",
            "esri/symbols/CIMSymbol",
            "esri/views/interactive/snapping/SnappingOptions",
            "esri/views/interactive/sketch/SketchTooltipOptions",
            "esri/widgets/support/Selector2D/SelectionOperation"
        ]);
    }
    removeSketchShortcuts() {
        if (this.arcgisSketchShortcuts) {
            this.arcgisSketchShortcuts.removeEventListener("arcgisSketchShortcutsDismissedChange", () => this.removeSketchShortcuts());
            document.body.removeChild(this.arcgisSketchShortcuts);
            this.arcgisSketchShortcuts = null;
        }
    }
    onGraphicCreate(event, sketchViewModel) {
        if (event.state === "start") {
            this.tempCreatedGraphic = null;
            this.removeHighlight();
        }
        if (event.state === "cancel" && this.escKey) {
            this.escKey = false;
            const tool = this.currentSketchInfo.tool === "text" ? "point" : this.currentSketchInfo.tool;
            sketchViewModel.create(tool);
        }
        if (event.state === "complete") {
            this.internalSketchUpdated.emit();
            if (event.graphic) {
                event.graphic.popupTemplate = this.currentSketchInfo.popup;
                event.graphic.attributes = {
                    title: this.currentSketchInfo.title
                };
                this.currentSketchInfo.graphics = [event.graphic];
                this.tempCreatedGraphic = event.graphic;
                this.highlightGraphic(event.graphic);
            }
            const tool = this.currentSketchInfo.tool === "text" ? "point" : this.currentSketchInfo.tool;
            sketchViewModel.create(tool);
        }
    }
    watchEscapeOnMapView(watch) {
        var _a;
        if (watch && !this.watchEscapeHandle) {
            this.watchEscapeHandle = this.mapView.on("key-down", (event) => {
                if (event.key === "Escape" &&
                    (this.svModel.getPointSVM().state === "active" ||
                        this.svModel.getLineSVM().state === "active" ||
                        this.svModel.getPolygonSVM().state === "active" ||
                        this.svModel.getTextSVM().state === "active")) {
                    event.stopPropagation();
                    this.escKey = true;
                    this.svModel.cancel();
                }
            });
        }
        else {
            (_a = this.watchEscapeHandle) === null || _a === void 0 ? void 0 : _a.remove();
            this.watchEscapeHandle = undefined;
        }
    }
    watchDeleteOnMapView(watch) {
        var _a;
        if (watch && !this.watchDeleteHandle) {
            this.watchDeleteHandle = this.mapView.on("key-down", (event) => {
                if (event.key === "Delete" || event.key === "Backspace") {
                    this.deleteInProgress = true;
                    this.svModel.delete();
                    this.deleteInProgress = false;
                    this.keepSelectToolSelection();
                }
            });
        }
        else {
            (_a = this.watchDeleteHandle) === null || _a === void 0 ? void 0 : _a.remove();
            this.watchDeleteHandle = undefined;
        }
    }
    defaultGraphicTitle() {
        switch (this.currentSketchInfo.tool) {
            case "point":
                return this.strings.point;
            case "polyline":
                return this.strings.line;
            case "polygon":
                return this.strings.polygon;
            case "rectangle":
                return this.strings.rectangle;
            case "circle":
                return this.strings.circle;
            case "text":
                return this.strings.text;
            default:
                return this.strings.point;
        }
    }
    clearHighlightAndPopup() {
        this.removeHighlight();
        this.mapView.closePopup();
    }
    actionOnMultipleSelections(multipleSelectTool) {
        this.selectedSketchFeaturesFeatures = null;
        const selectionSources = [
            this.layer.pointLayer,
            this.layer.polylineLayer,
            this.layer.polygonLayer,
            this.layer.textLayer
        ];
        const drawObject = multipleSelectTool === "rectangle"
            ? {
                createTool: "rectangle"
            }
            : {
                createTool: "polygon",
                mode: "freehand"
            };
        const operation = (this.selectorOperation = new this.SelectionOperation({
            view: this.mapView,
            sources: selectionSources,
            options: drawObject
        }));
        operation.once("complete", (event) => {
            const { selection } = event;
            //this.sketchMessageHandler(null);
            this.clearHighlightAndPopup();
            if (!event.aborted && selection.length) {
                let tempPoint = [];
                let tempLine = [];
                let tempPolygon = [];
                let tempText = [];
                selection.forEach((currGraphic) => {
                    switch (getGeometryTypeFromGraphic(currGraphic)) {
                        case "point":
                            tempPoint = [...tempPoint, currGraphic];
                            break;
                        case "polyline":
                            tempLine = [...tempLine, currGraphic];
                            break;
                        case "polygon":
                            tempPolygon = [...tempPolygon, currGraphic];
                            break;
                        case "text":
                            tempText = [...tempText, currGraphic];
                            break;
                        default:
                            tempPoint = [...tempPoint, currGraphic];
                            break;
                    }
                });
                this.multipleSelectedGraphics = [...tempPoint, ...tempLine, ...tempPolygon, ...tempText];
                tempPoint.length && this.svModel.updatePoint(tempPoint);
                tempLine.length && this.svModel.updateLine(tempLine);
                tempPolygon.length && this.svModel.updatePolygon(tempPolygon);
                tempText.length && this.svModel.updateText(tempText);
                this.watchDeleteOnMapView(true);
            }
        });
        this.svModel.updateOnGraphic(false);
    }
    sketchMessageHandler(message) {
        sketchState.sketchMessage = message;
    }
    highlightGraphic(graphic) {
        var _a;
        this.removeHighlight();
        const match = (_a = this.mapView.allLayerViews) === null || _a === void 0 ? void 0 : _a.items.find(({ layer }) => layer === this.layer);
        this.createdGraphicHighlightHandle = match === null || match === void 0 ? void 0 : match.highlight(graphic);
    }
    removeHighlight() {
        var _a;
        (_a = this.createdGraphicHighlightHandle) === null || _a === void 0 ? void 0 : _a.remove();
        this.createdGraphicHighlightHandle = undefined;
    }
    // for workflows where we want the current select tools to stay activated
    keepSelectToolSelection() {
        this.sketchActionOnSelectFeatures.emit({
            sketchMessage: this.keepSelectionMessage,
            multipleSelectTool: this.keepSelectionTool
        });
    }
    /**
     * Renders the Sketch Flow Panels
     * @returns VNode
     */
    renderSketchFlowPanel() {
        var _a, _b, _c, _d;
        const dismissButton = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: "close", scale: "m", icon: "x", slot: "header-actions-end", ref: (el) => (this.dismissButtonEl = el), onClick: (event) => {
                event.stopPropagation();
                this.sketchMessageHandler(null);
                this.svModel.cancel();
                this.clearHighlightAndPopup();
                this.arcgisSketchDismissedChange.emit();
            } }));
        const selectionMultipleLabel = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "center", for: "multiple-selection-buttons" }, ((_a = this.currentSketchInfo.graphics) === null || _a === void 0 ? void 0 : _a.length) <= 1
            ? this.strings.singleFeatureSelected
            : this.strings.featuresSelected.replace("${number}", (_b = this.currentSketchInfo.graphics) === null || _b === void 0 ? void 0 : _b.length.toString())));
        const deleteMultiple = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "center", iconStart: "trash", kind: "danger", width: "full", onClick: (event) => {
                event.stopPropagation();
                // svm knows what's selected, and will delete accordingly
                this.deleteInProgress = true;
                this.svModel.delete();
                this.deleteInProgress = false;
                this.multipleSelectedGraphics = [];
                this.keepSelectToolSelection();
            } }, this.strings.delete));
        const addToNewSketch = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "center", iconStart: "copy", kind: "neutral", width: "full", onClick: (event) => {
                event.stopPropagation();
                this.newSketchLayerFeatures = this.multipleSelectedGraphics.map((graphic) => graphic.clone());
                this.arcgisSketchAddToNewSketch.emit();
            } }, this.strings.addToNewSketch));
        const duplicateMultiple = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "center", iconStart: "duplicate", kind: "neutral", width: "full", onClick: (event) => {
                event.stopPropagation();
                this.svModel.duplicate();
                //this.keepSelectToolSelection();
            } }, this.strings.duplicate));
        const ShortcutAndSnapping = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "snapping", ref: (el) => (this.shortcutSnappingDiv = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", class: "sketch-keyboard-button", kind: "neutral", iconStart: "keyboard", scale: "l", label: this.strings.sketchShortcuts, onClick: () => {
                if (!this.arcgisSketchShortcuts) {
                    this.arcgisSketchShortcuts = document.createElement("arcgis-sketch-shortcuts");
                    this.arcgisSketchShortcuts.refElement = this.shortcutSnappingDiv;
                    document.body.appendChild(this.arcgisSketchShortcuts);
                    this.arcgisSketchShortcuts.addEventListener("arcgisSketchShortcutsDismissedChange", () => this.removeSketchShortcuts());
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", width: "full", iconStart: "gear", iconEnd: "chevron-down", scale: "l", label: this.strings.settings, onClick: (event) => {
                event.stopPropagation();
                if (!this.sketchSnappingEl) {
                    this.sketchSnappingEl = document.createElement("arcgis-sketch-snapping");
                    this.sketchSnappingEl.refElement = this.shortcutSnappingDiv;
                    document.body.appendChild(this.sketchSnappingEl);
                    this.disableSketchPanel.emit(true);
                }
            } }, this.strings.settings)));
        const sketchMessage = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: sketchState.sketchMessage && "sketch-message" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { width: "full", open: !!sketchState.sketchMessage && !(((_c = this.currentSketchInfo.graphics) === null || _c === void 0 ? void 0 : _c.length) > 1) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, sketchState.sketchMessage))));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (el) => (this.flowEl = el), dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), class: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl" ? _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl : "" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { ref: (el) => (this.sketchFlowItemEl = el), heading: this.strings.sketch, disabled: !this.layer.capabilities.operations.supportsMapNotesEditing }, this.dismissible && dismissButton, ShortcutAndSnapping, sketchMessage, ((_d = this.currentSketchInfo.graphics) === null || _d === void 0 ? void 0 : _d.length) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "multiple-selection" }, selectionMultipleLabel, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "multiple-selection-buttons", class: "buttons" }, duplicateMultiple, addToNewSketch, deleteMultiple))) : null, this.showSketchContent && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-sketch-content", { currentSketchInfo: this.currentSketchInfo, flowEl: this.flowEl, symbolStylerRefElement: this.dismissButtonEl, ref: (element) => (this.sketchContentEl = element) })))));
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, !this.showSketchToolsOnly && this.renderSketchFlowPanel()));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketch.style = arcgisSketchCss;

const arcgisSketchContentCss = ".sketch-content{display:flex;flex-direction:column;background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half)}.sketch-title calcite-inline-editable{border:1px solid;border-color:var(--calcite-color-border-input);padding:var(--arcgis-app-cap-spacing-third)}.rotation{display:flex;align-items:center;justify-content:space-between;position:relative}.rotation calcite-slider{width:50%}.rotation calcite-input-number{width:45%;font-size:var(--arcgis-app-font-size-0);font-family:var(--arcgis-app-font-family)}.sketch-popup-button{margin-bottom:0.4em}.recent-symbols{display:flex;flex-direction:column;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half)}.container{background-color:var(--arcgis-app-background);box-shadow:0px 1px 10px 2px rgba(0, 0, 0, 0.1);padding:8px 12px;display:flex;align-items:center;justify-content:space-evenly}.symbol{height:32px;display:flex;align-items:center;cursor:pointer}.symbol:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}.no-recent-symbols{min-height:32px;display:flex;align-items:center}.clear-recent-button{padding-top:8px;margin:auto}.halo-block{padding-top:6px}";

const ArcgisSketchContent = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.sketchGraphicUpdates = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchGraphicUpdates", 7);
        this.arcgisSketchPanelLoader = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchPanelLoader", 7);
        this.disableSketchPanel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableSketchPanel", 7);
        this.arcgisSketchActiveSymbolChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchActiveSymbolChange", 7);
        this.resizeObserver = new ResizeObserver(() => (this.reRender = !this.reRender));
        this.divNodes = [];
        this.symbolNodes = [];
        this.suggestedFillColors = [];
        this.savedColors = [];
        this.storePointStyler = (el) => {
            if (!el) {
                return;
            }
            this.pointStyler = el;
            this.startPointEdit();
        };
        this.storePolylineStyler = (el) => {
            if (!el) {
                return;
            }
            this.polylineStyler = el;
            this.startPolylineEdit();
        };
        this.storePolygonStyler = (el) => {
            if (!el) {
                return;
            }
            this.polygonStyler = el;
            this.startPolygonEdit();
        };
        // open font popover
        this.openFontPopover = () => {
            var _a;
            if (!this.arcgisFontPicker) {
                this.disableSketchPanel.emit(true);
                this.arcgisFontPicker = document.createElement("arcgis-font-picker");
                this.arcgisFontPicker.fontMap = _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_10__.f;
                this.arcgisFontPicker.font = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.font;
                this.arcgisFontPicker.popoverProps = {
                    refElement: this.hostElement
                };
                this.arcgisFontPicker.addEventListener("arcgisFontPickerDismissed", this.closeFontPopover);
                this.arcgisFontPicker.addEventListener("arcgisFontPickerChange", this.changeFont);
                document.body.appendChild(this.arcgisFontPicker);
            }
        };
        this.closeFontPopover = () => {
            if (this.arcgisFontPicker) {
                this.disableSketchPanel.emit(false);
                document.body.removeChild(this.arcgisFontPicker);
                this.arcgisFontPicker = null;
            }
        };
        this.changeFont = (event) => {
            var _a;
            const font = event.detail;
            if (font) {
                const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
                tempSymbol.font.family = font.family;
                tempSymbol.font.weight = font.weight;
                tempSymbol.font.style = font.style;
                this.updateSymbol(tempSymbol, false, false, "font");
                this.reRender = !this.reRender;
            }
        };
        this.currentSketchInfo = undefined;
        this.flowEl = undefined;
        this.symbolStylerRefElement = undefined;
        this.storageId = undefined;
        this.reRender = true;
    }
    // lifecycle methods
    async componentWillLoad() {
        this.arcgisSketchPanelLoader.emit(true);
        await this.loadAllModules();
        // add sketch
        suggestedColorList.forEach((hex) => this.suggestedFillColors.push(new this.Color(hex)));
        savedColorList.forEach((hex) => this.savedColors.push(new this.Color(hex)));
        this.mapView = sketchState.mapView;
        this.strings = sketchState.strings;
        this.currentLanguage = sketchState.currentLanguage;
        this.portal = sketchState.portal;
        if (!this.flowEl) {
            this.flowEl = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_9__.q)(this.hostElement, "calcite-flow");
        }
        // get recent symbols
        const storageId = this.currentSketchInfo.tool
            ? ["circle", "rectangle"].indexOf(this.currentSketchInfo.tool) > -1
                ? "arcgis-sketch-recent-polygon-symbols"
                : `arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`
            : "arcgis-sketch-recent-point-symbols";
        const recentSymbols = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.g)(storageId, true);
        if (recentSymbols) {
            this.recentSymbols = [...recentSymbols];
        }
    }
    componentDidLoad() {
        this.arcgisSketchPanelLoader.emit(false);
        this.flowEl && this.resizeObserver.observe(this.flowEl);
    }
    disconnectedCallback() {
        this.flowEl && this.resizeObserver.unobserve(this.flowEl);
    }
    // events
    calciteFlowItemBackHandler(event) {
        event.stopPropagation();
        this.mapView.closePopup();
        this.sketchPopupFlowItem = null;
    }
    // currentSketchInfo is updated. rerender.
    sketchContentReRenderHandler(event) {
        event.stopPropagation();
        if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(event.detail)) {
            this.storageId = this.currentSketchInfo.tool
                ? ["circle", "rectangle"].indexOf(event.detail) > -1
                    ? "arcgis-sketch-recent-polygon-symbols"
                    : `arcgis-sketch-recent-${event.detail}-symbols`
                : "arcgis-sketch-recent-point-symbols";
            this.recentSymbols = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.storageId, true);
        }
        this.reRender = !this.reRender;
        // go back if popup panel is open
        if (this.sketchPopupFlowItem) {
            this.flowEl.back();
            this.sketchPopupFlowItem = null;
        }
        const { tool } = this.currentSketchInfo;
        if (tool === "point") {
            this.startPointEdit();
        }
        else if (tool === "polyline") {
            this.startPolylineEdit();
        }
        else if (["circle", "polygon", "rectangle"].includes(tool)) {
            this.startPolygonEdit();
        }
    }
    popupUpdatedHandler({ detail: { mapNotesPopuptemplate } }) {
        this.currentSketchInfo.popup = mapNotesPopuptemplate;
        this.sketchGraphicUpdates.emit({
            type: "popup",
            update: true,
            close: false
        });
    }
    // Private Methods
    async loadAllModules() {
        [
            this.Color,
            this.cimSymbolUtils,
            this.symbolUtils,
            this.CIMSymbol,
            this.SimpleLineSymbol,
            this.SimpleFillSymbol,
            this.PictureMarkerSymbol,
            this.PictureFillSymbol,
            this.TextSymbol
        ] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__.l)([
            "esri/Color",
            "esri/symbols/support/cimSymbolUtils",
            "esri/symbols/support/symbolUtils",
            "esri/symbols/CIMSymbol",
            "esri/symbols/SimpleLineSymbol",
            "esri/symbols/SimpleFillSymbol",
            "esri/symbols/PictureMarkerSymbol",
            "esri/symbols/PictureFillSymbol",
            "esri/symbols/TextSymbol"
        ]);
    }
    updateSymbol(symbol, symbolSwitch, symbolSwitchFromRecent, textProp, needsDebounceBeforeUpdate) {
        var _a;
        const currentSymbolClone = this.currentSketchInfo.symbol.clone();
        const newSymbolClone = symbol.clone();
        const sizeChanged = getSymbolSize(this.currentSketchInfo.symbol) !== getSymbolSize(symbol);
        this.currentSketchInfo.symbol = symbol.clone();
        if (textProp === "recent-text") {
            this.currentSketchInfo.symbol.text = currentSymbolClone.text;
        }
        this.sketchGraphicUpdates.emit({
            type: "symbol",
            update: true,
            close: false,
            symbolSwitch,
            symbolSwitchFromRecent,
            textProp
        });
        if (needsDebounceBeforeUpdate) {
            this.arcgisSketchActiveSymbolChange.emit();
        }
        else if (!((sizeChanged && !symbolSwitch && !symbolSwitchFromRecent) ||
            ["halo-size", "text"].indexOf(textProp) > -1)) {
            if (newSymbolClone.type === "text") {
                newSymbolClone.text = this.strings.textPreview;
            }
            const currentlyStoredSymbols = (_a = this.recentSymbols) === null || _a === void 0 ? void 0 : _a.filter((recent) => JSON.stringify(recent) !== JSON.stringify(newSymbolClone));
            const recentSymbols = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.i)(currentlyStoredSymbols)
                ? [newSymbolClone, ...currentlyStoredSymbols].slice(0, 5)
                : [newSymbolClone];
            const storageId = this.currentSketchInfo.tool
                ? ["circle", "rectangle"].indexOf(this.currentSketchInfo.tool) > -1
                    ? "arcgis-sketch-recent-polygon-symbols"
                    : `arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`
                : "arcgis-sketch-recent-point-symbols";
            (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.s)(storageId, recentSymbols, true);
            this.recentSymbols = recentSymbols;
            this.arcgisSketchActiveSymbolChange.emit();
        }
    }
    applyCimOutline(sym, stroke) {
        const outline = getCimOutline(sym);
        if (!outline) {
            return;
        }
        const rgba = stroke.color.toRgba();
        rgba[3] *= 255;
        outline.color = rgba;
        outline.width = stroke.size;
    }
    // https://devtopia.esri.com/WebGIS/arcgis-components/blob/master/src/smartMapping/_utils/symbolStyler.ts#L4996
    getCimOutlineProps(sym) {
        var _a;
        const outline = getCimOutline(sym);
        return {
            color: new this.Color(outline === null || outline === void 0 ? void 0 : outline.color),
            size: (_a = outline === null || outline === void 0 ? void 0 : outline.width) !== null && _a !== void 0 ? _a : 1
        };
    }
    getPopoverProps(isRtl) {
        var _a;
        const flowRect = (_a = this.flowEl) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
        return {
            placement: isRtl ? "bottom-start" : "bottom-end",
            offsetDistance: 10,
            offsetSkidding: isRtl ? 3 : -3,
            overlayPositioning: "fixed",
            maxHeight: flowRect && `${flowRect.height - 65}px`,
            refElement: this.symbolStylerRefElement
        };
    }
    startPointEdit() {
        var _a;
        // cim and custom picture-markers are allowed
        const isCIM = this.currentSketchInfo.symbol.type === "cim";
        (_a = this.pointStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
            sections: {
                marker: {
                    open: true,
                    symbolsOpen: true,
                    sizeOpen: false,
                    rotationOpen: false,
                    // 'all' by default, can be 'simple', 'picture', 'cim', 'cim:picture', 'cim:vector'
                    // or an array of a combination of specific types
                    markerType: ["cim:vector", "custom"],
                    keepChoice: true,
                    parts: {
                        size: {
                            autoSizeAdjust: false // hide adjust size property
                        }
                    }
                },
                fill: isCIM && {
                    type: "color",
                    optional: true,
                    suggestedColors: this.suggestedFillColors,
                    savedColors: this.savedColors,
                    open: false,
                    suggestedColorsOpen: true
                },
                stroke: isCIM && {
                    optional: true,
                    open: false,
                    type: "color",
                    suggestedColors: this.suggestedFillColors,
                    savedColors: this.savedColors
                }
            },
            marker: {
                size: isCIM
                    ? this.cimSymbolUtils.getCIMSymbolSize(this.currentSketchInfo.symbol)
                    : this.currentSketchInfo.symbol.type === "picture-marker"
                        ? this.currentSketchInfo.symbol.width
                        : 25
            },
            fill: {
                color: (isCIM &&
                    this.cimSymbolUtils.getCIMSymbolColor(this.currentSketchInfo.symbol)) ||
                    this.suggestedFillColors[0]
            },
            stroke: isCIM && this.getCimOutlineProps(this.currentSketchInfo.symbol),
            fillEnabled: isCIM,
            strokeEnabled: isCIM,
            portal: this.createPortalProp()
        });
    }
    startPolylineEdit() {
        var _a, _b, _c, _d, _e;
        (_a = this.polylineStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
            sections: {
                stroke: {
                    type: "color",
                    open: true,
                    suggestedColorsOpen: true,
                    suggestedColors: this.suggestedFillColors,
                    extraParts: {
                        width: true,
                        autoStrokeAdjust: false
                    }
                }
            },
            stroke: {
                color: ((_b = this.currentSketchInfo.symbol) === null || _b === void 0 ? void 0 : _b.color) || this.savedColors[1],
                size: ((_c = this.currentSketchInfo.symbol) === null || _c === void 0 ? void 0 : _c.width) || 10,
                style: ((_d = this.currentSketchInfo.symbol) === null || _d === void 0 ? void 0 : _d.style) ||
                    "solid",
                marker: (_e = this.currentSketchInfo.symbol) === null || _e === void 0 ? void 0 : _e.marker
            },
            portal: this.createPortalProp()
        });
    }
    createPortalProp() {
        return {
            portal: this.portal,
            before: async (portal, data) => {
                await portal.load();
                data.originalStylesGroupQuery2d = portal.stylesGroupQuery2d;
                portal.stylesGroupQuery2d = 'title:"Esri Sketch Styles" AND owner:esri_en';
            },
            after: async (portal, data) => {
                portal.stylesGroupQuery2d = data.originalStylesGroupQuery2d;
            }
        };
    }
    startPolygonEdit() {
        var _a, _b, _c, _d, _e;
        (_a = this.polygonStyler) === null || _a === void 0 ? void 0 : _a.edit(this.currentSketchInfo.symbol.clone(), {
            sections: {
                fill: {
                    type: "color",
                    open: true,
                    optional: true,
                    suggestedColorsOpen: true,
                    transparencyOpen: false,
                    suggestedColors: this.suggestedFillColors
                },
                stroke: {
                    type: "color",
                    open: false,
                    optional: true,
                    suggestedColorsOpen: true,
                    suggestedColors: this.suggestedFillColors,
                    extraParts: {
                        width: true,
                        autoStrokeAdjust: false
                    }
                }
            },
            fill: {
                color: this.currentSketchInfo.symbol.color ||
                    this.suggestedFillColors[0]
            },
            stroke: {
                color: ((_b = this.currentSketchInfo.symbol.outline) === null || _b === void 0 ? void 0 : _b.color) ||
                    this.suggestedFillColors[0],
                size: ((_c = this.currentSketchInfo.symbol.outline) === null || _c === void 0 ? void 0 : _c.width) || 10,
                style: ((_d = this.currentSketchInfo.symbol.outline) === null || _d === void 0 ? void 0 : _d.style) || "solid",
                autoAdjusted: false
            },
            fillEnabled: this.currentSketchInfo.symbol.color ? true : false,
            strokeEnabled: ((_e = this.currentSketchInfo.symbol) === null || _e === void 0 ? void 0 : _e.outline)
                ? true
                : false,
            portal: this.createPortalProp()
        });
    }
    handleTextPropChange(node, textProp) {
        var _a;
        let value = parseInt(node.value);
        if (isNaN(value) || value < node.min) {
            value = node.min;
        }
        else if (value > node.max) {
            value = node.max;
        }
        node.value = `${value}`;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        switch (textProp) {
            case "font-size":
                tempSymbol.font.size = value * 0.75;
                break;
            case "halo-size":
                tempSymbol.haloSize = value * 0.75;
                break;
            case "rotation":
                tempSymbol.angle = value;
                break;
        }
        this.updateSymbol(tempSymbol, false, false, textProp);
        if (textProp === "rotation") {
            this.reRender = !this.reRender;
        }
    }
    handleRotationSliderValueChange(angle, needsDebounceBeforeUpdate) {
        var _a;
        const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
        tempSymbol.angle = angle;
        this.updateSymbol(tempSymbol, false, false, "rotation", needsDebounceBeforeUpdate);
    }
    render() {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u;
        const isRtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl";
        const isBulk = ((_a = this.currentSketchInfo.graphics) === null || _a === void 0 ? void 0 : _a.length) > 1;
        const firstSymbolType = (_b = this.currentSketchInfo.graphics) === null || _b === void 0 ? void 0 : _b[0].symbol.type;
        const identicalSymbolTypes = (_c = this.currentSketchInfo.graphics) === null || _c === void 0 ? void 0 : _c.every((graphic) => firstSymbolType === graphic.symbol.type);
        const point = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { mode: isBulk ? "minimal" : "default", key: "point-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.pointSourceId, ref: this.currentSketchInfo.symbol && this.storePointStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol, symbolSwitch } }) => {
                this.updateSymbol(symbol, symbolSwitch);
            }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.pointSourceId = sourceId) }));
        const polyline = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { mode: isBulk ? "minimal" : "default", key: "polyline-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.polylineSourceId, ref: this.currentSketchInfo.symbol && this.storePolylineStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol, symbolSwitch } }) => {
                this.updateSymbol(symbol, symbolSwitch);
            }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.polylineSourceId = sourceId) }));
        const polygon = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler", { mode: isBulk ? "minimal" : "default", key: "polygon-styler", lang: this.currentLanguage, initialSourceId: this.currentSketchInfo.sourceIds.polygonSourceId, ref: this.currentSketchInfo.symbol && this.storePolygonStyler, popoverProps: this.getPopoverProps(isRtl), onArcgisSymbolStylerEdit: ({ detail: { symbol, symbolSwitch } }) => {
                this.updateSymbol(symbol, symbolSwitch);
            }, onArcgisSymbolStylerSourceIdChange: ({ detail: sourceId }) => (this.currentSketchInfo.sourceIds.polygonSourceId = sourceId) }));
        // text
        let firstTextContent;
        let identicalTextContent;
        if (this.textContentEl) {
            firstTextContent = (_d = this.currentSketchInfo.symbol) === null || _d === void 0 ? void 0 : _d.text;
            identicalTextContent = (_e = this.currentSketchInfo.graphics) === null || _e === void 0 ? void 0 : _e.every((graphic) => firstTextContent === graphic.symbol.text);
        }
        const textContent = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.content, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "textarea", placeholder: this.strings.textContentPlaceholder, value: identicalTextContent ? (_f = this.currentSketchInfo.symbol) === null || _f === void 0 ? void 0 : _f.text : "", onCalciteInputInput: (event) => {
                var _a;
                event.stopPropagation();
                const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
                tempSymbol.text = event.target.value;
                this.updateSymbol(tempSymbol, false, false, "text");
            }, ref: (element) => (this.textContentEl = element) })));
        const fontFamilySelection = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.font, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", label: (0,_fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_10__.b)(((_g = this.currentSketchInfo.symbol) === null || _g === void 0 ? void 0 : _g.font) ||
                { family: "Arial", style: "normal", weight: "normal" }), width: "full", scale: "m", onClick: this.openFontPopover }, (0,_fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_10__.b)((_h = this.currentSketchInfo.symbol) === null || _h === void 0 ? void 0 : _h.font))));
        const textFontSize = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { scale: "s", min: 5, max: 125, value: `${((_k = (_j = this.currentSketchInfo.symbol) === null || _j === void 0 ? void 0 : _j.font) === null || _k === void 0 ? void 0 : _k.size) / 0.75 || 0}`, onCalciteInputNumberInput: (event) => {
                event.stopPropagation();
                const value = parseInt(this.fontSizeEl.value);
                if (!value || value < this.fontSizeEl.min || value > this.fontSizeEl.max) {
                    this.fontSizeValueHandle = setTimeout(() => this.handleTextPropChange(this.fontSizeEl, "font-size"), 3000);
                }
                else {
                    clearTimeout(this.fontSizeValueHandle);
                    this.handleTextPropChange(this.fontSizeEl, "font-size");
                }
            }, ref: (element) => (this.fontSizeEl = element) })));
        const textColor = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_m = (_l = this.currentSketchInfo.symbol) === null || _l === void 0 ? void 0 : _l.color) === null || _m === void 0 ? void 0 : _m.toHex()) || "#ffffff", popoverProps: this.getPopoverProps(isRtl), onArcgisColorInputChange: (event) => {
                var _a;
                const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
                tempSymbol.color = new this.Color(event.target.color);
                this.updateSymbol(tempSymbol, false, false, "color");
            } })));
        const rotation = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.rotation, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "rotation" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { min: 0, max: 360, value: ((_o = this.currentSketchInfo.symbol) === null || _o === void 0 ? void 0 : _o.angle) || 0, step: 1, onCalciteSliderInput: (event) => this.handleRotationSliderValueChange(event.target.value, true), onCalciteSliderChange: (event) => this.handleRotationSliderValueChange(event.target.value, false) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { scale: "s", min: 0, max: 360, suffixText: isRtl ? "" : "", prefixText: isRtl ? "" : "", step: 1, value: `${((_p = this.currentSketchInfo.symbol) === null || _p === void 0 ? void 0 : _p.angle) || 0}`, onCalciteInputNumberInput: (event) => {
                event.stopPropagation();
                const value = parseInt(this.rotationEl.value);
                if (!value || value < this.rotationEl.min || value > this.rotationEl.max) {
                    this.rotationValueHandle = setTimeout(() => this.handleTextPropChange(this.rotationEl, "rotation"), 3000);
                }
                else {
                    clearTimeout(this.rotationValueHandle);
                    this.handleTextPropChange(this.rotationEl, "rotation");
                }
            }, ref: (element) => (this.rotationEl = element) }))));
        const haloBlock = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { ref: (el) => (this.haloBlockSection = el), text: this.strings.halo, toggleDisplay: "switch", open: ((_q = this.currentSketchInfo.symbol) === null || _q === void 0 ? void 0 : _q.haloColor) ? true : false, onCalciteBlockSectionToggle: (event) => {
                var _a;
                event.stopPropagation();
                const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
                if (this.haloBlockSection.open) {
                    tempSymbol.haloColor = this.tempHaloColor || new this.Color("white");
                    tempSymbol.haloSize = (tempSymbol === null || tempSymbol === void 0 ? void 0 : tempSymbol.haloSize) || 1 * 0.75;
                }
                else {
                    this.tempHaloColor = tempSymbol.haloColor;
                    tempSymbol.haloColor = null;
                }
                this.updateSymbol(tempSymbol, false, false, "halo");
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "halo-block" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_s = (_r = this.currentSketchInfo.symbol) === null || _r === void 0 ? void 0 : _r.haloColor) === null || _s === void 0 ? void 0 : _s.toHex()) ||
                "#ffffff", popoverProps: this.getPopoverProps(isRtl), onArcgisColorInputChange: (event) => {
                var _a;
                const tempSymbol = (_a = this.currentSketchInfo.symbol) === null || _a === void 0 ? void 0 : _a.clone();
                tempSymbol.haloColor = new this.Color(event.target.color);
                this.updateSymbol(tempSymbol, false, false, "halo-color");
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { scale: "s", min: 1, max: 10, value: `${((_t = this.currentSketchInfo.symbol) === null || _t === void 0 ? void 0 : _t.haloSize) / 0.75 || 0}`, onCalciteInputNumberInput: (event) => {
                event.stopPropagation();
                const value = parseInt(this.haloSizeEl.value);
                if (!value || value < this.haloSizeEl.min || value > this.haloSizeEl.max) {
                    this.haloSizeValueHandle = setTimeout(() => this.handleTextPropChange(this.haloSizeEl, "halo-size"), 3000);
                }
                else {
                    clearTimeout(this.haloSizeValueHandle);
                    this.handleTextPropChange(this.haloSizeEl, "halo-size");
                }
            }, ref: (element) => (this.haloSizeEl = element) })))));
        const text = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, textContent, fontFamilySelection, textFontSize, textColor, rotation, haloBlock));
        this.divNodes = [];
        this.symbolNodes = [];
        let currentToolText;
        switch (this.currentSketchInfo.tool) {
            case "point":
                currentToolText = this.strings.point;
                break;
            case "polyline":
                currentToolText = this.strings.line;
                break;
            case "text":
                currentToolText = this.strings.text;
                break;
            default:
                currentToolText = this.strings.polygon;
        }
        currentToolText = currentToolText.toLocaleLowerCase();
        const recentSymbols = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.recentSymbols), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "container", ref: (node) => (this.recentSymbolsContainerEl = node) }, ((_u = this.recentSymbols) === null || _u === void 0 ? void 0 : _u.length) ? (this.recentSymbols.map((recentSymbol, idx) => {
            return recentSymbol ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "symbol", class: "symbol", tabindex: "0", onClick: () => this.handleRecentSymbolSelect(idx), onKeyDown: (event) => {
                    if (event.key === " " || event.key === "Enter") {
                        event.preventDefault();
                        event.stopPropagation();
                        this.handleRecentSymbolSelect(idx);
                    }
                }, ref: (node) => {
                    if (node) {
                        this.divNodes[idx] = node;
                        this.afterCreateDiv(node, recentSymbol, idx);
                    }
                } })) : null;
        })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "no-recent-symbol", class: "no-recent-symbols" }, this.strings.noRecentSymbols.replace("${tool}", currentToolText)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", class: "clear-recent-button", width: "half", onClick: () => {
                const storageId = this.currentSketchInfo.tool
                    ? ["circle", "rectangle"].indexOf(this.currentSketchInfo.tool) > -1
                        ? "arcgis-sketch-recent-polygon-symbols"
                        : `arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`
                    : "arcgis-sketch-recent-point-symbols";
                this.recentSymbols = [];
                (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.s)(storageId, this.recentSymbols, true);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }, this.strings.clear)));
        const sketchTitle = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-title" }, this.strings.title, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-inline-editable", { scale: "m" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { alignment: "start", placeholder: this.strings.enterTitlePlaceholder, type: "text", value: this.currentSketchInfo.title, onBlur: (event) => {
                this.currentSketchInfo.title = event.target.value;
                this.sketchGraphicUpdates.emit({
                    type: "title",
                    update: true,
                    close: false
                });
            } }))));
        const popupBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: isRtl ? "chevron-left" : "chevron-right", label: this.strings.popup, width: "full", scale: "l", class: "sketch-popup-button", onClick: (event) => {
                var _a, _b;
                event.stopPropagation();
                if (!this.sketchPopupFlowItem) {
                    this.sketchPopupFlowItem = document.createElement("calcite-flow-item");
                    this.sketchPopupFlowItem.heading = this.strings.sketch;
                    this.sketchPopupFlowItem.description = this.strings.popup;
                    const calciteFab = document.createElement("calcite-fab");
                    calciteFab.icon = "plus";
                    calciteFab.slot = "fab";
                    calciteFab.scale = "s";
                    calciteFab.appearance = "outline-fill";
                    calciteFab.kind = "neutral";
                    calciteFab.label = this.strings.addContent;
                    calciteFab.text = this.strings.addContent;
                    calciteFab.textEnabled = true;
                    this.sketchPopupFlowItem.appendChild(calciteFab);
                    const popupComponent = document.createElement("arcgis-popup");
                    popupComponent.lang = this.currentLanguage;
                    popupComponent.mapView = this.mapView;
                    popupComponent.layerDisplayType = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_8__.l.mapNotes;
                    popupComponent.mapNotesGraphic = (_a = this.currentSketchInfo.graphics) === null || _a === void 0 ? void 0 : _a[0];
                    popupComponent.mapNotesPopupTemplate = this.currentSketchInfo.popup;
                    popupComponent.calciteFlowProps = {
                        flow: this.flowEl,
                        calciteFab: calciteFab,
                        calciteFlowItem: this.sketchPopupFlowItem
                    };
                    this.sketchPopupFlowItem.appendChild(popupComponent);
                    this.flowEl.appendChild(this.sketchPopupFlowItem);
                    // handle multiple features
                    if (isBulk) {
                        popupComponent.disableEditing = true;
                        const applyChangesBtn = document.createElement("calcite-button");
                        applyChangesBtn.label = this.strings.applyChanges;
                        applyChangesBtn.innerHTML = this.strings.applyChanges;
                        applyChangesBtn.scale = "l";
                        applyChangesBtn.slot = "footer";
                        this.sketchPopupFlowItem.append(applyChangesBtn);
                        applyChangesBtn.addEventListener("click", () => {
                            popupComponent.disableEditing = false;
                            popupComponent.update();
                        });
                    }
                    this.sketchPopupFlowItem.setFocus();
                    this.sketchPopupFlowItem.beforeBack = async () => await popupComponent.done();
                    this.mapView.closePopup();
                    if (((_b = this.currentSketchInfo.graphics) === null || _b === void 0 ? void 0 : _b.length) && this.currentSketchInfo.popup) {
                        this.mapView.openPopup({
                            features: [this.currentSketchInfo.graphics[0]],
                            location: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_9__.o)(this.currentSketchInfo.graphics[0].geometry)
                        });
                    }
                }
            } }, this.strings.popup));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) }, (!isBulk || identicalSymbolTypes) && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "recent-symbols" }, recentSymbols), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sketch-content" }, sketchTitle, popupBtn, (() => {
            if (!isBulk || identicalSymbolTypes) {
                switch (this.currentSketchInfo.tool) {
                    case "point":
                        return point;
                    case "text":
                        return text;
                    case "polyline":
                        return polyline;
                    case "polygon":
                    case "rectangle":
                    case "circle":
                        return polygon;
                    default:
                        return null;
                }
            }
        })()))));
    }
    handleRecentSymbolSelect(idx) {
        this.updateSymbol(this.symbolNodes[idx], true, true, this.textContentEl ? "recent-text" : undefined);
        this.divNodes[0].focus();
    }
    async afterCreateDiv(node, symbol, idx) {
        var _a;
        let formattedSymbol;
        // display a symbol chosen from the panel
        if (["simple-line", "simple-fill", "picture-marker", "picture-fill", "text", "cim"].indexOf(symbol.type) > -1) {
            if (symbol.type === "text") {
                symbol.text = this.strings.textPreview;
            }
            formattedSymbol = symbol;
            // display a symbol whose JSON is in local storage
        }
        else {
            switch (symbol.type) {
                case "CIMSymbolReference":
                    formattedSymbol = this.CIMSymbol.fromJSON(symbol);
                    break;
                case "esriSLS":
                    formattedSymbol = this.SimpleLineSymbol.fromJSON(symbol);
                    break;
                case "esriSFS":
                    formattedSymbol = this.SimpleFillSymbol.fromJSON(symbol);
                    break;
                case "esriPMS":
                    formattedSymbol = this.PictureMarkerSymbol.fromJSON(symbol);
                    break;
                case "esriPFS":
                    formattedSymbol = this.PictureFillSymbol.fromJSON(symbol);
                    break;
                case "esriTS":
                    formattedSymbol = this.TextSymbol.fromJSON(symbol);
                    break;
            }
        }
        while ((_a = node === null || node === void 0 ? void 0 : node.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            node.removeChild(node.childNodes[0]);
        }
        const previewSymbol = formattedSymbol.clone();
        if (previewSymbol.type === "text") {
            previewSymbol.haloSize = Math.min(2, previewSymbol.haloSize);
        }
        if (previewSymbol.type === "simple-line") {
            previewSymbol.width = Math.min(2, previewSymbol.width);
        }
        const options = {
            maxSize: 24,
            scale: true,
            size: previewSymbol.type === "simple-line"
                ? { width: this.recentSymbolsContainerEl.clientWidth / 9 }
                : { width: 24, height: 24 }
        };
        if (previewSymbol) {
            await this.symbolUtils
                .renderPreviewHTML(previewSymbol, options)
                .then((element) => {
                if (element) {
                    node.append(element);
                    this.symbolNodes[idx] = formattedSymbol;
                }
            });
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchContent.style = arcgisSketchContentCss;

const arcgisSketchShortcutsCss = ".sketch-shortcut{background-color:var(--arcgis-app-background);display:grid;grid-template-columns:21% auto;row-gap:var(--arcgis-app-cap-spacing-half);padding:var(--arcgis-app-cap-spacing-half)}.sketch-shortcut-chip{margin-right:var(--arcgis-app-cap-spacing-half)}.sketch-shortcut-label{align-self:center}.popover{z-index:100}.arcgis--rtl .sketch-shortcut{max-height:40vh}.arcgis--rtl .sketch-shortcut-chip{margin-left:var(--arcgis-app-cap-spacing-half);margin-right:0}";

const ArcgisSketchShortcuts = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSketchShortcutsDismissedChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSketchShortcutsDismissedChange", 7);
        this.refElement = undefined;
        this.isOpen = false;
    }
    componentWillLoad() {
        this.strings = sketchState.strings;
    }
    componentDidLoad() {
        this.isOpen = true;
    }
    async reposition() {
        var _a;
        (_a = this.sketchShortcutsPopover) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    render() {
        const isRtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl";
        const placement = !isRtl ? "leading-start" : "trailing-start";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), class: "popover " + ((0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement) === "rtl" ? _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl : ""), ref: (el) => (this.sketchShortcutsPopover = el), placement: placement, open: this.isOpen, pointerDisabled: true, referenceElement: this.refElement, offsetDistance: -Math.round(this.refElement.getBoundingClientRect().width), offsetSkidding: 0, label: this.strings.sketchShortcuts }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: this.strings.sketchShortcuts, closable: true, style: {
                width: `${Math.max(this.refElement.getBoundingClientRect().width, 375)}px`
            }, onCalcitePanelClose: () => this.arcgisSketchShortcutsDismissedChange.emit() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sketch-shortcut" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Ctrl", scale: "m" }, "Ctrl"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.ctrlShortcut), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Enter", scale: "m" }, "Enter"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.cShortcut), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Z", scale: "m" }, "Z"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.zShortcut), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "R", scale: "m" }, "R"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.rShortcut), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "sketch-shortcut-chip", value: "Esc", scale: "m" }, "Esc"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "sketch-shortcut-label" }, this.strings.escShortcut))))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchShortcuts.style = arcgisSketchShortcutsCss;

const arcgisSketchSnappingCss = ".content{max-height:60vh}";

const ArcgisSketchSnapping = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.closeSketchSnappingPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeSketchSnappingPopovers", 7);
        this.refElement = undefined;
    }
    async componentWillLoad() {
        this.strings = sketchState.strings;
        this.mapView = sketchState.mapView;
        this.snappingOptions = sketchState.snappingOptions;
        this.snappingSessionStorageIds = sketchState.snappingSessionStorageIds;
        this.sketchTooltipOptions = sketchState.sketchTooltipOptions;
        this.sketchTooltipSessionStorageIds = sketchState.sketchTooltipSessionStorageIds;
        await this.loadAllModules();
        this.addSnappingWidget();
        this.addTooltipsWidget();
    }
    componentDidLoad() {
        this.snappingControls.container = this.snappingControlDiv;
        this.sketchTooltipControls.container = this.sketchTooltipControlDiv;
    }
    disconnectedCallback() {
        var _a, _b;
        (_a = this.snappingControls) === null || _a === void 0 ? void 0 : _a.destroy();
        (_b = this.sketchTooltipControls) === null || _b === void 0 ? void 0 : _b.destroy();
    }
    async reposition() {
        var _a;
        (_a = this.sketchSnappingPopover) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    async loadAllModules() {
        const [SnappingControls, SketchTooltipControls] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__.l)([
            "esri/widgets/support/SnappingControls",
            "esri/widgets/support/SketchTooltipControls"
        ]);
        this.SnappingControls = SnappingControls;
        this.SketchTooltipControls = SketchTooltipControls;
    }
    addSnappingWidget() {
        this.snappingControls = new this.SnappingControls({
            view: this.mapView,
            snappingOptions: sketchState.snappingOptions,
            visibleElements: {
                header: false
            }
        });
    }
    addTooltipsWidget() {
        this.sketchTooltipControls = new this.SketchTooltipControls({
            view: this.mapView,
            tooltipOptions: sketchState.sketchTooltipOptions,
            visibleElements: {
                tooltipsToggle: true,
                labelsToggle: false
            }
        } /* __esri.SketchTooltipControlsProperties */);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), placement: "leading-start", ref: (el) => (this.sketchSnappingPopover = el), open: true, pointerDisabled: true, referenceElement: this.refElement, offsetDistance: -Math.round(this.refElement.getBoundingClientRect().width), offsetSkidding: 0, label: this.strings.settings, style: {
                zIndex: "100"
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { closable: true, headingLevel: 2, heading: this.strings.settings, style: {
                width: `${this.refElement.getBoundingClientRect().width}px`
            }, onCalcitePanelClose: () => {
                var _a, _b;
                if ((_a = this.snappingSessionStorageIds) === null || _a === void 0 ? void 0 : _a.current) {
                    saveSnappingToStorage(this.snappingOptions, this.snappingSessionStorageIds.current);
                }
                if ((_b = this.sketchTooltipSessionStorageIds) === null || _b === void 0 ? void 0 : _b.current) {
                    saveSketchTooltipToStorage(this.sketchTooltipOptions, this.sketchTooltipSessionStorageIds.current);
                }
                this.closeSketchSnappingPopovers.emit();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.sketchTooltipControlDiv = el) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.snappingControlDiv = el) }))))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchSnapping.style = arcgisSketchSnappingCss;

const arcgisSketchToolsCss = ".popover{z-index:100}";

const ArcgisSketchTools = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.sketchActionOnDrawFeatures = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnDrawFeatures", 7);
        this.sketchActionOnSelectFeatures = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "sketchActionOnSelectFeatures", 7);
        this.refElement = undefined;
        this.mapNotesFeatures = null;
        this.sketchToolsToHide = [];
        this.activeSketchTool = undefined;
        this.hideSelectionTools = false;
        this.isOpen = false;
    }
    componentWillLoad() {
        this.strings = sketchState.strings;
        this.svModel = sketchState.svModel;
        this.layer = sketchState.layer;
        this.isOpen = true;
    }
    componentDidLoad() {
        var _a;
        // select mode if feature is available, else default add point mode
        if ((_a = this.mapNotesFeatures) === null || _a === void 0 ? void 0 : _a.length) {
            let tempPoint = [];
            let tempLine = [];
            let tempPolygon = [];
            let tempText = [];
            this.mapNotesFeatures.forEach((currGraphic) => {
                switch (getGeometryTypeFromGraphic(currGraphic)) {
                    case "polyline":
                        tempLine = [...tempLine, currGraphic];
                        break;
                    case "polygon":
                        tempPolygon = [...tempPolygon, currGraphic];
                        break;
                    case "text":
                        tempText = [...tempText, currGraphic];
                        break;
                    default:
                        tempPoint = [...tempPoint, currGraphic];
                        break;
                }
            });
            tempPoint.length && this.svModel.updatePoint(tempPoint);
            tempLine.length && this.svModel.updateLine(tempLine);
            tempPolygon.length && this.svModel.updatePolygon(tempPolygon);
            tempText.length && this.svModel.updateText(tempText);
        }
        else {
            const sketchToolsMapping = {
                point: this.sketchPointElement,
                polygon: this.sketchPolygonElement,
                polyline: this.sketchPolyLineElement,
                circle: this.sketchCircleElement,
                rectangle: this.sketchRectangleElement,
                text: this.sketchTextElement
            };
            let activeSketchElementString;
            let activeSketchElement;
            if (this.activeSketchTool) {
                activeSketchElementString = this.activeSketchTool;
                activeSketchElement = sketchToolsMapping[activeSketchElementString];
            }
            else {
                // Have next non-hidden tool be the defaulted selected tool
                let sketchTools = [
                    "point",
                    "polyline",
                    "polygon",
                    "rectangle",
                    "circle",
                    "text"
                ];
                sketchTools = sketchTools.filter((tool) => !this.sketchToolsToHide.includes(tool));
                activeSketchElementString = sketchTools.length ? sketchTools[0] : "point";
                activeSketchElement = sketchToolsMapping[activeSketchElementString];
            }
            this.actionOnDrawFeatures(activeSketchElementString, this.strings.addStamp, activeSketchElement);
        }
    }
    async reposition() {
        var _a;
        (_a = this.sketchToolsPopoverElement) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    actionOnDrawFeatures(tool, sketchMessage, currentActionElement) {
        this.clearActiveSelection();
        currentActionElement.active = true;
        this.sketchActionOnDrawFeatures.emit({
            tool: tool,
            sketchMessage: sketchMessage
        });
    }
    actionOnSelectFeatures(sketchMessage, currentActionElement, multipleSelectTool) {
        const { active = false } = currentActionElement;
        this.clearActiveSelection();
        currentActionElement.active = !active;
        this.svModel.cancel();
        this.sketchActionOnSelectFeatures.emit({
            sketchMessage: !active ? sketchMessage : "",
            multipleSelectTool: (!active && multipleSelectTool) || null
        });
    }
    clearActiveSelection() {
        const sketchTools = [
            this.sketchPointElement,
            this.sketchPolyLineElement,
            this.sketchPolygonElement,
            this.sketchRectangleElement,
            this.sketchCircleElement,
            this.sketchTextElement,
            this.sketchSelectElement,
            this.sketchRectangleSelectElement,
            this.sketchLassoSelectElement
        ];
        sketchTools.forEach((sketchTool) => {
            if (sketchTool) {
                sketchTool.active = false;
            }
        });
    }
    render() {
        const drawFeatures = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", { layout: "vertical" }, !this.sketchToolsToHide.includes("point") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPointElement = el), text: this.strings.stamp, label: this.strings.stamp, title: this.strings.stamp, icon: "pin", scale: "m", alignment: "center", onClick: () => {
                this.actionOnDrawFeatures("point", this.strings.addStamp, this.sketchPointElement);
            } })), !this.sketchToolsToHide.includes("polyline") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPolyLineElement = el), text: this.strings.line, label: this.strings.line, title: this.strings.line, icon: "line", scale: "m", alignment: "center", onClick: () => {
                this.actionOnDrawFeatures("polyline", this.strings.startFinishDrawing, this.sketchPolyLineElement);
            } })), !this.sketchToolsToHide.includes("polygon") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchPolygonElement = el), text: this.strings.polygon, label: this.strings.polygon, title: this.strings.polygon, icon: "polygon", scale: "m", alignment: "center", onClick: () => {
                this.actionOnDrawFeatures("polygon", this.strings.startFinishDrawing, this.sketchPolygonElement);
            } })), !this.sketchToolsToHide.includes("rectangle") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchRectangleElement = el), text: this.strings.rectangle, label: this.strings.rectangle, title: this.strings.rectangle, icon: "rectangle", scale: "m", alignment: "center", onClick: () => {
                this.actionOnDrawFeatures("rectangle", this.strings.addRectangle, this.sketchRectangleElement);
            } })), !this.sketchToolsToHide.includes("circle") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchCircleElement = el), text: this.strings.circle, label: this.strings.circle, title: this.strings.circle, icon: "circle", scale: "m", alignment: "center", onClick: () => {
                this.actionOnDrawFeatures("circle", this.strings.addCircle, this.sketchCircleElement);
            } })), !this.sketchToolsToHide.includes("text") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchTextElement = el), text: this.strings.text, label: this.strings.text, title: this.strings.text, icon: "text", scale: "m", alignment: "center", onClick: async () => {
                this.actionOnDrawFeatures("text", this.strings.addText, this.sketchTextElement);
            } }))));
        const selectFeatures = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-group", { layout: "vertical" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchSelectElement = el), text: this.strings.select, label: this.strings.select, title: this.strings.select, icon: "cursor", scale: "m", alignment: "center", onClick: () => {
                this.actionOnSelectFeatures(this.strings.selectText, this.sketchSelectElement);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchRectangleSelectElement = el), text: this.strings.rectangleSelect, label: this.strings.rectangleSelect, title: this.strings.rectangleSelect, icon: "cursor-marquee", scale: "m", alignment: "center", onClick: () => {
                this.actionOnSelectFeatures(this.strings.rectangleLassoSelect, this.sketchRectangleSelectElement, "rectangle");
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.sketchLassoSelectElement = el), text: this.strings.lassoSelect, label: this.strings.lassoSelect, title: this.strings.lassoSelect, icon: "lasso", scale: "m", alignment: "center", onClick: () => {
                this.actionOnSelectFeatures(this.strings.rectangleLassoSelect, this.sketchLassoSelectElement, "lasso");
            } })));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement), ref: (el) => (this.sketchToolsPopoverElement = el), placement: "leading-start", open: this.isOpen, referenceElement: this.refElement, offsetDistance: 15, pointerDisabled: true, focusTrapDisabled: true, triggerDisabled: true, label: this.strings.sketch, class: "popover", onCalcitePopoverBeforeClose: () => (this.sketchToolsPopoverElement.open = true) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action-pad", { position: "start", layout: "vertical", expandDisabled: true }, drawFeatures, !this.hideSelectionTools && selectFeatures))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSketchTools.style = arcgisSketchToolsCss;



//# sourceMappingURL=arcgis-sketch_5.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};



//# sourceMappingURL=index-05956cab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ setSessionStorageItem),
/* harmony export */   b: () => (/* binding */ getSessionStorageItem),
/* harmony export */   c: () => (/* binding */ getCookie),
/* harmony export */   d: () => (/* binding */ setCookie),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
    writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
    const cookie = readCookie(name);
    return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
    window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
    const item = window.localStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
    window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
    const item = window.sessionStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
    const cookie = document.cookie;
    const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
    const matchedCookies = cookie.match(cookieNameRE);
    return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
    properties = properties || {};
    let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
    if (typeof expires === "number") {
        const expirationDate = new Date();
        const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
        expirationDate.setTime(Date.now() + daysFromTodayInMs);
        expires = properties.expires = expirationDate;
    }
    if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
        properties.expires = expires.toUTCString();
    }
    let cookie = `${name}=${encodeURIComponent(value)}`;
    let property;
    for (property in properties) {
        cookie += `; ${property}`;
        const propertyValue = properties[property];
        if (propertyValue !== true) {
            cookie += `=${propertyValue}`;
        }
    }
    document.cookie = cookie;
}



//# sourceMappingURL=storage-0353a769.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWNiZTk2NC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzhJO0FBQ3hFO0FBQ1k7QUFDckI7QUFDc0Y7QUFDekY7QUFDRztBQUNOO0FBQ2U7QUFDNkI7QUFDVjtBQUM5RDs7QUFFM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHVEQUFxQjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0Msc0JBQXNCO0FBQzVEO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix1REFBcUI7QUFDckMsWUFBWSx1REFBcUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyw2QkFBNkI7QUFDakU7QUFDQSxvQ0FBb0MsaUNBQWlDO0FBQ3JFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDZCQUE2QjtBQUNqRTtBQUNBLG9DQUFvQyxpQ0FBaUM7QUFDckU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsNkJBQTZCO0FBQ2pFO0FBQ0Esb0NBQW9DLGlDQUFpQztBQUNyRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyw2QkFBNkI7QUFDakU7QUFDQSxvQ0FBb0MsaUNBQWlDO0FBQ3JFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG1CQUFtQjtBQUNwRDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsZ0JBQWdCO0FBQ3ZEO0FBQ0E7QUFDQSxpQ0FBaUMsMENBQTBDO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGVBQWU7QUFDdEQ7QUFDQTtBQUNBLGlDQUFpQyw0Q0FBNEM7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLHVEQUFXO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSwwREFBUztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVEQUFXO0FBQ25CO0FBQ0EsYUFBYSwwREFBUztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsdURBQVc7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLDBEQUFTO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdURBQVc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsdURBQVcsc0JBQXNCLHVEQUFXO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdURBQVc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSx1REFBcUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHVEQUFxQjtBQUNyQyxZQUFZLHVEQUFxQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0IscURBQVc7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDs7QUFFQSwrQkFBK0IsYUFBYSxjQUFjLGdCQUFnQixzQkFBc0IsNENBQTRDLFVBQVUsYUFBYSwyQ0FBMkMsOENBQThDLGdCQUFnQiwyQ0FBMkMsd0JBQXdCLG1CQUFtQixvQkFBb0IsYUFBYSxtQ0FBbUMsaUJBQWlCLHFDQUFxQyxtQkFBbUIsa0JBQWtCOztBQUVqZ0I7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDZCQUE2QixxREFBVztBQUN4QywyQ0FBMkMscURBQVc7QUFDdEQsMENBQTBDLHFEQUFXO0FBQ3JELHdDQUF3QyxxREFBVztBQUNuRCxxQ0FBcUMscURBQVc7QUFDaEQsbUNBQW1DLHFEQUFXO0FBQzlDLGtDQUFrQyxxREFBVztBQUM3QyxxQ0FBcUMscURBQVc7QUFDaEQsa0NBQWtDLHFEQUFXO0FBQzdDLDJDQUEyQyxxREFBVztBQUN0RCw0Q0FBNEMscURBQVc7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlHQUFpRyxRQUFRLGtHQUFrRztBQUMzTTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvQkFBb0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsc0RBQXlCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvR0FBb0csMERBQVM7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDBEQUFTLGtDQUFrQywwREFBUztBQUNwRjtBQUNBO0FBQ0EsZ0NBQWdDLDBEQUFTO0FBQ3pDLGdDQUFnQywwREFBUztBQUN6QztBQUNBO0FBQ0EsZ0NBQWdDLDBEQUFTO0FBQ3pDLGdDQUFnQywwREFBUztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLFVBQVUsdUJBQXVCO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELFVBQVUscUNBQXFDO0FBQy9GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUZBQXFGLFFBQVEsa0dBQWtHO0FBQy9MO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDJEQUFXO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxvQkFBb0IsWUFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEdBQThHLE9BQU87QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHFEQUFDLHFCQUFxQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmLHdDQUF3QyxxREFBQyxvQkFBb0Isd0RBQXdEO0FBQ3JIO0FBQ0EsdURBQXVELE9BQU87QUFDOUQsZ0NBQWdDLHFEQUFDLHFCQUFxQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixnQ0FBZ0MscURBQUMscUJBQXFCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixtQ0FBbUMscURBQUMscUJBQXFCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixxQ0FBcUMscURBQUMsVUFBVSxpRUFBaUUsRUFBRSxxREFBQyxxQkFBcUI7QUFDekk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxHQUFHLHFEQUFDLHFCQUFxQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZiwrQkFBK0IscURBQUMsVUFBVSxzREFBc0QsRUFBRSxxREFBQyxxQkFBcUIsb0pBQW9KLEVBQUUscURBQUMsVUFBVSxpQkFBaUI7QUFDMVMsZ0JBQWdCLHFEQUFDLG1CQUFtQixzQ0FBc0MsNERBQWEsMkJBQTJCLDREQUFhLCtCQUErQix3REFBVyxXQUFXLEVBQUUscURBQUMsd0JBQXdCLGdKQUFnSixvS0FBb0sscURBQUMsVUFBVSw2QkFBNkIsMEJBQTBCLHFEQUFDLFVBQVUsb0RBQW9ELDBGQUEwRixxREFBQyw0QkFBNEIsa0tBQWtLO0FBQzc1QjtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLENBQUMsaURBQUksSUFBSSwrQkFBK0I7QUFDekQ7QUFDQSx3QkFBd0IsT0FBTyxxREFBVTtBQUN6QztBQUNBOztBQUVBLGdEQUFnRCxhQUFhLHNCQUFzQiw4Q0FBOEMsMEVBQTBFLHNDQUFzQyxpQkFBaUIsK0NBQStDLDRDQUE0QyxVQUFVLGFBQWEsbUJBQW1CLDhCQUE4QixrQkFBa0IseUJBQXlCLFVBQVUsK0JBQStCLFVBQVUsd0NBQXdDLDBDQUEwQyxxQkFBcUIsb0JBQW9CLGdCQUFnQixhQUFhLHNCQUFzQiwwRUFBMEUsV0FBVyw4Q0FBOEMsK0NBQStDLGlCQUFpQixhQUFhLG1CQUFtQiw2QkFBNkIsUUFBUSxZQUFZLGFBQWEsbUJBQW1CLGVBQWUsY0FBYywwQ0FBMEMsbUJBQW1CLG1CQUFtQixnQkFBZ0IsYUFBYSxtQkFBbUIscUJBQXFCLGdCQUFnQixZQUFZLFlBQVksZ0JBQWdCOztBQUUvc0M7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLG9DQUFvQyxxREFBVztBQUMvQyx1Q0FBdUMscURBQVc7QUFDbEQsa0NBQWtDLHFEQUFXO0FBQzdDLDhDQUE4QyxxREFBVztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELHFEQUFxQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwrREFBa0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEU7QUFDQSw4QkFBOEIsdURBQW1CO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBEQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxhQUFhO0FBQzNEO0FBQ0EsaUNBQWlDLHVEQUFtQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLFVBQVUseUJBQXlCO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkRBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywwREFBUztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLDRCQUE0QjtBQUMxRTtBQUNBLFlBQVksdURBQW1CO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLHFCQUFxQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw0REFBYTtBQUNuQztBQUNBO0FBQ0E7QUFDQSx1QkFBdUIscURBQUMsMkJBQTJCLDZSQUE2UixVQUFVLHdCQUF3QjtBQUNsWDtBQUNBLGFBQWEseUNBQXlDLGtCQUFrQixrRUFBa0U7QUFDMUksMEJBQTBCLHFEQUFDLDJCQUEyQixzU0FBc1MsVUFBVSx3QkFBd0I7QUFDOVg7QUFDQSxhQUFhLHlDQUF5QyxrQkFBa0IscUVBQXFFO0FBQzdJLHlCQUF5QixxREFBQywyQkFBMkIsbVNBQW1TLFVBQVUsd0JBQXdCO0FBQzFYO0FBQ0EsYUFBYSx5Q0FBeUMsa0JBQWtCLG9FQUFvRTtBQUM1STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixxREFBQyw4Q0FBOEMscURBQUMsb0JBQW9CO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLG9EQUFvRDtBQUNqRSxxQ0FBcUMscURBQUMsMkNBQTJDLHFEQUFDLHFCQUFxQixrSEFBa0gseURBQWM7QUFDdk8sa0JBQWtCLG9EQUFvRCw2REFBNkQsRUFBRSx5REFBYztBQUNuSiw4QkFBOEIscURBQUMsMkNBQTJDLHFEQUFDLDJCQUEyQix3Q0FBd0Msb0pBQW9KO0FBQ2xTO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsaURBQWlEO0FBQzlELDJCQUEyQixxREFBQyw0Q0FBNEMscURBQUMseUJBQXlCO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmLDBCQUEwQixxREFBQywrQ0FBK0MscURBQUMsVUFBVSxtQkFBbUIsRUFBRSxxREFBQyxxQkFBcUIsaVVBQWlVLEdBQUcscURBQUMsMkJBQTJCLDZHQUE2RywwRkFBMEY7QUFDdnFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsaURBQWlEO0FBQzlELDJCQUEyQixxREFBQyw0QkFBNEI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxFQUFFLHFEQUFDLFVBQVUscUJBQXFCLEVBQUUscURBQUMsNENBQTRDLHFEQUFDLHlCQUF5QjtBQUMxSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxJQUFJLHFEQUFDLDJDQUEyQyxxREFBQywyQkFBMkIsdUNBQXVDLG9HQUFvRztBQUN0TztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlEQUFpRDtBQUM5RCxzQkFBc0IscURBQUM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixxREFBQyxDQUFDLGlEQUFRLFFBQVEscURBQUMscURBQXFELHFEQUFDLFVBQVUsMkVBQTJFO0FBQzdMLG1DQUFtQyxxREFBQyxVQUFVO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkIsU0FBUyxNQUFNLHFEQUFDLFVBQVUscURBQXFELDBDQUEwQyxLQUFLLHdCQUF3QixxREFBQyxxQkFBcUI7QUFDNUs7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELDRCQUE0QjtBQUM5RTtBQUNBO0FBQ0EsZ0JBQWdCLHVEQUFtQjtBQUNuQyxnQkFBZ0IscURBQVc7QUFDM0IsZUFBZTtBQUNmLDZCQUE2QixxREFBQyxvQkFBb0IsdUJBQXVCLHNCQUFzQixxREFBQyw4QkFBOEIsWUFBWSxFQUFFLHFEQUFDLG9CQUFvQjtBQUNqSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGVBQWU7QUFDZiwwQkFBMEIscURBQUMscUJBQXFCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELHVEQUFvQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsK0RBQW9CO0FBQzFELHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsZUFBZTtBQUNmLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsVUFBVSxLQUFLLDREQUFhLG9CQUFvQix1Q0FBdUMscURBQUMsVUFBVSx5QkFBeUIsa0JBQWtCLHFEQUFDLFVBQVUseUJBQXlCO0FBQ2hOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRUEsbURBQW1ELDhDQUE4QyxhQUFhLCtCQUErQiwyQ0FBMkMsMkNBQTJDLHNCQUFzQixnREFBZ0QsdUJBQXVCLGtCQUFrQixTQUFTLFlBQVksOEJBQThCLGdCQUFnQixtQ0FBbUMsK0NBQStDLGVBQWU7O0FBRXRmO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QixvREFBb0QscURBQVc7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw0REFBYTtBQUNuQztBQUNBLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLElBQUksd0JBQXdCLEVBQUUscURBQUMsc0JBQXNCLEtBQUssNERBQWEseUNBQXlDLDREQUFhLCtCQUErQix3REFBVyxvU0FBb1MsRUFBRSxxREFBQyxvQkFBb0I7QUFDeGYsMEJBQTBCLDZEQUE2RDtBQUN2RixhQUFhLCtFQUErRSxFQUFFLHFEQUFDLFVBQVUsMEJBQTBCLEVBQUUscURBQUMsbUJBQW1CLDBEQUEwRCxXQUFXLHFEQUFDLG9CQUFvQixnQ0FBZ0MsOEJBQThCLHFEQUFDLG1CQUFtQiwyREFBMkQsWUFBWSxxREFBQyxvQkFBb0IsZ0NBQWdDLDJCQUEyQixxREFBQyxtQkFBbUIsdURBQXVELFFBQVEscURBQUMsb0JBQW9CLGdDQUFnQywyQkFBMkIscURBQUMsbUJBQW1CLHVEQUF1RCxRQUFRLHFEQUFDLG9CQUFvQixnQ0FBZ0MsMkJBQTJCLHFEQUFDLG1CQUFtQix5REFBeUQsVUFBVSxxREFBQyxvQkFBb0IsZ0NBQWdDO0FBQzk2QjtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRUEsMENBQTBDLGdCQUFnQjs7QUFFMUQ7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDJDQUEyQyxxREFBVztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0UsMkRBQVc7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxJQUFJLHdCQUF3QixFQUFFLHFEQUFDLHNCQUFzQixLQUFLLDREQUFhO0FBQzdGO0FBQ0EsZUFBZSxFQUFFLHFEQUFDLG9CQUFvQjtBQUN0QywwQkFBMEIsOENBQThDO0FBQ3hFLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxFQUFFLHFEQUFDLFVBQVUsa0JBQWtCLEVBQUUscURBQUMsVUFBVSxrREFBa0QsR0FBRyxxREFBQyxVQUFVLDZDQUE2QztBQUN4SztBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRUEsdUNBQXVDLFlBQVk7O0FBRW5EO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QiwwQ0FBMEMscURBQVc7QUFDckQsNENBQTRDLHFEQUFXO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxnQkFBZ0IsaUJBQWlCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw4QkFBOEIscURBQUMsMkJBQTJCLG9CQUFvQixnREFBZ0QscURBQUMscUJBQXFCO0FBQ3BKO0FBQ0EsZUFBZSxxREFBcUQscURBQUMscUJBQXFCO0FBQzFGO0FBQ0EsZUFBZSxvREFBb0QscURBQUMscUJBQXFCO0FBQ3pGO0FBQ0EsZUFBZSxzREFBc0QscURBQUMscUJBQXFCO0FBQzNGO0FBQ0EsZUFBZSxtREFBbUQscURBQUMscUJBQXFCO0FBQ3hGO0FBQ0EsZUFBZSxpREFBaUQscURBQUMscUJBQXFCO0FBQ3RGO0FBQ0EsZUFBZTtBQUNmLGdDQUFnQyxxREFBQywyQkFBMkIsb0JBQW9CLEVBQUUscURBQUMscUJBQXFCO0FBQ3hHO0FBQ0EsZUFBZSxHQUFHLHFEQUFDLHFCQUFxQjtBQUN4QztBQUNBLGVBQWUsR0FBRyxxREFBQyxxQkFBcUI7QUFDeEM7QUFDQSxlQUFlO0FBQ2YsZ0JBQWdCLHFEQUFDLENBQUMsaURBQUksSUFBSSx3QkFBd0IsRUFBRSxxREFBQyxzQkFBc0IsS0FBSyw0REFBYSxvWEFBb1gsRUFBRSxxREFBQyx5QkFBeUIsNkRBQTZEO0FBQzFpQjtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRW1POztBQUVuTzs7Ozs7Ozs7Ozs7Ozs7O0FDdGdGQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RTs7QUFFN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLGVBQWUsaURBQWU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixxREFBZTtBQUN2QztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELGlEQUFXO0FBQ3RFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSx3REFBd0QsaURBQVc7QUFDbkU7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrSEFBa0g7QUFDbEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1R0FBdUc7QUFDdkc7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEI7O0FBRTVCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3ZNQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RDs7QUFFN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLEdBQUcsMERBQVksT0FBTyxLQUFLO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixLQUFLLEdBQUcsMEJBQTBCO0FBQ3REO0FBQ0E7QUFDQSxxQkFBcUIsRUFBRSxTQUFTO0FBQ2hDO0FBQ0E7QUFDQSwwQkFBMEIsY0FBYztBQUN4QztBQUNBO0FBQ0E7QUFDQTs7QUFFc0o7O0FBRXRKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNrZXRjaF81LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2luZGV4LTA1OTU2Y2FiLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JhZ2UtMDM1M2E3NjkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIsIEMgYXMgQ1NTX1VUSUxJVFkgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBhIGFzIHNldFNlc3Npb25TdG9yYWdlSXRlbSwgYiBhcyBnZXRTZXNzaW9uU3RvcmFnZUl0ZW0sIGcgYXMgZ2V0TG9jYWxTdG9yYWdlSXRlbSwgcyBhcyBzZXRMb2NhbFN0b3JhZ2VJdGVtIH0gZnJvbSAnLi9zdG9yYWdlLTAzNTNhNzY5LmpzJztcbmltcG9ydCB7IGkgYXMgaXNEZWZpbmVkIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGUgYXMgZXNyaU1vZHVsZXMgfSBmcm9tICcuL3N5bWJvbFV0aWxzLWYyMDdkOTc5LmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCB7IGwgYXMgbGF5ZXJEaXNwbGF5VHlwZUVudW0gfSBmcm9tICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IHEgYXMgcXVlcnlQYXJlbnRFbGVtZW50LCBvIGFzIGdldFBvaW50RnJvbUdlb21ldHJ5IH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuaW1wb3J0IHsgZiBhcyBmZWF0dXJlU2VydmljZUZvbnRNYXAsIGIgYXMgZm9udFRvRm9udE5hbWUgfSBmcm9tICcuL2ZvbnRVdGlsLWJiZTVkMDNkLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBzdWdnZXN0ZWRDb2xvckxpc3QgPSBbXG4gICAgXCIjZmY0MDQwXCIsXG4gICAgXCIjZmY4MjAyXCIsXG4gICAgXCIjZmFhODNlXCIsXG4gICAgXCIjZmZkMTU5XCIsXG4gICAgXCIjNzNiNTY2XCIsXG4gICAgXCIjMDA4OTc3XCIsXG4gICAgXCIjMzNlM2M4XCIsXG4gICAgXCIjNDNhYmViXCIsXG4gICAgXCIjNGI2NGM5XCIsXG4gICAgXCIjOTg2OGVkXCIsXG4gICAgXCIjYjA1NWU2XCIsXG4gICAgXCIjZGI1MTgxXCIsXG4gICAgXCIjZTAzYjk5XCIsXG4gICAgXCIjMmIyYjJiXCIsXG4gICAgXCIjYmRiZGJkXCIsXG4gICAgXCIjZmZmZmZmXCJcbl07XG5jb25zdCBzYXZlZENvbG9yTGlzdCA9IFtcbiAgICBcIiNmZmZmZmZcIixcbiAgICBcIiNiZGJkYmRcIixcbiAgICBcIiMyYjJiMmJcIixcbiAgICBcIiNlMDNiOTlcIixcbiAgICBcIiNkYjUxODFcIixcbiAgICBcIiNiMDU1ZTZcIixcbiAgICBcIiM5ODY4ZWRcIixcbiAgICBcIiM0YjY0YzlcIixcbiAgICBcIiM0M2FiZWJcIixcbiAgICBcIiMzM2UzYzhcIixcbiAgICBcIiMwMDg5NzdcIixcbiAgICBcIiM3M2I1NjZcIixcbiAgICBcIiNmZmQxNTlcIixcbiAgICBcIiNmYWE4M2VcIixcbiAgICBcIiNmZjgyMDJcIixcbiAgICBcIiNmZjQwNDBcIlxuXTtcblxuZnVuY3Rpb24gZ2V0R2VvbWV0cnlUeXBlRnJvbUdyYXBoaWMoY3VyckdyYXBoaWMpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHN3aXRjaCAoKF9hID0gY3VyckdyYXBoaWMgPT09IG51bGwgfHwgY3VyckdyYXBoaWMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJHcmFwaGljLmdlb21ldHJ5KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkge1xuICAgICAgICBjYXNlIFwicG9pbnRcIjpcbiAgICAgICAgICAgIGlmICgoKF9iID0gY3VyckdyYXBoaWMgPT09IG51bGwgfHwgY3VyckdyYXBoaWMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJHcmFwaGljLnN5bWJvbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnR5cGUpID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInRleHRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInBvaW50XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJwb2x5bGluZVwiOlxuICAgICAgICAgICAgcmV0dXJuIFwicG9seWxpbmVcIjtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBcInBvbHlnb25cIjtcbiAgICB9XG59XG5cbmNvbnN0IHNhdmVTbmFwcGluZ1RvU3RvcmFnZSA9IChzbmFwcGluZ09wdGlvbnMsIGN1cnJlbnRTbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWQpID0+IHtcbiAgICAvLyBnZXQgZW5hYmxlZCBsYXllcnMgYW5kIHNhdmUgb2JqZWN0IGluIHNlc3Npb24gc3RvcmFnZVxuICAgIGNvbnN0IGZlYXR1cmVTb3VyY2VzSWRzID0gW1xuICAgICAgICAuLi5uZXcgU2V0KFsuLi5zbmFwcGluZ09wdGlvbnMuZmVhdHVyZVNvdXJjZXMuZmlsdGVyKChzb3VyY2UpID0+IHNvdXJjZS5lbmFibGVkKS5tYXAoKHNvdXJjZSkgPT4gc291cmNlLmxheWVyLmlkKV0pXG4gICAgXTtcbiAgICBjb25zdCBzbmFwcGluZ09iamVjdCA9IHtcbiAgICAgICAgZW5hYmxlZDogc25hcHBpbmdPcHRpb25zLmVuYWJsZWQsXG4gICAgICAgIHNlbGZFbmFibGVkOiBzbmFwcGluZ09wdGlvbnMuc2VsZkVuYWJsZWQsXG4gICAgICAgIGZlYXR1cmVFbmFibGVkOiBzbmFwcGluZ09wdGlvbnMuZmVhdHVyZUVuYWJsZWQsXG4gICAgICAgIGZlYXR1cmVTb3VyY2VzSWRzOiBmZWF0dXJlU291cmNlc0lkc1xuICAgIH07XG4gICAgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtKGN1cnJlbnRTbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWQsIHNuYXBwaW5nT2JqZWN0LCB0cnVlKTtcbn07XG5jb25zdCBnZXRTbmFwcGluZ09wdGlvbnMgPSAoc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcywgbGF5ZXIsIG1hcFZpZXcsIFNuYXBwaW5nT3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IHNuYXBwaW5nID0gZ2V0U25hcHBpbmdGcm9tU3RvcmFnZShzbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzKSB8fCB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHNlbGZFbmFibGVkOiB0cnVlLFxuICAgICAgICBmZWF0dXJlRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgZmVhdHVyZVNvdXJjZXNJZHM6IFtsYXllci5pZF1cbiAgICB9O1xuICAgIHJldHVybiBuZXcgU25hcHBpbmdPcHRpb25zKHtcbiAgICAgICAgZW5hYmxlZDogc25hcHBpbmcuZW5hYmxlZCxcbiAgICAgICAgc2VsZkVuYWJsZWQ6IHNuYXBwaW5nLnNlbGZFbmFibGVkLFxuICAgICAgICBmZWF0dXJlRW5hYmxlZDogc25hcHBpbmcuZmVhdHVyZUVuYWJsZWQsXG4gICAgICAgIGZlYXR1cmVTb3VyY2VzOiBnZXRGZWF0dXJlU291cmNlc0Zyb21MYXllcklkcyhtYXBWaWV3LCBzbmFwcGluZy5mZWF0dXJlU291cmNlc0lkcylcbiAgICB9KTtcbn07XG5jb25zdCBnZXRGZWF0dXJlU291cmNlc0Zyb21MYXllcklkcyA9IChtYXBWaWV3LCBsYXllcklkcykgPT4ge1xuICAgIGNvbnN0IGZlYXR1cmVTb3VyY2VzID0gW107XG4gICAgbGF5ZXJJZHMuZm9yRWFjaCgobGF5ZXJJZCkgPT4ge1xuICAgICAgICBtYXBWaWV3Lm1hcC5hbGxMYXllcnMudG9BcnJheSgpLmZpbmQoKGxheWVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci50eXBlKSA9PT0gXCJtYXAtbm90ZXNcIiAmJiBsYXllci5pZCA9PT0gbGF5ZXJJZCkge1xuICAgICAgICAgICAgICAgIGZlYXR1cmVTb3VyY2VzLnB1c2goeyBsYXllciwgZW5hYmxlZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZlYXR1cmVTb3VyY2VzO1xufTtcbmNvbnN0IGdldFNuYXBwaW5nRnJvbVN0b3JhZ2UgPSAoc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcykgPT4ge1xuICAgIGlmIChzbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzKSB7XG4gICAgICAgIHJldHVybiAoZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMud2VibWFwLCB0cnVlKSB8fFxuICAgICAgICAgICAgZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHMuY3VycmVudCwgdHJ1ZSkgfHxcbiAgICAgICAgICAgIG51bGwpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn07XG5cbmNsYXNzIFNWTW9kZWwge1xuICAgIGNvbnN0cnVjdG9yKG1hcE5vdGVzTGF5ZXIsIG1hcFZpZXcsIFNrZXRjaFZpZXdNb2RlbCwgc25hcHBpbmdPcHRpb25zLCB0b29sdGlwT3B0aW9ucywgb25HcmFwaGljQ3JlYXRlLCBvbkdyYXBoaWNVcGRhdGUpIHtcbiAgICAgICAgdGhpcy5tYXBOb3Rlc0xheWVyID0gbWFwTm90ZXNMYXllcjtcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gbWFwVmlldztcbiAgICAgICAgLy8gcG9pbnRcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludCA9IG5ldyBTa2V0Y2hWaWV3TW9kZWwoe1xuICAgICAgICAgICAgbGF5ZXI6IHRoaXMubWFwTm90ZXNMYXllci5wb2ludExheWVyLFxuICAgICAgICAgICAgdmlldzogdGhpcy5tYXBWaWV3LFxuICAgICAgICAgICAgZGVmYXVsdENyZWF0ZU9wdGlvbnM6IHsgaGFzWjogZmFsc2UsIG1vZGU6IFwiaHlicmlkXCIgfSxcbiAgICAgICAgICAgIHVwZGF0ZU9uR3JhcGhpY0NsaWNrOiBmYWxzZSxcbiAgICAgICAgICAgIGRlZmF1bHRVcGRhdGVPcHRpb25zOiB7IG11bHRpcGxlU2VsZWN0aW9uRW5hYmxlZDogZmFsc2UgfSxcbiAgICAgICAgICAgIHNuYXBwaW5nT3B0aW9ucyxcbiAgICAgICAgICAgIHRvb2x0aXBPcHRpb25zXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50Lm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50KSk7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQub24oXCJ1cGRhdGVcIiwgKGV2ZW50KSA9PiBvbkdyYXBoaWNVcGRhdGUoZXZlbnQpKTtcbiAgICAgICAgLy8gbGluZVxuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUgPSBuZXcgU2tldGNoVmlld01vZGVsKHtcbiAgICAgICAgICAgIGxheWVyOiB0aGlzLm1hcE5vdGVzTGF5ZXIucG9seWxpbmVMYXllcixcbiAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgIGRlZmF1bHRDcmVhdGVPcHRpb25zOiB7IGhhc1o6IGZhbHNlLCBtb2RlOiBcImh5YnJpZFwiIH0sXG4gICAgICAgICAgICB1cGRhdGVPbkdyYXBoaWNDbGljazogZmFsc2UsXG4gICAgICAgICAgICBkZWZhdWx0VXBkYXRlT3B0aW9uczogeyBtdWx0aXBsZVNlbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sXG4gICAgICAgICAgICBzbmFwcGluZ09wdGlvbnMsXG4gICAgICAgICAgICB0b29sdGlwT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUpKTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLm9uKFwidXBkYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljVXBkYXRlKGV2ZW50KSk7XG4gICAgICAgIC8vIHBvbHlnb25cbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uID0gbmV3IFNrZXRjaFZpZXdNb2RlbCh7XG4gICAgICAgICAgICBsYXllcjogdGhpcy5tYXBOb3Rlc0xheWVyLnBvbHlnb25MYXllcixcbiAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgIGRlZmF1bHRDcmVhdGVPcHRpb25zOiB7IGhhc1o6IGZhbHNlLCBtb2RlOiBcImh5YnJpZFwiIH0sXG4gICAgICAgICAgICB1cGRhdGVPbkdyYXBoaWNDbGljazogZmFsc2UsXG4gICAgICAgICAgICBkZWZhdWx0VXBkYXRlT3B0aW9uczogeyBtdWx0aXBsZVNlbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sXG4gICAgICAgICAgICBzbmFwcGluZ09wdGlvbnMsXG4gICAgICAgICAgICB0b29sdGlwT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24pKTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLm9uKFwidXBkYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljVXBkYXRlKGV2ZW50KSk7XG4gICAgICAgIC8vIHRleHRcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0ID0gbmV3IFNrZXRjaFZpZXdNb2RlbCh7XG4gICAgICAgICAgICBsYXllcjogdGhpcy5tYXBOb3Rlc0xheWVyLnRleHRMYXllcixcbiAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgIGRlZmF1bHRDcmVhdGVPcHRpb25zOiB7IGhhc1o6IGZhbHNlLCBtb2RlOiBcImh5YnJpZFwiIH0sXG4gICAgICAgICAgICB1cGRhdGVPbkdyYXBoaWNDbGljazogZmFsc2UsXG4gICAgICAgICAgICBkZWZhdWx0VXBkYXRlT3B0aW9uczogeyBtdWx0aXBsZVNlbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sXG4gICAgICAgICAgICBzbmFwcGluZ09wdGlvbnMsXG4gICAgICAgICAgICB0b29sdGlwT3B0aW9uc1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0Lm9uKFwiY3JlYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljQ3JlYXRlKGV2ZW50LCB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQpKTtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0Lm9uKFwidXBkYXRlXCIsIChldmVudCkgPT4gb25HcmFwaGljVXBkYXRlKGV2ZW50KSk7XG4gICAgfVxuICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgdGhpcy5fZGVsZXRlUG9pbnQoKTtcbiAgICAgICAgdGhpcy5fZGVsZXRlTGluZSgpO1xuICAgICAgICB0aGlzLl9kZWxldGVQb2x5Z29uKCk7XG4gICAgICAgIHRoaXMuX2RlbGV0ZVRleHQoKTtcbiAgICB9XG4gICAgY2FuY2VsKCkge1xuICAgICAgICB0aGlzLl9jYW5jZWxQb2ludCgpO1xuICAgICAgICB0aGlzLl9jYW5jZWxMaW5lKCk7XG4gICAgICAgIHRoaXMuX2NhbmNlbFBvbHlnb24oKTtcbiAgICAgICAgdGhpcy5fY2FuY2VsVGV4dCgpO1xuICAgIH1cbiAgICBkdXBsaWNhdGUoKSB7XG4gICAgICAgIHRoaXMuX2R1cGxpY2F0ZVBvaW50KCk7XG4gICAgICAgIHRoaXMuX2R1cGxpY2F0ZUxpbmUoKTtcbiAgICAgICAgdGhpcy5fZHVwbGljYXRlUG9seWdvbigpO1xuICAgICAgICB0aGlzLl9kdXBsaWNhdGVUZXh0KCk7XG4gICAgfVxuICAgIHVwZGF0ZU9uR3JhcGhpYyhoaXRUZXN0LCB1cGRhdGUpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmhpdFRlc3RIYW5kbGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmUoKTtcbiAgICAgICAgaWYgKGhpdFRlc3QpIHtcbiAgICAgICAgICAgIHRoaXMuaGl0VGVzdEhhbmRsZSA9IHRoaXMubWFwVmlldy5vbihcImNsaWNrXCIsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGhpdFRlc3RSZXN1bHRzID0gYXdhaXQgdGhpcy5tYXBWaWV3LmhpdFRlc3QoZXZlbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZTogdGhpcy5tYXBOb3Rlc0xheWVyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IGhpdFRlc3RSZXN1bHRzLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNvcnQgYnkgaGl0IHRlc3Qgb3JkZXIgYW5kIGNob29zZSB0aGUgMXN0IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9IFtcInBvaW50XCIsIFwicG9seWxpbmVcIiwgXCJwb2x5Z29uXCJdO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmRlci5pbmRleE9mKGEuZ3JhcGhpYy5nZW9tZXRyeS50eXBlKSAtIG9yZGVyLmluZGV4T2YoYi5ncmFwaGljLmdlb21ldHJ5LnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VyckdyYXBoaWMgPSByZXN1bHRzWzBdLmdyYXBoaWM7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY3VyckdyYXBoaWMubGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5tYXBOb3Rlc0xheWVyLnBvaW50TGF5ZXI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb2ludChbY3VyckdyYXBoaWNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5tYXBOb3Rlc0xheWVyLnRleHRMYXllcjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVRleHQoW2N1cnJHcmFwaGljXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHRoaXMubWFwTm90ZXNMYXllci5wb2x5bGluZUxheWVyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGluZShbY3VyckdyYXBoaWNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5tYXBOb3Rlc0xheWVyLnBvbHlnb25MYXllcjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBvbHlnb24oW2N1cnJHcmFwaGljXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlKHsgc3RhdGU6IFwiY29tcGxldGVcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3lQb2ludCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95TGluZSgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95UG9seWdvbigpO1xuICAgICAgICB0aGlzLl9kZXN0cm95VGV4dCgpO1xuICAgIH1cbiAgICBnZXRQb2ludFNWTSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQ7XG4gICAgfVxuICAgIGdldFBvaW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5wb2ludFN5bWJvbDtcbiAgICB9XG4gICAgc2V0UG9pbnQoc3ltYm9sKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQucG9pbnRTeW1ib2wgPSBzeW1ib2w7XG4gICAgfVxuICAgIGNyZWF0ZVBvaW50KCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50LmNyZWF0ZShcInBvaW50XCIpO1xuICAgIH1cbiAgICB1cGRhdGVQb2ludChncmFwaGljcykge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50LnVwZGF0ZShncmFwaGljcyk7XG4gICAgfVxuICAgIF9kZWxldGVQb2ludCgpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2ludC5kZWxldGUoKTtcbiAgICB9XG4gICAgX2NhbmNlbFBvaW50KCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvaW50LmNhbmNlbCgpO1xuICAgIH1cbiAgICBfZHVwbGljYXRlUG9pbnQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQuZHVwbGljYXRlKCk7XG4gICAgfVxuICAgIF9kZXN0cm95UG9pbnQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9pbnQuZGVzdHJveSgpO1xuICAgIH1cbiAgICAvLyBsaW5lXG4gICAgZ2V0TGluZVNWTSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2tldGNoVmlld01vZGVsTGluZTtcbiAgICB9XG4gICAgZ2V0TGluZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2tldGNoVmlld01vZGVsTGluZS5wb2x5bGluZVN5bWJvbDtcbiAgICB9XG4gICAgc2V0TGluZShzeW1ib2wpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLnBvbHlsaW5lU3ltYm9sID0gc3ltYm9sO1xuICAgIH1cbiAgICBjcmVhdGVMaW5lKCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuY3JlYXRlKFwicG9seWxpbmVcIik7XG4gICAgfVxuICAgIHVwZGF0ZUxpbmUoZ3JhcGhpY3MpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLnVwZGF0ZShncmFwaGljcyk7XG4gICAgfVxuICAgIF9kZWxldGVMaW5lKCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuZGVsZXRlKCk7XG4gICAgfVxuICAgIF9jYW5jZWxMaW5lKCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuY2FuY2VsKCk7XG4gICAgfVxuICAgIF9kdXBsaWNhdGVMaW5lKCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbExpbmUuZHVwbGljYXRlKCk7XG4gICAgfVxuICAgIF9kZXN0cm95TGluZSgpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxMaW5lLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgLy8gcG9seWdvblxuICAgIGdldFBvbHlnb25TVk0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb247XG4gICAgfVxuICAgIGdldFBvbHlnb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24ucG9seWdvblN5bWJvbDtcbiAgICB9XG4gICAgc2V0UG9seWdvbihzeW1ib2wpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLnBvbHlnb25TeW1ib2wgPSBzeW1ib2w7XG4gICAgfVxuICAgIGNyZWF0ZVBvbHlnb24odG9vbCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFBvbHlnb24uY3JlYXRlKHRvb2wpO1xuICAgIH1cbiAgICB1cGRhdGVQb2x5Z29uKGdyYXBoaWNzKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9seWdvbi51cGRhdGUoZ3JhcGhpY3MpO1xuICAgIH1cbiAgICBfZGVsZXRlUG9seWdvbigpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLmRlbGV0ZSgpO1xuICAgIH1cbiAgICBfY2FuY2VsUG9seWdvbigpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLmNhbmNlbCgpO1xuICAgIH1cbiAgICBfZHVwbGljYXRlUG9seWdvbigpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hWaWV3TW9kZWxQb2x5Z29uLmR1cGxpY2F0ZSgpO1xuICAgIH1cbiAgICBfZGVzdHJveVBvbHlnb24oKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsUG9seWdvbi5kZXN0cm95KCk7XG4gICAgfVxuICAgIC8vIHRleHRcbiAgICBnZXRUZXh0U1ZNKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0O1xuICAgIH1cbiAgICBnZXRUZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5za2V0Y2hWaWV3TW9kZWxUZXh0LnBvaW50U3ltYm9sO1xuICAgIH1cbiAgICBzZXRUZXh0KHN5bWJvbCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQucG9pbnRTeW1ib2wgPSBzeW1ib2w7XG4gICAgfVxuICAgIGNyZWF0ZVRleHQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5jcmVhdGUoXCJwb2ludFwiKTtcbiAgICB9XG4gICAgdXBkYXRlVGV4dChncmFwaGljcykge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQudXBkYXRlKGdyYXBoaWNzKTtcbiAgICB9XG4gICAgX2RlbGV0ZVRleHQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5kZWxldGUoKTtcbiAgICB9XG4gICAgX2NhbmNlbFRleHQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5jYW5jZWwoKTtcbiAgICB9XG4gICAgX2R1cGxpY2F0ZVRleHQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVmlld01vZGVsVGV4dC5kdXBsaWNhdGUoKTtcbiAgICB9XG4gICAgX2Rlc3Ryb3lUZXh0KCkge1xuICAgICAgICB0aGlzLnNrZXRjaFZpZXdNb2RlbFRleHQuZGVzdHJveSgpO1xuICAgIH1cbn1cblxuY29uc3QgZGVmYXVsdExpbmVTeW1ib2wgPSBhc3luYyAobWFwVmlldywgQ29sb3JVdGlscykgPT4ge1xuICAgIGNvbnN0IGJhY2tncm91bmRUaGVtZUNvbG9yID0gYXdhaXQgQ29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3JUaGVtZShtYXBWaWV3KTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcInNpbXBsZS1saW5lXCIsXG4gICAgICAgIGNvbG9yOiBiYWNrZ3JvdW5kVGhlbWVDb2xvciA9PT0gXCJsaWdodFwiID8gWzAsIDAsIDBdIDogWzI1NSwgMjU1LCAyNTVdLFxuICAgICAgICB3aWR0aDogMSAqIDAuNzVcbiAgICB9O1xufTtcbmNvbnN0IGRlZmF1bHRQb2x5Z29uU3ltYm9sID0gYXN5bmMgKG1hcFZpZXcsIENvbG9yVXRpbHMpID0+IHtcbiAgICBjb25zdCBiYWNrZ3JvdW5kVGhlbWVDb2xvciA9IGF3YWl0IENvbG9yVXRpbHMuZ2V0QmFja2dyb3VuZENvbG9yVGhlbWUobWFwVmlldyk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJzaW1wbGUtZmlsbFwiLFxuICAgICAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIiA/IFswLCAwLCAwLCAwLjI1XSA6IFsyNTUsIDI1NSwgMjU1LCAwLjI1XSxcbiAgICAgICAgc3R5bGU6IFwic29saWRcIixcbiAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgY29sb3I6IGJhY2tncm91bmRUaGVtZUNvbG9yID09PSBcImxpZ2h0XCIgPyBbMCwgMCwgMF0gOiBbMjU1LCAyNTUsIDI1NV0sXG4gICAgICAgICAgICB3aWR0aDogMSAqIDAuNzVcbiAgICAgICAgfVxuICAgIH07XG59O1xuY29uc3QgZGVmYXVsdFRleHRTeW1ib2wgPSBhc3luYyAobWFwVmlldywgQ29sb3JVdGlscywgVGV4dFN5bWJvbCwgdGV4dCkgPT4ge1xuICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGF3YWl0IENvbG9yVXRpbHMuZ2V0QmFja2dyb3VuZENvbG9yKG1hcFZpZXcpO1xuICAgIGNvbnN0IGJhY2tncm91bmRUaGVtZUNvbG9yID0gYXdhaXQgQ29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3JUaGVtZShtYXBWaWV3KTtcbiAgICByZXR1cm4gbmV3IFRleHRTeW1ib2woe1xuICAgICAgICB0ZXh0LFxuICAgICAgICBjb2xvcjogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwibGlnaHRcIlxuICAgICAgICAgICAgPyBbMCwgMCwgMF1cbiAgICAgICAgICAgIDogYmFja2dyb3VuZFRoZW1lQ29sb3IgPT09IFwiZGFya1wiXG4gICAgICAgICAgICAgICAgPyBbMjU1LCAyNTUsIDI1NV1cbiAgICAgICAgICAgICAgICA6IGJhY2tncm91bmRDb2xvciB8fCBbMCwgMCwgMF0sXG4gICAgICAgIGhhbG9Db2xvcjogbnVsbCxcbiAgICAgICAgaGFsb1NpemU6IDEgKiAwLjc1LFxuICAgICAgICBmb250OiB7XG4gICAgICAgICAgICBzaXplOiAyMiAqIDAuNzUsXG4gICAgICAgICAgICBmYW1pbHk6IFwiQXJpYWxcIixcbiAgICAgICAgICAgIHdlaWdodDogXCJib2xkXCJcbiAgICAgICAgfSxcbiAgICAgICAgbGluZVdpZHRoOiA1MTJcbiAgICB9KTtcbn07XG5jb25zdCBkZWZhdWx0Q2ltU3ltYm9sID0gYXN5bmMgKENJTVN5bWJvbCwgbWFwVmlldywgQ29sb3JVdGlscykgPT4ge1xuICAgIGNvbnN0IGJhY2tncm91bmRUaGVtZUNvbG9yID0gYXdhaXQgQ29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3JUaGVtZShtYXBWaWV3KTtcbiAgICByZXR1cm4gbmV3IENJTVN5bWJvbCh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiQ0lNU3ltYm9sUmVmZXJlbmNlXCIsXG4gICAgICAgICAgICBzeW1ib2w6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNJTVBvaW50U3ltYm9sXCIsXG4gICAgICAgICAgICAgICAgc3ltYm9sTGF5ZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNVmVjdG9yTWFya2VyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvckxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvclBvaW50OiB7IHg6IDAsIHk6IC0xLjc1IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3JQb2ludFVuaXRzOiBcIlJlbGF0aXZlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiA1LjcsXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFtZTogeyB4bWluOiAwLCB5bWluOiAwLCB4bWF4OiA4NC4zLCB5bWF4OiA4NC4zIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJHcmFwaGljczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDSU1NYXJrZXJHcmFwaGljXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByaW5nczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzgzLjIsIDMyLjVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbODQuMywgNDAuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs4My44LCA0OC45XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzgxLjcsIDU2LjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNzguMSwgNjQuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs3MywgNzAuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs2Ni45LCA3Ni40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzU5LjcsIDgwLjVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNTEuOSwgODMuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs0My43LCA4NC4zXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzM1LjQsIDgzLjhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMjcuNCwgODEuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsyMCwgNzhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTMuNCwgNzNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNy45LCA2Ni44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzMuOCwgNTkuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxLjEsIDUxLjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMCwgNDMuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFswLjUsIDM1LjRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMi42LCAyNy40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzYuMywgMjBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTEuMywgMTMuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNy41LCA3LjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMjQuNywgMy44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzMyLjUsIDEuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFszOS44LCAwLjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNDcuMSwgMC4zXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzU0LjMsIDEuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs2MS4xLCA0LjVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNjcuNCwgOC40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzcyLjksIDEzLjNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNzcuNCwgMTkuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs4MC45LCAyNS41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzgzLjIsIDMyLjVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2w6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNUG9seWdvblN5bWJvbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sTGF5ZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkNJTVNvbGlkRmlsbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBiYWNrZ3JvdW5kVGhlbWVDb2xvciA9PT0gXCJsaWdodFwiID8gWzI0MiwgMjQyLCAyNDIsIDI1NV0gOiBbMjU1LCAyNTUsIDI1NSwgMjU1XVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVN5bWJvbHNQcm9wb3J0aW9uYWxseTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BlY3RGcmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNVmVjdG9yTWFya2VyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3JQb2ludDogeyB4OiAwLCB5OiAtMC41IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3JQb2ludFVuaXRzOiBcIlJlbGF0aXZlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAxNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lOiB7IHhtaW46IDAsIHltaW46IDAsIHhtYXg6IDE5Ny43LCB5bWF4OiAyOTQuNyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyR3JhcGhpY3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNTWFya2VyR3JhcGhpY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmluZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs5OC45LCAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzExOS40LCAyMy4yXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzEzOS40LCA0OS4zXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE1Ni44LCA3NS4yXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE3MS4yLCAxMDAuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxODIuNCwgMTI1LjNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTkwLjYsIDE0OC44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5NS43LCAxNzEuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTcuNywgMTkyLjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTk3LjcsIDE5NS44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5Ny43LCAyMDAuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTcuNiwgMjAyLjVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTk3LjUsIDIwNC44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5Ny4zLCAyMDcuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTcsIDIwOS40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5Ni43LCAyMTEuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTYuNCwgMjE0LjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTk2LCAyMTYuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTUuNSwgMjE4LjddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTk1LCAyMjEuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTQuNCwgMjIzLjRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTkzLjcsIDIyNS44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5MywgMjI4LjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTkyLjIsIDIzMC41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE5MS40LCAyMzIuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOTAuNSwgMjM1LjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTg5LjUsIDIzNy41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE4OC41LCAyMzkuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxODcuNCwgMjQyXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE4Ni4yLCAyNDQuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxODUsIDI0Ni41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE4My43LCAyNDguN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxODIuNCwgMjUwLjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTgxLCAyNTMuMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNzkuNSwgMjU1LjJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTc4LCAyNTcuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNzYuNCwgMjU5LjRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTc0LjcsIDI2MS40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE3My4xLCAyNjMuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNzEuMywgMjY1LjNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTY5LjUsIDI2Ny4yXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE2Ny43LCAyNjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTY1LjgsIDI3MC44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE2My45LCAyNzIuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNjEuOSwgMjc0LjJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTU5LjksIDI3NS44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE1Ny44LCAyNzcuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNTUuNywgMjc4LjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTUzLjYsIDI4MC40XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE1MS40LCAyODEuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNDkuMiwgMjgzLjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTQ3LCAyODQuNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNDQuOCwgMjg1LjZdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTQyLjUsIDI4Ni43XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzE0MC4zLCAyODcuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMzgsIDI4OC44XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzEzNS43LCAyODkuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMzMuNCwgMjkwLjddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTMxLCAyOTEuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMjguNywgMjkyLjNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTI2LjQsIDI5M10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMjQsIDI5My42XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzEyMS43LCAyOTQuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMTkuNCwgMjk0LjddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTE3LCAyOTUuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMTQuNywgMjk1LjZdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTEyLjQsIDI5Nl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMTAuMSwgMjk2LjNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTA3LjgsIDI5Ni41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzEwNS41LCAyOTYuN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxMDMuMywgMjk2LjhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTAxLjEsIDI5Ni45XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzk4LjgsIDI5Ni45XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzgzLjEsIDI5NS43XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzY3LjgsIDI5Ml0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs1My4zLCAyODUuOV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFszOS45LCAyNzcuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsyOC4xLCAyNjcuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxOCwgMjU1LjFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMTAsIDI0MS41XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzQuMiwgMjI2LjldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMC45LCAyMTEuNV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFswLCAxOTUuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFswLjEsIDE5Mi45XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzIuMSwgMTcxLjRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbNy4yLCAxNDguOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxNS40LCAxMjUuM10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsyNi42LCAxMDAuOF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs0MSwgNzUuMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFs1OC40LCA0OS4zXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzc4LjQsIDIzLjJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbOTguOSwgMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDSU1Qb2x5Z29uU3ltYm9sXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2xMYXllcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ0lNU29saWRGaWxsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGJhY2tncm91bmRUaGVtZUNvbG9yID09PSBcImxpZ2h0XCIgPyBbMTcsIDI2LCA0MCwgMjU1XSA6IFsxODYsIDE4NiwgMTg2LCAyNTVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlU3ltYm9sc1Byb3BvcnRpb25hbGx5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcGVjdEZyYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb246IDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc2NhbGVYOiAxLFxuICAgICAgICAgICAgICAgIGFuZ2xlQWxpZ25tZW50OiBcIkRpc3BsYXlcIixcbiAgICAgICAgICAgICAgICBhbmdsZTogMFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59O1xuLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWNvbXBvbmVudHMvYmxvYi9tYXN0ZXIvc3JjL3NtYXJ0TWFwcGluZy9fdXRpbHMvc3ltYm9sLnRzXG5mdW5jdGlvbiBnZXRDaW1PdXRsaW5lKHN5bSkge1xuICAgIGlmICghaXNNVkNvbXBhdGlibGVDSU0oc3ltKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHN5bWJvbExheWVycyA9IHN5bS5kYXRhLnN5bWJvbC5zeW1ib2xMYXllcnM7XG4gICAgY29uc3QgYmdTeW1ib2xMYXllciA9IHN5bWJvbExheWVyc1tzeW1ib2xMYXllcnMubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgZ3JhcGhpYyA9IGJnU3ltYm9sTGF5ZXIubWFya2VyR3JhcGhpY3NbMF07XG4gICAgcmV0dXJuIGdyYXBoaWMuc3ltYm9sLnN5bWJvbExheWVycy5maW5kKChzeW1ib2xMYXllcikgPT4gc3ltYm9sTGF5ZXIudHlwZSA9PT0gXCJDSU1Tb2xpZFN0cm9rZVwiKTtcbn1cbmZ1bmN0aW9uIGdldFN5bWJvbFNpemUoc3ltYm9sKSB7XG4gICAgaWYgKHN5bWJvbC50eXBlID09PSBcImNpbVwiKSB7XG4gICAgICAgIHJldHVybiBlc3JpTW9kdWxlcy5jaW1TeW1ib2xVdGlscy5nZXRDSU1TeW1ib2xTaXplKHN5bWJvbCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN5bWJvbC50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICByZXR1cm4gc3ltYm9sLmZvbnQuc2l6ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNEZWZpbmVkKHN5bWJvbC5zaXplKSkge1xuICAgICAgICByZXR1cm4gc3ltYm9sLnNpemU7XG4gICAgfVxuICAgIHJldHVybiBzeW1ib2wud2lkdGg7XG59XG5mdW5jdGlvbiBhcHBseVN5bWJvbFNpemUoc3ltYm9sLCBzaXplKSB7XG4gICAgaWYgKHN5bWJvbC50eXBlID09PSBcImNpbVwiKSB7XG4gICAgICAgIGVzcmlNb2R1bGVzLmNpbVN5bWJvbFV0aWxzLnNjYWxlQ0lNU3ltYm9sVG8oc3ltYm9sLCBzaXplKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNEZWZpbmVkKHN5bWJvbC5zaXplKSkge1xuICAgICAgICBzeW1ib2wuc2l6ZSA9IHNpemU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCByYXRpbyA9IHN5bWJvbC5oZWlnaHQgLyBzeW1ib2wud2lkdGg7XG4gICAgICAgIHN5bWJvbC53aWR0aCA9IHNpemU7XG4gICAgICAgIHN5bWJvbC5oZWlnaHQgPSBzeW1ib2wud2lkdGggKiByYXRpbztcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRTeW1ib2xSb3RhdGlvbihzeW1ib2wpIHtcbiAgICBpZiAoc3ltYm9sLnR5cGUgPT09IFwiY2ltXCIpIHtcbiAgICAgICAgcmV0dXJuIGVzcmlNb2R1bGVzLmNpbVN5bWJvbFV0aWxzLmdldENJTVN5bWJvbFJvdGF0aW9uKHN5bWJvbCwgdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKFtcInNpbXBsZS1tYXJrZXJcIiwgXCJwaWN0dXJlLW1hcmtlclwiXS5pbmRleE9mKHN5bWJvbC50eXBlKSA+IC0xKSB7XG4gICAgICAgIHJldHVybiBzeW1ib2wuYW5nbGU7XG4gICAgfVxuICAgIHJldHVybjtcbn1cbmZ1bmN0aW9uIGFwcGx5U3ltYm9sUm90YXRpb24oc3ltYm9sLCBhbmdsZSkge1xuICAgIGlmICghaXNEZWZpbmVkKGFuZ2xlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzeW1ib2wudHlwZSA9PT0gXCJjaW1cIikge1xuICAgICAgICBlc3JpTW9kdWxlcy5jaW1TeW1ib2xVdGlscy5hcHBseUNJTVN5bWJvbFJvdGF0aW9uKHN5bWJvbCwgYW5nbGUsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChbXCJzaW1wbGUtbWFya2VyXCIsIFwicGljdHVyZS1tYXJrZXJcIl0uaW5kZXhPZihzeW1ib2wudHlwZSkgPiAtMSkge1xuICAgICAgICBzeW1ib2wuYW5nbGUgPSBhbmdsZTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRTeW1ib2xDb2xvcihzeW1ib2wpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoc3ltYm9sID09PSBudWxsIHx8IHN5bWJvbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3ltYm9sLnR5cGUpID09PSBcImNpbVwiXG4gICAgICAgID8gZXNyaU1vZHVsZXMuQ29sb3IuZnJvbUpTT04oKF9hID0gZXNyaU1vZHVsZXMuY2ltU3ltYm9sVXRpbHMuZ2V0Q0lNU3ltYm9sQ29sb3Ioc3ltYm9sKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvSlNPTigpKVxuICAgICAgICA6IChzeW1ib2wgPT09IG51bGwgfHwgc3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2wudHlwZSkgPT09IFwic2ltcGxlLW1hcmtlclwiICYmIFtcInhcIiwgXCJjcm9zc1wiXS5pbmRleE9mKHN5bWJvbCA9PT0gbnVsbCB8fCBzeW1ib2wgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN5bWJvbC5zdHlsZSkgPiAtMVxuICAgICAgICAgICAgPyAoX2IgPSBzeW1ib2wgPT09IG51bGwgfHwgc3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2wub3V0bGluZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNvbG9yXG4gICAgICAgICAgICA6IHN5bWJvbCA9PT0gbnVsbCB8fCBzeW1ib2wgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN5bWJvbC5jb2xvcjtcbn1cbmZ1bmN0aW9uIGFwcGx5U3ltYm9sQ29sb3Ioc3ltYm9sLCBjb2xvcikge1xuICAgIGlmIChzeW1ib2wudHlwZSA9PT0gXCJwaWN0dXJlLW1hcmtlclwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHN5bWJvbC50eXBlID09PSBcImNpbVwiKSB7XG4gICAgICAgIGVzcmlNb2R1bGVzLmNpbVN5bWJvbFV0aWxzLmFwcGx5Q0lNU3ltYm9sQ29sb3Ioc3ltYm9sLCBjb2xvcik7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN5bWJvbC50eXBlID09PSBcInNpbXBsZS1tYXJrZXJcIiAmJiBzeW1ib2wuc3R5bGUgJiYgW1wiY3Jvc3NcIiwgXCJ4XCJdLmluZGV4T2Yoc3ltYm9sLnN0eWxlKSA+IC0xKSB7XG4gICAgICAgIGlmICghc3ltYm9sLm91dGxpbmUpIHtcbiAgICAgICAgICAgIHN5bWJvbC5vdXRsaW5lID0gbmV3IF9fZXNyaS5TaW1wbGVMaW5lU3ltYm9sKCk7XG4gICAgICAgIH1cbiAgICAgICAgc3ltYm9sLm91dGxpbmUuY29sb3IgPSBjb2xvcjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHN5bWJvbC5jb2xvciA9IGNvbG9yO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldFN5bWJvbE91dGxpbmUoc3ltYm9sKSB7XG4gICAgcmV0dXJuIChzeW1ib2wgPT09IG51bGwgfHwgc3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2wudHlwZSkgPT09IFwiY2ltXCIgPyBnZXRDaW1MaW5lKHN5bWJvbCkgOiBzeW1ib2wgPT09IG51bGwgfHwgc3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2wub3V0bGluZTtcbn1cbmZ1bmN0aW9uIGFwcGx5U3ltYm9sT3V0bGluZShzeW1ib2wsIG91dGxpbmUpIHtcbiAgICBpZiAoc3ltYm9sLnR5cGUgPT09IFwiY2ltXCIpIHtcbiAgICAgICAgc3ltYm9sLmRhdGEuc3ltYm9sLnN5bWJvbExheWVycy5mb3JFYWNoKChzeW1ib2xMYXllciwgaWR4KSA9PiB7XG4gICAgICAgICAgICBpZiAoc3ltYm9sTGF5ZXIudHlwZSA9PT0gXCJDSU1Tb2xpZFN0cm9rZVwiKSB7XG4gICAgICAgICAgICAgICAgc3ltYm9sLmRhdGEuc3ltYm9sLnN5bWJvbExheWVyc1tpZHhdID0gb3V0bGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzeW1ib2wub3V0bGluZSA9IG91dGxpbmU7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNNVkNvbXBhdGlibGVDSU0oc3ltKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgLy8gLVx0SGF2ZSBvbmUgc3ltYm9sTGF5ZXIgd2l0aCBhIHN0cm9rZSBhbmQgYSBmaWxsIChDSU1WZWN0b3JNYXJrZXIpIHRoYXQgaXMgbm90IGNvbG9yTG9ja2VkXG4gICAgLy8gLVx0SGF2ZSB0d28gc3ltYm9sTGF5ZXJzIHdpdGggYSBzdHJva2UgYW5kIGEgZmlsbCAoQ0lNVmVjdG9yTWFya2VyKVxuICAgIC8vICAgIFRoZSBzbWFsbGVyIChmaXJzdCkgc3ltYm9sTGF5ZXIgaXMgbm90IGNvbG9yTG9ja2VkXG4gICAgLy8gICAgVGhlIHNlY29uZCBzeW1ib2xMYXllciBtdXN0IGhhdmUgYSBncmVhdGVyIHNpemUgdGhhbiB0aGUgZmlyc3RcbiAgICBjb25zdCBzeW1ib2xMYXllcnMgPSBzeW0uZGF0YS5zeW1ib2wuc3ltYm9sTGF5ZXJzO1xuICAgIGlmIChzeW1ib2xMYXllcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHN5bWJvbExheWVyID0gc3ltYm9sTGF5ZXJzWzBdO1xuICAgICAgICBpZiAoc3ltYm9sTGF5ZXIudHlwZSAhPT0gXCJDSU1WZWN0b3JNYXJrZXJcIiB8fCBzeW1ib2xMYXllci5jb2xvckxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hcmtlckdyYXBoaWNMYXllcnMgPSAoX2IgPSAoX2EgPSBzeW1ib2xMYXllci5tYXJrZXJHcmFwaGljc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN5bWJvbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN5bWJvbExheWVycztcbiAgICAgICAgcmV0dXJuIHN5bWJvbExheWVyLm1hcmtlckdyYXBoaWNzLmxlbmd0aCA9PT0gMSAmJiBoYXNVbmxvY2tlZEZpbGxBbmRTdHJva2UobWFya2VyR3JhcGhpY0xheWVycyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN5bWJvbExheWVycy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgY29uc3Qgc3ltYm9sTGF5ZXIxID0gc3ltYm9sTGF5ZXJzWzBdO1xuICAgICAgICBjb25zdCBzeW1ib2xMYXllcjIgPSBzeW1ib2xMYXllcnNbMV07XG4gICAgICAgIGlmIChzeW1ib2xMYXllcjEudHlwZSAhPT0gXCJDSU1WZWN0b3JNYXJrZXJcIiB8fFxuICAgICAgICAgICAgc3ltYm9sTGF5ZXIyLnR5cGUgIT09IFwiQ0lNVmVjdG9yTWFya2VyXCIgfHxcbiAgICAgICAgICAgIHN5bWJvbExheWVyMS5jb2xvckxvY2tlZCB8fFxuICAgICAgICAgICAgc3ltYm9sTGF5ZXIxLnNpemUgPiBzeW1ib2xMYXllcjIuc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hcmtlckdyYXBoaWNMYXllcnMxID0gKF9kID0gKF9jID0gc3ltYm9sTGF5ZXIxLm1hcmtlckdyYXBoaWNzWzBdKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3ltYm9sKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3ltYm9sTGF5ZXJzO1xuICAgICAgICBjb25zdCBtYXJrZXJHcmFwaGljTGF5ZXJzMiA9IChfZiA9IChfZSA9IHN5bWJvbExheWVyMi5tYXJrZXJHcmFwaGljc1swXSkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnN5bWJvbCkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLnN5bWJvbExheWVycztcbiAgICAgICAgcmV0dXJuIChzeW1ib2xMYXllcjEubWFya2VyR3JhcGhpY3MubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICBzeW1ib2xMYXllcjIubWFya2VyR3JhcGhpY3MubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICBoYXNVbmxvY2tlZEZpbGxBbmRTdHJva2UobWFya2VyR3JhcGhpY0xheWVyczEpICYmXG4gICAgICAgICAgICBoYXNGaWxsQW5kU3Ryb2tlKG1hcmtlckdyYXBoaWNMYXllcnMyKSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGhhc1VubG9ja2VkRmlsbEFuZFN0cm9rZShzeW1ib2xMYXllcnMpIHtcbiAgICByZXR1cm4gaGFzVW5sb2NrZWRGaWxsKHN5bWJvbExheWVycykgJiYgaGFzU3Ryb2tlKHN5bWJvbExheWVycyk7XG59XG5mdW5jdGlvbiBoYXNGaWxsQW5kU3Ryb2tlKHN5bWJvbExheWVycykge1xuICAgIHJldHVybiBoYXNGaWxsKHN5bWJvbExheWVycykgJiYgaGFzU3Ryb2tlKHN5bWJvbExheWVycyk7XG59XG5mdW5jdGlvbiBoYXNGaWxsKHN5bWJvbExheWVycykge1xuICAgIHJldHVybiBzeW1ib2xMYXllcnMgPT09IG51bGwgfHwgc3ltYm9sTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2xMYXllcnMuZmluZCgoc3ltYm9sTGF5ZXIpID0+IHN5bWJvbExheWVyLnR5cGUgPT09IFwiQ0lNU29saWRGaWxsXCIpO1xufVxuZnVuY3Rpb24gaGFzVW5sb2NrZWRGaWxsKHN5bWJvbExheWVycykge1xuICAgIHJldHVybiBzeW1ib2xMYXllcnMgPT09IG51bGwgfHwgc3ltYm9sTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzeW1ib2xMYXllcnMuZmluZCgoc3ltYm9sTGF5ZXIpID0+IHN5bWJvbExheWVyLnR5cGUgPT09IFwiQ0lNU29saWRGaWxsXCIgJiYgIXN5bWJvbExheWVyLmNvbG9yTG9ja2VkKTtcbn1cbmZ1bmN0aW9uIGhhc1N0cm9rZShzeW1ib2xMYXllcnMpIHtcbiAgICByZXR1cm4gc3ltYm9sTGF5ZXJzID09PSBudWxsIHx8IHN5bWJvbExheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3ltYm9sTGF5ZXJzLmZpbmQoKHN5bWJvbExheWVyKSA9PiBzeW1ib2xMYXllci50eXBlID09PSBcIkNJTVNvbGlkU3Ryb2tlXCIpO1xufVxuZnVuY3Rpb24gZ2V0Q2ltTGluZShzeW1ib2wpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBpZiAoc3ltYm9sLnR5cGUgPT09IFwicGljdHVyZS1tYXJrZXJcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgoKF9hID0gc3ltYm9sLmRhdGEuc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiQ0lNUG9pbnRTeW1ib2xcIikge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBlbHNlIGlmICgoKF9iID0gc3ltYm9sLmRhdGEuc3ltYm9sKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudHlwZSkgPT09IFwiQ0lNTGluZVN5bWJvbFwiKSB7XG4gICAgICAgIHJldHVybiBnZXRDaW1MaW5lTGluZShzeW1ib2wpO1xuICAgIH1cbiAgICBlbHNlIGlmICgoKF9jID0gc3ltYm9sLmRhdGEuc3ltYm9sKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudHlwZSkgPT09IFwiQ0lNUG9seWdvblN5bWJvbFwiKSB7XG4gICAgICAgIHJldHVybiBnZXRDaW1Qb2x5Z29uT3V0bGluZShzeW1ib2wpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENpbUxpbmVMaW5lKHN5bWJvbCkge1xuICAgIGNvbnN0IHN5bWJvbExheWVycyA9IHN5bWJvbC5kYXRhLnN5bWJvbC5zeW1ib2xMYXllcnM7XG4gICAgcmV0dXJuIHN5bWJvbExheWVyc1swXTtcbn1cbmZ1bmN0aW9uIGdldENpbVBvbHlnb25PdXRsaW5lKHN5bWJvbCkge1xuICAgIC8vIEFzc3VtZSB0aGUgdG9wIHN0cm9rZSBsYXllciBvbiBwb2x5Z29ucyBpcyBhbiBvdXRsaW5lXG4gICAgY29uc3Qgc3ltYm9sTGF5ZXJzID0gc3ltYm9sLmRhdGEuc3ltYm9sLnN5bWJvbExheWVycztcbiAgICByZXR1cm4gc3ltYm9sTGF5ZXJzLmZpbmQoKHN5bWJvbExheWVyKSA9PiBzeW1ib2xMYXllci50eXBlID09PSBcIkNJTVNvbGlkU3Ryb2tlXCIpO1xufVxuXG5jb25zdCBzYXZlU2tldGNoVG9vbHRpcFRvU3RvcmFnZSA9ICh0b29sdGlwT3B0aW9ucywgY3VycmVudFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkKSA9PiB7XG4gICAgY29uc3QgdG9vbHRpcE9iamVjdCA9IHtcbiAgICAgICAgZW5hYmxlZDogdG9vbHRpcE9wdGlvbnMuZW5hYmxlZFxuICAgIH07XG4gICAgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtKGN1cnJlbnRUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZCwgdG9vbHRpcE9iamVjdCwgdHJ1ZSk7XG59O1xuY29uc3QgZ2V0U2tldGNoVG9vbHRpcE9wdGlvbnMgPSAoc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzLCBTa2V0Y2hUb29sdGlwT3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IHNrZXRjaFRvb2xpcCA9IGdldFNrZXRjaFRvb2x0aXBGcm9tU3RvcmFnZShza2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMpIHx8IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2VcbiAgICB9O1xuICAgIHJldHVybiBuZXcgU2tldGNoVG9vbHRpcE9wdGlvbnMoe1xuICAgICAgICBlbmFibGVkOiBza2V0Y2hUb29saXAuZW5hYmxlZFxuICAgIH0pO1xufTtcbmNvbnN0IGdldFNrZXRjaFRvb2x0aXBGcm9tU3RvcmFnZSA9IChza2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMpID0+IHtcbiAgICBpZiAoc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzKSB7XG4gICAgICAgIHJldHVybiAoZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKHNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcy53ZWJtYXAsIHRydWUpIHx8XG4gICAgICAgICAgICBnZXRTZXNzaW9uU3RvcmFnZUl0ZW0oc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQsIHRydWUpIHx8XG4gICAgICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59O1xuXG5jb25zdCBza2V0Y2hTdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICBtYXBWaWV3OiBudWxsLFxuICAgIHBvcnRhbDogbnVsbCxcbiAgICBsYXllcjogbnVsbCxcbiAgICBzdHJpbmdzOiBudWxsLFxuICAgIGN1cnJlbnRMYW5ndWFnZTogXCJcIixcbiAgICBza2V0Y2hNZXNzYWdlOiBcIlwiLFxuICAgIHN2TW9kZWw6IG51bGwsXG4gICAgc25hcHBpbmdPcHRpb25zOiBudWxsLFxuICAgIHNrZXRjaFRvb2x0aXBPcHRpb25zOiBudWxsLFxuICAgIHNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHM6IG51bGwsXG4gICAgc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzOiBudWxsXG59KTtcbmNvbnN0IHNrZXRjaFN0YXRlID0gc2tldGNoU3RvcmUuc3RhdGU7XG5cbmNvbnN0IGFyY2dpc1NrZXRjaENzcyA9IFwiOmhvc3R7ZGlzcGxheTpmbGV4O2ZsZXg6MSAxIGF1dG87b3ZlcmZsb3c6aGlkZGVufS5za2V0Y2gtZGVsZXRlLWJ1dHRvbntwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctdGhpcmQpfS5zbmFwcGluZ3tkaXNwbGF5OmZsZXg7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKX0uc2tldGNoLW1lc3NhZ2V7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpfS5za2V0Y2gta2V5Ym9hcmQtYnV0dG9ue21hcmdpbi1yaWdodDowLjNlbX0ubXVsdGlwbGUtc2VsZWN0aW9ue21hcmdpbjoxLjNlbX0ubXVsdGlwbGUtc2VsZWN0aW9uIGNhbGNpdGUtYnV0dG9ue21hcmdpbi10b3A6MC4zZW19LmFyY2dpcy0tcnRsIC5za2V0Y2gta2V5Ym9hcmQtYnV0dG9ue21hcmdpbi1yaWdodDp1bnNldDttYXJnaW4tbGVmdDowLjNlbX1cIjtcblxuY29uc3QgQXJjZ2lzU2tldGNoID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5za2V0Y2hVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJza2V0Y2hVcGRhdGVkXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NrZXRjaERpc21pc3NlZENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU2tldGNoRGlzbWlzc2VkQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NrZXRjaEFkZFRvTmV3U2tldGNoID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTa2V0Y2hBZGRUb05ld1NrZXRjaFwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNSZWNlbnRDb2xvcnNVcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1JlY2VudENvbG9yc1VwZGF0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5pbnRlcm5hbFNrZXRjaFVwZGF0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImludGVybmFsU2tldGNoVXBkYXRlZFwiLCA3KTtcbiAgICAgICAgdGhpcy5jbG9zZVNrZXRjaFBvcG92ZXJzID0gY3JlYXRlRXZlbnQodGhpcywgXCJjbG9zZVNrZXRjaFBvcG92ZXJzXCIsIDcpO1xuICAgICAgICB0aGlzLmNsb3NlUG9wdXBQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VQb3B1cFBvcG92ZXJzXCIsIDcpO1xuICAgICAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2tldGNoQ29udGVudFJlUmVuZGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmRpc2FibGVTa2V0Y2hQYW5lbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZGlzYWJsZVNrZXRjaFBhbmVsXCIsIDcpO1xuICAgICAgICB0aGlzLmNsb3NlU2tldGNoU25hcHBpbmdQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VTa2V0Y2hTbmFwcGluZ1BvcG92ZXJzXCIsIDcpO1xuICAgICAgICB0aGlzLnNrZXRjaEFjdGlvbk9uU2VsZWN0RmVhdHVyZXMgPSBjcmVhdGVFdmVudCh0aGlzLCBcInNrZXRjaEFjdGlvbk9uU2VsZWN0RmVhdHVyZXNcIiwgNyk7XG4gICAgICAgIHRoaXMuc2tldGNoTW9kZSA9IFwidXBkYXRlXCI7XG4gICAgICAgIHRoaXMuZXNjS2V5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMua2VlcFNlbGVjdGlvbk1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0aGlzLmtlZXBTZWxlY3Rpb25Ub29sID0gbnVsbDtcbiAgICAgICAgdGhpcy5kZWxldGVJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmVlZHNNYXBWaWV3SGFuZGxlcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9uR3JhcGhpY1VwZGF0ZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGlmIChldmVudC5zdGF0ZSA9PT0gXCJzdGFydFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBWaWV3LmNsb3NlUG9wdXAoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MubGVuZ3RoIDw9IDEgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXdTa2V0Y2hMYXllckZlYXR1cmVzLmxlbmd0aCA8PSAxICYmXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LmdyYXBoaWNzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzID0gW2V2ZW50LmdyYXBoaWNzWzBdXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzWzBdXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3ltYm9sO1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiBtdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MgaXMgMCwgY29taW5nIGZyb20gc2luZ2xlIHNlbGVjdFxuICAgICAgICAgICAgICAgICAgICAhdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcy5wdXNoKHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbMF0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wgPSBnZXRHZW9tZXRyeVR5cGVGcm9tR3JhcGhpYyh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5wb3B1cCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbMF0ucG9wdXBUZW1wbGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAoKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXS5hdHRyaWJ1dGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpIHx8IHRoaXMuZGVmYXVsdEdyYXBoaWNUaXRsZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1NrZXRjaENvbnRlbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcy5sZW5ndGggfHwgdGhpcy5uZXdTa2V0Y2hMYXllckZlYXR1cmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBidWxrIHBvcHVwIGFjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcyA9IHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljc1xuICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLm5ld1NrZXRjaExheWVyRmVhdHVyZXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN5bWJvbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID0gZ2V0R2VvbWV0cnlUeXBlRnJvbUdyYXBoaWModGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0VGl0bGUgPSAoKF9iID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXS5hdHRyaWJ1dGVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudGl0bGUpIHx8IHRoaXMuZGVmYXVsdEdyYXBoaWNUaXRsZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGljYWxUaXRsZXMgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzLmV2ZXJ5KChncmFwaGljKSA9PiB7IHZhciBfYTsgcmV0dXJuICgoX2EgPSBncmFwaGljLmF0dHJpYnV0ZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZSkgPT09IGZpcnN0VGl0bGU7IH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFBvcHVwID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXS5wb3B1cFRlbXBsYXRlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGljYWxQb3B1cHMgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzLmV2ZXJ5KChncmFwaGljKSA9PiBKU09OLnN0cmluZ2lmeShncmFwaGljLnBvcHVwVGVtcGxhdGUpID09PSBKU09OLnN0cmluZ2lmeShmaXJzdFBvcHVwKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVkaXRpbmcgYnVsayBpdGVtcyBzaG91bGQgc3RhcnQgd2l0aCBhbiBlbXB0eSBwb3B1cCBhbmQgdGl0bGUsIHVubGVzcyBhbGwgdGl0bGVzL3BvcHVwcyBhbGlnblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlID0gaWRlbnRpY2FsVGl0bGVzID8gZmlyc3RUaXRsZSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXAgPSBpZGVudGljYWxQb3B1cHMgPyBmaXJzdFBvcHVwIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTa2V0Y2hDb250ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2tldGNoTWVzc2FnZUhhbmRsZXIobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV2ZW50LnN0YXRlID09PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGtlZXBTZWxlY3Rpb25Ub29sIH0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICgha2VlcFNlbGVjdGlvblRvb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VTa2V0Y2hQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTa2V0Y2hVcGRhdGVkLmVtaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgIXRoaXMuZGVsZXRlSW5Qcm9ncmVzcyAmJiB0aGlzLmtlZXBTZWxlY3RUb29sU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1hcFZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRpc21pc3NpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWN0aXZlU2tldGNoVG9vbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sc1RvSGlkZSA9IFtdO1xuICAgICAgICB0aGlzLmhpZGVTZWxlY3Rpb25Ub29scyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdGVkU2tldGNoRmVhdHVyZXNGZWF0dXJlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYXBOb3Rlc0ZlYXR1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLnNob3dTa2V0Y2hUb29sc09ubHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sc1JlZmVyZW5jZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8gPSB7XG4gICAgICAgICAgICB0b29sOiBudWxsLFxuICAgICAgICAgICAgc3ltYm9sOiBudWxsLFxuICAgICAgICAgICAgZ3JhcGhpY3M6IG51bGwsXG4gICAgICAgICAgICBwb3B1cDogbnVsbCxcbiAgICAgICAgICAgIHRpdGxlOiBudWxsLFxuICAgICAgICAgICAgc291cmNlSWRzOiB7fVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm11bHRpcGxlU2VsZWN0ZWRHcmFwaGljcyA9IFtdO1xuICAgICAgICB0aGlzLm5ld1NrZXRjaExheWVyRmVhdHVyZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zaG93U2tldGNoQ29udGVudCA9IHRydWU7XG4gICAgfVxuICAgIC8vIExpZmVjeWNsZSBNZXRob2RzXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgW3RoaXMuc3RyaW5ncywgdGhpcy5jdXJyZW50TGFuZ3VhZ2VdID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkQWxsTW9kdWxlcygpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVTZXNzaW9uU3RvcmFnZU9wdGlvbnMoKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplU1ZNb2RlbCgpO1xuICAgICAgICBza2V0Y2hTdGF0ZS5zdk1vZGVsID0gdGhpcy5zdk1vZGVsO1xuICAgICAgICBza2V0Y2hTdGF0ZS5tYXBWaWV3ID0gdGhpcy5tYXBWaWV3O1xuICAgICAgICBza2V0Y2hTdGF0ZS5sYXllciA9IHRoaXMubGF5ZXI7XG4gICAgICAgIHNrZXRjaFN0YXRlLnBvcnRhbCA9IHRoaXMucG9ydGFsO1xuICAgICAgICBza2V0Y2hTdGF0ZS5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICBza2V0Y2hTdGF0ZS5jdXJyZW50TGFuZ3VhZ2UgPSB0aGlzLmN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgc2tldGNoU3RhdGUuc25hcHBpbmdPcHRpb25zID0gdGhpcy5zbmFwcGluZ09wdGlvbnM7XG4gICAgICAgIHNrZXRjaFN0YXRlLnNrZXRjaFRvb2x0aXBPcHRpb25zID0gdGhpcy5za2V0Y2hUb29sdGlwT3B0aW9ucztcbiAgICAgICAgc2tldGNoU3RhdGUuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcyA9IHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcztcbiAgICAgICAgc2tldGNoU3RhdGUuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzID0gdGhpcy5za2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHM7XG4gICAgICAgIGlmICh0aGlzLm1hcE5vdGVzRmVhdHVyZSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNrZXRjaEZlYXR1cmVzRmVhdHVyZXMgPSBbdGhpcy5tYXBOb3Rlc0ZlYXR1cmVdO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoX2EgPSB0aGlzLnNlbGVjdGVkU2tldGNoRmVhdHVyZXNGZWF0dXJlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MgPSB0aGlzLnNlbGVjdGVkU2tldGNoRmVhdHVyZXNGZWF0dXJlcy5maWx0ZXIoKGdyYXBoaWMpID0+IGlzRGVmaW5lZChncmFwaGljKSk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzID0gdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3M7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRTa2V0Y2hJbmZvKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgaWYgKHRoaXMubmVlZHNNYXBWaWV3SGFuZGxlcykge1xuICAgICAgICAgICAgdGhpcy5tYXBWaWV3LmZvY3VzKCk7XG4gICAgICAgICAgICB0aGlzLndhdGNoRGVsZXRlT25NYXBWaWV3KHRydWUpO1xuICAgICAgICAgICAgdGhpcy53YXRjaEVzY2FwZU9uTWFwVmlldyh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBkaXNhYmxlIHBvcHVwIGluIHRoZSBtYXAgdmlld1xuICAgICAgICB0aGlzLm1hcFZpZXcucG9wdXBFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIC8vIHNrZXRjaCB0b29sc1xuICAgICAgICB0aGlzLmNyZWF0ZVNrZXRjaFRvb2xzKCk7XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMud2F0Y2hFc2NhcGVPbk1hcFZpZXcoZmFsc2UpO1xuICAgICAgICB0aGlzLndhdGNoRGVsZXRlT25NYXBWaWV3KGZhbHNlKTtcbiAgICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgICAgIHRoaXMucmVtb3ZlU2tldGNoU2hvcnRjdXRzKCk7XG4gICAgICAgIChfYSA9IHRoaXMuc2VsZWN0b3JPcGVyYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYW5jZWwoKTtcbiAgICB9XG4gICAgLy8gRXZlbnRzXG4gICAgYXJjZ2lzU2tldGNoQWN0aXZlU3ltYm9sQ2hhbmdlSGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgIH1cbiAgICBjbG9zZVNrZXRjaFBvcG92ZXJzSGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5jbG9zZVBvcHVwUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICB0aGlzLnNrZXRjaE1lc3NhZ2VIYW5kbGVyKG51bGwpO1xuICAgICAgICB0aGlzLnNob3dTa2V0Y2hDb250ZW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2xvc2VTa2V0Y2hTbmFwcGluZ1BvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVTa2V0Y2hTaG9ydGN1dHMoKTtcbiAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xuICAgIH1cbiAgICBjbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnNIYW5kbGVyKCkge1xuICAgICAgICBpZiAodGhpcy5za2V0Y2hTbmFwcGluZ0VsKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuc2tldGNoU25hcHBpbmdFbCk7XG4gICAgICAgICAgICB0aGlzLnNrZXRjaFNuYXBwaW5nRWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlU2tldGNoUGFuZWwuZW1pdChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xuICAgIH1cbiAgICBkaXNhYmxlU2tldGNoUGFuZWxIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnNrZXRjaEZsb3dJdGVtRWwuZGlzYWJsZWQgPSBldmVudC5kZXRhaWw7XG4gICAgfVxuICAgIGludGVybmFsU2tldGNoVXBkYXRlZEhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuc2tldGNoVXBkYXRlZC5lbWl0KCk7XG4gICAgfVxuICAgIHNrZXRjaEdyYXBoaWNVcGRhdGVzSGFuZGxlcihldmVudCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgZ3JhcGhpY1VwZGF0ZXMgPSBldmVudC5kZXRhaWw7XG4gICAgICAgIGlmIChncmFwaGljVXBkYXRlcy51cGRhdGUpIHtcbiAgICAgICAgICAgIC8vIHVwZGF0ZSByZWNlbnQgY29sb3JzIGZvciBDSU0gc3ltYm9sc1xuICAgICAgICAgICAgaWYgKGdyYXBoaWNVcGRhdGVzLnR5cGUgPT09IFwic3ltYm9sXCIgJiYgZ3JhcGhpY1VwZGF0ZXMuc3ltYm9sU3dpdGNoRnJvbVJlY2VudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbG9yID0gKF9hID0gZ2V0U3ltYm9sQ29sb3IodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0hleCgpO1xuICAgICAgICAgICAgICAgIGlmIChuZXdDb2xvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1JlY2VudENvbG9yc1VwZGF0ZS5lbWl0KG5ld0NvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5za2V0Y2hNb2RlID09PSBcInVwZGF0ZVwiICYmICgoX2IgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzQnVsayA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3MubGVuZ3RoID4gMTtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYmFzaXMgZm9yIGNvbXBhcmlzb246IG9yaWdpbmFsIHN5bWJvbCBpcyB0aGUgZmlyc3Qgc2VsZWN0ZWQgc3ltYm9sIHByZS1tb2RpZmljYXRpb25cbiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbFN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbMF0uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3U3ltYm9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbFN5bWJvbFNpemUgPSBnZXRTeW1ib2xTaXplKG9yaWdpbmFsU3ltYm9sKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbFN5bWJvbFJvdGF0aW9uID0gZ2V0U3ltYm9sUm90YXRpb24ob3JpZ2luYWxTeW1ib2wpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsU3ltYm9sQ29sb3IgPSBnZXRTeW1ib2xDb2xvcihvcmlnaW5hbFN5bWJvbCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxTeW1ib2xPdXRsaW5lID0gZ2V0U3ltYm9sT3V0bGluZShvcmlnaW5hbFN5bWJvbCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxTeW1ib2xPdXRsaW5lU3R5bGUgPSAoX2MgPSBvcmlnaW5hbFN5bWJvbC5vdXRsaW5lKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3R5bGU7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxTeW1ib2xTdHJva2VTdHlsZSA9IG9yaWdpbmFsU3ltYm9sLnN0eWxlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N5bWJvbFNpemUgPSBnZXRTeW1ib2xTaXplKG5ld1N5bWJvbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3U3ltYm9sUm90YXRpb24gPSBnZXRTeW1ib2xSb3RhdGlvbihuZXdTeW1ib2wpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N5bWJvbENvbG9yID0gZ2V0U3ltYm9sQ29sb3IobmV3U3ltYm9sKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdTeW1ib2xPdXRsaW5lID0gZ2V0U3ltYm9sT3V0bGluZShuZXdTeW1ib2wpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N5bWJvbE91dGxpbmVTdHlsZSA9IChfZCA9IG5ld1N5bWJvbC5vdXRsaW5lKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3R5bGU7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3U3ltYm9sU3Ryb2tlU3R5bGUgPSBuZXdTeW1ib2wuc3R5bGU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcy5mb3JFYWNoKChncmFwaGljLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyYXBoaWNVcGRhdGVzLnR5cGUgPT09IFwidGl0bGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyYXBoaWMuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbaWR4XS5hdHRyaWJ1dGVzLnRpdGxlID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbaWR4XS5hdHRyaWJ1dGVzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyYXBoaWNVcGRhdGVzLnR5cGUgPT09IFwicG9wdXBcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1tpZHhdLnBvcHVwVGVtcGxhdGUgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChncmFwaGljVXBkYXRlcy50eXBlID09PSBcInN5bWJvbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQnVsayB8fCBncmFwaGljVXBkYXRlcy5zeW1ib2xTd2l0Y2hGcm9tUmVjZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1tpZHhdLnN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChncmFwaGljVXBkYXRlcy5zeW1ib2xTd2l0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSB0cmlnZ2VyIGEgc3ltYm9sIGNoYW5nZSwgd2Ugd2FudCB0byBhcHBseSBzb21lIG9mIHRoZSBvbGQgc3ltYm9sJ3MgYXR0cmlidXRlcyB0byB0aGUgbmV3IHN5bWJvbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbaWR4XS5zeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGdldFN5bWJvbFNpemUoY3VycmVudFN5bWJvbCkpICYmIGlzRGVmaW5lZChnZXRTeW1ib2xTaXplKG5ld1N5bWJvbCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sU2l6ZShuZXdTeW1ib2wsIGdldFN5bWJvbFNpemUoY3VycmVudFN5bWJvbCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGdldFN5bWJvbFJvdGF0aW9uKGN1cnJlbnRTeW1ib2wpKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmluZWQoZ2V0U3ltYm9sUm90YXRpb24obmV3U3ltYm9sKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlTeW1ib2xSb3RhdGlvbihuZXdTeW1ib2wsIGdldFN5bWJvbFJvdGF0aW9uKGN1cnJlbnRTeW1ib2wpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVmaW5lZChnZXRTeW1ib2xDb2xvcihjdXJyZW50U3ltYm9sKSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZWZpbmVkKGdldFN5bWJvbENvbG9yKG5ld1N5bWJvbCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sQ29sb3IobmV3U3ltYm9sLCBnZXRTeW1ib2xDb2xvcihjdXJyZW50U3ltYm9sKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbaWR4XS5zeW1ib2wgPSBuZXdTeW1ib2w7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBkaWQgbm90IHRyaWdnZXIgYSBzeW1ib2wgY2hhbmdlLCB3ZSB3YW50IHRvIGFwcGx5IHNvbWUgb2YgdGhlIG5ldyBzeW1ib2wncyBhdHRyaWJ1dGVzIHRvIHRoZSBvbGQgc3ltYm9sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbaWR4XS5zeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTeW1ib2wgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbFN5bWJvbFNpemUgIT09IG5ld1N5bWJvbFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlTeW1ib2xTaXplKGN1cnJlbnRTeW1ib2wsIGdldFN5bWJvbFNpemUobmV3U3ltYm9sKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbFN5bWJvbFJvdGF0aW9uICE9PSBuZXdTeW1ib2xSb3RhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVN5bWJvbFJvdGF0aW9uKGN1cnJlbnRTeW1ib2wsIGdldFN5bWJvbFJvdGF0aW9uKG5ld1N5bWJvbCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkob3JpZ2luYWxTeW1ib2xDb2xvciA9PT0gbnVsbCB8fCBvcmlnaW5hbFN5bWJvbENvbG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcmlnaW5hbFN5bWJvbENvbG9yLnRvSlNPTigpKSAhPT1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkobmV3U3ltYm9sQ29sb3IgPT09IG51bGwgfHwgbmV3U3ltYm9sQ29sb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5ld1N5bWJvbENvbG9yLnRvSlNPTigpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sb3IgPSBnZXRTeW1ib2xDb2xvcihjdXJyZW50U3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbG9yID0gZ2V0U3ltYm9sQ29sb3IobmV3U3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTYW1lQ29sb3JUcmFuc3BhcmVuY3kgPSBvcmlnaW5hbFN5bWJvbENvbG9yLmEgPT09IG5ld1N5bWJvbENvbG9yLmE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1NhbWVDb2xvclRyYW5zcGFyZW5jeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbG9yLnIgPSB1cGRhdGVkQ29sb3IucjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvci5nID0gdXBkYXRlZENvbG9yLmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IuYiA9IHVwZGF0ZWRDb2xvci5iO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbG9yLmEgPSB1cGRhdGVkQ29sb3IuYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVN5bWJvbENvbG9yKGN1cnJlbnRTeW1ib2wsIGN1cnJlbnRDb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShvcmlnaW5hbFN5bWJvbE91dGxpbmUgPT09IG51bGwgfHwgb3JpZ2luYWxTeW1ib2xPdXRsaW5lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcmlnaW5hbFN5bWJvbE91dGxpbmUudG9KU09OKCkpICE9PVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShuZXdTeW1ib2xPdXRsaW5lID09PSBudWxsIHx8IG5ld1N5bWJvbE91dGxpbmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5ld1N5bWJvbE91dGxpbmUudG9KU09OKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRPdXRsaW5lID0gZ2V0U3ltYm9sT3V0bGluZShjdXJyZW50U3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZE91dGxpbmUgPSBnZXRTeW1ib2xPdXRsaW5lKG5ld1N5bWJvbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU2FtZU91dGxpbmVUcmFuc3BhcmVuY3kgPSAob3JpZ2luYWxTeW1ib2xPdXRsaW5lID09PSBudWxsIHx8IG9yaWdpbmFsU3ltYm9sT3V0bGluZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3JpZ2luYWxTeW1ib2xPdXRsaW5lLmNvbG9yLmEpID09PSAobmV3U3ltYm9sT3V0bGluZSA9PT0gbnVsbCB8fCBuZXdTeW1ib2xPdXRsaW5lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdTeW1ib2xPdXRsaW5lLmNvbG9yLmEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1NhbWVPdXRsaW5lV2lkdGggPSAob3JpZ2luYWxTeW1ib2xPdXRsaW5lID09PSBudWxsIHx8IG9yaWdpbmFsU3ltYm9sT3V0bGluZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3JpZ2luYWxTeW1ib2xPdXRsaW5lLndpZHRoKSA9PT0gKG5ld1N5bWJvbE91dGxpbmUgPT09IG51bGwgfHwgbmV3U3ltYm9sT3V0bGluZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV3U3ltYm9sT3V0bGluZS53aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNTYW1lT3V0bGluZVdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50T3V0bGluZS53aWR0aCA9IHVwZGF0ZWRPdXRsaW5lLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU2FtZU91dGxpbmVUcmFuc3BhcmVuY3kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50T3V0bGluZS5jb2xvci5yID0gdXBkYXRlZE91dGxpbmUuY29sb3IucjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50T3V0bGluZS5jb2xvci5nID0gdXBkYXRlZE91dGxpbmUuY29sb3IuZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50T3V0bGluZS5jb2xvci5iID0gdXBkYXRlZE91dGxpbmUuY29sb3IuYjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRPdXRsaW5lLmNvbG9yLmEgPSB1cGRhdGVkT3V0bGluZS5jb2xvci5hO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sT3V0bGluZShjdXJyZW50U3ltYm9sLCBjdXJyZW50T3V0bGluZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShvcmlnaW5hbFN5bWJvbE91dGxpbmVTdHlsZSkgIT09IEpTT04uc3RyaW5naWZ5KG5ld1N5bWJvbE91dGxpbmVTdHlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTeW1ib2wub3V0bGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN5bWJvbC5vdXRsaW5lLnN0eWxlID0gbmV3U3ltYm9sT3V0bGluZVN0eWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShvcmlnaW5hbFN5bWJvbFN0cm9rZVN0eWxlKSAhPT0gSlNPTi5zdHJpbmdpZnkobmV3U3ltYm9sU3Ryb2tlU3R5bGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTeW1ib2wuc3R5bGUgPSBuZXdTeW1ib2xTdHJva2VTdHlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmFwaGljVXBkYXRlcy50ZXh0UHJvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGdyYXBoaWNVcGRhdGVzLnRleHRQcm9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTeW1ib2wudGV4dCA9IG5ld1N5bWJvbC50ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZvbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3ltYm9sLmZvbnQuZmFtaWx5ID0gbmV3U3ltYm9sLmZvbnQuZmFtaWx5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTeW1ib2wuZm9udC53ZWlnaHQgPSBuZXdTeW1ib2wuZm9udC53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN5bWJvbC5mb250LnN0eWxlID0gbmV3U3ltYm9sLmZvbnQuc3R5bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZm9udC1zaXplXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN5bWJvbC5mb250LnNpemUgPSBuZXdTeW1ib2wuZm9udC5zaXplO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNvbG9yXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN5bWJvbC5jb2xvciA9IG5ld1N5bWJvbC5jb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJyb3RhdGlvblwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTeW1ib2wuYW5nbGUgPSBuZXdTeW1ib2wuYW5nbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaGFsb1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTeW1ib2wuaGFsb0NvbG9yID0gbmV3U3ltYm9sLmhhbG9Db2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3ltYm9sLmhhbG9TaXplID0gbmV3U3ltYm9sLmhhbG9TaXplO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImhhbG8tY29sb3JcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3ltYm9sLmhhbG9Db2xvciA9IG5ld1N5bWJvbC5oYWxvQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaGFsby1zaXplXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN5bWJvbC5oYWxvU2l6ZSA9IG5ld1N5bWJvbC5oYWxvU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzW2lkeF0uc3ltYm9sID0gY3VycmVudFN5bWJvbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGVtcENyZWF0ZWRHcmFwaGljKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlbXBDcmVhdGVkR3JhcGhpYy5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBDcmVhdGVkR3JhcGhpYy5hdHRyaWJ1dGVzLnRpdGxlID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLmF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuY3VycmVudFNrZXRjaEluZm8udGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wQ3JlYXRlZEdyYXBoaWMucG9wdXBUZW1wbGF0ZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljLnN5bWJvbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInBvaW50XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLnNldFBvaW50KHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN2TW9kZWwuc2V0VGV4dCh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9PT0gXCJwb2x5bGluZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC5zZXRMaW5lKHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoW1wiY2lyY2xlXCIsIFwicG9seWdvblwiLCBcInJlY3RhbmdsZVwiXS5pbmRleE9mKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN2TW9kZWwuc2V0UG9seWdvbih0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdG8gcmVmcmVzaCBwb3B1cFxuICAgICAgICAgICAgdGhpcy5tYXBWaWV3LnBvcHVwLmZlYXR1cmVzID0gWyhfZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3MpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZVswXV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdyYXBoaWNVcGRhdGVzLmNsb3NlKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VTa2V0Y2hQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLnN2TW9kZWwuY2FuY2VsKCk7XG4gICAgICAgICAgICB0aGlzLnN2TW9kZWwudXBkYXRlT25HcmFwaGljKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludGVybmFsU2tldGNoVXBkYXRlZC5lbWl0KCk7XG4gICAgfVxuICAgIGFzeW5jIHNrZXRjaEFjdGlvbk9uRHJhd0ZlYXR1cmVzSGFuZGxlcih7IGRldGFpbDogeyB0b29sLCBza2V0Y2hNZXNzYWdlIH0gfSkge1xuICAgICAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICAgICAgdGhpcy53YXRjaEVzY2FwZU9uTWFwVmlldyh0cnVlKTtcbiAgICAgICAgdGhpcy53YXRjaERlbGV0ZU9uTWFwVmlldyhmYWxzZSk7XG4gICAgICAgIC8vIGNsb3NlIHBvcG92ZXIgdG8gcmVzZXQgd2hlbiBtb3ZpbmcgZnJvbSB1cGRhdGUgdG8gY29udGludW91cyBtb2RlXG4gICAgICAgIGlmICh0aGlzLnNrZXRjaE1vZGUgPT09IFwidXBkYXRlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VTa2V0Y2hQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5za2V0Y2hNZXNzYWdlSGFuZGxlcihza2V0Y2hNZXNzYWdlKTtcbiAgICAgICAgdGhpcy5za2V0Y2hNb2RlID0gXCJjb250aW51b3VzXCI7XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5jYW5jZWwoKTtcbiAgICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcyA9IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9IHRvb2w7XG4gICAgICAgIHN3aXRjaCAodG9vbCkge1xuICAgICAgICAgICAgY2FzZSBcInBvaW50XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLnNldFBvaW50KChhd2FpdCBkZWZhdWx0Q2ltU3ltYm9sKHRoaXMuQ0lNU3ltYm9sLCB0aGlzLm1hcFZpZXcsIHRoaXMuQ29sb3JVdGlscykpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRQb2ludCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC5jcmVhdGVQb2ludCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLnNldExpbmUoYXdhaXQgZGVmYXVsdExpbmVTeW1ib2wodGhpcy5tYXBWaWV3LCB0aGlzLkNvbG9yVXRpbHMpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRMaW5lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmNyZWF0ZUxpbmUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJwb2x5Z29uXCI6XG4gICAgICAgICAgICBjYXNlIFwicmVjdGFuZ2xlXCI6XG4gICAgICAgICAgICBjYXNlIFwiY2lyY2xlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLnNldFBvbHlnb24oYXdhaXQgZGVmYXVsdFBvbHlnb25TeW1ib2wodGhpcy5tYXBWaWV3LCB0aGlzLkNvbG9yVXRpbHMpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRQb2x5Z29uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmNyZWF0ZVBvbHlnb24odG9vbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC5zZXRUZXh0KChhd2FpdCBkZWZhdWx0VGV4dFN5bWJvbCh0aGlzLm1hcFZpZXcsIHRoaXMuQ29sb3JVdGlscywgdGhpcy5UZXh0U3ltYm9sLCB0aGlzLnN0cmluZ3MudGV4dCkpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHRoaXMuc3ZNb2RlbC5nZXRUZXh0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmNyZWF0ZVRleHQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnBvcHVwID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50aXRsZSA9IHRoaXMuZGVmYXVsdEdyYXBoaWNUaXRsZSgpO1xuICAgICAgICB0aGlzLnNrZXRjaENvbnRlbnRSZVJlbmRlci5lbWl0KHRvb2wpO1xuICAgICAgICB0aGlzLnNob3dTa2V0Y2hDb250ZW50ID0gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgc2tldGNoQWN0aW9uT25TZWxlY3RGZWF0dXJlc0hhbmRsZXIoeyBkZXRhaWw6IHsgc2tldGNoTWVzc2FnZSwgbXVsdGlwbGVTZWxlY3RUb29sIH0gfSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMua2VlcFNlbGVjdGlvbk1lc3NhZ2UgPSBza2V0Y2hNZXNzYWdlO1xuICAgICAgICB0aGlzLmtlZXBTZWxlY3Rpb25Ub29sID0gbXVsdGlwbGVTZWxlY3RUb29sO1xuICAgICAgICB0aGlzLmNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKTtcbiAgICAgICAgdGhpcy53YXRjaEVzY2FwZU9uTWFwVmlldyhmYWxzZSk7XG4gICAgICAgIHRoaXMud2F0Y2hEZWxldGVPbk1hcFZpZXcoZmFsc2UpO1xuICAgICAgICB0aGlzLmNsb3NlU2tldGNoUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICB0aGlzLnRlbXBDcmVhdGVkR3JhcGhpYyA9IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3MgPSBudWxsO1xuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCA9IG51bGw7XG4gICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gW107XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5jYW5jZWwoKTtcbiAgICAgICAgdGhpcy5za2V0Y2hNb2RlID0gXCJ1cGRhdGVcIjtcbiAgICAgICAgdGhpcy5za2V0Y2hNZXNzYWdlSGFuZGxlcih0aGlzLmtlZXBTZWxlY3Rpb25NZXNzYWdlKTtcbiAgICAgICAgdGhpcy5za2V0Y2hDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICBpZiAodGhpcy5rZWVwU2VsZWN0aW9uVG9vbCkge1xuICAgICAgICAgICAgdGhpcy5hY3Rpb25Pbk11bHRpcGxlU2VsZWN0aW9ucyh0aGlzLmtlZXBTZWxlY3Rpb25Ub29sKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuc2VsZWN0b3JPcGVyYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYW5jZWwoKTtcbiAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC51cGRhdGVPbkdyYXBoaWModHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXJjZ2lzU2tldGNoUGFuZWxMb2FkZXJIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnNrZXRjaEZsb3dJdGVtRWwubG9hZGluZyA9IGV2ZW50LmRldGFpbDtcbiAgICB9XG4gICAgLy8gUHVibGljIE1ldGhvZHNcbiAgICBhc3luYyBkb25lKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICAgICAgaWYgKChfYSA9IHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHNhdmVTbmFwcGluZ1RvU3RvcmFnZSh0aGlzLnNuYXBwaW5nT3B0aW9ucywgdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoX2IgPSB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHNhdmVTa2V0Y2hUb29sdGlwVG9TdG9yYWdlKHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMsIHRoaXMuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xvc2VTa2V0Y2hQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5kZXN0cm95KCk7XG4gICAgICAgIChfYyA9IHRoaXMuc2tldGNoVG9vbHNFbCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnNrZXRjaFRvb2xzRWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVtb3ZlU2tldGNoU2hvcnRjdXRzKCk7XG4gICAgICAgIC8vIGVuYWJsZSBwb3B1cCBpbiB0aGUgbWFwIHZpZXdcbiAgICAgICAgdGhpcy5tYXBWaWV3LnBvcHVwRW5hYmxlZCA9IHRydWU7XG4gICAgfVxuICAgIGFzeW5jIGFjdGl2YXRlTGF5ZXIobGF5ZXIsIGZlYXR1cmVzVG9TZWxlY3QpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgKF9hID0gdGhpcy5zdk1vZGVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZVNlc3Npb25TdG9yYWdlT3B0aW9ucygpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVTVk1vZGVsKCk7XG4gICAgICAgIGlmIChmZWF0dXJlc1RvU2VsZWN0KSB7XG4gICAgICAgICAgICB0aGlzLm5ld1NrZXRjaExheWVyRmVhdHVyZXMgPSBmZWF0dXJlc1RvU2VsZWN0Lm1hcCgoZmVhdHVyZVRvU2VsZWN0KSA9PiBmZWF0dXJlVG9TZWxlY3QuY2xvbmUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChfYiA9IHRoaXMubmV3U2tldGNoTGF5ZXJGZWF0dXJlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IHRlbXBQb2ludCA9IFtdO1xuICAgICAgICAgICAgbGV0IHRlbXBMaW5lID0gW107XG4gICAgICAgICAgICBsZXQgdGVtcFBvbHlnb24gPSBbXTtcbiAgICAgICAgICAgIGxldCB0ZW1wVGV4dCA9IFtdO1xuICAgICAgICAgICAgdGhpcy5uZXdTa2V0Y2hMYXllckZlYXR1cmVzLmZvckVhY2goKGN1cnJHcmFwaGljKSA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChnZXRHZW9tZXRyeVR5cGVGcm9tR3JhcGhpYyhjdXJyR3JhcGhpYykpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyR3JhcGhpYy5sYXllciA9IHRoaXMubGF5ZXIucG9seWxpbmVMYXllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBMaW5lID0gWy4uLnRlbXBMaW5lLCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInBvbHlnb25cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJHcmFwaGljLmxheWVyID0gdGhpcy5sYXllci5wb2x5Z29uTGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUG9seWdvbiA9IFsuLi50ZW1wUG9seWdvbiwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyR3JhcGhpYy5sYXllciA9IHRoaXMubGF5ZXIudGV4dExheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFRleHQgPSBbLi4udGVtcFRleHQsIGN1cnJHcmFwaGljXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY3VyckdyYXBoaWMubGF5ZXIgPSB0aGlzLmxheWVyLnBvaW50TGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUG9pbnQgPSBbLi4udGVtcFBvaW50LCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3MgPSB0aGlzLm5ld1NrZXRjaExheWVyRmVhdHVyZXM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRTa2V0Y2hJbmZvKCk7XG4gICAgICAgICAgICAvLyBUaW1lb3V0IGlzIHJlcXVpcmVkIHRvIGNvcnJlY3RseSBoaWdobGlnaHQgZ3JhcGhpY3NcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRlbXBQb2ludC5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZVBvaW50KHRlbXBQb2ludCk7XG4gICAgICAgICAgICAgICAgdGVtcExpbmUubGVuZ3RoICYmIHRoaXMuc3ZNb2RlbC51cGRhdGVMaW5lKHRlbXBMaW5lKTtcbiAgICAgICAgICAgICAgICB0ZW1wUG9seWdvbi5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZVBvbHlnb24odGVtcFBvbHlnb24pO1xuICAgICAgICAgICAgICAgIHRlbXBUZXh0Lmxlbmd0aCAmJiB0aGlzLnN2TW9kZWwudXBkYXRlVGV4dCh0ZW1wVGV4dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hNb2RlID0gXCJ1cGRhdGVcIjtcbiAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgc2V0Rm9jdXMoZm9jdXNJZCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChmb2N1c0lkID09PSBcImRpc21pc3MtYnV0dG9uXCIpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuZGlzbWlzc0J1dHRvbkVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjbGVhckhpZ2hsaWdodHMoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0KCk7XG4gICAgfVxuICAgIC8vIFByaXZhdGUgTWV0aG9kc1xuICAgIGluaXRpYWxpemVTZXNzaW9uU3RvcmFnZU9wdGlvbnMoKSB7XG4gICAgICAgIHRoaXMuc25hcHBpbmdPcHRpb25zID0gZ2V0U25hcHBpbmdPcHRpb25zKHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcywgdGhpcy5sYXllciwgdGhpcy5tYXBWaWV3LCB0aGlzLlNuYXBwaW5nT3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMgPSBnZXRTa2V0Y2hUb29sdGlwT3B0aW9ucyh0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcywgdGhpcy5Ta2V0Y2hUb29sdGlwT3B0aW9ucyk7XG4gICAgfVxuICAgIGluaXRpYWxpemVTVk1vZGVsKCkge1xuICAgICAgICB0aGlzLnN2TW9kZWwgPSBuZXcgU1ZNb2RlbCh0aGlzLmxheWVyLCB0aGlzLm1hcFZpZXcsIHRoaXMuU2tldGNoVmlld01vZGVsLCB0aGlzLnNuYXBwaW5nT3B0aW9ucywgdGhpcy5za2V0Y2hUb29sdGlwT3B0aW9ucywgKGV2ZW50LCBza2V0Y2hWaWV3TW9kZWwpID0+IHRoaXMub25HcmFwaGljQ3JlYXRlKGV2ZW50LCBza2V0Y2hWaWV3TW9kZWwpLCB0aGlzLm9uR3JhcGhpY1VwZGF0ZSk7XG4gICAgfVxuICAgIHVwZGF0ZUN1cnJlbnRTa2V0Y2hJbmZvKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXVxuICAgICAgICAgICAgLnN5bWJvbDtcbiAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID0gZ2V0R2VvbWV0cnlUeXBlRnJvbUdyYXBoaWModGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXSk7XG4gICAgICAgIGNvbnN0IGZpcnN0VGl0bGUgPSAoKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXS5hdHRyaWJ1dGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpIHx8IHRoaXMuZGVmYXVsdEdyYXBoaWNUaXRsZSgpO1xuICAgICAgICBjb25zdCBpZGVudGljYWxUaXRsZXMgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzLmV2ZXJ5KChncmFwaGljKSA9PiB7IHZhciBfYTsgcmV0dXJuICgoX2EgPSBncmFwaGljLmF0dHJpYnV0ZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZSkgPT09IGZpcnN0VGl0bGU7IH0pO1xuICAgICAgICBjb25zdCBmaXJzdFBvcHVwID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXS5wb3B1cFRlbXBsYXRlO1xuICAgICAgICBjb25zdCBpZGVudGljYWxQb3B1cHMgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzLmV2ZXJ5KChncmFwaGljKSA9PiBKU09OLnN0cmluZ2lmeShncmFwaGljLnBvcHVwVGVtcGxhdGUpID09PSBKU09OLnN0cmluZ2lmeShmaXJzdFBvcHVwKSk7XG4gICAgICAgIC8vIGVkaXRpbmcgYnVsayBpdGVtcyBzaG91bGQgc3RhcnQgd2l0aCBhbiBlbXB0eSBwb3B1cCBhbmQgdGl0bGUsIHVubGVzcyBhbGwgdGl0bGVzL3BvcHVwcyBhbGlnblxuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlID0gaWRlbnRpY2FsVGl0bGVzID8gZmlyc3RUaXRsZSA6IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXAgPSBpZGVudGljYWxQb3B1cHMgPyBmaXJzdFBvcHVwIDogbnVsbDtcbiAgICAgICAgdGhpcy5zaG93U2tldGNoQ29udGVudCA9IHRydWU7XG4gICAgICAgIHRoaXMuc3ZNb2RlbC51cGRhdGVPbkdyYXBoaWModHJ1ZSwgdGhpcy5vbkdyYXBoaWNVcGRhdGUpO1xuICAgICAgICB0aGlzLm5lZWRzTWFwVmlld0hhbmRsZXMgPSB0cnVlO1xuICAgIH1cbiAgICBhc3luYyB1cGRhdGVTa2V0Y2hUb29scygpIHtcbiAgICAgICAgaWYgKHRoaXMuc2tldGNoVG9vbHNFbCkge1xuICAgICAgICAgICAgdGhpcy5za2V0Y2hUb29sc0VsLnNrZXRjaFRvb2xzVG9IaWRlID0gdGhpcy5za2V0Y2hUb29sc1RvSGlkZTtcbiAgICAgICAgICAgIHRoaXMuc2tldGNoVG9vbHNFbC5oaWRlU2VsZWN0aW9uVG9vbHMgPSB0aGlzLmhpZGVTZWxlY3Rpb25Ub29scztcbiAgICAgICAgICAgIHRoaXMuc2tldGNoVG9vbHNFbC5hY3RpdmVTa2V0Y2hUb29sID0gdGhpcy5hY3RpdmVTa2V0Y2hUb29sO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZVNrZXRjaFRvb2xzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuc2tldGNoVG9vbHNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc2tldGNoLXRvb2xzXCIpO1xuICAgICAgICB0aGlzLnNrZXRjaFRvb2xzRWwuc2tldGNoVG9vbHNUb0hpZGUgPSB0aGlzLnNrZXRjaFRvb2xzVG9IaWRlO1xuICAgICAgICB0aGlzLnNrZXRjaFRvb2xzRWwuYWN0aXZlU2tldGNoVG9vbCA9IHRoaXMuYWN0aXZlU2tldGNoVG9vbDtcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sc0VsLmhpZGVTZWxlY3Rpb25Ub29scyA9IHRoaXMuaGlkZVNlbGVjdGlvblRvb2xzO1xuICAgICAgICB0aGlzLnNrZXRjaFRvb2xzRWwucmVmRWxlbWVudCA9IChfYSA9IHRoaXMuc2tldGNoVG9vbHNSZWZlcmVuY2VFbGVtZW50KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB0aGlzLmhvc3RFbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFNrZXRjaEZlYXR1cmVzRmVhdHVyZXMpIHtcbiAgICAgICAgICAgIHRoaXMuc2tldGNoVG9vbHNFbC5tYXBOb3Rlc0ZlYXR1cmVzID0gdGhpcy5zZWxlY3RlZFNrZXRjaEZlYXR1cmVzRmVhdHVyZXM7XG4gICAgICAgIH1cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnNrZXRjaFRvb2xzRWwpO1xuICAgICAgICBpZiAodGhpcy5za2V0Y2hDb250ZW50RWwgJiYgIXRoaXMuc2tldGNoQ29udGVudEVsLnN5bWJvbFN0eWxlclJlZkVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2tldGNoQ29udGVudEVsLnN5bWJvbFN0eWxlclJlZkVsZW1lbnQgPSB0aGlzLmRpc21pc3NCdXR0b25FbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBsb2FkQWxsTW9kdWxlcygpIHtcbiAgICAgICAgW1xuICAgICAgICAgICAgdGhpcy5Ta2V0Y2hWaWV3TW9kZWwsXG4gICAgICAgICAgICB0aGlzLlRleHRTeW1ib2wsXG4gICAgICAgICAgICB0aGlzLkNvbG9yVXRpbHMsXG4gICAgICAgICAgICB0aGlzLkNJTVN5bWJvbCxcbiAgICAgICAgICAgIHRoaXMuU25hcHBpbmdPcHRpb25zLFxuICAgICAgICAgICAgdGhpcy5Ta2V0Y2hUb29sdGlwT3B0aW9ucyxcbiAgICAgICAgICAgIHRoaXMuU2VsZWN0aW9uT3BlcmF0aW9uXG4gICAgICAgIF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICAgICAgICBcImVzcmkvd2lkZ2V0cy9Ta2V0Y2gvU2tldGNoVmlld01vZGVsXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9UZXh0U3ltYm9sXCIsXG4gICAgICAgICAgICBcImVzcmkvdmlld3Mvc3VwcG9ydC9jb2xvclV0aWxzXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9DSU1TeW1ib2xcIixcbiAgICAgICAgICAgIFwiZXNyaS92aWV3cy9pbnRlcmFjdGl2ZS9zbmFwcGluZy9TbmFwcGluZ09wdGlvbnNcIixcbiAgICAgICAgICAgIFwiZXNyaS92aWV3cy9pbnRlcmFjdGl2ZS9za2V0Y2gvU2tldGNoVG9vbHRpcE9wdGlvbnNcIixcbiAgICAgICAgICAgIFwiZXNyaS93aWRnZXRzL3N1cHBvcnQvU2VsZWN0b3IyRC9TZWxlY3Rpb25PcGVyYXRpb25cIlxuICAgICAgICBdKTtcbiAgICB9XG4gICAgcmVtb3ZlU2tldGNoU2hvcnRjdXRzKCkge1xuICAgICAgICBpZiAodGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTa2V0Y2hTaG9ydGN1dHNEaXNtaXNzZWRDaGFuZ2VcIiwgKCkgPT4gdGhpcy5yZW1vdmVTa2V0Y2hTaG9ydGN1dHMoKSk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkdyYXBoaWNDcmVhdGUoZXZlbnQsIHNrZXRjaFZpZXdNb2RlbCkge1xuICAgICAgICBpZiAoZXZlbnQuc3RhdGUgPT09IFwic3RhcnRcIikge1xuICAgICAgICAgICAgdGhpcy50ZW1wQ3JlYXRlZEdyYXBoaWMgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZlbnQuc3RhdGUgPT09IFwiY2FuY2VsXCIgJiYgdGhpcy5lc2NLZXkpIHtcbiAgICAgICAgICAgIHRoaXMuZXNjS2V5ID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zdCB0b29sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInRleHRcIiA/IFwicG9pbnRcIiA6IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbDtcbiAgICAgICAgICAgIHNrZXRjaFZpZXdNb2RlbC5jcmVhdGUodG9vbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LnN0YXRlID09PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTa2V0Y2hVcGRhdGVkLmVtaXQoKTtcbiAgICAgICAgICAgIGlmIChldmVudC5ncmFwaGljKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuZ3JhcGhpYy5wb3B1cFRlbXBsYXRlID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5wb3B1cDtcbiAgICAgICAgICAgICAgICBldmVudC5ncmFwaGljLmF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzID0gW2V2ZW50LmdyYXBoaWNdO1xuICAgICAgICAgICAgICAgIHRoaXMudGVtcENyZWF0ZWRHcmFwaGljID0gZXZlbnQuZ3JhcGhpYztcbiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodEdyYXBoaWMoZXZlbnQuZ3JhcGhpYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0b29sID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sID09PSBcInRleHRcIiA/IFwicG9pbnRcIiA6IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbDtcbiAgICAgICAgICAgIHNrZXRjaFZpZXdNb2RlbC5jcmVhdGUodG9vbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgd2F0Y2hFc2NhcGVPbk1hcFZpZXcod2F0Y2gpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAod2F0Y2ggJiYgIXRoaXMud2F0Y2hFc2NhcGVIYW5kbGUpIHtcbiAgICAgICAgICAgIHRoaXMud2F0Y2hFc2NhcGVIYW5kbGUgPSB0aGlzLm1hcFZpZXcub24oXCJrZXktZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICAgICAgICAgICAgICh0aGlzLnN2TW9kZWwuZ2V0UG9pbnRTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldExpbmVTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldFBvbHlnb25TVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmdldFRleHRTVk0oKS5zdGF0ZSA9PT0gXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXNjS2V5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmNhbmNlbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgKF9hID0gdGhpcy53YXRjaEVzY2FwZUhhbmRsZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy53YXRjaEVzY2FwZUhhbmRsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3YXRjaERlbGV0ZU9uTWFwVmlldyh3YXRjaCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh3YXRjaCAmJiAhdGhpcy53YXRjaERlbGV0ZUhhbmRsZSkge1xuICAgICAgICAgICAgdGhpcy53YXRjaERlbGV0ZUhhbmRsZSA9IHRoaXMubWFwVmlldy5vbihcImtleS1kb3duXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRGVsZXRlXCIgfHwgZXZlbnQua2V5ID09PSBcIkJhY2tzcGFjZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlSW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC5kZWxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxldGVJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2VlcFNlbGVjdFRvb2xTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMud2F0Y2hEZWxldGVIYW5kbGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMud2F0Y2hEZWxldGVIYW5kbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGVmYXVsdEdyYXBoaWNUaXRsZSgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wpIHtcbiAgICAgICAgICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MucG9pbnQ7XG4gICAgICAgICAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLmxpbmU7XG4gICAgICAgICAgICBjYXNlIFwicG9seWdvblwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MucG9seWdvbjtcbiAgICAgICAgICAgIGNhc2UgXCJyZWN0YW5nbGVcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLnJlY3RhbmdsZTtcbiAgICAgICAgICAgIGNhc2UgXCJjaXJjbGVcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLmNpcmNsZTtcbiAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy50ZXh0O1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLnBvaW50O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFySGlnaGxpZ2h0QW5kUG9wdXAoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0KCk7XG4gICAgICAgIHRoaXMubWFwVmlldy5jbG9zZVBvcHVwKCk7XG4gICAgfVxuICAgIGFjdGlvbk9uTXVsdGlwbGVTZWxlY3Rpb25zKG11bHRpcGxlU2VsZWN0VG9vbCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkU2tldGNoRmVhdHVyZXNGZWF0dXJlcyA9IG51bGw7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvblNvdXJjZXMgPSBbXG4gICAgICAgICAgICB0aGlzLmxheWVyLnBvaW50TGF5ZXIsXG4gICAgICAgICAgICB0aGlzLmxheWVyLnBvbHlsaW5lTGF5ZXIsXG4gICAgICAgICAgICB0aGlzLmxheWVyLnBvbHlnb25MYXllcixcbiAgICAgICAgICAgIHRoaXMubGF5ZXIudGV4dExheWVyXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGRyYXdPYmplY3QgPSBtdWx0aXBsZVNlbGVjdFRvb2wgPT09IFwicmVjdGFuZ2xlXCJcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2w6IFwicmVjdGFuZ2xlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgIGNyZWF0ZVRvb2w6IFwicG9seWdvblwiLFxuICAgICAgICAgICAgICAgIG1vZGU6IFwiZnJlZWhhbmRcIlxuICAgICAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gKHRoaXMuc2VsZWN0b3JPcGVyYXRpb24gPSBuZXcgdGhpcy5TZWxlY3Rpb25PcGVyYXRpb24oe1xuICAgICAgICAgICAgdmlldzogdGhpcy5tYXBWaWV3LFxuICAgICAgICAgICAgc291cmNlczogc2VsZWN0aW9uU291cmNlcyxcbiAgICAgICAgICAgIG9wdGlvbnM6IGRyYXdPYmplY3RcbiAgICAgICAgfSkpO1xuICAgICAgICBvcGVyYXRpb24ub25jZShcImNvbXBsZXRlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBzZWxlY3Rpb24gfSA9IGV2ZW50O1xuICAgICAgICAgICAgLy90aGlzLnNrZXRjaE1lc3NhZ2VIYW5kbGVyKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5jbGVhckhpZ2hsaWdodEFuZFBvcHVwKCk7XG4gICAgICAgICAgICBpZiAoIWV2ZW50LmFib3J0ZWQgJiYgc2VsZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxldCB0ZW1wUG9pbnQgPSBbXTtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcExpbmUgPSBbXTtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcFBvbHlnb24gPSBbXTtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcFRleHQgPSBbXTtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb24uZm9yRWFjaCgoY3VyckdyYXBoaWMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChnZXRHZW9tZXRyeVR5cGVGcm9tR3JhcGhpYyhjdXJyR3JhcGhpYykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwb2ludFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQb2ludCA9IFsuLi50ZW1wUG9pbnQsIGN1cnJHcmFwaGljXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwb2x5bGluZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBMaW5lID0gWy4uLnRlbXBMaW5lLCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicG9seWdvblwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQb2x5Z29uID0gWy4uLnRlbXBQb2x5Z29uLCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBUZXh0ID0gWy4uLnRlbXBUZXh0LCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQb2ludCA9IFsuLi50ZW1wUG9pbnQsIGN1cnJHcmFwaGljXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gWy4uLnRlbXBQb2ludCwgLi4udGVtcExpbmUsIC4uLnRlbXBQb2x5Z29uLCAuLi50ZW1wVGV4dF07XG4gICAgICAgICAgICAgICAgdGVtcFBvaW50Lmxlbmd0aCAmJiB0aGlzLnN2TW9kZWwudXBkYXRlUG9pbnQodGVtcFBvaW50KTtcbiAgICAgICAgICAgICAgICB0ZW1wTGluZS5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZUxpbmUodGVtcExpbmUpO1xuICAgICAgICAgICAgICAgIHRlbXBQb2x5Z29uLmxlbmd0aCAmJiB0aGlzLnN2TW9kZWwudXBkYXRlUG9seWdvbih0ZW1wUG9seWdvbik7XG4gICAgICAgICAgICAgICAgdGVtcFRleHQubGVuZ3RoICYmIHRoaXMuc3ZNb2RlbC51cGRhdGVUZXh0KHRlbXBUZXh0KTtcbiAgICAgICAgICAgICAgICB0aGlzLndhdGNoRGVsZXRlT25NYXBWaWV3KHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdk1vZGVsLnVwZGF0ZU9uR3JhcGhpYyhmYWxzZSk7XG4gICAgfVxuICAgIHNrZXRjaE1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2UpIHtcbiAgICAgICAgc2tldGNoU3RhdGUuc2tldGNoTWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgfVxuICAgIGhpZ2hsaWdodEdyYXBoaWMoZ3JhcGhpYykge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0KCk7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gKF9hID0gdGhpcy5tYXBWaWV3LmFsbExheWVyVmlld3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pdGVtcy5maW5kKCh7IGxheWVyIH0pID0+IGxheWVyID09PSB0aGlzLmxheWVyKTtcbiAgICAgICAgdGhpcy5jcmVhdGVkR3JhcGhpY0hpZ2hsaWdodEhhbmRsZSA9IG1hdGNoID09PSBudWxsIHx8IG1hdGNoID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXRjaC5oaWdobGlnaHQoZ3JhcGhpYyk7XG4gICAgfVxuICAgIHJlbW92ZUhpZ2hsaWdodCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmNyZWF0ZWRHcmFwaGljSGlnaGxpZ2h0SGFuZGxlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlZEdyYXBoaWNIaWdobGlnaHRIYW5kbGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vIGZvciB3b3JrZmxvd3Mgd2hlcmUgd2Ugd2FudCB0aGUgY3VycmVudCBzZWxlY3QgdG9vbHMgdG8gc3RheSBhY3RpdmF0ZWRcbiAgICBrZWVwU2VsZWN0VG9vbFNlbGVjdGlvbigpIHtcbiAgICAgICAgdGhpcy5za2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzLmVtaXQoe1xuICAgICAgICAgICAgc2tldGNoTWVzc2FnZTogdGhpcy5rZWVwU2VsZWN0aW9uTWVzc2FnZSxcbiAgICAgICAgICAgIG11bHRpcGxlU2VsZWN0VG9vbDogdGhpcy5rZWVwU2VsZWN0aW9uVG9vbFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVuZGVycyB0aGUgU2tldGNoIEZsb3cgUGFuZWxzXG4gICAgICogQHJldHVybnMgVk5vZGVcbiAgICAgKi9cbiAgICByZW5kZXJTa2V0Y2hGbG93UGFuZWwoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgY29uc3QgZGlzbWlzc0J1dHRvbiA9IChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyB0ZXh0OiBcImNsb3NlXCIsIHNjYWxlOiBcIm1cIiwgaWNvbjogXCJ4XCIsIHNsb3Q6IFwiaGVhZGVyLWFjdGlvbnMtZW5kXCIsIHJlZjogKGVsKSA9PiAodGhpcy5kaXNtaXNzQnV0dG9uRWwgPSBlbCksIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2tldGNoTWVzc2FnZUhhbmRsZXIobnVsbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmNhbmNlbCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJIaWdobGlnaHRBbmRQb3B1cCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoRGlzbWlzc2VkQ2hhbmdlLmVtaXQoKTtcbiAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25NdWx0aXBsZUxhYmVsID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgYWxpZ25tZW50OiBcImNlbnRlclwiLCBmb3I6IFwibXVsdGlwbGUtc2VsZWN0aW9uLWJ1dHRvbnNcIiB9LCAoKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPD0gMVxuICAgICAgICAgICAgPyB0aGlzLnN0cmluZ3Muc2luZ2xlRmVhdHVyZVNlbGVjdGVkXG4gICAgICAgICAgICA6IHRoaXMuc3RyaW5ncy5mZWF0dXJlc1NlbGVjdGVkLnJlcGxhY2UoXCIke251bWJlcn1cIiwgKF9iID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aC50b1N0cmluZygpKSkpO1xuICAgICAgICBjb25zdCBkZWxldGVNdWx0aXBsZSA9IChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIGljb25TdGFydDogXCJ0cmFzaFwiLCBraW5kOiBcImRhbmdlclwiLCB3aWR0aDogXCJmdWxsXCIsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIC8vIHN2bSBrbm93cyB3aGF0J3Mgc2VsZWN0ZWQsIGFuZCB3aWxsIGRlbGV0ZSBhY2NvcmRpbmdseVxuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlSW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zdk1vZGVsLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3RlZEdyYXBoaWNzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5rZWVwU2VsZWN0VG9vbFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnN0cmluZ3MuZGVsZXRlKSk7XG4gICAgICAgIGNvbnN0IGFkZFRvTmV3U2tldGNoID0gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgaWNvblN0YXJ0OiBcImNvcHlcIiwga2luZDogXCJuZXV0cmFsXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdTa2V0Y2hMYXllckZlYXR1cmVzID0gdGhpcy5tdWx0aXBsZVNlbGVjdGVkR3JhcGhpY3MubWFwKChncmFwaGljKSA9PiBncmFwaGljLmNsb25lKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoQWRkVG9OZXdTa2V0Y2guZW1pdCgpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnN0cmluZ3MuYWRkVG9OZXdTa2V0Y2gpKTtcbiAgICAgICAgY29uc3QgZHVwbGljYXRlTXVsdGlwbGUgPSAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBpY29uU3RhcnQ6IFwiZHVwbGljYXRlXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ZNb2RlbC5kdXBsaWNhdGUoKTtcbiAgICAgICAgICAgICAgICAvL3RoaXMua2VlcFNlbGVjdFRvb2xTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLmR1cGxpY2F0ZSkpO1xuICAgICAgICBjb25zdCBTaG9ydGN1dEFuZFNuYXBwaW5nID0gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbmFwcGluZ1wiLCByZWY6IChlbCkgPT4gKHRoaXMuc2hvcnRjdXRTbmFwcGluZ0RpdiA9IGVsKSB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBjbGFzczogXCJza2V0Y2gta2V5Ym9hcmQtYnV0dG9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uU3RhcnQ6IFwia2V5Ym9hcmRcIiwgc2NhbGU6IFwibFwiLCBsYWJlbDogdGhpcy5zdHJpbmdzLnNrZXRjaFNob3J0Y3V0cywgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNrZXRjaC1zaG9ydGN1dHNcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzLnJlZkVsZW1lbnQgPSB0aGlzLnNob3J0Y3V0U25hcHBpbmdEaXY7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NrZXRjaFNob3J0Y3V0cy5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU2tldGNoU2hvcnRjdXRzRGlzbWlzc2VkQ2hhbmdlXCIsICgpID0+IHRoaXMucmVtb3ZlU2tldGNoU2hvcnRjdXRzKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIGljb25TdGFydDogXCJnZWFyXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIHNjYWxlOiBcImxcIiwgbGFiZWw6IHRoaXMuc3RyaW5ncy5zZXR0aW5ncywgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNrZXRjaFNuYXBwaW5nRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hTbmFwcGluZ0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1za2V0Y2gtc25hcHBpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2tldGNoU25hcHBpbmdFbC5yZWZFbGVtZW50ID0gdGhpcy5zaG9ydGN1dFNuYXBwaW5nRGl2O1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuc2tldGNoU25hcHBpbmdFbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCB0aGlzLnN0cmluZ3Muc2V0dGluZ3MpKSk7XG4gICAgICAgIGNvbnN0IHNrZXRjaE1lc3NhZ2UgPSAoaChcImRpdlwiLCB7IGNsYXNzOiBza2V0Y2hTdGF0ZS5za2V0Y2hNZXNzYWdlICYmIFwic2tldGNoLW1lc3NhZ2VcIiB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyB3aWR0aDogXCJmdWxsXCIsIG9wZW46ICEhc2tldGNoU3RhdGUuc2tldGNoTWVzc2FnZSAmJiAhKCgoX2MgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubGVuZ3RoKSA+IDEpIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBza2V0Y2hTdGF0ZS5za2V0Y2hNZXNzYWdlKSkpKTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1mbG93XCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmZsb3dFbCA9IGVsKSwgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpLCBjbGFzczogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSA9PT0gXCJydGxcIiA/IENTU19VVElMSVRZLnJ0bCA6IFwiXCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaEZsb3dJdGVtRWwgPSBlbCksIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5za2V0Y2gsIGRpc2FibGVkOiAhdGhpcy5sYXllci5jYXBhYmlsaXRpZXMub3BlcmF0aW9ucy5zdXBwb3J0c01hcE5vdGVzRWRpdGluZyB9LCB0aGlzLmRpc21pc3NpYmxlICYmIGRpc21pc3NCdXR0b24sIFNob3J0Y3V0QW5kU25hcHBpbmcsIHNrZXRjaE1lc3NhZ2UsICgoX2QgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QubGVuZ3RoKSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibXVsdGlwbGUtc2VsZWN0aW9uXCIgfSwgc2VsZWN0aW9uTXVsdGlwbGVMYWJlbCwgaChcImRpdlwiLCB7IGlkOiBcIm11bHRpcGxlLXNlbGVjdGlvbi1idXR0b25zXCIsIGNsYXNzOiBcImJ1dHRvbnNcIiB9LCBkdXBsaWNhdGVNdWx0aXBsZSwgYWRkVG9OZXdTa2V0Y2gsIGRlbGV0ZU11bHRpcGxlKSkpIDogbnVsbCwgdGhpcy5zaG93U2tldGNoQ29udGVudCAmJiAoaChcImFyY2dpcy1za2V0Y2gtY29udGVudFwiLCB7IGN1cnJlbnRTa2V0Y2hJbmZvOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLCBmbG93RWw6IHRoaXMuZmxvd0VsLCBzeW1ib2xTdHlsZXJSZWZFbGVtZW50OiB0aGlzLmRpc21pc3NCdXR0b25FbCwgcmVmOiAoZWxlbWVudCkgPT4gKHRoaXMuc2tldGNoQ29udGVudEVsID0gZWxlbWVudCkgfSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgIXRoaXMuc2hvd1NrZXRjaFRvb2xzT25seSAmJiB0aGlzLnJlbmRlclNrZXRjaEZsb3dQYW5lbCgpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2guc3R5bGUgPSBhcmNnaXNTa2V0Y2hDc3M7XG5cbmNvbnN0IGFyY2dpc1NrZXRjaENvbnRlbnRDc3MgPSBcIi5za2V0Y2gtY29udGVudHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmcpIHZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWhhbGYpfS5za2V0Y2gtdGl0bGUgY2FsY2l0ZS1pbmxpbmUtZWRpdGFibGV7Ym9yZGVyOjFweCBzb2xpZDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItaW5wdXQpO3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy10aGlyZCl9LnJvdGF0aW9ue2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cG9zaXRpb246cmVsYXRpdmV9LnJvdGF0aW9uIGNhbGNpdGUtc2xpZGVye3dpZHRoOjUwJX0ucm90YXRpb24gY2FsY2l0ZS1pbnB1dC1udW1iZXJ7d2lkdGg6NDUlO2ZvbnQtc2l6ZTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtc2l6ZS0wKTtmb250LWZhbWlseTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtZmFtaWx5KX0uc2tldGNoLXBvcHVwLWJ1dHRvbnttYXJnaW4tYm90dG9tOjAuNGVtfS5yZWNlbnQtc3ltYm9sc3tkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO3BhZGRpbmc6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZykgdmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctaGFsZil9LmNvbnRhaW5lcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCk7Ym94LXNoYWRvdzowcHggMXB4IDEwcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4xKTtwYWRkaW5nOjhweCAxMnB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWV2ZW5seX0uc3ltYm9se2hlaWdodDozMnB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Y3Vyc29yOnBvaW50ZXJ9LnN5bWJvbDpmb2N1c3tvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLXVpLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9Lm5vLXJlY2VudC1zeW1ib2xze21pbi1oZWlnaHQ6MzJweDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyfS5jbGVhci1yZWNlbnQtYnV0dG9ue3BhZGRpbmctdG9wOjhweDttYXJnaW46YXV0b30uaGFsby1ibG9ja3twYWRkaW5nLXRvcDo2cHh9XCI7XG5cbmNvbnN0IEFyY2dpc1NrZXRjaENvbnRlbnQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnNrZXRjaEdyYXBoaWNVcGRhdGVzID0gY3JlYXRlRXZlbnQodGhpcywgXCJza2V0Y2hHcmFwaGljVXBkYXRlc1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hQYW5lbExvYWRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU2tldGNoUGFuZWxMb2FkZXJcIiwgNyk7XG4gICAgICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXNhYmxlU2tldGNoUGFuZWxcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoQWN0aXZlU3ltYm9sQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTa2V0Y2hBY3RpdmVTeW1ib2xDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4gKHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcikpO1xuICAgICAgICB0aGlzLmRpdk5vZGVzID0gW107XG4gICAgICAgIHRoaXMuc3ltYm9sTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzID0gW107XG4gICAgICAgIHRoaXMuc2F2ZWRDb2xvcnMgPSBbXTtcbiAgICAgICAgdGhpcy5zdG9yZVBvaW50U3R5bGVyID0gKGVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wb2ludFN0eWxlciA9IGVsO1xuICAgICAgICAgICAgdGhpcy5zdGFydFBvaW50RWRpdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0b3JlUG9seWxpbmVTdHlsZXIgPSAoZWwpID0+IHtcbiAgICAgICAgICAgIGlmICghZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBvbHlsaW5lU3R5bGVyID0gZWw7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9seWxpbmVFZGl0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3RvcmVQb2x5Z29uU3R5bGVyID0gKGVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wb2x5Z29uU3R5bGVyID0gZWw7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9seWdvbkVkaXQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gb3BlbiBmb250IHBvcG92ZXJcbiAgICAgICAgdGhpcy5vcGVuRm9udFBvcG92ZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXJjZ2lzRm9udFBpY2tlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZVNrZXRjaFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1mb250LXBpY2tlclwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuZm9udE1hcCA9IGZlYXR1cmVTZXJ2aWNlRm9udE1hcDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuZm9udCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9udDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIucG9wb3ZlclByb3BzID0ge1xuICAgICAgICAgICAgICAgICAgICByZWZFbGVtZW50OiB0aGlzLmhvc3RFbGVtZW50XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc0ZvbnRQaWNrZXJEaXNtaXNzZWRcIiwgdGhpcy5jbG9zZUZvbnRQb3BvdmVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc0ZvbnRQaWNrZXJDaGFuZ2VcIiwgdGhpcy5jaGFuZ2VGb250KTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXJjZ2lzRm9udFBpY2tlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xvc2VGb250UG9wb3ZlciA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVTa2V0Y2hQYW5lbC5lbWl0KGZhbHNlKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzRm9udFBpY2tlcik7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jaGFuZ2VGb250ID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBmb250ID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICAgICAgaWYgKGZvbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wU3ltYm9sID0gKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRlbXBTeW1ib2wuZm9udC5mYW1pbHkgPSBmb250LmZhbWlseTtcbiAgICAgICAgICAgICAgICB0ZW1wU3ltYm9sLmZvbnQud2VpZ2h0ID0gZm9udC53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgdGVtcFN5bWJvbC5mb250LnN0eWxlID0gZm9udC5zdHlsZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbCh0ZW1wU3ltYm9sLCBmYWxzZSwgZmFsc2UsIFwiZm9udFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmxvd0VsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN5bWJvbFN0eWxlclJlZkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RvcmFnZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gbGlmZWN5Y2xlIG1ldGhvZHNcbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hQYW5lbExvYWRlci5lbWl0KHRydWUpO1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRBbGxNb2R1bGVzKCk7XG4gICAgICAgIC8vIGFkZCBza2V0Y2hcbiAgICAgICAgc3VnZ2VzdGVkQ29sb3JMaXN0LmZvckVhY2goKGhleCkgPT4gdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzLnB1c2gobmV3IHRoaXMuQ29sb3IoaGV4KSkpO1xuICAgICAgICBzYXZlZENvbG9yTGlzdC5mb3JFYWNoKChoZXgpID0+IHRoaXMuc2F2ZWRDb2xvcnMucHVzaChuZXcgdGhpcy5Db2xvcihoZXgpKSk7XG4gICAgICAgIHRoaXMubWFwVmlldyA9IHNrZXRjaFN0YXRlLm1hcFZpZXc7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHNrZXRjaFN0YXRlLnN0cmluZ3M7XG4gICAgICAgIHRoaXMuY3VycmVudExhbmd1YWdlID0gc2tldGNoU3RhdGUuY3VycmVudExhbmd1YWdlO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHNrZXRjaFN0YXRlLnBvcnRhbDtcbiAgICAgICAgaWYgKCF0aGlzLmZsb3dFbCkge1xuICAgICAgICAgICAgdGhpcy5mbG93RWwgPSBxdWVyeVBhcmVudEVsZW1lbnQodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3dcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZ2V0IHJlY2VudCBzeW1ib2xzXG4gICAgICAgIGNvbnN0IHN0b3JhZ2VJZCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbFxuICAgICAgICAgICAgPyBbXCJjaXJjbGVcIiwgXCJyZWN0YW5nbGVcIl0uaW5kZXhPZih0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wpID4gLTFcbiAgICAgICAgICAgICAgICA/IFwiYXJjZ2lzLXNrZXRjaC1yZWNlbnQtcG9seWdvbi1zeW1ib2xzXCJcbiAgICAgICAgICAgICAgICA6IGBhcmNnaXMtc2tldGNoLXJlY2VudC0ke3RoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbH0tc3ltYm9sc2BcbiAgICAgICAgICAgIDogXCJhcmNnaXMtc2tldGNoLXJlY2VudC1wb2ludC1zeW1ib2xzXCI7XG4gICAgICAgIGNvbnN0IHJlY2VudFN5bWJvbHMgPSBnZXRMb2NhbFN0b3JhZ2VJdGVtKHN0b3JhZ2VJZCwgdHJ1ZSk7XG4gICAgICAgIGlmIChyZWNlbnRTeW1ib2xzKSB7XG4gICAgICAgICAgICB0aGlzLnJlY2VudFN5bWJvbHMgPSBbLi4ucmVjZW50U3ltYm9sc107XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hQYW5lbExvYWRlci5lbWl0KGZhbHNlKTtcbiAgICAgICAgdGhpcy5mbG93RWwgJiYgdGhpcy5yZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMuZmxvd0VsKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHRoaXMuZmxvd0VsICYmIHRoaXMucmVzaXplT2JzZXJ2ZXIudW5vYnNlcnZlKHRoaXMuZmxvd0VsKTtcbiAgICB9XG4gICAgLy8gZXZlbnRzXG4gICAgY2FsY2l0ZUZsb3dJdGVtQmFja0hhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMubWFwVmlldy5jbG9zZVBvcHVwKCk7XG4gICAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSA9IG51bGw7XG4gICAgfVxuICAgIC8vIGN1cnJlbnRTa2V0Y2hJbmZvIGlzIHVwZGF0ZWQuIHJlcmVuZGVyLlxuICAgIHNrZXRjaENvbnRlbnRSZVJlbmRlckhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmIChpc0RlZmluZWQoZXZlbnQuZGV0YWlsKSkge1xuICAgICAgICAgICAgdGhpcy5zdG9yYWdlSWQgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2xcbiAgICAgICAgICAgICAgICA/IFtcImNpcmNsZVwiLCBcInJlY3RhbmdsZVwiXS5pbmRleE9mKGV2ZW50LmRldGFpbCkgPiAtMVxuICAgICAgICAgICAgICAgICAgICA/IFwiYXJjZ2lzLXNrZXRjaC1yZWNlbnQtcG9seWdvbi1zeW1ib2xzXCJcbiAgICAgICAgICAgICAgICAgICAgOiBgYXJjZ2lzLXNrZXRjaC1yZWNlbnQtJHtldmVudC5kZXRhaWx9LXN5bWJvbHNgXG4gICAgICAgICAgICAgICAgOiBcImFyY2dpcy1za2V0Y2gtcmVjZW50LXBvaW50LXN5bWJvbHNcIjtcbiAgICAgICAgICAgIHRoaXMucmVjZW50U3ltYm9scyA9IGdldExvY2FsU3RvcmFnZUl0ZW0odGhpcy5zdG9yYWdlSWQsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICAgICAgLy8gZ28gYmFjayBpZiBwb3B1cCBwYW5lbCBpcyBvcGVuXG4gICAgICAgIGlmICh0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuZmxvd0VsLmJhY2soKTtcbiAgICAgICAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB0b29sIH0gPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvO1xuICAgICAgICBpZiAodG9vbCA9PT0gXCJwb2ludFwiKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9pbnRFZGl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodG9vbCA9PT0gXCJwb2x5bGluZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9seWxpbmVFZGl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoW1wiY2lyY2xlXCIsIFwicG9seWdvblwiLCBcInJlY3RhbmdsZVwiXS5pbmNsdWRlcyh0b29sKSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydFBvbHlnb25FZGl0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcG9wdXBVcGRhdGVkSGFuZGxlcih7IGRldGFpbDogeyBtYXBOb3Rlc1BvcHVwdGVtcGxhdGUgfSB9KSB7XG4gICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXAgPSBtYXBOb3Rlc1BvcHVwdGVtcGxhdGU7XG4gICAgICAgIHRoaXMuc2tldGNoR3JhcGhpY1VwZGF0ZXMuZW1pdCh7XG4gICAgICAgICAgICB0eXBlOiBcInBvcHVwXCIsXG4gICAgICAgICAgICB1cGRhdGU6IHRydWUsXG4gICAgICAgICAgICBjbG9zZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIFByaXZhdGUgTWV0aG9kc1xuICAgIGFzeW5jIGxvYWRBbGxNb2R1bGVzKCkge1xuICAgICAgICBbXG4gICAgICAgICAgICB0aGlzLkNvbG9yLFxuICAgICAgICAgICAgdGhpcy5jaW1TeW1ib2xVdGlscyxcbiAgICAgICAgICAgIHRoaXMuc3ltYm9sVXRpbHMsXG4gICAgICAgICAgICB0aGlzLkNJTVN5bWJvbCxcbiAgICAgICAgICAgIHRoaXMuU2ltcGxlTGluZVN5bWJvbCxcbiAgICAgICAgICAgIHRoaXMuU2ltcGxlRmlsbFN5bWJvbCxcbiAgICAgICAgICAgIHRoaXMuUGljdHVyZU1hcmtlclN5bWJvbCxcbiAgICAgICAgICAgIHRoaXMuUGljdHVyZUZpbGxTeW1ib2wsXG4gICAgICAgICAgICB0aGlzLlRleHRTeW1ib2xcbiAgICAgICAgXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgICAgICAgIFwiZXNyaS9Db2xvclwiLFxuICAgICAgICAgICAgXCJlc3JpL3N5bWJvbHMvc3VwcG9ydC9jaW1TeW1ib2xVdGlsc1wiLFxuICAgICAgICAgICAgXCJlc3JpL3N5bWJvbHMvc3VwcG9ydC9zeW1ib2xVdGlsc1wiLFxuICAgICAgICAgICAgXCJlc3JpL3N5bWJvbHMvQ0lNU3ltYm9sXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9TaW1wbGVMaW5lU3ltYm9sXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9TaW1wbGVGaWxsU3ltYm9sXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9QaWN0dXJlTWFya2VyU3ltYm9sXCIsXG4gICAgICAgICAgICBcImVzcmkvc3ltYm9scy9QaWN0dXJlRmlsbFN5bWJvbFwiLFxuICAgICAgICAgICAgXCJlc3JpL3N5bWJvbHMvVGV4dFN5bWJvbFwiXG4gICAgICAgIF0pO1xuICAgIH1cbiAgICB1cGRhdGVTeW1ib2woc3ltYm9sLCBzeW1ib2xTd2l0Y2gsIHN5bWJvbFN3aXRjaEZyb21SZWNlbnQsIHRleHRQcm9wLCBuZWVkc0RlYm91bmNlQmVmb3JlVXBkYXRlKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgY3VycmVudFN5bWJvbENsb25lID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgY29uc3QgbmV3U3ltYm9sQ2xvbmUgPSBzeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgY29uc3Qgc2l6ZUNoYW5nZWQgPSBnZXRTeW1ib2xTaXplKHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSAhPT0gZ2V0U3ltYm9sU2l6ZShzeW1ib2wpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCA9IHN5bWJvbC5jbG9uZSgpO1xuICAgICAgICBpZiAodGV4dFByb3AgPT09IFwicmVjZW50LXRleHRcIikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wudGV4dCA9IGN1cnJlbnRTeW1ib2xDbG9uZS50ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2tldGNoR3JhcGhpY1VwZGF0ZXMuZW1pdCh7XG4gICAgICAgICAgICB0eXBlOiBcInN5bWJvbFwiLFxuICAgICAgICAgICAgdXBkYXRlOiB0cnVlLFxuICAgICAgICAgICAgY2xvc2U6IGZhbHNlLFxuICAgICAgICAgICAgc3ltYm9sU3dpdGNoLFxuICAgICAgICAgICAgc3ltYm9sU3dpdGNoRnJvbVJlY2VudCxcbiAgICAgICAgICAgIHRleHRQcm9wXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobmVlZHNEZWJvdW5jZUJlZm9yZVVwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hBY3RpdmVTeW1ib2xDaGFuZ2UuZW1pdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCEoKHNpemVDaGFuZ2VkICYmICFzeW1ib2xTd2l0Y2ggJiYgIXN5bWJvbFN3aXRjaEZyb21SZWNlbnQpIHx8XG4gICAgICAgICAgICBbXCJoYWxvLXNpemVcIiwgXCJ0ZXh0XCJdLmluZGV4T2YodGV4dFByb3ApID4gLTEpKSB7XG4gICAgICAgICAgICBpZiAobmV3U3ltYm9sQ2xvbmUudHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgICAgICBuZXdTeW1ib2xDbG9uZS50ZXh0ID0gdGhpcy5zdHJpbmdzLnRleHRQcmV2aWV3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3VycmVudGx5U3RvcmVkU3ltYm9scyA9IChfYSA9IHRoaXMucmVjZW50U3ltYm9scykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbHRlcigocmVjZW50KSA9PiBKU09OLnN0cmluZ2lmeShyZWNlbnQpICE9PSBKU09OLnN0cmluZ2lmeShuZXdTeW1ib2xDbG9uZSkpO1xuICAgICAgICAgICAgY29uc3QgcmVjZW50U3ltYm9scyA9IGlzRGVmaW5lZChjdXJyZW50bHlTdG9yZWRTeW1ib2xzKVxuICAgICAgICAgICAgICAgID8gW25ld1N5bWJvbENsb25lLCAuLi5jdXJyZW50bHlTdG9yZWRTeW1ib2xzXS5zbGljZSgwLCA1KVxuICAgICAgICAgICAgICAgIDogW25ld1N5bWJvbENsb25lXTtcbiAgICAgICAgICAgIGNvbnN0IHN0b3JhZ2VJZCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbFxuICAgICAgICAgICAgICAgID8gW1wiY2lyY2xlXCIsIFwicmVjdGFuZ2xlXCJdLmluZGV4T2YodGhpcy5jdXJyZW50U2tldGNoSW5mby50b29sKSA+IC0xXG4gICAgICAgICAgICAgICAgICAgID8gXCJhcmNnaXMtc2tldGNoLXJlY2VudC1wb2x5Z29uLXN5bWJvbHNcIlxuICAgICAgICAgICAgICAgICAgICA6IGBhcmNnaXMtc2tldGNoLXJlY2VudC0ke3RoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbH0tc3ltYm9sc2BcbiAgICAgICAgICAgICAgICA6IFwiYXJjZ2lzLXNrZXRjaC1yZWNlbnQtcG9pbnQtc3ltYm9sc1wiO1xuICAgICAgICAgICAgc2V0TG9jYWxTdG9yYWdlSXRlbShzdG9yYWdlSWQsIHJlY2VudFN5bWJvbHMsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5yZWNlbnRTeW1ib2xzID0gcmVjZW50U3ltYm9scztcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU2tldGNoQWN0aXZlU3ltYm9sQ2hhbmdlLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhcHBseUNpbU91dGxpbmUoc3ltLCBzdHJva2UpIHtcbiAgICAgICAgY29uc3Qgb3V0bGluZSA9IGdldENpbU91dGxpbmUoc3ltKTtcbiAgICAgICAgaWYgKCFvdXRsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmdiYSA9IHN0cm9rZS5jb2xvci50b1JnYmEoKTtcbiAgICAgICAgcmdiYVszXSAqPSAyNTU7XG4gICAgICAgIG91dGxpbmUuY29sb3IgPSByZ2JhO1xuICAgICAgICBvdXRsaW5lLndpZHRoID0gc3Ryb2tlLnNpemU7XG4gICAgfVxuICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1jb21wb25lbnRzL2Jsb2IvbWFzdGVyL3NyYy9zbWFydE1hcHBpbmcvX3V0aWxzL3N5bWJvbFN0eWxlci50cyNMNDk5NlxuICAgIGdldENpbU91dGxpbmVQcm9wcyhzeW0pIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBvdXRsaW5lID0gZ2V0Q2ltT3V0bGluZShzeW0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29sb3I6IG5ldyB0aGlzLkNvbG9yKG91dGxpbmUgPT09IG51bGwgfHwgb3V0bGluZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3V0bGluZS5jb2xvciksXG4gICAgICAgICAgICBzaXplOiAoX2EgPSBvdXRsaW5lID09PSBudWxsIHx8IG91dGxpbmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG91dGxpbmUud2lkdGgpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDFcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgZmxvd1JlY3QgPSAoX2EgPSB0aGlzLmZsb3dFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGxhY2VtZW50OiBpc1J0bCA/IFwiYm90dG9tLXN0YXJ0XCIgOiBcImJvdHRvbS1lbmRcIixcbiAgICAgICAgICAgIG9mZnNldERpc3RhbmNlOiAxMCxcbiAgICAgICAgICAgIG9mZnNldFNraWRkaW5nOiBpc1J0bCA/IDMgOiAtMyxcbiAgICAgICAgICAgIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLFxuICAgICAgICAgICAgbWF4SGVpZ2h0OiBmbG93UmVjdCAmJiBgJHtmbG93UmVjdC5oZWlnaHQgLSA2NX1weGAsXG4gICAgICAgICAgICByZWZFbGVtZW50OiB0aGlzLnN5bWJvbFN0eWxlclJlZkVsZW1lbnRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3RhcnRQb2ludEVkaXQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gY2ltIGFuZCBjdXN0b20gcGljdHVyZS1tYXJrZXJzIGFyZSBhbGxvd2VkXG4gICAgICAgIGNvbnN0IGlzQ0lNID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wudHlwZSA9PT0gXCJjaW1cIjtcbiAgICAgICAgKF9hID0gdGhpcy5wb2ludFN0eWxlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVkaXQodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKSwge1xuICAgICAgICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBtYXJrZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3ltYm9sc09wZW46IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemVPcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb25PcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgLy8gJ2FsbCcgYnkgZGVmYXVsdCwgY2FuIGJlICdzaW1wbGUnLCAncGljdHVyZScsICdjaW0nLCAnY2ltOnBpY3R1cmUnLCAnY2ltOnZlY3RvcidcbiAgICAgICAgICAgICAgICAgICAgLy8gb3IgYW4gYXJyYXkgb2YgYSBjb21iaW5hdGlvbiBvZiBzcGVjaWZpYyB0eXBlc1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXJUeXBlOiBbXCJjaW06dmVjdG9yXCIsIFwiY3VzdG9tXCJdLFxuICAgICAgICAgICAgICAgICAgICBrZWVwQ2hvaWNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwYXJ0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9TaXplQWRqdXN0OiBmYWxzZSAvLyBoaWRlIGFkanVzdCBzaXplIHByb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZpbGw6IGlzQ0lNICYmIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25hbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGVkQ29sb3JzOiB0aGlzLnN1Z2dlc3RlZEZpbGxDb2xvcnMsXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkQ29sb3JzOiB0aGlzLnNhdmVkQ29sb3JzLFxuICAgICAgICAgICAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGVkQ29sb3JzT3BlbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBpc0NJTSAmJiB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICAgICAgICAgICAgc2F2ZWRDb2xvcnM6IHRoaXMuc2F2ZWRDb2xvcnNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWFya2VyOiB7XG4gICAgICAgICAgICAgICAgc2l6ZTogaXNDSU1cbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNpbVN5bWJvbFV0aWxzLmdldENJTVN5bWJvbFNpemUodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wudHlwZSA9PT0gXCJwaWN0dXJlLW1hcmtlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLndpZHRoXG4gICAgICAgICAgICAgICAgICAgICAgICA6IDI1XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgIGNvbG9yOiAoaXNDSU0gJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaW1TeW1ib2xVdGlscy5nZXRDSU1TeW1ib2xDb2xvcih0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9yc1swXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0cm9rZTogaXNDSU0gJiYgdGhpcy5nZXRDaW1PdXRsaW5lUHJvcHModGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpLFxuICAgICAgICAgICAgZmlsbEVuYWJsZWQ6IGlzQ0lNLFxuICAgICAgICAgICAgc3Ryb2tlRW5hYmxlZDogaXNDSU0sXG4gICAgICAgICAgICBwb3J0YWw6IHRoaXMuY3JlYXRlUG9ydGFsUHJvcCgpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGFydFBvbHlsaW5lRWRpdCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgKF9hID0gdGhpcy5wb2x5bGluZVN0eWxlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVkaXQodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKSwge1xuICAgICAgICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBzdHJva2U6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgICAgICBvcGVuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnNPcGVuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFQYXJ0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvU3Ryb2tlQWRqdXN0OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0cm9rZToge1xuICAgICAgICAgICAgICAgIGNvbG9yOiAoKF9iID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2xvcikgfHwgdGhpcy5zYXZlZENvbG9yc1sxXSxcbiAgICAgICAgICAgICAgICBzaXplOiAoKF9jID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy53aWR0aCkgfHwgMTAsXG4gICAgICAgICAgICAgICAgc3R5bGU6ICgoX2QgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnN0eWxlKSB8fFxuICAgICAgICAgICAgICAgICAgICBcInNvbGlkXCIsXG4gICAgICAgICAgICAgICAgbWFya2VyOiAoX2UgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLm1hcmtlclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvcnRhbDogdGhpcy5jcmVhdGVQb3J0YWxQcm9wKClcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNyZWF0ZVBvcnRhbFByb3AoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb3J0YWw6IHRoaXMucG9ydGFsLFxuICAgICAgICAgICAgYmVmb3JlOiBhc3luYyAocG9ydGFsLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcG9ydGFsLmxvYWQoKTtcbiAgICAgICAgICAgICAgICBkYXRhLm9yaWdpbmFsU3R5bGVzR3JvdXBRdWVyeTJkID0gcG9ydGFsLnN0eWxlc0dyb3VwUXVlcnkyZDtcbiAgICAgICAgICAgICAgICBwb3J0YWwuc3R5bGVzR3JvdXBRdWVyeTJkID0gJ3RpdGxlOlwiRXNyaSBTa2V0Y2ggU3R5bGVzXCIgQU5EIG93bmVyOmVzcmlfZW4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFmdGVyOiBhc3luYyAocG9ydGFsLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgcG9ydGFsLnN0eWxlc0dyb3VwUXVlcnkyZCA9IGRhdGEub3JpZ2luYWxTdHlsZXNHcm91cFF1ZXJ5MmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXJ0UG9seWdvbkVkaXQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgIChfYSA9IHRoaXMucG9seWdvblN0eWxlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVkaXQodGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY2xvbmUoKSwge1xuICAgICAgICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBmaWxsOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN1Z2dlc3RlZENvbG9yc09wZW46IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW5jeU9wZW46IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9yc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnNPcGVuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRDb2xvcnM6IHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9ycyxcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFQYXJ0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvU3Ryb2tlQWRqdXN0OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbGw6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY29sb3IgfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWdnZXN0ZWRGaWxsQ29sb3JzWzBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3Ryb2tlOiB7XG4gICAgICAgICAgICAgICAgY29sb3I6ICgoX2IgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbC5vdXRsaW5lKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VnZ2VzdGVkRmlsbENvbG9yc1swXSxcbiAgICAgICAgICAgICAgICBzaXplOiAoKF9jID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wub3V0bGluZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLndpZHRoKSB8fCAxMCxcbiAgICAgICAgICAgICAgICBzdHlsZTogKChfZCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sLm91dGxpbmUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdHlsZSkgfHwgXCJzb2xpZFwiLFxuICAgICAgICAgICAgICAgIGF1dG9BZGp1c3RlZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWxsRW5hYmxlZDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wuY29sb3IgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBzdHJva2VFbmFibGVkOiAoKF9lID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5vdXRsaW5lKVxuICAgICAgICAgICAgICAgID8gdHJ1ZVxuICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBwb3J0YWw6IHRoaXMuY3JlYXRlUG9ydGFsUHJvcCgpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVUZXh0UHJvcENoYW5nZShub2RlLCB0ZXh0UHJvcCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGxldCB2YWx1ZSA9IHBhcnNlSW50KG5vZGUudmFsdWUpO1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpIHx8IHZhbHVlIDwgbm9kZS5taW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gbm9kZS5taW47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsdWUgPiBub2RlLm1heCkge1xuICAgICAgICAgICAgdmFsdWUgPSBub2RlLm1heDtcbiAgICAgICAgfVxuICAgICAgICBub2RlLnZhbHVlID0gYCR7dmFsdWV9YDtcbiAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgc3dpdGNoICh0ZXh0UHJvcCkge1xuICAgICAgICAgICAgY2FzZSBcImZvbnQtc2l6ZVwiOlxuICAgICAgICAgICAgICAgIHRlbXBTeW1ib2wuZm9udC5zaXplID0gdmFsdWUgKiAwLjc1O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImhhbG8tc2l6ZVwiOlxuICAgICAgICAgICAgICAgIHRlbXBTeW1ib2wuaGFsb1NpemUgPSB2YWx1ZSAqIDAuNzU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwicm90YXRpb25cIjpcbiAgICAgICAgICAgICAgICB0ZW1wU3ltYm9sLmFuZ2xlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCwgZmFsc2UsIGZhbHNlLCB0ZXh0UHJvcCk7XG4gICAgICAgIGlmICh0ZXh0UHJvcCA9PT0gXCJyb3RhdGlvblwiKSB7XG4gICAgICAgICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlUm90YXRpb25TbGlkZXJWYWx1ZUNoYW5nZShhbmdsZSwgbmVlZHNEZWJvdW5jZUJlZm9yZVVwZGF0ZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHRlbXBTeW1ib2wgPSAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsb25lKCk7XG4gICAgICAgIHRlbXBTeW1ib2wuYW5nbGUgPSBhbmdsZTtcbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCwgZmFsc2UsIGZhbHNlLCBcInJvdGF0aW9uXCIsIG5lZWRzRGVib3VuY2VCZWZvcmVVcGRhdGUpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2gsIF9qLCBfaywgX2wsIF9tLCBfbywgX3AsIF9xLCBfciwgX3MsIF90LCBfdTtcbiAgICAgICAgY29uc3QgaXNSdGwgPSBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiO1xuICAgICAgICBjb25zdCBpc0J1bGsgPSAoKF9hID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAxO1xuICAgICAgICBjb25zdCBmaXJzdFN5bWJvbFR5cGUgPSAoX2IgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0uc3ltYm9sLnR5cGU7XG4gICAgICAgIGNvbnN0IGlkZW50aWNhbFN5bWJvbFR5cGVzID0gKF9jID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmV2ZXJ5KChncmFwaGljKSA9PiBmaXJzdFN5bWJvbFR5cGUgPT09IGdyYXBoaWMuc3ltYm9sLnR5cGUpO1xuICAgICAgICBjb25zdCBwb2ludCA9IChoKFwiYXJjZ2lzLXN5bWJvbC1zdHlsZXJcIiwgeyBtb2RlOiBpc0J1bGsgPyBcIm1pbmltYWxcIiA6IFwiZGVmYXVsdFwiLCBrZXk6IFwicG9pbnQtc3R5bGVyXCIsIGxhbmc6IHRoaXMuY3VycmVudExhbmd1YWdlLCBpbml0aWFsU291cmNlSWQ6IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc291cmNlSWRzLnBvaW50U291cmNlSWQsIHJlZjogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wgJiYgdGhpcy5zdG9yZVBvaW50U3R5bGVyLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNTeW1ib2xTdHlsZXJFZGl0OiAoeyBkZXRhaWw6IHsgc3ltYm9sLCBzeW1ib2xTd2l0Y2ggfSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTeW1ib2woc3ltYm9sLCBzeW1ib2xTd2l0Y2gpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTeW1ib2xTdHlsZXJTb3VyY2VJZENoYW5nZTogKHsgZGV0YWlsOiBzb3VyY2VJZCB9KSA9PiAodGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9pbnRTb3VyY2VJZCA9IHNvdXJjZUlkKSB9KSk7XG4gICAgICAgIGNvbnN0IHBvbHlsaW5lID0gKGgoXCJhcmNnaXMtc3ltYm9sLXN0eWxlclwiLCB7IG1vZGU6IGlzQnVsayA/IFwibWluaW1hbFwiIDogXCJkZWZhdWx0XCIsIGtleTogXCJwb2x5bGluZS1zdHlsZXJcIiwgbGFuZzogdGhpcy5jdXJyZW50TGFuZ3VhZ2UsIGluaXRpYWxTb3VyY2VJZDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWxpbmVTb3VyY2VJZCwgcmVmOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCAmJiB0aGlzLnN0b3JlUG9seWxpbmVTdHlsZXIsIHBvcG92ZXJQcm9wczogdGhpcy5nZXRQb3BvdmVyUHJvcHMoaXNSdGwpLCBvbkFyY2dpc1N5bWJvbFN0eWxlckVkaXQ6ICh7IGRldGFpbDogeyBzeW1ib2wsIHN5bWJvbFN3aXRjaCB9IH0pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN5bWJvbChzeW1ib2wsIHN5bWJvbFN3aXRjaCk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1N5bWJvbFN0eWxlclNvdXJjZUlkQ2hhbmdlOiAoeyBkZXRhaWw6IHNvdXJjZUlkIH0pID0+ICh0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnNvdXJjZUlkcy5wb2x5bGluZVNvdXJjZUlkID0gc291cmNlSWQpIH0pKTtcbiAgICAgICAgY29uc3QgcG9seWdvbiA9IChoKFwiYXJjZ2lzLXN5bWJvbC1zdHlsZXJcIiwgeyBtb2RlOiBpc0J1bGsgPyBcIm1pbmltYWxcIiA6IFwiZGVmYXVsdFwiLCBrZXk6IFwicG9seWdvbi1zdHlsZXJcIiwgbGFuZzogdGhpcy5jdXJyZW50TGFuZ3VhZ2UsIGluaXRpYWxTb3VyY2VJZDogdGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWdvblNvdXJjZUlkLCByZWY6IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sICYmIHRoaXMuc3RvcmVQb2x5Z29uU3R5bGVyLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNTeW1ib2xTdHlsZXJFZGl0OiAoeyBkZXRhaWw6IHsgc3ltYm9sLCBzeW1ib2xTd2l0Y2ggfSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTeW1ib2woc3ltYm9sLCBzeW1ib2xTd2l0Y2gpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTeW1ib2xTdHlsZXJTb3VyY2VJZENoYW5nZTogKHsgZGV0YWlsOiBzb3VyY2VJZCB9KSA9PiAodGhpcy5jdXJyZW50U2tldGNoSW5mby5zb3VyY2VJZHMucG9seWdvblNvdXJjZUlkID0gc291cmNlSWQpIH0pKTtcbiAgICAgICAgLy8gdGV4dFxuICAgICAgICBsZXQgZmlyc3RUZXh0Q29udGVudDtcbiAgICAgICAgbGV0IGlkZW50aWNhbFRleHRDb250ZW50O1xuICAgICAgICBpZiAodGhpcy50ZXh0Q29udGVudEVsKSB7XG4gICAgICAgICAgICBmaXJzdFRleHRDb250ZW50ID0gKF9kID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC50ZXh0O1xuICAgICAgICAgICAgaWRlbnRpY2FsVGV4dENvbnRlbnQgPSAoX2UgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuZXZlcnkoKGdyYXBoaWMpID0+IGZpcnN0VGV4dENvbnRlbnQgPT09IGdyYXBoaWMuc3ltYm9sLnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb250ZW50LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dGFyZWFcIiwgcGxhY2Vob2xkZXI6IHRoaXMuc3RyaW5ncy50ZXh0Q29udGVudFBsYWNlaG9sZGVyLCB2YWx1ZTogaWRlbnRpY2FsVGV4dENvbnRlbnQgPyAoX2YgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLnRleHQgOiBcIlwiLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0ZW1wU3ltYm9sLnRleHQgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCwgZmFsc2UsIGZhbHNlLCBcInRleHRcIik7XG4gICAgICAgICAgICB9LCByZWY6IChlbGVtZW50KSA9PiAodGhpcy50ZXh0Q29udGVudEVsID0gZWxlbWVudCkgfSkpKTtcbiAgICAgICAgY29uc3QgZm9udEZhbWlseVNlbGVjdGlvbiA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MuZm9udCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIGxhYmVsOiBmb250VG9Gb250TmFtZSgoKF9nID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy5mb250KSB8fFxuICAgICAgICAgICAgICAgIHsgZmFtaWx5OiBcIkFyaWFsXCIsIHN0eWxlOiBcIm5vcm1hbFwiLCB3ZWlnaHQ6IFwibm9ybWFsXCIgfSksIHdpZHRoOiBcImZ1bGxcIiwgc2NhbGU6IFwibVwiLCBvbkNsaWNrOiB0aGlzLm9wZW5Gb250UG9wb3ZlciB9LCBmb250VG9Gb250TmFtZSgoX2ggPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2ggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9oLmZvbnQpKSkpO1xuICAgICAgICBjb25zdCB0ZXh0Rm9udFNpemUgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLnNpemUsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHNjYWxlOiBcInNcIiwgbWluOiA1LCBtYXg6IDEyNSwgdmFsdWU6IGAkeygoX2sgPSAoX2ogPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2ogPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9qLmZvbnQpID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfay5zaXplKSAvIDAuNzUgfHwgMH1gLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KHRoaXMuZm9udFNpemVFbC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA8IHRoaXMuZm9udFNpemVFbC5taW4gfHwgdmFsdWUgPiB0aGlzLmZvbnRTaXplRWwubWF4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9udFNpemVWYWx1ZUhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVUZXh0UHJvcENoYW5nZSh0aGlzLmZvbnRTaXplRWwsIFwiZm9udC1zaXplXCIpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmZvbnRTaXplVmFsdWVIYW5kbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVRleHRQcm9wQ2hhbmdlKHRoaXMuZm9udFNpemVFbCwgXCJmb250LXNpemVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAoZWxlbWVudCkgPT4gKHRoaXMuZm9udFNpemVFbCA9IGVsZW1lbnQpIH0pKSk7XG4gICAgICAgIGNvbnN0IHRleHRDb2xvciA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MuY29sb3IsIGgoXCJhcmNnaXMtY29sb3ItaW5wdXRcIiwgeyBjb2xvcjogKChfbSA9IChfbCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2wuY29sb3IpID09PSBudWxsIHx8IF9tID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbS50b0hleCgpKSB8fCBcIiNmZmZmZmZcIiwgcG9wb3ZlclByb3BzOiB0aGlzLmdldFBvcG92ZXJQcm9wcyhpc1J0bCksIG9uQXJjZ2lzQ29sb3JJbnB1dENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBTeW1ib2wgPSAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGVtcFN5bWJvbC5jb2xvciA9IG5ldyB0aGlzLkNvbG9yKGV2ZW50LnRhcmdldC5jb2xvcik7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCwgZmFsc2UsIGZhbHNlLCBcImNvbG9yXCIpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICBjb25zdCByb3RhdGlvbiA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3Mucm90YXRpb24sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJyb3RhdGlvblwiIH0sIGgoXCJjYWxjaXRlLXNsaWRlclwiLCB7IG1pbjogMCwgbWF4OiAzNjAsIHZhbHVlOiAoKF9vID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9vID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfby5hbmdsZSkgfHwgMCwgc3RlcDogMSwgb25DYWxjaXRlU2xpZGVySW5wdXQ6IChldmVudCkgPT4gdGhpcy5oYW5kbGVSb3RhdGlvblNsaWRlclZhbHVlQ2hhbmdlKGV2ZW50LnRhcmdldC52YWx1ZSwgdHJ1ZSksIG9uQ2FsY2l0ZVNsaWRlckNoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZVJvdGF0aW9uU2xpZGVyVmFsdWVDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlLCBmYWxzZSkgfSksIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHNjYWxlOiBcInNcIiwgbWluOiAwLCBtYXg6IDM2MCwgc3VmZml4VGV4dDogaXNSdGwgPyBcIlwiIDogXCLCulwiLCBwcmVmaXhUZXh0OiBpc1J0bCA/IFwiwrpcIiA6IFwiXCIsIHN0ZXA6IDEsIHZhbHVlOiBgJHsoKF9wID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9wID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcC5hbmdsZSkgfHwgMH1gLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KHRoaXMucm90YXRpb25FbC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA8IHRoaXMucm90YXRpb25FbC5taW4gfHwgdmFsdWUgPiB0aGlzLnJvdGF0aW9uRWwubWF4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb25WYWx1ZUhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVUZXh0UHJvcENoYW5nZSh0aGlzLnJvdGF0aW9uRWwsIFwicm90YXRpb25cIiksIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucm90YXRpb25WYWx1ZUhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVGV4dFByb3BDaGFuZ2UodGhpcy5yb3RhdGlvbkVsLCBcInJvdGF0aW9uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHJlZjogKGVsZW1lbnQpID0+ICh0aGlzLnJvdGF0aW9uRWwgPSBlbGVtZW50KSB9KSkpKTtcbiAgICAgICAgY29uc3QgaGFsb0Jsb2NrID0gKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuaGFsb0Jsb2NrU2VjdGlvbiA9IGVsKSwgdGV4dDogdGhpcy5zdHJpbmdzLmhhbG8sIHRvZ2dsZURpc3BsYXk6IFwic3dpdGNoXCIsIG9wZW46ICgoX3EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX3EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9xLmhhbG9Db2xvcikgPyB0cnVlIDogZmFsc2UsIG9uQ2FsY2l0ZUJsb2NrU2VjdGlvblRvZ2dsZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBTeW1ib2wgPSAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnN5bWJvbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFsb0Jsb2NrU2VjdGlvbi5vcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBTeW1ib2wuaGFsb0NvbG9yID0gdGhpcy50ZW1wSGFsb0NvbG9yIHx8IG5ldyB0aGlzLkNvbG9yKFwid2hpdGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBTeW1ib2wuaGFsb1NpemUgPSAodGVtcFN5bWJvbCA9PT0gbnVsbCB8fCB0ZW1wU3ltYm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wU3ltYm9sLmhhbG9TaXplKSB8fCAxICogMC43NTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcEhhbG9Db2xvciA9IHRlbXBTeW1ib2wuaGFsb0NvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wU3ltYm9sLmhhbG9Db2xvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3ltYm9sKHRlbXBTeW1ib2wsIGZhbHNlLCBmYWxzZSwgXCJoYWxvXCIpO1xuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGFsby1ibG9ja1wiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGNvbG9yOiAoKF9zID0gKF9yID0gdGhpcy5jdXJyZW50U2tldGNoSW5mby5zeW1ib2wpID09PSBudWxsIHx8IF9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfci5oYWxvQ29sb3IpID09PSBudWxsIHx8IF9zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcy50b0hleCgpKSB8fFxuICAgICAgICAgICAgICAgIFwiI2ZmZmZmZlwiLCBwb3BvdmVyUHJvcHM6IHRoaXMuZ2V0UG9wb3ZlclByb3BzKGlzUnRsKSwgb25BcmNnaXNDb2xvcklucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcFN5bWJvbCA9IChfYSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0ZW1wU3ltYm9sLmhhbG9Db2xvciA9IG5ldyB0aGlzLkNvbG9yKGV2ZW50LnRhcmdldC5jb2xvcik7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGVtcFN5bWJvbCwgZmFsc2UsIGZhbHNlLCBcImhhbG8tY29sb3JcIik7XG4gICAgICAgICAgICB9IH0pKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLnNpemUsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHNjYWxlOiBcInNcIiwgbWluOiAxLCBtYXg6IDEwLCB2YWx1ZTogYCR7KChfdCA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uc3ltYm9sKSA9PT0gbnVsbCB8fCBfdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3QuaGFsb1NpemUpIC8gMC43NSB8fCAwfWAsIG9uQ2FsY2l0ZUlucHV0TnVtYmVySW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFyc2VJbnQodGhpcy5oYWxvU2l6ZUVsLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlIDwgdGhpcy5oYWxvU2l6ZUVsLm1pbiB8fCB2YWx1ZSA+IHRoaXMuaGFsb1NpemVFbC5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYWxvU2l6ZVZhbHVlSGFuZGxlID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZVRleHRQcm9wQ2hhbmdlKHRoaXMuaGFsb1NpemVFbCwgXCJoYWxvLXNpemVcIiksIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaGFsb1NpemVWYWx1ZUhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVGV4dFByb3BDaGFuZ2UodGhpcy5oYWxvU2l6ZUVsLCBcImhhbG8tc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCByZWY6IChlbGVtZW50KSA9PiAodGhpcy5oYWxvU2l6ZUVsID0gZWxlbWVudCkgfSkpKSkpO1xuICAgICAgICBjb25zdCB0ZXh0ID0gKGgoXCJkaXZcIiwgbnVsbCwgdGV4dENvbnRlbnQsIGZvbnRGYW1pbHlTZWxlY3Rpb24sIHRleHRGb250U2l6ZSwgdGV4dENvbG9yLCByb3RhdGlvbiwgaGFsb0Jsb2NrKSk7XG4gICAgICAgIHRoaXMuZGl2Tm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zeW1ib2xOb2RlcyA9IFtdO1xuICAgICAgICBsZXQgY3VycmVudFRvb2xUZXh0O1xuICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCkge1xuICAgICAgICAgICAgY2FzZSBcInBvaW50XCI6XG4gICAgICAgICAgICAgICAgY3VycmVudFRvb2xUZXh0ID0gdGhpcy5zdHJpbmdzLnBvaW50O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgICAgICAgICAgY3VycmVudFRvb2xUZXh0ID0gdGhpcy5zdHJpbmdzLmxpbmU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgICAgICAgIGN1cnJlbnRUb29sVGV4dCA9IHRoaXMuc3RyaW5ncy50ZXh0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjdXJyZW50VG9vbFRleHQgPSB0aGlzLnN0cmluZ3MucG9seWdvbjtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50VG9vbFRleHQgPSBjdXJyZW50VG9vbFRleHQudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgcmVjZW50U3ltYm9scyA9IChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MucmVjZW50U3ltYm9scyksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250YWluZXJcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMucmVjZW50U3ltYm9sc0NvbnRhaW5lckVsID0gbm9kZSkgfSwgKChfdSA9IHRoaXMucmVjZW50U3ltYm9scykgPT09IG51bGwgfHwgX3UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF91Lmxlbmd0aCkgPyAodGhpcy5yZWNlbnRTeW1ib2xzLm1hcCgocmVjZW50U3ltYm9sLCBpZHgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZWNlbnRTeW1ib2wgPyAoaChcImRpdlwiLCB7IGtleTogXCJzeW1ib2xcIiwgY2xhc3M6IFwic3ltYm9sXCIsIHRhYmluZGV4OiBcIjBcIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVSZWNlbnRTeW1ib2xTZWxlY3QoaWR4KSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVjZW50U3ltYm9sU2VsZWN0KGlkeCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpdk5vZGVzW2lkeF0gPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNyZWF0ZURpdihub2RlLCByZWNlbnRTeW1ib2wsIGlkeCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IH0pKSA6IG51bGw7XG4gICAgICAgIH0pKSA6IChoKFwiZGl2XCIsIHsga2V5OiBcIm5vLXJlY2VudC1zeW1ib2xcIiwgY2xhc3M6IFwibm8tcmVjZW50LXN5bWJvbHNcIiB9LCB0aGlzLnN0cmluZ3Mubm9SZWNlbnRTeW1ib2xzLnJlcGxhY2UoXCIke3Rvb2x9XCIsIGN1cnJlbnRUb29sVGV4dCkpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNjYWxlOiBcInNcIiwgY2xhc3M6IFwiY2xlYXItcmVjZW50LWJ1dHRvblwiLCB3aWR0aDogXCJoYWxmXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9yYWdlSWQgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2xcbiAgICAgICAgICAgICAgICAgICAgPyBbXCJjaXJjbGVcIiwgXCJyZWN0YW5nbGVcIl0uaW5kZXhPZih0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2wpID4gLTFcbiAgICAgICAgICAgICAgICAgICAgICAgID8gXCJhcmNnaXMtc2tldGNoLXJlY2VudC1wb2x5Z29uLXN5bWJvbHNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgOiBgYXJjZ2lzLXNrZXRjaC1yZWNlbnQtJHt0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRvb2x9LXN5bWJvbHNgXG4gICAgICAgICAgICAgICAgICAgIDogXCJhcmNnaXMtc2tldGNoLXJlY2VudC1wb2ludC1zeW1ib2xzXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWNlbnRTeW1ib2xzID0gW107XG4gICAgICAgICAgICAgICAgc2V0TG9jYWxTdG9yYWdlSXRlbShzdG9yYWdlSWQsIHRoaXMucmVjZW50U3ltYm9scywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy5jbGVhcikpKTtcbiAgICAgICAgY29uc3Qgc2tldGNoVGl0bGUgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJza2V0Y2gtdGl0bGVcIiB9LCB0aGlzLnN0cmluZ3MudGl0bGUsIGgoXCJjYWxjaXRlLWlubGluZS1lZGl0YWJsZVwiLCB7IHNjYWxlOiBcIm1cIiB9LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGFsaWdubWVudDogXCJzdGFydFwiLCBwbGFjZWhvbGRlcjogdGhpcy5zdHJpbmdzLmVudGVyVGl0bGVQbGFjZWhvbGRlciwgdHlwZTogXCJ0ZXh0XCIsIHZhbHVlOiB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLnRpdGxlLCBvbkJsdXI6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNrZXRjaEluZm8udGl0bGUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hHcmFwaGljVXBkYXRlcy5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0aXRsZVwiLFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSkpKTtcbiAgICAgICAgY29uc3QgcG9wdXBCdG4gPSAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25FbmQ6IGlzUnRsID8gXCJjaGV2cm9uLWxlZnRcIiA6IFwiY2hldnJvbi1yaWdodFwiLCBsYWJlbDogdGhpcy5zdHJpbmdzLnBvcHVwLCB3aWR0aDogXCJmdWxsXCIsIHNjYWxlOiBcImxcIiwgY2xhc3M6IFwic2tldGNoLXBvcHVwLWJ1dHRvblwiLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLmhlYWRpbmcgPSB0aGlzLnN0cmluZ3Muc2tldGNoO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0uZGVzY3JpcHRpb24gPSB0aGlzLnN0cmluZ3MucG9wdXA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGNpdGVGYWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1mYWJcIik7XG4gICAgICAgICAgICAgICAgICAgIGNhbGNpdGVGYWIuaWNvbiA9IFwicGx1c1wiO1xuICAgICAgICAgICAgICAgICAgICBjYWxjaXRlRmFiLnNsb3QgPSBcImZhYlwiO1xuICAgICAgICAgICAgICAgICAgICBjYWxjaXRlRmFiLnNjYWxlID0gXCJzXCI7XG4gICAgICAgICAgICAgICAgICAgIGNhbGNpdGVGYWIuYXBwZWFyYW5jZSA9IFwib3V0bGluZS1maWxsXCI7XG4gICAgICAgICAgICAgICAgICAgIGNhbGNpdGVGYWIua2luZCA9IFwibmV1dHJhbFwiO1xuICAgICAgICAgICAgICAgICAgICBjYWxjaXRlRmFiLmxhYmVsID0gdGhpcy5zdHJpbmdzLmFkZENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGNhbGNpdGVGYWIudGV4dCA9IHRoaXMuc3RyaW5ncy5hZGRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICBjYWxjaXRlRmFiLnRleHRFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLmFwcGVuZENoaWxkKGNhbGNpdGVGYWIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3B1cENvbXBvbmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtcG9wdXBcIik7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwQ29tcG9uZW50LmxhbmcgPSB0aGlzLmN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBDb21wb25lbnQubWFwVmlldyA9IHRoaXMubWFwVmlldztcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBDb21wb25lbnQubGF5ZXJEaXNwbGF5VHlwZSA9IGxheWVyRGlzcGxheVR5cGVFbnVtLm1hcE5vdGVzO1xuICAgICAgICAgICAgICAgICAgICBwb3B1cENvbXBvbmVudC5tYXBOb3Rlc0dyYXBoaWMgPSAoX2EgPSB0aGlzLmN1cnJlbnRTa2V0Y2hJbmZvLmdyYXBoaWNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwQ29tcG9uZW50Lm1hcE5vdGVzUG9wdXBUZW1wbGF0ZSA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXA7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwQ29tcG9uZW50LmNhbGNpdGVGbG93UHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93OiB0aGlzLmZsb3dFbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGNpdGVGYWI6IGNhbGNpdGVGYWIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxjaXRlRmxvd0l0ZW06IHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0uYXBwZW5kQ2hpbGQocG9wdXBDb21wb25lbnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dFbC5hcHBlbmRDaGlsZCh0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgbXVsdGlwbGUgZmVhdHVyZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQnVsaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXBDb21wb25lbnQuZGlzYWJsZUVkaXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBwbHlDaGFuZ2VzQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtYnV0dG9uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlDaGFuZ2VzQnRuLmxhYmVsID0gdGhpcy5zdHJpbmdzLmFwcGx5Q2hhbmdlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5Q2hhbmdlc0J0bi5pbm5lckhUTUwgPSB0aGlzLnN0cmluZ3MuYXBwbHlDaGFuZ2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlDaGFuZ2VzQnRuLnNjYWxlID0gXCJsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseUNoYW5nZXNCdG4uc2xvdCA9IFwiZm9vdGVyXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNrZXRjaFBvcHVwRmxvd0l0ZW0uYXBwZW5kKGFwcGx5Q2hhbmdlc0J0bik7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBseUNoYW5nZXNCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1cENvbXBvbmVudC5kaXNhYmxlRWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwQ29tcG9uZW50LnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5za2V0Y2hQb3B1cEZsb3dJdGVtLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2tldGNoUG9wdXBGbG93SXRlbS5iZWZvcmVCYWNrID0gYXN5bmMgKCkgPT4gYXdhaXQgcG9wdXBDb21wb25lbnQuZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXcuY2xvc2VQb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKChfYiA9IHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpICYmIHRoaXMuY3VycmVudFNrZXRjaEluZm8ucG9wdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwVmlldy5vcGVuUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbdGhpcy5jdXJyZW50U2tldGNoSW5mby5ncmFwaGljc1swXV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGdldFBvaW50RnJvbUdlb21ldHJ5KHRoaXMuY3VycmVudFNrZXRjaEluZm8uZ3JhcGhpY3NbMF0uZ2VvbWV0cnkpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLnBvcHVwKSk7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpIH0sICghaXNCdWxrIHx8IGlkZW50aWNhbFN5bWJvbFR5cGVzKSAmJiBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicmVjZW50LXN5bWJvbHNcIiB9LCByZWNlbnRTeW1ib2xzKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNrZXRjaC1jb250ZW50XCIgfSwgc2tldGNoVGl0bGUsIHBvcHVwQnRuLCAoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc0J1bGsgfHwgaWRlbnRpY2FsU3ltYm9sVHlwZXMpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFNrZXRjaEluZm8udG9vbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicG9pbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicG9seWxpbmVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2x5bGluZTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInBvbHlnb25cIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJlY3RhbmdsZVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY2lyY2xlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9seWdvbjtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkoKSkpKSk7XG4gICAgfVxuICAgIGhhbmRsZVJlY2VudFN5bWJvbFNlbGVjdChpZHgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVTeW1ib2wodGhpcy5zeW1ib2xOb2Rlc1tpZHhdLCB0cnVlLCB0cnVlLCB0aGlzLnRleHRDb250ZW50RWwgPyBcInJlY2VudC10ZXh0XCIgOiB1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLmRpdk5vZGVzWzBdLmZvY3VzKCk7XG4gICAgfVxuICAgIGFzeW5jIGFmdGVyQ3JlYXRlRGl2KG5vZGUsIHN5bWJvbCwgaWR4KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgbGV0IGZvcm1hdHRlZFN5bWJvbDtcbiAgICAgICAgLy8gZGlzcGxheSBhIHN5bWJvbCBjaG9zZW4gZnJvbSB0aGUgcGFuZWxcbiAgICAgICAgaWYgKFtcInNpbXBsZS1saW5lXCIsIFwic2ltcGxlLWZpbGxcIiwgXCJwaWN0dXJlLW1hcmtlclwiLCBcInBpY3R1cmUtZmlsbFwiLCBcInRleHRcIiwgXCJjaW1cIl0uaW5kZXhPZihzeW1ib2wudHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgaWYgKHN5bWJvbC50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgICAgIHN5bWJvbC50ZXh0ID0gdGhpcy5zdHJpbmdzLnRleHRQcmV2aWV3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9ybWF0dGVkU3ltYm9sID0gc3ltYm9sO1xuICAgICAgICAgICAgLy8gZGlzcGxheSBhIHN5bWJvbCB3aG9zZSBKU09OIGlzIGluIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN3aXRjaCAoc3ltYm9sLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiQ0lNU3ltYm9sUmVmZXJlbmNlXCI6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN5bWJvbCA9IHRoaXMuQ0lNU3ltYm9sLmZyb21KU09OKHN5bWJvbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlc3JpU0xTXCI6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN5bWJvbCA9IHRoaXMuU2ltcGxlTGluZVN5bWJvbC5mcm9tSlNPTihzeW1ib2wpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXNyaVNGU1wiOlxuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTeW1ib2wgPSB0aGlzLlNpbXBsZUZpbGxTeW1ib2wuZnJvbUpTT04oc3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVzcmlQTVNcIjpcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkU3ltYm9sID0gdGhpcy5QaWN0dXJlTWFya2VyU3ltYm9sLmZyb21KU09OKHN5bWJvbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlc3JpUEZTXCI6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN5bWJvbCA9IHRoaXMuUGljdHVyZUZpbGxTeW1ib2wuZnJvbUpTT04oc3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVzcmlUU1wiOlxuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTeW1ib2wgPSB0aGlzLlRleHRTeW1ib2wuZnJvbUpTT04oc3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5jaGlsZE5vZGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJldmlld1N5bWJvbCA9IGZvcm1hdHRlZFN5bWJvbC5jbG9uZSgpO1xuICAgICAgICBpZiAocHJldmlld1N5bWJvbC50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgcHJldmlld1N5bWJvbC5oYWxvU2l6ZSA9IE1hdGgubWluKDIsIHByZXZpZXdTeW1ib2wuaGFsb1NpemUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2aWV3U3ltYm9sLnR5cGUgPT09IFwic2ltcGxlLWxpbmVcIikge1xuICAgICAgICAgICAgcHJldmlld1N5bWJvbC53aWR0aCA9IE1hdGgubWluKDIsIHByZXZpZXdTeW1ib2wud2lkdGgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtYXhTaXplOiAyNCxcbiAgICAgICAgICAgIHNjYWxlOiB0cnVlLFxuICAgICAgICAgICAgc2l6ZTogcHJldmlld1N5bWJvbC50eXBlID09PSBcInNpbXBsZS1saW5lXCJcbiAgICAgICAgICAgICAgICA/IHsgd2lkdGg6IHRoaXMucmVjZW50U3ltYm9sc0NvbnRhaW5lckVsLmNsaWVudFdpZHRoIC8gOSB9XG4gICAgICAgICAgICAgICAgOiB7IHdpZHRoOiAyNCwgaGVpZ2h0OiAyNCB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChwcmV2aWV3U3ltYm9sKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN5bWJvbFV0aWxzXG4gICAgICAgICAgICAgICAgLnJlbmRlclByZXZpZXdIVE1MKHByZXZpZXdTeW1ib2wsIG9wdGlvbnMpXG4gICAgICAgICAgICAgICAgLnRoZW4oKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBub2RlLmFwcGVuZChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xOb2Rlc1tpZHhdID0gZm9ybWF0dGVkU3ltYm9sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2hDb250ZW50LnN0eWxlID0gYXJjZ2lzU2tldGNoQ29udGVudENzcztcblxuY29uc3QgYXJjZ2lzU2tldGNoU2hvcnRjdXRzQ3NzID0gXCIuc2tldGNoLXNob3J0Y3V0e2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjIxJSBhdXRvO3Jvdy1nYXA6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctaGFsZil9LnNrZXRjaC1zaG9ydGN1dC1jaGlwe21hcmdpbi1yaWdodDp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpfS5za2V0Y2gtc2hvcnRjdXQtbGFiZWx7YWxpZ24tc2VsZjpjZW50ZXJ9LnBvcG92ZXJ7ei1pbmRleDoxMDB9LmFyY2dpcy0tcnRsIC5za2V0Y2gtc2hvcnRjdXR7bWF4LWhlaWdodDo0MHZofS5hcmNnaXMtLXJ0bCAuc2tldGNoLXNob3J0Y3V0LWNoaXB7bWFyZ2luLWxlZnQ6dmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZy1oYWxmKTttYXJnaW4tcmlnaHQ6MH1cIjtcblxuY29uc3QgQXJjZ2lzU2tldGNoU2hvcnRjdXRzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTa2V0Y2hTaG9ydGN1dHNEaXNtaXNzZWRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NrZXRjaFNob3J0Y3V0c0Rpc21pc3NlZENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5yZWZFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gc2tldGNoU3RhdGUuc3RyaW5ncztcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgIH1cbiAgICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuc2tldGNoU2hvcnRjdXRzUG9wb3ZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcG9zaXRpb24oKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBpc1J0bCA9IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgPT09IFwicnRsXCI7XG4gICAgICAgIGNvbnN0IHBsYWNlbWVudCA9ICFpc1J0bCA/IFwibGVhZGluZy1zdGFydFwiIDogXCJ0cmFpbGluZy1zdGFydFwiO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgY2xhc3M6IFwicG9wb3ZlciBcIiArIChnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpID09PSBcInJ0bFwiID8gQ1NTX1VUSUxJVFkucnRsIDogXCJcIiksIHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hTaG9ydGN1dHNQb3BvdmVyID0gZWwpLCBwbGFjZW1lbnQ6IHBsYWNlbWVudCwgb3BlbjogdGhpcy5pc09wZW4sIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5yZWZFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogLU1hdGgucm91bmQodGhpcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSwgb2Zmc2V0U2tpZGRpbmc6IDAsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc2tldGNoU2hvcnRjdXRzIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgaGVhZGluZzogdGhpcy5zdHJpbmdzLnNrZXRjaFNob3J0Y3V0cywgY2xvc2FibGU6IHRydWUsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke01hdGgubWF4KHRoaXMucmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCwgMzc1KX1weGBcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZVBhbmVsQ2xvc2U6ICgpID0+IHRoaXMuYXJjZ2lzU2tldGNoU2hvcnRjdXRzRGlzbWlzc2VkQ2hhbmdlLmVtaXQoKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0XCIgfSwgaChcImNhbGNpdGUtY2hpcFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1jaGlwXCIsIHZhbHVlOiBcIkN0cmxcIiwgc2NhbGU6IFwibVwiIH0sIFwiQ3RybFwiKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXQtbGFiZWxcIiB9LCB0aGlzLnN0cmluZ3MuY3RybFNob3J0Y3V0KSwgaChcImNhbGNpdGUtY2hpcFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1jaGlwXCIsIHZhbHVlOiBcIkVudGVyXCIsIHNjYWxlOiBcIm1cIiB9LCBcIkVudGVyXCIpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5jU2hvcnRjdXQpLCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWNoaXBcIiwgdmFsdWU6IFwiWlwiLCBzY2FsZTogXCJtXCIgfSwgXCJaXCIpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy56U2hvcnRjdXQpLCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWNoaXBcIiwgdmFsdWU6IFwiUlwiLCBzY2FsZTogXCJtXCIgfSwgXCJSXCIpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNrZXRjaC1zaG9ydGN1dC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5yU2hvcnRjdXQpLCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgY2xhc3M6IFwic2tldGNoLXNob3J0Y3V0LWNoaXBcIiwgdmFsdWU6IFwiRXNjXCIsIHNjYWxlOiBcIm1cIiB9LCBcIkVzY1wiKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJza2V0Y2gtc2hvcnRjdXQtbGFiZWxcIiB9LCB0aGlzLnN0cmluZ3MuZXNjU2hvcnRjdXQpKSkpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2hTaG9ydGN1dHMuc3R5bGUgPSBhcmNnaXNTa2V0Y2hTaG9ydGN1dHNDc3M7XG5cbmNvbnN0IGFyY2dpc1NrZXRjaFNuYXBwaW5nQ3NzID0gXCIuY29udGVudHttYXgtaGVpZ2h0OjYwdmh9XCI7XG5cbmNvbnN0IEFyY2dpc1NrZXRjaFNuYXBwaW5nID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5jbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlU2tldGNoU25hcHBpbmdQb3BvdmVyc1wiLCA3KTtcbiAgICAgICAgdGhpcy5yZWZFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gc2tldGNoU3RhdGUuc3RyaW5ncztcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gc2tldGNoU3RhdGUubWFwVmlldztcbiAgICAgICAgdGhpcy5zbmFwcGluZ09wdGlvbnMgPSBza2V0Y2hTdGF0ZS5zbmFwcGluZ09wdGlvbnM7XG4gICAgICAgIHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcyA9IHNrZXRjaFN0YXRlLnNuYXBwaW5nU2Vzc2lvblN0b3JhZ2VJZHM7XG4gICAgICAgIHRoaXMuc2tldGNoVG9vbHRpcE9wdGlvbnMgPSBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwT3B0aW9ucztcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHMgPSBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwU2Vzc2lvblN0b3JhZ2VJZHM7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZEFsbE1vZHVsZXMoKTtcbiAgICAgICAgdGhpcy5hZGRTbmFwcGluZ1dpZGdldCgpO1xuICAgICAgICB0aGlzLmFkZFRvb2x0aXBzV2lkZ2V0KCk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuc25hcHBpbmdDb250cm9scy5jb250YWluZXIgPSB0aGlzLnNuYXBwaW5nQ29udHJvbERpdjtcbiAgICAgICAgdGhpcy5za2V0Y2hUb29sdGlwQ29udHJvbHMuY29udGFpbmVyID0gdGhpcy5za2V0Y2hUb29sdGlwQ29udHJvbERpdjtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIChfYSA9IHRoaXMuc25hcHBpbmdDb250cm9scykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlc3Ryb3koKTtcbiAgICAgICAgKF9iID0gdGhpcy5za2V0Y2hUb29sdGlwQ29udHJvbHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kZXN0cm95KCk7XG4gICAgfVxuICAgIGFzeW5jIHJlcG9zaXRpb24oKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5za2V0Y2hTbmFwcGluZ1BvcG92ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRBbGxNb2R1bGVzKCkge1xuICAgICAgICBjb25zdCBbU25hcHBpbmdDb250cm9scywgU2tldGNoVG9vbHRpcENvbnRyb2xzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgICAgICAgIFwiZXNyaS93aWRnZXRzL3N1cHBvcnQvU25hcHBpbmdDb250cm9sc1wiLFxuICAgICAgICAgICAgXCJlc3JpL3dpZGdldHMvc3VwcG9ydC9Ta2V0Y2hUb29sdGlwQ29udHJvbHNcIlxuICAgICAgICBdKTtcbiAgICAgICAgdGhpcy5TbmFwcGluZ0NvbnRyb2xzID0gU25hcHBpbmdDb250cm9scztcbiAgICAgICAgdGhpcy5Ta2V0Y2hUb29sdGlwQ29udHJvbHMgPSBTa2V0Y2hUb29sdGlwQ29udHJvbHM7XG4gICAgfVxuICAgIGFkZFNuYXBwaW5nV2lkZ2V0KCkge1xuICAgICAgICB0aGlzLnNuYXBwaW5nQ29udHJvbHMgPSBuZXcgdGhpcy5TbmFwcGluZ0NvbnRyb2xzKHtcbiAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgIHNuYXBwaW5nT3B0aW9uczogc2tldGNoU3RhdGUuc25hcHBpbmdPcHRpb25zLFxuICAgICAgICAgICAgdmlzaWJsZUVsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgaGVhZGVyOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWRkVG9vbHRpcHNXaWRnZXQoKSB7XG4gICAgICAgIHRoaXMuc2tldGNoVG9vbHRpcENvbnRyb2xzID0gbmV3IHRoaXMuU2tldGNoVG9vbHRpcENvbnRyb2xzKHtcbiAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgIHRvb2x0aXBPcHRpb25zOiBza2V0Y2hTdGF0ZS5za2V0Y2hUb29sdGlwT3B0aW9ucyxcbiAgICAgICAgICAgIHZpc2libGVFbGVtZW50czoge1xuICAgICAgICAgICAgICAgIHRvb2x0aXBzVG9nZ2xlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhYmVsc1RvZ2dsZTogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSAvKiBfX2VzcmkuU2tldGNoVG9vbHRpcENvbnRyb2xzUHJvcGVydGllcyAqLyk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dFwiIH0sIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCksIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsIHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hTbmFwcGluZ1BvcG92ZXIgPSBlbCksIG9wZW46IHRydWUsIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5yZWZFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogLU1hdGgucm91bmQodGhpcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSwgb2Zmc2V0U2tpZGRpbmc6IDAsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc2V0dGluZ3MsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgekluZGV4OiBcIjEwMFwiXG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgY2xvc2FibGU6IHRydWUsIGhlYWRpbmdMZXZlbDogMiwgaGVhZGluZzogdGhpcy5zdHJpbmdzLnNldHRpbmdzLCBzdHlsZToge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBgJHt0aGlzLnJlZkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGh9cHhgXG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVQYW5lbENsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBpZiAoKF9hID0gdGhpcy5zbmFwcGluZ1Nlc3Npb25TdG9yYWdlSWRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICBzYXZlU25hcHBpbmdUb1N0b3JhZ2UodGhpcy5zbmFwcGluZ09wdGlvbnMsIHRoaXMuc25hcHBpbmdTZXNzaW9uU3RvcmFnZUlkcy5jdXJyZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChfYiA9IHRoaXMuc2tldGNoVG9vbHRpcFNlc3Npb25TdG9yYWdlSWRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICBzYXZlU2tldGNoVG9vbHRpcFRvU3RvcmFnZSh0aGlzLnNrZXRjaFRvb2x0aXBPcHRpb25zLCB0aGlzLnNrZXRjaFRvb2x0aXBTZXNzaW9uU3RvcmFnZUlkcy5jdXJyZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVNrZXRjaFNuYXBwaW5nUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGVudFwiIH0sIGgoXCJkaXZcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoVG9vbHRpcENvbnRyb2xEaXYgPSBlbCkgfSksIGgoXCJkaXZcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc25hcHBpbmdDb250cm9sRGl2ID0gZWwpIH0pKSkpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTa2V0Y2hTbmFwcGluZy5zdHlsZSA9IGFyY2dpc1NrZXRjaFNuYXBwaW5nQ3NzO1xuXG5jb25zdCBhcmNnaXNTa2V0Y2hUb29sc0NzcyA9IFwiLnBvcG92ZXJ7ei1pbmRleDoxMDB9XCI7XG5cbmNvbnN0IEFyY2dpc1NrZXRjaFRvb2xzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5za2V0Y2hBY3Rpb25PbkRyYXdGZWF0dXJlcyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2tldGNoQWN0aW9uT25EcmF3RmVhdHVyZXNcIiwgNyk7XG4gICAgICAgIHRoaXMuc2tldGNoQWN0aW9uT25TZWxlY3RGZWF0dXJlcyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2tldGNoQWN0aW9uT25TZWxlY3RGZWF0dXJlc1wiLCA3KTtcbiAgICAgICAgdGhpcy5yZWZFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1hcE5vdGVzRmVhdHVyZXMgPSBudWxsO1xuICAgICAgICB0aGlzLnNrZXRjaFRvb2xzVG9IaWRlID0gW107XG4gICAgICAgIHRoaXMuYWN0aXZlU2tldGNoVG9vbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oaWRlU2VsZWN0aW9uVG9vbHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHNrZXRjaFN0YXRlLnN0cmluZ3M7XG4gICAgICAgIHRoaXMuc3ZNb2RlbCA9IHNrZXRjaFN0YXRlLnN2TW9kZWw7XG4gICAgICAgIHRoaXMubGF5ZXIgPSBza2V0Y2hTdGF0ZS5sYXllcjtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIHNlbGVjdCBtb2RlIGlmIGZlYXR1cmUgaXMgYXZhaWxhYmxlLCBlbHNlIGRlZmF1bHQgYWRkIHBvaW50IG1vZGVcbiAgICAgICAgaWYgKChfYSA9IHRoaXMubWFwTm90ZXNGZWF0dXJlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IHRlbXBQb2ludCA9IFtdO1xuICAgICAgICAgICAgbGV0IHRlbXBMaW5lID0gW107XG4gICAgICAgICAgICBsZXQgdGVtcFBvbHlnb24gPSBbXTtcbiAgICAgICAgICAgIGxldCB0ZW1wVGV4dCA9IFtdO1xuICAgICAgICAgICAgdGhpcy5tYXBOb3Rlc0ZlYXR1cmVzLmZvckVhY2goKGN1cnJHcmFwaGljKSA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChnZXRHZW9tZXRyeVR5cGVGcm9tR3JhcGhpYyhjdXJyR3JhcGhpYykpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wTGluZSA9IFsuLi50ZW1wTGluZSwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwb2x5Z29uXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUG9seWdvbiA9IFsuLi50ZW1wUG9seWdvbiwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wVGV4dCA9IFsuLi50ZW1wVGV4dCwgY3VyckdyYXBoaWNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUG9pbnQgPSBbLi4udGVtcFBvaW50LCBjdXJyR3JhcGhpY107XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRlbXBQb2ludC5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZVBvaW50KHRlbXBQb2ludCk7XG4gICAgICAgICAgICB0ZW1wTGluZS5sZW5ndGggJiYgdGhpcy5zdk1vZGVsLnVwZGF0ZUxpbmUodGVtcExpbmUpO1xuICAgICAgICAgICAgdGVtcFBvbHlnb24ubGVuZ3RoICYmIHRoaXMuc3ZNb2RlbC51cGRhdGVQb2x5Z29uKHRlbXBQb2x5Z29uKTtcbiAgICAgICAgICAgIHRlbXBUZXh0Lmxlbmd0aCAmJiB0aGlzLnN2TW9kZWwudXBkYXRlVGV4dCh0ZW1wVGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBza2V0Y2hUb29sc01hcHBpbmcgPSB7XG4gICAgICAgICAgICAgICAgcG9pbnQ6IHRoaXMuc2tldGNoUG9pbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgIHBvbHlnb246IHRoaXMuc2tldGNoUG9seWdvbkVsZW1lbnQsXG4gICAgICAgICAgICAgICAgcG9seWxpbmU6IHRoaXMuc2tldGNoUG9seUxpbmVFbGVtZW50LFxuICAgICAgICAgICAgICAgIGNpcmNsZTogdGhpcy5za2V0Y2hDaXJjbGVFbGVtZW50LFxuICAgICAgICAgICAgICAgIHJlY3RhbmdsZTogdGhpcy5za2V0Y2hSZWN0YW5nbGVFbGVtZW50LFxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMuc2tldGNoVGV4dEVsZW1lbnRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgYWN0aXZlU2tldGNoRWxlbWVudFN0cmluZztcbiAgICAgICAgICAgIGxldCBhY3RpdmVTa2V0Y2hFbGVtZW50O1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU2tldGNoVG9vbCkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVNrZXRjaEVsZW1lbnRTdHJpbmcgPSB0aGlzLmFjdGl2ZVNrZXRjaFRvb2w7XG4gICAgICAgICAgICAgICAgYWN0aXZlU2tldGNoRWxlbWVudCA9IHNrZXRjaFRvb2xzTWFwcGluZ1thY3RpdmVTa2V0Y2hFbGVtZW50U3RyaW5nXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEhhdmUgbmV4dCBub24taGlkZGVuIHRvb2wgYmUgdGhlIGRlZmF1bHRlZCBzZWxlY3RlZCB0b29sXG4gICAgICAgICAgICAgICAgbGV0IHNrZXRjaFRvb2xzID0gW1xuICAgICAgICAgICAgICAgICAgICBcInBvaW50XCIsXG4gICAgICAgICAgICAgICAgICAgIFwicG9seWxpbmVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJwb2x5Z29uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicmVjdGFuZ2xlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiY2lyY2xlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwidGV4dFwiXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBza2V0Y2hUb29scyA9IHNrZXRjaFRvb2xzLmZpbHRlcigodG9vbCkgPT4gIXRoaXMuc2tldGNoVG9vbHNUb0hpZGUuaW5jbHVkZXModG9vbCkpO1xuICAgICAgICAgICAgICAgIGFjdGl2ZVNrZXRjaEVsZW1lbnRTdHJpbmcgPSBza2V0Y2hUb29scy5sZW5ndGggPyBza2V0Y2hUb29sc1swXSA6IFwicG9pbnRcIjtcbiAgICAgICAgICAgICAgICBhY3RpdmVTa2V0Y2hFbGVtZW50ID0gc2tldGNoVG9vbHNNYXBwaW5nW2FjdGl2ZVNrZXRjaEVsZW1lbnRTdHJpbmddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hY3Rpb25PbkRyYXdGZWF0dXJlcyhhY3RpdmVTa2V0Y2hFbGVtZW50U3RyaW5nLCB0aGlzLnN0cmluZ3MuYWRkU3RhbXAsIGFjdGl2ZVNrZXRjaEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHJlcG9zaXRpb24oKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5za2V0Y2hUb29sc1BvcG92ZXJFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICBhY3Rpb25PbkRyYXdGZWF0dXJlcyh0b29sLCBza2V0Y2hNZXNzYWdlLCBjdXJyZW50QWN0aW9uRWxlbWVudCkge1xuICAgICAgICB0aGlzLmNsZWFyQWN0aXZlU2VsZWN0aW9uKCk7XG4gICAgICAgIGN1cnJlbnRBY3Rpb25FbGVtZW50LmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc2tldGNoQWN0aW9uT25EcmF3RmVhdHVyZXMuZW1pdCh7XG4gICAgICAgICAgICB0b29sOiB0b29sLFxuICAgICAgICAgICAgc2tldGNoTWVzc2FnZTogc2tldGNoTWVzc2FnZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWN0aW9uT25TZWxlY3RGZWF0dXJlcyhza2V0Y2hNZXNzYWdlLCBjdXJyZW50QWN0aW9uRWxlbWVudCwgbXVsdGlwbGVTZWxlY3RUb29sKSB7XG4gICAgICAgIGNvbnN0IHsgYWN0aXZlID0gZmFsc2UgfSA9IGN1cnJlbnRBY3Rpb25FbGVtZW50O1xuICAgICAgICB0aGlzLmNsZWFyQWN0aXZlU2VsZWN0aW9uKCk7XG4gICAgICAgIGN1cnJlbnRBY3Rpb25FbGVtZW50LmFjdGl2ZSA9ICFhY3RpdmU7XG4gICAgICAgIHRoaXMuc3ZNb2RlbC5jYW5jZWwoKTtcbiAgICAgICAgdGhpcy5za2V0Y2hBY3Rpb25PblNlbGVjdEZlYXR1cmVzLmVtaXQoe1xuICAgICAgICAgICAgc2tldGNoTWVzc2FnZTogIWFjdGl2ZSA/IHNrZXRjaE1lc3NhZ2UgOiBcIlwiLFxuICAgICAgICAgICAgbXVsdGlwbGVTZWxlY3RUb29sOiAoIWFjdGl2ZSAmJiBtdWx0aXBsZVNlbGVjdFRvb2wpIHx8IG51bGxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNsZWFyQWN0aXZlU2VsZWN0aW9uKCkge1xuICAgICAgICBjb25zdCBza2V0Y2hUb29scyA9IFtcbiAgICAgICAgICAgIHRoaXMuc2tldGNoUG9pbnRFbGVtZW50LFxuICAgICAgICAgICAgdGhpcy5za2V0Y2hQb2x5TGluZUVsZW1lbnQsXG4gICAgICAgICAgICB0aGlzLnNrZXRjaFBvbHlnb25FbGVtZW50LFxuICAgICAgICAgICAgdGhpcy5za2V0Y2hSZWN0YW5nbGVFbGVtZW50LFxuICAgICAgICAgICAgdGhpcy5za2V0Y2hDaXJjbGVFbGVtZW50LFxuICAgICAgICAgICAgdGhpcy5za2V0Y2hUZXh0RWxlbWVudCxcbiAgICAgICAgICAgIHRoaXMuc2tldGNoU2VsZWN0RWxlbWVudCxcbiAgICAgICAgICAgIHRoaXMuc2tldGNoUmVjdGFuZ2xlU2VsZWN0RWxlbWVudCxcbiAgICAgICAgICAgIHRoaXMuc2tldGNoTGFzc29TZWxlY3RFbGVtZW50XG4gICAgICAgIF07XG4gICAgICAgIHNrZXRjaFRvb2xzLmZvckVhY2goKHNrZXRjaFRvb2wpID0+IHtcbiAgICAgICAgICAgIGlmIChza2V0Y2hUb29sKSB7XG4gICAgICAgICAgICAgICAgc2tldGNoVG9vbC5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgZHJhd0ZlYXR1cmVzID0gKGgoXCJjYWxjaXRlLWFjdGlvbi1ncm91cFwiLCB7IGxheW91dDogXCJ2ZXJ0aWNhbFwiIH0sICF0aGlzLnNrZXRjaFRvb2xzVG9IaWRlLmluY2x1ZGVzKFwicG9pbnRcIikgJiYgKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hQb2ludEVsZW1lbnQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5zdGFtcCwgbGFiZWw6IHRoaXMuc3RyaW5ncy5zdGFtcCwgdGl0bGU6IHRoaXMuc3RyaW5ncy5zdGFtcCwgaWNvbjogXCJwaW5cIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbk9uRHJhd0ZlYXR1cmVzKFwicG9pbnRcIiwgdGhpcy5zdHJpbmdzLmFkZFN0YW1wLCB0aGlzLnNrZXRjaFBvaW50RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pKSwgIXRoaXMuc2tldGNoVG9vbHNUb0hpZGUuaW5jbHVkZXMoXCJwb2x5bGluZVwiKSAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFBvbHlMaW5lRWxlbWVudCA9IGVsKSwgdGV4dDogdGhpcy5zdHJpbmdzLmxpbmUsIGxhYmVsOiB0aGlzLnN0cmluZ3MubGluZSwgdGl0bGU6IHRoaXMuc3RyaW5ncy5saW5lLCBpY29uOiBcImxpbmVcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbk9uRHJhd0ZlYXR1cmVzKFwicG9seWxpbmVcIiwgdGhpcy5zdHJpbmdzLnN0YXJ0RmluaXNoRHJhd2luZywgdGhpcy5za2V0Y2hQb2x5TGluZUVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSksICF0aGlzLnNrZXRjaFRvb2xzVG9IaWRlLmluY2x1ZGVzKFwicG9seWdvblwiKSAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFBvbHlnb25FbGVtZW50ID0gZWwpLCB0ZXh0OiB0aGlzLnN0cmluZ3MucG9seWdvbiwgbGFiZWw6IHRoaXMuc3RyaW5ncy5wb2x5Z29uLCB0aXRsZTogdGhpcy5zdHJpbmdzLnBvbHlnb24sIGljb246IFwicG9seWdvblwiLCBzY2FsZTogXCJtXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJwb2x5Z29uXCIsIHRoaXMuc3RyaW5ncy5zdGFydEZpbmlzaERyYXdpbmcsIHRoaXMuc2tldGNoUG9seWdvbkVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSksICF0aGlzLnNrZXRjaFRvb2xzVG9IaWRlLmluY2x1ZGVzKFwicmVjdGFuZ2xlXCIpICYmIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoUmVjdGFuZ2xlRWxlbWVudCA9IGVsKSwgdGV4dDogdGhpcy5zdHJpbmdzLnJlY3RhbmdsZSwgbGFiZWw6IHRoaXMuc3RyaW5ncy5yZWN0YW5nbGUsIHRpdGxlOiB0aGlzLnN0cmluZ3MucmVjdGFuZ2xlLCBpY29uOiBcInJlY3RhbmdsZVwiLCBzY2FsZTogXCJtXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uT25EcmF3RmVhdHVyZXMoXCJyZWN0YW5nbGVcIiwgdGhpcy5zdHJpbmdzLmFkZFJlY3RhbmdsZSwgdGhpcy5za2V0Y2hSZWN0YW5nbGVFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSkpLCAhdGhpcy5za2V0Y2hUb29sc1RvSGlkZS5pbmNsdWRlcyhcImNpcmNsZVwiKSAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaENpcmNsZUVsZW1lbnQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5jaXJjbGUsIGxhYmVsOiB0aGlzLnN0cmluZ3MuY2lyY2xlLCB0aXRsZTogdGhpcy5zdHJpbmdzLmNpcmNsZSwgaWNvbjogXCJjaXJjbGVcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbk9uRHJhd0ZlYXR1cmVzKFwiY2lyY2xlXCIsIHRoaXMuc3RyaW5ncy5hZGRDaXJjbGUsIHRoaXMuc2tldGNoQ2lyY2xlRWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pKSwgIXRoaXMuc2tldGNoVG9vbHNUb0hpZGUuaW5jbHVkZXMoXCJ0ZXh0XCIpICYmIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoVGV4dEVsZW1lbnQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy50ZXh0LCBsYWJlbDogdGhpcy5zdHJpbmdzLnRleHQsIHRpdGxlOiB0aGlzLnN0cmluZ3MudGV4dCwgaWNvbjogXCJ0ZXh0XCIsIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25PbkRyYXdGZWF0dXJlcyhcInRleHRcIiwgdGhpcy5zdHJpbmdzLmFkZFRleHQsIHRoaXMuc2tldGNoVGV4dEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSkpKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0RmVhdHVyZXMgPSAoaChcImNhbGNpdGUtYWN0aW9uLWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIgfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFNlbGVjdEVsZW1lbnQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5zZWxlY3QsIGxhYmVsOiB0aGlzLnN0cmluZ3Muc2VsZWN0LCB0aXRsZTogdGhpcy5zdHJpbmdzLnNlbGVjdCwgaWNvbjogXCJjdXJzb3JcIiwgc2NhbGU6IFwibVwiLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbk9uU2VsZWN0RmVhdHVyZXModGhpcy5zdHJpbmdzLnNlbGVjdFRleHQsIHRoaXMuc2tldGNoU2VsZWN0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2tldGNoUmVjdGFuZ2xlU2VsZWN0RWxlbWVudCA9IGVsKSwgdGV4dDogdGhpcy5zdHJpbmdzLnJlY3RhbmdsZVNlbGVjdCwgbGFiZWw6IHRoaXMuc3RyaW5ncy5yZWN0YW5nbGVTZWxlY3QsIHRpdGxlOiB0aGlzLnN0cmluZ3MucmVjdGFuZ2xlU2VsZWN0LCBpY29uOiBcImN1cnNvci1tYXJxdWVlXCIsIHNjYWxlOiBcIm1cIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25PblNlbGVjdEZlYXR1cmVzKHRoaXMuc3RyaW5ncy5yZWN0YW5nbGVMYXNzb1NlbGVjdCwgdGhpcy5za2V0Y2hSZWN0YW5nbGVTZWxlY3RFbGVtZW50LCBcInJlY3RhbmdsZVwiKTtcbiAgICAgICAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5za2V0Y2hMYXNzb1NlbGVjdEVsZW1lbnQgPSBlbCksIHRleHQ6IHRoaXMuc3RyaW5ncy5sYXNzb1NlbGVjdCwgbGFiZWw6IHRoaXMuc3RyaW5ncy5sYXNzb1NlbGVjdCwgdGl0bGU6IHRoaXMuc3RyaW5ncy5sYXNzb1NlbGVjdCwgaWNvbjogXCJsYXNzb1wiLCBzY2FsZTogXCJtXCIsIGFsaWdubWVudDogXCJjZW50ZXJcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uT25TZWxlY3RGZWF0dXJlcyh0aGlzLnN0cmluZ3MucmVjdGFuZ2xlTGFzc29TZWxlY3QsIHRoaXMuc2tldGNoTGFzc29TZWxlY3RFbGVtZW50LCBcImxhc3NvXCIpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgcmVmOiAoZWwpID0+ICh0aGlzLnNrZXRjaFRvb2xzUG9wb3ZlckVsZW1lbnQgPSBlbCksIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsIG9wZW46IHRoaXMuaXNPcGVuLCByZWZlcmVuY2VFbGVtZW50OiB0aGlzLnJlZkVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiAxNSwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCBmb2N1c1RyYXBEaXNhYmxlZDogdHJ1ZSwgdHJpZ2dlckRpc2FibGVkOiB0cnVlLCBsYWJlbDogdGhpcy5zdHJpbmdzLnNrZXRjaCwgY2xhc3M6IFwicG9wb3ZlclwiLCBvbkNhbGNpdGVQb3BvdmVyQmVmb3JlQ2xvc2U6ICgpID0+ICh0aGlzLnNrZXRjaFRvb2xzUG9wb3ZlckVsZW1lbnQub3BlbiA9IHRydWUpIH0sIGgoXCJjYWxjaXRlLWFjdGlvbi1wYWRcIiwgeyBwb3NpdGlvbjogXCJzdGFydFwiLCBsYXlvdXQ6IFwidmVydGljYWxcIiwgZXhwYW5kRGlzYWJsZWQ6IHRydWUgfSwgZHJhd0ZlYXR1cmVzLCAhdGhpcy5oaWRlU2VsZWN0aW9uVG9vbHMgJiYgc2VsZWN0RmVhdHVyZXMpKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU2tldGNoVG9vbHMuc3R5bGUgPSBhcmNnaXNTa2V0Y2hUb29sc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzU2tldGNoIGFzIGFyY2dpc19za2V0Y2gsIEFyY2dpc1NrZXRjaENvbnRlbnQgYXMgYXJjZ2lzX3NrZXRjaF9jb250ZW50LCBBcmNnaXNTa2V0Y2hTaG9ydGN1dHMgYXMgYXJjZ2lzX3NrZXRjaF9zaG9ydGN1dHMsIEFyY2dpc1NrZXRjaFNuYXBwaW5nIGFzIGFyY2dpc19za2V0Y2hfc25hcHBpbmcsIEFyY2dpc1NrZXRjaFRvb2xzIGFzIGFyY2dpc19za2V0Y2hfdG9vbHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNrZXRjaF81LmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRSZW5kZXJpbmdSZWYsIGYgYXMgZm9yY2VVcGRhdGUgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcblxuY29uc3QgYXBwZW5kVG9NYXAgPSAobWFwLCBwcm9wTmFtZSwgdmFsdWUpID0+IHtcbiAgICBjb25zdCBpdGVtcyA9IG1hcC5nZXQocHJvcE5hbWUpO1xuICAgIGlmICghaXRlbXMpIHtcbiAgICAgICAgbWFwLnNldChwcm9wTmFtZSwgW3ZhbHVlXSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFpdGVtcy5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgaXRlbXMucHVzaCh2YWx1ZSk7XG4gICAgfVxufTtcbmNvbnN0IGRlYm91bmNlID0gKGZuLCBtcykgPT4ge1xuICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGltZW91dElkID0gMDtcbiAgICAgICAgICAgIGZuKC4uLmFyZ3MpO1xuICAgICAgICB9LCBtcyk7XG4gICAgfTtcbn07XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBwb3NzaWJsZSBlbGVtZW50IGlzQ29ubmVjdGVkLlxuICogVGhlIHByb3BlcnR5IG1pZ2h0IG5vdCBiZSB0aGVyZSwgc28gd2UgY2hlY2sgZm9yIGl0LlxuICpcbiAqIFdlIHdhbnQgaXQgdG8gcmV0dXJuIHRydWUgaWYgaXNDb25uZWN0ZWQgaXMgbm90IGEgcHJvcGVydHksXG4gKiBvdGhlcndpc2Ugd2Ugd291bGQgcmVtb3ZlIHRoZXNlIGVsZW1lbnRzIGFuZCB3b3VsZCBub3QgdXBkYXRlLlxuICpcbiAqIEJldHRlciBsZWFrIGluIEVkZ2UgdGhhbiB0byBiZSB1c2VsZXNzLlxuICovXG5jb25zdCBpc0Nvbm5lY3RlZCA9IChtYXliZUVsZW1lbnQpID0+ICEoJ2lzQ29ubmVjdGVkJyBpbiBtYXliZUVsZW1lbnQpIHx8IG1heWJlRWxlbWVudC5pc0Nvbm5lY3RlZDtcbmNvbnN0IGNsZWFudXBFbGVtZW50cyA9IGRlYm91bmNlKChtYXApID0+IHtcbiAgICBmb3IgKGxldCBrZXkgb2YgbWFwLmtleXMoKSkge1xuICAgICAgICBtYXAuc2V0KGtleSwgbWFwLmdldChrZXkpLmZpbHRlcihpc0Nvbm5lY3RlZCkpO1xuICAgIH1cbn0sIDIwMDApO1xuY29uc3Qgc3RlbmNpbFN1YnNjcmlwdGlvbiA9ICgpID0+IHtcbiAgICBpZiAodHlwZW9mIGdldFJlbmRlcmluZ1JlZiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiB3ZSBhcmUgbm90IGluIGEgc3RlbmNpbCBwcm9qZWN0LCB3ZSBkbyBub3RoaW5nLlxuICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIG5vdCByZWFsbHkgZXhwb3J0ZWQgYnkgQHN0ZW5jaWwvY29yZS5cbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBjb25zdCBlbG1zVG9VcGRhdGUgPSBuZXcgTWFwKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGlzcG9zZTogKCkgPT4gZWxtc1RvVXBkYXRlLmNsZWFyKCksXG4gICAgICAgIGdldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbG0gPSBnZXRSZW5kZXJpbmdSZWYoKTtcbiAgICAgICAgICAgIGlmIChlbG0pIHtcbiAgICAgICAgICAgICAgICBhcHBlbmRUb01hcChlbG1zVG9VcGRhdGUsIHByb3BOYW1lLCBlbG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzZXQ6IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBlbG1zVG9VcGRhdGUuZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50cykge1xuICAgICAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5zZXQocHJvcE5hbWUsIGVsZW1lbnRzLmZpbHRlcihmb3JjZVVwZGF0ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYW51cEVsZW1lbnRzKGVsbXNUb1VwZGF0ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0OiAoKSA9PiB7XG4gICAgICAgICAgICBlbG1zVG9VcGRhdGUuZm9yRWFjaCgoZWxtcykgPT4gZWxtcy5mb3JFYWNoKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICB9O1xufTtcblxuY29uc3QgdW53cmFwID0gKHZhbCkgPT4gKHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicgPyB2YWwoKSA6IHZhbCk7XG5jb25zdCBjcmVhdGVPYnNlcnZhYmxlTWFwID0gKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlID0gKGEsIGIpID0+IGEgIT09IGIpID0+IHtcbiAgICBjb25zdCB1bndyYXBwZWRTdGF0ZSA9IHVud3JhcChkZWZhdWx0U3RhdGUpO1xuICAgIGxldCBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHVud3JhcHBlZFN0YXRlICE9PSBudWxsICYmIHVud3JhcHBlZFN0YXRlICE9PSB2b2lkIDAgPyB1bndyYXBwZWRTdGF0ZSA6IHt9KSk7XG4gICAgY29uc3QgaGFuZGxlcnMgPSB7XG4gICAgICAgIGRpc3Bvc2U6IFtdLFxuICAgICAgICBnZXQ6IFtdLFxuICAgICAgICBzZXQ6IFtdLFxuICAgICAgICByZXNldDogW10sXG4gICAgfTtcbiAgICBjb25zdCByZXNldCA9ICgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBXaGVuIHJlc2V0dGluZyB0aGUgc3RhdGUsIHRoZSBkZWZhdWx0IHN0YXRlIG1heSBiZSBhIGZ1bmN0aW9uIC0gdW53cmFwIGl0IHRvIGludm9rZSBpdC5cbiAgICAgICAgLy8gb3RoZXJ3aXNlLCB0aGUgc3RhdGUgd29uJ3QgYmUgcHJvcGVybHkgcmVzZXRcbiAgICAgICAgc3RhdGVzID0gbmV3IE1hcChPYmplY3QuZW50cmllcygoX2EgPSB1bndyYXAoZGVmYXVsdFN0YXRlKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDoge30pKTtcbiAgICAgICAgaGFuZGxlcnMucmVzZXQuZm9yRWFjaCgoY2IpID0+IGNiKCkpO1xuICAgIH07XG4gICAgY29uc3QgZGlzcG9zZSA9ICgpID0+IHtcbiAgICAgICAgLy8gQ2FsbCBmaXJzdCBkaXNwb3NlIGFzIHJlc2V0dGluZyB0aGUgc3RhdGUgd291bGRcbiAgICAgICAgLy8gY2F1c2UgbGVzcyB1cGRhdGVzIDspXG4gICAgICAgIGhhbmRsZXJzLmRpc3Bvc2UuZm9yRWFjaCgoY2IpID0+IGNiKCkpO1xuICAgICAgICByZXNldCgpO1xuICAgIH07XG4gICAgY29uc3QgZ2V0ID0gKHByb3BOYW1lKSA9PiB7XG4gICAgICAgIGhhbmRsZXJzLmdldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUpKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlcy5nZXQocHJvcE5hbWUpO1xuICAgIH07XG4gICAgY29uc3Qgc2V0ID0gKHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHN0YXRlcy5nZXQocHJvcE5hbWUpO1xuICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKHZhbHVlLCBvbGRWYWx1ZSwgcHJvcE5hbWUpKSB7XG4gICAgICAgICAgICBzdGF0ZXMuc2V0KHByb3BOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICBoYW5kbGVycy5zZXQuZm9yRWFjaCgoY2IpID0+IGNiKHByb3BOYW1lLCB2YWx1ZSwgb2xkVmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgc3RhdGUgPSAodHlwZW9mIFByb3h5ID09PSAndW5kZWZpbmVkJ1xuICAgICAgICA/IHt9XG4gICAgICAgIDogbmV3IFByb3h5KHVud3JhcHBlZFN0YXRlLCB7XG4gICAgICAgICAgICBnZXQoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvd25LZXlzKF8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShzdGF0ZXMua2V5cygpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzKF8sIHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlcy5oYXMocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldChfLCBwcm9wTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBzZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pKTtcbiAgICBjb25zdCBvbiA9IChldmVudE5hbWUsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGhhbmRsZXJzW2V2ZW50TmFtZV0ucHVzaChjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVGcm9tQXJyYXkoaGFuZGxlcnNbZXZlbnROYW1lXSwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3Qgb25DaGFuZ2UgPSAocHJvcE5hbWUsIGNiKSA9PiB7XG4gICAgICAgIGNvbnN0IHVuU2V0ID0gb24oJ3NldCcsIChrZXksIG5ld1ZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIGNiKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdW53cmFwIHRoZSBkZWZhdWx0U3RhdGUgYmVjYXVzZSBpdCBtaWdodCBiZSBhIGZ1bmN0aW9uLlxuICAgICAgICAvLyBPdGhlcndpc2Ugd2UgbWlnaHQgbm90IGJlIHNlbmRpbmcgdGhlIHJpZ2h0IHJlc2V0IHZhbHVlLlxuICAgICAgICBjb25zdCB1blJlc2V0ID0gb24oJ3Jlc2V0JywgKCkgPT4gY2IodW53cmFwKGRlZmF1bHRTdGF0ZSlbcHJvcE5hbWVdKSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICB1blNldCgpO1xuICAgICAgICAgICAgdW5SZXNldCgpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgdXNlID0gKC4uLnN1YnNjcmlwdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgdW5zdWJzID0gc3Vic2NyaXB0aW9ucy5yZWR1Y2UoKHVuc3Vicywgc3Vic2NyaXB0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLnNldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdzZXQnLCBzdWJzY3JpcHRpb24uc2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLmdldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdnZXQnLCBzdWJzY3JpcHRpb24uZ2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLnJlc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3Jlc2V0Jywgc3Vic2NyaXB0aW9uLnJlc2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLmRpc3Bvc2UpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignZGlzcG9zZScsIHN1YnNjcmlwdGlvbi5kaXNwb3NlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5zdWJzO1xuICAgICAgICB9LCBbXSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB1bnN1YnMuZm9yRWFjaCgodW5zdWIpID0+IHVuc3ViKCkpO1xuICAgIH07XG4gICAgY29uc3QgZm9yY2VVcGRhdGUgPSAoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChrZXkpO1xuICAgICAgICBoYW5kbGVycy5zZXQuZm9yRWFjaCgoY2IpID0+IGNiKGtleSwgb2xkVmFsdWUsIG9sZFZhbHVlKSk7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzdGF0ZSxcbiAgICAgICAgZ2V0LFxuICAgICAgICBzZXQsXG4gICAgICAgIG9uLFxuICAgICAgICBvbkNoYW5nZSxcbiAgICAgICAgdXNlLFxuICAgICAgICBkaXNwb3NlLFxuICAgICAgICByZXNldCxcbiAgICAgICAgZm9yY2VVcGRhdGUsXG4gICAgfTtcbn07XG5jb25zdCByZW1vdmVGcm9tQXJyYXkgPSAoYXJyYXksIGl0ZW0pID0+IHtcbiAgICBjb25zdCBpbmRleCA9IGFycmF5LmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgYXJyYXlbaW5kZXhdID0gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07XG4gICAgICAgIGFycmF5Lmxlbmd0aC0tO1xuICAgIH1cbn07XG5cbmNvbnN0IGNyZWF0ZVN0b3JlID0gKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKSA9PiB7XG4gICAgY29uc3QgbWFwID0gY3JlYXRlT2JzZXJ2YWJsZU1hcChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSk7XG4gICAgbWFwLnVzZShzdGVuY2lsU3Vic2NyaXB0aW9uKCkpO1xuICAgIHJldHVybiBtYXA7XG59O1xuXG5leHBvcnQgeyBjcmVhdGVTdG9yZSBhcyBjIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LTA1OTU2Y2FiLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZSBhcyBlc2NhcGVSZWdFeHAgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuXG4vLyBpbXBvcnQgc3RyaW5nVXRpbCBmcm9tIFwiLi9zdHJpbmdzXCI7XG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHN0b3JhZ2Ugb2YgdmFyaW91cyBmb3JtcyAoY29va2llcywgbG9jYWwgc3RvcmFnZSwgYW5kIHNlc3Npb24gc3RvcmFnZSkuXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZShuYW1lLCBjb29raWUsIHByb3BlcnRpZXMsIHN0cmluZ2lmeSkge1xuICAgIHdyaXRlQ29va2llKG5hbWUsIHN0cmluZ2lmeSA/IEpTT04uc3RyaW5naWZ5KGNvb2tpZSkgOiBjb29raWUsIHByb3BlcnRpZXMpO1xufVxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUsIHBhcnNlKSB7XG4gICAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgICByZXR1cm4gY29va2llICYmIHBhcnNlID8gSlNPTi5wYXJzZShjb29raWUpIDogY29va2llO1xufVxuZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBpdGVtLCBzdHJpbmdpZnkpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgcGFyc2UpIHtcbiAgICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICAgIHJldHVybiBpdGVtICYmIHBhcnNlID8gSlNPTi5wYXJzZShpdGVtKSA6IGl0ZW07XG59XG5mdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldFNlc3Npb25TdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gcmVhZENvb2tpZShuYW1lKSB7XG4gICAgY29uc3QgY29va2llID0gZG9jdW1lbnQuY29va2llO1xuICAgIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgICBjb25zdCBtYXRjaGVkQ29va2llcyA9IGNvb2tpZS5tYXRjaChjb29raWVOYW1lUkUpO1xuICAgIHJldHVybiBtYXRjaGVkQ29va2llcyA/IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVkQ29va2llc1sxXSkgOiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiB3cml0ZUNvb2tpZShuYW1lLCB2YWx1ZSwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGxldCBleHBpcmVzID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLmV4cGlyZXM7XG4gICAgaWYgKHR5cGVvZiBleHBpcmVzID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShEYXRlLm5vdygpICsgZGF5c0Zyb21Ub2RheUluTXMpO1xuICAgICAgICBleHBpcmVzID0gcHJvcGVydGllcy5leHBpcmVzID0gZXhwaXJhdGlvbkRhdGU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmV4cGlyZXMgPSBleHBpcmVzLnRvVVRDU3RyaW5nKCk7XG4gICAgfVxuICAgIGxldCBjb29raWUgPSBgJHtuYW1lfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSl9YDtcbiAgICBsZXQgcHJvcGVydHk7XG4gICAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGNvb2tpZSArPSBgOyAke3Byb3BlcnR5fWA7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZTtcbn1cblxuZXhwb3J0IHsgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGEsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBiLCBnZXRDb29raWUgYXMgYywgc2V0Q29va2llIGFzIGQsIGdldExvY2FsU3RvcmFnZUl0ZW0gYXMgZywgc2V0TG9jYWxTdG9yYWdlSXRlbSBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0b3JhZ2UtMDM1M2E3NjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9