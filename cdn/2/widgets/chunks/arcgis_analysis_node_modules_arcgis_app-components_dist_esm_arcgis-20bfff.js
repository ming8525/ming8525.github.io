"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-20bfff"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const addItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    typeKeywords: [],
    customParameters: [],
    analyzedLocationTypes: [],
    allowStoredAuth: true,
    isSecured: null,
    checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;



//# sourceMappingURL=add-item-dbbe2f57.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ canMatchField),
/* harmony export */   g: () => (/* binding */ getAppendParameters)
/* harmony export */ });
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





var __rest = ( false) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
function canMatchField(field, matchField) {
    var _a;
    const fieldType = (field === null || field === void 0 ? void 0 : field.type) || null;
    const matchFieldType = (matchField === null || matchField === void 0 ? void 0 : matchField.type) || null;
    const matchFields = {
        esriFieldTypeSmallInteger: ["esriFieldTypeSmallInteger"],
        esriFieldTypeInteger: ["esriFieldTypeInteger", "esriFieldTypeSmallInteger"],
        esriFieldTypeSingle: ["esriFieldTypeSingle", "esriFieldTypeDouble"],
        esriFieldTypeDouble: [
            "esriFieldTypeDouble",
            "esriFieldTypeSingle",
            "esriFieldTypeInteger",
            "esriFieldTypeSmallInteger"
        ],
        esriFieldTypeDate: ["esriFieldTypeDate"],
        esriFieldTypeString: [
            "esriFieldTypeString",
            "esriFieldTypeSmallInteger",
            "esriFieldTypeInteger",
            "esriFieldTypeSingle",
            "esriFieldTypeDouble",
            "esriFieldTypeDate",
            "esriFieldTypeGUID"
        ],
        esriFieldTypeGUID: ["esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeOID: ["esriFieldTypeOID", "esriFieldTypeSmallInteger", "esriFieldTypeInteger"],
        esriFieldTypeGlobalID: ["esriFieldTypeGlobalID", "esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeDateOnly: ["esriFieldTypeDateOnly"],
        esriFieldTypeTimeOnly: ["esriFieldTypeTimeOnly"],
        esriFieldTypeTimestampOffset: ["esriFieldTypeTimestampOffset"],
        esriFieldTypeBigInteger: ["esriFieldTypeBigInteger"]
    };
    return matchFieldType && (matchFieldType === fieldType || ((_a = matchFields[fieldType]) === null || _a === void 0 ? void 0 : _a.indexOf(matchFieldType)) > -1);
}
function getAppendParameters(addItemProps) {
    var _a;
    const { timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption, sourceDataLayer } = addItemProps;
    let finalAppendParameters, appendSourceInfo;
    const { publishParameters } = analyzeResults, rest = __rest(analyzeResults, ["publishParameters"]);
    const upsert = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
    const finalFieldMappings = formatFieldMappings(fieldMappings);
    const appendFields = createAppendFields(finalFieldMappings);
    const timezoneInfo = {
        dateFieldsTimeReference: {
            timeZone: timezone || "UTC",
            respectsDaylightSaving: true
        }
    };
    const defaultAppendParams = {
        sourceTableName: dataLayer.name,
        fieldMappings: (finalFieldMappings === null || finalFieldMappings === void 0 ? void 0 : finalFieldMappings.length) ? JSON.stringify(finalFieldMappings) : null,
        upsert,
        skipInserts: addAppendSelectOption === "update",
        skipUpdates: false,
        useGlobalIds: upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.type) === "esriFieldTypeGlobalID",
        updateGeometry: upsert ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.addAppendSelectUpdateTypeOption === "attributeAndGeometry" : true,
        appendFields: appendFields.length ? JSON.stringify(appendFields) : null,
        appendItemId: id,
        appendUploadFormat: _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__.a[_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.type].appendUploadFormat,
        rollbackOnFailure: true
    };
    const publishInfo = __rest(publishParameters, ["layers"]);
    if (type === "CSV") {
        publishParameters.layerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    else if (type === "Microsoft Excel") {
        const layerInfo = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__.a)({}, true);
        const formattedLayerInfo = getLayerToAppend(layerInfo, publishInfo); //Updated info needs to be added to the layers [] rather than the root for excel
        formattedLayerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        publishInfo.name = dataLayer.name;
        appendSourceInfo = Object.assign(Object.assign(Object.assign(Object.assign({}, timezoneInfo), { layers: [formattedLayerInfo] }), publishInfo), rest);
    }
    else {
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    finalAppendParameters = Object.assign(Object.assign({}, defaultAppendParams), { appendSourceInfo: JSON.stringify(appendSourceInfo) });
    if (addAppendSelectOption === "add") {
        finalAppendParameters.upsertMatchingField = sourceDataLayer.objectIdField || ((_a = sourceDataLayer.uniqueField) === null || _a === void 0 ? void 0 : _a.name);
    }
    else {
        if (upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.isUniqueIndex)) {
            finalAppendParameters.upsertMatchingField = uidPair === null || uidPair === void 0 ? void 0 : uidPair.name;
        }
    }
    return finalAppendParameters;
}
function getLayerToAppend(layerInfo, updatedInfo) {
    const formattedLayer = Object.assign({}, layerInfo);
    formattedLayer.locationType = updatedInfo.locationType;
    if (formattedLayer.locationType === "address") {
        formattedLayer.addressFields = updatedInfo.addressFields;
        formattedLayer.sourceCountry = updatedInfo.sourceCountry;
    }
    else if (formattedLayer.locationType === "coordinates") {
        formattedLayer.coordinateFieldType = updatedInfo.coordinateFieldType;
        if (formattedLayer.coordinateFieldType === "LatitudeAndLongitude") {
            formattedLayer.latitudeFieldName = updatedInfo.latitudeFieldName;
            formattedLayer.longitudeFieldName = updatedInfo.longitudeFieldName;
        }
        else {
            formattedLayer.coordinateFieldName = updatedInfo.coordinateFieldName;
        }
    }
    return formattedLayer;
}
function formatFieldMappings(fieldMappings) {
    const fields = fieldMappings.filter((fieldMapping) => {
        return fieldMapping.source !== _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__.N;
    });
    const finalFieldMappings = fields.map(({ source, name }) => {
        return { source, name };
    });
    return finalFieldMappings;
}
function createAppendFields(fieldMappings) {
    const appendFields = fieldMappings.map((mapping) => {
        return mapping.name;
    });
    return appendFields;
}



//# sourceMappingURL=append-3f264d56.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-key-pair-select.entry.js":
/*!***********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-key-pair-select.entry.js ***!
  \***********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_key_pair_select: () => (/* binding */ ArcgisNewItemPagesAppendKeyPairSelect)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _append_3f264d56_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./append-3f264d56.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */

















const arcgisNewItemPagesAppendKeyPairSelectCss = ".timezone-wrapper{background-color:var(--calcite-color-background);padding-left:1rem}.timezone{margin-bottom:0.75rem;margin-inline-end:2.5rem;display:block}.timezone-header{font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}";

const ArcgisNewItemPagesAppendKeyPairSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.handleTimezoneChange = (event) => {
            this.selectedTimezone = event.detail;
        };
        this.handleKeyPairChange = (event) => {
            this.selectedKeyPair = event.detail;
        };
        this.i18n = undefined;
        this.selectedKeyPair = undefined;
        this.selectedTimezone = undefined;
        this.oidFieldSelected = false;
        this.error = undefined;
    }
    handleNext() {
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption !== "add") {
            if (Object.values(this.selectedKeyPair).includes(_append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N)) {
                this.error = { title: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error, message: this.i18n.noKeyPair }; //Key pair must be selected to update data.
                return;
            }
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair = this.selectedKeyPair;
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.timezone = this.selectedTimezone;
        this.newItemUpdatePage.emit("appendMatchFields");
    }
    async handlePrev(event) {
        var _a;
        if (!(((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) > 1)) {
            //item is deleted on appendSelectLayer
            event.preventDefault();
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair = null;
            this.newItemPrevPage.emit();
        }
    }
    componentWillLoad() {
        var _a;
        const { existingItem, dateFieldsTimeReference, originalFileName } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendKeyValuePair;
        this.serviceLayer = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.sourceDataLayer;
        this.selectedTimezone = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.timezone) !== null && _a !== void 0 ? _a : "UTC";
        this.timezoneDescription = this.i18n.timezoneDescription
            .replace("${uploadedFileName}", originalFileName)
            .replace("${featureLayerName}", existingItem.title)
            .replace("${featureLayerTimezone}", dateFieldsTimeReference.timeZone);
        this.isEnterprise = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_5__.c.portal.isPortal;
        this.findKeyPairs();
    }
    findKeyPairs() {
        var _a;
        const keyPairs = {};
        const serviceLayerFields = this.serviceLayer.fields || [];
        const indexes = this.serviceLayer.indexes || [];
        const dataLayerFields = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.backupLayerFields;
        indexes
            .filter((idx) => idx === null || idx === void 0 ? void 0 : idx.isUnique)
            .forEach((index) => {
            var _a;
            (((_a = index.fields) === null || _a === void 0 ? void 0 : _a.split(",")) || []).forEach((fieldName) => {
                serviceLayerFields.some((field) => {
                    if (field.name.toLowerCase() === fieldName.toLowerCase()) {
                        field.isUniqueIndex = true;
                        return true;
                    }
                    else {
                        return false;
                    }
                });
            });
        });
        this.serviceUIDFields = serviceLayerFields
            .filter((field) => (field.type && _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.u.includes(field.type)) || field.isUniqueIndex)
            .sort((a, b) => a.name.localeCompare(b.name));
        //Generate matched fields with serviceMatchFields
        this.serviceUIDFields.forEach((serviceFieldInfo) => {
            const matches = [];
            dataLayerFields.forEach((dataFieldInfo) => {
                if ((0,_append_3f264d56_js__WEBPACK_IMPORTED_MODULE_4__.c)(serviceFieldInfo, dataFieldInfo)) {
                    matches.push(dataFieldInfo.name);
                }
            });
            keyPairs[serviceFieldInfo.name] = {
                name: serviceFieldInfo.name,
                type: serviceFieldInfo.type,
                idx: 0,
                isUniqueIndex: serviceFieldInfo === null || serviceFieldInfo === void 0 ? void 0 : serviceFieldInfo.isUniqueIndex,
                possibleMatches: [_append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N, ...matches],
                disabled: true
            };
        });
        this.finalKeyPairs = Object.assign({ "<None>": { name: _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N, type: "None", possibleMatches: [_append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N] } }, keyPairs);
        this.selectedKeyPair = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair) !== null && _a !== void 0 ? _a : this.finalKeyPairs[_append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N];
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.serviceUIDFields = this.serviceUIDFields; //Do not include these fields in following match-fields table.
    }
    render() {
        const { error, i18n, isEnterprise, timezoneDescription } = this;
        const { addAppendSelectOption, backupLayerFields } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        const { helpBase, helpMap } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_5__.c.config;
        const isAddWorkflow = addAppendSelectOption === "add";
        const hasDate = backupLayerFields === null || backupLayerFields === void 0 ? void 0 : backupLayerFields.some((field) => field.type === "esriFieldTypeDate");
        const oidHelpLink = `${helpBase}${helpMap["120004711"]}`;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, !isAddWorkflow && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-append-key-value-pair", { class: "key-value-pair", keyPairs: this.finalKeyPairs, onKeyPairChange: this.handleKeyPairChange })), hasDate && !isEnterprise && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "timezone-header" }, i18n.timezoneHeader), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "timezone-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-timezone-dropdown", { class: "timezone", onTimezoneChange: this.handleTimezoneChange, defaultTimezone: this.selectedTimezone, subTitle: timezoneDescription })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: this.selectedKeyPair.type === "esriFieldTypeOID", kind: "warning", heading: i18n.learnMoreUIDTitle, link: { href: oidHelpLink, title: i18n.learnMoreUIDLink } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.message, active: !!error, kind: "danger", onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendKeyPairSelect.style = arcgisNewItemPagesAppendKeyPairSelectCss;



//# sourceMappingURL=arcgis-new-item-pages-append-key-pair-select.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const uiStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    nextText: "next",
    workflow: "content",
    scale: "m",
    disableScroll: false,
    featureFlags: {}
});
const uiStoreState = uiStore.state;



//# sourceMappingURL=ui-bca7bcd1.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTIwYmZmZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOztBQUVoRzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUMyRDtBQUNKO0FBQ1c7QUFDQzs7QUFFbkUsY0FBYyxNQUE2QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxjQUFjO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGdIQUFnSDtBQUM1SDtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG9EQUFZO0FBQzdDO0FBQ0E7QUFDQSw0QkFBNEIsc0RBQWtCLENBQUMsb0RBQVk7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0EsMEJBQTBCLHVEQUFvQixHQUFHO0FBQ2pELDZFQUE2RTtBQUM3RTtBQUNBO0FBQ0EscUZBQXFGLG1CQUFtQiw4QkFBOEI7QUFDdEk7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBLDBEQUEwRCwwQkFBMEIsb0RBQW9EO0FBQ3hJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsa0RBQVU7QUFDakQsS0FBSztBQUNMLDZDQUE2QyxjQUFjO0FBQzNELGlCQUFpQjtBQUNqQixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUV3RDs7QUFFeEQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDaEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFNOztBQUVyTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ2xEO0FBQ1k7QUFDbEI7QUFDSztBQUNGO0FBQzNCO0FBQ0U7QUFDRztBQUNBO0FBQ047QUFDRDtBQUNPO0FBQ0o7QUFDSztBQUNEOztBQUVsQyxvRUFBb0UsaURBQWlELGtCQUFrQixVQUFVLHNCQUFzQix5QkFBeUIsY0FBYyxpQkFBaUIsZUFBZSxnQkFBZ0Isa0NBQWtDOztBQUVoUztBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsaUNBQWlDLHFEQUFXO0FBQzVDLCtCQUErQixxREFBVztBQUMxQyxnQ0FBZ0MscURBQVc7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG9EQUFZO0FBQ3hCLDZEQUE2RCxrREFBVTtBQUN2RSwrQkFBK0IsT0FBTyw4Q0FBWSw2Q0FBNkM7QUFDL0Y7QUFDQTtBQUNBLFlBQVksb0RBQVk7QUFDeEI7QUFDQSxRQUFRLG9EQUFZO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG9EQUFZO0FBQ2pDO0FBQ0E7QUFDQSxZQUFZLG9EQUFZO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMERBQTBELEVBQUUsb0RBQVk7QUFDeEYsb0JBQW9CLDhDQUFZO0FBQ2hDLDRCQUE0QixvREFBWTtBQUN4QyxzQ0FBc0Msb0RBQVk7QUFDbEQ7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDLHdCQUF3QixpQkFBaUI7QUFDekMsd0JBQXdCLHFCQUFxQjtBQUM3Qyw0QkFBNEIsa0RBQVc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0Msb0RBQVk7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBLDhDQUE4QyxrREFBUztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNEQUFhO0FBQ2pDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxrREFBVTtBQUM1QztBQUNBO0FBQ0EsU0FBUztBQUNULDZDQUE2QyxZQUFZLE1BQU0sa0RBQVUsa0NBQWtDLGtEQUFVLEtBQUs7QUFDMUgscUNBQXFDLG9EQUFZLDhEQUE4RCxrREFBVTtBQUN6SCxRQUFRLG9EQUFZLDJDQUEyQztBQUMvRDtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFpRDtBQUNqRSxnQkFBZ0IsMkNBQTJDLEVBQUUsb0RBQVk7QUFDekUsZ0JBQWdCLG9CQUFvQixFQUFFLGtEQUFXO0FBQ2pEO0FBQ0E7QUFDQSwrQkFBK0IsU0FBUyxFQUFFLHFCQUFxQjtBQUMvRCxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSwyQkFBMkIscURBQUMsNENBQTRDLGtHQUFrRyxpQ0FBaUMscURBQUMsd0JBQXdCLHFEQUFDLFVBQVUsMEJBQTBCLHdCQUF3QixxREFBQyxVQUFVLDJCQUEyQixFQUFFLHFEQUFDLHdDQUF3Qyx1SUFBdUksTUFBTSxxREFBQyw0QkFBNEIsb0hBQW9ILG1EQUFtRCxHQUFHLHFEQUFDLDRCQUE0QiwwTkFBME47QUFDbjlCO0FBQ0EsZUFBZSxPQUFPLHFEQUFVO0FBQ2hDO0FBQ0E7O0FBRWlHOztBQUVqRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDdklBO0FBQ0E7QUFDQTtBQUNBO0FBQ21FOztBQUVuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxtREFBeUIsVUFBVSxlQUFlLE9BQU87O0FBRTZDOztBQUV4Sjs7Ozs7Ozs7Ozs7Ozs7OztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUN1RDs7QUFFdkQsZ0JBQWdCLHFEQUFXO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRTJDOztBQUUzQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FkZC1pdGVtLWRiYmUyZjU3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC0zZjI2NGQ1Ni5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtNGUxMTAzMmMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1rZXktcGFpci1zZWxlY3QuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS0zNTM1NTUyZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS91aS1iY2E3YmNkMS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgYWRkSXRlbVN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIHR5cGVLZXl3b3JkczogW10sXG4gICAgY3VzdG9tUGFyYW1ldGVyczogW10sXG4gICAgYW5hbHl6ZWRMb2NhdGlvblR5cGVzOiBbXSxcbiAgICBhbGxvd1N0b3JlZEF1dGg6IHRydWUsXG4gICAgaXNTZWN1cmVkOiBudWxsLFxuICAgIGNoZWNrQXV0aDogZmFsc2Vcbn0pO1xuLy8gRW50aXJlIGFkZCBpdGVtIHN0YXRlIG9iamVjdFxuY29uc3QgYWRkSXRlbVN0YXRlID0gYWRkSXRlbVN0b3JlLnN0YXRlO1xuLy8gU3Vic2V0cyBvZiBhZGQgaXRlbSBzdGF0ZVxuY29uc3QgYWRkSXRlbVJlcXVlc3RTdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbmNvbnN0IGFkZEl0ZW1VcmxTdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgYWRkSXRlbVN0YXRlIGFzIGEsIGFkZEl0ZW1VcmxTdGF0ZSBhcyBiLCBhZGRJdGVtUmVxdWVzdFN0YXRlIGFzIGMsIGFkZEl0ZW1TdG9yZSBhcyBkIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFkZC1pdGVtLWRiYmUyZjU3LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IE4gYXMgTk9ORV9WQUxVRSB9IGZyb20gJy4vYXBwZW5kLTRlMTEwMzJjLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QW5hbHl6ZWRMYXllckluZm8gfSBmcm9tICcuL2dlb2NvZGUtNjRlMGIwZDMuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuXG52YXIgX19yZXN0ID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19yZXN0KSB8fCBmdW5jdGlvbiAocywgZSkge1xuICAgIHZhciB0ID0ge307XG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXG4gICAgICAgIHRbcF0gPSBzW3BdO1xuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xuICAgICAgICB9XG4gICAgcmV0dXJuIHQ7XG59O1xuZnVuY3Rpb24gY2FuTWF0Y2hGaWVsZChmaWVsZCwgbWF0Y2hGaWVsZCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBmaWVsZFR5cGUgPSAoZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLnR5cGUpIHx8IG51bGw7XG4gICAgY29uc3QgbWF0Y2hGaWVsZFR5cGUgPSAobWF0Y2hGaWVsZCA9PT0gbnVsbCB8fCBtYXRjaEZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXRjaEZpZWxkLnR5cGUpIHx8IG51bGw7XG4gICAgY29uc3QgbWF0Y2hGaWVsZHMgPSB7XG4gICAgICAgIGVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVJbnRlZ2VyOiBbXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiLCBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVTaW5nbGU6IFtcImVzcmlGaWVsZFR5cGVTaW5nbGVcIiwgXCJlc3JpRmllbGRUeXBlRG91YmxlXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlRG91YmxlOiBbXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVEb3VibGVcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVNpbmdsZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCJcbiAgICAgICAgXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZURhdGU6IFtcImVzcmlGaWVsZFR5cGVEYXRlXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlU3RyaW5nOiBbXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTdHJpbmdcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVEb3VibGVcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZURhdGVcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZUdVSURcIlxuICAgICAgICBdLFxuICAgICAgICBlc3JpRmllbGRUeXBlR1VJRDogW1wiZXNyaUZpZWxkVHlwZUdVSURcIiwgXCJlc3JpRmllbGRUeXBlU3RyaW5nXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlT0lEOiBbXCJlc3JpRmllbGRUeXBlT0lEXCIsIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiLCBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlR2xvYmFsSUQ6IFtcImVzcmlGaWVsZFR5cGVHbG9iYWxJRFwiLCBcImVzcmlGaWVsZFR5cGVHVUlEXCIsIFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZURhdGVPbmx5OiBbXCJlc3JpRmllbGRUeXBlRGF0ZU9ubHlcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVUaW1lT25seTogW1wiZXNyaUZpZWxkVHlwZVRpbWVPbmx5XCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlVGltZXN0YW1wT2Zmc2V0OiBbXCJlc3JpRmllbGRUeXBlVGltZXN0YW1wT2Zmc2V0XCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlQmlnSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXJcIl1cbiAgICB9O1xuICAgIHJldHVybiBtYXRjaEZpZWxkVHlwZSAmJiAobWF0Y2hGaWVsZFR5cGUgPT09IGZpZWxkVHlwZSB8fCAoKF9hID0gbWF0Y2hGaWVsZHNbZmllbGRUeXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluZGV4T2YobWF0Y2hGaWVsZFR5cGUpKSA+IC0xKTtcbn1cbmZ1bmN0aW9uIGdldEFwcGVuZFBhcmFtZXRlcnMoYWRkSXRlbVByb3BzKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgdGltZXpvbmUsIGFuYWx5emVSZXN1bHRzLCB0eXBlLCBmaWVsZE1hcHBpbmdzLCBkYXRhTGF5ZXIsIGlkLCB1aWRQYWlyLCBhZGRBcHBlbmRTZWxlY3RPcHRpb24sIHNvdXJjZURhdGFMYXllciB9ID0gYWRkSXRlbVByb3BzO1xuICAgIGxldCBmaW5hbEFwcGVuZFBhcmFtZXRlcnMsIGFwcGVuZFNvdXJjZUluZm87XG4gICAgY29uc3QgeyBwdWJsaXNoUGFyYW1ldGVycyB9ID0gYW5hbHl6ZVJlc3VsdHMsIHJlc3QgPSBfX3Jlc3QoYW5hbHl6ZVJlc3VsdHMsIFtcInB1Ymxpc2hQYXJhbWV0ZXJzXCJdKTtcbiAgICBjb25zdCB1cHNlcnQgPSBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBzZXJ0XCIgfHwgYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwZGF0ZVwiO1xuICAgIGNvbnN0IGZpbmFsRmllbGRNYXBwaW5ncyA9IGZvcm1hdEZpZWxkTWFwcGluZ3MoZmllbGRNYXBwaW5ncyk7XG4gICAgY29uc3QgYXBwZW5kRmllbGRzID0gY3JlYXRlQXBwZW5kRmllbGRzKGZpbmFsRmllbGRNYXBwaW5ncyk7XG4gICAgY29uc3QgdGltZXpvbmVJbmZvID0ge1xuICAgICAgICBkYXRlRmllbGRzVGltZVJlZmVyZW5jZToge1xuICAgICAgICAgICAgdGltZVpvbmU6IHRpbWV6b25lIHx8IFwiVVRDXCIsXG4gICAgICAgICAgICByZXNwZWN0c0RheWxpZ2h0U2F2aW5nOiB0cnVlXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGRlZmF1bHRBcHBlbmRQYXJhbXMgPSB7XG4gICAgICAgIHNvdXJjZVRhYmxlTmFtZTogZGF0YUxheWVyLm5hbWUsXG4gICAgICAgIGZpZWxkTWFwcGluZ3M6IChmaW5hbEZpZWxkTWFwcGluZ3MgPT09IG51bGwgfHwgZmluYWxGaWVsZE1hcHBpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaW5hbEZpZWxkTWFwcGluZ3MubGVuZ3RoKSA/IEpTT04uc3RyaW5naWZ5KGZpbmFsRmllbGRNYXBwaW5ncykgOiBudWxsLFxuICAgICAgICB1cHNlcnQsXG4gICAgICAgIHNraXBJbnNlcnRzOiBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBkYXRlXCIsXG4gICAgICAgIHNraXBVcGRhdGVzOiBmYWxzZSxcbiAgICAgICAgdXNlR2xvYmFsSWRzOiB1cHNlcnQgJiYgKHVpZFBhaXIgPT09IG51bGwgfHwgdWlkUGFpciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlkUGFpci50eXBlKSA9PT0gXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIixcbiAgICAgICAgdXBkYXRlR2VvbWV0cnk6IHVwc2VydCA/IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RVcGRhdGVUeXBlT3B0aW9uID09PSBcImF0dHJpYnV0ZUFuZEdlb21ldHJ5XCIgOiB0cnVlLFxuICAgICAgICBhcHBlbmRGaWVsZHM6IGFwcGVuZEZpZWxkcy5sZW5ndGggPyBKU09OLnN0cmluZ2lmeShhcHBlbmRGaWVsZHMpIDogbnVsbCxcbiAgICAgICAgYXBwZW5kSXRlbUlkOiBpZCxcbiAgICAgICAgYXBwZW5kVXBsb2FkRm9ybWF0OiBhZGRDcmVhdGVJdGVtVHlwZXNbYWRkSXRlbVN0YXRlLnR5cGVdLmFwcGVuZFVwbG9hZEZvcm1hdCxcbiAgICAgICAgcm9sbGJhY2tPbkZhaWx1cmU6IHRydWVcbiAgICB9O1xuICAgIGNvbnN0IHB1Ymxpc2hJbmZvID0gX19yZXN0KHB1Ymxpc2hQYXJhbWV0ZXJzLCBbXCJsYXllcnNcIl0pO1xuICAgIGlmICh0eXBlID09PSBcIkNTVlwiKSB7XG4gICAgICAgIHB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVySW5mby5kYXRlRmllbGRzVGltZVJlZmVyZW5jZSA9IHRpbWV6b25lSW5mby5kYXRlRmllbGRzVGltZVJlZmVyZW5jZTtcbiAgICAgICAgYXBwZW5kU291cmNlSW5mbyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCBwdWJsaXNoUGFyYW1ldGVycyksIHJlc3QpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiKSB7XG4gICAgICAgIGNvbnN0IGxheWVySW5mbyA9IGdldEFuYWx5emVkTGF5ZXJJbmZvKHt9LCB0cnVlKTtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkTGF5ZXJJbmZvID0gZ2V0TGF5ZXJUb0FwcGVuZChsYXllckluZm8sIHB1Ymxpc2hJbmZvKTsgLy9VcGRhdGVkIGluZm8gbmVlZHMgdG8gYmUgYWRkZWQgdG8gdGhlIGxheWVycyBbXSByYXRoZXIgdGhhbiB0aGUgcm9vdCBmb3IgZXhjZWxcbiAgICAgICAgZm9ybWF0dGVkTGF5ZXJJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlID0gdGltZXpvbmVJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlO1xuICAgICAgICBwdWJsaXNoSW5mby5uYW1lID0gZGF0YUxheWVyLm5hbWU7XG4gICAgICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCB7IGxheWVyczogW2Zvcm1hdHRlZExheWVySW5mb10gfSksIHB1Ymxpc2hJbmZvKSwgcmVzdCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBhcHBlbmRTb3VyY2VJbmZvID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRpbWV6b25lSW5mbyksIHB1Ymxpc2hQYXJhbWV0ZXJzKSwgcmVzdCk7XG4gICAgfVxuICAgIGZpbmFsQXBwZW5kUGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdEFwcGVuZFBhcmFtcyksIHsgYXBwZW5kU291cmNlSW5mbzogSlNPTi5zdHJpbmdpZnkoYXBwZW5kU291cmNlSW5mbykgfSk7XG4gICAgaWYgKGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMudXBzZXJ0TWF0Y2hpbmdGaWVsZCA9IHNvdXJjZURhdGFMYXllci5vYmplY3RJZEZpZWxkIHx8ICgoX2EgPSBzb3VyY2VEYXRhTGF5ZXIudW5pcXVlRmllbGQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uYW1lKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICh1cHNlcnQgJiYgKHVpZFBhaXIgPT09IG51bGwgfHwgdWlkUGFpciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlkUGFpci5pc1VuaXF1ZUluZGV4KSkge1xuICAgICAgICAgICAgZmluYWxBcHBlbmRQYXJhbWV0ZXJzLnVwc2VydE1hdGNoaW5nRmllbGQgPSB1aWRQYWlyID09PSBudWxsIHx8IHVpZFBhaXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpZFBhaXIubmFtZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmluYWxBcHBlbmRQYXJhbWV0ZXJzO1xufVxuZnVuY3Rpb24gZ2V0TGF5ZXJUb0FwcGVuZChsYXllckluZm8sIHVwZGF0ZWRJbmZvKSB7XG4gICAgY29uc3QgZm9ybWF0dGVkTGF5ZXIgPSBPYmplY3QuYXNzaWduKHt9LCBsYXllckluZm8pO1xuICAgIGZvcm1hdHRlZExheWVyLmxvY2F0aW9uVHlwZSA9IHVwZGF0ZWRJbmZvLmxvY2F0aW9uVHlwZTtcbiAgICBpZiAoZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIikge1xuICAgICAgICBmb3JtYXR0ZWRMYXllci5hZGRyZXNzRmllbGRzID0gdXBkYXRlZEluZm8uYWRkcmVzc0ZpZWxkcztcbiAgICAgICAgZm9ybWF0dGVkTGF5ZXIuc291cmNlQ291bnRyeSA9IHVwZGF0ZWRJbmZvLnNvdXJjZUNvdW50cnk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvcm1hdHRlZExheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJjb29yZGluYXRlc1wiKSB7XG4gICAgICAgIGZvcm1hdHRlZExheWVyLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSB1cGRhdGVkSW5mby5jb29yZGluYXRlRmllbGRUeXBlO1xuICAgICAgICBpZiAoZm9ybWF0dGVkTGF5ZXIuY29vcmRpbmF0ZUZpZWxkVHlwZSA9PT0gXCJMYXRpdHVkZUFuZExvbmdpdHVkZVwiKSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRMYXllci5sYXRpdHVkZUZpZWxkTmFtZSA9IHVwZGF0ZWRJbmZvLmxhdGl0dWRlRmllbGROYW1lO1xuICAgICAgICAgICAgZm9ybWF0dGVkTGF5ZXIubG9uZ2l0dWRlRmllbGROYW1lID0gdXBkYXRlZEluZm8ubG9uZ2l0dWRlRmllbGROYW1lO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9ybWF0dGVkTGF5ZXIuY29vcmRpbmF0ZUZpZWxkTmFtZSA9IHVwZGF0ZWRJbmZvLmNvb3JkaW5hdGVGaWVsZE5hbWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdHRlZExheWVyO1xufVxuZnVuY3Rpb24gZm9ybWF0RmllbGRNYXBwaW5ncyhmaWVsZE1hcHBpbmdzKSB7XG4gICAgY29uc3QgZmllbGRzID0gZmllbGRNYXBwaW5ncy5maWx0ZXIoKGZpZWxkTWFwcGluZykgPT4ge1xuICAgICAgICByZXR1cm4gZmllbGRNYXBwaW5nLnNvdXJjZSAhPT0gTk9ORV9WQUxVRTtcbiAgICB9KTtcbiAgICBjb25zdCBmaW5hbEZpZWxkTWFwcGluZ3MgPSBmaWVsZHMubWFwKCh7IHNvdXJjZSwgbmFtZSB9KSA9PiB7XG4gICAgICAgIHJldHVybiB7IHNvdXJjZSwgbmFtZSB9O1xuICAgIH0pO1xuICAgIHJldHVybiBmaW5hbEZpZWxkTWFwcGluZ3M7XG59XG5mdW5jdGlvbiBjcmVhdGVBcHBlbmRGaWVsZHMoZmllbGRNYXBwaW5ncykge1xuICAgIGNvbnN0IGFwcGVuZEZpZWxkcyA9IGZpZWxkTWFwcGluZ3MubWFwKChtYXBwaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiBtYXBwaW5nLm5hbWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFwcGVuZEZpZWxkcztcbn1cblxuZXhwb3J0IHsgY2FuTWF0Y2hGaWVsZCBhcyBjLCBnZXRBcHBlbmRQYXJhbWV0ZXJzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwZW5kLTNmMjY0ZDU2LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuY29uc3QgdWlkRmllbGRzID0gW1wiZXNyaUZpZWxkVHlwZU9JRFwiLCBcImVzcmlGaWVsZFR5cGVHbG9iYWxJRFwiXTtcbmNvbnN0IE5PTkVfVkFMVUUgPSBcIjxOb25lPlwiO1xuY29uc3QgQXBwZW5kT3ZlcndyaXRlUHVibGlzaFR5cGVzID0ge1xuICAgIFwiZmlsZSBnZW9kYXRhYmFzZVwiOiBcImZpbGVnZW9kYXRhYmFzZVwiLFxuICAgIHNoYXBlZmlsZTogXCJzaGFwZWZpbGVcIixcbiAgICBnZW9qc29uOiBcImdlb2pzb25cIixcbiAgICBjc3Y6IFwiQ1NWXCIsXG4gICAgXCJtaWNyb3NvZnQgZXhjZWxcIjogXCJleGNlbFwiLFxuICAgIGdlb3BhY2thZ2U6IFwiZ2VvUGFja2FnZVwiXG59O1xuY29uc3QgYXBwZW5kRmlsZVR5cGVzID0ge1xuICAgIFNoYXBlZmlsZTogXCJzaGFwZWZpbGVcIixcbiAgICBcIkZpbGUgR2VvZGF0YWJhc2VcIjogXCJmaWxlR2VvZGF0YWJhc2VcIixcbiAgICBDU1Y6IFwiY3N2XCIsXG4gICAgXCJNaWNyb3NvZnQgRXhjZWxcIjogXCJleGNlbFwiLFxuICAgIEdlb0pzb246IFwiZ2VvanNvblwiLFxuICAgIEdlb1BhY2thZ2U6IFwiZ2VvUGFja2FnZVwiXG59O1xuY29uc3QgQXBwZW5kT3ZlcndyaXRlQ2xvdWRQdWJsaXNoVHlwZXMgPSB7XG4gICAgY3N2OiBcIkNTVlwiLFxuICAgIGV4Y2VsOiBcIk1pY3Jvc29mdCBFeGNlbFwiLFxuICAgIHNoYXBlZmlsZTogXCJTaGFwZWZpbGVcIixcbiAgICBmZ2RiOiBcIkZpbGUgR2VvZGF0YWJhc2VcIixcbiAgICBnZW9qc29uOiBcIkdlb0pzb25cIixcbiAgICBnb29nbGVzaGVldHM6IFwiTWljcm9zb2Z0IEV4Y2VsXCJcbn07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zID0gW1wiemlwXCIsIFwiY3N2XCIsIFwieGxzXCIsIFwieGxzeFwiLCBcImdlb2pzb25cIiwgXCJncGtnXCIsIFwianNvblwiXTtcbmNvbnN0IGFwcGVuZEV4dGVuc2lvbnNGb3JFbnRlcnByaXNlID0gW1wiemlwXCIsIFwiY3N2XCIsIFwieGxzXCIsIFwieGxzeFwiXTtcblxuZXhwb3J0IHsgQXBwZW5kT3ZlcndyaXRlQ2xvdWRQdWJsaXNoVHlwZXMgYXMgQSwgTk9ORV9WQUxVRSBhcyBOLCBhcHBlbmRGaWxlVHlwZXMgYXMgYSwgQXBwZW5kT3ZlcndyaXRlUHVibGlzaFR5cGVzIGFzIGIsIGFwcGVuZEV4dGVuc2lvbnNGb3JFbnRlcnByaXNlIGFzIGMsIGFwcGVuZEV4dGVuc2lvbnMgYXMgZCwgdWlkRmllbGRzIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwZW5kLTRlMTEwMzJjLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IE4gYXMgTk9ORV9WQUxVRSwgdSBhcyB1aWRGaWVsZHMgfSBmcm9tICcuL2FwcGVuZC00ZTExMDMyYy5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0IHsgYyBhcyBjYW5NYXRjaEZpZWxkIH0gZnJvbSAnLi9hcHBlbmQtM2YyNjRkNTYuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTc0NjM5ZGFlLmpzJztcbmltcG9ydCAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kS2V5UGFpclNlbGVjdENzcyA9IFwiLnRpbWV6b25lLXdyYXBwZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpO3BhZGRpbmctbGVmdDoxcmVtfS50aW1lem9uZXttYXJnaW4tYm90dG9tOjAuNzVyZW07bWFyZ2luLWlubGluZS1lbmQ6Mi41cmVtO2Rpc3BsYXk6YmxvY2t9LnRpbWV6b25lLWhlYWRlcntmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRLZXlQYWlyU2VsZWN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVByZXZQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtUHJldlBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVUaW1lem9uZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRpbWV6b25lID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUtleVBhaXJDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRLZXlQYWlyID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRLZXlQYWlyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkVGltZXpvbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub2lkRmllbGRTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBoYW5kbGVOZXh0KCkge1xuICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiAhPT0gXCJhZGRcIikge1xuICAgICAgICAgICAgaWYgKE9iamVjdC52YWx1ZXModGhpcy5zZWxlY3RlZEtleVBhaXIpLmluY2x1ZGVzKE5PTkVfVkFMVUUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IHsgdGl0bGU6IHVpU3RvcmVTdGF0ZS5pMThuLmVycm9yLCBtZXNzYWdlOiB0aGlzLmkxOG4ubm9LZXlQYWlyIH07IC8vS2V5IHBhaXIgbXVzdCBiZSBzZWxlY3RlZCB0byB1cGRhdGUgZGF0YS5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudWlkUGFpciA9IHRoaXMuc2VsZWN0ZWRLZXlQYWlyO1xuICAgICAgICB9XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50aW1lem9uZSA9IHRoaXMuc2VsZWN0ZWRUaW1lem9uZTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiYXBwZW5kTWF0Y2hGaWVsZHNcIik7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVByZXYoZXZlbnQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoISgoKF9hID0gYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAxKSkge1xuICAgICAgICAgICAgLy9pdGVtIGlzIGRlbGV0ZWQgb24gYXBwZW5kU2VsZWN0TGF5ZXJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudWlkUGFpciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBleGlzdGluZ0l0ZW0sIGRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlLCBvcmlnaW5hbEZpbGVOYW1lIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZEtleVZhbHVlUGFpcjtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTGF5ZXIgPSBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyO1xuICAgICAgICB0aGlzLnNlbGVjdGVkVGltZXpvbmUgPSAoX2EgPSBhZGRJdGVtU3RhdGUudGltZXpvbmUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiVVRDXCI7XG4gICAgICAgIHRoaXMudGltZXpvbmVEZXNjcmlwdGlvbiA9IHRoaXMuaTE4bi50aW1lem9uZURlc2NyaXB0aW9uXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7dXBsb2FkZWRGaWxlTmFtZX1cIiwgb3JpZ2luYWxGaWxlTmFtZSlcbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHtmZWF0dXJlTGF5ZXJOYW1lfVwiLCBleGlzdGluZ0l0ZW0udGl0bGUpXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7ZmVhdHVyZUxheWVyVGltZXpvbmV9XCIsIGRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlLnRpbWVab25lKTtcbiAgICAgICAgdGhpcy5pc0VudGVycHJpc2UgPSBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWw7XG4gICAgICAgIHRoaXMuZmluZEtleVBhaXJzKCk7XG4gICAgfVxuICAgIGZpbmRLZXlQYWlycygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBrZXlQYWlycyA9IHt9O1xuICAgICAgICBjb25zdCBzZXJ2aWNlTGF5ZXJGaWVsZHMgPSB0aGlzLnNlcnZpY2VMYXllci5maWVsZHMgfHwgW107XG4gICAgICAgIGNvbnN0IGluZGV4ZXMgPSB0aGlzLnNlcnZpY2VMYXllci5pbmRleGVzIHx8IFtdO1xuICAgICAgICBjb25zdCBkYXRhTGF5ZXJGaWVsZHMgPSBhZGRJdGVtU3RhdGUuYmFja3VwTGF5ZXJGaWVsZHM7XG4gICAgICAgIGluZGV4ZXNcbiAgICAgICAgICAgIC5maWx0ZXIoKGlkeCkgPT4gaWR4ID09PSBudWxsIHx8IGlkeCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWR4LmlzVW5pcXVlKVxuICAgICAgICAgICAgLmZvckVhY2goKGluZGV4KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoKChfYSA9IGluZGV4LmZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNwbGl0KFwiLFwiKSkgfHwgW10pLmZvckVhY2goKGZpZWxkTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIHNlcnZpY2VMYXllckZpZWxkcy5zb21lKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQubmFtZS50b0xvd2VyQ2FzZSgpID09PSBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuaXNVbmlxdWVJbmRleCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlcnZpY2VVSURGaWVsZHMgPSBzZXJ2aWNlTGF5ZXJGaWVsZHNcbiAgICAgICAgICAgIC5maWx0ZXIoKGZpZWxkKSA9PiAoZmllbGQudHlwZSAmJiB1aWRGaWVsZHMuaW5jbHVkZXMoZmllbGQudHlwZSkpIHx8IGZpZWxkLmlzVW5pcXVlSW5kZXgpXG4gICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSk7XG4gICAgICAgIC8vR2VuZXJhdGUgbWF0Y2hlZCBmaWVsZHMgd2l0aCBzZXJ2aWNlTWF0Y2hGaWVsZHNcbiAgICAgICAgdGhpcy5zZXJ2aWNlVUlERmllbGRzLmZvckVhY2goKHNlcnZpY2VGaWVsZEluZm8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICAgICAgICAgIGRhdGFMYXllckZpZWxkcy5mb3JFYWNoKChkYXRhRmllbGRJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbk1hdGNoRmllbGQoc2VydmljZUZpZWxkSW5mbywgZGF0YUZpZWxkSW5mbykpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKGRhdGFGaWVsZEluZm8ubmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBrZXlQYWlyc1tzZXJ2aWNlRmllbGRJbmZvLm5hbWVdID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHNlcnZpY2VGaWVsZEluZm8ubmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBzZXJ2aWNlRmllbGRJbmZvLnR5cGUsXG4gICAgICAgICAgICAgICAgaWR4OiAwLFxuICAgICAgICAgICAgICAgIGlzVW5pcXVlSW5kZXg6IHNlcnZpY2VGaWVsZEluZm8gPT09IG51bGwgfHwgc2VydmljZUZpZWxkSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZUZpZWxkSW5mby5pc1VuaXF1ZUluZGV4LFxuICAgICAgICAgICAgICAgIHBvc3NpYmxlTWF0Y2hlczogW05PTkVfVkFMVUUsIC4uLm1hdGNoZXNdLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maW5hbEtleVBhaXJzID0gT2JqZWN0LmFzc2lnbih7IFwiPE5vbmU+XCI6IHsgbmFtZTogTk9ORV9WQUxVRSwgdHlwZTogXCJOb25lXCIsIHBvc3NpYmxlTWF0Y2hlczogW05PTkVfVkFMVUVdIH0gfSwga2V5UGFpcnMpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkS2V5UGFpciA9IChfYSA9IGFkZEl0ZW1TdGF0ZS51aWRQYWlyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB0aGlzLmZpbmFsS2V5UGFpcnNbTk9ORV9WQUxVRV07XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlVUlERmllbGRzID0gdGhpcy5zZXJ2aWNlVUlERmllbGRzOyAvL0RvIG5vdCBpbmNsdWRlIHRoZXNlIGZpZWxkcyBpbiBmb2xsb3dpbmcgbWF0Y2gtZmllbGRzIHRhYmxlLlxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IsIGkxOG4sIGlzRW50ZXJwcmlzZSwgdGltZXpvbmVEZXNjcmlwdGlvbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBhZGRBcHBlbmRTZWxlY3RPcHRpb24sIGJhY2t1cExheWVyRmllbGRzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaGVscEJhc2UsIGhlbHBNYXAgfSA9IGNvbmZpZ1N0YXRlLmNvbmZpZztcbiAgICAgICAgY29uc3QgaXNBZGRXb3JrZmxvdyA9IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIjtcbiAgICAgICAgY29uc3QgaGFzRGF0ZSA9IGJhY2t1cExheWVyRmllbGRzID09PSBudWxsIHx8IGJhY2t1cExheWVyRmllbGRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBiYWNrdXBMYXllckZpZWxkcy5zb21lKChmaWVsZCkgPT4gZmllbGQudHlwZSA9PT0gXCJlc3JpRmllbGRUeXBlRGF0ZVwiKTtcbiAgICAgICAgY29uc3Qgb2lkSGVscExpbmsgPSBgJHtoZWxwQmFzZX0ke2hlbHBNYXBbXCIxMjAwMDQ3MTFcIl19YDtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICFpc0FkZFdvcmtmbG93ICYmIChoKFwiYXJjZ2lzLW5ldy1pdGVtLWFwcGVuZC1rZXktdmFsdWUtcGFpclwiLCB7IGNsYXNzOiBcImtleS12YWx1ZS1wYWlyXCIsIGtleVBhaXJzOiB0aGlzLmZpbmFsS2V5UGFpcnMsIG9uS2V5UGFpckNoYW5nZTogdGhpcy5oYW5kbGVLZXlQYWlyQ2hhbmdlIH0pKSwgaGFzRGF0ZSAmJiAhaXNFbnRlcnByaXNlICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGltZXpvbmUtaGVhZGVyXCIgfSwgaTE4bi50aW1lem9uZUhlYWRlciksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aW1lem9uZS13cmFwcGVyXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS10aW1lem9uZS1kcm9wZG93blwiLCB7IGNsYXNzOiBcInRpbWV6b25lXCIsIG9uVGltZXpvbmVDaGFuZ2U6IHRoaXMuaGFuZGxlVGltZXpvbmVDaGFuZ2UsIGRlZmF1bHRUaW1lem9uZTogdGhpcy5zZWxlY3RlZFRpbWV6b25lLCBzdWJUaXRsZTogdGltZXpvbmVEZXNjcmlwdGlvbiB9KSkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGFjdGl2ZTogdGhpcy5zZWxlY3RlZEtleVBhaXIudHlwZSA9PT0gXCJlc3JpRmllbGRUeXBlT0lEXCIsIGtpbmQ6IFwid2FybmluZ1wiLCBoZWFkaW5nOiBpMThuLmxlYXJuTW9yZVVJRFRpdGxlLCBsaW5rOiB7IGhyZWY6IG9pZEhlbHBMaW5rLCB0aXRsZTogaTE4bi5sZWFybk1vcmVVSURMaW5rIH0gfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBoZWFkaW5nOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IudGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSwgYWN0aXZlOiAhIWVycm9yLCBraW5kOiBcImRhbmdlclwiLCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9KSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kS2V5UGFpclNlbGVjdC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZEtleVBhaXJTZWxlY3RDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZEtleVBhaXJTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGVuZF9rZXlfcGFpcl9zZWxlY3QgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1rZXktcGFpci1zZWxlY3QuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmZ1bmN0aW9uIGlzRXNyaShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSBpdGVtLm93bmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImVzcmlcIikpO1xufVxuZnVuY3Rpb24gaXNQcmVtaXVtKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgQ3JlZGl0c1wiKSk7XG59XG5mdW5jdGlvbiBpc1N1YnNjcmliZXIoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gaXNFc3JpKGl0ZW0pICYmICEhKChfYSA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJSZXF1aXJlcyBTdWJzY3JpcHRpb25cIikpO1xufVxuZnVuY3Rpb24gaXNPd25lcihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGl0ZW0ub3duZXIgPT09IHVzZXIudXNlcm5hbWU7XG59XG4vKipcbiAqIENhbiB0aGUgdXNlciB1cGRhdGUgdGhlIGl0ZW1cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlSXRlbShpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB8fCBpdGVtLml0ZW1Db250cm9sID09PSBcInVwZGF0ZVwiO1xufVxuLyoqXG4gKiBJcyB0aGUgdXNlciBlaXRoZXIgYW4gb3duZXIgb3IgYWRtaW4gb2YgdGhlIGl0ZW1cbiAqL1xuZnVuY3Rpb24gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gaXNPd25lcihpdGVtLCB1c2VyKSB8fCBpc0l0ZW1BZG1pbihpdGVtLCB1c2VyKTtcbn1cbi8qKlxuICogRG9lcyB0aGUgdXNlciBoYXZlIGFkbWluIGNhcGFiaWxpdGllcyBvbiB0aGlzIGl0ZW1cbiAqL1xuZnVuY3Rpb24gaXNJdGVtQWRtaW4oaXRlbSwgdXNlcikge1xuICAgIHZhciBfYTtcbiAgICAvLyBpZiB0aGlzIGZsYWcgaXMgYWxyZWFkeSBzZXQgKHByb2JhYmx5IGhvbWUgYXBwKSwgdXNlIGl0XG4gICAgaWYgKGl0ZW0uaXNBZG1pbiAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiAhIWl0ZW0uaXNBZG1pbjtcbiAgICB9XG4gICAgY29uc3QgaXRlbU93bmVyID0gaXRlbS5vd25lcjtcbiAgICBjb25zdCBpdGVtQ29udHJvbEFkbWluID0gaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJhZG1pblwiO1xuICAgIGNvbnN0IGVzcmlVc2VycyA9IFtcImVzcmlfbGl2aW5nYXRsYXNcIiwgXCJlc3JpX2RlbW9ncmFwaGljc1wiLCBcImVzcmlfYm91bmRhcmllc1wiXTtcbiAgICBpZiAoKChfYSA9IGl0ZW0ucG9ydGFsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQb3J0YWwpICYmXG4gICAgICAgICFpc093bmVyKGl0ZW0sIHVzZXIpICYmXG4gICAgICAgIGl0ZW1Db250cm9sQWRtaW4gJiZcbiAgICAgICAgaXRlbU93bmVyLmluY2x1ZGVzKFwiZXNyaV9cIikgJiZcbiAgICAgICAgLy8gcG9ydGFsIGluY29ycmVjdGx5IHJldHVybnMgXCJpdGVtQ29udHJvbD1cImFkbWluXCIgZm9yIGVzcmkgb3duZWQgaXRlbXNcbiAgICAgICAgIWVzcmlVc2Vycy5pbmNsdWRlcyhpdGVtT3duZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1Db250cm9sQWRtaW47XG59XG5jb25zdCBpdGVtc0JlbG9uZ1RvVXNlck9yZyA9IChpdGVtcywgdXNlcikgPT4ge1xuICAgIHJldHVybiAhIXVzZXIub3JnSWQgJiYgaXRlbXMuZXZlcnkoKGl0ZW0pID0+IGl0ZW0uaXNPcmdJdGVtKTtcbn07XG5jb25zdCBnZXRJdGVtSG9tZUFwcFVybCA9IChpdGVtSWQsIGJhc2VVcmwpID0+IGAke2FkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcoYmFzZVVybCl9aXRlbS5odG1sP2lkPSR7aXRlbUlkfWA7XG5cbmV4cG9ydCB7IGlzU3Vic2NyaWJlciBhcyBhLCBpc1ByZW1pdW0gYXMgYiwgY2FuVXBkYXRlSXRlbSBhcyBjLCBpdGVtc0JlbG9uZ1RvVXNlck9yZyBhcyBkLCBnZXRJdGVtSG9tZUFwcFVybCBhcyBnLCBpc093bmVyIGFzIGksIHVzZXJJc0l0ZW1BZG1pbiBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWl0ZW0tMzUzNTU1MmQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IHVpU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gICAgbmV4dFRleHQ6IFwibmV4dFwiLFxuICAgIHdvcmtmbG93OiBcImNvbnRlbnRcIixcbiAgICBzY2FsZTogXCJtXCIsXG4gICAgZGlzYWJsZVNjcm9sbDogZmFsc2UsXG4gICAgZmVhdHVyZUZsYWdzOiB7fVxufSk7XG5jb25zdCB1aVN0b3JlU3RhdGUgPSB1aVN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyB1aVN0b3JlIGFzIGEsIHVpU3RvcmVTdGF0ZSBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVpLWJjYTdiY2QxLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==