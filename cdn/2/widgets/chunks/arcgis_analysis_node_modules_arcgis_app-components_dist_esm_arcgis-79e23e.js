"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-79e23e"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-un-ntc-pick-list_2.entry.js":
/*!****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-un-ntc-pick-list_2.entry.js ***!
  \****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_un_ntc_pick_list: () => (/* binding */ ArcgisUnNtcPickList),
/* harmony export */   arcgis_un_ntc_pick_list_info: () => (/* binding */ ArcgisUnNtcPickListInfo)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






var ntcLastSortBy;
(function (ntcLastSortBy) {
    ntcLastSortBy["default"] = "default";
    ntcLastSortBy["title"] = "title";
    ntcLastSortBy["type"] = "type";
    ntcLastSortBy["description"] = "description";
})(ntcLastSortBy || (ntcLastSortBy = {}));

const arcgisUnNtcPickListCss = ".popover{z-index:100}.panel{min-height:300px}.label{height:-webkit-fill-available;width:-webkit-fill-available;padding:10px}.selection-button-div{padding:4px 10px}.content{max-height:60vh}";

const ArcgisUnNtcPickList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisNtcPickListChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisNtcPickListChange", 7);
        this.arcgisNtcPickListDismissed = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisNtcPickListDismissed", 7);
        this.arcgisNtcPickListSortByChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisNtcPickListSortByChange", 7);
        this.errorMessage = "";
        this.namedTraceConfigurationsInfo = [];
        this.calciteValueList = (ntc) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { key: ntc.id, label: ntc.title, description: ntc.description, value: ntc.id, selected: this.selectedNTCs.indexOf(ntc.id) > -1, metadata: {
                id: ntc.id,
                title: ntc.title
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: this.strings.info, title: this.strings.info, scale: "s", icon: "information", onClick: (event) => {
                event.stopPropagation();
                const ntcFlowItemElementInfo = document.createElement("calcite-flow-item");
                ntcFlowItemElementInfo.heading = ntc.title;
                ntcFlowItemElementInfo.description = ntc.description;
                const ntcInfo = document.createElement("arcgis-un-ntc-pick-list-info");
                ntcInfo.utilityNetwork = this.utilityNetwork;
                ntcInfo.ntcId = ntc.id;
                ntcInfo.strings = this.strings;
                ntcInfo.classList.add("content");
                ntcFlowItemElementInfo.appendChild(ntcInfo);
                this.flowElement.appendChild(ntcFlowItemElementInfo);
                ntcFlowItemElementInfo.setFocus();
            } })));
        this.filterPlaceholderText = undefined;
        this.multiple = true;
        this.popoverProps = undefined;
        this.selectedNTCs = [];
        this.showFilterLength = 10;
        this.showSort = true;
        this.sortBy = ntcLastSortBy.default;
        this.utilityNetwork = undefined;
        this.lastSortyBy = ntcLastSortBy.default;
        this.filterNTCs = null;
        this.isOpen = false;
    }
    // --------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    // --------------------------------------------------------------------------
    async componentWillLoad() {
        await this.loadAllModules();
        const localeSettings = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.hostElement);
        this.strings = localeSettings[0];
        this.currentLanguage = localeSettings[1];
        this.lastSortyBy = this.sortBy || this.lastSortyBy;
        try {
            this.namedTraceConfigurations = await this.utilityNetwork.queryNamedTraceConfigurations();
            this.namedTraceConfigurations.forEach((ntc) => {
                this.namedTraceConfigurationsInfo.push({
                    id: ntc.globalId,
                    creationDate: ntc.creationDate,
                    creator: ntc.creator,
                    description: ntc.description,
                    minStartingPoints: ntc.minStartingPoints,
                    resultTypes: ntc.resultTypes,
                    tags: ntc.tags,
                    title: ntc.title,
                    type: ntc.traceType
                });
            });
            this.utilityNetwork.sharedNamedTraceConfigurations.forEach((ntc) => {
                this.selectedNTCs.push(ntc.globalId);
            });
        }
        catch (error) {
            this.errorMessage = error.message;
        }
    }
    componentDidLoad() {
        this.isOpen = true;
    }
    // temp: https://github.com/Esri/calcite-components/issues/4333
    calciteFilterChangeHandler(event) {
        var _a, _b;
        event.stopPropagation();
        const filterNode = (_a = event === null || event === void 0 ? void 0 : event.path) === null || _a === void 0 ? void 0 : _a.find((item) => item.nodeName === "CALCITE-FILTER");
        this.filterNTCs = (_b = filterNode === null || filterNode === void 0 ? void 0 : filterNode.filteredItems) === null || _b === void 0 ? void 0 : _b.map((item) => {
            return item.value;
        });
    }
    // --------------------------------------------------------------------------
    //
    // Public Methods
    //
    // --------------------------------------------------------------------------
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    // --------------------------------------------------------------------------
    //
    // Private Methods
    //
    // --------------------------------------------------------------------------
    getSortedList() {
        const tempSorted = [...this.namedTraceConfigurationsInfo];
        if (this.lastSortyBy === ntcLastSortBy.title) {
            tempSorted.sort((a, b) => a.title.localeCompare(b.title));
        }
        else if (this.lastSortyBy === ntcLastSortBy.description) {
            tempSorted.sort((a, b) => a.description.localeCompare(b.description));
        }
        if (this.lastSortyBy === ntcLastSortBy.type) {
            tempSorted.sort((a, b) => a.type.localeCompare(b.type));
        }
        return tempSorted;
    }
    // return true for deselect all, false for select all
    selectDeselect() {
        var _a;
        return ((_a = this.filterNTCs) === null || _a === void 0 ? void 0 : _a.length)
            ? this.filterContainsAll()
            : this.selectedNTCs.length === this.namedTraceConfigurationsInfo.length;
    }
    // check if filter has all current NTC info
    filterContainsAll() {
        return this.filterNTCs.every((filter) => {
            return this.selectedNTCs.some((curr) => {
                return curr === filter;
            });
        });
    }
    async loadAllModules() {
        const [NamedTraceConfiguration] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__.l)([
            "esri/networks/support/NamedTraceConfiguration"
        ]);
        this.NamedTraceConfiguration = NamedTraceConfiguration;
    }
    // --------------------------------------------------------------------------
    //
    // Render  Methods
    //
    // --------------------------------------------------------------------------
    render() {
        var _a;
        const { NamedTraceConfiguration } = this;
        const sort = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { slot: "menu-actions", placement: "bottom-end" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "trigger", text: this.strings.sort, title: this.strings.sort }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "sortDescending" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === ntcLastSortBy.default, onClick: () => {
                this.lastSortyBy = ntcLastSortBy.default;
                this.arcgisNtcPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.default), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === ntcLastSortBy.title, onClick: () => {
                this.lastSortyBy = ntcLastSortBy.title;
                this.arcgisNtcPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.name), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === ntcLastSortBy.type, onClick: () => {
                this.lastSortyBy = ntcLastSortBy.type;
                this.arcgisNtcPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.type), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === ntcLastSortBy.description, onClick: () => {
                this.lastSortyBy = ntcLastSortBy.description;
                this.arcgisNtcPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.description))));
        const selectionButton = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "selection-button-div" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", scale: "s", width: "full", onClick: () => {
                var _a, _b;
                if (this.selectDeselect()) {
                    //deselect all
                    this.selectedNTCs = ((_a = this.filterNTCs) === null || _a === void 0 ? void 0 : _a.length)
                        ? this.selectedNTCs.filter((item) => !this.filterNTCs.includes(item))
                        : [];
                }
                else {
                    //select all
                    this.selectedNTCs = ((_b = this.filterNTCs) === null || _b === void 0 ? void 0 : _b.length)
                        ? [...new Set([...this.selectedNTCs, ...this.filterNTCs])]
                        : this.namedTraceConfigurationsInfo.map((ntc) => {
                            return ntc.id;
                        });
                }
            } }, this.selectDeselect() ? this.strings.deselectAll : this.strings.selectAll)));
        const errorLabel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "label" }, this.errorMessage);
        const nctPickList = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { multiple: this.multiple, ref: (node) => {
                this.pickListNode = node;
            }, filterEnabled: this.namedTraceConfigurationsInfo.length >= this.showFilterLength ? true : false, filterPlaceholder: (_a = this.filterPlaceholderText) !== null && _a !== void 0 ? _a : this.strings.filter, onCalciteListChange: async () => {
                // keep original order. Add addional values at the end
                const selectedItems = await this.pickListNode.getSelectedItems();
                this.selectedNTCs = [
                    ...new Set([
                        ...this.selectedNTCs.filter((item) => {
                            return selectedItems.has(item);
                        }),
                        ...selectedItems.keys()
                    ])
                ];
                this.utilityNetwork.sharedNamedTraceConfigurations = [];
                this.selectedNTCs.forEach((ntcId) => {
                    let tmpNamedTraceConfiguration = this.namedTraceConfigurations.find((c) => c.globalId === ntcId);
                    this.utilityNetwork.sharedNamedTraceConfigurations.push(new NamedTraceConfiguration({
                        globalId: tmpNamedTraceConfiguration.globalId,
                        title: tmpNamedTraceConfiguration.title
                    }));
                });
                this.arcgisNtcPickListChange.emit(this.utilityNetwork.sharedNamedTraceConfigurations);
            } }, this.namedTraceConfigurationsInfo.length >= this.showFilterLength && this.showSort && sort, selectionButton, [...this.getSortedList()].map((ntc) => this.calciteValueList(ntc))));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { class: "popover", placement: this.popoverProps.placement || "leading-start", open: this.isOpen, pointerDisabled: true, referenceElement: this.popoverProps.refElement, offsetDistance: this.popoverProps.offsetDistance ||
                -Math.round(this.popoverProps.refElement.getBoundingClientRect().width), offsetSkidding: this.popoverProps.offsetSkidding || 0, label: this.strings.headerSelect, ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (node) => {
                this.flowElement = node;
            }, style: {
                width: `${this.popoverProps.popoverWidth ||
                    this.popoverProps.refElement.getBoundingClientRect().width}px`
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { ref: (el) => (this.flowItemElement = el), class: "panel", heading: this.strings.headerSelect, closable: true, onCalciteFlowItemClose: () => this.arcgisNtcPickListDismissed.emit() }, this.errorMessage !== "" ? errorLabel : nctPickList)))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisUnNtcPickList.style = arcgisUnNtcPickListCss;

/**
 * Returns additional named trace configuration info from utility network
 * @param props - properties containing utility network and named trace configuration globalID
 */
async function getNtcInfo(props) {
    const { utilityNetwork, ntcId } = props;
    let ntcInfo;
    let namedTraceConfigurations = await utilityNetwork.queryNamedTraceConfigurations();
    namedTraceConfigurations
        .filter((ntc) => ntc.globalId === ntcId)
        .forEach((c) => {
        const info = {
            title: c.title,
            description: c.description,
            creator: c.creator,
            creationDate: c.creationDate,
            traceType: c.traceType,
            minimumPoints: c.minStartingPoints,
            resultTypes: c.resultTypes,
            tags: c.tags
        };
        ntcInfo = info;
    });
    return ntcInfo;
}

const arcgisUnNtcPickListInfoCss = ":host{height:100%}.container{padding:6px;background-color:white}.title{font-weight:bold;padding:5px 0}.section{padding:6px 0}";

const CSS = {
    container: "container",
    section: "section",
    title: "title"
};
const ArcgisUnNtcPickListInfo = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this._getResultTypes = (resultTypes) => {
            if (resultTypes.length === 0) {
                return this.strings.ntcNoResultTypes;
            }
            else {
                let arr = [];
                resultTypes.forEach((r) => {
                    arr.push(r["type"]);
                });
                return arr.join(", ");
            }
        };
        this._getTags = (tags) => {
            if (tags.length === 0) {
                return this.strings.ntcNoTags;
            }
            else {
                return tags.join(", ");
            }
        };
        this.utilityNetwork = undefined;
        this.ntcId = undefined;
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Events
    //
    //--------------------------------------------------------------------------
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const { utilityNetwork, ntcId } = this;
        this.props = {
            utilityNetwork,
            ntcId
        };
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/intl"]);
        this.intl = intl;
        // required for initial load
        this.props.ntcInfo = await getNtcInfo(this.props);
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { props } = this;
        const { ntcInfo } = props;
        if (!ntcInfo) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, this.renderNtcCreator(), this.renderNtcCreationDate(), this.renderNtcTraceType(), this.renderNtcMinimumPoints(), this.renderNtcResultTypes(), this.renderNtcTags())));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    renderNtcCreator() {
        const { props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcCreator), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, ntcInfo.creator)));
    }
    renderNtcCreationDate() {
        const { intl, props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcCreationDate), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, intl.formatDate(ntcInfo.creationDate, { dateStyle: "full" }))));
    }
    renderNtcTraceType() {
        const { props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcTraceType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, ntcInfo.traceType)));
    }
    renderNtcMinimumPoints() {
        const { props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcMinPoints), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, ntcInfo.minimumPoints)));
    }
    renderNtcResultTypes() {
        const { props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcResultTypes), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this._getResultTypes(ntcInfo.resultTypes))));
    }
    renderNtcTags() {
        const { props } = this;
        const { ntcInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, this.strings.ntcTags), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this._getTags(ntcInfo.tags))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisUnNtcPickListInfo.style = arcgisUnNtcPickListInfoCss;



//# sourceMappingURL=arcgis-un-ntc-pick-list_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTc5ZTIzZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDaEQ7QUFDUztBQUMzQztBQUNTOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHNDQUFzQzs7QUFFdkMseUNBQXlDLFlBQVksT0FBTyxpQkFBaUIsT0FBTyw4QkFBOEIsNkJBQTZCLGFBQWEsc0JBQXNCLGlCQUFpQixTQUFTLGdCQUFnQjs7QUFFNU47QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHVDQUF1QyxxREFBVztBQUNsRCwwQ0FBMEMscURBQVc7QUFDckQsNkNBQTZDLHFEQUFXO0FBQ3hEO0FBQ0E7QUFDQSwwQ0FBMEMscURBQUMsNkJBQTZCO0FBQ3hFO0FBQ0E7QUFDQSxlQUFlLEVBQUUscURBQUMscUJBQXFCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxzREFBeUI7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FB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REFBaUM7QUFDbEU7QUFDQTtBQUNBLFFBQVEsd0RBQVc7QUFDbkIsZUFBZSx3REFBVztBQUMxQjtBQUNBO0FBQ0EsWUFBWSx3REFBVztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxxREFBWSw4QkFBOEIsY0FBYyxRQUFRLE9BQU87QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixjQUFjLEVBQUUsT0FBTztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsZUFBZSxHQUFHLGtCQUFrQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEU7O0FBRTVFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXVuLW50Yy1waWNrLWxpc3RfMi5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcblxudmFyIG50Y0xhc3RTb3J0Qnk7XG4oZnVuY3Rpb24gKG50Y0xhc3RTb3J0QnkpIHtcbiAgICBudGNMYXN0U29ydEJ5W1wiZGVmYXVsdFwiXSA9IFwiZGVmYXVsdFwiO1xuICAgIG50Y0xhc3RTb3J0QnlbXCJ0aXRsZVwiXSA9IFwidGl0bGVcIjtcbiAgICBudGNMYXN0U29ydEJ5W1widHlwZVwiXSA9IFwidHlwZVwiO1xuICAgIG50Y0xhc3RTb3J0QnlbXCJkZXNjcmlwdGlvblwiXSA9IFwiZGVzY3JpcHRpb25cIjtcbn0pKG50Y0xhc3RTb3J0QnkgfHwgKG50Y0xhc3RTb3J0QnkgPSB7fSkpO1xuXG5jb25zdCBhcmNnaXNVbk50Y1BpY2tMaXN0Q3NzID0gXCIucG9wb3Zlcnt6LWluZGV4OjEwMH0ucGFuZWx7bWluLWhlaWdodDozMDBweH0ubGFiZWx7aGVpZ2h0Oi13ZWJraXQtZmlsbC1hdmFpbGFibGU7d2lkdGg6LXdlYmtpdC1maWxsLWF2YWlsYWJsZTtwYWRkaW5nOjEwcHh9LnNlbGVjdGlvbi1idXR0b24tZGl2e3BhZGRpbmc6NHB4IDEwcHh9LmNvbnRlbnR7bWF4LWhlaWdodDo2MHZofVwiO1xuXG5jb25zdCBBcmNnaXNVbk50Y1BpY2tMaXN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNOdGNQaWNrTGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzTnRjUGlja0xpc3RDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTnRjUGlja0xpc3REaXNtaXNzZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc050Y1BpY2tMaXN0RGlzbWlzc2VkXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc050Y1BpY2tMaXN0U29ydEJ5Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNOdGNQaWNrTGlzdFNvcnRCeUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0aGlzLm5hbWVkVHJhY2VDb25maWd1cmF0aW9uc0luZm8gPSBbXTtcbiAgICAgICAgdGhpcy5jYWxjaXRlVmFsdWVMaXN0ID0gKG50YykgPT4gKGgoXCJjYWxjaXRlLXBpY2stbGlzdC1pdGVtXCIsIHsga2V5OiBudGMuaWQsIGxhYmVsOiBudGMudGl0bGUsIGRlc2NyaXB0aW9uOiBudGMuZGVzY3JpcHRpb24sIHZhbHVlOiBudGMuaWQsIHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkTlRDcy5pbmRleE9mKG50Yy5pZCkgPiAtMSwgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBpZDogbnRjLmlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBudGMudGl0bGVcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2xvdDogXCJhY3Rpb25zLWVuZFwiLCB0ZXh0OiB0aGlzLnN0cmluZ3MuaW5mbywgdGl0bGU6IHRoaXMuc3RyaW5ncy5pbmZvLCBzY2FsZTogXCJzXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbnRjRmxvd0l0ZW1FbGVtZW50SW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICAgICAgICAgICAgICBudGNGbG93SXRlbUVsZW1lbnRJbmZvLmhlYWRpbmcgPSBudGMudGl0bGU7XG4gICAgICAgICAgICAgICAgbnRjRmxvd0l0ZW1FbGVtZW50SW5mby5kZXNjcmlwdGlvbiA9IG50Yy5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBudGNJbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy11bi1udGMtcGljay1saXN0LWluZm9cIik7XG4gICAgICAgICAgICAgICAgbnRjSW5mby51dGlsaXR5TmV0d29yayA9IHRoaXMudXRpbGl0eU5ldHdvcms7XG4gICAgICAgICAgICAgICAgbnRjSW5mby5udGNJZCA9IG50Yy5pZDtcbiAgICAgICAgICAgICAgICBudGNJbmZvLnN0cmluZ3MgPSB0aGlzLnN0cmluZ3M7XG4gICAgICAgICAgICAgICAgbnRjSW5mby5jbGFzc0xpc3QuYWRkKFwiY29udGVudFwiKTtcbiAgICAgICAgICAgICAgICBudGNGbG93SXRlbUVsZW1lbnRJbmZvLmFwcGVuZENoaWxkKG50Y0luZm8pO1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvd0VsZW1lbnQuYXBwZW5kQ2hpbGQobnRjRmxvd0l0ZW1FbGVtZW50SW5mbyk7XG4gICAgICAgICAgICAgICAgbnRjRmxvd0l0ZW1FbGVtZW50SW5mby5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICB0aGlzLmZpbHRlclBsYWNlaG9sZGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tdWx0aXBsZSA9IHRydWU7XG4gICAgICAgIHRoaXMucG9wb3ZlclByb3BzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTlRDcyA9IFtdO1xuICAgICAgICB0aGlzLnNob3dGaWx0ZXJMZW5ndGggPSAxMDtcbiAgICAgICAgdGhpcy5zaG93U29ydCA9IHRydWU7XG4gICAgICAgIHRoaXMuc29ydEJ5ID0gbnRjTGFzdFNvcnRCeS5kZWZhdWx0O1xuICAgICAgICB0aGlzLnV0aWxpdHlOZXR3b3JrID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gbnRjTGFzdFNvcnRCeS5kZWZhdWx0O1xuICAgICAgICB0aGlzLmZpbHRlck5UQ3MgPSBudWxsO1xuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkQWxsTW9kdWxlcygpO1xuICAgICAgICBjb25zdCBsb2NhbGVTZXR0aW5ncyA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IGxvY2FsZVNldHRpbmdzWzBdO1xuICAgICAgICB0aGlzLmN1cnJlbnRMYW5ndWFnZSA9IGxvY2FsZVNldHRpbmdzWzFdO1xuICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gdGhpcy5zb3J0QnkgfHwgdGhpcy5sYXN0U29ydHlCeTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMubmFtZWRUcmFjZUNvbmZpZ3VyYXRpb25zID0gYXdhaXQgdGhpcy51dGlsaXR5TmV0d29yay5xdWVyeU5hbWVkVHJhY2VDb25maWd1cmF0aW9ucygpO1xuICAgICAgICAgICAgdGhpcy5uYW1lZFRyYWNlQ29uZmlndXJhdGlvbnMuZm9yRWFjaCgobnRjKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5uYW1lZFRyYWNlQ29uZmlndXJhdGlvbnNJbmZvLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogbnRjLmdsb2JhbElkLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGlvbkRhdGU6IG50Yy5jcmVhdGlvbkRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3I6IG50Yy5jcmVhdG9yLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbnRjLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBtaW5TdGFydGluZ1BvaW50czogbnRjLm1pblN0YXJ0aW5nUG9pbnRzLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRUeXBlczogbnRjLnJlc3VsdFR5cGVzLFxuICAgICAgICAgICAgICAgICAgICB0YWdzOiBudGMudGFncyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG50Yy50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbnRjLnRyYWNlVHlwZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnV0aWxpdHlOZXR3b3JrLnNoYXJlZE5hbWVkVHJhY2VDb25maWd1cmF0aW9ucy5mb3JFYWNoKChudGMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTlRDcy5wdXNoKG50Yy5nbG9iYWxJZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgfVxuICAgIC8vIHRlbXA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtY29tcG9uZW50cy9pc3N1ZXMvNDMzM1xuICAgIGNhbGNpdGVGaWx0ZXJDaGFuZ2VIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBmaWx0ZXJOb2RlID0gKF9hID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LnBhdGgpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChpdGVtKSA9PiBpdGVtLm5vZGVOYW1lID09PSBcIkNBTENJVEUtRklMVEVSXCIpO1xuICAgICAgICB0aGlzLmZpbHRlck5UQ3MgPSAoX2IgPSBmaWx0ZXJOb2RlID09PSBudWxsIHx8IGZpbHRlck5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbHRlck5vZGUuZmlsdGVyZWRJdGVtcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGdldFNvcnRlZExpc3QoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBTb3J0ZWQgPSBbLi4udGhpcy5uYW1lZFRyYWNlQ29uZmlndXJhdGlvbnNJbmZvXTtcbiAgICAgICAgaWYgKHRoaXMubGFzdFNvcnR5QnkgPT09IG50Y0xhc3RTb3J0QnkudGl0bGUpIHtcbiAgICAgICAgICAgIHRlbXBTb3J0ZWQuc29ydCgoYSwgYikgPT4gYS50aXRsZS5sb2NhbGVDb21wYXJlKGIudGl0bGUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmxhc3RTb3J0eUJ5ID09PSBudGNMYXN0U29ydEJ5LmRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0ZW1wU29ydGVkLnNvcnQoKGEsIGIpID0+IGEuZGVzY3JpcHRpb24ubG9jYWxlQ29tcGFyZShiLmRlc2NyaXB0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGFzdFNvcnR5QnkgPT09IG50Y0xhc3RTb3J0QnkudHlwZSkge1xuICAgICAgICAgICAgdGVtcFNvcnRlZC5zb3J0KChhLCBiKSA9PiBhLnR5cGUubG9jYWxlQ29tcGFyZShiLnR5cGUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGVtcFNvcnRlZDtcbiAgICB9XG4gICAgLy8gcmV0dXJuIHRydWUgZm9yIGRlc2VsZWN0IGFsbCwgZmFsc2UgZm9yIHNlbGVjdCBhbGxcbiAgICBzZWxlY3REZXNlbGVjdCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKChfYSA9IHRoaXMuZmlsdGVyTlRDcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aClcbiAgICAgICAgICAgID8gdGhpcy5maWx0ZXJDb250YWluc0FsbCgpXG4gICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWROVENzLmxlbmd0aCA9PT0gdGhpcy5uYW1lZFRyYWNlQ29uZmlndXJhdGlvbnNJbmZvLmxlbmd0aDtcbiAgICB9XG4gICAgLy8gY2hlY2sgaWYgZmlsdGVyIGhhcyBhbGwgY3VycmVudCBOVEMgaW5mb1xuICAgIGZpbHRlckNvbnRhaW5zQWxsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJOVENzLmV2ZXJ5KChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkTlRDcy5zb21lKChjdXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGN1cnIgPT09IGZpbHRlcjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgbG9hZEFsbE1vZHVsZXMoKSB7XG4gICAgICAgIGNvbnN0IFtOYW1lZFRyYWNlQ29uZmlndXJhdGlvbl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICAgICAgICBcImVzcmkvbmV0d29ya3Mvc3VwcG9ydC9OYW1lZFRyYWNlQ29uZmlndXJhdGlvblwiXG4gICAgICAgIF0pO1xuICAgICAgICB0aGlzLk5hbWVkVHJhY2VDb25maWd1cmF0aW9uID0gTmFtZWRUcmFjZUNvbmZpZ3VyYXRpb247XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kZXIgIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgTmFtZWRUcmFjZUNvbmZpZ3VyYXRpb24gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNvcnQgPSAoaChcImNhbGNpdGUtZHJvcGRvd25cIiwgeyBzbG90OiBcIm1lbnUtYWN0aW9uc1wiLCBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiIH0sIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNsb3Q6IFwidHJpZ2dlclwiLCB0ZXh0OiB0aGlzLnN0cmluZ3Muc29ydCwgdGl0bGU6IHRoaXMuc3RyaW5ncy5zb3J0IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwic29ydERlc2NlbmRpbmdcIiB9KSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWdyb3VwXCIsIG51bGwsIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogdGhpcy5sYXN0U29ydHlCeSA9PT0gbnRjTGFzdFNvcnRCeS5kZWZhdWx0LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U29ydHlCeSA9IG50Y0xhc3RTb3J0QnkuZGVmYXVsdDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc050Y1BpY2tMaXN0U29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydHlCeSk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy5kZWZhdWx0KSwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IHNlbGVjdGVkOiB0aGlzLmxhc3RTb3J0eUJ5ID09PSBudGNMYXN0U29ydEJ5LnRpdGxlLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U29ydHlCeSA9IG50Y0xhc3RTb3J0QnkudGl0bGU7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNOdGNQaWNrTGlzdFNvcnRCeUNoYW5nZS5lbWl0KHRoaXMubGFzdFNvcnR5QnkpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnN0cmluZ3MubmFtZSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogdGhpcy5sYXN0U29ydHlCeSA9PT0gbnRjTGFzdFNvcnRCeS50eXBlLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U29ydHlCeSA9IG50Y0xhc3RTb3J0QnkudHlwZTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc050Y1BpY2tMaXN0U29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydHlCeSk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy50eXBlKSwgaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IHNlbGVjdGVkOiB0aGlzLmxhc3RTb3J0eUJ5ID09PSBudGNMYXN0U29ydEJ5LmRlc2NyaXB0aW9uLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U29ydHlCeSA9IG50Y0xhc3RTb3J0QnkuZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNOdGNQaWNrTGlzdFNvcnRCeUNoYW5nZS5lbWl0KHRoaXMubGFzdFNvcnR5QnkpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnN0cmluZ3MuZGVzY3JpcHRpb24pKSkpO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25CdXR0b24gPSAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlbGVjdGlvbi1idXR0b24tZGl2XCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0RGVzZWxlY3QoKSkge1xuICAgICAgICAgICAgICAgICAgICAvL2Rlc2VsZWN0IGFsbFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTlRDcyA9ICgoX2EgPSB0aGlzLmZpbHRlck5UQ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuc2VsZWN0ZWROVENzLmZpbHRlcigoaXRlbSkgPT4gIXRoaXMuZmlsdGVyTlRDcy5pbmNsdWRlcyhpdGVtKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL3NlbGVjdCBhbGxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE5UQ3MgPSAoKF9iID0gdGhpcy5maWx0ZXJOVENzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBbLi4ubmV3IFNldChbLi4udGhpcy5zZWxlY3RlZE5UQ3MsIC4uLnRoaXMuZmlsdGVyTlRDc10pXVxuICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLm5hbWVkVHJhY2VDb25maWd1cmF0aW9uc0luZm8ubWFwKChudGMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnRjLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCB0aGlzLnNlbGVjdERlc2VsZWN0KCkgPyB0aGlzLnN0cmluZ3MuZGVzZWxlY3RBbGwgOiB0aGlzLnN0cmluZ3Muc2VsZWN0QWxsKSkpO1xuICAgICAgICBjb25zdCBlcnJvckxhYmVsID0gaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIHRoaXMuZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgY29uc3QgbmN0UGlja0xpc3QgPSAoaChcImNhbGNpdGUtcGljay1saXN0XCIsIHsgbXVsdGlwbGU6IHRoaXMubXVsdGlwbGUsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBpY2tMaXN0Tm9kZSA9IG5vZGU7XG4gICAgICAgICAgICB9LCBmaWx0ZXJFbmFibGVkOiB0aGlzLm5hbWVkVHJhY2VDb25maWd1cmF0aW9uc0luZm8ubGVuZ3RoID49IHRoaXMuc2hvd0ZpbHRlckxlbmd0aCA/IHRydWUgOiBmYWxzZSwgZmlsdGVyUGxhY2Vob2xkZXI6IChfYSA9IHRoaXMuZmlsdGVyUGxhY2Vob2xkZXJUZXh0KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB0aGlzLnN0cmluZ3MuZmlsdGVyLCBvbkNhbGNpdGVMaXN0Q2hhbmdlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8ga2VlcCBvcmlnaW5hbCBvcmRlci4gQWRkIGFkZGlvbmFsIHZhbHVlcyBhdCB0aGUgZW5kXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IGF3YWl0IHRoaXMucGlja0xpc3ROb2RlLmdldFNlbGVjdGVkSXRlbXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTlRDcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgLi4ubmV3IFNldChbXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLnNlbGVjdGVkTlRDcy5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRJdGVtcy5oYXMoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnNlbGVjdGVkSXRlbXMua2V5cygpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB0aGlzLnV0aWxpdHlOZXR3b3JrLnNoYXJlZE5hbWVkVHJhY2VDb25maWd1cmF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWROVENzLmZvckVhY2goKG50Y0lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0bXBOYW1lZFRyYWNlQ29uZmlndXJhdGlvbiA9IHRoaXMubmFtZWRUcmFjZUNvbmZpZ3VyYXRpb25zLmZpbmQoKGMpID0+IGMuZ2xvYmFsSWQgPT09IG50Y0lkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlsaXR5TmV0d29yay5zaGFyZWROYW1lZFRyYWNlQ29uZmlndXJhdGlvbnMucHVzaChuZXcgTmFtZWRUcmFjZUNvbmZpZ3VyYXRpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsSWQ6IHRtcE5hbWVkVHJhY2VDb25maWd1cmF0aW9uLmdsb2JhbElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRtcE5hbWVkVHJhY2VDb25maWd1cmF0aW9uLnRpdGxlXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc050Y1BpY2tMaXN0Q2hhbmdlLmVtaXQodGhpcy51dGlsaXR5TmV0d29yay5zaGFyZWROYW1lZFRyYWNlQ29uZmlndXJhdGlvbnMpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLm5hbWVkVHJhY2VDb25maWd1cmF0aW9uc0luZm8ubGVuZ3RoID49IHRoaXMuc2hvd0ZpbHRlckxlbmd0aCAmJiB0aGlzLnNob3dTb3J0ICYmIHNvcnQsIHNlbGVjdGlvbkJ1dHRvbiwgWy4uLnRoaXMuZ2V0U29ydGVkTGlzdCgpXS5tYXAoKG50YykgPT4gdGhpcy5jYWxjaXRlVmFsdWVMaXN0KG50YykpKSk7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImpzLWFwcC1mbHlvdXRcIiB9LCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgY2xhc3M6IFwicG9wb3ZlclwiLCBwbGFjZW1lbnQ6IHRoaXMucG9wb3ZlclByb3BzLnBsYWNlbWVudCB8fCBcImxlYWRpbmctc3RhcnRcIiwgb3BlbjogdGhpcy5pc09wZW4sIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IHRoaXMucG9wb3ZlclByb3BzLm9mZnNldERpc3RhbmNlIHx8XG4gICAgICAgICAgICAgICAgLU1hdGgucm91bmQodGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksIG9mZnNldFNraWRkaW5nOiB0aGlzLnBvcG92ZXJQcm9wcy5vZmZzZXRTa2lkZGluZyB8fCAwLCBsYWJlbDogdGhpcy5zdHJpbmdzLmhlYWRlclNlbGVjdCwgcmVmOiAobm9kZSkgPT4gKHRoaXMucG9wb3Zlck5vZGUgPSBub2RlKSB9LCBoKFwiY2FsY2l0ZS1mbG93XCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvd0VsZW1lbnQgPSBub2RlO1xuICAgICAgICAgICAgfSwgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogYCR7dGhpcy5wb3BvdmVyUHJvcHMucG9wb3ZlcldpZHRoIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclByb3BzLnJlZkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGh9cHhgXG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5mbG93SXRlbUVsZW1lbnQgPSBlbCksIGNsYXNzOiBcInBhbmVsXCIsIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5oZWFkZXJTZWxlY3QsIGNsb3NhYmxlOiB0cnVlLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoKSA9PiB0aGlzLmFyY2dpc050Y1BpY2tMaXN0RGlzbWlzc2VkLmVtaXQoKSB9LCB0aGlzLmVycm9yTWVzc2FnZSAhPT0gXCJcIiA/IGVycm9yTGFiZWwgOiBuY3RQaWNrTGlzdCkpKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzVW5OdGNQaWNrTGlzdC5zdHlsZSA9IGFyY2dpc1VuTnRjUGlja0xpc3RDc3M7XG5cbi8qKlxuICogUmV0dXJucyBhZGRpdGlvbmFsIG5hbWVkIHRyYWNlIGNvbmZpZ3VyYXRpb24gaW5mbyBmcm9tIHV0aWxpdHkgbmV0d29ya1xuICogQHBhcmFtIHByb3BzIC0gcHJvcGVydGllcyBjb250YWluaW5nIHV0aWxpdHkgbmV0d29yayBhbmQgbmFtZWQgdHJhY2UgY29uZmlndXJhdGlvbiBnbG9iYWxJRFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXROdGNJbmZvKHByb3BzKSB7XG4gICAgY29uc3QgeyB1dGlsaXR5TmV0d29yaywgbnRjSWQgfSA9IHByb3BzO1xuICAgIGxldCBudGNJbmZvO1xuICAgIGxldCBuYW1lZFRyYWNlQ29uZmlndXJhdGlvbnMgPSBhd2FpdCB1dGlsaXR5TmV0d29yay5xdWVyeU5hbWVkVHJhY2VDb25maWd1cmF0aW9ucygpO1xuICAgIG5hbWVkVHJhY2VDb25maWd1cmF0aW9uc1xuICAgICAgICAuZmlsdGVyKChudGMpID0+IG50Yy5nbG9iYWxJZCA9PT0gbnRjSWQpXG4gICAgICAgIC5mb3JFYWNoKChjKSA9PiB7XG4gICAgICAgIGNvbnN0IGluZm8gPSB7XG4gICAgICAgICAgICB0aXRsZTogYy50aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBjLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgY3JlYXRvcjogYy5jcmVhdG9yLFxuICAgICAgICAgICAgY3JlYXRpb25EYXRlOiBjLmNyZWF0aW9uRGF0ZSxcbiAgICAgICAgICAgIHRyYWNlVHlwZTogYy50cmFjZVR5cGUsXG4gICAgICAgICAgICBtaW5pbXVtUG9pbnRzOiBjLm1pblN0YXJ0aW5nUG9pbnRzLFxuICAgICAgICAgICAgcmVzdWx0VHlwZXM6IGMucmVzdWx0VHlwZXMsXG4gICAgICAgICAgICB0YWdzOiBjLnRhZ3NcbiAgICAgICAgfTtcbiAgICAgICAgbnRjSW5mbyA9IGluZm87XG4gICAgfSk7XG4gICAgcmV0dXJuIG50Y0luZm87XG59XG5cbmNvbnN0IGFyY2dpc1VuTnRjUGlja0xpc3RJbmZvQ3NzID0gXCI6aG9zdHtoZWlnaHQ6MTAwJX0uY29udGFpbmVye3BhZGRpbmc6NnB4O2JhY2tncm91bmQtY29sb3I6d2hpdGV9LnRpdGxle2ZvbnQtd2VpZ2h0OmJvbGQ7cGFkZGluZzo1cHggMH0uc2VjdGlvbntwYWRkaW5nOjZweCAwfVwiO1xuXG5jb25zdCBDU1MgPSB7XG4gICAgY29udGFpbmVyOiBcImNvbnRhaW5lclwiLFxuICAgIHNlY3Rpb246IFwic2VjdGlvblwiLFxuICAgIHRpdGxlOiBcInRpdGxlXCJcbn07XG5jb25zdCBBcmNnaXNVbk50Y1BpY2tMaXN0SW5mbyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuX2dldFJlc3VsdFR5cGVzID0gKHJlc3VsdFR5cGVzKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0VHlwZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5udGNOb1Jlc3VsdFR5cGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IGFyciA9IFtdO1xuICAgICAgICAgICAgICAgIHJlc3VsdFR5cGVzLmZvckVhY2goKHIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2gocltcInR5cGVcIl0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnIuam9pbihcIiwgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9nZXRUYWdzID0gKHRhZ3MpID0+IHtcbiAgICAgICAgICAgIGlmICh0YWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MubnRjTm9UYWdzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhZ3Muam9pbihcIiwgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnV0aWxpdHlOZXR3b3JrID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm50Y0lkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBFdmVudHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgdXRpbGl0eU5ldHdvcmssIG50Y0lkIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLnByb3BzID0ge1xuICAgICAgICAgICAgdXRpbGl0eU5ldHdvcmssXG4gICAgICAgICAgICBudGNJZFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICB0aGlzLmludGwgPSBpbnRsO1xuICAgICAgICAvLyByZXF1aXJlZCBmb3IgaW5pdGlhbCBsb2FkXG4gICAgICAgIHRoaXMucHJvcHMubnRjSW5mbyA9IGF3YWl0IGdldE50Y0luZm8odGhpcy5wcm9wcyk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbnRjSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIGlmICghbnRjSW5mbykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmNvbnRhaW5lciB9LCB0aGlzLnJlbmRlck50Y0NyZWF0b3IoKSwgdGhpcy5yZW5kZXJOdGNDcmVhdGlvbkRhdGUoKSwgdGhpcy5yZW5kZXJOdGNUcmFjZVR5cGUoKSwgdGhpcy5yZW5kZXJOdGNNaW5pbXVtUG9pbnRzKCksIHRoaXMucmVuZGVyTnRjUmVzdWx0VHlwZXMoKSwgdGhpcy5yZW5kZXJOdGNUYWdzKCkpKSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlck50Y0NyZWF0b3IoKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbnRjSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCB0aGlzLnN0cmluZ3MubnRjQ3JlYXRvciksIGgoXCJkaXZcIiwgbnVsbCwgbnRjSW5mby5jcmVhdG9yKSkpO1xuICAgIH1cbiAgICByZW5kZXJOdGNDcmVhdGlvbkRhdGUoKSB7XG4gICAgICAgIGNvbnN0IHsgaW50bCwgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbnRjSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCB0aGlzLnN0cmluZ3MubnRjQ3JlYXRpb25EYXRlKSwgaChcImRpdlwiLCBudWxsLCBpbnRsLmZvcm1hdERhdGUobnRjSW5mby5jcmVhdGlvbkRhdGUsIHsgZGF0ZVN0eWxlOiBcImZ1bGxcIiB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTnRjVHJhY2VUeXBlKCkge1xuICAgICAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG50Y0luZm8gfSA9IHByb3BzO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnNlY3Rpb24gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MudGl0bGUgfSwgdGhpcy5zdHJpbmdzLm50Y1RyYWNlVHlwZSksIGgoXCJkaXZcIiwgbnVsbCwgbnRjSW5mby50cmFjZVR5cGUpKSk7XG4gICAgfVxuICAgIHJlbmRlck50Y01pbmltdW1Qb2ludHMoKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbnRjSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCB0aGlzLnN0cmluZ3MubnRjTWluUG9pbnRzKSwgaChcImRpdlwiLCBudWxsLCBudGNJbmZvLm1pbmltdW1Qb2ludHMpKSk7XG4gICAgfVxuICAgIHJlbmRlck50Y1Jlc3VsdFR5cGVzKCkge1xuICAgICAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG50Y0luZm8gfSA9IHByb3BzO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnNlY3Rpb24gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MudGl0bGUgfSwgdGhpcy5zdHJpbmdzLm50Y1Jlc3VsdFR5cGVzKSwgaChcImRpdlwiLCBudWxsLCB0aGlzLl9nZXRSZXN1bHRUeXBlcyhudGNJbmZvLnJlc3VsdFR5cGVzKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTnRjVGFncygpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBudGNJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zZWN0aW9uIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnRpdGxlIH0sIHRoaXMuc3RyaW5ncy5udGNUYWdzKSwgaChcImRpdlwiLCBudWxsLCB0aGlzLl9nZXRUYWdzKG50Y0luZm8udGFncykpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNVbk50Y1BpY2tMaXN0SW5mby5zdHlsZSA9IGFyY2dpc1VuTnRjUGlja0xpc3RJbmZvQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNVbk50Y1BpY2tMaXN0IGFzIGFyY2dpc191bl9udGNfcGlja19saXN0LCBBcmNnaXNVbk50Y1BpY2tMaXN0SW5mbyBhcyBhcmNnaXNfdW5fbnRjX3BpY2tfbGlzdF9pbmZvIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy11bi1udGMtcGljay1saXN0XzIuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgICBbXCJhclwiLCBcImFyXCJdLFxuICAgIFtcImJnXCIsIFwiYmdcIl0sXG4gICAgW1wiYnNcIiwgXCJic1wiXSxcbiAgICBbXCJjYVwiLCBcImNhXCJdLFxuICAgIFtcImNzXCIsIFwiY3NcIl0sXG4gICAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgICBbXCJkZVwiLCBcImRlXCJdLFxuICAgIFtcImVsXCIsIFwiZWxcIl0sXG4gICAgW1wiZW5cIiwgXCJlblwiXSxcbiAgICBbXCJlc1wiLCBcImVzXCJdLFxuICAgIFtcImV0XCIsIFwiZXRcIl0sXG4gICAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgICBbXCJmclwiLCBcImZyXCJdLFxuICAgIFtcImhlXCIsIFwiaGVcIl0sXG4gICAgW1wiaHJcIiwgXCJoclwiXSxcbiAgICBbXCJodVwiLCBcImh1XCJdLFxuICAgIFtcImlkXCIsIFwiaWRcIl0sXG4gICAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgICBbXCJqYVwiLCBcImphXCJdLFxuICAgIFtcImtvXCIsIFwia29cIl0sXG4gICAgW1wibHRcIiwgXCJsdFwiXSxcbiAgICBbXCJsdlwiLCBcImx2XCJdLFxuICAgIFtcIm5iXCIsIFwibmJcIl0sXG4gICAgW1wibmxcIiwgXCJubFwiXSxcbiAgICBbXCJwbFwiLCBcInBsXCJdLFxuICAgIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gICAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgICBbXCJyb1wiLCBcInJvXCJdLFxuICAgIFtcInJ1XCIsIFwicnVcIl0sXG4gICAgW1wic2tcIiwgXCJza1wiXSxcbiAgICBbXCJzbFwiLCBcInNsXCJdLFxuICAgIFtcInNyXCIsIFwic3JcIl0sXG4gICAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgICBbXCJ0aFwiLCBcInRoXCJdLFxuICAgIFtcInRyXCIsIFwidHJcIl0sXG4gICAgW1widWtcIiwgXCJ1a1wiXSxcbiAgICBbXCJ2aVwiLCBcInZpXCJdLFxuICAgIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gICAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICAgIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmIChhcGkgPT09IDQpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgICAgICAgIHBsYWNlcyxcbiAgICAgICAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgICB9XG4gICAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICAgIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcGxhY2VzLFxuICAgICAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICAgIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICAgIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgICAgIGRheTogXCJudW1lcmljXCJcbiAgICB9O1xuICAgIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICAgICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuZnVuY3Rpb24gZm9ybWF0UGx1cmFsKGxhbmcsIHN0cmluZ09iaiwgbnVtYmVyKSB7XG4gICAgY29uc3Qgc2luZ2xlcyA9IFtcImlkXCIsIFwiamFcIiwgXCJrb1wiLCBcInRoXCIsIFwidmlcIiwgXCJ6aC1jblwiLCBcInpoLWhrXCIsIFwiemgtdHdcIl07XG4gICAgY29uc3QgbGlrZUVuZ2xpc2ggPSBbXG4gICAgICAgIFwiZW5cIixcbiAgICAgICAgXCJjYVwiLFxuICAgICAgICBcImRhXCIsXG4gICAgICAgIFwiZGVcIixcbiAgICAgICAgXCJlbFwiLFxuICAgICAgICBcImVzXCIsXG4gICAgICAgIFwiZXRcIixcbiAgICAgICAgXCJmaVwiLFxuICAgICAgICBcImhpXCIsXG4gICAgICAgIFwiaHVcIixcbiAgICAgICAgXCJpdFwiLFxuICAgICAgICBcIm5iXCIsXG4gICAgICAgIFwibmxcIixcbiAgICAgICAgXCJwdC1wdFwiLFxuICAgICAgICBcInN2XCIsXG4gICAgICAgIFwidHJcIlxuICAgIF07XG4gICAgY29uc3QgbG9jYWxlID0gbGFuZyAhPT0gbnVsbCAmJiBsYW5nICE9PSB2b2lkIDAgPyBsYW5nIDogXCJlblwiO1xuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgb25lLCBvciBpdCBpcyBhIFwic2ltcGxlXCIgbGFuZ3VhZ2UsIHJldHVybiB0aGUgMSBzdHJpbmdcbiAgICBpZiAobnVtYmVyID09PSAxIHx8IHNpbmdsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLnNpbmdsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIFwiMVwiKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBub3QgMSBhbmQgdGhlIGxhbmd1YWdlIHVzZXMgdGhlIHNhbWUgcGx1cmFsaXphdGlvbiBzdHJhdGVneSBhcyBlbmdsaXNoLFxuICAgIC8vIHJldHVybiB0aGUgbXVsdGlwbGUgc3RyaW5nXG4gICAgaWYgKG51bWJlciAhPT0gMSAmJiBsaWtlRW5nbGlzaC5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmoubXVsdGlwbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG4gICAgfVxuICAgIC8vIGlmIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmtlZCwgcmV0dXJuIHRoZSBcInVua25vd25cIiBzdHJpbmdcbiAgICByZXR1cm4gc3RyaW5nT2JqLnVua25vd24ucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0UGx1cmFsIGFzIGIsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gICAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgICAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgICAgICAgIHJldHVybiBsYW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gICAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICAgIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgICBsZXQgc3RyaW5ncztcbiAgICB0cnkge1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gICAgfVxuICAgIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYWxlLTA1MGI2ZGI5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==