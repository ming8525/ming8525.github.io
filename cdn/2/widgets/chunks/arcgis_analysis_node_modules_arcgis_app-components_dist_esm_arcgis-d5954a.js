"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d5954a"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-chart.entry.js":
/*!************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-chart.entry.js ***!
  \************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_chart: () => (/* binding */ ArcgisSmartMappingPanelsChart)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./symbolStyler-04635b2b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolStyler-04635b2b.js");
/* harmony import */ var _chart_097ec280_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./chart-097ec280.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/chart-097ec280.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */















const arcgisSmartMappingPanelsChartCss = ":host{width:100%}.flow-item{height:100%}.chart-block{overflow-x:hidden}.checkbox{margin:6px}.hidden{display:none}.top-grey-border{border-top:1.5px solid #e0e0e0}.top-padding{margin-top:12px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol-icon:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.other-null-list-item{min-height:45px}.other-symbol{margin-left:27px}.null-value-actions{display:contents}.shape-slider{background-color:transparent;position:relative;width:100%;padding:0 4px}.slider-labels{margin-top:10px}.space-between{display:flex;justify-content:space-between}.symbol-icon{width:19px;height:19px;margin:2px}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}";

const ArcgisSmartMappingPanelsChart = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsChartBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartBackClick", 7);
        this.arcgisSmartMappingPanelsChartClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartClose", 7);
        this.arcgisSmartMappingPanelsChartError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsChartError", 7);
        //maps from index to HTMLCalciteInputElement
        this.inputNodes = {};
        //maps from index to HTMLDivElement
        this.labelNodes = {};
        this.popoverSettings = {
            index: null,
            popoverNode: null
        };
        //maps from index to HTMLDivElement
        this.valueSymbolNodes = {};
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle Methods
    //
    //-------------------------------------------------------------------
    componentDidLoad() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin", `<link rel="stylesheet" href="${config.jsapiUrl}/themes/light/main.css" />`);
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    componentWillLoad() {
        var _a, _b, _c;
        const { layer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        if (!renderer.defaultLabel) {
            renderer.defaultLabel = strings.panels.chart.noData;
        }
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.lastDefault = {
            otherColor: (_a = renderer.othersCategory) === null || _a === void 0 ? void 0 : _a.color,
            otherLabel: ((_b = renderer.othersCategory) === null || _b === void 0 ? void 0 : _b.label) || strings.panels.chart.other,
            threshold: (_c = renderer.othersCategory) === null || _c === void 0 ? void 0 : _c.threshold,
            defaultColor: renderer.defaultColor,
            defaultLabel: renderer.defaultLabel
        };
    }
    disconnectedCallback() {
        var _a;
        (_a = this.sizeSliderWatchHandle) === null || _a === void 0 ? void 0 : _a.remove();
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.lastDefault = undefined;
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.selectedAttribute = undefined;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ae)();
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_8__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), heading: strings.panels.styleOptions, description: title, menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsChartBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isSizeChart = rendererType === "chart-size";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "chart-block", heading: isSizeChart ? strings.panels.chart.chartStyleColor : strings.panels.chart.chartStyle, open: true, collapsible: false }, this.renderChartSymbol(), this.renderValues(), this.renderChartSize(), this.renderShape(), this.renderMinSlice(), this.renderBackgroundStyle()));
    }
    renderChartSymbol() {
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const attributes = renderer.attributes;
        const schemes = modules.pieChartSchemes.getSchemes({
            basemap: mapView.map.basemap,
            geometryType: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.D)(layer),
            numColors: attributes.length
        });
        const colorRampsAndSchemes = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a9)(schemes, Math.min(attributes.length, 10));
        const defaultColors = colorRampsAndSchemes[0].colors;
        let colors = (attributes === null || attributes === void 0 ? void 0 : attributes.length)
            ? attributes
                .slice(0, 10)
                .map((attribute, idx) => attribute.color
                ? new modules.esriColor(attribute.color)
                : new modules.esriColor(defaultColors[idx % defaultColors.length]))
            : [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { type: "chart-ramp", colors: colors, rampType: "discrete", onArcgisSmartMappingSymbolButtonSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement) }));
    }
    renderValues() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "top-padding" }, strings.panels.chart.fieldName, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: "top-grey-border" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { "drag-enabled": true, onCalciteListOrderChange: (event) => {
                let items = Array.from(event.target.children);
                this.handleSortLegend(items);
            } }, renderer.attributes.map((attribute, idx) => this.renderValue(attribute, idx))), this.renderOtherValue(), this.renderNullValue())));
    }
    renderValue(attribute, index) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: attribute.field, value: attribute.field }, this.renderSymbolNode(attribute, index), this.renderTextNode(attribute, index)));
    }
    renderSymbolNode(attribute, index) {
        const { layer, mapView, modules, selectedAttribute, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const symbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
        symbol.color = new modules.esriColor(attribute.color);
        symbol.outline = undefined;
        const symbolNodeClasses = {
            "value-symbol": true,
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol)
        };
        const symbolClasses = {
            "symbol-icon": true,
            "selected": selectedAttribute === index
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, slot: "content-start", role: "button", "aria-label": strings.panels.chart.accessibility.editSymbolFor.replace("${value}", attribute.label), "aria-haspopup": "true", "aria-expanded": selectedAttribute === index, onClick: () => this.handleValueSymbolClick(index), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    this.handleValueSymbolClick(index);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolClasses, tabIndex: 0, "aria-hidden": "true", ref: (node) => {
                var _a, _b, _c, _d;
                if (node) {
                    this.valueSymbolNodes[index] = node;
                    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aE)(symbol)) {
                        node.style.backgroundColor = (_b = (_a = symbol.color) === null || _a === void 0 ? void 0 : _a.toHex()) !== null && _b !== void 0 ? _b : "#ffffff";
                        node.style.opacity = (_d = (_c = symbol.color) === null || _c === void 0 ? void 0 : _c.a) !== null && _d !== void 0 ? _d : 0;
                    }
                    else {
                        node.style.backgroundColor = null;
                        node.style.opacity = null;
                    }
                }
            } })));
    }
    renderOtherValue() {
        var _a, _b;
        const { lastDefault, layer, mapView, modules, selectedAttribute, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const defaultColor = ((_a = renderer.othersCategory) === null || _a === void 0 ? void 0 : _a.color) || lastDefault.otherColor;
        const defaultSymbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
        defaultSymbol.color = new modules.esriColor(defaultColor);
        defaultSymbol.outline = undefined;
        const defaultLabel = ((_b = renderer.othersCategory) === null || _b === void 0 ? void 0 : _b.label) || lastDefault.otherLabel;
        const symbolNodeClasses = {
            "other-symbol": true,
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(defaultSymbol)
        };
        const symbolClasses = {
            "symbol-icon": true,
            "selected": selectedAttribute === -1
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "top-grey-border other-null-list-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, slot: "content-start", role: "button", tabIndex: 0, "aria-haspopup": "true", "aria-expanded": selectedAttribute === -1, "aria-label": strings.panels.chart.accessibility.editSymbolFor.replace("${fieldName}", defaultLabel), onClick: () => this.handleValueSymbolClick(-1), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    this.handleValueSymbolClick(-1);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolClasses, tabIndex: 0, "aria-hidden": "true", ref: (node) => {
                var _a, _b, _c, _d;
                if (node) {
                    this.valueSymbolNodes[-1] = node;
                    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aE)(defaultSymbol)) {
                        node.style.backgroundColor = (_b = (_a = defaultSymbol.color) === null || _a === void 0 ? void 0 : _a.toHex()) !== null && _b !== void 0 ? _b : "#ffffff";
                        node.style.opacity = (_d = (_c = defaultSymbol.color) === null || _c === void 0 ? void 0 : _c.a) !== null && _d !== void 0 ? _d : 0;
                    }
                    else {
                        node.style.backgroundColor = null;
                        node.style.opacity = null;
                    }
                }
            } })), this.renderTextNode({
            symbol: defaultSymbol,
            label: defaultLabel
        }, -1)));
    }
    renderTextNode(attribute, index) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": strings.panels.chart.accessibility.editLabelFor.replace("${fieldName}", attribute.label), class: "label text-wrap", slot: "content", tabIndex: 0, onClick: (event) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                event.target.classList.add("hidden");
                this.inputNodes[index].classList.remove("hidden");
                this.inputNodes[index].setFocus();
            }, onKeyDown: (event) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    event.target.classList.add("hidden");
                    this.inputNodes[index].classList.remove("hidden");
                    this.inputNodes[index].setFocus();
                }
            }, ref: (node) => {
                this.labelNodes[index] = node;
            } }, attribute.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: "hidden", slot: "content", tabIndex: 0, value: attribute.label, onFocusout: (event) => {
                const node = event.target;
                this.handleValueTextChange(index, node.value);
            }, onKeyDown: (event) => {
                event.stopPropagation();
                if (event.key === "Escape" || event.key === "Enter") {
                    event.preventDefault();
                    const node = event.currentTarget;
                    this.handleValueTextChange(index, node.value);
                }
            }, ref: (node) => {
                this.inputNodes[index] = node;
            } })));
    }
    renderNullValue() {
        const { lastDefault, layer, mapView, modules, selectedAttribute, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const defaultColor = renderer.defaultColor || lastDefault.defaultColor;
        const defaultSymbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
        defaultSymbol.color = new modules.esriColor(defaultColor);
        defaultSymbol.outline = undefined;
        const defaultLabel = renderer.defaultLabel || lastDefault.defaultLabel;
        const symbolIsTransparent = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aE)(defaultSymbol);
        const symbolNodeClasses = {
            "symbol": true,
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(defaultSymbol)
        };
        const symbolClasses = {
            "symbol-icon": true,
            "selected": selectedAttribute === -2
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "other-null-list-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { disabled: symbolIsTransparent, slot: "actions-start", class: "checkbox", tabIndex: 0, checked: !!renderer.defaultColor && !symbolIsTransparent, onClick: () => this.handleNullValueCheckChange() }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, slot: "content-start", role: "button", tabIndex: 0, "aria-haspopup": "true", "aria-expanded": selectedAttribute === -2, "aria-label": strings.panels.chart.accessibility.editSymbolFor.replace("${fieldName}", defaultLabel), onClick: () => this.handleValueSymbolClick(-2), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    this.handleValueSymbolClick(2);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolClasses, tabIndex: 0, "aria-hidden": "true", ref: (node) => {
                var _a, _b, _c, _d;
                if (node) {
                    this.valueSymbolNodes[-2] = node;
                    if (!symbolIsTransparent) {
                        node.style.backgroundColor = (_b = (_a = defaultSymbol.color) === null || _a === void 0 ? void 0 : _a.toHex()) !== null && _b !== void 0 ? _b : "#ffffff";
                        node.style.opacity = (_d = (_c = defaultSymbol.color) === null || _c === void 0 ? void 0 : _c.a) !== null && _d !== void 0 ? _d : 0;
                    }
                    // need to reset for the transparent symbol css class to apply
                    else {
                        node.style.backgroundColor = null;
                        node.style.opacity = null;
                    }
                }
            } })), this.renderTextNode({
            symbol: defaultSymbol,
            label: defaultLabel
        }, -2)));
    }
    renderChartSize() {
        const { layer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        if (sizeVisVar) {
            return null;
        }
        const autoSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size", "auto"); //value depends on scale of map
        const size = this.getSizeValue();
        // prevent showing rounding issues
        const pxWidth = Math.round(size / 0.75);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.chart.chartSize), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-slider-input", { min: 10, max: 120, values: [pxWidth], precision: 0, suffixText: strings.panels.chart.px, onArcgisSmartMappingSliderInputChange: (event) => this.handleChartSizeChange(event.detail) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s", layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { scale: "s", checked: !!autoSizeVisVar, onCalciteCheckboxChange: (event) => {
                this.handleAutoSizeChange(event.target.checked ? "automatic" : "fixed");
            }, ref: (node) => {
                this.adjustSizeNode = node;
                this.sizeSliderWatchHandle = mapView.watch("scale", (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_7__.d)(() => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement), 100));
            } }), strings.panels.chart.adjustChartSizeAutomatically)));
    }
    renderShape() {
        var _a, _b;
        const { layer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (!this.shapeSlider) {
            const max = Math.max(0.9, renderer.holePercentage);
            const config = {
                min: 0,
                max,
                values: [(_a = renderer.holePercentage) !== null && _a !== void 0 ? _a : 0.5],
                precision: 1
            };
            this.shapeSlider = new modules.Slider(config);
            this.shapeSlider.on("thumb-drag", (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                renderer.holePercentage = event.value;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            });
            this.shapeSlider.on("thumb-change", (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                renderer.holePercentage = event.value;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            });
        }
        else {
            let config = {
                values: [(_b = renderer.holePercentage) !== null && _b !== void 0 ? _b : 0.5]
            };
            this.shapeSlider.set(config);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.chart.shape), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shape-slider slider-bottom-label", ref: (node) => {
                node.style.width = "100%";
                if (this.shapeSlider) {
                    this.shapeSlider.container = node;
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-labels space-between", "aria-hidden": "true" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.chart.pie), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.chart.donut))));
    }
    renderMinSlice() {
        const { isRTL, layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const { threshold = 0.04 } = renderer.othersCategory;
        let isPercentAfter = strings.panels.chart.percentValue.endsWith("%");
        if (isRTL) {
            // it flips it with RTL
            isPercentAfter = !isPercentAfter;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "top-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "space-between" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, strings.panels.chart.grouping), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "information", role: "button", ref: (node) => {
                var _a;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.af)(node, `<div>${strings.panels.chart.groupingInfo.replace("${other}", ((_a = renderer.othersCategory) === null || _a === void 0 ? void 0 : _a.label) || strings.panels.chart.other)}</div>`, false);
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-slider-input", { disabled: !renderer.othersCategory, min: 0, max: 50, values: [Math.round(threshold * 100)], precision: 0, prefixText: !isPercentAfter ? "%" : undefined, suffixText: isPercentAfter ? "%" : undefined, onArcgisSmartMappingSliderInputChange: (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                renderer.othersCategory.threshold = event.detail / 100;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            } })));
    }
    renderBackgroundStyle() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", null);
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: () => this.arcgisSmartMappingPanelsChartClose.emit("save"), appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                const { originalRendererJSON, originalFeatureReduction } = this;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.j)(originalRendererJSON, originalFeatureReduction);
                this.arcgisSmartMappingPanelsChartClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    //-------------------------------------------------------------------
    //
    //  Private Methods
    //
    //-------------------------------------------------------------------
    getSizeByScale(sizeAutoVisVar, scale) {
        const sizeStops = sizeAutoVisVar.stops;
        const stopsCount = sizeStops.length;
        const finalIndex = stopsCount - 1;
        const scaleMin = sizeStops[0].value;
        const scaleMax = sizeStops[finalIndex].value;
        if (scale <= scaleMin) {
            return sizeStops[0].size;
        }
        if (scale >= scaleMax) {
            return sizeStops[finalIndex].size;
        }
        for (let i = 0; i <= finalIndex; i++) {
            const currentStop = sizeStops[i];
            const nextStop = sizeStops[i + 1];
            if (scale >= currentStop.value && scale < nextStop.value) {
                const scaleRange = nextStop.value - currentStop.value;
                const sizeRange = currentStop.size - nextStop.size;
                const relativePosition = (scale - currentStop.value) / scaleRange;
                const effectiveSize = currentStop.size - sizeRange * relativePosition;
                return Math.round(effectiveSize * 100) / 100;
            }
        }
        return 1; // we really don't come here
    }
    /**
     * Get size value of size in current map scale (if applicable)
     */
    getSizeValue() {
        const { mapView, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const sizeAutoVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size", "auto");
        if (sizeAutoVisVar) {
            const mapScale = mapView.scale;
            const stops = sizeAutoVisVar.stops;
            let value = 0;
            let found = false;
            for (let i = 0; i < stops.length; i++) {
                const stop = stops[i];
                if (mapScale <= stop.value) {
                    found = true;
                    if (i > 0) {
                        // interpolate to get correct sizes
                        let lastStop = stops[i - 1];
                        const factor = (mapScale - lastStop.value) / (stop.value - lastStop.value);
                        value = lastStop.size + (stop.size - lastStop.size) * factor;
                    }
                    else {
                        // don't interpolate; use lowest sizes
                        value = stops[0].size;
                    }
                    break;
                }
            }
            if (!found) {
                // take lowest value
                value = stops[stops.length - 1].size;
            }
            return value;
        }
        else {
            return renderer.size;
        }
    }
    handleAutoSizeChange(type) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (type === "fixed") {
            // automatic -> fixed
            // remove visualVariable
            const visVars = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "size", "auto");
            if (visVars === null || visVars === void 0 ? void 0 : visVars.length) {
                renderer.visualVariables = visVars;
            }
            else {
                renderer.visualVariables = undefined;
            }
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        }
        else {
            // fixed -> automatic
            // need to create a new renderer
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_6__.a)({
                sizeOptimizationEnabled: true
            }), this.flowItemNode).then((result) => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            }, (error) => {
                // handles keeping the "adjust size automatically" button unchecked when renderer re-creation occurs
                this.adjustSizeNode.checked = false;
                this.arcgisSmartMappingPanelsChartError.emit(error);
            });
        }
    }
    handleChartSizeChange(value) {
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let newSize = Math.max(value, 0.1);
        const sizeAutoVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size", "auto");
        if (!sizeAutoVisVar) {
            renderer.size = newSize;
        }
        else {
            const oldSize = this.getSizeByScale(sizeAutoVisVar, mapView.scale);
            const factor = newSize / oldSize;
            this.updateAutoSizeStops(sizeAutoVisVar, factor);
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleNullValueCheckChange() {
        const { layer, lastDefault } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (renderer.defaultColor) {
            lastDefault.defaultColor = renderer.defaultColor;
            renderer.defaultColor = undefined;
        }
        else {
            renderer.defaultColor = lastDefault.defaultColor;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleSortLegend(items) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const attributes = renderer.attributes.map((attribute) => {
            return attribute.clone();
        });
        const itemValues = items.map((item) => item.value);
        attributes.sort((a, b) => itemValues.indexOf(a.field) - itemValues.indexOf(b.field));
        renderer.attributes = attributes;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleValueSymbolClick(index) {
        var _a;
        if ((_a = this.popoverSettings) === null || _a === void 0 ? void 0 : _a.popoverNode) {
            this.valueSymbolNodes[index].classList.remove("selected");
            if (this.popoverSettings.index === index) {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                this.popoverSettings.popoverNode = null;
                this.popoverSettings.index = null;
                this.valueSymbolNodes[index].focus();
            }
            else {
                this.popoverSettings.index = index;
                this.openSymbolStylerForValue(index);
            }
        }
        else {
            this.popoverSettings.index = index;
            this.openSymbolStylerForValue(index);
        }
    }
    handleValueTextChange(index, label) {
        var _a, _b;
        const { lastDefault, layer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const originalRenderer = modules.rendererJsonUtils.fromJSON(this.originalRendererJSON);
        this.inputNodes[index].classList.add("hidden");
        if (!label.length) {
            if (index === -1) {
                label = ((_a = originalRenderer.othersCategory) === null || _a === void 0 ? void 0 : _a.label) || strings.panels.chart.other;
            }
            else if (index === -2) {
                label = strings.panels.chart.noData;
            }
            else {
                let matchingInfo = originalRenderer.attributes.find((info) => info.field === renderer.attributes[index].field);
                label = matchingInfo.label;
            }
        }
        if (index === -1) {
            renderer.othersCategory = renderer.othersCategory || {
                color: lastDefault === null || lastDefault === void 0 ? void 0 : lastDefault.otherColor,
                threshold: (_b = lastDefault === null || lastDefault === void 0 ? void 0 : lastDefault.threshold) !== null && _b !== void 0 ? _b : 0
            };
            renderer.othersCategory.label = label;
            lastDefault.otherLabel = label;
        }
        else if (index === -2) {
            renderer.defaultLabel = label;
            lastDefault.defaultLabel = label;
        }
        else {
            renderer.attributes = renderer.attributes.map((attribute, idx2) => {
                if (idx2 === index) {
                    attribute.label = label;
                }
                return attribute;
            });
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        this.labelNodes[index].classList.remove("hidden");
        this.labelNodes[index].innerHTML = label;
        this.inputNodes[index].value = label;
        setTimeout(() => {
            this.labelNodes[index].focus();
        }, 100);
    }
    openSymbolStylerForValue(index) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        this.popoverSettings.popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_5__.c)({
            referenceElement: this.flowItemNode,
            heading: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.strings.styler.symbolStyle
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_5__.r)(this.popoverSettings.popoverNode);
            this.popoverSettings.popoverNode = null;
            this.valueSymbolNodes[index].classList.remove("selected");
            setTimeout(() => {
                this.valueSymbolNodes[index].focus();
            }, 100);
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_5__.r)(this.popoverSettings.popoverNode);
            this.popoverSettings.popoverNode = null;
            this.valueSymbolNodes[index].classList.remove("selected");
        });
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.selectedAttribute = index;
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_5__.a)({
            popoverNode: this.popoverSettings.popoverNode,
            onChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }
        });
        this.valueSymbolNodes[index].classList.add("selected");
    }
    updateAutoSizeStops(sizeAutoVisVar, factor) {
        sizeAutoVisVar.stops.forEach((stop) => {
            stop.size *= factor;
        });
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsChart.style = arcgisSmartMappingPanelsChartCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-chart.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
    let timeout;
    let status = "idle";
    function flush(...args) {
        status = "flushed";
        return debounced(...args);
    }
    function invoke(...args) {
        status = "invoked";
        return debounced(...args);
    }
    function cancel(...args) {
        status = "cancelled";
        return debounced(...args);
    }
    function getStatus() {
        return status;
    }
    const debounced = (...args) => new Promise((resolve) => {
        switch (status) {
            case "flushed":
                status = "idle";
                if (timeout) {
                    clearTimeout(timeout);
                    resolve(fn(...args));
                }
                else {
                    resolve(null);
                }
                break;
            case "invoked":
                clearTimeout(timeout);
                status = "idle";
                resolve(fn(...args));
                break;
            case "cancelled":
                clearTimeout(timeout);
                status = "idle";
                resolve(null);
                break;
            default:
                if (timeout) {
                    clearTimeout(timeout);
                }
                status = "pending";
                timeout = setTimeout(() => {
                    status = "idle";
                    return resolve(fn(...args));
                }, delay);
                break;
        }
    });
    debounced.flush = flush;
    debounced.invoke = invoke;
    debounced.cancel = cancel;
    debounced.getStatus = getStatus;
    return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
    let timeout;
    return (...args) => new Promise((resolve) => {
        if (timeout) {
            return;
        }
        timeout = setTimeout(() => {
            clearTimeout(timeout);
            timeout = undefined;
            resolve(fn(...args));
        }, delay);
    });
};
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
    await Promise.all([promise, timeout(minDelay)]);
    return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
    const { key, data } = getKeyAndItem(item);
    return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
    const resultArr = [];
    const lookupMap = {};
    myArr.forEach((item) => {
        const id = getItemId(item);
        if (lookupMap[id] == null) {
            lookupMap[id] = item;
            resultArr.push(item);
        }
    });
    return resultArr;
}
function unique(myArr) {
    const primitives = { boolean: {}, number: {}, string: {} };
    const objs = [];
    return myArr.filter((item) => {
        let type = typeof item;
        if (type in primitives) {
            return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
        }
        else {
            return objs.indexOf(item) >= 0 ? false : objs.push(item);
        }
    });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));



//# sourceMappingURL=functional-44de8fcf.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ requestWrapper)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
let _loadingTimer;
let _requestCancelled;
function startLoading(node) {
    node.loading = true;
    _requestCancelled = false;
    if (_loadingTimer) {
        clearTimeout(_loadingTimer);
    }
    _loadingTimer = setTimeout(() => {
        // took too long
        endLoading(node);
        _requestCancelled = true;
    }, 60000);
}
function endLoading(node) {
    node.loading = false;
}
function requestWrapper(request, node) {
    startLoading(node);
    return request
        .then((result) => {
        endLoading(node);
        if (!_requestCancelled) {
            return Promise.resolve(result);
        }
        else {
            return Promise.reject(new Error("timeout"));
        }
    })
        .catch((error) => {
        endLoading(node);
        return Promise.reject(error);
    });
}



//# sourceMappingURL=loading-69139907.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQ1OTU0YS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM4STtBQUMwVDtBQUM1WTtBQUN6QjtBQUNBO0FBQzhHO0FBQ3RFO0FBQ2xCO0FBQ0s7QUFDaEM7QUFDSDtBQUNFO0FBQ1U7QUFDUDs7QUFFaEMsZ0RBQWdELFdBQVcsV0FBVyxZQUFZLGFBQWEsa0JBQWtCLFVBQVUsV0FBVyxRQUFRLGFBQWEsaUJBQWlCLCtCQUErQixhQUFhLGdCQUFnQixPQUFPLHNDQUFzQyxnQkFBZ0IsbUJBQW1CLGdDQUFnQyw2Q0FBNkMsVUFBVSw2Q0FBNkMsc0JBQXNCLGdCQUFnQixjQUFjLGlCQUFpQixvQkFBb0IsaUJBQWlCLGNBQWMsNkJBQTZCLGtCQUFrQixXQUFXLGNBQWMsZUFBZSxnQkFBZ0IsZUFBZSxhQUFhLDhCQUE4QixhQUFhLFdBQVcsWUFBWSxXQUFXLGlCQUFpQix5QkFBeUIsV0FBVyx1QkFBdUI7O0FBRWgxQjtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsc0RBQXNELHFEQUFXO0FBQ2pFLGtEQUFrRCxxREFBVztBQUM3RCxrREFBa0QscURBQVc7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixTQUFTLEVBQUUsK0RBQWlCO0FBQzVDLHdIQUF3SCxnQkFBZ0I7QUFDeEksc0NBQXNDLFFBQVEscUZBQXFGO0FBQ25JO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwwQkFBMEIsRUFBRSwrREFBaUI7QUFDN0QseUJBQXlC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TTs7Ozs7Ozs7Ozs7Ozs7QUMvSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFK0I7O0FBRS9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWNoYXJ0LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9hZGluZy02OTEzOTkwNy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGFlIGFzIHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAsIGFhIGFzIGlzVG9wRmxvd0l0ZW0sIGcgYXMgZ2V0UmVuZGVyZXJUeXBlLCBEIGFzIGdldEdlb21ldHJ5VHlwZSwgUyBhcyBnZXREZWZhdWx0U3ltYm9sLCBhcSBhcyBpc1N5bWJvbEFsbW9zdFdoaXRlLCBhRSBhcyBpc1N5bWJvbFRyYW5zcGFyZW50LCBFIGFzIGNsb3NlUG9wb3ZlcnMsIGEgYXMgZ2V0VmlzVmFyLCBhYiBhcyB1cGRhdGVSZW5kZXJlciwgYWYgYXMgYWRkU21hcnRNYXBwaW5nVG9vbHRpcCwgbiBhcyBnZXRWaXNWYXJzRXhjZXB0LCBlIGFzIGFwcGx5UmVuZGVyZXIsIGggYXMgZ2V0UmVuZGVyZXIsIGogYXMgYXBwbHlSZW5kZXJlclRvQWxsLCBhOSBhcyBnZXRDb2xvclJhbXBzV2l0aFNjaGVtZXMgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0V3JhcHBlciB9IGZyb20gJy4vbG9hZGluZy02OTEzOTkwNy5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlU3ltYm9sU3R5bGVyUG9wb3ZlciwgciBhcyByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyLCBhIGFzIGJ1aWxkU3ltYm9sU3R5bGVyRm9yQ2hhcnRWYWx1ZSB9IGZyb20gJy4vc3ltYm9sU3R5bGVyLTA0NjM1YjJiLmpzJztcbmltcG9ydCB7IGEgYXMgY3JlYXRlQ2hhcnRSZW5kZXJlckZyb21FeGlzdGluZyB9IGZyb20gJy4vY2hhcnQtMDk3ZWMyODAuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWJvdW5jZSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCAnLi9sb2NhdGlvbi1lMjZiNTM5Zi5qcyc7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0Q3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9LmNoYXJ0LWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5jaGVja2JveHttYXJnaW46NnB4fS5oaWRkZW57ZGlzcGxheTpub25lfS50b3AtZ3JleS1ib3JkZXJ7Ym9yZGVyLXRvcDoxLjVweCBzb2xpZCAjZTBlMGUwfS50b3AtcGFkZGluZ3ttYXJnaW4tdG9wOjEycHh9LmxhYmVse2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMSk7cGFkZGluZy10b3A6NXB4O3BhZGRpbmctYm90dG9tOjVweH0ubGFiZWw6Zm9jdXMsLnN5bWJvbC1pY29uOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5zZWxlY3RlZHtvdXRsaW5lOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0ub3RoZXItbnVsbC1saXN0LWl0ZW17bWluLWhlaWdodDo0NXB4fS5vdGhlci1zeW1ib2x7bWFyZ2luLWxlZnQ6MjdweH0ubnVsbC12YWx1ZS1hY3Rpb25ze2Rpc3BsYXk6Y29udGVudHN9LnNoYXBlLXNsaWRlcntiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7cGFkZGluZzowIDRweH0uc2xpZGVyLWxhYmVsc3ttYXJnaW4tdG9wOjEwcHh9LnNwYWNlLWJldHdlZW57ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5zeW1ib2wtaWNvbnt3aWR0aDoxOXB4O2hlaWdodDoxOXB4O21hcmdpbjoycHh9LnN5bWJvbC1pcy13aGl0ZXtiYWNrZ3JvdW5kLWNvbG9yOiNmM2YzZjN9LnRleHQtd3JhcHtvdmVyZmxvdy13cmFwOmFueXdoZXJlfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0QmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0Q2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0Q2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRFcnJvclwiLCA3KTtcbiAgICAgICAgLy9tYXBzIGZyb20gaW5kZXggdG8gSFRNTENhbGNpdGVJbnB1dEVsZW1lbnRcbiAgICAgICAgdGhpcy5pbnB1dE5vZGVzID0ge307XG4gICAgICAgIC8vbWFwcyBmcm9tIGluZGV4IHRvIEhUTUxEaXZFbGVtZW50XG4gICAgICAgIHRoaXMubGFiZWxOb2RlcyA9IHt9O1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIGluZGV4OiBudWxsLFxuICAgICAgICAgICAgcG9wb3Zlck5vZGU6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgLy9tYXBzIGZyb20gaW5kZXggdG8gSFRNTERpdkVsZW1lbnRcbiAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzID0ge307XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBjb25maWcgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZmlyc3RFbGVtZW50Q2hpbGQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlYmVnaW5cIiwgYDxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJHtjb25maWcuanNhcGlVcmx9L3RoZW1lcy9saWdodC9tYWluLmNzc1wiIC8+YCk7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OID0gcmVuZGVyZXIudG9KU09OKCk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uID1cbiAgICAgICAgICAgIFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmIGxheWVyLmZlYXR1cmVSZWR1Y3Rpb25cbiAgICAgICAgICAgICAgICA/IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUobGF5ZXIuZmVhdHVyZVJlZHVjdGlvbilcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCFyZW5kZXJlci5kZWZhdWx0TGFiZWwpIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IHN0cmluZ3MucGFuZWxzLmNoYXJ0Lm5vRGF0YTtcbiAgICAgICAgfVxuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5sYXN0RGVmYXVsdCA9IHtcbiAgICAgICAgICAgIG90aGVyQ29sb3I6IChfYSA9IHJlbmRlcmVyLm90aGVyc0NhdGVnb3J5KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29sb3IsXG4gICAgICAgICAgICBvdGhlckxhYmVsOiAoKF9iID0gcmVuZGVyZXIub3RoZXJzQ2F0ZWdvcnkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sYWJlbCkgfHwgc3RyaW5ncy5wYW5lbHMuY2hhcnQub3RoZXIsXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IChfYyA9IHJlbmRlcmVyLm90aGVyc0NhdGVnb3J5KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudGhyZXNob2xkLFxuICAgICAgICAgICAgZGVmYXVsdENvbG9yOiByZW5kZXJlci5kZWZhdWx0Q29sb3IsXG4gICAgICAgICAgICBkZWZhdWx0TGFiZWw6IHJlbmRlcmVyLmRlZmF1bHRMYWJlbFxuICAgICAgICB9O1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnNpemVTbGlkZXJXYXRjaEhhbmRsZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZSgpO1xuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5sYXN0RGVmYXVsdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgc21hcnRNYXBwaW5nU3RhdGUuc2VsZWN0ZWRBdHRyaWJ1dGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGhpZGVMYXllclRpdGxlLCBpc1JUTCwgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGhpZGVMYXllclRpdGxlID8gdW5kZWZpbmVkIDogKF9hID0gbWFwSW1hZ2VTdWJsYXllciA9PT0gbnVsbCB8fCBtYXBJbWFnZVN1YmxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBJbWFnZVN1YmxheWVyLnRpdGxlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogdGl0bGUsIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0QmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgaXNTaXplQ2hhcnQgPSByZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwiY2hhcnQtYmxvY2tcIiwgaGVhZGluZzogaXNTaXplQ2hhcnQgPyBzdHJpbmdzLnBhbmVscy5jaGFydC5jaGFydFN0eWxlQ29sb3IgOiBzdHJpbmdzLnBhbmVscy5jaGFydC5jaGFydFN0eWxlLCBvcGVuOiB0cnVlLCBjb2xsYXBzaWJsZTogZmFsc2UgfSwgdGhpcy5yZW5kZXJDaGFydFN5bWJvbCgpLCB0aGlzLnJlbmRlclZhbHVlcygpLCB0aGlzLnJlbmRlckNoYXJ0U2l6ZSgpLCB0aGlzLnJlbmRlclNoYXBlKCksIHRoaXMucmVuZGVyTWluU2xpY2UoKSwgdGhpcy5yZW5kZXJCYWNrZ3JvdW5kU3R5bGUoKSkpO1xuICAgIH1cbiAgICByZW5kZXJDaGFydFN5bWJvbCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gcmVuZGVyZXIuYXR0cmlidXRlcztcbiAgICAgICAgY29uc3Qgc2NoZW1lcyA9IG1vZHVsZXMucGllQ2hhcnRTY2hlbWVzLmdldFNjaGVtZXMoe1xuICAgICAgICAgICAgYmFzZW1hcDogbWFwVmlldy5tYXAuYmFzZW1hcCxcbiAgICAgICAgICAgIGdlb21ldHJ5VHlwZTogZ2V0R2VvbWV0cnlUeXBlKGxheWVyKSxcbiAgICAgICAgICAgIG51bUNvbG9yczogYXR0cmlidXRlcy5sZW5ndGhcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbG9yUmFtcHNBbmRTY2hlbWVzID0gZ2V0Q29sb3JSYW1wc1dpdGhTY2hlbWVzKHNjaGVtZXMsIE1hdGgubWluKGF0dHJpYnV0ZXMubGVuZ3RoLCAxMCkpO1xuICAgICAgICBjb25zdCBkZWZhdWx0Q29sb3JzID0gY29sb3JSYW1wc0FuZFNjaGVtZXNbMF0uY29sb3JzO1xuICAgICAgICBsZXQgY29sb3JzID0gKGF0dHJpYnV0ZXMgPT09IG51bGwgfHwgYXR0cmlidXRlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXR0cmlidXRlcy5sZW5ndGgpXG4gICAgICAgICAgICA/IGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICAuc2xpY2UoMCwgMTApXG4gICAgICAgICAgICAgICAgLm1hcCgoYXR0cmlidXRlLCBpZHgpID0+IGF0dHJpYnV0ZS5jb2xvclxuICAgICAgICAgICAgICAgID8gbmV3IG1vZHVsZXMuZXNyaUNvbG9yKGF0dHJpYnV0ZS5jb2xvcilcbiAgICAgICAgICAgICAgICA6IG5ldyBtb2R1bGVzLmVzcmlDb2xvcihkZWZhdWx0Q29sb3JzW2lkeCAlIGRlZmF1bHRDb2xvcnMubGVuZ3RoXSkpXG4gICAgICAgICAgICA6IFtdO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgdHlwZTogXCJjaGFydC1yYW1wXCIsIGNvbG9yczogY29sb3JzLCByYW1wVHlwZTogXCJkaXNjcmV0ZVwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4gZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJWYWx1ZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInRvcC1wYWRkaW5nXCIgfSwgc3RyaW5ncy5wYW5lbHMuY2hhcnQuZmllbGROYW1lLCBoKFwiY2FsY2l0ZS1saXN0XCIsIHsgY2xhc3M6IFwidG9wLWdyZXktYm9yZGVyXCIgfSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IFwiZHJhZy1lbmFibGVkXCI6IHRydWUsIG9uQ2FsY2l0ZUxpc3RPcmRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU29ydExlZ2VuZChpdGVtcyk7XG4gICAgICAgICAgICB9IH0sIHJlbmRlcmVyLmF0dHJpYnV0ZXMubWFwKChhdHRyaWJ1dGUsIGlkeCkgPT4gdGhpcy5yZW5kZXJWYWx1ZShhdHRyaWJ1dGUsIGlkeCkpKSwgdGhpcy5yZW5kZXJPdGhlclZhbHVlKCksIHRoaXMucmVuZGVyTnVsbFZhbHVlKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclZhbHVlKGF0dHJpYnV0ZSwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBrZXk6IGF0dHJpYnV0ZS5maWVsZCwgdmFsdWU6IGF0dHJpYnV0ZS5maWVsZCB9LCB0aGlzLnJlbmRlclN5bWJvbE5vZGUoYXR0cmlidXRlLCBpbmRleCksIHRoaXMucmVuZGVyVGV4dE5vZGUoYXR0cmlidXRlLCBpbmRleCkpKTtcbiAgICB9XG4gICAgcmVuZGVyU3ltYm9sTm9kZShhdHRyaWJ1dGUsIGluZGV4KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMsIHNlbGVjdGVkQXR0cmlidXRlLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgc3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgIHN5bWJvbC5jb2xvciA9IG5ldyBtb2R1bGVzLmVzcmlDb2xvcihhdHRyaWJ1dGUuY29sb3IpO1xuICAgICAgICBzeW1ib2wub3V0bGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgc3ltYm9sTm9kZUNsYXNzZXMgPSB7XG4gICAgICAgICAgICBcInZhbHVlLXN5bWJvbFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzeW1ib2wtaXMtd2hpdGVcIjogaXNTeW1ib2xBbG1vc3RXaGl0ZShzeW1ib2wpXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN5bWJvbENsYXNzZXMgPSB7XG4gICAgICAgICAgICBcInN5bWJvbC1pY29uXCI6IHRydWUsXG4gICAgICAgICAgICBcInNlbGVjdGVkXCI6IHNlbGVjdGVkQXR0cmlidXRlID09PSBpbmRleFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogc3ltYm9sTm9kZUNsYXNzZXMsIHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCByb2xlOiBcImJ1dHRvblwiLCBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5wYW5lbHMuY2hhcnQuYWNjZXNzaWJpbGl0eS5lZGl0U3ltYm9sRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBhdHRyaWJ1dGUubGFiZWwpLCBcImFyaWEtaGFzcG9wdXBcIjogXCJ0cnVlXCIsIFwiYXJpYS1leHBhbmRlZFwiOiBzZWxlY3RlZEF0dHJpYnV0ZSA9PT0gaW5kZXgsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpbmRleCksIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogc3ltYm9sQ2xhc3NlcywgdGFiSW5kZXg6IDAsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzW2luZGV4XSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNTeW1ib2xUcmFuc3BhcmVudChzeW1ib2wpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IChfYiA9IChfYSA9IHN5bWJvbC5jb2xvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvSGV4KCkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiI2ZmZmZmZlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS5vcGFjaXR5ID0gKF9kID0gKF9jID0gc3ltYm9sLmNvbG9yKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuYSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUub3BhY2l0eSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlck90aGVyVmFsdWUoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgbGFzdERlZmF1bHQsIGxheWVyLCBtYXBWaWV3LCBtb2R1bGVzLCBzZWxlY3RlZEF0dHJpYnV0ZSwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBkZWZhdWx0Q29sb3IgPSAoKF9hID0gcmVuZGVyZXIub3RoZXJzQ2F0ZWdvcnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb2xvcikgfHwgbGFzdERlZmF1bHQub3RoZXJDb2xvcjtcbiAgICAgICAgY29uc3QgZGVmYXVsdFN5bWJvbCA9IGdldERlZmF1bHRTeW1ib2wobGF5ZXIsIG1hcFZpZXcpO1xuICAgICAgICBkZWZhdWx0U3ltYm9sLmNvbG9yID0gbmV3IG1vZHVsZXMuZXNyaUNvbG9yKGRlZmF1bHRDb2xvcik7XG4gICAgICAgIGRlZmF1bHRTeW1ib2wub3V0bGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgZGVmYXVsdExhYmVsID0gKChfYiA9IHJlbmRlcmVyLm90aGVyc0NhdGVnb3J5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGFiZWwpIHx8IGxhc3REZWZhdWx0Lm90aGVyTGFiZWw7XG4gICAgICAgIGNvbnN0IHN5bWJvbE5vZGVDbGFzc2VzID0ge1xuICAgICAgICAgICAgXCJvdGhlci1zeW1ib2xcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwic3ltYm9sLWlzLXdoaXRlXCI6IGlzU3ltYm9sQWxtb3N0V2hpdGUoZGVmYXVsdFN5bWJvbClcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc3ltYm9sQ2xhc3NlcyA9IHtcbiAgICAgICAgICAgIFwic3ltYm9sLWljb25cIjogdHJ1ZSxcbiAgICAgICAgICAgIFwic2VsZWN0ZWRcIjogc2VsZWN0ZWRBdHRyaWJ1dGUgPT09IC0xXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgY2xhc3M6IFwidG9wLWdyZXktYm9yZGVyIG90aGVyLW51bGwtbGlzdC1pdGVtXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBzeW1ib2xOb2RlQ2xhc3Nlcywgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIHJvbGU6IFwiYnV0dG9uXCIsIHRhYkluZGV4OiAwLCBcImFyaWEtaGFzcG9wdXBcIjogXCJ0cnVlXCIsIFwiYXJpYS1leHBhbmRlZFwiOiBzZWxlY3RlZEF0dHJpYnV0ZSA9PT0gLTEsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy5jaGFydC5hY2Nlc3NpYmlsaXR5LmVkaXRTeW1ib2xGb3IucmVwbGFjZShcIiR7ZmllbGROYW1lfVwiLCBkZWZhdWx0TGFiZWwpLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVZhbHVlU3ltYm9sQ2xpY2soLTEpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljaygtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IHN5bWJvbENsYXNzZXMsIHRhYkluZGV4OiAwLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTeW1ib2xOb2Rlc1stMV0gPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU3ltYm9sVHJhbnNwYXJlbnQoZGVmYXVsdFN5bWJvbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gKF9iID0gKF9hID0gZGVmYXVsdFN5bWJvbC5jb2xvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvSGV4KCkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiI2ZmZmZmZlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS5vcGFjaXR5ID0gKF9kID0gKF9jID0gZGVmYXVsdFN5bWJvbC5jb2xvcikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmEpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLm9wYWNpdHkgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSksIHRoaXMucmVuZGVyVGV4dE5vZGUoe1xuICAgICAgICAgICAgc3ltYm9sOiBkZWZhdWx0U3ltYm9sLFxuICAgICAgICAgICAgbGFiZWw6IGRlZmF1bHRMYWJlbFxuICAgICAgICB9LCAtMSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVGV4dE5vZGUoYXR0cmlidXRlLCBpbmRleCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5wYW5lbHMuY2hhcnQuYWNjZXNzaWJpbGl0eS5lZGl0TGFiZWxGb3IucmVwbGFjZShcIiR7ZmllbGROYW1lfVwiLCBhdHRyaWJ1dGUubGFiZWwpLCBjbGFzczogXCJsYWJlbCB0ZXh0LXdyYXBcIiwgc2xvdDogXCJjb250ZW50XCIsIHRhYkluZGV4OiAwLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpbmRleF0uc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaW5kZXhdLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxOb2Rlc1tpbmRleF0gPSBub2RlO1xuICAgICAgICAgICAgfSB9LCBhdHRyaWJ1dGUubGFiZWwpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGNsYXNzOiBcImhpZGRlblwiLCBzbG90OiBcImNvbnRlbnRcIiwgdGFiSW5kZXg6IDAsIHZhbHVlOiBhdHRyaWJ1dGUubGFiZWwsIG9uRm9jdXNvdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaW5kZXgsIG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVZhbHVlVGV4dENoYW5nZShpbmRleCwgbm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpbmRleF0gPSBub2RlO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJOdWxsVmFsdWUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGFzdERlZmF1bHQsIGxheWVyLCBtYXBWaWV3LCBtb2R1bGVzLCBzZWxlY3RlZEF0dHJpYnV0ZSwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBkZWZhdWx0Q29sb3IgPSByZW5kZXJlci5kZWZhdWx0Q29sb3IgfHwgbGFzdERlZmF1bHQuZGVmYXVsdENvbG9yO1xuICAgICAgICBjb25zdCBkZWZhdWx0U3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgIGRlZmF1bHRTeW1ib2wuY29sb3IgPSBuZXcgbW9kdWxlcy5lc3JpQ29sb3IoZGVmYXVsdENvbG9yKTtcbiAgICAgICAgZGVmYXVsdFN5bWJvbC5vdXRsaW5lID0gdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBkZWZhdWx0TGFiZWwgPSByZW5kZXJlci5kZWZhdWx0TGFiZWwgfHwgbGFzdERlZmF1bHQuZGVmYXVsdExhYmVsO1xuICAgICAgICBjb25zdCBzeW1ib2xJc1RyYW5zcGFyZW50ID0gaXNTeW1ib2xUcmFuc3BhcmVudChkZWZhdWx0U3ltYm9sKTtcbiAgICAgICAgY29uc3Qgc3ltYm9sTm9kZUNsYXNzZXMgPSB7XG4gICAgICAgICAgICBcInN5bWJvbFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzeW1ib2wtaXMtd2hpdGVcIjogaXNTeW1ib2xBbG1vc3RXaGl0ZShkZWZhdWx0U3ltYm9sKVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzeW1ib2xDbGFzc2VzID0ge1xuICAgICAgICAgICAgXCJzeW1ib2wtaWNvblwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzZWxlY3RlZFwiOiBzZWxlY3RlZEF0dHJpYnV0ZSA9PT0gLTJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBjbGFzczogXCJvdGhlci1udWxsLWxpc3QtaXRlbVwiIH0sIGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgZGlzYWJsZWQ6IHN5bWJvbElzVHJhbnNwYXJlbnQsIHNsb3Q6IFwiYWN0aW9ucy1zdGFydFwiLCBjbGFzczogXCJjaGVja2JveFwiLCB0YWJJbmRleDogMCwgY2hlY2tlZDogISFyZW5kZXJlci5kZWZhdWx0Q29sb3IgJiYgIXN5bWJvbElzVHJhbnNwYXJlbnQsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlTnVsbFZhbHVlQ2hlY2tDaGFuZ2UoKSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBzeW1ib2xOb2RlQ2xhc3Nlcywgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIHJvbGU6IFwiYnV0dG9uXCIsIHRhYkluZGV4OiAwLCBcImFyaWEtaGFzcG9wdXBcIjogXCJ0cnVlXCIsIFwiYXJpYS1leHBhbmRlZFwiOiBzZWxlY3RlZEF0dHJpYnV0ZSA9PT0gLTIsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy5jaGFydC5hY2Nlc3NpYmlsaXR5LmVkaXRTeW1ib2xGb3IucmVwbGFjZShcIiR7ZmllbGROYW1lfVwiLCBkZWZhdWx0TGFiZWwpLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVZhbHVlU3ltYm9sQ2xpY2soLTIpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljaygyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogc3ltYm9sQ2xhc3NlcywgdGFiSW5kZXg6IDAsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzWy0yXSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc3ltYm9sSXNUcmFuc3BhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAoX2IgPSAoX2EgPSBkZWZhdWx0U3ltYm9sLmNvbG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9IZXgoKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCIjZmZmZmZmXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLm9wYWNpdHkgPSAoX2QgPSAoX2MgPSBkZWZhdWx0U3ltYm9sLmNvbG9yKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuYSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBuZWVkIHRvIHJlc2V0IGZvciB0aGUgdHJhbnNwYXJlbnQgc3ltYm9sIGNzcyBjbGFzcyB0byBhcHBseVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUub3BhY2l0eSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSwgdGhpcy5yZW5kZXJUZXh0Tm9kZSh7XG4gICAgICAgICAgICBzeW1ib2w6IGRlZmF1bHRTeW1ib2wsXG4gICAgICAgICAgICBsYWJlbDogZGVmYXVsdExhYmVsXG4gICAgICAgIH0sIC0yKSkpO1xuICAgIH1cbiAgICByZW5kZXJDaGFydFNpemUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgc2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXV0b1NpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiLCBcImF1dG9cIik7IC8vdmFsdWUgZGVwZW5kcyBvbiBzY2FsZSBvZiBtYXBcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuZ2V0U2l6ZVZhbHVlKCk7XG4gICAgICAgIC8vIHByZXZlbnQgc2hvd2luZyByb3VuZGluZyBpc3N1ZXNcbiAgICAgICAgY29uc3QgcHhXaWR0aCA9IE1hdGgucm91bmQoc2l6ZSAvIDAuNzUpO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmNoYXJ0LmNoYXJ0U2l6ZSksIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zbGlkZXItaW5wdXRcIiwgeyBtaW46IDEwLCBtYXg6IDEyMCwgdmFsdWVzOiBbcHhXaWR0aF0sIHByZWNpc2lvbjogMCwgc3VmZml4VGV4dDogc3RyaW5ncy5wYW5lbHMuY2hhcnQucHgsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU2xpZGVySW5wdXRDaGFuZ2U6IChldmVudCkgPT4gdGhpcy5oYW5kbGVDaGFydFNpemVDaGFuZ2UoZXZlbnQuZGV0YWlsKSB9KSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIsIGxheW91dDogXCJpbmxpbmVcIiB9LCBoKFwiY2FsY2l0ZS1jaGVja2JveFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogISFhdXRvU2l6ZVZpc1Zhciwgb25DYWxjaXRlQ2hlY2tib3hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQXV0b1NpemVDaGFuZ2UoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPyBcImF1dG9tYXRpY1wiIDogXCJmaXhlZFwiKTtcbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdFNpemVOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNpemVTbGlkZXJXYXRjaEhhbmRsZSA9IG1hcFZpZXcud2F0Y2goXCJzY2FsZVwiLCBkZWJvdW5jZSgoKSA9PiBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KSwgMTAwKSk7XG4gICAgICAgICAgICB9IH0pLCBzdHJpbmdzLnBhbmVscy5jaGFydC5hZGp1c3RDaGFydFNpemVBdXRvbWF0aWNhbGx5KSkpO1xuICAgIH1cbiAgICByZW5kZXJTaGFwZSgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBpZiAoIXRoaXMuc2hhcGVTbGlkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KDAuOSwgcmVuZGVyZXIuaG9sZVBlcmNlbnRhZ2UpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICBtYXgsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbKF9hID0gcmVuZGVyZXIuaG9sZVBlcmNlbnRhZ2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDAuNV0sXG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAxXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zaGFwZVNsaWRlciA9IG5ldyBtb2R1bGVzLlNsaWRlcihjb25maWcpO1xuICAgICAgICAgICAgdGhpcy5zaGFwZVNsaWRlci5vbihcInRodW1iLWRyYWdcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuaG9sZVBlcmNlbnRhZ2UgPSBldmVudC52YWx1ZTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNoYXBlU2xpZGVyLm9uKFwidGh1bWItY2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmhvbGVQZXJjZW50YWdlID0gZXZlbnQudmFsdWU7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFsoX2IgPSByZW5kZXJlci5ob2xlUGVyY2VudGFnZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMC41XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc2hhcGVTbGlkZXIuc2V0KGNvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG9wLXBhZGRpbmdcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5jaGFydC5zaGFwZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzaGFwZS1zbGlkZXIgc2xpZGVyLWJvdHRvbS1sYWJlbFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgbm9kZS5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNoYXBlU2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVTbGlkZXIuY29udGFpbmVyID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2xpZGVyLWxhYmVscyBzcGFjZS1iZXR3ZWVuXCIsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuY2hhcnQucGllKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuY2hhcnQuZG9udXQpKSkpO1xuICAgIH1cbiAgICByZW5kZXJNaW5TbGljZSgpIHtcbiAgICAgICAgY29uc3QgeyBpc1JUTCwgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgeyB0aHJlc2hvbGQgPSAwLjA0IH0gPSByZW5kZXJlci5vdGhlcnNDYXRlZ29yeTtcbiAgICAgICAgbGV0IGlzUGVyY2VudEFmdGVyID0gc3RyaW5ncy5wYW5lbHMuY2hhcnQucGVyY2VudFZhbHVlLmVuZHNXaXRoKFwiJVwiKTtcbiAgICAgICAgaWYgKGlzUlRMKSB7XG4gICAgICAgICAgICAvLyBpdCBmbGlwcyBpdCB3aXRoIFJUTFxuICAgICAgICAgICAgaXNQZXJjZW50QWZ0ZXIgPSAhaXNQZXJjZW50QWZ0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG9wLXBhZGRpbmdcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3BhY2UtYmV0d2VlblwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiIH0sIHN0cmluZ3MucGFuZWxzLmNoYXJ0Lmdyb3VwaW5nKSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCByb2xlOiBcImJ1dHRvblwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGFkZFNtYXJ0TWFwcGluZ1Rvb2x0aXAobm9kZSwgYDxkaXY+JHtzdHJpbmdzLnBhbmVscy5jaGFydC5ncm91cGluZ0luZm8ucmVwbGFjZShcIiR7b3RoZXJ9XCIsICgoX2EgPSByZW5kZXJlci5vdGhlcnNDYXRlZ29yeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxhYmVsKSB8fCBzdHJpbmdzLnBhbmVscy5jaGFydC5vdGhlcil9PC9kaXY+YCwgZmFsc2UpO1xuICAgICAgICAgICAgfSB9KSksIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zbGlkZXItaW5wdXRcIiwgeyBkaXNhYmxlZDogIXJlbmRlcmVyLm90aGVyc0NhdGVnb3J5LCBtaW46IDAsIG1heDogNTAsIHZhbHVlczogW01hdGgucm91bmQodGhyZXNob2xkICogMTAwKV0sIHByZWNpc2lvbjogMCwgcHJlZml4VGV4dDogIWlzUGVyY2VudEFmdGVyID8gXCIlXCIgOiB1bmRlZmluZWQsIHN1ZmZpeFRleHQ6IGlzUGVyY2VudEFmdGVyID8gXCIlXCIgOiB1bmRlZmluZWQsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU2xpZGVySW5wdXRDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLm90aGVyc0NhdGVnb3J5LnRocmVzaG9sZCA9IGV2ZW50LmRldGFpbCAvIDEwMDtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJCYWNrZ3JvdW5kU3R5bGUoKSB7XG4gICAgICAgIHJldHVybiBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYmFja2dyb3VuZC1zeW1ib2xcIiwgbnVsbCk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDaGFydENsb3NlLmVtaXQoXCJzYXZlXCIpLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICAgICAgYXBwbHlSZW5kZXJlclRvQWxsKG9yaWdpbmFsUmVuZGVyZXJKU09OLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgfSwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZ2V0U2l6ZUJ5U2NhbGUoc2l6ZUF1dG9WaXNWYXIsIHNjYWxlKSB7XG4gICAgICAgIGNvbnN0IHNpemVTdG9wcyA9IHNpemVBdXRvVmlzVmFyLnN0b3BzO1xuICAgICAgICBjb25zdCBzdG9wc0NvdW50ID0gc2l6ZVN0b3BzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgZmluYWxJbmRleCA9IHN0b3BzQ291bnQgLSAxO1xuICAgICAgICBjb25zdCBzY2FsZU1pbiA9IHNpemVTdG9wc1swXS52YWx1ZTtcbiAgICAgICAgY29uc3Qgc2NhbGVNYXggPSBzaXplU3RvcHNbZmluYWxJbmRleF0udmFsdWU7XG4gICAgICAgIGlmIChzY2FsZSA8PSBzY2FsZU1pbikge1xuICAgICAgICAgICAgcmV0dXJuIHNpemVTdG9wc1swXS5zaXplO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzY2FsZSA+PSBzY2FsZU1heCkge1xuICAgICAgICAgICAgcmV0dXJuIHNpemVTdG9wc1tmaW5hbEluZGV4XS5zaXplO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGZpbmFsSW5kZXg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFN0b3AgPSBzaXplU3RvcHNbaV07XG4gICAgICAgICAgICBjb25zdCBuZXh0U3RvcCA9IHNpemVTdG9wc1tpICsgMV07XG4gICAgICAgICAgICBpZiAoc2NhbGUgPj0gY3VycmVudFN0b3AudmFsdWUgJiYgc2NhbGUgPCBuZXh0U3RvcC52YWx1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlUmFuZ2UgPSBuZXh0U3RvcC52YWx1ZSAtIGN1cnJlbnRTdG9wLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNpemVSYW5nZSA9IGN1cnJlbnRTdG9wLnNpemUgLSBuZXh0U3RvcC5zaXplO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlUG9zaXRpb24gPSAoc2NhbGUgLSBjdXJyZW50U3RvcC52YWx1ZSkgLyBzY2FsZVJhbmdlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZVNpemUgPSBjdXJyZW50U3RvcC5zaXplIC0gc2l6ZVJhbmdlICogcmVsYXRpdmVQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChlZmZlY3RpdmVTaXplICogMTAwKSAvIDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMTsgLy8gd2UgcmVhbGx5IGRvbid0IGNvbWUgaGVyZVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgc2l6ZSB2YWx1ZSBvZiBzaXplIGluIGN1cnJlbnQgbWFwIHNjYWxlIChpZiBhcHBsaWNhYmxlKVxuICAgICAqL1xuICAgIGdldFNpemVWYWx1ZSgpIHtcbiAgICAgICAgY29uc3QgeyBtYXBWaWV3LCBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBzaXplQXV0b1Zpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJzaXplXCIsIFwiYXV0b1wiKTtcbiAgICAgICAgaWYgKHNpemVBdXRvVmlzVmFyKSB7XG4gICAgICAgICAgICBjb25zdCBtYXBTY2FsZSA9IG1hcFZpZXcuc2NhbGU7XG4gICAgICAgICAgICBjb25zdCBzdG9wcyA9IHNpemVBdXRvVmlzVmFyLnN0b3BzO1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gMDtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdG9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0b3AgPSBzdG9wc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAobWFwU2NhbGUgPD0gc3RvcC52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW50ZXJwb2xhdGUgdG8gZ2V0IGNvcnJlY3Qgc2l6ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYXN0U3RvcCA9IHN0b3BzW2kgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IChtYXBTY2FsZSAtIGxhc3RTdG9wLnZhbHVlKSAvIChzdG9wLnZhbHVlIC0gbGFzdFN0b3AudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBsYXN0U3RvcC5zaXplICsgKHN0b3Auc2l6ZSAtIGxhc3RTdG9wLnNpemUpICogZmFjdG9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgaW50ZXJwb2xhdGU7IHVzZSBsb3dlc3Qgc2l6ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3RvcHNbMF0uc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gdGFrZSBsb3dlc3QgdmFsdWVcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHN0b3BzW3N0b3BzLmxlbmd0aCAtIDFdLnNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyZXIuc2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVBdXRvU2l6ZUNoYW5nZSh0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiZml4ZWRcIikge1xuICAgICAgICAgICAgLy8gYXV0b21hdGljIC0+IGZpeGVkXG4gICAgICAgICAgICAvLyByZW1vdmUgdmlzdWFsVmFyaWFibGVcbiAgICAgICAgICAgIGNvbnN0IHZpc1ZhcnMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlbmRlcmVyLCBcInNpemVcIiwgXCJhdXRvXCIpO1xuICAgICAgICAgICAgaWYgKHZpc1ZhcnMgPT09IG51bGwgfHwgdmlzVmFycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmlzVmFycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSB2aXNWYXJzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGZpeGVkIC0+IGF1dG9tYXRpY1xuICAgICAgICAgICAgLy8gbmVlZCB0byBjcmVhdGUgYSBuZXcgcmVuZGVyZXJcbiAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNoYXJ0UmVuZGVyZXJGcm9tRXhpc3Rpbmcoe1xuICAgICAgICAgICAgICAgIHNpemVPcHRpbWl6YXRpb25FbmFibGVkOiB0cnVlXG4gICAgICAgICAgICB9KSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGhhbmRsZXMga2VlcGluZyB0aGUgXCJhZGp1c3Qgc2l6ZSBhdXRvbWF0aWNhbGx5XCIgYnV0dG9uIHVuY2hlY2tlZCB3aGVuIHJlbmRlcmVyIHJlLWNyZWF0aW9uIG9jY3Vyc1xuICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0U2l6ZU5vZGUuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRFcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUNoYXJ0U2l6ZUNoYW5nZSh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtYXBWaWV3IH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGxldCBuZXdTaXplID0gTWF0aC5tYXgodmFsdWUsIDAuMSk7XG4gICAgICAgIGNvbnN0IHNpemVBdXRvVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIiwgXCJhdXRvXCIpO1xuICAgICAgICBpZiAoIXNpemVBdXRvVmlzVmFyKSB7XG4gICAgICAgICAgICByZW5kZXJlci5zaXplID0gbmV3U2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZFNpemUgPSB0aGlzLmdldFNpemVCeVNjYWxlKHNpemVBdXRvVmlzVmFyLCBtYXBWaWV3LnNjYWxlKTtcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG5ld1NpemUgLyBvbGRTaXplO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVBdXRvU2l6ZVN0b3BzKHNpemVBdXRvVmlzVmFyLCBmYWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZU51bGxWYWx1ZUNoZWNrQ2hhbmdlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBsYXN0RGVmYXVsdCB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBpZiAocmVuZGVyZXIuZGVmYXVsdENvbG9yKSB7XG4gICAgICAgICAgICBsYXN0RGVmYXVsdC5kZWZhdWx0Q29sb3IgPSByZW5kZXJlci5kZWZhdWx0Q29sb3I7XG4gICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0Q29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0Q29sb3IgPSBsYXN0RGVmYXVsdC5kZWZhdWx0Q29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgfVxuICAgIGhhbmRsZVNvcnRMZWdlbmQoaXRlbXMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gcmVuZGVyZXIuYXR0cmlidXRlcy5tYXAoKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5jbG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaXRlbVZhbHVlcyA9IGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgIGF0dHJpYnV0ZXMuc29ydCgoYSwgYikgPT4gaXRlbVZhbHVlcy5pbmRleE9mKGEuZmllbGQpIC0gaXRlbVZhbHVlcy5pbmRleE9mKGIuZmllbGQpKTtcbiAgICAgICAgcmVuZGVyZXIuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBoYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGluZGV4KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKChfYSA9IHRoaXMucG9wb3ZlclNldHRpbmdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMucG9wb3ZlclNldHRpbmdzLmluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF0uZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuU3ltYm9sU3R5bGVyRm9yVmFsdWUoaW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgIHRoaXMub3BlblN5bWJvbFN0eWxlckZvclZhbHVlKGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaW5kZXgsIGxhYmVsKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgbGFzdERlZmF1bHQsIGxheWVyLCBtb2R1bGVzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsUmVuZGVyZXIgPSBtb2R1bGVzLnJlbmRlcmVySnNvblV0aWxzLmZyb21KU09OKHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04pO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIGlmICghbGFiZWwubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSAoKF9hID0gb3JpZ2luYWxSZW5kZXJlci5vdGhlcnNDYXRlZ29yeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxhYmVsKSB8fCBzdHJpbmdzLnBhbmVscy5jaGFydC5vdGhlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGluZGV4ID09PSAtMikge1xuICAgICAgICAgICAgICAgIGxhYmVsID0gc3RyaW5ncy5wYW5lbHMuY2hhcnQubm9EYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IG1hdGNoaW5nSW5mbyA9IG9yaWdpbmFsUmVuZGVyZXIuYXR0cmlidXRlcy5maW5kKChpbmZvKSA9PiBpbmZvLmZpZWxkID09PSByZW5kZXJlci5hdHRyaWJ1dGVzW2luZGV4XS5maWVsZCk7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSBtYXRjaGluZ0luZm8ubGFiZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmVuZGVyZXIub3RoZXJzQ2F0ZWdvcnkgPSByZW5kZXJlci5vdGhlcnNDYXRlZ29yeSB8fCB7XG4gICAgICAgICAgICAgICAgY29sb3I6IGxhc3REZWZhdWx0ID09PSBudWxsIHx8IGxhc3REZWZhdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXN0RGVmYXVsdC5vdGhlckNvbG9yLFxuICAgICAgICAgICAgICAgIHRocmVzaG9sZDogKF9iID0gbGFzdERlZmF1bHQgPT09IG51bGwgfHwgbGFzdERlZmF1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhc3REZWZhdWx0LnRocmVzaG9sZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlbmRlcmVyLm90aGVyc0NhdGVnb3J5LmxhYmVsID0gbGFiZWw7XG4gICAgICAgICAgICBsYXN0RGVmYXVsdC5vdGhlckxhYmVsID0gbGFiZWw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5kZXggPT09IC0yKSB7XG4gICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0TGFiZWwgPSBsYWJlbDtcbiAgICAgICAgICAgIGxhc3REZWZhdWx0LmRlZmF1bHRMYWJlbCA9IGxhYmVsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyZXIuYXR0cmlidXRlcyA9IHJlbmRlcmVyLmF0dHJpYnV0ZXMubWFwKChhdHRyaWJ1dGUsIGlkeDIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaWR4MiA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLmxhYmVsID0gbGFiZWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaW5kZXhdLmlubmVySFRNTCA9IGxhYmVsO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaW5kZXhdLnZhbHVlID0gbGFiZWw7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2luZGV4XS5mb2N1cygpO1xuICAgICAgICB9LCAxMDApO1xuICAgIH1cbiAgICBvcGVuU3ltYm9sU3R5bGVyRm9yVmFsdWUoaW5kZXgpIHtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IGNyZWF0ZVN5bWJvbFN0eWxlclBvcG92ZXIoe1xuICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsXG4gICAgICAgICAgICBoZWFkaW5nOiBzbWFydE1hcHBpbmdTdGF0ZS5zdHJpbmdzLnN0eWxlci5zeW1ib2xTdHlsZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzW2luZGV4XS5mb2N1cygpO1xuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdTdHlsZXJQb3BvdmVyRGlzY29ubmVjdGVkXCIsICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIodGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUpO1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5zZWxlY3RlZEF0dHJpYnV0ZSA9IGluZGV4O1xuICAgICAgICBidWlsZFN5bWJvbFN0eWxlckZvckNoYXJ0VmFsdWUoe1xuICAgICAgICAgICAgcG9wb3Zlck5vZGU6IHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlLFxuICAgICAgICAgICAgb25DaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52YWx1ZVN5bWJvbE5vZGVzW2luZGV4XS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgfVxuICAgIHVwZGF0ZUF1dG9TaXplU3RvcHMoc2l6ZUF1dG9WaXNWYXIsIGZhY3Rvcikge1xuICAgICAgICBzaXplQXV0b1Zpc1Zhci5zdG9wcy5mb3JFYWNoKChzdG9wKSA9PiB7XG4gICAgICAgICAgICBzdG9wLnNpemUgKj0gZmFjdG9yO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0LnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0IGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc19jaGFydCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtY2hhcnQuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG4vKipcbiAqIENhbGwgYSBmdW5jdGlvbiBvbmx5IGFmdGVyIGl0IGhhcyBub3QgYmVlbiBjYWxsZWQgZm9yIG4gbWlsbGlzZWNvbmRzXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIGRlbGF5KSA9PiB7XG4gICAgbGV0IHRpbWVvdXQ7XG4gICAgbGV0IHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgIGZ1bmN0aW9uIGZsdXNoKC4uLmFyZ3MpIHtcbiAgICAgICAgc3RhdHVzID0gXCJmbHVzaGVkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGludm9rZSguLi5hcmdzKSB7XG4gICAgICAgIHN0YXR1cyA9IFwiaW52b2tlZFwiO1xuICAgICAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjYW5jZWwoLi4uYXJncykge1xuICAgICAgICBzdGF0dXMgPSBcImNhbmNlbGxlZFwiO1xuICAgICAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRTdGF0dXMoKSB7XG4gICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgfVxuICAgIGNvbnN0IGRlYm91bmNlZCA9ICguLi5hcmdzKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBcImZsdXNoZWRcIjpcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaW52b2tlZFwiOlxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxsZWRcIjpcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcInBlbmRpbmdcIjtcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgICAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZGVib3VuY2VkLmZsdXNoID0gZmx1c2g7XG4gICAgZGVib3VuY2VkLmludm9rZSA9IGludm9rZTtcbiAgICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsO1xuICAgIGRlYm91bmNlZC5nZXRTdGF0dXMgPSBnZXRTdGF0dXM7XG4gICAgcmV0dXJuIGRlYm91bmNlZDtcbn07XG4vKipcbiAqIENhbGwgYSBmdW5jdGlvbiBvbmx5IGFmdGVyIG4gbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZFxuICogQHBhcmFtIGZuICAgIC0gZnVuY3Rpb24gdG8gY2FsbFxuICogQHBhcmFtIGRlbGF5IC0gZGVsYXkgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmNvbnN0IHRocm90dGxlID0gKGZuLCBkZWxheSkgPT4ge1xuICAgIGxldCB0aW1lb3V0O1xuICAgIHJldHVybiAoLi4uYXJncykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICB0aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgIH0sIGRlbGF5KTtcbiAgICB9KTtcbn07XG5mdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7IC8vICQmIG1lYW5zIHRoZSB3aG9sZSBtYXRjaGVkIHN0cmluZ1xufVxuZnVuY3Rpb24gaXNEZWZpbmVkKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGw7XG59XG4vKipcbiAqIFNldCBhIG1pbmltdW0gdGltZSBmb3IgYSBwcm9taXNlIHRvIHJlc29sdmUgKHVzZWZ1bCBmb3IgcHJldmVudGluZyBmbGFzaCBvZiBsb2FkZXJzKVxuICovXG5hc3luYyBmdW5jdGlvbiBtaW5EZWxheShwcm9taXNlLCBtaW5EZWxheSkge1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFtwcm9taXNlLCB0aW1lb3V0KG1pbkRlbGF5KV0pO1xuICAgIHJldHVybiBwcm9taXNlO1xufVxuLyoqXG4gKiBIZWxwZXIgbWV0aG9kIHRvIGlubGluZSBzZXRUaW1lb3V0IGFzIGFuIGF3YWl0IGluIGFzeW5jIGZ1bmN0aW9uc1xuICovXG5mdW5jdGlvbiB0aW1lb3V0KG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5jb25zdCBhcnJheVRvTG9va3VwTWFwID0gKGRhdGFBcnIsIGdldEtleUFuZEl0ZW0pID0+IE9iamVjdC5mcm9tRW50cmllcygoZGF0YUFyciB8fCBbXSkubWFwKChpdGVtKSA9PiB7XG4gICAgY29uc3QgeyBrZXksIGRhdGEgfSA9IGdldEtleUFuZEl0ZW0oaXRlbSk7XG4gICAgcmV0dXJuIFtrZXksIGRhdGFdO1xufSkpO1xuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHR3byBhcnJheXMgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2YgZWxlbWVudHNcbiAqIGFuZCB3aGV0aGVyIHRoZXkgY29udGFpbiB0aGUgc2FtZSBlbGVtZW50c1xuICogcmVnYXJkbGVzcyBvZiBvcmRlclxuICovXG5jb25zdCBhcnJheXNBcmVFcXVpdmFsZW50ID0gKGFycjEsIGFycjIpID0+IGFycjEubGVuZ3RoID09PSBhcnIyLmxlbmd0aCAmJiBhcnIxLnJlZHVjZSgobWVtbywgc3RyKSA9PiBtZW1vICYmIGFycjIuaW5kZXhPZihzdHIpID4gLTEsIHRydWUpO1xuZnVuY3Rpb24gdW5pcXVlQnkobXlBcnIsIGdldEl0ZW1JZCkge1xuICAgIGNvbnN0IHJlc3VsdEFyciA9IFtdO1xuICAgIGNvbnN0IGxvb2t1cE1hcCA9IHt9O1xuICAgIG15QXJyLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgaWQgPSBnZXRJdGVtSWQoaXRlbSk7XG4gICAgICAgIGlmIChsb29rdXBNYXBbaWRdID09IG51bGwpIHtcbiAgICAgICAgICAgIGxvb2t1cE1hcFtpZF0gPSBpdGVtO1xuICAgICAgICAgICAgcmVzdWx0QXJyLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0QXJyO1xufVxuZnVuY3Rpb24gdW5pcXVlKG15QXJyKSB7XG4gICAgY29uc3QgcHJpbWl0aXZlcyA9IHsgYm9vbGVhbjoge30sIG51bWJlcjoge30sIHN0cmluZzoge30gfTtcbiAgICBjb25zdCBvYmpzID0gW107XG4gICAgcmV0dXJuIG15QXJyLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgICAgICBsZXQgdHlwZSA9IHR5cGVvZiBpdGVtO1xuICAgICAgICBpZiAodHlwZSBpbiBwcmltaXRpdmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJpbWl0aXZlc1t0eXBlXS5oYXNPd25Qcm9wZXJ0eShpdGVtKSA/IGZhbHNlIDogKHByaW1pdGl2ZXNbdHlwZV1baXRlbV0gPSB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvYmpzLmluZGV4T2YoaXRlbSkgPj0gMCA/IGZhbHNlIDogb2Jqcy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5jb25zdCBjaHVuayA9IChhcnIsIHNpemUpID0+IFsuLi5BcnJheShNYXRoLmNlaWwoYXJyLmxlbmd0aCAvIHNpemUpKV0ubWFwKChfLCBpKSA9PiBhcnIuc2xpY2Uoc2l6ZSAqIGksIHNpemUgKyBzaXplICogaSkpO1xuXG5leHBvcnQgeyBhcnJheVRvTG9va3VwTWFwIGFzIGEsIHVuaXF1ZSBhcyBiLCB0aHJvdHRsZSBhcyBjLCBkZWJvdW5jZSBhcyBkLCBlc2NhcGVSZWdFeHAgYXMgZSwgYXJyYXlzQXJlRXF1aXZhbGVudCBhcyBmLCBjaHVuayBhcyBnLCBpc0RlZmluZWQgYXMgaSwgbWluRGVsYXkgYXMgbSwgdGltZW91dCBhcyB0LCB1bmlxdWVCeSBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1bmN0aW9uYWwtNDRkZThmY2YuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5sZXQgX2xvYWRpbmdUaW1lcjtcbmxldCBfcmVxdWVzdENhbmNlbGxlZDtcbmZ1bmN0aW9uIHN0YXJ0TG9hZGluZyhub2RlKSB7XG4gICAgbm9kZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICBfcmVxdWVzdENhbmNlbGxlZCA9IGZhbHNlO1xuICAgIGlmIChfbG9hZGluZ1RpbWVyKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChfbG9hZGluZ1RpbWVyKTtcbiAgICB9XG4gICAgX2xvYWRpbmdUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyB0b29rIHRvbyBsb25nXG4gICAgICAgIGVuZExvYWRpbmcobm9kZSk7XG4gICAgICAgIF9yZXF1ZXN0Q2FuY2VsbGVkID0gdHJ1ZTtcbiAgICB9LCA2MDAwMCk7XG59XG5mdW5jdGlvbiBlbmRMb2FkaW5nKG5vZGUpIHtcbiAgICBub2RlLmxvYWRpbmcgPSBmYWxzZTtcbn1cbmZ1bmN0aW9uIHJlcXVlc3RXcmFwcGVyKHJlcXVlc3QsIG5vZGUpIHtcbiAgICBzdGFydExvYWRpbmcobm9kZSk7XG4gICAgcmV0dXJuIHJlcXVlc3RcbiAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBlbmRMb2FkaW5nKG5vZGUpO1xuICAgICAgICBpZiAoIV9yZXF1ZXN0Q2FuY2VsbGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwidGltZW91dFwiKSk7XG4gICAgICAgIH1cbiAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGVuZExvYWRpbmcobm9kZSk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgfSk7XG59XG5cbmV4cG9ydCB7IHJlcXVlc3RXcmFwcGVyIGFzIHIgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9hZGluZy02OTEzOTkwNy5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=