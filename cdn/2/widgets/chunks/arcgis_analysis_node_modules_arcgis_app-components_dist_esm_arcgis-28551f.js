"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-28551f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-restore-items.entry.js":
/*!***********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-restore-items.entry.js ***!
  \***********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_restore_items: () => (/* binding */ ArcgisRestoreItems)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */












const canRestoreItem = (item, user) => {
    const url = `${user.userContentUrl}/items/${item.id}/canRestore`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url);
};
/** If no folder ID passed, defaults to user's root folder */
const restoreItem = (item, user, folderID) => {
    const url = `${user.userContentUrl}/items/${item.id}/restore`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, { folderID }, {}, "post");
};

const MAX_BULK_RESTORE_ITEMS_COUNT = 20;
const getRestorableItems = async (items, user) => {
    const restorableItems = [];
    const sourceItems = []; // Must be restored before dependent items
    const unrestorableItems = [];
    await Promise.all(items.map(async (item) => {
        var _a;
        try {
            await canRestoreItem(item, user);
            sourceItems.push({ item });
        }
        catch (error) {
            const sharingError = Object.assign({}, error.details.raw);
            switch (sharingError.messageCode) {
                // This item has a related Service item
                case "CONT_00486":
                    {
                        const { offendingItems } = sharingError;
                        const offendingItemIds = (_a = offendingItems === null || offendingItems === void 0 ? void 0 : offendingItems.map((item) => item.itemId)) !== null && _a !== void 0 ? _a : [];
                        if (offendingItemIds.every((id) => items.map((item) => item.id).includes(id))) {
                            restorableItems.push({ item });
                        }
                        else {
                            unrestorableItems.push({ item, error: sharingError });
                        }
                    }
                    break;
                default:
                    unrestorableItems.push({ item, error: sharingError });
                    break;
            }
        }
    }));
    return { restorableItems, sourceItems, unrestorableItems };
};

const arcgisRestoreItemsCss = ".content{display:flex;min-height:72px;flex-direction:column}::slotted([slot=message]){margin-bottom:1rem}:host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}.folder-picker{margin-top:1rem}.divider{margin-left:0px;margin-right:0px;margin-top:1rem;margin-bottom:0px;border-style:none;border-top:1px solid #ccc}arcgis-items-summary:not(:first-of-type){margin-top:2rem}";

const ArcgisRestoreItems = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisRestoreItemsRestore = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisRestoreItemsRestore", 7);
        this.arcgisRestoreItemsClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisRestoreItemsClose", 7);
        this.headerTitle = "";
        this.renderContent = () => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "message" }), this.restoreItemsBuckets.unrestorableItems.length >= 1 && this.renderUnrestorableItems(), this.allRestorableItems.length >= 1 && this.renderRestorableItems()));
        };
        this.renderUnrestorableItems = () => {
            const { i18n, restoreItemsBuckets } = this;
            const { unrestorableItems } = restoreItemsBuckets;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.cannotRestore), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { popoverId: "restore-bucket", summaryGroups: [{ items: unrestorableItems }] })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "description", innerHTML: i18n.dependentItems[unrestorableItems.length === 1 ? "single" : "multiple"].replace("${parent}", `${unrestorableItems[0].item.title}` // Only applies to single item
                ) })), this.allRestorableItems.length > 0 && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("hr", { class: "divider" })));
        };
        this.renderRestorableItems = () => {
            const { i18n } = this;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, i18n.toRestore[this.allRestorableItems.length === 1 ? "single" : "multiple"]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-items-summary-bucket", { popoverId: "restore-bucket", summaryGroups: [{ items: this.allRestorableItems }] }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-folder-picker", { class: "folder-picker", label: this.i18n.restoreTo, user: this.user, onArcgisFolderPickerChange: (e) => (this.folder = e.detail) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, class: "leader-1" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.i18n.noticeMessage))));
        };
        this.handleRestore = async () => {
            this.isLoading = true;
            const { restorableItems, sourceItems } = this.restoreItemsBuckets;
            const { folder } = this;
            // Dependent items cannot be restored until their source item is restored
            const restoredSourceItems = await this.restoreItems(sourceItems.map((bucket) => bucket.item), folder);
            const restoredRemainingItems = await this.restoreItems(restorableItems.map((bucket) => bucket.item), folder);
            this.arcgisRestoreItemsRestore.emit({
                restoredItems: [...restoredSourceItems, ...restoredRemainingItems],
                folder
            });
            this.active = false;
            this.isLoading = false;
        };
        this.restoreItems = async (items, folder = null) => {
            return Promise.all(items.map((item) => restoreItem(item, this.user, folder.id)));
        };
        this.user = undefined;
        this.portal = undefined;
        this.items = [];
        this.active = false;
        this.restoreItemsBuckets = {
            restorableItems: [],
            sourceItems: [],
            unrestorableItems: []
        };
        this.showSelectedItemsCount = true;
        this.isLoading = false;
    }
    async componentWillLoad() {
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
        this.i18n = locale[0];
        this.folder = (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_1__.b)(this.user.username);
        this.determineRestoreState();
    }
    async determineRestoreState(props = { fetch: true }) {
        const { fetch } = props;
        // Sort items into bins on load
        if (fetch) {
            this.isLoading = true;
            this.restoreItemsBuckets = Object.assign({}, (await getRestorableItems(this.items, this.user)));
            this.isLoading = false;
        }
        const { restorableItems, sourceItems } = this.restoreItemsBuckets;
        this.allRestorableItems = [...restorableItems, ...sourceItems];
        this.tooManyItems = this.items.length > MAX_BULK_RESTORE_ITEMS_COUNT;
        this.allSameOwner = this.items.every((item) => item.owner === this.items[0].owner);
        this.canRestore = !this.tooManyItems && this.allSameOwner && this.allRestorableItems.length > 0;
        this.headerTitle = this.i18n[this.items.length > 1 ? "restoreItems" : "restoreItem"];
    }
    render() {
        const { i18n, active, isLoading, headerTitle, renderContent } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: active, widthScale: "s", kind: "brand", outsideCloseDisabled: true, onCalciteModalBeforeClose: () => {
                this.arcgisRestoreItemsClose.emit();
            }, onCalciteModalClose: () => {
                this.active = false;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { slot: "header", class: "header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "header" }, headerTitle)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "content" }, isLoading ? (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-scrim", { loading: true }) : renderContent()), !isLoading && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", "data-id": "cancelButton", onClick: () => {
                this.arcgisRestoreItemsClose.emit();
                this.active = false;
            }, width: "full" }, i18n.cancel), this.canRestore && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", kind: "brand", "data-id": "nextButton", onClick: () => this.handleRestore(), width: "full", disabled: isLoading }, i18n.restore))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "items": ["determineRestoreState"]
    }; }
};
ArcgisRestoreItems.style = arcgisRestoreItemsCss;



//# sourceMappingURL=arcgis-restore-items.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getFolderFromId),
/* harmony export */   b: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   e: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders),
/* harmony export */   u: () => (/* binding */ updateFolder)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



async function fetchUser(username, portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
    var _a;
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return [];
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return null;
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return self.favGroupId;
}
function getUserContentUrl(user, portal) {
    var _a;
    return (_a = user === null || user === void 0 ? void 0 : user.userContentUrl) !== null && _a !== void 0 ? _a : `${portal === null || portal === void 0 ? void 0 : portal.restUrl}/content/users/${user.username}`;
}
async function getUserContent(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
    const url = getUserContentUrl(user, portal);
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { num: 1 });
    return Promise.resolve(response);
}
async function getFolders(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const { folders } = await getUserContent(user);
    const { username } = user;
    const sortedFolders = folders.sort((a, b) => a.title.localeCompare(b.title));
    // add the home folder as if it's in the list
    return [{ username, id: username, title: username, created: "now" }, ...sortedFolders];
}
async function getFolderFromId(folderId, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const folders = await getFolders(user);
    return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
    return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/createFolder`;
    const folderResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
    return folderResponse;
}
async function updateFolder(id, newTitle, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/${id}/updateFolder`;
    try {
        const result = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { newTitle }, {}, "post");
        return { result };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=user-3ea69c3a.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTI4NTUxZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNpSDtBQUNsRDtBQUNPO0FBQ2xCO0FBQ3RCO0FBQ0Q7QUFDRjtBQUNTO0FBQ0Q7QUFDUjtBQUNPOztBQUVsQztBQUNBLG1CQUFtQixvQkFBb0IsU0FBUyxRQUFRO0FBQ3hELFdBQVcsc0RBQU87QUFDbEI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG9CQUFvQixTQUFTLFFBQVE7QUFDeEQsV0FBVyxzREFBTyxRQUFRLFVBQVUsSUFBSTtBQUN4Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixNQUFNO0FBQ3JDO0FBQ0E7QUFDQSxpREFBaUQ7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsaUJBQWlCO0FBQ2pEO0FBQ0E7QUFDQSxtREFBbUQsTUFBTTtBQUN6RDtBQUNBO0FBQ0EscURBQXFELDJCQUEyQjtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QywyQkFBMkI7QUFDeEU7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLGFBQWE7QUFDYjs7QUFFQSx3Q0FBd0MsYUFBYSxnQkFBZ0Isc0JBQXNCLDBCQUEwQixtQkFBbUIsTUFBTSxhQUFhLHNCQUFzQixzQ0FBc0MsZUFBZSxnQkFBZ0IsU0FBUyxnQkFBZ0IsaUJBQWlCLGdCQUFnQixrQkFBa0Isa0JBQWtCLDBCQUEwQix5Q0FBeUMsZ0JBQWdCOztBQUV2YTtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIseUNBQXlDLHFEQUFXO0FBQ3BELHVDQUF1QyxxREFBVztBQUNsRDtBQUNBO0FBQ0Esb0JBQW9CLHFEQUFDLENBQUMsaURBQVEsUUFBUSxxREFBQyxX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REFBTyxRQUFRLFVBQVUsSUFBSTtBQUMxRCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQixTQUFTO0FBQzFCO0FBQ0E7O0FBRW9NOztBQUVwTSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1yZXN0b3JlLWl0ZW1zLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMDUwYjZkYjkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdXNlci0zZWE2OWMzYS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBiIGFzIGdldEhvbWVGb2xkZXJGb3JVc2VyIH0gZnJvbSAnLi91c2VyLTNlYTY5YzNhLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL3VybC00YzNhZTU0Yy5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5cbmNvbnN0IGNhblJlc3RvcmVJdGVtID0gKGl0ZW0sIHVzZXIpID0+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9pdGVtcy8ke2l0ZW0uaWR9L2NhblJlc3RvcmVgO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCk7XG59O1xuLyoqIElmIG5vIGZvbGRlciBJRCBwYXNzZWQsIGRlZmF1bHRzIHRvIHVzZXIncyByb290IGZvbGRlciAqL1xuY29uc3QgcmVzdG9yZUl0ZW0gPSAoaXRlbSwgdXNlciwgZm9sZGVySUQpID0+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9pdGVtcy8ke2l0ZW0uaWR9L3Jlc3RvcmVgO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCwgeyBmb2xkZXJJRCB9LCB7fSwgXCJwb3N0XCIpO1xufTtcblxuY29uc3QgTUFYX0JVTEtfUkVTVE9SRV9JVEVNU19DT1VOVCA9IDIwO1xuY29uc3QgZ2V0UmVzdG9yYWJsZUl0ZW1zID0gYXN5bmMgKGl0ZW1zLCB1c2VyKSA9PiB7XG4gICAgY29uc3QgcmVzdG9yYWJsZUl0ZW1zID0gW107XG4gICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXTsgLy8gTXVzdCBiZSByZXN0b3JlZCBiZWZvcmUgZGVwZW5kZW50IGl0ZW1zXG4gICAgY29uc3QgdW5yZXN0b3JhYmxlSXRlbXMgPSBbXTtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChpdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2FuUmVzdG9yZUl0ZW0oaXRlbSwgdXNlcik7XG4gICAgICAgICAgICBzb3VyY2VJdGVtcy5wdXNoKHsgaXRlbSB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoYXJpbmdFcnJvciA9IE9iamVjdC5hc3NpZ24oe30sIGVycm9yLmRldGFpbHMucmF3KTtcbiAgICAgICAgICAgIHN3aXRjaCAoc2hhcmluZ0Vycm9yLm1lc3NhZ2VDb2RlKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpdGVtIGhhcyBhIHJlbGF0ZWQgU2VydmljZSBpdGVtXG4gICAgICAgICAgICAgICAgY2FzZSBcIkNPTlRfMDA0ODZcIjpcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBvZmZlbmRpbmdJdGVtcyB9ID0gc2hhcmluZ0Vycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2ZmZW5kaW5nSXRlbUlkcyA9IChfYSA9IG9mZmVuZGluZ0l0ZW1zID09PSBudWxsIHx8IG9mZmVuZGluZ0l0ZW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvZmZlbmRpbmdJdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uaXRlbUlkKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2ZmZW5kaW5nSXRlbUlkcy5ldmVyeSgoaWQpID0+IGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5pZCkuaW5jbHVkZXMoaWQpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RvcmFibGVJdGVtcy5wdXNoKHsgaXRlbSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVucmVzdG9yYWJsZUl0ZW1zLnB1c2goeyBpdGVtLCBlcnJvcjogc2hhcmluZ0Vycm9yIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHVucmVzdG9yYWJsZUl0ZW1zLnB1c2goeyBpdGVtLCBlcnJvcjogc2hhcmluZ0Vycm9yIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pKTtcbiAgICByZXR1cm4geyByZXN0b3JhYmxlSXRlbXMsIHNvdXJjZUl0ZW1zLCB1bnJlc3RvcmFibGVJdGVtcyB9O1xufTtcblxuY29uc3QgYXJjZ2lzUmVzdG9yZUl0ZW1zQ3NzID0gXCIuY29udGVudHtkaXNwbGF5OmZsZXg7bWluLWhlaWdodDo3MnB4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn06OnNsb3R0ZWQoW3Nsb3Q9bWVzc2FnZV0pe21hcmdpbi1ib3R0b206MXJlbX06aG9zdHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMSl9LmZvbGRlci1waWNrZXJ7bWFyZ2luLXRvcDoxcmVtfS5kaXZpZGVye21hcmdpbi1sZWZ0OjBweDttYXJnaW4tcmlnaHQ6MHB4O21hcmdpbi10b3A6MXJlbTttYXJnaW4tYm90dG9tOjBweDtib3JkZXItc3R5bGU6bm9uZTtib3JkZXItdG9wOjFweCBzb2xpZCAjY2NjfWFyY2dpcy1pdGVtcy1zdW1tYXJ5Om5vdCg6Zmlyc3Qtb2YtdHlwZSl7bWFyZ2luLXRvcDoycmVtfVwiO1xuXG5jb25zdCBBcmNnaXNSZXN0b3JlSXRlbXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1Jlc3RvcmVJdGVtc1Jlc3RvcmUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1Jlc3RvcmVJdGVtc1Jlc3RvcmVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzUmVzdG9yZUl0ZW1zQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1Jlc3RvcmVJdGVtc0Nsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmhlYWRlclRpdGxlID0gXCJcIjtcbiAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50ID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwic2xvdFwiLCB7IG5hbWU6IFwibWVzc2FnZVwiIH0pLCB0aGlzLnJlc3RvcmVJdGVtc0J1Y2tldHMudW5yZXN0b3JhYmxlSXRlbXMubGVuZ3RoID49IDEgJiYgdGhpcy5yZW5kZXJVbnJlc3RvcmFibGVJdGVtcygpLCB0aGlzLmFsbFJlc3RvcmFibGVJdGVtcy5sZW5ndGggPj0gMSAmJiB0aGlzLnJlbmRlclJlc3RvcmFibGVJdGVtcygpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyVW5yZXN0b3JhYmxlSXRlbXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4sIHJlc3RvcmVJdGVtc0J1Y2tldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHVucmVzdG9yYWJsZUl0ZW1zIH0gPSByZXN0b3JlSXRlbXNCdWNrZXRzO1xuICAgICAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnlcIiwgbnVsbCwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBoKFwic3BhblwiLCBudWxsLCBpMThuLmNhbm5vdFJlc3RvcmUpLCBoKFwiYXJjZ2lzLWl0ZW1zLXN1bW1hcnktYnVja2V0XCIsIHsgcG9wb3ZlcklkOiBcInJlc3RvcmUtYnVja2V0XCIsIHN1bW1hcnlHcm91cHM6IFt7IGl0ZW1zOiB1bnJlc3RvcmFibGVJdGVtcyB9XSB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImRlc2NyaXB0aW9uXCIsIGlubmVySFRNTDogaTE4bi5kZXBlbmRlbnRJdGVtc1t1bnJlc3RvcmFibGVJdGVtcy5sZW5ndGggPT09IDEgPyBcInNpbmdsZVwiIDogXCJtdWx0aXBsZVwiXS5yZXBsYWNlKFwiJHtwYXJlbnR9XCIsIGAke3VucmVzdG9yYWJsZUl0ZW1zWzBdLml0ZW0udGl0bGV9YCAvLyBPbmx5IGFwcGxpZXMgdG8gc2luZ2xlIGl0ZW1cbiAgICAgICAgICAgICAgICApIH0pKSwgdGhpcy5hbGxSZXN0b3JhYmxlSXRlbXMubGVuZ3RoID4gMCAmJiBoKFwiaHJcIiwgeyBjbGFzczogXCJkaXZpZGVyXCIgfSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW5kZXJSZXN0b3JhYmxlSXRlbXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJhcmNnaXMtaXRlbXMtc3VtbWFyeVwiLCBudWxsLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIGgoXCJzcGFuXCIsIG51bGwsIGkxOG4udG9SZXN0b3JlW3RoaXMuYWxsUmVzdG9yYWJsZUl0ZW1zLmxlbmd0aCA9PT0gMSA/IFwic2luZ2xlXCIgOiBcIm11bHRpcGxlXCJdKSwgaChcImFyY2dpcy1pdGVtcy1zdW1tYXJ5LWJ1Y2tldFwiLCB7IHBvcG92ZXJJZDogXCJyZXN0b3JlLWJ1Y2tldFwiLCBzdW1tYXJ5R3JvdXBzOiBbeyBpdGVtczogdGhpcy5hbGxSZXN0b3JhYmxlSXRlbXMgfV0gfSkpKSwgaChcImFyY2dpcy1mb2xkZXItcGlja2VyXCIsIHsgY2xhc3M6IFwiZm9sZGVyLXBpY2tlclwiLCBsYWJlbDogdGhpcy5pMThuLnJlc3RvcmVUbywgdXNlcjogdGhpcy51c2VyLCBvbkFyY2dpc0ZvbGRlclBpY2tlckNoYW5nZTogKGUpID0+ICh0aGlzLmZvbGRlciA9IGUuZGV0YWlsKSB9KSwgaChcImNhbGNpdGUtbm90aWNlXCIsIHsgb3BlbjogdHJ1ZSwgY2xhc3M6IFwibGVhZGVyLTFcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgdGhpcy5pMThuLm5vdGljZU1lc3NhZ2UpKSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVJlc3RvcmUgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3RvcmFibGVJdGVtcywgc291cmNlSXRlbXMgfSA9IHRoaXMucmVzdG9yZUl0ZW1zQnVja2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgZm9sZGVyIH0gPSB0aGlzO1xuICAgICAgICAgICAgLy8gRGVwZW5kZW50IGl0ZW1zIGNhbm5vdCBiZSByZXN0b3JlZCB1bnRpbCB0aGVpciBzb3VyY2UgaXRlbSBpcyByZXN0b3JlZFxuICAgICAgICAgICAgY29uc3QgcmVzdG9yZWRTb3VyY2VJdGVtcyA9IGF3YWl0IHRoaXMucmVzdG9yZUl0ZW1zKHNvdXJjZUl0ZW1zLm1hcCgoYnVja2V0KSA9PiBidWNrZXQuaXRlbSksIGZvbGRlcik7XG4gICAgICAgICAgICBjb25zdCByZXN0b3JlZFJlbWFpbmluZ0l0ZW1zID0gYXdhaXQgdGhpcy5yZXN0b3JlSXRlbXMocmVzdG9yYWJsZUl0ZW1zLm1hcCgoYnVja2V0KSA9PiBidWNrZXQuaXRlbSksIGZvbGRlcik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1Jlc3RvcmVJdGVtc1Jlc3RvcmUuZW1pdCh7XG4gICAgICAgICAgICAgICAgcmVzdG9yZWRJdGVtczogWy4uLnJlc3RvcmVkU291cmNlSXRlbXMsIC4uLnJlc3RvcmVkUmVtYWluaW5nSXRlbXNdLFxuICAgICAgICAgICAgICAgIGZvbGRlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZXN0b3JlSXRlbXMgPSBhc3luYyAoaXRlbXMsIGZvbGRlciA9IG51bGwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChpdGVtcy5tYXAoKGl0ZW0pID0+IHJlc3RvcmVJdGVtKGl0ZW0sIHRoaXMudXNlciwgZm9sZGVyLmlkKSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLml0ZW1zID0gW107XG4gICAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVzdG9yZUl0ZW1zQnVja2V0cyA9IHtcbiAgICAgICAgICAgIHJlc3RvcmFibGVJdGVtczogW10sXG4gICAgICAgICAgICBzb3VyY2VJdGVtczogW10sXG4gICAgICAgICAgICB1bnJlc3RvcmFibGVJdGVtczogW11cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zaG93U2VsZWN0ZWRJdGVtc0NvdW50ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgdGhpcy5mb2xkZXIgPSBnZXRIb21lRm9sZGVyRm9yVXNlcih0aGlzLnVzZXIudXNlcm5hbWUpO1xuICAgICAgICB0aGlzLmRldGVybWluZVJlc3RvcmVTdGF0ZSgpO1xuICAgIH1cbiAgICBhc3luYyBkZXRlcm1pbmVSZXN0b3JlU3RhdGUocHJvcHMgPSB7IGZldGNoOiB0cnVlIH0pIHtcbiAgICAgICAgY29uc3QgeyBmZXRjaCB9ID0gcHJvcHM7XG4gICAgICAgIC8vIFNvcnQgaXRlbXMgaW50byBiaW5zIG9uIGxvYWRcbiAgICAgICAgaWYgKGZldGNoKSB7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVJdGVtc0J1Y2tldHMgPSBPYmplY3QuYXNzaWduKHt9LCAoYXdhaXQgZ2V0UmVzdG9yYWJsZUl0ZW1zKHRoaXMuaXRlbXMsIHRoaXMudXNlcikpKTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyByZXN0b3JhYmxlSXRlbXMsIHNvdXJjZUl0ZW1zIH0gPSB0aGlzLnJlc3RvcmVJdGVtc0J1Y2tldHM7XG4gICAgICAgIHRoaXMuYWxsUmVzdG9yYWJsZUl0ZW1zID0gWy4uLnJlc3RvcmFibGVJdGVtcywgLi4uc291cmNlSXRlbXNdO1xuICAgICAgICB0aGlzLnRvb01hbnlJdGVtcyA9IHRoaXMuaXRlbXMubGVuZ3RoID4gTUFYX0JVTEtfUkVTVE9SRV9JVEVNU19DT1VOVDtcbiAgICAgICAgdGhpcy5hbGxTYW1lT3duZXIgPSB0aGlzLml0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtLm93bmVyID09PSB0aGlzLml0ZW1zWzBdLm93bmVyKTtcbiAgICAgICAgdGhpcy5jYW5SZXN0b3JlID0gIXRoaXMudG9vTWFueUl0ZW1zICYmIHRoaXMuYWxsU2FtZU93bmVyICYmIHRoaXMuYWxsUmVzdG9yYWJsZUl0ZW1zLmxlbmd0aCA+IDA7XG4gICAgICAgIHRoaXMuaGVhZGVyVGl0bGUgPSB0aGlzLmkxOG5bdGhpcy5pdGVtcy5sZW5ndGggPiAxID8gXCJyZXN0b3JlSXRlbXNcIiA6IFwicmVzdG9yZUl0ZW1cIl07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBhY3RpdmUsIGlzTG9hZGluZywgaGVhZGVyVGl0bGUsIHJlbmRlckNvbnRlbnQgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbW9kYWxcIiwgeyBvcGVuOiBhY3RpdmUsIHdpZHRoU2NhbGU6IFwic1wiLCBraW5kOiBcImJyYW5kXCIsIG91dHNpZGVDbG9zZURpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVNb2RhbEJlZm9yZUNsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNSZXN0b3JlSXRlbXNDbG9zZS5lbWl0KCk7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVNb2RhbENsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiaGVhZGVyXCIgfSwgaGVhZGVyVGl0bGUpKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBjbGFzczogXCJjb250ZW50XCIgfSwgaXNMb2FkaW5nID8gaChcImNhbGNpdGUtc2NyaW1cIiwgeyBsb2FkaW5nOiB0cnVlIH0pIDogcmVuZGVyQ29udGVudCgpKSwgIWlzTG9hZGluZyAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJzZWNvbmRhcnlcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgXCJkYXRhLWlkXCI6IFwiY2FuY2VsQnV0dG9uXCIsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1Jlc3RvcmVJdGVtc0Nsb3NlLmVtaXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSwgd2lkdGg6IFwiZnVsbFwiIH0sIGkxOG4uY2FuY2VsKSwgdGhpcy5jYW5SZXN0b3JlICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCBraW5kOiBcImJyYW5kXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVSZXN0b3JlKCksIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6IGlzTG9hZGluZyB9LCBpMThuLnJlc3RvcmUpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcIml0ZW1zXCI6IFtcImRldGVybWluZVJlc3RvcmVTdGF0ZVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNSZXN0b3JlSXRlbXMuc3R5bGUgPSBhcmNnaXNSZXN0b3JlSXRlbXNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1Jlc3RvcmVJdGVtcyBhcyBhcmNnaXNfcmVzdG9yZV9pdGVtcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtcmVzdG9yZS1pdGVtcy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hVc2VyKHVzZXJuYW1lLCBwb3J0YWwpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvdXNlcnMvJHt1c2VybmFtZX1gKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU2VsZigpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfS9jb21tdW5pdHkvc2VsZmApO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcygpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHNlbGYgPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gZmV0Y2hTZWxmKCksIFwiY29tbXVuaXR5U2VsZlwiLCB1c2VyLnVzZXJuYW1lKTtcbiAgICByZXR1cm4gKF9hID0gc2VsZiA9PT0gbnVsbCB8fCBzZWxmID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxmLmdyb3VwcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG59XG5hc3luYyBmdW5jdGlvbiBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAoKSB7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaFNlbGYoKSwgXCJjb21tdW5pdHlTZWxmXCIsIHVzZXIudXNlcm5hbWUpO1xuICAgIHJldHVybiBzZWxmLmZhdkdyb3VwSWQ7XG59XG5mdW5jdGlvbiBnZXRVc2VyQ29udGVudFVybCh1c2VyLCBwb3J0YWwpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci51c2VyQ29udGVudFVybCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYCR7cG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnJlc3RVcmx9L2NvbnRlbnQvdXNlcnMvJHt1c2VyLnVzZXJuYW1lfWA7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyQ29udGVudChwb3J0YWxVc2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgICBjb25zdCBwb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgY29uc3QgdXJsID0gZ2V0VXNlckNvbnRlbnRVcmwodXNlciwgcG9ydGFsKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IG51bTogMSB9KTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlcnMocG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgeyBmb2xkZXJzIH0gPSBhd2FpdCBnZXRVc2VyQ29udGVudCh1c2VyKTtcbiAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSB1c2VyO1xuICAgIGNvbnN0IHNvcnRlZEZvbGRlcnMgPSBmb2xkZXJzLnNvcnQoKGEsIGIpID0+IGEudGl0bGUubG9jYWxlQ29tcGFyZShiLnRpdGxlKSk7XG4gICAgLy8gYWRkIHRoZSBob21lIGZvbGRlciBhcyBpZiBpdCdzIGluIHRoZSBsaXN0XG4gICAgcmV0dXJuIFt7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9LCAuLi5zb3J0ZWRGb2xkZXJzXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlckZyb21JZChmb2xkZXJJZCwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gICAgcmV0dXJuIGZvbGRlcnMuZmluZCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQgPT09IGZvbGRlcklkKTtcbn1cbmZ1bmN0aW9uIGdldEhvbWVGb2xkZXJGb3JVc2VyKHVzZXJuYW1lKSB7XG4gICAgcmV0dXJuIHsgdXNlcm5hbWUsIGlkOiB1c2VybmFtZSwgdGl0bGU6IHVzZXJuYW1lLCBjcmVhdGVkOiBcIm5vd1wiIH07XG59XG5hc3luYyBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoZm9sZGVyTmFtZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vY3JlYXRlRm9sZGVyYDtcbiAgICBjb25zdCBmb2xkZXJSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IHRpdGxlOiBmb2xkZXJOYW1lIH0sIHt9LCBcInBvc3RcIik7XG4gICAgcmV0dXJuIGZvbGRlclJlc3BvbnNlO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRm9sZGVyKGlkLCBuZXdUaXRsZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vJHtpZH0vdXBkYXRlRm9sZGVyYDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0KHVybCwgeyBuZXdUaXRsZSB9LCB7fSwgXCJwb3N0XCIpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBnZXRGb2xkZXJGcm9tSWQgYXMgYSwgZ2V0SG9tZUZvbGRlckZvclVzZXIgYXMgYiwgY3JlYXRlRm9sZGVyIGFzIGMsIGdldFNpZ25lZEluVXNlcnNHcm91cHMgYXMgZCwgZ2V0U2lnbmVkSW5Vc2Vyc0Zhdm9yaXRlc0dyb3VwIGFzIGUsIGZldGNoVXNlciBhcyBmLCBnZXRGb2xkZXJzIGFzIGcsIHVwZGF0ZUZvbGRlciBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZXItM2VhNjljM2EuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9