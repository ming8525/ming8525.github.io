"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-90abf8"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-publish-item-pages-item-properties.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-publish-item-pages-item-properties.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_publish_item_pages_item_properties: () => (/* binding */ ArcgisPublishItemPagesItemProperties)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _image_collection_5b662b80_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./image-collection-5b662b80.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js");
/* harmony import */ var _publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./publish-item-17d2f9a3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-17d2f9a3.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _utils_9b3ffcf7_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./utils-9b3ffcf7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/* harmony import */ var _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./store-1a7c9ea6.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-1a7c9ea6.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










































const arcgisPublishItemPagesItemPropertiesCss = ".layer-description.sc-arcgis-publish-item-pages-item-properties{display:block;margin-bottom:0.75rem}.locator__heading.sc-arcgis-publish-item-pages-item-properties{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px;margin-bottom:2px}.locator__description.sc-arcgis-publish-item-pages-item-properties{margin:0px;margin-bottom:1rem;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-1)}.medium.sc-arcgis-publish-item-pages-item-properties{--arcgis-label-font-weight:500}.info-container.sc-arcgis-publish-item-pages-item-properties{margin-bottom:1.5rem}";

var __asyncValues = ( false) || function (o) {
    if (!Symbol.asyncIterator)
        throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function (v) { resolve({ value: v, done: d }); }, reject); }
};
const MAX_TITLE_LENGTH = 250;
const ArcgisPublishItemPagesItemProperties = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.arcgisWorkflowUpdateError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisWorkflowUpdateError", 7);
        this.workflowCancelled = false;
        this.handleRequest = async () => {
            const { categories, title } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_5__.i;
            // Don't send request if an error is reported
            if (!(await this.validate())) {
                this.arcgisWorkflowUpdateError.emit(this.errorMessage);
                return;
            }
            if ((title === null || title === void 0 ? void 0 : title.length) > MAX_TITLE_LENGTH) {
                this.titleRef.title = title.substring(0, MAX_TITLE_LENGTH);
            }
            try {
                // TODO: Repair telemetry
                // Telemetry: Begin upload tracking workflow
                // logAddNewItemStart();
                const { publishResponse } = await this.publishItem();
                categories &&
                    (await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.u)({
                        portal: this.portal,
                        itemIds: [publishResponse.id],
                        categories
                    }));
                if (!this.workflowCancelled) {
                    // Telemetry: Only log telemetry after successful upload
                    // logItemPropertiesChanges();
                    // logSuccessfulItemCreation();
                    // configState.telemetry && (await timeout(750));
                    const emitPayload = Object.assign({}, publishResponse);
                    // Current publish dialog expects this as the payload:
                    // const { id, response, jobId, serviceType, item, newItemMode } = e.detail;
                    // TODO: Remove new-item specific properties
                    this.workflowComplete.emit(emitPayload);
                }
                else {
                    (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_8__.d)(publishResponse.id));
                    this.workflowCancel.emit();
                }
                (0,_utils_9b3ffcf7_js__WEBPACK_IMPORTED_MODULE_9__.r)();
            }
            catch (error) {
                console.error(error);
                this.errorMessage = this.parseError(error.code);
                this.arcgisWorkflowUpdateError.emit(this.errorMessage);
                this.showLoader(false);
            }
        };
        this.item = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.errorMessage = undefined;
        this.loading = false;
        this.loaderType = "indeterminate";
        this.loaderMessage = undefined;
    }
    /**
     * Checks each field, short-circuiting on the first one to fail. Populates this.errorMessage internally
     */
    async validate() {
        var _a, _b, _c;
        const titleError = await ((_a = this.titleRef) === null || _a === void 0 ? void 0 : _a.validateTitle());
        if (titleError) {
            this.errorMessage = {
                title: _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n.error.title,
                description: titleError.translatedMessage
            };
            this.titleRef.focusMainInput();
            return false;
        }
        // TODO: connect folder component to error structure
        // Also, updating the new title in a folder picker doesn't emit an itemProperties change event,
        // so the error doesn't clear unless the folder is actually changed
        const folderResponse = await ((_b = this.itemPropertiesFolderRef) === null || _b === void 0 ? void 0 : _b.saveActiveFolder());
        if (!!folderResponse) {
            if (typeof folderResponse === "boolean" && !folderResponse) {
                return false;
            }
            else if (typeof folderResponse === "string") {
                this.errorMessage = {
                    title: _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n.error.title,
                    description: folderResponse
                };
                return false;
            }
        }
        const summaryError = await ((_c = this.summaryRef) === null || _c === void 0 ? void 0 : _c.getErrorMessage());
        if (summaryError) {
            this.errorMessage = {
                title: _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n.error.title,
                description: summaryError.translatedMessage
            };
            return false;
        }
        return true;
    }
    async navigateToNextPage() {
        this.handleRequest();
    }
    async componentWillLoad() {
        var _a, _b;
        // Grab common workflow state
        _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n = _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n;
        // Grab publishItem workflow state
        (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal);
        (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user);
        if (!this.item) {
            console.error("No item found");
            // TODO: create error message
            this.arcgisWorkflowUpdateError.emit(this.errorMessage);
            return;
        }
        // TODO: check if this should grab the item owner instead of current user
        this.folder = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_2__.a)(this.item.ownerFolder, this.user);
    }
    async publishItem() {
        const { id, type } = this.item;
        const addResponse = { success: true, id, folder: null };
        const publishResponse = type === "Image Collection"
            ? await this.publishImageCollection(addResponse)
            : await this.publishService(id);
        await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_7__.a)(publishResponse, this.user);
        return { addResponse, publishResponse };
    }
    async publishService(id) {
        var _a;
        const { type } = this.item;
        const extension = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__.a[type].fileExt[0];
        this.showLoader(true, {
            loaderType: "indeterminate",
            loaderMessage: _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n.publishingService
        });
        const { result: publishResponse, error } = await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_7__.p)({
            itemId: id,
            user: this.user,
            title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_5__.i.title,
            extension,
            type: type
        });
        if (error) {
            console.error("there was an error", error);
        }
        else {
            const service = (_a = publishResponse.services) === null || _a === void 0 ? void 0 : _a[0];
            return {
                success: true,
                id: service === null || service === void 0 ? void 0 : service.serviceItemId,
                jobId: service === null || service === void 0 ? void 0 : service.jobId,
                serviceType: service === null || service === void 0 ? void 0 : service.type,
                serviceUrl: service === null || service === void 0 ? void 0 : service.serviceurl
            };
        }
    }
    async publishImageCollection(addItemResponse) {
        var _a, e_1, _b, _c;
        const { config, user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        this.showLoader(true, {
            loaderType: "indeterminate",
            loaderMessage: _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n.publishingService
        });
        const imageCollectionGenerator = (0,_image_collection_5b662b80_js__WEBPACK_IMPORTED_MODULE_6__.c)(addItemResponse, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_5__.i.title, { config, user, portal });
        try {
            for (var _d = true, imageCollectionGenerator_1 = __asyncValues(imageCollectionGenerator), imageCollectionGenerator_1_1; imageCollectionGenerator_1_1 = await imageCollectionGenerator_1.next(), _a = imageCollectionGenerator_1_1.done, !_a; _d = true) {
                _c = imageCollectionGenerator_1_1.value;
                _d = false;
                const status = _c;
                if (typeof status === "string") {
                    this.updateLoader("indeterminate", _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p.i18n[status]);
                }
                else {
                    return {
                        success: true,
                        id: status.serviceItemId,
                        jobId: null,
                        serviceType: status.type,
                        serviceUrl: status.serviceurl
                    };
                }
            }
        }
        catch (e_1_1) {
            e_1 = { error: e_1_1 };
        }
        finally {
            try {
                if (!_d && !_a && (_b = imageCollectionGenerator_1.return))
                    await _b.call(imageCollectionGenerator_1);
            }
            finally {
                if (e_1)
                    throw e_1.error;
            }
        }
    }
    showLoader(show, update) {
        if (update) {
            this.updateLoader(update.loaderType, update.loaderMessage);
        }
        if (show) {
            this.newItemToggleNavigationEnabled.emit(false);
            this.loading = true;
        }
        else {
            this.newItemToggleNavigationEnabled.emit(true);
            this.loading = false;
        }
    }
    updateLoader(loaderType, loaderMessage) {
        this.loaderType = loaderType;
        this.loaderMessage = loaderMessage;
    }
    parseError(code) {
        var _a, _b, _c, _d;
        const { i18n } = _store_1a7c9ea6_js__WEBPACK_IMPORTED_MODULE_12__.p;
        return {
            title: (_b = (_a = i18n.error[code]) === null || _a === void 0 ? void 0 : _a.title) !== null && _b !== void 0 ? _b : "no error code title",
            description: (_d = (_c = i18n.error[code]) === null || _c === void 0 ? void 0 : _c.description) !== null && _d !== void 0 ? _d : "no error code description"
        };
    }
    render() {
        if (!this.item) {
            return;
        }
        const { type } = this.item;
        const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, value: _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_11__.w.uploadProgress, active: this.loading, text: this.loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-properties", {
            // Clear errors on any modification
            onArcgisItemPropertiesChange: () => this.arcgisWorkflowUpdateError.emit(null)
        }, type !== "Service Definition" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-title-input", { itemTitle: this.item.title, class: "medium", currentFolder: this.item.ownerFolder, type: type, enablePublishing: true, ref: (ele) => {
                this.titleRef = ele;
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-folder-picker", { class: "medium", ref: (ele) => (this.itemPropertiesFolderRef = ele), folder: this.folder }), !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_4__.a)(user) && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-categories-picker", { class: "medium" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tags-picker", { class: "medium" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-summary-input", { class: "medium", ref: (ele) => (this.summaryRef = ele) }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisPublishItemPagesItemProperties.style = arcgisPublishItemPagesItemPropertiesCss;



//# sourceMappingURL=arcgis-publish-item-pages-item-properties.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getGroupRestBaseUrl)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const getGroupRestBaseUrl = (portal, group) => (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.a)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/groups/${group.id}`);



//# sourceMappingURL=group-6a6303b0.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createImageCollection)
/* harmony export */ });
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





var __await = ( false) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); };
var __asyncGenerator = ( false) || function (thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
};
/**
 * Given an item, create a new service
 */
function createImageCollection(response, title, configOptions) {
    return __asyncGenerator(this, arguments, function* createImageCollection_1() {
        const { config, portal, user } = configOptions;
        const { item } = yield __await(fetchItem(response, user));
        const template = yield __await((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.v)(portal));
        yield yield __await("publishingService");
        const isNotInRootFolder = item.ownerFolder && item.ownerFolder !== "/" && item.ownerFolder !== "root";
        const tempTitle = `${title}---${(0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_0__.g)()}`;
        const { createServiceResponse, addToDefinitionResponse } = yield __await((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.w)(Object.assign({ name: isNotInRootFolder ? tempTitle : title, layers: (template === null || template === void 0 ? void 0 : template.layers) || [], tables: (template === null || template === void 0 ? void 0 : template.tables) || [] }, template), { config, user }));
        if (isNotInRootFolder) {
            yield __await((0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__.m)(createServiceResponse.itemId, item.ownerFolder));
            yield __await((0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__.u)(createServiceResponse.itemId, { title }));
        }
        yield yield __await("appendingPhotos");
        const { statusUrl } = yield __await(appendPhotos(createServiceResponse, addToDefinitionResponse, item));
        yield __await(addRelationship(createServiceResponse, item, user));
        yield yield __await("checkingStatus");
        yield __await((0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.p)(statusUrl));
        yield yield __await(createServiceResponse);
    });
}
function fetchItem(item, user) {
    const url = `${user.userContentUrl}/items/${item.id}`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url);
}
function appendPhotos(createServiceResponse, addToDefinitionResponse, item) {
    var _a;
    const layer = addToDefinitionResponse.layers[0];
    const url = `${createServiceResponse.encodedServiceURL}/${(_a = layer.id) !== null && _a !== void 0 ? _a : 0}/append`;
    const content = {
        appendItemId: item.id,
        appendUploadFormat: "imageCollection",
        appendAttachmentsInfo: JSON.stringify({ ignoreAttachmentsWithoutLocation: true }),
        upsert: false,
        useGlobalIds: false,
        rollbackOnFailure: true
    };
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}
function addRelationship(createServiceResponse, item, user) {
    const url = `${user.userContentUrl}/addRelationship`;
    const content = {
        relationshipType: "Service2Data",
        destinationItemId: item.id,
        originItemId: createServiceResponse.itemId
    };
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}



//# sourceMappingURL=image-collection-5b662b80.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-1a7c9ea6.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-1a7c9ea6.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   p: () => (/* binding */ publishItemState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const publishItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    sourceItem: null,
    i18n: null
});
const publishItemState = publishItemStore.state;



//# sourceMappingURL=store-1a7c9ea6.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ resetStoreOnHome),
/* harmony export */   r: () => (/* binding */ resetAddItemStores)
/* harmony export */ });
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function resetAddItemStores() {
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
}
const resetStoreOnHome = () => {
    if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__.u.workflow === "register") {
        return;
    }
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
    const folder = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.i.folder;
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.i.folder = folder;
};



//# sourceMappingURL=utils-9b3ffcf7.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTkwYWJmOC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUM1QztBQUNQO0FBQ0Y7QUFDSztBQUNZO0FBQ0c7QUFDYztBQUM5QjtBQUNFO0FBQ0s7QUFDVjtBQUNHO0FBQzlCO0FBQ0s7QUFDUjtBQUNPO0FBQ0w7QUFDQTtBQUNEO0FBQ0E7QUFDUztBQUNMO0FBQ0s7QUFDSjtBQUNGO0FBQ0Y7QUFDRjtBQUNHO0FBQ0g7QUFDQztBQUNTO0FBQ0g7QUFDUDtBQUNBO0FBQ0k7QUFDSDtBQUNGO0FBQ1E7QUFDSDtBQUNHOztBQUVsQyxpSEFBaUgsY0FBYyxzQkFBc0IsK0RBQStELG1CQUFtQixnQkFBZ0Isa0NBQWtDLGlCQUFpQixrQkFBa0IsbUVBQW1FLFdBQVcsbUJBQW1CLFlBQVksbUJBQW1CLGtDQUFrQyxxREFBcUQsK0JBQStCLDZEQUE2RCxxQkFBcUI7O0FBRXBvQixxQkFBcUIsTUFBb0M7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsMkdBQTJHLHVGQUF1RixjQUFjO0FBQ2hOLHVCQUF1Qiw4QkFBOEIsZ0RBQWdELHdEQUF3RDtBQUM3Siw2Q0FBNkMsdUNBQXVDLFVBQVUsbUJBQW1CLElBQUk7QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qiw4QkFBOEIscURBQVc7QUFDekMsZ0NBQWdDLHFEQUFXO0FBQzNDLDhDQUE4QyxxREFBVztBQUN6RCx5Q0FBeUMscURBQVc7QUFDcEQ7QUFDQTtBQUNBLG9CQUFvQixvQkFBb0IsRUFBRSwyREFBbUI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JB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TyxpQkFBaUI7QUFDbkM7QUFDQTtBQUNBLG1CQUFtQixvQkFBb0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsc0RBQU8saUJBQWlCO0FBQ25DOztBQUVzQzs7QUFFdEM7Ozs7Ozs7Ozs7Ozs7OztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUN1RDs7QUFFdkQseUJBQXlCLHFEQUFXO0FBQ3BDO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRWlDOztBQUVqQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDbUc7QUFDckI7QUFDekI7O0FBRXJEO0FBQ0EsSUFBSSxvREFBWTtBQUNoQixJQUFJLDJEQUFtQjtBQUN2QjtBQUNBO0FBQ0EsUUFBUSxvREFBWSxpQkFBaUIsOENBQVk7QUFDakQ7QUFDQTtBQUNBLElBQUksb0RBQVk7QUFDaEIsbUJBQW1CLDJEQUFtQjtBQUN0QyxJQUFJLDJEQUFtQjtBQUN2QixJQUFJLDJEQUFtQjtBQUN2Qjs7QUFFMEQ7O0FBRTFEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXB1Ymxpc2gtaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXMuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY2F0ZWdvcmllcy05ZjBmMzdlZS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9ncm91cC02YTYzMDNiMC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pbWFnZS1jb2xsZWN0aW9uLTViNjYyYjgwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JlLTFhN2M5ZWE2LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3V0aWxzLTliM2ZmY2Y3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgdSBhcyB1cGRhdGVDYXRlZ29yaWVzIH0gZnJvbSAnLi9jYXRlZ29yaWVzLTlmMGYzN2VlLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0Rm9sZGVyRnJvbUlkIH0gZnJvbSAnLi91c2VyLTNlYTY5YzNhLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgeyBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUltYWdlQ29sbGVjdGlvbiB9IGZyb20gJy4vaW1hZ2UtY29sbGVjdGlvbi01YjY2MmI4MC5qcyc7XG5pbXBvcnQgeyBhIGFzIGFwcGVuZFR5cGVLZXl3b3JkcywgcCBhcyBwdWJsaXNoU2VydmljZSB9IGZyb20gJy4vcHVibGlzaC1pdGVtLTE3ZDJmOWEzLmpzJztcbmltcG9ydCB7IGQgYXMgZGVsZXRlSXRlbSB9IGZyb20gJy4vc2VydmVyLWl0ZW0tOGQzODQ3OTYuanMnO1xuaW1wb3J0IHsgciBhcyByZXNldEFkZEl0ZW1TdG9yZXMgfSBmcm9tICcuL3V0aWxzLTliM2ZmY2Y3LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcbmltcG9ydCB7IHcgYXMgd29ya2Zsb3dTdGF0ZSB9IGZyb20gJy4vc3RvcmUtNmE4OGU2YzUuanMnO1xuaW1wb3J0IHsgcCBhcyBwdWJsaXNoSXRlbVN0YXRlIH0gZnJvbSAnLi9zdG9yZS0xYTdjOWVhNi5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0ICcuL2ZlYXR1cmUtbGF5ZXItNTczYmI0NzMuanMnO1xuaW1wb3J0ICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTc5ZmIzMDJjLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtYmNiODllNjkuanMnO1xuaW1wb3J0ICcuL3NlcnZpY2UtOGMyYzQyNDEuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCAnLi9hcGktMmUzYTEzNmYuanMnO1xuaW1wb3J0ICcuL3N0cmluZy01OGE1ZmVmMy5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTE3YjY0OTQ2LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTgxMzczZjZkLmpzJztcbmltcG9ydCAnLi9hZ3MtZWI0NThhMDMuanMnO1xuaW1wb3J0ICcuL3VybC0zNTg3NWExMC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS0wMzUzYTc2OS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0ICcuL3RpbGUtbGF5ZXItY2YwNGZhOTcuanMnO1xuaW1wb3J0ICcuL2dlb2NvZGUtNjRlMGIwZDMuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNzQ2MzlkYWUuanMnO1xuXG5jb25zdCBhcmNnaXNQdWJsaXNoSXRlbVBhZ2VzSXRlbVByb3BlcnRpZXNDc3MgPSBcIi5sYXllci1kZXNjcmlwdGlvbi5zYy1hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3tkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206MC43NXJlbX0ubG9jYXRvcl9faGVhZGluZy5zYy1hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3tmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtsaW5lLWhlaWdodDoxOHB4O21hcmdpbi1ib3R0b206MnB4fS5sb2NhdG9yX19kZXNjcmlwdGlvbi5zYy1hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3ttYXJnaW46MHB4O21hcmdpbi1ib3R0b206MXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5tZWRpdW0uc2MtYXJjZ2lzLXB1Ymxpc2gtaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXN7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NTAwfS5pbmZvLWNvbnRhaW5lci5zYy1hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3ttYXJnaW4tYm90dG9tOjEuNXJlbX1cIjtcblxudmFyIF9fYXN5bmNWYWx1ZXMgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX2FzeW5jVmFsdWVzKSB8fCBmdW5jdGlvbiAobykge1xuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcbiAgICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24gKHYpIHsgcmVzb2x2ZSh7IHZhbHVlOiB2LCBkb25lOiBkIH0pOyB9LCByZWplY3QpOyB9XG59O1xuY29uc3QgTUFYX1RJVExFX0xFTkdUSCA9IDI1MDtcbmNvbnN0IEFyY2dpc1B1Ymxpc2hJdGVtUGFnZXNJdGVtUHJvcGVydGllcyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q2FuY2VsXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzV29ya2Zsb3dVcGRhdGVFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzV29ya2Zsb3dVcGRhdGVFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbGxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhbmRsZVJlcXVlc3QgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNhdGVnb3JpZXMsIHRpdGxlIH0gPSBpdGVtUHJvcGVydGllc1N0YXRlO1xuICAgICAgICAgICAgLy8gRG9uJ3Qgc2VuZCByZXF1ZXN0IGlmIGFuIGVycm9yIGlzIHJlcG9ydGVkXG4gICAgICAgICAgICBpZiAoIShhd2FpdCB0aGlzLnZhbGlkYXRlKCkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNXb3JrZmxvd1VwZGF0ZUVycm9yLmVtaXQodGhpcy5lcnJvck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgodGl0bGUgPT09IG51bGwgfHwgdGl0bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpdGxlLmxlbmd0aCkgPiBNQVhfVElUTEVfTEVOR1RIKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZVJlZi50aXRsZSA9IHRpdGxlLnN1YnN0cmluZygwLCBNQVhfVElUTEVfTEVOR1RIKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogUmVwYWlyIHRlbGVtZXRyeVxuICAgICAgICAgICAgICAgIC8vIFRlbGVtZXRyeTogQmVnaW4gdXBsb2FkIHRyYWNraW5nIHdvcmtmbG93XG4gICAgICAgICAgICAgICAgLy8gbG9nQWRkTmV3SXRlbVN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwdWJsaXNoUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMucHVibGlzaEl0ZW0oKTtcbiAgICAgICAgICAgICAgICBjYXRlZ29yaWVzICYmXG4gICAgICAgICAgICAgICAgICAgIChhd2FpdCB1cGRhdGVDYXRlZ29yaWVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcnRhbDogdGhpcy5wb3J0YWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtSWRzOiBbcHVibGlzaFJlc3BvbnNlLmlkXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy53b3JrZmxvd0NhbmNlbGxlZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUZWxlbWV0cnk6IE9ubHkgbG9nIHRlbGVtZXRyeSBhZnRlciBzdWNjZXNzZnVsIHVwbG9hZFxuICAgICAgICAgICAgICAgICAgICAvLyBsb2dJdGVtUHJvcGVydGllc0NoYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbG9nU3VjY2Vzc2Z1bEl0ZW1DcmVhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25maWdTdGF0ZS50ZWxlbWV0cnkgJiYgKGF3YWl0IHRpbWVvdXQoNzUwKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7fSwgcHVibGlzaFJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBwdWJsaXNoIGRpYWxvZyBleHBlY3RzIHRoaXMgYXMgdGhlIHBheWxvYWQ6XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHsgaWQsIHJlc3BvbnNlLCBqb2JJZCwgc2VydmljZVR5cGUsIGl0ZW0sIG5ld0l0ZW1Nb2RlIH0gPSBlLmRldGFpbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogUmVtb3ZlIG5ldy1pdGVtIHNwZWNpZmljIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCkgJiYgKGF3YWl0IGRlbGV0ZUl0ZW0ocHVibGlzaFJlc3BvbnNlLmlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNldEFkZEl0ZW1TdG9yZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5wYXJzZUVycm9yKGVycm9yLmNvZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzV29ya2Zsb3dVcGRhdGVFcnJvci5lbWl0KHRoaXMuZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGVhY2ggZmllbGQsIHNob3J0LWNpcmN1aXRpbmcgb24gdGhlIGZpcnN0IG9uZSB0byBmYWlsLiBQb3B1bGF0ZXMgdGhpcy5lcnJvck1lc3NhZ2UgaW50ZXJuYWxseVxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgdGl0bGVFcnJvciA9IGF3YWl0ICgoX2EgPSB0aGlzLnRpdGxlUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsaWRhdGVUaXRsZSgpKTtcbiAgICAgICAgaWYgKHRpdGxlRXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4uZXJyb3IudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRpdGxlRXJyb3IudHJhbnNsYXRlZE1lc3NhZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRpdGxlUmVmLmZvY3VzTWFpbklucHV0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETzogY29ubmVjdCBmb2xkZXIgY29tcG9uZW50IHRvIGVycm9yIHN0cnVjdHVyZVxuICAgICAgICAvLyBBbHNvLCB1cGRhdGluZyB0aGUgbmV3IHRpdGxlIGluIGEgZm9sZGVyIHBpY2tlciBkb2Vzbid0IGVtaXQgYW4gaXRlbVByb3BlcnRpZXMgY2hhbmdlIGV2ZW50LFxuICAgICAgICAvLyBzbyB0aGUgZXJyb3IgZG9lc24ndCBjbGVhciB1bmxlc3MgdGhlIGZvbGRlciBpcyBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICAgIGNvbnN0IGZvbGRlclJlc3BvbnNlID0gYXdhaXQgKChfYiA9IHRoaXMuaXRlbVByb3BlcnRpZXNGb2xkZXJSZWYpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zYXZlQWN0aXZlRm9sZGVyKCkpO1xuICAgICAgICBpZiAoISFmb2xkZXJSZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmb2xkZXJSZXNwb25zZSA9PT0gXCJib29sZWFuXCIgJiYgIWZvbGRlclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGZvbGRlclJlc3BvbnNlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4uZXJyb3IudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBmb2xkZXJSZXNwb25zZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN1bW1hcnlFcnJvciA9IGF3YWl0ICgoX2MgPSB0aGlzLnN1bW1hcnlSZWYpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5nZXRFcnJvck1lc3NhZ2UoKSk7XG4gICAgICAgIGlmIChzdW1tYXJ5RXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4uZXJyb3IudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHN1bW1hcnlFcnJvci50cmFuc2xhdGVkTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgICAgICB0aGlzLmhhbmRsZVJlcXVlc3QoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIC8vIEdyYWIgY29tbW9uIHdvcmtmbG93IHN0YXRlXG4gICAgICAgIHB1Ymxpc2hJdGVtU3RhdGUuaTE4biA9IHB1Ymxpc2hJdGVtU3RhdGUuaTE4bjtcbiAgICAgICAgLy8gR3JhYiBwdWJsaXNoSXRlbSB3b3JrZmxvdyBzdGF0ZVxuICAgICAgICAoX2EgPSB0aGlzLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMucG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICAgICAgKF9iID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodGhpcy51c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgIGlmICghdGhpcy5pdGVtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiTm8gaXRlbSBmb3VuZFwiKTtcbiAgICAgICAgICAgIC8vIFRPRE86IGNyZWF0ZSBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1dvcmtmbG93VXBkYXRlRXJyb3IuZW1pdCh0aGlzLmVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgdGhpcyBzaG91bGQgZ3JhYiB0aGUgaXRlbSBvd25lciBpbnN0ZWFkIG9mIGN1cnJlbnQgdXNlclxuICAgICAgICB0aGlzLmZvbGRlciA9IGF3YWl0IGdldEZvbGRlckZyb21JZCh0aGlzLml0ZW0ub3duZXJGb2xkZXIsIHRoaXMudXNlcik7XG4gICAgfVxuICAgIGFzeW5jIHB1Ymxpc2hJdGVtKCkge1xuICAgICAgICBjb25zdCB7IGlkLCB0eXBlIH0gPSB0aGlzLml0ZW07XG4gICAgICAgIGNvbnN0IGFkZFJlc3BvbnNlID0geyBzdWNjZXNzOiB0cnVlLCBpZCwgZm9sZGVyOiBudWxsIH07XG4gICAgICAgIGNvbnN0IHB1Ymxpc2hSZXNwb25zZSA9IHR5cGUgPT09IFwiSW1hZ2UgQ29sbGVjdGlvblwiXG4gICAgICAgICAgICA/IGF3YWl0IHRoaXMucHVibGlzaEltYWdlQ29sbGVjdGlvbihhZGRSZXNwb25zZSlcbiAgICAgICAgICAgIDogYXdhaXQgdGhpcy5wdWJsaXNoU2VydmljZShpZCk7XG4gICAgICAgIGF3YWl0IGFwcGVuZFR5cGVLZXl3b3JkcyhwdWJsaXNoUmVzcG9uc2UsIHRoaXMudXNlcik7XG4gICAgICAgIHJldHVybiB7IGFkZFJlc3BvbnNlLCBwdWJsaXNoUmVzcG9uc2UgfTtcbiAgICB9XG4gICAgYXN5bmMgcHVibGlzaFNlcnZpY2UoaWQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IHR5cGUgfSA9IHRoaXMuaXRlbTtcbiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdLmZpbGVFeHRbMF07XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICAgICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHB1Ymxpc2hJdGVtU3RhdGUuaTE4bi5wdWJsaXNoaW5nU2VydmljZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyByZXN1bHQ6IHB1Ymxpc2hSZXNwb25zZSwgZXJyb3IgfSA9IGF3YWl0IHB1Ymxpc2hTZXJ2aWNlKHtcbiAgICAgICAgICAgIGl0ZW1JZDogaWQsXG4gICAgICAgICAgICB1c2VyOiB0aGlzLnVzZXIsXG4gICAgICAgICAgICB0aXRsZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSxcbiAgICAgICAgICAgIGV4dGVuc2lvbixcbiAgICAgICAgICAgIHR5cGU6IHR5cGVcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcInRoZXJlIHdhcyBhbiBlcnJvclwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2aWNlID0gKF9hID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgaWQ6IHNlcnZpY2UgPT09IG51bGwgfHwgc2VydmljZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZS5zZXJ2aWNlSXRlbUlkLFxuICAgICAgICAgICAgICAgIGpvYklkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuam9iSWQsXG4gICAgICAgICAgICAgICAgc2VydmljZVR5cGU6IHNlcnZpY2UgPT09IG51bGwgfHwgc2VydmljZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZS50eXBlLFxuICAgICAgICAgICAgICAgIHNlcnZpY2VVcmw6IHNlcnZpY2UgPT09IG51bGwgfHwgc2VydmljZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZS5zZXJ2aWNldXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHB1Ymxpc2hJbWFnZUNvbGxlY3Rpb24oYWRkSXRlbVJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBfYSwgZV8xLCBfYiwgX2M7XG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICBsb2FkZXJNZXNzYWdlOiBwdWJsaXNoSXRlbVN0YXRlLmkxOG4ucHVibGlzaGluZ1NlcnZpY2VcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvciA9IGNyZWF0ZUltYWdlQ29sbGVjdGlvbihhZGRJdGVtUmVzcG9uc2UsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsIHsgY29uZmlnLCB1c2VyLCBwb3J0YWwgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgKHZhciBfZCA9IHRydWUsIGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xID0gX19hc3luY1ZhbHVlcyhpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3IpLCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xOyBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xID0gYXdhaXQgaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEubmV4dCgpLCBfYSA9IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzEuZG9uZSwgIV9hOyBfZCA9IHRydWUpIHtcbiAgICAgICAgICAgICAgICBfYyA9IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xXzEudmFsdWU7XG4gICAgICAgICAgICAgICAgX2QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBfYztcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHN0YXR1cyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgcHVibGlzaEl0ZW1TdGF0ZS5pMThuW3N0YXR1c10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogc3RhdHVzLnNlcnZpY2VJdGVtSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JJZDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VUeXBlOiBzdGF0dXMudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VVcmw6IHN0YXR1cy5zZXJ2aWNldXJsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlXzFfMSkge1xuICAgICAgICAgICAgZV8xID0geyBlcnJvcjogZV8xXzEgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfZCAmJiAhX2EgJiYgKF9iID0gaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEucmV0dXJuKSlcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgX2IuY2FsbChpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBpZiAoZV8xKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlXzEuZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2hvd0xvYWRlcihzaG93LCB1cGRhdGUpIHtcbiAgICAgICAgaWYgKHVwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIodXBkYXRlLmxvYWRlclR5cGUsIHVwZGF0ZS5sb2FkZXJNZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUxvYWRlcihsb2FkZXJUeXBlLCBsb2FkZXJNZXNzYWdlKSB7XG4gICAgICAgIHRoaXMubG9hZGVyVHlwZSA9IGxvYWRlclR5cGU7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IGxvYWRlck1lc3NhZ2U7XG4gICAgfVxuICAgIHBhcnNlRXJyb3IoY29kZSkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGNvbnN0IHsgaTE4biB9ID0gcHVibGlzaEl0ZW1TdGF0ZTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiAoX2IgPSAoX2EgPSBpMThuLmVycm9yW2NvZGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwibm8gZXJyb3IgY29kZSB0aXRsZVwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IChfZCA9IChfYyA9IGkxOG4uZXJyb3JbY29kZV0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kZXNjcmlwdGlvbikgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogXCJubyBlcnJvciBjb2RlIGRlc2NyaXB0aW9uXCJcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdHlwZSB9ID0gdGhpcy5pdGVtO1xuICAgICAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiB0aGlzLmxvYWRlclR5cGUsIHZhbHVlOiB3b3JrZmxvd1N0YXRlLnVwbG9hZFByb2dyZXNzLCBhY3RpdmU6IHRoaXMubG9hZGluZywgdGV4dDogdGhpcy5sb2FkZXJNZXNzYWdlIH0pLCBoKFwiYXJjZ2lzLWl0ZW0tcHJvcGVydGllc1wiLCB7XG4gICAgICAgICAgICAvLyBDbGVhciBlcnJvcnMgb24gYW55IG1vZGlmaWNhdGlvblxuICAgICAgICAgICAgb25BcmNnaXNJdGVtUHJvcGVydGllc0NoYW5nZTogKCkgPT4gdGhpcy5hcmNnaXNXb3JrZmxvd1VwZGF0ZUVycm9yLmVtaXQobnVsbClcbiAgICAgICAgfSwgdHlwZSAhPT0gXCJTZXJ2aWNlIERlZmluaXRpb25cIiAmJiAoaChcImFyY2dpcy10aXRsZS1pbnB1dFwiLCB7IGl0ZW1UaXRsZTogdGhpcy5pdGVtLnRpdGxlLCBjbGFzczogXCJtZWRpdW1cIiwgY3VycmVudEZvbGRlcjogdGhpcy5pdGVtLm93bmVyRm9sZGVyLCB0eXBlOiB0eXBlLCBlbmFibGVQdWJsaXNoaW5nOiB0cnVlLCByZWY6IChlbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlUmVmID0gZWxlO1xuICAgICAgICAgICAgfSB9KSksIGgoXCJhcmNnaXMtZm9sZGVyLXBpY2tlclwiLCB7IGNsYXNzOiBcIm1lZGl1bVwiLCByZWY6IChlbGUpID0+ICh0aGlzLml0ZW1Qcm9wZXJ0aWVzRm9sZGVyUmVmID0gZWxlKSwgZm9sZGVyOiB0aGlzLmZvbGRlciB9KSwgIWlzUHVibGljVXNlcih1c2VyKSAmJiBoKFwiYXJjZ2lzLWNhdGVnb3JpZXMtcGlja2VyXCIsIHsgY2xhc3M6IFwibWVkaXVtXCIgfSksIGgoXCJhcmNnaXMtdGFncy1waWNrZXJcIiwgeyBjbGFzczogXCJtZWRpdW1cIiB9KSwgaChcImFyY2dpcy1zdW1tYXJ5LWlucHV0XCIsIHsgY2xhc3M6IFwibWVkaXVtXCIsIHJlZjogKGVsZSkgPT4gKHRoaXMuc3VtbWFyeVJlZiA9IGVsZSkgfSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNQdWJsaXNoSXRlbVBhZ2VzSXRlbVByb3BlcnRpZXMuc3R5bGUgPSBhcmNnaXNQdWJsaXNoSXRlbVBhZ2VzSXRlbVByb3BlcnRpZXNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1B1Ymxpc2hJdGVtUGFnZXNJdGVtUHJvcGVydGllcyBhcyBhcmNnaXNfcHVibGlzaF9pdGVtX3BhZ2VzX2l0ZW1fcHJvcGVydGllcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtcHVibGlzaC1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllcy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRHcm91cFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5cbmNvbnN0IGdldEl0ZW1DYXRlZ29yeVNjaGVtYSA9IGFzeW5jICh7IHBvcnRhbCwgdXNlciwgZ3JvdXAsIHVzZUNhY2hlID0gZmFsc2UgfSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBmZXRjaFJlc3VsdCA9IGF3YWl0IChncm91cFxuICAgICAgICAgICAgPyBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cC5pZCwgcG9ydGFsLCB1c2VDYWNoZSlcbiAgICAgICAgICAgIDogZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlciwgdXNlQ2FjaGUpKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiAoX2EgPSBmZXRjaFJlc3VsdCA9PT0gbnVsbCB8fCBmZXRjaFJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmV0Y2hSZXN1bHQuY2F0ZWdvcnlTY2hlbWEpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5hc3luYyBmdW5jdGlvbiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICB1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHZvaWQgMCA/IHVzZXIgOiAodXNlciA9IGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgIGlmICghKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pZCkgfHwgKHVzZXIgJiYgaXNQdWJsaWNVc2VyKHVzZXIpKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfXBvcnRhbHMvJHtwb3J0YWwuaWR9L2NhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpIDogZ2V0U2NoZW1hKCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICBpZiAoIWdyb3VwSWQgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRHcm91cFJlc3RCYXNlVXJsKHBvcnRhbCwgeyBpZDogZ3JvdXBJZCB9KX1jYXRlZ29yeVNjaGVtYWApO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgZ3JvdXBJZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1wb3J0YWxzL3NlbGZgKTtcbiAgICBjb25zdCBncm91cFNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb21tdW5pdHkvZ3JvdXBzP3E9JHtzZWxmLmNvbnRlbnRDYXRlZ29yeVNldHNHcm91cFF1ZXJ5fWApO1xuICAgIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW1TZWFyY2ggPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9ncm91cHMvJHtjYXRlZ29yeUdyb3VwLmlkfS9zZWFyY2hgLCB7XG4gICAgICAgIHE6IGB0eXBla2V5d29yZHM6ICR7Y2F0ZWdvcnlOYW1lfWBcbiAgICB9KTtcbiAgICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICAgIHJldHVybiByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9pdGVtcy8ke3NjaGVtYUl0ZW0uaWR9L2RhdGFgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgY2F0ZWdvcnlOYW1lLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCwgY2F0ZWdvcnlOYW1lKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIGNhdGVnb3J5TmFtZSkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNhdGVnb3JpZXMoeyBjYXRlZ29yaWVzLCBpdGVtSWRzLCBwb3J0YWwgfSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L2NvbnRlbnQvdXBkYXRlSXRlbXNgO1xuICAgICAgICBjb25zdCBpdGVtcyA9IEpTT04uc3RyaW5naWZ5KGl0ZW1JZHMubWFwKChpZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBbaWRdOiB7IGNhdGVnb3JpZXM6IEFycmF5LmlzQXJyYXkoY2F0ZWdvcmllcykgPyBjYXRlZ29yaWVzIDogY2F0ZWdvcmllc1tpZF0gfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3QodXJsLCB7IGl0ZW1zIH0sIHt9LCBcInBvc3RcIikgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMgYXMgYSwgZmV0Y2hHcm91cENhdGVnb3JpZXMgYXMgYiwgZmV0Y2hDYXRlZ29yaWVzIGFzIGYsIGdldEl0ZW1DYXRlZ29yeVNjaGVtYSBhcyBnLCB1cGRhdGVDYXRlZ29yaWVzIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy05ZjBmMzdlZS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmNvbnN0IGdldEdyb3VwUmVzdEJhc2VVcmwgPSAocG9ydGFsLCBncm91cCkgPT4gYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXAuaWR9YCk7XG5cbmV4cG9ydCB7IGdldEdyb3VwUmVzdEJhc2VVcmwgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ncm91cC02YTYzMDNiMC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ3VpZCB9IGZyb20gJy4vZ3VpZC1hZWFlZDg0ZC5qcyc7XG5pbXBvcnQgeyBtIGFzIG1vdmVJdGVtLCB1IGFzIHVwZGF0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcbmltcG9ydCB7IHYgYXMgZmluZFRlbXBsYXRlU2VydmljZUluZm8sIHcgYXMgY3JlYXRlU2VydmljZSB9IGZyb20gJy4vZmVhdHVyZS1sYXllci01NzNiYjQ3My5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3QsIHAgYXMgcG9sbEZvclN0YXR1cyB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcblxudmFyIF9fYXdhaXQgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX2F3YWl0KSB8fCBmdW5jdGlvbiAodikgeyByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTsgfTtcbnZhciBfX2FzeW5jR2VuZXJhdG9yID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19hc3luY0dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG4gICAgdmFyIGcgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSksIGksIHEgPSBbXTtcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxufTtcbi8qKlxuICogR2l2ZW4gYW4gaXRlbSwgY3JlYXRlIGEgbmV3IHNlcnZpY2VcbiAqL1xuZnVuY3Rpb24gY3JlYXRlSW1hZ2VDb2xsZWN0aW9uKHJlc3BvbnNlLCB0aXRsZSwgY29uZmlnT3B0aW9ucykge1xuICAgIHJldHVybiBfX2FzeW5jR2VuZXJhdG9yKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24qIGNyZWF0ZUltYWdlQ29sbGVjdGlvbl8xKCkge1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdPcHRpb25zO1xuICAgICAgICBjb25zdCB7IGl0ZW0gfSA9IHlpZWxkIF9fYXdhaXQoZmV0Y2hJdGVtKHJlc3BvbnNlLCB1c2VyKSk7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0geWllbGQgX19hd2FpdChmaW5kVGVtcGxhdGVTZXJ2aWNlSW5mbyhwb3J0YWwpKTtcbiAgICAgICAgeWllbGQgeWllbGQgX19hd2FpdChcInB1Ymxpc2hpbmdTZXJ2aWNlXCIpO1xuICAgICAgICBjb25zdCBpc05vdEluUm9vdEZvbGRlciA9IGl0ZW0ub3duZXJGb2xkZXIgJiYgaXRlbS5vd25lckZvbGRlciAhPT0gXCIvXCIgJiYgaXRlbS5vd25lckZvbGRlciAhPT0gXCJyb290XCI7XG4gICAgICAgIGNvbnN0IHRlbXBUaXRsZSA9IGAke3RpdGxlfS0tLSR7Z3VpZCgpfWA7XG4gICAgICAgIGNvbnN0IHsgY3JlYXRlU2VydmljZVJlc3BvbnNlLCBhZGRUb0RlZmluaXRpb25SZXNwb25zZSB9ID0geWllbGQgX19hd2FpdChjcmVhdGVTZXJ2aWNlKE9iamVjdC5hc3NpZ24oeyBuYW1lOiBpc05vdEluUm9vdEZvbGRlciA/IHRlbXBUaXRsZSA6IHRpdGxlLCBsYXllcnM6ICh0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUubGF5ZXJzKSB8fCBbXSwgdGFibGVzOiAodGVtcGxhdGUgPT09IG51bGwgfHwgdGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBsYXRlLnRhYmxlcykgfHwgW10gfSwgdGVtcGxhdGUpLCB7IGNvbmZpZywgdXNlciB9KSk7XG4gICAgICAgIGlmIChpc05vdEluUm9vdEZvbGRlcikge1xuICAgICAgICAgICAgeWllbGQgX19hd2FpdChtb3ZlSXRlbShjcmVhdGVTZXJ2aWNlUmVzcG9uc2UuaXRlbUlkLCBpdGVtLm93bmVyRm9sZGVyKSk7XG4gICAgICAgICAgICB5aWVsZCBfX2F3YWl0KHVwZGF0ZUl0ZW0oY3JlYXRlU2VydmljZVJlc3BvbnNlLml0ZW1JZCwgeyB0aXRsZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgeWllbGQgeWllbGQgX19hd2FpdChcImFwcGVuZGluZ1Bob3Rvc1wiKTtcbiAgICAgICAgY29uc3QgeyBzdGF0dXNVcmwgfSA9IHlpZWxkIF9fYXdhaXQoYXBwZW5kUGhvdG9zKGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgYWRkVG9EZWZpbml0aW9uUmVzcG9uc2UsIGl0ZW0pKTtcbiAgICAgICAgeWllbGQgX19hd2FpdChhZGRSZWxhdGlvbnNoaXAoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBpdGVtLCB1c2VyKSk7XG4gICAgICAgIHlpZWxkIHlpZWxkIF9fYXdhaXQoXCJjaGVja2luZ1N0YXR1c1wiKTtcbiAgICAgICAgeWllbGQgX19hd2FpdChwb2xsRm9yU3RhdHVzKHN0YXR1c1VybCkpO1xuICAgICAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KGNyZWF0ZVNlcnZpY2VSZXNwb25zZSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBmZXRjaEl0ZW0oaXRlbSwgdXNlcikge1xuICAgIGNvbnN0IHVybCA9IGAke3VzZXIudXNlckNvbnRlbnRVcmx9L2l0ZW1zLyR7aXRlbS5pZH1gO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCk7XG59XG5mdW5jdGlvbiBhcHBlbmRQaG90b3MoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBhZGRUb0RlZmluaXRpb25SZXNwb25zZSwgaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBsYXllciA9IGFkZFRvRGVmaW5pdGlvblJlc3BvbnNlLmxheWVyc1swXTtcbiAgICBjb25zdCB1cmwgPSBgJHtjcmVhdGVTZXJ2aWNlUmVzcG9uc2UuZW5jb2RlZFNlcnZpY2VVUkx9LyR7KF9hID0gbGF5ZXIuaWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDB9L2FwcGVuZGA7XG4gICAgY29uc3QgY29udGVudCA9IHtcbiAgICAgICAgYXBwZW5kSXRlbUlkOiBpdGVtLmlkLFxuICAgICAgICBhcHBlbmRVcGxvYWRGb3JtYXQ6IFwiaW1hZ2VDb2xsZWN0aW9uXCIsXG4gICAgICAgIGFwcGVuZEF0dGFjaG1lbnRzSW5mbzogSlNPTi5zdHJpbmdpZnkoeyBpZ25vcmVBdHRhY2htZW50c1dpdGhvdXRMb2NhdGlvbjogdHJ1ZSB9KSxcbiAgICAgICAgdXBzZXJ0OiBmYWxzZSxcbiAgICAgICAgdXNlR2xvYmFsSWRzOiBmYWxzZSxcbiAgICAgICAgcm9sbGJhY2tPbkZhaWx1cmU6IHRydWVcbiAgICB9O1xuICAgIHJldHVybiByZXF1ZXN0KHVybCwgY29udGVudCwge30sIFwicG9zdFwiKTtcbn1cbmZ1bmN0aW9uIGFkZFJlbGF0aW9uc2hpcChjcmVhdGVTZXJ2aWNlUmVzcG9uc2UsIGl0ZW0sIHVzZXIpIHtcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9hZGRSZWxhdGlvbnNoaXBgO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IFwiU2VydmljZTJEYXRhXCIsXG4gICAgICAgIGRlc3RpbmF0aW9uSXRlbUlkOiBpdGVtLmlkLFxuICAgICAgICBvcmlnaW5JdGVtSWQ6IGNyZWF0ZVNlcnZpY2VSZXNwb25zZS5pdGVtSWRcbiAgICB9O1xuICAgIHJldHVybiByZXF1ZXN0KHVybCwgY29udGVudCwge30sIFwicG9zdFwiKTtcbn1cblxuZXhwb3J0IHsgY3JlYXRlSW1hZ2VDb2xsZWN0aW9uIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW1hZ2UtY29sbGVjdGlvbi01YjY2MmI4MC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY3JlYXRlU3RvcmUgfSBmcm9tICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgcHVibGlzaEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICBzb3VyY2VJdGVtOiBudWxsLFxuICAgIGkxOG46IG51bGxcbn0pO1xuY29uc3QgcHVibGlzaEl0ZW1TdGF0ZSA9IHB1Ymxpc2hJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IHB1Ymxpc2hJdGVtU3RhdGUgYXMgcCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9yZS0xYTdjOWVhNi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGEgYXMgaXRlbVByb3BlcnRpZXNTdG9yZSwgaSBhcyBpdGVtUHJvcGVydGllc1N0YXRlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtMTA0OTFiMmUuanMnO1xuaW1wb3J0IHsgZCBhcyBhZGRJdGVtU3RvcmUsIGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktYmNhN2JjZDEuanMnO1xuXG5mdW5jdGlvbiByZXNldEFkZEl0ZW1TdG9yZXMoKSB7XG4gICAgYWRkSXRlbVN0b3JlLnJlc2V0KCk7XG4gICAgaXRlbVByb3BlcnRpZXNTdG9yZS5yZXNldCgpO1xufVxuY29uc3QgcmVzZXRTdG9yZU9uSG9tZSA9ICgpID0+IHtcbiAgICBpZiAoYWRkSXRlbVN0YXRlLmV4aXN0aW5nSXRlbSB8fCB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwicmVnaXN0ZXJcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGFkZEl0ZW1TdG9yZS5yZXNldCgpO1xuICAgIGNvbnN0IGZvbGRlciA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyO1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUucmVzZXQoKTtcbiAgICBpdGVtUHJvcGVydGllc1N0YXRlLmZvbGRlciA9IGZvbGRlcjtcbn07XG5cbmV4cG9ydCB7IHJlc2V0U3RvcmVPbkhvbWUgYXMgYSwgcmVzZXRBZGRJdGVtU3RvcmVzIGFzIHIgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbHMtOWIzZmZjZjcuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9