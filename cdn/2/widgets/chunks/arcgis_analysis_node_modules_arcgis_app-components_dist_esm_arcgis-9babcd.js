"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-9babcd"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-picker.entry.js":
/*!***********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-picker.entry.js ***!
  \***********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_symbol_picker: () => (/* binding */ ArcgisSymbolPicker)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _color_16791b45_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./color-16791b45.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-16791b45.js");
/* harmony import */ var _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./symbolUtils-f207d979.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolUtils-f207d979.js");
/* harmony import */ var _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./localStorage-9c4e7a3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */











function getInjectedRequestOptions(item) {
    // hack to inject authMode into request options
    return { authMode: item.access === "public" ? "anonymous" : "auto" };
}
const BASIC_SIMPLE_MARKER_SYMBOLS_JSON = [
    {
        name: "Circle",
        type: "esriSMS",
        style: "esriSMSCircle",
        color: [0, 0, 128, 128],
        size: 18,
        outline: {
            color: [0, 0, 128, 255],
            width: 1
        }
    },
    {
        name: "Square",
        type: "esriSMS",
        style: "esriSMSSquare",
        color: [0, 0, 128, 128],
        size: 18,
        outline: {
            color: [0, 0, 128, 255],
            width: 1
        }
    },
    {
        name: "Diamond",
        type: "esriSMS",
        style: "esriSMSDiamond",
        color: [0, 0, 128, 128],
        size: 18,
        outline: {
            color: [0, 0, 128, 255],
            width: 1
        }
    },
    {
        name: "Triangle",
        type: "esriSMS",
        style: "esriSMSTriangle",
        color: [0, 0, 128, 128],
        size: 18,
        outline: {
            color: [0, 0, 128, 255],
            width: 1
        }
    } /* ,
    {
      name: "Cross",
      type: "esriSMS",
      style: "esriSMSCross",
      color: [0, 0, 128, 128],
      size: 18,
      outline: {
        color: [0, 0, 128, 255],
        width: 1
      }
    },
    {
      name: "X",
      type: "esriSMS",
      style: "esriSMSX",
      color: [0, 0, 128, 128],
      size: 18,
      outline: {
        color: [0, 0, 128, 255],
        width: 1
      }
    } */
];
const BASIC_SIMPLE_LINE_SYMBOLS_JSON = [
    {
        type: "esriSLS",
        color: [0, 0, 0, 255],
        width: 0.75,
        style: "esriSLSSolid"
    }
];
const BASIC_SIMPLE_POLYGON_SYMBOLS_JSON = [
    {
        type: "esriSFS",
        color: [0, 0, 0, 64],
        outline: {
            type: "esriSLS",
            color: [0, 0, 0, 255],
            width: 0.75,
            style: "esriSLSSolid"
        },
        style: "esriSFSSolid"
    }
];
const symbolHeightAsMainAxis = 10;
const symbolRadiusFixed = 5;
function generateIconPrimitiveSymbolJson(strings) {
    const icons = [
        {
            title: strings.symbolSources.circle,
            name: "Circle",
            primitive: "circle"
        },
        {
            title: strings.symbolSources.square,
            name: "Square",
            primitive: "square"
        },
        {
            title: strings.symbolSources.cross,
            name: "Cross",
            primitive: "cross"
        },
        {
            title: strings.symbolSources.x,
            name: "X",
            primitive: "x"
        },
        {
            title: strings.symbolSources.kite,
            name: "Kite",
            primitive: "kite"
        },
        {
            title: strings.symbolSources.triangle,
            name: "Triangle",
            primitive: "triangle"
        }
    ];
    return icons.map((icon) => {
        var _a;
        return ({
            dimensionality: "flat",
            name: icon.name,
            title: icon.title,
            type: "PointSymbol3D",
            symbolLayers: [
                {
                    type: "Icon",
                    resource: {
                        primitive: icon.primitive
                    },
                    material: {
                        color: (_a = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e === null || _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e === void 0 ? void 0 : _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.gfxUtils) === null || _a === void 0 ? void 0 : _a.defaultThematicColor
                    },
                    outline: {
                        color: [0, 0, 0]
                    }
                }
            ]
        });
    });
}
function generateObjectPrimitiveSymbolJson(strings) {
    const objects = [
        {
            title: strings.symbolSources.sphere,
            name: "Sphere",
            primitive: "sphere"
        },
        {
            title: strings.symbolSources.tallCylinder,
            name: "Tall_Cylinder",
            primitive: "cylinder",
            mixins: {
                width: symbolRadiusFixed,
                height: symbolHeightAsMainAxis,
                depth: symbolRadiusFixed
            }
        },
        {
            title: strings.symbolSources.cylinder,
            name: "Cylinder",
            primitive: "cylinder"
        },
        {
            title: strings.symbolSources.tallCube,
            name: "Tall_Cube",
            primitive: "cube",
            mixins: {
                width: symbolRadiusFixed,
                height: symbolHeightAsMainAxis,
                depth: symbolRadiusFixed,
                anchor: "bottom"
            }
        },
        {
            title: strings.symbolSources.cube,
            name: "Cube",
            primitive: "cube"
        },
        {
            title: strings.symbolSources.tallCone,
            name: "Tall_Cone",
            primitive: "cone",
            mixins: {
                width: symbolRadiusFixed,
                height: symbolHeightAsMainAxis,
                depth: symbolRadiusFixed
            }
        },
        {
            title: strings.symbolSources.cone,
            name: "Cone",
            primitive: "cone"
        },
        {
            title: strings.symbolSources.invertedCone,
            name: "Inverted_Cone",
            primitive: "invertedCone"
        },
        {
            title: strings.symbolSources.diamond,
            name: "Diamond",
            primitive: "diamond"
        },
        {
            title: strings.symbolSources.tetrahedron,
            name: "Tetrahedron",
            primitive: "tetrahedron"
        }
    ];
    return objects.map((object) => ({
        dimensionality: "volumetric",
        name: object.name,
        title: object.title,
        type: "PointSymbol3D",
        symbolLayers: [
            Object.assign({ type: "Object", resource: {
                    primitive: object.primitive
                } }, object.mixins)
        ]
    }));
}
const symbolThumbnailSizeInPt = 24; // 24 pt => 32px
const symbolThumbnailSizeInPtFor3D = 42; // 42pt => 56px
function has3DFormat(itemData) {
    var _a, _b;
    const formatIncludes3D = (_a = itemData.formats) === null || _a === void 0 ? void 0 : _a.includes("web3d");
    const formatInfosIncludes3DHint = (_b = itemData.formatInfos) === null || _b === void 0 ? void 0 : _b.some((formatInfo) => formatInfo.type === "gltf" || formatInfo.type === "gltf_basisu");
    return formatIncludes3D || formatInfosIncludes3DHint;
}
async function getWebStyleSymbolThumbnailPreview(item) {
    var _a, _b;
    const itemData = item.data;
    let thumbnailUrl = (_a = itemData.thumbnail) === null || _a === void 0 ? void 0 : _a.href;
    const thumbnailData = (_b = itemData.thumbnail) === null || _b === void 0 ? void 0 : _b.imageData;
    const title = itemData.title || item.strings.symbolSources.noTitle;
    const wrapper = document.createElement("div");
    const isCIM = !!itemData.cimRef;
    const is3d = has3DFormat(itemData);
    const commonPreviewOptions = {
        size: is3d && itemData.dimensionality === "volumetric" ? symbolThumbnailSizeInPtFor3D : symbolThumbnailSizeInPt,
        disableUpsampling: false
    };
    if (
    /* symbol preview utils only support 2D CIM */
    isCIM &&
        !is3d) {
        const symbol = (await item.getSymbol());
        if (
        // lines/points use dynamically generated previews
        // polygons use thumbnail URLs since dynamically generated
        // previews may not display as nicely as authored ones
        !(0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.f)(symbol)) {
            if ((0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.h)(symbol)) {
                // we drop size for non-points to prevent a known rendering issue – https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/41790
                delete commonPreviewOptions.size;
            }
            return appendPreview(wrapper, symbol, commonPreviewOptions, title);
        }
    }
    // When loading Esri provided styles on dev environments we get incorrect
    // symbol URLs.
    // If necessary and allowed, adjust the URL to work on dev environments
    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/16832
    if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.devEnvironmentUtils.isDevEnvironment()) {
        thumbnailUrl = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.devEnvironmentUtils.adjustStaticAGOUrl(thumbnailUrl);
    }
    if (!thumbnailUrl && !thumbnailData) {
        wrapper.appendChild(createBlankThumbnail(title));
        return wrapper;
    }
    const symbol = new _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.WebStyleSymbol({
        name: itemData.name,
        styleUrl: `${item.portalItem.itemUrl}/data`,
        thumbnail: {
            url: thumbnailData
                ? `data:image/jpeg;base64, ${thumbnailData}`
                : _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.urlUtils.makeAbsolute(thumbnailUrl, item.portalItem.itemUrl)
        }
    });
    return appendPreview(wrapper, symbol, commonPreviewOptions, title);
}
async function appendPreview(node, symbol, options, title) {
    try {
        await _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.symbolUtils.renderPreviewHTML(symbol, Object.assign({ node }, options));
    }
    catch (e) {
        node.appendChild(createBlankThumbnail(title));
    }
    return node;
}
function createBlankThumbnail(title) {
    const element = document.createElement("span");
    // described by parent node
    element.setAttribute("alt", "");
    element.innerHTML = title;
    return element;
}
function webStyleSymbolStrategy(symbolType = "2d") {
    return {
        async getSymbol(item) {
            const { data, parentData, portalItem } = item;
            const symbol = await symbolFromWebStyleJSON(parentData, data.name, portalItem, parentData.cimVersion && symbolType === "2d" ? "cimRef" : "webRef");
            // Override color for 3d icon and object symbols to be thematic
            if (symbol.type === "point-3d") {
                symbol.symbolLayers.forEach((symbolLayer) => {
                    if (symbolLayer.get("material.color")) {
                        if (symbolLayer.type === "icon") {
                            const material = symbolLayer.material != null
                                ? symbolLayer.material
                                : {
                                /* autocasts as Symbol3DMaterial */
                                };
                            material.color = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.gfxUtils.defaultThematicColor.clone();
                            symbolLayer.material = material;
                        }
                        else if (symbolLayer.type === "object") {
                            const material = symbolLayer.material != null
                                ? symbolLayer.material
                                : {
                                /* autocasts as Symbol3DMaterial */
                                };
                            material.color = material.color || (0,_color_16791b45_js__WEBPACK_IMPORTED_MODULE_1__.c)([255, 255, 255]);
                            symbolLayer.material = material;
                        }
                    }
                });
            }
            return symbol;
        },
        async getThumbnail(item) {
            return getWebStyleSymbolThumbnailPreview(item);
        }
    };
}
function webStyleCustomSymbolStrategy() {
    return {
        async getSymbol(item) {
            return item.data.symbol;
        },
        async getThumbnail(item) {
            const wrapper = document.createElement("div");
            const html = appendPreview(wrapper, item.data.symbol, {
                size: 24,
                disableUpsampling: false
            }, item.data.title);
            return html;
        }
    };
}
const flatSymbolStrategy = {
    async getSymbol(item) {
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.jsonUtils.fromJSON(item.data);
    },
    async getThumbnail(item) {
        const symbol = (await item.getSymbol());
        const previewOptions = {
            size: (0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.g)(symbol) === "line"
                ? {
                    width: symbolThumbnailSizeInPt
                }
                : symbolThumbnailSizeInPt
        };
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.symbolUtils.renderPreviewHTML(symbol, previewOptions);
    }
};
const volumetricSymbolStrategy = {
    async getSymbol(item) {
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.jsonUtils.fromJSON(item.data);
    },
    async getThumbnail(item) {
        const symbol = await item.getSymbol();
        return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.symbolUtils.renderPreviewHTML(symbol, { size: symbolThumbnailSizeInPtFor3D - 4 });
    }
};
const noop = Function.prototype;
class SymbolItem {
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    constructor({ data, parentData, portalItem, strategy, strings }) {
        this.data = data;
        this.parentData = parentData;
        this.portalItem = portalItem;
        this.strategy = strategy;
        this.strings = strings;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async getSymbol() {
        if (!this._symbol) {
            const inflightSymbol = this._symbolRequest || (this._symbolRequest = this.strategy.getSymbol(this));
            this._symbol = await inflightSymbol;
        }
        return this._symbol.clone();
    }
    async getThumbnail(node) {
        if (this._thumbnail) {
            node.appendChild(this._thumbnail);
            return noop;
        }
        const inflightThumbnail = this._thumbnailRequest || (this._thumbnailRequest = this.strategy.getThumbnail(this));
        this._thumbnail = await inflightThumbnail;
        return () => node.appendChild(this._thumbnail);
    }
}
class PortalItemSymbolSourceBase {
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    constructor({ portalItem, strings, symbolType }) {
        this.symbolType = "2d";
        this.portalItem = portalItem;
        this.strings = strings;
        if (symbolType) {
            this.symbolType = symbolType;
        }
    }
    get data() {
        return this._data;
    }
    get id() {
        var _a;
        return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.id;
    }
    get keywords() {
        var _a;
        return ((_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.typeKeywords) || [];
    }
    get name() {
        var _a;
        return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.name;
    }
    get title() {
        var _a;
        return (_a = this.portalItem) === null || _a === void 0 ? void 0 : _a.title;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async fetchData(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._data) {
            this._data = await this.portalItem.fetchData("json", Object.assign(Object.assign({}, options), getInjectedRequestOptions(this.portalItem)));
        }
        return this._data;
    }
}
class SymbolSetSymbolSource extends PortalItemSymbolSourceBase {
    constructor() {
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        super(...arguments);
        //--------------------------------------------------------------------------
        //
        //  Properties
        //
        //--------------------------------------------------------------------------
        this.type = "symbol-set";
    }
    //--------------------------------------------------------------------------
    //
    //  Protected Methods
    //
    //--------------------------------------------------------------------------
    async getItems(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._items) {
            const data = await this.fetchData(options);
            this._items = data.map((item) => new SymbolItem({
                data: item,
                parentData: data,
                portalItem: this.portalItem,
                strategy: flatSymbolStrategy,
                strings: this.strings
            }));
        }
        return this._items;
    }
}
class WebStyleSymbolSource extends PortalItemSymbolSourceBase {
    constructor() {
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        super(...arguments);
        //--------------------------------------------------------------------------
        //
        //  Properties
        //
        //--------------------------------------------------------------------------
        this.type = "web-style";
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async getItems(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._items) {
            const data = await this.fetchData(options);
            this._items = data.items.map((item) => new SymbolItem({
                data: item,
                parentData: data,
                portalItem: this.portalItem,
                strategy: webStyleSymbolStrategy(this.symbolType),
                strings: this.strings
            }));
        }
        return this._items;
    }
}
class BasicSymbolSetSource {
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    constructor({ strings }) {
        this.keywords = [];
        this.name = "Basic";
        this.type = "symbol-set";
        this.title = strings.symbolSources.basic;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async getItems(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._items) {
            // no parent data since it's local
            this._items = this.data.map((data) => new SymbolItem({
                data,
                strategy: flatSymbolStrategy,
                strings: this.strings
            }));
        }
        return this._items;
    }
}
const basicPointSymbolSetSourceId = "basic-symbol-set:point";
const basicLineSymbolSetSourceId = "basic-symbol-set:line";
const basicPolygonSymbolSetSourceId = "basic-symbol-set:polygon";
class BasicPointSymbolSetSource extends BasicSymbolSetSource {
    constructor() {
        //--------------------------------------------------------------------------
        //
        //  Properties
        //
        //--------------------------------------------------------------------------
        super(...arguments);
        this.data = BASIC_SIMPLE_MARKER_SYMBOLS_JSON;
        this.id = basicPointSymbolSetSourceId;
        this.keywords = ["Point"];
    }
}
class BasicLineSymbolSetSource extends BasicSymbolSetSource {
    constructor() {
        //--------------------------------------------------------------------------
        //
        //  Properties
        //
        //--------------------------------------------------------------------------
        super(...arguments);
        this.data = BASIC_SIMPLE_LINE_SYMBOLS_JSON;
        this.id = basicLineSymbolSetSourceId;
        this.keywords = ["Line"];
    }
}
class BasicPolygonSymbolSetSource extends BasicSymbolSetSource {
    constructor() {
        //--------------------------------------------------------------------------
        //
        //  Properties
        //
        //--------------------------------------------------------------------------
        super(...arguments);
        this.data = BASIC_SIMPLE_POLYGON_SYMBOLS_JSON;
        this.id = basicPolygonSymbolSetSourceId;
        this.keywords = ["Polygon"];
    }
}
class IconPrimitiveWebStyleSource {
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    constructor({ strings }) {
        this.keywords = ["3d"];
        this.id = "basic-web-style:flat";
        this.name = "Basic";
        this.type = "web-style";
        this.data = { items: generateIconPrimitiveSymbolJson(strings) };
        this.title = strings.symbolSources.basic;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async getItems(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._items) {
            // no parent data since it's local
            this._items = this.data.items.map((data) => new SymbolItem({
                data,
                strategy: flatSymbolStrategy,
                strings: this.strings
            }));
        }
        return this._items;
    }
}
class ObjectPrimitiveWebStyleSource {
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    constructor({ strings }) {
        this.id = "basic-web-style:volumetric";
        this.keywords = ["3d", "volumetric"];
        this.name = "Basic";
        this.type = "web-style";
        this.data = { items: generateObjectPrimitiveSymbolJson(strings) };
        this.title = strings.symbolSources.basic;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async getItems(options) {
        if (_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.isAborted(options)) {
            throw _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.promiseUtils.createAbortError();
        }
        if (!this._items) {
            // no parent data since it's local
            this._items = this.data.items.map((data) => new SymbolItem({
                data,
                parentData: this.data,
                strategy: volumetricSymbolStrategy,
                strings: this.strings
            }));
        }
        return this._items;
    }
}
function styleNameFromItem(item) {
    // Find type keyword that looks like it's an esri style and hope it works
    for (const typeKeyword of item.typeKeywords) {
        if (/^Esri.*Style$/.test(typeKeyword) && typeKeyword !== "Esri Style") {
            return typeKeyword;
        }
    }
    return undefined;
}
async function symbolFromWebStyleJSON(style, name, item, type) {
    const styleName = styleNameFromItem(item);
    let styleUrl = null;
    if (!styleName) {
        styleUrl = `${item.itemUrl}/data`;
    }
    const styleResponse = {
        data: style,
        baseUrl: item.itemUrl,
        styleName,
        styleUrl
    };
    const { portal } = item;
    return _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.webStyleSymbolUtils.fetchSymbolFromStyle(styleResponse, name, { portal }, type, _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.styleUtils.symbolUrlFromStyleItem, getInjectedRequestOptions(item));
}

const CSS$1 = {
    markerItem: "marker-item",
    calciteDarkTheme: "calcite-mode-dark"
};
const MarkerItem = ({ item, index, observer }) => {
    const tooltip = item.data.title ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { "reference-element": item.data.name }, item.data.title)) : null;
    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: `${CSS$1.markerItem} ${CSS$1.calciteDarkTheme}`, ref: (node) => {
            if (!node) {
                return;
            }
            const alreadyProcessed = node.item;
            if (alreadyProcessed) {
                return;
            }
            node.item = item;
            node.index = index;
            observer.observe(node);
        }, id: item.data.name, slot: "thumbnail" }, tooltip));
};

function fetchSymbolSetSymbolSources(portal, strings) {
    return fetchSymbolSets(portal).then((items) => items.map((item) => new SymbolSetSymbolSource({
        portalItem: item,
        strings
    })));
}
function fetchSymbolSets(portal) {
    return itemFetcher({
        portal,
        queries: {
            group: portal.symbolSetsGroupQuery,
            item: `type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")`
        }
    }).then(moveDefaultToFirst);
}
function fetchWebStyleSymbolSources(portal, type, strings) {
    return fetchWebStyles(portal, type).then((items) => items.map((item) => new WebStyleSymbolSource({
        portalItem: item,
        symbolType: type,
        strings
    })));
}
async function fetchWebStyles(portal, type) {
    const group = type === "2d" ? portal.stylesGroupQuery2d : portal.stylesGroupQuery3d;
    if (!group) {
        return [];
    }
    return itemFetcher({
        portal,
        queries: {
            group,
            item: `type:"Style"`
        }
    }).then(moveDefaultToFirst);
}
function getPrimitives(dimensionality, strings) {
    return dimensionality === "flat"
        ? new IconPrimitiveWebStyleSource({ strings })
        : new ObjectPrimitiveWebStyleSource({ strings });
}
function getBasic(strings, geometryType) {
    const props = { strings };
    return geometryType === "line"
        ? new BasicLineSymbolSetSource(props)
        : geometryType === "polygon"
            ? new BasicPolygonSymbolSetSource(props)
            : new BasicPointSymbolSetSource(props);
}
async function itemFetcher(options) {
    const portal = options.portal;
    const groupQuery = options.queries.group;
    const itemQuery = options.queries.item;
    const maxItems = 100;
    const { results } = await portal.queryGroups({ query: groupQuery, disableExtraQuery: true });
    if (results.length === 0) {
        return [];
    }
    const [group] = results;
    return (await group.queryItems({
        query: itemQuery,
        disableExtraQuery: true,
        num: maxItems,
        sortField: group.sortField
    })).results;
}
function hasKeyword(item, keyword) {
    return item.typeKeywords.indexOf(keyword) > -1;
}
function moveDefaultToFirst(results) {
    const sorted = [];
    results.forEach((set) => {
        if (hasKeyword(set, "default")) {
            sorted.unshift(set);
        }
        else {
            sorted.push(set);
        }
    });
    return sorted;
}

const cimGeometryItemType = {
    point: "pointSymbol",
    line: "lineSymbol",
    polygon: "polygonSymbol"
};
const isInterceptor = (portalOrPortalInterceptor) => !!portalOrPortalInterceptor.portal;
async function asyncFilter(items, predicate) {
    return Promise.all(items.map(predicate)).then((results) => items.filter((_item, index) => results[index]));
}
async function filterSymbolItems(source, symbolItems, markerType, geometryType, symbolType, filter) {
    const allowed = normalizeAllowedTypes(markerType);
    const defaultSourceFilter = symbolType === "2d"
        ? createDefaultSymbolItemFilter2d(geometryType, allowed)
        : createDefaultSymbolItemFilter3d(allowed);
    const effectiveFilter = async (symbolItem) => filter ? filter(symbolItem, source, defaultSourceFilter) : defaultSourceFilter(symbolItem, source);
    return asyncFilter(symbolItems, effectiveFilter);
}
function createDefaultSymbolItemFilter2d(geometryType, allowedTypes) {
    function symbolItemOnlyFilter(symbolItem) {
        if (allowedTypes.includes("all")) {
            return true;
        }
        const { data } = symbolItem;
        const { dimensionality, type: symbolType } = data;
        if (dimensionality === "volumetric") {
            return false;
        }
        if (geometryType === "point") {
            if (allowedTypes.includes("picture") && symbolType === "esriPMS") {
                return true;
            }
            if (allowedTypes.includes("simple") && symbolType === "esriSMS") {
                return true;
            }
        }
        if (geometryType === "line") {
            if (allowedTypes.includes("simple") && symbolType === "esriSLS") {
                return true;
            }
        }
        if (geometryType === "polygon") {
            if (allowedTypes.includes("simple") && symbolType === "esriSFS") {
                return true;
            }
        }
        const { formats } = data;
        if (hasCIMType(allowedTypes) && hasCIMType(formats)) {
            return true;
        }
        return false;
    }
    return async function defaultSymbolItemFilter2d(symbolItem, source) {
        const geometrySymbolFilter = geometryType === "point" ? _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.j : geometryType === "line" ? _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.h : _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.f;
        if (!symbolItemOnlyFilter(symbolItem)) {
            return false;
        }
        const hasPictureCIM = allowedTypes.includes("cim:picture");
        const hasVectorCIM = allowedTypes.includes("cim:vector");
        const hasAllOrNoCIMFilters = (hasPictureCIM && hasVectorCIM) || (!hasPictureCIM && !hasVectorCIM);
        // TODO: base on geomtype
        const isPointOnlyCimSource = hasCimPointKeyword(source) && !hasCimLineKeyword(source) && !hasCimPolygonKeyword(source);
        const isLineOnlyCimSource = hasCimLineKeyword(source) && !hasCimPointKeyword(source) && !hasCimPolygonKeyword(source);
        const isPolygonOnlyCimSource = hasCimPolygonKeyword(source) && !hasCimPointKeyword(source) && !hasCimLineKeyword(source);
        const requestedType = geometryType === "line"
            ? cimGeometryItemType.line
            : geometryType === "polygon"
                ? cimGeometryItemType.polygon
                : cimGeometryItemType.point;
        const isRequestedTypeCimSource = isPointOnlyCimSource || isLineOnlyCimSource || isPolygonOnlyCimSource;
        if ((isRequestedTypeCimSource && hasAllOrNoCIMFilters) ||
            source.type !== "web-style" ||
            symbolItem.data.itemType === requestedType) {
            return true;
        }
        const symbol = await symbolItem.getSymbol();
        // we only filter CIM symbols, the rest we let through
        return !(0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.i)(symbol) || geometrySymbolFilter(symbol);
    };
}
function createDefaultSymbolItemFilter3d(allowedTypes) {
    return async function defaultSymbolItemFilter3d(symbolItem) {
        if (allowedTypes.includes("all") || allowedTypes.includes("3d")) {
            return true;
        }
        const { data: { dimensionality } } = symbolItem;
        return ((allowedTypes.includes("3d:flat") && dimensionality === "flat") ||
            (allowedTypes.includes("3d:volumetric") && dimensionality === "volumetric"));
    };
}
const geometryTypeKeywords = {
    point: "Point",
    line: "Line",
    polygon: "Polygon"
};
function hasCimPointKeyword({ keywords }) {
    return keywords.includes(geometryTypeKeywords.point) || keywords.includes("pointSymbol");
}
function hasMarkerKeyword({ keywords }) {
    return keywords.includes("marker");
}
function hasCimLineKeyword({ keywords }) {
    return keywords.includes(geometryTypeKeywords.line) || keywords.includes("lineSymbol");
}
function hasCimPolygonKeyword({ keywords }) {
    return keywords.includes(geometryTypeKeywords.polygon) || keywords.includes("polygonSymbol");
}
async function filterSources(sources, type, geometryType, symbolType, filter) {
    const allowed = normalizeAllowedTypes(type);
    const defaultSourceFilter = symbolType === "2d"
        ? createDefaultSymbolSourceFilter2d(geometryType, allowed)
        : createDefaultSymbolSourceFilter3d(allowed);
    const effectiveFilter = async (symbolSource) => filter ? filter(symbolSource, defaultSourceFilter) : defaultSourceFilter(symbolSource);
    return asyncFilter(sources, effectiveFilter);
}
function createDefaultSymbolSourceFilter2d(geometryType, allowedTypes) {
    return async (source) => {
        const is3d = source.keywords.includes("3d");
        const isDictionary = source.keywords.includes("Dictionary");
        const matchesGeometryType = geometryType === "point"
            ? hasCimPointKeyword(source) || hasMarkerKeyword(source)
            : geometryType === "line"
                ? hasCimLineKeyword(source)
                : hasCimPolygonKeyword(source);
        const hasAtLeastOneGeomKeyword = hasCimPointKeyword(source) ||
            hasMarkerKeyword(source) ||
            hasCimLineKeyword(source) ||
            hasCimPolygonKeyword(source);
        if (is3d || isDictionary || (!matchesGeometryType && hasAtLeastOneGeomKeyword)) {
            return false;
        }
        if (allowedTypes.includes("all")) {
            return true;
        }
        function getBasicSourceId() {
            return geometryType === "point"
                ? basicPointSymbolSetSourceId
                : geometryType === "line"
                    ? basicLineSymbolSetSourceId
                    : basicPolygonSymbolSetSourceId;
        }
        const basicSymbolSetSourceId = getBasicSourceId();
        if (allowedTypes.includes("picture") && source.id != basicSymbolSetSourceId && source.type === "symbol-set") {
            return true;
        }
        if (allowedTypes.includes("simple") && source.id === basicSymbolSetSourceId) {
            return true;
        }
        if (hasCIMType(allowedTypes) && source.type === "web-style") {
            return true;
        }
        return false;
    };
}
function isPortalSource(source) {
    return "portalItem" in source;
}
function createDefaultSymbolSourceFilter3d(allowedTypes) {
    const webStyleItemKeywordBlocklist = {
        EsriThematicShapesStyle: true
    };
    return async (source) => {
        if (source.keywords.every((keyword) => !webStyleItemKeywordBlocklist[keyword]) &&
            source.type === "web-style" &&
            (allowedTypes.includes("all") || allowedTypes.includes("3d"))) {
            return true;
        }
        if (isPortalSource(source)) {
            const data = await source.fetchData();
            const [first] = data.items;
            const { dimensionality } = first;
            return ((allowedTypes.includes("3d:flat") && dimensionality === "flat") ||
                (allowedTypes.includes("3d:volumetric") && dimensionality === "volumetric"));
        }
        return ((allowedTypes.includes("3d:flat") && source.id == "basic-web-style:flat") ||
            (allowedTypes.includes("3d:volumetric") && source.id == "basic-web-style:volumetric"));
    };
}
function hasCIMType(types) {
    return Array.isArray(types) && types.some((type) => type.includes("cim"));
}
function normalizeAllowedTypes(type = "all") {
    const types = Array.isArray(type) ? type : [type];
    const hasRedundantCIMTypes = types.find((type) => type === "cim" && types.find((type) => type.includes("cim:")));
    if (hasRedundantCIMTypes) {
        return types.filter((type) => !type.includes("cim:"));
    }
    return types;
}
async function fetchSources(portal, before, after, strings, type) {
    const interceptorData = {};
    if (before) {
        await before(portal, interceptorData);
    }
    await portal.load();
    const processedSources = await (type === "2d" ? build2dSources(portal, strings) : build3dSources(portal, strings));
    if (after) {
        await after(portal, interceptorData);
    }
    return processedSources;
}
async function build2dSources(portal, strings) {
    const originalSymbolSetsGroupQuery = portal.symbolSetsGroupQuery;
    portal.symbolSetsGroupQuery = 'owner:esri AND title:"Map Viewer Beta Symbols"';
    const [classic, sources] = await Promise.all([
        fetchSymbolSetSymbolSources(portal, strings),
        fetchWebStyleSymbolSources(portal, "2d", strings)
    ]);
    const filterOutBasicTypes = (source) => source.keywords.every((type) => type !== "Basic");
    const processedSources = [
        getBasic(strings, "point"),
        getBasic(strings, "line"),
        getBasic(strings, "polygon"),
        ...classic.filter(filterOutBasicTypes),
        ...sources.filter(filterOutBasicTypes)
    ];
    portal.symbolSetsGroupQuery = originalSymbolSetsGroupQuery;
    return processedSources;
}
async function build3dSources(portal, strings) {
    const [sources] = await Promise.all([fetchWebStyleSymbolSources(portal, "3d", strings)]);
    const filterOutBasicTypes = (source) => source.keywords.every((type) => type !== "Basic");
    const processedSources = [
        getPrimitives("flat", strings),
        getPrimitives("volumetric", strings),
        ...sources.filter(filterOutBasicTypes)
    ];
    return processedSources;
}

const arcgisSymbolPickerCss = ".scroller.sc-arcgis-symbol-picker{max-height:var(--scroller-max-height, min(100vh - 400px, 300px));overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}.sc-arcgis-symbol-picker-h,.arcgis-symbol-picker__container.sc-arcgis-symbol-picker{display:flex;flex:1 1 auto;flex-flow:column nowrap;align-items:stretch}.categories.sc-arcgis-symbol-picker{display:flex;align-content:normal}.categories-center-action.sc-arcgis-symbol-picker{padding:0 5px}.marker-selection.sc-arcgis-symbol-picker{padding:8px}.marker-source-select.sc-arcgis-symbol-picker{width:calc(100% - 74px);display:block}.marker-source-select[hidden].sc-arcgis-symbol-picker+.marker-selection.sc-arcgis-symbol-picker{border-top:1px solid lightgray;background-color:var(--arcgis-app-background)}.marker-selection--dark.sc-arcgis-symbol-picker{background-color:var(--arcgis-app-foreground);color:var(--arcgis-app-background)}.empty-category-content.sc-arcgis-symbol-picker{display:flex;align-items:center;padding:var(--arcgis-app-spacing-half) var(--arcgis-app-spacing-quarter)}.incompatible-symbols-notice.sc-arcgis-symbol-picker{margin:8px 0}.marker-item.sc-arcgis-symbol-picker{height:40px;width:38.5px;display:flex;justify-content:center;align-items:center;background-color:var(--arcgis-app-background)}.marker-item.sc-arcgis-symbol-picker [slot=thumbnail].sc-arcgis-symbol-picker>div.sc-arcgis-symbol-picker{margin:8px 10px;display:flex;justify-content:center;align-items:center}.item-palette.sc-arcgis-symbol-picker{width:100%;display:flex;flex-direction:column}.file-upload.sc-arcgis-symbol-picker{margin-top:20px;width:auto}";

const CSS = {
    container: "arcgis-symbol-picker__container",
    markerSymbolContent: "marker-symbol-content",
    incompatibleSymbolsNotice: "incompatible-symbols-notice",
    emptyCategoryContent: "empty-category-content",
    markerSelectionDropdown: "marker-source-select",
    markerSelection: "marker-selection",
    markerSelectionDark: "marker-selection--dark",
    scroller: "scroller",
    itemPalette: "item-palette",
    fileUpload: "file-upload",
    categories: "categories",
    categoriesCenterAction: "categories-center-action"
};
const ArcgisSymbolPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisActiveSymbolChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSymbolChange", 7);
        this.arcgisActiveSymbolItemChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSymbolItemChange", 7);
        this.arcgisActiveSourceIdChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSourceIdChange", 7);
        this.arcgisSymbolSourcesChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolSourcesChange", 7);
        this.arcgisActiveSourceItemsChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisActiveSourceItemsChange", 7);
        this.allCustomFileInfos = [];
        this.customSymbolsStorageId = "arcgis-symbol-picker-custom-symbols";
        this.actionEls = [];
        this._onSymbolSourceChange = (event) => {
            const dropdown = event.currentTarget;
            const { selectedItems } = dropdown;
            const mostRecentSelection = selectedItems.find((item) => item.getAttribute("data-value") !== this._activeSourceId);
            this._activeSourceId = (mostRecentSelection === null || mostRecentSelection === void 0 ? void 0 : mostRecentSelection.getAttribute("data-value")) || this._activeSourceId;
            dropdown
                .querySelectorAll("calcite-dropdown-item")
                .forEach((item) => {
                if (item !== mostRecentSelection) {
                    item.selected = false;
                }
            });
            event.stopPropagation();
        };
        this.symbol = undefined;
        this.portal = undefined;
        this.symbolFilter = undefined;
        this.activeSourceId = undefined;
        this.activeSymbolItem = undefined;
        this.hideHeader = false;
        this.symbolType = "2d";
        this.customSymbolItemFilter = undefined;
        this.customSymbolSourceFilter = undefined;
        this.itemsPerRow = 4;
        this.symbolSources = undefined;
        this.activeSymbolItems = undefined;
        this.messages = undefined;
        this._activeSourceId = undefined;
        this._symbolSources = undefined;
        this._activeSymbolItems = undefined;
        this.customSymbolError = undefined;
        this.isGridView = true;
        this._activeSymbolFetch = undefined;
    }
    /**
     * Whenever the activeSource changes, we fetch
     * the new symbol items for that sources.
     */
    handleActiveSourceItemIdChanges() {
        if (this._activeSourceId) {
            this._activeSourceId === "custom-symbol-set"
                ? this._setupCustomSymbols()
                : this._fetchAndSetUpSymbolItems(this._symbolSources.find(({ id }) => id === this._activeSourceId));
        }
    }
    get editGeometry() {
        return (0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.symbol);
    }
    handleFileUploadChange({ detail }) {
        const fileInfo = detail;
        const cimStr = fileInfo.cim && JSON.stringify(fileInfo.cim.toJSON());
        if (fileInfo.dataURL && fileInfo.dataURL.length > 200000) {
            this.customSymbolError = "too-large";
            return;
        }
        else if (fileInfo.cim && cimStr.length > 200000) {
            this.customSymbolError = "too-large";
            return;
        }
        else {
            this.customSymbolError = undefined;
        }
        const foundFileInfo = this.allCustomFileInfos.find((info) => (fileInfo.dataURL &&
            info.dataURL &&
            info.dataURL === fileInfo.dataURL &&
            info.fileName === fileInfo.fileName) ||
            (fileInfo.cim &&
                info.cim &&
                info.fileName === fileInfo.fileName &&
                cimStr === JSON.stringify(info.cim.toJSON())));
        try {
            let activeSymbolItem;
            if (!foundFileInfo) {
                const allCustomFileInfos = [...this.allCustomFileInfos, fileInfo];
                (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.s)(this.customSymbolsStorageId, allCustomFileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: JSON.stringify(info.cim.toJSON()) })), true);
                this.allCustomFileInfos = allCustomFileInfos;
                this._setupCustomSymbols();
                activeSymbolItem = this._activeSymbolItems[this._activeSymbolItems.length - 1];
            }
            else {
                activeSymbolItem = this._activeSymbolItems.find((symbolItem) => symbolItem.data.name === foundFileInfo.fileName);
            }
            // select active symbol
            this.activeSymbolItem = activeSymbolItem;
            this.arcgisActiveSymbolItemChange.emit(this.activeSymbolItem);
            this.activeSymbolItem
                .getSymbol()
                .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
            setTimeout(() => requestAnimationFrame(() => {
                var _a;
                (_a = this.itemPaletteNode) === null || _a === void 0 ? void 0 : _a.setFocus();
                this.updateListSelection();
            }), 1);
        }
        catch (e) {
            // e.name === QuotaExceededError
            this.customSymbolError = "storage-full";
        }
    }
    handleInvalidFile() {
        this.customSymbolError = "invalid-file";
    }
    handleFileUploadError() {
        this.customSymbolError = "error";
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    _renderSymbolSourceOptions(sources, activeSourceId) {
        const { messages: mergedStrings } = this;
        const classic = sources.filter((source) => source.type === "symbol-set");
        const webStyles = sources.filter((source) => source.type === "web-style");
        const showCustomSymbols = !this.symbolFilter ||
            !!(Array.isArray(this.symbolFilter) ? this.symbolFilter : [this.symbolFilter]).find((type) => type === "custom" || type === "picture");
        const customGroup = this.symbolType !== "3d" &&
            this.editGeometry === "point" &&
            showCustomSymbols && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.customSymbols, selectionMode: "multiple", key: "custom" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: "custom", "data-value": "custom-symbol-set", selected: "custom-symbol-set" === activeSourceId }, mergedStrings.symbols)));
        const classicGroup = classic.length > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.classicSymbols, selectionMode: "multiple", key: "classic" }, this._renderSourceDropdownItem(classic, activeSourceId)));
        const webStyleGroup = webStyles.length > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { groupTitle: mergedStrings.newSymbols, selectionMode: "multiple", key: "webstyles" }, this._renderSourceDropdownItem(webStyles, activeSourceId)));
        if (customGroup) {
            if (classicGroup) {
                if (webStyleGroup) {
                    return [customGroup, classicGroup, webStyleGroup];
                }
                else {
                    return [customGroup, classicGroup];
                }
            }
            else {
                return [customGroup, webStyleGroup];
            }
        }
        else if (classicGroup && webStyleGroup) {
            return [classicGroup, webStyleGroup];
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { key: "one-group" }, this._renderSourceDropdownItem([...classic, ...webStyles], activeSourceId)));
    }
    _renderSourceDropdownItem(sources, activeSourceId) {
        return sources.map((source) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: source.id, "data-value": source.id, selected: source.id === activeSourceId }, source.title)));
    }
    _setupCustomSymbols() {
        const existingSymbolItems = this.allCustomFileInfos.map((info) => {
            let width = 24;
            let height = 24;
            if (info.width > info.height) {
                height = Math.round((width / info.width) * info.height);
            }
            else if (info.width < info.height) {
                width = Math.round((height / info.height) * info.width);
            }
            if (info.dataURL) {
                const type = info.fileName.split(".")[1].toLowerCase();
                const contentType = type === "png" ? "image/png" : type === "gif" ? "image/gif" : "image/jpeg";
                return new SymbolItem({
                    data: {
                        angle: 0,
                        contentType,
                        height,
                        imageData: info.dataURL.split(",")[1],
                        name: info.fileName,
                        type: "esriPMS",
                        url: undefined,
                        width,
                        xoffset: 0,
                        yoffset: 0
                    },
                    parentData: null,
                    portalItem: null,
                    strategy: flatSymbolStrategy,
                    strings: this.messages
                });
            }
            else {
                return new SymbolItem({
                    data: {
                        symbol: info.cim,
                        name: info.fileName
                    },
                    parentData: { cimVersion: "2.6.0" },
                    portalItem: null,
                    strategy: webStyleCustomSymbolStrategy(),
                    strings: this.messages
                });
            }
        });
        this.setUpSymbolIntersectionObserver();
        this.customSymbolError = undefined;
        this._activeSymbolFetch = null;
        this._activeSymbolItems = existingSymbolItems;
        //if (this._activeSourceId !== "custom-symbol-set") {
        this.arcgisActiveSourceIdChange.emit("custom-symbol-set");
        //}
        this.arcgisActiveSourceItemsChange.emit(existingSymbolItems.map((item) => new SymbolItem(Object.assign({}, item))));
    }
    async _fetchAndSetUpSymbolItems(source) {
        if (this._activeSymbolFetch) {
            this._activeSymbolFetch.controller.abort();
        }
        const controller = new AbortController();
        const signal = controller.signal;
        this._activeSymbolFetch = {
            controller,
            id: source.id
        };
        // When loading for the first time, we check if there are some symbolItems passed
        // to the props and we trust it's the correct one for the current activeSymbolSource
        const symbolItems = (!this._activeSymbolItems && this.activeSymbolItems) || (await source.getItems(controller));
        if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
            return;
        }
        const filteredSymbolItems = await filterSymbolItems(source, symbolItems, this.symbolFilter, this.editGeometry, this.symbolType, this.customSymbolItemFilter);
        if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
            return;
        }
        this.setUpSymbolIntersectionObserver();
        this.customSymbolError = undefined;
        this._activeSymbolFetch = null;
        this._activeSymbolItems = filteredSymbolItems;
        this.arcgisActiveSourceIdChange.emit(this._activeSourceId);
        this.arcgisActiveSourceItemsChange.emit(filteredSymbolItems.map((item) => new SymbolItem(Object.assign({}, item))));
    }
    onIncompatibleVectorSymbolsDismiss(event) {
        (0,_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.s)(_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.l.ARCGIS_COMPONENT_NOTIFICATIONS, {
            key: _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED,
            value: "true"
        });
        event.stopPropagation();
    }
    tearDownSymbolIntersectionObserver() {
        var _a;
        (_a = this._symbolIntersectionObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
        this._symbolIntersectionObserver = null;
    }
    setUpSymbolIntersectionObserver() {
        this.tearDownSymbolIntersectionObserver();
        let nowServingIndex = 0;
        const pendingAppends = {};
        this._symbolIntersectionObserver = new IntersectionObserver((entries, observer) => {
            function next() {
                nowServingIndex++;
                if (pendingAppends[nowServingIndex]) {
                    pendingAppends[nowServingIndex]();
                    delete pendingAppends[nowServingIndex];
                    next();
                }
            }
            entries.forEach((entry) => {
                if (!entry.isIntersecting) {
                    return;
                }
                const node = entry.target;
                node.item.getThumbnail(node).then((appendThumbnail) => {
                    if (node.index === nowServingIndex) {
                        appendThumbnail();
                        next();
                    }
                    else {
                        pendingAppends[node.index] = appendThumbnail;
                    }
                });
                node.item.getSymbol();
                observer.unobserve(node);
            });
        });
    }
    async _fetchSources() {
        if (this._sourcesFetchController) {
            this._sourcesFetchController.abort();
        }
        this._sourcesFetchController = new AbortController();
        const signal = this._sourcesFetchController.signal;
        const portal = this.portal;
        const effectivePortal = isInterceptor(portal) ? portal.portal : portal;
        const beforeInterceptor = isInterceptor(portal) ? portal.before : null;
        const afterInterceptor = isInterceptor(portal) ? portal.after : null;
        const symbolSources = effectivePortal
            ? this.symbolSources ||
                (await fetchSources(effectivePortal, beforeInterceptor, afterInterceptor, this.messages, this.symbolType))
            : [];
        if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
            return;
        }
        this._symbolSources = await filterSources(symbolSources, this.symbolFilter, (0,_symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.symbol), this.symbolType, this.customSymbolSourceFilter);
        this.arcgisSymbolSourcesChange.emit(this._symbolSources);
        if (!this._activeSourceId) {
            let activeSourceId = this.activeSourceId;
            if (activeSourceId) {
                const activeSource = this._symbolSources.find((source) => source.id === this.activeSourceId);
                if (!activeSource) {
                    // maybe different symbol geometry type now; can't re-use last source
                    activeSourceId = undefined;
                }
            }
            this._activeSourceId = activeSourceId || this._symbolSources[0].id;
        }
    }
    _getCustomSymbolsFromStorage() {
        if (this.symbolType === "3d" || this.editGeometry !== "point") {
            return;
        }
        const fileInfos = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.customSymbolsStorageId, true);
        if (fileInfos) {
            this.allCustomFileInfos = fileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.CIMSymbol.fromJSON(JSON.parse(info.cim)) }));
        }
    }
    _renderSourceSelection() {
        const { messages: mergedStrings } = this;
        const sources = this._symbolSources;
        if (!sources) {
            return;
        }
        const activeSource = this._symbolSources.find((source) => source.id === this._activeSourceId);
        const activeSourceTitle = this._activeSourceId === "custom-symbol-set"
            ? mergedStrings.customSymbols
            : activeSource === null || activeSource === void 0 ? void 0 : activeSource.title;
        const hasSingleSource = sources.length === 1;
        const dropdown = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { class: {
                [CSS.markerSelectionDropdown]: true
            }, hidden: hasSingleSource, maxItems: 7, onCalciteDropdownSelect: this._onSymbolSourceChange, overlayPositioning: "absolute" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", scale: "m", slot: "trigger", width: "full" }, activeSourceTitle), this._renderSymbolSourceOptions(sources, this._activeSourceId)));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section", key: "header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "section" }, !this.hideHeader ? this.messages.category : null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.categories }, dropdown, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { active: this.isGridView, appearance: "transparent", icon: "grid", scale: "s", class: CSS.categoriesCenterAction, text: this.messages.gridView, onClick: () => {
                this.isGridView = true;
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { active: !this.isGridView, appearance: "transparent", icon: "list", iconFlipRtl: true, scale: "s", text: this.messages.listView, onClick: () => {
                this.isGridView = false;
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
            } })))));
    }
    _renderItemSelection() {
        const { portal, messages: mergedStrings } = this;
        const fetchingSymbolItems = this._activeSymbolFetch;
        const effectivePortal = isInterceptor(portal) ? portal.portal : portal;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                [CSS.scroller]: true,
                [CSS.markerSelection]: true
            }, key: "gallery" }, fetchingSymbolItems ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "" })) : this._activeSymbolItems.length === 0 && this._activeSourceId === "custom-symbol-set" ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-picker-file-upload", { portal: effectivePortal, strings: mergedStrings })) : this._activeSymbolItems.length > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.itemPalette, key: this._activeSymbolItems.length }, this.isGridView ? this._renderGridView() : this._renderListView(), this._activeSourceId === "custom-symbol-set" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-picker-file-upload", { class: CSS.fileUpload, portal: effectivePortal, strings: mergedStrings })))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.emptyCategoryContent }, this.messages.noSymbolsAvailable))));
    }
    _renderGridView() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-palette", { key: this._activeSourceId, items: this._activeSymbolItems.map((item, index) => ({
                item,
                index,
                observer: this._symbolIntersectionObserver
            })), ItemRenderer: MarkerItem, itemsPerRow: this.itemsPerRow, selected: ({ item }) => { var _a; return (item === null || item === void 0 ? void 0 : item.data) === ((_a = this.activeSymbolItem) === null || _a === void 0 ? void 0 : _a.data); }, onArcgisItemSelect: (event) => {
                const { detail: { item } } = event;
                this.customSymbolError = undefined;
                // This is just for the UI to remember which element is selected
                this.arcgisActiveSymbolItemChange.emit(item);
                this.activeSymbolItem = item;
                // Send back the actual symbol:
                item
                    .getSymbol()
                    .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
                event.stopPropagation();
            }, ref: (node) => (this.itemPaletteNode = node) }));
    }
    _renderListView() {
        const isRtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.el) === "rtl";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { key: this._activeSourceId }, this._activeSymbolItems.map((item, index) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: index, label: item.data.title || item.data.name, value: index, selected: ((_a = this.activeSymbolItem) === null || _a === void 0 ? void 0 : _a.data.name) === item.data.name, onCalciteListItemSelect: (event) => {
                    const node = event.target;
                    const selectedItem = this._activeSymbolItems[node.value];
                    this.customSymbolError = undefined;
                    // This is just for the UI to remember which element is selected
                    this.arcgisActiveSymbolItemChange.emit(selectedItem);
                    this.activeSymbolItem = selectedItem;
                    // Send back the actual symbol:
                    selectedItem
                        .getSymbol()
                        .then((symbol) => this.arcgisActiveSymbolChange.emit(symbol));
                    event.stopPropagation();
                } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-start", key: item.data.name, ref: (divNode) => {
                    if (divNode) {
                        item.getThumbnail(divNode).then((appendThumbnail) => appendThumbnail());
                        item.getSymbol();
                    }
                } }), this._activeSourceId === "custom-symbol-set" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", appearance: "transparent", text: this.messages.removeSymbol, ref: (node) => {
                    if (node) {
                        this.actionEls[index] = node;
                    }
                }, onClick: () => {
                    this.removeCustomSymbol(index);
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.el);
                }, onMouseOver: () => this.addTooltip({
                    referenceElement: this.actionEls[index],
                    placement: isRtl ? "right-start" : "left-start",
                    innerHTML: this.messages.removeSymbol
                }), onMouseOut: () => this.removeTooltip() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x" })))));
        })));
    }
    updateListSelection() {
        console.log("updateListSelection");
        this.el
            .querySelectorAll("CALCITE-LIST-ITEM")
            .forEach((listItem) => {
            listItem.selected = listItem.value === this.activeSymbolItem.data.name;
            if (listItem.selected) {
                listItem.setFocus();
            }
        });
    }
    removeCustomSymbol(index) {
        this.allCustomFileInfos.splice(index, 1);
        (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.s)(this.customSymbolsStorageId, this.allCustomFileInfos.map((info) => info.dataURL ? info : Object.assign(Object.assign({}, info), { cim: JSON.stringify(info.cim.toJSON()) })), true);
        this._setupCustomSymbols();
        this.activeSymbolItem = undefined;
    }
    addTooltip(props) {
        this.removeTooltip();
        this.tooltipEl = document.createElement("calcite-tooltip");
        this.tooltipEl.placement = props.placement || "auto";
        this.tooltipEl.referenceElement = props.referenceElement;
        this.tooltipEl.overlayPositioning = "fixed";
        this.tooltipEl.innerHTML = props.innerHTML;
        this.tooltipEl.open = true;
        // it won't show if just added to this.el
        this.el.parentElement.appendChild(this.tooltipEl);
    }
    removeTooltip() {
        var _a;
        if ((_a = this.tooltipEl) === null || _a === void 0 ? void 0 : _a.parentNode) {
            this.tooltipEl.parentNode.removeChild(this.tooltipEl);
            this.tooltipEl = undefined;
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const [, [strings]] = await Promise.all([
            _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_2__.e.load(),
            (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el)
        ]);
        this.messages = strings;
    }
    componentDidLoad() {
        if (!this._symbolSources) {
            this._fetchSources();
        }
        this._getCustomSymbolsFromStorage();
    }
    connectedCallback() {
        var _a, _b;
        this.setUpSymbolIntersectionObserver();
        (_a = this._activeSymbolFetch) === null || _a === void 0 ? void 0 : _a.controller.abort();
        (_b = this._sourcesFetchController) === null || _b === void 0 ? void 0 : _b.abort();
    }
    disconnectedCallback() {
        this.tearDownSymbolIntersectionObserver();
    }
    render() {
        const sources = this._symbolSources;
        const fetchingSymbolItems = this._activeSymbolFetch;
        if (!sources || fetchingSymbolItems) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "" })));
        }
        const activeSourceIsSMS = this._activeSourceId === "basic-symbol-set" || this._activeSourceId === "custom-symbol-set";
        const activeSource = this._symbolSources.find((source) => source.id === this._activeSourceId);
        const modernSymbolCategorySelected = !activeSourceIsSMS && (activeSource === null || activeSource === void 0 ? void 0 : activeSource.type) !== "symbol-set";
        const adobeSymbolCategorySelected = activeSource === null || activeSource === void 0 ? void 0 : activeSource.keywords.includes("Adobe");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, this._renderSourceSelection(), this._renderItemSelection(), adobeSymbolCategorySelected ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, kind: "danger", key: "copyright", scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message", innerHTML: this.messages.adobeCopyright.replace("${year}", "2022") }))) : null, modernSymbolCategorySelected &&
            this.symbolType !== "3d" &&
            !(0,_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.g)(_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.l.ARCGIS_COMPONENT_NOTIFICATIONS, _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_3__.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, class: CSS.incompatibleSymbolsNotice, closable: true, icon: true, key: "incompatible-symbols", onCalciteNoticeClose: this.onIncompatibleVectorSymbolsDismiss, scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.messages.incompatibleSymbolWarning))) : null, this.customSymbolError ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: true, class: CSS.incompatibleSymbolsNotice, closable: true, icon: "exclamation-mark-circle", kind: "danger", key: "large-symbol", onCalciteNoticeClose: () => (this.customSymbolError = undefined), scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.customSymbolError === "too-large"
            ? this.messages.customSymbolErrors.tooLarge
            : this.customSymbolError === "invalid-file"
                ? this.messages.customSymbolErrors.invalidFile
                : this.customSymbolError === "storage-full"
                    ? this.messages.customSymbolErrors.outOfSpace
                    : this.customSymbolError === "error"
                        ? this.messages.customSymbolErrors.error
                        : undefined))) : null));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "_activeSourceId": ["handleActiveSourceItemIdChanges"]
    }; }
};
ArcgisSymbolPicker.style = arcgisSymbolPickerCss;



//# sourceMappingURL=arcgis-symbol-picker.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-16791b45.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-16791b45.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ alphaToTransparency),
/* harmony export */   c: () => (/* binding */ create),
/* harmony export */   i: () => (/* binding */ isNullEquivalentColor),
/* harmony export */   t: () => (/* binding */ transparencyToAlpha)
/* harmony export */ });
/* harmony import */ var _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./symbolUtils-f207d979.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolUtils-f207d979.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// we allow users to enter 1 decimal as a transparency % value
const alphaToTransparency = (alpha) => Number(((1 - alpha) * 100).toFixed(1));
const transparencyToAlpha = (transparency) => Number((1 - transparency / 100).toFixed(3));
const nullEquivalentColor = [0, 0, 0, 0];
function create(color, json = false) {
    const colorToCreate = color !== null && color !== void 0 ? color : nullEquivalentColor;
    return json ? _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_0__.e.Color.fromJSON(colorToCreate) : new _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_0__.e.Color(colorToCreate);
}
function isNullEquivalentColor({ r, g, b, a }) {
    return r === 0 && g === 0 && b === 0 && a === 0;
}



//# sourceMappingURL=color-16791b45.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arcgisComponentNotificationsKeys),
/* harmony export */   g: () => (/* binding */ getSingleObjectLocalStorage),
/* harmony export */   l: () => (/* binding */ localStorageKeys),
/* harmony export */   s: () => (/* binding */ setSingleObjectLocalStorage)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
var localStorageKeys;
(function (localStorageKeys) {
    localStorageKeys["ARCGIS_COMPONENT_NOTIFICATIONS"] = "arcgisComponent_notifications";
})(localStorageKeys || (localStorageKeys = {}));
var arcgisComponentNotificationsKeys;
(function (arcgisComponentNotificationsKeys) {
    arcgisComponentNotificationsKeys["FEATURE_REDUCTION_WARNING_DISMISSED"] = "arcgis_feature_reduction_warning_dismissed";
    arcgisComponentNotificationsKeys["POPUP_WARNING_DISMISSED"] = "arcgis_popup_warning_dismissed";
    arcgisComponentNotificationsKeys["INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED"] = "arcgis_symbol_styler_incompatible_vector_symbols_dismissed";
    arcgisComponentNotificationsKeys["EFFECTS_TIP_DISMISSED"] = "arcgis_effects_tip_dismissed";
    arcgisComponentNotificationsKeys["LAYER_VIEW_DEFINITION_DISMISSED"] = "arcgis_layer_view_definition_dismissed";
    arcgisComponentNotificationsKeys["LAYER_OVERRIDE_STATUS_TIP_DISMISSED"] = "arcgis_layer_override_status_tip_dismissed";
    arcgisComponentNotificationsKeys["SMART_MAPPING_TIP1_DISMISSED"] = "arcgis_smart_mapping_tip1_dismissed";
    arcgisComponentNotificationsKeys["SMART_MAPPING_TIP2_DISMISSED"] = "arcgis_smart_mapping_tip2_dismissed";
    arcgisComponentNotificationsKeys["LAYER_VIEW_JOIN_TIP_DISMISSED"] = "arcgis_layer_view_join_tip_dismissed";
    arcgisComponentNotificationsKeys["MULTIDIMENSIONAL_INFO_TIP_DISMISSED"] = "arcgis_multidimensional_info_tip_dismissed";
})(arcgisComponentNotificationsKeys || (arcgisComponentNotificationsKeys = {}));
const getLocalStorage = (localStorageKey) => {
    return localStorage.getItem(localStorageKey);
};
const setLocalStorage = (localStorageKey, value) => {
    localStorage.setItem(localStorageKey, value);
};
const getObjectLocalStorage = (localStorageKey) => {
    return JSON.parse(getLocalStorage(localStorageKey)) || {};
};
const setSingleObjectLocalStorage = (localStorageKey, keyValueObject) => {
    const setLocalStorageVal = getObjectLocalStorage(localStorageKey);
    setLocalStorageVal[keyValueObject.key] = keyValueObject.value;
    setLocalStorage(localStorageKey, JSON.stringify(setLocalStorageVal));
};
const getSingleObjectLocalStorage = (localStorageKey, objectKey) => {
    const getLocalStorageVal = getObjectLocalStorage(localStorageKey);
    if (getLocalStorageVal === null || getLocalStorageVal === void 0 ? void 0 : getLocalStorageVal.hasOwnProperty(objectKey)) {
        return getLocalStorageVal[objectKey];
    }
    else {
        return null;
    }
};



//# sourceMappingURL=localStorage-9c4e7a3a.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ setSessionStorageItem),
/* harmony export */   b: () => (/* binding */ getSessionStorageItem),
/* harmony export */   c: () => (/* binding */ getCookie),
/* harmony export */   d: () => (/* binding */ setCookie),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
    writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
    const cookie = readCookie(name);
    return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
    window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
    const item = window.localStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
    window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
    const item = window.sessionStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
    const cookie = document.cookie;
    const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
    const matchedCookies = cookie.match(cookieNameRE);
    return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
    properties = properties || {};
    let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
    if (typeof expires === "number") {
        const expirationDate = new Date();
        const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
        expirationDate.setTime(Date.now() + daysFromTodayInMs);
        expires = properties.expires = expirationDate;
    }
    if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
        properties.expires = expires.toUTCString();
    }
    let cookie = `${name}=${encodeURIComponent(value)}`;
    let property;
    for (property in properties) {
        cookie += `; ${property}`;
        const propertyValue = properties[property];
        if (propertyValue !== true) {
            cookie += `=${propertyValue}`;
        }
    }
    document.cookie = cookie;
}



//# sourceMappingURL=storage-0353a769.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTliYWJjZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ29IO0FBQ2xFO0FBQ29HO0FBQ3dCO0FBQ25GO0FBQ3JCO0FBQ047QUFDN0I7QUFDRDtBQUNQOztBQUUzQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNB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QUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1REFBVztBQUN2QixrQkFBa0IsdURBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1REFBVztBQUN2QixrQkFBa0IsdURBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsU0FBUztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1REFBVztBQUN2QixrQkFBa0IsdURBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixLQUFLLEdBQUcsMEJBQTBCO0FBQ3REO0FBQ0E7QUFDQSxxQkFBcUIsRUFBRSxTQUFTO0FBQ2hDO0FBQ0E7QUFDQSwwQkFBMEIsY0FBYztBQUN4QztBQUNBO0FBQ0E7QUFDQTs7QUFFc0o7O0FBRXRKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXN5bWJvbC1waWNrZXIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY29sb3ItMTY3OTFiNDUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsU3RvcmFnZS05YzRlN2EzYS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdG9yYWdlLTAzNTNhNzY5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgaCwgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlIH0gZnJvbSAnLi9jb2xvci0xNjc5MWI0NS5qcyc7XG5pbXBvcnQgeyBlIGFzIGVzcmlNb2R1bGVzLCBnIGFzIGdlb21ldHJ5VHlwZSwgZiBhcyBpc1BvbHlnb25DSU0sIGggYXMgaXNMaW5lQ0lNLCBpIGFzIGlzQ0lNU3ltYm9sLCBqIGFzIGlzUG9pbnRDSU0gfSBmcm9tICcuL3N5bWJvbFV0aWxzLWYyMDdkOTc5LmpzJztcbmltcG9ydCB7IHMgYXMgc2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlLCBnIGFzIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSwgYSBhcyBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cywgbCBhcyBsb2NhbFN0b3JhZ2VLZXlzIH0gZnJvbSAnLi9sb2NhbFN0b3JhZ2UtOWM0ZTdhM2EuanMnO1xuaW1wb3J0IHsgcyBhcyBzZXRMb2NhbFN0b3JhZ2VJdGVtLCBnIGFzIGdldExvY2FsU3RvcmFnZUl0ZW0gfSBmcm9tICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5mdW5jdGlvbiBnZXRJbmplY3RlZFJlcXVlc3RPcHRpb25zKGl0ZW0pIHtcbiAgICAvLyBoYWNrIHRvIGluamVjdCBhdXRoTW9kZSBpbnRvIHJlcXVlc3Qgb3B0aW9uc1xuICAgIHJldHVybiB7IGF1dGhNb2RlOiBpdGVtLmFjY2VzcyA9PT0gXCJwdWJsaWNcIiA/IFwiYW5vbnltb3VzXCIgOiBcImF1dG9cIiB9O1xufVxuY29uc3QgQkFTSUNfU0lNUExFX01BUktFUl9TWU1CT0xTX0pTT04gPSBbXG4gICAge1xuICAgICAgICBuYW1lOiBcIkNpcmNsZVwiLFxuICAgICAgICB0eXBlOiBcImVzcmlTTVNcIixcbiAgICAgICAgc3R5bGU6IFwiZXNyaVNNU0NpcmNsZVwiLFxuICAgICAgICBjb2xvcjogWzAsIDAsIDEyOCwgMTI4XSxcbiAgICAgICAgc2l6ZTogMTgsXG4gICAgICAgIG91dGxpbmU6IHtcbiAgICAgICAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAyNTVdLFxuICAgICAgICAgICAgd2lkdGg6IDFcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIlNxdWFyZVwiLFxuICAgICAgICB0eXBlOiBcImVzcmlTTVNcIixcbiAgICAgICAgc3R5bGU6IFwiZXNyaVNNU1NxdWFyZVwiLFxuICAgICAgICBjb2xvcjogWzAsIDAsIDEyOCwgMTI4XSxcbiAgICAgICAgc2l6ZTogMTgsXG4gICAgICAgIG91dGxpbmU6IHtcbiAgICAgICAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAyNTVdLFxuICAgICAgICAgICAgd2lkdGg6IDFcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIkRpYW1vbmRcIixcbiAgICAgICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgICAgIHN0eWxlOiBcImVzcmlTTVNEaWFtb25kXCIsXG4gICAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAxMjhdLFxuICAgICAgICBzaXplOiAxOCxcbiAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICAgICAgICB3aWR0aDogMVxuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiVHJpYW5nbGVcIixcbiAgICAgICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgICAgIHN0eWxlOiBcImVzcmlTTVNUcmlhbmdsZVwiLFxuICAgICAgICBjb2xvcjogWzAsIDAsIDEyOCwgMTI4XSxcbiAgICAgICAgc2l6ZTogMTgsXG4gICAgICAgIG91dGxpbmU6IHtcbiAgICAgICAgICAgIGNvbG9yOiBbMCwgMCwgMTI4LCAyNTVdLFxuICAgICAgICAgICAgd2lkdGg6IDFcbiAgICAgICAgfVxuICAgIH0gLyogLFxuICAgIHtcbiAgICAgIG5hbWU6IFwiQ3Jvc3NcIixcbiAgICAgIHR5cGU6IFwiZXNyaVNNU1wiLFxuICAgICAgc3R5bGU6IFwiZXNyaVNNU0Nyb3NzXCIsXG4gICAgICBjb2xvcjogWzAsIDAsIDEyOCwgMTI4XSxcbiAgICAgIHNpemU6IDE4LFxuICAgICAgb3V0bGluZToge1xuICAgICAgICBjb2xvcjogWzAsIDAsIDEyOCwgMjU1XSxcbiAgICAgICAgd2lkdGg6IDFcbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiWFwiLFxuICAgICAgdHlwZTogXCJlc3JpU01TXCIsXG4gICAgICBzdHlsZTogXCJlc3JpU01TWFwiLFxuICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDEyOF0sXG4gICAgICBzaXplOiAxOCxcbiAgICAgIG91dGxpbmU6IHtcbiAgICAgICAgY29sb3I6IFswLCAwLCAxMjgsIDI1NV0sXG4gICAgICAgIHdpZHRoOiAxXG4gICAgICB9XG4gICAgfSAqL1xuXTtcbmNvbnN0IEJBU0lDX1NJTVBMRV9MSU5FX1NZTUJPTFNfSlNPTiA9IFtcbiAgICB7XG4gICAgICAgIHR5cGU6IFwiZXNyaVNMU1wiLFxuICAgICAgICBjb2xvcjogWzAsIDAsIDAsIDI1NV0sXG4gICAgICAgIHdpZHRoOiAwLjc1LFxuICAgICAgICBzdHlsZTogXCJlc3JpU0xTU29saWRcIlxuICAgIH1cbl07XG5jb25zdCBCQVNJQ19TSU1QTEVfUE9MWUdPTl9TWU1CT0xTX0pTT04gPSBbXG4gICAge1xuICAgICAgICB0eXBlOiBcImVzcmlTRlNcIixcbiAgICAgICAgY29sb3I6IFswLCAwLCAwLCA2NF0sXG4gICAgICAgIG91dGxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiZXNyaVNMU1wiLFxuICAgICAgICAgICAgY29sb3I6IFswLCAwLCAwLCAyNTVdLFxuICAgICAgICAgICAgd2lkdGg6IDAuNzUsXG4gICAgICAgICAgICBzdHlsZTogXCJlc3JpU0xTU29saWRcIlxuICAgICAgICB9LFxuICAgICAgICBzdHlsZTogXCJlc3JpU0ZTU29saWRcIlxuICAgIH1cbl07XG5jb25zdCBzeW1ib2xIZWlnaHRBc01haW5BeGlzID0gMTA7XG5jb25zdCBzeW1ib2xSYWRpdXNGaXhlZCA9IDU7XG5mdW5jdGlvbiBnZW5lcmF0ZUljb25QcmltaXRpdmVTeW1ib2xKc29uKHN0cmluZ3MpIHtcbiAgICBjb25zdCBpY29ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5jaXJjbGUsXG4gICAgICAgICAgICBuYW1lOiBcIkNpcmNsZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImNpcmNsZVwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuc3F1YXJlLFxuICAgICAgICAgICAgbmFtZTogXCJTcXVhcmVcIixcbiAgICAgICAgICAgIHByaW1pdGl2ZTogXCJzcXVhcmVcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmNyb3NzLFxuICAgICAgICAgICAgbmFtZTogXCJDcm9zc1wiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImNyb3NzXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy54LFxuICAgICAgICAgICAgbmFtZTogXCJYXCIsXG4gICAgICAgICAgICBwcmltaXRpdmU6IFwieFwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMua2l0ZSxcbiAgICAgICAgICAgIG5hbWU6IFwiS2l0ZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImtpdGVcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRyaWFuZ2xlLFxuICAgICAgICAgICAgbmFtZTogXCJUcmlhbmdsZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcInRyaWFuZ2xlXCJcbiAgICAgICAgfVxuICAgIF07XG4gICAgcmV0dXJuIGljb25zLm1hcCgoaWNvbikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoe1xuICAgICAgICAgICAgZGltZW5zaW9uYWxpdHk6IFwiZmxhdFwiLFxuICAgICAgICAgICAgbmFtZTogaWNvbi5uYW1lLFxuICAgICAgICAgICAgdGl0bGU6IGljb24udGl0bGUsXG4gICAgICAgICAgICB0eXBlOiBcIlBvaW50U3ltYm9sM0RcIixcbiAgICAgICAgICAgIHN5bWJvbExheWVyczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJJY29uXCIsXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltaXRpdmU6IGljb24ucHJpbWl0aXZlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogKF9hID0gZXNyaU1vZHVsZXMgPT09IG51bGwgfHwgZXNyaU1vZHVsZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVzcmlNb2R1bGVzLmdmeFV0aWxzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVmYXVsdFRoZW1hdGljQ29sb3JcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFswLCAwLCAwXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdlbmVyYXRlT2JqZWN0UHJpbWl0aXZlU3ltYm9sSnNvbihzdHJpbmdzKSB7XG4gICAgY29uc3Qgb2JqZWN0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5zcGhlcmUsXG4gICAgICAgICAgICBuYW1lOiBcIlNwaGVyZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcInNwaGVyZVwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMudGFsbEN5bGluZGVyLFxuICAgICAgICAgICAgbmFtZTogXCJUYWxsX0N5bGluZGVyXCIsXG4gICAgICAgICAgICBwcmltaXRpdmU6IFwiY3lsaW5kZXJcIixcbiAgICAgICAgICAgIG1peGluczoge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBzeW1ib2xSYWRpdXNGaXhlZCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHN5bWJvbEhlaWdodEFzTWFpbkF4aXMsXG4gICAgICAgICAgICAgICAgZGVwdGg6IHN5bWJvbFJhZGl1c0ZpeGVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuY3lsaW5kZXIsXG4gICAgICAgICAgICBuYW1lOiBcIkN5bGluZGVyXCIsXG4gICAgICAgICAgICBwcmltaXRpdmU6IFwiY3lsaW5kZXJcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRhbGxDdWJlLFxuICAgICAgICAgICAgbmFtZTogXCJUYWxsX0N1YmVcIixcbiAgICAgICAgICAgIHByaW1pdGl2ZTogXCJjdWJlXCIsXG4gICAgICAgICAgICBtaXhpbnM6IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogc3ltYm9sUmFkaXVzRml4ZWQsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBzeW1ib2xIZWlnaHRBc01haW5BeGlzLFxuICAgICAgICAgICAgICAgIGRlcHRoOiBzeW1ib2xSYWRpdXNGaXhlZCxcbiAgICAgICAgICAgICAgICBhbmNob3I6IFwiYm90dG9tXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3ltYm9sU291cmNlcy5jdWJlLFxuICAgICAgICAgICAgbmFtZTogXCJDdWJlXCIsXG4gICAgICAgICAgICBwcmltaXRpdmU6IFwiY3ViZVwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMudGFsbENvbmUsXG4gICAgICAgICAgICBuYW1lOiBcIlRhbGxfQ29uZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImNvbmVcIixcbiAgICAgICAgICAgIG1peGluczoge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBzeW1ib2xSYWRpdXNGaXhlZCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHN5bWJvbEhlaWdodEFzTWFpbkF4aXMsXG4gICAgICAgICAgICAgICAgZGVwdGg6IHN5bWJvbFJhZGl1c0ZpeGVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuY29uZSxcbiAgICAgICAgICAgIG5hbWU6IFwiQ29uZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImNvbmVcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmludmVydGVkQ29uZSxcbiAgICAgICAgICAgIG5hbWU6IFwiSW52ZXJ0ZWRfQ29uZVwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImludmVydGVkQ29uZVwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuZGlhbW9uZCxcbiAgICAgICAgICAgIG5hbWU6IFwiRGlhbW9uZFwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcImRpYW1vbmRcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zeW1ib2xTb3VyY2VzLnRldHJhaGVkcm9uLFxuICAgICAgICAgICAgbmFtZTogXCJUZXRyYWhlZHJvblwiLFxuICAgICAgICAgICAgcHJpbWl0aXZlOiBcInRldHJhaGVkcm9uXCJcbiAgICAgICAgfVxuICAgIF07XG4gICAgcmV0dXJuIG9iamVjdHMubWFwKChvYmplY3QpID0+ICh7XG4gICAgICAgIGRpbWVuc2lvbmFsaXR5OiBcInZvbHVtZXRyaWNcIixcbiAgICAgICAgbmFtZTogb2JqZWN0Lm5hbWUsXG4gICAgICAgIHRpdGxlOiBvYmplY3QudGl0bGUsXG4gICAgICAgIHR5cGU6IFwiUG9pbnRTeW1ib2wzRFwiLFxuICAgICAgICBzeW1ib2xMYXllcnM6IFtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oeyB0eXBlOiBcIk9iamVjdFwiLCByZXNvdXJjZToge1xuICAgICAgICAgICAgICAgICAgICBwcmltaXRpdmU6IG9iamVjdC5wcmltaXRpdmVcbiAgICAgICAgICAgICAgICB9IH0sIG9iamVjdC5taXhpbnMpXG4gICAgICAgIF1cbiAgICB9KSk7XG59XG5jb25zdCBzeW1ib2xUaHVtYm5haWxTaXplSW5QdCA9IDI0OyAvLyAyNCBwdCA9PiAzMnB4XG5jb25zdCBzeW1ib2xUaHVtYm5haWxTaXplSW5QdEZvcjNEID0gNDI7IC8vIDQycHQgPT4gNTZweFxuZnVuY3Rpb24gaGFzM0RGb3JtYXQoaXRlbURhdGEpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IGZvcm1hdEluY2x1ZGVzM0QgPSAoX2EgPSBpdGVtRGF0YS5mb3JtYXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJ3ZWIzZFwiKTtcbiAgICBjb25zdCBmb3JtYXRJbmZvc0luY2x1ZGVzM0RIaW50ID0gKF9iID0gaXRlbURhdGEuZm9ybWF0SW5mb3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zb21lKChmb3JtYXRJbmZvKSA9PiBmb3JtYXRJbmZvLnR5cGUgPT09IFwiZ2x0ZlwiIHx8IGZvcm1hdEluZm8udHlwZSA9PT0gXCJnbHRmX2Jhc2lzdVwiKTtcbiAgICByZXR1cm4gZm9ybWF0SW5jbHVkZXMzRCB8fCBmb3JtYXRJbmZvc0luY2x1ZGVzM0RIaW50O1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0V2ViU3R5bGVTeW1ib2xUaHVtYm5haWxQcmV2aWV3KGl0ZW0pIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IGl0ZW1EYXRhID0gaXRlbS5kYXRhO1xuICAgIGxldCB0aHVtYm5haWxVcmwgPSAoX2EgPSBpdGVtRGF0YS50aHVtYm5haWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ocmVmO1xuICAgIGNvbnN0IHRodW1ibmFpbERhdGEgPSAoX2IgPSBpdGVtRGF0YS50aHVtYm5haWwpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pbWFnZURhdGE7XG4gICAgY29uc3QgdGl0bGUgPSBpdGVtRGF0YS50aXRsZSB8fCBpdGVtLnN0cmluZ3Muc3ltYm9sU291cmNlcy5ub1RpdGxlO1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IGlzQ0lNID0gISFpdGVtRGF0YS5jaW1SZWY7XG4gICAgY29uc3QgaXMzZCA9IGhhczNERm9ybWF0KGl0ZW1EYXRhKTtcbiAgICBjb25zdCBjb21tb25QcmV2aWV3T3B0aW9ucyA9IHtcbiAgICAgICAgc2l6ZTogaXMzZCAmJiBpdGVtRGF0YS5kaW1lbnNpb25hbGl0eSA9PT0gXCJ2b2x1bWV0cmljXCIgPyBzeW1ib2xUaHVtYm5haWxTaXplSW5QdEZvcjNEIDogc3ltYm9sVGh1bWJuYWlsU2l6ZUluUHQsXG4gICAgICAgIGRpc2FibGVVcHNhbXBsaW5nOiBmYWxzZVxuICAgIH07XG4gICAgaWYgKFxuICAgIC8qIHN5bWJvbCBwcmV2aWV3IHV0aWxzIG9ubHkgc3VwcG9ydCAyRCBDSU0gKi9cbiAgICBpc0NJTSAmJlxuICAgICAgICAhaXMzZCkge1xuICAgICAgICBjb25zdCBzeW1ib2wgPSAoYXdhaXQgaXRlbS5nZXRTeW1ib2woKSk7XG4gICAgICAgIGlmIChcbiAgICAgICAgLy8gbGluZXMvcG9pbnRzIHVzZSBkeW5hbWljYWxseSBnZW5lcmF0ZWQgcHJldmlld3NcbiAgICAgICAgLy8gcG9seWdvbnMgdXNlIHRodW1ibmFpbCBVUkxzIHNpbmNlIGR5bmFtaWNhbGx5IGdlbmVyYXRlZFxuICAgICAgICAvLyBwcmV2aWV3cyBtYXkgbm90IGRpc3BsYXkgYXMgbmljZWx5IGFzIGF1dGhvcmVkIG9uZXNcbiAgICAgICAgIWlzUG9seWdvbkNJTShzeW1ib2wpKSB7XG4gICAgICAgICAgICBpZiAoaXNMaW5lQ0lNKHN5bWJvbCkpIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSBkcm9wIHNpemUgZm9yIG5vbi1wb2ludHMgdG8gcHJldmVudCBhIGtub3duIHJlbmRlcmluZyBpc3N1ZSDigJMgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWpzLWFwaS9pc3N1ZXMvNDE3OTBcbiAgICAgICAgICAgICAgICBkZWxldGUgY29tbW9uUHJldmlld09wdGlvbnMuc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhcHBlbmRQcmV2aWV3KHdyYXBwZXIsIHN5bWJvbCwgY29tbW9uUHJldmlld09wdGlvbnMsIHRpdGxlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBXaGVuIGxvYWRpbmcgRXNyaSBwcm92aWRlZCBzdHlsZXMgb24gZGV2IGVudmlyb25tZW50cyB3ZSBnZXQgaW5jb3JyZWN0XG4gICAgLy8gc3ltYm9sIFVSTHMuXG4gICAgLy8gSWYgbmVjZXNzYXJ5IGFuZCBhbGxvd2VkLCBhZGp1c3QgdGhlIFVSTCB0byB3b3JrIG9uIGRldiBlbnZpcm9ubWVudHNcbiAgICAvLyBzZWUgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWpzLWFwaS9pc3N1ZXMvMTY4MzJcbiAgICBpZiAoZXNyaU1vZHVsZXMuZGV2RW52aXJvbm1lbnRVdGlscy5pc0RldkVudmlyb25tZW50KCkpIHtcbiAgICAgICAgdGh1bWJuYWlsVXJsID0gZXNyaU1vZHVsZXMuZGV2RW52aXJvbm1lbnRVdGlscy5hZGp1c3RTdGF0aWNBR09VcmwodGh1bWJuYWlsVXJsKTtcbiAgICB9XG4gICAgaWYgKCF0aHVtYm5haWxVcmwgJiYgIXRodW1ibmFpbERhdGEpIHtcbiAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChjcmVhdGVCbGFua1RodW1ibmFpbCh0aXRsZSkpO1xuICAgICAgICByZXR1cm4gd3JhcHBlcjtcbiAgICB9XG4gICAgY29uc3Qgc3ltYm9sID0gbmV3IGVzcmlNb2R1bGVzLldlYlN0eWxlU3ltYm9sKHtcbiAgICAgICAgbmFtZTogaXRlbURhdGEubmFtZSxcbiAgICAgICAgc3R5bGVVcmw6IGAke2l0ZW0ucG9ydGFsSXRlbS5pdGVtVXJsfS9kYXRhYCxcbiAgICAgICAgdGh1bWJuYWlsOiB7XG4gICAgICAgICAgICB1cmw6IHRodW1ibmFpbERhdGFcbiAgICAgICAgICAgICAgICA/IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCAke3RodW1ibmFpbERhdGF9YFxuICAgICAgICAgICAgICAgIDogZXNyaU1vZHVsZXMudXJsVXRpbHMubWFrZUFic29sdXRlKHRodW1ibmFpbFVybCwgaXRlbS5wb3J0YWxJdGVtLml0ZW1VcmwpXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gYXBwZW5kUHJldmlldyh3cmFwcGVyLCBzeW1ib2wsIGNvbW1vblByZXZpZXdPcHRpb25zLCB0aXRsZSk7XG59XG5hc3luYyBmdW5jdGlvbiBhcHBlbmRQcmV2aWV3KG5vZGUsIHN5bWJvbCwgb3B0aW9ucywgdGl0bGUpIHtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBlc3JpTW9kdWxlcy5zeW1ib2xVdGlscy5yZW5kZXJQcmV2aWV3SFRNTChzeW1ib2wsIE9iamVjdC5hc3NpZ24oeyBub2RlIH0sIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVCbGFua1RodW1ibmFpbCh0aXRsZSkpO1xuICAgIH1cbiAgICByZXR1cm4gbm9kZTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJsYW5rVGh1bWJuYWlsKHRpdGxlKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIC8vIGRlc2NyaWJlZCBieSBwYXJlbnQgbm9kZVxuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYWx0XCIsIFwiXCIpO1xuICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gdGl0bGU7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG59XG5mdW5jdGlvbiB3ZWJTdHlsZVN5bWJvbFN0cmF0ZWd5KHN5bWJvbFR5cGUgPSBcIjJkXCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBhc3luYyBnZXRTeW1ib2woaXRlbSkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhLCBwYXJlbnREYXRhLCBwb3J0YWxJdGVtIH0gPSBpdGVtO1xuICAgICAgICAgICAgY29uc3Qgc3ltYm9sID0gYXdhaXQgc3ltYm9sRnJvbVdlYlN0eWxlSlNPTihwYXJlbnREYXRhLCBkYXRhLm5hbWUsIHBvcnRhbEl0ZW0sIHBhcmVudERhdGEuY2ltVmVyc2lvbiAmJiBzeW1ib2xUeXBlID09PSBcIjJkXCIgPyBcImNpbVJlZlwiIDogXCJ3ZWJSZWZcIik7XG4gICAgICAgICAgICAvLyBPdmVycmlkZSBjb2xvciBmb3IgM2QgaWNvbiBhbmQgb2JqZWN0IHN5bWJvbHMgdG8gYmUgdGhlbWF0aWNcbiAgICAgICAgICAgIGlmIChzeW1ib2wudHlwZSA9PT0gXCJwb2ludC0zZFwiKSB7XG4gICAgICAgICAgICAgICAgc3ltYm9sLnN5bWJvbExheWVycy5mb3JFYWNoKChzeW1ib2xMYXllcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3ltYm9sTGF5ZXIuZ2V0KFwibWF0ZXJpYWwuY29sb3JcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzeW1ib2xMYXllci50eXBlID09PSBcImljb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gc3ltYm9sTGF5ZXIubWF0ZXJpYWwgIT0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHN5bWJvbExheWVyLm1hdGVyaWFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBhdXRvY2FzdHMgYXMgU3ltYm9sM0RNYXRlcmlhbCAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsLmNvbG9yID0gZXNyaU1vZHVsZXMuZ2Z4VXRpbHMuZGVmYXVsdFRoZW1hdGljQ29sb3IuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2xMYXllci5tYXRlcmlhbCA9IG1hdGVyaWFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc3ltYm9sTGF5ZXIudHlwZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gc3ltYm9sTGF5ZXIubWF0ZXJpYWwgIT0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHN5bWJvbExheWVyLm1hdGVyaWFsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBhdXRvY2FzdHMgYXMgU3ltYm9sM0RNYXRlcmlhbCAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsLmNvbG9yID0gbWF0ZXJpYWwuY29sb3IgfHwgY3JlYXRlKFsyNTUsIDI1NSwgMjU1XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sTGF5ZXIubWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN5bWJvbDtcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgZ2V0VGh1bWJuYWlsKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRXZWJTdHlsZVN5bWJvbFRodW1ibmFpbFByZXZpZXcoaXRlbSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gd2ViU3R5bGVDdXN0b21TeW1ib2xTdHJhdGVneSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBhc3luYyBnZXRTeW1ib2woaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YS5zeW1ib2w7XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGdldFRodW1ibmFpbChpdGVtKSB7XG4gICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGNvbnN0IGh0bWwgPSBhcHBlbmRQcmV2aWV3KHdyYXBwZXIsIGl0ZW0uZGF0YS5zeW1ib2wsIHtcbiAgICAgICAgICAgICAgICBzaXplOiAyNCxcbiAgICAgICAgICAgICAgICBkaXNhYmxlVXBzYW1wbGluZzogZmFsc2VcbiAgICAgICAgICAgIH0sIGl0ZW0uZGF0YS50aXRsZSk7XG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfVxuICAgIH07XG59XG5jb25zdCBmbGF0U3ltYm9sU3RyYXRlZ3kgPSB7XG4gICAgYXN5bmMgZ2V0U3ltYm9sKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGVzcmlNb2R1bGVzLmpzb25VdGlscy5mcm9tSlNPTihpdGVtLmRhdGEpO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VGh1bWJuYWlsKGl0ZW0pIHtcbiAgICAgICAgY29uc3Qgc3ltYm9sID0gKGF3YWl0IGl0ZW0uZ2V0U3ltYm9sKCkpO1xuICAgICAgICBjb25zdCBwcmV2aWV3T3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHNpemU6IGdlb21ldHJ5VHlwZShzeW1ib2wpID09PSBcImxpbmVcIlxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogc3ltYm9sVGh1bWJuYWlsU2l6ZUluUHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiBzeW1ib2xUaHVtYm5haWxTaXplSW5QdFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZXNyaU1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCBwcmV2aWV3T3B0aW9ucyk7XG4gICAgfVxufTtcbmNvbnN0IHZvbHVtZXRyaWNTeW1ib2xTdHJhdGVneSA9IHtcbiAgICBhc3luYyBnZXRTeW1ib2woaXRlbSkge1xuICAgICAgICByZXR1cm4gZXNyaU1vZHVsZXMuanNvblV0aWxzLmZyb21KU09OKGl0ZW0uZGF0YSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRUaHVtYm5haWwoaXRlbSkge1xuICAgICAgICBjb25zdCBzeW1ib2wgPSBhd2FpdCBpdGVtLmdldFN5bWJvbCgpO1xuICAgICAgICByZXR1cm4gZXNyaU1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCB7IHNpemU6IHN5bWJvbFRodW1ibmFpbFNpemVJblB0Rm9yM0QgLSA0IH0pO1xuICAgIH1cbn07XG5jb25zdCBub29wID0gRnVuY3Rpb24ucHJvdG90eXBlO1xuY2xhc3MgU3ltYm9sSXRlbSB7XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0cnVjdG9yKHsgZGF0YSwgcGFyZW50RGF0YSwgcG9ydGFsSXRlbSwgc3RyYXRlZ3ksIHN0cmluZ3MgfSkge1xuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICB0aGlzLnBhcmVudERhdGEgPSBwYXJlbnREYXRhO1xuICAgICAgICB0aGlzLnBvcnRhbEl0ZW0gPSBwb3J0YWxJdGVtO1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGdldFN5bWJvbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9zeW1ib2wpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZmxpZ2h0U3ltYm9sID0gdGhpcy5fc3ltYm9sUmVxdWVzdCB8fCAodGhpcy5fc3ltYm9sUmVxdWVzdCA9IHRoaXMuc3RyYXRlZ3kuZ2V0U3ltYm9sKHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMuX3N5bWJvbCA9IGF3YWl0IGluZmxpZ2h0U3ltYm9sO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9zeW1ib2wuY2xvbmUoKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0VGh1bWJuYWlsKG5vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RodW1ibmFpbCkge1xuICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZCh0aGlzLl90aHVtYm5haWwpO1xuICAgICAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5mbGlnaHRUaHVtYm5haWwgPSB0aGlzLl90aHVtYm5haWxSZXF1ZXN0IHx8ICh0aGlzLl90aHVtYm5haWxSZXF1ZXN0ID0gdGhpcy5zdHJhdGVneS5nZXRUaHVtYm5haWwodGhpcykpO1xuICAgICAgICB0aGlzLl90aHVtYm5haWwgPSBhd2FpdCBpbmZsaWdodFRodW1ibmFpbDtcbiAgICAgICAgcmV0dXJuICgpID0+IG5vZGUuYXBwZW5kQ2hpbGQodGhpcy5fdGh1bWJuYWlsKTtcbiAgICB9XG59XG5jbGFzcyBQb3J0YWxJdGVtU3ltYm9sU291cmNlQmFzZSB7XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0cnVjdG9yKHsgcG9ydGFsSXRlbSwgc3RyaW5ncywgc3ltYm9sVHlwZSB9KSB7XG4gICAgICAgIHRoaXMuc3ltYm9sVHlwZSA9IFwiMmRcIjtcbiAgICAgICAgdGhpcy5wb3J0YWxJdGVtID0gcG9ydGFsSXRlbTtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgICAgaWYgKHN5bWJvbFR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuc3ltYm9sVHlwZSA9IHN5bWJvbFR5cGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICAgIH1cbiAgICBnZXQgaWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgcmV0dXJuIChfYSA9IHRoaXMucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkO1xuICAgIH1cbiAgICBnZXQga2V5d29yZHMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLnBvcnRhbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlS2V5d29yZHMpIHx8IFtdO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gdGhpcy5wb3J0YWxJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZTtcbiAgICB9XG4gICAgZ2V0IHRpdGxlKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoX2EgPSB0aGlzLnBvcnRhbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgZmV0Y2hEYXRhKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9kYXRhKSB7XG4gICAgICAgICAgICB0aGlzLl9kYXRhID0gYXdhaXQgdGhpcy5wb3J0YWxJdGVtLmZldGNoRGF0YShcImpzb25cIiwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgZ2V0SW5qZWN0ZWRSZXF1ZXN0T3B0aW9ucyh0aGlzLnBvcnRhbEl0ZW0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gICAgfVxufVxuY2xhc3MgU3ltYm9sU2V0U3ltYm9sU291cmNlIGV4dGVuZHMgUG9ydGFsSXRlbVN5bWJvbFNvdXJjZUJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIFByb3BlcnRpZXNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcm9wZXJ0aWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy50eXBlID0gXCJzeW1ib2wtc2V0XCI7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcm90ZWN0ZWQgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZmV0Y2hEYXRhKG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5faXRlbXMgPSBkYXRhLm1hcCgoaXRlbSkgPT4gbmV3IFN5bWJvbEl0ZW0oe1xuICAgICAgICAgICAgICAgIGRhdGE6IGl0ZW0sXG4gICAgICAgICAgICAgICAgcGFyZW50RGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBwb3J0YWxJdGVtOiB0aGlzLnBvcnRhbEl0ZW0sXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IGZsYXRTeW1ib2xTdHJhdGVneSxcbiAgICAgICAgICAgICAgICBzdHJpbmdzOiB0aGlzLnN0cmluZ3NcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gICAgfVxufVxuY2xhc3MgV2ViU3R5bGVTeW1ib2xTb3VyY2UgZXh0ZW5kcyBQb3J0YWxJdGVtU3ltYm9sU291cmNlQmFzZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgUHJvcGVydGllc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByb3BlcnRpZXNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLnR5cGUgPSBcIndlYi1zdHlsZVwiO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBnZXRJdGVtcyhvcHRpb25zKSB7XG4gICAgICAgIGlmIChlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuaXNBYm9ydGVkKG9wdGlvbnMpKSB7XG4gICAgICAgICAgICB0aHJvdyBlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuY3JlYXRlQWJvcnRFcnJvcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5faXRlbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmZldGNoRGF0YShvcHRpb25zKTtcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zID0gZGF0YS5pdGVtcy5tYXAoKGl0ZW0pID0+IG5ldyBTeW1ib2xJdGVtKHtcbiAgICAgICAgICAgICAgICBkYXRhOiBpdGVtLFxuICAgICAgICAgICAgICAgIHBhcmVudERhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgcG9ydGFsSXRlbTogdGhpcy5wb3J0YWxJdGVtLFxuICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiB3ZWJTdHlsZVN5bWJvbFN0cmF0ZWd5KHRoaXMuc3ltYm9sVHlwZSksXG4gICAgICAgICAgICAgICAgc3RyaW5nczogdGhpcy5zdHJpbmdzXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zO1xuICAgIH1cbn1cbmNsYXNzIEJhc2ljU3ltYm9sU2V0U291cmNlIHtcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29uc3RydWN0b3IoeyBzdHJpbmdzIH0pIHtcbiAgICAgICAgdGhpcy5rZXl3b3JkcyA9IFtdO1xuICAgICAgICB0aGlzLm5hbWUgPSBcIkJhc2ljXCI7XG4gICAgICAgIHRoaXMudHlwZSA9IFwic3ltYm9sLXNldFwiO1xuICAgICAgICB0aGlzLnRpdGxlID0gc3RyaW5ncy5zeW1ib2xTb3VyY2VzLmJhc2ljO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBnZXRJdGVtcyhvcHRpb25zKSB7XG4gICAgICAgIGlmIChlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuaXNBYm9ydGVkKG9wdGlvbnMpKSB7XG4gICAgICAgICAgICB0aHJvdyBlc3JpTW9kdWxlcy5wcm9taXNlVXRpbHMuY3JlYXRlQWJvcnRFcnJvcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5faXRlbXMpIHtcbiAgICAgICAgICAgIC8vIG5vIHBhcmVudCBkYXRhIHNpbmNlIGl0J3MgbG9jYWxcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5kYXRhLm1hcCgoZGF0YSkgPT4gbmV3IFN5bWJvbEl0ZW0oe1xuICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IGZsYXRTeW1ib2xTdHJhdGVneSxcbiAgICAgICAgICAgICAgICBzdHJpbmdzOiB0aGlzLnN0cmluZ3NcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gICAgfVxufVxuY29uc3QgYmFzaWNQb2ludFN5bWJvbFNldFNvdXJjZUlkID0gXCJiYXNpYy1zeW1ib2wtc2V0OnBvaW50XCI7XG5jb25zdCBiYXNpY0xpbmVTeW1ib2xTZXRTb3VyY2VJZCA9IFwiYmFzaWMtc3ltYm9sLXNldDpsaW5lXCI7XG5jb25zdCBiYXNpY1BvbHlnb25TeW1ib2xTZXRTb3VyY2VJZCA9IFwiYmFzaWMtc3ltYm9sLXNldDpwb2x5Z29uXCI7XG5jbGFzcyBCYXNpY1BvaW50U3ltYm9sU2V0U291cmNlIGV4dGVuZHMgQmFzaWNTeW1ib2xTZXRTb3VyY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcm9wZXJ0aWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5kYXRhID0gQkFTSUNfU0lNUExFX01BUktFUl9TWU1CT0xTX0pTT047XG4gICAgICAgIHRoaXMuaWQgPSBiYXNpY1BvaW50U3ltYm9sU2V0U291cmNlSWQ7XG4gICAgICAgIHRoaXMua2V5d29yZHMgPSBbXCJQb2ludFwiXTtcbiAgICB9XG59XG5jbGFzcyBCYXNpY0xpbmVTeW1ib2xTZXRTb3VyY2UgZXh0ZW5kcyBCYXNpY1N5bWJvbFNldFNvdXJjZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByb3BlcnRpZXNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmRhdGEgPSBCQVNJQ19TSU1QTEVfTElORV9TWU1CT0xTX0pTT047XG4gICAgICAgIHRoaXMuaWQgPSBiYXNpY0xpbmVTeW1ib2xTZXRTb3VyY2VJZDtcbiAgICAgICAgdGhpcy5rZXl3b3JkcyA9IFtcIkxpbmVcIl07XG4gICAgfVxufVxuY2xhc3MgQmFzaWNQb2x5Z29uU3ltYm9sU2V0U291cmNlIGV4dGVuZHMgQmFzaWNTeW1ib2xTZXRTb3VyY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcm9wZXJ0aWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5kYXRhID0gQkFTSUNfU0lNUExFX1BPTFlHT05fU1lNQk9MU19KU09OO1xuICAgICAgICB0aGlzLmlkID0gYmFzaWNQb2x5Z29uU3ltYm9sU2V0U291cmNlSWQ7XG4gICAgICAgIHRoaXMua2V5d29yZHMgPSBbXCJQb2x5Z29uXCJdO1xuICAgIH1cbn1cbmNsYXNzIEljb25QcmltaXRpdmVXZWJTdHlsZVNvdXJjZSB7XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0cnVjdG9yKHsgc3RyaW5ncyB9KSB7XG4gICAgICAgIHRoaXMua2V5d29yZHMgPSBbXCIzZFwiXTtcbiAgICAgICAgdGhpcy5pZCA9IFwiYmFzaWMtd2ViLXN0eWxlOmZsYXRcIjtcbiAgICAgICAgdGhpcy5uYW1lID0gXCJCYXNpY1wiO1xuICAgICAgICB0aGlzLnR5cGUgPSBcIndlYi1zdHlsZVwiO1xuICAgICAgICB0aGlzLmRhdGEgPSB7IGl0ZW1zOiBnZW5lcmF0ZUljb25QcmltaXRpdmVTeW1ib2xKc29uKHN0cmluZ3MpIH07XG4gICAgICAgIHRoaXMudGl0bGUgPSBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuYmFzaWM7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgICAgICAgLy8gbm8gcGFyZW50IGRhdGEgc2luY2UgaXQncyBsb2NhbFxuICAgICAgICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLmRhdGEuaXRlbXMubWFwKChkYXRhKSA9PiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICBzdHJhdGVneTogZmxhdFN5bWJvbFN0cmF0ZWd5LFxuICAgICAgICAgICAgICAgIHN0cmluZ3M6IHRoaXMuc3RyaW5nc1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtcztcbiAgICB9XG59XG5jbGFzcyBPYmplY3RQcmltaXRpdmVXZWJTdHlsZVNvdXJjZSB7XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0cnVjdG9yKHsgc3RyaW5ncyB9KSB7XG4gICAgICAgIHRoaXMuaWQgPSBcImJhc2ljLXdlYi1zdHlsZTp2b2x1bWV0cmljXCI7XG4gICAgICAgIHRoaXMua2V5d29yZHMgPSBbXCIzZFwiLCBcInZvbHVtZXRyaWNcIl07XG4gICAgICAgIHRoaXMubmFtZSA9IFwiQmFzaWNcIjtcbiAgICAgICAgdGhpcy50eXBlID0gXCJ3ZWItc3R5bGVcIjtcbiAgICAgICAgdGhpcy5kYXRhID0geyBpdGVtczogZ2VuZXJhdGVPYmplY3RQcmltaXRpdmVTeW1ib2xKc29uKHN0cmluZ3MpIH07XG4gICAgICAgIHRoaXMudGl0bGUgPSBzdHJpbmdzLnN5bWJvbFNvdXJjZXMuYmFzaWM7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGdldEl0ZW1zKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5pc0Fib3J0ZWQob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRocm93IGVzcmlNb2R1bGVzLnByb21pc2VVdGlscy5jcmVhdGVBYm9ydEVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgICAgICAgLy8gbm8gcGFyZW50IGRhdGEgc2luY2UgaXQncyBsb2NhbFxuICAgICAgICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLmRhdGEuaXRlbXMubWFwKChkYXRhKSA9PiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICBwYXJlbnREYXRhOiB0aGlzLmRhdGEsXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IHZvbHVtZXRyaWNTeW1ib2xTdHJhdGVneSxcbiAgICAgICAgICAgICAgICBzdHJpbmdzOiB0aGlzLnN0cmluZ3NcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXM7XG4gICAgfVxufVxuZnVuY3Rpb24gc3R5bGVOYW1lRnJvbUl0ZW0oaXRlbSkge1xuICAgIC8vIEZpbmQgdHlwZSBrZXl3b3JkIHRoYXQgbG9va3MgbGlrZSBpdCdzIGFuIGVzcmkgc3R5bGUgYW5kIGhvcGUgaXQgd29ya3NcbiAgICBmb3IgKGNvbnN0IHR5cGVLZXl3b3JkIG9mIGl0ZW0udHlwZUtleXdvcmRzKSB7XG4gICAgICAgIGlmICgvXkVzcmkuKlN0eWxlJC8udGVzdCh0eXBlS2V5d29yZCkgJiYgdHlwZUtleXdvcmQgIT09IFwiRXNyaSBTdHlsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHlwZUtleXdvcmQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbmFzeW5jIGZ1bmN0aW9uIHN5bWJvbEZyb21XZWJTdHlsZUpTT04oc3R5bGUsIG5hbWUsIGl0ZW0sIHR5cGUpIHtcbiAgICBjb25zdCBzdHlsZU5hbWUgPSBzdHlsZU5hbWVGcm9tSXRlbShpdGVtKTtcbiAgICBsZXQgc3R5bGVVcmwgPSBudWxsO1xuICAgIGlmICghc3R5bGVOYW1lKSB7XG4gICAgICAgIHN0eWxlVXJsID0gYCR7aXRlbS5pdGVtVXJsfS9kYXRhYDtcbiAgICB9XG4gICAgY29uc3Qgc3R5bGVSZXNwb25zZSA9IHtcbiAgICAgICAgZGF0YTogc3R5bGUsXG4gICAgICAgIGJhc2VVcmw6IGl0ZW0uaXRlbVVybCxcbiAgICAgICAgc3R5bGVOYW1lLFxuICAgICAgICBzdHlsZVVybFxuICAgIH07XG4gICAgY29uc3QgeyBwb3J0YWwgfSA9IGl0ZW07XG4gICAgcmV0dXJuIGVzcmlNb2R1bGVzLndlYlN0eWxlU3ltYm9sVXRpbHMuZmV0Y2hTeW1ib2xGcm9tU3R5bGUoc3R5bGVSZXNwb25zZSwgbmFtZSwgeyBwb3J0YWwgfSwgdHlwZSwgZXNyaU1vZHVsZXMuc3R5bGVVdGlscy5zeW1ib2xVcmxGcm9tU3R5bGVJdGVtLCBnZXRJbmplY3RlZFJlcXVlc3RPcHRpb25zKGl0ZW0pKTtcbn1cblxuY29uc3QgQ1NTJDEgPSB7XG4gICAgbWFya2VySXRlbTogXCJtYXJrZXItaXRlbVwiLFxuICAgIGNhbGNpdGVEYXJrVGhlbWU6IFwiY2FsY2l0ZS1tb2RlLWRhcmtcIlxufTtcbmNvbnN0IE1hcmtlckl0ZW0gPSAoeyBpdGVtLCBpbmRleCwgb2JzZXJ2ZXIgfSkgPT4ge1xuICAgIGNvbnN0IHRvb2x0aXAgPSBpdGVtLmRhdGEudGl0bGUgPyAoaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IFwicmVmZXJlbmNlLWVsZW1lbnRcIjogaXRlbS5kYXRhLm5hbWUgfSwgaXRlbS5kYXRhLnRpdGxlKSkgOiBudWxsO1xuICAgIHJldHVybiAoaChcInNwYW5cIiwgeyBjbGFzczogYCR7Q1NTJDEubWFya2VySXRlbX0gJHtDU1MkMS5jYWxjaXRlRGFya1RoZW1lfWAsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgIGlmICghbm9kZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFscmVhZHlQcm9jZXNzZWQgPSBub2RlLml0ZW07XG4gICAgICAgICAgICBpZiAoYWxyZWFkeVByb2Nlc3NlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUuaXRlbSA9IGl0ZW07XG4gICAgICAgICAgICBub2RlLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKG5vZGUpO1xuICAgICAgICB9LCBpZDogaXRlbS5kYXRhLm5hbWUsIHNsb3Q6IFwidGh1bWJuYWlsXCIgfSwgdG9vbHRpcCkpO1xufTtcblxuZnVuY3Rpb24gZmV0Y2hTeW1ib2xTZXRTeW1ib2xTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncykge1xuICAgIHJldHVybiBmZXRjaFN5bWJvbFNldHMocG9ydGFsKS50aGVuKChpdGVtcykgPT4gaXRlbXMubWFwKChpdGVtKSA9PiBuZXcgU3ltYm9sU2V0U3ltYm9sU291cmNlKHtcbiAgICAgICAgcG9ydGFsSXRlbTogaXRlbSxcbiAgICAgICAgc3RyaW5nc1xuICAgIH0pKSk7XG59XG5mdW5jdGlvbiBmZXRjaFN5bWJvbFNldHMocG9ydGFsKSB7XG4gICAgcmV0dXJuIGl0ZW1GZXRjaGVyKHtcbiAgICAgICAgcG9ydGFsLFxuICAgICAgICBxdWVyaWVzOiB7XG4gICAgICAgICAgICBncm91cDogcG9ydGFsLnN5bWJvbFNldHNHcm91cFF1ZXJ5LFxuICAgICAgICAgICAgaXRlbTogYHR5cGU6XCJTeW1ib2wgU2V0XCIgQU5EICh0eXBla2V5d29yZHM6XCJieSB2YWx1ZVwiIEFORCB0eXBla2V5d29yZHM6XCJtYXJrZXJcIilgXG4gICAgICAgIH1cbiAgICB9KS50aGVuKG1vdmVEZWZhdWx0VG9GaXJzdCk7XG59XG5mdW5jdGlvbiBmZXRjaFdlYlN0eWxlU3ltYm9sU291cmNlcyhwb3J0YWwsIHR5cGUsIHN0cmluZ3MpIHtcbiAgICByZXR1cm4gZmV0Y2hXZWJTdHlsZXMocG9ydGFsLCB0eXBlKS50aGVuKChpdGVtcykgPT4gaXRlbXMubWFwKChpdGVtKSA9PiBuZXcgV2ViU3R5bGVTeW1ib2xTb3VyY2Uoe1xuICAgICAgICBwb3J0YWxJdGVtOiBpdGVtLFxuICAgICAgICBzeW1ib2xUeXBlOiB0eXBlLFxuICAgICAgICBzdHJpbmdzXG4gICAgfSkpKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoV2ViU3R5bGVzKHBvcnRhbCwgdHlwZSkge1xuICAgIGNvbnN0IGdyb3VwID0gdHlwZSA9PT0gXCIyZFwiID8gcG9ydGFsLnN0eWxlc0dyb3VwUXVlcnkyZCA6IHBvcnRhbC5zdHlsZXNHcm91cFF1ZXJ5M2Q7XG4gICAgaWYgKCFncm91cCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBpdGVtRmV0Y2hlcih7XG4gICAgICAgIHBvcnRhbCxcbiAgICAgICAgcXVlcmllczoge1xuICAgICAgICAgICAgZ3JvdXAsXG4gICAgICAgICAgICBpdGVtOiBgdHlwZTpcIlN0eWxlXCJgXG4gICAgICAgIH1cbiAgICB9KS50aGVuKG1vdmVEZWZhdWx0VG9GaXJzdCk7XG59XG5mdW5jdGlvbiBnZXRQcmltaXRpdmVzKGRpbWVuc2lvbmFsaXR5LCBzdHJpbmdzKSB7XG4gICAgcmV0dXJuIGRpbWVuc2lvbmFsaXR5ID09PSBcImZsYXRcIlxuICAgICAgICA/IG5ldyBJY29uUHJpbWl0aXZlV2ViU3R5bGVTb3VyY2UoeyBzdHJpbmdzIH0pXG4gICAgICAgIDogbmV3IE9iamVjdFByaW1pdGl2ZVdlYlN0eWxlU291cmNlKHsgc3RyaW5ncyB9KTtcbn1cbmZ1bmN0aW9uIGdldEJhc2ljKHN0cmluZ3MsIGdlb21ldHJ5VHlwZSkge1xuICAgIGNvbnN0IHByb3BzID0geyBzdHJpbmdzIH07XG4gICAgcmV0dXJuIGdlb21ldHJ5VHlwZSA9PT0gXCJsaW5lXCJcbiAgICAgICAgPyBuZXcgQmFzaWNMaW5lU3ltYm9sU2V0U291cmNlKHByb3BzKVxuICAgICAgICA6IGdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5Z29uXCJcbiAgICAgICAgICAgID8gbmV3IEJhc2ljUG9seWdvblN5bWJvbFNldFNvdXJjZShwcm9wcylcbiAgICAgICAgICAgIDogbmV3IEJhc2ljUG9pbnRTeW1ib2xTZXRTb3VyY2UocHJvcHMpO1xufVxuYXN5bmMgZnVuY3Rpb24gaXRlbUZldGNoZXIob3B0aW9ucykge1xuICAgIGNvbnN0IHBvcnRhbCA9IG9wdGlvbnMucG9ydGFsO1xuICAgIGNvbnN0IGdyb3VwUXVlcnkgPSBvcHRpb25zLnF1ZXJpZXMuZ3JvdXA7XG4gICAgY29uc3QgaXRlbVF1ZXJ5ID0gb3B0aW9ucy5xdWVyaWVzLml0ZW07XG4gICAgY29uc3QgbWF4SXRlbXMgPSAxMDA7XG4gICAgY29uc3QgeyByZXN1bHRzIH0gPSBhd2FpdCBwb3J0YWwucXVlcnlHcm91cHMoeyBxdWVyeTogZ3JvdXBRdWVyeSwgZGlzYWJsZUV4dHJhUXVlcnk6IHRydWUgfSk7XG4gICAgaWYgKHJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgW2dyb3VwXSA9IHJlc3VsdHM7XG4gICAgcmV0dXJuIChhd2FpdCBncm91cC5xdWVyeUl0ZW1zKHtcbiAgICAgICAgcXVlcnk6IGl0ZW1RdWVyeSxcbiAgICAgICAgZGlzYWJsZUV4dHJhUXVlcnk6IHRydWUsXG4gICAgICAgIG51bTogbWF4SXRlbXMsXG4gICAgICAgIHNvcnRGaWVsZDogZ3JvdXAuc29ydEZpZWxkXG4gICAgfSkpLnJlc3VsdHM7XG59XG5mdW5jdGlvbiBoYXNLZXl3b3JkKGl0ZW0sIGtleXdvcmQpIHtcbiAgICByZXR1cm4gaXRlbS50eXBlS2V5d29yZHMuaW5kZXhPZihrZXl3b3JkKSA+IC0xO1xufVxuZnVuY3Rpb24gbW92ZURlZmF1bHRUb0ZpcnN0KHJlc3VsdHMpIHtcbiAgICBjb25zdCBzb3J0ZWQgPSBbXTtcbiAgICByZXN1bHRzLmZvckVhY2goKHNldCkgPT4ge1xuICAgICAgICBpZiAoaGFzS2V5d29yZChzZXQsIFwiZGVmYXVsdFwiKSkge1xuICAgICAgICAgICAgc29ydGVkLnVuc2hpZnQoc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNvcnRlZC5wdXNoKHNldCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc29ydGVkO1xufVxuXG5jb25zdCBjaW1HZW9tZXRyeUl0ZW1UeXBlID0ge1xuICAgIHBvaW50OiBcInBvaW50U3ltYm9sXCIsXG4gICAgbGluZTogXCJsaW5lU3ltYm9sXCIsXG4gICAgcG9seWdvbjogXCJwb2x5Z29uU3ltYm9sXCJcbn07XG5jb25zdCBpc0ludGVyY2VwdG9yID0gKHBvcnRhbE9yUG9ydGFsSW50ZXJjZXB0b3IpID0+ICEhcG9ydGFsT3JQb3J0YWxJbnRlcmNlcHRvci5wb3J0YWw7XG5hc3luYyBmdW5jdGlvbiBhc3luY0ZpbHRlcihpdGVtcywgcHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGl0ZW1zLm1hcChwcmVkaWNhdGUpKS50aGVuKChyZXN1bHRzKSA9PiBpdGVtcy5maWx0ZXIoKF9pdGVtLCBpbmRleCkgPT4gcmVzdWx0c1tpbmRleF0pKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZpbHRlclN5bWJvbEl0ZW1zKHNvdXJjZSwgc3ltYm9sSXRlbXMsIG1hcmtlclR5cGUsIGdlb21ldHJ5VHlwZSwgc3ltYm9sVHlwZSwgZmlsdGVyKSB7XG4gICAgY29uc3QgYWxsb3dlZCA9IG5vcm1hbGl6ZUFsbG93ZWRUeXBlcyhtYXJrZXJUeXBlKTtcbiAgICBjb25zdCBkZWZhdWx0U291cmNlRmlsdGVyID0gc3ltYm9sVHlwZSA9PT0gXCIyZFwiXG4gICAgICAgID8gY3JlYXRlRGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIyZChnZW9tZXRyeVR5cGUsIGFsbG93ZWQpXG4gICAgICAgIDogY3JlYXRlRGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIzZChhbGxvd2VkKTtcbiAgICBjb25zdCBlZmZlY3RpdmVGaWx0ZXIgPSBhc3luYyAoc3ltYm9sSXRlbSkgPT4gZmlsdGVyID8gZmlsdGVyKHN5bWJvbEl0ZW0sIHNvdXJjZSwgZGVmYXVsdFNvdXJjZUZpbHRlcikgOiBkZWZhdWx0U291cmNlRmlsdGVyKHN5bWJvbEl0ZW0sIHNvdXJjZSk7XG4gICAgcmV0dXJuIGFzeW5jRmlsdGVyKHN5bWJvbEl0ZW1zLCBlZmZlY3RpdmVGaWx0ZXIpO1xufVxuZnVuY3Rpb24gY3JlYXRlRGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIyZChnZW9tZXRyeVR5cGUsIGFsbG93ZWRUeXBlcykge1xuICAgIGZ1bmN0aW9uIHN5bWJvbEl0ZW1Pbmx5RmlsdGVyKHN5bWJvbEl0ZW0pIHtcbiAgICAgICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcImFsbFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBzeW1ib2xJdGVtO1xuICAgICAgICBjb25zdCB7IGRpbWVuc2lvbmFsaXR5LCB0eXBlOiBzeW1ib2xUeXBlIH0gPSBkYXRhO1xuICAgICAgICBpZiAoZGltZW5zaW9uYWxpdHkgPT09IFwidm9sdW1ldHJpY1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiKSB7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwicGljdHVyZVwiKSAmJiBzeW1ib2xUeXBlID09PSBcImVzcmlQTVNcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcInNpbXBsZVwiKSAmJiBzeW1ib2xUeXBlID09PSBcImVzcmlTTVNcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChnZW9tZXRyeVR5cGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwic2ltcGxlXCIpICYmIHN5bWJvbFR5cGUgPT09IFwiZXNyaVNMU1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5Z29uXCIpIHtcbiAgICAgICAgICAgIGlmIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJzaW1wbGVcIikgJiYgc3ltYm9sVHlwZSA9PT0gXCJlc3JpU0ZTXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGZvcm1hdHMgfSA9IGRhdGE7XG4gICAgICAgIGlmIChoYXNDSU1UeXBlKGFsbG93ZWRUeXBlcykgJiYgaGFzQ0lNVHlwZShmb3JtYXRzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gZGVmYXVsdFN5bWJvbEl0ZW1GaWx0ZXIyZChzeW1ib2xJdGVtLCBzb3VyY2UpIHtcbiAgICAgICAgY29uc3QgZ2VvbWV0cnlTeW1ib2xGaWx0ZXIgPSBnZW9tZXRyeVR5cGUgPT09IFwicG9pbnRcIiA/IGlzUG9pbnRDSU0gOiBnZW9tZXRyeVR5cGUgPT09IFwibGluZVwiID8gaXNMaW5lQ0lNIDogaXNQb2x5Z29uQ0lNO1xuICAgICAgICBpZiAoIXN5bWJvbEl0ZW1Pbmx5RmlsdGVyKHN5bWJvbEl0ZW0pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFzUGljdHVyZUNJTSA9IGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcImNpbTpwaWN0dXJlXCIpO1xuICAgICAgICBjb25zdCBoYXNWZWN0b3JDSU0gPSBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJjaW06dmVjdG9yXCIpO1xuICAgICAgICBjb25zdCBoYXNBbGxPck5vQ0lNRmlsdGVycyA9IChoYXNQaWN0dXJlQ0lNICYmIGhhc1ZlY3RvckNJTSkgfHwgKCFoYXNQaWN0dXJlQ0lNICYmICFoYXNWZWN0b3JDSU0pO1xuICAgICAgICAvLyBUT0RPOiBiYXNlIG9uIGdlb210eXBlXG4gICAgICAgIGNvbnN0IGlzUG9pbnRPbmx5Q2ltU291cmNlID0gaGFzQ2ltUG9pbnRLZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbUxpbmVLZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbVBvbHlnb25LZXl3b3JkKHNvdXJjZSk7XG4gICAgICAgIGNvbnN0IGlzTGluZU9ubHlDaW1Tb3VyY2UgPSBoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpICYmICFoYXNDaW1Qb2ludEtleXdvcmQoc291cmNlKSAmJiAhaGFzQ2ltUG9seWdvbktleXdvcmQoc291cmNlKTtcbiAgICAgICAgY29uc3QgaXNQb2x5Z29uT25seUNpbVNvdXJjZSA9IGhhc0NpbVBvbHlnb25LZXl3b3JkKHNvdXJjZSkgJiYgIWhhc0NpbVBvaW50S2V5d29yZChzb3VyY2UpICYmICFoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpO1xuICAgICAgICBjb25zdCByZXF1ZXN0ZWRUeXBlID0gZ2VvbWV0cnlUeXBlID09PSBcImxpbmVcIlxuICAgICAgICAgICAgPyBjaW1HZW9tZXRyeUl0ZW1UeXBlLmxpbmVcbiAgICAgICAgICAgIDogZ2VvbWV0cnlUeXBlID09PSBcInBvbHlnb25cIlxuICAgICAgICAgICAgICAgID8gY2ltR2VvbWV0cnlJdGVtVHlwZS5wb2x5Z29uXG4gICAgICAgICAgICAgICAgOiBjaW1HZW9tZXRyeUl0ZW1UeXBlLnBvaW50O1xuICAgICAgICBjb25zdCBpc1JlcXVlc3RlZFR5cGVDaW1Tb3VyY2UgPSBpc1BvaW50T25seUNpbVNvdXJjZSB8fCBpc0xpbmVPbmx5Q2ltU291cmNlIHx8IGlzUG9seWdvbk9ubHlDaW1Tb3VyY2U7XG4gICAgICAgIGlmICgoaXNSZXF1ZXN0ZWRUeXBlQ2ltU291cmNlICYmIGhhc0FsbE9yTm9DSU1GaWx0ZXJzKSB8fFxuICAgICAgICAgICAgc291cmNlLnR5cGUgIT09IFwid2ViLXN0eWxlXCIgfHxcbiAgICAgICAgICAgIHN5bWJvbEl0ZW0uZGF0YS5pdGVtVHlwZSA9PT0gcmVxdWVzdGVkVHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3ltYm9sID0gYXdhaXQgc3ltYm9sSXRlbS5nZXRTeW1ib2woKTtcbiAgICAgICAgLy8gd2Ugb25seSBmaWx0ZXIgQ0lNIHN5bWJvbHMsIHRoZSByZXN0IHdlIGxldCB0aHJvdWdoXG4gICAgICAgIHJldHVybiAhaXNDSU1TeW1ib2woc3ltYm9sKSB8fCBnZW9tZXRyeVN5bWJvbEZpbHRlcihzeW1ib2wpO1xuICAgIH07XG59XG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0U3ltYm9sSXRlbUZpbHRlcjNkKGFsbG93ZWRUeXBlcykge1xuICAgIHJldHVybiBhc3luYyBmdW5jdGlvbiBkZWZhdWx0U3ltYm9sSXRlbUZpbHRlcjNkKHN5bWJvbEl0ZW0pIHtcbiAgICAgICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcImFsbFwiKSB8fCBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBkYXRhOiB7IGRpbWVuc2lvbmFsaXR5IH0gfSA9IHN5bWJvbEl0ZW07XG4gICAgICAgIHJldHVybiAoKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOmZsYXRcIikgJiYgZGltZW5zaW9uYWxpdHkgPT09IFwiZmxhdFwiKSB8fFxuICAgICAgICAgICAgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOnZvbHVtZXRyaWNcIikgJiYgZGltZW5zaW9uYWxpdHkgPT09IFwidm9sdW1ldHJpY1wiKSk7XG4gICAgfTtcbn1cbmNvbnN0IGdlb21ldHJ5VHlwZUtleXdvcmRzID0ge1xuICAgIHBvaW50OiBcIlBvaW50XCIsXG4gICAgbGluZTogXCJMaW5lXCIsXG4gICAgcG9seWdvbjogXCJQb2x5Z29uXCJcbn07XG5mdW5jdGlvbiBoYXNDaW1Qb2ludEtleXdvcmQoeyBrZXl3b3JkcyB9KSB7XG4gICAgcmV0dXJuIGtleXdvcmRzLmluY2x1ZGVzKGdlb21ldHJ5VHlwZUtleXdvcmRzLnBvaW50KSB8fCBrZXl3b3Jkcy5pbmNsdWRlcyhcInBvaW50U3ltYm9sXCIpO1xufVxuZnVuY3Rpb24gaGFzTWFya2VyS2V5d29yZCh7IGtleXdvcmRzIH0pIHtcbiAgICByZXR1cm4ga2V5d29yZHMuaW5jbHVkZXMoXCJtYXJrZXJcIik7XG59XG5mdW5jdGlvbiBoYXNDaW1MaW5lS2V5d29yZCh7IGtleXdvcmRzIH0pIHtcbiAgICByZXR1cm4ga2V5d29yZHMuaW5jbHVkZXMoZ2VvbWV0cnlUeXBlS2V5d29yZHMubGluZSkgfHwga2V5d29yZHMuaW5jbHVkZXMoXCJsaW5lU3ltYm9sXCIpO1xufVxuZnVuY3Rpb24gaGFzQ2ltUG9seWdvbktleXdvcmQoeyBrZXl3b3JkcyB9KSB7XG4gICAgcmV0dXJuIGtleXdvcmRzLmluY2x1ZGVzKGdlb21ldHJ5VHlwZUtleXdvcmRzLnBvbHlnb24pIHx8IGtleXdvcmRzLmluY2x1ZGVzKFwicG9seWdvblN5bWJvbFwiKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZpbHRlclNvdXJjZXMoc291cmNlcywgdHlwZSwgZ2VvbWV0cnlUeXBlLCBzeW1ib2xUeXBlLCBmaWx0ZXIpIHtcbiAgICBjb25zdCBhbGxvd2VkID0gbm9ybWFsaXplQWxsb3dlZFR5cGVzKHR5cGUpO1xuICAgIGNvbnN0IGRlZmF1bHRTb3VyY2VGaWx0ZXIgPSBzeW1ib2xUeXBlID09PSBcIjJkXCJcbiAgICAgICAgPyBjcmVhdGVEZWZhdWx0U3ltYm9sU291cmNlRmlsdGVyMmQoZ2VvbWV0cnlUeXBlLCBhbGxvd2VkKVxuICAgICAgICA6IGNyZWF0ZURlZmF1bHRTeW1ib2xTb3VyY2VGaWx0ZXIzZChhbGxvd2VkKTtcbiAgICBjb25zdCBlZmZlY3RpdmVGaWx0ZXIgPSBhc3luYyAoc3ltYm9sU291cmNlKSA9PiBmaWx0ZXIgPyBmaWx0ZXIoc3ltYm9sU291cmNlLCBkZWZhdWx0U291cmNlRmlsdGVyKSA6IGRlZmF1bHRTb3VyY2VGaWx0ZXIoc3ltYm9sU291cmNlKTtcbiAgICByZXR1cm4gYXN5bmNGaWx0ZXIoc291cmNlcywgZWZmZWN0aXZlRmlsdGVyKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRTeW1ib2xTb3VyY2VGaWx0ZXIyZChnZW9tZXRyeVR5cGUsIGFsbG93ZWRUeXBlcykge1xuICAgIHJldHVybiBhc3luYyAoc291cmNlKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzM2QgPSBzb3VyY2Uua2V5d29yZHMuaW5jbHVkZXMoXCIzZFwiKTtcbiAgICAgICAgY29uc3QgaXNEaWN0aW9uYXJ5ID0gc291cmNlLmtleXdvcmRzLmluY2x1ZGVzKFwiRGljdGlvbmFyeVwiKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlc0dlb21ldHJ5VHlwZSA9IGdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiXG4gICAgICAgICAgICA/IGhhc0NpbVBvaW50S2V5d29yZChzb3VyY2UpIHx8IGhhc01hcmtlcktleXdvcmQoc291cmNlKVxuICAgICAgICAgICAgOiBnZW9tZXRyeVR5cGUgPT09IFwibGluZVwiXG4gICAgICAgICAgICAgICAgPyBoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpXG4gICAgICAgICAgICAgICAgOiBoYXNDaW1Qb2x5Z29uS2V5d29yZChzb3VyY2UpO1xuICAgICAgICBjb25zdCBoYXNBdExlYXN0T25lR2VvbUtleXdvcmQgPSBoYXNDaW1Qb2ludEtleXdvcmQoc291cmNlKSB8fFxuICAgICAgICAgICAgaGFzTWFya2VyS2V5d29yZChzb3VyY2UpIHx8XG4gICAgICAgICAgICBoYXNDaW1MaW5lS2V5d29yZChzb3VyY2UpIHx8XG4gICAgICAgICAgICBoYXNDaW1Qb2x5Z29uS2V5d29yZChzb3VyY2UpO1xuICAgICAgICBpZiAoaXMzZCB8fCBpc0RpY3Rpb25hcnkgfHwgKCFtYXRjaGVzR2VvbWV0cnlUeXBlICYmIGhhc0F0TGVhc3RPbmVHZW9tS2V5d29yZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKFwiYWxsXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRCYXNpY1NvdXJjZUlkKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiXG4gICAgICAgICAgICAgICAgPyBiYXNpY1BvaW50U3ltYm9sU2V0U291cmNlSWRcbiAgICAgICAgICAgICAgICA6IGdlb21ldHJ5VHlwZSA9PT0gXCJsaW5lXCJcbiAgICAgICAgICAgICAgICAgICAgPyBiYXNpY0xpbmVTeW1ib2xTZXRTb3VyY2VJZFxuICAgICAgICAgICAgICAgICAgICA6IGJhc2ljUG9seWdvblN5bWJvbFNldFNvdXJjZUlkO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJhc2ljU3ltYm9sU2V0U291cmNlSWQgPSBnZXRCYXNpY1NvdXJjZUlkKCk7XG4gICAgICAgIGlmIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCJwaWN0dXJlXCIpICYmIHNvdXJjZS5pZCAhPSBiYXNpY1N5bWJvbFNldFNvdXJjZUlkICYmIHNvdXJjZS50eXBlID09PSBcInN5bWJvbC1zZXRcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcInNpbXBsZVwiKSAmJiBzb3VyY2UuaWQgPT09IGJhc2ljU3ltYm9sU2V0U291cmNlSWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNDSU1UeXBlKGFsbG93ZWRUeXBlcykgJiYgc291cmNlLnR5cGUgPT09IFwid2ViLXN0eWxlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xufVxuZnVuY3Rpb24gaXNQb3J0YWxTb3VyY2Uoc291cmNlKSB7XG4gICAgcmV0dXJuIFwicG9ydGFsSXRlbVwiIGluIHNvdXJjZTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRTeW1ib2xTb3VyY2VGaWx0ZXIzZChhbGxvd2VkVHlwZXMpIHtcbiAgICBjb25zdCB3ZWJTdHlsZUl0ZW1LZXl3b3JkQmxvY2tsaXN0ID0ge1xuICAgICAgICBFc3JpVGhlbWF0aWNTaGFwZXNTdHlsZTogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIGFzeW5jIChzb3VyY2UpID0+IHtcbiAgICAgICAgaWYgKHNvdXJjZS5rZXl3b3Jkcy5ldmVyeSgoa2V5d29yZCkgPT4gIXdlYlN0eWxlSXRlbUtleXdvcmRCbG9ja2xpc3Rba2V5d29yZF0pICYmXG4gICAgICAgICAgICBzb3VyY2UudHlwZSA9PT0gXCJ3ZWItc3R5bGVcIiAmJlxuICAgICAgICAgICAgKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcImFsbFwiKSB8fCBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZFwiKSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1BvcnRhbFNvdXJjZShzb3VyY2UpKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgc291cmNlLmZldGNoRGF0YSgpO1xuICAgICAgICAgICAgY29uc3QgW2ZpcnN0XSA9IGRhdGEuaXRlbXM7XG4gICAgICAgICAgICBjb25zdCB7IGRpbWVuc2lvbmFsaXR5IH0gPSBmaXJzdDtcbiAgICAgICAgICAgIHJldHVybiAoKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOmZsYXRcIikgJiYgZGltZW5zaW9uYWxpdHkgPT09IFwiZmxhdFwiKSB8fFxuICAgICAgICAgICAgICAgIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZDp2b2x1bWV0cmljXCIpICYmIGRpbWVuc2lvbmFsaXR5ID09PSBcInZvbHVtZXRyaWNcIikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoKGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhcIjNkOmZsYXRcIikgJiYgc291cmNlLmlkID09IFwiYmFzaWMtd2ViLXN0eWxlOmZsYXRcIikgfHxcbiAgICAgICAgICAgIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoXCIzZDp2b2x1bWV0cmljXCIpICYmIHNvdXJjZS5pZCA9PSBcImJhc2ljLXdlYi1zdHlsZTp2b2x1bWV0cmljXCIpKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gaGFzQ0lNVHlwZSh0eXBlcykge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHR5cGVzKSAmJiB0eXBlcy5zb21lKCh0eXBlKSA9PiB0eXBlLmluY2x1ZGVzKFwiY2ltXCIpKTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZUFsbG93ZWRUeXBlcyh0eXBlID0gXCJhbGxcIikge1xuICAgIGNvbnN0IHR5cGVzID0gQXJyYXkuaXNBcnJheSh0eXBlKSA/IHR5cGUgOiBbdHlwZV07XG4gICAgY29uc3QgaGFzUmVkdW5kYW50Q0lNVHlwZXMgPSB0eXBlcy5maW5kKCh0eXBlKSA9PiB0eXBlID09PSBcImNpbVwiICYmIHR5cGVzLmZpbmQoKHR5cGUpID0+IHR5cGUuaW5jbHVkZXMoXCJjaW06XCIpKSk7XG4gICAgaWYgKGhhc1JlZHVuZGFudENJTVR5cGVzKSB7XG4gICAgICAgIHJldHVybiB0eXBlcy5maWx0ZXIoKHR5cGUpID0+ICF0eXBlLmluY2x1ZGVzKFwiY2ltOlwiKSk7XG4gICAgfVxuICAgIHJldHVybiB0eXBlcztcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU291cmNlcyhwb3J0YWwsIGJlZm9yZSwgYWZ0ZXIsIHN0cmluZ3MsIHR5cGUpIHtcbiAgICBjb25zdCBpbnRlcmNlcHRvckRhdGEgPSB7fTtcbiAgICBpZiAoYmVmb3JlKSB7XG4gICAgICAgIGF3YWl0IGJlZm9yZShwb3J0YWwsIGludGVyY2VwdG9yRGF0YSk7XG4gICAgfVxuICAgIGF3YWl0IHBvcnRhbC5sb2FkKCk7XG4gICAgY29uc3QgcHJvY2Vzc2VkU291cmNlcyA9IGF3YWl0ICh0eXBlID09PSBcIjJkXCIgPyBidWlsZDJkU291cmNlcyhwb3J0YWwsIHN0cmluZ3MpIDogYnVpbGQzZFNvdXJjZXMocG9ydGFsLCBzdHJpbmdzKSk7XG4gICAgaWYgKGFmdGVyKSB7XG4gICAgICAgIGF3YWl0IGFmdGVyKHBvcnRhbCwgaW50ZXJjZXB0b3JEYXRhKTtcbiAgICB9XG4gICAgcmV0dXJuIHByb2Nlc3NlZFNvdXJjZXM7XG59XG5hc3luYyBmdW5jdGlvbiBidWlsZDJkU291cmNlcyhwb3J0YWwsIHN0cmluZ3MpIHtcbiAgICBjb25zdCBvcmlnaW5hbFN5bWJvbFNldHNHcm91cFF1ZXJ5ID0gcG9ydGFsLnN5bWJvbFNldHNHcm91cFF1ZXJ5O1xuICAgIHBvcnRhbC5zeW1ib2xTZXRzR3JvdXBRdWVyeSA9ICdvd25lcjplc3JpIEFORCB0aXRsZTpcIk1hcCBWaWV3ZXIgQmV0YSBTeW1ib2xzXCInO1xuICAgIGNvbnN0IFtjbGFzc2ljLCBzb3VyY2VzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgZmV0Y2hTeW1ib2xTZXRTeW1ib2xTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncyksXG4gICAgICAgIGZldGNoV2ViU3R5bGVTeW1ib2xTb3VyY2VzKHBvcnRhbCwgXCIyZFwiLCBzdHJpbmdzKVxuICAgIF0pO1xuICAgIGNvbnN0IGZpbHRlck91dEJhc2ljVHlwZXMgPSAoc291cmNlKSA9PiBzb3VyY2Uua2V5d29yZHMuZXZlcnkoKHR5cGUpID0+IHR5cGUgIT09IFwiQmFzaWNcIik7XG4gICAgY29uc3QgcHJvY2Vzc2VkU291cmNlcyA9IFtcbiAgICAgICAgZ2V0QmFzaWMoc3RyaW5ncywgXCJwb2ludFwiKSxcbiAgICAgICAgZ2V0QmFzaWMoc3RyaW5ncywgXCJsaW5lXCIpLFxuICAgICAgICBnZXRCYXNpYyhzdHJpbmdzLCBcInBvbHlnb25cIiksXG4gICAgICAgIC4uLmNsYXNzaWMuZmlsdGVyKGZpbHRlck91dEJhc2ljVHlwZXMpLFxuICAgICAgICAuLi5zb3VyY2VzLmZpbHRlcihmaWx0ZXJPdXRCYXNpY1R5cGVzKVxuICAgIF07XG4gICAgcG9ydGFsLnN5bWJvbFNldHNHcm91cFF1ZXJ5ID0gb3JpZ2luYWxTeW1ib2xTZXRzR3JvdXBRdWVyeTtcbiAgICByZXR1cm4gcHJvY2Vzc2VkU291cmNlcztcbn1cbmFzeW5jIGZ1bmN0aW9uIGJ1aWxkM2RTb3VyY2VzKHBvcnRhbCwgc3RyaW5ncykge1xuICAgIGNvbnN0IFtzb3VyY2VzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtmZXRjaFdlYlN0eWxlU3ltYm9sU291cmNlcyhwb3J0YWwsIFwiM2RcIiwgc3RyaW5ncyldKTtcbiAgICBjb25zdCBmaWx0ZXJPdXRCYXNpY1R5cGVzID0gKHNvdXJjZSkgPT4gc291cmNlLmtleXdvcmRzLmV2ZXJ5KCh0eXBlKSA9PiB0eXBlICE9PSBcIkJhc2ljXCIpO1xuICAgIGNvbnN0IHByb2Nlc3NlZFNvdXJjZXMgPSBbXG4gICAgICAgIGdldFByaW1pdGl2ZXMoXCJmbGF0XCIsIHN0cmluZ3MpLFxuICAgICAgICBnZXRQcmltaXRpdmVzKFwidm9sdW1ldHJpY1wiLCBzdHJpbmdzKSxcbiAgICAgICAgLi4uc291cmNlcy5maWx0ZXIoZmlsdGVyT3V0QmFzaWNUeXBlcylcbiAgICBdO1xuICAgIHJldHVybiBwcm9jZXNzZWRTb3VyY2VzO1xufVxuXG5jb25zdCBhcmNnaXNTeW1ib2xQaWNrZXJDc3MgPSBcIi5zY3JvbGxlci5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnttYXgtaGVpZ2h0OnZhcigtLXNjcm9sbGVyLW1heC1oZWlnaHQsIG1pbigxMDB2aCAtIDQwMHB4LCAzMDBweCkpO292ZXJmbG93LXk6YXV0bzttaW4td2lkdGg6MjAwcHg7b3ZlcmZsb3cteDpoaWRkZW47ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9LnNjLWFyY2dpcy1zeW1ib2wtcGlja2VyLWgsLmFyY2dpcy1zeW1ib2wtcGlja2VyX19jb250YWluZXIuc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7ZGlzcGxheTpmbGV4O2ZsZXg6MSAxIGF1dG87ZmxleC1mbG93OmNvbHVtbiBub3dyYXA7YWxpZ24taXRlbXM6c3RyZXRjaH0uY2F0ZWdvcmllcy5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcntkaXNwbGF5OmZsZXg7YWxpZ24tY29udGVudDpub3JtYWx9LmNhdGVnb3JpZXMtY2VudGVyLWFjdGlvbi5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcntwYWRkaW5nOjAgNXB4fS5tYXJrZXItc2VsZWN0aW9uLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye3BhZGRpbmc6OHB4fS5tYXJrZXItc291cmNlLXNlbGVjdC5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnt3aWR0aDpjYWxjKDEwMCUgLSA3NHB4KTtkaXNwbGF5OmJsb2NrfS5tYXJrZXItc291cmNlLXNlbGVjdFtoaWRkZW5dLnNjLWFyY2dpcy1zeW1ib2wtcGlja2VyKy5tYXJrZXItc2VsZWN0aW9uLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye2JvcmRlci10b3A6MXB4IHNvbGlkIGxpZ2h0Z3JheTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCl9Lm1hcmtlci1zZWxlY3Rpb24tLWRhcmsuc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1hcmNnaXMtYXBwLWZvcmVncm91bmQpO2NvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCl9LmVtcHR5LWNhdGVnb3J5LWNvbnRlbnQuc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtc3BhY2luZy1oYWxmKSB2YXIoLS1hcmNnaXMtYXBwLXNwYWNpbmctcXVhcnRlcil9LmluY29tcGF0aWJsZS1zeW1ib2xzLW5vdGljZS5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnttYXJnaW46OHB4IDB9Lm1hcmtlci1pdGVtLnNjLWFyY2dpcy1zeW1ib2wtcGlja2Vye2hlaWdodDo0MHB4O3dpZHRoOjM4LjVweDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1hcmNnaXMtYXBwLWJhY2tncm91bmQpfS5tYXJrZXItaXRlbS5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlciBbc2xvdD10aHVtYm5haWxdLnNjLWFyY2dpcy1zeW1ib2wtcGlja2VyPmRpdi5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnttYXJnaW46OHB4IDEwcHg7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyfS5pdGVtLXBhbGV0dGUuc2MtYXJjZ2lzLXN5bWJvbC1waWNrZXJ7d2lkdGg6MTAwJTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5maWxlLXVwbG9hZC5zYy1hcmNnaXMtc3ltYm9sLXBpY2tlcnttYXJnaW4tdG9wOjIwcHg7d2lkdGg6YXV0b31cIjtcblxuY29uc3QgQ1NTID0ge1xuICAgIGNvbnRhaW5lcjogXCJhcmNnaXMtc3ltYm9sLXBpY2tlcl9fY29udGFpbmVyXCIsXG4gICAgbWFya2VyU3ltYm9sQ29udGVudDogXCJtYXJrZXItc3ltYm9sLWNvbnRlbnRcIixcbiAgICBpbmNvbXBhdGlibGVTeW1ib2xzTm90aWNlOiBcImluY29tcGF0aWJsZS1zeW1ib2xzLW5vdGljZVwiLFxuICAgIGVtcHR5Q2F0ZWdvcnlDb250ZW50OiBcImVtcHR5LWNhdGVnb3J5LWNvbnRlbnRcIixcbiAgICBtYXJrZXJTZWxlY3Rpb25Ecm9wZG93bjogXCJtYXJrZXItc291cmNlLXNlbGVjdFwiLFxuICAgIG1hcmtlclNlbGVjdGlvbjogXCJtYXJrZXItc2VsZWN0aW9uXCIsXG4gICAgbWFya2VyU2VsZWN0aW9uRGFyazogXCJtYXJrZXItc2VsZWN0aW9uLS1kYXJrXCIsXG4gICAgc2Nyb2xsZXI6IFwic2Nyb2xsZXJcIixcbiAgICBpdGVtUGFsZXR0ZTogXCJpdGVtLXBhbGV0dGVcIixcbiAgICBmaWxlVXBsb2FkOiBcImZpbGUtdXBsb2FkXCIsXG4gICAgY2F0ZWdvcmllczogXCJjYXRlZ29yaWVzXCIsXG4gICAgY2F0ZWdvcmllc0NlbnRlckFjdGlvbjogXCJjYXRlZ29yaWVzLWNlbnRlci1hY3Rpb25cIlxufTtcbmNvbnN0IEFyY2dpc1N5bWJvbFBpY2tlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNBY3RpdmVTeW1ib2xDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sSXRlbUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU3ltYm9sSXRlbUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJZENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU291cmNlSWRDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sU291cmNlc0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU3ltYm9sU291cmNlc0NoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJdGVtc0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQWN0aXZlU291cmNlSXRlbXNDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYWxsQ3VzdG9tRmlsZUluZm9zID0gW107XG4gICAgICAgIHRoaXMuY3VzdG9tU3ltYm9sc1N0b3JhZ2VJZCA9IFwiYXJjZ2lzLXN5bWJvbC1waWNrZXItY3VzdG9tLXN5bWJvbHNcIjtcbiAgICAgICAgdGhpcy5hY3Rpb25FbHMgPSBbXTtcbiAgICAgICAgdGhpcy5fb25TeW1ib2xTb3VyY2VDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJdGVtcyB9ID0gZHJvcGRvd247XG4gICAgICAgICAgICBjb25zdCBtb3N0UmVjZW50U2VsZWN0aW9uID0gc2VsZWN0ZWRJdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIikgIT09IHRoaXMuX2FjdGl2ZVNvdXJjZUlkKTtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVNvdXJjZUlkID0gKG1vc3RSZWNlbnRTZWxlY3Rpb24gPT09IG51bGwgfHwgbW9zdFJlY2VudFNlbGVjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogbW9zdFJlY2VudFNlbGVjdGlvbi5nZXRBdHRyaWJ1dGUoXCJkYXRhLXZhbHVlXCIpKSB8fCB0aGlzLl9hY3RpdmVTb3VyY2VJZDtcbiAgICAgICAgICAgIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIilcbiAgICAgICAgICAgICAgICAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtICE9PSBtb3N0UmVjZW50U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3ltYm9sRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFjdGl2ZVNvdXJjZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGlkZUhlYWRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN5bWJvbFR5cGUgPSBcIjJkXCI7XG4gICAgICAgIHRoaXMuY3VzdG9tU3ltYm9sSXRlbUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xTb3VyY2VGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbXNQZXJSb3cgPSA0O1xuICAgICAgICB0aGlzLnN5bWJvbFNvdXJjZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWN0aXZlU3ltYm9sSXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX2FjdGl2ZVNvdXJjZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9zeW1ib2xTb3VyY2VzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0dyaWRWaWV3ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2ggPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZW5ldmVyIHRoZSBhY3RpdmVTb3VyY2UgY2hhbmdlcywgd2UgZmV0Y2hcbiAgICAgKiB0aGUgbmV3IHN5bWJvbCBpdGVtcyBmb3IgdGhhdCBzb3VyY2VzLlxuICAgICAqL1xuICAgIGhhbmRsZUFjdGl2ZVNvdXJjZUl0ZW1JZENoYW5nZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVTb3VyY2VJZCkge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZlU291cmNlSWQgPT09IFwiY3VzdG9tLXN5bWJvbC1zZXRcIlxuICAgICAgICAgICAgICAgID8gdGhpcy5fc2V0dXBDdXN0b21TeW1ib2xzKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuX2ZldGNoQW5kU2V0VXBTeW1ib2xJdGVtcyh0aGlzLl9zeW1ib2xTb3VyY2VzLmZpbmQoKHsgaWQgfSkgPT4gaWQgPT09IHRoaXMuX2FjdGl2ZVNvdXJjZUlkKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGVkaXRHZW9tZXRyeSgpIHtcbiAgICAgICAgcmV0dXJuIGdlb21ldHJ5VHlwZSh0aGlzLnN5bWJvbCk7XG4gICAgfVxuICAgIGhhbmRsZUZpbGVVcGxvYWRDaGFuZ2UoeyBkZXRhaWwgfSkge1xuICAgICAgICBjb25zdCBmaWxlSW5mbyA9IGRldGFpbDtcbiAgICAgICAgY29uc3QgY2ltU3RyID0gZmlsZUluZm8uY2ltICYmIEpTT04uc3RyaW5naWZ5KGZpbGVJbmZvLmNpbS50b0pTT04oKSk7XG4gICAgICAgIGlmIChmaWxlSW5mby5kYXRhVVJMICYmIGZpbGVJbmZvLmRhdGFVUkwubGVuZ3RoID4gMjAwMDAwKSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gXCJ0b28tbGFyZ2VcIjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChmaWxlSW5mby5jaW0gJiYgY2ltU3RyLmxlbmd0aCA+IDIwMDAwMCkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IFwidG9vLWxhcmdlXCI7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvdW5kRmlsZUluZm8gPSB0aGlzLmFsbEN1c3RvbUZpbGVJbmZvcy5maW5kKChpbmZvKSA9PiAoZmlsZUluZm8uZGF0YVVSTCAmJlxuICAgICAgICAgICAgaW5mby5kYXRhVVJMICYmXG4gICAgICAgICAgICBpbmZvLmRhdGFVUkwgPT09IGZpbGVJbmZvLmRhdGFVUkwgJiZcbiAgICAgICAgICAgIGluZm8uZmlsZU5hbWUgPT09IGZpbGVJbmZvLmZpbGVOYW1lKSB8fFxuICAgICAgICAgICAgKGZpbGVJbmZvLmNpbSAmJlxuICAgICAgICAgICAgICAgIGluZm8uY2ltICYmXG4gICAgICAgICAgICAgICAgaW5mby5maWxlTmFtZSA9PT0gZmlsZUluZm8uZmlsZU5hbWUgJiZcbiAgICAgICAgICAgICAgICBjaW1TdHIgPT09IEpTT04uc3RyaW5naWZ5KGluZm8uY2ltLnRvSlNPTigpKSkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IGFjdGl2ZVN5bWJvbEl0ZW07XG4gICAgICAgICAgICBpZiAoIWZvdW5kRmlsZUluZm8pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxDdXN0b21GaWxlSW5mb3MgPSBbLi4udGhpcy5hbGxDdXN0b21GaWxlSW5mb3MsIGZpbGVJbmZvXTtcbiAgICAgICAgICAgICAgICBzZXRMb2NhbFN0b3JhZ2VJdGVtKHRoaXMuY3VzdG9tU3ltYm9sc1N0b3JhZ2VJZCwgYWxsQ3VzdG9tRmlsZUluZm9zLm1hcCgoaW5mbykgPT4gaW5mby5kYXRhVVJMID8gaW5mbyA6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgaW5mbyksIHsgY2ltOiBKU09OLnN0cmluZ2lmeShpbmZvLmNpbS50b0pTT04oKSkgfSkpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbEN1c3RvbUZpbGVJbmZvcyA9IGFsbEN1c3RvbUZpbGVJbmZvcztcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cEN1c3RvbVN5bWJvbHMoKTtcbiAgICAgICAgICAgICAgICBhY3RpdmVTeW1ib2xJdGVtID0gdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXNbdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVTeW1ib2xJdGVtID0gdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMuZmluZCgoc3ltYm9sSXRlbSkgPT4gc3ltYm9sSXRlbS5kYXRhLm5hbWUgPT09IGZvdW5kRmlsZUluZm8uZmlsZU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc2VsZWN0IGFjdGl2ZSBzeW1ib2xcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU3ltYm9sSXRlbSA9IGFjdGl2ZVN5bWJvbEl0ZW07XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbEl0ZW1DaGFuZ2UuZW1pdCh0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0pO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVTeW1ib2xJdGVtXG4gICAgICAgICAgICAgICAgLmdldFN5bWJvbCgpXG4gICAgICAgICAgICAgICAgLnRoZW4oKHN5bWJvbCkgPT4gdGhpcy5hcmNnaXNBY3RpdmVTeW1ib2xDaGFuZ2UuZW1pdChzeW1ib2wpKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgKF9hID0gdGhpcy5pdGVtUGFsZXR0ZU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGlzdFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgfSksIDEpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBlLm5hbWUgPT09IFF1b3RhRXhjZWVkZWRFcnJvclxuICAgICAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IFwic3RvcmFnZS1mdWxsXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlSW52YWxpZEZpbGUoKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSBcImludmFsaWQtZmlsZVwiO1xuICAgIH1cbiAgICBoYW5kbGVGaWxlVXBsb2FkRXJyb3IoKSB7XG4gICAgICAgIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPSBcImVycm9yXCI7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBfcmVuZGVyU3ltYm9sU291cmNlT3B0aW9ucyhzb3VyY2VzLCBhY3RpdmVTb3VyY2VJZCkge1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2VzOiBtZXJnZWRTdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBjbGFzc2ljID0gc291cmNlcy5maWx0ZXIoKHNvdXJjZSkgPT4gc291cmNlLnR5cGUgPT09IFwic3ltYm9sLXNldFwiKTtcbiAgICAgICAgY29uc3Qgd2ViU3R5bGVzID0gc291cmNlcy5maWx0ZXIoKHNvdXJjZSkgPT4gc291cmNlLnR5cGUgPT09IFwid2ViLXN0eWxlXCIpO1xuICAgICAgICBjb25zdCBzaG93Q3VzdG9tU3ltYm9scyA9ICF0aGlzLnN5bWJvbEZpbHRlciB8fFxuICAgICAgICAgICAgISEoQXJyYXkuaXNBcnJheSh0aGlzLnN5bWJvbEZpbHRlcikgPyB0aGlzLnN5bWJvbEZpbHRlciA6IFt0aGlzLnN5bWJvbEZpbHRlcl0pLmZpbmQoKHR5cGUpID0+IHR5cGUgPT09IFwiY3VzdG9tXCIgfHwgdHlwZSA9PT0gXCJwaWN0dXJlXCIpO1xuICAgICAgICBjb25zdCBjdXN0b21Hcm91cCA9IHRoaXMuc3ltYm9sVHlwZSAhPT0gXCIzZFwiICYmXG4gICAgICAgICAgICB0aGlzLmVkaXRHZW9tZXRyeSA9PT0gXCJwb2ludFwiICYmXG4gICAgICAgICAgICBzaG93Q3VzdG9tU3ltYm9scyAmJiAoaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBncm91cFRpdGxlOiBtZXJnZWRTdHJpbmdzLmN1c3RvbVN5bWJvbHMsIHNlbGVjdGlvbk1vZGU6IFwibXVsdGlwbGVcIiwga2V5OiBcImN1c3RvbVwiIH0sIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBrZXk6IFwiY3VzdG9tXCIsIFwiZGF0YS12YWx1ZVwiOiBcImN1c3RvbS1zeW1ib2wtc2V0XCIsIHNlbGVjdGVkOiBcImN1c3RvbS1zeW1ib2wtc2V0XCIgPT09IGFjdGl2ZVNvdXJjZUlkIH0sIG1lcmdlZFN0cmluZ3Muc3ltYm9scykpKTtcbiAgICAgICAgY29uc3QgY2xhc3NpY0dyb3VwID0gY2xhc3NpYy5sZW5ndGggPiAwICYmIChoKFwiY2FsY2l0ZS1kcm9wZG93bi1ncm91cFwiLCB7IGdyb3VwVGl0bGU6IG1lcmdlZFN0cmluZ3MuY2xhc3NpY1N5bWJvbHMsIHNlbGVjdGlvbk1vZGU6IFwibXVsdGlwbGVcIiwga2V5OiBcImNsYXNzaWNcIiB9LCB0aGlzLl9yZW5kZXJTb3VyY2VEcm9wZG93bkl0ZW0oY2xhc3NpYywgYWN0aXZlU291cmNlSWQpKSk7XG4gICAgICAgIGNvbnN0IHdlYlN0eWxlR3JvdXAgPSB3ZWJTdHlsZXMubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBncm91cFRpdGxlOiBtZXJnZWRTdHJpbmdzLm5ld1N5bWJvbHMsIHNlbGVjdGlvbk1vZGU6IFwibXVsdGlwbGVcIiwga2V5OiBcIndlYnN0eWxlc1wiIH0sIHRoaXMuX3JlbmRlclNvdXJjZURyb3Bkb3duSXRlbSh3ZWJTdHlsZXMsIGFjdGl2ZVNvdXJjZUlkKSkpO1xuICAgICAgICBpZiAoY3VzdG9tR3JvdXApIHtcbiAgICAgICAgICAgIGlmIChjbGFzc2ljR3JvdXApIHtcbiAgICAgICAgICAgICAgICBpZiAod2ViU3R5bGVHcm91cCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2N1c3RvbUdyb3VwLCBjbGFzc2ljR3JvdXAsIHdlYlN0eWxlR3JvdXBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtjdXN0b21Hcm91cCwgY2xhc3NpY0dyb3VwXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW2N1c3RvbUdyb3VwLCB3ZWJTdHlsZUdyb3VwXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjbGFzc2ljR3JvdXAgJiYgd2ViU3R5bGVHcm91cCkge1xuICAgICAgICAgICAgcmV0dXJuIFtjbGFzc2ljR3JvdXAsIHdlYlN0eWxlR3JvdXBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBrZXk6IFwib25lLWdyb3VwXCIgfSwgdGhpcy5fcmVuZGVyU291cmNlRHJvcGRvd25JdGVtKFsuLi5jbGFzc2ljLCAuLi53ZWJTdHlsZXNdLCBhY3RpdmVTb3VyY2VJZCkpKTtcbiAgICB9XG4gICAgX3JlbmRlclNvdXJjZURyb3Bkb3duSXRlbShzb3VyY2VzLCBhY3RpdmVTb3VyY2VJZCkge1xuICAgICAgICByZXR1cm4gc291cmNlcy5tYXAoKHNvdXJjZSkgPT4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBrZXk6IHNvdXJjZS5pZCwgXCJkYXRhLXZhbHVlXCI6IHNvdXJjZS5pZCwgc2VsZWN0ZWQ6IHNvdXJjZS5pZCA9PT0gYWN0aXZlU291cmNlSWQgfSwgc291cmNlLnRpdGxlKSkpO1xuICAgIH1cbiAgICBfc2V0dXBDdXN0b21TeW1ib2xzKCkge1xuICAgICAgICBjb25zdCBleGlzdGluZ1N5bWJvbEl0ZW1zID0gdGhpcy5hbGxDdXN0b21GaWxlSW5mb3MubWFwKChpbmZvKSA9PiB7XG4gICAgICAgICAgICBsZXQgd2lkdGggPSAyNDtcbiAgICAgICAgICAgIGxldCBoZWlnaHQgPSAyNDtcbiAgICAgICAgICAgIGlmIChpbmZvLndpZHRoID4gaW5mby5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLnJvdW5kKCh3aWR0aCAvIGluZm8ud2lkdGgpICogaW5mby5oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5mby53aWR0aCA8IGluZm8uaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBNYXRoLnJvdW5kKChoZWlnaHQgLyBpbmZvLmhlaWdodCkgKiBpbmZvLndpZHRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbmZvLmRhdGFVUkwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gaW5mby5maWxlTmFtZS5zcGxpdChcIi5cIilbMV0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50VHlwZSA9IHR5cGUgPT09IFwicG5nXCIgPyBcImltYWdlL3BuZ1wiIDogdHlwZSA9PT0gXCJnaWZcIiA/IFwiaW1hZ2UvZ2lmXCIgOiBcImltYWdlL2pwZWdcIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN5bWJvbEl0ZW0oe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbmdsZTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhOiBpbmZvLmRhdGFVUkwuc3BsaXQoXCIsXCIpWzFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaW5mby5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXNyaVBNU1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB5b2Zmc2V0OiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudERhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHBvcnRhbEl0ZW06IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiBmbGF0U3ltYm9sU3RyYXRlZ3ksXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IHRoaXMubWVzc2FnZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3ltYm9sSXRlbSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbDogaW5mby5jaW0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpbmZvLmZpbGVOYW1lXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudERhdGE6IHsgY2ltVmVyc2lvbjogXCIyLjYuMFwiIH0sXG4gICAgICAgICAgICAgICAgICAgIHBvcnRhbEl0ZW06IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiB3ZWJTdHlsZUN1c3RvbVN5bWJvbFN0cmF0ZWd5KCksXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IHRoaXMubWVzc2FnZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0VXBTeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlcigpO1xuICAgICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zID0gZXhpc3RpbmdTeW1ib2xJdGVtcztcbiAgICAgICAgLy9pZiAodGhpcy5fYWN0aXZlU291cmNlSWQgIT09IFwiY3VzdG9tLXN5bWJvbC1zZXRcIikge1xuICAgICAgICB0aGlzLmFyY2dpc0FjdGl2ZVNvdXJjZUlkQ2hhbmdlLmVtaXQoXCJjdXN0b20tc3ltYm9sLXNldFwiKTtcbiAgICAgICAgLy99XG4gICAgICAgIHRoaXMuYXJjZ2lzQWN0aXZlU291cmNlSXRlbXNDaGFuZ2UuZW1pdChleGlzdGluZ1N5bWJvbEl0ZW1zLm1hcCgoaXRlbSkgPT4gbmV3IFN5bWJvbEl0ZW0oT2JqZWN0LmFzc2lnbih7fSwgaXRlbSkpKSk7XG4gICAgfVxuICAgIGFzeW5jIF9mZXRjaEFuZFNldFVwU3ltYm9sSXRlbXMoc291cmNlKSB7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCkge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2guY29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgIGNvbnN0IHNpZ25hbCA9IGNvbnRyb2xsZXIuc2lnbmFsO1xuICAgICAgICB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIsXG4gICAgICAgICAgICBpZDogc291cmNlLmlkXG4gICAgICAgIH07XG4gICAgICAgIC8vIFdoZW4gbG9hZGluZyBmb3IgdGhlIGZpcnN0IHRpbWUsIHdlIGNoZWNrIGlmIHRoZXJlIGFyZSBzb21lIHN5bWJvbEl0ZW1zIHBhc3NlZFxuICAgICAgICAvLyB0byB0aGUgcHJvcHMgYW5kIHdlIHRydXN0IGl0J3MgdGhlIGNvcnJlY3Qgb25lIGZvciB0aGUgY3VycmVudCBhY3RpdmVTeW1ib2xTb3VyY2VcbiAgICAgICAgY29uc3Qgc3ltYm9sSXRlbXMgPSAoIXRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zICYmIHRoaXMuYWN0aXZlU3ltYm9sSXRlbXMpIHx8IChhd2FpdCBzb3VyY2UuZ2V0SXRlbXMoY29udHJvbGxlcikpO1xuICAgICAgICBpZiAoc2lnbmFsID09PSBudWxsIHx8IHNpZ25hbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWx0ZXJlZFN5bWJvbEl0ZW1zID0gYXdhaXQgZmlsdGVyU3ltYm9sSXRlbXMoc291cmNlLCBzeW1ib2xJdGVtcywgdGhpcy5zeW1ib2xGaWx0ZXIsIHRoaXMuZWRpdEdlb21ldHJ5LCB0aGlzLnN5bWJvbFR5cGUsIHRoaXMuY3VzdG9tU3ltYm9sSXRlbUZpbHRlcik7XG4gICAgICAgIGlmIChzaWduYWwgPT09IG51bGwgfHwgc2lnbmFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0VXBTeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlcigpO1xuICAgICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zID0gZmlsdGVyZWRTeW1ib2xJdGVtcztcbiAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJZENoYW5nZS5lbWl0KHRoaXMuX2FjdGl2ZVNvdXJjZUlkKTtcbiAgICAgICAgdGhpcy5hcmNnaXNBY3RpdmVTb3VyY2VJdGVtc0NoYW5nZS5lbWl0KGZpbHRlcmVkU3ltYm9sSXRlbXMubWFwKChpdGVtKSA9PiBuZXcgU3ltYm9sSXRlbShPYmplY3QuYXNzaWduKHt9LCBpdGVtKSkpKTtcbiAgICB9XG4gICAgb25JbmNvbXBhdGlibGVWZWN0b3JTeW1ib2xzRGlzbWlzcyhldmVudCkge1xuICAgICAgICBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5cy5BUkNHSVNfQ09NUE9ORU5UX05PVElGSUNBVElPTlMsIHtcbiAgICAgICAgICAgIGtleTogYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMuSU5DT01QQVRJQkxFX1ZFQ1RPUl9TWU1CT0xTX0RJU01JU1NFRCxcbiAgICAgICAgICAgIHZhbHVlOiBcInRydWVcIlxuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICAgIHRlYXJEb3duU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5fc3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuX3N5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyID0gbnVsbDtcbiAgICB9XG4gICAgc2V0VXBTeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlcigpIHtcbiAgICAgICAgdGhpcy50ZWFyRG93blN5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyKCk7XG4gICAgICAgIGxldCBub3dTZXJ2aW5nSW5kZXggPSAwO1xuICAgICAgICBjb25zdCBwZW5kaW5nQXBwZW5kcyA9IHt9O1xuICAgICAgICB0aGlzLl9zeW1ib2xJbnRlcnNlY3Rpb25PYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICAgICAgICAgICAgbm93U2VydmluZ0luZGV4Kys7XG4gICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdBcHBlbmRzW25vd1NlcnZpbmdJbmRleF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0FwcGVuZHNbbm93U2VydmluZ0luZGV4XSgpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcGVuZGluZ0FwcGVuZHNbbm93U2VydmluZ0luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGVudHJ5LnRhcmdldDtcbiAgICAgICAgICAgICAgICBub2RlLml0ZW0uZ2V0VGh1bWJuYWlsKG5vZGUpLnRoZW4oKGFwcGVuZFRodW1ibmFpbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pbmRleCA9PT0gbm93U2VydmluZ0luZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRUaHVtYm5haWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdBcHBlbmRzW25vZGUuaW5kZXhdID0gYXBwZW5kVGh1bWJuYWlsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbm9kZS5pdGVtLmdldFN5bWJvbCgpO1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLnVub2JzZXJ2ZShub2RlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgX2ZldGNoU291cmNlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NvdXJjZXNGZXRjaENvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3NvdXJjZXNGZXRjaENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zb3VyY2VzRmV0Y2hDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICBjb25zdCBzaWduYWwgPSB0aGlzLl9zb3VyY2VzRmV0Y2hDb250cm9sbGVyLnNpZ25hbDtcbiAgICAgICAgY29uc3QgcG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgICAgIGNvbnN0IGVmZmVjdGl2ZVBvcnRhbCA9IGlzSW50ZXJjZXB0b3IocG9ydGFsKSA/IHBvcnRhbC5wb3J0YWwgOiBwb3J0YWw7XG4gICAgICAgIGNvbnN0IGJlZm9yZUludGVyY2VwdG9yID0gaXNJbnRlcmNlcHRvcihwb3J0YWwpID8gcG9ydGFsLmJlZm9yZSA6IG51bGw7XG4gICAgICAgIGNvbnN0IGFmdGVySW50ZXJjZXB0b3IgPSBpc0ludGVyY2VwdG9yKHBvcnRhbCkgPyBwb3J0YWwuYWZ0ZXIgOiBudWxsO1xuICAgICAgICBjb25zdCBzeW1ib2xTb3VyY2VzID0gZWZmZWN0aXZlUG9ydGFsXG4gICAgICAgICAgICA/IHRoaXMuc3ltYm9sU291cmNlcyB8fFxuICAgICAgICAgICAgICAgIChhd2FpdCBmZXRjaFNvdXJjZXMoZWZmZWN0aXZlUG9ydGFsLCBiZWZvcmVJbnRlcmNlcHRvciwgYWZ0ZXJJbnRlcmNlcHRvciwgdGhpcy5tZXNzYWdlcywgdGhpcy5zeW1ib2xUeXBlKSlcbiAgICAgICAgICAgIDogW107XG4gICAgICAgIGlmIChzaWduYWwgPT09IG51bGwgfHwgc2lnbmFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N5bWJvbFNvdXJjZXMgPSBhd2FpdCBmaWx0ZXJTb3VyY2VzKHN5bWJvbFNvdXJjZXMsIHRoaXMuc3ltYm9sRmlsdGVyLCBnZW9tZXRyeVR5cGUodGhpcy5zeW1ib2wpLCB0aGlzLnN5bWJvbFR5cGUsIHRoaXMuY3VzdG9tU3ltYm9sU291cmNlRmlsdGVyKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTeW1ib2xTb3VyY2VzQ2hhbmdlLmVtaXQodGhpcy5fc3ltYm9sU291cmNlcyk7XG4gICAgICAgIGlmICghdGhpcy5fYWN0aXZlU291cmNlSWQpIHtcbiAgICAgICAgICAgIGxldCBhY3RpdmVTb3VyY2VJZCA9IHRoaXMuYWN0aXZlU291cmNlSWQ7XG4gICAgICAgICAgICBpZiAoYWN0aXZlU291cmNlSWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVTb3VyY2UgPSB0aGlzLl9zeW1ib2xTb3VyY2VzLmZpbmQoKHNvdXJjZSkgPT4gc291cmNlLmlkID09PSB0aGlzLmFjdGl2ZVNvdXJjZUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWFjdGl2ZVNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBtYXliZSBkaWZmZXJlbnQgc3ltYm9sIGdlb21ldHJ5IHR5cGUgbm93OyBjYW4ndCByZS11c2UgbGFzdCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlU291cmNlSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fYWN0aXZlU291cmNlSWQgPSBhY3RpdmVTb3VyY2VJZCB8fCB0aGlzLl9zeW1ib2xTb3VyY2VzWzBdLmlkO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9nZXRDdXN0b21TeW1ib2xzRnJvbVN0b3JhZ2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnN5bWJvbFR5cGUgPT09IFwiM2RcIiB8fCB0aGlzLmVkaXRHZW9tZXRyeSAhPT0gXCJwb2ludFwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsZUluZm9zID0gZ2V0TG9jYWxTdG9yYWdlSXRlbSh0aGlzLmN1c3RvbVN5bWJvbHNTdG9yYWdlSWQsIHRydWUpO1xuICAgICAgICBpZiAoZmlsZUluZm9zKSB7XG4gICAgICAgICAgICB0aGlzLmFsbEN1c3RvbUZpbGVJbmZvcyA9IGZpbGVJbmZvcy5tYXAoKGluZm8pID0+IGluZm8uZGF0YVVSTCA/IGluZm8gOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGluZm8pLCB7IGNpbTogZXNyaU1vZHVsZXMuQ0lNU3ltYm9sLmZyb21KU09OKEpTT04ucGFyc2UoaW5mby5jaW0pKSB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX3JlbmRlclNvdXJjZVNlbGVjdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlczogbWVyZ2VkU3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IHRoaXMuX3N5bWJvbFNvdXJjZXM7XG4gICAgICAgIGlmICghc291cmNlcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNvdXJjZSA9IHRoaXMuX3N5bWJvbFNvdXJjZXMuZmluZCgoc291cmNlKSA9PiBzb3VyY2UuaWQgPT09IHRoaXMuX2FjdGl2ZVNvdXJjZUlkKTtcbiAgICAgICAgY29uc3QgYWN0aXZlU291cmNlVGl0bGUgPSB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiXG4gICAgICAgICAgICA/IG1lcmdlZFN0cmluZ3MuY3VzdG9tU3ltYm9sc1xuICAgICAgICAgICAgOiBhY3RpdmVTb3VyY2UgPT09IG51bGwgfHwgYWN0aXZlU291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVTb3VyY2UudGl0bGU7XG4gICAgICAgIGNvbnN0IGhhc1NpbmdsZVNvdXJjZSA9IHNvdXJjZXMubGVuZ3RoID09PSAxO1xuICAgICAgICBjb25zdCBkcm9wZG93biA9IChoKFwiY2FsY2l0ZS1kcm9wZG93blwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgW0NTUy5tYXJrZXJTZWxlY3Rpb25Ecm9wZG93bl06IHRydWVcbiAgICAgICAgICAgIH0sIGhpZGRlbjogaGFzU2luZ2xlU291cmNlLCBtYXhJdGVtczogNywgb25DYWxjaXRlRHJvcGRvd25TZWxlY3Q6IHRoaXMuX29uU3ltYm9sU291cmNlQ2hhbmdlLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiYWJzb2x1dGVcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhbGlnbm1lbnQ6IFwic3BhY2UtYmV0d2VlblwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvbkVuZDogXCJjaGV2cm9uLWRvd25cIiwgc2NhbGU6IFwibVwiLCBzbG90OiBcInRyaWdnZXJcIiwgd2lkdGg6IFwiZnVsbFwiIH0sIGFjdGl2ZVNvdXJjZVRpdGxlKSwgdGhpcy5fcmVuZGVyU3ltYm9sU291cmNlT3B0aW9ucyhzb3VyY2VzLCB0aGlzLl9hY3RpdmVTb3VyY2VJZCkpKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiLCBrZXk6IFwiaGVhZGVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgIXRoaXMuaGlkZUhlYWRlciA/IHRoaXMubWVzc2FnZXMuY2F0ZWdvcnkgOiBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5jYXRlZ29yaWVzIH0sIGRyb3Bkb3duLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBhY3RpdmU6IHRoaXMuaXNHcmlkVmlldywgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uOiBcImdyaWRcIiwgc2NhbGU6IFwic1wiLCBjbGFzczogQ1NTLmNhdGVnb3JpZXNDZW50ZXJBY3Rpb24sIHRleHQ6IHRoaXMubWVzc2FnZXMuZ3JpZFZpZXcsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzR3JpZFZpZXcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuZWwpO1xuICAgICAgICAgICAgfSB9KSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgYWN0aXZlOiAhdGhpcy5pc0dyaWRWaWV3LCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGljb246IFwibGlzdFwiLCBpY29uRmxpcFJ0bDogdHJ1ZSwgc2NhbGU6IFwic1wiLCB0ZXh0OiB0aGlzLm1lc3NhZ2VzLmxpc3RWaWV3LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0dyaWRWaWV3ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5lbCk7XG4gICAgICAgICAgICB9IH0pKSkpKTtcbiAgICB9XG4gICAgX3JlbmRlckl0ZW1TZWxlY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsLCBtZXNzYWdlczogbWVyZ2VkU3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZmV0Y2hpbmdTeW1ib2xJdGVtcyA9IHRoaXMuX2FjdGl2ZVN5bWJvbEZldGNoO1xuICAgICAgICBjb25zdCBlZmZlY3RpdmVQb3J0YWwgPSBpc0ludGVyY2VwdG9yKHBvcnRhbCkgPyBwb3J0YWwucG9ydGFsIDogcG9ydGFsO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFtDU1Muc2Nyb2xsZXJdOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1MubWFya2VyU2VsZWN0aW9uXTogdHJ1ZVxuICAgICAgICAgICAgfSwga2V5OiBcImdhbGxlcnlcIiB9LCBmZXRjaGluZ1N5bWJvbEl0ZW1zID8gKGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiBcIlwiIH0pKSA6IHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zLmxlbmd0aCA9PT0gMCAmJiB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiID8gKGgoXCJhcmNnaXMtc3ltYm9sLXBpY2tlci1maWxlLXVwbG9hZFwiLCB7IHBvcnRhbDogZWZmZWN0aXZlUG9ydGFsLCBzdHJpbmdzOiBtZXJnZWRTdHJpbmdzIH0pKSA6IHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zLmxlbmd0aCA+IDAgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuaXRlbVBhbGV0dGUsIGtleTogdGhpcy5fYWN0aXZlU3ltYm9sSXRlbXMubGVuZ3RoIH0sIHRoaXMuaXNHcmlkVmlldyA/IHRoaXMuX3JlbmRlckdyaWRWaWV3KCkgOiB0aGlzLl9yZW5kZXJMaXN0VmlldygpLCB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiICYmIChoKFwiYXJjZ2lzLXN5bWJvbC1waWNrZXItZmlsZS11cGxvYWRcIiwgeyBjbGFzczogQ1NTLmZpbGVVcGxvYWQsIHBvcnRhbDogZWZmZWN0aXZlUG9ydGFsLCBzdHJpbmdzOiBtZXJnZWRTdHJpbmdzIH0pKSkpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmVtcHR5Q2F0ZWdvcnlDb250ZW50IH0sIHRoaXMubWVzc2FnZXMubm9TeW1ib2xzQXZhaWxhYmxlKSkpKTtcbiAgICB9XG4gICAgX3JlbmRlckdyaWRWaWV3KCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS1wYWxldHRlXCIsIHsga2V5OiB0aGlzLl9hY3RpdmVTb3VyY2VJZCwgaXRlbXM6IHRoaXMuX2FjdGl2ZVN5bWJvbEl0ZW1zLm1hcCgoaXRlbSwgaW5kZXgpID0+ICh7XG4gICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICBvYnNlcnZlcjogdGhpcy5fc3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXJcbiAgICAgICAgICAgIH0pKSwgSXRlbVJlbmRlcmVyOiBNYXJrZXJJdGVtLCBpdGVtc1BlclJvdzogdGhpcy5pdGVtc1BlclJvdywgc2VsZWN0ZWQ6ICh7IGl0ZW0gfSkgPT4geyB2YXIgX2E7IHJldHVybiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGEpID09PSAoKF9hID0gdGhpcy5hY3RpdmVTeW1ib2xJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGF0YSk7IH0sIG9uQXJjZ2lzSXRlbVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBkZXRhaWw6IHsgaXRlbSB9IH0gPSBldmVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMganVzdCBmb3IgdGhlIFVJIHRvIHJlbWVtYmVyIHdoaWNoIGVsZW1lbnQgaXMgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbEl0ZW1DaGFuZ2UuZW1pdChpdGVtKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0gPSBpdGVtO1xuICAgICAgICAgICAgICAgIC8vIFNlbmQgYmFjayB0aGUgYWN0dWFsIHN5bWJvbDpcbiAgICAgICAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAgICAgICAgIC5nZXRTeW1ib2woKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoc3ltYm9sKSA9PiB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbENoYW5nZS5lbWl0KHN5bWJvbCkpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuaXRlbVBhbGV0dGVOb2RlID0gbm9kZSkgfSkpO1xuICAgIH1cbiAgICBfcmVuZGVyTGlzdFZpZXcoKSB7XG4gICAgICAgIGNvbnN0IGlzUnRsID0gZ2V0RWxlbWVudERpcih0aGlzLmVsKSA9PT0gXCJydGxcIjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0XCIsIHsga2V5OiB0aGlzLl9hY3RpdmVTb3VyY2VJZCB9LCB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogaW5kZXgsIGxhYmVsOiBpdGVtLmRhdGEudGl0bGUgfHwgaXRlbS5kYXRhLm5hbWUsIHZhbHVlOiBpbmRleCwgc2VsZWN0ZWQ6ICgoX2EgPSB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kYXRhLm5hbWUpID09PSBpdGVtLmRhdGEubmFtZSwgb25DYWxjaXRlTGlzdEl0ZW1TZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSB0aGlzLl9hY3RpdmVTeW1ib2xJdGVtc1tub2RlLnZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBqdXN0IGZvciB0aGUgVUkgdG8gcmVtZW1iZXIgd2hpY2ggZWxlbWVudCBpcyBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0FjdGl2ZVN5bWJvbEl0ZW1DaGFuZ2UuZW1pdChzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0gPSBzZWxlY3RlZEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgYmFjayB0aGUgYWN0dWFsIHN5bWJvbDpcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U3ltYm9sKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChzeW1ib2wpID0+IHRoaXMuYXJjZ2lzQWN0aXZlU3ltYm9sQ2hhbmdlLmVtaXQoc3ltYm9sKSk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1zdGFydFwiLCBrZXk6IGl0ZW0uZGF0YS5uYW1lLCByZWY6IChkaXZOb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXZOb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmdldFRodW1ibmFpbChkaXZOb2RlKS50aGVuKChhcHBlbmRUaHVtYm5haWwpID0+IGFwcGVuZFRodW1ibmFpbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZ2V0U3ltYm9sKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IH0pLCB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJjdXN0b20tc3ltYm9sLXNldFwiICYmIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgdGV4dDogdGhpcy5tZXNzYWdlcy5yZW1vdmVTeW1ib2wsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uRWxzW2luZGV4XSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ3VzdG9tU3ltYm9sKGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5lbCk7XG4gICAgICAgICAgICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+IHRoaXMuYWRkVG9vbHRpcCh7XG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuYWN0aW9uRWxzW2luZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50OiBpc1J0bCA/IFwicmlnaHQtc3RhcnRcIiA6IFwibGVmdC1zdGFydFwiLFxuICAgICAgICAgICAgICAgICAgICBpbm5lckhUTUw6IHRoaXMubWVzc2FnZXMucmVtb3ZlU3ltYm9sXG4gICAgICAgICAgICAgICAgfSksIG9uTW91c2VPdXQ6ICgpID0+IHRoaXMucmVtb3ZlVG9vbHRpcCgpIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwieFwiIH0pKSkpKTtcbiAgICAgICAgfSkpKTtcbiAgICB9XG4gICAgdXBkYXRlTGlzdFNlbGVjdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ1cGRhdGVMaXN0U2VsZWN0aW9uXCIpO1xuICAgICAgICB0aGlzLmVsXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIkNBTENJVEUtTElTVC1JVEVNXCIpXG4gICAgICAgICAgICAuZm9yRWFjaCgobGlzdEl0ZW0pID0+IHtcbiAgICAgICAgICAgIGxpc3RJdGVtLnNlbGVjdGVkID0gbGlzdEl0ZW0udmFsdWUgPT09IHRoaXMuYWN0aXZlU3ltYm9sSXRlbS5kYXRhLm5hbWU7XG4gICAgICAgICAgICBpZiAobGlzdEl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBsaXN0SXRlbS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVtb3ZlQ3VzdG9tU3ltYm9sKGluZGV4KSB7XG4gICAgICAgIHRoaXMuYWxsQ3VzdG9tRmlsZUluZm9zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHNldExvY2FsU3RvcmFnZUl0ZW0odGhpcy5jdXN0b21TeW1ib2xzU3RvcmFnZUlkLCB0aGlzLmFsbEN1c3RvbUZpbGVJbmZvcy5tYXAoKGluZm8pID0+IGluZm8uZGF0YVVSTCA/IGluZm8gOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGluZm8pLCB7IGNpbTogSlNPTi5zdHJpbmdpZnkoaW5mby5jaW0udG9KU09OKCkpIH0pKSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuX3NldHVwQ3VzdG9tU3ltYm9scygpO1xuICAgICAgICB0aGlzLmFjdGl2ZVN5bWJvbEl0ZW0gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFkZFRvb2x0aXAocHJvcHMpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XG4gICAgICAgIHRoaXMudG9vbHRpcEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtdG9vbHRpcFwiKTtcbiAgICAgICAgdGhpcy50b29sdGlwRWwucGxhY2VtZW50ID0gcHJvcHMucGxhY2VtZW50IHx8IFwiYXV0b1wiO1xuICAgICAgICB0aGlzLnRvb2x0aXBFbC5yZWZlcmVuY2VFbGVtZW50ID0gcHJvcHMucmVmZXJlbmNlRWxlbWVudDtcbiAgICAgICAgdGhpcy50b29sdGlwRWwub3ZlcmxheVBvc2l0aW9uaW5nID0gXCJmaXhlZFwiO1xuICAgICAgICB0aGlzLnRvb2x0aXBFbC5pbm5lckhUTUwgPSBwcm9wcy5pbm5lckhUTUw7XG4gICAgICAgIHRoaXMudG9vbHRpcEVsLm9wZW4gPSB0cnVlO1xuICAgICAgICAvLyBpdCB3b24ndCBzaG93IGlmIGp1c3QgYWRkZWQgdG8gdGhpcy5lbFxuICAgICAgICB0aGlzLmVsLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50b29sdGlwRWwpO1xuICAgIH1cbiAgICByZW1vdmVUb29sdGlwKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICgoX2EgPSB0aGlzLnRvb2x0aXBFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50b29sdGlwRWwpO1xuICAgICAgICAgICAgdGhpcy50b29sdGlwRWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBbLCBbc3RyaW5nc11dID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgZXNyaU1vZHVsZXMubG9hZCgpLFxuICAgICAgICAgICAgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKVxuICAgICAgICBdKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IHN0cmluZ3M7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fc3ltYm9sU291cmNlcykge1xuICAgICAgICAgICAgdGhpcy5fZmV0Y2hTb3VyY2VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZ2V0Q3VzdG9tU3ltYm9sc0Zyb21TdG9yYWdlKCk7XG4gICAgfVxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICB0aGlzLnNldFVwU3ltYm9sSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcbiAgICAgICAgKF9hID0gdGhpcy5fYWN0aXZlU3ltYm9sRmV0Y2gpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb250cm9sbGVyLmFib3J0KCk7XG4gICAgICAgIChfYiA9IHRoaXMuX3NvdXJjZXNGZXRjaENvbnRyb2xsZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hYm9ydCgpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy50ZWFyRG93blN5bWJvbEludGVyc2VjdGlvbk9ic2VydmVyKCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IHRoaXMuX3N5bWJvbFNvdXJjZXM7XG4gICAgICAgIGNvbnN0IGZldGNoaW5nU3ltYm9sSXRlbXMgPSB0aGlzLl9hY3RpdmVTeW1ib2xGZXRjaDtcbiAgICAgICAgaWYgKCFzb3VyY2VzIHx8IGZldGNoaW5nU3ltYm9sSXRlbXMpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuY29udGFpbmVyIH0sIGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiBcIlwiIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWN0aXZlU291cmNlSXNTTVMgPSB0aGlzLl9hY3RpdmVTb3VyY2VJZCA9PT0gXCJiYXNpYy1zeW1ib2wtc2V0XCIgfHwgdGhpcy5fYWN0aXZlU291cmNlSWQgPT09IFwiY3VzdG9tLXN5bWJvbC1zZXRcIjtcbiAgICAgICAgY29uc3QgYWN0aXZlU291cmNlID0gdGhpcy5fc3ltYm9sU291cmNlcy5maW5kKChzb3VyY2UpID0+IHNvdXJjZS5pZCA9PT0gdGhpcy5fYWN0aXZlU291cmNlSWQpO1xuICAgICAgICBjb25zdCBtb2Rlcm5TeW1ib2xDYXRlZ29yeVNlbGVjdGVkID0gIWFjdGl2ZVNvdXJjZUlzU01TICYmIChhY3RpdmVTb3VyY2UgPT09IG51bGwgfHwgYWN0aXZlU291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVTb3VyY2UudHlwZSkgIT09IFwic3ltYm9sLXNldFwiO1xuICAgICAgICBjb25zdCBhZG9iZVN5bWJvbENhdGVnb3J5U2VsZWN0ZWQgPSBhY3RpdmVTb3VyY2UgPT09IG51bGwgfHwgYWN0aXZlU291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVTb3VyY2Uua2V5d29yZHMuaW5jbHVkZXMoXCJBZG9iZVwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5jb250YWluZXIgfSwgdGhpcy5fcmVuZGVyU291cmNlU2VsZWN0aW9uKCksIHRoaXMuX3JlbmRlckl0ZW1TZWxlY3Rpb24oKSwgYWRvYmVTeW1ib2xDYXRlZ29yeVNlbGVjdGVkID8gKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IG9wZW46IHRydWUsIGtpbmQ6IFwiZGFuZ2VyXCIsIGtleTogXCJjb3B5cmlnaHRcIiwgc2NhbGU6IFwic1wiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiwgaW5uZXJIVE1MOiB0aGlzLm1lc3NhZ2VzLmFkb2JlQ29weXJpZ2h0LnJlcGxhY2UoXCIke3llYXJ9XCIsIFwiMjAyMlwiKSB9KSkpIDogbnVsbCwgbW9kZXJuU3ltYm9sQ2F0ZWdvcnlTZWxlY3RlZCAmJlxuICAgICAgICAgICAgdGhpcy5zeW1ib2xUeXBlICE9PSBcIjNkXCIgJiZcbiAgICAgICAgICAgICFnZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5cy5BUkNHSVNfQ09NUE9ORU5UX05PVElGSUNBVElPTlMsIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLklOQ09NUEFUSUJMRV9WRUNUT1JfU1lNQk9MU19ESVNNSVNTRUQpID8gKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IG9wZW46IHRydWUsIGNsYXNzOiBDU1MuaW5jb21wYXRpYmxlU3ltYm9sc05vdGljZSwgY2xvc2FibGU6IHRydWUsIGljb246IHRydWUsIGtleTogXCJpbmNvbXBhdGlibGUtc3ltYm9sc1wiLCBvbkNhbGNpdGVOb3RpY2VDbG9zZTogdGhpcy5vbkluY29tcGF0aWJsZVZlY3RvclN5bWJvbHNEaXNtaXNzLCBzY2FsZTogXCJzXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIHRoaXMubWVzc2FnZXMuaW5jb21wYXRpYmxlU3ltYm9sV2FybmluZykpKSA6IG51bGwsIHRoaXMuY3VzdG9tU3ltYm9sRXJyb3IgPyAoaChcImNhbGNpdGUtbm90aWNlXCIsIHsgb3BlbjogdHJ1ZSwgY2xhc3M6IENTUy5pbmNvbXBhdGlibGVTeW1ib2xzTm90aWNlLCBjbG9zYWJsZTogdHJ1ZSwgaWNvbjogXCJleGNsYW1hdGlvbi1tYXJrLWNpcmNsZVwiLCBraW5kOiBcImRhbmdlclwiLCBrZXk6IFwibGFyZ2Utc3ltYm9sXCIsIG9uQ2FsY2l0ZU5vdGljZUNsb3NlOiAoKSA9PiAodGhpcy5jdXN0b21TeW1ib2xFcnJvciA9IHVuZGVmaW5lZCksIHNjYWxlOiBcInNcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9PT0gXCJ0b28tbGFyZ2VcIlxuICAgICAgICAgICAgPyB0aGlzLm1lc3NhZ2VzLmN1c3RvbVN5bWJvbEVycm9ycy50b29MYXJnZVxuICAgICAgICAgICAgOiB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID09PSBcImludmFsaWQtZmlsZVwiXG4gICAgICAgICAgICAgICAgPyB0aGlzLm1lc3NhZ2VzLmN1c3RvbVN5bWJvbEVycm9ycy5pbnZhbGlkRmlsZVxuICAgICAgICAgICAgICAgIDogdGhpcy5jdXN0b21TeW1ib2xFcnJvciA9PT0gXCJzdG9yYWdlLWZ1bGxcIlxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMubWVzc2FnZXMuY3VzdG9tU3ltYm9sRXJyb3JzLm91dE9mU3BhY2VcbiAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmN1c3RvbVN5bWJvbEVycm9yID09PSBcImVycm9yXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5tZXNzYWdlcy5jdXN0b21TeW1ib2xFcnJvcnMuZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkKSkpIDogbnVsbCkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJfYWN0aXZlU291cmNlSWRcIjogW1wiaGFuZGxlQWN0aXZlU291cmNlSXRlbUlkQ2hhbmdlc1wiXVxuICAgIH07IH1cbn07XG5BcmNnaXNTeW1ib2xQaWNrZXIuc3R5bGUgPSBhcmNnaXNTeW1ib2xQaWNrZXJDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1N5bWJvbFBpY2tlciBhcyBhcmNnaXNfc3ltYm9sX3BpY2tlciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtc3ltYm9sLXBpY2tlci5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGUgYXMgZXNyaU1vZHVsZXMgfSBmcm9tICcuL3N5bWJvbFV0aWxzLWYyMDdkOTc5LmpzJztcblxuLy8gd2UgYWxsb3cgdXNlcnMgdG8gZW50ZXIgMSBkZWNpbWFsIGFzIGEgdHJhbnNwYXJlbmN5ICUgdmFsdWVcbmNvbnN0IGFscGhhVG9UcmFuc3BhcmVuY3kgPSAoYWxwaGEpID0+IE51bWJlcigoKDEgLSBhbHBoYSkgKiAxMDApLnRvRml4ZWQoMSkpO1xuY29uc3QgdHJhbnNwYXJlbmN5VG9BbHBoYSA9ICh0cmFuc3BhcmVuY3kpID0+IE51bWJlcigoMSAtIHRyYW5zcGFyZW5jeSAvIDEwMCkudG9GaXhlZCgzKSk7XG5jb25zdCBudWxsRXF1aXZhbGVudENvbG9yID0gWzAsIDAsIDAsIDBdO1xuZnVuY3Rpb24gY3JlYXRlKGNvbG9yLCBqc29uID0gZmFsc2UpIHtcbiAgICBjb25zdCBjb2xvclRvQ3JlYXRlID0gY29sb3IgIT09IG51bGwgJiYgY29sb3IgIT09IHZvaWQgMCA/IGNvbG9yIDogbnVsbEVxdWl2YWxlbnRDb2xvcjtcbiAgICByZXR1cm4ganNvbiA/IGVzcmlNb2R1bGVzLkNvbG9yLmZyb21KU09OKGNvbG9yVG9DcmVhdGUpIDogbmV3IGVzcmlNb2R1bGVzLkNvbG9yKGNvbG9yVG9DcmVhdGUpO1xufVxuZnVuY3Rpb24gaXNOdWxsRXF1aXZhbGVudENvbG9yKHsgciwgZywgYiwgYSB9KSB7XG4gICAgcmV0dXJuIHIgPT09IDAgJiYgZyA9PT0gMCAmJiBiID09PSAwICYmIGEgPT09IDA7XG59XG5cbmV4cG9ydCB7IGFscGhhVG9UcmFuc3BhcmVuY3kgYXMgYSwgY3JlYXRlIGFzIGMsIGlzTnVsbEVxdWl2YWxlbnRDb2xvciBhcyBpLCB0cmFuc3BhcmVuY3lUb0FscGhhIGFzIHQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29sb3ItMTY3OTFiNDUuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgICBbXCJhclwiLCBcImFyXCJdLFxuICAgIFtcImJnXCIsIFwiYmdcIl0sXG4gICAgW1wiYnNcIiwgXCJic1wiXSxcbiAgICBbXCJjYVwiLCBcImNhXCJdLFxuICAgIFtcImNzXCIsIFwiY3NcIl0sXG4gICAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgICBbXCJkZVwiLCBcImRlXCJdLFxuICAgIFtcImVsXCIsIFwiZWxcIl0sXG4gICAgW1wiZW5cIiwgXCJlblwiXSxcbiAgICBbXCJlc1wiLCBcImVzXCJdLFxuICAgIFtcImV0XCIsIFwiZXRcIl0sXG4gICAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgICBbXCJmclwiLCBcImZyXCJdLFxuICAgIFtcImhlXCIsIFwiaGVcIl0sXG4gICAgW1wiaHJcIiwgXCJoclwiXSxcbiAgICBbXCJodVwiLCBcImh1XCJdLFxuICAgIFtcImlkXCIsIFwiaWRcIl0sXG4gICAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgICBbXCJqYVwiLCBcImphXCJdLFxuICAgIFtcImtvXCIsIFwia29cIl0sXG4gICAgW1wibHRcIiwgXCJsdFwiXSxcbiAgICBbXCJsdlwiLCBcImx2XCJdLFxuICAgIFtcIm5iXCIsIFwibmJcIl0sXG4gICAgW1wibmxcIiwgXCJubFwiXSxcbiAgICBbXCJwbFwiLCBcInBsXCJdLFxuICAgIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gICAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgICBbXCJyb1wiLCBcInJvXCJdLFxuICAgIFtcInJ1XCIsIFwicnVcIl0sXG4gICAgW1wic2tcIiwgXCJza1wiXSxcbiAgICBbXCJzbFwiLCBcInNsXCJdLFxuICAgIFtcInNyXCIsIFwic3JcIl0sXG4gICAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgICBbXCJ0aFwiLCBcInRoXCJdLFxuICAgIFtcInRyXCIsIFwidHJcIl0sXG4gICAgW1widWtcIiwgXCJ1a1wiXSxcbiAgICBbXCJ2aVwiLCBcInZpXCJdLFxuICAgIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gICAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICAgIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmIChhcGkgPT09IDQpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgICAgICAgIHBsYWNlcyxcbiAgICAgICAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgICB9XG4gICAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICAgIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcGxhY2VzLFxuICAgICAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICAgIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICAgIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgICAgIGRheTogXCJudW1lcmljXCJcbiAgICB9O1xuICAgIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICAgICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuZnVuY3Rpb24gZm9ybWF0UGx1cmFsKGxhbmcsIHN0cmluZ09iaiwgbnVtYmVyKSB7XG4gICAgY29uc3Qgc2luZ2xlcyA9IFtcImlkXCIsIFwiamFcIiwgXCJrb1wiLCBcInRoXCIsIFwidmlcIiwgXCJ6aC1jblwiLCBcInpoLWhrXCIsIFwiemgtdHdcIl07XG4gICAgY29uc3QgbGlrZUVuZ2xpc2ggPSBbXG4gICAgICAgIFwiZW5cIixcbiAgICAgICAgXCJjYVwiLFxuICAgICAgICBcImRhXCIsXG4gICAgICAgIFwiZGVcIixcbiAgICAgICAgXCJlbFwiLFxuICAgICAgICBcImVzXCIsXG4gICAgICAgIFwiZXRcIixcbiAgICAgICAgXCJmaVwiLFxuICAgICAgICBcImhpXCIsXG4gICAgICAgIFwiaHVcIixcbiAgICAgICAgXCJpdFwiLFxuICAgICAgICBcIm5iXCIsXG4gICAgICAgIFwibmxcIixcbiAgICAgICAgXCJwdC1wdFwiLFxuICAgICAgICBcInN2XCIsXG4gICAgICAgIFwidHJcIlxuICAgIF07XG4gICAgY29uc3QgbG9jYWxlID0gbGFuZyAhPT0gbnVsbCAmJiBsYW5nICE9PSB2b2lkIDAgPyBsYW5nIDogXCJlblwiO1xuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgb25lLCBvciBpdCBpcyBhIFwic2ltcGxlXCIgbGFuZ3VhZ2UsIHJldHVybiB0aGUgMSBzdHJpbmdcbiAgICBpZiAobnVtYmVyID09PSAxIHx8IHNpbmdsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLnNpbmdsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIFwiMVwiKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBub3QgMSBhbmQgdGhlIGxhbmd1YWdlIHVzZXMgdGhlIHNhbWUgcGx1cmFsaXphdGlvbiBzdHJhdGVneSBhcyBlbmdsaXNoLFxuICAgIC8vIHJldHVybiB0aGUgbXVsdGlwbGUgc3RyaW5nXG4gICAgaWYgKG51bWJlciAhPT0gMSAmJiBsaWtlRW5nbGlzaC5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmoubXVsdGlwbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG4gICAgfVxuICAgIC8vIGlmIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmtlZCwgcmV0dXJuIHRoZSBcInVua25vd25cIiBzdHJpbmdcbiAgICByZXR1cm4gc3RyaW5nT2JqLnVua25vd24ucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0UGx1cmFsIGFzIGIsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xudmFyIGxvY2FsU3RvcmFnZUtleXM7XG4oZnVuY3Rpb24gKGxvY2FsU3RvcmFnZUtleXMpIHtcbiAgICBsb2NhbFN0b3JhZ2VLZXlzW1wiQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TXCJdID0gXCJhcmNnaXNDb21wb25lbnRfbm90aWZpY2F0aW9uc1wiO1xufSkobG9jYWxTdG9yYWdlS2V5cyB8fCAobG9jYWxTdG9yYWdlS2V5cyA9IHt9KSk7XG52YXIgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXM7XG4oZnVuY3Rpb24gKGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzKSB7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJGRUFUVVJFX1JFRFVDVElPTl9XQVJOSU5HX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2ZlYXR1cmVfcmVkdWN0aW9uX3dhcm5pbmdfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJQT1BVUF9XQVJOSU5HX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3BvcHVwX3dhcm5pbmdfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJJTkNPTVBBVElCTEVfVkVDVE9SX1NZTUJPTFNfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfc3ltYm9sX3N0eWxlcl9pbmNvbXBhdGlibGVfdmVjdG9yX3N5bWJvbHNfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJFRkZFQ1RTX1RJUF9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19lZmZlY3RzX3RpcF9kaXNtaXNzZWRcIjtcbiAgICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkxBWUVSX1ZJRVdfREVGSU5JVElPTl9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19sYXllcl92aWV3X2RlZmluaXRpb25fZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJMQVlFUl9PVkVSUklERV9TVEFUVVNfVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2xheWVyX292ZXJyaWRlX3N0YXR1c190aXBfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJTTUFSVF9NQVBQSU5HX1RJUDFfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfc21hcnRfbWFwcGluZ190aXAxX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiU01BUlRfTUFQUElOR19USVAyX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3NtYXJ0X21hcHBpbmdfdGlwMl9kaXNtaXNzZWRcIjtcbiAgICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIkxBWUVSX1ZJRVdfSk9JTl9USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfbGF5ZXJfdmlld19qb2luX3RpcF9kaXNtaXNzZWRcIjtcbiAgICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIk1VTFRJRElNRU5TSU9OQUxfSU5GT19USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfbXVsdGlkaW1lbnNpb25hbF9pbmZvX3RpcF9kaXNtaXNzZWRcIjtcbn0pKGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzIHx8IChhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cyA9IHt9KSk7XG5jb25zdCBnZXRMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5KSA9PiB7XG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFnZUtleSk7XG59O1xuY29uc3Qgc2V0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSwgdmFsdWUpID0+IHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhZ2VLZXksIHZhbHVlKTtcbn07XG5jb25zdCBnZXRPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5KSA9PiB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZ2V0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSkpIHx8IHt9O1xufTtcbmNvbnN0IHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSA9IChsb2NhbFN0b3JhZ2VLZXksIGtleVZhbHVlT2JqZWN0KSA9PiB7XG4gICAgY29uc3Qgc2V0TG9jYWxTdG9yYWdlVmFsID0gZ2V0T2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSk7XG4gICAgc2V0TG9jYWxTdG9yYWdlVmFsW2tleVZhbHVlT2JqZWN0LmtleV0gPSBrZXlWYWx1ZU9iamVjdC52YWx1ZTtcbiAgICBzZXRMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShzZXRMb2NhbFN0b3JhZ2VWYWwpKTtcbn07XG5jb25zdCBnZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5LCBvYmplY3RLZXkpID0+IHtcbiAgICBjb25zdCBnZXRMb2NhbFN0b3JhZ2VWYWwgPSBnZXRPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5KTtcbiAgICBpZiAoZ2V0TG9jYWxTdG9yYWdlVmFsID09PSBudWxsIHx8IGdldExvY2FsU3RvcmFnZVZhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ2V0TG9jYWxTdG9yYWdlVmFsLmhhc093blByb3BlcnR5KG9iamVjdEtleSkpIHtcbiAgICAgICAgcmV0dXJuIGdldExvY2FsU3RvcmFnZVZhbFtvYmplY3RLZXldO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufTtcblxuZXhwb3J0IHsgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMgYXMgYSwgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlIGFzIGcsIGxvY2FsU3RvcmFnZUtleXMgYXMgbCwgc2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYWxTdG9yYWdlLTljNGU3YTNhLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZSBhcyBlc2NhcGVSZWdFeHAgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuXG4vLyBpbXBvcnQgc3RyaW5nVXRpbCBmcm9tIFwiLi9zdHJpbmdzXCI7XG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHN0b3JhZ2Ugb2YgdmFyaW91cyBmb3JtcyAoY29va2llcywgbG9jYWwgc3RvcmFnZSwgYW5kIHNlc3Npb24gc3RvcmFnZSkuXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZShuYW1lLCBjb29raWUsIHByb3BlcnRpZXMsIHN0cmluZ2lmeSkge1xuICAgIHdyaXRlQ29va2llKG5hbWUsIHN0cmluZ2lmeSA/IEpTT04uc3RyaW5naWZ5KGNvb2tpZSkgOiBjb29raWUsIHByb3BlcnRpZXMpO1xufVxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUsIHBhcnNlKSB7XG4gICAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgICByZXR1cm4gY29va2llICYmIHBhcnNlID8gSlNPTi5wYXJzZShjb29raWUpIDogY29va2llO1xufVxuZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBpdGVtLCBzdHJpbmdpZnkpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgcGFyc2UpIHtcbiAgICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICAgIHJldHVybiBpdGVtICYmIHBhcnNlID8gSlNPTi5wYXJzZShpdGVtKSA6IGl0ZW07XG59XG5mdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldFNlc3Npb25TdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gcmVhZENvb2tpZShuYW1lKSB7XG4gICAgY29uc3QgY29va2llID0gZG9jdW1lbnQuY29va2llO1xuICAgIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgICBjb25zdCBtYXRjaGVkQ29va2llcyA9IGNvb2tpZS5tYXRjaChjb29raWVOYW1lUkUpO1xuICAgIHJldHVybiBtYXRjaGVkQ29va2llcyA/IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVkQ29va2llc1sxXSkgOiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiB3cml0ZUNvb2tpZShuYW1lLCB2YWx1ZSwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGxldCBleHBpcmVzID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLmV4cGlyZXM7XG4gICAgaWYgKHR5cGVvZiBleHBpcmVzID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShEYXRlLm5vdygpICsgZGF5c0Zyb21Ub2RheUluTXMpO1xuICAgICAgICBleHBpcmVzID0gcHJvcGVydGllcy5leHBpcmVzID0gZXhwaXJhdGlvbkRhdGU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmV4cGlyZXMgPSBleHBpcmVzLnRvVVRDU3RyaW5nKCk7XG4gICAgfVxuICAgIGxldCBjb29raWUgPSBgJHtuYW1lfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSl9YDtcbiAgICBsZXQgcHJvcGVydHk7XG4gICAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGNvb2tpZSArPSBgOyAke3Byb3BlcnR5fWA7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZTtcbn1cblxuZXhwb3J0IHsgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGEsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBiLCBnZXRDb29raWUgYXMgYywgc2V0Q29va2llIGFzIGQsIGdldExvY2FsU3RvcmFnZUl0ZW0gYXMgZywgc2V0TG9jYWxTdG9yYWdlSXRlbSBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0b3JhZ2UtMDM1M2E3NjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9