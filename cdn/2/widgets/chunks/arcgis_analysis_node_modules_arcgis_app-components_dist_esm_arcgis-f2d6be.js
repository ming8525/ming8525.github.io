"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categorize-items.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categorize-items.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_categorize_items: () => (/* binding */ ArcgisCategorizeItems)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./categories-ca134005.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _types_a031c1da_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./types-a031c1da.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */

















const getItemCategorySelectionState = (items) => {
    const categorySelectionState = {};
    items.forEach(({ categories, id }) => {
        categories.forEach((categoryPath) => {
            if (!categorySelectionState[categoryPath]) {
                categorySelectionState[categoryPath] = [];
            }
            categorySelectionState[categoryPath].push(id);
        });
    });
    return categorySelectionState;
};

const arcgisCategorizeItemsCss = ".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px;z-index:900}.category-picker-container{margin-top:0.5rem}";

const ArcgisCategorizeItems = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisCategorizeItemsCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisCategorizeItemsCancel", 7);
        this.arcgisCategorizeItemsSubmit = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisCategorizeItemsSubmit", 7);
        this.closeDialog = () => {
            this.arcgisCategorizeItemsCancel.emit();
        };
        this.handleCategorySelected = ({ paths, selected }) => {
            const { itemIds, itemToCategoriesLookup } = this;
            const categorySelectionCountMap = Object.assign({}, this.categorySelectionCountMap);
            paths.forEach((path) => {
                categorySelectionCountMap[path] = selected ? [...itemIds] : [];
            });
            itemIds.forEach((itemId) => {
                if (!itemToCategoriesLookup[itemId]) {
                    itemToCategoriesLookup[itemId] = [];
                }
                const curTarget = itemToCategoriesLookup[itemId];
                // Might contain duplicate but that's fine since when we remove it, we're using filter
                itemToCategoriesLookup[itemId] = selected
                    ? [...curTarget, ...paths]
                    : curTarget.filter((ele) => !paths.includes(ele));
            });
            if (selected) {
                // We need to traverse the category tree and remove the selection of parents of `paths`
                //  since we only want to select the leaf nodes
                const pathsToRemove = paths.reduce((acc, cur) => {
                    let curPath = "";
                    cur
                        .split("/")
                        .filter(Boolean)
                        .forEach((part) => {
                        curPath = `${curPath}/${part}`;
                        curPath !== cur && acc.push(curPath);
                    });
                    return acc;
                }, []);
                pathsToRemove.forEach((path) => {
                    categorySelectionCountMap[path] = [];
                });
                itemIds.forEach((itemId) => {
                    const curTarget = itemToCategoriesLookup[itemId];
                    itemToCategoriesLookup[itemId] = curTarget.filter((ele) => !pathsToRemove.includes(ele));
                });
            }
            // Gotta do this to trigger state change
            this.categorySelectionCountMap = categorySelectionCountMap;
        };
        this.handleItemCategoryChange = (itemId, newCategories) => {
            const { itemToCategoriesLookup, categorySelectionCountMap, rootCategoryPath } = this;
            const prevSelectedCategories = itemToCategoriesLookup[itemId];
            const newCategoriesToCheck = newCategories.map((ele) => ele.startsWith(rootCategoryPath) ? ele : `${rootCategoryPath}${ele}`);
            if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.f)(prevSelectedCategories, newCategoriesToCheck)) {
                return;
            }
            // Remove old categories
            prevSelectedCategories.forEach((category) => {
                const curTarget = categorySelectionCountMap[category];
                categorySelectionCountMap[category] = (curTarget !== null && curTarget !== void 0 ? curTarget : []).filter((ele) => ele !== itemId);
            });
            // Add new categories
            newCategoriesToCheck.forEach((category) => {
                const curTarget = categorySelectionCountMap[category];
                categorySelectionCountMap[category] = [...(curTarget !== null && curTarget !== void 0 ? curTarget : []), itemId];
            });
            // Update item to categories lookup
            itemToCategoriesLookup[itemId] = [...newCategoriesToCheck];
            // Gotta do this to trigger state change
            this.categorySelectionCountMap = Object.assign({}, categorySelectionCountMap);
        };
        this.updateCategory = async () => {
            const { itemIds, portal, itemToCategoriesLookup, i18n } = this;
            this.isLoading = true;
            const { result, error } = await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.u)({
                categories: itemToCategoriesLookup,
                itemIds,
                portal
            });
            this.isLoading = false;
            // TODO: handle error
            if (result && !error) {
                this.arcgisCategorizeItemsSubmit.emit(itemToCategoriesLookup);
                this.hasUnsavedChanges = false;
                return;
            }
            this.error = i18n.errorMessage;
        };
        this.checkHasChange = () => {
            const { itemIds, itemToCategoriesLookup, initialItemToCategoriesLookup } = this;
            this.hasUnsavedChanges =
                !!itemToCategoriesLookup &&
                    !!initialItemToCategoriesLookup &&
                    itemIds.some((itemId) => !(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.f)(itemToCategoriesLookup[itemId], initialItemToCategoriesLookup[itemId]));
        };
        this.renderItemCard = (item) => {
            const { portal, user, config, itemToCategoriesLookup, handleItemCategoryChange, categorySchema, rootCategoryPath } = this;
            const selectedCategories = itemToCategoriesLookup[item.id];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card", { key: item.id, item: item, portal: portal, user: user, baseUrl: config.baseUrl, showItemType: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end", class: "category-picker-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-categories-picker", { portal: portal, categories: selectedCategories, schema: categorySchema, rootCategoryPath: rootCategoryPath, onArcgisCategoriesPickerChange: ({ detail }) => handleItemCategoryChange(item.id, detail), hideLabel: true }))));
        };
        this.isActive = undefined;
        this.items = undefined;
        this.user = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.categorySchema = undefined;
        this.isLoading = false;
        this.categorySelectionCountMap = undefined;
        this.itemToCategoriesLookup = undefined;
        this.error = undefined;
        this.hasUnsavedChanges = false;
        this.rootCategoryPath = undefined;
    }
    async componentWillLoad() {
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.el);
        this.i18n = locale[0];
        this.updateInternalData(this.items);
    }
    async componentDidLoad() {
        const { portal, user } = this;
        this.isLoading = true;
        // Use cache since we don't modify the schema in this modal
        // TODO: handle error
        const { result, error } = await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.g)({ portal, user, useCache: true });
        if (!error && result) {
            this.categorySchema = result[0].categories;
            this.rootCategoryPath = (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_2__.g)(result);
        }
        this.isLoading = false;
    }
    updateInternalData(newItems) {
        this.itemIds = newItems.map((item) => item.id);
        this.itemToCategoriesLookup = newItems.reduce((acc, cur) => {
            acc[cur.id] = cur.categories;
            return acc;
        }, {});
        this.categorySelectionCountMap = getItemCategorySelectionState(newItems);
        this.initialItemToCategoriesLookup = structuredClone(this.itemToCategoriesLookup);
    }
    handleIsActiveChange() {
        if (!this.isActive) {
            this.updateInternalData(this.items);
        }
    }
    handleCountMapChange() {
        this.checkHasChange();
    }
    render() {
        const { items, categorySchema, categorySelectionCountMap, updateCategory, isLoading, i18n, closeDialog, isActive, renderItemCard, handleCategorySelected, error, hasUnsavedChanges, rootCategoryPath } = this;
        const total = items.length;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: isActive, onCalciteModalClose: closeDialog, scale: "m", class: "modal" }, isLoading && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-scrim", { loading: true }, i18n.loadingText), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header" }, i18n.modalTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "stage" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { icon: true, open: !!error, label: error, kind: "danger", onCalciteAlertClose: () => (this.error = null) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, error)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser", { fetch: async () => ({
                nextStart: 0,
                num: total,
                results: items,
                start: 1,
                total
            }), portal: this.portal, user: this.user, config: this.config, hideContentTop: true, contentPaddedBottom: true, hidePreviewFooters: true, view: "list", selection: "none", num: _types_a031c1da_js__WEBPACK_IMPORTED_MODULE_5__.a }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-category-tree", { slot: "filters", rootCategoryPath: rootCategoryPath, categorySchema: categorySchema, categorySelectionCountMap: categorySelectionCountMap !== null && categorySelectionCountMap !== void 0 ? categorySelectionCountMap : {}, total: total, onArcgisCategorizeCategorySelected: ({ detail }) => handleCategorySelected(detail) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-content", { slot: "content" }, items.map((item) => renderItemCard(item))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline", "data-id": "cancelButton", onClick: closeDialog, width: "full" }, i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", "data-id": "nextButton", onClick: updateCategory, width: "full", disabled: !hasUnsavedChanges }, i18n.save)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "items": ["updateInternalData"],
        "isActive": ["handleIsActiveChange"],
        "categorySelectionCountMap": ["handleCountMapChange"]
    }; }
};
ArcgisCategorizeItems.style = arcgisCategorizeItemsCss;



//# sourceMappingURL=arcgis-categorize-items.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CATEGORY_BASE_PATH),
/* harmony export */   U: () => (/* binding */ UPPER_CATEGORY_BASE_PATH),
/* harmony export */   a: () => (/* binding */ getCategoryUIPath),
/* harmony export */   g: () => (/* binding */ getRootCategoryPath)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const CATEGORY_BASE_PATH = "/categories";
const UPPER_CATEGORY_BASE_PATH = "/Categories";

// TODO: add unit tests
/**
 * Construct the path of the category based on the parent path and the category title
 */
const getCategoryUIPath = (parentPath, category, lowerCase = true) => {
    const basePath = parentPath !== null && parentPath !== void 0 ? parentPath : "";
    return `${basePath}${basePath.endsWith("/") ? "" : "/"}${lowerCase ? category.title.toLocaleLowerCase() : category.title}`;
};
/**
 * Find the root node title to use for categories
 */
function getRootCategoryPath(categories) {
    var _a;
    let categoryTitle = (_a = categories === null || categories === void 0 ? void 0 : categories[0]) === null || _a === void 0 ? void 0 : _a.title;
    if (categoryTitle && categoryTitle.charAt(0) !== "/") {
        categoryTitle = `/${categoryTitle}`;
    }
    return categoryTitle || UPPER_CATEGORY_BASE_PATH;
}



//# sourceMappingURL=categories-ca134005.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getGroupRestBaseUrl)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const getGroupRestBaseUrl = (portal, group) => (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.a)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/groups/${group.id}`);



//# sourceMappingURL=group-6a6303b0.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/types-a031c1da.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   I: () => (/* binding */ ITEM_BROWSER_BUILT_IN_FILTERS),
/* harmony export */   a: () => (/* binding */ ITEM_BROWSER_MAX_ITEMS)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const ITEM_BROWSER_BUILT_IN_FILTERS = ["folder", "group", "contentType"];
const ITEM_BROWSER_MAX_ITEMS = 99999; // arbitrary large number so it show all items



//# sourceMappingURL=types-a031c1da.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWYyZDZiZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ2tHO0FBQ0w7QUFDekI7QUFDQTtBQUNFO0FBQ0o7QUFDcEM7QUFDSztBQUNMO0FBQ0Q7QUFDRjtBQUNFO0FBQ0s7QUFDTjtBQUNEO0FBQ1M7O0FBRXBDO0FBQ0E7QUFDQSxxQkFBcUIsZ0JBQWdCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7O0FBRUEseUNBQXlDLFlBQVksZ0JBQWdCLHFCQUFxQiwrTEFBK0wsaURBQWlELHNDQUFzQyxPQUFPLHlCQUF5QixPQUFPLGtDQUFrQyw2QkFBNkIsWUFBWSwyQkFBMkIsa0JBQWtCOztBQUUvZ0I7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDJDQUEyQyxxREFBVztBQUN0RCwyQ0FBMkMscURBQVc7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGlCQUFpQjtBQUMxRCxvQkFBb0Isa0NBQWtDO0FBQ3RELDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsUUFBUSxHQUFHLEtBQUs7QUFDckQ7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixzRUFBc0U7QUFDMUY7QUFDQSxnSEFBZ0gsaUJBQWlCLEVBQUUsSUFBSTtB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MscUJBQXFCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG9EQUFlO0FBQzFDO0FBQ0E7QUFDQSw4QkFBOEIsb0RBQWE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsb0RBQW9CO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5Yjs7QUFFemI7Ozs7Ozs7Ozs7Ozs7OztBQzlKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDOztBQUVxQzs7QUFFM0UiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtY2F0ZWdvcml6ZS1pdGVtcy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jYXRlZ29yaWVzLTlmMGYzN2VlLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NhdGVnb3JpZXMtY2ExMzQwMDUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZ3JvdXAtNmE2MzAzYjAuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS0zNTM1NTUyZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3ByaXZpbGVnZXMtNWMzODJmNjEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdHlwZXMtYTAzMWMxZGEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgdSBhcyB1cGRhdGVDYXRlZ29yaWVzLCBnIGFzIGdldEl0ZW1DYXRlZ29yeVNjaGVtYSB9IGZyb20gJy4vY2F0ZWdvcmllcy05ZjBmMzdlZS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFJvb3RDYXRlZ29yeVBhdGggfSBmcm9tICcuL2NhdGVnb3JpZXMtY2ExMzQwMDUuanMnO1xuaW1wb3J0IHsgZiBhcyBhcnJheXNBcmVFcXVpdmFsZW50IH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IGEgYXMgSVRFTV9CUk9XU0VSX01BWF9JVEVNUyB9IGZyb20gJy4vdHlwZXMtYTAzMWMxZGEuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL3VybC00YzNhZTU0Yy5qcyc7XG5pbXBvcnQgJy4vZ3JvdXAtNmE2MzAzYjAuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcblxuY29uc3QgZ2V0SXRlbUNhdGVnb3J5U2VsZWN0aW9uU3RhdGUgPSAoaXRlbXMpID0+IHtcbiAgICBjb25zdCBjYXRlZ29yeVNlbGVjdGlvblN0YXRlID0ge307XG4gICAgaXRlbXMuZm9yRWFjaCgoeyBjYXRlZ29yaWVzLCBpZCB9KSA9PiB7XG4gICAgICAgIGNhdGVnb3JpZXMuZm9yRWFjaCgoY2F0ZWdvcnlQYXRoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWNhdGVnb3J5U2VsZWN0aW9uU3RhdGVbY2F0ZWdvcnlQYXRoXSkge1xuICAgICAgICAgICAgICAgIGNhdGVnb3J5U2VsZWN0aW9uU3RhdGVbY2F0ZWdvcnlQYXRoXSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0ZWdvcnlTZWxlY3Rpb25TdGF0ZVtjYXRlZ29yeVBhdGhdLnB1c2goaWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gY2F0ZWdvcnlTZWxlY3Rpb25TdGF0ZTtcbn07XG5cbmNvbnN0IGFyY2dpc0NhdGVnb3JpemVJdGVtc0NzcyA9IFwiLnN0YWdle2hlaWdodDoxMDAlO292ZXJmbG93OmhpZGRlbjstLXR3LXRyYW5zbGF0ZS14OjBweDt0cmFuc2Zvcm06dHJhbnNsYXRlKHZhcigtLXR3LXRyYW5zbGF0ZS14KSwgdmFyKC0tdHctdHJhbnNsYXRlLXkpKSByb3RhdGUodmFyKC0tdHctcm90YXRlKSkgc2tld1godmFyKC0tdHctc2tldy14KSkgc2tld1kodmFyKC0tdHctc2tldy15KSkgc2NhbGVYKHZhcigtLXR3LXNjYWxlLXgpKSBzY2FsZVkodmFyKC0tdHctc2NhbGUteSkpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX1AbWVkaWEgc2NyZWVuIGFuZCAobWluLXdpZHRoOiAxMDgwcHgpey5zdGFnZXtoZWlnaHQ6bWluKDcwMHB4LCA2MHZoKX19Lm1vZGFsey0tY2FsY2l0ZS1tb2RhbC1jb250ZW50LXBhZGRpbmc6MDstLWNhbGNpdGUtbW9kYWwtd2lkdGg6MTA4MHB4O3otaW5kZXg6OTAwfS5jYXRlZ29yeS1waWNrZXItY29udGFpbmVye21hcmdpbi10b3A6MC41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNDYXRlZ29yaXplSXRlbXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0NhdGVnb3JpemVJdGVtc0NhbmNlbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQ2F0ZWdvcml6ZUl0ZW1zQ2FuY2VsXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0NhdGVnb3JpemVJdGVtc1N1Ym1pdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQ2F0ZWdvcml6ZUl0ZW1zU3VibWl0XCIsIDcpO1xuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNDYXRlZ29yaXplSXRlbXNDYW5jZWwuZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhdGVnb3J5U2VsZWN0ZWQgPSAoeyBwYXRocywgc2VsZWN0ZWQgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtSWRzLCBpdGVtVG9DYXRlZ29yaWVzTG9va3VwIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcCk7XG4gICAgICAgICAgICBwYXRocy5mb3JFYWNoKChwYXRoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcFtwYXRoXSA9IHNlbGVjdGVkID8gWy4uLml0ZW1JZHNdIDogW107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGl0ZW1JZHMuZm9yRWFjaCgoaXRlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtVG9DYXRlZ29yaWVzTG9va3VwW2l0ZW1JZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbVRvQ2F0ZWdvcmllc0xvb2t1cFtpdGVtSWRdID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGN1clRhcmdldCA9IGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXTtcbiAgICAgICAgICAgICAgICAvLyBNaWdodCBjb250YWluIGR1cGxpY2F0ZSBidXQgdGhhdCdzIGZpbmUgc2luY2Ugd2hlbiB3ZSByZW1vdmUgaXQsIHdlJ3JlIHVzaW5nIGZpbHRlclxuICAgICAgICAgICAgICAgIGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXSA9IHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgID8gWy4uLmN1clRhcmdldCwgLi4ucGF0aHNdXG4gICAgICAgICAgICAgICAgICAgIDogY3VyVGFyZ2V0LmZpbHRlcigoZWxlKSA9PiAhcGF0aHMuaW5jbHVkZXMoZWxlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gdHJhdmVyc2UgdGhlIGNhdGVnb3J5IHRyZWUgYW5kIHJlbW92ZSB0aGUgc2VsZWN0aW9uIG9mIHBhcmVudHMgb2YgYHBhdGhzYFxuICAgICAgICAgICAgICAgIC8vICBzaW5jZSB3ZSBvbmx5IHdhbnQgdG8gc2VsZWN0IHRoZSBsZWFmIG5vZGVzXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aHNUb1JlbW92ZSA9IHBhdGhzLnJlZHVjZSgoYWNjLCBjdXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGN1clBhdGggPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBjdXJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdChcIi9cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChwYXJ0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJQYXRoID0gYCR7Y3VyUGF0aH0vJHtwYXJ0fWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJQYXRoICE9PSBjdXIgJiYgYWNjLnB1c2goY3VyUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgICAgIH0sIFtdKTtcbiAgICAgICAgICAgICAgICBwYXRoc1RvUmVtb3ZlLmZvckVhY2goKHBhdGgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcFtwYXRoXSA9IFtdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGl0ZW1JZHMuZm9yRWFjaCgoaXRlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1clRhcmdldCA9IGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbVRvQ2F0ZWdvcmllc0xvb2t1cFtpdGVtSWRdID0gY3VyVGFyZ2V0LmZpbHRlcigoZWxlKSA9PiAhcGF0aHNUb1JlbW92ZS5pbmNsdWRlcyhlbGUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEdvdHRhIGRvIHRoaXMgdG8gdHJpZ2dlciBzdGF0ZSBjaGFuZ2VcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcCA9IGNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXA7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlSXRlbUNhdGVnb3J5Q2hhbmdlID0gKGl0ZW1JZCwgbmV3Q2F0ZWdvcmllcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtVG9DYXRlZ29yaWVzTG9va3VwLCBjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwLCByb290Q2F0ZWdvcnlQYXRoIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgcHJldlNlbGVjdGVkQ2F0ZWdvcmllcyA9IGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NhdGVnb3JpZXNUb0NoZWNrID0gbmV3Q2F0ZWdvcmllcy5tYXAoKGVsZSkgPT4gZWxlLnN0YXJ0c1dpdGgocm9vdENhdGVnb3J5UGF0aCkgPyBlbGUgOiBgJHtyb290Q2F0ZWdvcnlQYXRofSR7ZWxlfWApO1xuICAgICAgICAgICAgaWYgKGFycmF5c0FyZUVxdWl2YWxlbnQocHJldlNlbGVjdGVkQ2F0ZWdvcmllcywgbmV3Q2F0ZWdvcmllc1RvQ2hlY2spKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmVtb3ZlIG9sZCBjYXRlZ29yaWVzXG4gICAgICAgICAgICBwcmV2U2VsZWN0ZWRDYXRlZ29yaWVzLmZvckVhY2goKGNhdGVnb3J5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VyVGFyZ2V0ID0gY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcFtjYXRlZ29yeV07XG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcFtjYXRlZ29yeV0gPSAoY3VyVGFyZ2V0ICE9PSBudWxsICYmIGN1clRhcmdldCAhPT0gdm9pZCAwID8gY3VyVGFyZ2V0IDogW10pLmZpbHRlcigoZWxlKSA9PiBlbGUgIT09IGl0ZW1JZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEFkZCBuZXcgY2F0ZWdvcmllc1xuICAgICAgICAgICAgbmV3Q2F0ZWdvcmllc1RvQ2hlY2suZm9yRWFjaCgoY2F0ZWdvcnkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJUYXJnZXQgPSBjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwW2NhdGVnb3J5XTtcbiAgICAgICAgICAgICAgICBjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwW2NhdGVnb3J5XSA9IFsuLi4oY3VyVGFyZ2V0ICE9PSBudWxsICYmIGN1clRhcmdldCAhPT0gdm9pZCAwID8gY3VyVGFyZ2V0IDogW10pLCBpdGVtSWRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgaXRlbSB0byBjYXRlZ29yaWVzIGxvb2t1cFxuICAgICAgICAgICAgaXRlbVRvQ2F0ZWdvcmllc0xvb2t1cFtpdGVtSWRdID0gWy4uLm5ld0NhdGVnb3JpZXNUb0NoZWNrXTtcbiAgICAgICAgICAgIC8vIEdvdHRhIGRvIHRoaXMgdG8gdHJpZ2dlciBzdGF0ZSBjaGFuZ2VcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcCA9IE9iamVjdC5hc3NpZ24oe30sIGNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXApO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZUNhdGVnb3J5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtSWRzLCBwb3J0YWwsIGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAsIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IHVwZGF0ZUNhdGVnb3JpZXMoe1xuICAgICAgICAgICAgICAgIGNhdGVnb3JpZXM6IGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAsXG4gICAgICAgICAgICAgICAgaXRlbUlkcyxcbiAgICAgICAgICAgICAgICBwb3J0YWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvclxuICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiAhZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0NhdGVnb3JpemVJdGVtc1N1Ym1pdC5lbWl0KGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXApO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFzVW5zYXZlZENoYW5nZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gaTE4bi5lcnJvck1lc3NhZ2U7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2hlY2tIYXNDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGl0ZW1JZHMsIGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAsIGluaXRpYWxJdGVtVG9DYXRlZ29yaWVzTG9va3VwIH0gPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5oYXNVbnNhdmVkQ2hhbmdlcyA9XG4gICAgICAgICAgICAgICAgISFpdGVtVG9DYXRlZ29yaWVzTG9va3VwICYmXG4gICAgICAgICAgICAgICAgICAgICEhaW5pdGlhbEl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAgJiZcbiAgICAgICAgICAgICAgICAgICAgaXRlbUlkcy5zb21lKChpdGVtSWQpID0+ICFhcnJheXNBcmVFcXVpdmFsZW50KGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXSwgaW5pdGlhbEl0ZW1Ub0NhdGVnb3JpZXNMb29rdXBbaXRlbUlkXSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlckl0ZW1DYXJkID0gKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIGl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAsIGhhbmRsZUl0ZW1DYXRlZ29yeUNoYW5nZSwgY2F0ZWdvcnlTY2hlbWEsIHJvb3RDYXRlZ29yeVBhdGggfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZENhdGVnb3JpZXMgPSBpdGVtVG9DYXRlZ29yaWVzTG9va3VwW2l0ZW0uaWRdO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1jYXJkXCIsIHsga2V5OiBpdGVtLmlkLCBpdGVtOiBpdGVtLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwgYmFzZVVybDogY29uZmlnLmJhc2VVcmwsIHNob3dJdGVtVHlwZTogdHJ1ZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50LWVuZFwiLCBjbGFzczogXCJjYXRlZ29yeS1waWNrZXItY29udGFpbmVyXCIgfSwgaChcImFyY2dpcy1jYXRlZ29yaWVzLXBpY2tlclwiLCB7IHBvcnRhbDogcG9ydGFsLCBjYXRlZ29yaWVzOiBzZWxlY3RlZENhdGVnb3JpZXMsIHNjaGVtYTogY2F0ZWdvcnlTY2hlbWEsIHJvb3RDYXRlZ29yeVBhdGg6IHJvb3RDYXRlZ29yeVBhdGgsIG9uQXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZTogKHsgZGV0YWlsIH0pID0+IGhhbmRsZUl0ZW1DYXRlZ29yeUNoYW5nZShpdGVtLmlkLCBkZXRhaWwpLCBoaWRlTGFiZWw6IHRydWUgfSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNhdGVnb3J5U2NoZW1hID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbVRvQ2F0ZWdvcmllc0xvb2t1cCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oYXNVbnNhdmVkQ2hhbmdlcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvb3RDYXRlZ29yeVBhdGggPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgICAgIHRoaXMudXBkYXRlSW50ZXJuYWxEYXRhKHRoaXMuaXRlbXMpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBjb25zdCB7IHBvcnRhbCwgdXNlciB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAvLyBVc2UgY2FjaGUgc2luY2Ugd2UgZG9uJ3QgbW9kaWZ5IHRoZSBzY2hlbWEgaW4gdGhpcyBtb2RhbFxuICAgICAgICAvLyBUT0RPOiBoYW5kbGUgZXJyb3JcbiAgICAgICAgY29uc3QgeyByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBnZXRJdGVtQ2F0ZWdvcnlTY2hlbWEoeyBwb3J0YWwsIHVzZXIsIHVzZUNhY2hlOiB0cnVlIH0pO1xuICAgICAgICBpZiAoIWVycm9yICYmIHJlc3VsdCkge1xuICAgICAgICAgICAgdGhpcy5jYXRlZ29yeVNjaGVtYSA9IHJlc3VsdFswXS5jYXRlZ29yaWVzO1xuICAgICAgICAgICAgdGhpcy5yb290Q2F0ZWdvcnlQYXRoID0gZ2V0Um9vdENhdGVnb3J5UGF0aChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgfVxuICAgIHVwZGF0ZUludGVybmFsRGF0YShuZXdJdGVtcykge1xuICAgICAgICB0aGlzLml0ZW1JZHMgPSBuZXdJdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uaWQpO1xuICAgICAgICB0aGlzLml0ZW1Ub0NhdGVnb3JpZXNMb29rdXAgPSBuZXdJdGVtcy5yZWR1Y2UoKGFjYywgY3VyKSA9PiB7XG4gICAgICAgICAgICBhY2NbY3VyLmlkXSA9IGN1ci5jYXRlZ29yaWVzO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwge30pO1xuICAgICAgICB0aGlzLmNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXAgPSBnZXRJdGVtQ2F0ZWdvcnlTZWxlY3Rpb25TdGF0ZShuZXdJdGVtcyk7XG4gICAgICAgIHRoaXMuaW5pdGlhbEl0ZW1Ub0NhdGVnb3JpZXNMb29rdXAgPSBzdHJ1Y3R1cmVkQ2xvbmUodGhpcy5pdGVtVG9DYXRlZ29yaWVzTG9va3VwKTtcbiAgICB9XG4gICAgaGFuZGxlSXNBY3RpdmVDaGFuZ2UoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVJbnRlcm5hbERhdGEodGhpcy5pdGVtcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQ291bnRNYXBDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tIYXNDaGFuZ2UoKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGl0ZW1zLCBjYXRlZ29yeVNjaGVtYSwgY2F0ZWdvcnlTZWxlY3Rpb25Db3VudE1hcCwgdXBkYXRlQ2F0ZWdvcnksIGlzTG9hZGluZywgaTE4biwgY2xvc2VEaWFsb2csIGlzQWN0aXZlLCByZW5kZXJJdGVtQ2FyZCwgaGFuZGxlQ2F0ZWdvcnlTZWxlY3RlZCwgZXJyb3IsIGhhc1Vuc2F2ZWRDaGFuZ2VzLCByb290Q2F0ZWdvcnlQYXRoIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB0b3RhbCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1tb2RhbFwiLCB7IG9wZW46IGlzQWN0aXZlLCBvbkNhbGNpdGVNb2RhbENsb3NlOiBjbG9zZURpYWxvZywgc2NhbGU6IFwibVwiLCBjbGFzczogXCJtb2RhbFwiIH0sIGlzTG9hZGluZyAmJiBoKFwiY2FsY2l0ZS1zY3JpbVwiLCB7IGxvYWRpbmc6IHRydWUgfSwgaTE4bi5sb2FkaW5nVGV4dCksIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiIH0sIGkxOG4ubW9kYWxUaXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwic3RhZ2VcIiB9LCBoKFwiY2FsY2l0ZS1hbGVydFwiLCB7IGljb246IHRydWUsIG9wZW46ICEhZXJyb3IsIGxhYmVsOiBlcnJvciwga2luZDogXCJkYW5nZXJcIiwgb25DYWxjaXRlQWxlcnRDbG9zZTogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgZXJyb3IpKSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXJcIiwgeyBmZXRjaDogYXN5bmMgKCkgPT4gKHtcbiAgICAgICAgICAgICAgICBuZXh0U3RhcnQ6IDAsXG4gICAgICAgICAgICAgICAgbnVtOiB0b3RhbCxcbiAgICAgICAgICAgICAgICByZXN1bHRzOiBpdGVtcyxcbiAgICAgICAgICAgICAgICBzdGFydDogMSxcbiAgICAgICAgICAgICAgICB0b3RhbFxuICAgICAgICAgICAgfSksIHBvcnRhbDogdGhpcy5wb3J0YWwsIHVzZXI6IHRoaXMudXNlciwgY29uZmlnOiB0aGlzLmNvbmZpZywgaGlkZUNvbnRlbnRUb3A6IHRydWUsIGNvbnRlbnRQYWRkZWRCb3R0b206IHRydWUsIGhpZGVQcmV2aWV3Rm9vdGVyczogdHJ1ZSwgdmlldzogXCJsaXN0XCIsIHNlbGVjdGlvbjogXCJub25lXCIsIG51bTogSVRFTV9CUk9XU0VSX01BWF9JVEVNUyB9LCBoKFwiYXJjZ2lzLWNhdGVnb3J5LXRyZWVcIiwgeyBzbG90OiBcImZpbHRlcnNcIiwgcm9vdENhdGVnb3J5UGF0aDogcm9vdENhdGVnb3J5UGF0aCwgY2F0ZWdvcnlTY2hlbWE6IGNhdGVnb3J5U2NoZW1hLCBjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwOiBjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwICE9PSBudWxsICYmIGNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXAgIT09IHZvaWQgMCA/IGNhdGVnb3J5U2VsZWN0aW9uQ291bnRNYXAgOiB7fSwgdG90YWw6IHRvdGFsLCBvbkFyY2dpc0NhdGVnb3JpemVDYXRlZ29yeVNlbGVjdGVkOiAoeyBkZXRhaWwgfSkgPT4gaGFuZGxlQ2F0ZWdvcnlTZWxlY3RlZChkZXRhaWwpIH0pLCBoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1jb250ZW50XCIsIHsgc2xvdDogXCJjb250ZW50XCIgfSwgaXRlbXMubWFwKChpdGVtKSA9PiByZW5kZXJJdGVtQ2FyZChpdGVtKSkpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwic2Vjb25kYXJ5XCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZVwiLCBcImRhdGEtaWRcIjogXCJjYW5jZWxCdXR0b25cIiwgb25DbGljazogY2xvc2VEaWFsb2csIHdpZHRoOiBcImZ1bGxcIiB9LCBpMThuLmNhbmNlbCksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwicHJpbWFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogdXBkYXRlQ2F0ZWdvcnksIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6ICFoYXNVbnNhdmVkQ2hhbmdlcyB9LCBpMThuLnNhdmUpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcIml0ZW1zXCI6IFtcInVwZGF0ZUludGVybmFsRGF0YVwiXSxcbiAgICAgICAgXCJpc0FjdGl2ZVwiOiBbXCJoYW5kbGVJc0FjdGl2ZUNoYW5nZVwiXSxcbiAgICAgICAgXCJjYXRlZ29yeVNlbGVjdGlvbkNvdW50TWFwXCI6IFtcImhhbmRsZUNvdW50TWFwQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0NhdGVnb3JpemVJdGVtcy5zdHlsZSA9IGFyY2dpc0NhdGVnb3JpemVJdGVtc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzQ2F0ZWdvcml6ZUl0ZW1zIGFzIGFyY2dpc19jYXRlZ29yaXplX2l0ZW1zIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1jYXRlZ29yaXplLWl0ZW1zLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEdyb3VwUmVzdEJhc2VVcmwgfSBmcm9tICcuL2dyb3VwLTZhNjMwM2IwLmpzJztcbmltcG9ydCB7IGEgYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcblxuY29uc3QgZ2V0SXRlbUNhdGVnb3J5U2NoZW1hID0gYXN5bmMgKHsgcG9ydGFsLCB1c2VyLCBncm91cCwgdXNlQ2FjaGUgPSBmYWxzZSB9KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZldGNoUmVzdWx0ID0gYXdhaXQgKGdyb3VwXG4gICAgICAgICAgICA/IGZldGNoR3JvdXBDYXRlZ29yaWVzKGdyb3VwLmlkLCBwb3J0YWwsIHVzZUNhY2hlKVxuICAgICAgICAgICAgOiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IChfYSA9IGZldGNoUmVzdWx0ID09PSBudWxsIHx8IGZldGNoUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmZXRjaFJlc3VsdC5jYXRlZ29yeVNjaGVtYSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbCB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmFzeW5jIGZ1bmN0aW9uIGZldGNoQ2F0ZWdvcmllcyhwb3J0YWwsIHVzZXIsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIHVzZXIgIT09IG51bGwgJiYgdXNlciAhPT0gdm9pZCAwID8gdXNlciA6ICh1c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgaWYgKCEocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlkKSB8fCAodXNlciAmJiBpc1B1YmxpY1VzZXIodXNlcikpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vY2F0ZWdvcnlTY2hlbWFgKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIHBvcnRhbC5pZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoR3JvdXBDYXRlZ29yaWVzKGdyb3VwSWQsIHBvcnRhbCwgdXNlQ2FjaGUgPSB0cnVlKSB7XG4gICAgcG9ydGFsICE9PSBudWxsICYmIHBvcnRhbCAhPT0gdm9pZCAwID8gcG9ydGFsIDogKHBvcnRhbCA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIGlmICghZ3JvdXBJZCB8fCAhcG9ydGFsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiByZXF1ZXN0KGAke2dldEdyb3VwUmVzdEJhc2VVcmwocG9ydGFsLCB7IGlkOiBncm91cElkIH0pfWNhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBncm91cElkKSA6IGdldFNjaGVtYSgpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMaXZpbmdBdGxhc1NjaGVtYShwb3J0YWwsIGNhdGVnb3J5TmFtZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBiYXNlID0gZ2V0UmVzdEJhc2VVcmwocG9ydGFsKTtcbiAgICBjb25zdCBzZWxmID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfXBvcnRhbHMvc2VsZmApO1xuICAgIGNvbnN0IGdyb3VwU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbW11bml0eS9ncm91cHM/cT0ke3NlbGYuY29udGVudENhdGVnb3J5U2V0c0dyb3VwUXVlcnl9YCk7XG4gICAgY29uc3QgY2F0ZWdvcnlHcm91cCA9IChfYSA9IGdyb3VwU2VhcmNoID09PSBudWxsIHx8IGdyb3VwU2VhcmNoID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cFNlYXJjaC5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgY29uc3Qgc2NoZW1hSXRlbVNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb250ZW50L2dyb3Vwcy8ke2NhdGVnb3J5R3JvdXAuaWR9L3NlYXJjaGAsIHtcbiAgICAgICAgcTogYHR5cGVrZXl3b3JkczogJHtjYXRlZ29yeU5hbWV9YFxuICAgIH0pO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW0gPSBzY2hlbWFJdGVtU2VhcmNoLnJlc3VsdHNbMF07XG4gICAgcmV0dXJuIHJlcXVlc3QoYCR7YmFzZX1jb250ZW50L2l0ZW1zLyR7c2NoZW1hSXRlbS5pZH0vZGF0YWApO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMocG9ydGFsLCBjYXRlZ29yeU5hbWUsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIGNvbnN0IGdldFNjaGVtYSA9ICgpID0+IGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgY2F0ZWdvcnlOYW1lKSA6IGdldFNjaGVtYSgpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ2F0ZWdvcmllcyh7IGNhdGVnb3JpZXMsIGl0ZW1JZHMsIHBvcnRhbCB9KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29udGVudC91cGRhdGVJdGVtc2A7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gSlNPTi5zdHJpbmdpZnkoaXRlbUlkcy5tYXAoKGlkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIFtpZF06IHsgY2F0ZWdvcmllczogQXJyYXkuaXNBcnJheShjYXRlZ29yaWVzKSA/IGNhdGVnb3JpZXMgOiBjYXRlZ29yaWVzW2lkXSB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogYXdhaXQgcmVxdWVzdCh1cmwsIHsgaXRlbXMgfSwge30sIFwicG9zdFwiKSB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcyBhcyBhLCBmZXRjaEdyb3VwQ2F0ZWdvcmllcyBhcyBiLCBmZXRjaENhdGVnb3JpZXMgYXMgZiwgZ2V0SXRlbUNhdGVnb3J5U2NoZW1hIGFzIGcsIHVwZGF0ZUNhdGVnb3JpZXMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYXRlZ29yaWVzLTlmMGYzN2VlLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuY29uc3QgQ0FURUdPUllfQkFTRV9QQVRIID0gXCIvY2F0ZWdvcmllc1wiO1xuY29uc3QgVVBQRVJfQ0FURUdPUllfQkFTRV9QQVRIID0gXCIvQ2F0ZWdvcmllc1wiO1xuXG4vLyBUT0RPOiBhZGQgdW5pdCB0ZXN0c1xuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIHBhdGggb2YgdGhlIGNhdGVnb3J5IGJhc2VkIG9uIHRoZSBwYXJlbnQgcGF0aCBhbmQgdGhlIGNhdGVnb3J5IHRpdGxlXG4gKi9cbmNvbnN0IGdldENhdGVnb3J5VUlQYXRoID0gKHBhcmVudFBhdGgsIGNhdGVnb3J5LCBsb3dlckNhc2UgPSB0cnVlKSA9PiB7XG4gICAgY29uc3QgYmFzZVBhdGggPSBwYXJlbnRQYXRoICE9PSBudWxsICYmIHBhcmVudFBhdGggIT09IHZvaWQgMCA/IHBhcmVudFBhdGggOiBcIlwiO1xuICAgIHJldHVybiBgJHtiYXNlUGF0aH0ke2Jhc2VQYXRoLmVuZHNXaXRoKFwiL1wiKSA/IFwiXCIgOiBcIi9cIn0ke2xvd2VyQ2FzZSA/IGNhdGVnb3J5LnRpdGxlLnRvTG9jYWxlTG93ZXJDYXNlKCkgOiBjYXRlZ29yeS50aXRsZX1gO1xufTtcbi8qKlxuICogRmluZCB0aGUgcm9vdCBub2RlIHRpdGxlIHRvIHVzZSBmb3IgY2F0ZWdvcmllc1xuICovXG5mdW5jdGlvbiBnZXRSb290Q2F0ZWdvcnlQYXRoKGNhdGVnb3JpZXMpIHtcbiAgICB2YXIgX2E7XG4gICAgbGV0IGNhdGVnb3J5VGl0bGUgPSAoX2EgPSBjYXRlZ29yaWVzID09PSBudWxsIHx8IGNhdGVnb3JpZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNhdGVnb3JpZXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZTtcbiAgICBpZiAoY2F0ZWdvcnlUaXRsZSAmJiBjYXRlZ29yeVRpdGxlLmNoYXJBdCgwKSAhPT0gXCIvXCIpIHtcbiAgICAgICAgY2F0ZWdvcnlUaXRsZSA9IGAvJHtjYXRlZ29yeVRpdGxlfWA7XG4gICAgfVxuICAgIHJldHVybiBjYXRlZ29yeVRpdGxlIHx8IFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSDtcbn1cblxuZXhwb3J0IHsgQ0FURUdPUllfQkFTRV9QQVRIIGFzIEMsIFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSCBhcyBVLCBnZXRDYXRlZ29yeVVJUGF0aCBhcyBhLCBnZXRSb290Q2F0ZWdvcnlQYXRoIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy1jYTEzNDAwNS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmNvbnN0IGdldEdyb3VwUmVzdEJhc2VVcmwgPSAocG9ydGFsLCBncm91cCkgPT4gYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXAuaWR9YCk7XG5cbmV4cG9ydCB7IGdldEdyb3VwUmVzdEJhc2VVcmwgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ncm91cC02YTYzMDNiMC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcblxuZnVuY3Rpb24gaXNFc3JpKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IGl0ZW0ub3duZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZXNyaVwiKSk7XG59XG5mdW5jdGlvbiBpc1ByZW1pdW0oaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gaXNFc3JpKGl0ZW0pICYmICEhKChfYSA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJSZXF1aXJlcyBDcmVkaXRzXCIpKTtcbn1cbmZ1bmN0aW9uIGlzU3Vic2NyaWJlcihpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIFN1YnNjcmlwdGlvblwiKSk7XG59XG5mdW5jdGlvbiBpc093bmVyKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gaXRlbS5vd25lciA9PT0gdXNlci51c2VybmFtZTtcbn1cbi8qKlxuICogQ2FuIHRoZSB1c2VyIHVwZGF0ZSB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHx8IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwidXBkYXRlXCI7XG59XG4vKipcbiAqIElzIHRoZSB1c2VyIGVpdGhlciBhbiBvd25lciBvciBhZG1pbiBvZiB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpc093bmVyKGl0ZW0sIHVzZXIpIHx8IGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpO1xufVxuLyoqXG4gKiBEb2VzIHRoZSB1c2VyIGhhdmUgYWRtaW4gY2FwYWJpbGl0aWVzIG9uIHRoaXMgaXRlbVxuICovXG5mdW5jdGlvbiBpc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGlmIHRoaXMgZmxhZyBpcyBhbHJlYWR5IHNldCAocHJvYmFibHkgaG9tZSBhcHApLCB1c2UgaXRcbiAgICBpZiAoaXRlbS5pc0FkbWluICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICEhaXRlbS5pc0FkbWluO1xuICAgIH1cbiAgICBjb25zdCBpdGVtT3duZXIgPSBpdGVtLm93bmVyO1xuICAgIGNvbnN0IGl0ZW1Db250cm9sQWRtaW4gPSBpdGVtLml0ZW1Db250cm9sID09PSBcImFkbWluXCI7XG4gICAgY29uc3QgZXNyaVVzZXJzID0gW1wiZXNyaV9saXZpbmdhdGxhc1wiLCBcImVzcmlfZGVtb2dyYXBoaWNzXCIsIFwiZXNyaV9ib3VuZGFyaWVzXCJdO1xuICAgIGlmICgoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiZcbiAgICAgICAgIWlzT3duZXIoaXRlbSwgdXNlcikgJiZcbiAgICAgICAgaXRlbUNvbnRyb2xBZG1pbiAmJlxuICAgICAgICBpdGVtT3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJlxuICAgICAgICAvLyBwb3J0YWwgaW5jb3JyZWN0bHkgcmV0dXJucyBcIml0ZW1Db250cm9sPVwiYWRtaW5cIiBmb3IgZXNyaSBvd25lZCBpdGVtc1xuICAgICAgICAhZXNyaVVzZXJzLmluY2x1ZGVzKGl0ZW1Pd25lcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUNvbnRyb2xBZG1pbjtcbn1cbmNvbnN0IGl0ZW1zQmVsb25nVG9Vc2VyT3JnID0gKGl0ZW1zLCB1c2VyKSA9PiB7XG4gICAgcmV0dXJuICEhdXNlci5vcmdJZCAmJiBpdGVtcy5ldmVyeSgoaXRlbSkgPT4gaXRlbS5pc09yZ0l0ZW0pO1xufTtcbmNvbnN0IGdldEl0ZW1Ib21lQXBwVXJsID0gKGl0ZW1JZCwgYmFzZVVybCkgPT4gYCR7YWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhiYXNlVXJsKX1pdGVtLmh0bWw/aWQ9JHtpdGVtSWR9YDtcblxuZXhwb3J0IHsgaXNTdWJzY3JpYmVyIGFzIGEsIGlzUHJlbWl1bSBhcyBiLCBjYW5VcGRhdGVJdGVtIGFzIGMsIGl0ZW1zQmVsb25nVG9Vc2VyT3JnIGFzIGQsIGdldEl0ZW1Ib21lQXBwVXJsIGFzIGcsIGlzT3duZXIgYXMgaSwgdXNlcklzSXRlbUFkbWluIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS0zNTM1NTUyZC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyB1IGFzIHVzZXJJc0l0ZW1BZG1pbiwgYyBhcyBjYW5VcGRhdGVJdGVtLCBkIGFzIGl0ZW1zQmVsb25nVG9Vc2VyT3JnIH0gZnJvbSAnLi9pdGVtLTM1MzU1NTJkLmpzJztcblxuY29uc3QgZ2V0VXNlclJvbGUgPSAodXNlcikgPT4ge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiB0eXBlb2YgKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlKSA9PT0gXCJzdHJpbmdcIiAmJiAhISh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZSlcbiAgICAgICAgPyB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZVxuICAgICAgICA6IChfYiA9IChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlSWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5pZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKF9jID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5pZDtcbn07XG5mdW5jdGlvbiBpc1B1YmxpY1VzZXIodXNlcikge1xuICAgIHJldHVybiB1c2VyICYmICF1c2VyLm9yZ0lkO1xufVxuZnVuY3Rpb24gaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSB7XG4gICAgcmV0dXJuICFwb3J0YWwuaXNQb3J0YWwgfHwgISFwb3J0YWwuaXNCYWNrZWRCeVNEUztcbn1cbmZ1bmN0aW9uIGlzRGV2ZWxvcGVyKHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICBjb25zdCBkZXZTdWJzY3JpcHRpb25UeXBlcyA9IFtcIlRyaWFsIERldmVsb3BlclwiLCBcIkRldmVsb3BlclwiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIl07XG4gICAgcmV0dXJuIGRldlN1YnNjcmlwdGlvblR5cGVzLmluY2x1ZGVzKHN1YnNjcmlwdGlvbkluZm8gPT09IG51bGwgfHwgc3Vic2NyaXB0aW9uSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3Vic2NyaXB0aW9uSW5mby50eXBlKTtcbn1cbmZ1bmN0aW9uIGlzT3JnQWRtaW4odXNlcikge1xuICAgIHJldHVybiBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJvcmdfYWRtaW5cIiB8fCBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJhY2NvdW50X2FkbWluXCI7XG59XG5mdW5jdGlvbiBpc09yZ1VzZXIodXNlcikge1xuICAgIHJldHVybiBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJvcmdfdXNlclwiIHx8IGdldFVzZXJSb2xlKHVzZXIpID09PSBcImFjY291bnRfdXNlclwiO1xufVxuZnVuY3Rpb24gaXNDdXN0b21Sb2xlKHVzZXIpIHtcbiAgICAvLyBUaGUgSG9tZSBBcHAgY29sbGFwc2UgdGhlIGByb2xlSWRgIGFuZCBgcm9sZWAgaW50byBhIHNpbmdsZSBgaWRgIHByb3BlcnR5LCB0aGF0J3Mgd2h5XG4gICAgLy8gIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2Jsb2IvbWFzdGVyL3NyYy9qcy9hcmNnaXNvbmxpbmUvc2hhcmluZy9kaWppdC9Sb2xlLnRzI0w0Njkgd29ya3NcbiAgICAvLyBJbiBwcmFjdGljZSwgd2Ugb25seSBuZWVkIHRvIGNoZWNrIGlmIGByb2xlSWRgIGV4aXN0XG4gICAgLy8gIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy80NDY4MiNpc3N1ZWNvbW1lbnQtNDE0Njg2NlxuICAgIHJldHVybiAhISh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZUlkKSAmJiB1c2VyLnJvbGVJZC5sZW5ndGggPiAwO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgcHJpdmlsZWdlIFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1DYXRlZ29yeVNjaGVtYVwiIGlzIGdyYW50ZWQuXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW1DYXRlZ29yaWVzKHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbUNhdGVnb3J5U2NoZW1hXCIpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHByaXZpbGVnZSBcInBvcnRhbDphZG1pbjp1cGRhdGVHcm91cHNcIiBpcyBncmFudGVkLlxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVPcmdHcm91cHModXNlcikge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVHcm91cHNcIikpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHVwZGF0ZSBvdGhlciB1c2VyJ3MgaXRlbXMgaW4gdGhlaXIgb3JnYW5pemF0aW9uLlxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtc1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHRvIGVuc3VyZSB0aGUgcG9ydGFsIGlzIGFuIG9yZ2FuaXphdGlvbiBwb3J0YWxcbiAqL1xuZnVuY3Rpb24gaXNPcmdQb3J0YWwocG9ydGFsKSB7XG4gICAgcmV0dXJuICEhKHBvcnRhbC51cmxLZXkgJiYgcG9ydGFsLmN1c3RvbUJhc2VVcmwpIHx8ICEhcG9ydGFsLmlzUG9ydGFsO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gdG8gZ3JvdXBzXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvR3JvdXAodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvR3JvdXBcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBhbiBpdGVtIG9uIGEgZ2l2ZW4gcG9ydGFsXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlKHVzZXIsIHBvcnRhbCkge1xuICAgIHJldHVybiAoIWlzT3JnUG9ydGFsKHBvcnRhbCkgfHxcbiAgICAgICAgY2FuU2hhcmVJdGVtVG9Hcm91cCh1c2VyKSB8fFxuICAgICAgICBjYW5TaGFyZUl0ZW1Ub09yZyh1c2VyKSB8fFxuICAgICAgICAoISFwb3J0YWwuY2FuU2hhcmVQdWJsaWMgJiYgY2FuU2hhcmVJdGVtVG9QdWJsaWModXNlcikpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBzaGFyZSB0aGVpciBpdGVtIG90IHRoZSBvcmdhbml6YXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvT3JnKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb09yZ1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBzaGFyZSB0aGVpciBpdGVtIHRvIHB1YmxpY1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9QdWJsaWNcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtc1RvT3JnKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9PcmdcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9QdWJsaWNcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9Hcm91cFwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgaW4gYW4gYWxsb3dlZCBvcmdhbml6YXRpb24gYW5kIGhhcyB0aGUgcG93ZXIgdG8gbWFuYWdlIGNvbGxhYm9yYXRpb25zXG4gKi9cbmZ1bmN0aW9uIGNhbk1hbmFnZUNvbGxhYm9yYXRpb25zKGNvbmZpZywgdXNlciwgcG9ydGFsLCBzdWJzY3JpcHRpb25JbmZvKSB7XG4gICAgY29uc3QgZXhjbHVkZWRPcmdUeXBlcyA9IFtcIlRyaWFsXCIsIFwiVHJpYWwgUHJlc3NcIiwgXCJUcmlhbCBEZXZlbG9wZXJcIiwgXCJEZXZlbG9wZXIgU3Vic2NyaXB0aW9uXCIsIFwiRXZhbHVhdGlvblwiXTtcbiAgICBjb25zdCBpc1ZhbGlkT3JnVHlwZSA9IHN1YnNjcmlwdGlvbkluZm8gJiYgIWV4Y2x1ZGVkT3JnVHlwZXMuaW5jbHVkZXMoc3Vic2NyaXB0aW9uSW5mby50eXBlKTtcbiAgICBjb25zdCBoYXNQcml2aWxlZ2UgPSAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46bWFuYWdlQ29sbGFib3JhdGlvbnNcIik7XG4gICAgcmV0dXJuICEhKChjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWcuY29sbGFib3JhdGlvbnNFbmFibGVkKSAmJlxuICAgICAgICB1c2VyICYmXG4gICAgICAgIChpc09yZ0FkbWluKHVzZXIpIHx8IGhhc1ByaXZpbGVnZSkgJiZcbiAgICAgICAgKChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpIHx8IGlzVmFsaWRPcmdUeXBlKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiB2aWV3IG90aGVyIG9yZ2FuaXphdGlvbiB1c2VycycgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuVmlld09yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnZpZXdJdGVtc1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHZpZXcgb3RoZXIgb3JnYW5pemF0aW9uIHVzZXJzJyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5WaWV3T3RoZXJzT3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAhIXVzZXIgJiYgKCFpc0N1c3RvbVJvbGUodXNlcikgfHwgKGlzQ3VzdG9tUm9sZSh1c2VyKSAmJiBjYW5WaWV3T3JnSXRlbXModXNlcikpKTtcbn1cbi8vIFRPRE86IGFkZCB1bml0IHRlc3RzXG5jb25zdCBoYXNBZG1pblNoYXJlUHJpdmlsZWdlID0gKHsgaXRlbXMsIHVzZXIsIHBvcnRhbCB9KSA9PiB7XG4gICAgY29uc3QgaXRlbSA9IGl0ZW1zWzBdO1xuICAgIC8vIGVudGVycHJpc2UgaW5jb3JyZWN0bHkgcmV0dXJucyBpdGVtcyBvd25lZCBieSBcImVzcmlfXCIgYXMgaXRlbSBjb250cm9sIGFkbWluIChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMzg2OTUpXG4gICAgY29uc3Qgb3duZXIgPSBpdGVtLm93bmVyO1xuICAgIGNvbnN0IHdoaXRlbGlzdE93bmVyID0gW1wiZXNyaV9saXZpbmdhdGxhc1wiXTtcbiAgICBpZiAocG9ydGFsLmlzUG9ydGFsICYmIG93bmVyICE9PSB1c2VyLnVzZXJuYW1lICYmIG93bmVyLmluY2x1ZGVzKFwiZXNyaV9cIikgJiYgIXdoaXRlbGlzdE93bmVyLmluY2x1ZGVzKG93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGlzT3duZXJPckFkbWluID0gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpO1xuICAgIGNvbnN0IGlzQ3VzdG9tID0gaXNDdXN0b21Sb2xlKHVzZXIpO1xuICAgIGNvbnN0IGNhblNoYXJlT3JnSXRlbXMgPSBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpO1xuICAgIGNvbnN0IGNhblVwZGF0ZUFuZFNoYXJlID0gY2FuVXBkYXRlSXRlbShpdGVtLCB1c2VyKSAmJlxuICAgICAgICBjYW5VcGRhdGVPcmdJdGVtcyh1c2VyKSAmJlxuICAgICAgICAhaXNDdXN0b20gJiZcbiAgICAgICAgKGNhblNoYXJlKHVzZXIsIHBvcnRhbCkgfHwgY2FuU2hhcmVPdGhlcnNJdGVtcyh1c2VyKSk7XG4gICAgLy8gaWYgaXQncyB0aGUgaXRlbSBvd25lciBvciBhZG1pbiwgb3IgY3VzdG9tIGFkbWluIHdobyBjYW4gc2hhcmVcbiAgICByZXR1cm4gaXNPd25lck9yQWRtaW4gfHwgY2FuVXBkYXRlQW5kU2hhcmUgfHwgKGl0ZW1zQmVsb25nVG9Vc2VyT3JnKGl0ZW1zLCB1c2VyKSAmJiBjYW5TaGFyZU9yZ0l0ZW1zKTtcbn07XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuIGFkbWluQ2FuU2hhcmVPdGhlcnNJdGVtVG9Hcm91cCh1c2VyKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcodXNlcikgfHwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljKHVzZXIpO1xufVxuXG5leHBvcnQgeyBpc1B1YmxpY1VzZXIgYXMgYSwgaXNPcmdBZG1pbiBhcyBiLCBpc0hvc3RlZFBvcnRhbCBhcyBjLCBpc0N1c3RvbVJvbGUgYXMgZCwgY2FuVXBkYXRlT3JnR3JvdXBzIGFzIGUsIGNhblVwZGF0ZUl0ZW1DYXRlZ29yaWVzIGFzIGYsIGNhbk1hbmFnZUNvbGxhYm9yYXRpb25zIGFzIGcsIGlzT3JnVXNlciBhcyBoLCBpc0RldmVsb3BlciBhcyBpLCBjYW5TaGFyZUl0ZW1Ub0dyb3VwIGFzIGosIGNhblNoYXJlSXRlbVRvT3JnIGFzIGssIGFkbWluQ2FuU2hhcmVPdGhlcnNJdGVtVG9Hcm91cCBhcyBsLCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcgYXMgbSwgY2FuU2hhcmVJdGVtVG9QdWJsaWMgYXMgbiwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljIGFzIG8sIGhhc0FkbWluU2hhcmVQcml2aWxlZ2UgYXMgcCwgY2FuVmlld090aGVyc09yZ0l0ZW1zIGFzIHEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJpdmlsZWdlcy01YzM4MmY2MS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IElURU1fQlJPV1NFUl9CVUlMVF9JTl9GSUxURVJTID0gW1wiZm9sZGVyXCIsIFwiZ3JvdXBcIiwgXCJjb250ZW50VHlwZVwiXTtcbmNvbnN0IElURU1fQlJPV1NFUl9NQVhfSVRFTVMgPSA5OTk5OTsgLy8gYXJiaXRyYXJ5IGxhcmdlIG51bWJlciBzbyBpdCBzaG93IGFsbCBpdGVtc1xuXG5leHBvcnQgeyBJVEVNX0JST1dTRVJfQlVJTFRfSU5fRklMVEVSUyBhcyBJLCBJVEVNX0JST1dTRVJfTUFYX0lURU1TIGFzIGEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dHlwZXMtYTAzMWMxZGEuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9