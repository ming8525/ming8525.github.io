"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3ff12d"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser-filter-content-type.entry.js":
/*!******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser-filter-content-type.entry.js ***!
  \******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_browser_filter_content_type: () => (/* binding */ ArcgisItemBrowserFilterContentType)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _store_7fa26472_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./store-7fa26472.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










const arcgisItemBrowserFilterContentTypeCss = ".hide.sc-arcgis-item-browser-filter-content-type{display:none}calcite-list-item.sc-arcgis-item-browser-filter-content-type:not([selected]){--calcite-color-foreground-1:var(--calcite-color-background)}";

const ArcgisItemBrowserFilterContentType = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.contentType = "allOrgContent";
        this.expanded = undefined;
        this.contentTypes = ["allOrgContent", "recycle"];
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.el);
        this.i18n = this.store.state.i18n.filterContentType;
    }
    componentDidLoad() {
        if (this.expanded && this.accordionItem) {
            this.accordionItem.expanded = true;
        }
    }
    getEventDetail() {
        return {
            id: "contentType",
            param: "q",
            value: "",
            label: this.i18n.allOrgContent,
            contentType: this.contentType
        };
    }
    render() {
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        const bucket = this.store.state.bucket;
        const { i18n, contentType, contentTypes } = this;
        const hide = !user ||
            !contentType ||
            (bucket && bucket !== "org") ||
            (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_2__.a)(user) ||
            (portal === null || portal === void 0 ? void 0 : portal.isPortal);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.contentType, expanded: this.expanded, noPadding: true, class: { hide } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { selectionAppearance: "border", selectionMode: "single", loading: !contentType, class: "content-types" }, contentTypes.map((type) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "content-type", label: i18n[type], value: type, key: type, onCalciteListItemSelect: () => {
                    this.contentType = type;
                    this.arcgisItemBrowserFilter.emit(this.getEventDetail());
                }, selected: this.contentType === type }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: type === "allOrgContent" ? "organization" : "recycle-bin", slot: "content-start", scale: "s" })));
        })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterContentType.style = arcgisItemBrowserFilterContentTypeCss;



//# sourceMappingURL=arcgis-item-browser-filter-content-type.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ configState),
/* harmony export */   o: () => (/* binding */ onConfigChange)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const configStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    portal: null,
    user: null,
    api: 4,
    scale: "m"
});
const configState = configStore.state;
const onConfigChange = configStore.onChange;



//# sourceMappingURL=config-75adf962.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};



//# sourceMappingURL=index-05956cab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ onItemBrowserSortChange),
/* harmony export */   b: () => (/* binding */ onItemBrowserPreviewChange),
/* harmony export */   c: () => (/* binding */ onItemBrowserViewChange),
/* harmony export */   g: () => (/* binding */ getItemBrowserStore),
/* harmony export */   o: () => (/* binding */ onItemBrowserBucketChange)
/* harmony export */ });
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function getItemBrowserStore(el) {
    return (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_0__.g)(el, "arcgis-item-browser");
}
const onItemBrowserViewChange = (store, callback) => {
    store.onChange("view", (newView) => {
        callback(newView);
    });
};
const onItemBrowserBucketChange = (store, callback) => {
    store.onChange("bucket", (newBucket) => {
        callback(newBucket);
    });
};
const onItemBrowserPreviewChange = (store, callback) => {
    store.onChange("preview", (preview) => {
        callback(preview);
    });
};
const onItemBrowserSortChange = (store, callback) => {
    store.onChange("sort", (sort) => {
        callback(sort);
    });
};



//# sourceMappingURL=store-7fa26472.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ onBrowserFilterRemove),
/* harmony export */   b: () => (/* binding */ onGroupIdChange),
/* harmony export */   g: () => (/* binding */ getStore),
/* harmony export */   o: () => (/* binding */ onPreviewChange)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const onBrowserFilterRemove = (id, store, callback) => {
    // @ts-ignore
    store.onChange("filters", (filters) => {
        if (!filters[id] || !filters[id].value) {
            callback();
        }
    });
};
const onPreviewChange = (store, callback) => {
    // @ts-ignore
    store.onChange("preview", (preview) => {
        callback();
    });
};
const onGroupIdChange = (store, callback) => {
    // @ts-ignore
    store.onChange("groupId", (preview) => {
        callback();
    });
};
const STORE_LOOKUP = new Map();
function getStore(el, browserTag) {
    const existingStore = STORE_LOOKUP.get(el);
    if (existingStore) {
        return existingStore;
    }
    const browser = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(el, browserTag);
    if (browser) {
        STORE_LOOKUP.set(el, browser.store);
        return browser.store;
    }
    return null;
}



//# sourceMappingURL=store-8b1b0846.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js":
/*!*********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addTrailingSlashIfMissing),
/* harmony export */   b: () => (/* binding */ geoJsonRegExp),
/* harmony export */   c: () => (/* binding */ agsRegExp),
/* harmony export */   g: () => (/* binding */ getRestUrlFromUrl),
/* harmony export */   p: () => (/* binding */ parseAGSServerInfo),
/* harmony export */   r: () => (/* binding */ regexServerType),
/* harmony export */   s: () => (/* binding */ specialCharactersRegExp),
/* harmony export */   v: () => (/* binding */ validArcgisRestServicePath)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const specialCharactersRegExp = /\+|\?|\/|\(|\)|\\|\!|\#|\"|\||\*|\:|<|>|\%|\$|\@|\'|\^|\[|\]|\,|\=|\;/gi;
const geoJsonRegExp = /(\.|outputFormat=)json|geojson$/i;
const agsRegExp = /\/ags\//gi;

const serverTypes = "MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer|SceneServer|VectorTileServer|StreamServer|WorkspaceServer|GeoenrichmentServer|VideoServer";
const regexServerType = new RegExp(`http.+\/(${serverTypes})`);
const validArcgisRestServicePath = `\/arcgis\/rest\/services|\/rest\/services|\/arcgis\/services|\/arcgis\/rest`;
const serverInfoExp = `(?<server>http.+(?:${validArcgisRestServicePath})(?:\/?.*\/(?<name>.*)\/(?<type>${serverTypes})))(?!.*\/${serverTypes})\/?(?<soe>\\d+)?.*`;
/** Returns an array containing the input url, base server url, server name, server type, and layer index (if entered).
 * Example: [
 * "https://sampleserver6.arcgisonline.com/arcgis/rest/services/FeatureServer/500",
 * "https://sampleserver6.arcgisonline.com/arcgis/rest/services/TestService/FeatureServer",
 * "TestService",
 * "FeatureServer",
 * "500"
 * ]  */
const regexServerInfo = new RegExp(serverInfoExp, "i");

const parseAGSServerInfo = (url) => {
    const extractedInfo = url.match(regexServerInfo);
    if (!extractedInfo) {
        const containsAGS = url.match(agsRegExp);
        // Type is always MapServer for /ags/ services
        return containsAGS ? { baseServerUrl: url, serverName: null, serverType: "MapServer", index: null } : null;
    }
    const [, baseServerUrl, serverName, serverType, indexStr] = extractedInfo;
    const index = parseInt(indexStr);
    return { baseServerUrl, serverName, serverType, index: isNaN(index) ? null : index };
};
const getRestUrlFromUrl = (url) => {
    if (!url) {
        return null;
    }
    const extractedInfo = url.match(validArcgisRestServicePath);
    if (!extractedInfo) {
        return null;
    }
    const urlParts = url.split("/rest");
    return urlParts.length < 2 ? null : `${urlParts[0]}/rest/`;
};
const addTrailingSlashIfMissing = (url) => url && url.charAt(url.length - 1) !== "/" ? `${url}/` : url;



//# sourceMappingURL=url-4c3ae54c.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTNmZjEyZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDckQ7QUFDSztBQUNFO0FBQ2xDO0FBQ0Q7QUFDRDtBQUNFO0FBQ0Y7O0FBRTNCLGdHQUFnRyxhQUFhLDZFQUE2RSw2REFBNkQ7O0FBRXZQO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qix1Q0FBdUMscURBQVc7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixxREFBbUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixlQUFlLEVBQUUsa0RBQVc7QUFDNUM7QUFDQSxnQkFBZ0Isa0NBQWtDO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLFlBQVksMERBQVk7QUFDeEI7QUFDQSxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLDRCQUE0Qiw4RUFBOEUsUUFBUSxFQUFFLHFEQUFDLG1CQUFtQix1R0FBdUc7QUFDOVEsb0JBQW9CLHFEQUFDLHdCQUF3QjtBQUM3QztBQUNBO0FBQ0EsaUJBQWlCLHVDQUF1QyxFQUFFLHFEQUFDLG1CQUFtQixvR0FBb0c7QUFDbEwsU0FBUztBQUNUO0FBQ0EsZUFBZSxPQUFPLHFEQUFVO0FBQ2hDO0FBQ0E7O0FBRXlGOztBQUV6Rjs7Ozs7Ozs7Ozs7Ozs7OztBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUN1RDs7QUFFdkQsb0JBQW9CLHFEQUFXO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7O0FBRWlEOztBQUVqRDs7Ozs7Ozs7Ozs7Ozs7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQzZFOztBQUU3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsZUFBZSxpREFBZTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHFEQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsaURBQVc7QUFDdEU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLHdEQUF3RCxpREFBVztBQUNuRTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtIQUFrSDtBQUNsSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVHQUF1RztBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU0Qjs7QUFFNUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3ZNQTtBQUNBO0FBQ0E7QUFDQTtBQUNtRTs7QUFFbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsbURBQXlCLFVBQVUsZUFBZSxPQUFPOztBQUU2Qzs7QUFFeEo7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDeUc7O0FBRXpHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MscUJBQXFCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG9EQUFlO0FBQzFDO0FBQ0E7QUFDQSw4QkFBOEIsb0RBQWE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsb0RBQW9CO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5Yjs7QUFFemI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDb0Q7O0FBRXBEO0FBQ0EsV0FBVyxxREFBUTtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFaUs7O0FBRWpLOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDMkU7O0FBRTNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsbURBQWlDO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFaUc7O0FBRWpHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzR0FBc0c7QUFDdEc7QUFDQTs7QUFFQTtBQUNBLCtDQUErQyxZQUFZO0FBQzNEO0FBQ0EsNENBQTRDLDJCQUEyQixrQ0FBa0MsWUFBWSxZQUFZLFlBQVk7QUFDN0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsNkVBQTZFO0FBQzVHO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxZQUFZO0FBQ3ZEO0FBQ0EsMEZBQTBGLElBQUk7O0FBRXNIOztBQUVwTiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWNvbnRlbnQtdHlwZS5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jb25maWctNzVhZGY5NjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaW5kZXgtMDU5NTZjYWIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS0zNTM1NTUyZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JlLTdmYTI2NDcyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JlLThiMWIwODQ2LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3VybC00YzNhZTU0Yy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEl0ZW1Ccm93c2VyU3RvcmUgfSBmcm9tICcuL3N0b3JlLTdmYTI2NDcyLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9zdG9yZS04YjFiMDg0Ni5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDb250ZW50VHlwZUNzcyA9IFwiLmhpZGUuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItY29udGVudC10eXBle2Rpc3BsYXk6bm9uZX1jYWxjaXRlLWxpc3QtaXRlbS5zYy1hcmNnaXMtaXRlbS1icm93c2VyLWZpbHRlci1jb250ZW50LXR5cGU6bm90KFtzZWxlY3RlZF0pey0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTE6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDb250ZW50VHlwZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gXCJhbGxPcmdDb250ZW50XCI7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29udGVudFR5cGVzID0gW1wiYWxsT3JnQ29udGVudFwiLCBcInJlY3ljbGVcIl07XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckNvbnRlbnRUeXBlO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5leHBhbmRlZCAmJiB0aGlzLmFjY29yZGlvbkl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuYWNjb3JkaW9uSXRlbS5leHBhbmRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJjb250ZW50VHlwZVwiLFxuICAgICAgICAgICAgcGFyYW06IFwicVwiLFxuICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICBsYWJlbDogdGhpcy5pMThuLmFsbE9yZ0NvbnRlbnQsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogdGhpcy5jb250ZW50VHlwZVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgYnVja2V0ID0gdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQ7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgY29udGVudFR5cGUsIGNvbnRlbnRUeXBlcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaGlkZSA9ICF1c2VyIHx8XG4gICAgICAgICAgICAhY29udGVudFR5cGUgfHxcbiAgICAgICAgICAgIChidWNrZXQgJiYgYnVja2V0ICE9PSBcIm9yZ1wiKSB8fFxuICAgICAgICAgICAgaXNQdWJsaWNVc2VyKHVzZXIpIHx8XG4gICAgICAgICAgICAocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlzUG9ydGFsKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiBpMThuLmNvbnRlbnRUeXBlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgbm9QYWRkaW5nOiB0cnVlLCBjbGFzczogeyBoaWRlIH0gfSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IHNlbGVjdGlvbkFwcGVhcmFuY2U6IFwiYm9yZGVyXCIsIHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIGxvYWRpbmc6ICFjb250ZW50VHlwZSwgY2xhc3M6IFwiY29udGVudC10eXBlc1wiIH0sIGNvbnRlbnRUeXBlcy5tYXAoKHR5cGUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgY2xhc3M6IFwiY29udGVudC10eXBlXCIsIGxhYmVsOiBpMThuW3R5cGVdLCB2YWx1ZTogdHlwZSwga2V5OiB0eXBlLCBvbkNhbGNpdGVMaXN0SXRlbVNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgICAgICAgICAgfSwgc2VsZWN0ZWQ6IHRoaXMuY29udGVudFR5cGUgPT09IHR5cGUgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IHR5cGUgPT09IFwiYWxsT3JnQ29udGVudFwiID8gXCJvcmdhbml6YXRpb25cIiA6IFwicmVjeWNsZS1iaW5cIiwgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIHNjYWxlOiBcInNcIiB9KSkpO1xuICAgICAgICB9KSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbnRlbnRUeXBlLnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDb250ZW50VHlwZUNzcztcblxuZXhwb3J0IHsgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDb250ZW50VHlwZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9jb250ZW50X3R5cGUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItY29udGVudC10eXBlLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuXG5jb25zdCBjb25maWdTdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICBwb3J0YWw6IG51bGwsXG4gICAgdXNlcjogbnVsbCxcbiAgICBhcGk6IDQsXG4gICAgc2NhbGU6IFwibVwiXG59KTtcbmNvbnN0IGNvbmZpZ1N0YXRlID0gY29uZmlnU3RvcmUuc3RhdGU7XG5jb25zdCBvbkNvbmZpZ0NoYW5nZSA9IGNvbmZpZ1N0b3JlLm9uQ2hhbmdlO1xuXG5leHBvcnQgeyBjb25maWdTdGF0ZSBhcyBjLCBvbkNvbmZpZ0NoYW5nZSBhcyBvIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbmZpZy03NWFkZjk2Mi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVuZGVyaW5nUmVmLCBmIGFzIGZvcmNlVXBkYXRlIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbmNvbnN0IGFwcGVuZFRvTWFwID0gKG1hcCwgcHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgY29uc3QgaXRlbXMgPSBtYXAuZ2V0KHByb3BOYW1lKTtcbiAgICBpZiAoIWl0ZW1zKSB7XG4gICAgICAgIG1hcC5zZXQocHJvcE5hbWUsIFt2YWx1ZV0pO1xuICAgIH1cbiAgICBlbHNlIGlmICghaXRlbXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgIGl0ZW1zLnB1c2godmFsdWUpO1xuICAgIH1cbn07XG5jb25zdCBkZWJvdW5jZSA9IChmbiwgbXMpID0+IHtcbiAgICBsZXQgdGltZW91dElkO1xuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAodGltZW91dElkKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgfVxuICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRpbWVvdXRJZCA9IDA7XG4gICAgICAgICAgICBmbiguLi5hcmdzKTtcbiAgICAgICAgfSwgbXMpO1xuICAgIH07XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIGEgcG9zc2libGUgZWxlbWVudCBpc0Nvbm5lY3RlZC5cbiAqIFRoZSBwcm9wZXJ0eSBtaWdodCBub3QgYmUgdGhlcmUsIHNvIHdlIGNoZWNrIGZvciBpdC5cbiAqXG4gKiBXZSB3YW50IGl0IHRvIHJldHVybiB0cnVlIGlmIGlzQ29ubmVjdGVkIGlzIG5vdCBhIHByb3BlcnR5LFxuICogb3RoZXJ3aXNlIHdlIHdvdWxkIHJlbW92ZSB0aGVzZSBlbGVtZW50cyBhbmQgd291bGQgbm90IHVwZGF0ZS5cbiAqXG4gKiBCZXR0ZXIgbGVhayBpbiBFZGdlIHRoYW4gdG8gYmUgdXNlbGVzcy5cbiAqL1xuY29uc3QgaXNDb25uZWN0ZWQgPSAobWF5YmVFbGVtZW50KSA9PiAhKCdpc0Nvbm5lY3RlZCcgaW4gbWF5YmVFbGVtZW50KSB8fCBtYXliZUVsZW1lbnQuaXNDb25uZWN0ZWQ7XG5jb25zdCBjbGVhbnVwRWxlbWVudHMgPSBkZWJvdW5jZSgobWFwKSA9PiB7XG4gICAgZm9yIChsZXQga2V5IG9mIG1hcC5rZXlzKCkpIHtcbiAgICAgICAgbWFwLnNldChrZXksIG1hcC5nZXQoa2V5KS5maWx0ZXIoaXNDb25uZWN0ZWQpKTtcbiAgICB9XG59LCAyMDAwKTtcbmNvbnN0IHN0ZW5jaWxTdWJzY3JpcHRpb24gPSAoKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBnZXRSZW5kZXJpbmdSZWYgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgd2UgYXJlIG5vdCBpbiBhIHN0ZW5jaWwgcHJvamVjdCwgd2UgZG8gbm90aGluZy5cbiAgICAgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBub3QgcmVhbGx5IGV4cG9ydGVkIGJ5IEBzdGVuY2lsL2NvcmUuXG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY29uc3QgZWxtc1RvVXBkYXRlID0gbmV3IE1hcCgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRpc3Bvc2U6ICgpID0+IGVsbXNUb1VwZGF0ZS5jbGVhcigpLFxuICAgICAgICBnZXQ6IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxtID0gZ2V0UmVuZGVyaW5nUmVmKCk7XG4gICAgICAgICAgICBpZiAoZWxtKSB7XG4gICAgICAgICAgICAgICAgYXBwZW5kVG9NYXAoZWxtc1RvVXBkYXRlLCBwcm9wTmFtZSwgZWxtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZWxtc1RvVXBkYXRlLmdldChwcm9wTmFtZSk7XG4gICAgICAgICAgICBpZiAoZWxlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBlbG1zVG9VcGRhdGUuc2V0KHByb3BOYW1lLCBlbGVtZW50cy5maWx0ZXIoZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgICAgICByZXNldDogKCkgPT4ge1xuICAgICAgICAgICAgZWxtc1RvVXBkYXRlLmZvckVhY2goKGVsbXMpID0+IGVsbXMuZm9yRWFjaChmb3JjZVVwZGF0ZSkpO1xuICAgICAgICAgICAgY2xlYW51cEVsZW1lbnRzKGVsbXNUb1VwZGF0ZSk7XG4gICAgICAgIH0sXG4gICAgfTtcbn07XG5cbmNvbnN0IHVud3JhcCA9ICh2YWwpID0+ICh0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nID8gdmFsKCkgOiB2YWwpO1xuY29uc3QgY3JlYXRlT2JzZXJ2YWJsZU1hcCA9IChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSA9IChhLCBiKSA9PiBhICE9PSBiKSA9PiB7XG4gICAgY29uc3QgdW53cmFwcGVkU3RhdGUgPSB1bndyYXAoZGVmYXVsdFN0YXRlKTtcbiAgICBsZXQgc3RhdGVzID0gbmV3IE1hcChPYmplY3QuZW50cmllcyh1bndyYXBwZWRTdGF0ZSAhPT0gbnVsbCAmJiB1bndyYXBwZWRTdGF0ZSAhPT0gdm9pZCAwID8gdW53cmFwcGVkU3RhdGUgOiB7fSkpO1xuICAgIGNvbnN0IGhhbmRsZXJzID0ge1xuICAgICAgICBkaXNwb3NlOiBbXSxcbiAgICAgICAgZ2V0OiBbXSxcbiAgICAgICAgc2V0OiBbXSxcbiAgICAgICAgcmVzZXQ6IFtdLFxuICAgIH07XG4gICAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gV2hlbiByZXNldHRpbmcgdGhlIHN0YXRlLCB0aGUgZGVmYXVsdCBzdGF0ZSBtYXkgYmUgYSBmdW5jdGlvbiAtIHVud3JhcCBpdCB0byBpbnZva2UgaXQuXG4gICAgICAgIC8vIG90aGVyd2lzZSwgdGhlIHN0YXRlIHdvbid0IGJlIHByb3Blcmx5IHJlc2V0XG4gICAgICAgIHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMoKF9hID0gdW53cmFwKGRlZmF1bHRTdGF0ZSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHt9KSk7XG4gICAgICAgIGhhbmRsZXJzLnJlc2V0LmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICB9O1xuICAgIGNvbnN0IGRpc3Bvc2UgPSAoKSA9PiB7XG4gICAgICAgIC8vIENhbGwgZmlyc3QgZGlzcG9zZSBhcyByZXNldHRpbmcgdGhlIHN0YXRlIHdvdWxkXG4gICAgICAgIC8vIGNhdXNlIGxlc3MgdXBkYXRlcyA7KVxuICAgICAgICBoYW5kbGVycy5kaXNwb3NlLmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICB9O1xuICAgIGNvbnN0IGdldCA9IChwcm9wTmFtZSkgPT4ge1xuICAgICAgICBoYW5kbGVycy5nZXQuZm9yRWFjaCgoY2IpID0+IGNiKHByb3BOYW1lKSk7XG4gICAgICAgIHJldHVybiBzdGF0ZXMuZ2V0KHByb3BOYW1lKTtcbiAgICB9O1xuICAgIGNvbnN0IHNldCA9IChwcm9wTmFtZSwgdmFsdWUpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KHByb3BOYW1lKTtcbiAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSh2YWx1ZSwgb2xkVmFsdWUsIHByb3BOYW1lKSkge1xuICAgICAgICAgICAgc3RhdGVzLnNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgaGFuZGxlcnMuc2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSwgdmFsdWUsIG9sZFZhbHVlKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHN0YXRlID0gKHR5cGVvZiBQcm94eSA9PT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgPyB7fVxuICAgICAgICA6IG5ldyBQcm94eSh1bndyYXBwZWRTdGF0ZSwge1xuICAgICAgICAgICAgZ2V0KF8sIHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldChwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3duS2V5cyhfKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oc3RhdGVzLmtleXMoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhcyhfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZXMuaGFzKHByb3BOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQoXywgcHJvcE5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2V0KHByb3BOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSk7XG4gICAgY29uc3Qgb24gPSAoZXZlbnROYW1lLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICBoYW5kbGVyc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgcmVtb3ZlRnJvbUFycmF5KGhhbmRsZXJzW2V2ZW50TmFtZV0sIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IG9uQ2hhbmdlID0gKHByb3BOYW1lLCBjYikgPT4ge1xuICAgICAgICBjb25zdCB1blNldCA9IG9uKCdzZXQnLCAoa2V5LCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYihuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHVud3JhcCB0aGUgZGVmYXVsdFN0YXRlIGJlY2F1c2UgaXQgbWlnaHQgYmUgYSBmdW5jdGlvbi5cbiAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIG1pZ2h0IG5vdCBiZSBzZW5kaW5nIHRoZSByaWdodCByZXNldCB2YWx1ZS5cbiAgICAgICAgY29uc3QgdW5SZXNldCA9IG9uKCdyZXNldCcsICgpID0+IGNiKHVud3JhcChkZWZhdWx0U3RhdGUpW3Byb3BOYW1lXSkpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgdW5TZXQoKTtcbiAgICAgICAgICAgIHVuUmVzZXQoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IHVzZSA9ICguLi5zdWJzY3JpcHRpb25zKSA9PiB7XG4gICAgICAgIGNvbnN0IHVuc3VicyA9IHN1YnNjcmlwdGlvbnMucmVkdWNlKCh1bnN1YnMsIHN1YnNjcmlwdGlvbikgPT4ge1xuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5zZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignc2V0Jywgc3Vic2NyaXB0aW9uLnNldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5nZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbignZ2V0Jywgc3Vic2NyaXB0aW9uLmdldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5yZXNldCkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdyZXNldCcsIHN1YnNjcmlwdGlvbi5yZXNldCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5kaXNwb3NlKSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2Rpc3Bvc2UnLCBzdWJzY3JpcHRpb24uZGlzcG9zZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuc3VicztcbiAgICAgICAgfSwgW10pO1xuICAgICAgICByZXR1cm4gKCkgPT4gdW5zdWJzLmZvckVhY2goKHVuc3ViKSA9PiB1bnN1YigpKTtcbiAgICB9O1xuICAgIGNvbnN0IGZvcmNlVXBkYXRlID0gKGtleSkgPT4ge1xuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHN0YXRlcy5nZXQoa2V5KTtcbiAgICAgICAgaGFuZGxlcnMuc2V0LmZvckVhY2goKGNiKSA9PiBjYihrZXksIG9sZFZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGdldCxcbiAgICAgICAgc2V0LFxuICAgICAgICBvbixcbiAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgIHVzZSxcbiAgICAgICAgZGlzcG9zZSxcbiAgICAgICAgcmVzZXQsXG4gICAgICAgIGZvcmNlVXBkYXRlLFxuICAgIH07XG59O1xuY29uc3QgcmVtb3ZlRnJvbUFycmF5ID0gKGFycmF5LCBpdGVtKSA9PiB7XG4gICAgY29uc3QgaW5kZXggPSBhcnJheS5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIGFycmF5W2luZGV4XSA9IGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdO1xuICAgICAgICBhcnJheS5sZW5ndGgtLTtcbiAgICB9XG59O1xuXG5jb25zdCBjcmVhdGVTdG9yZSA9IChkZWZhdWx0U3RhdGUsIHNob3VsZFVwZGF0ZSkgPT4ge1xuICAgIGNvbnN0IG1hcCA9IGNyZWF0ZU9ic2VydmFibGVNYXAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpO1xuICAgIG1hcC51c2Uoc3RlbmNpbFN1YnNjcmlwdGlvbigpKTtcbiAgICByZXR1cm4gbWFwO1xufTtcblxuZXhwb3J0IHsgY3JlYXRlU3RvcmUgYXMgYyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC0wNTk1NmNhYi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcblxuZnVuY3Rpb24gaXNFc3JpKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IGl0ZW0ub3duZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZXNyaVwiKSk7XG59XG5mdW5jdGlvbiBpc1ByZW1pdW0oaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gaXNFc3JpKGl0ZW0pICYmICEhKChfYSA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJSZXF1aXJlcyBDcmVkaXRzXCIpKTtcbn1cbmZ1bmN0aW9uIGlzU3Vic2NyaWJlcihpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIFN1YnNjcmlwdGlvblwiKSk7XG59XG5mdW5jdGlvbiBpc093bmVyKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gaXRlbS5vd25lciA9PT0gdXNlci51c2VybmFtZTtcbn1cbi8qKlxuICogQ2FuIHRoZSB1c2VyIHVwZGF0ZSB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHx8IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwidXBkYXRlXCI7XG59XG4vKipcbiAqIElzIHRoZSB1c2VyIGVpdGhlciBhbiBvd25lciBvciBhZG1pbiBvZiB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpc093bmVyKGl0ZW0sIHVzZXIpIHx8IGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpO1xufVxuLyoqXG4gKiBEb2VzIHRoZSB1c2VyIGhhdmUgYWRtaW4gY2FwYWJpbGl0aWVzIG9uIHRoaXMgaXRlbVxuICovXG5mdW5jdGlvbiBpc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGlmIHRoaXMgZmxhZyBpcyBhbHJlYWR5IHNldCAocHJvYmFibHkgaG9tZSBhcHApLCB1c2UgaXRcbiAgICBpZiAoaXRlbS5pc0FkbWluICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICEhaXRlbS5pc0FkbWluO1xuICAgIH1cbiAgICBjb25zdCBpdGVtT3duZXIgPSBpdGVtLm93bmVyO1xuICAgIGNvbnN0IGl0ZW1Db250cm9sQWRtaW4gPSBpdGVtLml0ZW1Db250cm9sID09PSBcImFkbWluXCI7XG4gICAgY29uc3QgZXNyaVVzZXJzID0gW1wiZXNyaV9saXZpbmdhdGxhc1wiLCBcImVzcmlfZGVtb2dyYXBoaWNzXCIsIFwiZXNyaV9ib3VuZGFyaWVzXCJdO1xuICAgIGlmICgoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiZcbiAgICAgICAgIWlzT3duZXIoaXRlbSwgdXNlcikgJiZcbiAgICAgICAgaXRlbUNvbnRyb2xBZG1pbiAmJlxuICAgICAgICBpdGVtT3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJlxuICAgICAgICAvLyBwb3J0YWwgaW5jb3JyZWN0bHkgcmV0dXJucyBcIml0ZW1Db250cm9sPVwiYWRtaW5cIiBmb3IgZXNyaSBvd25lZCBpdGVtc1xuICAgICAgICAhZXNyaVVzZXJzLmluY2x1ZGVzKGl0ZW1Pd25lcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUNvbnRyb2xBZG1pbjtcbn1cbmNvbnN0IGl0ZW1zQmVsb25nVG9Vc2VyT3JnID0gKGl0ZW1zLCB1c2VyKSA9PiB7XG4gICAgcmV0dXJuICEhdXNlci5vcmdJZCAmJiBpdGVtcy5ldmVyeSgoaXRlbSkgPT4gaXRlbS5pc09yZ0l0ZW0pO1xufTtcbmNvbnN0IGdldEl0ZW1Ib21lQXBwVXJsID0gKGl0ZW1JZCwgYmFzZVVybCkgPT4gYCR7YWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhiYXNlVXJsKX1pdGVtLmh0bWw/aWQ9JHtpdGVtSWR9YDtcblxuZXhwb3J0IHsgaXNTdWJzY3JpYmVyIGFzIGEsIGlzUHJlbWl1bSBhcyBiLCBjYW5VcGRhdGVJdGVtIGFzIGMsIGl0ZW1zQmVsb25nVG9Vc2VyT3JnIGFzIGQsIGdldEl0ZW1Ib21lQXBwVXJsIGFzIGcsIGlzT3duZXIgYXMgaSwgdXNlcklzSXRlbUFkbWluIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS0zNTM1NTUyZC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHUgYXMgdXNlcklzSXRlbUFkbWluLCBjIGFzIGNhblVwZGF0ZUl0ZW0sIGQgYXMgaXRlbXNCZWxvbmdUb1VzZXJPcmcgfSBmcm9tICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuXG5jb25zdCBnZXRVc2VyUm9sZSA9ICh1c2VyKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIHR5cGVvZiAodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGUpID09PSBcInN0cmluZ1wiICYmICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlKVxuICAgICAgICA/IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlXG4gICAgICAgIDogKF9iID0gKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGVJZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLmlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlkO1xufTtcbmZ1bmN0aW9uIGlzUHVibGljVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXIgJiYgIXVzZXIub3JnSWQ7XG59XG5mdW5jdGlvbiBpc0hvc3RlZFBvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gIXBvcnRhbC5pc1BvcnRhbCB8fCAhIXBvcnRhbC5pc0JhY2tlZEJ5U0RTO1xufVxuZnVuY3Rpb24gaXNEZXZlbG9wZXIoc3Vic2NyaXB0aW9uSW5mbykge1xuICAgIGNvbnN0IGRldlN1YnNjcmlwdGlvblR5cGVzID0gW1wiVHJpYWwgRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyIFN1YnNjcmlwdGlvblwiXTtcbiAgICByZXR1cm4gZGV2U3Vic2NyaXB0aW9uVHlwZXMuaW5jbHVkZXMoc3Vic2NyaXB0aW9uSW5mbyA9PT0gbnVsbCB8fCBzdWJzY3JpcHRpb25JbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xufVxuZnVuY3Rpb24gaXNPcmdBZG1pbih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ19hZG1pblwiIHx8IGdldFVzZXJSb2xlKHVzZXIpID09PSBcImFjY291bnRfYWRtaW5cIjtcbn1cbmZ1bmN0aW9uIGlzT3JnVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ191c2VyXCIgfHwgZ2V0VXNlclJvbGUodXNlcikgPT09IFwiYWNjb3VudF91c2VyXCI7XG59XG5mdW5jdGlvbiBpc0N1c3RvbVJvbGUodXNlcikge1xuICAgIC8vIFRoZSBIb21lIEFwcCBjb2xsYXBzZSB0aGUgYHJvbGVJZGAgYW5kIGByb2xlYCBpbnRvIGEgc2luZ2xlIGBpZGAgcHJvcGVydHksIHRoYXQncyB3aHlcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvYmxvYi9tYXN0ZXIvc3JjL2pzL2FyY2dpc29ubGluZS9zaGFyaW5nL2Rpaml0L1JvbGUudHMjTDQ2OSB3b3Jrc1xuICAgIC8vIEluIHByYWN0aWNlLCB3ZSBvbmx5IG5lZWQgdG8gY2hlY2sgaWYgYHJvbGVJZGAgZXhpc3RcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ0NjgyI2lzc3VlY29tbWVudC00MTQ2ODY2XG4gICAgcmV0dXJuICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlSWQpICYmIHVzZXIucm9sZUlkLmxlbmd0aCA+IDA7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBwcml2aWxlZ2UgXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbUNhdGVnb3J5U2NoZW1hXCIgaXMgZ3JhbnRlZC5cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXModXNlcikge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtQ2F0ZWdvcnlTY2hlbWFcIikpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgcHJpdmlsZWdlIFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiIGlzIGdyYW50ZWQuXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0dyb3Vwcyh1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gdXBkYXRlIG90aGVyIHVzZXIncyBpdGVtcyBpbiB0aGVpciBvcmdhbml6YXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3MgdG8gZW5zdXJlIHRoZSBwb3J0YWwgaXMgYW4gb3JnYW5pemF0aW9uIHBvcnRhbFxuICovXG5mdW5jdGlvbiBpc09yZ1BvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gISEocG9ydGFsLnVybEtleSAmJiBwb3J0YWwuY3VzdG9tQmFzZVVybCkgfHwgISFwb3J0YWwuaXNQb3J0YWw7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gc2hhcmUgdGhlaXIgaXRlbSB0byBncm91cHNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9Hcm91cCh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9Hcm91cFwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIGFuIGl0ZW0gb24gYSBnaXZlbiBwb3J0YWxcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmUodXNlciwgcG9ydGFsKSB7XG4gICAgcmV0dXJuICghaXNPcmdQb3J0YWwocG9ydGFsKSB8fFxuICAgICAgICBjYW5TaGFyZUl0ZW1Ub0dyb3VwKHVzZXIpIHx8XG4gICAgICAgIGNhblNoYXJlSXRlbVRvT3JnKHVzZXIpIHx8XG4gICAgICAgICghIXBvcnRhbC5jYW5TaGFyZVB1YmxpYyAmJiBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyh1c2VyKSkpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gb3QgdGhlIG9yZ2FuaXphdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvT3JnXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gdG8gcHVibGljXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvUHVibGljKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb09yZ1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBhZG1pbkNhblNoYXJlT3RoZXJzSXRlbVRvR3JvdXAodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb0dyb3VwXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBpbiBhbiBhbGxvd2VkIG9yZ2FuaXphdGlvbiBhbmQgaGFzIHRoZSBwb3dlciB0byBtYW5hZ2UgY29sbGFib3JhdGlvbnNcbiAqL1xuZnVuY3Rpb24gY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMoY29uZmlnLCB1c2VyLCBwb3J0YWwsIHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICBjb25zdCBleGNsdWRlZE9yZ1R5cGVzID0gW1wiVHJpYWxcIiwgXCJUcmlhbCBQcmVzc1wiLCBcIlRyaWFsIERldmVsb3BlclwiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIiwgXCJFdmFsdWF0aW9uXCJdO1xuICAgIGNvbnN0IGlzVmFsaWRPcmdUeXBlID0gc3Vic2NyaXB0aW9uSW5mbyAmJiAhZXhjbHVkZWRPcmdUeXBlcy5pbmNsdWRlcyhzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xuICAgIGNvbnN0IGhhc1ByaXZpbGVnZSA9ICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjptYW5hZ2VDb2xsYWJvcmF0aW9uc1wiKTtcbiAgICByZXR1cm4gISEoKGNvbmZpZyA9PT0gbnVsbCB8fCBjb25maWcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZy5jb2xsYWJvcmF0aW9uc0VuYWJsZWQpICYmXG4gICAgICAgIHVzZXIgJiZcbiAgICAgICAgKGlzT3JnQWRtaW4odXNlcikgfHwgaGFzUHJpdmlsZWdlKSAmJlxuICAgICAgICAoKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgfHwgaXNWYWxpZE9yZ1R5cGUpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHZpZXcgb3RoZXIgb3JnYW5pemF0aW9uIHVzZXJzJyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5WaWV3T3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dmlld0l0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gdmlldyBvdGhlciBvcmdhbml6YXRpb24gdXNlcnMnIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblZpZXdPdGhlcnNPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICEhdXNlciAmJiAoIWlzQ3VzdG9tUm9sZSh1c2VyKSB8fCAoaXNDdXN0b21Sb2xlKHVzZXIpICYmIGNhblZpZXdPcmdJdGVtcyh1c2VyKSkpO1xufVxuLy8gVE9ETzogYWRkIHVuaXQgdGVzdHNcbmNvbnN0IGhhc0FkbWluU2hhcmVQcml2aWxlZ2UgPSAoeyBpdGVtcywgdXNlciwgcG9ydGFsIH0pID0+IHtcbiAgICBjb25zdCBpdGVtID0gaXRlbXNbMF07XG4gICAgLy8gZW50ZXJwcmlzZSBpbmNvcnJlY3RseSByZXR1cm5zIGl0ZW1zIG93bmVkIGJ5IFwiZXNyaV9cIiBhcyBpdGVtIGNvbnRyb2wgYWRtaW4gKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzODY5NSlcbiAgICBjb25zdCBvd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3Qgd2hpdGVsaXN0T3duZXIgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCJdO1xuICAgIGlmIChwb3J0YWwuaXNQb3J0YWwgJiYgb3duZXIgIT09IHVzZXIudXNlcm5hbWUgJiYgb3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJiAhd2hpdGVsaXN0T3duZXIuaW5jbHVkZXMob3duZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgaXNPd25lck9yQWRtaW4gPSB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG4gICAgY29uc3QgaXNDdXN0b20gPSBpc0N1c3RvbVJvbGUodXNlcik7XG4gICAgY29uc3QgY2FuU2hhcmVPcmdJdGVtcyA9IGNhblNoYXJlT3RoZXJzSXRlbXModXNlcik7XG4gICAgY29uc3QgY2FuVXBkYXRlQW5kU2hhcmUgPSBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpICYmXG4gICAgICAgIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpICYmXG4gICAgICAgICFpc0N1c3RvbSAmJlxuICAgICAgICAoY2FuU2hhcmUodXNlciwgcG9ydGFsKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpKTtcbiAgICAvLyBpZiBpdCdzIHRoZSBpdGVtIG93bmVyIG9yIGFkbWluLCBvciBjdXN0b20gYWRtaW4gd2hvIGNhbiBzaGFyZVxuICAgIHJldHVybiBpc093bmVyT3JBZG1pbiB8fCBjYW5VcGRhdGVBbmRTaGFyZSB8fCAoaXRlbXNCZWxvbmdUb1VzZXJPcmcoaXRlbXMsIHVzZXIpICYmIGNhblNoYXJlT3JnSXRlbXMpO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwKHVzZXIpIHx8IGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyh1c2VyKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcik7XG59XG5cbmV4cG9ydCB7IGlzUHVibGljVXNlciBhcyBhLCBpc09yZ0FkbWluIGFzIGIsIGlzSG9zdGVkUG9ydGFsIGFzIGMsIGlzQ3VzdG9tUm9sZSBhcyBkLCBjYW5VcGRhdGVPcmdHcm91cHMgYXMgZSwgY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXMgYXMgZiwgY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMgYXMgZywgaXNPcmdVc2VyIGFzIGgsIGlzRGV2ZWxvcGVyIGFzIGksIGNhblNoYXJlSXRlbVRvR3JvdXAgYXMgaiwgY2FuU2hhcmVJdGVtVG9PcmcgYXMgaywgYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwIGFzIGwsIGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyBhcyBtLCBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyBhcyBuLCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWMgYXMgbywgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSBhcyBwLCBjYW5WaWV3T3RoZXJzT3JnSXRlbXMgYXMgcSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcml2aWxlZ2VzLTVjMzgyZjYxLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRTdG9yZSB9IGZyb20gJy4vc3RvcmUtOGIxYjA4NDYuanMnO1xuXG5mdW5jdGlvbiBnZXRJdGVtQnJvd3NlclN0b3JlKGVsKSB7XG4gICAgcmV0dXJuIGdldFN0b3JlKGVsLCBcImFyY2dpcy1pdGVtLWJyb3dzZXJcIik7XG59XG5jb25zdCBvbkl0ZW1Ccm93c2VyVmlld0NoYW5nZSA9IChzdG9yZSwgY2FsbGJhY2spID0+IHtcbiAgICBzdG9yZS5vbkNoYW5nZShcInZpZXdcIiwgKG5ld1ZpZXcpID0+IHtcbiAgICAgICAgY2FsbGJhY2sobmV3Vmlldyk7XG4gICAgfSk7XG59O1xuY29uc3Qgb25JdGVtQnJvd3NlckJ1Y2tldENoYW5nZSA9IChzdG9yZSwgY2FsbGJhY2spID0+IHtcbiAgICBzdG9yZS5vbkNoYW5nZShcImJ1Y2tldFwiLCAobmV3QnVja2V0KSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG5ld0J1Y2tldCk7XG4gICAgfSk7XG59O1xuY29uc3Qgb25JdGVtQnJvd3NlclByZXZpZXdDaGFuZ2UgPSAoc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gICAgc3RvcmUub25DaGFuZ2UoXCJwcmV2aWV3XCIsIChwcmV2aWV3KSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKHByZXZpZXcpO1xuICAgIH0pO1xufTtcbmNvbnN0IG9uSXRlbUJyb3dzZXJTb3J0Q2hhbmdlID0gKHN0b3JlLCBjYWxsYmFjaykgPT4ge1xuICAgIHN0b3JlLm9uQ2hhbmdlKFwic29ydFwiLCAoc29ydCkgPT4ge1xuICAgICAgICBjYWxsYmFjayhzb3J0KTtcbiAgICB9KTtcbn07XG5cbmV4cG9ydCB7IG9uSXRlbUJyb3dzZXJTb3J0Q2hhbmdlIGFzIGEsIG9uSXRlbUJyb3dzZXJQcmV2aWV3Q2hhbmdlIGFzIGIsIG9uSXRlbUJyb3dzZXJWaWV3Q2hhbmdlIGFzIGMsIGdldEl0ZW1Ccm93c2VyU3RvcmUgYXMgZywgb25JdGVtQnJvd3NlckJ1Y2tldENoYW5nZSBhcyBvIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0b3JlLTdmYTI2NDcyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmNvbnN0IG9uQnJvd3NlckZpbHRlclJlbW92ZSA9IChpZCwgc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHN0b3JlLm9uQ2hhbmdlKFwiZmlsdGVyc1wiLCAoZmlsdGVycykgPT4ge1xuICAgICAgICBpZiAoIWZpbHRlcnNbaWRdIHx8ICFmaWx0ZXJzW2lkXS52YWx1ZSkge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcbmNvbnN0IG9uUHJldmlld0NoYW5nZSA9IChzdG9yZSwgY2FsbGJhY2spID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgc3RvcmUub25DaGFuZ2UoXCJwcmV2aWV3XCIsIChwcmV2aWV3KSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG59O1xuY29uc3Qgb25Hcm91cElkQ2hhbmdlID0gKHN0b3JlLCBjYWxsYmFjaykgPT4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBzdG9yZS5vbkNoYW5nZShcImdyb3VwSWRcIiwgKHByZXZpZXcpID0+IHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbn07XG5jb25zdCBTVE9SRV9MT09LVVAgPSBuZXcgTWFwKCk7XG5mdW5jdGlvbiBnZXRTdG9yZShlbCwgYnJvd3NlclRhZykge1xuICAgIGNvbnN0IGV4aXN0aW5nU3RvcmUgPSBTVE9SRV9MT09LVVAuZ2V0KGVsKTtcbiAgICBpZiAoZXhpc3RpbmdTdG9yZSkge1xuICAgICAgICByZXR1cm4gZXhpc3RpbmdTdG9yZTtcbiAgICB9XG4gICAgY29uc3QgYnJvd3NlciA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYnJvd3NlclRhZyk7XG4gICAgaWYgKGJyb3dzZXIpIHtcbiAgICAgICAgU1RPUkVfTE9PS1VQLnNldChlbCwgYnJvd3Nlci5zdG9yZSk7XG4gICAgICAgIHJldHVybiBicm93c2VyLnN0b3JlO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IHsgb25Ccm93c2VyRmlsdGVyUmVtb3ZlIGFzIGEsIG9uR3JvdXBJZENoYW5nZSBhcyBiLCBnZXRTdG9yZSBhcyBnLCBvblByZXZpZXdDaGFuZ2UgYXMgbyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9yZS04YjFiMDg0Ni5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IHNwZWNpYWxDaGFyYWN0ZXJzUmVnRXhwID0gL1xcK3xcXD98XFwvfFxcKHxcXCl8XFxcXHxcXCF8XFwjfFxcXCJ8XFx8fFxcKnxcXDp8PHw+fFxcJXxcXCR8XFxAfFxcJ3xcXF58XFxbfFxcXXxcXCx8XFw9fFxcOy9naTtcbmNvbnN0IGdlb0pzb25SZWdFeHAgPSAvKFxcLnxvdXRwdXRGb3JtYXQ9KWpzb258Z2VvanNvbiQvaTtcbmNvbnN0IGFnc1JlZ0V4cCA9IC9cXC9hZ3NcXC8vZ2k7XG5cbmNvbnN0IHNlcnZlclR5cGVzID0gXCJNYXBTZXJ2ZXJ8R2VvY29kZVNlcnZlcnxHUFNlcnZlcnxHZW9tZXRyeVNlcnZlcnxJbWFnZVNlcnZlcnxOQVNlcnZlcnxGZWF0dXJlU2VydmVyfEdlb0RhdGFTZXJ2ZXJ8R2xvYmVTZXJ2ZXJ8TW9iaWxlU2VydmVyfFdNU2VydmVyfFNjZW5lU2VydmVyfFZlY3RvclRpbGVTZXJ2ZXJ8U3RyZWFtU2VydmVyfFdvcmtzcGFjZVNlcnZlcnxHZW9lbnJpY2htZW50U2VydmVyfFZpZGVvU2VydmVyXCI7XG5jb25zdCByZWdleFNlcnZlclR5cGUgPSBuZXcgUmVnRXhwKGBodHRwLitcXC8oJHtzZXJ2ZXJUeXBlc30pYCk7XG5jb25zdCB2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCA9IGBcXC9hcmNnaXNcXC9yZXN0XFwvc2VydmljZXN8XFwvcmVzdFxcL3NlcnZpY2VzfFxcL2FyY2dpc1xcL3NlcnZpY2VzfFxcL2FyY2dpc1xcL3Jlc3RgO1xuY29uc3Qgc2VydmVySW5mb0V4cCA9IGAoPzxzZXJ2ZXI+aHR0cC4rKD86JHt2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aH0pKD86XFwvPy4qXFwvKD88bmFtZT4uKilcXC8oPzx0eXBlPiR7c2VydmVyVHlwZXN9KSkpKD8hLipcXC8ke3NlcnZlclR5cGVzfSlcXC8/KD88c29lPlxcXFxkKyk/LipgO1xuLyoqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgaW5wdXQgdXJsLCBiYXNlIHNlcnZlciB1cmwsIHNlcnZlciBuYW1lLCBzZXJ2ZXIgdHlwZSwgYW5kIGxheWVyIGluZGV4IChpZiBlbnRlcmVkKS5cbiAqIEV4YW1wbGU6IFtcbiAqIFwiaHR0cHM6Ly9zYW1wbGVzZXJ2ZXI2LmFyY2dpc29ubGluZS5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXMvRmVhdHVyZVNlcnZlci81MDBcIixcbiAqIFwiaHR0cHM6Ly9zYW1wbGVzZXJ2ZXI2LmFyY2dpc29ubGluZS5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXMvVGVzdFNlcnZpY2UvRmVhdHVyZVNlcnZlclwiLFxuICogXCJUZXN0U2VydmljZVwiLFxuICogXCJGZWF0dXJlU2VydmVyXCIsXG4gKiBcIjUwMFwiXG4gKiBdICAqL1xuY29uc3QgcmVnZXhTZXJ2ZXJJbmZvID0gbmV3IFJlZ0V4cChzZXJ2ZXJJbmZvRXhwLCBcImlcIik7XG5cbmNvbnN0IHBhcnNlQUdTU2VydmVySW5mbyA9ICh1cmwpID0+IHtcbiAgICBjb25zdCBleHRyYWN0ZWRJbmZvID0gdXJsLm1hdGNoKHJlZ2V4U2VydmVySW5mbyk7XG4gICAgaWYgKCFleHRyYWN0ZWRJbmZvKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zQUdTID0gdXJsLm1hdGNoKGFnc1JlZ0V4cCk7XG4gICAgICAgIC8vIFR5cGUgaXMgYWx3YXlzIE1hcFNlcnZlciBmb3IgL2Fncy8gc2VydmljZXNcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zQUdTID8geyBiYXNlU2VydmVyVXJsOiB1cmwsIHNlcnZlck5hbWU6IG51bGwsIHNlcnZlclR5cGU6IFwiTWFwU2VydmVyXCIsIGluZGV4OiBudWxsIH0gOiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBbLCBiYXNlU2VydmVyVXJsLCBzZXJ2ZXJOYW1lLCBzZXJ2ZXJUeXBlLCBpbmRleFN0cl0gPSBleHRyYWN0ZWRJbmZvO1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoaW5kZXhTdHIpO1xuICAgIHJldHVybiB7IGJhc2VTZXJ2ZXJVcmwsIHNlcnZlck5hbWUsIHNlcnZlclR5cGUsIGluZGV4OiBpc05hTihpbmRleCkgPyBudWxsIDogaW5kZXggfTtcbn07XG5jb25zdCBnZXRSZXN0VXJsRnJvbVVybCA9ICh1cmwpID0+IHtcbiAgICBpZiAoIXVybCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZXh0cmFjdGVkSW5mbyA9IHVybC5tYXRjaCh2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCk7XG4gICAgaWYgKCFleHRyYWN0ZWRJbmZvKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB1cmxQYXJ0cyA9IHVybC5zcGxpdChcIi9yZXN0XCIpO1xuICAgIHJldHVybiB1cmxQYXJ0cy5sZW5ndGggPCAyID8gbnVsbCA6IGAke3VybFBhcnRzWzBdfS9yZXN0L2A7XG59O1xuY29uc3QgYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyA9ICh1cmwpID0+IHVybCAmJiB1cmwuY2hhckF0KHVybC5sZW5ndGggLSAxKSAhPT0gXCIvXCIgPyBgJHt1cmx9L2AgOiB1cmw7XG5cbmV4cG9ydCB7IGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgYXMgYSwgZ2VvSnNvblJlZ0V4cCBhcyBiLCBhZ3NSZWdFeHAgYXMgYywgZ2V0UmVzdFVybEZyb21VcmwgYXMgZywgcGFyc2VBR1NTZXJ2ZXJJbmZvIGFzIHAsIHJlZ2V4U2VydmVyVHlwZSBhcyByLCBzcGVjaWFsQ2hhcmFjdGVyc1JlZ0V4cCBhcyBzLCB2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCBhcyB2IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVybC00YzNhZTU0Yy5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=