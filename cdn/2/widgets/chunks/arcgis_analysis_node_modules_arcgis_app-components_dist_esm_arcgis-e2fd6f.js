"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-e2fd6f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const addItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    typeKeywords: [],
    customParameters: [],
    analyzedLocationTypes: [],
    allowStoredAuth: true,
    isSecured: null,
    checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;



//# sourceMappingURL=add-item-dbbe2f57.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-layer.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-layer.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_select_layer: () => (/* binding */ ArcgisNewItemPagesAppendSelectLayer)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./analyze-69ec08c8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./geometries-6ca39907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./basic-6db7ebd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



















function validateLayers(dataLayers, item, layers, configStateProps, addItemStateProps) {
    const portal = configStateProps.portal;
    const serviceInfo = (item === null || item === void 0 ? void 0 : item.serviceInfo) || {};
    const adminServiceInfo = (item === null || item === void 0 ? void 0 : item.adminServiceInfo) || {};
    const capabilities = portal.isPortal && !item.isSDS
        ? serviceInfo.capabilities.split(",") // portal hosted feature layer w/o 'providerSDS' typeKeyword
        : adminServiceInfo.capabilities.split(","); // every other hosted feature layer impl,
    const changeTrackingEnabled = capabilities.includes("ChangeTracking");
    const syncEnabled = (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.syncEnabled) || false;
    const publishParameters = (addItemStateProps.analyzeResults && addItemStateProps.analyzeResults.publishParameters) || {};
    const isFGDB = publishParameters.type === "fileGeodatabase";
    const insertOnly = syncEnabled || changeTrackingEnabled;
    const serviceLayers = !insertOnly
        ? layers
        : layers.filter((serviceLayer) => {
            return dataLayers.some((dataLayer) => {
                return (dataLayer.geometryType === serviceLayer.geometryType ||
                    !serviceLayer.geometryType ||
                    (serviceLayer.geometryType === "esriGeometryPoint" && !isFGDB && !dataLayer.geometryType));
            });
        });
    if (!serviceLayers || !serviceLayers.length) {
        return null;
    }
    else {
        return dataLayers;
    }
}

const arcgisNewItemPagesAppendSelectLayerCss = ":host{position:relative;display:flex;height:100%;max-width:100%;flex-direction:column;background-color:var(--calcite-color-background)}.search-bar{margin-left:auto;margin-right:auto;display:flex;padding-right:1rem;padding-left:2rem;max-width:var(--item-browser-max-width)}.x{position:absolute;z-index:10;cursor:pointer;border-style:none;background-color:transparent;color:var(--calcite-color-text-1);outline:2px solid transparent;outline-offset:2px;margin-top:0.875rem}.input{position:relative;z-index:0;box-sizing:border-box;display:block;height:3rem;width:100%;border-style:none;background-color:transparent;padding-right:1rem;padding-left:1.5rem;font-size:0.875rem;color:var(--calcite-color-text-1);--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;transition-duration:150ms;border-bottom:2px solid transparent;font-family:inherit}.input::-webkit-search-cancel-button{display:none}.input::-ms-clear{display:none}.input:focus{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);outline:2px solid transparent;outline-offset:2px;border-bottom-color:var(--calcite-color-brand)}.heading{margin-top:1.5rem;margin-left:1.5rem;margin-right:1.5rem;margin-bottom:0.5rem;font-size:1rem;color:var(--calcite-color-text-1)}.layerCards{margin-left:1.5rem;margin-right:1.5rem;font-size:0.875rem;background-color:rgba(220, 220, 220, 0.934)}.appendLayerBrowser{position:relative;display:block;background-color:var(--calcite-color-foreground-1)}.cards-wrapper{position:relative;display:flex;height:100%;min-width:0px;flex-direction:column;justify-content:space-between;background-color:var(--calcite-color-background);padding-bottom:1rem}.pagination-range{margin-left:1.5rem}.no-results-string{display:flex;justify-content:center;align-items:center}";

const ArcgisNewItemPagesAppendSelectLayer = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.dataLayers = [];
        this.searchTerm = "";
        this.isSourceDataSelect = false;
        this.ITEMS_PER_PAGE = 6;
        this.layers = undefined;
        this.loading = undefined;
        this.loaderMessage = undefined;
        this.error = undefined;
        this.filteredLayers = [];
        this.pagination = undefined;
        this.currentStart = 1;
        this.selected = undefined;
    }
    async handleNext() {
        var _a, _b;
        let nextPage = "appendKeyPairSelect";
        if (this.isSourceDataSelect) {
            //after selecting layer of Feature Layer
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer = this.selected;
            nextPage = "appendUpload";
        }
        else {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedSheet = this.selected.excelSheetId || this.selected.id;
            await this.analyzeSelectedLayer(); //updates addItemState.backupLayerFields with selected layer
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.dataLayer =
                (_b = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.analyzeResults) === null || _a === void 0 ? void 0 : _a.publishParameters) === null || _b === void 0 ? void 0 : _b.layers[_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedSheet];
            if ((_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.type === "Microsoft Excel" || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.type === "CSV") &&
                (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a === null || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a === void 0 ? void 0 : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer.geometryType) === "esriGeometryPoint" &&
                (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a === null || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a === void 0 ? void 0 : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer.type) !== "Table") {
                nextPage = "csvLocationFields";
            }
            else if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.addAppendSelectOption === "add" &&
                (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.backupLayerFields.some((field) => field.type === "esriFieldTypeDate") ||
                    this.isEnterprise)) {
                nextPage = "appendMatchFields";
            }
            else {
                nextPage = "appendKeyPairSelect";
            }
        }
        this.newItemToggleNavigationEnabled.emit(true);
        this.newItemUpdatePage.emit(nextPage);
    }
    searchHandler(e) {
        this.searchTerm = e.detail;
        this.fetchLayers(this.searchTerm);
    }
    async handlePrev(event) {
        event.preventDefault();
        if (this.loading) {
            return;
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.id) {
            //resetting uploaded data file
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.dataLayer = null;
        }
        this.newItemPrevPage.emit();
    }
    async componentWillLoad() {
        const { sourceDataLayer, existingItem, addAppendSelectOption } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a;
        const layers = existingItem.layers;
        this.layers = layers;
        this.isSourceDataSelect = this.layers.length > 1 && !sourceDataLayer ? true : false;
        this.item = existingItem;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.appendSelectLayer;
        this.isEnterprise = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal;
        this.header = this.isSourceDataSelect
            ? this.i18n.chooseServiceLayer
            : this.createHeaderText(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.type === "Microsoft Excel");
        if (!this.isSourceDataSelect) {
            this.addLayerInfo();
            if (!this.selected && addAppendSelectOption !== "update") {
                //if no compatible layers are found, throw error.
                this.handleError(this.i18n.sameGeometryWarningTitle, this.i18n.sameGeometryWarningDescription, "warning");
            }
        }
        else {
            this.dataLayers = layers;
            this.filteredLayers = layers;
            this.selected = this.filteredLayers[0];
        }
    }
    async analyzeSelectedLayer() {
        this.newItemToggleNavigationEnabled.emit(false);
        this.loading = true;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.appendUpload.analyzing;
        const { portal, user, config, lang } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        const { type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a;
        const { error } = await (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_2__.a)({
            analyzeArgs: { type: "item", itemid: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.id, workflow: "append" },
            itemArgs: { itemType: type },
            configArgs: { portal, user, config, lang },
            initialize: true
        });
        if (error) {
            this.handleError();
        }
    }
    fetchLayers(searchTerm) {
        //* Search layers by name.
        const term = searchTerm.toLowerCase();
        const found = this.dataLayers.filter((layer) => {
            return layer.name.toLowerCase().includes(term, 0);
        });
        this.currentStart = 1;
        this.filteredLayers = found;
    }
    addLayerInfo() {
        var _a;
        //helps to determine what geometryType icon to display
        const publishParameters = ((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.analyzeResults) === null || _a === void 0 ? void 0 : _a.publishParameters)
            ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.analyzeResults.publishParameters
            : {};
        const layers = publishParameters.layers || [publishParameters.layerInfo] || 0;
        const dataLayers = layers.map((layerInfo) => {
            const locationType = layerInfo.locationType || publishParameters.locationType || null;
            layerInfo.geometryType =
                layerInfo.geometryType ||
                    (locationType === "coordinates" ? "esriGeometryPoint" : null) ||
                    null;
            layerInfo.addressFields =
                layerInfo.addressFields ||
                    publishParameters.addressFields ||
                    (locationType === "coordinates"
                        ? {
                            longitudeFieldName: layerInfo.longitudeFieldName || publishParameters.longitudeFieldName,
                            latitudeFieldName: layerInfo.latitudeFieldName || publishParameters.latitudeFieldName
                        }
                        : {});
            return layerInfo;
        });
        const validatedLayers = validateLayers(dataLayers, this.item, this.layers, { portal: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal }, { analyzeResults: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.analyzeResults });
        if (validatedLayers) {
            this.dataLayers = validatedLayers;
            this.filteredLayers = validatedLayers;
            this.selected = this.filteredLayers.filter((layer) => {
                return (0,_geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_5__.c)(layer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.type);
            })[0];
        }
    }
    async handleError(title, description, errorType) {
        this.newItemToggleNavigationEnabled.emit(true);
        this.loading = false;
        this.error = {
            //Todo: Refining error messages in progress
            title: title || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.publishSelect.error.title,
            description: description || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.publishSelect.error.description,
            kind: errorType
        };
    }
    renderPageNumberText() {
        const start = this.currentStart;
        const total = this.filteredLayers.length;
        const end = Math.min(start + this.ITEMS_PER_PAGE - 1, total);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "page-number" }, this.i18n.paginationHeader
            .replace("${start}", `${start}`)
            .replace("${end}", `${end}`)
            .replace("${total}", `${total}`)));
    }
    createHeaderText(isExcel) {
        var _a;
        const stringBase = isExcel ? this.i18n.chooseSheet : this.i18n.chooseLayer;
        return stringBase
            .replace("${featureLayerName}", this.item.layers.length === 0 ? this.item.title : (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer) === null || _a === void 0 ? void 0 : _a.name)
            .replace("${uploadedFile}", _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.originalFileName);
    }
    render() {
        const { error, filteredLayers, i18n, currentStart, ITEMS_PER_PAGE, loading, loaderMessage, header, isSourceDataSelect } = this;
        const layersExist = filteredLayers.length > 0;
        const showPagination = (filteredLayers === null || filteredLayers === void 0 ? void 0 : filteredLayers.length) > ITEMS_PER_PAGE;
        const layers = filteredLayers === null || filteredLayers === void 0 ? void 0 : filteredLayers.slice(currentStart - 1, currentStart + ITEMS_PER_PAGE - 1);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { class: "loader-overlay", type: "indeterminate", active: loading, text: loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "appendLayerBrowser" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "search-bar" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "search", scale: "s", class: "x" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { class: "input", value: this.searchTerm, placeholder: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_4__.u.i18n.layerSearch.search, onInput: (e) => {
                const term = e.currentTarget.value;
                this.fetchLayers(term);
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cards-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "heading" }, header), layersExist ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "pagination-range" }, showPagination && this.renderPageNumberText()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "layerCards" }, (layers || []).map((dataLayer, idx) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-append-layer-card", { key: dataLayer.excelSheetId || idx, isIncompatibleGeom: !isSourceDataSelect &&
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.addAppendSelectOption !== "update" &&
                !(0,_geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_5__.c)(dataLayer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceDataLayer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.type), selected: this.selected === dataLayer, layer: dataLayer, onLayerCardSelect: (e) => {
                this.selected = e.detail.item;
            } }))), showPagination && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "pagination" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pagination", { scale: "m", totalItems: this.filteredLayers.length, pageSize: ITEMS_PER_PAGE, startItem: this.currentStart, onCalcitePaginationChange: (e) => {
                this.currentStart = e.target.startItem;
            } })))))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "no-results-string" }, i18n.noResults))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, kind: (error === null || error === void 0 ? void 0 : error.kind) || "danger", onAlertDismiss: () => (this.error = null) }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendSelectLayer.style = arcgisNewItemPagesAppendSelectLayerCss;



//# sourceMappingURL=arcgis-new-item-pages-append-select-layer.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ checkCompatibleGeometries),
/* harmony export */   v: () => (/* binding */ verifyGeometries)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function verifyGeometries(args) {
    var _a, _b;
    const { dataLayer, type, sourceDataLayer } = args;
    const dataLayerGeometry = (_a = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) !== null && _a !== void 0 ? _a : (_b = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.layerInfo) === null || _b === void 0 ? void 0 : _b.geometryType;
    if (type === "Microsoft Excel" || type === "CSV") {
        if (((dataLayer.locationType === "address" && dataLayer.addressFields) || dataLayer.locationType === "coordinates") && //check location type is address in case "none" is selected and addressFields linger
            (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return null;
        }
        else if (!dataLayerGeometry || dataLayer.locationType === "none" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return { title: "noGeometryMatchTitle", description: "noGeometryTableMessage" };
        }
        else if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== dataLayerGeometry) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
    else {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType)) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
}
function checkCompatibleGeometries(dataLayer, sourceDataLayer, type) {
    if (type === "Microsoft Excel" || type === "CSV") {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return true;
        }
        else if (((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") &&
            (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.locationType) === "none") {
            return true;
        }
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return !!dataLayer.addressFields || dataLayer.locationType !== "none";
        }
        return false;
    }
    else {
        return (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table" || (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) === (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType);
    }
}



//# sourceMappingURL=geometries-6ca39907.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const uiStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    nextText: "next",
    workflow: "content",
    scale: "m",
    disableScroll: false,
    featureFlags: {}
});
const uiStoreState = uiStore.state;



//# sourceMappingURL=ui-bca7bcd1.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWUyZmQ2Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOztBQUVoRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDckQ7QUFDSDtBQUNNO0FBQ047QUFDcUI7QUFDN0M7QUFDQTtBQUNNO0FBQ0E7QUFDTDtBQUNDO0FBQ0c7QUFDQTtBQUNOO0FBQ0Q7QUFDTztBQUNKOztBQUU5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0Q7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzREFBc0Qsa0JBQWtCLGFBQWEsWUFBWSxlQUFlLHNCQUFzQixpREFBaUQsWUFBWSxpQkFBaUIsa0JBQWtCLGFBQWEsbUJBQW1CLGtCQUFrQix3Q0FBd0MsR0FBRyxrQkFBa0IsV0FBVyxlQUFlLGtCQUFrQiw2QkFBNkIsa0NBQWtDLDhCQUE4QixtQkFBbUIsb0JBQW9CLE9BQU8sa0JBQWtCLFVBQVUsc0JBQXNCLGNBQWMsWUFBWSxXQUFXLGtCQUFrQiw2QkFBNkIsbUJBQW1CLG9CQUFvQixtQkFBbUIsa0NBQWtDLHNCQUFzQiw4QkFBOEIsdUdBQXVHLGdLQUFnSyx3SkFBd0osaUxBQWlMLDBCQUEwQixvQ0FBb0Msb0JBQW9CLHFDQUFxQyxhQUFhLGtCQUFrQixhQUFh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QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVpRTs7QUFFakU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNtRTs7QUFFbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsbURBQXlCLFVBQVUsZUFBZSxPQUFPOztBQUU2Qzs7QUFFeEo7Ozs7Ozs7Ozs7Ozs7Ozs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDdUQ7O0FBRXZELGdCQUFnQixxREFBVztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEOztBQUUyQzs7QUFFM0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hZGQtaXRlbS1kYmJlMmY1Ny5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLXNlbGVjdC1sYXllci5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9nZW9tZXRyaWVzLTZjYTM5OTA3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tMzUzNTU1MmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdWktYmNhN2JjZDEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICB0eXBlS2V5d29yZHM6IFtdLFxuICAgIGN1c3RvbVBhcmFtZXRlcnM6IFtdLFxuICAgIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gICAgYWxsb3dTdG9yZWRBdXRoOiB0cnVlLFxuICAgIGlzU2VjdXJlZDogbnVsbCxcbiAgICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZGQtaXRlbS1kYmJlMmY1Ny5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFuYWx5emUgfSBmcm9tICcuL2FuYWx5emUtNjllYzA4YzguanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1iY2E3YmNkMS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNoZWNrQ29tcGF0aWJsZUdlb21ldHJpZXMgfSBmcm9tICcuL2dlb21ldHJpZXMtNmNhMzk5MDcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9iYXNpYy02ZGI3ZWJkNy5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9hcHBlbmQtNGUxMTAzMmMuanMnO1xuaW1wb3J0ICcuL2dlb2NvZGUtNjRlMGIwZDMuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL3VybC00YzNhZTU0Yy5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy03NDYzOWRhZS5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcblxuZnVuY3Rpb24gdmFsaWRhdGVMYXllcnMoZGF0YUxheWVycywgaXRlbSwgbGF5ZXJzLCBjb25maWdTdGF0ZVByb3BzLCBhZGRJdGVtU3RhdGVQcm9wcykge1xuICAgIGNvbnN0IHBvcnRhbCA9IGNvbmZpZ1N0YXRlUHJvcHMucG9ydGFsO1xuICAgIGNvbnN0IHNlcnZpY2VJbmZvID0gKGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5zZXJ2aWNlSW5mbykgfHwge307XG4gICAgY29uc3QgYWRtaW5TZXJ2aWNlSW5mbyA9IChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uYWRtaW5TZXJ2aWNlSW5mbykgfHwge307XG4gICAgY29uc3QgY2FwYWJpbGl0aWVzID0gcG9ydGFsLmlzUG9ydGFsICYmICFpdGVtLmlzU0RTXG4gICAgICAgID8gc2VydmljZUluZm8uY2FwYWJpbGl0aWVzLnNwbGl0KFwiLFwiKSAvLyBwb3J0YWwgaG9zdGVkIGZlYXR1cmUgbGF5ZXIgdy9vICdwcm92aWRlclNEUycgdHlwZUtleXdvcmRcbiAgICAgICAgOiBhZG1pblNlcnZpY2VJbmZvLmNhcGFiaWxpdGllcy5zcGxpdChcIixcIik7IC8vIGV2ZXJ5IG90aGVyIGhvc3RlZCBmZWF0dXJlIGxheWVyIGltcGwsXG4gICAgY29uc3QgY2hhbmdlVHJhY2tpbmdFbmFibGVkID0gY2FwYWJpbGl0aWVzLmluY2x1ZGVzKFwiQ2hhbmdlVHJhY2tpbmdcIik7XG4gICAgY29uc3Qgc3luY0VuYWJsZWQgPSAoc2VydmljZUluZm8gPT09IG51bGwgfHwgc2VydmljZUluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2VJbmZvLnN5bmNFbmFibGVkKSB8fCBmYWxzZTtcbiAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9IChhZGRJdGVtU3RhdGVQcm9wcy5hbmFseXplUmVzdWx0cyAmJiBhZGRJdGVtU3RhdGVQcm9wcy5hbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycykgfHwge307XG4gICAgY29uc3QgaXNGR0RCID0gcHVibGlzaFBhcmFtZXRlcnMudHlwZSA9PT0gXCJmaWxlR2VvZGF0YWJhc2VcIjtcbiAgICBjb25zdCBpbnNlcnRPbmx5ID0gc3luY0VuYWJsZWQgfHwgY2hhbmdlVHJhY2tpbmdFbmFibGVkO1xuICAgIGNvbnN0IHNlcnZpY2VMYXllcnMgPSAhaW5zZXJ0T25seVxuICAgICAgICA/IGxheWVyc1xuICAgICAgICA6IGxheWVycy5maWx0ZXIoKHNlcnZpY2VMYXllcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGFMYXllcnMuc29tZSgoZGF0YUxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlID09PSBzZXJ2aWNlTGF5ZXIuZ2VvbWV0cnlUeXBlIHx8XG4gICAgICAgICAgICAgICAgICAgICFzZXJ2aWNlTGF5ZXIuZ2VvbWV0cnlUeXBlIHx8XG4gICAgICAgICAgICAgICAgICAgIChzZXJ2aWNlTGF5ZXIuZ2VvbWV0cnlUeXBlID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIgJiYgIWlzRkdEQiAmJiAhZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIGlmICghc2VydmljZUxheWVycyB8fCAhc2VydmljZUxheWVycy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZGF0YUxheWVycztcbiAgICB9XG59XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdExheWVyQ3NzID0gXCI6aG9zdHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwMCU7bWF4LXdpZHRoOjEwMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX0uc2VhcmNoLWJhcnttYXJnaW4tbGVmdDphdXRvO21hcmdpbi1yaWdodDphdXRvO2Rpc3BsYXk6ZmxleDtwYWRkaW5nLXJpZ2h0OjFyZW07cGFkZGluZy1sZWZ0OjJyZW07bWF4LXdpZHRoOnZhcigtLWl0ZW0tYnJvd3Nlci1tYXgtd2lkdGgpfS54e3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6MTA7Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyLXN0eWxlOm5vbmU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O21hcmdpbi10b3A6MC44NzVyZW19LmlucHV0e3Bvc2l0aW9uOnJlbGF0aXZlO3otaW5kZXg6MDtib3gtc2l6aW5nOmJvcmRlci1ib3g7ZGlzcGxheTpibG9jaztoZWlnaHQ6M3JlbTt3aWR0aDoxMDAlO2JvcmRlci1zdHlsZTpub25lO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7cGFkZGluZy1yaWdodDoxcmVtO3BhZGRpbmctbGVmdDoxLjVyZW07Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTstLXR3LXNoYWRvdzowIDAgIzAwMDA7LS10dy1zaGFkb3ctY29sb3JlZDowIDAgIzAwMDA7Ym94LXNoYWRvdzp2YXIoLS10dy1yaW5nLW9mZnNldC1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXJpbmctc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1zaGFkb3cpO3RyYW5zaXRpb24tcHJvcGVydHk6Y29sb3IsIGJhY2tncm91bmQtY29sb3IsIGJvcmRlci1jb2xvciwgdGV4dC1kZWNvcmF0aW9uLWNvbG9yLCBmaWxsLCBzdHJva2UsIG9wYWNpdHksIGJveC1zaGFkb3csIHRyYW5zZm9ybSwgZmlsdGVyLCAtd2Via2l0LWJhY2tkcm9wLWZpbHRlcjt0cmFuc2l0aW9uLXByb3BlcnR5OmNvbG9yLCBiYWNrZ3JvdW5kLWNvbG9yLCBib3JkZXItY29sb3IsIHRleHQtZGVjb3JhdGlvbi1jb2xvciwgZmlsbCwgc3Ryb2tlLCBvcGFjaXR5LCBib3gtc2hhZG93LCB0cmFuc2Zvcm0sIGZpbHRlciwgYmFja2Ryb3AtZmlsdGVyO3RyYW5zaXRpb24tcHJvcGVydHk6Y29sb3IsIGJhY2tncm91bmQtY29sb3IsIGJvcmRlci1jb2xvciwgdGV4dC1kZWNvcmF0aW9uLWNvbG9yLCBmaWxsLCBzdHJva2UsIG9wYWNpdHksIGJveC1zaGFkb3csIHRyYW5zZm9ybSwgZmlsdGVyLCBiYWNrZHJvcC1maWx0ZXIsIC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyO3RyYW5zaXRpb24tZHVyYXRpb246MTUwbXM7Ym9yZGVyLWJvdHRvbToycHggc29saWQgdHJhbnNwYXJlbnQ7Zm9udC1mYW1pbHk6aW5oZXJpdH0uaW5wdXQ6Oi13ZWJraXQtc2VhcmNoLWNhbmNlbC1idXR0b257ZGlzcGxheTpub25lfS5pbnB1dDo6LW1zLWNsZWFye2Rpc3BsYXk6bm9uZX0uaW5wdXQ6Zm9jdXN7LS10dy1zaGFkb3c6MCAwICMwMDAwOy0tdHctc2hhZG93LWNvbG9yZWQ6MCAwICMwMDAwO2JveC1zaGFkb3c6dmFyKC0tdHctcmluZy1vZmZzZXQtc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1yaW5nLXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctc2hhZG93KTtvdXRsaW5lOjJweCBzb2xpZCB0cmFuc3BhcmVudDtvdXRsaW5lLW9mZnNldDoycHg7Ym9yZGVyLWJvdHRvbS1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0uaGVhZGluZ3ttYXJnaW4tdG9wOjEuNXJlbTttYXJnaW4tbGVmdDoxLjVyZW07bWFyZ2luLXJpZ2h0OjEuNXJlbTttYXJnaW4tYm90dG9tOjAuNXJlbTtmb250LXNpemU6MXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmxheWVyQ2FyZHN7bWFyZ2luLWxlZnQ6MS41cmVtO21hcmdpbi1yaWdodDoxLjVyZW07Zm9udC1zaXplOjAuODc1cmVtO2JhY2tncm91bmQtY29sb3I6cmdiYSgyMjAsIDIyMCwgMjIwLCAwLjkzNCl9LmFwcGVuZExheWVyQnJvd3Nlcntwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfS5jYXJkcy13cmFwcGVye3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6ZmxleDtoZWlnaHQ6MTAwJTttaW4td2lkdGg6MHB4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7cGFkZGluZy1ib3R0b206MXJlbX0ucGFnaW5hdGlvbi1yYW5nZXttYXJnaW4tbGVmdDoxLjVyZW19Lm5vLXJlc3VsdHMtc3RyaW5ne2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcn1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0TGF5ZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5uZXdJdGVtUHJldlBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1QcmV2UGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICAgICAgdGhpcy5kYXRhTGF5ZXJzID0gW107XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IFwiXCI7XG4gICAgICAgIHRoaXMuaXNTb3VyY2VEYXRhU2VsZWN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuSVRFTVNfUEVSX1BBR0UgPSA2O1xuICAgICAgICB0aGlzLmxheWVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSBbXTtcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGFydCA9IDE7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGxldCBuZXh0UGFnZSA9IFwiYXBwZW5kS2V5UGFpclNlbGVjdFwiO1xuICAgICAgICBpZiAodGhpcy5pc1NvdXJjZURhdGFTZWxlY3QpIHtcbiAgICAgICAgICAgIC8vYWZ0ZXIgc2VsZWN0aW5nIGxheWVyIG9mIEZlYXR1cmUgTGF5ZXJcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIgPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgbmV4dFBhZ2UgPSBcImFwcGVuZFVwbG9hZFwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkU2hlZXQgPSB0aGlzLnNlbGVjdGVkLmV4Y2VsU2hlZXRJZCB8fCB0aGlzLnNlbGVjdGVkLmlkO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hbmFseXplU2VsZWN0ZWRMYXllcigpOyAvL3VwZGF0ZXMgYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzIHdpdGggc2VsZWN0ZWQgbGF5ZXJcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIgPVxuICAgICAgICAgICAgICAgIChfYiA9IChfYSA9IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnB1Ymxpc2hQYXJhbWV0ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGF5ZXJzW2FkZEl0ZW1TdGF0ZS5zZWxlY3RlZFNoZWV0XTtcbiAgICAgICAgICAgIGlmICgoYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiQ1NWXCIpICYmXG4gICAgICAgICAgICAgICAgKGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiICYmXG4gICAgICAgICAgICAgICAgKGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIudHlwZSkgIT09IFwiVGFibGVcIikge1xuICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJjc3ZMb2NhdGlvbkZpZWxkc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiAmJlxuICAgICAgICAgICAgICAgICghYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzLnNvbWUoKGZpZWxkKSA9PiBmaWVsZC50eXBlID09PSBcImVzcmlGaWVsZFR5cGVEYXRlXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFbnRlcnByaXNlKSkge1xuICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJhcHBlbmRNYXRjaEZpZWxkc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV4dFBhZ2UgPSBcImFwcGVuZEtleVBhaXJTZWxlY3RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KHRydWUpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFBhZ2UpO1xuICAgIH1cbiAgICBzZWFyY2hIYW5kbGVyKGUpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gZS5kZXRhaWw7XG4gICAgICAgIHRoaXMuZmV0Y2hMYXllcnModGhpcy5zZWFyY2hUZXJtKTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlUHJldihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5pZCkge1xuICAgICAgICAgICAgLy9yZXNldHRpbmcgdXBsb2FkZWQgZGF0YSBmaWxlXG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZGF0YUxheWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IHNvdXJjZURhdGFMYXllciwgZXhpc3RpbmdJdGVtLCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXJzID0gZXhpc3RpbmdJdGVtLmxheWVycztcbiAgICAgICAgdGhpcy5sYXllcnMgPSBsYXllcnM7XG4gICAgICAgIHRoaXMuaXNTb3VyY2VEYXRhU2VsZWN0ID0gdGhpcy5sYXllcnMubGVuZ3RoID4gMSAmJiAhc291cmNlRGF0YUxheWVyID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB0aGlzLml0ZW0gPSBleGlzdGluZ0l0ZW07XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFNlbGVjdExheWVyO1xuICAgICAgICB0aGlzLmlzRW50ZXJwcmlzZSA9IGNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbDtcbiAgICAgICAgdGhpcy5oZWFkZXIgPSB0aGlzLmlzU291cmNlRGF0YVNlbGVjdFxuICAgICAgICAgICAgPyB0aGlzLmkxOG4uY2hvb3NlU2VydmljZUxheWVyXG4gICAgICAgICAgICA6IHRoaXMuY3JlYXRlSGVhZGVyVGV4dChhZGRJdGVtU3RhdGUudHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIik7XG4gICAgICAgIGlmICghdGhpcy5pc1NvdXJjZURhdGFTZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkTGF5ZXJJbmZvKCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQgJiYgYWRkQXBwZW5kU2VsZWN0T3B0aW9uICE9PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgLy9pZiBubyBjb21wYXRpYmxlIGxheWVycyBhcmUgZm91bmQsIHRocm93IGVycm9yLlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IodGhpcy5pMThuLnNhbWVHZW9tZXRyeVdhcm5pbmdUaXRsZSwgdGhpcy5pMThuLnNhbWVHZW9tZXRyeVdhcm5pbmdEZXNjcmlwdGlvbiwgXCJ3YXJuaW5nXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kYXRhTGF5ZXJzID0gbGF5ZXJzO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJlZExheWVycyA9IGxheWVycztcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB0aGlzLmZpbHRlcmVkTGF5ZXJzWzBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGFuYWx5emVTZWxlY3RlZExheWVyKCkge1xuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kVXBsb2FkLmFuYWx5emluZztcbiAgICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBhbmFseXplKHtcbiAgICAgICAgICAgIGFuYWx5emVBcmdzOiB7IHR5cGU6IFwiaXRlbVwiLCBpdGVtaWQ6IGFkZEl0ZW1TdGF0ZS5pZCwgd29ya2Zsb3c6IFwiYXBwZW5kXCIgfSxcbiAgICAgICAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICAgICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0sXG4gICAgICAgICAgICBpbml0aWFsaXplOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmZXRjaExheWVycyhzZWFyY2hUZXJtKSB7XG4gICAgICAgIC8vKiBTZWFyY2ggbGF5ZXJzIGJ5IG5hbWUuXG4gICAgICAgIGNvbnN0IHRlcm0gPSBzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5kYXRhTGF5ZXJzLmZpbHRlcigobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBsYXllci5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGFydCA9IDE7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSBmb3VuZDtcbiAgICB9XG4gICAgYWRkTGF5ZXJJbmZvKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vaGVscHMgdG8gZGV0ZXJtaW5lIHdoYXQgZ2VvbWV0cnlUeXBlIGljb24gdG8gZGlzcGxheVxuICAgICAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9ICgoX2EgPSBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wdWJsaXNoUGFyYW1ldGVycylcbiAgICAgICAgICAgID8gYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzXG4gICAgICAgICAgICA6IHt9O1xuICAgICAgICBjb25zdCBsYXllcnMgPSBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMgfHwgW3B1Ymxpc2hQYXJhbWV0ZXJzLmxheWVySW5mb10gfHwgW107XG4gICAgICAgIGNvbnN0IGRhdGFMYXllcnMgPSBsYXllcnMubWFwKChsYXllckluZm8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uVHlwZSA9IGxheWVySW5mby5sb2NhdGlvblR5cGUgfHwgcHVibGlzaFBhcmFtZXRlcnMubG9jYXRpb25UeXBlIHx8IG51bGw7XG4gICAgICAgICAgICBsYXllckluZm8uZ2VvbWV0cnlUeXBlID1cbiAgICAgICAgICAgICAgICBsYXllckluZm8uZ2VvbWV0cnlUeXBlIHx8XG4gICAgICAgICAgICAgICAgICAgIChsb2NhdGlvblR5cGUgPT09IFwiY29vcmRpbmF0ZXNcIiA/IFwiZXNyaUdlb21ldHJ5UG9pbnRcIiA6IG51bGwpIHx8XG4gICAgICAgICAgICAgICAgICAgIG51bGw7XG4gICAgICAgICAgICBsYXllckluZm8uYWRkcmVzc0ZpZWxkcyA9XG4gICAgICAgICAgICAgICAgbGF5ZXJJbmZvLmFkZHJlc3NGaWVsZHMgfHxcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaFBhcmFtZXRlcnMuYWRkcmVzc0ZpZWxkcyB8fFxuICAgICAgICAgICAgICAgICAgICAobG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZUZpZWxkTmFtZTogbGF5ZXJJbmZvLmxvbmdpdHVkZUZpZWxkTmFtZSB8fCBwdWJsaXNoUGFyYW1ldGVycy5sb25naXR1ZGVGaWVsZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGVGaWVsZE5hbWU6IGxheWVySW5mby5sYXRpdHVkZUZpZWxkTmFtZSB8fCBwdWJsaXNoUGFyYW1ldGVycy5sYXRpdHVkZUZpZWxkTmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgOiB7fSk7XG4gICAgICAgICAgICByZXR1cm4gbGF5ZXJJbmZvO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkTGF5ZXJzID0gdmFsaWRhdGVMYXllcnMoZGF0YUxheWVycywgdGhpcy5pdGVtLCB0aGlzLmxheWVycywgeyBwb3J0YWw6IGNvbmZpZ1N0YXRlLnBvcnRhbCB9LCB7IGFuYWx5emVSZXN1bHRzOiBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMgfSk7XG4gICAgICAgIGlmICh2YWxpZGF0ZWRMYXllcnMpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YUxheWVycyA9IHZhbGlkYXRlZExheWVycztcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSB2YWxpZGF0ZWRMYXllcnM7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5maWx0ZXJlZExheWVycy5maWx0ZXIoKGxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrQ29tcGF0aWJsZUdlb21ldHJpZXMobGF5ZXIsIGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIsIGFkZEl0ZW1TdGF0ZS50eXBlKTtcbiAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZUVycm9yKHRpdGxlLCBkZXNjcmlwdGlvbiwgZXJyb3JUeXBlKSB7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQodHJ1ZSk7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yID0ge1xuICAgICAgICAgICAgLy9Ub2RvOiBSZWZpbmluZyBlcnJvciBtZXNzYWdlcyBpbiBwcm9ncmVzc1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlIHx8IHVpU3RvcmVTdGF0ZS5pMThuLnB1Ymxpc2hTZWxlY3QuZXJyb3IudGl0bGUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgdWlTdG9yZVN0YXRlLmkxOG4ucHVibGlzaFNlbGVjdC5lcnJvci5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGtpbmQ6IGVycm9yVHlwZVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXJQYWdlTnVtYmVyVGV4dCgpIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmN1cnJlbnRTdGFydDtcbiAgICAgICAgY29uc3QgdG90YWwgPSB0aGlzLmZpbHRlcmVkTGF5ZXJzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oc3RhcnQgKyB0aGlzLklURU1TX1BFUl9QQUdFIC0gMSwgdG90YWwpO1xuICAgICAgICByZXR1cm4gKGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwicGFnZS1udW1iZXJcIiB9LCB0aGlzLmkxOG4ucGFnaW5hdGlvbkhlYWRlclxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke3N0YXJ0fVwiLCBgJHtzdGFydH1gKVxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke2VuZH1cIiwgYCR7ZW5kfWApXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7dG90YWx9XCIsIGAke3RvdGFsfWApKSk7XG4gICAgfVxuICAgIGNyZWF0ZUhlYWRlclRleHQoaXNFeGNlbCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHN0cmluZ0Jhc2UgPSBpc0V4Y2VsID8gdGhpcy5pMThuLmNob29zZVNoZWV0IDogdGhpcy5pMThuLmNob29zZUxheWVyO1xuICAgICAgICByZXR1cm4gc3RyaW5nQmFzZVxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke2ZlYXR1cmVMYXllck5hbWV9XCIsIHRoaXMuaXRlbS5sYXllcnMubGVuZ3RoID09PSAwID8gdGhpcy5pdGVtLnRpdGxlIDogKF9hID0gYWRkSXRlbVN0YXRlLnNvdXJjZURhdGFMYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpXG4gICAgICAgICAgICAucmVwbGFjZShcIiR7dXBsb2FkZWRGaWxlfVwiLCBhZGRJdGVtU3RhdGUub3JpZ2luYWxGaWxlTmFtZSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBlcnJvciwgZmlsdGVyZWRMYXllcnMsIGkxOG4sIGN1cnJlbnRTdGFydCwgSVRFTVNfUEVSX1BBR0UsIGxvYWRpbmcsIGxvYWRlck1lc3NhZ2UsIGhlYWRlciwgaXNTb3VyY2VEYXRhU2VsZWN0IH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBsYXllcnNFeGlzdCA9IGZpbHRlcmVkTGF5ZXJzLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IHNob3dQYWdpbmF0aW9uID0gKGZpbHRlcmVkTGF5ZXJzID09PSBudWxsIHx8IGZpbHRlcmVkTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWx0ZXJlZExheWVycy5sZW5ndGgpID4gSVRFTVNfUEVSX1BBR0U7XG4gICAgICAgIGNvbnN0IGxheWVycyA9IGZpbHRlcmVkTGF5ZXJzID09PSBudWxsIHx8IGZpbHRlcmVkTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWx0ZXJlZExheWVycy5zbGljZShjdXJyZW50U3RhcnQgLSAxLCBjdXJyZW50U3RhcnQgKyBJVEVNU19QRVJfUEFHRSAtIDEpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyBjbGFzczogXCJsb2FkZXItb3ZlcmxheVwiLCB0eXBlOiBcImluZGV0ZXJtaW5hdGVcIiwgYWN0aXZlOiBsb2FkaW5nLCB0ZXh0OiBsb2FkZXJNZXNzYWdlIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYXBwZW5kTGF5ZXJCcm93c2VyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlYXJjaC1iYXJcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJzZWFyY2hcIiwgc2NhbGU6IFwic1wiLCBjbGFzczogXCJ4XCIgfSksIGgoXCJpbnB1dFwiLCB7IGNsYXNzOiBcImlucHV0XCIsIHZhbHVlOiB0aGlzLnNlYXJjaFRlcm0sIHBsYWNlaG9sZGVyOiB1aVN0b3JlU3RhdGUuaTE4bi5sYXllclNlYXJjaC5zZWFyY2gsIG9uSW5wdXQ6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVybSA9IGUuY3VycmVudFRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmZldGNoTGF5ZXJzKHRlcm0pO1xuICAgICAgICAgICAgfSB9KSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkcy13cmFwcGVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImhlYWRpbmdcIiB9LCBoZWFkZXIpLCBsYXllcnNFeGlzdCA/IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicGFnaW5hdGlvbi1yYW5nZVwiIH0sIHNob3dQYWdpbmF0aW9uICYmIHRoaXMucmVuZGVyUGFnZU51bWJlclRleHQoKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJsYXllckNhcmRzXCIgfSwgKGxheWVycyB8fCBbXSkubWFwKChkYXRhTGF5ZXIsIGlkeCkgPT4gKGgoXCJhcmNnaXMtbmV3LWl0ZW0tYXBwZW5kLWxheWVyLWNhcmRcIiwgeyBrZXk6IGRhdGFMYXllci5leGNlbFNoZWV0SWQgfHwgaWR4LCBpc0luY29tcGF0aWJsZUdlb206ICFpc1NvdXJjZURhdGFTZWxlY3QgJiZcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uICE9PSBcInVwZGF0ZVwiICYmXG4gICAgICAgICAgICAgICAgIWNoZWNrQ29tcGF0aWJsZUdlb21ldHJpZXMoZGF0YUxheWVyLCBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLCBhZGRJdGVtU3RhdGUudHlwZSksIHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkID09PSBkYXRhTGF5ZXIsIGxheWVyOiBkYXRhTGF5ZXIsIG9uTGF5ZXJDYXJkU2VsZWN0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBlLmRldGFpbC5pdGVtO1xuICAgICAgICAgICAgfSB9KSkpLCBzaG93UGFnaW5hdGlvbiAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInBhZ2luYXRpb25cIiB9LCBoKFwiY2FsY2l0ZS1wYWdpbmF0aW9uXCIsIHsgc2NhbGU6IFwibVwiLCB0b3RhbEl0ZW1zOiB0aGlzLmZpbHRlcmVkTGF5ZXJzLmxlbmd0aCwgcGFnZVNpemU6IElURU1TX1BFUl9QQUdFLCBzdGFydEl0ZW06IHRoaXMuY3VycmVudFN0YXJ0LCBvbkNhbGNpdGVQYWdpbmF0aW9uQ2hhbmdlOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0YXJ0ID0gZS50YXJnZXQuc3RhcnRJdGVtO1xuICAgICAgICAgICAgfSB9KSkpKSkpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogXCJuby1yZXN1bHRzLXN0cmluZ1wiIH0sIGkxOG4ubm9SZXN1bHRzKSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRlc2NyaXB0aW9uLCBsaW5rOiB7IGhyZWY6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rLCB0aXRsZTogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmxpbmtUZXh0IH0sIGFjdGl2ZTogISFlcnJvciwga2luZDogKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5raW5kKSB8fCBcImRhbmdlclwiLCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9KSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdExheWVyLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0TGF5ZXJDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdExheWVyIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hcHBlbmRfc2VsZWN0X2xheWVyIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LWxheWVyLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuZnVuY3Rpb24gdmVyaWZ5R2VvbWV0cmllcyhhcmdzKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IGRhdGFMYXllciwgdHlwZSwgc291cmNlRGF0YUxheWVyIH0gPSBhcmdzO1xuICAgIGNvbnN0IGRhdGFMYXllckdlb21ldHJ5ID0gKF9hID0gZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9iID0gZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmxheWVySW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdlb21ldHJ5VHlwZTtcbiAgICBpZiAodHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIiB8fCB0eXBlID09PSBcIkNTVlwiKSB7XG4gICAgICAgIGlmICgoKGRhdGFMYXllci5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiICYmIGRhdGFMYXllci5hZGRyZXNzRmllbGRzKSB8fCBkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCIpICYmIC8vY2hlY2sgbG9jYXRpb24gdHlwZSBpcyBhZGRyZXNzIGluIGNhc2UgXCJub25lXCIgaXMgc2VsZWN0ZWQgYW5kIGFkZHJlc3NGaWVsZHMgbGluZ2VyXG4gICAgICAgICAgICAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgPT09IFwiZXNyaUdlb21ldHJ5UG9pbnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWRhdGFMYXllckdlb21ldHJ5IHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgPT09IFwibm9uZVwiIHx8IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeVRhYmxlTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBkYXRhTGF5ZXJHZW9tZXRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICgoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzKGRhdGFMYXllciwgc291cmNlRGF0YUxheWVyLCB0eXBlKSB7XG4gICAgaWYgKHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgdHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci50eXBlKSA9PT0gXCJUYWJsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpICYmXG4gICAgICAgICAgICAoZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmxvY2F0aW9uVHlwZSkgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgICAgICAgIHJldHVybiAhIWRhdGFMYXllci5hZGRyZXNzRmllbGRzIHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgIT09IFwibm9uZVwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLnR5cGUpID09PSBcIlRhYmxlXCIgfHwgKGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzIGFzIGMsIHZlcmlmeUdlb21ldHJpZXMgYXMgdiB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1nZW9tZXRyaWVzLTZjYTM5OTA3LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nIH0gZnJvbSAnLi91cmwtNGMzYWU1NGMuanMnO1xuXG5mdW5jdGlvbiBpc0VzcmkoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gaXRlbS5vd25lcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlc3JpXCIpKTtcbn1cbmZ1bmN0aW9uIGlzUHJlbWl1bShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIENyZWRpdHNcIikpO1xufVxuZnVuY3Rpb24gaXNTdWJzY3JpYmVyKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgU3Vic2NyaXB0aW9uXCIpKTtcbn1cbmZ1bmN0aW9uIGlzT3duZXIoaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpdGVtLm93bmVyID09PSB1c2VyLnVzZXJuYW1lO1xufVxuLyoqXG4gKiBDYW4gdGhlIHVzZXIgdXBkYXRlIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW0oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikgfHwgaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJ1cGRhdGVcIjtcbn1cbi8qKlxuICogSXMgdGhlIHVzZXIgZWl0aGVyIGFuIG93bmVyIG9yIGFkbWluIG9mIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGlzT3duZXIoaXRlbSwgdXNlcikgfHwgaXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG59XG4vKipcbiAqIERvZXMgdGhlIHVzZXIgaGF2ZSBhZG1pbiBjYXBhYmlsaXRpZXMgb24gdGhpcyBpdGVtXG4gKi9cbmZ1bmN0aW9uIGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gaWYgdGhpcyBmbGFnIGlzIGFscmVhZHkgc2V0IChwcm9iYWJseSBob21lIGFwcCksIHVzZSBpdFxuICAgIGlmIChpdGVtLmlzQWRtaW4gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gISFpdGVtLmlzQWRtaW47XG4gICAgfVxuICAgIGNvbnN0IGl0ZW1Pd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3QgaXRlbUNvbnRyb2xBZG1pbiA9IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwiYWRtaW5cIjtcbiAgICBjb25zdCBlc3JpVXNlcnMgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCIsIFwiZXNyaV9kZW1vZ3JhcGhpY3NcIiwgXCJlc3JpX2JvdW5kYXJpZXNcIl07XG4gICAgaWYgKCgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSAmJlxuICAgICAgICAhaXNPd25lcihpdGVtLCB1c2VyKSAmJlxuICAgICAgICBpdGVtQ29udHJvbEFkbWluICYmXG4gICAgICAgIGl0ZW1Pd25lci5pbmNsdWRlcyhcImVzcmlfXCIpICYmXG4gICAgICAgIC8vIHBvcnRhbCBpbmNvcnJlY3RseSByZXR1cm5zIFwiaXRlbUNvbnRyb2w9XCJhZG1pblwiIGZvciBlc3JpIG93bmVkIGl0ZW1zXG4gICAgICAgICFlc3JpVXNlcnMuaW5jbHVkZXMoaXRlbU93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBpdGVtQ29udHJvbEFkbWluO1xufVxuY29uc3QgaXRlbXNCZWxvbmdUb1VzZXJPcmcgPSAoaXRlbXMsIHVzZXIpID0+IHtcbiAgICByZXR1cm4gISF1c2VyLm9yZ0lkICYmIGl0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtLmlzT3JnSXRlbSk7XG59O1xuY29uc3QgZ2V0SXRlbUhvbWVBcHBVcmwgPSAoaXRlbUlkLCBiYXNlVXJsKSA9PiBgJHthZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nKGJhc2VVcmwpfWl0ZW0uaHRtbD9pZD0ke2l0ZW1JZH1gO1xuXG5leHBvcnQgeyBpc1N1YnNjcmliZXIgYXMgYSwgaXNQcmVtaXVtIGFzIGIsIGNhblVwZGF0ZUl0ZW0gYXMgYywgaXRlbXNCZWxvbmdUb1VzZXJPcmcgYXMgZCwgZ2V0SXRlbUhvbWVBcHBVcmwgYXMgZywgaXNPd25lciBhcyBpLCB1c2VySXNJdGVtQWRtaW4gYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pdGVtLTM1MzU1NTJkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuXG5jb25zdCB1aVN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIG5leHRUZXh0OiBcIm5leHRcIixcbiAgICB3b3JrZmxvdzogXCJjb250ZW50XCIsXG4gICAgc2NhbGU6IFwibVwiLFxuICAgIGRpc2FibGVTY3JvbGw6IGZhbHNlLFxuICAgIGZlYXR1cmVGbGFnczoge31cbn0pO1xuY29uc3QgdWlTdG9yZVN0YXRlID0gdWlTdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgdWlTdG9yZSBhcyBhLCB1aVN0b3JlU3RhdGUgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD11aS1iY2E3YmNkMS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=