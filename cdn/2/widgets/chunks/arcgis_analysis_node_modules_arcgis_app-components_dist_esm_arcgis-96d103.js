"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-96d103"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categories-picker_6.entry.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-categories-picker_6.entry.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_categories_picker: () => (/* binding */ ArcgisCategoriesPicker),
/* harmony export */   arcgis_folder_picker: () => (/* binding */ ArcgisFolderPicker),
/* harmony export */   arcgis_item_properties: () => (/* binding */ ArcgisItemProperties),
/* harmony export */   arcgis_summary_input: () => (/* binding */ ArcgisSummaryInput),
/* harmony export */   arcgis_tags_picker: () => (/* binding */ ArcgisTagsPicker),
/* harmony export */   arcgis_title_input: () => (/* binding */ ArcgisTitleInput)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./categories-ca134005.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */

























const arcgisCategoriesPickerCss = ".label{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight, 400)}";

const ArcgisCategoriesPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisCategoriesPickerChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisCategoriesPickerChange", 7);
        this.renderCombobox = () => {
            const { i18n, scale, schema, label } = this;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: label !== null && label !== void 0 ? label : i18n.categories, maxItems: 5, selectionMode: "ancestors", placeholder: i18n.assignCategories, scale: scale, ref: (el) => (this.combobox = el) }, this.renderNestedCategories(schema)));
        };
        this.api = undefined;
        this.portal = undefined;
        this.scale = undefined;
        this.label = undefined;
        this.hideLabel = undefined;
        this.categories = undefined;
        this.schema = [];
        this.rootCategoryPath = _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_2__.U;
    }
    async componentWillLoad() {
        var _a, _b, _c, _d;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el);
        this.i18n = locale[0];
        // Fall back to config if no props passed in
        (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal);
        (_b = this.scale) !== null && _b !== void 0 ? _b : (this.scale = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale);
        (_c = this.api) !== null && _c !== void 0 ? _c : (this.api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api);
        (_d = this.categories) !== null && _d !== void 0 ? _d : (this.categories = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.categories);
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.on("reset", () => {
            this.categories = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.categories;
        });
    }
    async componentDidLoad() {
        var _a, _b, _c;
        const { portal, schema } = this;
        if (portal && !(schema === null || schema === void 0 ? void 0 : schema.length)) {
            if (portal.categories) {
                this.schema = (_a = portal.categories[0]) === null || _a === void 0 ? void 0 : _a.categories;
            }
            else {
                const response = await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.f)(portal);
                this.schema = (_c = (_b = response.categorySchema) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.categories;
                this.rootCategoryPath = (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_2__.g)(response.categorySchema);
            }
        }
    }
    updateCategories() {
        this.arcgisCategoriesPickerChange.emit(this.categories);
    }
    categoriesPickerChangeHandler(event) {
        var _a;
        event.stopPropagation();
        const values = ((_a = this.combobox) === null || _a === void 0 ? void 0 : _a.value) || [];
        const newList = Array.isArray(values) ? values : [values];
        if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.f)(newList, this.categories)) {
            return;
        }
        this.categories = newList;
    }
    renderNestedCategories(schema, previousValue) {
        return schema.map((category) => {
            // Keep breadcrumbs of categories' ancestry
            const value = previousValue
                ? `${previousValue}/${category.title}`
                : `${this.rootCategoryPath}/${category.title}`;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { value: value, textLabel: category.title, selected: this.categories.some((ele) => ele === value || ele.toLocaleLowerCase() === value.toLocaleLowerCase()) }, category.categories && this.renderNestedCategories(category.categories, value)));
        });
    }
    render() {
        const { i18n, scale, schema, hideLabel, label, renderCombobox } = this;
        if (hideLabel) {
            return renderCombobox();
        }
        return (!!schema && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, label !== null && label !== void 0 ? label : i18n.categories), renderCombobox())));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "categories": ["updateCategories"]
    }; }
};
ArcgisCategoriesPicker.style = arcgisCategoriesPickerCss;

const arcgisFolderPickerCss = ".label{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight, 400)}.create-folder{--calcite-color-text-1:var(--calcite-color-text-link);--calcite-color-text-3:var(--calcite-color-text-link)}.combobox-wrapper{position:relative}.progress{position:absolute;top:0px;z-index:1}";

const MAX_TITLE_LENGTH$1 = 250;
const ArcgisFolderPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisFolderPickerChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFolderPickerChange", 7);
        this.arcgisFolderPickerLoad = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFolderPickerLoad", 7);
        this.api = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.scale = undefined;
        this.label = undefined;
        this.folder = undefined;
        this.folders = [];
        this.newFolderActive = false;
        this.emptyFilterList = false;
        this.filterText = undefined;
        this.newFolderInput = undefined;
        this.createFolderText = undefined;
        this.showError = false;
        this.errorString = undefined;
        this.newFolderInputElement = undefined;
        this.comboboxElement = undefined;
        this.loading = false;
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el);
        this.i18n = locale[0];
        // Fall back to config if no props passed
        (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal);
        (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user);
        (_c = this.scale) !== null && _c !== void 0 ? _c : (this.scale = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale);
        (_d = this.api) !== null && _d !== void 0 ? _d : (this.api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api);
        (_e = this.folder) !== null && _e !== void 0 ? _e : (this.folder = (_g = (_f = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.folder) !== null && _f !== void 0 ? _f : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.initialFolder) !== null && _g !== void 0 ? _g : (_h = this.folders) === null || _h === void 0 ? void 0 : _h[0]);
        this.createFolderText = this.i18n.createNewFolder;
        // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.on("reset", () => {
            var _a, _b, _c;
            this.folder = (_b = (_a = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.folder) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.initialFolder) !== null && _b !== void 0 ? _b : (_c = this.folders) === null || _c === void 0 ? void 0 : _c[0];
        });
    }
    async componentDidLoad() {
        // Only load folders if empty
        if (!this.folders.length) {
            await this.loadFolders(this.user);
        }
    }
    async handleUserChange(newUser, previousUser) {
        if (!!previousUser && newUser.username !== previousUser.username) {
            await this.loadFolders(newUser);
            this.folder = this.getHomeFolder();
        }
    }
    handleFolderChange() {
        this.arcgisFolderPickerChange.emit(this.folder);
    }
    async loadFolders(user) {
        var _a;
        this.loading = true;
        this.folders = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_7__.g)(user);
        this.arcgisFolderPickerLoad.emit([...this.folders]);
        if (!((_a = this.folder) === null || _a === void 0 ? void 0 : _a.id)) {
            this.folder = this.getHomeFolder();
        }
        this.loading = false;
    }
    getHomeFolder() {
        return this.folders.find((folder) => folder.title === folder.id);
    }
    setNewFolderActive() {
        var _a;
        (_a = this.newFolderInputElement) === null || _a === void 0 ? void 0 : _a.setFocus();
        if (!this.newFolderInputElement) {
            this.showError = false;
            this.newFolderInput = "";
        }
    }
    checkForEmptySuggestions(event) {
        var _a;
        event.stopPropagation();
        const text = this.comboboxElement.shadowRoot.querySelector("input").value;
        const { i18n } = this;
        this.emptyFilterList = ((_a = this.comboboxElement.filteredItems) === null || _a === void 0 ? void 0 : _a.length) <= 1;
        this.createFolderText = this.emptyFilterList
            ? i18n.noFoldersFoundCreate.replace("${folder}", text)
            : i18n.createNewFolder;
        this.filterText = text;
    }
    handleComboboxChange(event) {
        var _a, _b, _c;
        event.stopPropagation();
        const value = (_a = this.comboboxElement) === null || _a === void 0 ? void 0 : _a.value;
        if (value === "create-folder") {
            this.showError = false;
            this.emptyFilterList ? this.createNewFolder(this.filterText) : (this.newFolderActive = true);
            return;
        }
        this.folder =
            (_c = (_b = this.folders.find((folder) => folder.id === value)) !== null && _b !== void 0 ? _b : this.folder) !== null && _c !== void 0 ? _c : this.getHomeFolder();
    }
    closeNewFolderInput(event) {
        event.stopPropagation();
        this.newFolderActive = false;
    }
    // TODO: convert to Result, add folder errors to error structure
    async saveActiveFolder() {
        if (!this.newFolderActive) {
            return true;
        }
        try {
            await this.createNewFolder(this.newFolderInput);
        }
        catch (e) {
            return this.errorString;
        }
        return !this.showError;
    }
    async createNewFolder(folderName) {
        var _a;
        const title = folderName.trim();
        const { i18n, user } = this;
        try {
            const { folder } = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_7__.c)(title, user);
            this.folder = folder;
            this.folders = [this.folder, ...this.folders];
            // TODO: Remove/move configState.folders? Leftover from initial telemetry pass, may not be properly utilized anymore
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.folders = this.folders;
            this.newFolderActive = false;
            this.showError = false;
            // for some reason, sometimes the combobox doesn't pick up the change, so make sure the new folder is selected
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
            const selectedItem = (_a = this.el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector(`calcite-combobox-item[data-id="${this.folder.id}"]`);
            if (selectedItem) {
                selectedItem.selected = true;
            }
        }
        catch (error) {
            // Identify which error occurred
            // TODO: Report via AppComponentErrorCode
            if (!title || (title === null || title === void 0 ? void 0 : title.length) <= 0) {
                this.errorString = i18n.error.noName;
            }
            else if (this.folders.map((folder) => folder.title).includes(title)) {
                this.errorString = i18n.error.folderAlreadyExists.replace("${folder}", title);
            }
            else if (title.indexOf(">") >= 0 || title.indexOf("<") >= 0) {
                this.errorString = i18n.error.invalidCharacters;
            }
            else {
                console.error(error);
                this.errorString = error.message;
            }
            this.showError = true;
            throw error;
        }
    }
    render() {
        var _a;
        const { i18n, scale } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale, class: "input-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, (_a = this.label) !== null && _a !== void 0 ? _a : i18n.folder), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.newFolderActive ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-inline-editable", { controls: true, "editing-enabled": true, afterConfirm: async () => {
                var _a;
                try {
                    await this.createNewFolder(this.newFolderInput);
                    this.newFolderActive = false;
                }
                catch (error) {
                    (_a = this.newFolderInputElement) === null || _a === void 0 ? void 0 : _a.setFocus();
                    throw error;
                }
            }, scale: scale }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: i18n.enterFolder, value: this.newFolderInput, maxLength: MAX_TITLE_LENGTH$1, scale: scale, onCalciteInputInput: (event) => (this.newFolderInput = event.target.value), onKeyDown: (e) => {
                e.stopPropagation();
                this.showError = false;
                switch (e.key) {
                    case "Enter":
                        this.createNewFolder(this.newFolderInput);
                        break;
                    case "Escape":
                        this.newFolderActive = false;
                        this.showError = false;
                        break;
                }
            }, ref: (element) => (this.newFolderInputElement = element), status: this.showError ? "invalid" : "idle" }))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "combobox-wrapper" }, this.loading && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-progress", { type: "indeterminate", class: "progress" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.folder, selectionMode: "single", maxItems: 5, placeholder: this.loading ? i18n.loading : i18n.searchFolders, scale: scale, ref: (element) => (this.comboboxElement = element), disabled: this.loading, clearDisabled: true, onCalciteComboboxChange: (event) => this.handleComboboxChange(event), onCalciteComboboxBeforeClose: () => {
                // Calcite Combobox workaround: folder picker should always have an option selected - reset folder to previous if selected folder is empty
                if (!this.comboboxElement.selectedItems.length) {
                    this.comboboxElement.value = this.folder.id;
                }
            } }, !this.loading && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.user && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { class: "create-folder", value: "create-folder", textLabel: this.createFolderText, selected: false, icon: "folder-plus", filterDisabled: true })), this.folders.map(({ id, username, title }) => {
            // Fall back to user's home folder if current folder isn't found - invalid, deleted, etc.
            const selectedFolder = this.folders
                .map((folder) => folder.id)
                .includes(this.folder.id)
                ? this.folder
                : this.getHomeFolder();
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { "data-id": id, value: id, textLabel: title, selected: (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.id) !== "all"
                    ? id === (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.id)
                    : id === username, icon: id === username ? "home" : "folder" }));
        }))))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { status: "invalid", hidden: !this.showError, icon: this.showError, scale: scale }, this.errorString)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "user": ["handleUserChange"],
        "folder": ["handleFolderChange"],
        "newFolderInputElement": ["setNewFolderActive"]
    }; }
};
ArcgisFolderPicker.style = arcgisFolderPickerCss;

var itemPropertiesEvent;
(function (itemPropertiesEvent) {
    itemPropertiesEvent["arcgisTitleInputChange"] = "title";
    itemPropertiesEvent["arcgisFolderPickerChange"] = "folder";
    itemPropertiesEvent["arcgisSummaryInputChange"] = "snippet";
    itemPropertiesEvent["arcgisTagsPickerChange"] = "tags";
    itemPropertiesEvent["arcgisCategoriesPickerChange"] = "categories";
})(itemPropertiesEvent || (itemPropertiesEvent = {}));
const ArcgisItemProperties = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemPropertiesChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemPropertiesChange", 7);
        this.portal = undefined;
        this.user = undefined;
        this.api = undefined;
        this.config = undefined;
        this.itemId = undefined;
        this.type = undefined;
        this.scale = undefined;
    }
    /**
     * Manually reset state
     */
    async resetItemPropertiesStore() {
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.reset();
    }
    // If any prop changes, update the store and emit the current itemPropertiesState
    handleItemPropertiesChange(event) {
        const { detail, type } = event;
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i[itemPropertiesEvent[type]] = detail;
        this.arcgisItemPropertiesChange.emit(Object.assign({}, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i));
    }
    async componentWillLoad() {
        var _a, _b;
        // Prioritize props over existing store values
        if (this.portal) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal = this.portal;
        }
        if (this.user) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user = this.user;
        }
        if (this.api) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api = this.api;
        }
        if (this.config) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.config = this.config;
        }
        if (this.itemId) {
            ({ result: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.item } = await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_8__.a)(this.itemId, this.portal));
        }
        if (this.type) {
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.type = (_a = this.type) !== null && _a !== void 0 ? _a : (_b = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.item) === null || _b === void 0 ? void 0 : _b.type;
        }
        if (this.scale) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale = this.scale;
        }
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)));
    }
    disconnectedCallback() {
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.reset();
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisSummaryInputCss = ":host{--arcgis-label-margin-bottom:1rem}.container-s{margin-bottom:0.5rem}.container-m{margin-bottom:0.75rem}.container-l{margin-bottom:1rem}.label{--calcite-label-margin-bottom:0}.label-text{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight, 400)}calcite-input{--calcite-color-border-1:var(--calcite-color-border-input)}.count{font-size:0.75rem;color:var(--calcite-color-text-1);opacity:0.75}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

// Taken from https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm
const MAX_CHARACTER = 2048;
const ArcgisSummaryInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSummaryInputChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSummaryInputChange", 7);
        this.updateLiveRegion = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)((summary) => {
            this.liveRegionText = this.getCharactersText(summary);
        }, 1500);
        this.scale = undefined;
        this.label = undefined;
        this.summary = undefined;
        this.liveRegionText = undefined;
        this.valid = true;
    }
    async getErrorMessage() {
        if (!this.valid) {
            return {
                code: "summaryInvalid",
                translatedMessage: this.i18n.invalid
            };
        }
        return null;
    }
    async componentWillLoad() {
        var _a, _b;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el);
        this.i18n = locale[0];
        // Do not override configState scale for individual components
        (_a = this.scale) !== null && _a !== void 0 ? _a : (this.scale = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale);
        (_b = this.summary) !== null && _b !== void 0 ? _b : (this.summary = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet);
        this.liveRegionText = this.getCharactersText(this.summary);
        // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.on("reset", () => {
            this.summary = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.snippet;
        });
    }
    componentDidRender() {
        var _a, _b, _c;
        // TODO: remove this once calcite-input support resize="vertical" https://github.com/Esri/calcite-design-system/tree/main/packages/calcite-components/src/components/input
        const textArea = (_c = (_b = (_a = this.el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-input")) === null || _b === void 0 ? void 0 : _b.shadowRoot) === null || _c === void 0 ? void 0 : _c.querySelector("textarea");
        textArea && (textArea.style.resize = "vertical");
    }
    getCharactersText(summary) {
        return this.i18n.charactersLeft.replace("${num}", `${MAX_CHARACTER - summary.length}`);
    }
    validate() {
        this.valid = !/>|</.test(this.summary);
    }
    render() {
        const { i18n, summary, label, scale, liveRegionText, valid } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `container-${scale}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale, class: "label" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label-text" }, label !== null && label !== void 0 ? label : i18n.summary), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "textarea", id: "summary-input", placeholder: i18n.addSummary, value: summary, maxLength: MAX_CHARACTER, scale: scale, status: valid ? "idle" : "invalid", onCalciteInputInput: (event) => {
                event.stopPropagation();
                const node = event.target;
                this.summary = node.value;
                this.arcgisSummaryInputChange.emit(this.summary);
                this.updateLiveRegion(node.value);
                this.validate();
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { hidden: valid, icon: true, scale: scale, status: valid ? "idle" : "invalid" }, i18n.invalid), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only", "aria-live": "polite" }, liveRegionText)), valid && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "count", "aria-hidden": "true" }, this.getCharactersText(summary)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSummaryInput.style = arcgisSummaryInputCss;

/**
 * Given a publishable type, find what type the resulting published item will be
 */
function findPublishType(type) {
    switch (type) {
        case "CSV":
        case "Microsoft Excel":
        case "GeoJson":
        case "Shapefile":
        case "File Geodatabase":
        case "Image Collection":
        case "GeoPackage":
        case "Service Definition":
        case "Feature Collection":
            return "Feature Service";
        case "Tile Package":
            return "Map Service";
        case "Vector Tile Package":
            return "Vector Tile Service";
        case "Scene Package":
            return "Scene Service";
        case "3DTiles Package":
            return "3DTiles Service";
    }
    return type;
}
/**
 * Check if a title is valid and unique
 */
const MAX_PUBLISH_SERVICE_NAME = 90;
const MAX_DATA_STORE_TITLE = 90;
const MAX_TITLE_LENGTH = 250;
async function validateTitle({ portal, user, title, itemType, folder, extension, enablePublishing = false, update = false }) {
    if (!user || !portal) {
        return { code: "missingUserOrPortal" };
    }
    if (!title || title.length <= 0) {
        return { code: "titleRequired" };
    }
    // for data store items, only alphanumeric and underscores should be allowed
    const dataStoreNameInvalidCharacterRegExp = /[\s.@~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g;
    if (itemType === "Data Store" &&
        (dataStoreNameInvalidCharacterRegExp.test(title) || title.length > MAX_DATA_STORE_TITLE)) {
        return { code: "dataStoreTitleInvalid" };
    }
    // for non publishable items, the only characters that arent allowed are < and >
    const itemNameCharacterRegExp = /<|>/gi;
    if (!enablePublishing && (itemNameCharacterRegExp.test(title) || title.length > MAX_TITLE_LENGTH)) {
        return { code: "titleInvalid" };
    }
    // for publishable items, only alphanumeric and underscores should be allowed
    const serviceNameInvalidCharacterRegExp = /[.@~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g;
    if (enablePublishing && (serviceNameInvalidCharacterRegExp.test(title) || title.length > MAX_PUBLISH_SERVICE_NAME)) {
        return { code: "serviceNameInvalid" };
    }
    const publishedItemType = enablePublishing ? findPublishType(itemType) : itemType;
    const { itemURLList } = (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_8__.s)(title, publishedItemType, folder, extension, user, portal)) || {};
    if (itemURLList && !update) {
        return {
            code: "itemExists",
            itemUrl: itemURLList[0]
        };
    }
    // if we're publishing, ensure that the service name is available
    if (enablePublishing) {
        const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__.g)(portal)}portals/${portal.id}/isServiceNameAvailable`, {
            name: title.replace(/\s/g, "_"),
            type: publishedItemType
        });
        if (!(response === null || response === void 0 ? void 0 : response.available)) {
            return {
                code: "titleInUseService",
                layerName: title
            };
        }
    }
    return null;
}
async function fetchTags(user) {
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user);
    // PortalUser type doesn't include url but it's definitely a thing
    // @ts-ignore
    const tagsUrl = user.url + "/tags";
    try {
        const tagsResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_10__.r)(tagsUrl);
        return tagsResponse.tags;
    }
    catch (error) {
        console.error(error);
    }
}

const arcgisTagsPickerCss = ".label{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight, 400)}.screen-reader-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

const ArcgisTagsPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisTagsPickerChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTagsPickerChange", 7);
        /** Custom type guard to check if tags need to be re-requested */
        this.isTag = (arg) => arg.tag !== undefined && arg.count !== undefined;
        /** store all the tags that have been rendered through this component in contrast to the ones added directly by calcite-combobox */
        this.controlledTags = [];
        this.mapItemValue = (items) => {
            return items.map((item) => item.value);
        };
        this.handleKeydown = (e) => {
            var _a;
            // If user typed a comma, treat as enter.
            // TODO: remove after calcite enables comma support (https://github.com/Esri/calcite-components/issues/4672)
            if (e.key === ",") {
                const target = e.target;
                const input = (_a = target === null || target === void 0 ? void 0 : target.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("input");
                if (input === null || input === void 0 ? void 0 : input.value) {
                    e.preventDefault();
                    const existing = target.querySelector(`calcite-combobox-item[value="${input.value}"]`);
                    if (existing) {
                        existing.selected = true;
                    }
                    else {
                        const item = document.createElement("calcite-combobox-item");
                        item.value = input.value;
                        item.textLabel = input.value;
                        item.selected = true;
                        target === null || target === void 0 ? void 0 : target.appendChild(item);
                    }
                    input.value = "";
                }
            }
        };
        this.api = undefined;
        this.user = undefined;
        this.scale = undefined;
        this.activeTags = undefined;
        this.knownTags = [];
        this.label = undefined;
        this.placeholder = undefined;
        this.hideLabel = undefined;
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e, _f;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el);
        this.i18n = locale[0];
        // Fall back to config if no props passed in
        (_a = this.user) !== null && _a !== void 0 ? _a : (this.user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user);
        (_b = this.scale) !== null && _b !== void 0 ? _b : (this.scale = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale);
        (_c = this.api) !== null && _c !== void 0 ? _c : (this.api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api);
        (_d = this.activeTags) !== null && _d !== void 0 ? _d : (this.activeTags = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.tags);
        this.activeTags = (0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_9__.f)(this.activeTags);
        // Build initial tags list from existing tags and ones pre-set by the consuming app
        this.knownTags = (0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_9__.f)([...((_e = this.knownTags) !== null && _e !== void 0 ? _e : []), ...((_f = this.activeTags) !== null && _f !== void 0 ? _f : [])]);
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.on("reset", () => {
            this.activeTags = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.tags;
        });
    }
    async componentDidLoad() {
        var _a, _b, _c;
        const { user } = this;
        if (user) {
            const userTags = (_a = user.contentTags) !== null && _a !== void 0 ? _a : user.tags;
            if (!(userTags === null || userTags === void 0 ? void 0 : userTags.length) || ((userTags === null || userTags === void 0 ? void 0 : userTags.length) > 0 && !this.isTag(userTags[0]))) {
                this.knownTags = [...this.knownTags, ...(await fetchTags(user)).map((tag) => tag.tag)];
            }
            else {
                this.knownTags = [...this.knownTags, ...userTags.map((tag) => tag.tag)];
            }
            this.knownTags = (0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_9__.f)([...((_b = this.activeTags) !== null && _b !== void 0 ? _b : []), ...((_c = this.knownTags) !== null && _c !== void 0 ? _c : [])]);
        }
    }
    itemPropertiesTagsChangeHandler(event) {
        var _a;
        event.stopPropagation();
        const values = ((_a = this.combobox) === null || _a === void 0 ? void 0 : _a.value) || [];
        const tags = Array.isArray(values) ? values : [values];
        this.arcgisTagsPickerChange.emit((0,_functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_9__.f)(tags));
        const knownItems = Array.from(this.combobox.children);
        const activeItems = this.combobox.selectedItems;
        knownItems.forEach((item) => {
            const hasBeenAdded = this.controlledTags.includes(item.value);
            // remove any combobox-item that is not yet part of the controlled list of tags
            if (!hasBeenAdded) {
                item.remove();
            }
        });
        this.knownTags = this.mapItemValue(knownItems);
        this.activeTags = this.mapItemValue(activeItems);
    }
    renderFormattedTags() {
        const { i18n, scale, handleKeydown, placeholder } = this;
        this.knownTags.forEach((tag) => {
            if (this.controlledTags.includes(tag)) {
                return;
            }
            this.controlledTags.push(tag);
        });
        const tagElements = this.knownTags.map((tag) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: tag, value: tag, textLabel: tag.length > 36 ? `${tag.slice(0, 36)}...` : tag, selected: ((_a = this.activeTags) === null || _a === void 0 ? void 0 : _a.indexOf(tag)) >= 0 }));
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.tags, maxItems: 5, "allow-custom-values": true, placeholder: placeholder !== null && placeholder !== void 0 ? placeholder : i18n.addTags, scale: scale, onKeyDown: handleKeydown, ref: (el) => (this.combobox = el) }, tagElements));
    }
    async setFocus() {
        var _a;
        (_a = this.combobox) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    render() {
        const { i18n, scale, hideLabel, label } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: { label: true, "screen-reader-only": hideLabel } }, label !== null && label !== void 0 ? label : i18n.tags), this.renderFormattedTags()));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisTagsPicker.style = arcgisTagsPickerCss;

const arcgisTitleInputCss = ".label{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight, 400)}calcite-input{--calcite-color-border-1:var(--calcite-color-border-input)}";

const ArcgisTitleInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisTitleInputChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisTitleInputChange", 7);
        this.debouncedInput = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)(() => {
            return this.handleTitleValidation();
        }, 400);
        this.api = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.scale = undefined;
        this.label = undefined;
        this.itemTitle = undefined;
        this.currentFolder = undefined;
        this.type = undefined;
        this.update = false;
        this.enablePublishing = undefined;
        this.titleError = undefined;
    }
    async focusMainInput() {
        var _a, _b;
        // arcgis-workflow TODO: mainInputRef is an empty object when publish item properties' test calls validate
        (_b = (_a = this.mainInputRef).setFocus) === null || _b === void 0 ? void 0 : _b.call(_a);
    }
    async validateTitle() {
        // Check which situations should be flushed instead of invoked - might need to introduce something to catch "modified since last validate"
        return this.debouncedInput.invoke();
        // TODO: Refer to the below snippet if there's a timing issue found always invoking
        // We want to invoke to trigger the empty title error so it always get triggered
        // return !this.itemTitle ? this.debouncedInput.invoke() : this.debouncedInput.flush();
    }
    async handleTitleValidation() {
        const { type, itemTitle, enablePublishing, portal, user, update } = this;
        const { extension } = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.a)(itemTitle);
        if (!type) {
            console.error("No item type found. Skipping title validation");
            return;
        }
        this.titleError = await validateTitle({
            portal,
            user,
            title: itemTitle,
            itemType: type,
            folder: this.currentFolder,
            extension,
            enablePublishing,
            update
        });
        return this.getErrorMessage();
    }
    getErrorMessage() {
        const { itemTitle, titleError, i18n } = this;
        if (!itemTitle) {
            this.titleError = {
                code: "titleRequired",
                translatedMessage: this.i18n.validation.titleRequired
            };
        }
        if (!!titleError) {
            titleError.translatedMessage = i18n.validation[this.titleError.code].replace("${name}", itemTitle);
        }
        return titleError;
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e, _f, _g;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.el);
        this.i18n = locale[0];
        // Fall back to config if no props passed
        (_a = this.portal) !== null && _a !== void 0 ? _a : (this.portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal);
        (_b = this.user) !== null && _b !== void 0 ? _b : (this.user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user);
        (_c = this.scale) !== null && _c !== void 0 ? _c : (this.scale = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.scale);
        (_d = this.api) !== null && _d !== void 0 ? _d : (this.api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api);
        (_e = this.type) !== null && _e !== void 0 ? _e : (this.type = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.type);
        (_f = this.itemTitle) !== null && _f !== void 0 ? _f : (this.itemTitle = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.title);
        (_g = this.currentFolder) !== null && _g !== void 0 ? _g : (this.currentFolder = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.folder);
        this.itemTitle && this.handleTitleValidation();
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.title = this.itemTitle;
        // arcgis-workflow TODO: re-initializing local state on store reset is not compatible with tests
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.a.on("reset", () => {
            this.itemTitle = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_6__.i.title;
        });
    }
    render() {
        var _a;
        const { i18n, itemTitle, scale } = this;
        const { translatedMessage, code } = this.titleError || {};
        const valid = !translatedMessage;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: scale }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label" }, (_a = this.label) !== null && _a !== void 0 ? _a : i18n.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { id: "item-properties-title", placeholder: i18n.addTitle, value: itemTitle, scale: scale, onInput: this.debouncedInput, max: MAX_TITLE_LENGTH, ref: (ele) => (this.mainInputRef = ele), status: valid ? "idle" : "invalid", onCalciteInputInput: (event) => {
                event.stopPropagation();
                this.itemTitle = event.target.value;
                this.arcgisTitleInputChange.emit(this.itemTitle);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: valid, status: valid ? "idle" : "invalid" }, translatedMessage || i18n[code] || i18n.title)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "currentFolder": ["handleTitleValidation"]
    }; }
};
ArcgisTitleInput.style = arcgisTitleInputCss;



//# sourceMappingURL=arcgis-categories-picker_6.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CATEGORY_BASE_PATH),
/* harmony export */   U: () => (/* binding */ UPPER_CATEGORY_BASE_PATH),
/* harmony export */   a: () => (/* binding */ getCategoryUIPath),
/* harmony export */   g: () => (/* binding */ getRootCategoryPath)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const CATEGORY_BASE_PATH = "/categories";
const UPPER_CATEGORY_BASE_PATH = "/Categories";

// TODO: add unit tests
/**
 * Construct the path of the category based on the parent path and the category title
 */
const getCategoryUIPath = (parentPath, category, lowerCase = true) => {
    const basePath = parentPath !== null && parentPath !== void 0 ? parentPath : "";
    return `${basePath}${basePath.endsWith("/") ? "" : "/"}${lowerCase ? category.title.toLocaleLowerCase() : category.title}`;
};
/**
 * Find the root node title to use for categories
 */
function getRootCategoryPath(categories) {
    var _a;
    let categoryTitle = (_a = categories === null || categories === void 0 ? void 0 : categories[0]) === null || _a === void 0 ? void 0 : _a.title;
    if (categoryTitle && categoryTitle.charAt(0) !== "/") {
        categoryTitle = `/${categoryTitle}`;
    }
    return categoryTitle || UPPER_CATEGORY_BASE_PATH;
}



//# sourceMappingURL=categories-ca134005.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ sanitizeFileName),
/* harmony export */   f: () => (/* binding */ formatFileSize),
/* harmony export */   g: () => (/* binding */ getItemInfoByType),
/* harmony export */   s: () => (/* binding */ sanitizeFileInput),
/* harmony export */   v: () => (/* binding */ validateOverwriteFileName)
/* harmony export */ });
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function sanitizeFileName(name, addGUID) {
    //TODO: add new param to spec file.
    const expression = /(?:\.([^.]+))?$/;
    const invalidTitleCharacters = /\.|-/g;
    let fileName = name.replace(/^.*(\\|\/|:)/, "");
    let extension = (fileName && expression.exec(fileName)[1] ? expression.exec(fileName)[1].toLowerCase() : "");
    let title = "";
    if (fileName.indexOf(".rft.") > -1) {
        const [name, suffix] = fileName.split(".rft.");
        extension = `rft.${suffix}`;
        title = name;
    }
    if (fileName && !title) {
        title = fileName.lastIndexOf(".") === -1 ? fileName : fileName.substring(0, fileName.lastIndexOf("."));
    }
    // Replace any invalid characters with an underscore
    title = title.replace(invalidTitleCharacters, "_");
    // Allow file upload of existing item's file name // currently used in append
    if (addGUID) {
        title = makeUniqueFileName(title);
        fileName = `${title}.${extension}`;
    }
    return { title, fileName, extension };
}
// Helper method that takes in a file & returns the cleaned up file name as is and in title form, and the detected file extension
function sanitizeFileInput(file, addGUID) {
    return sanitizeFileName(file.name, !!addGUID);
}
function makeUniqueFileName(name) {
    return `${name}_${(0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_1__.g)()}`;
}
function validateOverwriteFileName(uploadedFileName, sourceFileName) {
    let fileName = uploadedFileName;
    const position = uploadedFileName.lastIndexOf("\\");
    if (position > -1) {
        fileName = fileName.substring(position + 1, fileName.length);
    }
    return fileName.replace(/\ /g, "_") === sourceFileName.replace(/\ /g, "_");
}
function getItemInfoByType(type) {
    if (_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[type]) {
        return _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[type];
    }
    else {
        return _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[Object.keys(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a).find((fileType) => _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[fileType].type === type)];
    }
}
function formatFileSize(size) {
    if (!size) {
        return "0 B";
    }
    const i = Math.floor(Math.log(size) / Math.log(1024));
    const adjustedSize = Math.round(size / Math.pow(1024, i));
    const unit = ["B", "KB", "MB", "GB", "TB"][i];
    return `${adjustedSize} ${unit}`;
}



//# sourceMappingURL=file-bf8ab90f.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getGroupRestBaseUrl)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const getGroupRestBaseUrl = (portal, group) => (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.a)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/groups/${group.id}`);



//# sourceMappingURL=group-6a6303b0.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function generateId(counts) {
    return counts
        .map((count) => {
        let out = "";
        for (let i = 0; i < count; i++) {
            out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return out;
    })
        .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);



//# sourceMappingURL=guid-aeaed84d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getFolderFromId),
/* harmony export */   b: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   e: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders),
/* harmony export */   u: () => (/* binding */ updateFolder)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



async function fetchUser(username, portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
    var _a;
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return [];
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return null;
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return self.favGroupId;
}
function getUserContentUrl(user, portal) {
    var _a;
    return (_a = user === null || user === void 0 ? void 0 : user.userContentUrl) !== null && _a !== void 0 ? _a : `${portal === null || portal === void 0 ? void 0 : portal.restUrl}/content/users/${user.username}`;
}
async function getUserContent(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
    const url = getUserContentUrl(user, portal);
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { num: 1 });
    return Promise.resolve(response);
}
async function getFolders(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const { folders } = await getUserContent(user);
    const { username } = user;
    const sortedFolders = folders.sort((a, b) => a.title.localeCompare(b.title));
    // add the home folder as if it's in the list
    return [{ username, id: username, title: username, created: "now" }, ...sortedFolders];
}
async function getFolderFromId(folderId, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const folders = await getFolders(user);
    return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
    return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/createFolder`;
    const folderResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
    return folderResponse;
}
async function updateFolder(id, newTitle, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/${id}/updateFolder`;
    try {
        const result = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { newTitle }, {}, "post");
        return { result };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=user-3ea69c3a.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTk2ZDEwMy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM0SDtBQUM1RDtBQUNtQztBQUMzQztBQUN5QztBQUMzQjtBQUM2QjtBQUMzQjtBQUNVO0FBQ3ZCO0FBQ2M7QUFDZDtBQUM5QjtBQUNGO0FBQ087QUFDTjtBQUNDO0FBQ0Y7QUFDUztBQUNEO0FBQ0g7QUFDTjtBQUNRO0FBQ047O0FBRTVCLDBDQUEwQyxlQUFlLGtCQUFrQixpREFBaUQ7O0FBRTVIO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qiw0Q0FBNEMscURBQVc7QUFDdkQ7QUFDQSxvQkFBb0IsNkJBQTZCO0FBQ2pELG9CQUFvQixxREFBQyx1QkFBdUIsbU1BQW1NO0FBQy9PO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0Msc0RBQXdCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixzREFBeUI7QUFDdEQ7QUFDQTtBQUNBLDJFQUEyRSxrREFBVztBQUN0Rix5RUFBeUUsa0RBQVc7QUFDcEYscUVBQXFFLGtEQUFXO0FBQ2hGLG1GQUFtRiwyREFBbUI7QUFDdEcsUUFBUSwyREFBbUI7QUFDM0IsOEJBQThCLDJEQUFtQjtBQUNqRCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlCQUFpQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDBEQUFlO0FBQ3REO0FBQ0Esd0NBQXdDLDBEQUFtQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwwREFBbUI7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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UztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHNIQUFzSCwrREFBK0QsaUJBQWlCLGNBQWM7QUFDcE47QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLGtEQUFXLHdDQUF3QyxrREFBVztBQUNqSixtQkFBbUIsa0RBQVc7QUFDOUI7QUFDQSwyQkFBMkIsc0RBQU8sUUFBUSxRQUFRO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLGtEQUFXLHdDQUF3QyxrREFBVztBQUNqSixZQUFZLFVBQVU7QUFDdEIsWUFBWSxXQUFXO0FBQ3ZCO0FBQ0E7QUFDQSxjQUFjLHlEQUF5RDtBQUN2RTtBQUNBO0FBQ0E7QUFDQSxtRkFBbUYsa0RBQVcsd0NBQXdDLGtEQUFXO0FBQ2pKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDakosbUJBQW1CLHdCQUF3QixrREFBVyxTQUFTO0FBQy9ELGlDQUFpQyxzREFBTyxRQUFRLG1CQUFtQixJQUFJO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLGtEQUFXLHdDQUF3QyxrREFBVztBQUNqSixtQkFBbUIsd0JBQXdCLGtEQUFXLFNBQVMsR0FBRyxHQUFHO0FBQ3JFO0FBQ0EsNkJBQTZCLHNEQUFPLFFBQVEsVUFBVSxJQUFJO0FBQzFELGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCLFNBQVM7QUFDMUI7QUFDQTs7QUFFb007O0FBRXBNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWNhdGVnb3JpZXMtcGlja2VyXzYuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY2F0ZWdvcmllcy05ZjBmMzdlZS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jYXRlZ29yaWVzLWNhMTM0MDA1LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2ZpbGUtYmY4YWI5MGYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZ3JvdXAtNmE2MzAzYjAuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZ3VpZC1hZWFlZDg0ZC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3ByaXZpbGVnZXMtNWMzODJmNjEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdXNlci0zZWE2OWMzYS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZCBhcyBnZXRFbGVtZW50LCBGIGFzIEZyYWdtZW50LCBIIGFzIEhvc3QgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hDYXRlZ29yaWVzIH0gZnJvbSAnLi9jYXRlZ29yaWVzLTlmMGYzN2VlLmpzJztcbmltcG9ydCB7IFUgYXMgVVBQRVJfQ0FURUdPUllfQkFTRV9QQVRILCBnIGFzIGdldFJvb3RDYXRlZ29yeVBhdGggfSBmcm9tICcuL2NhdGVnb3JpZXMtY2ExMzQwMDUuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IGYgYXMgYXJyYXlzQXJlRXF1aXZhbGVudCwgdCBhcyB0aW1lb3V0LCBkIGFzIGRlYm91bmNlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IGkgYXMgaXRlbVByb3BlcnRpZXNTdGF0ZSwgYSBhcyBpdGVtUHJvcGVydGllc1N0b3JlIH0gZnJvbSAnLi9pdGVtLXByb3BlcnRpZXMtMTA0OTFiMmUuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRGb2xkZXJzLCBjIGFzIGNyZWF0ZUZvbGRlciB9IGZyb20gJy4vdXNlci0zZWE2OWMzYS5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEl0ZW0sIHMgYXMgc2VhcmNoRXhpc3RpbmdJdGVtIH0gZnJvbSAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgeyBmIGFzIGZvcm1hdFRhZ3MgfSBmcm9tICcuL2Z1bmN0aW9uYWwtODEzNzNmNmQuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYSBhcyBzYW5pdGl6ZUZpbGVOYW1lIH0gZnJvbSAnLi9maWxlLWJmOGFiOTBmLmpzJztcbmltcG9ydCAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0ICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuaW1wb3J0ICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuXG5jb25zdCBhcmNnaXNDYXRlZ29yaWVzUGlja2VyQ3NzID0gXCIubGFiZWx7bWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6dmFyKC0tYXJjZ2lzLWxhYmVsLWZvbnQtd2VpZ2h0LCA0MDApfVwiO1xuXG5jb25zdCBBcmNnaXNDYXRlZ29yaWVzUGlja2VyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNDYXRlZ29yaWVzUGlja2VyQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNDYXRlZ29yaWVzUGlja2VyQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLnJlbmRlckNvbWJvYm94ID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpMThuLCBzY2FsZSwgc2NoZW1hLCBsYWJlbCB9ID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3hcIiwgeyBsYWJlbDogbGFiZWwgIT09IG51bGwgJiYgbGFiZWwgIT09IHZvaWQgMCA/IGxhYmVsIDogaTE4bi5jYXRlZ29yaWVzLCBtYXhJdGVtczogNSwgc2VsZWN0aW9uTW9kZTogXCJhbmNlc3RvcnNcIiwgcGxhY2Vob2xkZXI6IGkxOG4uYXNzaWduQ2F0ZWdvcmllcywgc2NhbGU6IHNjYWxlLCByZWY6IChlbCkgPT4gKHRoaXMuY29tYm9ib3ggPSBlbCkgfSwgdGhpcy5yZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKHNjaGVtYSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhpZGVMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jYXRlZ29yaWVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IFtdO1xuICAgICAgICB0aGlzLnJvb3RDYXRlZ29yeVBhdGggPSBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEg7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGNvbmZpZyBpZiBubyBwcm9wcyBwYXNzZWQgaW5cbiAgICAgICAgKF9hID0gdGhpcy5wb3J0YWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLnBvcnRhbCA9IGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgICAgIChfYiA9IHRoaXMuc2NhbGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICh0aGlzLnNjYWxlID0gY29uZmlnU3RhdGUuc2NhbGUpO1xuICAgICAgICAoX2MgPSB0aGlzLmFwaSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKHRoaXMuYXBpID0gY29uZmlnU3RhdGUuYXBpKTtcbiAgICAgICAgKF9kID0gdGhpcy5jYXRlZ29yaWVzKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAodGhpcy5jYXRlZ29yaWVzID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5jYXRlZ29yaWVzKTtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdG9yZS5vbihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcmllcyA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuY2F0ZWdvcmllcztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBjb25zdCB7IHBvcnRhbCwgc2NoZW1hIH0gPSB0aGlzO1xuICAgICAgICBpZiAocG9ydGFsICYmICEoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2NoZW1hLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIGlmIChwb3J0YWwuY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1hID0gKF9hID0gcG9ydGFsLmNhdGVnb3JpZXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYXRlZ29yaWVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaENhdGVnb3JpZXMocG9ydGFsKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVtYSA9IChfYyA9IChfYiA9IHJlc3BvbnNlLmNhdGVnb3J5U2NoZW1hKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jYXRlZ29yaWVzO1xuICAgICAgICAgICAgICAgIHRoaXMucm9vdENhdGVnb3J5UGF0aCA9IGdldFJvb3RDYXRlZ29yeVBhdGgocmVzcG9uc2UuY2F0ZWdvcnlTY2hlbWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUNhdGVnb3JpZXMoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzQ2F0ZWdvcmllc1BpY2tlckNoYW5nZS5lbWl0KHRoaXMuY2F0ZWdvcmllcyk7XG4gICAgfVxuICAgIGNhdGVnb3JpZXNQaWNrZXJDaGFuZ2VIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9ICgoX2EgPSB0aGlzLmNvbWJvYm94KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWUpIHx8IFtdO1xuICAgICAgICBjb25zdCBuZXdMaXN0ID0gQXJyYXkuaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW3ZhbHVlc107XG4gICAgICAgIGlmIChhcnJheXNBcmVFcXVpdmFsZW50KG5ld0xpc3QsIHRoaXMuY2F0ZWdvcmllcykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhdGVnb3JpZXMgPSBuZXdMaXN0O1xuICAgIH1cbiAgICByZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKHNjaGVtYSwgcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICByZXR1cm4gc2NoZW1hLm1hcCgoY2F0ZWdvcnkpID0+IHtcbiAgICAgICAgICAgIC8vIEtlZXAgYnJlYWRjcnVtYnMgb2YgY2F0ZWdvcmllcycgYW5jZXN0cnlcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcHJldmlvdXNWYWx1ZVxuICAgICAgICAgICAgICAgID8gYCR7cHJldmlvdXNWYWx1ZX0vJHtjYXRlZ29yeS50aXRsZX1gXG4gICAgICAgICAgICAgICAgOiBgJHt0aGlzLnJvb3RDYXRlZ29yeVBhdGh9LyR7Y2F0ZWdvcnkudGl0bGV9YDtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IHZhbHVlOiB2YWx1ZSwgdGV4dExhYmVsOiBjYXRlZ29yeS50aXRsZSwgc2VsZWN0ZWQ6IHRoaXMuY2F0ZWdvcmllcy5zb21lKChlbGUpID0+IGVsZSA9PT0gdmFsdWUgfHwgZWxlLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09IHZhbHVlLnRvTG9jYWxlTG93ZXJDYXNlKCkpIH0sIGNhdGVnb3J5LmNhdGVnb3JpZXMgJiYgdGhpcy5yZW5kZXJOZXN0ZWRDYXRlZ29yaWVzKGNhdGVnb3J5LmNhdGVnb3JpZXMsIHZhbHVlKSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4sIHNjYWxlLCBzY2hlbWEsIGhpZGVMYWJlbCwgbGFiZWwsIHJlbmRlckNvbWJvYm94IH0gPSB0aGlzO1xuICAgICAgICBpZiAoaGlkZUxhYmVsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyQ29tYm9ib3goKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCEhc2NoZW1hICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBzY2FsZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgbGFiZWwgIT09IG51bGwgJiYgbGFiZWwgIT09IHZvaWQgMCA/IGxhYmVsIDogaTE4bi5jYXRlZ29yaWVzKSwgcmVuZGVyQ29tYm9ib3goKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXCJ1cGRhdGVDYXRlZ29yaWVzXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0NhdGVnb3JpZXNQaWNrZXIuc3R5bGUgPSBhcmNnaXNDYXRlZ29yaWVzUGlja2VyQ3NzO1xuXG5jb25zdCBhcmNnaXNGb2xkZXJQaWNrZXJDc3MgPSBcIi5sYWJlbHttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDtmb250LXdlaWdodDp2YXIoLS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQsIDQwMCl9LmNyZWF0ZS1mb2xkZXJ7LS1jYWxjaXRlLWNvbG9yLXRleHQtMTp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayk7LS1jYWxjaXRlLWNvbG9yLXRleHQtMzp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayl9LmNvbWJvYm94LXdyYXBwZXJ7cG9zaXRpb246cmVsYXRpdmV9LnByb2dyZXNze3Bvc2l0aW9uOmFic29sdXRlO3RvcDowcHg7ei1pbmRleDoxfVwiO1xuXG5jb25zdCBNQVhfVElUTEVfTEVOR1RIJDEgPSAyNTA7XG5jb25zdCBBcmNnaXNGb2xkZXJQaWNrZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbGRlclBpY2tlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzRm9sZGVyUGlja2VyQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbGRlclBpY2tlckxvYWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ZvbGRlclBpY2tlckxvYWRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZvbGRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5mb2xkZXJzID0gW107XG4gICAgICAgIHRoaXMubmV3Rm9sZGVyQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZW1wdHlGaWx0ZXJMaXN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5uZXdGb2xkZXJJbnB1dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jcmVhdGVGb2xkZXJUZXh0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yU3RyaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5ld0ZvbGRlcklucHV0RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb21ib2JveEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDtcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICAvLyBGYWxsIGJhY2sgdG8gY29uZmlnIGlmIG5vIHByb3BzIHBhc3NlZFxuICAgICAgICAoX2EgPSB0aGlzLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMucG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICAgICAgKF9iID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAodGhpcy51c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgIChfYyA9IHRoaXMuc2NhbGUpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6ICh0aGlzLnNjYWxlID0gY29uZmlnU3RhdGUuc2NhbGUpO1xuICAgICAgICAoX2QgPSB0aGlzLmFwaSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogKHRoaXMuYXBpID0gY29uZmlnU3RhdGUuYXBpKTtcbiAgICAgICAgKF9lID0gdGhpcy5mb2xkZXIpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6ICh0aGlzLmZvbGRlciA9IChfZyA9IChfZiA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiBjb25maWdTdGF0ZS5pbml0aWFsRm9sZGVyKSAhPT0gbnVsbCAmJiBfZyAhPT0gdm9pZCAwID8gX2cgOiAoX2ggPSB0aGlzLmZvbGRlcnMpID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaFswXSk7XG4gICAgICAgIHRoaXMuY3JlYXRlRm9sZGVyVGV4dCA9IHRoaXMuaTE4bi5jcmVhdGVOZXdGb2xkZXI7XG4gICAgICAgIC8vIGFyY2dpcy13b3JrZmxvdyBUT0RPOiByZS1pbml0aWFsaXppbmcgbG9jYWwgc3RhdGUgb24gc3RvcmUgcmVzZXQgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0ZXN0c1xuICAgICAgICBpdGVtUHJvcGVydGllc1N0b3JlLm9uKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IChfYiA9IChfYSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5pbml0aWFsRm9sZGVyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSB0aGlzLmZvbGRlcnMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1swXTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIC8vIE9ubHkgbG9hZCBmb2xkZXJzIGlmIGVtcHR5XG4gICAgICAgIGlmICghdGhpcy5mb2xkZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkRm9sZGVycyh0aGlzLnVzZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVVzZXJDaGFuZ2UobmV3VXNlciwgcHJldmlvdXNVc2VyKSB7XG4gICAgICAgIGlmICghIXByZXZpb3VzVXNlciAmJiBuZXdVc2VyLnVzZXJuYW1lICE9PSBwcmV2aW91c1VzZXIudXNlcm5hbWUpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMubG9hZEZvbGRlcnMobmV3VXNlcik7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IHRoaXMuZ2V0SG9tZUZvbGRlcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUZvbGRlckNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNGb2xkZXJQaWNrZXJDaGFuZ2UuZW1pdCh0aGlzLmZvbGRlcik7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRGb2xkZXJzKHVzZXIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmZvbGRlcnMgPSBhd2FpdCBnZXRGb2xkZXJzKHVzZXIpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZvbGRlclBpY2tlckxvYWQuZW1pdChbLi4udGhpcy5mb2xkZXJzXSk7XG4gICAgICAgIGlmICghKChfYSA9IHRoaXMuZm9sZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQpKSB7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IHRoaXMuZ2V0SG9tZUZvbGRlcigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBnZXRIb21lRm9sZGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5mb2xkZXJzLmZpbmQoKGZvbGRlcikgPT4gZm9sZGVyLnRpdGxlID09PSBmb2xkZXIuaWQpO1xuICAgIH1cbiAgICBzZXROZXdGb2xkZXJBY3RpdmUoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5uZXdGb2xkZXJJbnB1dEVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgICBpZiAoIXRoaXMubmV3Rm9sZGVySW5wdXRFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5uZXdGb2xkZXJJbnB1dCA9IFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2hlY2tGb3JFbXB0eVN1Z2dlc3Rpb25zKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSB0aGlzLmNvbWJvYm94RWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKS52YWx1ZTtcbiAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmVtcHR5RmlsdGVyTGlzdCA9ICgoX2EgPSB0aGlzLmNvbWJvYm94RWxlbWVudC5maWx0ZXJlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA8PSAxO1xuICAgICAgICB0aGlzLmNyZWF0ZUZvbGRlclRleHQgPSB0aGlzLmVtcHR5RmlsdGVyTGlzdFxuICAgICAgICAgICAgPyBpMThuLm5vRm9sZGVyc0ZvdW5kQ3JlYXRlLnJlcGxhY2UoXCIke2ZvbGRlcn1cIiwgdGV4dClcbiAgICAgICAgICAgIDogaTE4bi5jcmVhdGVOZXdGb2xkZXI7XG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRleHQ7XG4gICAgfVxuICAgIGhhbmRsZUNvbWJvYm94Q2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSAoX2EgPSB0aGlzLmNvbWJvYm94RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgPT09IFwiY3JlYXRlLWZvbGRlclwiKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lbXB0eUZpbHRlckxpc3QgPyB0aGlzLmNyZWF0ZU5ld0ZvbGRlcih0aGlzLmZpbHRlclRleHQpIDogKHRoaXMubmV3Rm9sZGVyQWN0aXZlID0gdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mb2xkZXIgPVxuICAgICAgICAgICAgKF9jID0gKF9iID0gdGhpcy5mb2xkZXJzLmZpbmQoKGZvbGRlcikgPT4gZm9sZGVyLmlkID09PSB2YWx1ZSkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHRoaXMuZm9sZGVyKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiB0aGlzLmdldEhvbWVGb2xkZXIoKTtcbiAgICB9XG4gICAgY2xvc2VOZXdGb2xkZXJJbnB1dChldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5uZXdGb2xkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gVE9ETzogY29udmVydCB0byBSZXN1bHQsIGFkZCBmb2xkZXIgZXJyb3JzIHRvIGVycm9yIHN0cnVjdHVyZVxuICAgIGFzeW5jIHNhdmVBY3RpdmVGb2xkZXIoKSB7XG4gICAgICAgIGlmICghdGhpcy5uZXdGb2xkZXJBY3RpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZU5ld0ZvbGRlcih0aGlzLm5ld0ZvbGRlcklucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JTdHJpbmc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICF0aGlzLnNob3dFcnJvcjtcbiAgICB9XG4gICAgYXN5bmMgY3JlYXRlTmV3Rm9sZGVyKGZvbGRlck5hbWUpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGZvbGRlck5hbWUudHJpbSgpO1xuICAgICAgICBjb25zdCB7IGkxOG4sIHVzZXIgfSA9IHRoaXM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IGZvbGRlciB9ID0gYXdhaXQgY3JlYXRlRm9sZGVyKHRpdGxlLCB1c2VyKTtcbiAgICAgICAgICAgIHRoaXMuZm9sZGVyID0gZm9sZGVyO1xuICAgICAgICAgICAgdGhpcy5mb2xkZXJzID0gW3RoaXMuZm9sZGVyLCAuLi50aGlzLmZvbGRlcnNdO1xuICAgICAgICAgICAgLy8gVE9ETzogUmVtb3ZlL21vdmUgY29uZmlnU3RhdGUuZm9sZGVycz8gTGVmdG92ZXIgZnJvbSBpbml0aWFsIHRlbGVtZXRyeSBwYXNzLCBtYXkgbm90IGJlIHByb3Blcmx5IHV0aWxpemVkIGFueW1vcmVcbiAgICAgICAgICAgIGNvbmZpZ1N0YXRlLmZvbGRlcnMgPSB0aGlzLmZvbGRlcnM7XG4gICAgICAgICAgICB0aGlzLm5ld0ZvbGRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIGZvciBzb21lIHJlYXNvbiwgc29tZXRpbWVzIHRoZSBjb21ib2JveCBkb2Vzbid0IHBpY2sgdXAgdGhlIGNoYW5nZSwgc28gbWFrZSBzdXJlIHRoZSBuZXcgZm9sZGVyIGlzIHNlbGVjdGVkXG4gICAgICAgICAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSAoX2EgPSB0aGlzLmVsLnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBjYWxjaXRlLWNvbWJvYm94LWl0ZW1bZGF0YS1pZD1cIiR7dGhpcy5mb2xkZXIuaWR9XCJdYCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIElkZW50aWZ5IHdoaWNoIGVycm9yIG9jY3VycmVkXG4gICAgICAgICAgICAvLyBUT0RPOiBSZXBvcnQgdmlhIEFwcENvbXBvbmVudEVycm9yQ29kZVxuICAgICAgICAgICAgaWYgKCF0aXRsZSB8fCAodGl0bGUgPT09IG51bGwgfHwgdGl0bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpdGxlLmxlbmd0aCkgPD0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JTdHJpbmcgPSBpMThuLmVycm9yLm5vTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZm9sZGVycy5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLnRpdGxlKS5pbmNsdWRlcyh0aXRsZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3RyaW5nID0gaTE4bi5lcnJvci5mb2xkZXJBbHJlYWR5RXhpc3RzLnJlcGxhY2UoXCIke2ZvbGRlcn1cIiwgdGl0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGl0bGUuaW5kZXhPZihcIj5cIikgPj0gMCB8fCB0aXRsZS5pbmRleE9mKFwiPFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvclN0cmluZyA9IGkxOG4uZXJyb3IuaW52YWxpZENoYXJhY3RlcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3RyaW5nID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGkxOG4sIHNjYWxlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IHNjYWxlLCBjbGFzczogXCJpbnB1dC1oZWlnaHRcIiB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgKF9hID0gdGhpcy5sYWJlbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogaTE4bi5mb2xkZXIpLCBoKFwiZGl2XCIsIG51bGwsIHRoaXMubmV3Rm9sZGVyQWN0aXZlID8gKGgoXCJjYWxjaXRlLWlubGluZS1lZGl0YWJsZVwiLCB7IGNvbnRyb2xzOiB0cnVlLCBcImVkaXRpbmctZW5hYmxlZFwiOiB0cnVlLCBhZnRlckNvbmZpcm06IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jcmVhdGVOZXdGb2xkZXIodGhpcy5uZXdGb2xkZXJJbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV3Rm9sZGVyQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLm5ld0ZvbGRlcklucHV0RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHNjYWxlOiBzY2FsZSB9LCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiBpMThuLmVudGVyRm9sZGVyLCB2YWx1ZTogdGhpcy5uZXdGb2xkZXJJbnB1dCwgbWF4TGVuZ3RoOiBNQVhfVElUTEVfTEVOR1RIJDEsIHNjYWxlOiBzY2FsZSwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiAodGhpcy5uZXdGb2xkZXJJbnB1dCA9IGV2ZW50LnRhcmdldC52YWx1ZSksIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlLmtleSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRW50ZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTmV3Rm9sZGVyKHRoaXMubmV3Rm9sZGVySW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFc2NhcGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV3Rm9sZGVyQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAoZWxlbWVudCkgPT4gKHRoaXMubmV3Rm9sZGVySW5wdXRFbGVtZW50ID0gZWxlbWVudCksIHN0YXR1czogdGhpcy5zaG93RXJyb3IgPyBcImludmFsaWRcIiA6IFwiaWRsZVwiIH0pKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbWJvYm94LXdyYXBwZXJcIiB9LCB0aGlzLmxvYWRpbmcgJiYgaChcImNhbGNpdGUtcHJvZ3Jlc3NcIiwgeyB0eXBlOiBcImluZGV0ZXJtaW5hdGVcIiwgY2xhc3M6IFwicHJvZ3Jlc3NcIiB9KSwgaChcImNhbGNpdGUtY29tYm9ib3hcIiwgeyBsYWJlbDogaTE4bi5mb2xkZXIsIHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIG1heEl0ZW1zOiA1LCBwbGFjZWhvbGRlcjogdGhpcy5sb2FkaW5nID8gaTE4bi5sb2FkaW5nIDogaTE4bi5zZWFyY2hGb2xkZXJzLCBzY2FsZTogc2NhbGUsIHJlZjogKGVsZW1lbnQpID0+ICh0aGlzLmNvbWJvYm94RWxlbWVudCA9IGVsZW1lbnQpLCBkaXNhYmxlZDogdGhpcy5sb2FkaW5nLCBjbGVhckRpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVDb21ib2JveENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUNvbWJvYm94Q2hhbmdlKGV2ZW50KSwgb25DYWxjaXRlQ29tYm9ib3hCZWZvcmVDbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIENhbGNpdGUgQ29tYm9ib3ggd29ya2Fyb3VuZDogZm9sZGVyIHBpY2tlciBzaG91bGQgYWx3YXlzIGhhdmUgYW4gb3B0aW9uIHNlbGVjdGVkIC0gcmVzZXQgZm9sZGVyIHRvIHByZXZpb3VzIGlmIHNlbGVjdGVkIGZvbGRlciBpcyBlbXB0eVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb21ib2JveEVsZW1lbnQuc2VsZWN0ZWRJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21ib2JveEVsZW1lbnQudmFsdWUgPSB0aGlzLmZvbGRlci5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sICF0aGlzLmxvYWRpbmcgJiYgKGgoRnJhZ21lbnQsIG51bGwsIHRoaXMudXNlciAmJiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGNsYXNzOiBcImNyZWF0ZS1mb2xkZXJcIiwgdmFsdWU6IFwiY3JlYXRlLWZvbGRlclwiLCB0ZXh0TGFiZWw6IHRoaXMuY3JlYXRlRm9sZGVyVGV4dCwgc2VsZWN0ZWQ6IGZhbHNlLCBpY29uOiBcImZvbGRlci1wbHVzXCIsIGZpbHRlckRpc2FibGVkOiB0cnVlIH0pKSwgdGhpcy5mb2xkZXJzLm1hcCgoeyBpZCwgdXNlcm5hbWUsIHRpdGxlIH0pID0+IHtcbiAgICAgICAgICAgIC8vIEZhbGwgYmFjayB0byB1c2VyJ3MgaG9tZSBmb2xkZXIgaWYgY3VycmVudCBmb2xkZXIgaXNuJ3QgZm91bmQgLSBpbnZhbGlkLCBkZWxldGVkLCBldGMuXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZEZvbGRlciA9IHRoaXMuZm9sZGVyc1xuICAgICAgICAgICAgICAgIC5tYXAoKGZvbGRlcikgPT4gZm9sZGVyLmlkKVxuICAgICAgICAgICAgICAgIC5pbmNsdWRlcyh0aGlzLmZvbGRlci5pZClcbiAgICAgICAgICAgICAgICA/IHRoaXMuZm9sZGVyXG4gICAgICAgICAgICAgICAgOiB0aGlzLmdldEhvbWVGb2xkZXIoKTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IFwiZGF0YS1pZFwiOiBpZCwgdmFsdWU6IGlkLCB0ZXh0TGFiZWw6IHRpdGxlLCBzZWxlY3RlZDogKHNlbGVjdGVkRm9sZGVyID09PSBudWxsIHx8IHNlbGVjdGVkRm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZvbGRlci5pZCkgIT09IFwiYWxsXCJcbiAgICAgICAgICAgICAgICAgICAgPyBpZCA9PT0gKHNlbGVjdGVkRm9sZGVyID09PSBudWxsIHx8IHNlbGVjdGVkRm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZvbGRlci5pZClcbiAgICAgICAgICAgICAgICAgICAgOiBpZCA9PT0gdXNlcm5hbWUsIGljb246IGlkID09PSB1c2VybmFtZSA/IFwiaG9tZVwiIDogXCJmb2xkZXJcIiB9KSk7XG4gICAgICAgIH0pKSkpKSkpLCBoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgc3RhdHVzOiBcImludmFsaWRcIiwgaGlkZGVuOiAhdGhpcy5zaG93RXJyb3IsIGljb246IHRoaXMuc2hvd0Vycm9yLCBzY2FsZTogc2NhbGUgfSwgdGhpcy5lcnJvclN0cmluZykpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwidXNlclwiOiBbXCJoYW5kbGVVc2VyQ2hhbmdlXCJdLFxuICAgICAgICBcImZvbGRlclwiOiBbXCJoYW5kbGVGb2xkZXJDaGFuZ2VcIl0sXG4gICAgICAgIFwibmV3Rm9sZGVySW5wdXRFbGVtZW50XCI6IFtcInNldE5ld0ZvbGRlckFjdGl2ZVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNGb2xkZXJQaWNrZXIuc3R5bGUgPSBhcmNnaXNGb2xkZXJQaWNrZXJDc3M7XG5cbnZhciBpdGVtUHJvcGVydGllc0V2ZW50O1xuKGZ1bmN0aW9uIChpdGVtUHJvcGVydGllc0V2ZW50KSB7XG4gICAgaXRlbVByb3BlcnRpZXNFdmVudFtcImFyY2dpc1RpdGxlSW5wdXRDaGFuZ2VcIl0gPSBcInRpdGxlXCI7XG4gICAgaXRlbVByb3BlcnRpZXNFdmVudFtcImFyY2dpc0ZvbGRlclBpY2tlckNoYW5nZVwiXSA9IFwiZm9sZGVyXCI7XG4gICAgaXRlbVByb3BlcnRpZXNFdmVudFtcImFyY2dpc1N1bW1hcnlJbnB1dENoYW5nZVwiXSA9IFwic25pcHBldFwiO1xuICAgIGl0ZW1Qcm9wZXJ0aWVzRXZlbnRbXCJhcmNnaXNUYWdzUGlja2VyQ2hhbmdlXCJdID0gXCJ0YWdzXCI7XG4gICAgaXRlbVByb3BlcnRpZXNFdmVudFtcImFyY2dpc0NhdGVnb3JpZXNQaWNrZXJDaGFuZ2VcIl0gPSBcImNhdGVnb3JpZXNcIjtcbn0pKGl0ZW1Qcm9wZXJ0aWVzRXZlbnQgfHwgKGl0ZW1Qcm9wZXJ0aWVzRXZlbnQgPSB7fSkpO1xuY29uc3QgQXJjZ2lzSXRlbVByb3BlcnRpZXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Qcm9wZXJ0aWVzQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtUHJvcGVydGllc0NoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLml0ZW1JZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50eXBlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYW51YWxseSByZXNldCBzdGF0ZVxuICAgICAqL1xuICAgIGFzeW5jIHJlc2V0SXRlbVByb3BlcnRpZXNTdG9yZSgpIHtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdG9yZS5yZXNldCgpO1xuICAgIH1cbiAgICAvLyBJZiBhbnkgcHJvcCBjaGFuZ2VzLCB1cGRhdGUgdGhlIHN0b3JlIGFuZCBlbWl0IHRoZSBjdXJyZW50IGl0ZW1Qcm9wZXJ0aWVzU3RhdGVcbiAgICBoYW5kbGVJdGVtUHJvcGVydGllc0NoYW5nZShldmVudCkge1xuICAgICAgICBjb25zdCB7IGRldGFpbCwgdHlwZSB9ID0gZXZlbnQ7XG4gICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGVbaXRlbVByb3BlcnRpZXNFdmVudFt0eXBlXV0gPSBkZXRhaWw7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbVByb3BlcnRpZXNDaGFuZ2UuZW1pdChPYmplY3QuYXNzaWduKHt9LCBpdGVtUHJvcGVydGllc1N0YXRlKSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAvLyBQcmlvcml0aXplIHByb3BzIG92ZXIgZXhpc3Rpbmcgc3RvcmUgdmFsdWVzXG4gICAgICAgIGlmICh0aGlzLnBvcnRhbCkge1xuICAgICAgICAgICAgY29uZmlnU3RhdGUucG9ydGFsID0gdGhpcy5wb3J0YWw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudXNlcikge1xuICAgICAgICAgICAgY29uZmlnU3RhdGUudXNlciA9IHRoaXMudXNlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hcGkpIHtcbiAgICAgICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnU3RhdGUuY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXRlbUlkKSB7XG4gICAgICAgICAgICAoeyByZXN1bHQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuaXRlbSB9ID0gYXdhaXQgZ2V0SXRlbSh0aGlzLml0ZW1JZCwgdGhpcy5wb3J0YWwpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50eXBlKSB7XG4gICAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnR5cGUgPSAoX2EgPSB0aGlzLnR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuaXRlbSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2NhbGUpIHtcbiAgICAgICAgICAgIGNvbmZpZ1N0YXRlLnNjYWxlID0gdGhpcy5zY2FsZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwic2xvdFwiLCBudWxsKSkpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdG9yZS5yZXNldCgpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNTdW1tYXJ5SW5wdXRDc3MgPSBcIjpob3N0ey0tYXJjZ2lzLWxhYmVsLW1hcmdpbi1ib3R0b206MXJlbX0uY29udGFpbmVyLXN7bWFyZ2luLWJvdHRvbTowLjVyZW19LmNvbnRhaW5lci1te21hcmdpbi1ib3R0b206MC43NXJlbX0uY29udGFpbmVyLWx7bWFyZ2luLWJvdHRvbToxcmVtfS5sYWJlbHstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowfS5sYWJlbC10ZXh0e21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCwgNDAwKX1jYWxjaXRlLWlucHV0ey0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMTp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci1pbnB1dCl9LmNvdW50e2ZvbnQtc2l6ZTowLjc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtvcGFjaXR5OjAuNzV9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfVwiO1xuXG4vLyBUYWtlbiBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5hcmNnaXMuY29tL3Jlc3QvdXNlcnMtZ3JvdXBzLWFuZC1pdGVtcy91cGRhdGUtaXRlbS5odG1cbmNvbnN0IE1BWF9DSEFSQUNURVIgPSAyMDQ4O1xuY29uc3QgQXJjZ2lzU3VtbWFyeUlucHV0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTdW1tYXJ5SW5wdXRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1N1bW1hcnlJbnB1dENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXZlUmVnaW9uID0gZGVib3VuY2UoKHN1bW1hcnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMubGl2ZVJlZ2lvblRleHQgPSB0aGlzLmdldENoYXJhY3RlcnNUZXh0KHN1bW1hcnkpO1xuICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgdGhpcy5zY2FsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdW1tYXJ5ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxpdmVSZWdpb25UZXh0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnZhbGlkID0gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0RXJyb3JNZXNzYWdlKCkge1xuICAgICAgICBpZiAoIXRoaXMudmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY29kZTogXCJzdW1tYXJ5SW52YWxpZFwiLFxuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZWRNZXNzYWdlOiB0aGlzLmkxOG4uaW52YWxpZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgLy8gRG8gbm90IG92ZXJyaWRlIGNvbmZpZ1N0YXRlIHNjYWxlIGZvciBpbmRpdmlkdWFsIGNvbXBvbmVudHNcbiAgICAgICAgKF9hID0gdGhpcy5zY2FsZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMuc2NhbGUgPSBjb25maWdTdGF0ZS5zY2FsZSk7XG4gICAgICAgIChfYiA9IHRoaXMuc3VtbWFyeSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKHRoaXMuc3VtbWFyeSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldCk7XG4gICAgICAgIHRoaXMubGl2ZVJlZ2lvblRleHQgPSB0aGlzLmdldENoYXJhY3RlcnNUZXh0KHRoaXMuc3VtbWFyeSk7XG4gICAgICAgIC8vIGFyY2dpcy13b3JrZmxvdyBUT0RPOiByZS1pbml0aWFsaXppbmcgbG9jYWwgc3RhdGUgb24gc3RvcmUgcmVzZXQgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0ZXN0c1xuICAgICAgICBpdGVtUHJvcGVydGllc1N0b3JlLm9uKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdW1tYXJ5ID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5zbmlwcGV0O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkUmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBjYWxjaXRlLWlucHV0IHN1cHBvcnQgcmVzaXplPVwidmVydGljYWxcIiBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vdHJlZS9tYWluL3BhY2thZ2VzL2NhbGNpdGUtY29tcG9uZW50cy9zcmMvY29tcG9uZW50cy9pbnB1dFxuICAgICAgICBjb25zdCB0ZXh0QXJlYSA9IChfYyA9IChfYiA9IChfYSA9IHRoaXMuZWwuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLWlucHV0XCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnF1ZXJ5U2VsZWN0b3IoXCJ0ZXh0YXJlYVwiKTtcbiAgICAgICAgdGV4dEFyZWEgJiYgKHRleHRBcmVhLnN0eWxlLnJlc2l6ZSA9IFwidmVydGljYWxcIik7XG4gICAgfVxuICAgIGdldENoYXJhY3RlcnNUZXh0KHN1bW1hcnkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5jaGFyYWN0ZXJzTGVmdC5yZXBsYWNlKFwiJHtudW19XCIsIGAke01BWF9DSEFSQUNURVIgLSBzdW1tYXJ5Lmxlbmd0aH1gKTtcbiAgICB9XG4gICAgdmFsaWRhdGUoKSB7XG4gICAgICAgIHRoaXMudmFsaWQgPSAhLz58PC8udGVzdCh0aGlzLnN1bW1hcnkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgc3VtbWFyeSwgbGFiZWwsIHNjYWxlLCBsaXZlUmVnaW9uVGV4dCwgdmFsaWQgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBgY29udGFpbmVyLSR7c2NhbGV9YCB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBzY2FsZSwgY2xhc3M6IFwibGFiZWxcIiB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsLXRleHRcIiB9LCBsYWJlbCAhPT0gbnVsbCAmJiBsYWJlbCAhPT0gdm9pZCAwID8gbGFiZWwgOiBpMThuLnN1bW1hcnkpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dGFyZWFcIiwgaWQ6IFwic3VtbWFyeS1pbnB1dFwiLCBwbGFjZWhvbGRlcjogaTE4bi5hZGRTdW1tYXJ5LCB2YWx1ZTogc3VtbWFyeSwgbWF4TGVuZ3RoOiBNQVhfQ0hBUkFDVEVSLCBzY2FsZTogc2NhbGUsIHN0YXR1czogdmFsaWQgPyBcImlkbGVcIiA6IFwiaW52YWxpZFwiLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IG5vZGUudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTdW1tYXJ5SW5wdXRDaGFuZ2UuZW1pdCh0aGlzLnN1bW1hcnkpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGl2ZVJlZ2lvbihub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgaGlkZGVuOiB2YWxpZCwgaWNvbjogdHJ1ZSwgc2NhbGU6IHNjYWxlLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9LCBpMThuLmludmFsaWQpLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiwgXCJhcmlhLWxpdmVcIjogXCJwb2xpdGVcIiB9LCBsaXZlUmVnaW9uVGV4dCkpLCB2YWxpZCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJjb3VudFwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIHRoaXMuZ2V0Q2hhcmFjdGVyc1RleHQoc3VtbWFyeSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU3VtbWFyeUlucHV0LnN0eWxlID0gYXJjZ2lzU3VtbWFyeUlucHV0Q3NzO1xuXG4vKipcbiAqIEdpdmVuIGEgcHVibGlzaGFibGUgdHlwZSwgZmluZCB3aGF0IHR5cGUgdGhlIHJlc3VsdGluZyBwdWJsaXNoZWQgaXRlbSB3aWxsIGJlXG4gKi9cbmZ1bmN0aW9uIGZpbmRQdWJsaXNoVHlwZSh0eXBlKSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgXCJDU1ZcIjpcbiAgICAgICAgY2FzZSBcIk1pY3Jvc29mdCBFeGNlbFwiOlxuICAgICAgICBjYXNlIFwiR2VvSnNvblwiOlxuICAgICAgICBjYXNlIFwiU2hhcGVmaWxlXCI6XG4gICAgICAgIGNhc2UgXCJGaWxlIEdlb2RhdGFiYXNlXCI6XG4gICAgICAgIGNhc2UgXCJJbWFnZSBDb2xsZWN0aW9uXCI6XG4gICAgICAgIGNhc2UgXCJHZW9QYWNrYWdlXCI6XG4gICAgICAgIGNhc2UgXCJTZXJ2aWNlIERlZmluaXRpb25cIjpcbiAgICAgICAgY2FzZSBcIkZlYXR1cmUgQ29sbGVjdGlvblwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiRmVhdHVyZSBTZXJ2aWNlXCI7XG4gICAgICAgIGNhc2UgXCJUaWxlIFBhY2thZ2VcIjpcbiAgICAgICAgICAgIHJldHVybiBcIk1hcCBTZXJ2aWNlXCI7XG4gICAgICAgIGNhc2UgXCJWZWN0b3IgVGlsZSBQYWNrYWdlXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJWZWN0b3IgVGlsZSBTZXJ2aWNlXCI7XG4gICAgICAgIGNhc2UgXCJTY2VuZSBQYWNrYWdlXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJTY2VuZSBTZXJ2aWNlXCI7XG4gICAgICAgIGNhc2UgXCIzRFRpbGVzIFBhY2thZ2VcIjpcbiAgICAgICAgICAgIHJldHVybiBcIjNEVGlsZXMgU2VydmljZVwiO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZTtcbn1cbi8qKlxuICogQ2hlY2sgaWYgYSB0aXRsZSBpcyB2YWxpZCBhbmQgdW5pcXVlXG4gKi9cbmNvbnN0IE1BWF9QVUJMSVNIX1NFUlZJQ0VfTkFNRSA9IDkwO1xuY29uc3QgTUFYX0RBVEFfU1RPUkVfVElUTEUgPSA5MDtcbmNvbnN0IE1BWF9USVRMRV9MRU5HVEggPSAyNTA7XG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVRpdGxlKHsgcG9ydGFsLCB1c2VyLCB0aXRsZSwgaXRlbVR5cGUsIGZvbGRlciwgZXh0ZW5zaW9uLCBlbmFibGVQdWJsaXNoaW5nID0gZmFsc2UsIHVwZGF0ZSA9IGZhbHNlIH0pIHtcbiAgICBpZiAoIXVzZXIgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4geyBjb2RlOiBcIm1pc3NpbmdVc2VyT3JQb3J0YWxcIiB9O1xuICAgIH1cbiAgICBpZiAoIXRpdGxlIHx8IHRpdGxlLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybiB7IGNvZGU6IFwidGl0bGVSZXF1aXJlZFwiIH07XG4gICAgfVxuICAgIC8vIGZvciBkYXRhIHN0b3JlIGl0ZW1zLCBvbmx5IGFscGhhbnVtZXJpYyBhbmQgdW5kZXJzY29yZXMgc2hvdWxkIGJlIGFsbG93ZWRcbiAgICBjb25zdCBkYXRhU3RvcmVOYW1lSW52YWxpZENoYXJhY3RlclJlZ0V4cCA9IC9bXFxzLkB+YCEjJCVcXF4mKis9XFwtXFxbXFxdXFxcXCc7LFxcL3t9fFxcXFxcIjo8PlxcP10vZztcbiAgICBpZiAoaXRlbVR5cGUgPT09IFwiRGF0YSBTdG9yZVwiICYmXG4gICAgICAgIChkYXRhU3RvcmVOYW1lSW52YWxpZENoYXJhY3RlclJlZ0V4cC50ZXN0KHRpdGxlKSB8fCB0aXRsZS5sZW5ndGggPiBNQVhfREFUQV9TVE9SRV9USVRMRSkpIHtcbiAgICAgICAgcmV0dXJuIHsgY29kZTogXCJkYXRhU3RvcmVUaXRsZUludmFsaWRcIiB9O1xuICAgIH1cbiAgICAvLyBmb3Igbm9uIHB1Ymxpc2hhYmxlIGl0ZW1zLCB0aGUgb25seSBjaGFyYWN0ZXJzIHRoYXQgYXJlbnQgYWxsb3dlZCBhcmUgPCBhbmQgPlxuICAgIGNvbnN0IGl0ZW1OYW1lQ2hhcmFjdGVyUmVnRXhwID0gLzx8Pi9naTtcbiAgICBpZiAoIWVuYWJsZVB1Ymxpc2hpbmcgJiYgKGl0ZW1OYW1lQ2hhcmFjdGVyUmVnRXhwLnRlc3QodGl0bGUpIHx8IHRpdGxlLmxlbmd0aCA+IE1BWF9USVRMRV9MRU5HVEgpKSB7XG4gICAgICAgIHJldHVybiB7IGNvZGU6IFwidGl0bGVJbnZhbGlkXCIgfTtcbiAgICB9XG4gICAgLy8gZm9yIHB1Ymxpc2hhYmxlIGl0ZW1zLCBvbmx5IGFscGhhbnVtZXJpYyBhbmQgdW5kZXJzY29yZXMgc2hvdWxkIGJlIGFsbG93ZWRcbiAgICBjb25zdCBzZXJ2aWNlTmFtZUludmFsaWRDaGFyYWN0ZXJSZWdFeHAgPSAvWy5AfmAhIyQlXFxeJiorPVxcLVxcW1xcXVxcXFwnOyxcXC97fXxcXFxcXCI6PD5cXD9dL2c7XG4gICAgaWYgKGVuYWJsZVB1Ymxpc2hpbmcgJiYgKHNlcnZpY2VOYW1lSW52YWxpZENoYXJhY3RlclJlZ0V4cC50ZXN0KHRpdGxlKSB8fCB0aXRsZS5sZW5ndGggPiBNQVhfUFVCTElTSF9TRVJWSUNFX05BTUUpKSB7XG4gICAgICAgIHJldHVybiB7IGNvZGU6IFwic2VydmljZU5hbWVJbnZhbGlkXCIgfTtcbiAgICB9XG4gICAgY29uc3QgcHVibGlzaGVkSXRlbVR5cGUgPSBlbmFibGVQdWJsaXNoaW5nID8gZmluZFB1Ymxpc2hUeXBlKGl0ZW1UeXBlKSA6IGl0ZW1UeXBlO1xuICAgIGNvbnN0IHsgaXRlbVVSTExpc3QgfSA9IChhd2FpdCBzZWFyY2hFeGlzdGluZ0l0ZW0odGl0bGUsIHB1Ymxpc2hlZEl0ZW1UeXBlLCBmb2xkZXIsIGV4dGVuc2lvbiwgdXNlciwgcG9ydGFsKSkgfHwge307XG4gICAgaWYgKGl0ZW1VUkxMaXN0ICYmICF1cGRhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvZGU6IFwiaXRlbUV4aXN0c1wiLFxuICAgICAgICAgICAgaXRlbVVybDogaXRlbVVSTExpc3RbMF1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLy8gaWYgd2UncmUgcHVibGlzaGluZywgZW5zdXJlIHRoYXQgdGhlIHNlcnZpY2UgbmFtZSBpcyBhdmFpbGFibGVcbiAgICBpZiAoZW5hYmxlUHVibGlzaGluZykge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1wb3J0YWxzLyR7cG9ydGFsLmlkfS9pc1NlcnZpY2VOYW1lQXZhaWxhYmxlYCwge1xuICAgICAgICAgICAgbmFtZTogdGl0bGUucmVwbGFjZSgvXFxzL2csIFwiX1wiKSxcbiAgICAgICAgICAgIHR5cGU6IHB1Ymxpc2hlZEl0ZW1UeXBlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIShyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UuYXZhaWxhYmxlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcInRpdGxlSW5Vc2VTZXJ2aWNlXCIsXG4gICAgICAgICAgICAgICAgbGF5ZXJOYW1lOiB0aXRsZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoVGFncyh1c2VyKSB7XG4gICAgdXNlciAhPT0gbnVsbCAmJiB1c2VyICE9PSB2b2lkIDAgPyB1c2VyIDogKHVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgICAvLyBQb3J0YWxVc2VyIHR5cGUgZG9lc24ndCBpbmNsdWRlIHVybCBidXQgaXQncyBkZWZpbml0ZWx5IGEgdGhpbmdcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgdGFnc1VybCA9IHVzZXIudXJsICsgXCIvdGFnc1wiO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHRhZ3NSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodGFnc1VybCk7XG4gICAgICAgIHJldHVybiB0YWdzUmVzcG9uc2UudGFncztcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH1cbn1cblxuY29uc3QgYXJjZ2lzVGFnc1BpY2tlckNzcyA9IFwiLmxhYmVse21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCwgNDAwKX0uc2NyZWVuLXJlYWRlci1vbmx5e3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjFweDtoZWlnaHQ6MXB4O3BhZGRpbmc6MDttYXJnaW46LTFweDtvdmVyZmxvdzpoaWRkZW47Y2xpcDpyZWN0KDAsIDAsIDAsIDApO3doaXRlLXNwYWNlOm5vd3JhcDtib3JkZXItd2lkdGg6MH1cIjtcblxuY29uc3QgQXJjZ2lzVGFnc1BpY2tlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzVGFnc1BpY2tlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVGFnc1BpY2tlckNoYW5nZVwiLCA3KTtcbiAgICAgICAgLyoqIEN1c3RvbSB0eXBlIGd1YXJkIHRvIGNoZWNrIGlmIHRhZ3MgbmVlZCB0byBiZSByZS1yZXF1ZXN0ZWQgKi9cbiAgICAgICAgdGhpcy5pc1RhZyA9IChhcmcpID0+IGFyZy50YWcgIT09IHVuZGVmaW5lZCAmJiBhcmcuY291bnQgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgLyoqIHN0b3JlIGFsbCB0aGUgdGFncyB0aGF0IGhhdmUgYmVlbiByZW5kZXJlZCB0aHJvdWdoIHRoaXMgY29tcG9uZW50IGluIGNvbnRyYXN0IHRvIHRoZSBvbmVzIGFkZGVkIGRpcmVjdGx5IGJ5IGNhbGNpdGUtY29tYm9ib3ggKi9cbiAgICAgICAgdGhpcy5jb250cm9sbGVkVGFncyA9IFtdO1xuICAgICAgICB0aGlzLm1hcEl0ZW1WYWx1ZSA9IChpdGVtcykgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlS2V5ZG93biA9IChlKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAvLyBJZiB1c2VyIHR5cGVkIGEgY29tbWEsIHRyZWF0IGFzIGVudGVyLlxuICAgICAgICAgICAgLy8gVE9ETzogcmVtb3ZlIGFmdGVyIGNhbGNpdGUgZW5hYmxlcyBjb21tYSBzdXBwb3J0IChodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvaXNzdWVzLzQ2NzIpXG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiLFwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSAoX2EgPSB0YXJnZXQgPT09IG51bGwgfHwgdGFyZ2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0YXJnZXQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgPT09IG51bGwgfHwgaW5wdXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlucHV0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSB0YXJnZXQucXVlcnlTZWxlY3RvcihgY2FsY2l0ZS1jb21ib2JveC1pdGVtW3ZhbHVlPVwiJHtpbnB1dC52YWx1ZX1cIl1gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZy5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udGV4dExhYmVsID0gaW5wdXQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9PT0gbnVsbCB8fCB0YXJnZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhcmdldC5hcHBlbmRDaGlsZChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFwaSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjYWxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFjdGl2ZVRhZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMua25vd25UYWdzID0gW107XG4gICAgICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGlkZUxhYmVsID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGNvbmZpZyBpZiBubyBwcm9wcyBwYXNzZWQgaW5cbiAgICAgICAgKF9hID0gdGhpcy51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAodGhpcy51c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgIChfYiA9IHRoaXMuc2NhbGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICh0aGlzLnNjYWxlID0gY29uZmlnU3RhdGUuc2NhbGUpO1xuICAgICAgICAoX2MgPSB0aGlzLmFwaSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKHRoaXMuYXBpID0gY29uZmlnU3RhdGUuYXBpKTtcbiAgICAgICAgKF9kID0gdGhpcy5hY3RpdmVUYWdzKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAodGhpcy5hY3RpdmVUYWdzID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzKTtcbiAgICAgICAgdGhpcy5hY3RpdmVUYWdzID0gZm9ybWF0VGFncyh0aGlzLmFjdGl2ZVRhZ3MpO1xuICAgICAgICAvLyBCdWlsZCBpbml0aWFsIHRhZ3MgbGlzdCBmcm9tIGV4aXN0aW5nIHRhZ3MgYW5kIG9uZXMgcHJlLXNldCBieSB0aGUgY29uc3VtaW5nIGFwcFxuICAgICAgICB0aGlzLmtub3duVGFncyA9IGZvcm1hdFRhZ3MoWy4uLigoX2UgPSB0aGlzLmtub3duVGFncykgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogW10pLCAuLi4oKF9mID0gdGhpcy5hY3RpdmVUYWdzKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiBbXSldKTtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdG9yZS5vbihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlVGFncyA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBjb25zdCB7IHVzZXIgfSA9IHRoaXM7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyVGFncyA9IChfYSA9IHVzZXIuY29udGVudFRhZ3MpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVzZXIudGFncztcbiAgICAgICAgICAgIGlmICghKHVzZXJUYWdzID09PSBudWxsIHx8IHVzZXJUYWdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyVGFncy5sZW5ndGgpIHx8ICgodXNlclRhZ3MgPT09IG51bGwgfHwgdXNlclRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXJUYWdzLmxlbmd0aCkgPiAwICYmICF0aGlzLmlzVGFnKHVzZXJUYWdzWzBdKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmtub3duVGFncyA9IFsuLi50aGlzLmtub3duVGFncywgLi4uKGF3YWl0IGZldGNoVGFncyh1c2VyKSkubWFwKCh0YWcpID0+IHRhZy50YWcpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMua25vd25UYWdzID0gWy4uLnRoaXMua25vd25UYWdzLCAuLi51c2VyVGFncy5tYXAoKHRhZykgPT4gdGFnLnRhZyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5rbm93blRhZ3MgPSBmb3JtYXRUYWdzKFsuLi4oKF9iID0gdGhpcy5hY3RpdmVUYWdzKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXSksIC4uLigoX2MgPSB0aGlzLmtub3duVGFncykgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogW10pXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaXRlbVByb3BlcnRpZXNUYWdzQ2hhbmdlSGFuZGxlcihldmVudCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSAoKF9hID0gdGhpcy5jb21ib2JveCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhbHVlKSB8fCBbXTtcbiAgICAgICAgY29uc3QgdGFncyA9IEFycmF5LmlzQXJyYXkodmFsdWVzKSA/IHZhbHVlcyA6IFt2YWx1ZXNdO1xuICAgICAgICB0aGlzLmFyY2dpc1RhZ3NQaWNrZXJDaGFuZ2UuZW1pdChmb3JtYXRUYWdzKHRhZ3MpKTtcbiAgICAgICAgY29uc3Qga25vd25JdGVtcyA9IEFycmF5LmZyb20odGhpcy5jb21ib2JveC5jaGlsZHJlbik7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUl0ZW1zID0gdGhpcy5jb21ib2JveC5zZWxlY3RlZEl0ZW1zO1xuICAgICAgICBrbm93bkl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhhc0JlZW5BZGRlZCA9IHRoaXMuY29udHJvbGxlZFRhZ3MuaW5jbHVkZXMoaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICAvLyByZW1vdmUgYW55IGNvbWJvYm94LWl0ZW0gdGhhdCBpcyBub3QgeWV0IHBhcnQgb2YgdGhlIGNvbnRyb2xsZWQgbGlzdCBvZiB0YWdzXG4gICAgICAgICAgICBpZiAoIWhhc0JlZW5BZGRlZCkge1xuICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmtub3duVGFncyA9IHRoaXMubWFwSXRlbVZhbHVlKGtub3duSXRlbXMpO1xuICAgICAgICB0aGlzLmFjdGl2ZVRhZ3MgPSB0aGlzLm1hcEl0ZW1WYWx1ZShhY3RpdmVJdGVtcyk7XG4gICAgfVxuICAgIHJlbmRlckZvcm1hdHRlZFRhZ3MoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgc2NhbGUsIGhhbmRsZUtleWRvd24sIHBsYWNlaG9sZGVyIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmtub3duVGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZWRUYWdzLmluY2x1ZGVzKHRhZykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZWRUYWdzLnB1c2godGFnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRhZ0VsZW1lbnRzID0gdGhpcy5rbm93blRhZ3MubWFwKCh0YWcpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGtleTogdGFnLCB2YWx1ZTogdGFnLCB0ZXh0TGFiZWw6IHRhZy5sZW5ndGggPiAzNiA/IGAke3RhZy5zbGljZSgwLCAzNil9Li4uYCA6IHRhZywgc2VsZWN0ZWQ6ICgoX2EgPSB0aGlzLmFjdGl2ZVRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKHRhZykpID49IDAgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jb21ib2JveFwiLCB7IGxhYmVsOiBpMThuLnRhZ3MsIG1heEl0ZW1zOiA1LCBcImFsbG93LWN1c3RvbS12YWx1ZXNcIjogdHJ1ZSwgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyICE9PSBudWxsICYmIHBsYWNlaG9sZGVyICE9PSB2b2lkIDAgPyBwbGFjZWhvbGRlciA6IGkxOG4uYWRkVGFncywgc2NhbGU6IHNjYWxlLCBvbktleURvd246IGhhbmRsZUtleWRvd24sIHJlZjogKGVsKSA9PiAodGhpcy5jb21ib2JveCA9IGVsKSB9LCB0YWdFbGVtZW50cykpO1xuICAgIH1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmNvbWJvYm94KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4sIHNjYWxlLCBoaWRlTGFiZWwsIGxhYmVsIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IHNjYWxlIH0sIGgoXCJwXCIsIHsgY2xhc3M6IHsgbGFiZWw6IHRydWUsIFwic2NyZWVuLXJlYWRlci1vbmx5XCI6IGhpZGVMYWJlbCB9IH0sIGxhYmVsICE9PSBudWxsICYmIGxhYmVsICE9PSB2b2lkIDAgPyBsYWJlbCA6IGkxOG4udGFncyksIHRoaXMucmVuZGVyRm9ybWF0dGVkVGFncygpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNUYWdzUGlja2VyLnN0eWxlID0gYXJjZ2lzVGFnc1BpY2tlckNzcztcblxuY29uc3QgYXJjZ2lzVGl0bGVJbnB1dENzcyA9IFwiLmxhYmVse21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OnZhcigtLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodCwgNDAwKX1jYWxjaXRlLWlucHV0ey0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMTp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci1pbnB1dCl9XCI7XG5cbmNvbnN0IEFyY2dpc1RpdGxlSW5wdXQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1RpdGxlSW5wdXRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1RpdGxlSW5wdXRDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuZGVib3VuY2VkSW5wdXQgPSBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVUaXRsZVZhbGlkYXRpb24oKTtcbiAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2NhbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbVRpdGxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmN1cnJlbnRGb2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51cGRhdGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lbmFibGVQdWJsaXNoaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRpdGxlRXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGZvY3VzTWFpbklucHV0KCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAvLyBhcmNnaXMtd29ya2Zsb3cgVE9ETzogbWFpbklucHV0UmVmIGlzIGFuIGVtcHR5IG9iamVjdCB3aGVuIHB1Ymxpc2ggaXRlbSBwcm9wZXJ0aWVzJyB0ZXN0IGNhbGxzIHZhbGlkYXRlXG4gICAgICAgIChfYiA9IChfYSA9IHRoaXMubWFpbklucHV0UmVmKS5zZXRGb2N1cykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EpO1xuICAgIH1cbiAgICBhc3luYyB2YWxpZGF0ZVRpdGxlKCkge1xuICAgICAgICAvLyBDaGVjayB3aGljaCBzaXR1YXRpb25zIHNob3VsZCBiZSBmbHVzaGVkIGluc3RlYWQgb2YgaW52b2tlZCAtIG1pZ2h0IG5lZWQgdG8gaW50cm9kdWNlIHNvbWV0aGluZyB0byBjYXRjaCBcIm1vZGlmaWVkIHNpbmNlIGxhc3QgdmFsaWRhdGVcIlxuICAgICAgICByZXR1cm4gdGhpcy5kZWJvdW5jZWRJbnB1dC5pbnZva2UoKTtcbiAgICAgICAgLy8gVE9ETzogUmVmZXIgdG8gdGhlIGJlbG93IHNuaXBwZXQgaWYgdGhlcmUncyBhIHRpbWluZyBpc3N1ZSBmb3VuZCBhbHdheXMgaW52b2tpbmdcbiAgICAgICAgLy8gV2Ugd2FudCB0byBpbnZva2UgdG8gdHJpZ2dlciB0aGUgZW1wdHkgdGl0bGUgZXJyb3Igc28gaXQgYWx3YXlzIGdldCB0cmlnZ2VyZWRcbiAgICAgICAgLy8gcmV0dXJuICF0aGlzLml0ZW1UaXRsZSA/IHRoaXMuZGVib3VuY2VkSW5wdXQuaW52b2tlKCkgOiB0aGlzLmRlYm91bmNlZElucHV0LmZsdXNoKCk7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVRpdGxlVmFsaWRhdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyB0eXBlLCBpdGVtVGl0bGUsIGVuYWJsZVB1Ymxpc2hpbmcsIHBvcnRhbCwgdXNlciwgdXBkYXRlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlTmFtZShpdGVtVGl0bGUpO1xuICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBpdGVtIHR5cGUgZm91bmQuIFNraXBwaW5nIHRpdGxlIHZhbGlkYXRpb25cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aXRsZUVycm9yID0gYXdhaXQgdmFsaWRhdGVUaXRsZSh7XG4gICAgICAgICAgICBwb3J0YWwsXG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgdGl0bGU6IGl0ZW1UaXRsZSxcbiAgICAgICAgICAgIGl0ZW1UeXBlOiB0eXBlLFxuICAgICAgICAgICAgZm9sZGVyOiB0aGlzLmN1cnJlbnRGb2xkZXIsXG4gICAgICAgICAgICBleHRlbnNpb24sXG4gICAgICAgICAgICBlbmFibGVQdWJsaXNoaW5nLFxuICAgICAgICAgICAgdXBkYXRlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRFcnJvck1lc3NhZ2UoKTtcbiAgICB9XG4gICAgZ2V0RXJyb3JNZXNzYWdlKCkge1xuICAgICAgICBjb25zdCB7IGl0ZW1UaXRsZSwgdGl0bGVFcnJvciwgaTE4biB9ID0gdGhpcztcbiAgICAgICAgaWYgKCFpdGVtVGl0bGUpIHtcbiAgICAgICAgICAgIHRoaXMudGl0bGVFcnJvciA9IHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcInRpdGxlUmVxdWlyZWRcIixcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGVkTWVzc2FnZTogdGhpcy5pMThuLnZhbGlkYXRpb24udGl0bGVSZXF1aXJlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoISF0aXRsZUVycm9yKSB7XG4gICAgICAgICAgICB0aXRsZUVycm9yLnRyYW5zbGF0ZWRNZXNzYWdlID0gaTE4bi52YWxpZGF0aW9uW3RoaXMudGl0bGVFcnJvci5jb2RlXS5yZXBsYWNlKFwiJHtuYW1lfVwiLCBpdGVtVGl0bGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aXRsZUVycm9yO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nO1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgICAgIC8vIEZhbGwgYmFjayB0byBjb25maWcgaWYgbm8gcHJvcHMgcGFzc2VkXG4gICAgICAgIChfYSA9IHRoaXMucG9ydGFsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAodGhpcy5wb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICAoX2IgPSB0aGlzLnVzZXIpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICh0aGlzLnVzZXIgPSBjb25maWdTdGF0ZS51c2VyKTtcbiAgICAgICAgKF9jID0gdGhpcy5zY2FsZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKHRoaXMuc2NhbGUgPSBjb25maWdTdGF0ZS5zY2FsZSk7XG4gICAgICAgIChfZCA9IHRoaXMuYXBpKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAodGhpcy5hcGkgPSBjb25maWdTdGF0ZS5hcGkpO1xuICAgICAgICAoX2UgPSB0aGlzLnR5cGUpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6ICh0aGlzLnR5cGUgPSBpdGVtUHJvcGVydGllc1N0YXRlLnR5cGUpO1xuICAgICAgICAoX2YgPSB0aGlzLml0ZW1UaXRsZSkgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogKHRoaXMuaXRlbVRpdGxlID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSk7XG4gICAgICAgIChfZyA9IHRoaXMuY3VycmVudEZvbGRlcikgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogKHRoaXMuY3VycmVudEZvbGRlciA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyKTtcbiAgICAgICAgdGhpcy5pdGVtVGl0bGUgJiYgdGhpcy5oYW5kbGVUaXRsZVZhbGlkYXRpb24oKTtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRoaXMuaXRlbVRpdGxlO1xuICAgICAgICAvLyBhcmNnaXMtd29ya2Zsb3cgVE9ETzogcmUtaW5pdGlhbGl6aW5nIGxvY2FsIHN0YXRlIG9uIHN0b3JlIHJlc2V0IGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGVzdHNcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdG9yZS5vbihcInJlc2V0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXRlbVRpdGxlID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGkxOG4sIGl0ZW1UaXRsZSwgc2NhbGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdHJhbnNsYXRlZE1lc3NhZ2UsIGNvZGUgfSA9IHRoaXMudGl0bGVFcnJvciB8fCB7fTtcbiAgICAgICAgY29uc3QgdmFsaWQgPSAhdHJhbnNsYXRlZE1lc3NhZ2U7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogc2NhbGUgfSwgaChcInBcIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIChfYSA9IHRoaXMubGFiZWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGkxOG4udGl0bGUpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGlkOiBcIml0ZW0tcHJvcGVydGllcy10aXRsZVwiLCBwbGFjZWhvbGRlcjogaTE4bi5hZGRUaXRsZSwgdmFsdWU6IGl0ZW1UaXRsZSwgc2NhbGU6IHNjYWxlLCBvbklucHV0OiB0aGlzLmRlYm91bmNlZElucHV0LCBtYXg6IE1BWF9USVRMRV9MRU5HVEgsIHJlZjogKGVsZSkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWxlKSwgc3RhdHVzOiB2YWxpZCA/IFwiaWRsZVwiIDogXCJpbnZhbGlkXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbVRpdGxlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVGl0bGVJbnB1dENoYW5nZS5lbWl0KHRoaXMuaXRlbVRpdGxlKTtcbiAgICAgICAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBoaWRkZW46IHZhbGlkLCBzdGF0dXM6IHZhbGlkID8gXCJpZGxlXCIgOiBcImludmFsaWRcIiB9LCB0cmFuc2xhdGVkTWVzc2FnZSB8fCBpMThuW2NvZGVdIHx8IGkxOG4udGl0bGUpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcImN1cnJlbnRGb2xkZXJcIjogW1wiaGFuZGxlVGl0bGVWYWxpZGF0aW9uXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc1RpdGxlSW5wdXQuc3R5bGUgPSBhcmNnaXNUaXRsZUlucHV0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNDYXRlZ29yaWVzUGlja2VyIGFzIGFyY2dpc19jYXRlZ29yaWVzX3BpY2tlciwgQXJjZ2lzRm9sZGVyUGlja2VyIGFzIGFyY2dpc19mb2xkZXJfcGlja2VyLCBBcmNnaXNJdGVtUHJvcGVydGllcyBhcyBhcmNnaXNfaXRlbV9wcm9wZXJ0aWVzLCBBcmNnaXNTdW1tYXJ5SW5wdXQgYXMgYXJjZ2lzX3N1bW1hcnlfaW5wdXQsIEFyY2dpc1RhZ3NQaWNrZXIgYXMgYXJjZ2lzX3RhZ3NfcGlja2VyLCBBcmNnaXNUaXRsZUlucHV0IGFzIGFyY2dpc190aXRsZV9pbnB1dCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtY2F0ZWdvcmllcy1waWNrZXJfNi5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRHcm91cFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5cbmNvbnN0IGdldEl0ZW1DYXRlZ29yeVNjaGVtYSA9IGFzeW5jICh7IHBvcnRhbCwgdXNlciwgZ3JvdXAsIHVzZUNhY2hlID0gZmFsc2UgfSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBmZXRjaFJlc3VsdCA9IGF3YWl0IChncm91cFxuICAgICAgICAgICAgPyBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cC5pZCwgcG9ydGFsLCB1c2VDYWNoZSlcbiAgICAgICAgICAgIDogZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlciwgdXNlQ2FjaGUpKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiAoX2EgPSBmZXRjaFJlc3VsdCA9PT0gbnVsbCB8fCBmZXRjaFJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmV0Y2hSZXN1bHQuY2F0ZWdvcnlTY2hlbWEpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5hc3luYyBmdW5jdGlvbiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICB1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHZvaWQgMCA/IHVzZXIgOiAodXNlciA9IGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgIGlmICghKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pZCkgfHwgKHVzZXIgJiYgaXNQdWJsaWNVc2VyKHVzZXIpKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfXBvcnRhbHMvJHtwb3J0YWwuaWR9L2NhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpIDogZ2V0U2NoZW1hKCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICBpZiAoIWdyb3VwSWQgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRHcm91cFJlc3RCYXNlVXJsKHBvcnRhbCwgeyBpZDogZ3JvdXBJZCB9KX1jYXRlZ29yeVNjaGVtYWApO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgZ3JvdXBJZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1wb3J0YWxzL3NlbGZgKTtcbiAgICBjb25zdCBncm91cFNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb21tdW5pdHkvZ3JvdXBzP3E9JHtzZWxmLmNvbnRlbnRDYXRlZ29yeVNldHNHcm91cFF1ZXJ5fWApO1xuICAgIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW1TZWFyY2ggPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9ncm91cHMvJHtjYXRlZ29yeUdyb3VwLmlkfS9zZWFyY2hgLCB7XG4gICAgICAgIHE6IGB0eXBla2V5d29yZHM6ICR7Y2F0ZWdvcnlOYW1lfWBcbiAgICB9KTtcbiAgICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICAgIHJldHVybiByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9pdGVtcy8ke3NjaGVtYUl0ZW0uaWR9L2RhdGFgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgY2F0ZWdvcnlOYW1lLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCwgY2F0ZWdvcnlOYW1lKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIGNhdGVnb3J5TmFtZSkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNhdGVnb3JpZXMoeyBjYXRlZ29yaWVzLCBpdGVtSWRzLCBwb3J0YWwgfSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L2NvbnRlbnQvdXBkYXRlSXRlbXNgO1xuICAgICAgICBjb25zdCBpdGVtcyA9IEpTT04uc3RyaW5naWZ5KGl0ZW1JZHMubWFwKChpZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBbaWRdOiB7IGNhdGVnb3JpZXM6IEFycmF5LmlzQXJyYXkoY2F0ZWdvcmllcykgPyBjYXRlZ29yaWVzIDogY2F0ZWdvcmllc1tpZF0gfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3QodXJsLCB7IGl0ZW1zIH0sIHt9LCBcInBvc3RcIikgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMgYXMgYSwgZmV0Y2hHcm91cENhdGVnb3JpZXMgYXMgYiwgZmV0Y2hDYXRlZ29yaWVzIGFzIGYsIGdldEl0ZW1DYXRlZ29yeVNjaGVtYSBhcyBnLCB1cGRhdGVDYXRlZ29yaWVzIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy05ZjBmMzdlZS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IENBVEVHT1JZX0JBU0VfUEFUSCA9IFwiL2NhdGVnb3JpZXNcIjtcbmNvbnN0IFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSCA9IFwiL0NhdGVnb3JpZXNcIjtcblxuLy8gVE9ETzogYWRkIHVuaXQgdGVzdHNcbi8qKlxuICogQ29uc3RydWN0IHRoZSBwYXRoIG9mIHRoZSBjYXRlZ29yeSBiYXNlZCBvbiB0aGUgcGFyZW50IHBhdGggYW5kIHRoZSBjYXRlZ29yeSB0aXRsZVxuICovXG5jb25zdCBnZXRDYXRlZ29yeVVJUGF0aCA9IChwYXJlbnRQYXRoLCBjYXRlZ29yeSwgbG93ZXJDYXNlID0gdHJ1ZSkgPT4ge1xuICAgIGNvbnN0IGJhc2VQYXRoID0gcGFyZW50UGF0aCAhPT0gbnVsbCAmJiBwYXJlbnRQYXRoICE9PSB2b2lkIDAgPyBwYXJlbnRQYXRoIDogXCJcIjtcbiAgICByZXR1cm4gYCR7YmFzZVBhdGh9JHtiYXNlUGF0aC5lbmRzV2l0aChcIi9cIikgPyBcIlwiIDogXCIvXCJ9JHtsb3dlckNhc2UgPyBjYXRlZ29yeS50aXRsZS50b0xvY2FsZUxvd2VyQ2FzZSgpIDogY2F0ZWdvcnkudGl0bGV9YDtcbn07XG4vKipcbiAqIEZpbmQgdGhlIHJvb3Qgbm9kZSB0aXRsZSB0byB1c2UgZm9yIGNhdGVnb3JpZXNcbiAqL1xuZnVuY3Rpb24gZ2V0Um9vdENhdGVnb3J5UGF0aChjYXRlZ29yaWVzKSB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBjYXRlZ29yeVRpdGxlID0gKF9hID0gY2F0ZWdvcmllcyA9PT0gbnVsbCB8fCBjYXRlZ29yaWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjYXRlZ29yaWVzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGU7XG4gICAgaWYgKGNhdGVnb3J5VGl0bGUgJiYgY2F0ZWdvcnlUaXRsZS5jaGFyQXQoMCkgIT09IFwiL1wiKSB7XG4gICAgICAgIGNhdGVnb3J5VGl0bGUgPSBgLyR7Y2F0ZWdvcnlUaXRsZX1gO1xuICAgIH1cbiAgICByZXR1cm4gY2F0ZWdvcnlUaXRsZSB8fCBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEg7XG59XG5cbmV4cG9ydCB7IENBVEVHT1JZX0JBU0VfUEFUSCBhcyBDLCBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEggYXMgVSwgZ2V0Q2F0ZWdvcnlVSVBhdGggYXMgYSwgZ2V0Um9vdENhdGVnb3J5UGF0aCBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNhdGVnb3JpZXMtY2ExMzQwMDUuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuXG5mdW5jdGlvbiBzYW5pdGl6ZUZpbGVOYW1lKG5hbWUsIGFkZEdVSUQpIHtcbiAgICAvL1RPRE86IGFkZCBuZXcgcGFyYW0gdG8gc3BlYyBmaWxlLlxuICAgIGNvbnN0IGV4cHJlc3Npb24gPSAvKD86XFwuKFteLl0rKSk/JC87XG4gICAgY29uc3QgaW52YWxpZFRpdGxlQ2hhcmFjdGVycyA9IC9cXC58LS9nO1xuICAgIGxldCBmaWxlTmFtZSA9IG5hbWUucmVwbGFjZSgvXi4qKFxcXFx8XFwvfDopLywgXCJcIik7XG4gICAgbGV0IGV4dGVuc2lvbiA9IChmaWxlTmFtZSAmJiBleHByZXNzaW9uLmV4ZWMoZmlsZU5hbWUpWzFdID8gZXhwcmVzc2lvbi5leGVjKGZpbGVOYW1lKVsxXS50b0xvd2VyQ2FzZSgpIDogXCJcIik7XG4gICAgbGV0IHRpdGxlID0gXCJcIjtcbiAgICBpZiAoZmlsZU5hbWUuaW5kZXhPZihcIi5yZnQuXCIpID4gLTEpIHtcbiAgICAgICAgY29uc3QgW25hbWUsIHN1ZmZpeF0gPSBmaWxlTmFtZS5zcGxpdChcIi5yZnQuXCIpO1xuICAgICAgICBleHRlbnNpb24gPSBgcmZ0LiR7c3VmZml4fWA7XG4gICAgICAgIHRpdGxlID0gbmFtZTtcbiAgICB9XG4gICAgaWYgKGZpbGVOYW1lICYmICF0aXRsZSkge1xuICAgICAgICB0aXRsZSA9IGZpbGVOYW1lLmxhc3RJbmRleE9mKFwiLlwiKSA9PT0gLTEgPyBmaWxlTmFtZSA6IGZpbGVOYW1lLnN1YnN0cmluZygwLCBmaWxlTmFtZS5sYXN0SW5kZXhPZihcIi5cIikpO1xuICAgIH1cbiAgICAvLyBSZXBsYWNlIGFueSBpbnZhbGlkIGNoYXJhY3RlcnMgd2l0aCBhbiB1bmRlcnNjb3JlXG4gICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGludmFsaWRUaXRsZUNoYXJhY3RlcnMsIFwiX1wiKTtcbiAgICAvLyBBbGxvdyBmaWxlIHVwbG9hZCBvZiBleGlzdGluZyBpdGVtJ3MgZmlsZSBuYW1lIC8vIGN1cnJlbnRseSB1c2VkIGluIGFwcGVuZFxuICAgIGlmIChhZGRHVUlEKSB7XG4gICAgICAgIHRpdGxlID0gbWFrZVVuaXF1ZUZpbGVOYW1lKHRpdGxlKTtcbiAgICAgICAgZmlsZU5hbWUgPSBgJHt0aXRsZX0uJHtleHRlbnNpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfTtcbn1cbi8vIEhlbHBlciBtZXRob2QgdGhhdCB0YWtlcyBpbiBhIGZpbGUgJiByZXR1cm5zIHRoZSBjbGVhbmVkIHVwIGZpbGUgbmFtZSBhcyBpcyBhbmQgaW4gdGl0bGUgZm9ybSwgYW5kIHRoZSBkZXRlY3RlZCBmaWxlIGV4dGVuc2lvblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgYWRkR1VJRCkge1xuICAgIHJldHVybiBzYW5pdGl6ZUZpbGVOYW1lKGZpbGUubmFtZSwgISFhZGRHVUlEKTtcbn1cbmZ1bmN0aW9uIG1ha2VVbmlxdWVGaWxlTmFtZShuYW1lKSB7XG4gICAgcmV0dXJuIGAke25hbWV9XyR7Z3VpZCgpfWA7XG59XG5mdW5jdGlvbiB2YWxpZGF0ZU92ZXJ3cml0ZUZpbGVOYW1lKHVwbG9hZGVkRmlsZU5hbWUsIHNvdXJjZUZpbGVOYW1lKSB7XG4gICAgbGV0IGZpbGVOYW1lID0gdXBsb2FkZWRGaWxlTmFtZTtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHVwbG9hZGVkRmlsZU5hbWUubGFzdEluZGV4T2YoXCJcXFxcXCIpO1xuICAgIGlmIChwb3NpdGlvbiA+IC0xKSB7XG4gICAgICAgIGZpbGVOYW1lID0gZmlsZU5hbWUuc3Vic3RyaW5nKHBvc2l0aW9uICsgMSwgZmlsZU5hbWUubGVuZ3RoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIikgPT09IHNvdXJjZUZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIik7XG59XG5mdW5jdGlvbiBnZXRJdGVtSW5mb0J5VHlwZSh0eXBlKSB7XG4gICAgaWYgKGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkge1xuICAgICAgICByZXR1cm4gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGFkZENyZWF0ZUl0ZW1UeXBlc1tPYmplY3Qua2V5cyhhZGRDcmVhdGVJdGVtVHlwZXMpLmZpbmQoKGZpbGVUeXBlKSA9PiBhZGRDcmVhdGVJdGVtVHlwZXNbZmlsZVR5cGVdLnR5cGUgPT09IHR5cGUpXTtcbiAgICB9XG59XG5mdW5jdGlvbiBmb3JtYXRGaWxlU2l6ZShzaXplKSB7XG4gICAgaWYgKCFzaXplKSB7XG4gICAgICAgIHJldHVybiBcIjAgQlwiO1xuICAgIH1cbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhzaXplKSAvIE1hdGgubG9nKDEwMjQpKTtcbiAgICBjb25zdCBhZGp1c3RlZFNpemUgPSBNYXRoLnJvdW5kKHNpemUgLyBNYXRoLnBvdygxMDI0LCBpKSk7XG4gICAgY29uc3QgdW5pdCA9IFtcIkJcIiwgXCJLQlwiLCBcIk1CXCIsIFwiR0JcIiwgXCJUQlwiXVtpXTtcbiAgICByZXR1cm4gYCR7YWRqdXN0ZWRTaXplfSAke3VuaXR9YDtcbn1cblxuZXhwb3J0IHsgc2FuaXRpemVGaWxlTmFtZSBhcyBhLCBmb3JtYXRGaWxlU2l6ZSBhcyBmLCBnZXRJdGVtSW5mb0J5VHlwZSBhcyBnLCBzYW5pdGl6ZUZpbGVJbnB1dCBhcyBzLCB2YWxpZGF0ZU92ZXJ3cml0ZUZpbGVOYW1lIGFzIHYgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmlsZS1iZjhhYjkwZi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmNvbnN0IGdldEdyb3VwUmVzdEJhc2VVcmwgPSAocG9ydGFsLCBncm91cCkgPT4gYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXAuaWR9YCk7XG5cbmV4cG9ydCB7IGdldEdyb3VwUmVzdEJhc2VVcmwgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ncm91cC02YTYzMDNiMC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSWQoY291bnRzKSB7XG4gICAgcmV0dXJuIGNvdW50c1xuICAgICAgICAubWFwKChjb3VudCkgPT4ge1xuICAgICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQgKz0gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfSlcbiAgICAgICAgLmpvaW4oXCItXCIpO1xufVxuY29uc3QgZ3VpZCA9ICgpID0+IGdlbmVyYXRlSWQoWzIsIDEsIDEsIDEsIDNdKTtcblxuZXhwb3J0IHsgZ3VpZCBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWd1aWQtYWVhZWQ4NGQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgICBbXCJhclwiLCBcImFyXCJdLFxuICAgIFtcImJnXCIsIFwiYmdcIl0sXG4gICAgW1wiYnNcIiwgXCJic1wiXSxcbiAgICBbXCJjYVwiLCBcImNhXCJdLFxuICAgIFtcImNzXCIsIFwiY3NcIl0sXG4gICAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgICBbXCJkZVwiLCBcImRlXCJdLFxuICAgIFtcImVsXCIsIFwiZWxcIl0sXG4gICAgW1wiZW5cIiwgXCJlblwiXSxcbiAgICBbXCJlc1wiLCBcImVzXCJdLFxuICAgIFtcImV0XCIsIFwiZXRcIl0sXG4gICAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgICBbXCJmclwiLCBcImZyXCJdLFxuICAgIFtcImhlXCIsIFwiaGVcIl0sXG4gICAgW1wiaHJcIiwgXCJoclwiXSxcbiAgICBbXCJodVwiLCBcImh1XCJdLFxuICAgIFtcImlkXCIsIFwiaWRcIl0sXG4gICAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgICBbXCJqYVwiLCBcImphXCJdLFxuICAgIFtcImtvXCIsIFwia29cIl0sXG4gICAgW1wibHRcIiwgXCJsdFwiXSxcbiAgICBbXCJsdlwiLCBcImx2XCJdLFxuICAgIFtcIm5iXCIsIFwibmJcIl0sXG4gICAgW1wibmxcIiwgXCJubFwiXSxcbiAgICBbXCJwbFwiLCBcInBsXCJdLFxuICAgIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gICAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgICBbXCJyb1wiLCBcInJvXCJdLFxuICAgIFtcInJ1XCIsIFwicnVcIl0sXG4gICAgW1wic2tcIiwgXCJza1wiXSxcbiAgICBbXCJzbFwiLCBcInNsXCJdLFxuICAgIFtcInNyXCIsIFwic3JcIl0sXG4gICAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgICBbXCJ0aFwiLCBcInRoXCJdLFxuICAgIFtcInRyXCIsIFwidHJcIl0sXG4gICAgW1widWtcIiwgXCJ1a1wiXSxcbiAgICBbXCJ2aVwiLCBcInZpXCJdLFxuICAgIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gICAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICAgIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmIChhcGkgPT09IDQpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgICAgICAgIHBsYWNlcyxcbiAgICAgICAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgICB9XG4gICAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICAgIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcGxhY2VzLFxuICAgICAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICAgIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICAgIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgICAgIGRheTogXCJudW1lcmljXCJcbiAgICB9O1xuICAgIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICAgICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuZnVuY3Rpb24gZm9ybWF0UGx1cmFsKGxhbmcsIHN0cmluZ09iaiwgbnVtYmVyKSB7XG4gICAgY29uc3Qgc2luZ2xlcyA9IFtcImlkXCIsIFwiamFcIiwgXCJrb1wiLCBcInRoXCIsIFwidmlcIiwgXCJ6aC1jblwiLCBcInpoLWhrXCIsIFwiemgtdHdcIl07XG4gICAgY29uc3QgbGlrZUVuZ2xpc2ggPSBbXG4gICAgICAgIFwiZW5cIixcbiAgICAgICAgXCJjYVwiLFxuICAgICAgICBcImRhXCIsXG4gICAgICAgIFwiZGVcIixcbiAgICAgICAgXCJlbFwiLFxuICAgICAgICBcImVzXCIsXG4gICAgICAgIFwiZXRcIixcbiAgICAgICAgXCJmaVwiLFxuICAgICAgICBcImhpXCIsXG4gICAgICAgIFwiaHVcIixcbiAgICAgICAgXCJpdFwiLFxuICAgICAgICBcIm5iXCIsXG4gICAgICAgIFwibmxcIixcbiAgICAgICAgXCJwdC1wdFwiLFxuICAgICAgICBcInN2XCIsXG4gICAgICAgIFwidHJcIlxuICAgIF07XG4gICAgY29uc3QgbG9jYWxlID0gbGFuZyAhPT0gbnVsbCAmJiBsYW5nICE9PSB2b2lkIDAgPyBsYW5nIDogXCJlblwiO1xuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgb25lLCBvciBpdCBpcyBhIFwic2ltcGxlXCIgbGFuZ3VhZ2UsIHJldHVybiB0aGUgMSBzdHJpbmdcbiAgICBpZiAobnVtYmVyID09PSAxIHx8IHNpbmdsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLnNpbmdsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIFwiMVwiKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBub3QgMSBhbmQgdGhlIGxhbmd1YWdlIHVzZXMgdGhlIHNhbWUgcGx1cmFsaXphdGlvbiBzdHJhdGVneSBhcyBlbmdsaXNoLFxuICAgIC8vIHJldHVybiB0aGUgbXVsdGlwbGUgc3RyaW5nXG4gICAgaWYgKG51bWJlciAhPT0gMSAmJiBsaWtlRW5nbGlzaC5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmoubXVsdGlwbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG4gICAgfVxuICAgIC8vIGlmIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmtlZCwgcmV0dXJuIHRoZSBcInVua25vd25cIiBzdHJpbmdcbiAgICByZXR1cm4gc3RyaW5nT2JqLnVua25vd24ucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0UGx1cmFsIGFzIGIsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gICAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgICAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgICAgICAgIHJldHVybiBsYW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gICAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICAgIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgICBsZXQgc3RyaW5ncztcbiAgICB0cnkge1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gICAgfVxuICAgIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYWxlLTA1MGI2ZGI5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgdSBhcyB1c2VySXNJdGVtQWRtaW4sIGMgYXMgY2FuVXBkYXRlSXRlbSwgZCBhcyBpdGVtc0JlbG9uZ1RvVXNlck9yZyB9IGZyb20gJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5cbmNvbnN0IGdldFVzZXJSb2xlID0gKHVzZXIpID0+IHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICByZXR1cm4gdHlwZW9mICh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZSkgPT09IFwic3RyaW5nXCIgJiYgISEodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGUpXG4gICAgICAgID8gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGVcbiAgICAgICAgOiAoX2IgPSAoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZUlkKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuaWQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IChfYyA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5zb3VyY2VKU09OKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaWQ7XG59O1xuZnVuY3Rpb24gaXNQdWJsaWNVc2VyKHVzZXIpIHtcbiAgICByZXR1cm4gdXNlciAmJiAhdXNlci5vcmdJZDtcbn1cbmZ1bmN0aW9uIGlzSG9zdGVkUG9ydGFsKHBvcnRhbCkge1xuICAgIHJldHVybiAhcG9ydGFsLmlzUG9ydGFsIHx8ICEhcG9ydGFsLmlzQmFja2VkQnlTRFM7XG59XG5mdW5jdGlvbiBpc0RldmVsb3BlcihzdWJzY3JpcHRpb25JbmZvKSB7XG4gICAgY29uc3QgZGV2U3Vic2NyaXB0aW9uVHlwZXMgPSBbXCJUcmlhbCBEZXZlbG9wZXJcIiwgXCJEZXZlbG9wZXJcIiwgXCJEZXZlbG9wZXIgU3Vic2NyaXB0aW9uXCJdO1xuICAgIHJldHVybiBkZXZTdWJzY3JpcHRpb25UeXBlcy5pbmNsdWRlcyhzdWJzY3JpcHRpb25JbmZvID09PSBudWxsIHx8IHN1YnNjcmlwdGlvbkluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1YnNjcmlwdGlvbkluZm8udHlwZSk7XG59XG5mdW5jdGlvbiBpc09yZ0FkbWluKHVzZXIpIHtcbiAgICByZXR1cm4gZ2V0VXNlclJvbGUodXNlcikgPT09IFwib3JnX2FkbWluXCIgfHwgZ2V0VXNlclJvbGUodXNlcikgPT09IFwiYWNjb3VudF9hZG1pblwiO1xufVxuZnVuY3Rpb24gaXNPcmdVc2VyKHVzZXIpIHtcbiAgICByZXR1cm4gZ2V0VXNlclJvbGUodXNlcikgPT09IFwib3JnX3VzZXJcIiB8fCBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJhY2NvdW50X3VzZXJcIjtcbn1cbmZ1bmN0aW9uIGlzQ3VzdG9tUm9sZSh1c2VyKSB7XG4gICAgLy8gVGhlIEhvbWUgQXBwIGNvbGxhcHNlIHRoZSBgcm9sZUlkYCBhbmQgYHJvbGVgIGludG8gYSBzaW5nbGUgYGlkYCBwcm9wZXJ0eSwgdGhhdCdzIHdoeVxuICAgIC8vICBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9ibG9iL21hc3Rlci9zcmMvanMvYXJjZ2lzb25saW5lL3NoYXJpbmcvZGlqaXQvUm9sZS50cyNMNDY5IHdvcmtzXG4gICAgLy8gSW4gcHJhY3RpY2UsIHdlIG9ubHkgbmVlZCB0byBjaGVjayBpZiBgcm9sZUlkYCBleGlzdFxuICAgIC8vICBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDQ2ODIjaXNzdWVjb21tZW50LTQxNDY4NjZcbiAgICByZXR1cm4gISEodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGVJZCkgJiYgdXNlci5yb2xlSWQubGVuZ3RoID4gMDtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHByaXZpbGVnZSBcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtQ2F0ZWdvcnlTY2hlbWFcIiBpcyBncmFudGVkLlxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVJdGVtQ2F0ZWdvcmllcyh1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1DYXRlZ29yeVNjaGVtYVwiKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBwcml2aWxlZ2UgXCJwb3J0YWw6YWRtaW46dXBkYXRlR3JvdXBzXCIgaXMgZ3JhbnRlZC5cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlT3JnR3JvdXBzKHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dXBkYXRlR3JvdXBzXCIpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byB1cGRhdGUgb3RoZXIgdXNlcidzIGl0ZW1zIGluIHRoZWlyIG9yZ2FuaXphdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlT3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbXNcIik7XG59XG4vKipcbiAqIENoZWNrcyB0byBlbnN1cmUgdGhlIHBvcnRhbCBpcyBhbiBvcmdhbml6YXRpb24gcG9ydGFsXG4gKi9cbmZ1bmN0aW9uIGlzT3JnUG9ydGFsKHBvcnRhbCkge1xuICAgIHJldHVybiAhIShwb3J0YWwudXJsS2V5ICYmIHBvcnRhbC5jdXN0b21CYXNlVXJsKSB8fCAhIXBvcnRhbC5pc1BvcnRhbDtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBzaGFyZSB0aGVpciBpdGVtIHRvIGdyb3Vwc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZUl0ZW1Ub0dyb3VwKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb0dyb3VwXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gc2hhcmUgYW4gaXRlbSBvbiBhIGdpdmVuIHBvcnRhbFxuICovXG5mdW5jdGlvbiBjYW5TaGFyZSh1c2VyLCBwb3J0YWwpIHtcbiAgICByZXR1cm4gKCFpc09yZ1BvcnRhbChwb3J0YWwpIHx8XG4gICAgICAgIGNhblNoYXJlSXRlbVRvR3JvdXAodXNlcikgfHxcbiAgICAgICAgY2FuU2hhcmVJdGVtVG9PcmcodXNlcikgfHxcbiAgICAgICAgKCEhcG9ydGFsLmNhblNoYXJlUHVibGljICYmIGNhblNoYXJlSXRlbVRvUHVibGljKHVzZXIpKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gc2hhcmUgdGhlaXIgaXRlbSBvdCB0aGUgb3JnYW5pemF0aW9uLlxuICovXG5mdW5jdGlvbiBjYW5TaGFyZUl0ZW1Ub09yZyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9PcmdcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gc2hhcmUgdGhlaXIgaXRlbSB0byBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9QdWJsaWModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvUHVibGljXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gc2hhcmUgb3RoZXIgdXNlcidzIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjpzaGFyZVRvT3JnXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gc2hhcmUgb3RoZXIgdXNlcidzIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlT3RoZXJzSXRlbXNUb1B1YmxpYyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjpzaGFyZVRvUHVibGljXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gc2hhcmUgb3RoZXIgdXNlcidzIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGFkbWluQ2FuU2hhcmVPdGhlcnNJdGVtVG9Hcm91cCh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjpzaGFyZVRvR3JvdXBcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGluIGFuIGFsbG93ZWQgb3JnYW5pemF0aW9uIGFuZCBoYXMgdGhlIHBvd2VyIHRvIG1hbmFnZSBjb2xsYWJvcmF0aW9uc1xuICovXG5mdW5jdGlvbiBjYW5NYW5hZ2VDb2xsYWJvcmF0aW9ucyhjb25maWcsIHVzZXIsIHBvcnRhbCwgc3Vic2NyaXB0aW9uSW5mbykge1xuICAgIGNvbnN0IGV4Y2x1ZGVkT3JnVHlwZXMgPSBbXCJUcmlhbFwiLCBcIlRyaWFsIFByZXNzXCIsIFwiVHJpYWwgRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyIFN1YnNjcmlwdGlvblwiLCBcIkV2YWx1YXRpb25cIl07XG4gICAgY29uc3QgaXNWYWxpZE9yZ1R5cGUgPSBzdWJzY3JpcHRpb25JbmZvICYmICFleGNsdWRlZE9yZ1R5cGVzLmluY2x1ZGVzKHN1YnNjcmlwdGlvbkluZm8udHlwZSk7XG4gICAgY29uc3QgaGFzUHJpdmlsZWdlID0gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOm1hbmFnZUNvbGxhYm9yYXRpb25zXCIpO1xuICAgIHJldHVybiAhISgoY29uZmlnID09PSBudWxsIHx8IGNvbmZpZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnLmNvbGxhYm9yYXRpb25zRW5hYmxlZCkgJiZcbiAgICAgICAgdXNlciAmJlxuICAgICAgICAoaXNPcmdBZG1pbih1c2VyKSB8fCBoYXNQcml2aWxlZ2UpICYmXG4gICAgICAgICgocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlzUG9ydGFsKSB8fCBpc1ZhbGlkT3JnVHlwZSkpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gdmlldyBvdGhlciBvcmdhbml6YXRpb24gdXNlcnMnIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblZpZXdPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp2aWV3SXRlbXNcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiB2aWV3IG90aGVyIG9yZ2FuaXphdGlvbiB1c2VycycgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuVmlld090aGVyc09yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gISF1c2VyICYmICghaXNDdXN0b21Sb2xlKHVzZXIpIHx8IChpc0N1c3RvbVJvbGUodXNlcikgJiYgY2FuVmlld09yZ0l0ZW1zKHVzZXIpKSk7XG59XG4vLyBUT0RPOiBhZGQgdW5pdCB0ZXN0c1xuY29uc3QgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSA9ICh7IGl0ZW1zLCB1c2VyLCBwb3J0YWwgfSkgPT4ge1xuICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1swXTtcbiAgICAvLyBlbnRlcnByaXNlIGluY29ycmVjdGx5IHJldHVybnMgaXRlbXMgb3duZWQgYnkgXCJlc3JpX1wiIGFzIGl0ZW0gY29udHJvbCBhZG1pbiAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzM4Njk1KVxuICAgIGNvbnN0IG93bmVyID0gaXRlbS5vd25lcjtcbiAgICBjb25zdCB3aGl0ZWxpc3RPd25lciA9IFtcImVzcmlfbGl2aW5nYXRsYXNcIl07XG4gICAgaWYgKHBvcnRhbC5pc1BvcnRhbCAmJiBvd25lciAhPT0gdXNlci51c2VybmFtZSAmJiBvd25lci5pbmNsdWRlcyhcImVzcmlfXCIpICYmICF3aGl0ZWxpc3RPd25lci5pbmNsdWRlcyhvd25lcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBpc093bmVyT3JBZG1pbiA9IHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKTtcbiAgICBjb25zdCBpc0N1c3RvbSA9IGlzQ3VzdG9tUm9sZSh1c2VyKTtcbiAgICBjb25zdCBjYW5TaGFyZU9yZ0l0ZW1zID0gY2FuU2hhcmVPdGhlcnNJdGVtcyh1c2VyKTtcbiAgICBjb25zdCBjYW5VcGRhdGVBbmRTaGFyZSA9IGNhblVwZGF0ZUl0ZW0oaXRlbSwgdXNlcikgJiZcbiAgICAgICAgY2FuVXBkYXRlT3JnSXRlbXModXNlcikgJiZcbiAgICAgICAgIWlzQ3VzdG9tICYmXG4gICAgICAgIChjYW5TaGFyZSh1c2VyLCBwb3J0YWwpIHx8IGNhblNoYXJlT3RoZXJzSXRlbXModXNlcikpO1xuICAgIC8vIGlmIGl0J3MgdGhlIGl0ZW0gb3duZXIgb3IgYWRtaW4sIG9yIGN1c3RvbSBhZG1pbiB3aG8gY2FuIHNoYXJlXG4gICAgcmV0dXJuIGlzT3duZXJPckFkbWluIHx8IGNhblVwZGF0ZUFuZFNoYXJlIHx8IChpdGVtc0JlbG9uZ1RvVXNlck9yZyhpdGVtcywgdXNlcikgJiYgY2FuU2hhcmVPcmdJdGVtcyk7XG59O1xuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gc2hhcmUgb3RoZXIgdXNlcidzIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlT3RoZXJzSXRlbXModXNlcikge1xuICAgIHJldHVybiBhZG1pbkNhblNoYXJlT3RoZXJzSXRlbVRvR3JvdXAodXNlcikgfHwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvT3JnKHVzZXIpIHx8IGNhblNoYXJlT3RoZXJzSXRlbXNUb1B1YmxpYyh1c2VyKTtcbn1cblxuZXhwb3J0IHsgaXNQdWJsaWNVc2VyIGFzIGEsIGlzT3JnQWRtaW4gYXMgYiwgaXNIb3N0ZWRQb3J0YWwgYXMgYywgaXNDdXN0b21Sb2xlIGFzIGQsIGNhblVwZGF0ZU9yZ0dyb3VwcyBhcyBlLCBjYW5VcGRhdGVJdGVtQ2F0ZWdvcmllcyBhcyBmLCBjYW5NYW5hZ2VDb2xsYWJvcmF0aW9ucyBhcyBnLCBpc09yZ1VzZXIgYXMgaCwgaXNEZXZlbG9wZXIgYXMgaSwgY2FuU2hhcmVJdGVtVG9Hcm91cCBhcyBqLCBjYW5TaGFyZUl0ZW1Ub09yZyBhcyBrLCBhZG1pbkNhblNoYXJlT3RoZXJzSXRlbVRvR3JvdXAgYXMgbCwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvT3JnIGFzIG0sIGNhblNoYXJlSXRlbVRvUHVibGljIGFzIG4sIGNhblNoYXJlT3RoZXJzSXRlbXNUb1B1YmxpYyBhcyBvLCBoYXNBZG1pblNoYXJlUHJpdmlsZWdlIGFzIHAsIGNhblZpZXdPdGhlcnNPcmdJdGVtcyBhcyBxIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXByaXZpbGVnZXMtNWMzODJmNjEuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hVc2VyKHVzZXJuYW1lLCBwb3J0YWwpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvdXNlcnMvJHt1c2VybmFtZX1gKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU2VsZigpIHtcbiAgICByZXR1cm4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybCgpfS9jb21tdW5pdHkvc2VsZmApO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcygpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHNlbGYgPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gZmV0Y2hTZWxmKCksIFwiY29tbXVuaXR5U2VsZlwiLCB1c2VyLnVzZXJuYW1lKTtcbiAgICByZXR1cm4gKF9hID0gc2VsZiA9PT0gbnVsbCB8fCBzZWxmID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxmLmdyb3VwcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG59XG5hc3luYyBmdW5jdGlvbiBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAoKSB7XG4gICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyO1xuICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaFNlbGYoKSwgXCJjb21tdW5pdHlTZWxmXCIsIHVzZXIudXNlcm5hbWUpO1xuICAgIHJldHVybiBzZWxmLmZhdkdyb3VwSWQ7XG59XG5mdW5jdGlvbiBnZXRVc2VyQ29udGVudFVybCh1c2VyLCBwb3J0YWwpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci51c2VyQ29udGVudFVybCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYCR7cG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnJlc3RVcmx9L2NvbnRlbnQvdXNlcnMvJHt1c2VyLnVzZXJuYW1lfWA7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyQ29udGVudChwb3J0YWxVc2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHVzZXIgPSAoX2EgPSBwb3J0YWxVc2VyICE9PSBudWxsICYmIHBvcnRhbFVzZXIgIT09IHZvaWQgMCA/IHBvcnRhbFVzZXIgOiBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb25maWdTdGF0ZS5wb3J0YWwudXNlcjtcbiAgICBjb25zdCBwb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgY29uc3QgdXJsID0gZ2V0VXNlckNvbnRlbnRVcmwodXNlciwgcG9ydGFsKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IG51bTogMSB9KTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlcnMocG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgeyBmb2xkZXJzIH0gPSBhd2FpdCBnZXRVc2VyQ29udGVudCh1c2VyKTtcbiAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSB1c2VyO1xuICAgIGNvbnN0IHNvcnRlZEZvbGRlcnMgPSBmb2xkZXJzLnNvcnQoKGEsIGIpID0+IGEudGl0bGUubG9jYWxlQ29tcGFyZShiLnRpdGxlKSk7XG4gICAgLy8gYWRkIHRoZSBob21lIGZvbGRlciBhcyBpZiBpdCdzIGluIHRoZSBsaXN0XG4gICAgcmV0dXJuIFt7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9LCAuLi5zb3J0ZWRGb2xkZXJzXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbGRlckZyb21JZChmb2xkZXJJZCwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gICAgcmV0dXJuIGZvbGRlcnMuZmluZCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQgPT09IGZvbGRlcklkKTtcbn1cbmZ1bmN0aW9uIGdldEhvbWVGb2xkZXJGb3JVc2VyKHVzZXJuYW1lKSB7XG4gICAgcmV0dXJuIHsgdXNlcm5hbWUsIGlkOiB1c2VybmFtZSwgdGl0bGU6IHVzZXJuYW1lLCBjcmVhdGVkOiBcIm5vd1wiIH07XG59XG5hc3luYyBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoZm9sZGVyTmFtZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vY3JlYXRlRm9sZGVyYDtcbiAgICBjb25zdCBmb2xkZXJSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7IHRpdGxlOiBmb2xkZXJOYW1lIH0sIHt9LCBcInBvc3RcIik7XG4gICAgcmV0dXJuIGZvbGRlclJlc3BvbnNlO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRm9sZGVyKGlkLCBuZXdUaXRsZSwgcG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0VXNlckNvbnRlbnRVcmwodXNlciwgY29uZmlnU3RhdGUucG9ydGFsKX0vJHtpZH0vdXBkYXRlRm9sZGVyYDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0KHVybCwgeyBuZXdUaXRsZSB9LCB7fSwgXCJwb3N0XCIpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBnZXRGb2xkZXJGcm9tSWQgYXMgYSwgZ2V0SG9tZUZvbGRlckZvclVzZXIgYXMgYiwgY3JlYXRlRm9sZGVyIGFzIGMsIGdldFNpZ25lZEluVXNlcnNHcm91cHMgYXMgZCwgZ2V0U2lnbmVkSW5Vc2Vyc0Zhdm9yaXRlc0dyb3VwIGFzIGUsIGZldGNoVXNlciBhcyBmLCBnZXRGb2xkZXJzIGFzIGcsIHVwZGF0ZUZvbGRlciBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVzZXItM2VhNjljM2EuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9