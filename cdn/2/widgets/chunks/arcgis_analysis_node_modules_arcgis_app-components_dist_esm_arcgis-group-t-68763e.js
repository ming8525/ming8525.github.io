"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-group-t-68763e"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-thumbnail.entry.js":
/*!*************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-thumbnail.entry.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_group_thumbnail: () => (/* binding */ ArcgisGroupThumbnail)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */









/**
 * The following utilities come from calcite components
 * If there is a good way to import ts utils from CC, this should be deleted.
 */
const shortHandHex = /^#[0-9A-F]{3}$/i;
const longhandHex = /^#[0-9A-F]{6}$/i;
function isValidHex(hex) {
    return isShorthandHex(hex) || isLonghandHex(hex);
}
function isShorthandHex(hex) {
    return hex && hex.length === 4 && shortHandHex.test(hex);
}
function isLonghandHex(hex) {
    return hex && hex.length === 7 && longhandHex.test(hex);
}
function hexToRGB(hex) {
    if (!isValidHex(hex)) {
        return null;
    }
    hex = hex.replace("#", "");
    if (hex.length === 3) {
        const [first, second, third] = hex.split("");
        const r = parseInt(`${first}${first}`, 16);
        const g = parseInt(`${second}${second}`, 16);
        const b = parseInt(`${third}${third}`, 16);
        return { r, g, b };
    }
    const r = parseInt(hex.slice(0, 2), 16);
    const g = parseInt(hex.slice(2, 4), 16);
    const b = parseInt(hex.slice(4, 6), 16);
    return { r, g, b };
}
/**
 * Convert a string to a valid hex by hashing its contents
 * and using the hash as a seed for three distinct color values
 *
 * @param str
 */
function stringToHex(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        hash = str.charCodeAt(i) + ((hash << 5) - hash);
    }
    let hex = "#";
    for (let j = 0; j < 3; j++) {
        const value = (hash >> (j * 8)) & 0xff;
        hex += ("00" + value.toString(16)).substr(-2);
    }
    return hex;
}
/**
 * Find the hue of a color given the separate RGB color channels
 *
 * @param rgb
 */
function rgbToHue(rgb) {
    let { r, g, b } = rgb;
    r /= 255;
    g /= 255;
    b /= 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const delta = max - min;
    if (max === min) {
        return 0;
    }
    let hue = (max + min) / 2;
    switch (max) {
        case r:
            hue = (g - b) / delta + (g < b ? 6 : 0);
            break;
        case g:
            hue = (b - r) / delta + 2;
            break;
        case b:
            hue = (r - g) / delta + 4;
            break;
    }
    return Math.round(hue * 60);
}
/**
 * For a hex color, find the hue
 *
 * @param hex {string} - form of "#------"
 */
function hexToHue(hex) {
    return rgbToHue(hexToRGB(hex));
}

const arcgisGroupThumbnailCss = ":host{display:inline-block}:host([scale=s]){height:1.5rem;width:1.5rem;font-size:0.625rem}:host([scale=m]){height:2rem;width:2rem;font-size:0.75rem}:host([scale=l]){font-size:1rem;height:2.75rem;width:2.75rem}:host([scale=xl]){font-size:1.25rem;height:4rem;width:4rem}.icon{display:flex;color:var(--calcite-color-text-3)}.background{position:relative;display:flex;height:100%;width:100%;align-items:center;justify-content:center}.initials{position:absolute;font-weight:700;text-transform:uppercase;color:var(--calcite-color-text-2)}.thumbnail{height:100%;width:100%}.tooltip-text{margin:0px;padding:0px;font-size:0.75rem;color:var(--calcite-color-text-2)}calcite-tooltip{pointer-events:none}";

const ArcgisGroupThumbnail = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.openTooltip = () => {
            if (this.tooltipElement) {
                this.tooltipElement.open = true;
            }
        };
        this.closeTooltip = () => {
            if (this.tooltipElement) {
                this.tooltipElement.open = false;
            }
        };
        this.group = undefined;
        this.portal = undefined;
        this.tooltip = undefined;
        this.scale = "m";
        this.error = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { group, error, openTooltip, closeTooltip } = this;
        if ((group === null || group === void 0 ? void 0 : group.thumbnail) && !error) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { alt: "", class: "thumbnail", onError: () => (this.error = true), ref: (el) => (this.thumbnailElement = el), src: this.getThumbnailURI(), onMouseLeave: closeTooltip, onMouseEnter: openTooltip, onFocusout: closeTooltip, onFocusin: openTooltip }), this.renderTooltip()));
        }
        const initials = this.generateInitials();
        const backgroundColor = this.generateFillColor();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "background", ref: (el) => (this.thumbnailElement = el), style: { backgroundColor }, onMouseLeave: closeTooltip, onMouseEnter: openTooltip, onFocusout: closeTooltip, onFocusin: openTooltip }, initials ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { "aria-hidden": "true", class: "initials" }, initials)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "icon", icon: "users", scale: this.scale === "xl" ? "l" : this.scale }))), this.renderTooltip()));
    }
    renderTooltip() {
        if (!this.tooltip) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { ref: (el) => {
                el.referenceElement = this.thumbnailElement;
                this.tooltipElement = el;
            }, closeOnClick: true, label: this.group.title, placement: "bottom-start", offsetDistance: 6, offsetSkidding: 0, class: "tooltip" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "tooltip-text" }, this.group.title)));
    }
    getThumbnailURI() {
        const { group } = this;
        if (!(group === null || group === void 0 ? void 0 : group.thumbnail)) {
            return null;
        }
        // if user begins with a protocol, assume it's already fully qualified
        if (group.thumbnail.startsWith("http")) {
            return group.thumbnail;
        }
        const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.e)(this.portal);
        const tokenParam = token ? `?token=${token}` : "";
        return `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.portal)}community/groups/${group.id}/info/${group.thumbnail}${tokenParam}`;
    }
    generateFillColor() {
        const { group: { title, id }, el } = this;
        const theme = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_2__.g)(el);
        const idHex = `#${id === null || id === void 0 ? void 0 : id.substr(id.length - 6)}`;
        const hex = id && isValidHex(idHex) ? idHex : stringToHex(title);
        // if there is not unique information, or an invalid hex is produced, return a default
        if ((!id && !title) || !isValidHex(hex)) {
            return `var(--calcite-color-foreground-2)`;
        }
        const hue = hexToHue(hex);
        const l = theme === "dark" ? 20 : 90;
        return `hsl(${hue}, 60%, ${l}%)`;
    }
    generateInitials() {
        var _a, _b;
        const initial = (_b = (_a = this.group) === null || _a === void 0 ? void 0 : _a.title) === null || _b === void 0 ? void 0 : _b.trim().charAt(0);
        if (initial === null || initial === void 0 ? void 0 : initial.match(/^\w+$/)) {
            return initial;
        }
        return false;
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupThumbnail.style = arcgisGroupThumbnailCss;



//# sourceMappingURL=arcgis-group-thumbnail.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWdyb3VwLXQtNjg3NjNlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzJGO0FBQ2pCO0FBQ3BCO0FBQ25CO0FBQ0w7QUFDRDtBQUNGO0FBQ087O0FBRWxDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLEVBQUU7QUFDbkMsZ0NBQWdDLEVBQUU7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsTUFBTSxFQUFFLE1BQU07QUFDNUMsOEJBQThCLE9BQU8sRUFBRSxPQUFPO0FBQzlDLDhCQUE4QixNQUFNLEVBQUUsTUFBTTtBQUM1QyxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQztBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxVQUFVO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDLHFCQUFxQixpQkFBaUIsY0FBYyxhQUFhLG1CQUFtQixpQkFBaUIsWUFBWSxXQUFXLGtCQUFrQixpQkFBaUIsZUFBZSxlQUFlLGNBQWMsa0JBQWtCLGtCQUFrQixZQUFZLFdBQVcsTUFBTSxhQUFhLGtDQUFrQyxZQUFZLGtCQUFrQixhQUFhLFlBQVksV0FBVyxtQkFBbUIsdUJBQXVCLFVBQVUsa0JBQWtCLGdCQUFnQix5QkFBeUIsa0NBQWtDLFdBQVcsWUFBWSxXQUFXLGNBQWMsV0FBVyxZQUFZLGtCQUFrQixrQ0FBa0MsZ0JBQWdCLG9CQUFvQjs7QUFFcHRCO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwwQ0FBMEM7QUFDMUQ7QUFDQSxvQkFBb0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLFVBQVUsa1BBQWtQO0FBQy9SO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsV0FBVyx5RUFBeUUsaUJBQWlCLDJHQUEyRyxjQUFjLHFEQUFDLFdBQVcsMENBQTBDLGdCQUFnQixxREFBQyxtQkFBbUIsNkVBQTZFO0FBQ3BhO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IscURBQUMsc0JBQXNCO0FBQ3ZDO0FBQ0E7QUFDQSxhQUFhLGtJQUFrSSxFQUFFLHFEQUFDLFFBQVEsdUJBQXVCO0FBQ2pMO0FBQ0E7QUFDQSxnQkFBZ0IsUUFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixzREFBUTtBQUM5Qiw2Q0FBNkMsTUFBTTtBQUNuRCxrQkFBa0Isc0RBQWMsY0FBYyxtQkFBbUIsU0FBUyxRQUFRLGdCQUFnQixFQUFFLFdBQVc7QUFDL0c7QUFDQTtBQUNBLGdCQUFnQixTQUFTLFdBQVcsT0FBTztBQUMzQyxzQkFBc0IsbURBQVk7QUFDbEMsMEJBQTBCLGlFQUFpRTtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixJQUFJLFNBQVMsRUFBRTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEM7QUFDQTs7QUFFMEQ7O0FBRTFEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWdyb3VwLXRodW1ibmFpbC5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwsIGUgYXMgZ2V0VG9rZW4gfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFRoZW1lTmFtZSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcblxuLyoqXG4gKiBUaGUgZm9sbG93aW5nIHV0aWxpdGllcyBjb21lIGZyb20gY2FsY2l0ZSBjb21wb25lbnRzXG4gKiBJZiB0aGVyZSBpcyBhIGdvb2Qgd2F5IHRvIGltcG9ydCB0cyB1dGlscyBmcm9tIENDLCB0aGlzIHNob3VsZCBiZSBkZWxldGVkLlxuICovXG5jb25zdCBzaG9ydEhhbmRIZXggPSAvXiNbMC05QS1GXXszfSQvaTtcbmNvbnN0IGxvbmdoYW5kSGV4ID0gL14jWzAtOUEtRl17Nn0kL2k7XG5mdW5jdGlvbiBpc1ZhbGlkSGV4KGhleCkge1xuICAgIHJldHVybiBpc1Nob3J0aGFuZEhleChoZXgpIHx8IGlzTG9uZ2hhbmRIZXgoaGV4KTtcbn1cbmZ1bmN0aW9uIGlzU2hvcnRoYW5kSGV4KGhleCkge1xuICAgIHJldHVybiBoZXggJiYgaGV4Lmxlbmd0aCA9PT0gNCAmJiBzaG9ydEhhbmRIZXgudGVzdChoZXgpO1xufVxuZnVuY3Rpb24gaXNMb25naGFuZEhleChoZXgpIHtcbiAgICByZXR1cm4gaGV4ICYmIGhleC5sZW5ndGggPT09IDcgJiYgbG9uZ2hhbmRIZXgudGVzdChoZXgpO1xufVxuZnVuY3Rpb24gaGV4VG9SR0IoaGV4KSB7XG4gICAgaWYgKCFpc1ZhbGlkSGV4KGhleCkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGhleCA9IGhleC5yZXBsYWNlKFwiI1wiLCBcIlwiKTtcbiAgICBpZiAoaGV4Lmxlbmd0aCA9PT0gMykge1xuICAgICAgICBjb25zdCBbZmlyc3QsIHNlY29uZCwgdGhpcmRdID0gaGV4LnNwbGl0KFwiXCIpO1xuICAgICAgICBjb25zdCByID0gcGFyc2VJbnQoYCR7Zmlyc3R9JHtmaXJzdH1gLCAxNik7XG4gICAgICAgIGNvbnN0IGcgPSBwYXJzZUludChgJHtzZWNvbmR9JHtzZWNvbmR9YCwgMTYpO1xuICAgICAgICBjb25zdCBiID0gcGFyc2VJbnQoYCR7dGhpcmR9JHt0aGlyZH1gLCAxNik7XG4gICAgICAgIHJldHVybiB7IHIsIGcsIGIgfTtcbiAgICB9XG4gICAgY29uc3QgciA9IHBhcnNlSW50KGhleC5zbGljZSgwLCAyKSwgMTYpO1xuICAgIGNvbnN0IGcgPSBwYXJzZUludChoZXguc2xpY2UoMiwgNCksIDE2KTtcbiAgICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDQsIDYpLCAxNik7XG4gICAgcmV0dXJuIHsgciwgZywgYiB9O1xufVxuLyoqXG4gKiBDb252ZXJ0IGEgc3RyaW5nIHRvIGEgdmFsaWQgaGV4IGJ5IGhhc2hpbmcgaXRzIGNvbnRlbnRzXG4gKiBhbmQgdXNpbmcgdGhlIGhhc2ggYXMgYSBzZWVkIGZvciB0aHJlZSBkaXN0aW5jdCBjb2xvciB2YWx1ZXNcbiAqXG4gKiBAcGFyYW0gc3RyXG4gKi9cbmZ1bmN0aW9uIHN0cmluZ1RvSGV4KHN0cikge1xuICAgIGxldCBoYXNoID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBoYXNoID0gc3RyLmNoYXJDb2RlQXQoaSkgKyAoKGhhc2ggPDwgNSkgLSBoYXNoKTtcbiAgICB9XG4gICAgbGV0IGhleCA9IFwiI1wiO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gKGhhc2ggPj4gKGogKiA4KSkgJiAweGZmO1xuICAgICAgICBoZXggKz0gKFwiMDBcIiArIHZhbHVlLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC0yKTtcbiAgICB9XG4gICAgcmV0dXJuIGhleDtcbn1cbi8qKlxuICogRmluZCB0aGUgaHVlIG9mIGEgY29sb3IgZ2l2ZW4gdGhlIHNlcGFyYXRlIFJHQiBjb2xvciBjaGFubmVsc1xuICpcbiAqIEBwYXJhbSByZ2JcbiAqL1xuZnVuY3Rpb24gcmdiVG9IdWUocmdiKSB7XG4gICAgbGV0IHsgciwgZywgYiB9ID0gcmdiO1xuICAgIHIgLz0gMjU1O1xuICAgIGcgLz0gMjU1O1xuICAgIGIgLz0gMjU1O1xuICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpO1xuICAgIGNvbnN0IG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIGNvbnN0IGRlbHRhID0gbWF4IC0gbWluO1xuICAgIGlmIChtYXggPT09IG1pbikge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgbGV0IGh1ZSA9IChtYXggKyBtaW4pIC8gMjtcbiAgICBzd2l0Y2ggKG1heCkge1xuICAgICAgICBjYXNlIHI6XG4gICAgICAgICAgICBodWUgPSAoZyAtIGIpIC8gZGVsdGEgKyAoZyA8IGIgPyA2IDogMCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBnOlxuICAgICAgICAgICAgaHVlID0gKGIgLSByKSAvIGRlbHRhICsgMjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIGI6XG4gICAgICAgICAgICBodWUgPSAociAtIGcpIC8gZGVsdGEgKyA0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLnJvdW5kKGh1ZSAqIDYwKTtcbn1cbi8qKlxuICogRm9yIGEgaGV4IGNvbG9yLCBmaW5kIHRoZSBodWVcbiAqXG4gKiBAcGFyYW0gaGV4IHtzdHJpbmd9IC0gZm9ybSBvZiBcIiMtLS0tLS1cIlxuICovXG5mdW5jdGlvbiBoZXhUb0h1ZShoZXgpIHtcbiAgICByZXR1cm4gcmdiVG9IdWUoaGV4VG9SR0IoaGV4KSk7XG59XG5cbmNvbnN0IGFyY2dpc0dyb3VwVGh1bWJuYWlsQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmlubGluZS1ibG9ja306aG9zdChbc2NhbGU9c10pe2hlaWdodDoxLjVyZW07d2lkdGg6MS41cmVtO2ZvbnQtc2l6ZTowLjYyNXJlbX06aG9zdChbc2NhbGU9bV0pe2hlaWdodDoycmVtO3dpZHRoOjJyZW07Zm9udC1zaXplOjAuNzVyZW19Omhvc3QoW3NjYWxlPWxdKXtmb250LXNpemU6MXJlbTtoZWlnaHQ6Mi43NXJlbTt3aWR0aDoyLjc1cmVtfTpob3N0KFtzY2FsZT14bF0pe2ZvbnQtc2l6ZToxLjI1cmVtO2hlaWdodDo0cmVtO3dpZHRoOjRyZW19Lmljb257ZGlzcGxheTpmbGV4O2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKX0uYmFja2dyb3VuZHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwMCU7d2lkdGg6MTAwJTthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn0uaW5pdGlhbHN7cG9zaXRpb246YWJzb2x1dGU7Zm9udC13ZWlnaHQ6NzAwO3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMil9LnRodW1ibmFpbHtoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlfS50b29sdGlwLXRleHR7bWFyZ2luOjBweDtwYWRkaW5nOjBweDtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMil9Y2FsY2l0ZS10b29sdGlwe3BvaW50ZXItZXZlbnRzOm5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwVGh1bWJuYWlsID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5vcGVuVG9vbHRpcCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXBFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwRWxlbWVudC5vcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jbG9zZVRvb2x0aXAgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcEVsZW1lbnQub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdyb3VwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50b29sdGlwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNjYWxlID0gXCJtXCI7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBncm91cCwgZXJyb3IsIG9wZW5Ub29sdGlwLCBjbG9zZVRvb2x0aXAgfSA9IHRoaXM7XG4gICAgICAgIGlmICgoZ3JvdXAgPT09IG51bGwgfHwgZ3JvdXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyb3VwLnRodW1ibmFpbCkgJiYgIWVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImltZ1wiLCB7IGFsdDogXCJcIiwgY2xhc3M6IFwidGh1bWJuYWlsXCIsIG9uRXJyb3I6ICgpID0+ICh0aGlzLmVycm9yID0gdHJ1ZSksIHJlZjogKGVsKSA9PiAodGhpcy50aHVtYm5haWxFbGVtZW50ID0gZWwpLCBzcmM6IHRoaXMuZ2V0VGh1bWJuYWlsVVJJKCksIG9uTW91c2VMZWF2ZTogY2xvc2VUb29sdGlwLCBvbk1vdXNlRW50ZXI6IG9wZW5Ub29sdGlwLCBvbkZvY3Vzb3V0OiBjbG9zZVRvb2x0aXAsIG9uRm9jdXNpbjogb3BlblRvb2x0aXAgfSksIHRoaXMucmVuZGVyVG9vbHRpcCgpKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5pdGlhbHMgPSB0aGlzLmdlbmVyYXRlSW5pdGlhbHMoKTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gdGhpcy5nZW5lcmF0ZUZpbGxDb2xvcigpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcInNwYW5cIiwgeyBjbGFzczogXCJiYWNrZ3JvdW5kXCIsIHJlZjogKGVsKSA9PiAodGhpcy50aHVtYm5haWxFbGVtZW50ID0gZWwpLCBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3IgfSwgb25Nb3VzZUxlYXZlOiBjbG9zZVRvb2x0aXAsIG9uTW91c2VFbnRlcjogb3BlblRvb2x0aXAsIG9uRm9jdXNvdXQ6IGNsb3NlVG9vbHRpcCwgb25Gb2N1c2luOiBvcGVuVG9vbHRpcCB9LCBpbml0aWFscyA/IChoKFwic3BhblwiLCB7IFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIsIGNsYXNzOiBcImluaXRpYWxzXCIgfSwgaW5pdGlhbHMpKSA6IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsgY2xhc3M6IFwiaWNvblwiLCBpY29uOiBcInVzZXJzXCIsIHNjYWxlOiB0aGlzLnNjYWxlID09PSBcInhsXCIgPyBcImxcIiA6IHRoaXMuc2NhbGUgfSkpKSwgdGhpcy5yZW5kZXJUb29sdGlwKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyVG9vbHRpcCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRvb2x0aXApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgZWwucmVmZXJlbmNlRWxlbWVudCA9IHRoaXMudGh1bWJuYWlsRWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50ID0gZWw7XG4gICAgICAgICAgICB9LCBjbG9zZU9uQ2xpY2s6IHRydWUsIGxhYmVsOiB0aGlzLmdyb3VwLnRpdGxlLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIG9mZnNldERpc3RhbmNlOiA2LCBvZmZzZXRTa2lkZGluZzogMCwgY2xhc3M6IFwidG9vbHRpcFwiIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwidG9vbHRpcC10ZXh0XCIgfSwgdGhpcy5ncm91cC50aXRsZSkpKTtcbiAgICB9XG4gICAgZ2V0VGh1bWJuYWlsVVJJKCkge1xuICAgICAgICBjb25zdCB7IGdyb3VwIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIShncm91cCA9PT0gbnVsbCB8fCBncm91cCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXAudGh1bWJuYWlsKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgdXNlciBiZWdpbnMgd2l0aCBhIHByb3RvY29sLCBhc3N1bWUgaXQncyBhbHJlYWR5IGZ1bGx5IHF1YWxpZmllZFxuICAgICAgICBpZiAoZ3JvdXAudGh1bWJuYWlsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZ3JvdXAudGh1bWJuYWlsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRva2VuID0gZ2V0VG9rZW4odGhpcy5wb3J0YWwpO1xuICAgICAgICBjb25zdCB0b2tlblBhcmFtID0gdG9rZW4gPyBgP3Rva2VuPSR7dG9rZW59YCA6IFwiXCI7XG4gICAgICAgIHJldHVybiBgJHtnZXRSZXN0QmFzZVVybCh0aGlzLnBvcnRhbCl9Y29tbXVuaXR5L2dyb3Vwcy8ke2dyb3VwLmlkfS9pbmZvLyR7Z3JvdXAudGh1bWJuYWlsfSR7dG9rZW5QYXJhbX1gO1xuICAgIH1cbiAgICBnZW5lcmF0ZUZpbGxDb2xvcigpIHtcbiAgICAgICAgY29uc3QgeyBncm91cDogeyB0aXRsZSwgaWQgfSwgZWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHRoZW1lID0gZ2V0VGhlbWVOYW1lKGVsKTtcbiAgICAgICAgY29uc3QgaWRIZXggPSBgIyR7aWQgPT09IG51bGwgfHwgaWQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkLnN1YnN0cihpZC5sZW5ndGggLSA2KX1gO1xuICAgICAgICBjb25zdCBoZXggPSBpZCAmJiBpc1ZhbGlkSGV4KGlkSGV4KSA/IGlkSGV4IDogc3RyaW5nVG9IZXgodGl0bGUpO1xuICAgICAgICAvLyBpZiB0aGVyZSBpcyBub3QgdW5pcXVlIGluZm9ybWF0aW9uLCBvciBhbiBpbnZhbGlkIGhleCBpcyBwcm9kdWNlZCwgcmV0dXJuIGEgZGVmYXVsdFxuICAgICAgICBpZiAoKCFpZCAmJiAhdGl0bGUpIHx8ICFpc1ZhbGlkSGV4KGhleCkpIHtcbiAgICAgICAgICAgIHJldHVybiBgdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTIpYDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBodWUgPSBoZXhUb0h1ZShoZXgpO1xuICAgICAgICBjb25zdCBsID0gdGhlbWUgPT09IFwiZGFya1wiID8gMjAgOiA5MDtcbiAgICAgICAgcmV0dXJuIGBoc2woJHtodWV9LCA2MCUsICR7bH0lKWA7XG4gICAgfVxuICAgIGdlbmVyYXRlSW5pdGlhbHMoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGluaXRpYWwgPSAoX2IgPSAoX2EgPSB0aGlzLmdyb3VwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50cmltKCkuY2hhckF0KDApO1xuICAgICAgICBpZiAoaW5pdGlhbCA9PT0gbnVsbCB8fCBpbml0aWFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbml0aWFsLm1hdGNoKC9eXFx3KyQvKSkge1xuICAgICAgICAgICAgcmV0dXJuIGluaXRpYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzR3JvdXBUaHVtYm5haWwuc3R5bGUgPSBhcmNnaXNHcm91cFRodW1ibmFpbENzcztcblxuZXhwb3J0IHsgQXJjZ2lzR3JvdXBUaHVtYm5haWwgYXMgYXJjZ2lzX2dyb3VwX3RodW1ibmFpbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtZ3JvdXAtdGh1bWJuYWlsLmVudHJ5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==