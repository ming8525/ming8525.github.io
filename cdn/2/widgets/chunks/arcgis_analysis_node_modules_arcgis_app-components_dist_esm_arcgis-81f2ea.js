"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81f2ea"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-raster-class-breaks_8.entry.js":
/*!****************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-raster-class-breaks_8.entry.js ***!
  \****************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_raster_class_breaks: () => (/* binding */ ArcgisSmartMappingPanelsRasterClassBreaks),
/* harmony export */   arcgis_smart_mapping_panels_raster_colormap: () => (/* binding */ ArcgisSmartMappingPanelsRasterColormap),
/* harmony export */   arcgis_smart_mapping_panels_raster_flow: () => (/* binding */ ArcgisSmartMappingPanelsRasterFlow),
/* harmony export */   arcgis_smart_mapping_panels_raster_rgb: () => (/* binding */ ArcgisSmartMappingPanelsRasterRgb),
/* harmony export */   arcgis_smart_mapping_panels_raster_shaded_relief: () => (/* binding */ ArcgisSmartMappingPanelsRasterShadedRelief),
/* harmony export */   arcgis_smart_mapping_panels_raster_stretch: () => (/* binding */ ArcgisSmartMappingPanelsRasterStretch),
/* harmony export */   arcgis_smart_mapping_panels_raster_unique_value: () => (/* binding */ ArcgisSmartMappingPanelsRasterUniqueValue),
/* harmony export */   arcgis_smart_mapping_panels_raster_vector_field: () => (/* binding */ ArcgisSmartMappingPanelsRasterVectorField)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./raster-renderer-a62f152c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-renderer-a62f152c.js");
/* harmony import */ var _raster_symbolStyler_9b32ef48_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./raster-symbolStyler-9b32ef48.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-symbolStyler-9b32ef48.js");
/* harmony import */ var _symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./symbolStyler-04635b2b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolStyler-04635b2b.js");
/* harmony import */ var _raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./raster-class-breaks-50c446bd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-class-breaks-50c446bd.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./raster-flow-761a3470.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-flow-761a3470.js");
/* harmony import */ var _popover_721f7ba2_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./popover-721f7ba2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



















const arcgisSmartMappingPanelsRasterClassBreaksCss = ":host{width:100%}.flow-item{height:100%}.class-breaks-block{overflow-x:hidden;overflow-wrap:anywhere}.hidden{display:none}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.label,.symbol-container{padding-top:5px;padding-bottom:5px}.selected{outline:1px solid var(--calcite-color-brand)}";

const ArcgisSmartMappingPanelsRasterClassBreaks = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterClassBreaksClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterClassBreaksClose", 7);
        this.arcgisSmartMappingPanelsRasterClassBreaksBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterClassBreaksBackClick", 7);
        this.arcgisSmartMappingPanelsRasterClassBreaksError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterClassBreaksError", 7);
        this.symbolNodes = [];
        this.labelNodes = [];
        this.inputNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterClassBreaksClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterClassBreaksClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        // save original renderer
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
        this.defaultColorRamp = renderer.classBreakInfos.map((classBreakInfo) => classBreakInfo.symbol.color);
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.classBreaks.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterClassBreaksBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "class-breaks-block", heading: strings.panels.classBreaks.classBreaks, open: true }, this.renderFieldSelector(), this.renderMethod(), this.renderClasses(), this.renderDefinedInterval(), this.renderColorScheme(), this.renderColorSlider(), this.renderValues()));
    }
    renderFieldSelector() {
        var _a;
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const rendererField = renderer.field || strings.panels.classBreaks.value;
        const fields = (0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.g)();
        const fieldList = fields.map((field) => {
            return {
                label: field.alias,
                layerField: field,
                // raster layer displays are not dependent on field type, so we use "string" as a placeholder
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.STRING
            };
        });
        const selectedField = fields.find((field) => {
            return field.name === rendererField;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { label: strings.panels.classBreaks.field, fieldList: fieldList, selectedField: {
                field: (_a = selectedField === null || selectedField === void 0 ? void 0 : selectedField.name) !== null && _a !== void 0 ? _a : strings.panels.classBreaks.value,
                // raster layer displays are not dependent on field type, so we use "string" as a placeholder
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.STRING
            }, mode: "simple", popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingAttributeInputChange: (event) => {
                if (event.detail) {
                    const newField = event.detail.field;
                    this.handleFieldChange(newField);
                }
            } }));
    }
    renderMethod() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-method-button", { key: renderer.authoringInfo.classificationMethod, showDefinedInterval: true, onArcgisSmartMappingMethodButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingMethodButtonChange: (event) => {
                var _a, _b;
                const renderer = layer.renderer;
                if (event.detail === "manual") {
                    const authInfo = renderer.authoringInfo;
                    authInfo.classificationMethod = "manual";
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    setTimeout(() => this.methodButtonNode.setFocus(), 300);
                }
                else {
                    let numClasses = ((_a = renderer === null || renderer === void 0 ? void 0 : renderer.authoringInfo) === null || _a === void 0 ? void 0 : _a.numClasses) || ((_b = renderer.classBreakInfos) === null || _b === void 0 ? void 0 : _b.length);
                    let definedInterval;
                    if (event.detail === "defined-interval") {
                        const classBreaks = renderer.classBreakInfos;
                        definedInterval =
                            (classBreaks[classBreaks.length - 1].maxValue - classBreaks[0].minValue) / 5;
                        numClasses = Math.ceil((renderer.classBreakInfos[numClasses - 1].maxValue -
                            renderer.classBreakInfos[0].minValue) /
                            definedInterval);
                    }
                    (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.b)({
                        classificationMethod: event.detail,
                        numClasses,
                        definedInterval
                    }), this.flowItemNode).then((result) => {
                        this.updateRenderer(result.renderer);
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                        setTimeout(() => this.methodButtonNode.setFocus(), 300);
                    }, (error) => {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.methodButtonNode);
                        this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(error);
                    });
                }
            }, ref: (node) => {
                if (node) {
                    this.methodButtonNode = node;
                }
            } }));
    }
    renderClasses() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const numClasses = renderer.classBreakInfos.length;
        const authInfo = renderer.authoringInfo;
        const classificationMethod = authInfo.classificationMethod;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.classBreaks.classifyClasses, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { tabindex: "0", value: `${numClasses}`, disabled: classificationMethod === "defined-interval", min: 1, max: 10, step: 1, scale: "s", onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const value = parseInt(this.classesNode.value);
                if (value === numClasses) {
                    return;
                }
                if (!value || value < this.classesNode.min || value > this.classesNode.max) {
                    this.classesChangeHandle = setTimeout(() => this.handleClassesChange(), 3000);
                }
                else {
                    clearTimeout(this.classesChangeHandle);
                    this.handleClassesChange();
                }
            }, 300), ref: (node) => {
                if (node) {
                    this.classesNode = node;
                }
            } })));
    }
    renderDefinedInterval() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const classificationMethod = authInfo.classificationMethod;
        if (classificationMethod !== "defined-interval") {
            return null;
        }
        const breakInterval = renderer.classBreakInfos[0].maxValue - renderer.classBreakInfos[0].minValue;
        // set min and max based on a maximum of 10 classes
        const min = Math.floor((renderer.classBreakInfos[renderer.classBreakInfos.length - 1].maxValue -
            renderer.classBreakInfos[0].minValue) /
            9.1);
        const max = renderer.classBreakInfos[renderer.classBreakInfos.length - 1].maxValue -
            renderer.classBreakInfos[0].minValue;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.classBreaks.definedInterval, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { tabIndex: 0, value: `${Math.round(breakInterval * 100) / 100}`, min: min, max: max, step: 0.1, scale: "s", onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newValue = parseFloat(node.value);
                if (!node.value || newValue < node.min || newValue > node.max) {
                    this.definedIntervalChangeHandle = setTimeout(() => this.handleDefinedIntervalChange(), 3000);
                }
                else {
                    clearTimeout(this.definedIntervalChangeHandle);
                    this.handleDefinedIntervalChange();
                }
            }, ref: (node) => (this.definedIntervalNode = node) })));
    }
    renderColorScheme() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colors = renderer.classBreakInfos.map((classBreakInfo) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(classBreakInfo.symbol));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { label: strings.panels.classBreaks.colorScheme, type: "raster-class-breaks", rampType: "discrete", colors: colors, onArcgisSmartMappingSymbolButtonSymbolChange: (event) => {
                const node = event.target;
                const renderer = layer.renderer;
                this.defaultColorRamp = renderer.classBreakInfos.map((classBreakInfo) => classBreakInfo.symbol.color);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
            }, ref: (node) => (this.symbolButtonNode = node) }));
    }
    renderColorSlider() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-class-breaks-color-slider", { onArcgisSmartMappingClassBreaksColorSliderChange: (event) => {
                const renderer = layer.renderer;
                const instructions = event.detail;
                if (instructions === null || instructions === void 0 ? void 0 : instructions.updateValues) {
                    renderer.authoringInfo.classificationMethod = "manual";
                }
                if (instructions === null || instructions === void 0 ? void 0 : instructions.invertColors) {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.defaultColorRamp = renderer.classBreakInfos.map((classBreakInfo) => classBreakInfo.symbol.color);
            }, ref: (node) => (this.sliderNode = node) }));
    }
    renderValues() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.labelNodes = [];
        this.inputNodes = [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, renderer.classBreakInfos
            .map((classBreakInfo, idx) => {
            return this.renderValue(classBreakInfo, idx);
        })
            .reverse()));
    }
    renderValue(classBreakInfo, idx) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-container", slot: "actions-start" }, this.renderSymbolNode(classBreakInfo, idx)), this.renderTextNode(classBreakInfo, idx)));
    }
    renderSymbolNode(classBreakInfo, idx) {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let symbol = renderer.classBreakInfos[idx].symbol.clone();
        const symbolNodeClasses = {
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol),
            symbol: true
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, tabindex: "0", "aria-label": strings.panels.classBreaks.accessibility.editColorFor.replace("${value}", classBreakInfo.label), "aria-haspopup": "true", ref: (node) => {
                if (node) {
                    this.symbolNodes.unshift(node);
                }
            }, onClick: () => {
                if (this.popoverNode) {
                    this.symbolNodes[this.selectedPopoverIdx].classList.remove("selected");
                    if (this.selectedPopoverIdx === idx) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                        this.popoverNode = null;
                        this.selectedPopoverIdx = null;
                    }
                    else {
                        this.selectedPopoverIdx = idx;
                        this.handleValueSymbolClick(idx);
                    }
                }
                else {
                    this.selectedPopoverIdx = idx;
                    this.handleValueSymbolClick(idx);
                }
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.handleValueSymbolClick(idx);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                if (node) {
                    this.afterCreateValueSymbol(node, idx);
                }
            } })));
    }
    renderTextNode(classBreakInfo, idx) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "label", slot: "content", tabindex: "0", ref: (node) => {
                if (node) {
                    this.labelNodes.unshift(node);
                }
            }, "aria-label": strings.panels.classBreaks.accessibility.editLabelFor.replace("${value}", classBreakInfo.label), onClick: (event) => {
                let inputNode = this.inputNodes[idx];
                inputNode.classList.remove("hidden");
                inputNode.setFocus();
                event.target.classList.add("hidden");
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    let inputNode = this.inputNodes[idx];
                    inputNode.classList.remove("hidden");
                    inputNode.setFocus();
                    event.target.classList.add("hidden");
                }
            } }, classBreakInfo.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { slot: "content", class: "hidden", scale: "s", tabindex: "0", ref: (node) => {
                if (node) {
                    this.inputNodes.unshift(node);
                }
            }, value: classBreakInfo.label, onCalciteInputChange: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onFocusout: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onKeyDown: (event) => {
                if (event.key === "Escape" || event.key === "Enter") {
                    this.inputNodes[idx].classList.add("hidden");
                    const input = event.currentTarget;
                    input.value = classBreakInfo.label || "";
                    input.disabled = true;
                    this.handleValueTextChange(idx, event);
                    this.labelNodes[idx].classList.remove("hidden");
                    input.disabled = false;
                    setTimeout(() => this.labelNodes[idx].focus(), 300);
                }
            } })));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handleFieldChange(newField) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.b)({ field: newField }), this.flowItemNode).then((result) => this.updateRenderer(result.renderer), (error) => {
            this.fieldNode.value = renderer.field;
            this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(error);
        });
    }
    handleDefinedIntervalChange() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const currentInterval = renderer.classBreakInfos[0].maxValue - renderer.classBreakInfos[0].minValue;
        let newInterval = parseFloat(this.definedIntervalNode.value);
        if (newInterval === currentInterval) {
            return;
        }
        if (isNaN(newInterval) || newInterval < this.definedIntervalNode.min) {
            newInterval = this.definedIntervalNode.min;
        }
        else if (newInterval > this.definedIntervalNode.max) {
            newInterval = this.definedIntervalNode.max;
        }
        newInterval = parseFloat(newInterval.toFixed(2));
        this.definedIntervalNode.value = `${newInterval}`;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.b)({ definedInterval: newInterval }), this.flowItemNode).then((result) => this.updateRenderer(result.renderer), (error) => {
            this.definedIntervalNode.value = `${currentInterval}`;
            this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(error);
        });
    }
    handleClassesChange() {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const currentNumClasses = renderer.classBreakInfos.length;
        const { authoringInfo } = renderer || {};
        authoringInfo.numClasses = this.classesNode.value
            ? Number.parseInt(this.classesNode.value, 10)
            : 0;
        if (authoringInfo.classificationMethod === "manual") {
            authoringInfo.classificationMethod = "equal-interval";
        }
        const value = Math.min(Math.max(parseInt(this.classesNode.value), 1), 10) || 5;
        if (`${value}` !== this.classesNode.value) {
            this.classesNode.value = `${value}`;
        }
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.b)({ numClasses: value }), this.flowItemNode).then((result) => this.updateRenderer(result.renderer), (error) => {
            this.classesNode.value = `${currentNumClasses}`;
            this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(error);
        });
    }
    afterCreateValueSymbol(node, idx) {
        var _a;
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let symbol = renderer.classBreakInfos[idx].symbol.clone();
        // reset default outline
        if (idx === -1) {
            if (symbol.outline) {
                symbol.outline.width = 0;
            }
        }
        // add outlines only to symbols that are almost white
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol)) {
            symbol.outline = new modules.SimpleLineSymbol({
                color: "#bdc3c7",
                width: 0.75
            });
        }
        while ((_a = node === null || node === void 0 ? void 0 : node.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            node.removeChild(node.childNodes[0]);
        }
        const { symbolUtils } = modules;
        if (symbol) {
            symbolUtils
                .renderPreviewHTML(symbol, {
                size: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ar)(symbol),
                // @ts-ignore
                ignoreWhiteSymbols: true,
                symbolConfig: {
                    isSquareFill: true
                }
            })
                .then((element) => node === null || node === void 0 ? void 0 : node.appendChild(element));
        }
    }
    handleValueSymbolClick(idx) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.c)({
            referenceElement: this.flowItemNode,
            heading: strings.panels.classBreaks.colorScheme
        });
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(popoverNode);
            setTimeout(() => {
                this.symbolNodes[idx].focus();
                this.popoverNode = null;
                this.symbolNodes[idx].classList.remove("selected");
            }, 300);
        });
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(popoverNode);
            setTimeout(() => {
                this.popoverNode = null;
                this.symbolNodes[idx].classList.remove("selected");
            }, 300);
        });
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.classedSymbolSelectedIdx = idx;
        (0,_raster_symbolStyler_9b32ef48_js__WEBPACK_IMPORTED_MODULE_6__.b)({
            popoverNode: popoverNode,
            onChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
            }
        });
        this.popoverNode = popoverNode;
        this.symbolNodes[idx].classList.add("selected");
    }
    handleValueTextChange(idx, event) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const node = event.currentTarget;
        renderer.classBreakInfos[idx].label = node.value;
        /* workaround to allow "empty" labels (otherwise, the classify label
        will stay empty but the legend label will assume its default value) */
        if (node.value === "") {
            const classBreak = renderer.classBreakInfos[idx];
            classBreak.label = `${classBreak.minValue.toLocaleString()} - ${classBreak.maxValue.toLocaleString()}`;
            this.inputNodes[idx].value = this.labelNodes[idx].textContent;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleInversionStatus(resultRenderer) {
        const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const oldFirstColor = JSON.stringify(this.defaultColorRamp[0]);
        const newFirstColor = JSON.stringify(resultRenderer.classBreakInfos[0].symbol.color);
        if (oldFirstColor !== newFirstColor) {
            let colors = resultRenderer.classBreakInfos.map((classBreakInfo) => {
                return ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(classBreakInfo.symbol) ||
                    new modules.esriColor({ r: 64, g: 64, b: 64, a: 1 }));
            });
            colors = colors.reverse();
            resultRenderer.classBreakInfos.map((classBreakInfo, idx) => {
                if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(classBreakInfo.symbol)) {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(classBreakInfo.symbol, colors[idx]);
                }
            });
        }
        else {
            this.defaultColorRamp = resultRenderer.classBreakInfos.map((classBreakInfo) => classBreakInfo.symbol.color);
        }
    }
    updateRenderer(resultRenderer) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        this.handleInversionStatus(resultRenderer);
        (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(resultRenderer, layer);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterClassBreaks.style = arcgisSmartMappingPanelsRasterClassBreaksCss;

const arcgisSmartMappingPanelsRasterColormapCss = ":host{width:100%}.flow-item{height:100%}.colormap-block{overflow-x:hidden}.table{width:100%;overflow-wrap:anywhere}.color{display:flex;justify-content:center}.colorblock{border:1px solid #000}.hidden{display:none}.label{padding-top:5px;padding-bottom:5px}.label:focus{outline:2px solid var(--calcite-color-brand)}";

const ArcgisSmartMappingPanelsRasterColormap = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterColormapClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterColormapClose", 7);
        this.arcgisSmartMappingPanelsRasterColormapBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterColormapBackClick", 7);
        this.inputNodes = [];
        this.labelNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterColormapClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterColormapClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        // save original renderer
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
        renderer.colormapInfos.forEach((colormapInfo, idx) => {
            if (!colormapInfo.label) {
                // workaround for allowing empty labels. We keep values with no labels in our table for parity with Pro.
                renderer.colormapInfos[idx].label = " ";
            }
        });
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.colormap.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterColormapBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "colormap-block", heading: strings.panels.colormap.colormap, open: true }, this.renderColormapTable()));
    }
    renderColormapTable() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.labelNodes = [];
        this.inputNodes = [];
        const colormaps = renderer.colormapInfos.map((colormapInfo, idx) => this.renderColormapRow(colormapInfo, idx));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table", { class: "table", caption: strings.panels.colormap.colormapTable }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-row", { slot: "table-header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-header", { heading: strings.panels.colormap.color, alignment: "center" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-header", { heading: strings.panels.colormap.value, alignment: "center" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-header", { heading: strings.panels.colormap.label, alignment: "center" })), colormaps));
    }
    renderColormapRow(colormapInfo, idx) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-row", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-cell", { alignment: "center" }, this.renderColorNode(colormapInfo)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-cell", { alignment: "center" }, colormapInfo.value), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-table-cell", { alignment: "center" }, this.renderLabelNode(colormapInfo, idx))));
    }
    renderColorNode(colormapInfo) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color", ref: (node) => {
                if (node) {
                    this.afterCreateColor(node, colormapInfo);
                }
            } }));
    }
    renderLabelNode(colormapInfo, idx) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "label", tabindex: "0", ref: (node) => {
                if (node) {
                    this.labelNodes[idx] = node;
                }
            }, "aria-label": strings.panels.classBreaks.accessibility.editLabelFor.replace("${value}", colormapInfo.label), onClick: (event) => {
                let inputNode = this.inputNodes[idx];
                inputNode.classList.remove("hidden");
                inputNode.setFocus();
                event.target.classList.add("hidden");
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    let inputNode = this.inputNodes[idx];
                    inputNode.classList.remove("hidden");
                    inputNode.setFocus();
                    event.target.classList.add("hidden");
                }
            } }, colormapInfo.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: "hidden", tabindex: "0", ref: (node) => {
                if (node) {
                    this.inputNodes[idx] = node;
                }
            }, value: colormapInfo.label, onCalciteInputChange: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onFocusout: (event) => {
                this.inputNodes[idx].classList.add("hidden");
                this.labelNodes[idx].classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onKeyDown: (event) => {
                if (event.key === "Escape" || event.key === "Enter") {
                    this.inputNodes[idx].classList.add("hidden");
                    const input = event.currentTarget;
                    input.value = colormapInfo.label || "";
                    input.disabled = true;
                    this.handleValueTextChange(idx, event);
                    this.labelNodes[idx].classList.remove("hidden");
                    input.disabled = false;
                    setTimeout(() => this.labelNodes[idx].focus(), 300);
                }
            } })));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    afterCreateColor(node, colormapInfo) {
        var _a;
        const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        while ((_a = node === null || node === void 0 ? void 0 : node.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            node.removeChild(node.childNodes[0]);
        }
        const { symbolUtils } = modules;
        const colorblock = symbolUtils.renderColorRampPreviewHTML([colormapInfo.color.clone()], {
            gradient: false,
            width: 20,
            height: 20
        });
        colorblock.classList.add("colorblock");
        node.appendChild(colorblock);
    }
    handleValueTextChange(idx, event) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const node = event.currentTarget;
        node.value === ""
            ? (this.inputNodes[idx].value = this.labelNodes[idx].textContent)
            : (renderer.colormapInfos[idx].label = node.value);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterColormap.style = arcgisSmartMappingPanelsRasterColormapCss;

const arcgisSmartMappingPanelsRasterFlowCss = ":host{width:100%}.flow-item{height:100%}.flow-block{overflow-x:hidden}.block-content-padding{padding-bottom:10px}.block-content-padding-large{padding-bottom:20px}.symbol-button-padding{padding-bottom:12px}.mode-hover{cursor:pointer}.toggles{padding-top:10px}.toggle-text{width:100%}.hint-text{font-size:smaller;margin-top:-8px}.hint-text.disabled{opacity:0.5}";

const ArcgisSmartMappingPanelsRasterFlow = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterFlowClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterFlowClose", 7);
        this.arcgisSmartMappingPanelsRasterFlowBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterFlowBackClick", 7);
        this.arcgisSmartMappingPanelsRasterFlowError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterFlowError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterFlowClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj, originalEffect } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            layer.effect = originalEffect;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterFlowClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        // save original renderer and effect
        this.originalRendererObj = layer.renderer;
        this.originalEffect = layer.effect;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.flow.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterFlowBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "flow-block", heading: strings.panels.flow.flowStyle, open: true }, this.renderMode(), this.renderSpeed(), this.renderDensity(), this.renderLength(), this.renderWidth(), this.renderColor(), this.renderColorSlider(), this.renderDirection(), this.renderRoundCaps(), this.renderShowInLegend(), this.renderEffects()));
    }
    renderMode() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const isWave = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.flowTheme)
            ? (authInfo === null || authInfo === void 0 ? void 0 : authInfo.flowTheme) === "wave-front"
            : renderer.trailLength < 1;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-content-padding-large" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { value: "flowline", appearance: isWave ? "outline-fill" : "solid", kind: isWave ? "neutral" : "brand", class: isWave ? "mode-hover" : "", scale: "s", onClick: () => this.handleModeChange("flowline") }, strings.panels.flow.flowline), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, "\u00A0"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { value: "wavefront", appearance: isWave ? "solid" : "outline-fill", kind: isWave ? "brand" : "neutral", class: isWave ? "" : "mode-hover", scale: "s", onClick: () => this.handleModeChange("wavefront") }, strings.panels.flow.wavefront)));
    }
    renderSpeed() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const isWave = authInfo.flowTheme === "wave-front";
        const { flowSpeed } = renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.flow.speed, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "flow", type: "speed", min: 0, max: isWave ? 20 : 40, values: [flowSpeed], precision: 1, minLabel: strings.panels.flow.slow, maxLabel: strings.panels.flow.fast })));
    }
    renderDensity() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { density } = renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.flow.density, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "flow", type: "density", min: 0.1, max: 1, values: [density], precision: 1, minLabel: strings.panels.flow.low, maxLabel: strings.panels.flow.high })));
    }
    renderLength() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const isWave = authInfo.flowTheme === "wave-front";
        const { trailLength } = renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.flow.length, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "flow", type: "trail-length", min: isWave ? 0.1 : 1, max: isWave ? 50 : 200, values: [trailLength / 0.75], precision: isWave ? 1 : 0, minLabel: strings.panels.flow.short, maxLabel: strings.panels.flow.long })));
    }
    renderWidth() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const isWave = authInfo.flowTheme === "wave-front";
        const { trailWidth } = renderer;
        const pxWidth = Math.round((trailWidth / 0.75) * 10) / 10;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-content-padding-large" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.flow.width), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-slider-input", { min: isWave ? Math.min(5, Math.floor(pxWidth)) : 0.1, max: isWave ? Math.max(12, Math.ceil(pxWidth)) : Math.max(5, Math.ceil(pxWidth)), values: [pxWidth], precision: 1, suffixText: strings.panels.flow.px, onArcgisSmartMappingSliderInputChange: (event) => {
                const renderer = layer.renderer;
                const newTrailWidth = event.detail;
                const { trailWidth } = renderer;
                const currentTrailWidth = Math.round((trailWidth / 0.75) * 10) / 10;
                if (newTrailWidth === currentTrailWidth) {
                    return;
                }
                renderer.trailWidth = newTrailWidth * 0.75;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            } })));
    }
    renderColor() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { class: "block-content-padding", name: "colorType", layout: "vertical", onCalciteRadioButtonGroupChange: (event) => this.handleColorTypeChange(event.target.selectedItem.value) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: !colorVisVar, value: "singleColor", ref: (node) => (this.singleColorNode = node) }), strings.panels.flow.singleColor), !colorVisVar && this.renderSingleColor()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: !!colorVisVar, value: "colorRamp", ref: (node) => (this.colorRampNode = node) }), strings.panels.flow.colorRamp), colorVisVar && this.renderColorRamp())));
    }
    renderSingleColor() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { color } = renderer;
        const symbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aj)();
        symbol.color = color;
        symbol.outline.color = color;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-button-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, hideLabel: true, type: "raster-flow", rampType: "continuous", onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } })));
    }
    renderColorRamp() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return;
        }
        const colors = colorVisVar.stops.map((stop) => {
            const color = stop.color.clone();
            color.a = 1;
            return color;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-button-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { colors: colors, hideLabel: true, type: "raster-flow", rampType: "continuous", ref: (node) => {
                if (node) {
                    this.symbolButtonNode = node;
                }
            }, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.flowColorSliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.flowColorSliderNode);
            } })));
    }
    renderColorSlider() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-flow-color-slider", { ref: (node) => {
                if (node) {
                    this.flowColorSliderNode = node;
                }
            }, onArcgisSmartMappingFlowColorSliderChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.symbolButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
            }, onArcgisSmartMappingFlowColorSliderError: (event) => this.arcgisSmartMappingPanelsRasterFlowError.emit(event.detail) }));
    }
    renderDirection() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { flowRepresentation } = renderer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "block-content-padding" }, strings.panels.flow.flowDirection, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control", { layout: "horizontal", appearance: "solid", onCalciteSegmentedControlChange: (event) => this.handleDirectionChange(event.target.selectedItem.value) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: "to", checked: flowRepresentation !== "flow-from" }, strings.panels.flow.to), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: "from", checked: flowRepresentation === "flow-from" }, strings.panels.flow.from))));
    }
    renderRoundCaps() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { trailWidth, authoringInfo } = renderer;
        const isFlowline = authoringInfo.flowTheme === "flow-line";
        const isChecked = renderer.trailCap === "round";
        // trailWidth is in pts; bypass rounding issues
        const isEnabled = Math.round(trailWidth * 1000) / 1000 > 3;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "toggles block-content-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "toggle-text", layout: "inline-space-between" }, strings.panels.flow.roundEndCaps, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { ref: (node) => {
                if (node) {
                    this.roundCapToggleNode = node;
                }
            }, disabled: !isEnabled, scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleRoundCapsToggle() })), isFlowline ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `hint-text ${!isEnabled ? "disabled" : ""}` }, strings.panels.flow.forWideLines)) : null));
    }
    renderShowInLegend() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return null;
        }
        const legendOptions = colorVisVar.legendOptions;
        const isChecked = !legendOptions || legendOptions.showLegend !== false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "toggle-text toggles block-content-padding" }, strings.panels.flow.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    renderEffects() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "toggles block-content-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "toggle-text", layout: "inline-space-between" }, strings.panels.flow.layerEffects, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: !!layer.effect, onCalciteSwitchChange: () => this.handleEffectToggle() })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "hint-text" }, strings.panels.flow.adjustEffects)));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handleModeChange(type) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authInfo = renderer.authoringInfo;
        const isWave = authInfo.flowTheme === "wave-front";
        const newFlowTheme = authInfo.flowTheme === "wave-front" ? "flow-line" : "wave-front";
        if ((!isWave && type === "wavefront") || (isWave && type === "flowline")) {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_11__.a)({ flowTheme: newFlowTheme }), this.flowItemNode).then((result) => {
                layer.renderer = result.renderer.clone();
                this.roundCapToggleNode.checked = false;
                // TODO: determine if updateRenderer() is needed to update other components appropriately
                // updateRenderer();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, (error) => this.arcgisSmartMappingPanelsRasterFlowError.emit(error));
        }
    }
    handleColorTypeChange(type) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const config = {
            includeColorVariable: type === "colorRamp"
        };
        if (type !== "colorRamp") {
            this.lastFlowTheme = (0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_11__.f)();
        }
        else if (this.lastFlowTheme) {
            config.flowScheme = this.lastFlowTheme;
        }
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_11__.a)(config), this.flowItemNode).then((result) => {
            layer.renderer = result.renderer.clone();
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        }, (error) => {
            // handles checking the previously checked color option; order matters when setting these!
            if (this.singleColorNode.checked) {
                this.singleColorNode.checked = false;
                this.colorRampNode.checked = true;
            }
            else {
                this.colorRampNode.checked = false;
                this.singleColorNode.checked = true;
            }
            this.arcgisSmartMappingPanelsRasterFlowError.emit(error);
        });
    }
    handleDirectionChange(type) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        renderer.flowRepresentation = type === "from" ? "flow-from" : "flow-to";
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleRoundCapsToggle() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        renderer.trailCap = renderer.trailCap === "round" ? "butt" : "round";
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleIncludeInLegendToggle() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const legendOptions = colorVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                colorVisVar.legendOptions = undefined;
            }
        }
        else {
            colorVisVar.legendOptions = legendOptions || {};
            colorVisVar.legendOptions.showLegend = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleEffectToggle() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        if (layer.effect) {
            layer.effect = undefined;
        }
        else {
            const authInfo = renderer.authoringInfo;
            (0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_11__.c)({ flowTheme: authInfo.flowTheme }).then((result) => {
                layer.effect = result.layerEffect;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            }, (error) => this.arcgisSmartMappingPanelsRasterFlowError.emit(error));
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterFlow.style = arcgisSmartMappingPanelsRasterFlowCss;

var colorBands;
(function (colorBands) {
    colorBands[colorBands["ALL"] = -1] = "ALL";
    colorBands[colorBands["RED"] = 0] = "RED";
    colorBands[colorBands["GREEN"] = 1] = "GREEN";
    colorBands[colorBands["BLUE"] = 2] = "BLUE";
})(colorBands || (colorBands = {}));
const defaultStatistics = {
    min: 0,
    max: 65535,
    avg: 0,
    stddev: 0
};

const arcgisSmartMappingPanelsRasterRgbCss = ":host{width:100%}.flow-item{height:100%}.rgb-block{overflow-x:hidden}.percent-clip-section{display:flex;justify-content:space-between}.percent-clip-section-input{width:48%;display:flex;flex-flow:column;justify-content:space-between}.individual-gamma-label,.range-adjustment-label{font-weight:var(--calcite-font-weight-medium)}.individual-gamma-selection{display:flex;justify-content:space-between}.individual-gamma-selection-value{display:flex;flex-flow:column;justify-content:space-between;width:30%}";

const ArcgisSmartMappingPanelsRasterRgb = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterRgbClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterRgbClose", 7);
        this.arcgisSmartMappingPanelsRasterRgbBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterRgbBackClick", 7);
        this.arcgisSmartMappingPanelsRasterRgbError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterRgbError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterRgbClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj, originalEffect, originalBandCombination, originalStatistics } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            layer.effect = originalEffect;
            layer.bandIds = originalBandCombination;
            layer.rasterInfo.statistics = originalStatistics;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterRgbClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        var _a, _b;
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const { statistics } = layer.rasterInfo;
        if (!layer.bandIds) {
            layer.bandIds = await (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.as)(layer);
        }
        // save original renderer, effect, and band combination
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
        this.originalEffect = layer.effect;
        this.originalBandCombination = layer.bandIds;
        // save original statistics
        this.originalStatistics = (_a = modules.esriLang.clone(statistics)) !== null && _a !== void 0 ? _a : [];
        this.currentStatistics = (_b = modules.esriLang.clone(statistics)) !== null && _b !== void 0 ? _b : [];
        // handles when no renderer statistics are initialized on load
        const renderer = layer.renderer;
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(renderer.statistics[0])) {
            renderer.statistics = new Array(3).fill(defaultStatistics);
            this.currentStatistics = modules.esriLang.clone(renderer.statistics);
        }
        if (Array.isArray(renderer.statistics) &&
            !renderer.statistics.length &&
            !renderer.dynamicRangeAdjustment) {
            renderer.statistics = layer.bandIds.map((bandId) => this.originalStatistics[bandId]);
        }
        this.rendererStatisticsSelection = layer.bandIds[0];
        this.changeIndividualGamma = false;
        this.percentLabelFlip = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.at)(this.hostElement);
    }
    componentDidLoad() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        // if statistics are displayed on load, we always display statistics for the red band
        if (!renderer.dynamicRangeAdjustment) {
            this.updateStatisticsDisplay(renderer.statistics[0]);
        }
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.rgb.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterRgbBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "rgb-block", heading: strings.panels.rgb.rgb, open: true }, this.renderRgbBandSelectors(), this.renderStretchTypeSelector(), this.renderStandardDeviationSection(), this.renderPercentClipSection(), this.renderGammaBlock(), this.renderIndividualGammaToggle(), this.renderRangeAdjustmentToggle(), this.renderStatistics()));
    }
    renderRgbBandSelectors() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const { rasterInfo } = layer;
        const { bandInfos } = rasterInfo;
        const bandNames = bandInfos.map((bandInfo) => bandInfo.name);
        const { red, green, blue } = strings.panels.rgb;
        const colorBands = [red, green, blue];
        const bandSelectors = colorBands.map((color, colorIdx) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, color, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: color, clearDisabled: true, selectionMode: "single-persist", onCalciteComboboxChange: (event) => {
                    const node = event.target;
                    const renderer = layer.renderer;
                    // update layer.bandIds with new band's index
                    layer.bandIds[colorIdx] = bandNames.indexOf(node.value);
                    const newBandNameId = layer.bandIds[colorIdx];
                    // for the current renderer statistics, replace the appropriate band with the new band's values
                    renderer.statistics[colorIdx] = this.currentStatistics[newBandNameId];
                    // update the statistics table only if the checked segmented control item matches the band color whose statistics were actually switched
                    if (this.statisticsControlNode && color === this.statisticsControlNode.value) {
                        this.rendererStatisticsSelection = newBandNameId;
                        this.updateStatisticsDisplay(renderer.statistics[colorIdx]);
                    }
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                } }, bandNames.map((bandName, idx) => this.renderBandOptions(bandName, idx, colorIdx)))));
        });
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, bandSelectors);
    }
    renderBandOptions(bandName, idx, colorIdx) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const bandNameIdx = layer.bandIds[colorIdx];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { textLabel: bandName, value: bandName, selected: bandNameIdx === idx }));
    }
    renderStretchTypeSelector() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-stretch-type-button", { onArcgisSmartMappingStretchTypeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingStretchTypeButtonChange: (event) => {
                const node = event.target;
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.au)({ stretchType: event.detail }), this.flowItemNode).then((result) => {
                    if (event.detail === "none") {
                        result.renderer.dynamicRangeAdjustment = false;
                    }
                    this.rendererStatisticsSelection = layer.bandIds[0];
                    (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(result.renderer, layer);
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
                }, (error) => this.arcgisSmartMappingPanelsRasterRgbError.emit(error));
            } }));
    }
    renderStandardDeviationSection() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STRETCH_TYPE } = renderer || {};
        const isStretchTypeStandardDeviation = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.STANDARD_DEVIATION;
        if (!isStretchTypeStandardDeviation) {
            return null;
        }
        let { numberOfStandardDeviations } = renderer || {};
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(numberOfStandardDeviations) || numberOfStandardDeviations === 0) {
            numberOfStandardDeviations = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STD_DEV;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.stddev, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb.stddev, scale: "s", tabindex: "0", min: 1, max: 100, step: 0.1, value: `${numberOfStandardDeviations}`, onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newStddev = parseFloat(node.value);
                if (node.value && newStddev >= node.min && newStddev <= node.max) {
                    this.handlePercentOrStddevChange(node, "stddev");
                }
                else {
                    setTimeout(() => this.handlePercentOrStddevChange(node, "stddev"), 3000);
                }
            } })));
    }
    renderPercentClipSection() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STRETCH_TYPE } = renderer || {};
        const isStretchTypePercentClip = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.PERCENT_CLIP;
        if (!isStretchTypePercentClip) {
            return null;
        }
        let { minPercent, maxPercent } = renderer || {};
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(minPercent) || minPercent <= 0 || minPercent >= 100) {
            minPercent = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.MIN_PERCENT;
        }
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(maxPercent) || maxPercent <= 0 || maxPercent >= 100) {
            maxPercent = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.MAX_PERCENT;
        }
        minPercent = parseFloat(minPercent.toFixed(1));
        maxPercent = parseFloat(maxPercent.toFixed(1));
        renderer.minPercent = minPercent;
        renderer.maxPercent = maxPercent;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "percent-clip-section" }, this.renderPercentClipSectionInput("min", minPercent), this.renderPercentClipSectionInput("max", maxPercent)));
    }
    renderPercentClipSectionInput(selection, value) {
        const { percentLabelFlip } = this;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "percent-clip-section-input" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb[selection], (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb[selection], scale: "s", min: 0.1, max: 99.9, step: 0.1, prefixText: percentLabelFlip ? "%" : undefined, suffixText: !percentLabelFlip ? "%" : undefined, value: `${value}`, onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newPercent = parseFloat(node.value);
                if (node.value && newPercent >= node.min && newPercent <= node.max) {
                    this.handlePercentOrStddevChange(node, selection);
                }
                else {
                    setTimeout(() => this.handlePercentOrStddevChange(node, selection), 3000);
                }
            } }))));
    }
    renderIndividualGammaToggle() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "individual-gamma-label" }, strings.panels.rgb.individualGamma, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: this.changeIndividualGamma, onCalciteSwitchChange: () => {
                this.changeIndividualGamma = !this.changeIndividualGamma;
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } })));
    }
    renderGammaBlock() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { gamma = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.GAMMA } = renderer || {};
        const rendererGamma = Array.isArray(renderer.gamma) ? renderer.gamma[0] : renderer.gamma;
        const redGamma = gamma[colorBands.RED] || rendererGamma;
        const greenGamma = gamma[colorBands.GREEN] || rendererGamma;
        const blueGamma = gamma[colorBands.BLUE] || rendererGamma;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.gamma, this.changeIndividualGamma ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "individual-gamma-selection" }, this.renderIndividualGamma(redGamma, "red"), this.renderIndividualGamma(greenGamma, "green"), this.renderIndividualGamma(blueGamma, "blue"))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-gamma-slider", { gamma: Array.isArray(gamma) ? gamma[0] : gamma, rendererType: "raster-rgb" }))));
    }
    renderIndividualGamma(individualGammaValue, selection) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "individual-gamma-selection-value" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb[selection], (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb[selection], numberButtonType: "none", tabindex: "0", scale: "s", value: `${individualGammaValue}`, min: 0.1, max: 10, step: 0.1, onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newGamma = parseFloat(node.value);
                if (node.value && newGamma >= node.min && newGamma <= node.max) {
                    this.handleIndividualGammaChange(node, selection);
                }
                else {
                    setTimeout(() => this.handleIndividualGammaChange(node, selection), 3000);
                }
            } }))));
    }
    renderRangeAdjustmentToggle() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { dynamicRangeAdjustment } = renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STRETCH_TYPE } = renderer || {};
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.NONE;
        if (isStretchTypeNone) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "range-adjustment-label" }, strings.panels.rgb.dynamicRangeAdjustment, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: dynamicRangeAdjustment, onCalciteSwitchChange: (event) => {
                const node = event.target;
                const isToggled = node.checked;
                this.handleDRAToggle(isToggled);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } })));
    }
    renderStatistics() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STRETCH_TYPE } = renderer || {};
        const isStretchTypePercentClip = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.PERCENT_CLIP;
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.NONE;
        const { dynamicRangeAdjustment } = renderer;
        const showStatsTable = !dynamicRangeAdjustment && !(isStretchTypeNone || isStretchTypePercentClip);
        if (!showStatsTable) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.statistics, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control", { scale: "s", width: "full", onCalciteSegmentedControlChange: (event) => {
                const renderer = layer.renderer;
                const node = event.target;
                const value = node.value;
                const currentBandId = value === strings.panels.rgb.red
                    ? layer.bandIds[0]
                    : value === strings.panels.rgb.green
                        ? layer.bandIds[1]
                        : layer.bandIds[2];
                const statisticsToDisplay = value === strings.panels.rgb.red
                    ? renderer.statistics[0]
                    : value === strings.panels.rgb.green
                        ? renderer.statistics[1]
                        : renderer.statistics[2];
                this.rendererStatisticsSelection = currentBandId;
                this.updateStatisticsDisplay(statisticsToDisplay);
            }, ref: (node) => (this.statisticsControlNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: strings.panels.rgb.red, checked: this.rendererStatisticsSelection === layer.bandIds[0] }, strings.panels.rgb.red), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: strings.panels.rgb.green, checked: this.rendererStatisticsSelection === layer.bandIds[1] &&
                this.rendererStatisticsSelection !== layer.bandIds[0] }, strings.panels.rgb.green), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: strings.panels.rgb.blue, checked: this.rendererStatisticsSelection === layer.bandIds[2] &&
                this.rendererStatisticsSelection !== layer.bandIds[0] &&
                this.rendererStatisticsSelection !== layer.bandIds[1] }, strings.panels.rgb.blue))), this.renderStatisticsDisplay()));
    }
    renderStatisticsDisplay() {
        var _a, _b;
        const { originalStatistics } = this;
        const { layer: smLayer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aw.STRETCH_TYPE } = renderer || {};
        const isStretchTypePercentClip = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.PERCENT_CLIP;
        const isStretchTypeStandardDeviation = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.av.STANDARD_DEVIATION;
        const hasStatistics = layer.rasterInfo.statistics !== null;
        let { statistics } = renderer || {};
        if (!statistics || (Array.isArray(statistics) && statistics.length < 1)) {
            statistics = modules.esriLang.clone(originalStatistics);
        }
        const initialBandSelection = (_a = this.rendererStatisticsSelection) !== null && _a !== void 0 ? _a : 0;
        const disableMeanAndStdDev = (!hasStatistics || isStretchTypePercentClip) && !isStretchTypeStandardDeviation;
        const { min = 0, max = 255, avg: mean = 0, stddev = 0 } = ((_b = this.currentStatistics) === null || _b === void 0 ? void 0 : _b[initialBandSelection !== null && initialBandSelection !== void 0 ? initialBandSelection : 0]) || {};
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.min, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb.min, scale: "s", step: 0.1, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) ? this.round(min) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                var _a;
                const value = parseFloat(this.minNode.value);
                const currentBandSelection = (_a = this.rendererStatisticsSelection) !== null && _a !== void 0 ? _a : 0;
                if (!isNaN(value) && value <= this.currentStatistics[currentBandSelection]["max"]) {
                    this.minNode.value = `${value}`;
                    this.handleStatisticsChange(value, currentBandSelection, "min");
                }
                else {
                    setTimeout(() => {
                        const currentMin = this.currentStatistics[currentBandSelection]["min"];
                        this.minNode.value = `${this.round(currentMin)}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.minNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.max, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb.max, scale: "s", step: 0.1, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) ? this.round(max) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                var _a;
                const value = parseFloat(this.maxNode.value);
                const currentBandSelection = (_a = this.rendererStatisticsSelection) !== null && _a !== void 0 ? _a : 0;
                if (!isNaN(value) && value >= this.currentStatistics[currentBandSelection]["min"]) {
                    this.maxNode.value = `${value}`;
                    this.handleStatisticsChange(value, currentBandSelection, "max");
                }
                else {
                    setTimeout(() => {
                        const currentMax = this.currentStatistics[currentBandSelection]["max"];
                        this.maxNode.value = `${this.round(currentMax)}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.maxNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.mean, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb.mean, scale: "s", step: 0.1, disabled: disableMeanAndStdDev, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(mean) ? this.round(mean) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                var _a;
                const value = parseFloat(this.avgNode.value);
                const currentBandSelection = (_a = this.rendererStatisticsSelection) !== null && _a !== void 0 ? _a : 0;
                if (!isNaN(value)) {
                    this.avgNode.value = `${value}`;
                    this.handleStatisticsChange(value, currentBandSelection, "avg");
                }
                else {
                    setTimeout(() => {
                        const currentMean = this.currentStatistics[currentBandSelection]["avg"];
                        this.avgNode.value = `${this.round(currentMean)}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.avgNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.rgb.stddev, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.rgb.stddev, scale: "s", step: 0.1, disabled: disableMeanAndStdDev, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(stddev) ? this.round(stddev) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                var _a;
                const value = parseFloat(this.stddevNode.value);
                const currentBandSelection = (_a = this.rendererStatisticsSelection) !== null && _a !== void 0 ? _a : 0;
                if (!isNaN(value)) {
                    this.stddevNode.value = `${value}`;
                    this.handleStatisticsChange(value, currentBandSelection, "stddev");
                }
                else {
                    setTimeout(() => {
                        const currentStddev = this.currentStatistics[currentBandSelection]["stddev"];
                        this.stddevNode.value = `${this.round(currentStddev)}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.stddevNode = node) }))));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handlePercentOrStddevChange(node, changing) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let value = parseFloat(node.value);
        if (isNaN(value) || value < node.min) {
            value = node.min;
        }
        else if (value > node.max) {
            value = node.max;
        }
        value = parseFloat(value.toFixed(1));
        node.value = `${value}`;
        changing === "min"
            ? (renderer.minPercent = value)
            : changing === "max"
                ? (renderer.maxPercent = value)
                : (renderer.numberOfStandardDeviations = value);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleIndividualGammaChange(node, changing) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let value = parseFloat(node.value);
        if (isNaN(value) || value < node.min) {
            value = node.min;
        }
        else if (value > node.max) {
            value = node.max;
        }
        value = parseFloat(value.toFixed(1));
        node.value = `${value}`;
        changing === "red"
            ? (renderer.gamma[colorBands.RED] = value)
            : changing === "green"
                ? (renderer.gamma[colorBands.GREEN] = value)
                : (renderer.gamma[colorBands.BLUE] = value);
        renderer.useGamma = true;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleDRAToggle(applyDRA) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        renderer.dynamicRangeAdjustment = applyDRA;
        if (applyDRA) {
            renderer.statistics = [];
        }
        else {
            const updatedRendererStatistics = layer.bandIds.map((bandId) => this.currentStatistics[bandId]);
            renderer.statistics = updatedRendererStatistics;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleStatisticsChange(value, statisticIDToUpdate, type) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.currentStatistics[statisticIDToUpdate][type] = value;
        const rendererBandsToUpdate = [];
        layer.bandIds.forEach((bandId, idx) => {
            if (bandId === statisticIDToUpdate) {
                rendererBandsToUpdate.push(idx);
            }
        });
        rendererBandsToUpdate.forEach((rendererBandToUdpate) => (renderer.statistics[rendererBandToUdpate] = this.currentStatistics[statisticIDToUpdate]));
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    updateStatisticsDisplay(selection) {
        const { min, max, avg, stddev } = selection;
        this.minNode.value = `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) ? this.round(min) : ""}`;
        this.maxNode.value = `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) ? this.round(max) : ""}`;
        this.avgNode.value = `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(avg) ? this.round(avg) : ""}`;
        this.stddevNode.value = `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(stddev) ? this.round(stddev) : ""}`;
    }
    round(value) {
        return Math.round(value * 1000) / 1000;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterRgb.style = arcgisSmartMappingPanelsRasterRgbCss;

const hillshadeTypeOptions = {
    TRADITIONAL: "traditional",
    MULTIDIRECTIONAL: "multi-directional"
};
const defaultHillshadeType = "multi-directional";
const defaultScalingType = "none";
const shadedReliefDefaults = {
    azimuth: 315,
    altitude: 45,
    pixelSizePower: 0.664,
    pixelSizeFactor: 0.024,
    zFactor: 1
};

const arcgisSmartMappingPanelsRasterShadedReliefCss = ":host{width:100%}.flow-item{height:100%}.shaded-relief-block{overflow-x:hidden}";

const ArcgisSmartMappingPanelsRasterShadedRelief = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterShadedReliefClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterShadedReliefClose", 7);
        this.arcgisSmartMappingPanelsRasterShadedReliefBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterShadedReliefBackClick", 7);
        this.arcgisSmartMappingPanelsRasterShadedReliefError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterShadedReliefError", 7);
        this.handles = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterShadedReliefClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterShadedReliefClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        // save original renderer
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.shadedRelief.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterShadedReliefBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "shaded-relief-block", heading: strings.panels.shadedRelief.shadedRelief, open: true }, this.renderHillshadeTypeSelector(), this.renderColorScheme(), this.renderAzimuthSlider(), this.renderAltitudeSlider(), this.renderScalingSelector(), this.renderZFactorAndPixelInputs()));
    }
    renderHillshadeTypeSelector() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-hillshade-type-button", { onArcgisSmartMappingHillshadeTypeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingHillshadeTypeButtonChange: (event) => {
                const node = event.target;
                const hillshadeType = event.detail;
                const renderer = layer.renderer;
                renderer.hillshadeType = hillshadeType;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
            } }));
    }
    renderColorScheme() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { colorRamp } = renderer || {};
        // normalize colorRamp (currently in Multipart form)
        const colorScheme = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.n)(colorRamp);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { label: strings.panels.shadedRelief.colorScheme, type: "raster-shaded-relief", rampType: "continuous", colors: colorScheme, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }));
    }
    renderAzimuthSlider() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { hillshadeType = defaultHillshadeType, azimuth = shadedReliefDefaults.azimuth } = renderer || {};
        const showAzimuth = hillshadeType === hillshadeTypeOptions.TRADITIONAL;
        if (!showAzimuth) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.shadedRelief.azimuth, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "shaded-relief", showThumbLabel: true, editThumbLabel: true, type: "azimuth", min: 0, max: 360, values: [azimuth], precision: 1, minLabel: "0", maxLabel: "360" })));
    }
    renderAltitudeSlider() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { hillshadeType = defaultHillshadeType, altitude = shadedReliefDefaults.altitude } = renderer || {};
        const showAltitude = hillshadeType === hillshadeTypeOptions.TRADITIONAL;
        if (!showAltitude) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.shadedRelief.altitude, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "shaded-relief", showThumbLabel: true, editThumbLabel: true, type: "altitude", min: 0, max: 90, values: [altitude], precision: 1, minLabel: "0", maxLabel: "90" })));
    }
    renderScalingSelector() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { scalingType = defaultScalingType } = renderer || {};
        const scalingOptions = strings.panels.shadedRelief.scalingOptions;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.shadedRelief.scaling, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control", { scale: "s", width: "full", onCalciteSegmentedControlChange: (event) => {
                const node = event.target;
                this.handleScalingOptionChange(node.value);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: "none", checked: scalingType === "none" }, scalingOptions.none), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-segmented-control-item", { value: "adjusted", checked: scalingType === "adjusted" }, scalingOptions.adjusted))));
    }
    renderZFactorAndPixelInputs() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { scalingType = defaultScalingType } = renderer || {};
        const showPixelSizePowerInput = scalingType === "adjusted";
        const zFactorPixelEntries = ["zFactor"];
        if (showPixelSizePowerInput) {
            zFactorPixelEntries.push("pixelSizePower");
            zFactorPixelEntries.push("pixelSizeFactor");
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, zFactorPixelEntries.map((zFactorPixelEntry, idx) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.shadedRelief[zFactorPixelEntry], (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.shadedRelief[zFactorPixelEntry], tabindex: "0", min: 0, step: 0.1, scale: "s", value: `${(_a = renderer[zFactorPixelEntry]) !== null && _a !== void 0 ? _a : shadedReliefDefaults[zFactorPixelEntry]}`, onCalciteInputNumberInput: (event) => {
                    const node = event.target;
                    if (node.value === "" || parseFloat(node.value) < 0) {
                        this.handles[idx] = setTimeout(() => this.handleZFactorOrPixelChange(node, zFactorPixelEntry), 3000);
                    }
                    else {
                        clearTimeout(this.handles[idx]);
                        setTimeout(() => this.handleZFactorOrPixelChange(node, zFactorPixelEntry), 300);
                    }
                } })));
        })));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handleScalingOptionChange(newScalingType) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        renderer.scalingType = newScalingType;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleZFactorOrPixelChange(node, property) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let value = parseFloat(node.value);
        if (isNaN(value) || value < node.min) {
            value = node.min;
        }
        node.value = `${value}`;
        renderer[property] = value;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterShadedRelief.style = arcgisSmartMappingPanelsRasterShadedReliefCss;

const arcgisSmartMappingPanelsRasterStretchCss = ":host{width:100%}.flow-item{height:100%}.stretch-block{overflow-x:hidden}.percent-clip-section{display:flex;justify-content:space-between}.percent-clip-section-input{width:48%;display:flex;flex-flow:column;justify-content:space-between}.range-adjustment-label{font-weight:var(--calcite-font-weight-medium)}";

const ArcgisSmartMappingPanelsRasterStretch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterStretchClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterStretchClose", 7);
        this.arcgisSmartMappingPanelsRasterStretchBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterStretchBackClick", 7);
        this.arcgisSmartMappingPanelsRasterStretchError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterStretchError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterStretchClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj, originalEffect, originalBandCombination, originalStatistics } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            layer.effect = originalEffect;
            layer.bandIds = originalBandCombination;
            layer.rasterInfo.statistics = originalStatistics;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterStretchClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        var _a, _b, _c, _d;
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { statistics } = layer.rasterInfo;
        // save original renderer
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
        this.originalEffect = layer.effect;
        this.originalBandCombination = layer.bandIds;
        // save original statistics
        this.originalStatistics = (_a = modules.esriLang.clone(statistics)) !== null && _a !== void 0 ? _a : [];
        this.currentStatistics = (_b = modules.esriLang.clone(statistics)) !== null && _b !== void 0 ? _b : [];
        if (((_c = layer.bandIds) === null || _c === void 0 ? void 0 : _c.length) !== 1) {
            layer.bandIds = [0];
        }
        // populate renderer statistics if necessary
        if (this.isAnEmptyArray(renderer.statistics)) {
            renderer.statistics = [this.originalStatistics[0]];
        }
        // handles when no renderer statistics are initialized on load
        const bandIndex = (_d = layer.bandIds[0]) !== null && _d !== void 0 ? _d : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(statistics) && !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(renderer.statistics[0])) {
            renderer.statistics[0] = {
                min: 0,
                max: 255,
                avg: 0,
                stddev: 0
            };
            this.currentStatistics[bandIndex] = renderer.statistics[0];
        }
        const rendererStats = renderer.statistics;
        if (this.isAnEmptyArray(rendererStats) && !renderer.dynamicRangeAdjustment) {
            this.currentStatistics[bandIndex] = {
                min: 0,
                max: 255,
                avg: 0,
                stddev: 0
            };
            renderer.statistics = [this.currentStatistics[bandIndex]];
        }
        else {
            this.currentStatistics[bandIndex] = renderer.statistics[0];
        }
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.stretch.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterStretchBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "stretch-block", heading: strings.panels.stretch.stretch, open: true }, this.renderStretchTypeSelector(), this.renderStandardDeviationSection(), this.renderPercentClipSection(), this.renderBandSelector(), this.renderGammaSlider(), this.renderColorScheme(), this.renderRangeAdjustmentToggle(), this.renderStatisticsTable()));
    }
    renderStretchTypeSelector() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-stretch-type-button", { onArcgisSmartMappingStretchTypeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingStretchTypeButtonChange: (event) => {
                const node = event.target;
                const stretchType = event.detail;
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ay)({ stretchType }), this.flowItemNode).then((result) => {
                    var _a;
                    const bandIndex = (_a = layer.bandIds[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
                    if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.currentStatistics)) {
                        result.renderer.statistics = [this.currentStatistics[bandIndex]];
                    }
                    if (stretchType === "none") {
                        result.renderer.dynamicRangeAdjustment = false;
                        result.renderer.colorRamp = null;
                    }
                    (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(result.renderer, layer);
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
                }, (error) => {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(node);
                    this.arcgisSmartMappingPanelsRasterStretchError.emit(error);
                });
            } }));
    }
    renderStandardDeviationSection() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypeStandardDeviation = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.STANDARD_DEVIATION;
        if (!isStretchTypeStandardDeviation) {
            return null;
        }
        let { numberOfStandardDeviations } = renderer || {};
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(numberOfStandardDeviations) || numberOfStandardDeviations === 0) {
            numberOfStandardDeviations = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STD_DEV;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.stddev, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch.stddev, scale: "s", tabindex: "0", min: 1, max: 100, step: 0.1, value: `${numberOfStandardDeviations}`, onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newStddev = parseFloat(node.value);
                if (node.value && newStddev >= node.min && newStddev <= node.max) {
                    this.handlePercentOrStddevChange(node, "stddev");
                }
                else {
                    setTimeout(() => this.handlePercentOrStddevChange(node, "stddev"), 3000);
                }
            } })));
    }
    renderPercentClipSection() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypePercentClip = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.PERCENT_CLIP;
        if (!isStretchTypePercentClip) {
            return null;
        }
        let { minPercent, maxPercent } = renderer || {};
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(minPercent) || minPercent <= 0 || minPercent >= 100) {
            minPercent = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.MIN_PERCENT;
        }
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(maxPercent) || maxPercent <= 0 || maxPercent >= 100) {
            maxPercent = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.MAX_PERCENT;
        }
        minPercent = parseFloat(minPercent.toFixed(1));
        maxPercent = parseFloat(maxPercent.toFixed(1));
        renderer.minPercent = minPercent;
        renderer.maxPercent = maxPercent;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "percent-clip-section" }, this.renderPercentClipSectionInput("min", minPercent), this.renderPercentClipSectionInput("max", maxPercent)));
    }
    renderPercentClipSectionInput(selection, value) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "percent-clip-section-input" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch[selection], (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch[selection], scale: "s", min: 0.1, max: 99.9, step: 0.1, suffixText: "%", value: `${value}`, onCalciteInputNumberInput: (event) => {
                const node = event.target;
                const newPercent = parseFloat(node.value);
                if (node.value && newPercent >= node.min && newPercent <= node.max) {
                    this.handlePercentOrStddevChange(node, selection);
                }
                else {
                    setTimeout(() => this.handlePercentOrStddevChange(node, selection), 3000);
                }
            } }))));
    }
    renderBandSelector() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const { bandCount } = layer.rasterInfo;
        const showBandSelector = bandCount > 1;
        if (!showBandSelector) {
            return null;
        }
        const { bandInfos } = layer.rasterInfo;
        const bandNames = bandInfos.map((bandInfo) => bandInfo.name);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.band, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: strings.panels.stretch.band, clearDisabled: true, selectionMode: "single-persist", onCalciteComboboxChange: (event) => {
                var _a;
                const node = event.target;
                const renderer = layer.renderer;
                layer.bandIds = [bandNames.indexOf(node.value)];
                const bandIndex = (_a = layer.bandIds[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
                renderer.statistics = [this.currentStatistics[bandIndex]];
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }, bandNames.map((bandName, idx) => this.renderBandOptions(bandName, idx)))));
    }
    renderBandOptions(bandName, idx) {
        var _a;
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const bandIndex = (_a = layer.bandIds[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { textLabel: bandName, value: bandName, selected: bandIndex === idx }));
    }
    renderGammaSlider() {
        var _a;
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let { gamma = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.GAMMA } = renderer || {};
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(gamma)) {
            gamma = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.GAMMA;
        }
        if (Array.isArray(gamma)) {
            gamma = (_a = gamma[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.GAMMA;
        }
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.NONE;
        if (isStretchTypeNone) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.gamma, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-gamma-slider", { gamma: gamma, rendererType: "raster-stretch" })));
    }
    renderColorScheme() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.NONE;
        if (isStretchTypeNone) {
            return null;
        }
        const { colorRamp } = renderer || {};
        // normalize colorRamp (currently in Multipart form)
        const colorScheme = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.n)(colorRamp);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { label: strings.panels.stretch.colorScheme, type: "raster-stretch", rampType: "continuous", colors: colorScheme, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }));
    }
    renderRangeAdjustmentToggle() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { dynamicRangeAdjustment } = renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.NONE;
        if (isStretchTypeNone) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between", class: "range-adjustment-label" }, strings.panels.stretch.dynamicRangeAdjustment, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: dynamicRangeAdjustment, onCalciteSwitchChange: (event) => {
                const node = event.target;
                const isToggled = node.checked;
                this.handleDRAToggle(isToggled);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } })));
    }
    renderStatisticsTable() {
        var _a;
        const { originalStatistics } = this;
        const { layer: smLayer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.STRETCH_TYPE } = renderer || {};
        const isStretchTypePercentClip = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.PERCENT_CLIP;
        const isStretchTypeNone = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.NONE;
        const isStretchTypeStandardDeviation = stretchType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.az.STANDARD_DEVIATION;
        const { dynamicRangeAdjustment } = renderer;
        const showStatsTable = !dynamicRangeAdjustment && !(isStretchTypeNone || isStretchTypePercentClip);
        if (!showStatsTable) {
            return null;
        }
        const hasStatistics = layer.rasterInfo.statistics !== null;
        let { statistics } = renderer || {};
        if (!statistics || (Array.isArray(statistics) && statistics.length < 1)) {
            statistics = modules.esriLang.clone(originalStatistics);
        }
        const bandIndex = (_a = layer.bandIds[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
        const disableMeanAndStdDev = (!hasStatistics || isStretchTypePercentClip) && !isStretchTypeStandardDeviation;
        const { min = 0, max = 255, avg: mean = 0, stddev = 0 } = (statistics === null || statistics === void 0 ? void 0 : statistics[0]) || {};
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.statistics), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.min, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch.min, scale: "s", step: 0.1, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) ? this.round(min) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const value = parseFloat(this.minNode.value);
                if (!isNaN(value) && value <= this.currentStatistics[bandIndex]["max"]) {
                    this.minNode.value = `${value}`;
                    this.handleStatisticsChange(value, bandIndex, "min");
                }
                else {
                    setTimeout(() => {
                        const currentMin = this.round(this.currentStatistics[bandIndex]["min"]);
                        this.minNode.value = `${currentMin}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.minNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.max, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch.max, scale: "s", step: 0.1, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) ? this.round(max) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const value = parseFloat(this.maxNode.value);
                if (!isNaN(value) && value >= this.currentStatistics[bandIndex]["min"]) {
                    this.maxNode.value = `${value}`;
                    this.handleStatisticsChange(value, bandIndex, "max");
                }
                else {
                    setTimeout(() => {
                        const currentMax = this.round(this.currentStatistics[bandIndex]["max"]);
                        this.maxNode.value = `${currentMax}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.maxNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.mean, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch.mean, scale: "s", step: 0.1, disabled: disableMeanAndStdDev, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(mean) ? this.round(mean) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const value = parseFloat(this.avgNode.value);
                if (!isNaN(value)) {
                    this.avgNode.value = `${value}`;
                    this.handleStatisticsChange(value, bandIndex, "avg");
                }
                else {
                    setTimeout(() => {
                        const currentMean = this.round(this.currentStatistics[bandIndex]["avg"]);
                        this.avgNode.value = `${currentMean}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.avgNode = node) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.stretch.stddev, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { label: strings.panels.stretch.stddev, scale: "s", step: 0.1, disabled: disableMeanAndStdDev, numberButtonType: "none", value: `${(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(stddev) ? this.round(stddev) : ""}`, onCalciteInputNumberInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const value = parseFloat(this.stddevNode.value);
                if (!isNaN(value)) {
                    this.stddevNode.value = `${value}`;
                    this.handleStatisticsChange(value, bandIndex, "stddev");
                }
                else {
                    setTimeout(() => {
                        const currentStddev = this.round(this.currentStatistics[bandIndex]["stddev"]);
                        this.stddevNode.value = `${currentStddev}`;
                    }, 3000);
                }
            }, 300), ref: (node) => (this.stddevNode = node) }))));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handlePercentOrStddevChange(node, changing) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let value = parseFloat(node.value);
        if (isNaN(value) || value < node.min) {
            value = node.min;
        }
        else if (value > node.max) {
            value = node.max;
        }
        value = parseFloat(value.toFixed(1));
        node.value = `${value}`;
        changing === "min"
            ? (renderer.minPercent = value)
            : changing === "max"
                ? (renderer.maxPercent = value)
                : (renderer.numberOfStandardDeviations = value);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleDRAToggle(applyDRA) {
        var _a;
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const bandIndex = (_a = layer.bandIds[0]) !== null && _a !== void 0 ? _a : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ax.BAND_INDEX;
        renderer.dynamicRangeAdjustment = applyDRA;
        if (applyDRA) {
            renderer.statistics = [];
        }
        else {
            renderer.statistics = [this.currentStatistics[bandIndex]];
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleStatisticsChange(value, statisticIDToUpdate, type) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.currentStatistics[statisticIDToUpdate][type] = value;
        renderer.statistics = [this.currentStatistics[statisticIDToUpdate]];
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    isAnEmptyArray(value) {
        if (Array.isArray(value)) {
            return value.length === 0;
        }
        return value === undefined || value === null;
    }
    round(value) {
        return Math.round(value * 1000) / 1000;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterStretch.style = arcgisSmartMappingPanelsRasterStretchCss;

const arcgisSmartMappingPanelsRasterUniqueValueCss = ":host{width:100%}.flow-item{height:100%}.unique-value-block{overflow-x:hidden;overflow-wrap:anywhere}.label{padding:5px auto}.symbol{width:19px;height:19px}.symbol:focus,.label:focus{outline:2px solid var(--calcite-color-brand)}.symbol-container{cursor:pointer}.selected{outline:1px solid var(--calcite-color-brand)}.hidden{display:none}.gray-border{border-top:1px solid #e0e0e0;border-bottom:1px solid #e0e0e0}.checkbox{margin:0px 5.5px}.default-list-padding{padding-top:8px}";

const ArcgisSmartMappingPanelsRasterUniqueValue = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterUniqueValueClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterUniqueValueClose", 7);
        this.arcgisSmartMappingPanelsRasterUniqueValueBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterUniqueValueBackClick", 7);
        this.arcgisSmartMappingPanelsRasterUniqueValueError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterUniqueValueError", 7);
        this.inputNodes = [];
        this.labelNodes = [];
        this.colorNodes = [];
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterUniqueValueClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterUniqueValueClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer, mapView, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.lastDefault = {
            defaultSymbol: renderer.defaultSymbol || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType),
            defaultLabel: renderer.defaultLabel || strings.panels.uniqueValue.other
        };
        // save original renderer
        this.originalRendererObj = modules.esriLang.clone(layer.renderer);
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    disconnectedCallback() {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ae)();
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.uniqueValue.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterUniqueValueBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "unique-value-block", heading: strings.panels.uniqueValue.uniqueValue, open: true }, this.renderFieldSelector(), this.renderColorScheme(), this.renderValues()));
    }
    renderFieldSelector() {
        var _a;
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const rendererField = renderer.field || strings.panels.uniqueValue.value;
        const fields = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aA)();
        const fieldList = fields.map((field) => {
            return {
                label: field.alias,
                layerField: field,
                // raster layer displays are not dependent on field type, so we use "string" as a placeholder
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.STRING
            };
        });
        const selectedField = fields.find((field) => {
            return field.name === rendererField;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { label: strings.panels.uniqueValue.field, fieldList: fieldList, selectedField: {
                field: (_a = selectedField === null || selectedField === void 0 ? void 0 : selectedField.name) !== null && _a !== void 0 ? _a : strings.panels.uniqueValue.value,
                // raster layer displays are not dependent on field type, so we use "string" as a placeholder
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.STRING
            }, mode: "simple", popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingAttributeInputChange: (event) => {
                if (event.detail) {
                    const newField = event.detail.field;
                    this.handleFieldChange(newField);
                }
            } }));
    }
    renderColorScheme() {
        const { layer: smLayer, mapView, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const uniqueValueInfos = renderer.uniqueValueInfos;
        if (!uniqueValueInfos.length) {
            return null;
        }
        const schemes = modules.typeSchemes.getSchemes({
            basemap: mapView.map.basemap,
            geometryType: "polygon"
        });
        const colorRampsAndSchemes = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a9)(schemes, Math.min(uniqueValueInfos.length, 10));
        const defaultColors = colorRampsAndSchemes[0].colors;
        const colors = [];
        colors.push(...((uniqueValueInfos === null || uniqueValueInfos === void 0 ? void 0 : uniqueValueInfos.length)
            ? uniqueValueInfos.map((uniqueValueInfo, idx) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(uniqueValueInfo.symbol) ||
                new modules.esriColor(defaultColors[idx % defaultColors.length]))
            : []));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { label: strings.panels.uniqueValue.colorScheme, type: "raster-unique-value",
            /**
             * rampType must be continuous to handle graceful display of datasets with more than ~20 colors.
             * Individual colors can still be modified, and the changes will  be reflected in the symbol
             * button and symbol styler.
             */
            rampType: "continuous", colors: modules.esriLang.clone(colors).reverse(), onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
            }, ref: (node) => (this.symbolButtonNode = node) }));
    }
    renderValues() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.labelNodes = [];
        this.inputNodes = [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, renderer.field), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { group: "unique-value-items", class: "gray-border", dragEnabled: true, onCalciteListOrderChange: (event) => {
                if (event.detail.toEl) {
                    const draggedElement = event.detail.dragEl;
                    const draggedToOtherValuesList = event.detail.toEl.id === "other-values-list";
                    if (draggedToOtherValuesList) {
                        const newUniqueValueInfos = renderer.uniqueValueInfos.filter((_, idx) => idx !== parseInt(draggedElement.label));
                        renderer.uniqueValueInfos = newUniqueValueInfos;
                    }
                }
                const items = Array.from(event.target.children);
                this.handleSortValues(items);
            } }, renderer.uniqueValueInfos.map((uniqueValueInfo, idx) => {
            return this.renderValue(uniqueValueInfo, idx);
        })), this.renderDefaultValue(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { id: "other-values-list", dragEnabled: true, group: "unique-value-items" })));
    }
    renderValue(uniqueValueInfo, idx) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: `values-${uniqueValueInfo.value}`, value: `${uniqueValueInfo.value}`, label: `${idx}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-start" }, this.renderColorNode(uniqueValueInfo, idx)), this.renderTextNode(uniqueValueInfo, idx)));
    }
    renderColorNode(uniqueValueInfo, idx) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        let symbol = uniqueValueInfo.symbol.clone();
        const symbolNodeClasses = {
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol),
            symbol: true
        };
        if (idx !== -1 && this.colorNodes.length) {
            this.colorNodes = [];
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, tabindex: "0", "aria-label": strings.panels.uniqueValue.accessibility.editColorFor.replace("${value}", uniqueValueInfo.label), "aria-haspopup": "true", ref: (node) => {
                if (node) {
                    idx === -1 ? (this.defaultColorNode = node) : this.colorNodes.push(node);
                }
            }, onClick: () => {
                if (this.popoverNode) {
                    const colorNode = this.selectedPopoverIdx === -1 ? this.defaultColorNode : this.colorNodes[this.selectedPopoverIdx];
                    colorNode.classList.remove("selected");
                    if (this.selectedPopoverIdx === idx) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                        this.popoverNode = null;
                        this.selectedPopoverIdx = null;
                    }
                    else {
                        this.selectedPopoverIdx = idx;
                        this.handleColorClick(idx);
                    }
                }
                else {
                    this.selectedPopoverIdx = idx;
                    this.handleColorClick(idx);
                }
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.handleColorClick(idx);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                if (node) {
                    this.afterCreateColorNode(node, idx);
                }
            } })));
    }
    renderTextNode(uniqueValueInfo, idx) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `${idx === -1 ? "default-label" : ""} label`, slot: "content", tabindex: "0", ref: (node) => {
                if (node) {
                    idx === -1 ? (this.defaultLabelNode = node) : (this.labelNodes[idx] = node);
                }
            }, "aria-label": strings.panels.uniqueValue.accessibility.editLabelFor.replace("${value}", uniqueValueInfo.label), onClick: (event) => this.handleLabelEdit(idx, event), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    this.handleLabelEdit(idx, event);
                }
            } }, uniqueValueInfo.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { slot: "content", class: "hidden", scale: "s", tabindex: "0", ref: (node) => {
                var _a;
                if (node) {
                    idx === -1 ? (this.defaultInputNode = node) : (this.inputNodes[idx] = node);
                    (_a = this.defaultInputNode) === null || _a === void 0 ? void 0 : _a.classList.add("default-input-padding");
                }
            }, value: uniqueValueInfo.label, onCalciteInputChange: (event) => {
                const inputNode = idx === -1 ? this.defaultInputNode : this.inputNodes[idx];
                const labelNode = idx === -1 ? this.defaultLabelNode : this.labelNodes[idx];
                inputNode.classList.add("hidden");
                labelNode.classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onFocusout: (event) => {
                const inputNode = idx === -1 ? this.defaultInputNode : this.inputNodes[idx];
                const labelNode = idx === -1 ? this.defaultLabelNode : this.labelNodes[idx];
                inputNode.classList.add("hidden");
                labelNode.classList.remove("hidden");
                this.handleValueTextChange(idx, event);
            }, onKeyDown: (event) => {
                if (event.key === "Escape" || event.key === "Enter") {
                    const inputNode = idx === -1 ? this.defaultInputNode : this.inputNodes[idx];
                    inputNode.classList.add("hidden");
                    const input = event.currentTarget;
                    input.value = uniqueValueInfo.label || "";
                    input.disabled = true;
                    this.handleValueTextChange(idx, event);
                    const labelNode = idx === -1 ? this.defaultLabelNode : this.labelNodes[idx];
                    labelNode.classList.remove("hidden");
                    input.disabled = false;
                    setTimeout(() => labelNode.focus(), 300);
                }
            } })));
    }
    renderDefaultValue() {
        const { layer: smLayer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        const defaultSymbol = renderer.defaultSymbol || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType);
        const defaultLabel = renderer.defaultLabel || strings.panels.uniqueValue.other;
        const defaultUniqueValueInfo = {
            symbol: defaultSymbol,
            label: defaultLabel
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: "default-list-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { class: "checkbox", slot: "actions-start", scale: "m", tabIndex: 0, checked: !!renderer.defaultSymbol, onClick: (event) => this.handleCheckboxClick(event), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.handleCheckboxClick(event);
                }
            }, onMouseOver: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.checkboxNode, strings.panels.uniqueValue.otherTooltip), onMouseOut: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ae)(), onFocus: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.af)(this.checkboxNode, strings.panels.uniqueValue.otherTooltip), onFocusout: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ae)(), ref: (node) => {
                if (node) {
                    this.checkboxNode = node;
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-start", class: "symbol-container" }, this.renderColorNode(defaultUniqueValueInfo, -1)), this.renderTextNode(defaultUniqueValueInfo, -1))));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    handleFieldChange(field) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aB)({ field }), this.flowItemNode).then((result) => {
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(result.renderer, layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        }, (error) => {
            this.fieldNode.value = renderer.field;
            this.arcgisSmartMappingPanelsRasterUniqueValueError.emit(error);
        });
    }
    handleSortValues(items) {
        const { layer: smLayer, mapView, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        const layer = smLayer;
        const renderer = layer.renderer;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const itemValues = items.map((item) => item.value);
        const uniqueValueInfos = renderer.uniqueValueInfos.map((uniqueValueInfo) => modules.esriLang.clone(uniqueValueInfo));
        uniqueValueInfos.sort((a, b) => {
            const aIndex = itemValues.indexOf(`${a.value}`);
            const bIndex = itemValues.indexOf(`${b.value}`);
            return aIndex - bIndex;
        });
        if (uniqueValueInfos.length) {
            renderer.uniqueValueInfos = uniqueValueInfos;
        }
        else {
            renderer.defaultSymbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType);
            renderer.defaultLabel = strings.panels.uniqueValue.other;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    afterCreateColorNode(node, idx) {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const rendererType = (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.g)();
        const symbol = idx === -1
            ? renderer.defaultSymbol || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView, rendererType)
            : renderer.uniqueValueInfos[idx].symbol.clone();
        // reset default outline
        if (idx === -1) {
            if (symbol.outline) {
                symbol.outline.width = 0;
            }
        }
        // add outlines only to symbols that are almost white
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(symbol)) {
            symbol.outline = new modules.SimpleLineSymbol({
                color: "#bdc3c7",
                width: 0.75
            });
        }
        while ((_a = node === null || node === void 0 ? void 0 : node.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            node.removeChild(node.childNodes[0]);
        }
        const { symbolUtils } = modules;
        if (symbol) {
            symbolUtils
                .renderPreviewHTML(symbol, {
                size: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ar)(symbol),
                // @ts-ignore
                ignoreWhiteSymbols: true,
                symbolConfig: {
                    isSquareFill: true
                }
            })
                .then((element) => node === null || node === void 0 ? void 0 : node.appendChild(element));
        }
    }
    handleColorClick(idx) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.c)({
            referenceElement: this.flowItemNode,
            heading: strings.panels.uniqueValue.colorScheme
        });
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => this.handleRemoveColorFocus(popoverNode, idx, false));
        popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => this.handleRemoveColorFocus(popoverNode, idx, true));
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.selectedValue = idx;
        (0,_raster_symbolStyler_9b32ef48_js__WEBPACK_IMPORTED_MODULE_6__.a)({
            popoverNode: popoverNode,
            onChange: () => {
                const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
                const layer = smLayer;
                const renderer = layer.renderer;
                if (idx === -1 && !renderer.defaultLabel) {
                    renderer.defaultLabel = strings.panels.uniqueValue.other;
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.symbolButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
            }
        });
        this.popoverNode = popoverNode;
        idx === -1
            ? this.defaultColorNode.classList.add("selected")
            : this.colorNodes[idx].classList.add("selected");
    }
    handleRemoveColorFocus(popoverNode, idx, disconnected) {
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(popoverNode);
        setTimeout(() => {
            const colorNode = idx === -1 ? this.defaultColorNode : this.colorNodes[idx];
            if (!disconnected) {
                colorNode.focus();
            }
            colorNode.classList.remove("selected");
            this.popoverNode = null;
        }, 300);
    }
    handleLabelEdit(idx, event) {
        const inputNode = idx === -1 ? this.defaultInputNode : this.inputNodes[idx];
        inputNode.classList.remove("hidden");
        inputNode.setFocus();
        event.target.classList.add("hidden");
    }
    handleValueTextChange(idx, event) {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        // handles unchecking the default label checkbox
        if (idx === -1 && !renderer.defaultLabel) {
            this.defaultInputNode.value = strings.panels.uniqueValue.other;
            this.defaultLabelNode.textContent = strings.panels.uniqueValue.other;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            return;
        }
        const node = event.target;
        idx === -1
            ? (renderer.defaultLabel = node.value)
            : (renderer.uniqueValueInfos[idx].label = node.value);
        // handles empty inputs
        if (node.value === "") {
            if (idx === -1) {
                renderer.defaultLabel = strings.panels.uniqueValue.other;
                this.defaultInputNode.value = strings.panels.uniqueValue.other;
                this.defaultLabelNode.textContent = strings.panels.uniqueValue.other;
            }
            else {
                renderer.uniqueValueInfos[idx].label = `${renderer.uniqueValueInfos[idx].value}`;
                this.inputNodes[idx].value = renderer.uniqueValueInfos[idx].label;
            }
        }
        else {
            if (idx === -1) {
                this.defaultInputNode.value = renderer.defaultLabel;
                this.defaultLabelNode.textContent = renderer.defaultLabel;
            }
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleCheckboxClick(event) {
        const { layer: smLayer, lastDefault, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_7__.r)(this.popoverNode);
        this.popoverNode = null;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        if (renderer.uniqueValueInfos.length) {
            if (renderer.defaultSymbol) {
                renderer.defaultSymbol = undefined;
                renderer.defaultLabel = undefined;
                this.defaultLabelNode.textContent = strings.panels.uniqueValue.other;
                this.defaultInputNode.value = strings.panels.uniqueValue.other;
            }
            else {
                renderer.defaultSymbol = lastDefault.defaultSymbol;
                renderer.defaultLabel = this.defaultLabelNode.textContent;
            }
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        }
        else {
            event.target.checked = true;
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterUniqueValue.style = arcgisSmartMappingPanelsRasterUniqueValueCss;

const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
const unitOptions = strings.panels.vectorField.unitOptions;
const SpeedUnitOptions = [
    { key: "meter-per-second", title: unitOptions.esriMetersPerSecond, selected: false },
    { key: "kilometer-per-hour", title: unitOptions.esriKilometersPerHour, selected: false },
    { key: "knots", title: unitOptions.esriKnots, selected: false },
    { key: "feet-per-second", title: unitOptions.esriFeetPerSecond, selected: false },
    { key: "mile-per-hour", title: unitOptions.esriMilesPerHour, selected: false }
];

const arcgisSmartMappingPanelsRasterVectorFieldCss = ":host{width:100%}.flow-item{height:100%}.vector-field-block{overflow-x:hidden}.invert-symbol-wrapper{display:flex;justify-content:space-between}.invert-symbol-margin{margin-right:inherit;margin-left:0.35rem}.arcgis--rtl .invert-symbol-margin{margin-left:inherit;margin-right:0.35rem}.invert-symbol-switch{padding-top:6px}.magnitude-input-section{display:flex;justify-content:space-between;margin-top:-10px;margin-bottom:16px}.magnitude-input{width:48%}";

const ArcgisSmartMappingPanelsRasterVectorField = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsRasterVectorFieldClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterVectorFieldClose", 7);
        this.arcgisSmartMappingPanelsRasterVectorFieldBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterVectorFieldBackClick", 7);
        this.arcgisSmartMappingPanelsRasterVectorFieldError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsRasterVectorFieldError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        this.documentClickHandler = undefined;
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsRasterVectorFieldClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererObj } = this;
            const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
            const layer = smLayer;
            (0,_raster_renderer_a62f152c_js__WEBPACK_IMPORTED_MODULE_5__.a)(originalRendererObj, layer);
            this.arcgisSmartMappingPanelsRasterVectorFieldClose.emit("cancel");
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        // save original renderer
        this.originalRendererObj = layer.renderer;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
        this.currentInput = this.inputUnitNode.value;
        this.currentOutput = this.outputUnitNode.value;
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { hideLayerTitle, layer, strings, isRTL } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.vectorField.styleOptions, description: !hideLayerTitle ? title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsRasterVectorFieldBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderDoneButton(), this.renderCancelButton())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "vector-field-block", heading: strings.panels.vectorField.vectorField, open: true }, this.renderSymbolStyleSelector(), this.renderSymbolDensitySlider(), this.renderSymbolScalingSlider(), this.renderInvertSymbols(), this.renderMagnitudeRange(), this.renderUnitSelectors()));
    }
    renderSymbolStyleSelector() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-vector-symbol-button", { ref: (node) => (this.selectNode = node), onArcgisSmartMappingSelectBeforeOpen: () => {
                var _a;
                (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.parentElement.removeChild(this.popoverNode);
                this.popoverNode = null;
                this.popoverOpen = false;
            }, onArcgisSmartMappingSelectChange: (event) => {
                const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
                const layer = smLayer;
                const renderer = layer.renderer;
                let style = event.detail;
                if (style.includes("beaufort")) {
                    style = this.getExactBeaufortUnit(renderer.outputUnit);
                }
                this.resetOutputUnit(style, renderer);
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_class_breaks_50c446bd_js__WEBPACK_IMPORTED_MODULE_8__.d)({ style: style }), this.flowItemNode).then((result) => {
                    layer.renderer = result.renderer;
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    this.selectNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.selectNode);
                }, (error) => {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.selectNode);
                    this.arcgisSmartMappingPanelsRasterVectorFieldError.emit(error);
                });
            } }));
    }
    renderSymbolDensitySlider() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { symbolTileSize } = renderer || {};
        const adjustedTileSize = 100 / symbolTileSize;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.vectorField.symbolDensity, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-raster-slider", { rendererType: "vector-field", type: "density", min: 1, max: 5, values: [Math.round(adjustedTileSize * 10) / 10], precision: 1, minLabel: strings.panels.flow.low, maxLabel: strings.panels.flow.high })));
    }
    renderSymbolScalingSlider() {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        const { minSize, maxSize } = sizeVisVar;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.vectorField.symbolScaling, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { min: 0, minValue: minSize !== null ? minSize : 20, max: 100, maxValue: maxSize !== null ? maxSize : 80, step: 1, labelHandles: true, labelTicks: true, precise: true, snap: true, onCalciteSliderInput: (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_10__.d)(() => {
                const min = this.symbolScalingSliderNode.minValue;
                const max = this.symbolScalingSliderNode.maxValue;
                this.handleSymbolScaleChange(min, max);
            }, 300), ref: (node) => (this.symbolScalingSliderNode = node) })));
    }
    renderInvertSymbols() {
        const { layer: smLayer, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        let isChecked = renderer.flowRepresentation !== "flow-from";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "invert-symbol-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, strings.panels.vectorField.invertSymbols, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: {
                "invert-symbol-margin": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_9__.C.rtl]: isRTL
            }, "icon-start": "information", scale: "s", appearance: "transparent", kind: "neutral", onClick: () => {
                if (this.popoverOpen) {
                    this.removePopover();
                    this.buttonNode.setFocus();
                }
                else {
                    this.togglePopover();
                }
            }, ref: (node) => (this.buttonNode = node) }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { class: "invert-symbol-switch", scale: "s", label: strings.panels.vectorField.invertSymbols, checked: isChecked, onCalciteSwitchChange: (event) => this.handleInvertSymbolsChange(event.currentTarget.checked ? "flow-to" : "flow-from") })));
    }
    renderMagnitudeRange() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-magnitude-range-slider", null);
    }
    renderUnitSelectors() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.vectorField.convertMagnitude), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.vectorField.inputUnits, this.renderUnitSelector("input")), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.vectorField.outputUnits, this.renderUnitSelector("output"))));
    }
    renderUnitSelector(type) {
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const disabled = type === "output" &&
            ["wind-barb", "ocean-current-kn", "ocean-current-m"].indexOf(renderer.style) > -1;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { disabled: disabled, key: type === "input" ? renderer.inputUnit : renderer.outputUnit, label: type === "input"
                ? strings.panels.vectorField.inputUnits
                : strings.panels.vectorField.outputUnits, clearDisabled: true, scale: "s", selectionMode: "single", ref: (node) => {
                if (node) {
                    if (type === "output") {
                        this.outputUnitNode = node;
                    }
                    else {
                        this.inputUnitNode = node;
                    }
                }
            }, onCalciteComboboxChange: () => {
                if (type === "input") {
                    if (this.inputUnitNode.value === "") {
                        this.inputUnitNode.value = this.currentInput;
                    }
                    else {
                        this.currentInput = this.inputUnitNode.value;
                    }
                    this.handleUnitSelectClick("input");
                }
                else {
                    if (this.outputUnitNode.value === "") {
                        this.outputUnitNode.value = this.currentOutput;
                    }
                    else {
                        this.currentOutput = this.outputUnitNode.value;
                    }
                    this.handleUnitSelectClick("output");
                }
            } }, SpeedUnitOptions.map((unitOption) => this.renderUnitOption(type, unitOption))));
    }
    renderUnitOption(type, unit) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const selectedUnitOption = SpeedUnitOptions.find((speedUnitOption) => type === "input"
            ? speedUnitOption.key === renderer.inputUnit
            : speedUnitOption.key === renderer.outputUnit);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { value: unit.key, textLabel: unit.title, selected: selectedUnitOption ? unit === selectedUnitOption : false }));
    }
    renderDoneButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    getExactBeaufortUnit(outputUnit) {
        outputUnit = outputUnit !== null && outputUnit !== void 0 ? outputUnit : "meter-per-second";
        switch (outputUnit) {
            case "knots":
                return "beaufort-kn";
            case "meter-per-second":
                return "beaufort-m";
            case "mile-per-hour":
                return "beaufort-mi";
            case "kilometer-per-hour":
                return "beaufort-km";
            case "feet-per-second":
                return "beaufort-ft";
        }
    }
    resetOutputUnit(style, renderer) {
        let outputUnit;
        switch (style) {
            case "ocean-current-kn":
            case "wind-barb":
                outputUnit = "knots";
                break;
            case "ocean-current-m":
                outputUnit = "meter-per-second";
                break;
        }
        if (outputUnit) {
            renderer.outputUnit = outputUnit;
        }
    }
    handleSymbolScaleChange(min, max) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
        sizeVisVar.minSize = min;
        sizeVisVar.maxSize = max;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleInvertSymbolsChange(direction) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        renderer.flowRepresentation = direction;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    handleUnitSelectClick(type) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        if (type === "input") {
            renderer.inputUnit = this.inputUnitNode.value;
        }
        else {
            renderer.outputUnit = this.outputUnitNode.value;
            if (renderer.style.includes("beaufort")) {
                renderer.style = this.getExactBeaufortUnit(renderer.outputUnit);
            }
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    togglePopover() {
        const { flowItemNode } = this;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.popoverNode = document.createElement("arcgis-smart-mapping-info-popover");
        this.popoverNode.props = {
            title: strings.panels.vectorField.invertSymbols,
            flowItemNode,
            moreInfo: strings.panels.vectorField.invertSymbolsTip
        };
        this.popoverNode.referenceElement = this.buttonNode;
        this.popoverNode.addEventListener("arcgisSmartMappingInfoPopoverClose", (event) => {
            event.stopPropagation();
            this.removePopover();
            this.buttonNode.setFocus();
        });
        document.body.appendChild(this.popoverNode);
        this.popoverNode.setOpen(true);
        this.popoverOpen = true;
        setTimeout(() => {
            this.documentClickHandler = (event) => {
                if (!(0,_popover_721f7ba2_js__WEBPACK_IMPORTED_MODULE_12__.i)(event.target)) {
                    this.removePopover();
                }
            };
            document.addEventListener("click", this.documentClickHandler);
        });
    }
    removePopover() {
        document.body
            .querySelectorAll(".arcgis-smart-mapping-popover")
            .forEach((node) => document.body.removeChild(node));
        this.popoverNode = null;
        this.popoverOpen = false;
        if (this.documentClickHandler) {
            document.removeEventListener("click", this.documentClickHandler);
            this.documentClickHandler = undefined;
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsRasterVectorField.style = arcgisSmartMappingPanelsRasterVectorFieldCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-raster-class-breaks_8.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
    let timeout;
    let status = "idle";
    function flush(...args) {
        status = "flushed";
        return debounced(...args);
    }
    function invoke(...args) {
        status = "invoked";
        return debounced(...args);
    }
    function cancel(...args) {
        status = "cancelled";
        return debounced(...args);
    }
    function getStatus() {
        return status;
    }
    const debounced = (...args) => new Promise((resolve) => {
        switch (status) {
            case "flushed":
                status = "idle";
                if (timeout) {
                    clearTimeout(timeout);
                    resolve(fn(...args));
                }
                else {
                    resolve(null);
                }
                break;
            case "invoked":
                clearTimeout(timeout);
                status = "idle";
                resolve(fn(...args));
                break;
            case "cancelled":
                clearTimeout(timeout);
                status = "idle";
                resolve(null);
                break;
            default:
                if (timeout) {
                    clearTimeout(timeout);
                }
                status = "pending";
                timeout = setTimeout(() => {
                    status = "idle";
                    return resolve(fn(...args));
                }, delay);
                break;
        }
    });
    debounced.flush = flush;
    debounced.invoke = invoke;
    debounced.cancel = cancel;
    debounced.getStatus = getStatus;
    return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
    let timeout;
    return (...args) => new Promise((resolve) => {
        if (timeout) {
            return;
        }
        timeout = setTimeout(() => {
            clearTimeout(timeout);
            timeout = undefined;
            resolve(fn(...args));
        }, delay);
    });
};
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
    await Promise.all([promise, timeout(minDelay)]);
    return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
    const { key, data } = getKeyAndItem(item);
    return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
    const resultArr = [];
    const lookupMap = {};
    myArr.forEach((item) => {
        const id = getItemId(item);
        if (lookupMap[id] == null) {
            lookupMap[id] = item;
            resultArr.push(item);
        }
    });
    return resultArr;
}
function unique(myArr) {
    const primitives = { boolean: {}, number: {}, string: {} };
    const objs = [];
    return myArr.filter((item) => {
        let type = typeof item;
        if (type in primitives) {
            return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
        }
        else {
            return objs.indexOf(item) >= 0 ? false : objs.push(item);
        }
    });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));



//# sourceMappingURL=functional-44de8fcf.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popover-721f7ba2.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   i: () => (/* binding */ isInsideInfoPopoverNode)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function isInsideInfoPopoverNode(node) {
    if ((node === null || node === void 0 ? void 0 : node.tagName) === "ARCGIS-SMART-MAPPING-INFO-POPOVER") {
        return true;
    }
    else {
        let parentNode = node === null || node === void 0 ? void 0 : node.parentElement;
        while (parentNode) {
            if (parentNode.tagName === "ARCGIS-SMART-MAPPING-INFO-POPOVER") {
                return true;
            }
            else {
                parentNode = parentNode.parentElement;
            }
        }
    }
    return false;
}



//# sourceMappingURL=popover-721f7ba2.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTgxZjJlYS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzhJO0FBQytrQjtBQUNqcUI7QUFDekI7QUFDQTtBQUMyRjtBQUN3QjtBQUMxQztBQUNnRTtBQUM5RztBQUNMO0FBQ3FFO0FBQ3pEO0FBQ3ZDO0FBQ0g7QUFDRTtBQUNVO0FBQ1A7O0FBRWhDLDREQUE0RCxXQUFXLFdBQVcsWUFBWSxvQkFBb0Isa0JBQWtCLHVCQUF1QixRQUFRLGFBQWEsMkJBQTJCLDZDQUE2Qyx5QkFBeUIsZ0JBQWdCLG1CQUFtQixVQUFVLDZDQUE2Qzs7QUFFM1c7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDhEQUE4RCxxREFBVztBQUN6RSxrRUFBa0UscURBQVc7QUFDN0UsOERBQThELHFEQUFXO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNCQUFzQjtBQUMxQyxvQkFBb0IsaUJBQWlCLEVBQUUsK0RBQWlCO0FBQ3hEO0FBQ0EsWUFBWSwrREFBbUI7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQixFQUFFLCtEQUFpQjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxRQUFRLHFGQUFxRjtBQUNuSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix3Q0FBd0MsRUFBRSwrREFBaUI7QUFDM0U7QUFDQSxnQkFB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEI7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixXQUFXLFlBQVk7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRWlNOztBQUVqTTs7Ozs7Ozs7Ozs7Ozs7QUMvSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV3Qzs7QUFFeEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtcmFzdGVyLWNsYXNzLWJyZWFrc184LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vcG9wb3Zlci03MjFmN2JhMi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGFhIGFzIGlzVG9wRmxvd0l0ZW0sIHcgYXMgc2ltcGxlRmllbGRUeXBlcywgdCBhcyBnZXRTeW1ib2xDb2xvciwgYXEgYXMgaXNTeW1ib2xBbG1vc3RXaGl0ZSwgRSBhcyBjbG9zZVBvcG92ZXJzLCBhciBhcyBnZXRSZW5kZXJQcmV2aWV3U2l6ZSwgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSwgYWIgYXMgdXBkYXRlUmVuZGVyZXIsIHIgYXMgYXBwbHlTeW1ib2xDb2xvciwgYSBhcyBnZXRWaXNWYXIsIGFqIGFzIGdldFJhc3RlckRlZmF1bHRTeW1ib2wsIGFzIGFzIHNldERlZmF1bHRSR0JCYW5kcywgYWMgYXMgaXNEZWZpbmVkLCBhdCBhcyBnZXRQZXJjZW50TGFiZWxGbGlwLCBhdSBhcyBjcmVhdGVSZ2JSZW5kZXJlckZyb21FeGlzdGluZywgYXYgYXMgcmdiVHlwZU1hcCwgYXcgYXMgcmdiRGVmYXVsdHMsIGF4IGFzIHN0cmV0Y2hEZWZhdWx0cywgYXkgYXMgY3JlYXRlU3RyZXRjaFJlbmRlcmVyRnJvbUV4aXN0aW5nLCBheiBhcyBzdHJldGNoVHlwZU1hcCwgUyBhcyBnZXREZWZhdWx0U3ltYm9sLCBhZSBhcyByZW1vdmVTbWFydE1hcHBpbmdUb29sdGlwLCBhQSBhcyBnZXRSYXN0ZXJVbmlxdWVWYWx1ZUZpZWxkcywgYWYgYXMgYWRkU21hcnRNYXBwaW5nVG9vbHRpcCwgYUIgYXMgY3JlYXRlVW5pcXVlVmFsdWVSZW5kZXJlckZyb21FeGlzdGluZywgYTkgYXMgZ2V0Q29sb3JSYW1wc1dpdGhTY2hlbWVzIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCB7IHIgYXMgcmVxdWVzdFdyYXBwZXIgfSBmcm9tICcuL2xvYWRpbmctNjkxMzk5MDcuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFwcGx5UmFzdGVyUmVuZGVyZXIsIG4gYXMgbm9ybWFsaXplQ29sb3JSYW1wLCBnIGFzIGdldFJhc3RlclJlbmRlcmVyVHlwZSB9IGZyb20gJy4vcmFzdGVyLXJlbmRlcmVyLWE2MmYxNTJjLmpzJztcbmltcG9ydCB7IGIgYXMgYnVpbGRTeW1ib2xTdHlsZXJGb3JSYXN0ZXJDbGFzc0JyZWFrc1ZhbHVlLCBhIGFzIGJ1aWxkU3ltYm9sU3R5bGVyRm9yUmFzdGVyVW5pcXVlVmFsdWVzVmFsdWUgfSBmcm9tICcuL3Jhc3Rlci1zeW1ib2xTdHlsZXItOWIzMmVmNDguanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTeW1ib2xTdHlsZXJQb3BvdmVyLCByIGFzIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIgfSBmcm9tICcuL3N5bWJvbFN0eWxlci0wNDYzNWIyYi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFJhc3RlckNsYXNzQnJlYWtzRmllbGRzLCBiIGFzIGNyZWF0ZUNsYXNzQnJlYWtzUmVuZGVyZXJGcm9tRXhpc3RpbmcsIGQgYXMgY3JlYXRlVmVjdG9yRmllbGRSZW5kZXJlckZyb21FeGlzdGluZyB9IGZyb20gJy4vcmFzdGVyLWNsYXNzLWJyZWFrcy01MGM0NDZiZC5qcyc7XG5pbXBvcnQgeyBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWJvdW5jZSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBhIGFzIGNyZWF0ZUZsb3dSZW5kZXJlckZyb21FeGlzdGluZywgZiBhcyBmaW5kRmxvd1NjaGVtZSwgYyBhcyBjcmVhdGVGbG93UmVuZGVyZXIgfSBmcm9tICcuL3Jhc3Rlci1mbG93LTc2MWEzNDcwLmpzJztcbmltcG9ydCB7IGkgYXMgaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUgfSBmcm9tICcuL3BvcG92ZXItNzIxZjdiYTIuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCAnLi9sb2NhdGlvbi1lMjZiNTM5Zi5qcyc7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9LmNsYXNzLWJyZWFrcy1ibG9ja3tvdmVyZmxvdy14OmhpZGRlbjtvdmVyZmxvdy13cmFwOmFueXdoZXJlfS5oaWRkZW57ZGlzcGxheTpub25lfS5sYWJlbDpmb2N1cywuc3ltYm9sOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5sYWJlbCwuc3ltYm9sLWNvbnRhaW5lcntwYWRkaW5nLXRvcDo1cHg7cGFkZGluZy1ib3R0b206NXB4fS5zZWxlY3RlZHtvdXRsaW5lOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3MgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMuc3ltYm9sTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuaW5wdXROb2RlcyA9IFtdO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmhhbmRsZURvbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBrZWVwIHRoZSBjdXJyZW50IHNldHRpbmdzIG9uIHRoZSBsYXllclxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDbGFzc0JyZWFrc0Nsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlck9iaiB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICAgICAgYXBwbHlSYXN0ZXJSZW5kZXJlcihvcmlnaW5hbFJlbmRlcmVyT2JqLCBsYXllcik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQ2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51T3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5iZWZvcmVCYWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJPYmogPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLnJlbmRlcmVyKTtcbiAgICAgICAgdGhpcy5kZWZhdWx0Q29sb3JSYW1wID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLm1hcCgoY2xhc3NCcmVha0luZm8pID0+IGNsYXNzQnJlYWtJbmZvLnN5bWJvbC5jb2xvcik7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBoaWRlTGF5ZXJUaXRsZSwgbGF5ZXIsIHN0cmluZ3MsIGlzUlRMIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5jbGFzc0JyZWFrcy5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiAhaGlkZUxheWVyVGl0bGUgPyB0aXRsZSA6IHVuZGVmaW5lZCwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NCYWNrQ2xpY2suZW1pdCgpLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlclZpc3VhbGl6YXRpb24oKSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJjbGFzcy1icmVha3MtYmxvY2tcIiwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMuY2xhc3NCcmVha3MuY2xhc3NCcmVha3MsIG9wZW46IHRydWUgfSwgdGhpcy5yZW5kZXJGaWVsZFNlbGVjdG9yKCksIHRoaXMucmVuZGVyTWV0aG9kKCksIHRoaXMucmVuZGVyQ2xhc3NlcygpLCB0aGlzLnJlbmRlckRlZmluZWRJbnRlcnZhbCgpLCB0aGlzLnJlbmRlckNvbG9yU2NoZW1lKCksIHRoaXMucmVuZGVyQ29sb3JTbGlkZXIoKSwgdGhpcy5yZW5kZXJWYWx1ZXMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJGaWVsZFNlbGVjdG9yKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyRmllbGQgPSByZW5kZXJlci5maWVsZCB8fCBzdHJpbmdzLnBhbmVscy5jbGFzc0JyZWFrcy52YWx1ZTtcbiAgICAgICAgY29uc3QgZmllbGRzID0gZ2V0UmFzdGVyQ2xhc3NCcmVha3NGaWVsZHMoKTtcbiAgICAgICAgY29uc3QgZmllbGRMaXN0ID0gZmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IGZpZWxkLmFsaWFzLFxuICAgICAgICAgICAgICAgIGxheWVyRmllbGQ6IGZpZWxkLFxuICAgICAgICAgICAgICAgIC8vIHJhc3RlciBsYXllciBkaXNwbGF5cyBhcmUgbm90IGRlcGVuZGVudCBvbiBmaWVsZCB0eXBlLCBzbyB3ZSB1c2UgXCJzdHJpbmdcIiBhcyBhIHBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLlNUUklOR1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGQgPSBmaWVsZHMuZmluZCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBmaWVsZC5uYW1lID09PSByZW5kZXJlckZpZWxkO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYXR0cmlidXRlLWlucHV0XCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLmNsYXNzQnJlYWtzLmZpZWxkLCBmaWVsZExpc3Q6IGZpZWxkTGlzdCwgc2VsZWN0ZWRGaWVsZDoge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAoX2EgPSBzZWxlY3RlZEZpZWxkID09PSBudWxsIHx8IHNlbGVjdGVkRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRmllbGQubmFtZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogc3RyaW5ncy5wYW5lbHMuY2xhc3NCcmVha3MudmFsdWUsXG4gICAgICAgICAgICAgICAgLy8gcmFzdGVyIGxheWVyIGRpc3BsYXlzIGFyZSBub3QgZGVwZW5kZW50IG9uIGZpZWxkIHR5cGUsIHNvIHdlIHVzZSBcInN0cmluZ1wiIGFzIGEgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HXG4gICAgICAgICAgICB9LCBtb2RlOiBcInNpbXBsZVwiLCBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsIG9uQXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RmllbGQgPSBldmVudC5kZXRhaWwuZmllbGQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRmllbGRDaGFuZ2UobmV3RmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJNZXRob2QoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLW1ldGhvZC1idXR0b25cIiwgeyBrZXk6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8uY2xhc3NpZmljYXRpb25NZXRob2QsIHNob3dEZWZpbmVkSW50ZXJ2YWw6IHRydWUsIG9uQXJjZ2lzU21hcnRNYXBwaW5nTWV0aG9kQnV0dG9uQmVmb3JlT3BlbjogKCkgPT4gY2xvc2VQb3BvdmVycygpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5kZXRhaWwgPT09IFwibWFudWFsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICAgICAgICAgICAgICBhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMubWV0aG9kQnV0dG9uTm9kZS5zZXRGb2N1cygpLCAzMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG51bUNsYXNzZXMgPSAoKF9hID0gcmVuZGVyZXIgPT09IG51bGwgfHwgcmVuZGVyZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5udW1DbGFzc2VzKSB8fCAoKF9iID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRlZmluZWRJbnRlcnZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRldGFpbCA9PT0gXCJkZWZpbmVkLWludGVydmFsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzQnJlYWtzID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZEludGVydmFsID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2xhc3NCcmVha3NbY2xhc3NCcmVha3MubGVuZ3RoIC0gMV0ubWF4VmFsdWUgLSBjbGFzc0JyZWFrc1swXS5taW5WYWx1ZSkgLyA1O1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtQ2xhc3NlcyA9IE1hdGguY2VpbCgocmVuZGVyZXIuY2xhc3NCcmVha0luZm9zW251bUNsYXNzZXMgLSAxXS5tYXhWYWx1ZSAtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLm1pblZhbHVlKSAvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZEludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0V3JhcHBlcihjcmVhdGVDbGFzc0JyZWFrc1JlbmRlcmVyRnJvbUV4aXN0aW5nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uTWV0aG9kOiBldmVudC5kZXRhaWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1DbGFzc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZEludGVydmFsXG4gICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5tZXRob2RCdXR0b25Ob2RlLnNldEZvY3VzKCksIDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5tZXRob2RCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NFcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kQnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckNsYXNzZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IG51bUNsYXNzZXMgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubGVuZ3RoO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uTWV0aG9kID0gYXV0aEluZm8uY2xhc3NpZmljYXRpb25NZXRob2Q7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuY2xhc3NCcmVha3MuY2xhc3NpZnlDbGFzc2VzLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyB0YWJpbmRleDogXCIwXCIsIHZhbHVlOiBgJHtudW1DbGFzc2VzfWAsIGRpc2FibGVkOiBjbGFzc2lmaWNhdGlvbk1ldGhvZCA9PT0gXCJkZWZpbmVkLWludGVydmFsXCIsIG1pbjogMSwgbWF4OiAxMCwgc3RlcDogMSwgc2NhbGU6IFwic1wiLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludCh0aGlzLmNsYXNzZXNOb2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bUNsYXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlIDwgdGhpcy5jbGFzc2VzTm9kZS5taW4gfHwgdmFsdWUgPiB0aGlzLmNsYXNzZXNOb2RlLm1heCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzZXNDaGFuZ2VIYW5kbGUgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlQ2xhc3Nlc0NoYW5nZSgpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsYXNzZXNDaGFuZ2VIYW5kbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsYXNzZXNDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAzMDApLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc2VzTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJEZWZpbmVkSW50ZXJ2YWwoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgY2xhc3NpZmljYXRpb25NZXRob2QgPSBhdXRoSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZDtcbiAgICAgICAgaWYgKGNsYXNzaWZpY2F0aW9uTWV0aG9kICE9PSBcImRlZmluZWQtaW50ZXJ2YWxcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYnJlYWtJbnRlcnZhbCA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5tYXhWYWx1ZSAtIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5taW5WYWx1ZTtcbiAgICAgICAgLy8gc2V0IG1pbiBhbmQgbWF4IGJhc2VkIG9uIGEgbWF4aW11bSBvZiAxMCBjbGFzc2VzXG4gICAgICAgIGNvbnN0IG1pbiA9IE1hdGguZmxvb3IoKHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1tyZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubGVuZ3RoIC0gMV0ubWF4VmFsdWUgLVxuICAgICAgICAgICAgcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLm1pblZhbHVlKSAvXG4gICAgICAgICAgICA5LjEpO1xuICAgICAgICBjb25zdCBtYXggPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmxlbmd0aCAtIDFdLm1heFZhbHVlIC1cbiAgICAgICAgICAgIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5taW5WYWx1ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5jbGFzc0JyZWFrcy5kZWZpbmVkSW50ZXJ2YWwsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IHRhYkluZGV4OiAwLCB2YWx1ZTogYCR7TWF0aC5yb3VuZChicmVha0ludGVydmFsICogMTAwKSAvIDEwMH1gLCBtaW46IG1pbiwgbWF4OiBtYXgsIHN0ZXA6IDAuMSwgc2NhbGU6IFwic1wiLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUudmFsdWUgfHwgbmV3VmFsdWUgPCBub2RlLm1pbiB8fCBuZXdWYWx1ZSA+IG5vZGUubWF4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVmaW5lZEludGVydmFsQ2hhbmdlSGFuZGxlID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZURlZmluZWRJbnRlcnZhbENoYW5nZSgpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlZmluZWRJbnRlcnZhbENoYW5nZUhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRGVmaW5lZEludGVydmFsQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZGVmaW5lZEludGVydmFsTm9kZSA9IG5vZGUpIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2NoZW1lKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBjb2xvcnMgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubWFwKChjbGFzc0JyZWFrSW5mbykgPT4gZ2V0U3ltYm9sQ29sb3IoY2xhc3NCcmVha0luZm8uc3ltYm9sKSk7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyBsYWJlbDogc3RyaW5ncy5wYW5lbHMuY2xhc3NCcmVha3MuY29sb3JTY2hlbWUsIHR5cGU6IFwicmFzdGVyLWNsYXNzLWJyZWFrc1wiLCByYW1wVHlwZTogXCJkaXNjcmV0ZVwiLCBjb2xvcnM6IGNvbG9ycywgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xCdXR0b25TeW1ib2xDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRDb2xvclJhbXAgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubWFwKChjbGFzc0JyZWFrSW5mbykgPT4gY2xhc3NCcmVha0luZm8uc3ltYm9sLmNvbG9yKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUobm9kZSk7XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5zeW1ib2xCdXR0b25Ob2RlID0gbm9kZSkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2xvclNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctY2xhc3MtYnJlYWtzLWNvbG9yLXNsaWRlclwiLCB7IG9uQXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NCcmVha3NDb2xvclNsaWRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy51cGRhdGVWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbnMgPT09IG51bGwgfHwgaW5zdHJ1Y3Rpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbnN0cnVjdGlvbnMuaW52ZXJ0Q29sb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc3ltYm9sQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0Q29sb3JSYW1wID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLm1hcCgoY2xhc3NCcmVha0luZm8pID0+IGNsYXNzQnJlYWtJbmZvLnN5bWJvbC5jb2xvcik7XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5zbGlkZXJOb2RlID0gbm9kZSkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJWYWx1ZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHRoaXMubGFiZWxOb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLmlucHV0Tm9kZXMgPSBbXTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0XCIsIG51bGwsIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1xuICAgICAgICAgICAgLm1hcCgoY2xhc3NCcmVha0luZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVmFsdWUoY2xhc3NCcmVha0luZm8sIGlkeCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAucmV2ZXJzZSgpKSk7XG4gICAgfVxuICAgIHJlbmRlclZhbHVlKGNsYXNzQnJlYWtJbmZvLCBpZHgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN5bWJvbC1jb250YWluZXJcIiwgc2xvdDogXCJhY3Rpb25zLXN0YXJ0XCIgfSwgdGhpcy5yZW5kZXJTeW1ib2xOb2RlKGNsYXNzQnJlYWtJbmZvLCBpZHgpKSwgdGhpcy5yZW5kZXJUZXh0Tm9kZShjbGFzc0JyZWFrSW5mbywgaWR4KSkpO1xuICAgIH1cbiAgICByZW5kZXJTeW1ib2xOb2RlKGNsYXNzQnJlYWtJbmZvLCBpZHgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgbGV0IHN5bWJvbCA9IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1tpZHhdLnN5bWJvbC5jbG9uZSgpO1xuICAgICAgICBjb25zdCBzeW1ib2xOb2RlQ2xhc3NlcyA9IHtcbiAgICAgICAgICAgIFwic3ltYm9sLWlzLXdoaXRlXCI6IGlzU3ltYm9sQWxtb3N0V2hpdGUoc3ltYm9sKSxcbiAgICAgICAgICAgIHN5bWJvbDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogc3ltYm9sTm9kZUNsYXNzZXMsIHRhYmluZGV4OiBcIjBcIiwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MucGFuZWxzLmNsYXNzQnJlYWtzLmFjY2Vzc2liaWxpdHkuZWRpdENvbG9yRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBjbGFzc0JyZWFrSW5mby5sYWJlbCksIFwiYXJpYS1oYXNwb3B1cFwiOiBcInRydWVcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXMudW5zaGlmdChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xOb2Rlc1t0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPT09IGlkeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IGlkeDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpZHgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG9wb3ZlcklkeCA9IGlkeDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGlkeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGlkeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVWYWx1ZVN5bWJvbChub2RlLCBpZHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVGV4dE5vZGUoY2xhc3NCcmVha0luZm8sIGlkeCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJsYWJlbFwiLCBzbG90OiBcImNvbnRlbnRcIiwgdGFiaW5kZXg6IFwiMFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzLnVuc2hpZnQobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MucGFuZWxzLmNsYXNzQnJlYWtzLmFjY2Vzc2liaWxpdHkuZWRpdExhYmVsRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBjbGFzc0JyZWFrSW5mby5sYWJlbCksIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBpbnB1dE5vZGUgPSB0aGlzLmlucHV0Tm9kZXNbaWR4XTtcbiAgICAgICAgICAgICAgICBpbnB1dE5vZGUuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICBpbnB1dE5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0Tm9kZSA9IHRoaXMuaW5wdXROb2Rlc1tpZHhdO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dE5vZGUuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXROb2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgY2xhc3NCcmVha0luZm8ubGFiZWwpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBjbGFzczogXCJoaWRkZW5cIiwgc2NhbGU6IFwic1wiLCB0YWJpbmRleDogXCIwXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXMudW5zaGlmdChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB2YWx1ZTogY2xhc3NCcmVha0luZm8ubGFiZWwsIG9uQ2FsY2l0ZUlucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaWR4XS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxOb2Rlc1tpZHhdLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaWR4LCBldmVudCk7XG4gICAgICAgICAgICB9LCBvbkZvY3Vzb3V0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaWR4XS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxOb2Rlc1tpZHhdLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaWR4LCBldmVudCk7XG4gICAgICAgICAgICB9LCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGNsYXNzQnJlYWtJbmZvLmxhYmVsIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaWR4LCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxOb2Rlc1tpZHhdLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5sYWJlbE5vZGVzW2lkeF0uZm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogdGhpcy5oYW5kbGVEb25lLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICBoYW5kbGVGaWVsZENoYW5nZShuZXdGaWVsZCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICByZXF1ZXN0V3JhcHBlcihjcmVhdGVDbGFzc0JyZWFrc1JlbmRlcmVyRnJvbUV4aXN0aW5nKHsgZmllbGQ6IG5ld0ZpZWxkIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB0aGlzLnVwZGF0ZVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciksIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWVsZE5vZGUudmFsdWUgPSByZW5kZXJlci5maWVsZDtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3NFcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhhbmRsZURlZmluZWRJbnRlcnZhbENoYW5nZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY3VycmVudEludGVydmFsID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLm1heFZhbHVlIC0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLm1pblZhbHVlO1xuICAgICAgICBsZXQgbmV3SW50ZXJ2YWwgPSBwYXJzZUZsb2F0KHRoaXMuZGVmaW5lZEludGVydmFsTm9kZS52YWx1ZSk7XG4gICAgICAgIGlmIChuZXdJbnRlcnZhbCA9PT0gY3VycmVudEludGVydmFsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzTmFOKG5ld0ludGVydmFsKSB8fCBuZXdJbnRlcnZhbCA8IHRoaXMuZGVmaW5lZEludGVydmFsTm9kZS5taW4pIHtcbiAgICAgICAgICAgIG5ld0ludGVydmFsID0gdGhpcy5kZWZpbmVkSW50ZXJ2YWxOb2RlLm1pbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChuZXdJbnRlcnZhbCA+IHRoaXMuZGVmaW5lZEludGVydmFsTm9kZS5tYXgpIHtcbiAgICAgICAgICAgIG5ld0ludGVydmFsID0gdGhpcy5kZWZpbmVkSW50ZXJ2YWxOb2RlLm1heDtcbiAgICAgICAgfVxuICAgICAgICBuZXdJbnRlcnZhbCA9IHBhcnNlRmxvYXQobmV3SW50ZXJ2YWwudG9GaXhlZCgyKSk7XG4gICAgICAgIHRoaXMuZGVmaW5lZEludGVydmFsTm9kZS52YWx1ZSA9IGAke25ld0ludGVydmFsfWA7XG4gICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNsYXNzQnJlYWtzUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBkZWZpbmVkSW50ZXJ2YWw6IG5ld0ludGVydmFsIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB0aGlzLnVwZGF0ZVJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciksIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgdGhpcy5kZWZpbmVkSW50ZXJ2YWxOb2RlLnZhbHVlID0gYCR7Y3VycmVudEludGVydmFsfWA7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzRXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVDbGFzc2VzQ2hhbmdlKCkge1xuICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGN1cnJlbnROdW1DbGFzc2VzID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmxlbmd0aDtcbiAgICAgICAgY29uc3QgeyBhdXRob3JpbmdJbmZvIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgYXV0aG9yaW5nSW5mby5udW1DbGFzc2VzID0gdGhpcy5jbGFzc2VzTm9kZS52YWx1ZVxuICAgICAgICAgICAgPyBOdW1iZXIucGFyc2VJbnQodGhpcy5jbGFzc2VzTm9kZS52YWx1ZSwgMTApXG4gICAgICAgICAgICA6IDA7XG4gICAgICAgIGlmIChhdXRob3JpbmdJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kID09PSBcIm1hbnVhbFwiKSB7XG4gICAgICAgICAgICBhdXRob3JpbmdJbmZvLmNsYXNzaWZpY2F0aW9uTWV0aG9kID0gXCJlcXVhbC1pbnRlcnZhbFwiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5taW4oTWF0aC5tYXgocGFyc2VJbnQodGhpcy5jbGFzc2VzTm9kZS52YWx1ZSksIDEpLCAxMCkgfHwgNTtcbiAgICAgICAgaWYgKGAke3ZhbHVlfWAgIT09IHRoaXMuY2xhc3Nlc05vZGUudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3Nlc05vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNsYXNzQnJlYWtzUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBudW1DbGFzc2VzOiB2YWx1ZSB9KSwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4gdGhpcy51cGRhdGVSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIpLCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3Nlc05vZGUudmFsdWUgPSBgJHtjdXJyZW50TnVtQ2xhc3Nlc31gO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDbGFzc0JyZWFrc0Vycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWZ0ZXJDcmVhdGVWYWx1ZVN5bWJvbChub2RlLCBpZHgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBsZXQgc3ltYm9sID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zW2lkeF0uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgIC8vIHJlc2V0IGRlZmF1bHQgb3V0bGluZVxuICAgICAgICBpZiAoaWR4ID09PSAtMSkge1xuICAgICAgICAgICAgaWYgKHN5bWJvbC5vdXRsaW5lKSB7XG4gICAgICAgICAgICAgICAgc3ltYm9sLm91dGxpbmUud2lkdGggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGFkZCBvdXRsaW5lcyBvbmx5IHRvIHN5bWJvbHMgdGhhdCBhcmUgYWxtb3N0IHdoaXRlXG4gICAgICAgIGlmIChpc1N5bWJvbEFsbW9zdFdoaXRlKHN5bWJvbCkpIHtcbiAgICAgICAgICAgIHN5bWJvbC5vdXRsaW5lID0gbmV3IG1vZHVsZXMuU2ltcGxlTGluZVN5bWJvbCh7XG4gICAgICAgICAgICAgICAgY29sb3I6IFwiI2JkYzNjN1wiLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAwLjc1XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoKF9hID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLmNoaWxkTm9kZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHtcbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5jaGlsZE5vZGVzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHN5bWJvbFV0aWxzIH0gPSBtb2R1bGVzO1xuICAgICAgICBpZiAoc3ltYm9sKSB7XG4gICAgICAgICAgICBzeW1ib2xVdGlsc1xuICAgICAgICAgICAgICAgIC5yZW5kZXJQcmV2aWV3SFRNTChzeW1ib2wsIHtcbiAgICAgICAgICAgICAgICBzaXplOiBnZXRSZW5kZXJQcmV2aWV3U2l6ZShzeW1ib2wpLFxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBpZ25vcmVXaGl0ZVN5bWJvbHM6IHRydWUsXG4gICAgICAgICAgICAgICAgc3ltYm9sQ29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzU3F1YXJlRmlsbDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKGVsZW1lbnQpID0+IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5hcHBlbmRDaGlsZChlbGVtZW50KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpZHgpIHtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBwb3BvdmVyTm9kZSA9IGNyZWF0ZVN5bWJvbFN0eWxlclBvcG92ZXIoe1xuICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsXG4gICAgICAgICAgICBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5jbGFzc0JyZWFrcy5jb2xvclNjaGVtZVxuICAgICAgICB9KTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHBvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXNbaWR4XS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9KTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1N0eWxlclBvcG92ZXJEaXNjb25uZWN0ZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcmVtb3ZlU3ltYm9sU3R5bGVyUG9wb3Zlcihwb3BvdmVyTm9kZSk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJOb2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbE5vZGVzW2lkeF0uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLmNsYXNzZWRTeW1ib2xTZWxlY3RlZElkeCA9IGlkeDtcbiAgICAgICAgYnVpbGRTeW1ib2xTdHlsZXJGb3JSYXN0ZXJDbGFzc0JyZWFrc1ZhbHVlKHtcbiAgICAgICAgICAgIHBvcG92ZXJOb2RlOiBwb3BvdmVyTm9kZSxcbiAgICAgICAgICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLnNsaWRlck5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IHBvcG92ZXJOb2RlO1xuICAgICAgICB0aGlzLnN5bWJvbE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgIH1cbiAgICBoYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaWR4LCBldmVudCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zW2lkeF0ubGFiZWwgPSBub2RlLnZhbHVlO1xuICAgICAgICAvKiB3b3JrYXJvdW5kIHRvIGFsbG93IFwiZW1wdHlcIiBsYWJlbHMgKG90aGVyd2lzZSwgdGhlIGNsYXNzaWZ5IGxhYmVsXG4gICAgICAgIHdpbGwgc3RheSBlbXB0eSBidXQgdGhlIGxlZ2VuZCBsYWJlbCB3aWxsIGFzc3VtZSBpdHMgZGVmYXVsdCB2YWx1ZSkgKi9cbiAgICAgICAgaWYgKG5vZGUudmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzQnJlYWsgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbaWR4XTtcbiAgICAgICAgICAgIGNsYXNzQnJlYWsubGFiZWwgPSBgJHtjbGFzc0JyZWFrLm1pblZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9IC0gJHtjbGFzc0JyZWFrLm1heFZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9YDtcbiAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpZHhdLnZhbHVlID0gdGhpcy5sYWJlbE5vZGVzW2lkeF0udGV4dENvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgfVxuICAgIGhhbmRsZUludmVyc2lvblN0YXR1cyhyZXN1bHRSZW5kZXJlcikge1xuICAgICAgICBjb25zdCB7IG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBvbGRGaXJzdENvbG9yID0gSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZhdWx0Q29sb3JSYW1wWzBdKTtcbiAgICAgICAgY29uc3QgbmV3Rmlyc3RDb2xvciA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdFJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5zeW1ib2wuY29sb3IpO1xuICAgICAgICBpZiAob2xkRmlyc3RDb2xvciAhPT0gbmV3Rmlyc3RDb2xvcikge1xuICAgICAgICAgICAgbGV0IGNvbG9ycyA9IHJlc3VsdFJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5tYXAoKGNsYXNzQnJlYWtJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChnZXRTeW1ib2xDb2xvcihjbGFzc0JyZWFrSW5mby5zeW1ib2wpIHx8XG4gICAgICAgICAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcih7IHI6IDY0LCBnOiA2NCwgYjogNjQsIGE6IDEgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb2xvcnMgPSBjb2xvcnMucmV2ZXJzZSgpO1xuICAgICAgICAgICAgcmVzdWx0UmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLm1hcCgoY2xhc3NCcmVha0luZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChnZXRTeW1ib2xDb2xvcihjbGFzc0JyZWFrSW5mby5zeW1ib2wpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sQ29sb3IoY2xhc3NCcmVha0luZm8uc3ltYm9sLCBjb2xvcnNbaWR4XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRDb2xvclJhbXAgPSByZXN1bHRSZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MubWFwKChjbGFzc0JyZWFrSW5mbykgPT4gY2xhc3NCcmVha0luZm8uc3ltYm9sLmNvbG9yKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVSZW5kZXJlcihyZXN1bHRSZW5kZXJlcikge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICB0aGlzLmhhbmRsZUludmVyc2lvblN0YXR1cyhyZXN1bHRSZW5kZXJlcik7XG4gICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIocmVzdWx0UmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDbGFzc0JyZWFrcy5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNsYXNzQnJlYWtzQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDb2xvcm1hcENzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS5jb2xvcm1hcC1ibG9ja3tvdmVyZmxvdy14OmhpZGRlbn0udGFibGV7d2lkdGg6MTAwJTtvdmVyZmxvdy13cmFwOmFueXdoZXJlfS5jb2xvcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcn0uY29sb3JibG9ja3tib3JkZXI6MXB4IHNvbGlkICMwMDB9LmhpZGRlbntkaXNwbGF5Om5vbmV9LmxhYmVse3BhZGRpbmctdG9wOjVweDtwYWRkaW5nLWJvdHRvbTo1cHh9LmxhYmVsOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDb2xvcm1hcCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDb2xvcm1hcEJhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuaW5wdXROb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLmxhYmVsTm9kZXMgPSBbXTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJPYmogfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIob3JpZ2luYWxSZW5kZXJlck9iaiwgbGF5ZXIpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDb2xvcm1hcENsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXJcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVyT2JqID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5yZW5kZXJlcik7XG4gICAgICAgIHJlbmRlcmVyLmNvbG9ybWFwSW5mb3MuZm9yRWFjaCgoY29sb3JtYXBJbmZvLCBpZHgpID0+IHtcbiAgICAgICAgICAgIGlmICghY29sb3JtYXBJbmZvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgLy8gd29ya2Fyb3VuZCBmb3IgYWxsb3dpbmcgZW1wdHkgbGFiZWxzLiBXZSBrZWVwIHZhbHVlcyB3aXRoIG5vIGxhYmVscyBpbiBvdXIgdGFibGUgZm9yIHBhcml0eSB3aXRoIFByby5cbiAgICAgICAgICAgICAgICByZW5kZXJlci5jb2xvcm1hcEluZm9zW2lkeF0ubGFiZWwgPSBcIiBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBoaWRlTGF5ZXJUaXRsZSwgbGF5ZXIsIHN0cmluZ3MsIGlzUlRMIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5jb2xvcm1hcC5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiAhaGlkZUxheWVyVGl0bGUgPyB0aXRsZSA6IHVuZGVmaW5lZCwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXBCYWNrQ2xpY2suZW1pdCgpLCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLnJlbmRlclZpc3VhbGl6YXRpb24oKSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJjb2xvcm1hcC1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5jb2xvcm1hcC5jb2xvcm1hcCwgb3BlbjogdHJ1ZSB9LCB0aGlzLnJlbmRlckNvbG9ybWFwVGFibGUoKSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2xvcm1hcFRhYmxlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICB0aGlzLmxhYmVsTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5pbnB1dE5vZGVzID0gW107XG4gICAgICAgIGNvbnN0IGNvbG9ybWFwcyA9IHJlbmRlcmVyLmNvbG9ybWFwSW5mb3MubWFwKChjb2xvcm1hcEluZm8sIGlkeCkgPT4gdGhpcy5yZW5kZXJDb2xvcm1hcFJvdyhjb2xvcm1hcEluZm8sIGlkeCkpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRhYmxlXCIsIHsgY2xhc3M6IFwidGFibGVcIiwgY2FwdGlvbjogc3RyaW5ncy5wYW5lbHMuY29sb3JtYXAuY29sb3JtYXBUYWJsZSB9LCBoKFwiY2FsY2l0ZS10YWJsZS1yb3dcIiwgeyBzbG90OiBcInRhYmxlLWhlYWRlclwiIH0sIGgoXCJjYWxjaXRlLXRhYmxlLWhlYWRlclwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLmNvbG9ybWFwLmNvbG9yLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIgfSksIGgoXCJjYWxjaXRlLXRhYmxlLWhlYWRlclwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLmNvbG9ybWFwLnZhbHVlLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIgfSksIGgoXCJjYWxjaXRlLXRhYmxlLWhlYWRlclwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLmNvbG9ybWFwLmxhYmVsLCBhbGlnbm1lbnQ6IFwiY2VudGVyXCIgfSkpLCBjb2xvcm1hcHMpKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JtYXBSb3coY29sb3JtYXBJbmZvLCBpZHgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10YWJsZS1yb3dcIiwgbnVsbCwgaChcImNhbGNpdGUtdGFibGUtY2VsbFwiLCB7IGFsaWdubWVudDogXCJjZW50ZXJcIiB9LCB0aGlzLnJlbmRlckNvbG9yTm9kZShjb2xvcm1hcEluZm8pKSwgaChcImNhbGNpdGUtdGFibGUtY2VsbFwiLCB7IGFsaWdubWVudDogXCJjZW50ZXJcIiB9LCBjb2xvcm1hcEluZm8udmFsdWUpLCBoKFwiY2FsY2l0ZS10YWJsZS1jZWxsXCIsIHsgYWxpZ25tZW50OiBcImNlbnRlclwiIH0sIHRoaXMucmVuZGVyTGFiZWxOb2RlKGNvbG9ybWFwSW5mbywgaWR4KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JOb2RlKGNvbG9ybWFwSW5mbykge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvclwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNyZWF0ZUNvbG9yKG5vZGUsIGNvbG9ybWFwSW5mbyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckxhYmVsTm9kZShjb2xvcm1hcEluZm8sIGlkeCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJsYWJlbFwiLCB0YWJpbmRleDogXCIwXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MucGFuZWxzLmNsYXNzQnJlYWtzLmFjY2Vzc2liaWxpdHkuZWRpdExhYmVsRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBjb2xvcm1hcEluZm8ubGFiZWwpLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXROb2RlID0gdGhpcy5pbnB1dE5vZGVzW2lkeF07XG4gICAgICAgICAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgaW5wdXROb2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9LCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dE5vZGUgPSB0aGlzLmlucHV0Tm9kZXNbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0Tm9kZS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGNvbG9ybWFwSW5mby5sYWJlbCksIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgY2xhc3M6IFwiaGlkZGVuXCIsIHRhYmluZGV4OiBcIjBcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpZHhdID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB2YWx1ZTogY29sb3JtYXBJbmZvLmxhYmVsLCBvbkNhbGNpdGVJbnB1dENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgfSwgb25Gb2N1c291dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dE5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsTm9kZXNbaWR4XS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpZHhdLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBjb2xvcm1hcEluZm8ubGFiZWwgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVZhbHVlVGV4dENoYW5nZShpZHgsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2lkeF0uY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmxhYmVsTm9kZXNbaWR4XS5mb2N1cygpLCAzMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIGFmdGVyQ3JlYXRlQ29sb3Iobm9kZSwgY29sb3JtYXBJbmZvKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgd2hpbGUgKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5jaGlsZE5vZGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzeW1ib2xVdGlscyB9ID0gbW9kdWxlcztcbiAgICAgICAgY29uc3QgY29sb3JibG9jayA9IHN5bWJvbFV0aWxzLnJlbmRlckNvbG9yUmFtcFByZXZpZXdIVE1MKFtjb2xvcm1hcEluZm8uY29sb3IuY2xvbmUoKV0sIHtcbiAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZSxcbiAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbG9yYmxvY2suY2xhc3NMaXN0LmFkZChcImNvbG9yYmxvY2tcIik7XG4gICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY29sb3JibG9jayk7XG4gICAgfVxuICAgIGhhbmRsZVZhbHVlVGV4dENoYW5nZShpZHgsIGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICBub2RlLnZhbHVlID09PSBcIlwiXG4gICAgICAgICAgICA/ICh0aGlzLmlucHV0Tm9kZXNbaWR4XS52YWx1ZSA9IHRoaXMubGFiZWxOb2Rlc1tpZHhdLnRleHRDb250ZW50KVxuICAgICAgICAgICAgOiAocmVuZGVyZXIuY29sb3JtYXBJbmZvc1tpZHhdLmxhYmVsID0gbm9kZS52YWx1ZSk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ29sb3JtYXAuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJDb2xvcm1hcENzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0NzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS5mbG93LWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5ibG9jay1jb250ZW50LXBhZGRpbmd7cGFkZGluZy1ib3R0b206MTBweH0uYmxvY2stY29udGVudC1wYWRkaW5nLWxhcmdle3BhZGRpbmctYm90dG9tOjIwcHh9LnN5bWJvbC1idXR0b24tcGFkZGluZ3twYWRkaW5nLWJvdHRvbToxMnB4fS5tb2RlLWhvdmVye2N1cnNvcjpwb2ludGVyfS50b2dnbGVze3BhZGRpbmctdG9wOjEwcHh9LnRvZ2dsZS10ZXh0e3dpZHRoOjEwMCV9LmhpbnQtdGV4dHtmb250LXNpemU6c21hbGxlcjttYXJnaW4tdG9wOi04cHh9LmhpbnQtdGV4dC5kaXNhYmxlZHtvcGFjaXR5OjAuNX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvdyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0Nsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJGbG93Q2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0JhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0JhY2tDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJGbG93RXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckZsb3dFcnJvclwiLCA3KTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0Nsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlck9iaiwgb3JpZ2luYWxFZmZlY3QgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgICAgIGxheWVyLmVmZmVjdCA9IG9yaWdpbmFsRWZmZWN0O1xuICAgICAgICAgICAgYXBwbHlSYXN0ZXJSZW5kZXJlcihvcmlnaW5hbFJlbmRlcmVyT2JqLCBsYXllcik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckZsb3dDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyIGFuZCBlZmZlY3RcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVyT2JqID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHRoaXMub3JpZ2luYWxFZmZlY3QgPSBsYXllci5lZmZlY3Q7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBoaWRlTGF5ZXJUaXRsZSwgbGF5ZXIsIHN0cmluZ3MsIGlzUlRMIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5mbG93LnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IHRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJGbG93QmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwiZmxvdy1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5mbG93LmZsb3dTdHlsZSwgb3BlbjogdHJ1ZSB9LCB0aGlzLnJlbmRlck1vZGUoKSwgdGhpcy5yZW5kZXJTcGVlZCgpLCB0aGlzLnJlbmRlckRlbnNpdHkoKSwgdGhpcy5yZW5kZXJMZW5ndGgoKSwgdGhpcy5yZW5kZXJXaWR0aCgpLCB0aGlzLnJlbmRlckNvbG9yKCksIHRoaXMucmVuZGVyQ29sb3JTbGlkZXIoKSwgdGhpcy5yZW5kZXJEaXJlY3Rpb24oKSwgdGhpcy5yZW5kZXJSb3VuZENhcHMoKSwgdGhpcy5yZW5kZXJTaG93SW5MZWdlbmQoKSwgdGhpcy5yZW5kZXJFZmZlY3RzKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyTW9kZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBpc1dhdmUgPSAoYXV0aEluZm8gPT09IG51bGwgfHwgYXV0aEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhJbmZvLmZsb3dUaGVtZSlcbiAgICAgICAgICAgID8gKGF1dGhJbmZvID09PSBudWxsIHx8IGF1dGhJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoSW5mby5mbG93VGhlbWUpID09PSBcIndhdmUtZnJvbnRcIlxuICAgICAgICAgICAgOiByZW5kZXJlci50cmFpbExlbmd0aCA8IDE7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImJsb2NrLWNvbnRlbnQtcGFkZGluZy1sYXJnZVwiIH0sIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyB2YWx1ZTogXCJmbG93bGluZVwiLCBhcHBlYXJhbmNlOiBpc1dhdmUgPyBcIm91dGxpbmUtZmlsbFwiIDogXCJzb2xpZFwiLCBraW5kOiBpc1dhdmUgPyBcIm5ldXRyYWxcIiA6IFwiYnJhbmRcIiwgY2xhc3M6IGlzV2F2ZSA/IFwibW9kZS1ob3ZlclwiIDogXCJcIiwgc2NhbGU6IFwic1wiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZU1vZGVDaGFuZ2UoXCJmbG93bGluZVwiKSB9LCBzdHJpbmdzLnBhbmVscy5mbG93LmZsb3dsaW5lKSwgaChcInNwYW5cIiwgbnVsbCwgXCJcXHUwMEEwXCIpLCBoKFwiY2FsY2l0ZS1jaGlwXCIsIHsgdmFsdWU6IFwid2F2ZWZyb250XCIsIGFwcGVhcmFuY2U6IGlzV2F2ZSA/IFwic29saWRcIiA6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IGlzV2F2ZSA/IFwiYnJhbmRcIiA6IFwibmV1dHJhbFwiLCBjbGFzczogaXNXYXZlID8gXCJcIiA6IFwibW9kZS1ob3ZlclwiLCBzY2FsZTogXCJzXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlTW9kZUNoYW5nZShcIndhdmVmcm9udFwiKSB9LCBzdHJpbmdzLnBhbmVscy5mbG93LndhdmVmcm9udCkpKTtcbiAgICB9XG4gICAgcmVuZGVyU3BlZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgaXNXYXZlID0gYXV0aEluZm8uZmxvd1RoZW1lID09PSBcIndhdmUtZnJvbnRcIjtcbiAgICAgICAgY29uc3QgeyBmbG93U3BlZWQgfSA9IHJlbmRlcmVyO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmZsb3cuc3BlZWQsIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1yYXN0ZXItc2xpZGVyXCIsIHsgcmVuZGVyZXJUeXBlOiBcImZsb3dcIiwgdHlwZTogXCJzcGVlZFwiLCBtaW46IDAsIG1heDogaXNXYXZlID8gMjAgOiA0MCwgdmFsdWVzOiBbZmxvd1NwZWVkXSwgcHJlY2lzaW9uOiAxLCBtaW5MYWJlbDogc3RyaW5ncy5wYW5lbHMuZmxvdy5zbG93LCBtYXhMYWJlbDogc3RyaW5ncy5wYW5lbHMuZmxvdy5mYXN0IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckRlbnNpdHkoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgZGVuc2l0eSB9ID0gcmVuZGVyZXI7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuZmxvdy5kZW5zaXR5LCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcmFzdGVyLXNsaWRlclwiLCB7IHJlbmRlcmVyVHlwZTogXCJmbG93XCIsIHR5cGU6IFwiZGVuc2l0eVwiLCBtaW46IDAuMSwgbWF4OiAxLCB2YWx1ZXM6IFtkZW5zaXR5XSwgcHJlY2lzaW9uOiAxLCBtaW5MYWJlbDogc3RyaW5ncy5wYW5lbHMuZmxvdy5sb3csIG1heExhYmVsOiBzdHJpbmdzLnBhbmVscy5mbG93LmhpZ2ggfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTGVuZ3RoKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzV2F2ZSA9IGF1dGhJbmZvLmZsb3dUaGVtZSA9PT0gXCJ3YXZlLWZyb250XCI7XG4gICAgICAgIGNvbnN0IHsgdHJhaWxMZW5ndGggfSA9IHJlbmRlcmVyO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmZsb3cubGVuZ3RoLCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcmFzdGVyLXNsaWRlclwiLCB7IHJlbmRlcmVyVHlwZTogXCJmbG93XCIsIHR5cGU6IFwidHJhaWwtbGVuZ3RoXCIsIG1pbjogaXNXYXZlID8gMC4xIDogMSwgbWF4OiBpc1dhdmUgPyA1MCA6IDIwMCwgdmFsdWVzOiBbdHJhaWxMZW5ndGggLyAwLjc1XSwgcHJlY2lzaW9uOiBpc1dhdmUgPyAxIDogMCwgbWluTGFiZWw6IHN0cmluZ3MucGFuZWxzLmZsb3cuc2hvcnQsIG1heExhYmVsOiBzdHJpbmdzLnBhbmVscy5mbG93LmxvbmcgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyV2lkdGgoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgaXNXYXZlID0gYXV0aEluZm8uZmxvd1RoZW1lID09PSBcIndhdmUtZnJvbnRcIjtcbiAgICAgICAgY29uc3QgeyB0cmFpbFdpZHRoIH0gPSByZW5kZXJlcjtcbiAgICAgICAgY29uc3QgcHhXaWR0aCA9IE1hdGgucm91bmQoKHRyYWlsV2lkdGggLyAwLjc1KSAqIDEwKSAvIDEwO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJibG9jay1jb250ZW50LXBhZGRpbmctbGFyZ2VcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5mbG93LndpZHRoKSwgaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXNsaWRlci1pbnB1dFwiLCB7IG1pbjogaXNXYXZlID8gTWF0aC5taW4oNSwgTWF0aC5mbG9vcihweFdpZHRoKSkgOiAwLjEsIG1heDogaXNXYXZlID8gTWF0aC5tYXgoMTIsIE1hdGguY2VpbChweFdpZHRoKSkgOiBNYXRoLm1heCg1LCBNYXRoLmNlaWwocHhXaWR0aCkpLCB2YWx1ZXM6IFtweFdpZHRoXSwgcHJlY2lzaW9uOiAxLCBzdWZmaXhUZXh0OiBzdHJpbmdzLnBhbmVscy5mbG93LnB4LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1NsaWRlcklucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RyYWlsV2lkdGggPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB0cmFpbFdpZHRoIH0gPSByZW5kZXJlcjtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VHJhaWxXaWR0aCA9IE1hdGgucm91bmQoKHRyYWlsV2lkdGggLyAwLjc1KSAqIDEwKSAvIDEwO1xuICAgICAgICAgICAgICAgIGlmIChuZXdUcmFpbFdpZHRoID09PSBjdXJyZW50VHJhaWxXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRyYWlsV2lkdGggPSBuZXdUcmFpbFdpZHRoICogMC43NTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2xvcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uLWdyb3VwXCIsIHsgY2xhc3M6IFwiYmxvY2stY29udGVudC1wYWRkaW5nXCIsIG5hbWU6IFwiY29sb3JUeXBlXCIsIGxheW91dDogXCJ2ZXJ0aWNhbFwiLCBvbkNhbGNpdGVSYWRpb0J1dHRvbkdyb3VwQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlQ29sb3JUeXBlQ2hhbmdlKGV2ZW50LnRhcmdldC5zZWxlY3RlZEl0ZW0udmFsdWUpIH0sIGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lXCIgfSwgaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uXCIsIHsgY2hlY2tlZDogIWNvbG9yVmlzVmFyLCB2YWx1ZTogXCJzaW5nbGVDb2xvclwiLCByZWY6IChub2RlKSA9PiAodGhpcy5zaW5nbGVDb2xvck5vZGUgPSBub2RlKSB9KSwgc3RyaW5ncy5wYW5lbHMuZmxvdy5zaW5nbGVDb2xvciksICFjb2xvclZpc1ZhciAmJiB0aGlzLnJlbmRlclNpbmdsZUNvbG9yKCkpLCBoKFwiZGl2XCIsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiIH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNoZWNrZWQ6ICEhY29sb3JWaXNWYXIsIHZhbHVlOiBcImNvbG9yUmFtcFwiLCByZWY6IChub2RlKSA9PiAodGhpcy5jb2xvclJhbXBOb2RlID0gbm9kZSkgfSksIHN0cmluZ3MucGFuZWxzLmZsb3cuY29sb3JSYW1wKSwgY29sb3JWaXNWYXIgJiYgdGhpcy5yZW5kZXJDb2xvclJhbXAoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyU2luZ2xlQ29sb3IoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgY29sb3IgfSA9IHJlbmRlcmVyO1xuICAgICAgICBjb25zdCBzeW1ib2wgPSBnZXRSYXN0ZXJEZWZhdWx0U3ltYm9sKCk7XG4gICAgICAgIHN5bWJvbC5jb2xvciA9IGNvbG9yO1xuICAgICAgICBzeW1ib2wub3V0bGluZS5jb2xvciA9IGNvbG9yO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzeW1ib2wtYnV0dG9uLXBhZGRpbmdcIiB9LCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IHN5bWJvbDogc3ltYm9sLCBoaWRlTGFiZWw6IHRydWUsIHR5cGU6IFwicmFzdGVyLWZsb3dcIiwgcmFtcFR5cGU6IFwiY29udGludW91c1wiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yUmFtcCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmICghY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2xvcnMgPSBjb2xvclZpc1Zhci5zdG9wcy5tYXAoKHN0b3ApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3RvcC5jb2xvci5jbG9uZSgpO1xuICAgICAgICAgICAgY29sb3IuYSA9IDE7XG4gICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzeW1ib2wtYnV0dG9uLXBhZGRpbmdcIiB9LCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IGNvbG9yczogY29sb3JzLCBoaWRlTGFiZWw6IHRydWUsIHR5cGU6IFwicmFzdGVyLWZsb3dcIiwgcmFtcFR5cGU6IFwiY29udGludW91c1wiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xCdXR0b25Ob2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuZmxvd0NvbG9yU2xpZGVyTm9kZSk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgaWYgKCFjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZmxvdy1jb2xvci1zbGlkZXJcIiwgeyByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXJOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdGbG93Q29sb3JTbGlkZXJFcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckZsb3dFcnJvci5lbWl0KGV2ZW50LmRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJEaXJlY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgZmxvd1JlcHJlc2VudGF0aW9uIH0gPSByZW5kZXJlcjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiLCBjbGFzczogXCJibG9jay1jb250ZW50LXBhZGRpbmdcIiB9LCBzdHJpbmdzLnBhbmVscy5mbG93LmZsb3dEaXJlY3Rpb24sIGgoXCJjYWxjaXRlLXNlZ21lbnRlZC1jb250cm9sXCIsIHsgbGF5b3V0OiBcImhvcml6b250YWxcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCBvbkNhbGNpdGVTZWdtZW50ZWRDb250cm9sQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlRGlyZWN0aW9uQ2hhbmdlKGV2ZW50LnRhcmdldC5zZWxlY3RlZEl0ZW0udmFsdWUpIH0sIGgoXCJjYWxjaXRlLXNlZ21lbnRlZC1jb250cm9sLWl0ZW1cIiwgeyB2YWx1ZTogXCJ0b1wiLCBjaGVja2VkOiBmbG93UmVwcmVzZW50YXRpb24gIT09IFwiZmxvdy1mcm9tXCIgfSwgc3RyaW5ncy5wYW5lbHMuZmxvdy50byksIGgoXCJjYWxjaXRlLXNlZ21lbnRlZC1jb250cm9sLWl0ZW1cIiwgeyB2YWx1ZTogXCJmcm9tXCIsIGNoZWNrZWQ6IGZsb3dSZXByZXNlbnRhdGlvbiA9PT0gXCJmbG93LWZyb21cIiB9LCBzdHJpbmdzLnBhbmVscy5mbG93LmZyb20pKSkpO1xuICAgIH1cbiAgICByZW5kZXJSb3VuZENhcHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgdHJhaWxXaWR0aCwgYXV0aG9yaW5nSW5mbyB9ID0gcmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGlzRmxvd2xpbmUgPSBhdXRob3JpbmdJbmZvLmZsb3dUaGVtZSA9PT0gXCJmbG93LWxpbmVcIjtcbiAgICAgICAgY29uc3QgaXNDaGVja2VkID0gcmVuZGVyZXIudHJhaWxDYXAgPT09IFwicm91bmRcIjtcbiAgICAgICAgLy8gdHJhaWxXaWR0aCBpcyBpbiBwdHM7IGJ5cGFzcyByb3VuZGluZyBpc3N1ZXNcbiAgICAgICAgY29uc3QgaXNFbmFibGVkID0gTWF0aC5yb3VuZCh0cmFpbFdpZHRoICogMTAwMCkgLyAxMDAwID4gMztcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG9nZ2xlcyBibG9jay1jb250ZW50LXBhZGRpbmdcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInRvZ2dsZS10ZXh0XCIsIGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiIH0sIHN0cmluZ3MucGFuZWxzLmZsb3cucm91bmRFbmRDYXBzLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3VuZENhcFRvZ2dsZU5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGRpc2FibGVkOiAhaXNFbmFibGVkLCBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IGlzQ2hlY2tlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoKSA9PiB0aGlzLmhhbmRsZVJvdW5kQ2Fwc1RvZ2dsZSgpIH0pKSwgaXNGbG93bGluZSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IGBoaW50LXRleHQgJHshaXNFbmFibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1gIH0sIHN0cmluZ3MucGFuZWxzLmZsb3cuZm9yV2lkZUxpbmVzKSkgOiBudWxsKSk7XG4gICAgfVxuICAgIHJlbmRlclNob3dJbkxlZ2VuZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmICghY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxlZ2VuZE9wdGlvbnMgPSBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBjb25zdCBpc0NoZWNrZWQgPSAhbGVnZW5kT3B0aW9ucyB8fCBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgIT09IGZhbHNlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIsIGNsYXNzOiBcInRvZ2dsZS10ZXh0IHRvZ2dsZXMgYmxvY2stY29udGVudC1wYWRkaW5nXCIgfSwgc3RyaW5ncy5wYW5lbHMuZmxvdy5pbmNsdWRlSW5MZWdlbmQsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogaXNDaGVja2VkLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6ICgpID0+IHRoaXMuaGFuZGxlSW5jbHVkZUluTGVnZW5kVG9nZ2xlKCkgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRWZmZWN0cygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidG9nZ2xlcyBibG9jay1jb250ZW50LXBhZGRpbmdcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInRvZ2dsZS10ZXh0XCIsIGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiIH0sIHN0cmluZ3MucGFuZWxzLmZsb3cubGF5ZXJFZmZlY3RzLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6ICEhbGF5ZXIuZWZmZWN0LCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6ICgpID0+IHRoaXMuaGFuZGxlRWZmZWN0VG9nZ2xlKCkgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGludC10ZXh0XCIgfSwgc3RyaW5ncy5wYW5lbHMuZmxvdy5hZGp1c3RFZmZlY3RzKSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgaGFuZGxlTW9kZUNoYW5nZSh0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgaXNXYXZlID0gYXV0aEluZm8uZmxvd1RoZW1lID09PSBcIndhdmUtZnJvbnRcIjtcbiAgICAgICAgY29uc3QgbmV3Rmxvd1RoZW1lID0gYXV0aEluZm8uZmxvd1RoZW1lID09PSBcIndhdmUtZnJvbnRcIiA/IFwiZmxvdy1saW5lXCIgOiBcIndhdmUtZnJvbnRcIjtcbiAgICAgICAgaWYgKCghaXNXYXZlICYmIHR5cGUgPT09IFwid2F2ZWZyb250XCIpIHx8IChpc1dhdmUgJiYgdHlwZSA9PT0gXCJmbG93bGluZVwiKSkge1xuICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgcmVxdWVzdFdyYXBwZXIoY3JlYXRlRmxvd1JlbmRlcmVyRnJvbUV4aXN0aW5nKHsgZmxvd1RoZW1lOiBuZXdGbG93VGhlbWUgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBsYXllci5yZW5kZXJlciA9IHJlc3VsdC5yZW5kZXJlci5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMucm91bmRDYXBUb2dnbGVOb2RlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBkZXRlcm1pbmUgaWYgdXBkYXRlUmVuZGVyZXIoKSBpcyBuZWVkZWQgdG8gdXBkYXRlIG90aGVyIGNvbXBvbmVudHMgYXBwcm9wcmlhdGVseVxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0Vycm9yLmVtaXQoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVDb2xvclR5cGVDaGFuZ2UodHlwZSkge1xuICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgIGluY2x1ZGVDb2xvclZhcmlhYmxlOiB0eXBlID09PSBcImNvbG9yUmFtcFwiXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlICE9PSBcImNvbG9yUmFtcFwiKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RGbG93VGhlbWUgPSBmaW5kRmxvd1NjaGVtZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdEZsb3dUaGVtZSkge1xuICAgICAgICAgICAgY29uZmlnLmZsb3dTY2hlbWUgPSB0aGlzLmxhc3RGbG93VGhlbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdFdyYXBwZXIoY3JlYXRlRmxvd1JlbmRlcmVyRnJvbUV4aXN0aW5nKGNvbmZpZyksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGxheWVyLnJlbmRlcmVyID0gcmVzdWx0LnJlbmRlcmVyLmNsb25lKCk7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgLy8gaGFuZGxlcyBjaGVja2luZyB0aGUgcHJldmlvdXNseSBjaGVja2VkIGNvbG9yIG9wdGlvbjsgb3JkZXIgbWF0dGVycyB3aGVuIHNldHRpbmcgdGhlc2UhXG4gICAgICAgICAgICBpZiAodGhpcy5zaW5nbGVDb2xvck5vZGUuY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2luZ2xlQ29sb3JOb2RlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yUmFtcE5vZGUuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yUmFtcE5vZGUuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2luZ2xlQ29sb3JOb2RlLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJGbG93RXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVEaXJlY3Rpb25DaGFuZ2UodHlwZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICByZW5kZXJlci5mbG93UmVwcmVzZW50YXRpb24gPSB0eXBlID09PSBcImZyb21cIiA/IFwiZmxvdy1mcm9tXCIgOiBcImZsb3ctdG9cIjtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgaGFuZGxlUm91bmRDYXBzVG9nZ2xlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICByZW5kZXJlci50cmFpbENhcCA9IHJlbmRlcmVyLnRyYWlsQ2FwID09PSBcInJvdW5kXCIgPyBcImJ1dHRcIiA6IFwicm91bmRcIjtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgaGFuZGxlSW5jbHVkZUluTGVnZW5kVG9nZ2xlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgbGVnZW5kT3B0aW9ucyA9IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnM7XG4gICAgICAgIGlmIChsZWdlbmRPcHRpb25zICYmIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChsZWdlbmRPcHRpb25zLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgbGVnZW5kT3B0aW9ucy5zaG93TGVnZW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zID0gbGVnZW5kT3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZUVmZmVjdFRvZ2dsZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgaWYgKGxheWVyLmVmZmVjdCkge1xuICAgICAgICAgICAgbGF5ZXIuZWZmZWN0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICAgICAgY3JlYXRlRmxvd1JlbmRlcmVyKHsgZmxvd1RoZW1lOiBhdXRoSW5mby5mbG93VGhlbWUgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuZWZmZWN0ID0gcmVzdWx0LmxheWVyRWZmZWN0O1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvd0Vycm9yLmVtaXQoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyRmxvdy5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckZsb3dDc3M7XG5cbnZhciBjb2xvckJhbmRzO1xuKGZ1bmN0aW9uIChjb2xvckJhbmRzKSB7XG4gICAgY29sb3JCYW5kc1tjb2xvckJhbmRzW1wiQUxMXCJdID0gLTFdID0gXCJBTExcIjtcbiAgICBjb2xvckJhbmRzW2NvbG9yQmFuZHNbXCJSRURcIl0gPSAwXSA9IFwiUkVEXCI7XG4gICAgY29sb3JCYW5kc1tjb2xvckJhbmRzW1wiR1JFRU5cIl0gPSAxXSA9IFwiR1JFRU5cIjtcbiAgICBjb2xvckJhbmRzW2NvbG9yQmFuZHNbXCJCTFVFXCJdID0gMl0gPSBcIkJMVUVcIjtcbn0pKGNvbG9yQmFuZHMgfHwgKGNvbG9yQmFuZHMgPSB7fSkpO1xuY29uc3QgZGVmYXVsdFN0YXRpc3RpY3MgPSB7XG4gICAgbWluOiAwLFxuICAgIG1heDogNjU1MzUsXG4gICAgYXZnOiAwLFxuICAgIHN0ZGRldjogMFxufTtcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiQ3NzID0gXCI6aG9zdHt3aWR0aDoxMDAlfS5mbG93LWl0ZW17aGVpZ2h0OjEwMCV9LnJnYi1ibG9ja3tvdmVyZmxvdy14OmhpZGRlbn0ucGVyY2VudC1jbGlwLXNlY3Rpb257ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5wZXJjZW50LWNsaXAtc2VjdGlvbi1pbnB1dHt3aWR0aDo0OCU7ZGlzcGxheTpmbGV4O2ZsZXgtZmxvdzpjb2x1bW47anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmluZGl2aWR1YWwtZ2FtbWEtbGFiZWwsLnJhbmdlLWFkanVzdG1lbnQtbGFiZWx7Zm9udC13ZWlnaHQ6dmFyKC0tY2FsY2l0ZS1mb250LXdlaWdodC1tZWRpdW0pfS5pbmRpdmlkdWFsLWdhbW1hLXNlbGVjdGlvbntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmluZGl2aWR1YWwtZ2FtbWEtc2VsZWN0aW9uLXZhbHVle2Rpc3BsYXk6ZmxleDtmbGV4LWZsb3c6Y29sdW1uO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO3dpZHRoOjMwJX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclJnYkVycm9yXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmhhbmRsZURvbmUgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBrZWVwIHRoZSBjdXJyZW50IHNldHRpbmdzIG9uIHRoZSBsYXllclxuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJPYmosIG9yaWdpbmFsRWZmZWN0LCBvcmlnaW5hbEJhbmRDb21iaW5hdGlvbiwgb3JpZ2luYWxTdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBsYXllci5lZmZlY3QgPSBvcmlnaW5hbEVmZmVjdDtcbiAgICAgICAgICAgIGxheWVyLmJhbmRJZHMgPSBvcmlnaW5hbEJhbmRDb21iaW5hdGlvbjtcbiAgICAgICAgICAgIGxheWVyLnJhc3RlckluZm8uc3RhdGlzdGljcyA9IG9yaWdpbmFsU3RhdGlzdGljcztcbiAgICAgICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIob3JpZ2luYWxSZW5kZXJlck9iaiwgbGF5ZXIpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3MgfSA9IGxheWVyLnJhc3RlckluZm87XG4gICAgICAgIGlmICghbGF5ZXIuYmFuZElkcykge1xuICAgICAgICAgICAgbGF5ZXIuYmFuZElkcyA9IGF3YWl0IHNldERlZmF1bHRSR0JCYW5kcyhsYXllcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlciwgZWZmZWN0LCBhbmQgYmFuZCBjb21iaW5hdGlvblxuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJPYmogPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLnJlbmRlcmVyKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEVmZmVjdCA9IGxheWVyLmVmZmVjdDtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEJhbmRDb21iaW5hdGlvbiA9IGxheWVyLmJhbmRJZHM7XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgc3RhdGlzdGljc1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGlzdGljcyA9IChfYSA9IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUoc3RhdGlzdGljcykpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGF0aXN0aWNzID0gKF9iID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShzdGF0aXN0aWNzKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgIC8vIGhhbmRsZXMgd2hlbiBubyByZW5kZXJlciBzdGF0aXN0aWNzIGFyZSBpbml0aWFsaXplZCBvbiBsb2FkXG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGlmICghaXNEZWZpbmVkKHN0YXRpc3RpY3MpICYmICFpc0RlZmluZWQocmVuZGVyZXIuc3RhdGlzdGljc1swXSkpIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLnN0YXRpc3RpY3MgPSBuZXcgQXJyYXkoMykuZmlsbChkZWZhdWx0U3RhdGlzdGljcyk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0aXN0aWNzID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShyZW5kZXJlci5zdGF0aXN0aWNzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZW5kZXJlci5zdGF0aXN0aWNzKSAmJlxuICAgICAgICAgICAgIXJlbmRlcmVyLnN0YXRpc3RpY3MubGVuZ3RoICYmXG4gICAgICAgICAgICAhcmVuZGVyZXIuZHluYW1pY1JhbmdlQWRqdXN0bWVudCkge1xuICAgICAgICAgICAgcmVuZGVyZXIuc3RhdGlzdGljcyA9IGxheWVyLmJhbmRJZHMubWFwKChiYW5kSWQpID0+IHRoaXMub3JpZ2luYWxTdGF0aXN0aWNzW2JhbmRJZF0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uID0gbGF5ZXIuYmFuZElkc1swXTtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbmRpdmlkdWFsR2FtbWEgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wZXJjZW50TGFiZWxGbGlwID0gZ2V0UGVyY2VudExhYmVsRmxpcCh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgLy8gaWYgc3RhdGlzdGljcyBhcmUgZGlzcGxheWVkIG9uIGxvYWQsIHdlIGFsd2F5cyBkaXNwbGF5IHN0YXRpc3RpY3MgZm9yIHRoZSByZWQgYmFuZFxuICAgICAgICBpZiAoIXJlbmRlcmVyLmR5bmFtaWNSYW5nZUFkanVzdG1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGlzdGljc0Rpc3BsYXkocmVuZGVyZXIuc3RhdGlzdGljc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGhpZGVMYXllclRpdGxlLCBsYXllciwgc3RyaW5ncywgaXNSVEwgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnJnYi5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiAhaGlkZUxheWVyVGl0bGUgPyB0aXRsZSA6IHVuZGVmaW5lZCwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyUmdiQmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwicmdiLWJsb2NrXCIsIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnJnYi5yZ2IsIG9wZW46IHRydWUgfSwgdGhpcy5yZW5kZXJSZ2JCYW5kU2VsZWN0b3JzKCksIHRoaXMucmVuZGVyU3RyZXRjaFR5cGVTZWxlY3RvcigpLCB0aGlzLnJlbmRlclN0YW5kYXJkRGV2aWF0aW9uU2VjdGlvbigpLCB0aGlzLnJlbmRlclBlcmNlbnRDbGlwU2VjdGlvbigpLCB0aGlzLnJlbmRlckdhbW1hQmxvY2soKSwgdGhpcy5yZW5kZXJJbmRpdmlkdWFsR2FtbWFUb2dnbGUoKSwgdGhpcy5yZW5kZXJSYW5nZUFkanVzdG1lbnRUb2dnbGUoKSwgdGhpcy5yZW5kZXJTdGF0aXN0aWNzKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyUmdiQmFuZFNlbGVjdG9ycygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgeyByYXN0ZXJJbmZvIH0gPSBsYXllcjtcbiAgICAgICAgY29uc3QgeyBiYW5kSW5mb3MgfSA9IHJhc3RlckluZm87XG4gICAgICAgIGNvbnN0IGJhbmROYW1lcyA9IGJhbmRJbmZvcy5tYXAoKGJhbmRJbmZvKSA9PiBiYW5kSW5mby5uYW1lKTtcbiAgICAgICAgY29uc3QgeyByZWQsIGdyZWVuLCBibHVlIH0gPSBzdHJpbmdzLnBhbmVscy5yZ2I7XG4gICAgICAgIGNvbnN0IGNvbG9yQmFuZHMgPSBbcmVkLCBncmVlbiwgYmx1ZV07XG4gICAgICAgIGNvbnN0IGJhbmRTZWxlY3RvcnMgPSBjb2xvckJhbmRzLm1hcCgoY29sb3IsIGNvbG9ySWR4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGNvbG9yLCBoKFwiY2FsY2l0ZS1jb21ib2JveFwiLCB7IGxhYmVsOiBjb2xvciwgY2xlYXJEaXNhYmxlZDogdHJ1ZSwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGUtcGVyc2lzdFwiLCBvbkNhbGNpdGVDb21ib2JveENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBsYXllci5iYW5kSWRzIHdpdGggbmV3IGJhbmQncyBpbmRleFxuICAgICAgICAgICAgICAgICAgICBsYXllci5iYW5kSWRzW2NvbG9ySWR4XSA9IGJhbmROYW1lcy5pbmRleE9mKG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdCYW5kTmFtZUlkID0gbGF5ZXIuYmFuZElkc1tjb2xvcklkeF07XG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgY3VycmVudCByZW5kZXJlciBzdGF0aXN0aWNzLCByZXBsYWNlIHRoZSBhcHByb3ByaWF0ZSBiYW5kIHdpdGggdGhlIG5ldyBiYW5kJ3MgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnN0YXRpc3RpY3NbY29sb3JJZHhdID0gdGhpcy5jdXJyZW50U3RhdGlzdGljc1tuZXdCYW5kTmFtZUlkXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBzdGF0aXN0aWNzIHRhYmxlIG9ubHkgaWYgdGhlIGNoZWNrZWQgc2VnbWVudGVkIGNvbnRyb2wgaXRlbSBtYXRjaGVzIHRoZSBiYW5kIGNvbG9yIHdob3NlIHN0YXRpc3RpY3Mgd2VyZSBhY3R1YWxseSBzd2l0Y2hlZFxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0aXN0aWNzQ29udHJvbE5vZGUgJiYgY29sb3IgPT09IHRoaXMuc3RhdGlzdGljc0NvbnRyb2xOb2RlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyU3RhdGlzdGljc1NlbGVjdGlvbiA9IG5ld0JhbmROYW1lSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRpc3RpY3NEaXNwbGF5KHJlbmRlcmVyLnN0YXRpc3RpY3NbY29sb3JJZHhdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIH0gfSwgYmFuZE5hbWVzLm1hcCgoYmFuZE5hbWUsIGlkeCkgPT4gdGhpcy5yZW5kZXJCYW5kT3B0aW9ucyhiYW5kTmFtZSwgaWR4LCBjb2xvcklkeCkpKSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGgoRnJhZ21lbnQsIG51bGwsIGJhbmRTZWxlY3RvcnMpO1xuICAgIH1cbiAgICByZW5kZXJCYW5kT3B0aW9ucyhiYW5kTmFtZSwgaWR4LCBjb2xvcklkeCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCBiYW5kTmFtZUlkeCA9IGxheWVyLmJhbmRJZHNbY29sb3JJZHhdO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNvbWJvYm94LWl0ZW1cIiwgeyB0ZXh0TGFiZWw6IGJhbmROYW1lLCB2YWx1ZTogYmFuZE5hbWUsIHNlbGVjdGVkOiBiYW5kTmFtZUlkeCA9PT0gaWR4IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU3RyZXRjaFR5cGVTZWxlY3RvcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3RyZXRjaC10eXBlLWJ1dHRvblwiLCB7IG9uQXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25CZWZvcmVPcGVuOiAoKSA9PiBjbG9zZVBvcG92ZXJzKCksIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25DaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFdyYXBwZXIoY3JlYXRlUmdiUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBzdHJldGNoVHlwZTogZXZlbnQuZGV0YWlsIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kZXRhaWwgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZXIuZHluYW1pY1JhbmdlQWRqdXN0bWVudCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uID0gbGF5ZXIuYmFuZElkc1swXTtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlSYXN0ZXJSZW5kZXJlcihyZXN1bHQucmVuZGVyZXIsIGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKG5vZGUpO1xuICAgICAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2JFcnJvci5lbWl0KGVycm9yKSk7XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU3RhbmRhcmREZXZpYXRpb25TZWN0aW9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCB7IHN0cmV0Y2hUeXBlID0gcmdiRGVmYXVsdHMuU1RSRVRDSF9UWVBFIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgY29uc3QgaXNTdHJldGNoVHlwZVN0YW5kYXJkRGV2aWF0aW9uID0gc3RyZXRjaFR5cGUgPT09IHJnYlR5cGVNYXAuU1RBTkRBUkRfREVWSUFUSU9OO1xuICAgICAgICBpZiAoIWlzU3RyZXRjaFR5cGVTdGFuZGFyZERldmlhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHsgbnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnMgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBpZiAoIWlzRGVmaW5lZChudW1iZXJPZlN0YW5kYXJkRGV2aWF0aW9ucykgfHwgbnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnMgPT09IDApIHtcbiAgICAgICAgICAgIG51bWJlck9mU3RhbmRhcmREZXZpYXRpb25zID0gcmdiRGVmYXVsdHMuU1REX0RFVjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnJnYi5zdGRkZXYsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5yZ2Iuc3RkZGV2LCBzY2FsZTogXCJzXCIsIHRhYmluZGV4OiBcIjBcIiwgbWluOiAxLCBtYXg6IDEwMCwgc3RlcDogMC4xLCB2YWx1ZTogYCR7bnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnN9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGRkZXYgPSBwYXJzZUZsb2F0KG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChub2RlLnZhbHVlICYmIG5ld1N0ZGRldiA+PSBub2RlLm1pbiAmJiBuZXdTdGRkZXYgPD0gbm9kZS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgXCJzdGRkZXZcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlUGVyY2VudE9yU3RkZGV2Q2hhbmdlKG5vZGUsIFwic3RkZGV2XCIpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlclBlcmNlbnRDbGlwU2VjdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHJnYkRlZmF1bHRzLlNUUkVUQ0hfVFlQRSB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGNvbnN0IGlzU3RyZXRjaFR5cGVQZXJjZW50Q2xpcCA9IHN0cmV0Y2hUeXBlID09PSByZ2JUeXBlTWFwLlBFUkNFTlRfQ0xJUDtcbiAgICAgICAgaWYgKCFpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCB7IG1pblBlcmNlbnQsIG1heFBlcmNlbnQgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBpZiAoIWlzRGVmaW5lZChtaW5QZXJjZW50KSB8fCBtaW5QZXJjZW50IDw9IDAgfHwgbWluUGVyY2VudCA+PSAxMDApIHtcbiAgICAgICAgICAgIG1pblBlcmNlbnQgPSByZ2JEZWZhdWx0cy5NSU5fUEVSQ0VOVDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzRGVmaW5lZChtYXhQZXJjZW50KSB8fCBtYXhQZXJjZW50IDw9IDAgfHwgbWF4UGVyY2VudCA+PSAxMDApIHtcbiAgICAgICAgICAgIG1heFBlcmNlbnQgPSByZ2JEZWZhdWx0cy5NQVhfUEVSQ0VOVDtcbiAgICAgICAgfVxuICAgICAgICBtaW5QZXJjZW50ID0gcGFyc2VGbG9hdChtaW5QZXJjZW50LnRvRml4ZWQoMSkpO1xuICAgICAgICBtYXhQZXJjZW50ID0gcGFyc2VGbG9hdChtYXhQZXJjZW50LnRvRml4ZWQoMSkpO1xuICAgICAgICByZW5kZXJlci5taW5QZXJjZW50ID0gbWluUGVyY2VudDtcbiAgICAgICAgcmVuZGVyZXIubWF4UGVyY2VudCA9IG1heFBlcmNlbnQ7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInBlcmNlbnQtY2xpcC1zZWN0aW9uXCIgfSwgdGhpcy5yZW5kZXJQZXJjZW50Q2xpcFNlY3Rpb25JbnB1dChcIm1pblwiLCBtaW5QZXJjZW50KSwgdGhpcy5yZW5kZXJQZXJjZW50Q2xpcFNlY3Rpb25JbnB1dChcIm1heFwiLCBtYXhQZXJjZW50KSkpO1xuICAgIH1cbiAgICByZW5kZXJQZXJjZW50Q2xpcFNlY3Rpb25JbnB1dChzZWxlY3Rpb24sIHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgcGVyY2VudExhYmVsRmxpcCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicGVyY2VudC1jbGlwLXNlY3Rpb24taW5wdXRcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5yZ2Jbc2VsZWN0aW9uXSwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnJnYltzZWxlY3Rpb25dLCBzY2FsZTogXCJzXCIsIG1pbjogMC4xLCBtYXg6IDk5LjksIHN0ZXA6IDAuMSwgcHJlZml4VGV4dDogcGVyY2VudExhYmVsRmxpcCA/IFwiJVwiIDogdW5kZWZpbmVkLCBzdWZmaXhUZXh0OiAhcGVyY2VudExhYmVsRmxpcCA/IFwiJVwiIDogdW5kZWZpbmVkLCB2YWx1ZTogYCR7dmFsdWV9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQZXJjZW50ID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS52YWx1ZSAmJiBuZXdQZXJjZW50ID49IG5vZGUubWluICYmIG5ld1BlcmNlbnQgPD0gbm9kZS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgc2VsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgc2VsZWN0aW9uKSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVySW5kaXZpZHVhbEdhbW1hVG9nZ2xlKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIsIGNsYXNzOiBcImluZGl2aWR1YWwtZ2FtbWEtbGFiZWxcIiB9LCBzdHJpbmdzLnBhbmVscy5yZ2IuaW5kaXZpZHVhbEdhbW1hLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IHRoaXMuY2hhbmdlSW5kaXZpZHVhbEdhbW1hLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUluZGl2aWR1YWxHYW1tYSA9ICF0aGlzLmNoYW5nZUluZGl2aWR1YWxHYW1tYTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyR2FtbWFCbG9jaygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBnYW1tYSA9IHJnYkRlZmF1bHRzLkdBTU1BIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJHYW1tYSA9IEFycmF5LmlzQXJyYXkocmVuZGVyZXIuZ2FtbWEpID8gcmVuZGVyZXIuZ2FtbWFbMF0gOiByZW5kZXJlci5nYW1tYTtcbiAgICAgICAgY29uc3QgcmVkR2FtbWEgPSBnYW1tYVtjb2xvckJhbmRzLlJFRF0gfHwgcmVuZGVyZXJHYW1tYTtcbiAgICAgICAgY29uc3QgZ3JlZW5HYW1tYSA9IGdhbW1hW2NvbG9yQmFuZHMuR1JFRU5dIHx8IHJlbmRlcmVyR2FtbWE7XG4gICAgICAgIGNvbnN0IGJsdWVHYW1tYSA9IGdhbW1hW2NvbG9yQmFuZHMuQkxVRV0gfHwgcmVuZGVyZXJHYW1tYTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5yZ2IuZ2FtbWEsIHRoaXMuY2hhbmdlSW5kaXZpZHVhbEdhbW1hID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmRpdmlkdWFsLWdhbW1hLXNlbGVjdGlvblwiIH0sIHRoaXMucmVuZGVySW5kaXZpZHVhbEdhbW1hKHJlZEdhbW1hLCBcInJlZFwiKSwgdGhpcy5yZW5kZXJJbmRpdmlkdWFsR2FtbWEoZ3JlZW5HYW1tYSwgXCJncmVlblwiKSwgdGhpcy5yZW5kZXJJbmRpdmlkdWFsR2FtbWEoYmx1ZUdhbW1hLCBcImJsdWVcIikpKSA6IChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZ2FtbWEtc2xpZGVyXCIsIHsgZ2FtbWE6IEFycmF5LmlzQXJyYXkoZ2FtbWEpID8gZ2FtbWFbMF0gOiBnYW1tYSwgcmVuZGVyZXJUeXBlOiBcInJhc3Rlci1yZ2JcIiB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVySW5kaXZpZHVhbEdhbW1hKGluZGl2aWR1YWxHYW1tYVZhbHVlLCBzZWxlY3Rpb24pIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW5kaXZpZHVhbC1nYW1tYS1zZWxlY3Rpb24tdmFsdWVcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5yZ2Jbc2VsZWN0aW9uXSwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnJnYltzZWxlY3Rpb25dLCBudW1iZXJCdXR0b25UeXBlOiBcIm5vbmVcIiwgdGFiaW5kZXg6IFwiMFwiLCBzY2FsZTogXCJzXCIsIHZhbHVlOiBgJHtpbmRpdmlkdWFsR2FtbWFWYWx1ZX1gLCBtaW46IDAuMSwgbWF4OiAxMCwgc3RlcDogMC4xLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0dhbW1hID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS52YWx1ZSAmJiBuZXdHYW1tYSA+PSBub2RlLm1pbiAmJiBuZXdHYW1tYSA8PSBub2RlLm1heCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUluZGl2aWR1YWxHYW1tYUNoYW5nZShub2RlLCBzZWxlY3Rpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZUluZGl2aWR1YWxHYW1tYUNoYW5nZShub2RlLCBzZWxlY3Rpb24pLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJSYW5nZUFkanVzdG1lbnRUb2dnbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgZHluYW1pY1JhbmdlQWRqdXN0bWVudCB9ID0gcmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc3RyZXRjaFR5cGUgPSByZ2JEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlTm9uZSA9IHN0cmV0Y2hUeXBlID09PSByZ2JUeXBlTWFwLk5PTkU7XG4gICAgICAgIGlmIChpc1N0cmV0Y2hUeXBlTm9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiLCBjbGFzczogXCJyYW5nZS1hZGp1c3RtZW50LWxhYmVsXCIgfSwgc3RyaW5ncy5wYW5lbHMucmdiLmR5bmFtaWNSYW5nZUFkanVzdG1lbnQsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogZHluYW1pY1JhbmdlQWRqdXN0bWVudCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzVG9nZ2xlZCA9IG5vZGUuY2hlY2tlZDtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURSQVRvZ2dsZShpc1RvZ2dsZWQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJTdGF0aXN0aWNzKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCB7IHN0cmV0Y2hUeXBlID0gcmdiRGVmYXVsdHMuU1RSRVRDSF9UWVBFIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgY29uc3QgaXNTdHJldGNoVHlwZVBlcmNlbnRDbGlwID0gc3RyZXRjaFR5cGUgPT09IHJnYlR5cGVNYXAuUEVSQ0VOVF9DTElQO1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlTm9uZSA9IHN0cmV0Y2hUeXBlID09PSByZ2JUeXBlTWFwLk5PTkU7XG4gICAgICAgIGNvbnN0IHsgZHluYW1pY1JhbmdlQWRqdXN0bWVudCB9ID0gcmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHNob3dTdGF0c1RhYmxlID0gIWR5bmFtaWNSYW5nZUFkanVzdG1lbnQgJiYgIShpc1N0cmV0Y2hUeXBlTm9uZSB8fCBpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXApO1xuICAgICAgICBpZiAoIXNob3dTdGF0c1RhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnJnYi5zdGF0aXN0aWNzLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbFwiLCB7IHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiZnVsbFwiLCBvbkNhbGNpdGVTZWdtZW50ZWRDb250cm9sQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBub2RlLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCYW5kSWQgPSB2YWx1ZSA9PT0gc3RyaW5ncy5wYW5lbHMucmdiLnJlZFxuICAgICAgICAgICAgICAgICAgICA/IGxheWVyLmJhbmRJZHNbMF1cbiAgICAgICAgICAgICAgICAgICAgOiB2YWx1ZSA9PT0gc3RyaW5ncy5wYW5lbHMucmdiLmdyZWVuXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGxheWVyLmJhbmRJZHNbMV1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogbGF5ZXIuYmFuZElkc1syXTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0aXN0aWNzVG9EaXNwbGF5ID0gdmFsdWUgPT09IHN0cmluZ3MucGFuZWxzLnJnYi5yZWRcbiAgICAgICAgICAgICAgICAgICAgPyByZW5kZXJlci5zdGF0aXN0aWNzWzBdXG4gICAgICAgICAgICAgICAgICAgIDogdmFsdWUgPT09IHN0cmluZ3MucGFuZWxzLnJnYi5ncmVlblxuICAgICAgICAgICAgICAgICAgICAgICAgPyByZW5kZXJlci5zdGF0aXN0aWNzWzFdXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHJlbmRlcmVyLnN0YXRpc3RpY3NbMl07XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlclN0YXRpc3RpY3NTZWxlY3Rpb24gPSBjdXJyZW50QmFuZElkO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGlzdGljc0Rpc3BsYXkoc3RhdGlzdGljc1RvRGlzcGxheSk7XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5zdGF0aXN0aWNzQ29udHJvbE5vZGUgPSBub2RlKSB9LCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbC1pdGVtXCIsIHsgdmFsdWU6IHN0cmluZ3MucGFuZWxzLnJnYi5yZWQsIGNoZWNrZWQ6IHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uID09PSBsYXllci5iYW5kSWRzWzBdIH0sIHN0cmluZ3MucGFuZWxzLnJnYi5yZWQpLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbC1pdGVtXCIsIHsgdmFsdWU6IHN0cmluZ3MucGFuZWxzLnJnYi5ncmVlbiwgY2hlY2tlZDogdGhpcy5yZW5kZXJlclN0YXRpc3RpY3NTZWxlY3Rpb24gPT09IGxheWVyLmJhbmRJZHNbMV0gJiZcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyU3RhdGlzdGljc1NlbGVjdGlvbiAhPT0gbGF5ZXIuYmFuZElkc1swXSB9LCBzdHJpbmdzLnBhbmVscy5yZ2IuZ3JlZW4pLCBoKFwiY2FsY2l0ZS1zZWdtZW50ZWQtY29udHJvbC1pdGVtXCIsIHsgdmFsdWU6IHN0cmluZ3MucGFuZWxzLnJnYi5ibHVlLCBjaGVja2VkOiB0aGlzLnJlbmRlcmVyU3RhdGlzdGljc1NlbGVjdGlvbiA9PT0gbGF5ZXIuYmFuZElkc1syXSAmJlxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uICE9PSBsYXllci5iYW5kSWRzWzBdICYmXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlclN0YXRpc3RpY3NTZWxlY3Rpb24gIT09IGxheWVyLmJhbmRJZHNbMV0gfSwgc3RyaW5ncy5wYW5lbHMucmdiLmJsdWUpKSksIHRoaXMucmVuZGVyU3RhdGlzdGljc0Rpc3BsYXkoKSkpO1xuICAgIH1cbiAgICByZW5kZXJTdGF0aXN0aWNzRGlzcGxheSgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBvcmlnaW5hbFN0YXRpc3RpY3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc3RyZXRjaFR5cGUgPSByZ2JEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXAgPSBzdHJldGNoVHlwZSA9PT0gcmdiVHlwZU1hcC5QRVJDRU5UX0NMSVA7XG4gICAgICAgIGNvbnN0IGlzU3RyZXRjaFR5cGVTdGFuZGFyZERldmlhdGlvbiA9IHN0cmV0Y2hUeXBlID09PSByZ2JUeXBlTWFwLlNUQU5EQVJEX0RFVklBVElPTjtcbiAgICAgICAgY29uc3QgaGFzU3RhdGlzdGljcyA9IGxheWVyLnJhc3RlckluZm8uc3RhdGlzdGljcyAhPT0gbnVsbDtcbiAgICAgICAgbGV0IHsgc3RhdGlzdGljcyB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGlmICghc3RhdGlzdGljcyB8fCAoQXJyYXkuaXNBcnJheShzdGF0aXN0aWNzKSAmJiBzdGF0aXN0aWNzLmxlbmd0aCA8IDEpKSB7XG4gICAgICAgICAgICBzdGF0aXN0aWNzID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShvcmlnaW5hbFN0YXRpc3RpY3MpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluaXRpYWxCYW5kU2VsZWN0aW9uID0gKF9hID0gdGhpcy5yZW5kZXJlclN0YXRpc3RpY3NTZWxlY3Rpb24pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDA7XG4gICAgICAgIGNvbnN0IGRpc2FibGVNZWFuQW5kU3RkRGV2ID0gKCFoYXNTdGF0aXN0aWNzIHx8IGlzU3RyZXRjaFR5cGVQZXJjZW50Q2xpcCkgJiYgIWlzU3RyZXRjaFR5cGVTdGFuZGFyZERldmlhdGlvbjtcbiAgICAgICAgY29uc3QgeyBtaW4gPSAwLCBtYXggPSAyNTUsIGF2ZzogbWVhbiA9IDAsIHN0ZGRldiA9IDAgfSA9ICgoX2IgPSB0aGlzLmN1cnJlbnRTdGF0aXN0aWNzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbaW5pdGlhbEJhbmRTZWxlY3Rpb24gIT09IG51bGwgJiYgaW5pdGlhbEJhbmRTZWxlY3Rpb24gIT09IHZvaWQgMCA/IGluaXRpYWxCYW5kU2VsZWN0aW9uIDogMF0pIHx8IHt9O1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnJnYi5taW4sIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5yZ2IubWluLCBzY2FsZTogXCJzXCIsIHN0ZXA6IDAuMSwgbnVtYmVyQnV0dG9uVHlwZTogXCJub25lXCIsIHZhbHVlOiBgJHtpc0RlZmluZWQobWluKSA/IHRoaXMucm91bmQobWluKSA6IFwiXCJ9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5taW5Ob2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmFuZFNlbGVjdGlvbiA9IChfYSA9IHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlIDw9IHRoaXMuY3VycmVudFN0YXRpc3RpY3NbY3VycmVudEJhbmRTZWxlY3Rpb25dW1wibWF4XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWluTm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGlzdGljc0NoYW5nZSh2YWx1ZSwgY3VycmVudEJhbmRTZWxlY3Rpb24sIFwibWluXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TWluID0gdGhpcy5jdXJyZW50U3RhdGlzdGljc1tjdXJyZW50QmFuZFNlbGVjdGlvbl1bXCJtaW5cIl07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbk5vZGUudmFsdWUgPSBgJHt0aGlzLnJvdW5kKGN1cnJlbnRNaW4pfWA7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDMwMCksIHJlZjogKG5vZGUpID0+ICh0aGlzLm1pbk5vZGUgPSBub2RlKSB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnJnYi5tYXgsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5yZ2IubWF4LCBzY2FsZTogXCJzXCIsIHN0ZXA6IDAuMSwgbnVtYmVyQnV0dG9uVHlwZTogXCJub25lXCIsIHZhbHVlOiBgJHtpc0RlZmluZWQobWF4KSA/IHRoaXMucm91bmQobWF4KSA6IFwiXCJ9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5tYXhOb2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmFuZFNlbGVjdGlvbiA9IChfYSA9IHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlID49IHRoaXMuY3VycmVudFN0YXRpc3RpY3NbY3VycmVudEJhbmRTZWxlY3Rpb25dW1wibWluXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWF4Tm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGlzdGljc0NoYW5nZSh2YWx1ZSwgY3VycmVudEJhbmRTZWxlY3Rpb24sIFwibWF4XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TWF4ID0gdGhpcy5jdXJyZW50U3RhdGlzdGljc1tjdXJyZW50QmFuZFNlbGVjdGlvbl1bXCJtYXhcIl07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1heE5vZGUudmFsdWUgPSBgJHt0aGlzLnJvdW5kKGN1cnJlbnRNYXgpfWA7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDMwMCksIHJlZjogKG5vZGUpID0+ICh0aGlzLm1heE5vZGUgPSBub2RlKSB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnJnYi5tZWFuLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5wYW5lbHMucmdiLm1lYW4sIHNjYWxlOiBcInNcIiwgc3RlcDogMC4xLCBkaXNhYmxlZDogZGlzYWJsZU1lYW5BbmRTdGREZXYsIG51bWJlckJ1dHRvblR5cGU6IFwibm9uZVwiLCB2YWx1ZTogYCR7aXNEZWZpbmVkKG1lYW4pID8gdGhpcy5yb3VuZChtZWFuKSA6IFwiXCJ9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5hdmdOb2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmFuZFNlbGVjdGlvbiA9IChfYSA9IHRoaXMucmVuZGVyZXJTdGF0aXN0aWNzU2VsZWN0aW9uKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXZnTm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGlzdGljc0NoYW5nZSh2YWx1ZSwgY3VycmVudEJhbmRTZWxlY3Rpb24sIFwiYXZnXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TWVhbiA9IHRoaXMuY3VycmVudFN0YXRpc3RpY3NbY3VycmVudEJhbmRTZWxlY3Rpb25dW1wiYXZnXCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdmdOb2RlLnZhbHVlID0gYCR7dGhpcy5yb3VuZChjdXJyZW50TWVhbil9YDtcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYXZnTm9kZSA9IG5vZGUpIH0pKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMucmdiLnN0ZGRldiwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnJnYi5zdGRkZXYsIHNjYWxlOiBcInNcIiwgc3RlcDogMC4xLCBkaXNhYmxlZDogZGlzYWJsZU1lYW5BbmRTdGREZXYsIG51bWJlckJ1dHRvblR5cGU6IFwibm9uZVwiLCB2YWx1ZTogYCR7aXNEZWZpbmVkKHN0ZGRldikgPyB0aGlzLnJvdW5kKHN0ZGRldikgOiBcIlwifWAsIG9uQ2FsY2l0ZUlucHV0TnVtYmVySW5wdXQ6IGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuc3RkZGV2Tm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJhbmRTZWxlY3Rpb24gPSAoX2EgPSB0aGlzLnJlbmRlcmVyU3RhdGlzdGljc1NlbGVjdGlvbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0ZGRldk5vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVN0YXRpc3RpY3NDaGFuZ2UodmFsdWUsIGN1cnJlbnRCYW5kU2VsZWN0aW9uLCBcInN0ZGRldlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN0ZGRldiA9IHRoaXMuY3VycmVudFN0YXRpc3RpY3NbY3VycmVudEJhbmRTZWxlY3Rpb25dW1wic3RkZGV2XCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGRkZXZOb2RlLnZhbHVlID0gYCR7dGhpcy5yb3VuZChjdXJyZW50U3RkZGV2KX1gO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAzMDApLCByZWY6IChub2RlKSA9PiAodGhpcy5zdGRkZXZOb2RlID0gbm9kZSkgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogdGhpcy5oYW5kbGVEb25lLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICBoYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgY2hhbmdpbmcpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgbGV0IHZhbHVlID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA8IG5vZGUubWluKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IG5vZGUubWluO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlID4gbm9kZS5tYXgpIHtcbiAgICAgICAgICAgIHZhbHVlID0gbm9kZS5tYXg7XG4gICAgICAgIH1cbiAgICAgICAgdmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlLnRvRml4ZWQoMSkpO1xuICAgICAgICBub2RlLnZhbHVlID0gYCR7dmFsdWV9YDtcbiAgICAgICAgY2hhbmdpbmcgPT09IFwibWluXCJcbiAgICAgICAgICAgID8gKHJlbmRlcmVyLm1pblBlcmNlbnQgPSB2YWx1ZSlcbiAgICAgICAgICAgIDogY2hhbmdpbmcgPT09IFwibWF4XCJcbiAgICAgICAgICAgICAgICA/IChyZW5kZXJlci5tYXhQZXJjZW50ID0gdmFsdWUpXG4gICAgICAgICAgICAgICAgOiAocmVuZGVyZXIubnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnMgPSB2YWx1ZSk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZUluZGl2aWR1YWxHYW1tYUNoYW5nZShub2RlLCBjaGFuZ2luZykge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBsZXQgdmFsdWUgPSBwYXJzZUZsb2F0KG5vZGUudmFsdWUpO1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpIHx8IHZhbHVlIDwgbm9kZS5taW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gbm9kZS5taW47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsdWUgPiBub2RlLm1heCkge1xuICAgICAgICAgICAgdmFsdWUgPSBub2RlLm1heDtcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUudG9GaXhlZCgxKSk7XG4gICAgICAgIG5vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICBjaGFuZ2luZyA9PT0gXCJyZWRcIlxuICAgICAgICAgICAgPyAocmVuZGVyZXIuZ2FtbWFbY29sb3JCYW5kcy5SRURdID0gdmFsdWUpXG4gICAgICAgICAgICA6IGNoYW5naW5nID09PSBcImdyZWVuXCJcbiAgICAgICAgICAgICAgICA/IChyZW5kZXJlci5nYW1tYVtjb2xvckJhbmRzLkdSRUVOXSA9IHZhbHVlKVxuICAgICAgICAgICAgICAgIDogKHJlbmRlcmVyLmdhbW1hW2NvbG9yQmFuZHMuQkxVRV0gPSB2YWx1ZSk7XG4gICAgICAgIHJlbmRlcmVyLnVzZUdhbW1hID0gdHJ1ZTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgaGFuZGxlRFJBVG9nZ2xlKGFwcGx5RFJBKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHJlbmRlcmVyLmR5bmFtaWNSYW5nZUFkanVzdG1lbnQgPSBhcHBseURSQTtcbiAgICAgICAgaWYgKGFwcGx5RFJBKSB7XG4gICAgICAgICAgICByZW5kZXJlci5zdGF0aXN0aWNzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkUmVuZGVyZXJTdGF0aXN0aWNzID0gbGF5ZXIuYmFuZElkcy5tYXAoKGJhbmRJZCkgPT4gdGhpcy5jdXJyZW50U3RhdGlzdGljc1tiYW5kSWRdKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnN0YXRpc3RpY3MgPSB1cGRhdGVkUmVuZGVyZXJTdGF0aXN0aWNzO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZVN0YXRpc3RpY3NDaGFuZ2UodmFsdWUsIHN0YXRpc3RpY0lEVG9VcGRhdGUsIHR5cGUpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGlzdGljc1tzdGF0aXN0aWNJRFRvVXBkYXRlXVt0eXBlXSA9IHZhbHVlO1xuICAgICAgICBjb25zdCByZW5kZXJlckJhbmRzVG9VcGRhdGUgPSBbXTtcbiAgICAgICAgbGF5ZXIuYmFuZElkcy5mb3JFYWNoKChiYW5kSWQsIGlkeCkgPT4ge1xuICAgICAgICAgICAgaWYgKGJhbmRJZCA9PT0gc3RhdGlzdGljSURUb1VwZGF0ZSkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyQmFuZHNUb1VwZGF0ZS5wdXNoKGlkeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZW5kZXJlckJhbmRzVG9VcGRhdGUuZm9yRWFjaCgocmVuZGVyZXJCYW5kVG9VZHBhdGUpID0+IChyZW5kZXJlci5zdGF0aXN0aWNzW3JlbmRlcmVyQmFuZFRvVWRwYXRlXSA9IHRoaXMuY3VycmVudFN0YXRpc3RpY3Nbc3RhdGlzdGljSURUb1VwZGF0ZV0pKTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgdXBkYXRlU3RhdGlzdGljc0Rpc3BsYXkoc2VsZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IHsgbWluLCBtYXgsIGF2Zywgc3RkZGV2IH0gPSBzZWxlY3Rpb247XG4gICAgICAgIHRoaXMubWluTm9kZS52YWx1ZSA9IGAke2lzRGVmaW5lZChtaW4pID8gdGhpcy5yb3VuZChtaW4pIDogXCJcIn1gO1xuICAgICAgICB0aGlzLm1heE5vZGUudmFsdWUgPSBgJHtpc0RlZmluZWQobWF4KSA/IHRoaXMucm91bmQobWF4KSA6IFwiXCJ9YDtcbiAgICAgICAgdGhpcy5hdmdOb2RlLnZhbHVlID0gYCR7aXNEZWZpbmVkKGF2ZykgPyB0aGlzLnJvdW5kKGF2ZykgOiBcIlwifWA7XG4gICAgICAgIHRoaXMuc3RkZGV2Tm9kZS52YWx1ZSA9IGAke2lzRGVmaW5lZChzdGRkZXYpID8gdGhpcy5yb3VuZChzdGRkZXYpIDogXCJcIn1gO1xuICAgIH1cbiAgICByb3VuZCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh2YWx1ZSAqIDEwMDApIC8gMTAwMDtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclJnYi5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclJnYkNzcztcblxuY29uc3QgaGlsbHNoYWRlVHlwZU9wdGlvbnMgPSB7XG4gICAgVFJBRElUSU9OQUw6IFwidHJhZGl0aW9uYWxcIixcbiAgICBNVUxUSURJUkVDVElPTkFMOiBcIm11bHRpLWRpcmVjdGlvbmFsXCJcbn07XG5jb25zdCBkZWZhdWx0SGlsbHNoYWRlVHlwZSA9IFwibXVsdGktZGlyZWN0aW9uYWxcIjtcbmNvbnN0IGRlZmF1bHRTY2FsaW5nVHlwZSA9IFwibm9uZVwiO1xuY29uc3Qgc2hhZGVkUmVsaWVmRGVmYXVsdHMgPSB7XG4gICAgYXppbXV0aDogMzE1LFxuICAgIGFsdGl0dWRlOiA0NSxcbiAgICBwaXhlbFNpemVQb3dlcjogMC42NjQsXG4gICAgcGl4ZWxTaXplRmFjdG9yOiAwLjAyNCxcbiAgICB6RmFjdG9yOiAxXG59O1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTaGFkZWRSZWxpZWZDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX0uc2hhZGVkLXJlbGllZi1ibG9ja3tvdmVyZmxvdy14OmhpZGRlbn1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTaGFkZWRSZWxpZWZDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmQmFja0NsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTaGFkZWRSZWxpZWZCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZkVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLmhhbmRsZXMgPSBbXTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFJlbmRlcmVyT2JqIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBhcHBseVJhc3RlclJlbmRlcmVyKG9yaWdpbmFsUmVuZGVyZXJPYmosIGxheWVyKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmQ2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51T3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5iZWZvcmVCYWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCByZW5kZXJlclxuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJPYmogPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLnJlbmRlcmVyKTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGhpZGVMYXllclRpdGxlLCBsYXllciwgc3RyaW5ncywgaXNSVEwgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnNoYWRlZFJlbGllZi5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiAhaGlkZUxheWVyVGl0bGUgPyB0aXRsZSA6IHVuZGVmaW5lZCwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZsb3ctaXRlbVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU2hhZGVkUmVsaWVmQmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwic2hhZGVkLXJlbGllZi1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5zaGFkZWRSZWxpZWYuc2hhZGVkUmVsaWVmLCBvcGVuOiB0cnVlIH0sIHRoaXMucmVuZGVySGlsbHNoYWRlVHlwZVNlbGVjdG9yKCksIHRoaXMucmVuZGVyQ29sb3JTY2hlbWUoKSwgdGhpcy5yZW5kZXJBemltdXRoU2xpZGVyKCksIHRoaXMucmVuZGVyQWx0aXR1ZGVTbGlkZXIoKSwgdGhpcy5yZW5kZXJTY2FsaW5nU2VsZWN0b3IoKSwgdGhpcy5yZW5kZXJaRmFjdG9yQW5kUGl4ZWxJbnB1dHMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJIaWxsc2hhZGVUeXBlU2VsZWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWhpbGxzaGFkZS10eXBlLWJ1dHRvblwiLCB7IG9uQXJjZ2lzU21hcnRNYXBwaW5nSGlsbHNoYWRlVHlwZUJ1dHRvbkJlZm9yZU9wZW46ICgpID0+IGNsb3NlUG9wb3ZlcnMoKSwgb25BcmNnaXNTbWFydE1hcHBpbmdIaWxsc2hhZGVUeXBlQnV0dG9uQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGhpbGxzaGFkZVR5cGUgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5oaWxsc2hhZGVUeXBlID0gaGlsbHNoYWRlVHlwZTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKG5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckNvbG9yU2NoZW1lKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCB7IGNvbG9yUmFtcCB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIC8vIG5vcm1hbGl6ZSBjb2xvclJhbXAgKGN1cnJlbnRseSBpbiBNdWx0aXBhcnQgZm9ybSlcbiAgICAgICAgY29uc3QgY29sb3JTY2hlbWUgPSBub3JtYWxpemVDb2xvclJhbXAoY29sb3JSYW1wKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5zaGFkZWRSZWxpZWYuY29sb3JTY2hlbWUsIHR5cGU6IFwicmFzdGVyLXNoYWRlZC1yZWxpZWZcIiwgcmFtcFR5cGU6IFwiY29udGludW91c1wiLCBjb2xvcnM6IGNvbG9yU2NoZW1lLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQXppbXV0aFNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBoaWxsc2hhZGVUeXBlID0gZGVmYXVsdEhpbGxzaGFkZVR5cGUsIGF6aW11dGggPSBzaGFkZWRSZWxpZWZEZWZhdWx0cy5hemltdXRoIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgY29uc3Qgc2hvd0F6aW11dGggPSBoaWxsc2hhZGVUeXBlID09PSBoaWxsc2hhZGVUeXBlT3B0aW9ucy5UUkFESVRJT05BTDtcbiAgICAgICAgaWYgKCFzaG93QXppbXV0aCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zaGFkZWRSZWxpZWYuYXppbXV0aCwgaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXJhc3Rlci1zbGlkZXJcIiwgeyByZW5kZXJlclR5cGU6IFwic2hhZGVkLXJlbGllZlwiLCBzaG93VGh1bWJMYWJlbDogdHJ1ZSwgZWRpdFRodW1iTGFiZWw6IHRydWUsIHR5cGU6IFwiYXppbXV0aFwiLCBtaW46IDAsIG1heDogMzYwLCB2YWx1ZXM6IFthemltdXRoXSwgcHJlY2lzaW9uOiAxLCBtaW5MYWJlbDogXCIwXCIsIG1heExhYmVsOiBcIjM2MFwiIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckFsdGl0dWRlU2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCB7IGhpbGxzaGFkZVR5cGUgPSBkZWZhdWx0SGlsbHNoYWRlVHlwZSwgYWx0aXR1ZGUgPSBzaGFkZWRSZWxpZWZEZWZhdWx0cy5hbHRpdHVkZSB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGNvbnN0IHNob3dBbHRpdHVkZSA9IGhpbGxzaGFkZVR5cGUgPT09IGhpbGxzaGFkZVR5cGVPcHRpb25zLlRSQURJVElPTkFMO1xuICAgICAgICBpZiAoIXNob3dBbHRpdHVkZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zaGFkZWRSZWxpZWYuYWx0aXR1ZGUsIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1yYXN0ZXItc2xpZGVyXCIsIHsgcmVuZGVyZXJUeXBlOiBcInNoYWRlZC1yZWxpZWZcIiwgc2hvd1RodW1iTGFiZWw6IHRydWUsIGVkaXRUaHVtYkxhYmVsOiB0cnVlLCB0eXBlOiBcImFsdGl0dWRlXCIsIG1pbjogMCwgbWF4OiA5MCwgdmFsdWVzOiBbYWx0aXR1ZGVdLCBwcmVjaXNpb246IDEsIG1pbkxhYmVsOiBcIjBcIiwgbWF4TGFiZWw6IFwiOTBcIiB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJTY2FsaW5nU2VsZWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc2NhbGluZ1R5cGUgPSBkZWZhdWx0U2NhbGluZ1R5cGUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBzY2FsaW5nT3B0aW9ucyA9IHN0cmluZ3MucGFuZWxzLnNoYWRlZFJlbGllZi5zY2FsaW5nT3B0aW9ucztcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zaGFkZWRSZWxpZWYuc2NhbGluZywgaChcImNhbGNpdGUtc2VnbWVudGVkLWNvbnRyb2xcIiwgeyBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DYWxjaXRlU2VnbWVudGVkQ29udHJvbENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNjYWxpbmdPcHRpb25DaGFuZ2Uobm9kZS52YWx1ZSk7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLXNlZ21lbnRlZC1jb250cm9sLWl0ZW1cIiwgeyB2YWx1ZTogXCJub25lXCIsIGNoZWNrZWQ6IHNjYWxpbmdUeXBlID09PSBcIm5vbmVcIiB9LCBzY2FsaW5nT3B0aW9ucy5ub25lKSwgaChcImNhbGNpdGUtc2VnbWVudGVkLWNvbnRyb2wtaXRlbVwiLCB7IHZhbHVlOiBcImFkanVzdGVkXCIsIGNoZWNrZWQ6IHNjYWxpbmdUeXBlID09PSBcImFkanVzdGVkXCIgfSwgc2NhbGluZ09wdGlvbnMuYWRqdXN0ZWQpKSkpO1xuICAgIH1cbiAgICByZW5kZXJaRmFjdG9yQW5kUGl4ZWxJbnB1dHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc2NhbGluZ1R5cGUgPSBkZWZhdWx0U2NhbGluZ1R5cGUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBzaG93UGl4ZWxTaXplUG93ZXJJbnB1dCA9IHNjYWxpbmdUeXBlID09PSBcImFkanVzdGVkXCI7XG4gICAgICAgIGNvbnN0IHpGYWN0b3JQaXhlbEVudHJpZXMgPSBbXCJ6RmFjdG9yXCJdO1xuICAgICAgICBpZiAoc2hvd1BpeGVsU2l6ZVBvd2VySW5wdXQpIHtcbiAgICAgICAgICAgIHpGYWN0b3JQaXhlbEVudHJpZXMucHVzaChcInBpeGVsU2l6ZVBvd2VyXCIpO1xuICAgICAgICAgICAgekZhY3RvclBpeGVsRW50cmllcy5wdXNoKFwicGl4ZWxTaXplRmFjdG9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgekZhY3RvclBpeGVsRW50cmllcy5tYXAoKHpGYWN0b3JQaXhlbEVudHJ5LCBpZHgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuc2hhZGVkUmVsaWVmW3pGYWN0b3JQaXhlbEVudHJ5XSwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnNoYWRlZFJlbGllZlt6RmFjdG9yUGl4ZWxFbnRyeV0sIHRhYmluZGV4OiBcIjBcIiwgbWluOiAwLCBzdGVwOiAwLjEsIHNjYWxlOiBcInNcIiwgdmFsdWU6IGAkeyhfYSA9IHJlbmRlcmVyW3pGYWN0b3JQaXhlbEVudHJ5XSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogc2hhZGVkUmVsaWVmRGVmYXVsdHNbekZhY3RvclBpeGVsRW50cnldfWAsIG9uQ2FsY2l0ZUlucHV0TnVtYmVySW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS52YWx1ZSA9PT0gXCJcIiB8fCBwYXJzZUZsb2F0KG5vZGUudmFsdWUpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVzW2lkeF0gPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlWkZhY3Rvck9yUGl4ZWxDaGFuZ2Uobm9kZSwgekZhY3RvclBpeGVsRW50cnkpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmhhbmRsZXNbaWR4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlWkZhY3Rvck9yUGl4ZWxDaGFuZ2Uobm9kZSwgekZhY3RvclBpeGVsRW50cnkpLCAzMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgaGFuZGxlU2NhbGluZ09wdGlvbkNoYW5nZShuZXdTY2FsaW5nVHlwZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICByZW5kZXJlci5zY2FsaW5nVHlwZSA9IG5ld1NjYWxpbmdUeXBlO1xuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICB9XG4gICAgaGFuZGxlWkZhY3Rvck9yUGl4ZWxDaGFuZ2Uobm9kZSwgcHJvcGVydHkpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgbGV0IHZhbHVlID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA8IG5vZGUubWluKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IG5vZGUubWluO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICByZW5kZXJlcltwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZi5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZkNzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU3RyZXRjaENzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS5zdHJldGNoLWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5wZXJjZW50LWNsaXAtc2VjdGlvbntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LnBlcmNlbnQtY2xpcC1zZWN0aW9uLWlucHV0e3dpZHRoOjQ4JTtkaXNwbGF5OmZsZXg7ZmxleC1mbG93OmNvbHVtbjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0ucmFuZ2UtYWRqdXN0bWVudC1sYWJlbHtmb250LXdlaWdodDp2YXIoLS1jYWxjaXRlLWZvbnQtd2VpZ2h0LW1lZGl1bSl9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2ggPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU3RyZXRjaENsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU3RyZXRjaEVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTdHJldGNoRXJyb3JcIiwgNyk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2hDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJPYmosIG9yaWdpbmFsRWZmZWN0LCBvcmlnaW5hbEJhbmRDb21iaW5hdGlvbiwgb3JpZ2luYWxTdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBsYXllci5lZmZlY3QgPSBvcmlnaW5hbEVmZmVjdDtcbiAgICAgICAgICAgIGxheWVyLmJhbmRJZHMgPSBvcmlnaW5hbEJhbmRDb21iaW5hdGlvbjtcbiAgICAgICAgICAgIGxheWVyLnJhc3RlckluZm8uc3RhdGlzdGljcyA9IG9yaWdpbmFsU3RhdGlzdGljcztcbiAgICAgICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIob3JpZ2luYWxSZW5kZXJlck9iaiwgbGF5ZXIpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTdHJldGNoQ2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51T3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5iZWZvcmVCYWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3MgfSA9IGxheWVyLnJhc3RlckluZm87XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXJcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVyT2JqID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5yZW5kZXJlcik7XG4gICAgICAgIHRoaXMub3JpZ2luYWxFZmZlY3QgPSBsYXllci5lZmZlY3Q7XG4gICAgICAgIHRoaXMub3JpZ2luYWxCYW5kQ29tYmluYXRpb24gPSBsYXllci5iYW5kSWRzO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHN0YXRpc3RpY3NcbiAgICAgICAgdGhpcy5vcmlnaW5hbFN0YXRpc3RpY3MgPSAoX2EgPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKHN0YXRpc3RpY3MpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGlzdGljcyA9IChfYiA9IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUoc3RhdGlzdGljcykpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdO1xuICAgICAgICBpZiAoKChfYyA9IGxheWVyLmJhbmRJZHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sZW5ndGgpICE9PSAxKSB7XG4gICAgICAgICAgICBsYXllci5iYW5kSWRzID0gWzBdO1xuICAgICAgICB9XG4gICAgICAgIC8vIHBvcHVsYXRlIHJlbmRlcmVyIHN0YXRpc3RpY3MgaWYgbmVjZXNzYXJ5XG4gICAgICAgIGlmICh0aGlzLmlzQW5FbXB0eUFycmF5KHJlbmRlcmVyLnN0YXRpc3RpY3MpKSB7XG4gICAgICAgICAgICByZW5kZXJlci5zdGF0aXN0aWNzID0gW3RoaXMub3JpZ2luYWxTdGF0aXN0aWNzWzBdXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBoYW5kbGVzIHdoZW4gbm8gcmVuZGVyZXIgc3RhdGlzdGljcyBhcmUgaW5pdGlhbGl6ZWQgb24gbG9hZFxuICAgICAgICBjb25zdCBiYW5kSW5kZXggPSAoX2QgPSBsYXllci5iYW5kSWRzWzBdKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBzdHJldGNoRGVmYXVsdHMuQkFORF9JTkRFWDtcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoc3RhdGlzdGljcykgJiYgIWlzRGVmaW5lZChyZW5kZXJlci5zdGF0aXN0aWNzWzBdKSkge1xuICAgICAgICAgICAgcmVuZGVyZXIuc3RhdGlzdGljc1swXSA9IHtcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgbWF4OiAyNTUsXG4gICAgICAgICAgICAgICAgYXZnOiAwLFxuICAgICAgICAgICAgICAgIHN0ZGRldjogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XSA9IHJlbmRlcmVyLnN0YXRpc3RpY3NbMF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVuZGVyZXJTdGF0cyA9IHJlbmRlcmVyLnN0YXRpc3RpY3M7XG4gICAgICAgIGlmICh0aGlzLmlzQW5FbXB0eUFycmF5KHJlbmRlcmVyU3RhdHMpICYmICFyZW5kZXJlci5keW5hbWljUmFuZ2VBZGp1c3RtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0aXN0aWNzW2JhbmRJbmRleF0gPSB7XG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIG1heDogMjU1LFxuICAgICAgICAgICAgICAgIGF2ZzogMCxcbiAgICAgICAgICAgICAgICBzdGRkZXY6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZW5kZXJlci5zdGF0aXN0aWNzID0gW3RoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0aXN0aWNzW2JhbmRJbmRleF0gPSByZW5kZXJlci5zdGF0aXN0aWNzWzBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBoaWRlTGF5ZXJUaXRsZSwgbGF5ZXIsIHN0cmluZ3MsIGlzUlRMIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBsYXllci50aXRsZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5zdHJldGNoLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IHRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTdHJldGNoQmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwic3RyZXRjaC1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5zdHJldGNoLnN0cmV0Y2gsIG9wZW46IHRydWUgfSwgdGhpcy5yZW5kZXJTdHJldGNoVHlwZVNlbGVjdG9yKCksIHRoaXMucmVuZGVyU3RhbmRhcmREZXZpYXRpb25TZWN0aW9uKCksIHRoaXMucmVuZGVyUGVyY2VudENsaXBTZWN0aW9uKCksIHRoaXMucmVuZGVyQmFuZFNlbGVjdG9yKCksIHRoaXMucmVuZGVyR2FtbWFTbGlkZXIoKSwgdGhpcy5yZW5kZXJDb2xvclNjaGVtZSgpLCB0aGlzLnJlbmRlclJhbmdlQWRqdXN0bWVudFRvZ2dsZSgpLCB0aGlzLnJlbmRlclN0YXRpc3RpY3NUYWJsZSgpKSk7XG4gICAgfVxuICAgIHJlbmRlclN0cmV0Y2hUeXBlU2VsZWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN0cmV0Y2gtdHlwZS1idXR0b25cIiwgeyBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uQmVmb3JlT3BlbjogKCkgPT4gY2xvc2VQb3BvdmVycygpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmV0Y2hUeXBlID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZVN0cmV0Y2hSZW5kZXJlckZyb21FeGlzdGluZyh7IHN0cmV0Y2hUeXBlIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFuZEluZGV4ID0gKF9hID0gbGF5ZXIuYmFuZElkc1swXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogc3RyZXRjaERlZmF1bHRzLkJBTkRfSU5ERVg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0RlZmluZWQodGhpcy5jdXJyZW50U3RhdGlzdGljcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5zdGF0aXN0aWNzID0gW3RoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmV0Y2hUeXBlID09PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmR5bmFtaWNSYW5nZUFkanVzdG1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5jb2xvclJhbXAgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5UmFzdGVyUmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyU3RyZXRjaEVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclN0YW5kYXJkRGV2aWF0aW9uU2VjdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHN0cmV0Y2hEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlU3RhbmRhcmREZXZpYXRpb24gPSBzdHJldGNoVHlwZSA9PT0gc3RyZXRjaFR5cGVNYXAuU1RBTkRBUkRfREVWSUFUSU9OO1xuICAgICAgICBpZiAoIWlzU3RyZXRjaFR5cGVTdGFuZGFyZERldmlhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHsgbnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnMgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBpZiAoIWlzRGVmaW5lZChudW1iZXJPZlN0YW5kYXJkRGV2aWF0aW9ucykgfHwgbnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnMgPT09IDApIHtcbiAgICAgICAgICAgIG51bWJlck9mU3RhbmRhcmREZXZpYXRpb25zID0gc3RyZXRjaERlZmF1bHRzLlNURF9ERVY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zdHJldGNoLnN0ZGRldiwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnN0cmV0Y2guc3RkZGV2LCBzY2FsZTogXCJzXCIsIHRhYmluZGV4OiBcIjBcIiwgbWluOiAxLCBtYXg6IDEwMCwgc3RlcDogMC4xLCB2YWx1ZTogYCR7bnVtYmVyT2ZTdGFuZGFyZERldmlhdGlvbnN9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGRkZXYgPSBwYXJzZUZsb2F0KG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChub2RlLnZhbHVlICYmIG5ld1N0ZGRldiA+PSBub2RlLm1pbiAmJiBuZXdTdGRkZXYgPD0gbm9kZS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgXCJzdGRkZXZcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlUGVyY2VudE9yU3RkZGV2Q2hhbmdlKG5vZGUsIFwic3RkZGV2XCIpLCAzMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlclBlcmNlbnRDbGlwU2VjdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHN0cmV0Y2hEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXAgPSBzdHJldGNoVHlwZSA9PT0gc3RyZXRjaFR5cGVNYXAuUEVSQ0VOVF9DTElQO1xuICAgICAgICBpZiAoIWlzU3RyZXRjaFR5cGVQZXJjZW50Q2xpcCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHsgbWluUGVyY2VudCwgbWF4UGVyY2VudCB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGlmICghaXNEZWZpbmVkKG1pblBlcmNlbnQpIHx8IG1pblBlcmNlbnQgPD0gMCB8fCBtaW5QZXJjZW50ID49IDEwMCkge1xuICAgICAgICAgICAgbWluUGVyY2VudCA9IHN0cmV0Y2hEZWZhdWx0cy5NSU5fUEVSQ0VOVDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzRGVmaW5lZChtYXhQZXJjZW50KSB8fCBtYXhQZXJjZW50IDw9IDAgfHwgbWF4UGVyY2VudCA+PSAxMDApIHtcbiAgICAgICAgICAgIG1heFBlcmNlbnQgPSBzdHJldGNoRGVmYXVsdHMuTUFYX1BFUkNFTlQ7XG4gICAgICAgIH1cbiAgICAgICAgbWluUGVyY2VudCA9IHBhcnNlRmxvYXQobWluUGVyY2VudC50b0ZpeGVkKDEpKTtcbiAgICAgICAgbWF4UGVyY2VudCA9IHBhcnNlRmxvYXQobWF4UGVyY2VudC50b0ZpeGVkKDEpKTtcbiAgICAgICAgcmVuZGVyZXIubWluUGVyY2VudCA9IG1pblBlcmNlbnQ7XG4gICAgICAgIHJlbmRlcmVyLm1heFBlcmNlbnQgPSBtYXhQZXJjZW50O1xuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJwZXJjZW50LWNsaXAtc2VjdGlvblwiIH0sIHRoaXMucmVuZGVyUGVyY2VudENsaXBTZWN0aW9uSW5wdXQoXCJtaW5cIiwgbWluUGVyY2VudCksIHRoaXMucmVuZGVyUGVyY2VudENsaXBTZWN0aW9uSW5wdXQoXCJtYXhcIiwgbWF4UGVyY2VudCkpKTtcbiAgICB9XG4gICAgcmVuZGVyUGVyY2VudENsaXBTZWN0aW9uSW5wdXQoc2VsZWN0aW9uLCB2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJwZXJjZW50LWNsaXAtc2VjdGlvbi1pbnB1dFwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnN0cmV0Y2hbc2VsZWN0aW9uXSwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnN0cmV0Y2hbc2VsZWN0aW9uXSwgc2NhbGU6IFwic1wiLCBtaW46IDAuMSwgbWF4OiA5OS45LCBzdGVwOiAwLjEsIHN1ZmZpeFRleHQ6IFwiJVwiLCB2YWx1ZTogYCR7dmFsdWV9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQZXJjZW50ID0gcGFyc2VGbG9hdChub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS52YWx1ZSAmJiBuZXdQZXJjZW50ID49IG5vZGUubWluICYmIG5ld1BlcmNlbnQgPD0gbm9kZS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgc2VsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVQZXJjZW50T3JTdGRkZXZDaGFuZ2Uobm9kZSwgc2VsZWN0aW9uKSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQmFuZFNlbGVjdG9yKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCB7IGJhbmRDb3VudCB9ID0gbGF5ZXIucmFzdGVySW5mbztcbiAgICAgICAgY29uc3Qgc2hvd0JhbmRTZWxlY3RvciA9IGJhbmRDb3VudCA+IDE7XG4gICAgICAgIGlmICghc2hvd0JhbmRTZWxlY3Rvcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBiYW5kSW5mb3MgfSA9IGxheWVyLnJhc3RlckluZm87XG4gICAgICAgIGNvbnN0IGJhbmROYW1lcyA9IGJhbmRJbmZvcy5tYXAoKGJhbmRJbmZvKSA9PiBiYW5kSW5mby5uYW1lKTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zdHJldGNoLmJhbmQsIGgoXCJjYWxjaXRlLWNvbWJvYm94XCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnN0cmV0Y2guYmFuZCwgY2xlYXJEaXNhYmxlZDogdHJ1ZSwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGUtcGVyc2lzdFwiLCBvbkNhbGNpdGVDb21ib2JveENoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICBsYXllci5iYW5kSWRzID0gW2JhbmROYW1lcy5pbmRleE9mKG5vZGUudmFsdWUpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBiYW5kSW5kZXggPSAoX2EgPSBsYXllci5iYW5kSWRzWzBdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdHJldGNoRGVmYXVsdHMuQkFORF9JTkRFWDtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5zdGF0aXN0aWNzID0gW3RoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XV07XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSwgYmFuZE5hbWVzLm1hcCgoYmFuZE5hbWUsIGlkeCkgPT4gdGhpcy5yZW5kZXJCYW5kT3B0aW9ucyhiYW5kTmFtZSwgaWR4KSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckJhbmRPcHRpb25zKGJhbmROYW1lLCBpZHgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCBiYW5kSW5kZXggPSAoX2EgPSBsYXllci5iYW5kSWRzWzBdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdHJldGNoRGVmYXVsdHMuQkFORF9JTkRFWDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jb21ib2JveC1pdGVtXCIsIHsgdGV4dExhYmVsOiBiYW5kTmFtZSwgdmFsdWU6IGJhbmROYW1lLCBzZWxlY3RlZDogYmFuZEluZGV4ID09PSBpZHggfSkpO1xuICAgIH1cbiAgICByZW5kZXJHYW1tYVNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBsZXQgeyBnYW1tYSA9IHN0cmV0Y2hEZWZhdWx0cy5HQU1NQSB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGlmICghaXNEZWZpbmVkKGdhbW1hKSkge1xuICAgICAgICAgICAgZ2FtbWEgPSBzdHJldGNoRGVmYXVsdHMuR0FNTUE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZ2FtbWEpKSB7XG4gICAgICAgICAgICBnYW1tYSA9IChfYSA9IGdhbW1hWzBdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdHJldGNoRGVmYXVsdHMuR0FNTUE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHN0cmV0Y2hEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlTm9uZSA9IHN0cmV0Y2hUeXBlID09PSBzdHJldGNoVHlwZU1hcC5OT05FO1xuICAgICAgICBpZiAoaXNTdHJldGNoVHlwZU5vbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuc3RyZXRjaC5nYW1tYSwgaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWdhbW1hLXNsaWRlclwiLCB7IGdhbW1hOiBnYW1tYSwgcmVuZGVyZXJUeXBlOiBcInJhc3Rlci1zdHJldGNoXCIgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JTY2hlbWUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc3RyZXRjaFR5cGUgPSBzdHJldGNoRGVmYXVsdHMuU1RSRVRDSF9UWVBFIH0gPSByZW5kZXJlciB8fCB7fTtcbiAgICAgICAgY29uc3QgaXNTdHJldGNoVHlwZU5vbmUgPSBzdHJldGNoVHlwZSA9PT0gc3RyZXRjaFR5cGVNYXAuTk9ORTtcbiAgICAgICAgaWYgKGlzU3RyZXRjaFR5cGVOb25lKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGNvbG9yUmFtcCB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIC8vIG5vcm1hbGl6ZSBjb2xvclJhbXAgKGN1cnJlbnRseSBpbiBNdWx0aXBhcnQgZm9ybSlcbiAgICAgICAgY29uc3QgY29sb3JTY2hlbWUgPSBub3JtYWxpemVDb2xvclJhbXAoY29sb3JSYW1wKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5zdHJldGNoLmNvbG9yU2NoZW1lLCB0eXBlOiBcInJhc3Rlci1zdHJldGNoXCIsIHJhbXBUeXBlOiBcImNvbnRpbnVvdXNcIiwgY29sb3JzOiBjb2xvclNjaGVtZSwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xCdXR0b25TeW1ib2xDaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclJhbmdlQWRqdXN0bWVudFRvZ2dsZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBkeW5hbWljUmFuZ2VBZGp1c3RtZW50IH0gPSByZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHN0cmV0Y2hEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlTm9uZSA9IHN0cmV0Y2hUeXBlID09PSBzdHJldGNoVHlwZU1hcC5OT05FO1xuICAgICAgICBpZiAoaXNTdHJldGNoVHlwZU5vbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiwgY2xhc3M6IFwicmFuZ2UtYWRqdXN0bWVudC1sYWJlbFwiIH0sIHN0cmluZ3MucGFuZWxzLnN0cmV0Y2guZHluYW1pY1JhbmdlQWRqdXN0bWVudCwgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgc2NhbGU6IFwic1wiLCBjaGVja2VkOiBkeW5hbWljUmFuZ2VBZGp1c3RtZW50LCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNUb2dnbGVkID0gbm9kZS5jaGVja2VkO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRFJBVG9nZ2xlKGlzVG9nZ2xlZCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlclN0YXRpc3RpY3NUYWJsZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IG9yaWdpbmFsU3RhdGlzdGljcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbW9kdWxlcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZSA9IHN0cmV0Y2hEZWZhdWx0cy5TVFJFVENIX1RZUEUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXAgPSBzdHJldGNoVHlwZSA9PT0gc3RyZXRjaFR5cGVNYXAuUEVSQ0VOVF9DTElQO1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlTm9uZSA9IHN0cmV0Y2hUeXBlID09PSBzdHJldGNoVHlwZU1hcC5OT05FO1xuICAgICAgICBjb25zdCBpc1N0cmV0Y2hUeXBlU3RhbmRhcmREZXZpYXRpb24gPSBzdHJldGNoVHlwZSA9PT0gc3RyZXRjaFR5cGVNYXAuU1RBTkRBUkRfREVWSUFUSU9OO1xuICAgICAgICBjb25zdCB7IGR5bmFtaWNSYW5nZUFkanVzdG1lbnQgfSA9IHJlbmRlcmVyO1xuICAgICAgICBjb25zdCBzaG93U3RhdHNUYWJsZSA9ICFkeW5hbWljUmFuZ2VBZGp1c3RtZW50ICYmICEoaXNTdHJldGNoVHlwZU5vbmUgfHwgaXNTdHJldGNoVHlwZVBlcmNlbnRDbGlwKTtcbiAgICAgICAgaWYgKCFzaG93U3RhdHNUYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFzU3RhdGlzdGljcyA9IGxheWVyLnJhc3RlckluZm8uc3RhdGlzdGljcyAhPT0gbnVsbDtcbiAgICAgICAgbGV0IHsgc3RhdGlzdGljcyB9ID0gcmVuZGVyZXIgfHwge307XG4gICAgICAgIGlmICghc3RhdGlzdGljcyB8fCAoQXJyYXkuaXNBcnJheShzdGF0aXN0aWNzKSAmJiBzdGF0aXN0aWNzLmxlbmd0aCA8IDEpKSB7XG4gICAgICAgICAgICBzdGF0aXN0aWNzID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShvcmlnaW5hbFN0YXRpc3RpY3MpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJhbmRJbmRleCA9IChfYSA9IGxheWVyLmJhbmRJZHNbMF0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHN0cmV0Y2hEZWZhdWx0cy5CQU5EX0lOREVYO1xuICAgICAgICBjb25zdCBkaXNhYmxlTWVhbkFuZFN0ZERldiA9ICghaGFzU3RhdGlzdGljcyB8fCBpc1N0cmV0Y2hUeXBlUGVyY2VudENsaXApICYmICFpc1N0cmV0Y2hUeXBlU3RhbmRhcmREZXZpYXRpb247XG4gICAgICAgIGNvbnN0IHsgbWluID0gMCwgbWF4ID0gMjU1LCBhdmc6IG1lYW4gPSAwLCBzdGRkZXYgPSAwIH0gPSAoc3RhdGlzdGljcyA9PT0gbnVsbCB8fCBzdGF0aXN0aWNzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdGF0aXN0aWNzWzBdKSB8fCB7fTtcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zdHJldGNoLnN0YXRpc3RpY3MpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5zdHJldGNoLm1pbiwgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnN0cmV0Y2gubWluLCBzY2FsZTogXCJzXCIsIHN0ZXA6IDAuMSwgbnVtYmVyQnV0dG9uVHlwZTogXCJub25lXCIsIHZhbHVlOiBgJHtpc0RlZmluZWQobWluKSA/IHRoaXMucm91bmQobWluKSA6IFwiXCJ9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLm1pbk5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlIDw9IHRoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XVtcIm1heFwiXSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbk5vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVN0YXRpc3RpY3NDaGFuZ2UodmFsdWUsIGJhbmRJbmRleCwgXCJtaW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNaW4gPSB0aGlzLnJvdW5kKHRoaXMuY3VycmVudFN0YXRpc3RpY3NbYmFuZEluZGV4XVtcIm1pblwiXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbk5vZGUudmFsdWUgPSBgJHtjdXJyZW50TWlufWA7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDMwMCksIHJlZjogKG5vZGUpID0+ICh0aGlzLm1pbk5vZGUgPSBub2RlKSB9KSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnN0cmV0Y2gubWF4LCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5wYW5lbHMuc3RyZXRjaC5tYXgsIHNjYWxlOiBcInNcIiwgc3RlcDogMC4xLCBudW1iZXJCdXR0b25UeXBlOiBcIm5vbmVcIiwgdmFsdWU6IGAke2lzRGVmaW5lZChtYXgpID8gdGhpcy5yb3VuZChtYXgpIDogXCJcIn1gLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMubWF4Tm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFpc05hTih2YWx1ZSkgJiYgdmFsdWUgPj0gdGhpcy5jdXJyZW50U3RhdGlzdGljc1tiYW5kSW5kZXhdW1wibWluXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWF4Tm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGlzdGljc0NoYW5nZSh2YWx1ZSwgYmFuZEluZGV4LCBcIm1heFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE1heCA9IHRoaXMucm91bmQodGhpcy5jdXJyZW50U3RhdGlzdGljc1tiYW5kSW5kZXhdW1wibWF4XCJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF4Tm9kZS52YWx1ZSA9IGAke2N1cnJlbnRNYXh9YDtcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMubWF4Tm9kZSA9IG5vZGUpIH0pKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuc3RyZXRjaC5tZWFuLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5wYW5lbHMuc3RyZXRjaC5tZWFuLCBzY2FsZTogXCJzXCIsIHN0ZXA6IDAuMSwgZGlzYWJsZWQ6IGRpc2FibGVNZWFuQW5kU3RkRGV2LCBudW1iZXJCdXR0b25UeXBlOiBcIm5vbmVcIiwgdmFsdWU6IGAke2lzRGVmaW5lZChtZWFuKSA/IHRoaXMucm91bmQobWVhbikgOiBcIlwifWAsIG9uQ2FsY2l0ZUlucHV0TnVtYmVySW5wdXQ6IGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5hdmdOb2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF2Z05vZGUudmFsdWUgPSBgJHt2YWx1ZX1gO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVN0YXRpc3RpY3NDaGFuZ2UodmFsdWUsIGJhbmRJbmRleCwgXCJhdmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRNZWFuID0gdGhpcy5yb3VuZCh0aGlzLmN1cnJlbnRTdGF0aXN0aWNzW2JhbmRJbmRleF1bXCJhdmdcIl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdmdOb2RlLnZhbHVlID0gYCR7Y3VycmVudE1lYW59YDtcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYXZnTm9kZSA9IG5vZGUpIH0pKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMuc3RyZXRjaC5zdGRkZXYsIGgoXCJjYWxjaXRlLWlucHV0LW51bWJlclwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy5zdHJldGNoLnN0ZGRldiwgc2NhbGU6IFwic1wiLCBzdGVwOiAwLjEsIGRpc2FibGVkOiBkaXNhYmxlTWVhbkFuZFN0ZERldiwgbnVtYmVyQnV0dG9uVHlwZTogXCJub25lXCIsIHZhbHVlOiBgJHtpc0RlZmluZWQoc3RkZGV2KSA/IHRoaXMucm91bmQoc3RkZGV2KSA6IFwiXCJ9YCwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLnN0ZGRldk5vZGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RkZGV2Tm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGlzdGljc0NoYW5nZSh2YWx1ZSwgYmFuZEluZGV4LCBcInN0ZGRldlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN0ZGRldiA9IHRoaXMucm91bmQodGhpcy5jdXJyZW50U3RhdGlzdGljc1tiYW5kSW5kZXhdW1wic3RkZGV2XCJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RkZGV2Tm9kZS52YWx1ZSA9IGAke2N1cnJlbnRTdGRkZXZ9YDtcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuc3RkZGV2Tm9kZSA9IG5vZGUpIH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgaGFuZGxlUGVyY2VudE9yU3RkZGV2Q2hhbmdlKG5vZGUsIGNoYW5naW5nKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGxldCB2YWx1ZSA9IHBhcnNlRmxvYXQobm9kZS52YWx1ZSk7XG4gICAgICAgIGlmIChpc05hTih2YWx1ZSkgfHwgdmFsdWUgPCBub2RlLm1pbikge1xuICAgICAgICAgICAgdmFsdWUgPSBub2RlLm1pbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IG5vZGUubWF4KSB7XG4gICAgICAgICAgICB2YWx1ZSA9IG5vZGUubWF4O1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZS50b0ZpeGVkKDEpKTtcbiAgICAgICAgbm9kZS52YWx1ZSA9IGAke3ZhbHVlfWA7XG4gICAgICAgIGNoYW5naW5nID09PSBcIm1pblwiXG4gICAgICAgICAgICA/IChyZW5kZXJlci5taW5QZXJjZW50ID0gdmFsdWUpXG4gICAgICAgICAgICA6IGNoYW5naW5nID09PSBcIm1heFwiXG4gICAgICAgICAgICAgICAgPyAocmVuZGVyZXIubWF4UGVyY2VudCA9IHZhbHVlKVxuICAgICAgICAgICAgICAgIDogKHJlbmRlcmVyLm51bWJlck9mU3RhbmRhcmREZXZpYXRpb25zID0gdmFsdWUpO1xuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICBoYW5kbGVEUkFUb2dnbGUoYXBwbHlEUkEpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBiYW5kSW5kZXggPSAoX2EgPSBsYXllci5iYW5kSWRzWzBdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdHJldGNoRGVmYXVsdHMuQkFORF9JTkRFWDtcbiAgICAgICAgcmVuZGVyZXIuZHluYW1pY1JhbmdlQWRqdXN0bWVudCA9IGFwcGx5RFJBO1xuICAgICAgICBpZiAoYXBwbHlEUkEpIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLnN0YXRpc3RpY3MgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLnN0YXRpc3RpY3MgPSBbdGhpcy5jdXJyZW50U3RhdGlzdGljc1tiYW5kSW5kZXhdXTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICBoYW5kbGVTdGF0aXN0aWNzQ2hhbmdlKHZhbHVlLCBzdGF0aXN0aWNJRFRvVXBkYXRlLCB0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRpc3RpY3Nbc3RhdGlzdGljSURUb1VwZGF0ZV1bdHlwZV0gPSB2YWx1ZTtcbiAgICAgICAgcmVuZGVyZXIuc3RhdGlzdGljcyA9IFt0aGlzLmN1cnJlbnRTdGF0aXN0aWNzW3N0YXRpc3RpY0lEVG9VcGRhdGVdXTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgaXNBbkVtcHR5QXJyYXkodmFsdWUpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUubGVuZ3RoID09PSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsO1xuICAgIH1cbiAgICByb3VuZCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh2YWx1ZSAqIDEwMDApIC8gMTAwMDtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2guc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJTdHJldGNoQ3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJVbmlxdWVWYWx1ZUNzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS51bmlxdWUtdmFsdWUtYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW47b3ZlcmZsb3ctd3JhcDphbnl3aGVyZX0ubGFiZWx7cGFkZGluZzo1cHggYXV0b30uc3ltYm9se3dpZHRoOjE5cHg7aGVpZ2h0OjE5cHh9LnN5bWJvbDpmb2N1cywubGFiZWw6Zm9jdXN7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9LnN5bWJvbC1jb250YWluZXJ7Y3Vyc29yOnBvaW50ZXJ9LnNlbGVjdGVke291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5oaWRkZW57ZGlzcGxheTpub25lfS5ncmF5LWJvcmRlcntib3JkZXItdG9wOjFweCBzb2xpZCAjZTBlMGUwO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlMGUwZTB9LmNoZWNrYm94e21hcmdpbjowcHggNS41cHh9LmRlZmF1bHQtbGlzdC1wYWRkaW5ne3BhZGRpbmctdG9wOjhweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVW5pcXVlVmFsdWUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVW5pcXVlVmFsdWVCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMuaW5wdXROb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLmxhYmVsTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jb2xvck5vZGVzID0gW107XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFJlbmRlcmVyT2JqIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBhcHBseVJhc3RlclJlbmRlcmVyKG9yaWdpbmFsUmVuZGVyZXJPYmosIGxheWVyKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVW5pcXVlVmFsdWVDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtYXBWaWV3LCBtb2R1bGVzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSYXN0ZXJSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgc21hcnRNYXBwaW5nU3RhdGUubGFzdERlZmF1bHQgPSB7XG4gICAgICAgICAgICBkZWZhdWx0U3ltYm9sOiByZW5kZXJlci5kZWZhdWx0U3ltYm9sIHx8IGdldERlZmF1bHRTeW1ib2wobGF5ZXIsIG1hcFZpZXcsIHJlbmRlcmVyVHlwZSksXG4gICAgICAgICAgICBkZWZhdWx0TGFiZWw6IHJlbmRlcmVyLmRlZmF1bHRMYWJlbCB8fCBzdHJpbmdzLnBhbmVscy51bmlxdWVWYWx1ZS5vdGhlclxuICAgICAgICB9O1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlck9iaiA9IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUobGF5ZXIucmVuZGVyZXIpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCgpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgaGlkZUxheWVyVGl0bGUsIGxheWVyLCBzdHJpbmdzLCBpc1JUTCB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gbGF5ZXIudGl0bGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImNhbGNpdGUtbWF0Y2gtaGVpZ2h0XCIgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUuc3R5bGVPcHRpb25zLCBkZXNjcmlwdGlvbjogIWhpZGVMYXllclRpdGxlID8gdGl0bGUgOiB1bmRlZmluZWQsIGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGNsb3NhYmxlOiBpc1RvcEZsb3dJdGVtKHRoaXMuaG9zdEVsZW1lbnQpLCBtZW51T3BlbjogdGhpcy5tZW51T3BlbiwgYmVmb3JlQmFjazogdGhpcy5iZWZvcmVCYWNrLFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2hvd0JhY2tCdXR0b246IHRoaXMuc2hvd0JhY2tCdXR0b24sIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6IHRoaXMuaGFuZGxlRG9uZSwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyRG9uZUJ1dHRvbigpLCB0aGlzLnJlbmRlckNhbmNlbEJ1dHRvbigpKSkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IFwidW5pcXVlLXZhbHVlLWJsb2NrXCIsIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLnVuaXF1ZVZhbHVlLCBvcGVuOiB0cnVlIH0sIHRoaXMucmVuZGVyRmllbGRTZWxlY3RvcigpLCB0aGlzLnJlbmRlckNvbG9yU2NoZW1lKCksIHRoaXMucmVuZGVyVmFsdWVzKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRTZWxlY3RvcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCByZW5kZXJlckZpZWxkID0gcmVuZGVyZXIuZmllbGQgfHwgc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUudmFsdWU7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IGdldFJhc3RlclVuaXF1ZVZhbHVlRmllbGRzKCk7XG4gICAgICAgIGNvbnN0IGZpZWxkTGlzdCA9IGZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBmaWVsZC5hbGlhcyxcbiAgICAgICAgICAgICAgICBsYXllckZpZWxkOiBmaWVsZCxcbiAgICAgICAgICAgICAgICAvLyByYXN0ZXIgbGF5ZXIgZGlzcGxheXMgYXJlIG5vdCBkZXBlbmRlbnQgb24gZmllbGQgdHlwZSwgc28gd2UgdXNlIFwic3RyaW5nXCIgYXMgYSBwbGFjZWhvbGRlclxuICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogc2ltcGxlRmllbGRUeXBlcy5TVFJJTkdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEZpZWxkID0gZmllbGRzLmZpbmQoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQubmFtZSA9PT0gcmVuZGVyZXJGaWVsZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWF0dHJpYnV0ZS1pbnB1dFwiLCB7IGxhYmVsOiBzdHJpbmdzLnBhbmVscy51bmlxdWVWYWx1ZS5maWVsZCwgZmllbGRMaXN0OiBmaWVsZExpc3QsIHNlbGVjdGVkRmllbGQ6IHtcbiAgICAgICAgICAgICAgICBmaWVsZDogKF9hID0gc2VsZWN0ZWRGaWVsZCA9PT0gbnVsbCB8fCBzZWxlY3RlZEZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEZpZWxkLm5hbWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLnZhbHVlLFxuICAgICAgICAgICAgICAgIC8vIHJhc3RlciBsYXllciBkaXNwbGF5cyBhcmUgbm90IGRlcGVuZGVudCBvbiBmaWVsZCB0eXBlLCBzbyB3ZSB1c2UgXCJzdHJpbmdcIiBhcyBhIHBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLlNUUklOR1xuICAgICAgICAgICAgfSwgbW9kZTogXCJzaW1wbGVcIiwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZpZWxkID0gZXZlbnQuZGV0YWlsLmZpZWxkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUZpZWxkQ2hhbmdlKG5ld0ZpZWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JTY2hlbWUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVZhbHVlSW5mb3MgPSByZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zO1xuICAgICAgICBpZiAoIXVuaXF1ZVZhbHVlSW5mb3MubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzY2hlbWVzID0gbW9kdWxlcy50eXBlU2NoZW1lcy5nZXRTY2hlbWVzKHtcbiAgICAgICAgICAgIGJhc2VtYXA6IG1hcFZpZXcubWFwLmJhc2VtYXAsXG4gICAgICAgICAgICBnZW9tZXRyeVR5cGU6IFwicG9seWdvblwiXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb2xvclJhbXBzQW5kU2NoZW1lcyA9IGdldENvbG9yUmFtcHNXaXRoU2NoZW1lcyhzY2hlbWVzLCBNYXRoLm1pbih1bmlxdWVWYWx1ZUluZm9zLmxlbmd0aCwgMTApKTtcbiAgICAgICAgY29uc3QgZGVmYXVsdENvbG9ycyA9IGNvbG9yUmFtcHNBbmRTY2hlbWVzWzBdLmNvbG9ycztcbiAgICAgICAgY29uc3QgY29sb3JzID0gW107XG4gICAgICAgIGNvbG9ycy5wdXNoKC4uLigodW5pcXVlVmFsdWVJbmZvcyA9PT0gbnVsbCB8fCB1bmlxdWVWYWx1ZUluZm9zID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1bmlxdWVWYWx1ZUluZm9zLmxlbmd0aClcbiAgICAgICAgICAgID8gdW5pcXVlVmFsdWVJbmZvcy5tYXAoKHVuaXF1ZVZhbHVlSW5mbywgaWR4KSA9PiBnZXRTeW1ib2xDb2xvcih1bmlxdWVWYWx1ZUluZm8uc3ltYm9sKSB8fFxuICAgICAgICAgICAgICAgIG5ldyBtb2R1bGVzLmVzcmlDb2xvcihkZWZhdWx0Q29sb3JzW2lkeCAlIGRlZmF1bHRDb2xvcnMubGVuZ3RoXSkpXG4gICAgICAgICAgICA6IFtdKSk7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyBsYWJlbDogc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUuY29sb3JTY2hlbWUsIHR5cGU6IFwicmFzdGVyLXVuaXF1ZS12YWx1ZVwiLFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiByYW1wVHlwZSBtdXN0IGJlIGNvbnRpbnVvdXMgdG8gaGFuZGxlIGdyYWNlZnVsIGRpc3BsYXkgb2YgZGF0YXNldHMgd2l0aCBtb3JlIHRoYW4gfjIwIGNvbG9ycy5cbiAgICAgICAgICAgICAqIEluZGl2aWR1YWwgY29sb3JzIGNhbiBzdGlsbCBiZSBtb2RpZmllZCwgYW5kIHRoZSBjaGFuZ2VzIHdpbGwgIGJlIHJlZmxlY3RlZCBpbiB0aGUgc3ltYm9sXG4gICAgICAgICAgICAgKiBidXR0b24gYW5kIHN5bWJvbCBzdHlsZXIuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJhbXBUeXBlOiBcImNvbnRpbnVvdXNcIiwgY29sb3JzOiBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGNvbG9ycykucmV2ZXJzZSgpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5zeW1ib2xCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUgPSBub2RlKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuaW5wdXROb2RlcyA9IFtdO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHJlbmRlcmVyLmZpZWxkKSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IGdyb3VwOiBcInVuaXF1ZS12YWx1ZS1pdGVtc1wiLCBjbGFzczogXCJncmF5LWJvcmRlclwiLCBkcmFnRW5hYmxlZDogdHJ1ZSwgb25DYWxjaXRlTGlzdE9yZGVyQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsLnRvRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHJhZ2dlZEVsZW1lbnQgPSBldmVudC5kZXRhaWwuZHJhZ0VsO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkcmFnZ2VkVG9PdGhlclZhbHVlc0xpc3QgPSBldmVudC5kZXRhaWwudG9FbC5pZCA9PT0gXCJvdGhlci12YWx1ZXMtbGlzdFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZFRvT3RoZXJWYWx1ZXNMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdVbmlxdWVWYWx1ZUluZm9zID0gcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcy5maWx0ZXIoKF8sIGlkeCkgPT4gaWR4ICE9PSBwYXJzZUludChkcmFnZ2VkRWxlbWVudC5sYWJlbCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcyA9IG5ld1VuaXF1ZVZhbHVlSW5mb3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5jaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTb3J0VmFsdWVzKGl0ZW1zKTtcbiAgICAgICAgICAgIH0gfSwgcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcy5tYXAoKHVuaXF1ZVZhbHVlSW5mbywgaWR4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJWYWx1ZSh1bmlxdWVWYWx1ZUluZm8sIGlkeCk7XG4gICAgICAgIH0pKSwgdGhpcy5yZW5kZXJEZWZhdWx0VmFsdWUoKSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IGlkOiBcIm90aGVyLXZhbHVlcy1saXN0XCIsIGRyYWdFbmFibGVkOiB0cnVlLCBncm91cDogXCJ1bmlxdWUtdmFsdWUtaXRlbXNcIiB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJWYWx1ZSh1bmlxdWVWYWx1ZUluZm8sIGlkeCkge1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogYHZhbHVlcy0ke3VuaXF1ZVZhbHVlSW5mby52YWx1ZX1gLCB2YWx1ZTogYCR7dW5pcXVlVmFsdWVJbmZvLnZhbHVlfWAsIGxhYmVsOiBgJHtpZHh9YCB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJhY3Rpb25zLXN0YXJ0XCIgfSwgdGhpcy5yZW5kZXJDb2xvck5vZGUodW5pcXVlVmFsdWVJbmZvLCBpZHgpKSwgdGhpcy5yZW5kZXJUZXh0Tm9kZSh1bmlxdWVWYWx1ZUluZm8sIGlkeCkpKTtcbiAgICB9XG4gICAgcmVuZGVyQ29sb3JOb2RlKHVuaXF1ZVZhbHVlSW5mbywgaWR4KSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGxldCBzeW1ib2wgPSB1bmlxdWVWYWx1ZUluZm8uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgIGNvbnN0IHN5bWJvbE5vZGVDbGFzc2VzID0ge1xuICAgICAgICAgICAgXCJzeW1ib2wtaXMtd2hpdGVcIjogaXNTeW1ib2xBbG1vc3RXaGl0ZShzeW1ib2wpLFxuICAgICAgICAgICAgc3ltYm9sOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGlmIChpZHggIT09IC0xICYmIHRoaXMuY29sb3JOb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuY29sb3JOb2RlcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBzeW1ib2xOb2RlQ2xhc3NlcywgdGFiaW5kZXg6IFwiMFwiLCBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUuYWNjZXNzaWJpbGl0eS5lZGl0Q29sb3JGb3IucmVwbGFjZShcIiR7dmFsdWV9XCIsIHVuaXF1ZVZhbHVlSW5mby5sYWJlbCksIFwiYXJpYS1oYXNwb3B1cFwiOiBcInRydWVcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkeCA9PT0gLTEgPyAodGhpcy5kZWZhdWx0Q29sb3JOb2RlID0gbm9kZSkgOiB0aGlzLmNvbG9yTm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sb3JOb2RlID0gdGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPT09IC0xID8gdGhpcy5kZWZhdWx0Q29sb3JOb2RlIDogdGhpcy5jb2xvck5vZGVzW3RoaXMuc2VsZWN0ZWRQb3BvdmVySWR4XTtcbiAgICAgICAgICAgICAgICAgICAgY29sb3JOb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQb3BvdmVySWR4ID09PSBpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPSBpZHg7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNvbG9yQ2xpY2soaWR4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFBvcG92ZXJJZHggPSBpZHg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ29sb3JDbGljayhpZHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ29sb3JDbGljayhpZHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyQ3JlYXRlQ29sb3JOb2RlKG5vZGUsIGlkeCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJUZXh0Tm9kZSh1bmlxdWVWYWx1ZUluZm8sIGlkeCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogYCR7aWR4ID09PSAtMSA/IFwiZGVmYXVsdC1sYWJlbFwiIDogXCJcIn0gbGFiZWxgLCBzbG90OiBcImNvbnRlbnRcIiwgdGFiaW5kZXg6IFwiMFwiLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWR4ID09PSAtMSA/ICh0aGlzLmRlZmF1bHRMYWJlbE5vZGUgPSBub2RlKSA6ICh0aGlzLmxhYmVsTm9kZXNbaWR4XSA9IG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy51bmlxdWVWYWx1ZS5hY2Nlc3NpYmlsaXR5LmVkaXRMYWJlbEZvci5yZXBsYWNlKFwiJHt2YWx1ZX1cIiwgdW5pcXVlVmFsdWVJbmZvLmxhYmVsKSwgb25DbGljazogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUxhYmVsRWRpdChpZHgsIGV2ZW50KSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUxhYmVsRWRpdChpZHgsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIHVuaXF1ZVZhbHVlSW5mby5sYWJlbCksIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgc2xvdDogXCJjb250ZW50XCIsIGNsYXNzOiBcImhpZGRlblwiLCBzY2FsZTogXCJzXCIsIHRhYmluZGV4OiBcIjBcIiwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBpZHggPT09IC0xID8gKHRoaXMuZGVmYXVsdElucHV0Tm9kZSA9IG5vZGUpIDogKHRoaXMuaW5wdXROb2Rlc1tpZHhdID0gbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIChfYSA9IHRoaXMuZGVmYXVsdElucHV0Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzTGlzdC5hZGQoXCJkZWZhdWx0LWlucHV0LXBhZGRpbmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdmFsdWU6IHVuaXF1ZVZhbHVlSW5mby5sYWJlbCwgb25DYWxjaXRlSW5wdXRDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0Tm9kZSA9IGlkeCA9PT0gLTEgPyB0aGlzLmRlZmF1bHRJbnB1dE5vZGUgOiB0aGlzLmlucHV0Tm9kZXNbaWR4XTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbE5vZGUgPSBpZHggPT09IC0xID8gdGhpcy5kZWZhdWx0TGFiZWxOb2RlIDogdGhpcy5sYWJlbE5vZGVzW2lkeF07XG4gICAgICAgICAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgbGFiZWxOb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaWR4LCBldmVudCk7XG4gICAgICAgICAgICB9LCBvbkZvY3Vzb3V0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dE5vZGUgPSBpZHggPT09IC0xID8gdGhpcy5kZWZhdWx0SW5wdXROb2RlIDogdGhpcy5pbnB1dE5vZGVzW2lkeF07XG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWxOb2RlID0gaWR4ID09PSAtMSA/IHRoaXMuZGVmYXVsdExhYmVsTm9kZSA6IHRoaXMubGFiZWxOb2Rlc1tpZHhdO1xuICAgICAgICAgICAgICAgIGlucHV0Tm9kZS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIGxhYmVsTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVUZXh0Q2hhbmdlKGlkeCwgZXZlbnQpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0Tm9kZSA9IGlkeCA9PT0gLTEgPyB0aGlzLmRlZmF1bHRJbnB1dE5vZGUgOiB0aGlzLmlucHV0Tm9kZXNbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB1bmlxdWVWYWx1ZUluZm8ubGFiZWwgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVZhbHVlVGV4dENoYW5nZShpZHgsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWxOb2RlID0gaWR4ID09PSAtMSA/IHRoaXMuZGVmYXVsdExhYmVsTm9kZSA6IHRoaXMubGFiZWxOb2Rlc1tpZHhdO1xuICAgICAgICAgICAgICAgICAgICBsYWJlbE5vZGUuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBsYWJlbE5vZGUuZm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckRlZmF1bHRWYWx1ZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmFzdGVyUmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRTeW1ib2wgPSByZW5kZXJlci5kZWZhdWx0U3ltYm9sIHx8IGdldERlZmF1bHRTeW1ib2wobGF5ZXIsIG1hcFZpZXcsIHJlbmRlcmVyVHlwZSk7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRMYWJlbCA9IHJlbmRlcmVyLmRlZmF1bHRMYWJlbCB8fCBzdHJpbmdzLnBhbmVscy51bmlxdWVWYWx1ZS5vdGhlcjtcbiAgICAgICAgY29uc3QgZGVmYXVsdFVuaXF1ZVZhbHVlSW5mbyA9IHtcbiAgICAgICAgICAgIHN5bWJvbDogZGVmYXVsdFN5bWJvbCxcbiAgICAgICAgICAgIGxhYmVsOiBkZWZhdWx0TGFiZWxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0XCIsIHsgY2xhc3M6IFwiZGVmYXVsdC1saXN0LXBhZGRpbmdcIiB9LCBoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgbnVsbCwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBjbGFzczogXCJjaGVja2JveFwiLCBzbG90OiBcImFjdGlvbnMtc3RhcnRcIiwgc2NhbGU6IFwibVwiLCB0YWJJbmRleDogMCwgY2hlY2tlZDogISFyZW5kZXJlci5kZWZhdWx0U3ltYm9sLCBvbkNsaWNrOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlQ2hlY2tib3hDbGljayhldmVudCksIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2hlY2tib3hDbGljayhldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+IGFkZFNtYXJ0TWFwcGluZ1Rvb2x0aXAodGhpcy5jaGVja2JveE5vZGUsIHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyVG9vbHRpcCksIG9uTW91c2VPdXQ6ICgpID0+IHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAoKSwgb25Gb2N1czogKCkgPT4gYWRkU21hcnRNYXBwaW5nVG9vbHRpcCh0aGlzLmNoZWNrYm94Tm9kZSwgc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUub3RoZXJUb29sdGlwKSwgb25Gb2N1c291dDogKCkgPT4gcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCgpLCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2JveE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgY2xhc3M6IFwic3ltYm9sLWNvbnRhaW5lclwiIH0sIHRoaXMucmVuZGVyQ29sb3JOb2RlKGRlZmF1bHRVbmlxdWVWYWx1ZUluZm8sIC0xKSksIHRoaXMucmVuZGVyVGV4dE5vZGUoZGVmYXVsdFVuaXF1ZVZhbHVlSW5mbywgLTEpKSkpO1xuICAgIH1cbiAgICByZW5kZXJEb25lQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmRvbmUsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRG9uZSwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5kb25lKSk7XG4gICAgfVxuICAgIHJlbmRlckNhbmNlbEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5jYW5jZWwsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogXCJoYWxmXCIgfSwgc3RyaW5ncy5jYW5jZWwpKTtcbiAgICB9XG4gICAgaGFuZGxlRmllbGRDaGFuZ2UoZmllbGQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgcmVxdWVzdFdyYXBwZXIoY3JlYXRlVW5pcXVlVmFsdWVSZW5kZXJlckZyb21FeGlzdGluZyh7IGZpZWxkIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBhcHBseVJhc3RlclJlbmRlcmVyKHJlc3VsdC5yZW5kZXJlciwgbGF5ZXIpO1xuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmllbGROb2RlLnZhbHVlID0gcmVuZGVyZXIuZmllbGQ7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlRXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVTb3J0VmFsdWVzKGl0ZW1zKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSYXN0ZXJSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgIGNvbnN0IGl0ZW1WYWx1ZXMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0udmFsdWUpO1xuICAgICAgICBjb25zdCB1bmlxdWVWYWx1ZUluZm9zID0gcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcy5tYXAoKHVuaXF1ZVZhbHVlSW5mbykgPT4gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZSh1bmlxdWVWYWx1ZUluZm8pKTtcbiAgICAgICAgdW5pcXVlVmFsdWVJbmZvcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhSW5kZXggPSBpdGVtVmFsdWVzLmluZGV4T2YoYCR7YS52YWx1ZX1gKTtcbiAgICAgICAgICAgIGNvbnN0IGJJbmRleCA9IGl0ZW1WYWx1ZXMuaW5kZXhPZihgJHtiLnZhbHVlfWApO1xuICAgICAgICAgICAgcmV0dXJuIGFJbmRleCAtIGJJbmRleDtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh1bmlxdWVWYWx1ZUluZm9zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcyA9IHVuaXF1ZVZhbHVlSW5mb3M7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0U3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldywgcmVuZGVyZXJUeXBlKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBhZnRlckNyZWF0ZUNvbG9yTm9kZShub2RlLCBpZHgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSYXN0ZXJSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3Qgc3ltYm9sID0gaWR4ID09PSAtMVxuICAgICAgICAgICAgPyByZW5kZXJlci5kZWZhdWx0U3ltYm9sIHx8IGdldERlZmF1bHRTeW1ib2wobGF5ZXIsIG1hcFZpZXcsIHJlbmRlcmVyVHlwZSlcbiAgICAgICAgICAgIDogcmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvc1tpZHhdLnN5bWJvbC5jbG9uZSgpO1xuICAgICAgICAvLyByZXNldCBkZWZhdWx0IG91dGxpbmVcbiAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGlmIChzeW1ib2wub3V0bGluZSkge1xuICAgICAgICAgICAgICAgIHN5bWJvbC5vdXRsaW5lLndpZHRoID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBhZGQgb3V0bGluZXMgb25seSB0byBzeW1ib2xzIHRoYXQgYXJlIGFsbW9zdCB3aGl0ZVxuICAgICAgICBpZiAoaXNTeW1ib2xBbG1vc3RXaGl0ZShzeW1ib2wpKSB7XG4gICAgICAgICAgICBzeW1ib2wub3V0bGluZSA9IG5ldyBtb2R1bGVzLlNpbXBsZUxpbmVTeW1ib2woe1xuICAgICAgICAgICAgICAgIGNvbG9yOiBcIiNiZGMzYzdcIixcbiAgICAgICAgICAgICAgICB3aWR0aDogMC43NVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5jaGlsZE5vZGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBzeW1ib2xVdGlscyB9ID0gbW9kdWxlcztcbiAgICAgICAgaWYgKHN5bWJvbCkge1xuICAgICAgICAgICAgc3ltYm9sVXRpbHNcbiAgICAgICAgICAgICAgICAucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogZ2V0UmVuZGVyUHJldmlld1NpemUoc3ltYm9sKSxcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgaWdub3JlV2hpdGVTeW1ib2xzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN5bWJvbENvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICBpc1NxdWFyZUZpbGw6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKChlbGVtZW50KSA9PiBub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGUuYXBwZW5kQ2hpbGQoZWxlbWVudCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUNvbG9yQ2xpY2soaWR4KSB7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcG9wb3Zlck5vZGUgPSBjcmVhdGVTeW1ib2xTdHlsZXJQb3BvdmVyKHtcbiAgICAgICAgICAgIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLFxuICAgICAgICAgICAgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUuY29sb3JTY2hlbWVcbiAgICAgICAgfSk7XG4gICAgICAgIHBvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdTdHlsZXJQb3BvdmVyQ2xvc2VcIiwgKCkgPT4gdGhpcy5oYW5kbGVSZW1vdmVDb2xvckZvY3VzKHBvcG92ZXJOb2RlLCBpZHgsIGZhbHNlKSk7XG4gICAgICAgIHBvcG92ZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdTdHlsZXJQb3BvdmVyRGlzY29ubmVjdGVkXCIsICgpID0+IHRoaXMuaGFuZGxlUmVtb3ZlQ29sb3JGb2N1cyhwb3BvdmVyTm9kZSwgaWR4LCB0cnVlKSk7XG4gICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLnNlbGVjdGVkVmFsdWUgPSBpZHg7XG4gICAgICAgIGJ1aWxkU3ltYm9sU3R5bGVyRm9yUmFzdGVyVW5pcXVlVmFsdWVzVmFsdWUoe1xuICAgICAgICAgICAgcG9wb3Zlck5vZGU6IHBvcG92ZXJOb2RlLFxuICAgICAgICAgICAgb25DaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID09PSAtMSAmJiAhcmVuZGVyZXIuZGVmYXVsdExhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnN5bWJvbEJ1dHRvbk5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IHBvcG92ZXJOb2RlO1xuICAgICAgICBpZHggPT09IC0xXG4gICAgICAgICAgICA/IHRoaXMuZGVmYXVsdENvbG9yTm9kZS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIilcbiAgICAgICAgICAgIDogdGhpcy5jb2xvck5vZGVzW2lkeF0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgIH1cbiAgICBoYW5kbGVSZW1vdmVDb2xvckZvY3VzKHBvcG92ZXJOb2RlLCBpZHgsIGRpc2Nvbm5lY3RlZCkge1xuICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHBvcG92ZXJOb2RlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb2xvck5vZGUgPSBpZHggPT09IC0xID8gdGhpcy5kZWZhdWx0Q29sb3JOb2RlIDogdGhpcy5jb2xvck5vZGVzW2lkeF07XG4gICAgICAgICAgICBpZiAoIWRpc2Nvbm5lY3RlZCkge1xuICAgICAgICAgICAgICAgIGNvbG9yTm9kZS5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29sb3JOb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICB9LCAzMDApO1xuICAgIH1cbiAgICBoYW5kbGVMYWJlbEVkaXQoaWR4LCBldmVudCkge1xuICAgICAgICBjb25zdCBpbnB1dE5vZGUgPSBpZHggPT09IC0xID8gdGhpcy5kZWZhdWx0SW5wdXROb2RlIDogdGhpcy5pbnB1dE5vZGVzW2lkeF07XG4gICAgICAgIGlucHV0Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICBpbnB1dE5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGhhbmRsZVZhbHVlVGV4dENoYW5nZShpZHgsIGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIC8vIGhhbmRsZXMgdW5jaGVja2luZyB0aGUgZGVmYXVsdCBsYWJlbCBjaGVja2JveFxuICAgICAgICBpZiAoaWR4ID09PSAtMSAmJiAhcmVuZGVyZXIuZGVmYXVsdExhYmVsKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRJbnB1dE5vZGUudmFsdWUgPSBzdHJpbmdzLnBhbmVscy51bmlxdWVWYWx1ZS5vdGhlcjtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdExhYmVsTm9kZS50ZXh0Q29udGVudCA9IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyO1xuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlkeCA9PT0gLTFcbiAgICAgICAgICAgID8gKHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IG5vZGUudmFsdWUpXG4gICAgICAgICAgICA6IChyZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zW2lkeF0ubGFiZWwgPSBub2RlLnZhbHVlKTtcbiAgICAgICAgLy8gaGFuZGxlcyBlbXB0eSBpbnB1dHNcbiAgICAgICAgaWYgKG5vZGUudmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIGlmIChpZHggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUub3RoZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0SW5wdXROb2RlLnZhbHVlID0gc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUub3RoZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0TGFiZWxOb2RlLnRleHRDb250ZW50ID0gc3RyaW5ncy5wYW5lbHMudW5pcXVlVmFsdWUub3RoZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zW2lkeF0ubGFiZWwgPSBgJHtyZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zW2lkeF0udmFsdWV9YDtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0Tm9kZXNbaWR4XS52YWx1ZSA9IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3NbaWR4XS5sYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpZHggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0SW5wdXROb2RlLnZhbHVlID0gcmVuZGVyZXIuZGVmYXVsdExhYmVsO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExhYmVsTm9kZS50ZXh0Q29udGVudCA9IHJlbmRlcmVyLmRlZmF1bHRMYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICB9XG4gICAgaGFuZGxlQ2hlY2tib3hDbGljayhldmVudCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBsYXN0RGVmYXVsdCwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgcmVtb3ZlU3ltYm9sU3R5bGVyUG9wb3Zlcih0aGlzLnBvcG92ZXJOb2RlKTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgaWYgKHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAocmVuZGVyZXIuZGVmYXVsdFN5bWJvbCkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRTeW1ib2wgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExhYmVsTm9kZS50ZXh0Q29udGVudCA9IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdElucHV0Tm9kZS52YWx1ZSA9IHN0cmluZ3MucGFuZWxzLnVuaXF1ZVZhbHVlLm90aGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCA9IGxhc3REZWZhdWx0LmRlZmF1bHRTeW1ib2w7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gdGhpcy5kZWZhdWx0TGFiZWxOb2RlLnRleHRDb250ZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJVbmlxdWVWYWx1ZS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclVuaXF1ZVZhbHVlQ3NzO1xuXG5jb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuY29uc3QgdW5pdE9wdGlvbnMgPSBzdHJpbmdzLnBhbmVscy52ZWN0b3JGaWVsZC51bml0T3B0aW9ucztcbmNvbnN0IFNwZWVkVW5pdE9wdGlvbnMgPSBbXG4gICAgeyBrZXk6IFwibWV0ZXItcGVyLXNlY29uZFwiLCB0aXRsZTogdW5pdE9wdGlvbnMuZXNyaU1ldGVyc1BlclNlY29uZCwgc2VsZWN0ZWQ6IGZhbHNlIH0sXG4gICAgeyBrZXk6IFwia2lsb21ldGVyLXBlci1ob3VyXCIsIHRpdGxlOiB1bml0T3B0aW9ucy5lc3JpS2lsb21ldGVyc1BlckhvdXIsIHNlbGVjdGVkOiBmYWxzZSB9LFxuICAgIHsga2V5OiBcImtub3RzXCIsIHRpdGxlOiB1bml0T3B0aW9ucy5lc3JpS25vdHMsIHNlbGVjdGVkOiBmYWxzZSB9LFxuICAgIHsga2V5OiBcImZlZXQtcGVyLXNlY29uZFwiLCB0aXRsZTogdW5pdE9wdGlvbnMuZXNyaUZlZXRQZXJTZWNvbmQsIHNlbGVjdGVkOiBmYWxzZSB9LFxuICAgIHsga2V5OiBcIm1pbGUtcGVyLWhvdXJcIiwgdGl0bGU6IHVuaXRPcHRpb25zLmVzcmlNaWxlc1BlckhvdXIsIHNlbGVjdGVkOiBmYWxzZSB9XG5dO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJWZWN0b3JGaWVsZENzcyA9IFwiOmhvc3R7d2lkdGg6MTAwJX0uZmxvdy1pdGVte2hlaWdodDoxMDAlfS52ZWN0b3ItZmllbGQtYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59LmludmVydC1zeW1ib2wtd3JhcHBlcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmludmVydC1zeW1ib2wtbWFyZ2lue21hcmdpbi1yaWdodDppbmhlcml0O21hcmdpbi1sZWZ0OjAuMzVyZW19LmFyY2dpcy0tcnRsIC5pbnZlcnQtc3ltYm9sLW1hcmdpbnttYXJnaW4tbGVmdDppbmhlcml0O21hcmdpbi1yaWdodDowLjM1cmVtfS5pbnZlcnQtc3ltYm9sLXN3aXRjaHtwYWRkaW5nLXRvcDo2cHh9Lm1hZ25pdHVkZS1pbnB1dC1zZWN0aW9ue2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjttYXJnaW4tdG9wOi0xMHB4O21hcmdpbi1ib3R0b206MTZweH0ubWFnbml0dWRlLWlucHV0e3dpZHRoOjQ4JX1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkQ2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGRCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkQmFja0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkRXJyb3JcIiwgNyk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgUHJvcGVydGllc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRG9uZSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIGN1cnJlbnQgc2V0dGluZ3Mgb24gdGhlIGxheWVyXG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclZlY3RvckZpZWxkQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFJlbmRlcmVyT2JqIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICBhcHBseVJhc3RlclJlbmRlcmVyKG9yaWdpbmFsUmVuZGVyZXJPYmosIGxheWVyKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGRDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlck9iaiA9IGxheWVyLnJlbmRlcmVyO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRJbnB1dCA9IHRoaXMuaW5wdXRVbml0Tm9kZS52YWx1ZTtcbiAgICAgICAgdGhpcy5jdXJyZW50T3V0cHV0ID0gdGhpcy5vdXRwdXRVbml0Tm9kZS52YWx1ZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGhpZGVMYXllclRpdGxlLCBsYXllciwgc3RyaW5ncywgaXNSVEwgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB0aXRsZSA9IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IHRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJWZWN0b3JGaWVsZEJhY2tDbGljay5lbWl0KCksIHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpIH0sIHRoaXMucmVuZGVyVmlzdWFsaXphdGlvbigpLCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVmlzdWFsaXphdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNsYXNzOiBcInZlY3Rvci1maWVsZC1ibG9ja1wiLCBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy52ZWN0b3JGaWVsZC52ZWN0b3JGaWVsZCwgb3BlbjogdHJ1ZSB9LCB0aGlzLnJlbmRlclN5bWJvbFN0eWxlU2VsZWN0b3IoKSwgdGhpcy5yZW5kZXJTeW1ib2xEZW5zaXR5U2xpZGVyKCksIHRoaXMucmVuZGVyU3ltYm9sU2NhbGluZ1NsaWRlcigpLCB0aGlzLnJlbmRlckludmVydFN5bWJvbHMoKSwgdGhpcy5yZW5kZXJNYWduaXR1ZGVSYW5nZSgpLCB0aGlzLnJlbmRlclVuaXRTZWxlY3RvcnMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJTeW1ib2xTdHlsZVNlbGVjdG9yKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy12ZWN0b3Itc3ltYm9sLWJ1dHRvblwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLnNlbGVjdE5vZGUgPSBub2RlKSwgb25BcmNnaXNTbWFydE1hcHBpbmdTZWxlY3RCZWZvcmVPcGVuOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMucG9wb3Zlck5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3Zlck9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nU2VsZWN0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgICAgICAgICBsZXQgc3R5bGUgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgaWYgKHN0eWxlLmluY2x1ZGVzKFwiYmVhdWZvcnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSB0aGlzLmdldEV4YWN0QmVhdWZvcnRVbml0KHJlbmRlcmVyLm91dHB1dFVuaXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0T3V0cHV0VW5pdChzdHlsZSwgcmVuZGVyZXIpO1xuICAgICAgICAgICAgICAgIHJlcXVlc3RXcmFwcGVyKGNyZWF0ZVZlY3RvckZpZWxkUmVuZGVyZXJGcm9tRXhpc3RpbmcoeyBzdHlsZTogc3R5bGUgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIucmVuZGVyZXIgPSByZXN1bHQucmVuZGVyZXI7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdE5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zZWxlY3ROb2RlKTtcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5zZWxlY3ROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJWZWN0b3JGaWVsZEVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbERlbnNpdHlTbGlkZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc3ltYm9sVGlsZVNpemUgfSA9IHJlbmRlcmVyIHx8IHt9O1xuICAgICAgICBjb25zdCBhZGp1c3RlZFRpbGVTaXplID0gMTAwIC8gc3ltYm9sVGlsZVNpemU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMudmVjdG9yRmllbGQuc3ltYm9sRGVuc2l0eSwgaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXJhc3Rlci1zbGlkZXJcIiwgeyByZW5kZXJlclR5cGU6IFwidmVjdG9yLWZpZWxkXCIsIHR5cGU6IFwiZGVuc2l0eVwiLCBtaW46IDEsIG1heDogNSwgdmFsdWVzOiBbTWF0aC5yb3VuZChhZGp1c3RlZFRpbGVTaXplICogMTApIC8gMTBdLCBwcmVjaXNpb246IDEsIG1pbkxhYmVsOiBzdHJpbmdzLnBhbmVscy5mbG93LmxvdywgbWF4TGFiZWw6IHN0cmluZ3MucGFuZWxzLmZsb3cuaGlnaCB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJTeW1ib2xTY2FsaW5nU2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIGNvbnN0IHsgbWluU2l6ZSwgbWF4U2l6ZSB9ID0gc2l6ZVZpc1ZhcjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy52ZWN0b3JGaWVsZC5zeW1ib2xTY2FsaW5nLCBoKFwiY2FsY2l0ZS1zbGlkZXJcIiwgeyBtaW46IDAsIG1pblZhbHVlOiBtaW5TaXplICE9PSBudWxsID8gbWluU2l6ZSA6IDIwLCBtYXg6IDEwMCwgbWF4VmFsdWU6IG1heFNpemUgIT09IG51bGwgPyBtYXhTaXplIDogODAsIHN0ZXA6IDEsIGxhYmVsSGFuZGxlczogdHJ1ZSwgbGFiZWxUaWNrczogdHJ1ZSwgcHJlY2lzZTogdHJ1ZSwgc25hcDogdHJ1ZSwgb25DYWxjaXRlU2xpZGVySW5wdXQ6IGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSB0aGlzLnN5bWJvbFNjYWxpbmdTbGlkZXJOb2RlLm1pblZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IHRoaXMuc3ltYm9sU2NhbGluZ1NsaWRlck5vZGUubWF4VmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTeW1ib2xTY2FsZUNoYW5nZShtaW4sIG1heCk7XG4gICAgICAgICAgICB9LCAzMDApLCByZWY6IChub2RlKSA9PiAodGhpcy5zeW1ib2xTY2FsaW5nU2xpZGVyTm9kZSA9IG5vZGUpIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckludmVydFN5bWJvbHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIGlzUlRMLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBsZXQgaXNDaGVja2VkID0gcmVuZGVyZXIuZmxvd1JlcHJlc2VudGF0aW9uICE9PSBcImZsb3ctZnJvbVwiO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbnZlcnQtc3ltYm9sLXdyYXBwZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiIH0sIGgoXCJzZWN0aW9uXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLmludmVydFN5bWJvbHMsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJpbnZlcnQtc3ltYm9sLW1hcmdpblwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgXCJpY29uLXN0YXJ0XCI6IFwiaW5mb3JtYXRpb25cIiwgc2NhbGU6IFwic1wiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck9wZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uTm9kZS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYnV0dG9uTm9kZSA9IG5vZGUpIH0pKSksIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGNsYXNzOiBcImludmVydC1zeW1ib2wtc3dpdGNoXCIsIHNjYWxlOiBcInNcIiwgbGFiZWw6IHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLmludmVydFN5bWJvbHMsIGNoZWNrZWQ6IGlzQ2hlY2tlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlSW52ZXJ0U3ltYm9sc0NoYW5nZShldmVudC5jdXJyZW50VGFyZ2V0LmNoZWNrZWQgPyBcImZsb3ctdG9cIiA6IFwiZmxvdy1mcm9tXCIpIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlck1hZ25pdHVkZVJhbmdlKCkge1xuICAgICAgICByZXR1cm4gaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLW1hZ25pdHVkZS1yYW5nZS1zbGlkZXJcIiwgbnVsbCk7XG4gICAgfVxuICAgIHJlbmRlclVuaXRTZWxlY3RvcnMoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5wYW5lbHMudmVjdG9yRmllbGQuY29udmVydE1hZ25pdHVkZSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLmlucHV0VW5pdHMsIHRoaXMucmVuZGVyVW5pdFNlbGVjdG9yKFwiaW5wdXRcIikpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy52ZWN0b3JGaWVsZC5vdXRwdXRVbml0cywgdGhpcy5yZW5kZXJVbml0U2VsZWN0b3IoXCJvdXRwdXRcIikpKSk7XG4gICAgfVxuICAgIHJlbmRlclVuaXRTZWxlY3Rvcih0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IGRpc2FibGVkID0gdHlwZSA9PT0gXCJvdXRwdXRcIiAmJlxuICAgICAgICAgICAgW1wid2luZC1iYXJiXCIsIFwib2NlYW4tY3VycmVudC1rblwiLCBcIm9jZWFuLWN1cnJlbnQtbVwiXS5pbmRleE9mKHJlbmRlcmVyLnN0eWxlKSA+IC0xO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNvbWJvYm94XCIsIHsgZGlzYWJsZWQ6IGRpc2FibGVkLCBrZXk6IHR5cGUgPT09IFwiaW5wdXRcIiA/IHJlbmRlcmVyLmlucHV0VW5pdCA6IHJlbmRlcmVyLm91dHB1dFVuaXQsIGxhYmVsOiB0eXBlID09PSBcImlucHV0XCJcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLmlucHV0VW5pdHNcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucGFuZWxzLnZlY3RvckZpZWxkLm91dHB1dFVuaXRzLCBjbGVhckRpc2FibGVkOiB0cnVlLCBzY2FsZTogXCJzXCIsIHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJvdXRwdXRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdXRwdXRVbml0Tm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0VW5pdE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25DYWxjaXRlQ29tYm9ib3hDaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJpbnB1dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VW5pdE5vZGUudmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRVbml0Tm9kZS52YWx1ZSA9IHRoaXMuY3VycmVudElucHV0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5wdXQgPSB0aGlzLmlucHV0VW5pdE5vZGUudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVVbml0U2VsZWN0Q2xpY2soXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm91dHB1dFVuaXROb2RlLnZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm91dHB1dFVuaXROb2RlLnZhbHVlID0gdGhpcy5jdXJyZW50T3V0cHV0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50T3V0cHV0ID0gdGhpcy5vdXRwdXRVbml0Tm9kZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVVuaXRTZWxlY3RDbGljayhcIm91dHB1dFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIFNwZWVkVW5pdE9wdGlvbnMubWFwKCh1bml0T3B0aW9uKSA9PiB0aGlzLnJlbmRlclVuaXRPcHRpb24odHlwZSwgdW5pdE9wdGlvbikpKSk7XG4gICAgfVxuICAgIHJlbmRlclVuaXRPcHRpb24odHlwZSwgdW5pdCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBzZWxlY3RlZFVuaXRPcHRpb24gPSBTcGVlZFVuaXRPcHRpb25zLmZpbmQoKHNwZWVkVW5pdE9wdGlvbikgPT4gdHlwZSA9PT0gXCJpbnB1dFwiXG4gICAgICAgICAgICA/IHNwZWVkVW5pdE9wdGlvbi5rZXkgPT09IHJlbmRlcmVyLmlucHV0VW5pdFxuICAgICAgICAgICAgOiBzcGVlZFVuaXRPcHRpb24ua2V5ID09PSByZW5kZXJlci5vdXRwdXRVbml0KTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jb21ib2JveC1pdGVtXCIsIHsgdmFsdWU6IHVuaXQua2V5LCB0ZXh0TGFiZWw6IHVuaXQudGl0bGUsIHNlbGVjdGVkOiBzZWxlY3RlZFVuaXRPcHRpb24gPyB1bml0ID09PSBzZWxlY3RlZFVuaXRPcHRpb24gOiBmYWxzZSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogdGhpcy5oYW5kbGVEb25lLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICBnZXRFeGFjdEJlYXVmb3J0VW5pdChvdXRwdXRVbml0KSB7XG4gICAgICAgIG91dHB1dFVuaXQgPSBvdXRwdXRVbml0ICE9PSBudWxsICYmIG91dHB1dFVuaXQgIT09IHZvaWQgMCA/IG91dHB1dFVuaXQgOiBcIm1ldGVyLXBlci1zZWNvbmRcIjtcbiAgICAgICAgc3dpdGNoIChvdXRwdXRVbml0KSB7XG4gICAgICAgICAgICBjYXNlIFwia25vdHNcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJiZWF1Zm9ydC1rblwiO1xuICAgICAgICAgICAgY2FzZSBcIm1ldGVyLXBlci1zZWNvbmRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJiZWF1Zm9ydC1tXCI7XG4gICAgICAgICAgICBjYXNlIFwibWlsZS1wZXItaG91clwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImJlYXVmb3J0LW1pXCI7XG4gICAgICAgICAgICBjYXNlIFwia2lsb21ldGVyLXBlci1ob3VyXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYmVhdWZvcnQta21cIjtcbiAgICAgICAgICAgIGNhc2UgXCJmZWV0LXBlci1zZWNvbmRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJiZWF1Zm9ydC1mdFwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlc2V0T3V0cHV0VW5pdChzdHlsZSwgcmVuZGVyZXIpIHtcbiAgICAgICAgbGV0IG91dHB1dFVuaXQ7XG4gICAgICAgIHN3aXRjaCAoc3R5bGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJvY2Vhbi1jdXJyZW50LWtuXCI6XG4gICAgICAgICAgICBjYXNlIFwid2luZC1iYXJiXCI6XG4gICAgICAgICAgICAgICAgb3V0cHV0VW5pdCA9IFwia25vdHNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJvY2Vhbi1jdXJyZW50LW1cIjpcbiAgICAgICAgICAgICAgICBvdXRwdXRVbml0ID0gXCJtZXRlci1wZXItc2Vjb25kXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG91dHB1dFVuaXQpIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLm91dHB1dFVuaXQgPSBvdXRwdXRVbml0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVN5bWJvbFNjYWxlQ2hhbmdlKG1pbiwgbWF4KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgc2l6ZVZpc1Zhci5taW5TaXplID0gbWluO1xuICAgICAgICBzaXplVmlzVmFyLm1heFNpemUgPSBtYXg7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGhhbmRsZUludmVydFN5bWJvbHNDaGFuZ2UoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHJlbmRlcmVyLmZsb3dSZXByZXNlbnRhdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgaGFuZGxlVW5pdFNlbGVjdENsaWNrKHR5cGUpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiaW5wdXRcIikge1xuICAgICAgICAgICAgcmVuZGVyZXIuaW5wdXRVbml0ID0gdGhpcy5pbnB1dFVuaXROb2RlLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyZXIub3V0cHV0VW5pdCA9IHRoaXMub3V0cHV0VW5pdE5vZGUudmFsdWU7XG4gICAgICAgICAgICBpZiAocmVuZGVyZXIuc3R5bGUuaW5jbHVkZXMoXCJiZWF1Zm9ydFwiKSkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnN0eWxlID0gdGhpcy5nZXRFeGFjdEJlYXVmb3J0VW5pdChyZW5kZXJlci5vdXRwdXRVbml0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICB0b2dnbGVQb3BvdmVyKCkge1xuICAgICAgICBjb25zdCB7IGZsb3dJdGVtTm9kZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1pbmZvLXBvcG92ZXJcIik7XG4gICAgICAgIHRoaXMucG9wb3Zlck5vZGUucHJvcHMgPSB7XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5wYW5lbHMudmVjdG9yRmllbGQuaW52ZXJ0U3ltYm9scyxcbiAgICAgICAgICAgIGZsb3dJdGVtTm9kZSxcbiAgICAgICAgICAgIG1vcmVJbmZvOiBzdHJpbmdzLnBhbmVscy52ZWN0b3JGaWVsZC5pbnZlcnRTeW1ib2xzVGlwXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucG9wb3Zlck5vZGUucmVmZXJlbmNlRWxlbWVudCA9IHRoaXMuYnV0dG9uTm9kZTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nSW5mb1BvcG92ZXJDbG9zZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVQb3BvdmVyKCk7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvbk5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5wb3BvdmVyTm9kZSk7XG4gICAgICAgIHRoaXMucG9wb3Zlck5vZGUuc2V0T3Blbih0cnVlKTtcbiAgICAgICAgdGhpcy5wb3BvdmVyT3BlbiA9IHRydWU7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVBvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVtb3ZlUG9wb3ZlcigpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keVxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcG9wb3ZlclwiKVxuICAgICAgICAgICAgLmZvckVhY2goKG5vZGUpID0+IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobm9kZSkpO1xuICAgICAgICB0aGlzLnBvcG92ZXJOb2RlID0gbnVsbDtcbiAgICAgICAgdGhpcy5wb3BvdmVyT3BlbiA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5kb2N1bWVudENsaWNrSGFuZGxlcikge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGQuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJWZWN0b3JGaWVsZENzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyQ2xhc3NCcmVha3MgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3Jhc3Rlcl9jbGFzc19icmVha3MsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckNvbG9ybWFwIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3BhbmVsc19yYXN0ZXJfY29sb3JtYXAsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlckZsb3cgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3Jhc3Rlcl9mbG93LCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJSZ2IgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3Jhc3Rlcl9yZ2IsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclNoYWRlZFJlbGllZiBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfcmFzdGVyX3NoYWRlZF9yZWxpZWYsIEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1Jhc3RlclN0cmV0Y2ggYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3Jhc3Rlcl9zdHJldGNoLCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNSYXN0ZXJVbmlxdWVWYWx1ZSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfcmFzdGVyX3VuaXF1ZV92YWx1ZSwgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmFzdGVyVmVjdG9yRmllbGQgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX3Jhc3Rlcl92ZWN0b3JfZmllbGQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXJhc3Rlci1jbGFzcy1icmVha3NfOC5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbi8qKlxuICogQ2FsbCBhIGZ1bmN0aW9uIG9ubHkgYWZ0ZXIgaXQgaGFzIG5vdCBiZWVuIGNhbGxlZCBmb3IgbiBtaWxsaXNlY29uZHNcbiAqIEBwYXJhbSBmbiAgICAtIGZ1bmN0aW9uIHRvIGNhbGxcbiAqIEBwYXJhbSBkZWxheSAtIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xuICovXG5jb25zdCBkZWJvdW5jZSA9IChmbiwgZGVsYXkpID0+IHtcbiAgICBsZXQgdGltZW91dDtcbiAgICBsZXQgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgZnVuY3Rpb24gZmx1c2goLi4uYXJncykge1xuICAgICAgICBzdGF0dXMgPSBcImZsdXNoZWRcIjtcbiAgICAgICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaW52b2tlKC4uLmFyZ3MpIHtcbiAgICAgICAgc3RhdHVzID0gXCJpbnZva2VkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNhbmNlbCguLi5hcmdzKSB7XG4gICAgICAgIHN0YXR1cyA9IFwiY2FuY2VsbGVkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFN0YXR1cygpIHtcbiAgICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICB9XG4gICAgY29uc3QgZGVib3VuY2VkID0gKC4uLmFyZ3MpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIFwiZmx1c2hlZFwiOlxuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJpbnZva2VkXCI6XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNhbmNlbGxlZFwiOlxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICB9LCBkZWxheSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBkZWJvdW5jZWQuZmx1c2ggPSBmbHVzaDtcbiAgICBkZWJvdW5jZWQuaW52b2tlID0gaW52b2tlO1xuICAgIGRlYm91bmNlZC5jYW5jZWwgPSBjYW5jZWw7XG4gICAgZGVib3VuY2VkLmdldFN0YXR1cyA9IGdldFN0YXR1cztcbiAgICByZXR1cm4gZGVib3VuY2VkO1xufTtcbi8qKlxuICogQ2FsbCBhIGZ1bmN0aW9uIG9ubHkgYWZ0ZXIgbiBtaWxsaXNlY29uZHMgaGF2ZSBlbGFwc2VkXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgdGhyb3R0bGUgPSAoZm4sIGRlbGF5KSA9PiB7XG4gICAgbGV0IHRpbWVvdXQ7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgIHRpbWVvdXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgfSwgZGVsYXkpO1xuICAgIH0pO1xufTtcbmZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCBcIlxcXFwkJlwiKTsgLy8gJCYgbWVhbnMgdGhlIHdob2xlIG1hdGNoZWQgc3RyaW5nXG59XG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogU2V0IGEgbWluaW11bSB0aW1lIGZvciBhIHByb21pc2UgdG8gcmVzb2x2ZSAodXNlZnVsIGZvciBwcmV2ZW50aW5nIGZsYXNoIG9mIGxvYWRlcnMpXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG1pbkRlbGF5KHByb21pc2UsIG1pbkRlbGF5KSB7XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoW3Byb21pc2UsIHRpbWVvdXQobWluRGVsYXkpXSk7XG4gICAgcmV0dXJuIHByb21pc2U7XG59XG4vKipcbiAqIEhlbHBlciBtZXRob2QgdG8gaW5saW5lIHNldFRpbWVvdXQgYXMgYW4gYXdhaXQgaW4gYXN5bmMgZnVuY3Rpb25zXG4gKi9cbmZ1bmN0aW9uIHRpbWVvdXQobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn1cbmNvbnN0IGFycmF5VG9Mb29rdXBNYXAgPSAoZGF0YUFyciwgZ2V0S2V5QW5kSXRlbSkgPT4gT2JqZWN0LmZyb21FbnRyaWVzKChkYXRhQXJyIHx8IFtdKS5tYXAoKGl0ZW0pID0+IHtcbiAgICBjb25zdCB7IGtleSwgZGF0YSB9ID0gZ2V0S2V5QW5kSXRlbShpdGVtKTtcbiAgICByZXR1cm4gW2tleSwgZGF0YV07XG59KSk7XG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdHdvIGFycmF5cyBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50c1xuICogYW5kIHdoZXRoZXIgdGhleSBjb250YWluIHRoZSBzYW1lIGVsZW1lbnRzXG4gKiByZWdhcmRsZXNzIG9mIG9yZGVyXG4gKi9cbmNvbnN0IGFycmF5c0FyZUVxdWl2YWxlbnQgPSAoYXJyMSwgYXJyMikgPT4gYXJyMS5sZW5ndGggPT09IGFycjIubGVuZ3RoICYmIGFycjEucmVkdWNlKChtZW1vLCBzdHIpID0+IG1lbW8gJiYgYXJyMi5pbmRleE9mKHN0cikgPiAtMSwgdHJ1ZSk7XG5mdW5jdGlvbiB1bmlxdWVCeShteUFyciwgZ2V0SXRlbUlkKSB7XG4gICAgY29uc3QgcmVzdWx0QXJyID0gW107XG4gICAgY29uc3QgbG9va3VwTWFwID0ge307XG4gICAgbXlBcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBpZCA9IGdldEl0ZW1JZChpdGVtKTtcbiAgICAgICAgaWYgKGxvb2t1cE1hcFtpZF0gPT0gbnVsbCkge1xuICAgICAgICAgICAgbG9va3VwTWFwW2lkXSA9IGl0ZW07XG4gICAgICAgICAgICByZXN1bHRBcnIucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHRBcnI7XG59XG5mdW5jdGlvbiB1bmlxdWUobXlBcnIpIHtcbiAgICBjb25zdCBwcmltaXRpdmVzID0geyBib29sZWFuOiB7fSwgbnVtYmVyOiB7fSwgc3RyaW5nOiB7fSB9O1xuICAgIGNvbnN0IG9ianMgPSBbXTtcbiAgICByZXR1cm4gbXlBcnIuZmlsdGVyKChpdGVtKSA9PiB7XG4gICAgICAgIGxldCB0eXBlID0gdHlwZW9mIGl0ZW07XG4gICAgICAgIGlmICh0eXBlIGluIHByaW1pdGl2ZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmltaXRpdmVzW3R5cGVdLmhhc093blByb3BlcnR5KGl0ZW0pID8gZmFsc2UgOiAocHJpbWl0aXZlc1t0eXBlXVtpdGVtXSA9IHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9ianMuaW5kZXhPZihpdGVtKSA+PSAwID8gZmFsc2UgOiBvYmpzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmNvbnN0IGNodW5rID0gKGFyciwgc2l6ZSkgPT4gWy4uLkFycmF5KE1hdGguY2VpbChhcnIubGVuZ3RoIC8gc2l6ZSkpXS5tYXAoKF8sIGkpID0+IGFyci5zbGljZShzaXplICogaSwgc2l6ZSArIHNpemUgKiBpKSk7XG5cbmV4cG9ydCB7IGFycmF5VG9Mb29rdXBNYXAgYXMgYSwgdW5pcXVlIGFzIGIsIHRocm90dGxlIGFzIGMsIGRlYm91bmNlIGFzIGQsIGVzY2FwZVJlZ0V4cCBhcyBlLCBhcnJheXNBcmVFcXVpdmFsZW50IGFzIGYsIGNodW5rIGFzIGcsIGlzRGVmaW5lZCBhcyBpLCBtaW5EZWxheSBhcyBtLCB0aW1lb3V0IGFzIHQsIHVuaXF1ZUJ5IGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZnVuY3Rpb25hbC00NGRlOGZjZi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmZ1bmN0aW9uIGlzSW5zaWRlSW5mb1BvcG92ZXJOb2RlKG5vZGUpIHtcbiAgICBpZiAoKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS50YWdOYW1lKSA9PT0gXCJBUkNHSVMtU01BUlQtTUFQUElORy1JTkZPLVBPUE9WRVJcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBwYXJlbnROb2RlID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIHdoaWxlIChwYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZS50YWdOYW1lID09PSBcIkFSQ0dJUy1TTUFSVC1NQVBQSU5HLUlORk8tUE9QT1ZFUlwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IHsgaXNJbnNpZGVJbmZvUG9wb3Zlck5vZGUgYXMgaSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wb3BvdmVyLTcyMWY3YmEyLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==