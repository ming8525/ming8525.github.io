"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-upload.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-upload.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_upload: () => (/* binding */ ArcgisNewItemPagesAppendUpload)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./analyze-69ec08c8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./overwrite-7eb8dfd4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-7eb8dfd4.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./item-types-586f0301.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js");
/* harmony import */ var _geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./geometries-6ca39907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/* harmony import */ var _basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./basic-6db7ebd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./publish-item-17d2f9a3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-17d2f9a3.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */












































/**
 * Different methods to delete item and reset add item store property
 */
async function deleteAddItemStateItem() {
    try {
        await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_7__.d)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, { permanentDelete: true });
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = null;
    }
    catch (error) {
        console.warn("Delete item failed", error);
    }
}

const arcgisNewItemPagesAppendUploadCss = ":host{overflow:hidden}.file-browser-container{display:block;height:95%}.file-browser-container--has-description{display:block;height:90%}.upload-step{margin-bottom:0px;display:block}.upload-step--header-with-description{margin-bottom:0.75rem;display:block}.read-only{z-index:50;display:block}.zip-select-heading{font-weight:500}";

const ArcgisNewItemPagesAppendUpload = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.fileSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "fileSelect", 7);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.sourceName = "";
        this.itemTypes = [
            { value: "File Geodatabase", icon: "data", publishable: true },
            { value: "Shapefile", icon: "file-zip", publishable: true }
        ];
        this.insideModal = true;
        this.fullHeight = true;
        this.selectedZipFile = "File Geodatabase";
        this.step = "upload";
        this.loading = undefined;
        this.loaderMessage = undefined;
        this.loaderType = "indeterminate";
        this.error = undefined;
        this.overwriteProcess = false;
        this.file = undefined;
        this.header = undefined;
        this.description = undefined;
    }
    async handlePrev(event) {
        event.preventDefault();
        if (this.loading) {
            return;
        }
        if (this.step === "analyzeZip") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null;
            this.step = "upload";
            return;
        }
        if (this.item.layers.length > 1) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer = null;
        }
        this.newItemPrevPage.emit();
    }
    async handleNext() {
        var _a;
        if (this.overwriteProcess && _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
            const { addAppendSelectOption } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            const emitPayload = Object.assign({ id: (_a = this.publishResponse) === null || _a === void 0 ? void 0 : _a.id, appendType: addAppendSelectOption, item: Object.assign({}, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a), overwriteStatus: this.overwriteStatus }, this.publishResponse);
            this.workflowComplete.emit(emitPayload);
            return;
        }
        if (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file) {
            this.handleError({ code: "providePath" });
            return;
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip") {
            this.step = "analyzeZip";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_11__.a[this.selectedZipFile].type;
            const response = await this.uploadAndAnalyzeFile();
            if (response) {
                this.nextStep();
            }
        }
    }
    // Triggered when a file is selected (via drop or button)
    async fileSelectHandler(event) {
        var _a;
        const file = event.detail.file;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.originalFileName = file.name;
        const { title, fileName, extension } = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_2__.s)(file, true);
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite" &&
            !(0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_2__.v)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.originalFileName, this.sourceName)) {
            this.handleError({ code: "useSameFileName" });
            return;
        }
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.title = title;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = file;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = extension;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type =
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && this.isEnterprise
                ? "Shapefile"
                : (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_12__.f)(extension, this.validTypes)[0].type;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsUniqueFile = true;
        if (((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer) === null || _a === void 0 ? void 0 : _a.geometryType) === "esriGeometryMultiPatch" &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type !== "File Geodatabase" &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type !== "Shapefile" &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption !== "update") {
            // Multipatch BUG: https://desktopqa/SFTriage/#/BUG-000156207
            this.step = "upload";
            this.handleError({ code: "multiPatchRestriction" });
            return;
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
            await this.handleOverwrite();
        }
        else {
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && !this.isEnterprise) {
                this.step = "analyzeZip";
            }
            else {
                this.step = "analyze";
                const response = await this.uploadAndAnalyzeFile();
                if (response) {
                    this.nextStep();
                }
            }
        }
    }
    async componentWillLoad() {
        var _a, _b, _c;
        const { existingItem, addAppendSelectOption } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { config, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        this.item = existingItem;
        this.sourceName = ((_a = this.item.sourceData) === null || _a === void 0 ? void 0 : _a.name) || this.item.name;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendUpload;
        this.config = config;
        this.isEnterprise = portal.isPortal;
        const sourceType = (_c = (_b = this.item) === null || _b === void 0 ? void 0 : _b.sourceData) === null || _c === void 0 ? void 0 : _c.type; //overwrite is disabled when sourceData is null.
        this.allowedExtensions =
            addAppendSelectOption === "overwrite"
                ? (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_12__.m)([
                    sourceType.toLowerCase() === "geojson" ? "GeoJson" : sourceType
                ])
                : portal.isPortal
                    ? _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_10__.c
                    : _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_10__.d;
        this.header = this.i18n.selectData;
        this.description = "";
        this.validTypes = Object.values(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_11__.a).filter((value) => {
            return value.appendUploadFormat;
        });
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
            await deleteAddItemStateItem();
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null; //reset store when user goes back to this page
    }
    async handleOverwrite() {
        const { existingItem, file, keepDescription } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.nextText = "proceed";
        const item = existingItem;
        this.loading = true;
        this.overwriteProcess = true;
        this.newItemToggleNavigationEnabled.emit(false);
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.append.appendLoadingMessages.overwriting;
        const { error } = await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.f)(item, item.itemOwner.userContentUrl, {
            // ! Use fetchUser if itemOwner is not available
            file,
            overwrite: true,
            keepDescription
        });
        if (error) {
            this.handleError(error);
            this.loading = false;
            return false;
        }
        try {
            this.publishResponse = await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.p)(existingItem, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.title, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
            await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.r)(item);
            await this.checkStatus(item);
        }
        catch (error) {
            this.handleError({ code: "unhandledError" });
            this.loading = false;
            return false;
        }
    }
    async checkStatus(item) {
        var _a;
        this.newItemToggleNavigationEnabled.emit(true);
        const response = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__.x)(item.id); //checking update of source data's job.
        this.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
        const emitPayload = Object.assign({ id: (_a = this.publishResponse) === null || _a === void 0 ? void 0 : _a.id, item: Object.assign({}, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a), overwriteStatus: this.overwriteStatus, appendType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption }, this.publishResponse);
        if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "completed") {
            emitPayload.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
            this.workflowComplete.emit(emitPayload);
            return;
        }
        else if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "failed") {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.nextText = "next";
            this.loading = false;
            this.handleError({ code: "unhandledError" });
        }
        return response;
    }
    nextStep() {
        var _a, _b, _c;
        //Determine next step in workflow.
        let nextPage = "appendSelectLayer";
        const { analyzeResults } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const publishParameters = analyzeResults.publishParameters;
        if (((_a = analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) === 1 ||
            !analyzeResults.publishParameters.layers) {
            //CSV is never multi-layered so does not have layers property
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataLayer = (_c = (_b = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _b === void 0 ? void 0 : _b[0]) !== null && _c !== void 0 ? _c : publishParameters;
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption !== "update") {
                const isCompatibleGeometries = (0,_geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_13__.c)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataLayer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type);
                if (!isCompatibleGeometries) {
                    this.handleError({ code: "incompatibleGeometries" });
                    return;
                }
            }
            if ((_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type === "Microsoft Excel" || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type === "CSV") &&
                (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === null || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === void 0 ? void 0 : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer.geometryType) === "esriGeometryPoint" &&
                (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === null || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === void 0 ? void 0 : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sourceDataLayer.type) !== "Table") {
                nextPage = "csvLocationFields";
            }
            else if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "add" &&
                (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.backupLayerFields.some((field) => field.type === "esriFieldTypeDate") ||
                    this.isEnterprise)) {
                nextPage = "appendMatchFields";
            }
            else {
                nextPage = "appendKeyPairSelect";
            }
        }
        this.newItemToggleNavigationEnabled.emit(true);
        this.newItemUpdatePage.emit(nextPage);
    }
    updateLoader(loaderType, loaderMessage) {
        this.loaderType = loaderType;
        this.loaderMessage = loaderMessage;
    }
    async uploadAndAnalyzeFile() {
        const { file, originalFileName, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { portal, user, config, lang } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        this.loading = true;
        this.newItemToggleNavigationEnabled.emit(false);
        this.updateLoader((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__.M ? "determinate" : "indeterminate", _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.append.appendLoadingMessages.uploading.replace("${fileName}", originalFileName));
        let error = null;
        ({ error } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_4__.y)()); //upload file includes check status
        if (error) {
            this.handleError(error);
            return false;
        }
        this.updateLoader("indeterminate", this.i18n.analyzing);
        ({ error } = await (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_5__.a)({
            analyzeArgs: { type: "item", itemid: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, workflow: "append" },
            itemArgs: { itemType: type },
            configArgs: { portal, user, config, lang },
            initialize: true
        }));
        if (error) {
            this.handleError(error);
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
                await deleteAddItemStateItem();
            }
        }
        return !error;
    }
    async handleError(error) {
        this.newItemToggleNavigationEnabled.emit(true);
        let errorTitle = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.error;
        let errorMessage = this.i18n.errors.errorWhileUpload;
        switch (error.code) {
            case "exceedsFileSize":
                errorMessage = this.i18n.errors.errorExceedFileSize;
                break;
            case "invalidFileGeodatabase":
                errorTitle = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidGeodatabase.title;
                errorMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidGeodatabase.description;
                break;
            case "invalidShapefile":
                errorTitle = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidShapefile.title;
                errorMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.itemProperties.invalidShapefile.description;
                break;
            case "useSameFileName":
                errorMessage = this.i18n.errors.sameFileName.replace("${x}", this.sourceName);
                break;
            case "providePath":
                errorMessage = this.i18n.errors.providePath;
                break;
            case "incompatibleGeometries":
                errorTitle = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningTitle;
                errorMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningDescription;
                break;
            case "multiPatchRestriction":
                errorTitle = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_9__.u.i18n.appendSelectLayer.sameGeometryWarningTitle;
                errorMessage = this.i18n.errors.multiPatchErrorDescription;
                break;
            case "unhandledError":
                if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite") {
                    errorMessage = this.i18n.errors.errorUpdate;
                }
                break;
        }
        if (error.code === "incompatibleGeometries" ||
            (error.code === "multiPatchRestriction" && _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id)) {
            //delete the temp item for incorrect file upload
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null;
            await deleteAddItemStateItem();
        }
        this.loading = false;
        this.error = { title: errorTitle, description: errorMessage };
    }
    renderPickZip() {
        const options = this.itemTypes.map(({ value, icon }) => ({
            optionTitle: this.i18n[value].title,
            value,
            description: this.i18n[value].description,
            icon
        }));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "zip-select" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "zip-select-heading" }, this.i18n.itemType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, Object.keys(options).map((key) => {
            const { icon, value, optionTitle, description } = options[key];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: value, checked: value === this.selectedZipFile, heading: optionTitle, description: description, icon: icon, name: "select-zip-file-for-append", "input-enabled": true, width: "full", type: "radio", value: value, onCalciteTileSelectChange: (e) => {
                    this.selectedZipFile = e.target.value;
                } }));
        }))));
    }
    render() {
        const { i18n, error, loaderType, loaderMessage, step, loading, config, sourceName, validTypes, allowedExtensions, isEnterprise } = this;
        const isOverwrite = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption === "overwrite";
        if (isOverwrite) {
            this.header = i18n.selectData;
            this.description = i18n.sameFileNameDescription.replace("${fileName}", sourceName);
        }
        const helpNumber = isEnterprise && isOverwrite ? "120004189" : "120001300";
        const helpLink = `${config.helpBase}${config.helpMap[helpNumber]}`;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, active: loading, text: loaderMessage }), step !== "analyzeZip" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "upload-step": true, "upload-step--header-with-description": isOverwrite } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: this.header, content: this.description }))), step !== "analyzeZip" && ( //Have file browser still present when error occurs in analyze
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "file-browser-container": true,
                "file-browser-container--has-description": isOverwrite
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-file-browser", { cloud: false, validTypes: validTypes, allowedExtensions: allowedExtensions, insideModal: true, config: config, helpText: i18n.learnMore, helpLink: helpLink, helpIdType: "append", fullHeight: true }))), step === "analyzeZip" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "analyze-step" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", { label: i18n.file }), _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension === "zip" && this.renderPickZip())), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendUpload.style = arcgisNewItemPagesAppendUploadCss;



//# sourceMappingURL=arcgis-new-item-pages-append-upload.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ checkCompatibleGeometries),
/* harmony export */   v: () => (/* binding */ verifyGeometries)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function verifyGeometries(args) {
    var _a, _b;
    const { dataLayer, type, sourceDataLayer } = args;
    const dataLayerGeometry = (_a = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) !== null && _a !== void 0 ? _a : (_b = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.layerInfo) === null || _b === void 0 ? void 0 : _b.geometryType;
    if (type === "Microsoft Excel" || type === "CSV") {
        if (((dataLayer.locationType === "address" && dataLayer.addressFields) || dataLayer.locationType === "coordinates") && //check location type is address in case "none" is selected and addressFields linger
            (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return null;
        }
        else if (!dataLayerGeometry || dataLayer.locationType === "none" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return { title: "noGeometryMatchTitle", description: "noGeometryTableMessage" };
        }
        else if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== dataLayerGeometry) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
    else {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType)) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
}
function checkCompatibleGeometries(dataLayer, sourceDataLayer, type) {
    if (type === "Microsoft Excel" || type === "CSV") {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return true;
        }
        else if (((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") &&
            (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.locationType) === "none") {
            return true;
        }
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return !!dataLayer.addressFields || dataLayer.locationType !== "none";
        }
        return false;
    }
    else {
        return (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table" || (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) === (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType);
    }
}



//# sourceMappingURL=geometries-6ca39907.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
    // Search item types extensions for the one imported
    let itemTypes;
    if (validationTypes) {
        itemTypes = validationTypes.map((value) => {
            return value.type;
        });
    }
    else {
        itemTypes = Object.keys(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a);
    }
    let possibleItemTypes = [];
    itemTypes.forEach((type) => {
        var _a;
        if (((_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
            possibleItemTypes.push(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
        }
    });
    return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
    if (!types) {
        return null;
    }
    return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
    return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
    return sizeInMB > 20; // 20MB
};



//# sourceMappingURL=item-types-586f0301.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTZmNWNlMC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3JEO0FBQ29DO0FBQ25CO0FBQzhDO0FBQ2xFO0FBQ007QUFDQztBQUN3RDtBQUMvRDtBQUM0QztBQUM5QjtBQUNpRDtBQUMxQztBQUM3QztBQUNEO0FBQ007QUFDUDtBQUNVO0FBQ0o7QUFDSDtBQUNLO0FBQ0o7QUFDSDtBQUNDO0FBQ0Y7QUFDRztBQUNIO0FBQ0M7QUFDUztBQUNIO0FBQ1A7QUFDQTtBQUNJO0FBQ0Y7QUFDQTtBQUNNO0FBQ0o7QUFDRztBQUNOO0FBQ007QUFDRTtBQUNGOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywyREFBVSxDQUFDLG9EQUFZLE9BQU8sdUJBQXVCO0FBQ25FLFFBQVEsb0RBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpREFBaUQsZ0JBQWdCLHdCQUF3QixjQUFjLFdBQVcseUNBQXlDLGNBQWMsV0FBVyxhQUFhLGtCQUFrQixjQUFjLHNDQUFzQyxzQkFBc0IsY0FBYyxXQUFXLFdBQVcsY0FBYyxvQkFBb0IsZ0JBQWdCOztBQUVuWDtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsMEJBQTBCLHFEQUFXO0FBQ3JDLGlDQUFpQyxxREFBVztBQUM1Qyw4Q0FBOEMscURBQVc7QUFDekQsK0JBQStCLHFEQUFXO0FBQzFDLGdDQUFnQyxxREFBVztBQUMzQztBQUNBO0FBQ0EsY0FBYyw0REFBNEQ7QUFDMUUsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFaUU7O0FBRWpFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEO0FBQ1k7O0FBRW5FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsZ0NBQWdDLHNEQUFrQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixzREFBa0I7QUFDckMsbUNBQW1DLHNEQUFrQjtBQUNyRDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLDBEQUFNLDJCQUEyQixRQUFRLGFBQWEsc0RBQWtCLDBEQUEwRDtBQUM3STtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjs7QUFFMEg7O0FBRTFIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC11cGxvYWQuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZ2VvbWV0cmllcy02Y2EzOTkwNy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pdGVtLXR5cGVzLTU4NmYwMzAxLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IHMgYXMgc2FuaXRpemVGaWxlSW5wdXQsIHYgYXMgdmFsaWRhdGVPdmVyd3JpdGVGaWxlTmFtZSB9IGZyb20gJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgeyBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcyc7XG5pbXBvcnQgeyB4IGFzIGdldEl0ZW1TdGF0dXMsIE0gYXMgTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFLCB5IGFzIHVwbG9hZEZpbGUgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItNTczYmI0NzMuanMnO1xuaW1wb3J0IHsgYSBhcyBhbmFseXplIH0gZnJvbSAnLi9hbmFseXplLTY5ZWMwOGM4LmpzJztcbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlbGV0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hBbmRVcGRhdGVJdGVtLCBwIGFzIHB1Ymxpc2hGb3JPdmVyd3JpdGUsIHIgYXMgcmVzZXRTZXJ2aWNlVGl0bGUgfSBmcm9tICcuL292ZXJ3cml0ZS03ZWI4ZGZkNC5qcyc7XG5pbXBvcnQgeyB1IGFzIHVpU3RvcmVTdGF0ZSB9IGZyb20gJy4vdWktYmNhN2JjZDEuanMnO1xuaW1wb3J0IHsgYyBhcyBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSwgZCBhcyBhcHBlbmRFeHRlbnNpb25zIH0gZnJvbSAnLi9hcHBlbmQtNGUxMTAzMmMuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuaW1wb3J0IHsgZiBhcyBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiwgbSBhcyBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTU4NmYwMzAxLmpzJztcbmltcG9ydCB7IGMgYXMgY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyB9IGZyb20gJy4vZ2VvbWV0cmllcy02Y2EzOTkwNy5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0ICcuL3VybC00YzNhZTU0Yy5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci03OWZiMzAyYy5qcyc7XG5pbXBvcnQgJy4vdGh1bWJuYWlsLWJjYjg5ZTY5LmpzJztcbmltcG9ydCAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9zZXJ2aWNlLThjMmM0MjQxLmpzJztcbmltcG9ydCAnLi91c2VyLTNlYTY5YzNhLmpzJztcbmltcG9ydCAnLi9xdWVyeS1kNjI2NjBkNC5qcyc7XG5pbXBvcnQgJy4vYXBpLTJlM2ExMzZmLmpzJztcbmltcG9ydCAnLi9zdHJpbmctNThhNWZlZjMuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vaXRlbS1jNThmZmNlZC5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci0xN2I2NDk0Ni5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC04MTM3M2Y2ZC5qcyc7XG5pbXBvcnQgJy4vYWdzLWViNDU4YTAzLmpzJztcbmltcG9ydCAnLi91cmwtMzU4NzVhMTAuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0ICcuL3N0b3JlLTZhODhlNmM1LmpzJztcbmltcG9ydCAnLi9iYXNpYy02ZGI3ZWJkNy5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0ICcuL2dlb2NvZGUtNjRlMGIwZDMuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNzQ2MzlkYWUuanMnO1xuaW1wb3J0ICcuL3B1Ymxpc2gtaXRlbS0xN2QyZjlhMy5qcyc7XG5pbXBvcnQgJy4vdGlsZS1sYXllci1jZjA0ZmE5Ny5qcyc7XG5cbi8qKlxuICogRGlmZmVyZW50IG1ldGhvZHMgdG8gZGVsZXRlIGl0ZW0gYW5kIHJlc2V0IGFkZCBpdGVtIHN0b3JlIHByb3BlcnR5XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFkZEl0ZW1TdGF0ZUl0ZW0oKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGVsZXRlSXRlbShhZGRJdGVtU3RhdGUuaWQsIHsgcGVybWFuZW50RGVsZXRlOiB0cnVlIH0pO1xuICAgICAgICBhZGRJdGVtU3RhdGUuaWQgPSBudWxsO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiRGVsZXRlIGl0ZW0gZmFpbGVkXCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFVwbG9hZENzcyA9IFwiOmhvc3R7b3ZlcmZsb3c6aGlkZGVufS5maWxlLWJyb3dzZXItY29udGFpbmVye2Rpc3BsYXk6YmxvY2s7aGVpZ2h0Ojk1JX0uZmlsZS1icm93c2VyLWNvbnRhaW5lci0taGFzLWRlc2NyaXB0aW9ue2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjkwJX0udXBsb2FkLXN0ZXB7bWFyZ2luLWJvdHRvbTowcHg7ZGlzcGxheTpibG9ja30udXBsb2FkLXN0ZXAtLWhlYWRlci13aXRoLWRlc2NyaXB0aW9ue21hcmdpbi1ib3R0b206MC43NXJlbTtkaXNwbGF5OmJsb2NrfS5yZWFkLW9ubHl7ei1pbmRleDo1MDtkaXNwbGF5OmJsb2NrfS56aXAtc2VsZWN0LWhlYWRpbmd7Zm9udC13ZWlnaHQ6NTAwfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRVcGxvYWQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmZpbGVTZWxlY3QgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZpbGVTZWxlY3RcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVByZXZQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMuc291cmNlTmFtZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuaXRlbVR5cGVzID0gW1xuICAgICAgICAgICAgeyB2YWx1ZTogXCJGaWxlIEdlb2RhdGFiYXNlXCIsIGljb246IFwiZGF0YVwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJTaGFwZWZpbGVcIiwgaWNvbjogXCJmaWxlLXppcFwiLCBwdWJsaXNoYWJsZTogdHJ1ZSB9XG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuaW5zaWRlTW9kYWwgPSB0cnVlO1xuICAgICAgICB0aGlzLmZ1bGxIZWlnaHQgPSB0cnVlO1xuICAgICAgICB0aGlzLnNlbGVjdGVkWmlwRmlsZSA9IFwiRmlsZSBHZW9kYXRhYmFzZVwiO1xuICAgICAgICB0aGlzLnN0ZXAgPSBcInVwbG9hZFwiO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3ZlcndyaXRlUHJvY2VzcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZpbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGVhZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVQcmV2KGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGVwID09PSBcImFuYWx5emVaaXBcIikge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5zdGVwID0gXCJ1cGxvYWRcIjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pdGVtLmxheWVycy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKHRoaXMub3ZlcndyaXRlUHJvY2VzcyAmJiBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcIm92ZXJ3cml0ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB7IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgY29uc3QgZW1pdFBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgaWQ6IChfYSA9IHRoaXMucHVibGlzaFJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQsIGFwcGVuZFR5cGU6IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiwgaXRlbTogT2JqZWN0LmFzc2lnbih7fSwgYWRkSXRlbVN0YXRlKSwgb3ZlcndyaXRlU3RhdHVzOiB0aGlzLm92ZXJ3cml0ZVN0YXR1cyB9LCB0aGlzLnB1Ymxpc2hSZXNwb25zZSk7XG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChlbWl0UGF5bG9hZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhZGRJdGVtU3RhdGUuZmlsZSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7IGNvZGU6IFwicHJvdmlkZVBhdGhcIiB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9PT0gXCJ6aXBcIikge1xuICAgICAgICAgICAgdGhpcy5zdGVwID0gXCJhbmFseXplWmlwXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0aGlzLnNlbGVjdGVkWmlwRmlsZV0udHlwZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy51cGxvYWRBbmRBbmFseXplRmlsZSgpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0U3RlcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgZmlsZSBpcyBzZWxlY3RlZCAodmlhIGRyb3Agb3IgYnV0dG9uKVxuICAgIGFzeW5jIGZpbGVTZWxlY3RIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgZmlsZSA9IGV2ZW50LmRldGFpbC5maWxlO1xuICAgICAgICBhZGRJdGVtU3RhdGUub3JpZ2luYWxGaWxlTmFtZSA9IGZpbGUubmFtZTtcbiAgICAgICAgY29uc3QgeyB0aXRsZSwgZmlsZU5hbWUsIGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgdHJ1ZSk7XG4gICAgICAgIGlmIChhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcIm92ZXJ3cml0ZVwiICYmXG4gICAgICAgICAgICAhdmFsaWRhdGVPdmVyd3JpdGVGaWxlTmFtZShhZGRJdGVtU3RhdGUub3JpZ2luYWxGaWxlTmFtZSwgdGhpcy5zb3VyY2VOYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7IGNvZGU6IFwidXNlU2FtZUZpbGVOYW1lXCIgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZmlsZSA9IGZpbGU7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImZpbGVcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9IGV4dGVuc2lvbjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPVxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9PT0gXCJ6aXBcIiAmJiB0aGlzLmlzRW50ZXJwcmlzZVxuICAgICAgICAgICAgICAgID8gXCJTaGFwZWZpbGVcIlxuICAgICAgICAgICAgICAgIDogZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uLCB0aGlzLnZhbGlkVHlwZXMpWzBdLnR5cGU7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGRBc1VuaXF1ZUZpbGUgPSB0cnVlO1xuICAgICAgICBpZiAoKChfYSA9IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeU11bHRpUGF0Y2hcIiAmJlxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgIT09IFwiRmlsZSBHZW9kYXRhYmFzZVwiICYmXG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudHlwZSAhPT0gXCJTaGFwZWZpbGVcIiAmJlxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiAhPT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgLy8gTXVsdGlwYXRjaCBCVUc6IGh0dHBzOi8vZGVza3RvcHFhL1NGVHJpYWdlLyMvQlVHLTAwMDE1NjIwN1xuICAgICAgICAgICAgdGhpcy5zdGVwID0gXCJ1cGxvYWRcIjtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcIm11bHRpUGF0Y2hSZXN0cmljdGlvblwiIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcIm92ZXJ3cml0ZVwiKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZU92ZXJ3cml0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIgJiYgIXRoaXMuaXNFbnRlcnByaXNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGVwID0gXCJhbmFseXplWmlwXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0ZXAgPSBcImFuYWx5emVcIjtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMudXBsb2FkQW5kQW5hbHl6ZUZpbGUoKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0U3RlcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIGNvbnN0IHsgZXhpc3RpbmdJdGVtLCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgeyBjb25maWcsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIHRoaXMuaXRlbSA9IGV4aXN0aW5nSXRlbTtcbiAgICAgICAgdGhpcy5zb3VyY2VOYW1lID0gKChfYSA9IHRoaXMuaXRlbS5zb3VyY2VEYXRhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZSkgfHwgdGhpcy5pdGVtLm5hbWU7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFVwbG9hZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgICAgIHRoaXMuaXNFbnRlcnByaXNlID0gcG9ydGFsLmlzUG9ydGFsO1xuICAgICAgICBjb25zdCBzb3VyY2VUeXBlID0gKF9jID0gKF9iID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc291cmNlRGF0YSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnR5cGU7IC8vb3ZlcndyaXRlIGlzIGRpc2FibGVkIHdoZW4gc291cmNlRGF0YSBpcyBudWxsLlxuICAgICAgICB0aGlzLmFsbG93ZWRFeHRlbnNpb25zID1cbiAgICAgICAgICAgIGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJvdmVyd3JpdGVcIlxuICAgICAgICAgICAgICAgID8gbWFwSXRlbVR5cGVzVG9GaWxlRXh0ZW5zaW9ucyhbXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJnZW9qc29uXCIgPyBcIkdlb0pzb25cIiA6IHNvdXJjZVR5cGVcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIDogcG9ydGFsLmlzUG9ydGFsXG4gICAgICAgICAgICAgICAgICAgID8gYXBwZW5kRXh0ZW5zaW9uc0ZvckVudGVycHJpc2VcbiAgICAgICAgICAgICAgICAgICAgOiBhcHBlbmRFeHRlbnNpb25zO1xuICAgICAgICB0aGlzLmhlYWRlciA9IHRoaXMuaTE4bi5zZWxlY3REYXRhO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgdGhpcy52YWxpZFR5cGVzID0gT2JqZWN0LnZhbHVlcyhhZGRDcmVhdGVJdGVtVHlwZXMpLmZpbHRlcigodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5hcHBlbmRVcGxvYWRGb3JtYXQ7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmlkKSB7XG4gICAgICAgICAgICBhd2FpdCBkZWxldGVBZGRJdGVtU3RhdGVJdGVtKCk7XG4gICAgICAgIH1cbiAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsOyAvL3Jlc2V0IHN0b3JlIHdoZW4gdXNlciBnb2VzIGJhY2sgdG8gdGhpcyBwYWdlXG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU92ZXJ3cml0ZSgpIHtcbiAgICAgICAgY29uc3QgeyBleGlzdGluZ0l0ZW0sIGZpbGUsIGtlZXBEZXNjcmlwdGlvbiB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcInByb2NlZWRcIjtcbiAgICAgICAgY29uc3QgaXRlbSA9IGV4aXN0aW5nSXRlbTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vdmVyd3JpdGVQcm9jZXNzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChmYWxzZSk7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMub3ZlcndyaXRpbmc7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IGZldGNoQW5kVXBkYXRlSXRlbShpdGVtLCBpdGVtLml0ZW1Pd25lci51c2VyQ29udGVudFVybCwge1xuICAgICAgICAgICAgLy8gISBVc2UgZmV0Y2hVc2VyIGlmIGl0ZW1Pd25lciBpcyBub3QgYXZhaWxhYmxlXG4gICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgb3ZlcndyaXRlOiB0cnVlLFxuICAgICAgICAgICAga2VlcERlc2NyaXB0aW9uXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMucHVibGlzaFJlc3BvbnNlID0gYXdhaXQgcHVibGlzaEZvck92ZXJ3cml0ZShleGlzdGluZ0l0ZW0sIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsIGNvbmZpZ1N0YXRlLnBvcnRhbCwgY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgICAgICBhd2FpdCByZXNldFNlcnZpY2VUaXRsZShpdGVtKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hlY2tTdGF0dXMoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0pO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY2hlY2tTdGF0dXMoaXRlbSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQodHJ1ZSk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0SXRlbVN0YXR1cyhpdGVtLmlkKTsgLy9jaGVja2luZyB1cGRhdGUgb2Ygc291cmNlIGRhdGEncyBqb2IuXG4gICAgICAgIHRoaXMub3ZlcndyaXRlU3RhdHVzID0gcmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnN0YXR1cztcbiAgICAgICAgY29uc3QgZW1pdFBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgaWQ6IChfYSA9IHRoaXMucHVibGlzaFJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQsIGl0ZW06IE9iamVjdC5hc3NpZ24oe30sIGFkZEl0ZW1TdGF0ZSksIG92ZXJ3cml0ZVN0YXR1czogdGhpcy5vdmVyd3JpdGVTdGF0dXMsIGFwcGVuZFR5cGU6IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gfSwgdGhpcy5wdWJsaXNoUmVzcG9uc2UpO1xuICAgICAgICBpZiAoKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXMudG9Mb3dlckNhc2UoKSkgPT09IFwiY29tcGxldGVkXCIpIHtcbiAgICAgICAgICAgIGVtaXRQYXlsb2FkLm92ZXJ3cml0ZVN0YXR1cyA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXM7XG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChlbWl0UGF5bG9hZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXMudG9Mb3dlckNhc2UoKSkgPT09IFwiZmFpbGVkXCIpIHtcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwibmV4dFwiO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgbmV4dFN0ZXAoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICAvL0RldGVybWluZSBuZXh0IHN0ZXAgaW4gd29ya2Zsb3cuXG4gICAgICAgIGxldCBuZXh0UGFnZSA9IFwiYXBwZW5kU2VsZWN0TGF5ZXJcIjtcbiAgICAgICAgY29uc3QgeyBhbmFseXplUmVzdWx0cyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9IGFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzO1xuICAgICAgICBpZiAoKChfYSA9IGFuYWx5emVSZXN1bHRzLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPT09IDEgfHxcbiAgICAgICAgICAgICFhbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpIHtcbiAgICAgICAgICAgIC8vQ1NWIGlzIG5ldmVyIG11bHRpLWxheWVyZWQgc28gZG9lcyBub3QgaGF2ZSBsYXllcnMgcHJvcGVydHlcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIgPSAoX2MgPSAoX2IgPSBwdWJsaXNoUGFyYW1ldGVycyA9PT0gbnVsbCB8fCBwdWJsaXNoUGFyYW1ldGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0pICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHB1Ymxpc2hQYXJhbWV0ZXJzO1xuICAgICAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gIT09IFwidXBkYXRlXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0NvbXBhdGlibGVHZW9tZXRyaWVzID0gY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyhhZGRJdGVtU3RhdGUuZGF0YUxheWVyLCBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLCBhZGRJdGVtU3RhdGUudHlwZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0NvbXBhdGlibGVHZW9tZXRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcImluY29tcGF0aWJsZUdlb21ldHJpZXNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgYWRkSXRlbVN0YXRlLnR5cGUgPT09IFwiQ1NWXCIpICYmXG4gICAgICAgICAgICAgICAgKGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiICYmXG4gICAgICAgICAgICAgICAgKGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5zb3VyY2VEYXRhTGF5ZXIudHlwZSkgIT09IFwiVGFibGVcIikge1xuICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJjc3ZMb2NhdGlvbkZpZWxkc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiAmJlxuICAgICAgICAgICAgICAgICghYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzLnNvbWUoKGZpZWxkKSA9PiBmaWVsZC50eXBlID09PSBcImVzcmlGaWVsZFR5cGVEYXRlXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFbnRlcnByaXNlKSkge1xuICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJhcHBlbmRNYXRjaEZpZWxkc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV4dFBhZ2UgPSBcImFwcGVuZEtleVBhaXJTZWxlY3RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KHRydWUpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFBhZ2UpO1xuICAgIH1cbiAgICB1cGRhdGVMb2FkZXIobG9hZGVyVHlwZSwgbG9hZGVyTWVzc2FnZSkge1xuICAgICAgICB0aGlzLmxvYWRlclR5cGUgPSBsb2FkZXJUeXBlO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSBsb2FkZXJNZXNzYWdlO1xuICAgIH1cbiAgICBhc3luYyB1cGxvYWRBbmRBbmFseXplRmlsZSgpIHtcbiAgICAgICAgY29uc3QgeyBmaWxlLCBvcmlnaW5hbEZpbGVOYW1lLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIGxhbmcgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5zaXplKSA+IE1VTFRJX1BBUlRfVVBMT0FEX01JTklNVU1fU0laRSA/IFwiZGV0ZXJtaW5hdGVcIiA6IFwiaW5kZXRlcm1pbmF0ZVwiLCB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmQuYXBwZW5kTG9hZGluZ01lc3NhZ2VzLnVwbG9hZGluZy5yZXBsYWNlKFwiJHtmaWxlTmFtZX1cIiwgb3JpZ2luYWxGaWxlTmFtZSkpO1xuICAgICAgICBsZXQgZXJyb3IgPSBudWxsO1xuICAgICAgICAoeyBlcnJvciB9ID0gYXdhaXQgdXBsb2FkRmlsZSgpKTsgLy91cGxvYWQgZmlsZSBpbmNsdWRlcyBjaGVjayBzdGF0dXNcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZUxvYWRlcihcImluZGV0ZXJtaW5hdGVcIiwgdGhpcy5pMThuLmFuYWx5emluZyk7XG4gICAgICAgICh7IGVycm9yIH0gPSBhd2FpdCBhbmFseXplKHtcbiAgICAgICAgICAgIGFuYWx5emVBcmdzOiB7IHR5cGU6IFwiaXRlbVwiLCBpdGVtaWQ6IGFkZEl0ZW1TdGF0ZS5pZCwgd29ya2Zsb3c6IFwiYXBwZW5kXCIgfSxcbiAgICAgICAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICAgICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0sXG4gICAgICAgICAgICBpbml0aWFsaXplOiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIGlmIChhZGRJdGVtU3RhdGUuaWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVBZGRJdGVtU3RhdGVJdGVtKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICFlcnJvcjtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgbGV0IGVycm9yVGl0bGUgPSB1aVN0b3JlU3RhdGUuaTE4bi5lcnJvcjtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5lcnJvcnMuZXJyb3JXaGlsZVVwbG9hZDtcbiAgICAgICAgc3dpdGNoIChlcnJvci5jb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFwiZXhjZWVkc0ZpbGVTaXplXCI6XG4gICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVycm9ycy5lcnJvckV4Y2VlZEZpbGVTaXplO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImludmFsaWRGaWxlR2VvZGF0YWJhc2VcIjpcbiAgICAgICAgICAgICAgICBlcnJvclRpdGxlID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVByb3BlcnRpZXMuaW52YWxpZEdlb2RhdGFiYXNlLnRpdGxlO1xuICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLml0ZW1Qcm9wZXJ0aWVzLmludmFsaWRHZW9kYXRhYmFzZS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJpbnZhbGlkU2hhcGVmaWxlXCI6XG4gICAgICAgICAgICAgICAgZXJyb3JUaXRsZSA9IHVpU3RvcmVTdGF0ZS5pMThuLml0ZW1Qcm9wZXJ0aWVzLmludmFsaWRTaGFwZWZpbGUudGl0bGU7XG4gICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVByb3BlcnRpZXMuaW52YWxpZFNoYXBlZmlsZS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ1c2VTYW1lRmlsZU5hbWVcIjpcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3JzLnNhbWVGaWxlTmFtZS5yZXBsYWNlKFwiJHt4fVwiLCB0aGlzLnNvdXJjZU5hbWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInByb3ZpZGVQYXRoXCI6XG4gICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVycm9ycy5wcm92aWRlUGF0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJpbmNvbXBhdGlibGVHZW9tZXRyaWVzXCI6XG4gICAgICAgICAgICAgICAgZXJyb3JUaXRsZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFNlbGVjdExheWVyLnNhbWVHZW9tZXRyeVdhcm5pbmdUaXRsZTtcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3RMYXllci5zYW1lR2VvbWV0cnlXYXJuaW5nRGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibXVsdGlQYXRjaFJlc3RyaWN0aW9uXCI6XG4gICAgICAgICAgICAgICAgZXJyb3JUaXRsZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZFNlbGVjdExheWVyLnNhbWVHZW9tZXRyeVdhcm5pbmdUaXRsZTtcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uZXJyb3JzLm11bHRpUGF0Y2hFcnJvckRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInVuaGFuZGxlZEVycm9yXCI6XG4gICAgICAgICAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVycm9ycy5lcnJvclVwZGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiaW5jb21wYXRpYmxlR2VvbWV0cmllc1wiIHx8XG4gICAgICAgICAgICAoZXJyb3IuY29kZSA9PT0gXCJtdWx0aVBhdGNoUmVzdHJpY3Rpb25cIiAmJiBhZGRJdGVtU3RhdGUuaWQpKSB7XG4gICAgICAgICAgICAvL2RlbGV0ZSB0aGUgdGVtcCBpdGVtIGZvciBpbmNvcnJlY3QgZmlsZSB1cGxvYWRcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlID0gbnVsbDtcbiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZUFkZEl0ZW1TdGF0ZUl0ZW0oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHsgdGl0bGU6IGVycm9yVGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvck1lc3NhZ2UgfTtcbiAgICB9XG4gICAgcmVuZGVyUGlja1ppcCgpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuaXRlbVR5cGVzLm1hcCgoeyB2YWx1ZSwgaWNvbiB9KSA9PiAoe1xuICAgICAgICAgICAgb3B0aW9uVGl0bGU6IHRoaXMuaTE4blt2YWx1ZV0udGl0bGUsXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG5bdmFsdWVdLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgaWNvblxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJ6aXAtc2VsZWN0XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInppcC1zZWxlY3QtaGVhZGluZ1wiIH0sIHRoaXMuaTE4bi5pdGVtVHlwZSksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIsIGNsYXNzOiBcInRpbGUtc2VsZWN0XCIgfSwgT2JqZWN0LmtleXMob3B0aW9ucykubWFwKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaWNvbiwgdmFsdWUsIG9wdGlvblRpdGxlLCBkZXNjcmlwdGlvbiB9ID0gb3B0aW9uc1trZXldO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGtleTogdmFsdWUsIGNoZWNrZWQ6IHZhbHVlID09PSB0aGlzLnNlbGVjdGVkWmlwRmlsZSwgaGVhZGluZzogb3B0aW9uVGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwgaWNvbjogaWNvbiwgbmFtZTogXCJzZWxlY3QtemlwLWZpbGUtZm9yLWFwcGVuZFwiLCBcImlucHV0LWVuYWJsZWRcIjogdHJ1ZSwgd2lkdGg6IFwiZnVsbFwiLCB0eXBlOiBcInJhZGlvXCIsIHZhbHVlOiB2YWx1ZSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFppcEZpbGUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICB9IH0pKTtcbiAgICAgICAgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBlcnJvciwgbG9hZGVyVHlwZSwgbG9hZGVyTWVzc2FnZSwgc3RlcCwgbG9hZGluZywgY29uZmlnLCBzb3VyY2VOYW1lLCB2YWxpZFR5cGVzLCBhbGxvd2VkRXh0ZW5zaW9ucywgaXNFbnRlcnByaXNlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBpc092ZXJ3cml0ZSA9IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwib3ZlcndyaXRlXCI7XG4gICAgICAgIGlmIChpc092ZXJ3cml0ZSkge1xuICAgICAgICAgICAgdGhpcy5oZWFkZXIgPSBpMThuLnNlbGVjdERhdGE7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gaTE4bi5zYW1lRmlsZU5hbWVEZXNjcmlwdGlvbi5yZXBsYWNlKFwiJHtmaWxlTmFtZX1cIiwgc291cmNlTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVscE51bWJlciA9IGlzRW50ZXJwcmlzZSAmJiBpc092ZXJ3cml0ZSA/IFwiMTIwMDA0MTg5XCIgOiBcIjEyMDAwMTMwMFwiO1xuICAgICAgICBjb25zdCBoZWxwTGluayA9IGAke2NvbmZpZy5oZWxwQmFzZX0ke2NvbmZpZy5oZWxwTWFwW2hlbHBOdW1iZXJdfWA7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiB7IFwib3ZlcmZsb3ctaGlkZGVuXCI6IGxvYWRpbmcgfSB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IHR5cGU6IGxvYWRlclR5cGUsIGFjdGl2ZTogbG9hZGluZywgdGV4dDogbG9hZGVyTWVzc2FnZSB9KSwgc3RlcCAhPT0gXCJhbmFseXplWmlwXCIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogeyBcInVwbG9hZC1zdGVwXCI6IHRydWUsIFwidXBsb2FkLXN0ZXAtLWhlYWRlci13aXRoLWRlc2NyaXB0aW9uXCI6IGlzT3ZlcndyaXRlIH0gfSwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogdGhpcy5oZWFkZXIsIGNvbnRlbnQ6IHRoaXMuZGVzY3JpcHRpb24gfSkpKSwgc3RlcCAhPT0gXCJhbmFseXplWmlwXCIgJiYgKCAvL0hhdmUgZmlsZSBicm93c2VyIHN0aWxsIHByZXNlbnQgd2hlbiBlcnJvciBvY2N1cnMgaW4gYW5hbHl6ZVxuICAgICAgICBoKFwiZGl2XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImZpbGUtYnJvd3Nlci1jb250YWluZXJcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImZpbGUtYnJvd3Nlci1jb250YWluZXItLWhhcy1kZXNjcmlwdGlvblwiOiBpc092ZXJ3cml0ZVxuICAgICAgICAgICAgfSB9LCBoKFwiYXJjZ2lzLWZpbGUtYnJvd3NlclwiLCB7IGNsb3VkOiBmYWxzZSwgdmFsaWRUeXBlczogdmFsaWRUeXBlcywgYWxsb3dlZEV4dGVuc2lvbnM6IGFsbG93ZWRFeHRlbnNpb25zLCBpbnNpZGVNb2RhbDogdHJ1ZSwgY29uZmlnOiBjb25maWcsIGhlbHBUZXh0OiBpMThuLmxlYXJuTW9yZSwgaGVscExpbms6IGhlbHBMaW5rLCBoZWxwSWRUeXBlOiBcImFwcGVuZFwiLCBmdWxsSGVpZ2h0OiB0cnVlIH0pKSksIHN0ZXAgPT09IFwiYW5hbHl6ZVppcFwiICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYW5hbHl6ZS1zdGVwXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1pbnB1dC1yZWFkb25seVwiLCB7IGxhYmVsOiBpMThuLmZpbGUgfSksIGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPT09IFwiemlwXCIgJiYgdGhpcy5yZW5kZXJQaWNrWmlwKCkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci50aXRsZSwgZGVzY3JpcHRpb246IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5kZXNjcmlwdGlvbiwgbGluazogeyBocmVmOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubGluaywgdGl0bGU6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rVGV4dCB9LCBhY3RpdmU6ICEhZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRVcGxvYWQuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRVcGxvYWRDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFVwbG9hZCBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfYXBwZW5kX3VwbG9hZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLXVwbG9hZC5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmZ1bmN0aW9uIHZlcmlmeUdlb21ldHJpZXMoYXJncykge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyBkYXRhTGF5ZXIsIHR5cGUsIHNvdXJjZURhdGFMYXllciB9ID0gYXJncztcbiAgICBjb25zdCBkYXRhTGF5ZXJHZW9tZXRyeSA9IChfYSA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5sYXllckluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5nZW9tZXRyeVR5cGU7XG4gICAgaWYgKHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgdHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICBpZiAoKChkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJiBkYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkcykgfHwgZGF0YUxheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJjb29yZGluYXRlc1wiKSAmJiAvL2NoZWNrIGxvY2F0aW9uIHR5cGUgaXMgYWRkcmVzcyBpbiBjYXNlIFwibm9uZVwiIGlzIHNlbGVjdGVkIGFuZCBhZGRyZXNzRmllbGRzIGxpbmdlclxuICAgICAgICAgICAgKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFkYXRhTGF5ZXJHZW9tZXRyeSB8fCBkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcIm5vbmVcIiB8fCAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLnR5cGUpID09PSBcIlRhYmxlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiBcIm5vR2VvbWV0cnlNYXRjaFRpdGxlXCIsIGRlc2NyaXB0aW9uOiBcIm5vR2VvbWV0cnlUYWJsZU1lc3NhZ2VcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSAhPT0gZGF0YUxheWVyR2VvbWV0cnkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiBcIm5vR2VvbWV0cnlNYXRjaFRpdGxlXCIsIGRlc2NyaXB0aW9uOiBcIm5vR2VvbWV0cnlNYXRjaE1lc3NhZ2VcIiB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSAoZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiBcIm5vR2VvbWV0cnlNYXRjaFRpdGxlXCIsIGRlc2NyaXB0aW9uOiBcIm5vR2VvbWV0cnlNYXRjaE1lc3NhZ2VcIiB9O1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyhkYXRhTGF5ZXIsIHNvdXJjZURhdGFMYXllciwgdHlwZSkge1xuICAgIGlmICh0eXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiIHx8IHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICAgICAgaWYgKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiKSAmJlxuICAgICAgICAgICAgKGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5sb2NhdGlvblR5cGUpID09PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gISFkYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkcyB8fCBkYXRhTGF5ZXIubG9jYXRpb25UeXBlICE9PSBcIm5vbmVcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci50eXBlKSA9PT0gXCJUYWJsZVwiIHx8IChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSA9PT0gKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgY2hlY2tDb21wYXRpYmxlR2VvbWV0cmllcyBhcyBjLCB2ZXJpZnlHZW9tZXRyaWVzIGFzIHYgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2VvbWV0cmllcy02Y2EzOTkwNy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGIgYXMgdW5pcXVlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcblxuZnVuY3Rpb24gZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uLCB2YWxpZGF0aW9uVHlwZXMpIHtcbiAgICAvLyBTZWFyY2ggaXRlbSB0eXBlcyBleHRlbnNpb25zIGZvciB0aGUgb25lIGltcG9ydGVkXG4gICAgbGV0IGl0ZW1UeXBlcztcbiAgICBpZiAodmFsaWRhdGlvblR5cGVzKSB7XG4gICAgICAgIGl0ZW1UeXBlcyA9IHZhbGlkYXRpb25UeXBlcy5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudHlwZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpdGVtVHlwZXMgPSBPYmplY3Qua2V5cyhhZGRDcmVhdGVJdGVtVHlwZXMpO1xuICAgIH1cbiAgICBsZXQgcG9zc2libGVJdGVtVHlwZXMgPSBbXTtcbiAgICBpdGVtVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICgoKF9hID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdLmZpbGVFeHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKGV4dGVuc2lvbikpID49IDApIHtcbiAgICAgICAgICAgIHBvc3NpYmxlSXRlbVR5cGVzLnB1c2goYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBwb3NzaWJsZUl0ZW1UeXBlcztcbn1cbmZ1bmN0aW9uIG1hcEl0ZW1UeXBlc1RvRmlsZUV4dGVuc2lvbnModHlwZXMpIHtcbiAgICBpZiAoIXR5cGVzKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gdW5pcXVlKHR5cGVzLmZsYXRNYXAoKHR5cGUpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsZUV4dDsgfSkuZmlsdGVyKCh2YWxpZCkgPT4gISF2YWxpZCkpO1xufVxuY29uc3QgaXNMYXJnZUdlb0pTT04gPSAoc2l6ZUluQnl0ZXMpID0+IHtcbiAgICBjb25zdCBzaXplSW5NQiA9IHNpemVJbkJ5dGVzIC8gMTAyNCAvIDEwMjQ7XG4gICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNTUzI2lzc3VlY29tbWVudC0zNjQ1NDA0XG4gICAgcmV0dXJuIHNpemVJbk1CID4gNTA7IC8vIDUwTUJcbn07XG5jb25zdCBpc0xhcmdlQ1NWID0gKHNpemVJbkJ5dGVzKSA9PiB7XG4gICAgY29uc3Qgc2l6ZUluTUIgPSBzaXplSW5CeXRlcyAvIDEwMjQgLyAxMDI0O1xuICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9pc3N1ZXMvMjg3NSNpc3N1ZWNvbW1lbnQtMzc0ODkxM1xuICAgIHJldHVybiBzaXplSW5NQiA+IDIwOyAvLyAyME1CXG59O1xuXG5leHBvcnQgeyBpc0xhcmdlQ1NWIGFzIGEsIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uIGFzIGYsIGlzTGFyZ2VHZW9KU09OIGFzIGksIG1hcEl0ZW1UeXBlc1RvRmlsZUV4dGVuc2lvbnMgYXMgbSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pdGVtLXR5cGVzLTU4NmYwMzAxLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==