"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d311cc"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-order.entry.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-symbol-order.entry.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_symbol_order: () => (/* binding */ ArcgisSymbolOrder)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






const CSS = {
    container: "container",
    section: "section",
    title: "title",
    missing: "missing"
};

var SortDirectionIcon;
(function (SortDirectionIcon) {
    SortDirectionIcon["Ascending"] = "sort-ascending-arrow";
    SortDirectionIcon["Descending"] = "sort-descending-arrow";
})(SortDirectionIcon || (SortDirectionIcon = {}));
var SortDirectionTooltip;
(function (SortDirectionTooltip) {
    SortDirectionTooltip["AscendingDate"] = "sortLeastRecent";
    SortDirectionTooltip["AscendingNumber"] = "smallToLarge";
    SortDirectionTooltip["DescendingDate"] = "sortMostRecent";
    SortDirectionTooltip["DescendingNumber"] = "largeToSmall";
})(SortDirectionTooltip || (SortDirectionTooltip = {}));

const arcgisSymbolOrderCss = "article{display:flex;align-items:center;flex-direction:row;grid-gap:0.5rem;gap:0.5rem}article calcite-action{margin-top:0.7em}article calcite-label{width:100%}.infoPopover{width:340px;font-size:12px}.information{margin:0 0 1em 0}";

const ArcgisSymbolOrder = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSymbolOrderChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolOrderChange", 7);
        this.fieldPickListChanges = (event) => {
            var _a, _b;
            event.stopPropagation();
            const fieldName = (_b = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) === null || _b === void 0 ? void 0 : _b[0];
            if (fieldName && fieldName !== this.selectedField.name) {
                this.selectedField =
                    fieldName !== this.getRendererFieldName()
                        ? this.toPickListFieldInfo(this.findField(fieldName))
                        : this.getRendererFieldInfo();
            }
            this.onHideFieldPickList();
        };
        this.view = undefined;
        this.layer = undefined;
        this.open = true;
        this.disabled = false;
        this.fieldTypes = [
            "integer",
            "small-integer",
            "big-integer",
            "single",
            "double",
            "long",
            "date"
        ];
        this.objectIdFieldName = "oid";
        this.ascending = false;
        this.selectedField = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        var _a;
        const [strings] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = strings;
        const { view, layer, pickListFields } = this;
        this.props = {
            view,
            layer
        };
        const fields = pickListFields || this.createPickListFields();
        if (!this.isRendererOrder()) {
            const { orderBy } = layer;
            const orderByInfo = (orderBy === null || orderBy === void 0 ? void 0 : orderBy.length) ? orderBy[0] : orderBy;
            this.ascending = (orderByInfo === null || orderByInfo === void 0 ? void 0 : orderByInfo.mode) === "ascending";
            const orderByField = (this.orderByField =
                (orderByInfo === null || orderByInfo === void 0 ? void 0 : orderByInfo.field) || ((_a = this.findOIDField(fields)) === null || _a === void 0 ? void 0 : _a.name) || fields[0]);
            this.selectedField = this.toPickListFieldInfo(this.findField(orderByField));
        }
        else {
            this.selectedField = this.getRendererFieldInfo();
        }
    }
    async componentDidLoad() {
        // once component is visible make other calls
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/intl"]);
        this.intl = intl;
        this.intl.setLocale(document.documentElement.lang);
    }
    disconnectedCallback() {
        this.destroyFieldsPickList();
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    /**
     * Cleans up component, closes popovers
     */
    async done() {
        this.disableContainer(false);
        this.destroyFieldsPickList();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { strings, open, disabled } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: CSS.container, heading: strings.heading, collapsible: true, disabled: disabled, open: open && !disabled }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "information" }, strings.orderByTooltip), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("article", null, this.renderFieldSelectionButton(), this.renderSortOrderAction())), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { "reference-element": "sort-action", placement: "bottom-start", label: "", ref: (node) => (this.tooltipNode = node) }, this.getSortDirectionTooltip())));
    }
    renderFieldSelectionButton() {
        const { selectedField, strings } = this;
        const fields = this.createPickListFields();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.orderBy, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { key: "selected-field-button", appearance: "outline-fill", kind: "neutral", width: "full", alignment: "icon-end-space-between", scale: "s", disabled: fields.length <= 1, iconEnd: "chevron-down", onClick: (e) => this.onShowFieldPickList(e), ref: (node) => (this.fieldSelectionNode = node) }, (selectedField === null || selectedField === void 0 ? void 0 : selectedField.alias) || fields[0].alias)));
    }
    renderSortOrderAction() {
        const { selectedField } = this;
        const disabled = selectedField.type === "oid" || selectedField.type === "renderer";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", id: "sort-action", appearance: "transparent", alignment: "start", icon: this.getSortDirectionIcon(), onClick: (e) => this.onToggleSortDirection(e), onMouseOver: () => this.onShowTooltip(true), onMouseOut: () => this.onShowTooltip(false), text: "", disabled: disabled })));
    }
    // --------------------------------------------------------------------------
    //
    //  Event Handlers
    //
    //---------------------------------------------------------------------------
    onChange() {
        const value = this.getValue();
        const isOrderByClasses = value === "renderer";
        this.layer.orderBy = !isOrderByClasses ? value : undefined;
        this.layer.renderer.orderByClassesEnabled = isOrderByClasses || undefined;
        this.arcgisSymbolOrderChange.emit();
    }
    async onShowFieldPickList(e) {
        e.stopPropagation();
        this.disableContainer(true);
        this.createFieldPickList();
    }
    async onHideFieldPickList() {
        this.disableContainer(false);
        this.destroyFieldsPickList();
        await this.fieldSelectionNode.setFocus();
        this.onChange();
    }
    onToggleSortDirection(e) {
        e.stopPropagation();
        this.ascending = !this.ascending;
        this.onChange();
    }
    onShowTooltip(open) {
        this.tooltipNode.open = open;
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    createFieldPickList() {
        const { layer, pickListFields, view, strings } = this;
        const fields = pickListFields || this.createPickListFields();
        const refElement = this.fieldSelectionNode;
        const popoverProps = this.createPopoverProps(refElement);
        const selectedField = this.selectedField || (this.isRendererOrder() ? this.getRendererFieldInfo() : fields[0]);
        const fieldPickList = (this.fieldPickList =
            document.createElement("arcgis-field-pick-list"));
        fieldPickList.heading = strings.orderBy;
        fieldPickList.multiple = false;
        fieldPickList.showFieldInfo = false;
        fieldPickList.showFieldName = true;
        fieldPickList.mapView = view;
        fieldPickList.layer = layer;
        fieldPickList.fields = fields;
        fieldPickList.selectedFields = [selectedField.name];
        fieldPickList.popoverProps = popoverProps;
        fieldPickList.addEventListener("arcgisFieldPickListDismissed", this.fieldPickListChanges);
        document.body.appendChild(fieldPickList);
        return fieldPickList;
    }
    destroyFieldsPickList() {
        if (this.fieldPickList) {
            document.body.removeChild(this.fieldPickList);
            this.fieldPickList = null;
        }
    }
    createPopoverProps(refElement) {
        return {
            placement: "bottom-end",
            offsetDistance: 5,
            offsetSkidding: 0,
            pointerDisabled: true,
            popoverWidth: this.getPopoverWidth(),
            refElement: refElement
        };
    }
    createPickListFields() {
        let { pickListFields } = this;
        if (!pickListFields) {
            const { layer, fieldTypes } = this;
            const { fields } = layer;
            pickListFields = this.pickListFields = fields
                .filter((field) => fieldTypes.indexOf(field === null || field === void 0 ? void 0 : field.type) > -1)
                .map((field) => this.toPickListFieldInfo(field));
            // Add oidField to the list
            const objectIdFieldInfo = this.toPickListFieldInfo(this.getOIDField());
            pickListFields.unshift(objectIdFieldInfo);
            // Add sortByStyles to the beginning of the the list
            if (this.hasTypesOrPredominanceRenderer()) {
                const sortRendererFieldInfo = this.getRendererFieldInfo();
                pickListFields.unshift(sortRendererFieldInfo);
            }
        }
        return pickListFields;
    }
    toPickListFieldInfo(field) {
        return {
            name: field.name,
            alias: this.getFieldAlias(field),
            type: field.type
        };
    }
    getPopoverWidth() {
        var _a;
        const buffer = 30;
        const nodeWidth = (_a = this.hostElement) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect().width;
        return nodeWidth + buffer || 280;
    }
    getFieldAlias(field) {
        const { strings } = this;
        if (field.type === "oid") {
            return strings.defaultDataOrder;
        }
        else {
            const fieldInfo = this.findFieldInfoFromPopup(field);
            return (fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.label) || field.alias || field.name;
        }
    }
    findFieldInfoFromPopup(field) {
        const { popupTemplate } = this.layer;
        const fieldInfos = popupTemplate === null || popupTemplate === void 0 ? void 0 : popupTemplate.fieldInfos;
        return (fieldInfos || []).find((fieldInfo) => fieldInfo.fieldName === field.name);
    }
    getOIDField() {
        const { layer } = this;
        const { fields } = layer;
        return fields.find((field) => field.name === layer.objectIdField || field.type === "oid");
    }
    findOIDField(fieldInfos) {
        const { layer } = this;
        return fieldInfos.find((field) => field.name === layer.objectIdField || field.type === "oid");
    }
    findField(name) {
        const { layer } = this;
        const { fields } = layer;
        const field = fields.find((field) => field.name === name);
        return field || fields[0];
    }
    getSortDirectionIcon() {
        return this.ascending ? SortDirectionIcon.Ascending : SortDirectionIcon.Descending;
    }
    getSortDirectionTooltip() {
        const { ascending, selectedField, strings } = this;
        const selectedFeldType = selectedField === null || selectedField === void 0 ? void 0 : selectedField.type;
        let stringKey = "sortLeastRecent";
        if (selectedFeldType === "date") {
            stringKey = ascending
                ? SortDirectionTooltip.AscendingDate
                : SortDirectionTooltip.DescendingDate;
        }
        else {
            stringKey = ascending
                ? SortDirectionTooltip.AscendingNumber
                : SortDirectionTooltip.DescendingNumber;
        }
        return strings[stringKey];
    }
    hasTypesOrPredominanceRenderer() {
        var _a, _b;
        const { layer } = this;
        const { renderer } = layer;
        return ((renderer === null || renderer === void 0 ? void 0 : renderer.type) === "unique-value" &&
            (!((_a = renderer === null || renderer === void 0 ? void 0 : renderer.authoringInfo) === null || _a === void 0 ? void 0 : _a.type) || ((_b = renderer === null || renderer === void 0 ? void 0 : renderer.authoringInfo) === null || _b === void 0 ? void 0 : _b.type) === "predominance"));
    }
    isRendererOrder() {
        const { layer } = this;
        const renderer = layer.renderer;
        return this.hasTypesOrPredominanceRenderer() && (renderer === null || renderer === void 0 ? void 0 : renderer.orderByClassesEnabled) === true;
    }
    getRendererFieldName() {
        const { layer } = this;
        const renderer = layer.renderer;
        return ((this.hasTypesOrPredominanceRenderer() &&
            (renderer.field || renderer.valueExpressionTitle)) ||
            null);
    }
    getRendererFieldInfo() {
        return {
            name: this.getRendererFieldName(),
            alias: this.strings.styleOrder,
            type: "renderer"
        };
    }
    disableContainer(disable) {
        const container = this.hostElement.closest("calcite-flow-item");
        if (container) {
            container.disabled = disable;
        }
    }
    getValue() {
        const { selectedField } = this;
        if (selectedField.type === "oid") {
            return null;
        }
        else if (selectedField.type === "renderer") {
            return "renderer";
        }
        else {
            return [
                {
                    order: this.ascending ? "ascending" : "descending",
                    field: this.selectedField.name
                }
            ];
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSymbolOrder.style = arcgisSymbolOrderCss;



//# sourceMappingURL=arcgis-symbol-order.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQzMTFjYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUN2QztBQUNUO0FBQ2xDO0FBQ1M7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsOENBQThDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsb0RBQW9EOztBQUVyRCxzQ0FBc0MsYUFBYSxtQkFBbUIsbUJBQW1CLGdCQUFnQixXQUFXLHVCQUF1QixpQkFBaUIsc0JBQXNCLFdBQVcsYUFBYSxZQUFZLGVBQWUsYUFBYSxpQkFBaUI7O0FBRW5RO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qix1Q0FBdUMscURBQVc7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHNEQUF5QjtBQUN6RDtBQUNBLGdCQUFnQiw4QkFBOEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDJEQUFXO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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LG1EQUFpQztBQUNsRTtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQixlQUFlLHdEQUFXO0FBQzFCO0FBQ0E7QUFDQSxZQUFZLHdEQUFXO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHFEQUFZLDhCQUE4QixjQUFjLFFBQVEsT0FBTztBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGNBQWMsRUFBRSxPQUFPO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxlQUFlLEdBQUcsa0JBQWtCO0FBQzFFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RTs7QUFFNUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtc3ltYm9sLW9yZGVyLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMDUwYjZkYjkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuXG5jb25zdCBDU1MgPSB7XG4gICAgY29udGFpbmVyOiBcImNvbnRhaW5lclwiLFxuICAgIHNlY3Rpb246IFwic2VjdGlvblwiLFxuICAgIHRpdGxlOiBcInRpdGxlXCIsXG4gICAgbWlzc2luZzogXCJtaXNzaW5nXCJcbn07XG5cbnZhciBTb3J0RGlyZWN0aW9uSWNvbjtcbihmdW5jdGlvbiAoU29ydERpcmVjdGlvbkljb24pIHtcbiAgICBTb3J0RGlyZWN0aW9uSWNvbltcIkFzY2VuZGluZ1wiXSA9IFwic29ydC1hc2NlbmRpbmctYXJyb3dcIjtcbiAgICBTb3J0RGlyZWN0aW9uSWNvbltcIkRlc2NlbmRpbmdcIl0gPSBcInNvcnQtZGVzY2VuZGluZy1hcnJvd1wiO1xufSkoU29ydERpcmVjdGlvbkljb24gfHwgKFNvcnREaXJlY3Rpb25JY29uID0ge30pKTtcbnZhciBTb3J0RGlyZWN0aW9uVG9vbHRpcDtcbihmdW5jdGlvbiAoU29ydERpcmVjdGlvblRvb2x0aXApIHtcbiAgICBTb3J0RGlyZWN0aW9uVG9vbHRpcFtcIkFzY2VuZGluZ0RhdGVcIl0gPSBcInNvcnRMZWFzdFJlY2VudFwiO1xuICAgIFNvcnREaXJlY3Rpb25Ub29sdGlwW1wiQXNjZW5kaW5nTnVtYmVyXCJdID0gXCJzbWFsbFRvTGFyZ2VcIjtcbiAgICBTb3J0RGlyZWN0aW9uVG9vbHRpcFtcIkRlc2NlbmRpbmdEYXRlXCJdID0gXCJzb3J0TW9zdFJlY2VudFwiO1xuICAgIFNvcnREaXJlY3Rpb25Ub29sdGlwW1wiRGVzY2VuZGluZ051bWJlclwiXSA9IFwibGFyZ2VUb1NtYWxsXCI7XG59KShTb3J0RGlyZWN0aW9uVG9vbHRpcCB8fCAoU29ydERpcmVjdGlvblRvb2x0aXAgPSB7fSkpO1xuXG5jb25zdCBhcmNnaXNTeW1ib2xPcmRlckNzcyA9IFwiYXJ0aWNsZXtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXgtZGlyZWN0aW9uOnJvdztncmlkLWdhcDowLjVyZW07Z2FwOjAuNXJlbX1hcnRpY2xlIGNhbGNpdGUtYWN0aW9ue21hcmdpbi10b3A6MC43ZW19YXJ0aWNsZSBjYWxjaXRlLWxhYmVse3dpZHRoOjEwMCV9LmluZm9Qb3BvdmVye3dpZHRoOjM0MHB4O2ZvbnQtc2l6ZToxMnB4fS5pbmZvcm1hdGlvbnttYXJnaW46MCAwIDFlbSAwfVwiO1xuXG5jb25zdCBBcmNnaXNTeW1ib2xPcmRlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sT3JkZXJDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1N5bWJvbE9yZGVyQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmZpZWxkUGlja0xpc3RDaGFuZ2VzID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSAoX2IgPSAoX2EgPSBldmVudC5kZXRhaWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZWxlY3RlZEZpZWxkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iWzBdO1xuICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSAmJiBmaWVsZE5hbWUgIT09IHRoaXMuc2VsZWN0ZWRGaWVsZC5uYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkID1cbiAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lICE9PSB0aGlzLmdldFJlbmRlcmVyRmllbGROYW1lKClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy50b1BpY2tMaXN0RmllbGRJbmZvKHRoaXMuZmluZEZpZWxkKGZpZWxkTmFtZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHRoaXMuZ2V0UmVuZGVyZXJGaWVsZEluZm8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMub25IaWRlRmllbGRQaWNrTGlzdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5maWVsZFR5cGVzID0gW1xuICAgICAgICAgICAgXCJpbnRlZ2VyXCIsXG4gICAgICAgICAgICBcInNtYWxsLWludGVnZXJcIixcbiAgICAgICAgICAgIFwiYmlnLWludGVnZXJcIixcbiAgICAgICAgICAgIFwic2luZ2xlXCIsXG4gICAgICAgICAgICBcImRvdWJsZVwiLFxuICAgICAgICAgICAgXCJsb25nXCIsXG4gICAgICAgICAgICBcImRhdGVcIlxuICAgICAgICBdO1xuICAgICAgICB0aGlzLm9iamVjdElkRmllbGROYW1lID0gXCJvaWRcIjtcbiAgICAgICAgdGhpcy5hc2NlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgW3N0cmluZ3NdID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgICAgY29uc3QgeyB2aWV3LCBsYXllciwgcGlja0xpc3RGaWVsZHMgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgbGF5ZXJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZmllbGRzID0gcGlja0xpc3RGaWVsZHMgfHwgdGhpcy5jcmVhdGVQaWNrTGlzdEZpZWxkcygpO1xuICAgICAgICBpZiAoIXRoaXMuaXNSZW5kZXJlck9yZGVyKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JkZXJCeSB9ID0gbGF5ZXI7XG4gICAgICAgICAgICBjb25zdCBvcmRlckJ5SW5mbyA9IChvcmRlckJ5ID09PSBudWxsIHx8IG9yZGVyQnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9yZGVyQnkubGVuZ3RoKSA/IG9yZGVyQnlbMF0gOiBvcmRlckJ5O1xuICAgICAgICAgICAgdGhpcy5hc2NlbmRpbmcgPSAob3JkZXJCeUluZm8gPT09IG51bGwgfHwgb3JkZXJCeUluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9yZGVyQnlJbmZvLm1vZGUpID09PSBcImFzY2VuZGluZ1wiO1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJCeUZpZWxkID0gKHRoaXMub3JkZXJCeUZpZWxkID1cbiAgICAgICAgICAgICAgICAob3JkZXJCeUluZm8gPT09IG51bGwgfHwgb3JkZXJCeUluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9yZGVyQnlJbmZvLmZpZWxkKSB8fCAoKF9hID0gdGhpcy5maW5kT0lERmllbGQoZmllbGRzKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpIHx8IGZpZWxkc1swXSk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGQgPSB0aGlzLnRvUGlja0xpc3RGaWVsZEluZm8odGhpcy5maW5kRmllbGQob3JkZXJCeUZpZWxkKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGQgPSB0aGlzLmdldFJlbmRlcmVyRmllbGRJbmZvKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgLy8gb25jZSBjb21wb25lbnQgaXMgdmlzaWJsZSBtYWtlIG90aGVyIGNhbGxzXG4gICAgICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIHRoaXMuaW50bCA9IGludGw7XG4gICAgICAgIHRoaXMuaW50bC5zZXRMb2NhbGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy5kZXN0cm95RmllbGRzUGlja0xpc3QoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLyoqXG4gICAgICogQ2xlYW5zIHVwIGNvbXBvbmVudCwgY2xvc2VzIHBvcG92ZXJzXG4gICAgICovXG4gICAgYXN5bmMgZG9uZSgpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKGZhbHNlKTtcbiAgICAgICAgdGhpcy5kZXN0cm95RmllbGRzUGlja0xpc3QoKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBvcGVuLCBkaXNhYmxlZCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IENTUy5jb250YWluZXIsIGhlYWRpbmc6IHN0cmluZ3MuaGVhZGluZywgY29sbGFwc2libGU6IHRydWUsIGRpc2FibGVkOiBkaXNhYmxlZCwgb3Blbjogb3BlbiAmJiAhZGlzYWJsZWQgfSwgaChcInBcIiwgeyBjbGFzczogXCJpbmZvcm1hdGlvblwiIH0sIHN0cmluZ3Mub3JkZXJCeVRvb2x0aXApLCBoKFwiYXJ0aWNsZVwiLCBudWxsLCB0aGlzLnJlbmRlckZpZWxkU2VsZWN0aW9uQnV0dG9uKCksIHRoaXMucmVuZGVyU29ydE9yZGVyQWN0aW9uKCkpKSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IFwicmVmZXJlbmNlLWVsZW1lbnRcIjogXCJzb3J0LWFjdGlvblwiLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIGxhYmVsOiBcIlwiLCByZWY6IChub2RlKSA9PiAodGhpcy50b29sdGlwTm9kZSA9IG5vZGUpIH0sIHRoaXMuZ2V0U29ydERpcmVjdGlvblRvb2x0aXAoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRTZWxlY3Rpb25CdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZCwgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5jcmVhdGVQaWNrTGlzdEZpZWxkcygpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Mub3JkZXJCeSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsga2V5OiBcInNlbGVjdGVkLWZpZWxkLWJ1dHRvblwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgd2lkdGg6IFwiZnVsbFwiLCBhbGlnbm1lbnQ6IFwiaWNvbi1lbmQtc3BhY2UtYmV0d2VlblwiLCBzY2FsZTogXCJzXCIsIGRpc2FibGVkOiBmaWVsZHMubGVuZ3RoIDw9IDEsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIG9uQ2xpY2s6IChlKSA9PiB0aGlzLm9uU2hvd0ZpZWxkUGlja0xpc3QoZSksIHJlZjogKG5vZGUpID0+ICh0aGlzLmZpZWxkU2VsZWN0aW9uTm9kZSA9IG5vZGUpIH0sIChzZWxlY3RlZEZpZWxkID09PSBudWxsIHx8IHNlbGVjdGVkRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRmllbGQuYWxpYXMpIHx8IGZpZWxkc1swXS5hbGlhcykpKTtcbiAgICB9XG4gICAgcmVuZGVyU29ydE9yZGVyQWN0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGQgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGRpc2FibGVkID0gc2VsZWN0ZWRGaWVsZC50eXBlID09PSBcIm9pZFwiIHx8IHNlbGVjdGVkRmllbGQudHlwZSA9PT0gXCJyZW5kZXJlclwiO1xuICAgICAgICByZXR1cm4gKGgoXCJzZWN0aW9uXCIsIG51bGwsIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNjYWxlOiBcInNcIiwgaWQ6IFwic29ydC1hY3Rpb25cIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBhbGlnbm1lbnQ6IFwic3RhcnRcIiwgaWNvbjogdGhpcy5nZXRTb3J0RGlyZWN0aW9uSWNvbigpLCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5vblRvZ2dsZVNvcnREaXJlY3Rpb24oZSksIG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLm9uU2hvd1Rvb2x0aXAodHJ1ZSksIG9uTW91c2VPdXQ6ICgpID0+IHRoaXMub25TaG93VG9vbHRpcChmYWxzZSksIHRleHQ6IFwiXCIsIGRpc2FibGVkOiBkaXNhYmxlZCB9KSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50IEhhbmRsZXJzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIG9uQ2hhbmdlKCkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICAgICAgY29uc3QgaXNPcmRlckJ5Q2xhc3NlcyA9IHZhbHVlID09PSBcInJlbmRlcmVyXCI7XG4gICAgICAgIHRoaXMubGF5ZXIub3JkZXJCeSA9ICFpc09yZGVyQnlDbGFzc2VzID8gdmFsdWUgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXIucmVuZGVyZXIub3JkZXJCeUNsYXNzZXNFbmFibGVkID0gaXNPcmRlckJ5Q2xhc3NlcyB8fCB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sT3JkZXJDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBhc3luYyBvblNob3dGaWVsZFBpY2tMaXN0KGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKHRydWUpO1xuICAgICAgICB0aGlzLmNyZWF0ZUZpZWxkUGlja0xpc3QoKTtcbiAgICB9XG4gICAgYXN5bmMgb25IaWRlRmllbGRQaWNrTGlzdCgpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKGZhbHNlKTtcbiAgICAgICAgdGhpcy5kZXN0cm95RmllbGRzUGlja0xpc3QoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5maWVsZFNlbGVjdGlvbk5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgIH1cbiAgICBvblRvZ2dsZVNvcnREaXJlY3Rpb24oZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmFzY2VuZGluZyA9ICF0aGlzLmFzY2VuZGluZztcbiAgICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgIH1cbiAgICBvblNob3dUb29sdGlwKG9wZW4pIHtcbiAgICAgICAgdGhpcy50b29sdGlwTm9kZS5vcGVuID0gb3BlbjtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY3JlYXRlRmllbGRQaWNrTGlzdCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgcGlja0xpc3RGaWVsZHMsIHZpZXcsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHBpY2tMaXN0RmllbGRzIHx8IHRoaXMuY3JlYXRlUGlja0xpc3RGaWVsZHMoKTtcbiAgICAgICAgY29uc3QgcmVmRWxlbWVudCA9IHRoaXMuZmllbGRTZWxlY3Rpb25Ob2RlO1xuICAgICAgICBjb25zdCBwb3BvdmVyUHJvcHMgPSB0aGlzLmNyZWF0ZVBvcG92ZXJQcm9wcyhyZWZFbGVtZW50KTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZCA9IHRoaXMuc2VsZWN0ZWRGaWVsZCB8fCAodGhpcy5pc1JlbmRlcmVyT3JkZXIoKSA/IHRoaXMuZ2V0UmVuZGVyZXJGaWVsZEluZm8oKSA6IGZpZWxkc1swXSk7XG4gICAgICAgIGNvbnN0IGZpZWxkUGlja0xpc3QgPSAodGhpcy5maWVsZFBpY2tMaXN0ID1cbiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZmllbGQtcGljay1saXN0XCIpKTtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5oZWFkaW5nID0gc3RyaW5ncy5vcmRlckJ5O1xuICAgICAgICBmaWVsZFBpY2tMaXN0Lm11bHRpcGxlID0gZmFsc2U7XG4gICAgICAgIGZpZWxkUGlja0xpc3Quc2hvd0ZpZWxkSW5mbyA9IGZhbHNlO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LnNob3dGaWVsZE5hbWUgPSB0cnVlO1xuICAgICAgICBmaWVsZFBpY2tMaXN0Lm1hcFZpZXcgPSB2aWV3O1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmxheWVyID0gbGF5ZXI7XG4gICAgICAgIGZpZWxkUGlja0xpc3QuZmllbGRzID0gZmllbGRzO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LnNlbGVjdGVkRmllbGRzID0gW3NlbGVjdGVkRmllbGQubmFtZV07XG4gICAgICAgIGZpZWxkUGlja0xpc3QucG9wb3ZlclByb3BzID0gcG9wb3ZlclByb3BzO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkXCIsIHRoaXMuZmllbGRQaWNrTGlzdENoYW5nZXMpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpZWxkUGlja0xpc3QpO1xuICAgICAgICByZXR1cm4gZmllbGRQaWNrTGlzdDtcbiAgICB9XG4gICAgZGVzdHJveUZpZWxkc1BpY2tMaXN0KCkge1xuICAgICAgICBpZiAodGhpcy5maWVsZFBpY2tMaXN0KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuZmllbGRQaWNrTGlzdCk7XG4gICAgICAgICAgICB0aGlzLmZpZWxkUGlja0xpc3QgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZVBvcG92ZXJQcm9wcyhyZWZFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiLFxuICAgICAgICAgICAgb2Zmc2V0RGlzdGFuY2U6IDUsXG4gICAgICAgICAgICBvZmZzZXRTa2lkZGluZzogMCxcbiAgICAgICAgICAgIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIHBvcG92ZXJXaWR0aDogdGhpcy5nZXRQb3BvdmVyV2lkdGgoKSxcbiAgICAgICAgICAgIHJlZkVsZW1lbnQ6IHJlZkVsZW1lbnRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY3JlYXRlUGlja0xpc3RGaWVsZHMoKSB7XG4gICAgICAgIGxldCB7IHBpY2tMaXN0RmllbGRzIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIXBpY2tMaXN0RmllbGRzKSB7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyLCBmaWVsZFR5cGVzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmaWVsZHMgfSA9IGxheWVyO1xuICAgICAgICAgICAgcGlja0xpc3RGaWVsZHMgPSB0aGlzLnBpY2tMaXN0RmllbGRzID0gZmllbGRzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZmllbGQpID0+IGZpZWxkVHlwZXMuaW5kZXhPZihmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQudHlwZSkgPiAtMSlcbiAgICAgICAgICAgICAgICAubWFwKChmaWVsZCkgPT4gdGhpcy50b1BpY2tMaXN0RmllbGRJbmZvKGZpZWxkKSk7XG4gICAgICAgICAgICAvLyBBZGQgb2lkRmllbGQgdG8gdGhlIGxpc3RcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdElkRmllbGRJbmZvID0gdGhpcy50b1BpY2tMaXN0RmllbGRJbmZvKHRoaXMuZ2V0T0lERmllbGQoKSk7XG4gICAgICAgICAgICBwaWNrTGlzdEZpZWxkcy51bnNoaWZ0KG9iamVjdElkRmllbGRJbmZvKTtcbiAgICAgICAgICAgIC8vIEFkZCBzb3J0QnlTdHlsZXMgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgdGhlIGxpc3RcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc1R5cGVzT3JQcmVkb21pbmFuY2VSZW5kZXJlcigpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydFJlbmRlcmVyRmllbGRJbmZvID0gdGhpcy5nZXRSZW5kZXJlckZpZWxkSW5mbygpO1xuICAgICAgICAgICAgICAgIHBpY2tMaXN0RmllbGRzLnVuc2hpZnQoc29ydFJlbmRlcmVyRmllbGRJbmZvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGlja0xpc3RGaWVsZHM7XG4gICAgfVxuICAgIHRvUGlja0xpc3RGaWVsZEluZm8oZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgICAgICBhbGlhczogdGhpcy5nZXRGaWVsZEFsaWFzKGZpZWxkKSxcbiAgICAgICAgICAgIHR5cGU6IGZpZWxkLnR5cGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0UG9wb3ZlcldpZHRoKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IDMwO1xuICAgICAgICBjb25zdCBub2RlV2lkdGggPSAoX2EgPSB0aGlzLmhvc3RFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgIHJldHVybiBub2RlV2lkdGggKyBidWZmZXIgfHwgMjgwO1xuICAgIH1cbiAgICBnZXRGaWVsZEFsaWFzKGZpZWxkKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFwib2lkXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJpbmdzLmRlZmF1bHREYXRhT3JkZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB0aGlzLmZpbmRGaWVsZEluZm9Gcm9tUG9wdXAoZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIChmaWVsZEluZm8gPT09IG51bGwgfHwgZmllbGRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZEluZm8ubGFiZWwpIHx8IGZpZWxkLmFsaWFzIHx8IGZpZWxkLm5hbWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZmluZEZpZWxkSW5mb0Zyb21Qb3B1cChmaWVsZCkge1xuICAgICAgICBjb25zdCB7IHBvcHVwVGVtcGxhdGUgfSA9IHRoaXMubGF5ZXI7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mb3MgPSBwb3B1cFRlbXBsYXRlID09PSBudWxsIHx8IHBvcHVwVGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcztcbiAgICAgICAgcmV0dXJuIChmaWVsZEluZm9zIHx8IFtdKS5maW5kKChmaWVsZEluZm8pID0+IGZpZWxkSW5mby5maWVsZE5hbWUgPT09IGZpZWxkLm5hbWUpO1xuICAgIH1cbiAgICBnZXRPSURGaWVsZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBmaWVsZHMgfSA9IGxheWVyO1xuICAgICAgICByZXR1cm4gZmllbGRzLmZpbmQoKGZpZWxkKSA9PiBmaWVsZC5uYW1lID09PSBsYXllci5vYmplY3RJZEZpZWxkIHx8IGZpZWxkLnR5cGUgPT09IFwib2lkXCIpO1xuICAgIH1cbiAgICBmaW5kT0lERmllbGQoZmllbGRJbmZvcykge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gZmllbGRJbmZvcy5maW5kKChmaWVsZCkgPT4gZmllbGQubmFtZSA9PT0gbGF5ZXIub2JqZWN0SWRGaWVsZCB8fCBmaWVsZC50eXBlID09PSBcIm9pZFwiKTtcbiAgICB9XG4gICAgZmluZEZpZWxkKG5hbWUpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBmaWVsZHMgfSA9IGxheWVyO1xuICAgICAgICBjb25zdCBmaWVsZCA9IGZpZWxkcy5maW5kKChmaWVsZCkgPT4gZmllbGQubmFtZSA9PT0gbmFtZSk7XG4gICAgICAgIHJldHVybiBmaWVsZCB8fCBmaWVsZHNbMF07XG4gICAgfVxuICAgIGdldFNvcnREaXJlY3Rpb25JY29uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hc2NlbmRpbmcgPyBTb3J0RGlyZWN0aW9uSWNvbi5Bc2NlbmRpbmcgOiBTb3J0RGlyZWN0aW9uSWNvbi5EZXNjZW5kaW5nO1xuICAgIH1cbiAgICBnZXRTb3J0RGlyZWN0aW9uVG9vbHRpcCgpIHtcbiAgICAgICAgY29uc3QgeyBhc2NlbmRpbmcsIHNlbGVjdGVkRmllbGQsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmVsZFR5cGUgPSBzZWxlY3RlZEZpZWxkID09PSBudWxsIHx8IHNlbGVjdGVkRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRmllbGQudHlwZTtcbiAgICAgICAgbGV0IHN0cmluZ0tleSA9IFwic29ydExlYXN0UmVjZW50XCI7XG4gICAgICAgIGlmIChzZWxlY3RlZEZlbGRUeXBlID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgc3RyaW5nS2V5ID0gYXNjZW5kaW5nXG4gICAgICAgICAgICAgICAgPyBTb3J0RGlyZWN0aW9uVG9vbHRpcC5Bc2NlbmRpbmdEYXRlXG4gICAgICAgICAgICAgICAgOiBTb3J0RGlyZWN0aW9uVG9vbHRpcC5EZXNjZW5kaW5nRGF0ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0cmluZ0tleSA9IGFzY2VuZGluZ1xuICAgICAgICAgICAgICAgID8gU29ydERpcmVjdGlvblRvb2x0aXAuQXNjZW5kaW5nTnVtYmVyXG4gICAgICAgICAgICAgICAgOiBTb3J0RGlyZWN0aW9uVG9vbHRpcC5EZXNjZW5kaW5nTnVtYmVyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdHJpbmdzW3N0cmluZ0tleV07XG4gICAgfVxuICAgIGhhc1R5cGVzT3JQcmVkb21pbmFuY2VSZW5kZXJlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyByZW5kZXJlciB9ID0gbGF5ZXI7XG4gICAgICAgIHJldHVybiAoKHJlbmRlcmVyID09PSBudWxsIHx8IHJlbmRlcmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZW5kZXJlci50eXBlKSA9PT0gXCJ1bmlxdWUtdmFsdWVcIiAmJlxuICAgICAgICAgICAgKCEoKF9hID0gcmVuZGVyZXIgPT09IG51bGwgfHwgcmVuZGVyZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSB8fCAoKF9iID0gcmVuZGVyZXIgPT09IG51bGwgfHwgcmVuZGVyZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJwcmVkb21pbmFuY2VcIikpO1xuICAgIH1cbiAgICBpc1JlbmRlcmVyT3JkZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc1R5cGVzT3JQcmVkb21pbmFuY2VSZW5kZXJlcigpICYmIChyZW5kZXJlciA9PT0gbnVsbCB8fCByZW5kZXJlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVuZGVyZXIub3JkZXJCeUNsYXNzZXNFbmFibGVkKSA9PT0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0UmVuZGVyZXJGaWVsZE5hbWUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHJldHVybiAoKHRoaXMuaGFzVHlwZXNPclByZWRvbWluYW5jZVJlbmRlcmVyKCkgJiZcbiAgICAgICAgICAgIChyZW5kZXJlci5maWVsZCB8fCByZW5kZXJlci52YWx1ZUV4cHJlc3Npb25UaXRsZSkpIHx8XG4gICAgICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgZ2V0UmVuZGVyZXJGaWVsZEluZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLmdldFJlbmRlcmVyRmllbGROYW1lKCksXG4gICAgICAgICAgICBhbGlhczogdGhpcy5zdHJpbmdzLnN0eWxlT3JkZXIsXG4gICAgICAgICAgICB0eXBlOiBcInJlbmRlcmVyXCJcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZGlzYWJsZUNvbnRhaW5lcihkaXNhYmxlKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuaG9zdEVsZW1lbnQuY2xvc2VzdChcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250YWluZXIuZGlzYWJsZWQgPSBkaXNhYmxlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFZhbHVlKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGQgfSA9IHRoaXM7XG4gICAgICAgIGlmIChzZWxlY3RlZEZpZWxkLnR5cGUgPT09IFwib2lkXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGQudHlwZSA9PT0gXCJyZW5kZXJlclwiKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJyZW5kZXJlclwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyOiB0aGlzLmFzY2VuZGluZyA/IFwiYXNjZW5kaW5nXCIgOiBcImRlc2NlbmRpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMuc2VsZWN0ZWRGaWVsZC5uYW1lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU3ltYm9sT3JkZXIuc3R5bGUgPSBhcmNnaXNTeW1ib2xPcmRlckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU3ltYm9sT3JkZXIgYXMgYXJjZ2lzX3N5bWJvbF9vcmRlciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtc3ltYm9sLW9yZGVyLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gICAgW1wiYXJcIiwgXCJhclwiXSxcbiAgICBbXCJiZ1wiLCBcImJnXCJdLFxuICAgIFtcImJzXCIsIFwiYnNcIl0sXG4gICAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgICBbXCJjc1wiLCBcImNzXCJdLFxuICAgIFtcImRhXCIsIFwiZGFcIl0sXG4gICAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgICBbXCJlbFwiLCBcImVsXCJdLFxuICAgIFtcImVuXCIsIFwiZW5cIl0sXG4gICAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgICBbXCJldFwiLCBcImV0XCJdLFxuICAgIFtcImZpXCIsIFwiZmlcIl0sXG4gICAgW1wiZnJcIiwgXCJmclwiXSxcbiAgICBbXCJoZVwiLCBcImhlXCJdLFxuICAgIFtcImhyXCIsIFwiaHJcIl0sXG4gICAgW1wiaHVcIiwgXCJodVwiXSxcbiAgICBbXCJpZFwiLCBcImlkXCJdLFxuICAgIFtcIml0XCIsIFwiaXRcIl0sXG4gICAgW1wiamFcIiwgXCJqYVwiXSxcbiAgICBbXCJrb1wiLCBcImtvXCJdLFxuICAgIFtcImx0XCIsIFwibHRcIl0sXG4gICAgW1wibHZcIiwgXCJsdlwiXSxcbiAgICBbXCJuYlwiLCBcIm5iXCJdLFxuICAgIFtcIm5sXCIsIFwibmxcIl0sXG4gICAgW1wicGxcIiwgXCJwbFwiXSxcbiAgICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICAgIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gICAgW1wicm9cIiwgXCJyb1wiXSxcbiAgICBbXCJydVwiLCBcInJ1XCJdLFxuICAgIFtcInNrXCIsIFwic2tcIl0sXG4gICAgW1wic2xcIiwgXCJzbFwiXSxcbiAgICBbXCJzclwiLCBcInNyXCJdLFxuICAgIFtcInN2XCIsIFwic3ZcIl0sXG4gICAgW1widGhcIiwgXCJ0aFwiXSxcbiAgICBbXCJ0clwiLCBcInRyXCJdLFxuICAgIFtcInVrXCIsIFwidWtcIl0sXG4gICAgW1widmlcIiwgXCJ2aVwiXSxcbiAgICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICAgIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gICAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gICAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gICAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoYXBpID09PSA0KSB7XG4gICAgICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICAgICAgICBwbGFjZXMsXG4gICAgICAgICAgICBzdHlsZTogdHlwZSxcbiAgICAgICAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gICAgfVxuICAgIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIHBsYWNlcyxcbiAgICAgICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gICAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgICAgICBtb250aDogXCJzaG9ydFwiLFxuICAgICAgICBkYXk6IFwibnVtZXJpY1wiXG4gICAgfTtcbiAgICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFBsdXJhbChsYW5nLCBzdHJpbmdPYmosIG51bWJlcikge1xuICAgIGNvbnN0IHNpbmdsZXMgPSBbXCJpZFwiLCBcImphXCIsIFwia29cIiwgXCJ0aFwiLCBcInZpXCIsIFwiemgtY25cIiwgXCJ6aC1oa1wiLCBcInpoLXR3XCJdO1xuICAgIGNvbnN0IGxpa2VFbmdsaXNoID0gW1xuICAgICAgICBcImVuXCIsXG4gICAgICAgIFwiY2FcIixcbiAgICAgICAgXCJkYVwiLFxuICAgICAgICBcImRlXCIsXG4gICAgICAgIFwiZWxcIixcbiAgICAgICAgXCJlc1wiLFxuICAgICAgICBcImV0XCIsXG4gICAgICAgIFwiZmlcIixcbiAgICAgICAgXCJoaVwiLFxuICAgICAgICBcImh1XCIsXG4gICAgICAgIFwiaXRcIixcbiAgICAgICAgXCJuYlwiLFxuICAgICAgICBcIm5sXCIsXG4gICAgICAgIFwicHQtcHRcIixcbiAgICAgICAgXCJzdlwiLFxuICAgICAgICBcInRyXCJcbiAgICBdO1xuICAgIGNvbnN0IGxvY2FsZSA9IGxhbmcgIT09IG51bGwgJiYgbGFuZyAhPT0gdm9pZCAwID8gbGFuZyA6IFwiZW5cIjtcbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG9uZSwgb3IgaXQgaXMgYSBcInNpbXBsZVwiIGxhbmd1YWdlLCByZXR1cm4gdGhlIDEgc3RyaW5nXG4gICAgaWYgKG51bWJlciA9PT0gMSB8fCBzaW5nbGVzLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5zaW5nbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBcIjFcIik7XG4gICAgfVxuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgbm90IDEgYW5kIHRoZSBsYW5ndWFnZSB1c2VzIHRoZSBzYW1lIHBsdXJhbGl6YXRpb24gc3RyYXRlZ3kgYXMgZW5nbGlzaCxcbiAgICAvLyByZXR1cm4gdGhlIG11bHRpcGxlIHN0cmluZ1xuICAgIGlmIChudW1iZXIgIT09IDEgJiYgbGlrZUVuZ2xpc2guaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLm11bHRpcGxlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xuICAgIH1cbiAgICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSB3b3JrZWQsIHJldHVybiB0aGUgXCJ1bmtub3duXCIgc3RyaW5nXG4gICAgcmV0dXJuIHN0cmluZ09iai51bmtub3duLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdFBsdXJhbCBhcyBiLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAgIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAgICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICAgICAgICByZXR1cm4gbGFuZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICAgIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgICAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gICAgbGV0IHN0cmluZ3M7XG4gICAgdHJ5IHtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsZS0wNTBiNmRiOS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=