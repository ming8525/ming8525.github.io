"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-gallery.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-gallery.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_gallery: () => (/* binding */ ArcgisSmartMappingPanelsGallery)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _feature_1ce1b984_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./feature-1ce1b984.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-1ce1b984.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/* harmony import */ var _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./color-d6da0a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-d6da0a9a.js");
/* harmony import */ var _colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./colorSize-ce0ccdeb.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSize-ce0ccdeb.js");
/* harmony import */ var _heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./heatmap-75ffd452.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js");
/* harmony import */ var _predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./predominance-a1a2d74d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js");
/* harmony import */ var _chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./chart-097ec280.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/chart-097ec280.js");
/* harmony import */ var _compare_ba1292fe_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./compare-ba1292fe.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/compare-ba1292fe.js");
/* harmony import */ var _type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./type-0ace5d2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-0ace5d2e.js");
/* harmony import */ var _relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./relationship-b72d7d97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/relationship-b72d7d97.js");
/* harmony import */ var _colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./colorSizeUnivariant-d266ac7c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorSizeUnivariant-d266ac7c.js");
/* harmony import */ var _typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./typeSize-9d4c5d28.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/typeSize-9d4c5d28.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */























/**
 * Updates the layer with a DotDensity renderer with default settings
 * @param options: options
 */
function createDotDensityRenderer(options) {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    const layer = smLayer;
    options = options || {};
    return modules.DotDensityCreator.createRenderer({
        layer,
        view: mapView,
        attributes: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(options.attributes) ? options.attributes : getAttributes(options.fieldInfos),
        dotBlendingEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(options.dotBlendingEnabled) ? options.dotBlendingEnabled : true,
        dotValueOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(options.dotValueOptimizationEnabled)
            ? options.dotValueOptimizationEnabled
            : true,
        outlineOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(options.outlineOptimizationEnabled)
            ? options.outlineOptimizationEnabled
            : true,
        legendOptions: options.legendOptions,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    });
}
function getAttributes(fieldInfos) {
    return fieldInfos.map((fieldInfo) => {
        return {
            //valueExpression: `$feature.${option.value}`,
            field: fieldInfo.field,
            label: getFieldLabel(fieldInfo.field)
        };
    });
}
function getFieldLabel(fieldName) {
    const galleryFields = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.fields.filter((field) => field.layerField.name === fieldName);
    if (galleryFields.length) {
        return galleryFields[0].label;
    }
    return "";
}

/**
 * Updates the layer with a Predominance renderer with default settings
 * @param options: options
 */
function createRelationshipSizeRenderer(options) {
    const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    options = options || {};
    const relationshipFieldInfos = [];
    const sizeFieldInfos = [];
    relationshipFieldInfos.push(options.fieldInfos[0]);
    relationshipFieldInfos.push(options.fieldInfos[1]);
    sizeFieldInfos.push(options.fieldInfos[2]);
    if (sameRelationshipFields(options)) {
        return createSizePartForRenderer((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer), sizeFieldInfos, options).then((rendererResult) => {
            return Promise.resolve({ renderer: rendererResult });
        }, (error) => Promise.reject(error));
    }
    return (0,_relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_16__.c)(Object.assign(Object.assign({}, options), { fieldInfos: relationshipFieldInfos })).then((relationshipRendererResult) => {
        return createSizePartForRenderer(relationshipRendererResult.renderer, sizeFieldInfos, options).then((rendererResult) => {
            relationshipRendererResult.renderer = rendererResult;
            return Promise.resolve(relationshipRendererResult);
        }, (error) => Promise.reject(error));
    }, (error) => Promise.reject(error));
}
function createSizePartForRenderer(relRenderer, sizeFieldInfos, options) {
    const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    return (0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)(Object.assign(Object.assign({}, options), { fieldInfos: sizeFieldInfos })).then((sizeRendererResult) => {
        const sizeRenderer = sizeRendererResult.renderer;
        relRenderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.n)(relRenderer, "size") || [];
        relRenderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.n)(relRenderer, "size", "auto") || [];
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(sizeRenderer, "size");
        relRenderer.visualVariables.push(sizeVisVar);
        relRenderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.o)(relRenderer, "size") || [];
        const sizeAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.p)(sizeRenderer, "size");
        relRenderer.authoringInfo.visualVariables.push(sizeAuthVisVar);
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.q)(layer)) {
            // we need to switch the fill symbols to marker symbols
            let markerSymbol = sizeRenderer.classBreakInfos[0].symbol;
            const rendererValueInfos = [];
            relRenderer.uniqueValueInfos.forEach((valueInfo) => {
                rendererValueInfos.push(modules.esriLang.clone(valueInfo));
            });
            rendererValueInfos.forEach((valueInfo) => {
                relRenderer.removeUniqueValueInfo(valueInfo.value);
            });
            rendererValueInfos.forEach((valueInfo) => {
                const sym = markerSymbol.clone();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.r)(sym, (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.t)(valueInfo.symbol));
                relRenderer.addUniqueValueInfo({
                    value: valueInfo.value,
                    symbol: sym,
                    label: valueInfo.label
                });
            });
            relRenderer.backgroundFillSymbol = sizeRenderer.backgroundFillSymbol;
            const sizeOutlineVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.a)(sizeRenderer, "size", "outline");
            if (sizeOutlineVisVar) {
                relRenderer.visualVariables.push(sizeOutlineVisVar);
            }
        }
        return Promise.resolve(relRenderer);
    }, (error) => Promise.reject(error));
}
function sameRelationshipFields(options) {
    // not checking for normalizationField
    // we keep it if the renderer has it and it does not get overwritten
    const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)() === "relationship" &&
        options.normalizationField1 === undefined &&
        options.normalizationField2 === undefined) {
        const authInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer).authoringInfo;
        if (options.fieldInfos &&
            options.fieldInfos.length > 1 &&
            options.fieldInfos[0].field == authInfo.field1.field &&
            options.fieldInfos[1].field == authInfo.field2.field) {
            return true;
        }
    }
    return false;
}

let _delayHandler;
function createNewRendererWithDelay(galleryRequestWrapper) {
    // wait a little before executing the request
    // in case the user deletes a bunch of attributes
    if (_delayHandler) {
        clearTimeout(_delayHandler);
    }
    _delayHandler = setTimeout(() => {
        _delayHandler = null;
        createNewRenderer(galleryRequestWrapper);
    }, 1000);
}
function createNewRenderer(galleryRequestWrapper) {
    var _a, _b;
    const { selectedFields, layer, mapImageSublayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    const isOGC = layer.type === "ogc-feature";
    const isWFS = layer.type === "wfs";
    const supportsSqlExpression = (_b = (_a = layer.capabilities) === null || _a === void 0 ? void 0 : _a.query) === null || _b === void 0 ? void 0 : _b.supportsSqlExpression;
    const advanced = isOGC || isWFS || supportsSqlExpression; // predom, age, dotDensity, field-heatmap
    const fields = selectedFields.map((fieldInfo) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(fieldInfo.field));
    const rendererFields = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.f)(layer);
    const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
    if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.v)(selectedFields, rendererFields)) {
        if (selectedFields.length === 0) {
            if (rendererType === "heatmap") {
                galleryRequestWrapper((0,_heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_11__.c)());
            }
            else {
                galleryRequestWrapper((0,_location_e26b539f_js__WEBPACK_IMPORTED_MODULE_8__.c)());
            }
        }
        else if (selectedFields.length === 1) {
            const field = fields[0];
            if (rendererType === "heatmap" &&
                advanced &&
                !selectedFields[0].expression &&
                selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER) {
                galleryRequestWrapper((0,_heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_11__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else if (rendererType === "color-size" && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[0])) {
                // keep color
                galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else if (rendererType === "type-size" && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[0])) {
                // keep type
                galleryRequestWrapper((0,_type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_15__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else if (["color-size", "type-size"].indexOf(rendererType) > -1 &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[rendererFields.length > 1 ? 1 : 0])) {
                // keep size
                galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else if (selectedFields[0].expression) {
                if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER) {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({ fieldInfos: selectedFields }));
                }
                else if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE) {
                    galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({
                        fieldInfos: selectedFields
                    }));
                }
                else {
                    galleryRequestWrapper((0,_type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_15__.c)({ fieldInfos: selectedFields }));
                }
            }
            else if (field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING ||
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.y)(field) === "string" ||
                ("domain" in field.layerField && field.layerField.domain)) {
                galleryRequestWrapper((0,_type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_15__.c)({ fieldInfos: selectedFields }));
            }
            else if (["integer", "double", "single", "small-integer", "big-integer"].indexOf((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.z)(field.layerField)) > -1 &&
                "objectIdField" in layer &&
                layer.objectIdField !== field.layerField.name) {
                if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.A)(layer)) {
                    if ("featureReduction" in layer && layer.featureReduction) {
                        galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({
                            fieldInfos: selectedFields
                        }));
                    }
                    else {
                        galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({
                            fieldInfos: selectedFields
                        }));
                    }
                }
                else if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.B)(layer)) {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({ fieldInfos: selectedFields }));
                }
                else {
                    // "polygon"
                    const valueType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.y)(field);
                    if (["integer", "small-integer", "big-integer"].indexOf((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.z)(field.layerField)) > -1 ||
                        ((0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(valueType) && valueType === "integer")) {
                        galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({
                            fieldInfos: selectedFields
                        }));
                    }
                    else {
                        galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({
                            fieldInfos: selectedFields
                        }));
                    }
                }
            }
            else if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.z)(field.layerField) === "date") {
                if (rendererType === "color-age-size" && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[0])) {
                    galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.a)({ fieldInfos: selectedFields }));
                }
                else if (["color-size-age", "type-size-age"].indexOf(rendererType) > -1 &&
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[1])) {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.a)({ fieldInfos: selectedFields }));
                }
                else if (mapImageSublayer) {
                    // doesn't support color renderer
                    galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.a)({ fieldInfos: selectedFields }));
                }
                else {
                    galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({ fieldInfos: selectedFields }));
                }
            }
        }
        else if (selectedFields.length === 2) {
            const field1 = fields[0];
            //const field2 = fields[1]!;
            if ((rendererType === "type" || rendererType === "type-size") &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.x)(selectedFields[0], rendererFields[0])) {
                // keep type
                galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else if (selectedFields[0].expression) {
                if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER &&
                    selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER) {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.b)({
                        fieldInfos: selectedFields
                    }));
                }
                else {
                    galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.c)({ fieldInfos: selectedFields }));
                }
            }
            else if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING ||
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.y)(field1) === "string" ||
                ("domain" in field1.layerField && field1.layerField.domain)) {
                if (selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
                    (["color-size-age", "type-size-age"].indexOf(rendererType) > -1 || mapImageSublayer)) {
                    // MS doesn't support color or size renderer on date field
                    galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.a)({ fieldInfos: selectedFields }));
                }
                else {
                    galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.c)({ fieldInfos: selectedFields }));
                }
            }
            else if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE ||
                selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE) {
                if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
                    (["color-age", "color-age-size"].indexOf(rendererType) > -1 || mapImageSublayer)) {
                    // MS doesn't support color or size renderer on date field
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.d)({ fieldInfos: selectedFields }));
                }
                else if (selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
                    (["color-size-age", "type-size-age"].indexOf(rendererType) > -1 || mapImageSublayer)) {
                    // MS doesn't support color or size renderer on date field
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.e)({ fieldInfos: selectedFields }));
                }
                else {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.b)({ fieldInfos: selectedFields }));
                }
            }
            else {
                // both numbers
                // stay with the style we're at, if possible
                if (selectedFields[0].expression || selectedFields[1].expression) {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.b)({ fieldInfos: selectedFields }));
                }
                else if (rendererType === "dot-density") {
                    galleryRequestWrapper(createDotDensityRenderer({
                        fieldInfos: selectedFields
                    }));
                }
                else if (rendererType === "predominance") {
                    galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({
                        fieldInfos: selectedFields
                    }));
                }
                else if (rendererType === "predominance-size") {
                    galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({
                        fieldInfos: selectedFields,
                        includeSizeVariable: true
                    }));
                }
                else if (rendererType === "chart") {
                    galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({
                        fieldInfos: selectedFields
                    }));
                }
                else if (rendererType === "chart-size") {
                    galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({
                        fieldInfos: selectedFields,
                        includeSizeVariable: true
                    }));
                }
                else if (rendererType === "compare") {
                    galleryRequestWrapper((0,_compare_ba1292fe_js__WEBPACK_IMPORTED_MODULE_14__.c)({
                        fieldInfos: selectedFields
                    }));
                }
                else if (["relationship", "relationship-size"].indexOf(rendererType) > -1) {
                    galleryRequestWrapper((0,_relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_16__.c)({
                        fieldInfos: selectedFields
                    }));
                }
                else {
                    galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.b)({ fieldInfos: selectedFields }));
                }
            }
        }
        else {
            // more than two attributes
            if (selectedFields.length === 3 &&
                (["relationship", "relationship-size"].indexOf(rendererType) > -1 || selectedFields[2].expression || !advanced) //||
            ) {
                galleryRequestWrapper(createRelationshipSizeRenderer({
                    fieldInfos: selectedFields
                }));
            }
            else if (rendererType === "dot-density" && selectedFields.length <= 8) {
                galleryRequestWrapper(createDotDensityRenderer({
                    fieldInfos: selectedFields
                }));
            }
            else if (rendererType === "predominance-size") {
                galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({
                    fieldInfos: selectedFields,
                    includeSizeVariable: true
                }));
            }
            else if (rendererType === "chart") {
                galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({
                    fieldInfos: selectedFields,
                    includeSizeVariable: false
                }));
            }
            else if (rendererType === "chart-size") {
                galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({
                    fieldInfos: selectedFields,
                    includeSizeVariable: true
                }));
            }
            else {
                if (mapImageSublayer && !advanced) {
                    galleryRequestWrapper(createRelationshipSizeRenderer({
                        fieldInfos: selectedFields
                    }));
                }
                else if (selectedFields[2].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE) {
                    galleryRequestWrapper(createRelationshipSizeRenderer({
                        fieldInfos: selectedFields
                    }));
                }
                else {
                    galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({
                        fieldInfos: selectedFields
                    }));
                }
            }
        }
    }
}
function createCertainRenderer(type, galleryRequestWrapper) {
    const { selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    switch (type) {
        case "simple":
            // remove selected attributes
            _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = [];
            galleryRequestWrapper((0,_location_e26b539f_js__WEBPACK_IMPORTED_MODULE_8__.c)());
            break;
        case "type":
            galleryRequestWrapper((0,_type_0ace5d2e_js__WEBPACK_IMPORTED_MODULE_15__.c)({ fieldInfos: selectedFields }));
            break;
        case "color":
            galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.c)({ fieldInfos: selectedFields }));
            break;
        case "size":
            galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.c)({ fieldInfos: selectedFields }));
            break;
        case "color-age":
            galleryRequestWrapper((0,_color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_9__.a)({ fieldInfos: selectedFields }));
            break;
        case "size-age":
            galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.a)({ fieldInfos: selectedFields }));
            break;
        case "dot-density":
            galleryRequestWrapper(createDotDensityRenderer({ fieldInfos: selectedFields }));
            break;
        case "heatmap":
            galleryRequestWrapper((0,_heatmap_75ffd452_js__WEBPACK_IMPORTED_MODULE_11__.c)({ fieldInfos: selectedFields }));
            break;
        case "compare":
            galleryRequestWrapper((0,_compare_ba1292fe_js__WEBPACK_IMPORTED_MODULE_14__.c)({ fieldInfos: selectedFields }));
            break;
        case "relationship":
            galleryRequestWrapper((0,_relationship_b72d7d97_js__WEBPACK_IMPORTED_MODULE_16__.c)({ fieldInfos: selectedFields }));
            break;
        case "relationship-size":
            galleryRequestWrapper(createRelationshipSizeRenderer({
                fieldInfos: selectedFields
            }));
            break;
        case "predominance":
            galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({ fieldInfos: selectedFields }));
            break;
        case "predominance-size":
            galleryRequestWrapper((0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_12__.c)({
                fieldInfos: selectedFields,
                includeSizeVariable: true
            }));
            break;
        case "chart":
            galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({ fieldInfos: selectedFields }));
            break;
        case "chart-size":
            galleryRequestWrapper((0,_chart_097ec280_js__WEBPACK_IMPORTED_MODULE_13__.c)({
                fieldInfos: selectedFields,
                includeSizeVariable: true
            }));
            break;
        case "type-size":
            galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.c)({ fieldInfos: selectedFields }));
            break;
        case "type-size-age":
            galleryRequestWrapper((0,_typeSize_9d4c5d28_js__WEBPACK_IMPORTED_MODULE_18__.a)({ fieldInfos: selectedFields }));
            break;
        case "color-size":
            if (selectedFields.length === 1) {
                galleryRequestWrapper((0,_colorSizeUnivariant_d266ac7c_js__WEBPACK_IMPORTED_MODULE_17__.c)({
                    fieldInfos: selectedFields
                }));
            }
            else {
                galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.b)({ fieldInfos: selectedFields }));
            }
            break;
        case "color-age-size":
            galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.d)({ fieldInfos: selectedFields }));
            break;
        case "color-size-age":
            galleryRequestWrapper((0,_colorSize_ce0ccdeb_js__WEBPACK_IMPORTED_MODULE_10__.e)({ fieldInfos: selectedFields }));
            break;
    }
}

function getAllowedStyles() {
    var _a, _b;
    const { layer, mapImageSublayer, selectedFields, supportsArcade } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    const isOGC = layer.type === "ogc-feature";
    const isWFS = layer.type === "wfs";
    const isStream = layer.type === "stream";
    const featureReduction = "featureReduction" in layer && layer.featureReduction;
    const fieldCount = selectedFields.length;
    const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.C)();
    const hasStringField = counts.string > 0;
    const hasDateField = counts.date > 0;
    const hasExpression = counts.expression > 0;
    //const hasUnknownType = counts.unknown > 0;
    const supportsSqlExpression = (_b = (_a = layer.capabilities) === null || _a === void 0 ? void 0 : _a.query) === null || _b === void 0 ? void 0 : _b.supportsSqlExpression;
    const advanced = isOGC || isWFS || isStream || supportsSqlExpression; // predom, chart, age, dotDensity, field-heatmap
    const list = [];
    list.push("simple");
    if (fieldCount === 1 && !hasStringField && !(mapImageSublayer && hasDateField)) {
        list.push("color");
    }
    if (fieldCount === 1 && !hasStringField && !(mapImageSublayer && hasDateField)) {
        list.push("size");
    }
    if ((!mapImageSublayer || supportsArcade) && fieldCount === 1 && hasDateField && !hasExpression && advanced) {
        list.push("color-age");
    }
    if ((!mapImageSublayer || supportsArcade) && fieldCount === 1 && hasDateField && !hasExpression && advanced) {
        list.push("size-age");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        (fieldCount === 1 || fieldCount === 2) &&
        !hasStringField &&
        !(mapImageSublayer && hasDateField)) {
        list.push("color-size");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount === 2 &&
        !hasStringField &&
        hasDateField &&
        selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
        !selectedFields[0].expression &&
        advanced &&
        !(mapImageSublayer && counts.date > 1)) {
        list.push("color-age-size");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount === 2 &&
        !hasStringField &&
        hasDateField &&
        selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
        !selectedFields[1].expression &&
        advanced &&
        !(mapImageSublayer && counts.date > 1)) {
        list.push("color-size-age");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount > 0 &&
        fieldCount <= 8 &&
        !hasExpression &&
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.q)(layer) &&
        !hasStringField &&
        !hasDateField &&
        advanced) {
        list.push("dot-density");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount > 1 &&
        fieldCount <= 10 &&
        !hasExpression &&
        !hasStringField &&
        !hasDateField &&
        advanced) {
        list.push("predominance");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount > 1 &&
        !hasExpression &&
        !hasStringField &&
        !hasDateField &&
        advanced) {
        list.push("predominance-size");
    }
    if (!mapImageSublayer &&
        !featureReduction &&
        fieldCount > 1 &&
        fieldCount <= 10 &&
        !hasExpression &&
        ["polygon", "point", "multipoint"].indexOf((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.D)(layer)) > -1 &&
        !hasStringField &&
        !hasDateField &&
        advanced) {
        list.push("chart");
    }
    if (!mapImageSublayer &&
        !featureReduction &&
        fieldCount > 1 &&
        !hasExpression &&
        ["polygon", "point", "multipoint"].indexOf((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.D)(layer)) > -1 &&
        !hasStringField &&
        !hasDateField &&
        advanced) {
        list.push("chart-size");
    }
    if ((!mapImageSublayer || supportsArcade) && fieldCount === 2 && !hasExpression && !hasStringField && !hasDateField) {
        list.push("relationship");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount === 3 &&
        (!hasExpression || (counts.expression === 1 && selectedFields[2].expression)) &&
        !(mapImageSublayer && hasDateField)) {
        list.push("relationship-size");
    }
    if ((!mapImageSublayer || supportsArcade) && fieldCount === 2 && !hasExpression && !hasStringField && !hasDateField) {
        list.push("compare");
    }
    if (fieldCount === 1 && !(mapImageSublayer && hasDateField)) {
        list.push("type");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount === 2 &&
        counts.date < 2 &&
        !(mapImageSublayer && hasDateField)) {
        list.push("type-size");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        fieldCount === 2 &&
        hasDateField &&
        counts.date < 2 &&
        selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE &&
        selectedFields[1].field &&
        advanced) {
        // age renderer has expression and field set
        list.push("type-size-age");
    }
    if ((!mapImageSublayer || supportsArcade) &&
        ["point", "multipoint"].indexOf((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.D)(layer)) > -1 &&
        !featureReduction &&
        ((advanced && fieldCount <= 1) || (!advanced && fieldCount === 0)) &&
        !hasStringField &&
        !hasDateField &&
        counts.expression === 0) {
        list.push("heatmap");
    }
    return list;
}
function getOrderForRendererType() {
    const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
    const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
    const fieldInfos = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.f)(layer);
    const fieldType1 = fieldInfos.length > 0 ? fieldInfos[0].simpleFieldType : null;
    //const fieldType2 =
    //  fieldInfos.length > 1 ? fieldInfos[1].simpleFieldType : null;
    let list = [];
    switch (rendererType) {
        case "simple":
            list = [
                "simple",
                "color",
                "size",
                "color-age",
                "size-age",
                "color-size",
                "type",
                "heatmap",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ];
            break;
        case "type":
            list = [
                "type",
                "color",
                "size",
                "color-age",
                "size-age",
                "color-size",
                "dot-density",
                "heatmap",
                "simple",
                "type-size",
                "type-size-age",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ];
            break;
        case "color":
            list = ["color", "size", "color-age", "size-age", "color-size", "dot-density"];
            if (fieldType1 === "string" || fieldType1 === "date") {
                list = list.concat(["type", "heatmap", "simple"]);
            }
            else {
                list = list.concat(["heatmap", "simple", "type"]);
            }
            list = list.concat([
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
            break;
        case "color-age":
            list = ["color-age", "color", "size", "size-age", "color-size", "dot-density"];
            if (fieldType1 === "string" || fieldType1 === "date") {
                list = list.concat(["type", "heatmap", "simple"]);
            }
            else {
                list = list.concat(["heatmap", "simple", "type"]);
            }
            list = list.concat([
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
            break;
        case "size":
            list = ["size", "size-age", "color", "color-age", "color-size", "dot-density"];
            if (fieldType1 === "string" || fieldType1 === "date") {
                list = list.concat(["type", "heatmap", "simple"]);
            }
            else {
                list = list.concat(["heatmap", "simple", "type"]);
            }
            list = list.concat([
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
            break;
        case "size-age":
            list = ["size-age", "size", "color-age", "color", "color-size", "dot-density"];
            if (fieldType1 === "string" || fieldType1 === "date") {
                list = list.concat(["type", "heatmap", "simple"]);
            }
            else {
                list = list.concat(["heatmap", "simple", "type"]);
            }
            list = list.concat([
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
            break;
        case "heatmap":
            list = ["heatmap", "color", "size", "color-age", "size-age", "color-size", "dot-density"];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            list = list.concat([
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
            break;
        case "predominance":
            list = [
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "compare",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            break;
        case "chart":
            list = [
                "chart",
                "chart-size",
                "predominance",
                "predominance-size",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "compare",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            break;
        case "dot-density":
            list = [
                "dot-density",
                "color-size",
                "color-age-size",
                "color-size-age",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "compare",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            break;
        case "compare":
            list = [
                "compare",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type"]);
            }
            list = list.concat(["simple"]);
            if (!fieldType1 || fieldType1 !== "string") {
                list = list.concat(["type"]);
            }
            break;
        case "relationship":
            list = [
                "relationship",
                "relationship-size",
                "compare",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type"]);
            }
            list = list.concat(["simple"]);
            if (!fieldType1 || fieldType1 !== "string") {
                list = list.concat(["type"]);
            }
            break;
        case "color-size":
            list = [
                "color-size",
                "color-age-size",
                "color-size-age",
                "color",
                "size",
                "color-age",
                "size-age",
                "compare",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "type",
                "heatmap",
                "simple"
            ];
            break;
        case "color-age-size":
            list = [
                "color-age-size",
                "color-size-age",
                "color-size",
                "compare",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "color",
                "color-age",
                "size",
                "size-age",
                "simple",
                "type",
                "heatmap"
            ];
            break;
        case "color-size-age":
            list = [
                "color-size-age",
                "color-age-size",
                "color-size",
                "compare",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "color",
                "color-age",
                "size",
                "size-age",
                "simple",
                "type",
                "heatmap"
            ];
            break;
        case "type-size":
            list = [
                "type-size",
                "type-size-age",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "type",
                "size",
                "simple",
                "color",
                "color-age",
                "size-age",
                "heatmap",
                "compare",
                "relationship",
                "relationship-size"
            ];
            break;
        case "type-size-age":
            list = [
                "type-size-age",
                "type-size",
                "color-age-size",
                "color-size-age",
                "color-size",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "type",
                "size",
                "size-age",
                "simple",
                "color",
                "color-age",
                "heatmap",
                "compare",
                "relationship",
                "relationship-size"
            ];
            break;
        case "predominance-size":
            list = [
                "predominance-size",
                "predominance",
                "chart-size",
                "chart",
                "dot-density",
                "color-size",
                "color-age-size",
                "color-size-age",
                "compare",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            break;
        case "chart-size":
            list = [
                "chart-size",
                "chart",
                "predominance-size",
                "predominance",
                "dot-density",
                "color-size",
                "color-age-size",
                "color-size-age",
                "compare",
                "relationship",
                "relationship-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type", "simple"]);
            }
            else {
                list = list.concat(["simple", "type"]);
            }
            break;
        case "relationship-size":
            list = [
                "relationship-size",
                "relationship",
                "compare",
                "color-size",
                "color-age-size",
                "color-size-age",
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "type-size",
                "type-size-age",
                "heatmap",
                "color",
                "size",
                "color-age",
                "size-age"
            ];
            if (fieldType1 === "string") {
                list = list.concat(["type"]);
            }
            list = list.concat(["simple"]);
            if (fieldType1 !== "string") {
                list = list.concat(["type"]);
            }
            break;
        default:
            list = ["color", "size", "color-age", "size-age", "color-size"];
            if (fieldType1 === "string") {
                list = list.concat(["type"]);
            }
            list = list.concat(["heatmap", "simple"]);
            if (fieldType1 !== "string") {
                list = list.concat(["type"]);
            }
            list = list.concat([
                "dot-density",
                "predominance",
                "predominance-size",
                "chart",
                "chart-size",
                "color-age-size",
                "color-size-age",
                "type-size",
                "type-size-age",
                "compare",
                "relationship",
                "relationship-size"
            ]);
    }
    return list;
}

const arcgisSmartMappingPanelsGalleryCss = ".add-button-div{margin:0 3px}.add-buttons{display:flex;flex-direction:row;justify-content:space-between;background-color:#ffffff}.attributes{padding:6px 6px 0 6px;background-color:#ffffff}.attributes-header-text{font-weight:bold;font-size:16px;padding:10px 0}.attributes-msg{font-size:var(--calcite-font-size--2)}.attributes-add-new{margin-top:10px}.tip{margin-top:15px;display:flex;justify-content:space-between}.tip-message{justify-content:center}.tip-text{color:#3d5f1d}.tip-close{margin-top:4px}.field-type{display:flex;align-items:center;height:100%;color:var(--calcite-color-text-1)}.attribute-list{border-bottom:1px solid #e0e0e0}.gallery-block{padding:12px 3px;margin-bottom:12px;background-color:#ffffff;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.center{display:flex;align-items:center;justify-content:center;text-align:center}.number-icon{color:var(--calcite-color-brand)}.styles-msg-title{padding:6px;font-weight:bold;font-size:16px;display:flex;justify-content:center}.styles-msg{font-size:var(--calcite-font-size--2)}";

const ArcgisSmartMappingPanelsGallery = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsGalleryClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsGalleryClose", 7);
        this.arcgisSmartMappingPanelsGalleryError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsGalleryError", 7);
        this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsGalleryClusterRequiresUpdate", 7);
        this.tileNodes = [];
        this.lastSortBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_5__.L.default;
        this.addExpression = async () => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
            try {
                // open Arcade editor
                const fieldInfo = await (0,_feature_1ce1b984_js__WEBPACK_IMPORTED_MODULE_1__.u)();
                if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.UNKNOWN) {
                    // let's just assume it's a number; maybe it didn't have good test data
                    fieldInfo.simpleFieldType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER;
                }
                const { selectedFields, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                if (selectedFields.length === 2 && (fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                    // can't use a string field for size component of relationship+size
                    this.arcgisSmartMappingPanelsGalleryError.emit({
                        message: strings.panels.gallery.errors.expressionMustBeNumber,
                        type: "warning"
                    });
                    return;
                }
                else if (selectedFields.length === 1 &&
                    selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING &&
                    (fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                    // can't use 2 string fields
                    this.arcgisSmartMappingPanelsGalleryError.emit({
                        message: strings.panels.gallery.errors.expressionMustBeNumber,
                        type: "warning"
                    });
                    return;
                }
                const newSelectedFields = modules.esriLang.clone(selectedFields);
                newSelectedFields.push(fieldInfo);
                if (newSelectedFields.length === 3) {
                    for (let i = 0; i < 3; i++) {
                        const fieldInfo = newSelectedFields[i];
                        if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE && i !== 2) {
                            // move to end for 'Relationship & Size'
                            newSelectedFields.splice(i, 1);
                            newSelectedFields.splice(2, 0, fieldInfo);
                            break;
                        }
                    }
                }
                if (newSelectedFields.length > 1 &&
                    newSelectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                    newSelectedFields.reverse();
                }
                _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = newSelectedFields;
                createNewRendererWithDelay(this.galleryRequestWrapper);
            }
            catch (e) {
                this.addExpressionButtonNode.setFocus();
            }
        };
        this.handleArcadeEdit = async (editIdx) => {
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
            try {
                const { selectedFields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                // open Arcade editor
                const fieldInfo = await (0,_feature_1ce1b984_js__WEBPACK_IMPORTED_MODULE_1__.u)(selectedFields[editIdx]);
                if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.UNKNOWN) {
                    // let's just assume it's a number; maybe it didn't have good test data
                    fieldInfo.simpleFieldType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER;
                }
                if (editIdx !== 0 && (fieldInfo === null || fieldInfo === void 0 ? void 0 : fieldInfo.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                    // editing an expression
                    if (selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                        // can't do 2 string fields
                        this.arcgisSmartMappingPanelsGalleryError.emit({
                            message: strings.panels.gallery.errors.expressionMustBeNumber,
                            type: "warning"
                        });
                        return;
                    }
                }
                if (fieldInfo.simpleFieldType === "string") {
                    // add in front
                    selectedFields.splice(editIdx, 1);
                    selectedFields.unshift(fieldInfo);
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                }
                else {
                    selectedFields[editIdx] = fieldInfo;
                }
                _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = selectedFields;
                createNewRendererWithDelay(this.galleryRequestWrapper);
            }
            catch (e) {
                this.addExpressionButtonNode.setFocus();
            }
        };
        this.handleListOrderChange = (event) => {
            const { selectedFields, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            const newSelectedFields = [];
            event.target
                .querySelectorAll("calcite-list-item")
                .forEach((item) => {
                newSelectedFields.push(modules.esriLang.clone(selectedFields[parseInt(item.value)]));
            });
            _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = newSelectedFields;
            createNewRendererWithDelay(this.galleryRequestWrapper);
        };
        this.handleListChange = (value) => {
            const { selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            const isExpression = !!selectedFields[value].expression;
            isExpression ? this.handleArcadeEdit(value) : this.openFieldPickList(true, value);
        };
        this.handleRemoveAttribute = (idx) => {
            this.modifyFieldPickList = true;
            const { selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = selectedFields === null || selectedFields === void 0 ? void 0 : selectedFields.filter((_, idx2) => idx2 !== idx);
            createNewRendererWithDelay(this.galleryRequestWrapper);
        };
        this.handleSelectClick = (type) => {
            createCertainRenderer(type, this.galleryRequestWrapper);
        };
        this.handleOptionsClick = (type) => {
            const { flowNode } = this;
            const { selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            switch (type) {
                case "simple": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-simple");
                    flowItem.addEventListener("arcgisSmartMappingPanelsSimpleClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSimpleBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsSimpleError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "color":
                case "color-age": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-color");
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorBackClick", () => {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsColorError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "size":
                case "size-age": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-size");
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeBackClick", () => {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "type": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-type");
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate", () => {
                        this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit();
                    });
                    flowItem.addEventListener("onArcgisSmartMappingPanelsTypeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "compare": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-compare");
                    flowItem.addEventListener("arcgisSmartMappingPanelsCompareClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsCompareBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsCompareError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "heatmap": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-heatmap");
                    flowItem.addEventListener("arcgisSmartMappingPanelsHeatmapClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsHeatmapError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "predominance": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-predominance");
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "chart": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-chart");
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "relationship": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-relationship");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "dot-density": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-dot-density");
                    flowItem.addEventListener("arcgisSmartMappingPanelsDotDensityClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsDotDensityError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "color-size":
                case "color-age-size":
                case "color-size-age": {
                    if (selectedFields.length > 1) {
                        const flowItem = document.createElement("arcgis-smart-mapping-panels-color-size");
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeClose", () => {
                            flowNode.removeChild(flowItem);
                            this.focusSelectedTile();
                        });
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick", () => this.focusSelectedTile());
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                        flowNode.appendChild(flowItem);
                    }
                    else {
                        //selectedFields.length === 1
                        const flowItem = document.createElement("arcgis-smart-mapping-panels-color-size-univariate");
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose", () => {
                            flowNode.removeChild(flowItem);
                            this.focusSelectedTile();
                        });
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick", () => {
                            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                            this.focusSelectedTile();
                        });
                        flowItem.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                        flowNode.appendChild(flowItem);
                    }
                    break;
                }
                case "type-size":
                case "type-size-age": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-type-size");
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsTypeSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "predominance-size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-predominance-size");
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "chart-size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-chart-size");
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsChartSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
                case "relationship-size": {
                    const flowItem = document.createElement("arcgis-smart-mapping-panels-relationship-size");
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose", () => {
                        flowNode.removeChild(flowItem);
                        this.focusSelectedTile();
                    });
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick", () => this.focusSelectedTile());
                    flowItem.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError", ({ detail }) => this.arcgisSmartMappingPanelsGalleryError.emit(detail));
                    flowNode.appendChild(flowItem);
                    break;
                }
            }
        };
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsGalleryClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsGalleryClose.emit("cancel");
        };
        /*
         * Place panel in loading mode during renderer creation.
         */
        this.galleryRequestWrapper = (request) => {
            const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
            (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_3__.r)(request, this.flowItemNode).then((result) => {
                const { layer, mapImageSublayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.e)(result.renderer.clone(), layer);
                if (mapImageSublayer) {
                    mapImageSublayer.renderer = result.renderer;
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.checkCluster();
                this.checkClusterRenderer();
                this.focusSelectedTile();
            }, () => {
                this.arcgisSmartMappingPanelsGalleryError.emit({
                    message: strings.panels.gallery.errors.changeRendererErrorMsg,
                    type: "warning"
                });
            });
        };
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.flowNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.F)(this.hostElement, "calcite-flow");
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a, _b, _c;
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        let displayWarning = false;
        if ("featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "cluster") {
            const featureReduction = layer.featureReduction;
            if (((_b = featureReduction.renderer) === null || _b === void 0 ? void 0 : _b.type) === "pie-chart" &&
                !((_c = featureReduction.renderer.authoringInfo) === null || _c === void 0 ? void 0 : _c.isAutoGenerated)) {
                displayWarning = true;
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.gallery.styles, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.C.rtl]: isRTL
            }, closable: true, menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, ref: (node) => (this.flowItemNode = node) }, displayWarning ? this.renderClusteringWarning() : this.renderGalleryContent())));
    }
    renderGalleryContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.renderDoneButton(), this.renderCancelButton(), this.renderStepOne(), this.renderStepTwo()));
    }
    renderClusteringWarning() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tip", { closeDisabled: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.panels.gallery.chartClusterMsg))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleCancel, appearance: "outline-fill", width: "full" }, strings.done)));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderStepOne() {
        const { layer, selectedFields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const fieldCount = selectedFields.length;
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.C)();
        const hasStringField = counts.string > 0;
        const thirdIsExpr = fieldCount === 3 && selectedFields[2].expression;
        const thirdIsDate = fieldCount === 3 && selectedFields[2].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE;
        let fieldsSelection = selectedFields.map((__, idx) => this.renderAttribute(idx));
        const dragEnabled = fieldCount > 1 && !hasStringField && !thirdIsExpr && !thirdIsDate;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "attributes gallery-block" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "center" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "number-icon", scale: "m", icon: "number-circle-1" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "attributes-header-text center" }, strings.panels.gallery.chooseAttributes)), !fieldCount && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "attributes-msg center" }, strings.panels.gallery.chooseAttributesMsg)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: fieldsSelection.length > 0 ? "attribute-list" : "", key: `gallery-attributes-selects-${selectedFields}`, dragEnabled: dragEnabled, onCalciteListOrderChange: this.handleListOrderChange }, fieldsSelection), layer && this.renderAddButtons(), layer && this.renderTip()));
    }
    renderAttribute(idx) {
        const { selectedFields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const fieldID = selectedFields[idx].field || selectedFields[idx].expressionTitle;
        const isExpression = !!selectedFields[idx].expression;
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(selectedFields[idx].field);
        const fieldLabel = field ? field.label : selectedFields[idx].expressionTitle;
        const fieldType = selectedFields[idx].simpleFieldType;
        const icon = !isExpression &&
            (fieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER
                ? "number"
                : fieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING
                    ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.z)(field === null || field === void 0 ? void 0 : field.layerField) === "date-only"
                        ? "calendar"
                        : "string"
                    : fieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE
                        ? "date-time"
                        : null);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: `gallery-attribute-${idx}-${fieldID}`, label: fieldLabel, value: idx, onClick: (event) => event.target && this.handleListChange(idx), onKeyDown: (event) => {
                if (event.key === " ") {
                    event.preventDefault();
                    this.handleListChange(idx);
                }
            } }, icon && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-end" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: icon, class: "field-type" }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { key: `gallery-attribute-${idx}-${fieldID}-remove`, slot: "actions-end", text: isExpression
                ? strings.panels.gallery.removeExpression
                : strings.panels.gallery.removeField, label: isExpression
                ? strings.panels.gallery.removeExpression
                : strings.panels.gallery.removeField, onClick: (event) => {
                event.stopPropagation();
                this.handleRemoveAttribute(idx);
            }, onKeyDown: (event) => {
                if (event.key === "Enter" || event.key === " ") {
                    event.stopPropagation();
                    this.handleRemoveAttribute(idx);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x" }))));
    }
    renderTip() {
        var _a;
        const { selectedFields, portal, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if (selectedFields.length > 1) {
            return;
        }
        if ((!selectedFields.length &&
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.G)(_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.N.ARCGIS_COMPONENT_NOTIFICATIONS, _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.M.SMART_MAPPING_TIP1_DISMISSED)) ||
            (selectedFields.length === 1 &&
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.G)(_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.N.ARCGIS_COMPONENT_NOTIFICATIONS, _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.M.SMART_MAPPING_TIP2_DISMISSED))) {
            return null;
        }
        const pos = strings.panels.gallery.tip1.indexOf("${smartMappingLink}");
        const helpMap = ((_a = portal.helpMap) === null || _a === void 0 ? void 0 : _a.m) || portal.helpMap;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "gallery-tip", class: "tip" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { key: "gallery-tip-message", icon: "lightbulb", class: "tip-message" }, selectedFields.length === 0 && portal.helpBase && helpMap ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "gallery-tip-text" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "tip-text" }, strings.panels.gallery.tip1.substring(0, pos)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { target: "_blank", href: `${portal.helpBase}${helpMap["120003249"]}` }, strings.panels.gallery.tip1Link), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "tip-text" }, strings.panels.gallery.tip1.substring(pos + 19)))) : selectedFields.length === 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { key: "gallery-tip-text", class: "tip-text" }, strings.panels.gallery.tip1.replace("${smartMappingLink}", strings.panels.gallery.tip1Link), " ")) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { key: "gallery-tip-text", class: "tip-text" }, strings.panels.gallery.tip2))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", label: strings.close, text: strings.close, onClick: () => {
                const { selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
                if (!selectedFields.length) {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.H)(_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.N.ARCGIS_COMPONENT_NOTIFICATIONS, {
                        key: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.M.SMART_MAPPING_TIP1_DISMISSED,
                        value: "true"
                    });
                }
                else {
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.H)(_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.N.ARCGIS_COMPONENT_NOTIFICATIONS, {
                        key: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.M.SMART_MAPPING_TIP2_DISMISSED,
                        value: "true"
                    });
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x" }))));
    }
    renderAddButtons() {
        var _a, _b;
        const { layer, mapImageSublayer, selectedFields, strings, supportsArcade } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const fieldCount = selectedFields.length;
        const layerCounts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.I)();
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.C)();
        const hasStringField = counts.string > 0;
        const hasDateField = counts.date > 0;
        const hasExpression = counts.expression > 0;
        const supportsSqlExpression = (_b = (_a = layer.capabilities) === null || _a === void 0 ? void 0 : _a.query) === null || _b === void 0 ? void 0 : _b.supportsSqlExpression;
        // do we have renderer styles for more fields?
        let enableAddField = !(mapImageSublayer && !supportsArcade && fieldCount === 1) &&
            fieldCount < 10 &&
            !(fieldCount === 2 && (hasStringField || hasExpression)) &&
            !(mapImageSublayer && fieldCount === 2 && hasDateField) &&
            !(fieldCount === 3 &&
                (hasDateField || selectedFields[2].expression || !supportsSqlExpression));
        // do we have more layer fields?
        enableAddField =
            enableAddField &&
                ((counts.string === 1 &&
                    counts.number + counts.date === 0 &&
                    layerCounts.number + layerCounts.date > 0) ||
                    (counts.string === 0 &&
                        counts.date < 2 &&
                        counts.number + counts.date < 3 &&
                        counts.string + counts.number + counts.date <
                            layerCounts.string + layerCounts.number + layerCounts.date) ||
                    (counts.number >= 2 && counts.number < layerCounts.number));
        const enableAddExpression = (!mapImageSublayer || supportsArcade) &&
            (fieldCount < 2 ||
                (fieldCount === 2 &&
                    !hasExpression &&
                    selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER &&
                    selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "add-button-div" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "add-buttons" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { disabled: !enableAddField, onClick: () => this.openFieldPickList(), appearance: "outline-fill", kind: "neutral", width: "full", label: strings.panels.gallery.addField, iconStart: "plus", class: "attributes-add-new", ref: (node) => (this.addFieldButtonNode = node) }, strings.panels.gallery.field), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, "\u00A0\u00A0"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { disabled: !enableAddExpression, onClick: this.addExpression, appearance: "outline-fill", kind: "neutral", width: "full", label: strings.panels.gallery.addExpression, iconStart: "plus", class: "attributes-add-new", ref: (node) => (this.addExpressionButtonNode = node) }, strings.expression))));
    }
    renderStepTwo() {
        const { selectedFields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        const allowedList = getAllowedStyles();
        const orderedList = getOrderForRendererType();
        const msg = !(selectedFields === null || selectedFields === void 0 ? void 0 : selectedFields.length)
            ? strings.panels.gallery.styleMsg.empty
            : selectedFields.length === 1 &&
                selectedFields[0].field &&
                selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER
                ? strings.panels.gallery.styleMsg.oneNumber
                : selectedFields.length === 2 &&
                    selectedFields[0].field &&
                    selectedFields[1].field &&
                    selectedFields[0].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER &&
                    selectedFields[1].simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.NUMBER
                    ? strings.panels.gallery.styleMsg.multipleNumber
                    : strings.panels.gallery.styleMsg.any;
        //console.log(getRendererType(), allowedList, orderedList);
        allowedList.sort((a, b) => {
            return orderedList.indexOf(a) - orderedList.indexOf(b);
        });
        const styleTiles = allowedList.map((style, idx) => this.renderStyleTile(style, idx));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "gallery-block" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "attributes-header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "center" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "number-icon", scale: "m", icon: "number-circle-2" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "styles-msg-title center" }, strings.panels.gallery.pickStyle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "styles-msg center" }, msg)), styleTiles));
    }
    renderStyleTile(type, idx) {
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.g)();
        const theme = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.J)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-tile", { key: `tile-${type}-${theme}`, tileType: "gallery", type: type, selected: type === rendererType, ref: (node) => {
                /* Workaround for null-related ref issue: https://github.com/ionic-team/stencil/issues/3253
                All "if (node)" checks in arcgis-smart-mapping are workarounds for this same issue! */
                if (node) {
                    this.tileNodes[idx] = node;
                }
            }, onArcgisSmartMappingTileSelect: () => this.handleSelectClick(type), onArcgisSmartMappingTileOptions: () => this.handleOptionsClick(type), onArcgisSmartMappingTileError: (event) => this.arcgisSmartMappingPanelsGalleryError.emit(event.detail) }));
    }
    //--------------------------------------------------------------------------
    //
    //  Private methods
    //
    //--------------------------------------------------------------------------
    addField(fieldNames) {
        const { selectedFields, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.K)(fieldNames);
        const newSelectedFields = modules.esriLang.clone(selectedFields);
        fieldNames.forEach((fieldName) => {
            const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(fieldName);
            if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING) {
                // add in front for 'Type & Size'
                newSelectedFields.unshift({
                    field: fieldName,
                    simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING
                });
            }
            else {
                newSelectedFields.push({
                    field: fieldName,
                    simpleFieldType: fieldInfo.simpleFieldType
                });
            }
        });
        if (newSelectedFields.length === 3) {
            for (let i = 0; i < 3; i++) {
                const fieldInfo = newSelectedFields[i];
                if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.DATE && i !== 2) {
                    // move to end for 'Relationship & Size'
                    newSelectedFields.splice(i, 1);
                    newSelectedFields.splice(2, 0, fieldInfo);
                    break;
                }
            }
        }
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.v)(selectedFields, newSelectedFields)) {
            _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = newSelectedFields;
            createNewRendererWithDelay(this.galleryRequestWrapper);
        }
    }
    editAttribute(fieldNames, editIdx) {
        const { selectedFields, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.K)(fieldNames);
        const oldSelectedFields = modules.esriLang.clone(selectedFields);
        fieldNames.forEach((fieldName) => {
            const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.u)(fieldName);
            if (fieldInfo.simpleFieldType === "string") {
                // add in front
                selectedFields.splice(editIdx, 1);
                selectedFields.unshift({
                    field: fieldName,
                    simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.w.STRING
                });
            }
            else {
                selectedFields[editIdx] = {
                    field: fieldName,
                    simpleFieldType: fieldInfo.simpleFieldType
                };
            }
        });
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.v)(selectedFields, oldSelectedFields)) {
            _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s.selectedFields = selectedFields;
            createNewRendererWithDelay(this.galleryRequestWrapper);
        }
    }
    checkCluster() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        "featureReduction" in layer &&
            layer.featureReduction &&
            this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit();
    }
    checkClusterRenderer() {
        var _a;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        if ("featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "cluster") {
            const cluster = layer.featureReduction;
            // recreate default renderer
            cluster.renderer = null;
            layer.featureReduction = cluster.clone();
        }
    }
    openFieldPickList(singleEditMode = false, editIndex = null) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.E)();
        const { fields, selectedFields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.s;
        let selectedFieldNames = selectedFields.map((field) => field.field);
        let fieldsForPickList;
        fieldsForPickList = fields.filter((field) => {
            // remove currently selected fields and if single edit mode
            let include = !selectedFieldNames.includes(field.layerField.name);
            if (singleEditMode) {
                include = include || field.layerField.name === selectedFieldNames[editIndex];
            }
            return include;
        });
        const fieldPickList = document.createElement("arcgis-smart-mapping-field-pick-list");
        fieldPickList.fields = fieldsForPickList;
        fieldPickList.popoverProps = {
            refElement: this.flowItemNode,
            placement: "leading",
            offsetDistance: 0,
            popoverWidth: this.flowItemNode.getBoundingClientRect().width * 1.05,
            overlayPositioning: "absolute",
            flipDisabled: false,
            triggerDisabled: true
        };
        fieldPickList.singleEditMode = singleEditMode;
        fieldPickList.fieldToReplace = singleEditMode ? selectedFields[editIndex] : null;
        fieldPickList.lastSortBy = this.lastSortBy;
        document.body.appendChild(fieldPickList);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.L)(this.flowItemNode, true);
        fieldPickList.addEventListener("arcgisSmartMappingFieldPickListClose", (event) => {
            var _a;
            this.modifyFieldPickList = true;
            document.body.removeChild(fieldPickList);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_2__.L)(this.flowItemNode, false);
            if ((_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) {
                if (singleEditMode) {
                    this.editAttribute(event.detail.selectedFields, editIndex);
                }
                else {
                    this.addField(event.detail.selectedFields);
                }
            }
            this.addFieldButtonNode.setFocus();
        });
        fieldPickList.addEventListener("arcgisSmartMappingFieldPickListSortByChange", (event) => {
            this.lastSortBy = event.detail;
        });
    }
    focusSelectedTile() {
        setTimeout(() => requestAnimationFrame(() => { var _a; return (_a = this.tileNodes[0]) === null || _a === void 0 ? void 0 : _a.setFocus(); }), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsGallery.style = arcgisSmartMappingPanelsGalleryCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-gallery.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/compare-ba1292fe.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/compare-ba1292fe.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ createCompareRendererFromExisting),
/* harmony export */   c: () => (/* binding */ createCompareRenderer)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * Updates the layer with a Compare renderer with default settings
 * @param props: must contain layer, mapView, field
 * @param options: options
 */
function createCompareRenderer(options) {
    var _a;
    const { layer: smLayer, mapImageSublayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const extras = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.m)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer));
    return modules.ColorCreator.createContinuousRenderer({
        layer,
        view: mapView,
        field: options.fieldInfos[0].field,
        theme: "above-and-below",
        colorScheme: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.P)("above-and-below"),
        normalizationField: options.fieldInfos[1].field,
        outlineOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.outlineOptimizationEnabled)
                ? options.outlineOptimizationEnabled
                : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.q)(layer),
        sizeOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.sizeOptimizationEnabled)
                ? options.sizeOptimizationEnabled
                : true,
        legendOptions: options.legendOptions,
        defaultSymbolEnabled: false,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        const colorAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(result.renderer, "color") || {};
        colorAuthVisVar.style = "ratio"; // "ratio", "percent", "percent-of-total"
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.l)(extras, result.renderer);
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
/**
 * Creates a Compare renderer with settings from current renderer
 * @param props: only contains properties that need to be overwritten
 */
function createCompareRendererFromExisting(options) {
    var _a, _b, _c, _d;
    const { layer: smLayer, mapImageSublayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(renderer, "color");
    if (colorVisVar &&
        options.fieldInfo &&
        options.fieldInfo.field == colorVisVar.field &&
        options.normalizationField === colorVisVar.normalizationField) {
        // no changes to fields
        delete options.fieldInfos;
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.R)(options)) {
            // nothing really changes
            return Promise.resolve({ renderer: renderer.clone() });
        }
    }
    const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(renderer, "color");
    const extras = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.m)(renderer);
    let fieldInfo = options.fieldInfos
        ? options.fieldInfos[0]
        : colorVisVar
            ? {
                field: colorVisVar.field,
                expression: colorVisVar.valueExpression,
                expressionTitle: colorVisVar.valueExpressionTitle,
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.w.NUMBER
            }
            : {
                field: renderer.field,
                expression: renderer.valueExpression,
                expressionTitle: renderer.valueExpressionTitle,
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.w.NUMBER
            };
    const normalizationField = options.normalizationField
        ? options.normalizationField
        : colorVisVar
            ? colorVisVar.normalizationField
            : renderer.normalizationField;
    const symbol = renderer.classBreakInfos && renderer.classBreakInfos.length ? renderer.classBreakInfos[0].symbol : null;
    const defaultSymbol = renderer.defaultSymbol;
    const defaultLabel = renderer.defaultLabel;
    let needNewStatistics = false;
    if (options.normalizationField === null || options.normalizationField || options.fieldInfo) {
        needNewStatistics = true;
    }
    const minValue = options.discardMinMax
        ? undefined
        : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.min)
            ? options.min
            : needNewStatistics
                ? undefined
                : authColorVisVar
                    ? authColorVisVar.minSliderValue
                    : renderer.classBreakInfos[0].minValue;
    const maxValue = options.discardMinMax
        ? undefined
        : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.max)
            ? options.max
            : needNewStatistics
                ? undefined
                : authColorVisVar
                    ? authColorVisVar.maxSliderValue
                    : renderer.classBreakInfos[renderer.classBreakInfos.length - 1].maxValue;
    return modules.ColorCreator.createContinuousRenderer({
        layer,
        view: mapView,
        field: fieldInfo ? fieldInfo.field : renderer.field,
        theme: "above-and-below",
        colorScheme: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.P)("above-and-below"),
        normalizationField,
        minValue,
        maxValue,
        outlineOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.outlineOptimizationEnabled)
                ? options.outlineOptimizationEnabled
                : !!extras.sizeOutlineVisVar,
        sizeOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.sizeOptimizationEnabled)
                ? options.sizeOptimizationEnabled
                : !!extras.sizeAutoVisVar,
        legendOptions: ((_a = options.legendOptions) === null || _a === void 0 ? void 0 : _a.toJSON()) ||
            ((_b = colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.legendOptions) === null || _b === void 0 ? void 0 : _b.toJSON()) ||
            ((_c = renderer.legendOptions) === null || _c === void 0 ? void 0 : _c.toJSON()),
        defaultSymbolEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.defaultSymbolEnabled)
            ? options.defaultSymbolEnabled
            : !!renderer.defaultSymbol,
        forBinning: ((_d = layer.featureReduction) === null || _d === void 0 ? void 0 : _d.type) === "binning"
    }).then((result) => {
        // reset handles if necessary
        if (options.discardMinMax) {
            const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(renderer, "color");
            const newColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "color");
            colorVisVar.stops.forEach((stop, idx) => (stop.value = newColorVisVar.stops[idx].value));
        }
        const colorAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(result.renderer, "color") || {};
        colorAuthVisVar.style = "ratio";
        //console.log("createContinuousRenderer", result);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.l)(extras, result.renderer);
        if (symbol && result.renderer.classBreakInfos && result.renderer.classBreakInfos.length) {
            result.renderer.classBreakInfos[0].symbol = symbol;
        }
        if (defaultSymbol) {
            result.renderer.defaultSymbol = defaultSymbol;
            result.renderer.defaultLabel = defaultLabel;
        }
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}



//# sourceMappingURL=compare-ba1292fe.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/heatmap-75ffd452.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ updateWithHeatmapStatistics),
/* harmony export */   c: () => (/* binding */ createHeatmapRenderer),
/* harmony export */   u: () => (/* binding */ updateHeatmapRendererwithFade)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * Updates the layer with a Heatmap renderer with default settings
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function createHeatmapRenderer(options) {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    options = options || {};
    if (rendererType === "heatmap") {
        options.radius = options.radius || renderer.radius;
        options.heatmapScheme = options.heatmapScheme || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.V)();
    }
    if ((_a = options.fieldInfos) === null || _a === void 0 ? void 0 : _a.length) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.O)([options.fieldInfos[0].field]);
    }
    return modules.HeatmapCreator.createRenderer({
        layer,
        view: mapView,
        field: options.fieldInfos && options.fieldInfos.length ? options.fieldInfos[0].field : null,
        radius: options.radius || 10,
        heatmapScheme: options.heatmapScheme || undefined
    });
}
/**
 * Updates the Heatmap renderer with a new fadeRatio
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param fadeRatio: new value
 */
function updateHeatmapRendererwithFade(fadeRatio) {
    const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    return modules.HeatmapCreator.updateRenderer({
        renderer,
        fadeRatio
    });
}
/**
 * Updates the layer with a new radius
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function updateWithHeatmapStatistics(options) {
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    options = options || {};
    // workaround for: This expression is not callable. Type 'heatmapStatistics' has no call signatures.ts(2349)
    //const _heatmapStatistics: any = modules.heatmapStatistics;
    return modules
        .heatmapStatistics({
        layer,
        view: mapView,
        field: renderer.field,
        radius: options.radius || renderer.radius || 10
    })
        .then((statistics) => {
        renderer.minDensity = statistics.min;
        renderer.maxDensity = statistics.max;
        return Promise.resolve(statistics);
    }, (error) => Promise.reject(error));
}



//# sourceMappingURL=heatmap-75ffd452.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ buildOutlineVisVar),
/* harmony export */   b: () => (/* binding */ buildSizeAutoVisVar),
/* harmony export */   c: () => (/* binding */ createSimpleRenderer)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * Updates the layer with a Simple renderer with default settings
 * @param options: options
 */
function createSimpleRenderer(options) {
    var _a;
    const { layer: smLayer, mapImageSublayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const extras = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.m)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer));
    return modules.LocationCreator.createRenderer({
        layer,
        view: mapView,
        outlineOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.outlineOptimizationEnabled)
                ? options.outlineOptimizationEnabled
                : true,
        sizeOptimizationEnabled: mapImageSublayer
            ? false
            : (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.sizeOptimizationEnabled)
                ? options.sizeOptimizationEnabled
                : true,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.l)(extras, result.renderer);
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
function buildOutlineVisVar() {
    var _a;
    // TODO - can we just get the visualVariable without a full renderer?
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    return modules.LocationCreator.createRenderer({
        layer,
        view: mapView,
        outlineOptimizationEnabled: true,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        const sizeOutlineVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "size", "outline");
        return Promise.resolve(sizeOutlineVisVar);
    });
}
function buildSizeAutoVisVar() {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    return modules.LocationCreator.createRenderer({
        layer,
        view: mapView,
        outlineOptimizationEnabled: false,
        sizeOptimizationEnabled: true,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        const sizeAutoVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "size", "auto");
        return Promise.resolve(sizeAutoVisVar);
    });
}



//# sourceMappingURL=location-e26b539f.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTcyNTdiYi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzhJO0FBQ2pGO0FBQzh2QjtBQUMvdkI7QUFDekI7QUFDMEI7QUFDQztBQUNDO0FBQ0k7QUFDeUI7QUFDa0c7QUFDM0g7QUFDVTtBQUNkO0FBQ0k7QUFDTjtBQUNnQjtBQUNjO0FBQ1U7QUFDdkU7QUFDSDtBQUNFOztBQUU3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1DQUFtQyxFQUFFLCtEQUFpQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtEQUFTO0FBQzdCLDRCQUE0QiwrREFBUztBQUNyQyxxQ0FBcUMsK0RBQVM7QUFDOUM7QUFDQTtBQUNBLG9DQUFvQywrREFBUztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxhQUFhO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsMEJBQTBCLCtEQUFpQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFFBQVEsRUFBRSwrREFBaUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsbUVBQVc7QUFDcEQscUNBQXFDLDBCQUEwQjtBQUMvRCxTQUFTO0FBQ1Q7QUFDQSxXQUFXLDZEQUEwQiwrQkFBK0IsY0FBYyxvQ0FBb0M7QUFDdEg7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWSxpQkFBaUIsRUFBRSwrREFBaUI7QUFDaEQsV0FBVywwREFBa0IsK0JBQStCLGNBQWMsNEJBQTRCO0FBQ3RHO0FBQ0Esc0NBQXNDLG1FQUFnQjtBQUN0RCxzQ0FBc0MsbUVBQWdCO0FBQ3RELDJCQUEyQixtRUFBUztBQUNwQztBQUNBLG9EQUFvRCxtRUFBb0I7QUFDeEUsK0JBQStCLG1FQUFhO0FBQzVDO0FBQ0EsWUFBWSxtRUFBYTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGdCQUFnQixtRUFBZ0IsTUFBTSxtRUFBYztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQSxzQ0FBc0MsbUVBQVM7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksUUFBUSxFQUFFLCtEQUFpQjtBQUN2QyxRQUFRLG1FQUFlO0FBQ3ZCO0FBQ0E7QUFDQSx5QkFBeUIsbUVBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFlBQVksMENBQTBDLEVBQUUsK0RBQWlCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RCxxREFBcUQsbUVBQVE7QUFDN0QsMkJBQTJCLG1FQUFxQjtBQUNoRCx5QkFBeUIsbUVBQWU7QUFDeEMsU0FBUyxtRUFBZ0I7QUFDekI7QUFDQTtBQUNBLHNDQUFzQyx3REFBcUI7QUFDM0Q7QUFDQTtBQUNBLHNDQUFzQyx3REFBb0I7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsK0RBQWdCO0FBQ3RFLHNDQUFzQyx3REFBcUI7QUFDM0Q7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxzREFBc0QsbUVBQWU7QUFDckU7QUFDQSxzQ0FBc0MscURBQW1CO0FBQ3pEO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EscURBQXFELG1FQUFlO0FBQ3BFO0FBQ0Esc0NBQXNDLHFEQUFrQjtBQUN4RDtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsZ0JBQWdCLG1FQUFlO0FBQy9CO0FBQ0Esc0NBQXNDLDBEQUFrQjtBQUN4RDtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsMERBQTBELCtEQUFnQjtBQUMxRSwwQ0FBMEMsMERBQWtCLEdBQUcsNEJBQTRCO0FBQzNGO0FBQ0EsK0RBQStELCtEQUFnQjtBQUMvRSwwQ0FBMEMscURBQW1CO0FBQzdEO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQ0FBMEMscURBQWtCLEdBQUcsNEJBQTRCO0FBQzNGO0FBQ0E7QUFDQSwrQ0FBK0MsK0RBQWdCO0FBQy9ELGdCQUFnQixtRUFBeUI7QUFDekM7QUFDQSxzQ0FBc0MscURBQWtCLEdBQUcsNEJBQTRCO0FBQ3ZGO0FBQ0EsNkZBQTZGLG1FQUFZO0FBQ3pHO0FBQ0E7QUFDQSxvQkFBb0IsbUVBQVc7QUFDL0I7QUFDQSw4Q0FBOEMscURBQW1CO0FBQ2pFO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSw4Q0FBOEMsMERBQWtCO0FBQ2hFO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUIsbUVBQWM7QUFDdkMsMENBQTBDLDBEQUFrQixHQUFHLDRCQUE0QjtBQUMzRjtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsbUVBQXlCO0FBQy9ELDRFQUE0RSxtRUFBWTtBQUN4Rix5QkFBeUIsK0RBQVM7QUFDbEMsOENBQThDLDBEQUFrQjtBQUNoRTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsOENBQThDLHFEQUFtQjtBQUNqRTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsbUVBQVk7QUFDakMseURBQXlELG1FQUFlO0FBQ3hFLDBDQUEwQyxxREFBc0IsR0FBRyw0QkFBNEI7QUFDL0Y7QUFDQTtBQUNBLG9CQUFvQixtRUFBZTtBQUNuQywwQ0FBMEMsMERBQXFCLEdBQUcsNEJBQTRCO0FBQzlGO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxxREFBc0IsR0FBRyw0QkFBNEI7QUFDL0Y7QUFDQTtBQUNBLDBDQUEwQyxxREFBbUIsR0FBRyw0QkFBNEI7QUFDNUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsbUVBQWU7QUFDL0I7QUFDQSxzQ0FBc0MseURBQXNCO0FBQzVEO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSwwREFBMEQsK0RBQWdCO0FBQzFFLDBEQUEwRCwrREFBZ0I7QUFDMUUsMENBQTBDLDBEQUF1QjtBQUNqRTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsMENBQTBDLHlEQUFzQixHQUFHLDRCQUE0QjtBQUMvRjtBQUNBO0FBQ0EsMkRBQTJELCtEQUFnQjtBQUMzRSxnQkFBZ0IsbUVBQXlCO0FBQ3pDO0FBQ0EsMERBQTBELCtEQUFnQjtBQUMxRTtBQUNBO0FBQ0EsMENBQTBDLHlEQUF5QixHQUFHLDRCQUE0QjtBQUNsRztBQUNBO0FBQ0EsMENBQTBDLHlEQUFzQixHQUFHLDRCQUE0QjtBQUMvRjtBQUNBO0FBQ0EsMkRBQTJELCtEQUFnQjtBQUMzRSxzREFBc0QsK0RBQWdCO0FBQ3RFLDBEQUEwRCwrREFBZ0I7QUFDMUU7QUFDQTtBQUNBLDBDQUEwQywwREFBMEIsR0FBRyw0QkFBNEI7QUFDbkc7QUFDQSwrREFBK0QsK0RBQWdCO0FBQy9FO0FBQ0E7QUFDQSwwQ0FBMEMsMERBQTBCLEdBQUcsNEJBQTRCO0FBQ25HO0FBQ0E7QUFDQSwwQ0FBMEMsMERBQXVCLEdBQUcsNEJBQTRCO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQywwREFBdUIsR0FBRyw0QkFBNEI7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLDBDQUEwQyw2REFBMEI7QUFDcEU7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLDBDQUEwQyw2REFBMEI7QUFDcEU7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsMENBQTBDLHNEQUFtQjtBQUM3RDtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsMENBQTBDLHNEQUFtQjtBQUM3RDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQ0FBMEMsd0RBQXFCO0FBQy9EO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQ0FBMEMsNkRBQTBCO0FBQ3BFO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQ0FBMEMsMERBQXVCLEdBQUcsNEJBQTRCO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxzQ0FBc0MsNkRBQTBCO0FBQ2hFO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHNDQUFzQyxzREFBbUI7QUFDekQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esc0NBQXNDLHNEQUFtQjtBQUN6RDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSwrREFBK0QsK0RBQWdCO0FBQy9FO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLDBDQUEwQyw2REFBMEI7QUFDcEU7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpQkFBaUIsRUFBRSwrREFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrREFBaUI7QUFDN0Isa0NBQWtDLHdEQUFvQjtBQUN0RDtBQUNBO0FBQ0Esa0NBQWtDLHFEQUFrQixHQUFHLDRCQUE0QjtBQUNuRjtBQUNBO0FBQ0Esa0NBQWtDLHFEQUFtQixHQUFHLDRCQUE0QjtBQUNwRjtBQUNBO0FBQ0Esa0NBQWtDLDBEQUFrQixHQUFHLDRCQUE0QjtBQUNuRjtBQUNBO0FBQ0Esa0NBQWtDLHFEQUFzQixHQUFHLDRCQUE0QjtBQUN2RjtBQUNBO0FBQ0Esa0NBQWtDLDBEQUFxQixHQUFHLDRCQUE0QjtBQUN0RjtBQUNBO0FBQ0EsNkRBQTZELDRCQUE0QjtBQUN6RjtBQUNBO0FBQ0Esa0NBQWtDLHdEQUFxQixHQUFHLDRCQUE0QjtBQUN0RjtBQUNBO0FBQ0Esa0NBQWtDLHdEQUFxQixHQUFHLDRCQUE0QjtBQUN0RjtBQUNBO0FBQ0Esa0NBQWtDLDZEQUEwQixHQUFHLDRCQUE0QjtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esa0NBQWtDLDZEQUEwQixHQUFHLDRCQUE0QjtBQUMzRjtBQUNBO0FBQ0Esa0NBQWtDLDZEQUEwQjtBQUM1RDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQW1CLEdBQUcsNEJBQTRCO0FBQ3BGO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQW1CO0FBQ3JEO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGtDQUFrQyx5REFBc0IsR0FBRyw0QkFBNEI7QUFDdkY7QUFDQTtBQUNBLGtDQUFrQyx5REFBeUIsR0FBRyw0QkFBNEI7QUFDMUY7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLG9FQUFpQztBQUN2RTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esc0NBQXNDLDBEQUF1QixHQUFHLDRCQUE0QjtBQUM1RjtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMERBQTBCLEdBQUcsNEJBQTRCO0FBQzNGO0FBQ0E7QUFDQSxrQ0FBa0MsMERBQTBCLEdBQUcsNEJBQTRCO0FBQzNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsWUFBWSwwREFBMEQsRUFBRSwrREFBaUI7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixtRUFBaUI7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBFQUEwRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsK0RBQWdCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QywrREFBZ0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxtRUFBYTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsbUVBQWU7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELG1FQUFlO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QywrREFBZ0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLG1FQUFlO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxRQUFRLEVBQUUsK0RBQWlCO0FBQ3ZDLHlCQUF5QixtRUFBZTtBQUN4Qyx1QkFBdUIsbUVBQXFCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUNoQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1DQUFtQyxFQUFFLCtEQUFpQjtBQUNsRTtBQUNBLHFCQUFxQixtRUFBVztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRTRHOztBQUU1Rzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUM0SjtBQUN6SDtBQUM0Qjs7QUFFL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBcUQsRUFBRSwrREFBaUI7QUFDcEY7QUFDQTtBQUNBLG1CQUFtQixtRUFBZ0IsQ0FBQyxtRUFBVztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywrREFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsK0RBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFFBQVEsbUVBQWlCO0FBQ3pCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtQ0FBbUMsRUFBRSwrREFBaUI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLGtDQUFrQyxtRUFBUztBQUMzQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1DQUFtQyxFQUFFLCtEQUFpQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCwrQkFBK0IsbUVBQVM7QUFDeEM7QUFDQSxLQUFLO0FBQ0w7O0FBRXdGOztBQUV4RiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1nYWxsZXJ5LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NvbXBhcmUtYmExMjkyZmUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaGVhdG1hcC03NWZmZDQ1Mi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhdGlvbi1lMjZiNTM5Zi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgZiBhcyBmb3JjZVVwZGF0ZSwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IHUgYXMgdXNlQXJjYWRlRWRpdG9yIH0gZnJvbSAnLi9mZWF0dXJlLTFjZTFiOTg0LmpzJztcbmltcG9ydCB7IHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGggYXMgZ2V0UmVuZGVyZXIsIG4gYXMgZ2V0VmlzVmFyc0V4Y2VwdCwgYSBhcyBnZXRWaXNWYXIsIG8gYXMgZ2V0QXV0aFZpc1ZhcnNFeGNlcHQsIHAgYXMgZ2V0QXV0aFZpc1ZhciwgcSBhcyBpc1BvbHlnb25UeXBlLCByIGFzIGFwcGx5U3ltYm9sQ29sb3IsIHQgYXMgZ2V0U3ltYm9sQ29sb3IsIGcgYXMgZ2V0UmVuZGVyZXJUeXBlLCB1IGFzIGdldEZpZWxkLCBmIGFzIGdldFJlbmRlcmVyRmllbGRJbmZvcywgdiBhcyBpc1NhbWVGaWVsZEluZm9zLCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIHggYXMgaXNTYW1lRmllbGRJbmZvLCB5IGFzIGdldEZpZWxkVHlwZUZyb21WYWx1ZVR5cGUsIHogYXMgZ2V0RmllbGRUeXBlLCBBIGFzIGlzUG9pbnRUeXBlLCBCIGFzIGlzUG9seWxpbmVUeXBlLCBDIGFzIGdldEZpZWxkVHlwZUNvdW50LCBEIGFzIGdldEdlb21ldHJ5VHlwZSwgRSBhcyBjbG9zZVBvcG92ZXJzLCBqIGFzIGFwcGx5UmVuZGVyZXJUb0FsbCwgZSBhcyBhcHBseVJlbmRlcmVyLCBGIGFzIGZpbmRQYXJlbnROb2RlLCBHIGFzIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSwgSCBhcyBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UsIEkgYXMgZ2V0TGF5ZXJGaWVsZFR5cGVDb3VudCwgSiBhcyBnZXRSZW5kZXJlclRoZW1lLCBLIGFzIGFkZEZpZWxkc1RvTGF5ZXJDYWNoZSwgTCBhcyBkaXNhYmxlUGFuZWwsIE0gYXMgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMsIE4gYXMgbG9jYWxTdG9yYWdlS2V5cyB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3RXcmFwcGVyIH0gZnJvbSAnLi9sb2FkaW5nLTY5MTM5OTA3LmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBMIGFzIExhc3RTb3J0eUJ5IH0gZnJvbSAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0RlZmluZWQgfSBmcm9tICcuL2NvbW1vbkZ1bmN0aW9ucy1iMDgzMGU5ZS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVNpbXBsZVJlbmRlcmVyIH0gZnJvbSAnLi9sb2NhdGlvbi1lMjZiNTM5Zi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUNvbG9yUmVuZGVyZXIsIGEgYXMgY3JlYXRlQ29sb3JBZ2VSZW5kZXJlciB9IGZyb20gJy4vY29sb3ItZDZkYTBhOWEuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTaXplUmVuZGVyZXIsIGEgYXMgY3JlYXRlU2l6ZUFnZVJlbmRlcmVyLCBiIGFzIGNyZWF0ZUNvbG9yU2l6ZVJlbmRlcmVyLCBkIGFzIGNyZWF0ZUNvbG9yQWdlU2l6ZVJlbmRlcmVyLCBlIGFzIGNyZWF0ZUNvbG9yU2l6ZUFnZVJlbmRlcmVyIH0gZnJvbSAnLi9jb2xvclNpemUtY2UwY2NkZWIuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVIZWF0bWFwUmVuZGVyZXIgfSBmcm9tICcuL2hlYXRtYXAtNzVmZmQ0NTIuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlciB9IGZyb20gJy4vcHJlZG9taW5hbmNlLWExYTJkNzRkLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlQ2hhcnRSZW5kZXJlciB9IGZyb20gJy4vY2hhcnQtMDk3ZWMyODAuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVDb21wYXJlUmVuZGVyZXIgfSBmcm9tICcuL2NvbXBhcmUtYmExMjkyZmUuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVUeXBlUmVuZGVyZXIgfSBmcm9tICcuL3R5cGUtMGFjZTVkMmUuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVSZWxhdGlvbnNoaXBSZW5kZXJlciB9IGZyb20gJy4vcmVsYXRpb25zaGlwLWI3MmQ3ZDk3LmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlQ29sb3JTaXplVW5pdmFyaWF0ZVJlbmRlcmVyIH0gZnJvbSAnLi9jb2xvclNpemVVbml2YXJpYW50LWQyNjZhYzdjLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlVHlwZVNpemVSZW5kZXJlciwgYSBhcyBjcmVhdGVUeXBlU2l6ZUFnZVJlbmRlcmVyIH0gZnJvbSAnLi90eXBlU2l6ZS05ZDRjNWQyOC5qcyc7XG5pbXBvcnQgJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBsYXllciB3aXRoIGEgRG90RGVuc2l0eSByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqIEBwYXJhbSBvcHRpb25zOiBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZURvdERlbnNpdHlSZW5kZXJlcihvcHRpb25zKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICByZXR1cm4gbW9kdWxlcy5Eb3REZW5zaXR5Q3JlYXRvci5jcmVhdGVSZW5kZXJlcih7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICBhdHRyaWJ1dGVzOiBpc0RlZmluZWQob3B0aW9ucy5hdHRyaWJ1dGVzKSA/IG9wdGlvbnMuYXR0cmlidXRlcyA6IGdldEF0dHJpYnV0ZXMob3B0aW9ucy5maWVsZEluZm9zKSxcbiAgICAgICAgZG90QmxlbmRpbmdFbmFibGVkOiBpc0RlZmluZWQob3B0aW9ucy5kb3RCbGVuZGluZ0VuYWJsZWQpID8gb3B0aW9ucy5kb3RCbGVuZGluZ0VuYWJsZWQgOiB0cnVlLFxuICAgICAgICBkb3RWYWx1ZU9wdGltaXphdGlvbkVuYWJsZWQ6IGlzRGVmaW5lZChvcHRpb25zLmRvdFZhbHVlT3B0aW1pemF0aW9uRW5hYmxlZClcbiAgICAgICAgICAgID8gb3B0aW9ucy5kb3RWYWx1ZU9wdGltaXphdGlvbkVuYWJsZWRcbiAgICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgb3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWQ6IGlzRGVmaW5lZChvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkKVxuICAgICAgICAgICAgPyBvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkXG4gICAgICAgICAgICA6IHRydWUsXG4gICAgICAgIGxlZ2VuZE9wdGlvbnM6IG9wdGlvbnMubGVnZW5kT3B0aW9ucyxcbiAgICAgICAgZm9yQmlubmluZzogKChfYSA9IGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCJcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldEF0dHJpYnV0ZXMoZmllbGRJbmZvcykge1xuICAgIHJldHVybiBmaWVsZEluZm9zLm1hcCgoZmllbGRJbmZvKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvL3ZhbHVlRXhwcmVzc2lvbjogYCRmZWF0dXJlLiR7b3B0aW9uLnZhbHVlfWAsXG4gICAgICAgICAgICBmaWVsZDogZmllbGRJbmZvLmZpZWxkLFxuICAgICAgICAgICAgbGFiZWw6IGdldEZpZWxkTGFiZWwoZmllbGRJbmZvLmZpZWxkKVxuICAgICAgICB9O1xuICAgIH0pO1xufVxuZnVuY3Rpb24gZ2V0RmllbGRMYWJlbChmaWVsZE5hbWUpIHtcbiAgICBjb25zdCBnYWxsZXJ5RmllbGRzID0gc21hcnRNYXBwaW5nU3RhdGUuZmllbGRzLmZpbHRlcigoZmllbGQpID0+IGZpZWxkLmxheWVyRmllbGQubmFtZSA9PT0gZmllbGROYW1lKTtcbiAgICBpZiAoZ2FsbGVyeUZpZWxkcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGdhbGxlcnlGaWVsZHNbMF0ubGFiZWw7XG4gICAgfVxuICAgIHJldHVybiBcIlwiO1xufVxuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIGxheWVyIHdpdGggYSBQcmVkb21pbmFuY2UgcmVuZGVyZXIgd2l0aCBkZWZhdWx0IHNldHRpbmdzXG4gKiBAcGFyYW0gb3B0aW9uczogb3B0aW9uc1xuICovXG5mdW5jdGlvbiBjcmVhdGVSZWxhdGlvbnNoaXBTaXplUmVuZGVyZXIob3B0aW9ucykge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IHJlbGF0aW9uc2hpcEZpZWxkSW5mb3MgPSBbXTtcbiAgICBjb25zdCBzaXplRmllbGRJbmZvcyA9IFtdO1xuICAgIHJlbGF0aW9uc2hpcEZpZWxkSW5mb3MucHVzaChvcHRpb25zLmZpZWxkSW5mb3NbMF0pO1xuICAgIHJlbGF0aW9uc2hpcEZpZWxkSW5mb3MucHVzaChvcHRpb25zLmZpZWxkSW5mb3NbMV0pO1xuICAgIHNpemVGaWVsZEluZm9zLnB1c2gob3B0aW9ucy5maWVsZEluZm9zWzJdKTtcbiAgICBpZiAoc2FtZVJlbGF0aW9uc2hpcEZpZWxkcyhvcHRpb25zKSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlU2l6ZVBhcnRGb3JSZW5kZXJlcihnZXRSZW5kZXJlcihsYXllciksIHNpemVGaWVsZEluZm9zLCBvcHRpb25zKS50aGVuKChyZW5kZXJlclJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IHJlbmRlcmVyOiByZW5kZXJlclJlc3VsdCB9KTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xuICAgIH1cbiAgICByZXR1cm4gY3JlYXRlUmVsYXRpb25zaGlwUmVuZGVyZXIoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgeyBmaWVsZEluZm9zOiByZWxhdGlvbnNoaXBGaWVsZEluZm9zIH0pKS50aGVuKChyZWxhdGlvbnNoaXBSZW5kZXJlclJlc3VsdCkgPT4ge1xuICAgICAgICByZXR1cm4gY3JlYXRlU2l6ZVBhcnRGb3JSZW5kZXJlcihyZWxhdGlvbnNoaXBSZW5kZXJlclJlc3VsdC5yZW5kZXJlciwgc2l6ZUZpZWxkSW5mb3MsIG9wdGlvbnMpLnRoZW4oKHJlbmRlcmVyUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXBSZW5kZXJlclJlc3VsdC5yZW5kZXJlciA9IHJlbmRlcmVyUmVzdWx0O1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZWxhdGlvbnNoaXBSZW5kZXJlclJlc3VsdCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbiAgICB9LCAoZXJyb3IpID0+IFByb21pc2UucmVqZWN0KGVycm9yKSk7XG59XG5mdW5jdGlvbiBjcmVhdGVTaXplUGFydEZvclJlbmRlcmVyKHJlbFJlbmRlcmVyLCBzaXplRmllbGRJbmZvcywgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIHJldHVybiBjcmVhdGVTaXplUmVuZGVyZXIoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgeyBmaWVsZEluZm9zOiBzaXplRmllbGRJbmZvcyB9KSkudGhlbigoc2l6ZVJlbmRlcmVyUmVzdWx0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNpemVSZW5kZXJlciA9IHNpemVSZW5kZXJlclJlc3VsdC5yZW5kZXJlcjtcbiAgICAgICAgcmVsUmVuZGVyZXIudmlzdWFsVmFyaWFibGVzID0gZ2V0VmlzVmFyc0V4Y2VwdChyZWxSZW5kZXJlciwgXCJzaXplXCIpIHx8IFtdO1xuICAgICAgICByZWxSZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlbFJlbmRlcmVyLCBcInNpemVcIiwgXCJhdXRvXCIpIHx8IFtdO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHNpemVSZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICByZWxSZW5kZXJlci52aXN1YWxWYXJpYWJsZXMucHVzaChzaXplVmlzVmFyKTtcbiAgICAgICAgcmVsUmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMgPSBnZXRBdXRoVmlzVmFyc0V4Y2VwdChyZWxSZW5kZXJlciwgXCJzaXplXCIpIHx8IFtdO1xuICAgICAgICBjb25zdCBzaXplQXV0aFZpc1ZhciA9IGdldEF1dGhWaXNWYXIoc2l6ZVJlbmRlcmVyLCBcInNpemVcIik7XG4gICAgICAgIHJlbFJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzLnB1c2goc2l6ZUF1dGhWaXNWYXIpO1xuICAgICAgICBpZiAoaXNQb2x5Z29uVHlwZShsYXllcikpIHtcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gc3dpdGNoIHRoZSBmaWxsIHN5bWJvbHMgdG8gbWFya2VyIHN5bWJvbHNcbiAgICAgICAgICAgIGxldCBtYXJrZXJTeW1ib2wgPSBzaXplUmVuZGVyZXIuY2xhc3NCcmVha0luZm9zWzBdLnN5bWJvbDtcbiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyVmFsdWVJbmZvcyA9IFtdO1xuICAgICAgICAgICAgcmVsUmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcy5mb3JFYWNoKCh2YWx1ZUluZm8pID0+IHtcbiAgICAgICAgICAgICAgICByZW5kZXJlclZhbHVlSW5mb3MucHVzaChtb2R1bGVzLmVzcmlMYW5nLmNsb25lKHZhbHVlSW5mbykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZW5kZXJlclZhbHVlSW5mb3MuZm9yRWFjaCgodmFsdWVJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVsUmVuZGVyZXIucmVtb3ZlVW5pcXVlVmFsdWVJbmZvKHZhbHVlSW5mby52YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlbmRlcmVyVmFsdWVJbmZvcy5mb3JFYWNoKCh2YWx1ZUluZm8pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzeW0gPSBtYXJrZXJTeW1ib2wuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICBhcHBseVN5bWJvbENvbG9yKHN5bSwgZ2V0U3ltYm9sQ29sb3IodmFsdWVJbmZvLnN5bWJvbCkpO1xuICAgICAgICAgICAgICAgIHJlbFJlbmRlcmVyLmFkZFVuaXF1ZVZhbHVlSW5mbyh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZUluZm8udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbDogc3ltLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdmFsdWVJbmZvLmxhYmVsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlbFJlbmRlcmVyLmJhY2tncm91bmRGaWxsU3ltYm9sID0gc2l6ZVJlbmRlcmVyLmJhY2tncm91bmRGaWxsU3ltYm9sO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZU91dGxpbmVWaXNWYXIgPSBnZXRWaXNWYXIoc2l6ZVJlbmRlcmVyLCBcInNpemVcIiwgXCJvdXRsaW5lXCIpO1xuICAgICAgICAgICAgaWYgKHNpemVPdXRsaW5lVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgcmVsUmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2goc2l6ZU91dGxpbmVWaXNWYXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVsUmVuZGVyZXIpO1xuICAgIH0sIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbn1cbmZ1bmN0aW9uIHNhbWVSZWxhdGlvbnNoaXBGaWVsZHMob3B0aW9ucykge1xuICAgIC8vIG5vdCBjaGVja2luZyBmb3Igbm9ybWFsaXphdGlvbkZpZWxkXG4gICAgLy8gd2Uga2VlcCBpdCBpZiB0aGUgcmVuZGVyZXIgaGFzIGl0IGFuZCBpdCBkb2VzIG5vdCBnZXQgb3ZlcndyaXR0ZW5cbiAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBpZiAoZ2V0UmVuZGVyZXJUeXBlKCkgPT09IFwicmVsYXRpb25zaGlwXCIgJiZcbiAgICAgICAgb3B0aW9ucy5ub3JtYWxpemF0aW9uRmllbGQxID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgb3B0aW9ucy5ub3JtYWxpemF0aW9uRmllbGQyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSBnZXRSZW5kZXJlcihsYXllcikuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgaWYgKG9wdGlvbnMuZmllbGRJbmZvcyAmJlxuICAgICAgICAgICAgb3B0aW9ucy5maWVsZEluZm9zLmxlbmd0aCA+IDEgJiZcbiAgICAgICAgICAgIG9wdGlvbnMuZmllbGRJbmZvc1swXS5maWVsZCA9PSBhdXRoSW5mby5maWVsZDEuZmllbGQgJiZcbiAgICAgICAgICAgIG9wdGlvbnMuZmllbGRJbmZvc1sxXS5maWVsZCA9PSBhdXRoSW5mby5maWVsZDIuZmllbGQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxubGV0IF9kZWxheUhhbmRsZXI7XG5mdW5jdGlvbiBjcmVhdGVOZXdSZW5kZXJlcldpdGhEZWxheShnYWxsZXJ5UmVxdWVzdFdyYXBwZXIpIHtcbiAgICAvLyB3YWl0IGEgbGl0dGxlIGJlZm9yZSBleGVjdXRpbmcgdGhlIHJlcXVlc3RcbiAgICAvLyBpbiBjYXNlIHRoZSB1c2VyIGRlbGV0ZXMgYSBidW5jaCBvZiBhdHRyaWJ1dGVzXG4gICAgaWYgKF9kZWxheUhhbmRsZXIpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KF9kZWxheUhhbmRsZXIpO1xuICAgIH1cbiAgICBfZGVsYXlIYW5kbGVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIF9kZWxheUhhbmRsZXIgPSBudWxsO1xuICAgICAgICBjcmVhdGVOZXdSZW5kZXJlcihnYWxsZXJ5UmVxdWVzdFdyYXBwZXIpO1xuICAgIH0sIDEwMDApO1xufVxuZnVuY3Rpb24gY3JlYXRlTmV3UmVuZGVyZXIoZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IHNlbGVjdGVkRmllbGRzLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgaXNPR0MgPSBsYXllci50eXBlID09PSBcIm9nYy1mZWF0dXJlXCI7XG4gICAgY29uc3QgaXNXRlMgPSBsYXllci50eXBlID09PSBcIndmc1wiO1xuICAgIGNvbnN0IHN1cHBvcnRzU3FsRXhwcmVzc2lvbiA9IChfYiA9IChfYSA9IGxheWVyLmNhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3VwcG9ydHNTcWxFeHByZXNzaW9uO1xuICAgIGNvbnN0IGFkdmFuY2VkID0gaXNPR0MgfHwgaXNXRlMgfHwgc3VwcG9ydHNTcWxFeHByZXNzaW9uOyAvLyBwcmVkb20sIGFnZSwgZG90RGVuc2l0eSwgZmllbGQtaGVhdG1hcFxuICAgIGNvbnN0IGZpZWxkcyA9IHNlbGVjdGVkRmllbGRzLm1hcCgoZmllbGRJbmZvKSA9PiBnZXRGaWVsZChmaWVsZEluZm8uZmllbGQpKTtcbiAgICBjb25zdCByZW5kZXJlckZpZWxkcyA9IGdldFJlbmRlcmVyRmllbGRJbmZvcyhsYXllcik7XG4gICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgaWYgKCFpc1NhbWVGaWVsZEluZm9zKHNlbGVjdGVkRmllbGRzLCByZW5kZXJlckZpZWxkcykpIHtcbiAgICAgICAgaWYgKHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJoZWF0bWFwXCIpIHtcbiAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlSGVhdG1hcFJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVNpbXBsZVJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBmaWVsZHNbMF07XG4gICAgICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImhlYXRtYXBcIiAmJlxuICAgICAgICAgICAgICAgIGFkdmFuY2VkICYmXG4gICAgICAgICAgICAgICAgIXNlbGVjdGVkRmllbGRzWzBdLmV4cHJlc3Npb24gJiZcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSKSB7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUhlYXRtYXBSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yLXNpemVcIiAmJiBpc1NhbWVGaWVsZEluZm8oc2VsZWN0ZWRGaWVsZHNbMF0sIHJlbmRlcmVyRmllbGRzWzBdKSkge1xuICAgICAgICAgICAgICAgIC8vIGtlZXAgY29sb3JcbiAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcInR5cGUtc2l6ZVwiICYmIGlzU2FtZUZpZWxkSW5mbyhzZWxlY3RlZEZpZWxkc1swXSwgcmVuZGVyZXJGaWVsZHNbMF0pKSB7XG4gICAgICAgICAgICAgICAgLy8ga2VlcCB0eXBlXG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVR5cGVSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoW1wiY29sb3Itc2l6ZVwiLCBcInR5cGUtc2l6ZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSAmJlxuICAgICAgICAgICAgICAgIGlzU2FtZUZpZWxkSW5mbyhzZWxlY3RlZEZpZWxkc1swXSwgcmVuZGVyZXJGaWVsZHNbcmVuZGVyZXJGaWVsZHMubGVuZ3RoID4gMSA/IDEgOiAwXSkpIHtcbiAgICAgICAgICAgICAgICAvLyBrZWVwIHNpemVcbiAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlU2l6ZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZEZpZWxkc1swXS5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRmllbGRzWzBdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVNpemVSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRGaWVsZHNbMF0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVR5cGVSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaWVsZC5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HIHx8XG4gICAgICAgICAgICAgICAgZ2V0RmllbGRUeXBlRnJvbVZhbHVlVHlwZShmaWVsZCkgPT09IFwic3RyaW5nXCIgfHxcbiAgICAgICAgICAgICAgICAoXCJkb21haW5cIiBpbiBmaWVsZC5sYXllckZpZWxkICYmIGZpZWxkLmxheWVyRmllbGQuZG9tYWluKSkge1xuICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVUeXBlUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChbXCJpbnRlZ2VyXCIsIFwiZG91YmxlXCIsIFwic2luZ2xlXCIsIFwic21hbGwtaW50ZWdlclwiLCBcImJpZy1pbnRlZ2VyXCJdLmluZGV4T2YoZ2V0RmllbGRUeXBlKGZpZWxkLmxheWVyRmllbGQpKSA+IC0xICYmXG4gICAgICAgICAgICAgICAgXCJvYmplY3RJZEZpZWxkXCIgaW4gbGF5ZXIgJiZcbiAgICAgICAgICAgICAgICBsYXllci5vYmplY3RJZEZpZWxkICE9PSBmaWVsZC5sYXllckZpZWxkLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQb2ludFR5cGUobGF5ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVTaXplUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNQb2x5bGluZVR5cGUobGF5ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBcInBvbHlnb25cIlxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZVR5cGUgPSBnZXRGaWVsZFR5cGVGcm9tVmFsdWVUeXBlKGZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFtcImludGVnZXJcIiwgXCJzbWFsbC1pbnRlZ2VyXCIsIFwiYmlnLWludGVnZXJcIl0uaW5kZXhPZihnZXRGaWVsZFR5cGUoZmllbGQubGF5ZXJGaWVsZCkpID4gLTEgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChpc0RlZmluZWQodmFsdWVUeXBlKSAmJiB2YWx1ZVR5cGUgPT09IFwiaW50ZWdlclwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVNpemVSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvclJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZ2V0RmllbGRUeXBlKGZpZWxkLmxheWVyRmllbGQpID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3ItYWdlLXNpemVcIiAmJiBpc1NhbWVGaWVsZEluZm8oc2VsZWN0ZWRGaWVsZHNbMF0sIHJlbmRlcmVyRmllbGRzWzBdKSkge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JBZ2VSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoW1wiY29sb3Itc2l6ZS1hZ2VcIiwgXCJ0eXBlLXNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xICYmXG4gICAgICAgICAgICAgICAgICAgIGlzU2FtZUZpZWxkSW5mbyhzZWxlY3RlZEZpZWxkc1swXSwgcmVuZGVyZXJGaWVsZHNbMV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVTaXplQWdlUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcEltYWdlU3VibGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZG9lc24ndCBzdXBwb3J0IGNvbG9yIHJlbmRlcmVyXG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvckFnZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgY29uc3QgZmllbGQxID0gZmllbGRzWzBdO1xuICAgICAgICAgICAgLy9jb25zdCBmaWVsZDIgPSBmaWVsZHNbMV0hO1xuICAgICAgICAgICAgaWYgKChyZW5kZXJlclR5cGUgPT09IFwidHlwZVwiIHx8IHJlbmRlcmVyVHlwZSA9PT0gXCJ0eXBlLXNpemVcIikgJiZcbiAgICAgICAgICAgICAgICBpc1NhbWVGaWVsZEluZm8oc2VsZWN0ZWRGaWVsZHNbMF0sIHJlbmRlcmVyRmllbGRzWzBdKSkge1xuICAgICAgICAgICAgICAgIC8vIGtlZXAgdHlwZVxuICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVUeXBlU2l6ZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZEZpZWxkc1swXS5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRmllbGRzWzBdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIgJiZcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHNbMV0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUikge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JTaXplUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVR5cGVTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRGaWVsZHNbMF0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLlNUUklORyB8fFxuICAgICAgICAgICAgICAgIGdldEZpZWxkVHlwZUZyb21WYWx1ZVR5cGUoZmllbGQxKSA9PT0gXCJzdHJpbmdcIiB8fFxuICAgICAgICAgICAgICAgIChcImRvbWFpblwiIGluIGZpZWxkMS5sYXllckZpZWxkICYmIGZpZWxkMS5sYXllckZpZWxkLmRvbWFpbikpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZHNbMV0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgJiZcbiAgICAgICAgICAgICAgICAgICAgKFtcImNvbG9yLXNpemUtYWdlXCIsIFwidHlwZS1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSB8fCBtYXBJbWFnZVN1YmxheWVyKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNUyBkb2Vzbid0IHN1cHBvcnQgY29sb3Igb3Igc2l6ZSByZW5kZXJlciBvbiBkYXRlIGZpZWxkXG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVUeXBlU2l6ZUFnZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVR5cGVTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRGaWVsZHNbMF0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgfHxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1sxXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSkge1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSAmJlxuICAgICAgICAgICAgICAgICAgICAoW1wiY29sb3ItYWdlXCIsIFwiY29sb3ItYWdlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEgfHwgbWFwSW1hZ2VTdWJsYXllcikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTVMgZG9lc24ndCBzdXBwb3J0IGNvbG9yIG9yIHNpemUgcmVuZGVyZXIgb24gZGF0ZSBmaWVsZFxuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JBZ2VTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGRzWzFdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFICYmXG4gICAgICAgICAgICAgICAgICAgIChbXCJjb2xvci1zaXplLWFnZVwiLCBcInR5cGUtc2l6ZS1hZ2VcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEgfHwgbWFwSW1hZ2VTdWJsYXllcikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTVMgZG9lc24ndCBzdXBwb3J0IGNvbG9yIG9yIHNpemUgcmVuZGVyZXIgb24gZGF0ZSBmaWVsZFxuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JTaXplQWdlUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gYm90aCBudW1iZXJzXG4gICAgICAgICAgICAgICAgLy8gc3RheSB3aXRoIHRoZSBzdHlsZSB3ZSdyZSBhdCwgaWYgcG9zc2libGVcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZHNbMF0uZXhwcmVzc2lvbiB8fCBzZWxlY3RlZEZpZWxkc1sxXS5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDb2xvclNpemVSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImRvdC1kZW5zaXR5XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZURvdERlbnNpdHlSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJwcmVkb21pbmFuY2VcIikge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwicHJlZG9taW5hbmNlLXNpemVcIikge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlU2l6ZVZhcmlhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNoYXJ0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNoYXJ0UmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY2hhcnQtc2l6ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDaGFydFJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVNpemVWYXJpYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJjb21wYXJlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbXBhcmVSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKFtcInJlbGF0aW9uc2hpcFwiLCBcInJlbGF0aW9uc2hpcC1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVSZWxhdGlvbnNoaXBSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlQ29sb3JTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gbW9yZSB0aGFuIHR3byBhdHRyaWJ1dGVzXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAzICYmXG4gICAgICAgICAgICAgICAgKFtcInJlbGF0aW9uc2hpcFwiLCBcInJlbGF0aW9uc2hpcC1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xIHx8IHNlbGVjdGVkRmllbGRzWzJdLmV4cHJlc3Npb24gfHwgIWFkdmFuY2VkKSAvL3x8XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlUmVsYXRpb25zaGlwU2l6ZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiZG90LWRlbnNpdHlcIiAmJiBzZWxlY3RlZEZpZWxkcy5sZW5ndGggPD0gOCkge1xuICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVEb3REZW5zaXR5UmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJwcmVkb21pbmFuY2Utc2l6ZVwiKSB7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVByZWRvbWluYW5jZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVTaXplVmFyaWFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY2hhcnRcIikge1xuICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDaGFydFJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVTaXplVmFyaWFibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVuZGVyZXJUeXBlID09PSBcImNoYXJ0LXNpemVcIikge1xuICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDaGFydFJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVTaXplVmFyaWFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobWFwSW1hZ2VTdWJsYXllciAmJiAhYWR2YW5jZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVJlbGF0aW9uc2hpcFNpemVSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGRzWzJdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVSZWxhdGlvbnNoaXBTaXplUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVByZWRvbWluYW5jZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBjcmVhdGVDZXJ0YWluUmVuZGVyZXIodHlwZSwgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgXCJzaW1wbGVcIjpcbiAgICAgICAgICAgIC8vIHJlbW92ZSBzZWxlY3RlZCBhdHRyaWJ1dGVzXG4gICAgICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5zZWxlY3RlZEZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVNpbXBsZVJlbmRlcmVyKCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0eXBlXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlVHlwZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvclwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNpemVcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNvbG9yLWFnZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yQWdlUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNpemUtYWdlXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlU2l6ZUFnZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb3QtZGVuc2l0eVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZURvdERlbnNpdHlSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaGVhdG1hcFwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUhlYXRtYXBSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY29tcGFyZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbXBhcmVSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVsYXRpb25zaGlwXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlUmVsYXRpb25zaGlwUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlbGF0aW9uc2hpcC1zaXplXCI6XG4gICAgICAgICAgICBnYWxsZXJ5UmVxdWVzdFdyYXBwZXIoY3JlYXRlUmVsYXRpb25zaGlwU2l6ZVJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2VcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlcih7IGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzIH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicHJlZG9taW5hbmNlLXNpemVcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMsXG4gICAgICAgICAgICAgICAgaW5jbHVkZVNpemVWYXJpYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjaGFydFwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNoYXJ0UmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNoYXJ0LXNpemVcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVDaGFydFJlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyxcbiAgICAgICAgICAgICAgICBpbmNsdWRlU2l6ZVZhcmlhYmxlOiB0cnVlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInR5cGUtc2l6ZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZVR5cGVTaXplUmVuZGVyZXIoeyBmaWVsZEluZm9zOiBzZWxlY3RlZEZpZWxkcyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInR5cGUtc2l6ZS1hZ2VcIjpcbiAgICAgICAgICAgIGdhbGxlcnlSZXF1ZXN0V3JhcHBlcihjcmVhdGVUeXBlU2l6ZUFnZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvci1zaXplXCI6XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yU2l6ZVVuaXZhcmlhdGVSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yU2l6ZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvci1hZ2Utc2l6ZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yQWdlU2l6ZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvci1zaXplLWFnZVwiOlxuICAgICAgICAgICAgZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKGNyZWF0ZUNvbG9yU2l6ZUFnZVJlbmRlcmVyKHsgZmllbGRJbmZvczogc2VsZWN0ZWRGaWVsZHMgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRBbGxvd2VkU3R5bGVzKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc2VsZWN0ZWRGaWVsZHMsIHN1cHBvcnRzQXJjYWRlIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBpc09HQyA9IGxheWVyLnR5cGUgPT09IFwib2djLWZlYXR1cmVcIjtcbiAgICBjb25zdCBpc1dGUyA9IGxheWVyLnR5cGUgPT09IFwid2ZzXCI7XG4gICAgY29uc3QgaXNTdHJlYW0gPSBsYXllci50eXBlID09PSBcInN0cmVhbVwiO1xuICAgIGNvbnN0IGZlYXR1cmVSZWR1Y3Rpb24gPSBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uO1xuICAgIGNvbnN0IGZpZWxkQ291bnQgPSBzZWxlY3RlZEZpZWxkcy5sZW5ndGg7XG4gICAgY29uc3QgY291bnRzID0gZ2V0RmllbGRUeXBlQ291bnQoKTtcbiAgICBjb25zdCBoYXNTdHJpbmdGaWVsZCA9IGNvdW50cy5zdHJpbmcgPiAwO1xuICAgIGNvbnN0IGhhc0RhdGVGaWVsZCA9IGNvdW50cy5kYXRlID4gMDtcbiAgICBjb25zdCBoYXNFeHByZXNzaW9uID0gY291bnRzLmV4cHJlc3Npb24gPiAwO1xuICAgIC8vY29uc3QgaGFzVW5rbm93blR5cGUgPSBjb3VudHMudW5rbm93biA+IDA7XG4gICAgY29uc3Qgc3VwcG9ydHNTcWxFeHByZXNzaW9uID0gKF9iID0gKF9hID0gbGF5ZXIuY2FwYWJpbGl0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdXBwb3J0c1NxbEV4cHJlc3Npb247XG4gICAgY29uc3QgYWR2YW5jZWQgPSBpc09HQyB8fCBpc1dGUyB8fCBpc1N0cmVhbSB8fCBzdXBwb3J0c1NxbEV4cHJlc3Npb247IC8vIHByZWRvbSwgY2hhcnQsIGFnZSwgZG90RGVuc2l0eSwgZmllbGQtaGVhdG1hcFxuICAgIGNvbnN0IGxpc3QgPSBbXTtcbiAgICBsaXN0LnB1c2goXCJzaW1wbGVcIik7XG4gICAgaWYgKGZpZWxkQ291bnQgPT09IDEgJiYgIWhhc1N0cmluZ0ZpZWxkICYmICEobWFwSW1hZ2VTdWJsYXllciAmJiBoYXNEYXRlRmllbGQpKSB7XG4gICAgICAgIGxpc3QucHVzaChcImNvbG9yXCIpO1xuICAgIH1cbiAgICBpZiAoZmllbGRDb3VudCA9PT0gMSAmJiAhaGFzU3RyaW5nRmllbGQgJiYgIShtYXBJbWFnZVN1YmxheWVyICYmIGhhc0RhdGVGaWVsZCkpIHtcbiAgICAgICAgbGlzdC5wdXNoKFwic2l6ZVwiKTtcbiAgICB9XG4gICAgaWYgKCghbWFwSW1hZ2VTdWJsYXllciB8fCBzdXBwb3J0c0FyY2FkZSkgJiYgZmllbGRDb3VudCA9PT0gMSAmJiBoYXNEYXRlRmllbGQgJiYgIWhhc0V4cHJlc3Npb24gJiYgYWR2YW5jZWQpIHtcbiAgICAgICAgbGlzdC5wdXNoKFwiY29sb3ItYWdlXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJiBmaWVsZENvdW50ID09PSAxICYmIGhhc0RhdGVGaWVsZCAmJiAhaGFzRXhwcmVzc2lvbiAmJiBhZHZhbmNlZCkge1xuICAgICAgICBsaXN0LnB1c2goXCJzaXplLWFnZVwiKTtcbiAgICB9XG4gICAgaWYgKCghbWFwSW1hZ2VTdWJsYXllciB8fCBzdXBwb3J0c0FyY2FkZSkgJiZcbiAgICAgICAgKGZpZWxkQ291bnQgPT09IDEgfHwgZmllbGRDb3VudCA9PT0gMikgJiZcbiAgICAgICAgIWhhc1N0cmluZ0ZpZWxkICYmXG4gICAgICAgICEobWFwSW1hZ2VTdWJsYXllciAmJiBoYXNEYXRlRmllbGQpKSB7XG4gICAgICAgIGxpc3QucHVzaChcImNvbG9yLXNpemVcIik7XG4gICAgfVxuICAgIGlmICgoIW1hcEltYWdlU3VibGF5ZXIgfHwgc3VwcG9ydHNBcmNhZGUpICYmXG4gICAgICAgIGZpZWxkQ291bnQgPT09IDIgJiZcbiAgICAgICAgIWhhc1N0cmluZ0ZpZWxkICYmXG4gICAgICAgIGhhc0RhdGVGaWVsZCAmJlxuICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSAmJlxuICAgICAgICAhc2VsZWN0ZWRGaWVsZHNbMF0uZXhwcmVzc2lvbiAmJlxuICAgICAgICBhZHZhbmNlZCAmJlxuICAgICAgICAhKG1hcEltYWdlU3VibGF5ZXIgJiYgY291bnRzLmRhdGUgPiAxKSkge1xuICAgICAgICBsaXN0LnB1c2goXCJjb2xvci1hZ2Utc2l6ZVwiKTtcbiAgICB9XG4gICAgaWYgKCghbWFwSW1hZ2VTdWJsYXllciB8fCBzdXBwb3J0c0FyY2FkZSkgJiZcbiAgICAgICAgZmllbGRDb3VudCA9PT0gMiAmJlxuICAgICAgICAhaGFzU3RyaW5nRmllbGQgJiZcbiAgICAgICAgaGFzRGF0ZUZpZWxkICYmXG4gICAgICAgIHNlbGVjdGVkRmllbGRzWzFdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFICYmXG4gICAgICAgICFzZWxlY3RlZEZpZWxkc1sxXS5leHByZXNzaW9uICYmXG4gICAgICAgIGFkdmFuY2VkICYmXG4gICAgICAgICEobWFwSW1hZ2VTdWJsYXllciAmJiBjb3VudHMuZGF0ZSA+IDEpKSB7XG4gICAgICAgIGxpc3QucHVzaChcImNvbG9yLXNpemUtYWdlXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJlxuICAgICAgICBmaWVsZENvdW50ID4gMCAmJlxuICAgICAgICBmaWVsZENvdW50IDw9IDggJiZcbiAgICAgICAgIWhhc0V4cHJlc3Npb24gJiZcbiAgICAgICAgaXNQb2x5Z29uVHlwZShsYXllcikgJiZcbiAgICAgICAgIWhhc1N0cmluZ0ZpZWxkICYmXG4gICAgICAgICFoYXNEYXRlRmllbGQgJiZcbiAgICAgICAgYWR2YW5jZWQpIHtcbiAgICAgICAgbGlzdC5wdXNoKFwiZG90LWRlbnNpdHlcIik7XG4gICAgfVxuICAgIGlmICgoIW1hcEltYWdlU3VibGF5ZXIgfHwgc3VwcG9ydHNBcmNhZGUpICYmXG4gICAgICAgIGZpZWxkQ291bnQgPiAxICYmXG4gICAgICAgIGZpZWxkQ291bnQgPD0gMTAgJiZcbiAgICAgICAgIWhhc0V4cHJlc3Npb24gJiZcbiAgICAgICAgIWhhc1N0cmluZ0ZpZWxkICYmXG4gICAgICAgICFoYXNEYXRlRmllbGQgJiZcbiAgICAgICAgYWR2YW5jZWQpIHtcbiAgICAgICAgbGlzdC5wdXNoKFwicHJlZG9taW5hbmNlXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJlxuICAgICAgICBmaWVsZENvdW50ID4gMSAmJlxuICAgICAgICAhaGFzRXhwcmVzc2lvbiAmJlxuICAgICAgICAhaGFzU3RyaW5nRmllbGQgJiZcbiAgICAgICAgIWhhc0RhdGVGaWVsZCAmJlxuICAgICAgICBhZHZhbmNlZCkge1xuICAgICAgICBsaXN0LnB1c2goXCJwcmVkb21pbmFuY2Utc2l6ZVwiKTtcbiAgICB9XG4gICAgaWYgKCFtYXBJbWFnZVN1YmxheWVyICYmXG4gICAgICAgICFmZWF0dXJlUmVkdWN0aW9uICYmXG4gICAgICAgIGZpZWxkQ291bnQgPiAxICYmXG4gICAgICAgIGZpZWxkQ291bnQgPD0gMTAgJiZcbiAgICAgICAgIWhhc0V4cHJlc3Npb24gJiZcbiAgICAgICAgW1wicG9seWdvblwiLCBcInBvaW50XCIsIFwibXVsdGlwb2ludFwiXS5pbmRleE9mKGdldEdlb21ldHJ5VHlwZShsYXllcikpID4gLTEgJiZcbiAgICAgICAgIWhhc1N0cmluZ0ZpZWxkICYmXG4gICAgICAgICFoYXNEYXRlRmllbGQgJiZcbiAgICAgICAgYWR2YW5jZWQpIHtcbiAgICAgICAgbGlzdC5wdXNoKFwiY2hhcnRcIik7XG4gICAgfVxuICAgIGlmICghbWFwSW1hZ2VTdWJsYXllciAmJlxuICAgICAgICAhZmVhdHVyZVJlZHVjdGlvbiAmJlxuICAgICAgICBmaWVsZENvdW50ID4gMSAmJlxuICAgICAgICAhaGFzRXhwcmVzc2lvbiAmJlxuICAgICAgICBbXCJwb2x5Z29uXCIsIFwicG9pbnRcIiwgXCJtdWx0aXBvaW50XCJdLmluZGV4T2YoZ2V0R2VvbWV0cnlUeXBlKGxheWVyKSkgPiAtMSAmJlxuICAgICAgICAhaGFzU3RyaW5nRmllbGQgJiZcbiAgICAgICAgIWhhc0RhdGVGaWVsZCAmJlxuICAgICAgICBhZHZhbmNlZCkge1xuICAgICAgICBsaXN0LnB1c2goXCJjaGFydC1zaXplXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJiBmaWVsZENvdW50ID09PSAyICYmICFoYXNFeHByZXNzaW9uICYmICFoYXNTdHJpbmdGaWVsZCAmJiAhaGFzRGF0ZUZpZWxkKSB7XG4gICAgICAgIGxpc3QucHVzaChcInJlbGF0aW9uc2hpcFwiKTtcbiAgICB9XG4gICAgaWYgKCghbWFwSW1hZ2VTdWJsYXllciB8fCBzdXBwb3J0c0FyY2FkZSkgJiZcbiAgICAgICAgZmllbGRDb3VudCA9PT0gMyAmJlxuICAgICAgICAoIWhhc0V4cHJlc3Npb24gfHwgKGNvdW50cy5leHByZXNzaW9uID09PSAxICYmIHNlbGVjdGVkRmllbGRzWzJdLmV4cHJlc3Npb24pKSAmJlxuICAgICAgICAhKG1hcEltYWdlU3VibGF5ZXIgJiYgaGFzRGF0ZUZpZWxkKSkge1xuICAgICAgICBsaXN0LnB1c2goXCJyZWxhdGlvbnNoaXAtc2l6ZVwiKTtcbiAgICB9XG4gICAgaWYgKCghbWFwSW1hZ2VTdWJsYXllciB8fCBzdXBwb3J0c0FyY2FkZSkgJiYgZmllbGRDb3VudCA9PT0gMiAmJiAhaGFzRXhwcmVzc2lvbiAmJiAhaGFzU3RyaW5nRmllbGQgJiYgIWhhc0RhdGVGaWVsZCkge1xuICAgICAgICBsaXN0LnB1c2goXCJjb21wYXJlXCIpO1xuICAgIH1cbiAgICBpZiAoZmllbGRDb3VudCA9PT0gMSAmJiAhKG1hcEltYWdlU3VibGF5ZXIgJiYgaGFzRGF0ZUZpZWxkKSkge1xuICAgICAgICBsaXN0LnB1c2goXCJ0eXBlXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJlxuICAgICAgICBmaWVsZENvdW50ID09PSAyICYmXG4gICAgICAgIGNvdW50cy5kYXRlIDwgMiAmJlxuICAgICAgICAhKG1hcEltYWdlU3VibGF5ZXIgJiYgaGFzRGF0ZUZpZWxkKSkge1xuICAgICAgICBsaXN0LnB1c2goXCJ0eXBlLXNpemVcIik7XG4gICAgfVxuICAgIGlmICgoIW1hcEltYWdlU3VibGF5ZXIgfHwgc3VwcG9ydHNBcmNhZGUpICYmXG4gICAgICAgIGZpZWxkQ291bnQgPT09IDIgJiZcbiAgICAgICAgaGFzRGF0ZUZpZWxkICYmXG4gICAgICAgIGNvdW50cy5kYXRlIDwgMiAmJlxuICAgICAgICBzZWxlY3RlZEZpZWxkc1sxXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSAmJlxuICAgICAgICBzZWxlY3RlZEZpZWxkc1sxXS5maWVsZCAmJlxuICAgICAgICBhZHZhbmNlZCkge1xuICAgICAgICAvLyBhZ2UgcmVuZGVyZXIgaGFzIGV4cHJlc3Npb24gYW5kIGZpZWxkIHNldFxuICAgICAgICBsaXN0LnB1c2goXCJ0eXBlLXNpemUtYWdlXCIpO1xuICAgIH1cbiAgICBpZiAoKCFtYXBJbWFnZVN1YmxheWVyIHx8IHN1cHBvcnRzQXJjYWRlKSAmJlxuICAgICAgICBbXCJwb2ludFwiLCBcIm11bHRpcG9pbnRcIl0uaW5kZXhPZihnZXRHZW9tZXRyeVR5cGUobGF5ZXIpKSA+IC0xICYmXG4gICAgICAgICFmZWF0dXJlUmVkdWN0aW9uICYmXG4gICAgICAgICgoYWR2YW5jZWQgJiYgZmllbGRDb3VudCA8PSAxKSB8fCAoIWFkdmFuY2VkICYmIGZpZWxkQ291bnQgPT09IDApKSAmJlxuICAgICAgICAhaGFzU3RyaW5nRmllbGQgJiZcbiAgICAgICAgIWhhc0RhdGVGaWVsZCAmJlxuICAgICAgICBjb3VudHMuZXhwcmVzc2lvbiA9PT0gMCkge1xuICAgICAgICBsaXN0LnB1c2goXCJoZWF0bWFwXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbn1cbmZ1bmN0aW9uIGdldE9yZGVyRm9yUmVuZGVyZXJUeXBlKCkge1xuICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgIGNvbnN0IGZpZWxkSW5mb3MgPSBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpO1xuICAgIGNvbnN0IGZpZWxkVHlwZTEgPSBmaWVsZEluZm9zLmxlbmd0aCA+IDAgPyBmaWVsZEluZm9zWzBdLnNpbXBsZUZpZWxkVHlwZSA6IG51bGw7XG4gICAgLy9jb25zdCBmaWVsZFR5cGUyID1cbiAgICAvLyAgZmllbGRJbmZvcy5sZW5ndGggPiAxID8gZmllbGRJbmZvc1sxXS5zaW1wbGVGaWVsZFR5cGUgOiBudWxsO1xuICAgIGxldCBsaXN0ID0gW107XG4gICAgc3dpdGNoIChyZW5kZXJlclR5cGUpIHtcbiAgICAgICAgY2FzZSBcInNpbXBsZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcInNpbXBsZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICBcInNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGVcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImRvdC1kZW5zaXR5XCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydFwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbXBhcmVcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidHlwZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcInR5cGVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiLFxuICAgICAgICAgICAgICAgIFwic2ltcGxlXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbXBhcmVcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY29sb3JcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXCJjb2xvclwiLCBcInNpemVcIiwgXCJjb2xvci1hZ2VcIiwgXCJzaXplLWFnZVwiLCBcImNvbG9yLXNpemVcIiwgXCJkb3QtZGVuc2l0eVwiXTtcbiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUxID09PSBcInN0cmluZ1wiIHx8IGZpZWxkVHlwZTEgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInR5cGVcIiwgXCJoZWF0bWFwXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJoZWF0bWFwXCIsIFwic2ltcGxlXCIsIFwidHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1xuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvci1hZ2VcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXCJjb2xvci1hZ2VcIiwgXCJjb2xvclwiLCBcInNpemVcIiwgXCJzaXplLWFnZVwiLCBcImNvbG9yLXNpemVcIiwgXCJkb3QtZGVuc2l0eVwiXTtcbiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUxID09PSBcInN0cmluZ1wiIHx8IGZpZWxkVHlwZTEgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInR5cGVcIiwgXCJoZWF0bWFwXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJoZWF0bWFwXCIsIFwic2ltcGxlXCIsIFwidHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1xuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzaXplXCI6XG4gICAgICAgICAgICBsaXN0ID0gW1wic2l6ZVwiLCBcInNpemUtYWdlXCIsIFwiY29sb3JcIiwgXCJjb2xvci1hZ2VcIiwgXCJjb2xvci1zaXplXCIsIFwiZG90LWRlbnNpdHlcIl07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIiB8fCBmaWVsZFR5cGUxID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCIsIFwiaGVhdG1hcFwiLCBcInNpbXBsZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1wiaGVhdG1hcFwiLCBcInNpbXBsZVwiLCBcInR5cGVcIl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiY29tcGFyZVwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic2l6ZS1hZ2VcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXCJzaXplLWFnZVwiLCBcInNpemVcIiwgXCJjb2xvci1hZ2VcIiwgXCJjb2xvclwiLCBcImNvbG9yLXNpemVcIiwgXCJkb3QtZGVuc2l0eVwiXTtcbiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUxID09PSBcInN0cmluZ1wiIHx8IGZpZWxkVHlwZTEgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInR5cGVcIiwgXCJoZWF0bWFwXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJoZWF0bWFwXCIsIFwic2ltcGxlXCIsIFwidHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1xuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJoZWF0bWFwXCI6XG4gICAgICAgICAgICBsaXN0ID0gW1wiaGVhdG1hcFwiLCBcImNvbG9yXCIsIFwic2l6ZVwiLCBcImNvbG9yLWFnZVwiLCBcInNpemUtYWdlXCIsIFwiY29sb3Itc2l6ZVwiLCBcImRvdC1kZW5zaXR5XCJdO1xuICAgICAgICAgICAgaWYgKGZpZWxkVHlwZTEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiLCBcInNpbXBsZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1wic2ltcGxlXCIsIFwidHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1xuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2VcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydFwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwiY29tcGFyZVwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJoZWF0bWFwXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplLWFnZVwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaWYgKGZpZWxkVHlwZTEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiLCBcInNpbXBsZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1wic2ltcGxlXCIsIFwidHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNoYXJ0XCI6XG4gICAgICAgICAgICBsaXN0ID0gW1xuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZG90LWRlbnNpdHlcIixcbiAgICAgICAgICAgICAgICBcImNvbXBhcmVcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICBcInNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZS1hZ2VcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUxID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInR5cGVcIiwgXCJzaW1wbGVcIl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInNpbXBsZVwiLCBcInR5cGVcIl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb3QtZGVuc2l0eVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcImRvdC1kZW5zaXR5XCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJzaW1wbGVcIiwgXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY29tcGFyZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcImNvbXBhcmVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZG90LWRlbnNpdHlcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJzaW1wbGVcIl0pO1xuICAgICAgICAgICAgaWYgKCFmaWVsZFR5cGUxIHx8IGZpZWxkVHlwZTEgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlbGF0aW9uc2hpcFwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbXBhcmVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZG90LWRlbnNpdHlcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJzaW1wbGVcIl0pO1xuICAgICAgICAgICAgaWYgKCFmaWVsZFR5cGUxIHx8IGZpZWxkVHlwZTEgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNvbG9yLXNpemVcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiLFxuICAgICAgICAgICAgICAgIFwic2ltcGxlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNvbG9yLWFnZS1zaXplXCI6XG4gICAgICAgICAgICBsaXN0ID0gW1xuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpbXBsZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb2xvci1zaXplLWFnZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29tcGFyZVwiLFxuICAgICAgICAgICAgICAgIFwiZG90LWRlbnNpdHlcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemVcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJzaW1wbGVcIixcbiAgICAgICAgICAgICAgICBcInR5cGVcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidHlwZS1zaXplXCI6XG4gICAgICAgICAgICBsaXN0ID0gW1xuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImRvdC1kZW5zaXR5XCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydFwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwic2ltcGxlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiLFxuICAgICAgICAgICAgICAgIFwiY29tcGFyZVwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0eXBlLXNpemUtYWdlXCI6XG4gICAgICAgICAgICBsaXN0ID0gW1xuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImRvdC1kZW5zaXR5XCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydFwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpbXBsZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3JcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiaGVhdG1hcFwiLFxuICAgICAgICAgICAgICAgIFwiY29tcGFyZVwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2Utc2l6ZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJzaW1wbGVcIiwgXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2hhcnQtc2l6ZVwiOlxuICAgICAgICAgICAgbGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0XCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemVcIixcbiAgICAgICAgICAgICAgICBcInR5cGUtc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImhlYXRtYXBcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2VcIixcbiAgICAgICAgICAgICAgICBcInNpemUtYWdlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCIsIFwic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJzaW1wbGVcIiwgXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVsYXRpb25zaGlwLXNpemVcIjpcbiAgICAgICAgICAgIGxpc3QgPSBbXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1hZ2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3Itc2l6ZS1hZ2VcIixcbiAgICAgICAgICAgICAgICBcImRvdC1kZW5zaXR5XCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2VcIixcbiAgICAgICAgICAgICAgICBcInByZWRvbWluYW5jZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFydFwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnQtc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJoZWF0bWFwXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvclwiLFxuICAgICAgICAgICAgICAgIFwic2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY29sb3ItYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJzaXplLWFnZVwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaWYgKGZpZWxkVHlwZTEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1wic2ltcGxlXCJdKTtcbiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUxICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KFtcInR5cGVcIl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBsaXN0ID0gW1wiY29sb3JcIiwgXCJzaXplXCIsIFwiY29sb3ItYWdlXCIsIFwic2l6ZS1hZ2VcIiwgXCJjb2xvci1zaXplXCJdO1xuICAgICAgICAgICAgaWYgKGZpZWxkVHlwZTEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1widHlwZVwiXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQoW1wiaGVhdG1hcFwiLCBcInNpbXBsZVwiXSk7XG4gICAgICAgICAgICBpZiAoZmllbGRUeXBlMSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXCJ0eXBlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChbXG4gICAgICAgICAgICAgICAgXCJkb3QtZGVuc2l0eVwiLFxuICAgICAgICAgICAgICAgIFwicHJlZG9taW5hbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJwcmVkb21pbmFuY2Utc2l6ZVwiLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRcIixcbiAgICAgICAgICAgICAgICBcImNoYXJ0LXNpemVcIixcbiAgICAgICAgICAgICAgICBcImNvbG9yLWFnZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJjb2xvci1zaXplLWFnZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZS1zaXplXCIsXG4gICAgICAgICAgICAgICAgXCJ0eXBlLXNpemUtYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYXJlXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICAgICAgICBcInJlbGF0aW9uc2hpcC1zaXplXCJcbiAgICAgICAgICAgIF0pO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbn1cblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUNzcyA9IFwiLmFkZC1idXR0b24tZGl2e21hcmdpbjowIDNweH0uYWRkLWJ1dHRvbnN7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdztqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmZ9LmF0dHJpYnV0ZXN7cGFkZGluZzo2cHggNnB4IDAgNnB4O2JhY2tncm91bmQtY29sb3I6I2ZmZmZmZn0uYXR0cmlidXRlcy1oZWFkZXItdGV4dHtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNnB4O3BhZGRpbmc6MTBweCAwfS5hdHRyaWJ1dGVzLW1zZ3tmb250LXNpemU6dmFyKC0tY2FsY2l0ZS1mb250LXNpemUtLTIpfS5hdHRyaWJ1dGVzLWFkZC1uZXd7bWFyZ2luLXRvcDoxMHB4fS50aXB7bWFyZ2luLXRvcDoxNXB4O2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0udGlwLW1lc3NhZ2V7anVzdGlmeS1jb250ZW50OmNlbnRlcn0udGlwLXRleHR7Y29sb3I6IzNkNWYxZH0udGlwLWNsb3Nle21hcmdpbi10b3A6NHB4fS5maWVsZC10eXBle2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7aGVpZ2h0OjEwMCU7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5hdHRyaWJ1dGUtbGlzdHtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTBlMGUwfS5nYWxsZXJ5LWJsb2Nre3BhZGRpbmc6MTJweCAzcHg7bWFyZ2luLWJvdHRvbToxMnB4O2JhY2tncm91bmQtY29sb3I6I2ZmZmZmZjtib3gtc2hhZG93OjAgMXB4IDEwcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4wNSksIDAgMCAwIDFweCAjZTBlMGUwfS5jZW50ZXJ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO3RleHQtYWxpZ246Y2VudGVyfS5udW1iZXItaWNvbntjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0uc3R5bGVzLW1zZy10aXRsZXtwYWRkaW5nOjZweDtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNnB4O2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyfS5zdHlsZXMtbXNne2ZvbnQtc2l6ZTp2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMil9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnkgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUNsb3NlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlDbHVzdGVyUmVxdWlyZXNVcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlDbHVzdGVyUmVxdWlyZXNVcGRhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMudGlsZU5vZGVzID0gW107XG4gICAgICAgIHRoaXMubGFzdFNvcnRCeSA9IExhc3RTb3J0eUJ5LmRlZmF1bHQ7XG4gICAgICAgIHRoaXMuYWRkRXhwcmVzc2lvbiA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gb3BlbiBBcmNhZGUgZWRpdG9yXG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRJbmZvID0gYXdhaXQgdXNlQXJjYWRlRWRpdG9yKCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuVU5LTk9XTikge1xuICAgICAgICAgICAgICAgICAgICAvLyBsZXQncyBqdXN0IGFzc3VtZSBpdCdzIGEgbnVtYmVyOyBtYXliZSBpdCBkaWRuJ3QgaGF2ZSBnb29kIHRlc3QgZGF0YVxuICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlID0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZHMsIG1vZHVsZXMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZpZWxkcy5sZW5ndGggPT09IDIgJiYgKGZpZWxkSW5mbyA9PT0gbnVsbCB8fCBmaWVsZEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUpID09PSBzaW1wbGVGaWVsZFR5cGVzLlNUUklORykge1xuICAgICAgICAgICAgICAgICAgICAvLyBjYW4ndCB1c2UgYSBzdHJpbmcgZmllbGQgZm9yIHNpemUgY29tcG9uZW50IG9mIHJlbGF0aW9uc2hpcCtzaXplXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5lcnJvcnMuZXhwcmVzc2lvbk11c3RCZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HICYmXG4gICAgICAgICAgICAgICAgICAgIChmaWVsZEluZm8gPT09IG51bGwgfHwgZmllbGRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlKSA9PT0gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuJ3QgdXNlIDIgc3RyaW5nIGZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHN0cmluZ3MucGFuZWxzLmdhbGxlcnkuZXJyb3JzLmV4cHJlc3Npb25NdXN0QmVOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdTZWxlY3RlZEZpZWxkcyA9IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUoc2VsZWN0ZWRGaWVsZHMpO1xuICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkRmllbGRzLnB1c2goZmllbGRJbmZvKTtcbiAgICAgICAgICAgICAgICBpZiAobmV3U2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBuZXdTZWxlY3RlZEZpZWxkc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLkRBVEUgJiYgaSAhPT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgdG8gZW5kIGZvciAnUmVsYXRpb25zaGlwICYgU2l6ZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZEZpZWxkcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2VsZWN0ZWRGaWVsZHMuc3BsaWNlKDIsIDAsIGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5ld1NlbGVjdGVkRmllbGRzLmxlbmd0aCA+IDEgJiZcbiAgICAgICAgICAgICAgICAgICAgbmV3U2VsZWN0ZWRGaWVsZHNbMV0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLlNUUklORykge1xuICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZEZpZWxkcy5yZXZlcnNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLnNlbGVjdGVkRmllbGRzID0gbmV3U2VsZWN0ZWRGaWVsZHM7XG4gICAgICAgICAgICAgICAgY3JlYXRlTmV3UmVuZGVyZXJXaXRoRGVsYXkodGhpcy5nYWxsZXJ5UmVxdWVzdFdyYXBwZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEV4cHJlc3Npb25CdXR0b25Ob2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQXJjYWRlRWRpdCA9IGFzeW5jIChlZGl0SWR4KSA9PiB7XG4gICAgICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZHMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIC8vIG9wZW4gQXJjYWRlIGVkaXRvclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGF3YWl0IHVzZUFyY2FkZUVkaXRvcihzZWxlY3RlZEZpZWxkc1tlZGl0SWR4XSk7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuVU5LTk9XTikge1xuICAgICAgICAgICAgICAgICAgICAvLyBsZXQncyBqdXN0IGFzc3VtZSBpdCdzIGEgbnVtYmVyOyBtYXliZSBpdCBkaWRuJ3QgaGF2ZSBnb29kIHRlc3QgZGF0YVxuICAgICAgICAgICAgICAgICAgICBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlID0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlZGl0SWR4ICE9PSAwICYmIChmaWVsZEluZm8gPT09IG51bGwgfHwgZmllbGRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlKSA9PT0gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZWRpdGluZyBhbiBleHByZXNzaW9uXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4ndCBkbyAyIHN0cmluZyBmaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHN0cmluZ3MucGFuZWxzLmdhbGxlcnkuZXJyb3JzLmV4cHJlc3Npb25NdXN0QmVOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBpbiBmcm9udFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkcy5zcGxpY2UoZWRpdElkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzLnVuc2hpZnQoZmllbGRJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1tlZGl0SWR4XSA9IGZpZWxkSW5mbztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc21hcnRNYXBwaW5nU3RhdGUuc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcztcbiAgICAgICAgICAgICAgICBjcmVhdGVOZXdSZW5kZXJlcldpdGhEZWxheSh0aGlzLmdhbGxlcnlSZXF1ZXN0V3JhcHBlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRXhwcmVzc2lvbkJ1dHRvbk5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVMaXN0T3JkZXJDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZHMsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRGaWVsZHMgPSBbXTtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldFxuICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIilcbiAgICAgICAgICAgICAgICAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkRmllbGRzLnB1c2gobW9kdWxlcy5lc3JpTGFuZy5jbG9uZShzZWxlY3RlZEZpZWxkc1twYXJzZUludChpdGVtLnZhbHVlKV0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc21hcnRNYXBwaW5nU3RhdGUuc2VsZWN0ZWRGaWVsZHMgPSBuZXdTZWxlY3RlZEZpZWxkcztcbiAgICAgICAgICAgIGNyZWF0ZU5ld1JlbmRlcmVyV2l0aERlbGF5KHRoaXMuZ2FsbGVyeVJlcXVlc3RXcmFwcGVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVMaXN0Q2hhbmdlID0gKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGlzRXhwcmVzc2lvbiA9ICEhc2VsZWN0ZWRGaWVsZHNbdmFsdWVdLmV4cHJlc3Npb247XG4gICAgICAgICAgICBpc0V4cHJlc3Npb24gPyB0aGlzLmhhbmRsZUFyY2FkZUVkaXQodmFsdWUpIDogdGhpcy5vcGVuRmllbGRQaWNrTGlzdCh0cnVlLCB2YWx1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlUmVtb3ZlQXR0cmlidXRlID0gKGlkeCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tb2RpZnlGaWVsZFBpY2tMaXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZHMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgc21hcnRNYXBwaW5nU3RhdGUuc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcyA9PT0gbnVsbCB8fCBzZWxlY3RlZEZpZWxkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRGaWVsZHMuZmlsdGVyKChfLCBpZHgyKSA9PiBpZHgyICE9PSBpZHgpO1xuICAgICAgICAgICAgY3JlYXRlTmV3UmVuZGVyZXJXaXRoRGVsYXkodGhpcy5nYWxsZXJ5UmVxdWVzdFdyYXBwZXIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVNlbGVjdENsaWNrID0gKHR5cGUpID0+IHtcbiAgICAgICAgICAgIGNyZWF0ZUNlcnRhaW5SZW5kZXJlcih0eXBlLCB0aGlzLmdhbGxlcnlSZXF1ZXN0V3JhcHBlcik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlT3B0aW9uc0NsaWNrID0gKHR5cGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvd05vZGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaW1wbGVcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtc2ltcGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpbXBsZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2ltcGxlRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJjb2xvclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJjb2xvci1hZ2VcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtY29sb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckJhY2tDbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwic2l6ZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJzaXplLWFnZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1zaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzU2l6ZUNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNTaXplQmFja0NsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1NpemVFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcInR5cGVcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtdHlwZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZUNsdXN0ZXJSZXF1aXJlc1VwZGF0ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlDbHVzdGVyUmVxdWlyZXNVcGRhdGUuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm9uQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwiY29tcGFyZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1jb21wYXJlXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29tcGFyZUNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLnJlbW92ZUNoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb21wYXJlQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb21wYXJlRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJoZWF0bWFwXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWhlYXRtYXBcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNIZWF0bWFwQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXBCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0hlYXRtYXBFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcInByZWRvbWluYW5jZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1wcmVkb21pbmFuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlQmFja0NsaWNrXCIsICgpID0+IHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VFcnJvclwiLCAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNHYWxsZXJ5RXJyb3IuZW1pdChkZXRhaWwpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBcImNoYXJ0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxvd0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWNoYXJ0XCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0RXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZWxhdGlvbnNoaXBcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtcmVsYXRpb25zaGlwXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcEJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJkb3QtZGVuc2l0eVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1kb3QtZGVuc2l0eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0RvdERlbnNpdHlDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzRG90RGVuc2l0eUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzRG90RGVuc2l0eUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwiY29sb3Itc2l6ZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJjb2xvci1hZ2Utc2l6ZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJjb2xvci1zaXplLWFnZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZpZWxkcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtY29sb3Itc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvclNpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNTZWxlY3RlZFRpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yU2l6ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9zZWxlY3RlZEZpZWxkcy5sZW5ndGggPT09IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1jb2xvci1zaXplLXVuaXZhcmlhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUJhY2tDbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JTaXplVW5pdmFyaWF0ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuYXBwZW5kQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwidHlwZS1zaXplXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInR5cGUtc2l6ZS1hZ2VcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1wYW5lbHMtdHlwZS1zaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzVHlwZVNpemVCYWNrQ2xpY2tcIiwgKCkgPT4gdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1R5cGVTaXplRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJwcmVkb21pbmFuY2Utc2l6ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1wcmVkb21pbmFuY2Utc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZVNpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlU2l6ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIFwiY2hhcnQtc2l6ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1jaGFydC1zaXplXCIpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUucmVtb3ZlQ2hpbGQoZmxvd0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c1NlbGVjdGVkVGlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NoYXJ0U2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ2hhcnRTaXplRXJyb3JcIiwgKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUVycm9yLmVtaXQoZGV0YWlsKSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dOb2RlLmFwcGVuZENoaWxkKGZsb3dJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZWxhdGlvbnNoaXAtc2l6ZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsb3dJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1yZWxhdGlvbnNoaXAtc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxvd0l0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1JlbGF0aW9uc2hpcFNpemVDbG9zZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5yZW1vdmVDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUJhY2tDbGlja1wiLCAoKSA9PiB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93SXRlbS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUmVsYXRpb25zaGlwU2l6ZUVycm9yXCIsICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlFcnJvci5lbWl0KGRldGFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmbG93Tm9kZS5hcHBlbmRDaGlsZChmbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUNsb3NlLmVtaXQoXCJzYXZlXCIpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGFwcGx5UmVuZGVyZXJUb0FsbChvcmlnaW5hbFJlbmRlcmVySlNPTiwgb3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUNsb3NlLmVtaXQoXCJjYW5jZWxcIik7XG4gICAgICAgIH07XG4gICAgICAgIC8qXG4gICAgICAgICAqIFBsYWNlIHBhbmVsIGluIGxvYWRpbmcgbW9kZSBkdXJpbmcgcmVuZGVyZXIgY3JlYXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdhbGxlcnlSZXF1ZXN0V3JhcHBlciA9IChyZXF1ZXN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgcmVxdWVzdFdyYXBwZXIocmVxdWVzdCwgdGhpcy5mbG93SXRlbU5vZGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLmNsb25lKCksIGxheWVyKTtcbiAgICAgICAgICAgICAgICBpZiAobWFwSW1hZ2VTdWJsYXllcikge1xuICAgICAgICAgICAgICAgICAgICBtYXBJbWFnZVN1YmxheWVyLnJlbmRlcmVyID0gcmVzdWx0LnJlbmRlcmVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQ2x1c3RlcigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tDbHVzdGVyUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzU2VsZWN0ZWRUaWxlKCk7XG4gICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNHYWxsZXJ5RXJyb3IuZW1pdCh7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHN0cmluZ3MucGFuZWxzLmdhbGxlcnkuZXJyb3JzLmNoYW5nZVJlbmRlcmVyRXJyb3JNc2csXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51T3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5iZWZvcmVCYWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVuZGVyZXJcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMub3JpZ2luYWxSZW5kZXJlckpTT04gPSByZW5kZXJlci50b0pTT04oKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gPVxuICAgICAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgbGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgID8gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShsYXllci5mZWF0dXJlUmVkdWN0aW9uKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZsb3dOb2RlID0gZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3dcIik7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIGhpZGVMYXllclRpdGxlLCBpc1JUTCwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGxldCBkaXNwbGF5V2FybmluZyA9IGZhbHNlO1xuICAgICAgICBpZiAoXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgKChfYSA9IGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJjbHVzdGVyXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVSZWR1Y3Rpb24gPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uO1xuICAgICAgICAgICAgaWYgKCgoX2IgPSBmZWF0dXJlUmVkdWN0aW9uLnJlbmRlcmVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudHlwZSkgPT09IFwicGllLWNoYXJ0XCIgJiZcbiAgICAgICAgICAgICAgICAhKChfYyA9IGZlYXR1cmVSZWR1Y3Rpb24ucmVuZGVyZXIuYXV0aG9yaW5nSW5mbykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlzQXV0b0dlbmVyYXRlZCkpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5V2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwiY2FsY2l0ZS1tYXRjaC1oZWlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnN0eWxlcywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IGxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogdHJ1ZSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIHJlZjogKG5vZGUpID0+ICh0aGlzLmZsb3dJdGVtTm9kZSA9IG5vZGUpIH0sIGRpc3BsYXlXYXJuaW5nID8gdGhpcy5yZW5kZXJDbHVzdGVyaW5nV2FybmluZygpIDogdGhpcy5yZW5kZXJHYWxsZXJ5Q29udGVudCgpKSkpO1xuICAgIH1cbiAgICByZW5kZXJHYWxsZXJ5Q29udGVudCgpIHtcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCB0aGlzLnJlbmRlckRvbmVCdXR0b24oKSwgdGhpcy5yZW5kZXJDYW5jZWxCdXR0b24oKSwgdGhpcy5yZW5kZXJTdGVwT25lKCksIHRoaXMucmVuZGVyU3RlcFR3bygpKSk7XG4gICAgfVxuICAgIHJlbmRlckNsdXN0ZXJpbmdXYXJuaW5nKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtdGlwXCIsIHsgY2xvc2VEaXNhYmxlZDogdHJ1ZSB9LCBoKFwiZGl2XCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLmdhbGxlcnkuY2hhcnRDbHVzdGVyTXNnKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiZnVsbFwiIH0sIHN0cmluZ3MuZG9uZSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZUJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgc3RhdGUgb2YgcGFuZWwgZG9lc24ndCBwb3NpdGlvbiBidXR0b25zIGNvcnJlY3RseVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWxCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoIWxheWVyKSB7XG4gICAgICAgICAgICAvLyBsb2FkaW5nIHN0YXRlIG9mIHBhbmVsIGRvZXNuJ3QgcG9zaXRpb24gYnV0dG9ucyBjb3JyZWN0bHlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbCwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIHJlbmRlclN0ZXBPbmUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHNlbGVjdGVkRmllbGRzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgZmllbGRDb3VudCA9IHNlbGVjdGVkRmllbGRzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgY291bnRzID0gZ2V0RmllbGRUeXBlQ291bnQoKTtcbiAgICAgICAgY29uc3QgaGFzU3RyaW5nRmllbGQgPSBjb3VudHMuc3RyaW5nID4gMDtcbiAgICAgICAgY29uc3QgdGhpcmRJc0V4cHIgPSBmaWVsZENvdW50ID09PSAzICYmIHNlbGVjdGVkRmllbGRzWzJdLmV4cHJlc3Npb247XG4gICAgICAgIGNvbnN0IHRoaXJkSXNEYXRlID0gZmllbGRDb3VudCA9PT0gMyAmJiBzZWxlY3RlZEZpZWxkc1syXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgbGV0IGZpZWxkc1NlbGVjdGlvbiA9IHNlbGVjdGVkRmllbGRzLm1hcCgoX18sIGlkeCkgPT4gdGhpcy5yZW5kZXJBdHRyaWJ1dGUoaWR4KSk7XG4gICAgICAgIGNvbnN0IGRyYWdFbmFibGVkID0gZmllbGRDb3VudCA+IDEgJiYgIWhhc1N0cmluZ0ZpZWxkICYmICF0aGlyZElzRXhwciAmJiAhdGhpcmRJc0RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImF0dHJpYnV0ZXMgZ2FsbGVyeS1ibG9ja1wiIH0sIGgoXCJkaXZcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNlbnRlclwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBjbGFzczogXCJudW1iZXItaWNvblwiLCBzY2FsZTogXCJtXCIsIGljb246IFwibnVtYmVyLWNpcmNsZS0xXCIgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYXR0cmlidXRlcy1oZWFkZXItdGV4dCBjZW50ZXJcIiB9LCBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LmNob29zZUF0dHJpYnV0ZXMpKSwgIWZpZWxkQ291bnQgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJhdHRyaWJ1dGVzLW1zZyBjZW50ZXJcIiB9LCBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LmNob29zZUF0dHJpYnV0ZXNNc2cpKSwgaChcImNhbGNpdGUtbGlzdFwiLCB7IGNsYXNzOiBmaWVsZHNTZWxlY3Rpb24ubGVuZ3RoID4gMCA/IFwiYXR0cmlidXRlLWxpc3RcIiA6IFwiXCIsIGtleTogYGdhbGxlcnktYXR0cmlidXRlcy1zZWxlY3RzLSR7c2VsZWN0ZWRGaWVsZHN9YCwgZHJhZ0VuYWJsZWQ6IGRyYWdFbmFibGVkLCBvbkNhbGNpdGVMaXN0T3JkZXJDaGFuZ2U6IHRoaXMuaGFuZGxlTGlzdE9yZGVyQ2hhbmdlIH0sIGZpZWxkc1NlbGVjdGlvbiksIGxheWVyICYmIHRoaXMucmVuZGVyQWRkQnV0dG9ucygpLCBsYXllciAmJiB0aGlzLnJlbmRlclRpcCgpKSk7XG4gICAgfVxuICAgIHJlbmRlckF0dHJpYnV0ZShpZHgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGZpZWxkSUQgPSBzZWxlY3RlZEZpZWxkc1tpZHhdLmZpZWxkIHx8IHNlbGVjdGVkRmllbGRzW2lkeF0uZXhwcmVzc2lvblRpdGxlO1xuICAgICAgICBjb25zdCBpc0V4cHJlc3Npb24gPSAhIXNlbGVjdGVkRmllbGRzW2lkeF0uZXhwcmVzc2lvbjtcbiAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZChzZWxlY3RlZEZpZWxkc1tpZHhdLmZpZWxkKTtcbiAgICAgICAgY29uc3QgZmllbGRMYWJlbCA9IGZpZWxkID8gZmllbGQubGFiZWwgOiBzZWxlY3RlZEZpZWxkc1tpZHhdLmV4cHJlc3Npb25UaXRsZTtcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gc2VsZWN0ZWRGaWVsZHNbaWR4XS5zaW1wbGVGaWVsZFR5cGU7XG4gICAgICAgIGNvbnN0IGljb24gPSAhaXNFeHByZXNzaW9uICYmXG4gICAgICAgICAgICAoZmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgICAgID8gXCJudW1iZXJcIlxuICAgICAgICAgICAgICAgIDogZmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLlNUUklOR1xuICAgICAgICAgICAgICAgICAgICA/IGdldEZpZWxkVHlwZShmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQubGF5ZXJGaWVsZCkgPT09IFwiZGF0ZS1vbmx5XCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gXCJjYWxlbmRhclwiXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgOiBmaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogYGdhbGxlcnktYXR0cmlidXRlLSR7aWR4fS0ke2ZpZWxkSUR9YCwgbGFiZWw6IGZpZWxkTGFiZWwsIHZhbHVlOiBpZHgsIG9uQ2xpY2s6IChldmVudCkgPT4gZXZlbnQudGFyZ2V0ICYmIHRoaXMuaGFuZGxlTGlzdENoYW5nZShpZHgpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGlzdENoYW5nZShpZHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgaWNvbiAmJiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBpY29uLCBjbGFzczogXCJmaWVsZC10eXBlXCIgfSkpKSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsga2V5OiBgZ2FsbGVyeS1hdHRyaWJ1dGUtJHtpZHh9LSR7ZmllbGRJRH0tcmVtb3ZlYCwgc2xvdDogXCJhY3Rpb25zLWVuZFwiLCB0ZXh0OiBpc0V4cHJlc3Npb25cbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLmdhbGxlcnkucmVtb3ZlRXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5yZW1vdmVGaWVsZCwgbGFiZWw6IGlzRXhwcmVzc2lvblxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5yZW1vdmVFeHByZXNzaW9uXG4gICAgICAgICAgICAgICAgOiBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnJlbW92ZUZpZWxkLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlbW92ZUF0dHJpYnV0ZShpZHgpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIgfHwgZXZlbnQua2V5ID09PSBcIiBcIikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZW1vdmVBdHRyaWJ1dGUoaWR4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwieFwiIH0pKSkpO1xuICAgIH1cbiAgICByZW5kZXJUaXAoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkcywgcG9ydGFsLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKHNlbGVjdGVkRmllbGRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKCFzZWxlY3RlZEZpZWxkcy5sZW5ndGggJiZcbiAgICAgICAgICAgIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXlzLkFSQ0dJU19DT01QT05FTlRfTk9USUZJQ0FUSU9OUywgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMuU01BUlRfTUFQUElOR19USVAxX0RJU01JU1NFRCkpIHx8XG4gICAgICAgICAgICAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICAgICAgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleXMuQVJDR0lTX0NPTVBPTkVOVF9OT1RJRklDQVRJT05TLCBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cy5TTUFSVF9NQVBQSU5HX1RJUDJfRElTTUlTU0VEKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBvcyA9IHN0cmluZ3MucGFuZWxzLmdhbGxlcnkudGlwMS5pbmRleE9mKFwiJHtzbWFydE1hcHBpbmdMaW5rfVwiKTtcbiAgICAgICAgY29uc3QgaGVscE1hcCA9ICgoX2EgPSBwb3J0YWwuaGVscE1hcCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm0pIHx8IHBvcnRhbC5oZWxwTWFwO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBrZXk6IFwiZ2FsbGVyeS10aXBcIiwgY2xhc3M6IFwidGlwXCIgfSwgaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGtleTogXCJnYWxsZXJ5LXRpcC1tZXNzYWdlXCIsIGljb246IFwibGlnaHRidWxiXCIsIGNsYXNzOiBcInRpcC1tZXNzYWdlXCIgfSwgc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAwICYmIHBvcnRhbC5oZWxwQmFzZSAmJiBoZWxwTWFwID8gKGgoXCJkaXZcIiwgeyBrZXk6IFwiZ2FsbGVyeS10aXAtdGV4dFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwidGlwLXRleHRcIiB9LCBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnRpcDEuc3Vic3RyaW5nKDAsIHBvcykpLCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgdGFyZ2V0OiBcIl9ibGFua1wiLCBocmVmOiBgJHtwb3J0YWwuaGVscEJhc2V9JHtoZWxwTWFwW1wiMTIwMDAzMjQ5XCJdfWAgfSwgc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS50aXAxTGluayksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwidGlwLXRleHRcIiB9LCBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnRpcDEuc3Vic3RyaW5nKHBvcyArIDE5KSkpKSA6IHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMCA/IChoKFwic3BhblwiLCB7IGtleTogXCJnYWxsZXJ5LXRpcC10ZXh0XCIsIGNsYXNzOiBcInRpcC10ZXh0XCIgfSwgc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS50aXAxLnJlcGxhY2UoXCIke3NtYXJ0TWFwcGluZ0xpbmt9XCIsIHN0cmluZ3MucGFuZWxzLmdhbGxlcnkudGlwMUxpbmspLCBcIiBcIikpIDogKGgoXCJzcGFuXCIsIHsga2V5OiBcImdhbGxlcnktdGlwLXRleHRcIiwgY2xhc3M6IFwidGlwLXRleHRcIiB9LCBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnRpcDIpKSksIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNjYWxlOiBcInNcIiwgbGFiZWw6IHN0cmluZ3MuY2xvc2UsIHRleHQ6IHN0cmluZ3MuY2xvc2UsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgICAgICAgICBpZiAoIXNlbGVjdGVkRmllbGRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5cy5BUkNHSVNfQ09NUE9ORU5UX05PVElGSUNBVElPTlMsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMuU01BUlRfTUFQUElOR19USVAxX0RJU01JU1NFRCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcInRydWVcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXlzLkFSQ0dJU19DT01QT05FTlRfTk9USUZJQ0FUSU9OUywge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cy5TTUFSVF9NQVBQSU5HX1RJUDJfRElTTUlTU0VELFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwidHJ1ZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJ4XCIgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckFkZEJ1dHRvbnMoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIHNlbGVjdGVkRmllbGRzLCBzdHJpbmdzLCBzdXBwb3J0c0FyY2FkZSB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGZpZWxkQ291bnQgPSBzZWxlY3RlZEZpZWxkcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGxheWVyQ291bnRzID0gZ2V0TGF5ZXJGaWVsZFR5cGVDb3VudCgpO1xuICAgICAgICBjb25zdCBjb3VudHMgPSBnZXRGaWVsZFR5cGVDb3VudCgpO1xuICAgICAgICBjb25zdCBoYXNTdHJpbmdGaWVsZCA9IGNvdW50cy5zdHJpbmcgPiAwO1xuICAgICAgICBjb25zdCBoYXNEYXRlRmllbGQgPSBjb3VudHMuZGF0ZSA+IDA7XG4gICAgICAgIGNvbnN0IGhhc0V4cHJlc3Npb24gPSBjb3VudHMuZXhwcmVzc2lvbiA+IDA7XG4gICAgICAgIGNvbnN0IHN1cHBvcnRzU3FsRXhwcmVzc2lvbiA9IChfYiA9IChfYSA9IGxheWVyLmNhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3VwcG9ydHNTcWxFeHByZXNzaW9uO1xuICAgICAgICAvLyBkbyB3ZSBoYXZlIHJlbmRlcmVyIHN0eWxlcyBmb3IgbW9yZSBmaWVsZHM/XG4gICAgICAgIGxldCBlbmFibGVBZGRGaWVsZCA9ICEobWFwSW1hZ2VTdWJsYXllciAmJiAhc3VwcG9ydHNBcmNhZGUgJiYgZmllbGRDb3VudCA9PT0gMSkgJiZcbiAgICAgICAgICAgIGZpZWxkQ291bnQgPCAxMCAmJlxuICAgICAgICAgICAgIShmaWVsZENvdW50ID09PSAyICYmIChoYXNTdHJpbmdGaWVsZCB8fCBoYXNFeHByZXNzaW9uKSkgJiZcbiAgICAgICAgICAgICEobWFwSW1hZ2VTdWJsYXllciAmJiBmaWVsZENvdW50ID09PSAyICYmIGhhc0RhdGVGaWVsZCkgJiZcbiAgICAgICAgICAgICEoZmllbGRDb3VudCA9PT0gMyAmJlxuICAgICAgICAgICAgICAgIChoYXNEYXRlRmllbGQgfHwgc2VsZWN0ZWRGaWVsZHNbMl0uZXhwcmVzc2lvbiB8fCAhc3VwcG9ydHNTcWxFeHByZXNzaW9uKSk7XG4gICAgICAgIC8vIGRvIHdlIGhhdmUgbW9yZSBsYXllciBmaWVsZHM/XG4gICAgICAgIGVuYWJsZUFkZEZpZWxkID1cbiAgICAgICAgICAgIGVuYWJsZUFkZEZpZWxkICYmXG4gICAgICAgICAgICAgICAgKChjb3VudHMuc3RyaW5nID09PSAxICYmXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cy5udW1iZXIgKyBjb3VudHMuZGF0ZSA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICBsYXllckNvdW50cy5udW1iZXIgKyBsYXllckNvdW50cy5kYXRlID4gMCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvdW50cy5zdHJpbmcgPT09IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cy5kYXRlIDwgMiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRzLm51bWJlciArIGNvdW50cy5kYXRlIDwgMyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRzLnN0cmluZyArIGNvdW50cy5udW1iZXIgKyBjb3VudHMuZGF0ZSA8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJDb3VudHMuc3RyaW5nICsgbGF5ZXJDb3VudHMubnVtYmVyICsgbGF5ZXJDb3VudHMuZGF0ZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvdW50cy5udW1iZXIgPj0gMiAmJiBjb3VudHMubnVtYmVyIDwgbGF5ZXJDb3VudHMubnVtYmVyKSk7XG4gICAgICAgIGNvbnN0IGVuYWJsZUFkZEV4cHJlc3Npb24gPSAoIW1hcEltYWdlU3VibGF5ZXIgfHwgc3VwcG9ydHNBcmNhZGUpICYmXG4gICAgICAgICAgICAoZmllbGRDb3VudCA8IDIgfHxcbiAgICAgICAgICAgICAgICAoZmllbGRDb3VudCA9PT0gMiAmJlxuICAgICAgICAgICAgICAgICAgICAhaGFzRXhwcmVzc2lvbiAmJlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSICYmXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzWzFdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYWRkLWJ1dHRvbi1kaXZcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYWRkLWJ1dHRvbnNcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBkaXNhYmxlZDogIWVuYWJsZUFkZEZpZWxkLCBvbkNsaWNrOiAoKSA9PiB0aGlzLm9wZW5GaWVsZFBpY2tMaXN0KCksIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCB3aWR0aDogXCJmdWxsXCIsIGxhYmVsOiBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LmFkZEZpZWxkLCBpY29uU3RhcnQ6IFwicGx1c1wiLCBjbGFzczogXCJhdHRyaWJ1dGVzLWFkZC1uZXdcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYWRkRmllbGRCdXR0b25Ob2RlID0gbm9kZSkgfSwgc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5maWVsZCksIGgoXCJzcGFuXCIsIG51bGwsIFwiXFx1MDBBMFxcdTAwQTBcIiksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGRpc2FibGVkOiAhZW5hYmxlQWRkRXhwcmVzc2lvbiwgb25DbGljazogdGhpcy5hZGRFeHByZXNzaW9uLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgd2lkdGg6IFwiZnVsbFwiLCBsYWJlbDogc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5hZGRFeHByZXNzaW9uLCBpY29uU3RhcnQ6IFwicGx1c1wiLCBjbGFzczogXCJhdHRyaWJ1dGVzLWFkZC1uZXdcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYWRkRXhwcmVzc2lvbkJ1dHRvbk5vZGUgPSBub2RlKSB9LCBzdHJpbmdzLmV4cHJlc3Npb24pKSkpO1xuICAgIH1cbiAgICByZW5kZXJTdGVwVHdvKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkRmllbGRzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgYWxsb3dlZExpc3QgPSBnZXRBbGxvd2VkU3R5bGVzKCk7XG4gICAgICAgIGNvbnN0IG9yZGVyZWRMaXN0ID0gZ2V0T3JkZXJGb3JSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgbXNnID0gIShzZWxlY3RlZEZpZWxkcyA9PT0gbnVsbCB8fCBzZWxlY3RlZEZpZWxkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRGaWVsZHMubGVuZ3RoKVxuICAgICAgICAgICAgPyBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnN0eWxlTXNnLmVtcHR5XG4gICAgICAgICAgICA6IHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzWzBdLmZpZWxkICYmXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHNbMF0uc2ltcGxlRmllbGRUeXBlID09PSBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5zdHlsZU1zZy5vbmVOdW1iZXJcbiAgICAgICAgICAgICAgICA6IHNlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMiAmJlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5maWVsZCAmJlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1sxXS5maWVsZCAmJlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkc1swXS5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSICYmXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzWzFdLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnBhbmVscy5nYWxsZXJ5LnN0eWxlTXNnLm11bHRpcGxlTnVtYmVyXG4gICAgICAgICAgICAgICAgICAgIDogc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5zdHlsZU1zZy5hbnk7XG4gICAgICAgIC8vY29uc29sZS5sb2coZ2V0UmVuZGVyZXJUeXBlKCksIGFsbG93ZWRMaXN0LCBvcmRlcmVkTGlzdCk7XG4gICAgICAgIGFsbG93ZWRMaXN0LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBvcmRlcmVkTGlzdC5pbmRleE9mKGEpIC0gb3JkZXJlZExpc3QuaW5kZXhPZihiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHN0eWxlVGlsZXMgPSBhbGxvd2VkTGlzdC5tYXAoKHN0eWxlLCBpZHgpID0+IHRoaXMucmVuZGVyU3R5bGVUaWxlKHN0eWxlLCBpZHgpKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZ2FsbGVyeS1ibG9ja1wiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJhdHRyaWJ1dGVzLWhlYWRlclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjZW50ZXJcIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgY2xhc3M6IFwibnVtYmVyLWljb25cIiwgc2NhbGU6IFwibVwiLCBpY29uOiBcIm51bWJlci1jaXJjbGUtMlwiIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN0eWxlcy1tc2ctdGl0bGUgY2VudGVyXCIgfSwgc3RyaW5ncy5wYW5lbHMuZ2FsbGVyeS5waWNrU3R5bGUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3R5bGVzLW1zZyBjZW50ZXJcIiB9LCBtc2cpKSwgc3R5bGVUaWxlcykpO1xuICAgIH1cbiAgICByZW5kZXJTdHlsZVRpbGUodHlwZSwgaWR4KSB7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCB0aGVtZSA9IGdldFJlbmRlcmVyVGhlbWUoKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdGlsZVwiLCB7IGtleTogYHRpbGUtJHt0eXBlfS0ke3RoZW1lfWAsIHRpbGVUeXBlOiBcImdhbGxlcnlcIiwgdHlwZTogdHlwZSwgc2VsZWN0ZWQ6IHR5cGUgPT09IHJlbmRlcmVyVHlwZSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8qIFdvcmthcm91bmQgZm9yIG51bGwtcmVsYXRlZCByZWYgaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL3N0ZW5jaWwvaXNzdWVzLzMyNTNcbiAgICAgICAgICAgICAgICBBbGwgXCJpZiAobm9kZSlcIiBjaGVja3MgaW4gYXJjZ2lzLXNtYXJ0LW1hcHBpbmcgYXJlIHdvcmthcm91bmRzIGZvciB0aGlzIHNhbWUgaXNzdWUhICovXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aWxlTm9kZXNbaWR4XSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlU2VsZWN0OiAoKSA9PiB0aGlzLmhhbmRsZVNlbGVjdENsaWNrKHR5cGUpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RpbGVPcHRpb25zOiAoKSA9PiB0aGlzLmhhbmRsZU9wdGlvbnNDbGljayh0eXBlKSwgb25BcmNnaXNTbWFydE1hcHBpbmdUaWxlRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNHYWxsZXJ5RXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFkZEZpZWxkKGZpZWxkTmFtZXMpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkcywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGFkZEZpZWxkc1RvTGF5ZXJDYWNoZShmaWVsZE5hbWVzKTtcbiAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRGaWVsZHMgPSBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKHNlbGVjdGVkRmllbGRzKTtcbiAgICAgICAgZmllbGROYW1lcy5mb3JFYWNoKChmaWVsZE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGdldEZpZWxkKGZpZWxkTmFtZSk7XG4gICAgICAgICAgICBpZiAoZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkcpIHtcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW4gZnJvbnQgZm9yICdUeXBlICYgU2l6ZSdcbiAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZEZpZWxkcy51bnNoaWZ0KHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLlNUUklOR1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0ZWRGaWVsZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG5ld1NlbGVjdGVkRmllbGRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBuZXdTZWxlY3RlZEZpZWxkc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5EQVRFICYmIGkgIT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbW92ZSB0byBlbmQgZm9yICdSZWxhdGlvbnNoaXAgJiBTaXplJ1xuICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZEZpZWxkcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkRmllbGRzLnNwbGljZSgyLCAwLCBmaWVsZEluZm8pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1NhbWVGaWVsZEluZm9zKHNlbGVjdGVkRmllbGRzLCBuZXdTZWxlY3RlZEZpZWxkcykpIHtcbiAgICAgICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLnNlbGVjdGVkRmllbGRzID0gbmV3U2VsZWN0ZWRGaWVsZHM7XG4gICAgICAgICAgICBjcmVhdGVOZXdSZW5kZXJlcldpdGhEZWxheSh0aGlzLmdhbGxlcnlSZXF1ZXN0V3JhcHBlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWRpdEF0dHJpYnV0ZShmaWVsZE5hbWVzLCBlZGl0SWR4KSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRGaWVsZHMsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBhZGRGaWVsZHNUb0xheWVyQ2FjaGUoZmllbGROYW1lcyk7XG4gICAgICAgIGNvbnN0IG9sZFNlbGVjdGVkRmllbGRzID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShzZWxlY3RlZEZpZWxkcyk7XG4gICAgICAgIGZpZWxkTmFtZXMuZm9yRWFjaCgoZmllbGROYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBnZXRGaWVsZChmaWVsZE5hbWUpO1xuICAgICAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW4gZnJvbnRcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkcy5zcGxpY2UoZWRpdElkeCwgMSk7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHMudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogc2ltcGxlRmllbGRUeXBlcy5TVFJJTkdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzW2VkaXRJZHhdID0ge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogZmllbGROYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFpc1NhbWVGaWVsZEluZm9zKHNlbGVjdGVkRmllbGRzLCBvbGRTZWxlY3RlZEZpZWxkcykpIHtcbiAgICAgICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLnNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHM7XG4gICAgICAgICAgICBjcmVhdGVOZXdSZW5kZXJlcldpdGhEZWxheSh0aGlzLmdhbGxlcnlSZXF1ZXN0V3JhcHBlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2hlY2tDbHVzdGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiZcbiAgICAgICAgICAgIGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24gJiZcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeUNsdXN0ZXJSZXF1aXJlc1VwZGF0ZS5lbWl0KCk7XG4gICAgfVxuICAgIGNoZWNrQ2x1c3RlclJlbmRlcmVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoXCJmZWF0dXJlUmVkdWN0aW9uXCIgaW4gbGF5ZXIgJiYgKChfYSA9IGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJjbHVzdGVyXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNsdXN0ZXIgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uO1xuICAgICAgICAgICAgLy8gcmVjcmVhdGUgZGVmYXVsdCByZW5kZXJlclxuICAgICAgICAgICAgY2x1c3Rlci5yZW5kZXJlciA9IG51bGw7XG4gICAgICAgICAgICBsYXllci5mZWF0dXJlUmVkdWN0aW9uID0gY2x1c3Rlci5jbG9uZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9wZW5GaWVsZFBpY2tMaXN0KHNpbmdsZUVkaXRNb2RlID0gZmFsc2UsIGVkaXRJbmRleCA9IG51bGwpIHtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBjb25zdCB7IGZpZWxkcywgc2VsZWN0ZWRGaWVsZHMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBsZXQgc2VsZWN0ZWRGaWVsZE5hbWVzID0gc2VsZWN0ZWRGaWVsZHMubWFwKChmaWVsZCkgPT4gZmllbGQuZmllbGQpO1xuICAgICAgICBsZXQgZmllbGRzRm9yUGlja0xpc3Q7XG4gICAgICAgIGZpZWxkc0ZvclBpY2tMaXN0ID0gZmllbGRzLmZpbHRlcigoZmllbGQpID0+IHtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBjdXJyZW50bHkgc2VsZWN0ZWQgZmllbGRzIGFuZCBpZiBzaW5nbGUgZWRpdCBtb2RlXG4gICAgICAgICAgICBsZXQgaW5jbHVkZSA9ICFzZWxlY3RlZEZpZWxkTmFtZXMuaW5jbHVkZXMoZmllbGQubGF5ZXJGaWVsZC5uYW1lKTtcbiAgICAgICAgICAgIGlmIChzaW5nbGVFZGl0TW9kZSkge1xuICAgICAgICAgICAgICAgIGluY2x1ZGUgPSBpbmNsdWRlIHx8IGZpZWxkLmxheWVyRmllbGQubmFtZSA9PT0gc2VsZWN0ZWRGaWVsZE5hbWVzW2VkaXRJbmRleF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5jbHVkZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGZpZWxkUGlja0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZmllbGQtcGljay1saXN0XCIpO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmZpZWxkcyA9IGZpZWxkc0ZvclBpY2tMaXN0O1xuICAgICAgICBmaWVsZFBpY2tMaXN0LnBvcG92ZXJQcm9wcyA9IHtcbiAgICAgICAgICAgIHJlZkVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLFxuICAgICAgICAgICAgcGxhY2VtZW50OiBcImxlYWRpbmdcIixcbiAgICAgICAgICAgIG9mZnNldERpc3RhbmNlOiAwLFxuICAgICAgICAgICAgcG9wb3ZlcldpZHRoOiB0aGlzLmZsb3dJdGVtTm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAqIDEuMDUsXG4gICAgICAgICAgICBvdmVybGF5UG9zaXRpb25pbmc6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgIGZsaXBEaXNhYmxlZDogZmFsc2UsXG4gICAgICAgICAgICB0cmlnZ2VyRGlzYWJsZWQ6IHRydWVcbiAgICAgICAgfTtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5zaW5nbGVFZGl0TW9kZSA9IHNpbmdsZUVkaXRNb2RlO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmZpZWxkVG9SZXBsYWNlID0gc2luZ2xlRWRpdE1vZGUgPyBzZWxlY3RlZEZpZWxkc1tlZGl0SW5kZXhdIDogbnVsbDtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5sYXN0U29ydEJ5ID0gdGhpcy5sYXN0U29ydEJ5O1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpZWxkUGlja0xpc3QpO1xuICAgICAgICBkaXNhYmxlUGFuZWwodGhpcy5mbG93SXRlbU5vZGUsIHRydWUpO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdGaWVsZFBpY2tMaXN0Q2xvc2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB0aGlzLm1vZGlmeUZpZWxkUGlja0xpc3QgPSB0cnVlO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmaWVsZFBpY2tMaXN0KTtcbiAgICAgICAgICAgIGRpc2FibGVQYW5lbCh0aGlzLmZsb3dJdGVtTm9kZSwgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKChfYSA9IGV2ZW50LmRldGFpbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlbGVjdGVkRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNpbmdsZUVkaXRNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdEF0dHJpYnV0ZShldmVudC5kZXRhaWwuc2VsZWN0ZWRGaWVsZHMsIGVkaXRJbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEZpZWxkKGV2ZW50LmRldGFpbC5zZWxlY3RlZEZpZWxkcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hZGRGaWVsZEJ1dHRvbk5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZpZWxkUGlja0xpc3QuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ0ZpZWxkUGlja0xpc3RTb3J0QnlDaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxhc3RTb3J0QnkgPSBldmVudC5kZXRhaWw7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmb2N1c1NlbGVjdGVkVGlsZSgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLnRpbGVOb2Rlc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7IH0pLCAzMDApO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzR2FsbGVyeS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnlDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0dhbGxlcnkgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX2dhbGxlcnkgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWdhbGxlcnkuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBQIGFzIGZpbmRDb2xvclNjaGVtZSwgcSBhcyBpc1BvbHlnb25UeXBlLCBwIGFzIGdldEF1dGhWaXNWYXIsIGwgYXMgYXBwbHlFeHRyYVZpc1ZhcnMsIHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIG0gYXMgc2F2ZUV4dHJhVmlzVmFycywgaCBhcyBnZXRSZW5kZXJlciwgYSBhcyBnZXRWaXNWYXIsIFIgYXMgaXNFbXB0eSwgdyBhcyBzaW1wbGVGaWVsZFR5cGVzIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzRGVmaW5lZCB9IGZyb20gJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBsYXllciB3aXRoIGEgQ29tcGFyZSByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqIEBwYXJhbSBwcm9wczogbXVzdCBjb250YWluIGxheWVyLCBtYXBWaWV3LCBmaWVsZFxuICogQHBhcmFtIG9wdGlvbnM6IG9wdGlvbnNcbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ29tcGFyZVJlbmRlcmVyKG9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwSW1hZ2VTdWJsYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IGV4dHJhcyA9IHNhdmVFeHRyYVZpc1ZhcnMoZ2V0UmVuZGVyZXIobGF5ZXIpKTtcbiAgICByZXR1cm4gbW9kdWxlcy5Db2xvckNyZWF0b3IuY3JlYXRlQ29udGludW91c1JlbmRlcmVyKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIGZpZWxkOiBvcHRpb25zLmZpZWxkSW5mb3NbMF0uZmllbGQsXG4gICAgICAgIHRoZW1lOiBcImFib3ZlLWFuZC1iZWxvd1wiLFxuICAgICAgICBjb2xvclNjaGVtZTogZmluZENvbG9yU2NoZW1lKFwiYWJvdmUtYW5kLWJlbG93XCIpLFxuICAgICAgICBub3JtYWxpemF0aW9uRmllbGQ6IG9wdGlvbnMuZmllbGRJbmZvc1sxXS5maWVsZCxcbiAgICAgICAgb3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWQ6IG1hcEltYWdlU3VibGF5ZXJcbiAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgIDogaXNEZWZpbmVkKG9wdGlvbnMub3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWQpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkXG4gICAgICAgICAgICAgICAgOiBpc1BvbHlnb25UeXBlKGxheWVyKSxcbiAgICAgICAgc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQ6IG1hcEltYWdlU3VibGF5ZXJcbiAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgIDogaXNEZWZpbmVkKG9wdGlvbnMuc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLnNpemVPcHRpbWl6YXRpb25FbmFibGVkXG4gICAgICAgICAgICAgICAgOiB0cnVlLFxuICAgICAgICBsZWdlbmRPcHRpb25zOiBvcHRpb25zLmxlZ2VuZE9wdGlvbnMsXG4gICAgICAgIGRlZmF1bHRTeW1ib2xFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgZm9yQmlubmluZzogKChfYSA9IGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCJcbiAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgY29uc3QgY29sb3JBdXRoVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIFwiY29sb3JcIikgfHwge307XG4gICAgICAgIGNvbG9yQXV0aFZpc1Zhci5zdHlsZSA9IFwicmF0aW9cIjsgLy8gXCJyYXRpb1wiLCBcInBlcmNlbnRcIiwgXCJwZXJjZW50LW9mLXRvdGFsXCJcbiAgICAgICAgYXBwbHlFeHRyYVZpc1ZhcnMoZXh0cmFzLCByZXN1bHQucmVuZGVyZXIpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgfSwgKGVycm9yKSA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgQ29tcGFyZSByZW5kZXJlciB3aXRoIHNldHRpbmdzIGZyb20gY3VycmVudCByZW5kZXJlclxuICogQHBhcmFtIHByb3BzOiBvbmx5IGNvbnRhaW5zIHByb3BlcnRpZXMgdGhhdCBuZWVkIHRvIGJlIG92ZXJ3cml0dGVuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUNvbXBhcmVSZW5kZXJlckZyb21FeGlzdGluZyhvcHRpb25zKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICBpZiAoY29sb3JWaXNWYXIgJiZcbiAgICAgICAgb3B0aW9ucy5maWVsZEluZm8gJiZcbiAgICAgICAgb3B0aW9ucy5maWVsZEluZm8uZmllbGQgPT0gY29sb3JWaXNWYXIuZmllbGQgJiZcbiAgICAgICAgb3B0aW9ucy5ub3JtYWxpemF0aW9uRmllbGQgPT09IGNvbG9yVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZCkge1xuICAgICAgICAvLyBubyBjaGFuZ2VzIHRvIGZpZWxkc1xuICAgICAgICBkZWxldGUgb3B0aW9ucy5maWVsZEluZm9zO1xuICAgICAgICBpZiAoaXNFbXB0eShvcHRpb25zKSkge1xuICAgICAgICAgICAgLy8gbm90aGluZyByZWFsbHkgY2hhbmdlc1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IHJlbmRlcmVyOiByZW5kZXJlci5jbG9uZSgpIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgY29uc3QgZXh0cmFzID0gc2F2ZUV4dHJhVmlzVmFycyhyZW5kZXJlcik7XG4gICAgbGV0IGZpZWxkSW5mbyA9IG9wdGlvbnMuZmllbGRJbmZvc1xuICAgICAgICA/IG9wdGlvbnMuZmllbGRJbmZvc1swXVxuICAgICAgICA6IGNvbG9yVmlzVmFyXG4gICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICBmaWVsZDogY29sb3JWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogY29sb3JWaXNWYXIudmFsdWVFeHByZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogY29sb3JWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IHJlbmRlcmVyLmZpZWxkLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHJlbmRlcmVyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IHJlbmRlcmVyLnZhbHVlRXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgICAgIH07XG4gICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gb3B0aW9ucy5ub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgPyBvcHRpb25zLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICA6IGNvbG9yVmlzVmFyXG4gICAgICAgICAgICA/IGNvbG9yVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgOiByZW5kZXJlci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgY29uc3Qgc3ltYm9sID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zICYmIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGggPyByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3NbMF0uc3ltYm9sIDogbnVsbDtcbiAgICBjb25zdCBkZWZhdWx0U3ltYm9sID0gcmVuZGVyZXIuZGVmYXVsdFN5bWJvbDtcbiAgICBjb25zdCBkZWZhdWx0TGFiZWwgPSByZW5kZXJlci5kZWZhdWx0TGFiZWw7XG4gICAgbGV0IG5lZWROZXdTdGF0aXN0aWNzID0gZmFsc2U7XG4gICAgaWYgKG9wdGlvbnMubm9ybWFsaXphdGlvbkZpZWxkID09PSBudWxsIHx8IG9wdGlvbnMubm9ybWFsaXphdGlvbkZpZWxkIHx8IG9wdGlvbnMuZmllbGRJbmZvKSB7XG4gICAgICAgIG5lZWROZXdTdGF0aXN0aWNzID0gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgbWluVmFsdWUgPSBvcHRpb25zLmRpc2NhcmRNaW5NYXhcbiAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgOiBpc0RlZmluZWQob3B0aW9ucy5taW4pXG4gICAgICAgICAgICA/IG9wdGlvbnMubWluXG4gICAgICAgICAgICA6IG5lZWROZXdTdGF0aXN0aWNzXG4gICAgICAgICAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICA6IGF1dGhDb2xvclZpc1ZhclxuICAgICAgICAgICAgICAgICAgICA/IGF1dGhDb2xvclZpc1Zhci5taW5TbGlkZXJWYWx1ZVxuICAgICAgICAgICAgICAgICAgICA6IHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5taW5WYWx1ZTtcbiAgICBjb25zdCBtYXhWYWx1ZSA9IG9wdGlvbnMuZGlzY2FyZE1pbk1heFxuICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICA6IGlzRGVmaW5lZChvcHRpb25zLm1heClcbiAgICAgICAgICAgID8gb3B0aW9ucy5tYXhcbiAgICAgICAgICAgIDogbmVlZE5ld1N0YXRpc3RpY3NcbiAgICAgICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIDogYXV0aENvbG9yVmlzVmFyXG4gICAgICAgICAgICAgICAgICAgID8gYXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlXG4gICAgICAgICAgICAgICAgICAgIDogcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zW3JlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcy5sZW5ndGggLSAxXS5tYXhWYWx1ZTtcbiAgICByZXR1cm4gbW9kdWxlcy5Db2xvckNyZWF0b3IuY3JlYXRlQ29udGludW91c1JlbmRlcmVyKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIGZpZWxkOiBmaWVsZEluZm8gPyBmaWVsZEluZm8uZmllbGQgOiByZW5kZXJlci5maWVsZCxcbiAgICAgICAgdGhlbWU6IFwiYWJvdmUtYW5kLWJlbG93XCIsXG4gICAgICAgIGNvbG9yU2NoZW1lOiBmaW5kQ29sb3JTY2hlbWUoXCJhYm92ZS1hbmQtYmVsb3dcIiksXG4gICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZCxcbiAgICAgICAgbWluVmFsdWUsXG4gICAgICAgIG1heFZhbHVlLFxuICAgICAgICBvdXRsaW5lT3B0aW1pemF0aW9uRW5hYmxlZDogbWFwSW1hZ2VTdWJsYXllclxuICAgICAgICAgICAgPyBmYWxzZVxuICAgICAgICAgICAgOiBpc0RlZmluZWQob3B0aW9ucy5vdXRsaW5lT3B0aW1pemF0aW9uRW5hYmxlZClcbiAgICAgICAgICAgICAgICA/IG9wdGlvbnMub3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWRcbiAgICAgICAgICAgICAgICA6ICEhZXh0cmFzLnNpemVPdXRsaW5lVmlzVmFyLFxuICAgICAgICBzaXplT3B0aW1pemF0aW9uRW5hYmxlZDogbWFwSW1hZ2VTdWJsYXllclxuICAgICAgICAgICAgPyBmYWxzZVxuICAgICAgICAgICAgOiBpc0RlZmluZWQob3B0aW9ucy5zaXplT3B0aW1pemF0aW9uRW5hYmxlZClcbiAgICAgICAgICAgICAgICA/IG9wdGlvbnMuc2l6ZU9wdGltaXphdGlvbkVuYWJsZWRcbiAgICAgICAgICAgICAgICA6ICEhZXh0cmFzLnNpemVBdXRvVmlzVmFyLFxuICAgICAgICBsZWdlbmRPcHRpb25zOiAoKF9hID0gb3B0aW9ucy5sZWdlbmRPcHRpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9KU09OKCkpIHx8XG4gICAgICAgICAgICAoKF9iID0gY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b0pTT04oKSkgfHxcbiAgICAgICAgICAgICgoX2MgPSByZW5kZXJlci5sZWdlbmRPcHRpb25zKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudG9KU09OKCkpLFxuICAgICAgICBkZWZhdWx0U3ltYm9sRW5hYmxlZDogaXNEZWZpbmVkKG9wdGlvbnMuZGVmYXVsdFN5bWJvbEVuYWJsZWQpXG4gICAgICAgICAgICA/IG9wdGlvbnMuZGVmYXVsdFN5bWJvbEVuYWJsZWRcbiAgICAgICAgICAgIDogISFyZW5kZXJlci5kZWZhdWx0U3ltYm9sLFxuICAgICAgICBmb3JCaW5uaW5nOiAoKF9kID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAvLyByZXNldCBoYW5kbGVzIGlmIG5lY2Vzc2FyeVxuICAgICAgICBpZiAob3B0aW9ucy5kaXNjYXJkTWluTWF4KSB7XG4gICAgICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4gKHN0b3AudmFsdWUgPSBuZXdDb2xvclZpc1Zhci5zdG9wc1tpZHhdLnZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sb3JBdXRoVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIFwiY29sb3JcIikgfHwge307XG4gICAgICAgIGNvbG9yQXV0aFZpc1Zhci5zdHlsZSA9IFwicmF0aW9cIjtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImNyZWF0ZUNvbnRpbnVvdXNSZW5kZXJlclwiLCByZXN1bHQpO1xuICAgICAgICBhcHBseUV4dHJhVmlzVmFycyhleHRyYXMsIHJlc3VsdC5yZW5kZXJlcik7XG4gICAgICAgIGlmIChzeW1ib2wgJiYgcmVzdWx0LnJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvcyAmJiByZXN1bHQucmVuZGVyZXIuY2xhc3NCcmVha0luZm9zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5zeW1ib2wgPSBzeW1ib2w7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlZmF1bHRTeW1ib2wpIHtcbiAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5kZWZhdWx0U3ltYm9sID0gZGVmYXVsdFN5bWJvbDtcbiAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5kZWZhdWx0TGFiZWwgPSBkZWZhdWx0TGFiZWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgIH0sIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbn1cblxuZXhwb3J0IHsgY3JlYXRlQ29tcGFyZVJlbmRlcmVyRnJvbUV4aXN0aW5nIGFzIGEsIGNyZWF0ZUNvbXBhcmVSZW5kZXJlciBhcyBjIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbXBhcmUtYmExMjkyZmUuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlLCBoIGFzIGdldFJlbmRlcmVyLCBnIGFzIGdldFJlbmRlcmVyVHlwZSwgViBhcyBmaW5kSGVhdG1hcFNjaGVtZSwgTyBhcyBhZGRGaWVsZHNUb091dEZpZWxkcyB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBsYXllciB3aXRoIGEgSGVhdG1hcCByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqIEBwYXJhbSBwcm9wczogbXVzdCBjb250YWluIGxheWVyLCBtYXBWaWV3LCBHYWxsZXJ5RmllbGRzW11cbiAqIEBwYXJhbSBvcHRpb25zOiBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUhlYXRtYXBSZW5kZXJlcihvcHRpb25zKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImhlYXRtYXBcIikge1xuICAgICAgICBvcHRpb25zLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzIHx8IHJlbmRlcmVyLnJhZGl1cztcbiAgICAgICAgb3B0aW9ucy5oZWF0bWFwU2NoZW1lID0gb3B0aW9ucy5oZWF0bWFwU2NoZW1lIHx8IGZpbmRIZWF0bWFwU2NoZW1lKCk7XG4gICAgfVxuICAgIGlmICgoX2EgPSBvcHRpb25zLmZpZWxkSW5mb3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHtcbiAgICAgICAgYWRkRmllbGRzVG9PdXRGaWVsZHMoW29wdGlvbnMuZmllbGRJbmZvc1swXS5maWVsZF0pO1xuICAgIH1cbiAgICByZXR1cm4gbW9kdWxlcy5IZWF0bWFwQ3JlYXRvci5jcmVhdGVSZW5kZXJlcih7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICBmaWVsZDogb3B0aW9ucy5maWVsZEluZm9zICYmIG9wdGlvbnMuZmllbGRJbmZvcy5sZW5ndGggPyBvcHRpb25zLmZpZWxkSW5mb3NbMF0uZmllbGQgOiBudWxsLFxuICAgICAgICByYWRpdXM6IG9wdGlvbnMucmFkaXVzIHx8IDEwLFxuICAgICAgICBoZWF0bWFwU2NoZW1lOiBvcHRpb25zLmhlYXRtYXBTY2hlbWUgfHwgdW5kZWZpbmVkXG4gICAgfSk7XG59XG4vKipcbiAqIFVwZGF0ZXMgdGhlIEhlYXRtYXAgcmVuZGVyZXIgd2l0aCBhIG5ldyBmYWRlUmF0aW9cbiAqIEBwYXJhbSBwcm9wczogbXVzdCBjb250YWluIGxheWVyLCBtYXBWaWV3LCBHYWxsZXJ5RmllbGRzW11cbiAqIEBwYXJhbSBmYWRlUmF0aW86IG5ldyB2YWx1ZVxuICovXG5mdW5jdGlvbiB1cGRhdGVIZWF0bWFwUmVuZGVyZXJ3aXRoRmFkZShmYWRlUmF0aW8pIHtcbiAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICByZXR1cm4gbW9kdWxlcy5IZWF0bWFwQ3JlYXRvci51cGRhdGVSZW5kZXJlcih7XG4gICAgICAgIHJlbmRlcmVyLFxuICAgICAgICBmYWRlUmF0aW9cbiAgICB9KTtcbn1cbi8qKlxuICogVXBkYXRlcyB0aGUgbGF5ZXIgd2l0aCBhIG5ldyByYWRpdXNcbiAqIEBwYXJhbSBwcm9wczogbXVzdCBjb250YWluIGxheWVyLCBtYXBWaWV3LCBHYWxsZXJ5RmllbGRzW11cbiAqIEBwYXJhbSBvcHRpb25zOiBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZVdpdGhIZWF0bWFwU3RhdGlzdGljcyhvcHRpb25zKSB7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIC8vIHdvcmthcm91bmQgZm9yOiBUaGlzIGV4cHJlc3Npb24gaXMgbm90IGNhbGxhYmxlLiBUeXBlICdoZWF0bWFwU3RhdGlzdGljcycgaGFzIG5vIGNhbGwgc2lnbmF0dXJlcy50cygyMzQ5KVxuICAgIC8vY29uc3QgX2hlYXRtYXBTdGF0aXN0aWNzOiBhbnkgPSBtb2R1bGVzLmhlYXRtYXBTdGF0aXN0aWNzO1xuICAgIHJldHVybiBtb2R1bGVzXG4gICAgICAgIC5oZWF0bWFwU3RhdGlzdGljcyh7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICBmaWVsZDogcmVuZGVyZXIuZmllbGQsXG4gICAgICAgIHJhZGl1czogb3B0aW9ucy5yYWRpdXMgfHwgcmVuZGVyZXIucmFkaXVzIHx8IDEwXG4gICAgfSlcbiAgICAgICAgLnRoZW4oKHN0YXRpc3RpY3MpID0+IHtcbiAgICAgICAgcmVuZGVyZXIubWluRGVuc2l0eSA9IHN0YXRpc3RpY3MubWluO1xuICAgICAgICByZW5kZXJlci5tYXhEZW5zaXR5ID0gc3RhdGlzdGljcy5tYXg7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc3RhdGlzdGljcyk7XG4gICAgfSwgKGVycm9yKSA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xufVxuXG5leHBvcnQgeyB1cGRhdGVXaXRoSGVhdG1hcFN0YXRpc3RpY3MgYXMgYSwgY3JlYXRlSGVhdG1hcFJlbmRlcmVyIGFzIGMsIHVwZGF0ZUhlYXRtYXBSZW5kZXJlcndpdGhGYWRlIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aGVhdG1hcC03NWZmZDQ1Mi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgYXBwbHlFeHRyYVZpc1ZhcnMsIHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIG0gYXMgc2F2ZUV4dHJhVmlzVmFycywgaCBhcyBnZXRSZW5kZXJlciwgYSBhcyBnZXRWaXNWYXIgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGkgYXMgaXNEZWZpbmVkIH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIGxheWVyIHdpdGggYSBTaW1wbGUgcmVuZGVyZXIgd2l0aCBkZWZhdWx0IHNldHRpbmdzXG4gKiBAcGFyYW0gb3B0aW9uczogb3B0aW9uc1xuICovXG5mdW5jdGlvbiBjcmVhdGVTaW1wbGVSZW5kZXJlcihvcHRpb25zKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBjb25zdCBleHRyYXMgPSBzYXZlRXh0cmFWaXNWYXJzKGdldFJlbmRlcmVyKGxheWVyKSk7XG4gICAgcmV0dXJuIG1vZHVsZXMuTG9jYXRpb25DcmVhdG9yLmNyZWF0ZVJlbmRlcmVyKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIG91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkOiBtYXBJbWFnZVN1YmxheWVyXG4gICAgICAgICAgICA/IGZhbHNlXG4gICAgICAgICAgICA6IGlzRGVmaW5lZChvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkKVxuICAgICAgICAgICAgICAgID8gb3B0aW9ucy5vdXRsaW5lT3B0aW1pemF0aW9uRW5hYmxlZFxuICAgICAgICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQ6IG1hcEltYWdlU3VibGF5ZXJcbiAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgIDogaXNEZWZpbmVkKG9wdGlvbnMuc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQpXG4gICAgICAgICAgICAgICAgPyBvcHRpb25zLnNpemVPcHRpbWl6YXRpb25FbmFibGVkXG4gICAgICAgICAgICAgICAgOiB0cnVlLFxuICAgICAgICBmb3JCaW5uaW5nOiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBhcHBseUV4dHJhVmlzVmFycyhleHRyYXMsIHJlc3VsdC5yZW5kZXJlcik7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICB9LCAoZXJyb3IpID0+IFByb21pc2UucmVqZWN0KGVycm9yKSk7XG59XG5mdW5jdGlvbiBidWlsZE91dGxpbmVWaXNWYXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIFRPRE8gLSBjYW4gd2UganVzdCBnZXQgdGhlIHZpc3VhbFZhcmlhYmxlIHdpdGhvdXQgYSBmdWxsIHJlbmRlcmVyP1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICByZXR1cm4gbW9kdWxlcy5Mb2NhdGlvbkNyZWF0b3IuY3JlYXRlUmVuZGVyZXIoe1xuICAgICAgICBsYXllcixcbiAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgb3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGZvckJpbm5pbmc6ICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNpemVPdXRsaW5lVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIsIFwib3V0bGluZVwiKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzaXplT3V0bGluZVZpc1Zhcik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBidWlsZFNpemVBdXRvVmlzVmFyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyLCBtYXBWaWV3LCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgcmV0dXJuIG1vZHVsZXMuTG9jYXRpb25DcmVhdG9yLmNyZWF0ZVJlbmRlcmVyKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIG91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkOiBmYWxzZSxcbiAgICAgICAgc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGZvckJpbm5pbmc6ICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIGNvbnN0IHNpemVBdXRvVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIsIFwiYXV0b1wiKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzaXplQXV0b1Zpc1Zhcik7XG4gICAgfSk7XG59XG5cbmV4cG9ydCB7IGJ1aWxkT3V0bGluZVZpc1ZhciBhcyBhLCBidWlsZFNpemVBdXRvVmlzVmFyIGFzIGIsIGNyZWF0ZVNpbXBsZVJlbmRlcmVyIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYXRpb24tZTI2YjUzOWYuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9