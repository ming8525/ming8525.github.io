"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-927c7f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-label_3.entry.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-label_3.entry.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_label: () => (/* binding */ ArcgisLabel),
/* harmony export */   arcgis_label_content: () => (/* binding */ ArcgisLabelContent),
/* harmony export */   arcgis_label_content_style: () => (/* binding */ ArcgisLabelContentStyle)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./labelStore-27fe3cde.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-27fe3cde.js");
/* harmony import */ var _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./fontUtil-bbe5d03d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/fontUtil-bbe5d03d.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */












const CSS$1 = {
    enableLabel: "enable-label",
    enableLabelLabel: "enable-label-label",
    labelSwitch: "label-switch",
    componentDiv: "component-ul"
};

const arcgisLabelCss = ".enable-label{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-cap-spacing-half) var(--arcgis-app-cap-spacing-quarter);border-bottom:solid 1px var(--arcgis-app-border)}.enable-label-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.label-switch{margin:0;flex:0 0 0%;justify-self:flex-end}.component-ul{margin:0 0 var(--arcgis-app-cap-spacing);padding:0}";

const ArcgisLabel = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.labelUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelUpdated", 7);
        this.arcgisLabelDismissedChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLabelDismissedChange", 7);
        this.internalLabelUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalLabelUpdated", 7);
        this.closeLabelPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
        this.arcgisFilterDone = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFilterDone", 7);
        this.labelReRender = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelReRender", 7);
        // rendor methods
        this.labelComponent = (uniqueGuid, labelClass, blockOpen) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: uniqueGuid, id: uniqueGuid }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-label-content", { guid: uniqueGuid, labelClass: labelClass, blockOpen: blockOpen, calciteFlowItem: ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFlowItem) ||
                    this.hostElement.shadowRoot.getElementById("labelFlowItem_Id") })));
        };
        this.mapView = undefined;
        this.layer = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.layerDisplayType = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature;
        this.dismissible = false;
        this.hideLayerTitle = false;
        this.calciteFlowProps = null;
        this.labelComponents = [];
        this.reRender = undefined;
    }
    // lifecycle methods
    async componentWillLoad() {
        [this.strings, this.currentLanguage] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.layerGeometryType = await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.h)(this.layer);
        this.serviceType = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.c)(this.layer);
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layer = this.layer;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.mapView = this.mapView;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.portal = this.portal;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.config = this.config;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.strings = this.strings;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.currentLanguage = this.currentLanguage;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layerGeometryType = this.layerGeometryType;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType = this.serviceType;
        _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType = this.layerDisplayType;
        this.labelingInfo =
            this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature
                ? this.layer.labelingInfo
                : this.layer.featureReduction.labelingInfo;
        // temp
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
            this.layer.labelsVisible = this.layer.labelsVisible || false;
        }
        else if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
            this.layer.featureReduction.labelsVisible =
                this.layer.featureReduction.labelsVisible ||
                    false;
        }
        // add for existing
        if (Array.isArray(this.labelingInfo)) {
            this.labelingInfo.forEach((labelClass) => {
                this.addLabelClass(labelClass, this.labelingInfo.length === 1 ? true : false);
            });
        }
    }
    componentDidLoad() {
        var _a;
        this.sortableComponents = this.hostElement.shadowRoot.getElementById("SortableComponents_Id");
        this.calciteFab =
            ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFab) ||
                this.hostElement.shadowRoot.getElementById("addComponentBtn_Id");
        this.enableDisableLabel(this.getLabelEnabledProp());
        this.calciteFab.onclick = async (event) => {
            event.stopPropagation();
            this.closeLabelPopovers.emit();
            const labelClass = await this.getLabelClass();
            if (this.labelingInfo) {
                this.labelingInfo.push(labelClass);
            }
            else {
                this.labelingInfo = [labelClass];
            }
            this.addLabelClass(labelClass, true);
            this.focusLastLabelClass();
        };
        if (this.flowItemNode) {
            requestAnimationFrame(() => this.flowItemNode.setFocus());
        }
    }
    componentDidUpdate() {
        this.internalLabelUpdated.emit();
    }
    // Events
    mainPopupReRenderHandler(event) {
        event.stopPropagation();
        this.reRender = this.reRender ? false : true;
    }
    deleteComponentHandler(event) {
        event.stopPropagation();
        this.closeLabelPopovers.emit();
        // each div has id. Find id, and splice by index
        const allComponents = this.sortableComponents.getElementsByTagName("div");
        for (let x = 0; x < allComponents.length; x++) {
            if (allComponents[x].id === event.detail) {
                this.labelingInfo.splice(x, 1);
                this.labelComponents.splice(x, 1);
                break;
            }
        }
        this.labelReRender.emit();
        this.calciteFab.setFocus();
    }
    duplicateComponentHandler(event) {
        event.stopPropagation();
        this.closeLabelPopovers.emit();
        // each div has id. Find id, and clone
        const allComponents = this.sortableComponents.getElementsByTagName("div");
        for (let x = 0; x < allComponents.length; x++) {
            if (allComponents[x].id === event.detail) {
                const tempLabelClass = this.labelingInfo[x].clone();
                this.labelingInfo.push(tempLabelClass);
                this.addLabelClass(tempLabelClass, true);
                this.focusLastLabelClass();
                break;
            }
        }
    }
    internalLabelUpdatedHandler(event) {
        event.stopPropagation();
        // if event.detail is true, only update external
        if (this.labelingInfo && !event.detail) {
            if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
                this.layer.labelingInfo = [...this.labelingInfo];
            }
            else {
                this.layer.featureReduction.labelingInfo = [
                    ...this.labelingInfo
                ];
            }
        }
        this.labelUpdated.emit();
    }
    disableLabelPanelHandler(event) {
        var _a;
        event.stopPropagation();
        const panel = ((_a = this.calciteFlowProps) === null || _a === void 0 ? void 0 : _a.calciteFlowItem) ||
            this.hostElement.shadowRoot.getElementById("labelFlowItem_Id");
        panel.disabled = event.detail;
    }
    // Public Methods
    async done() {
        this.arcgisFilterDone.emit();
        this.closeLabelPopovers.emit();
    }
    async setFocus() {
        var _a;
        if (this.flowItemNode) {
            this.flowItemNode.setFocus();
        }
        else {
            (_a = this.labelSwitch) === null || _a === void 0 ? void 0 : _a.focus();
        }
    }
    // private methods and properties
    enableDisableLabel(labelBool) {
        // hide rest of the component.
        const labelDiv = this.hostElement.shadowRoot.getElementById("labelDiv_Id");
        labelDiv.style.display = labelBool ? "block" : "none";
        this.calciteFab.style.display = labelBool ? "block" : "none";
        this.closeLabelPopovers.emit();
    }
    getLabelEnabledProp() {
        switch (this.layerDisplayType) {
            case _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature: {
                return this.layer.labelsVisible;
            }
            case _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster: {
                return this.layer.featureReduction
                    .labelsVisible;
            }
            default: {
                return this.layer.labelsVisible;
            }
        }
    }
    addLabelClass(labelClass, blockOpen = false) {
        this.labelComponents = [
            ...this.labelComponents,
            this.labelComponent((0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_3__.g)(), labelClass, blockOpen)
        ];
    }
    async getLabelClass() {
        var _a, _b, _c, _d, _e, _f;
        const [LabelClass, colorUtils, clusterLabelCreator, binLabelCreator] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)([
            "esri/layers/support/LabelClass",
            "esri/views/support/colorUtils",
            "esri/smartMapping/labels/clusters",
            "esri/smartMapping/labels/bins"
        ]);
        // feature or cluster
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
            return new LabelClass(this.defaultLabelProps(this.defaultSymbolProps(await colorUtils.getBackgroundColor(this.mapView), await colorUtils.getBackgroundColorTheme(this.mapView))));
        }
        else if (((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
            return (((_c = (_b = (await binLabelCreator.getLabelSchemes({
                layer: this.layer
            }))) === null || _b === void 0 ? void 0 : _b.primaryScheme) === null || _c === void 0 ? void 0 : _c.labelingInfo[0]) || null);
        }
        else {
            return (((_f = (_e = (await clusterLabelCreator.getLabelSchemes({
                layer: this.layer,
                renderer: (_d = this.layer) === null || _d === void 0 ? void 0 : _d.renderer,
                view: this.mapView
            }))) === null || _e === void 0 ? void 0 : _e.primaryScheme) === null || _f === void 0 ? void 0 : _f.labelingInfo[0]) || null);
        }
    }
    defaultLabelProps(symbolProps) {
        const defaultFieldName = this.defaultLabelField();
        return {
            // autocasts as new LabelClass()
            symbol: {
                type: "text",
                color: symbolProps.fontColor,
                haloColor: symbolProps.haloColor,
                haloSize: symbolProps.haloSize,
                font: {
                    family: symbolProps.fontFamily,
                    size: symbolProps.fontSize
                }
            },
            labelExpressionInfo: this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
                ? {
                    expression: `$feature["${defaultFieldName}"]`
                }
                : this.serviceType !== _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage
                    ? {
                        expression: defaultFieldName
                            ? this.layer.fields.some((field) => {
                                var _a;
                                if (field.name === defaultFieldName) {
                                    return ((_a = field === null || field === void 0 ? void 0 : field.domain) === null || _a === void 0 ? void 0 : _a.type) === "coded-value";
                                }
                            })
                                ? `$feature["${defaultFieldName}"]\nDomainName($feature, "${defaultFieldName}")`
                                : `$feature["${defaultFieldName}"]`
                            : null
                    }
                    : null,
            labelExpression: this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage ? `[${defaultFieldName}]` : null,
            labelPlacement: this.defaultPlacement(),
            maxScale: this.layer.maxScale || 0,
            minScale: this.layer.minScale || 0
        };
    }
    defaultLabelField() {
        let defaultField = null;
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
            // we know we have at least one field
            defaultField = this.layer.featureReduction
                .fields[0].name;
        }
        else if ("displayField" in this.layer &&
            this.layer.displayField &&
            this.layer.fieldsIndex.get(this.layer.displayField)) {
            defaultField = this.layer.displayField;
        }
        else {
            this.layer.fields.find((field) => {
                if (field.type.toLowerCase().includes("string")) {
                    return (defaultField = field.name);
                }
            });
        }
        return defaultField ? defaultField : this.layer.fields[0].name;
    }
    defaultSymbolProps(backgroundColor, backgroundColorTheme) {
        if (backgroundColorTheme === "light") {
            return {
                fontFamily: "Arial",
                fontSize: 13 * 0.75,
                fontColor: "#696969",
                haloColor: "#d3d3d3",
                haloSize: 1
            };
        }
        else if (backgroundColorTheme === "dark") {
            return {
                fontFamily: "Arial",
                fontSize: 13 * 0.75,
                fontColor: "#d3d3d3",
                haloColor: "#696969",
                haloSize: 1
            };
        }
        else {
            return {
                fontFamily: "Arial",
                fontSize: 13 * 0.75,
                fontColor: backgroundColor || "#696969",
                haloColor: "#d3d3d3",
                haloSize: 1 * 0.75
            };
        }
    }
    defaultPlacement() {
        var _a;
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
            ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
            return "always-horizontal";
        }
        else if (this.layerGeometryType === "point" || this.layerGeometryType === "multipoint") {
            return "above-center";
        }
        else if (this.layerGeometryType === "polyline") {
            return "center-along";
        }
        else if (this.layerGeometryType === "polygon") {
            return "always-horizontal";
        }
        else {
            return null;
        }
    }
    focusLastLabelClass() {
        setTimeout(() => requestAnimationFrame(() => {
            const blocks = this.hostElement.shadowRoot.querySelectorAll("arcgis-label-content");
            if (blocks === null || blocks === void 0 ? void 0 : blocks.length) {
                blocks[blocks.length - 1].setFocus();
            }
        }), 200);
    }
    labelSwitchAndContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS$1.enableLabel, alignment: "start", layout: "inline-space-between" }, this.strings.enableLabels, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { ref: (el) => (this.labelSwitch = el), scale: "s", class: CSS$1.labelSwitch, checked: this.getLabelEnabledProp(), onCalciteSwitchChange: (event) => {
                const checked = event.target.checked;
                switch (this.layerDisplayType) {
                    case _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature: {
                        this.layer.labelsVisible = checked;
                        break;
                    }
                    case _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster: {
                        this.layer.featureReduction.labelsVisible = checked;
                        break;
                    }
                    default: {
                        this.layer.labelsVisible = checked;
                    }
                }
                this.enableDisableLabel(checked);
                this.internalLabelUpdated.emit(true);
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "labelDiv_Id" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "SortableComponents_Id", class: CSS$1.componentDiv }, this.labelComponents))));
    }
    render() {
        const addLabelBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-fab", { id: "addComponentBtn_Id", icon: "plus", slot: "fab", scale: "s", appearance: "outline-fill", kind: "neutral", label: this.strings.addLabel, text: this.strings.addLabel, "text-enabled": true }));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { style: this.calciteFlowProps ? {} : { display: "flex", flex: "1 1 auto", overflow: "hidden" } }, this.calciteFlowProps ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement) }, this.labelSwitchAndContent())) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { id: "labelFlowItem_Id", heading: this.strings.labelFeatures, description: !this.hideLayerTitle ? this.layer.title : undefined, closable: this.dismissible, onCalciteFlowItemClose: (event) => {
                event.stopPropagation();
                this.closeLabelPopovers.emit();
                this.arcgisLabelDismissedChange.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.labelSwitchAndContent(), addLabelBtn)))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabel.style = arcgisLabelCss;

const CSS = {
    labelContentButtonSection: "label-content-btn-section",
    labelContentButtonExp: "label-content-btn-exp",
    labelContentButton: "label-content-btn",
    labelContentButtonText: "label-content-btn-text",
    labelContentButtonIcon: "label-content-btn-icon",
    fieldExpressionDiv: "field-expression-div"
};

const arcgisLabelContentCss = ".label-content-btn-section{background-color:var(--arcgis-app-background);min-width:100%}.label-content-btn{background:var(--arcgis-app-background-clear);border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius);display:flex;align-items:center;justify-content:space-between;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter);cursor:pointer;width:100%;text-align:unset;transition:background-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function), border-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function)}.label-content-btn:hover{background-color:var(--arcgis-app-background-hover);border-color:var(--arcgis-app-border-hover)}.label-content-btn-exp{width:calc(100% - 32px)}.label-content-btn-exp .label-content-btn{border:none;border-radius:0;border-right:1px solid var(--arcgis-app-border)}.label-content-btn-text{font-family:var(--arcgis-app-font-family);font-size:var(--arcgis-app-font-size-0);flex:0 1 auto;overflow:hidden;padding:0 var(--arcgis-app-side-spacing-eighth);text-overflow:ellipsis;white-space:nowrap}.label-content-btn-icon{flex:0 0 0%;padding:0 var(--arcgis-app-side-spacing-half)}.field-expression-div{align-items:center;display:flex;justify-content:space-between;width:100%;border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius)}.field-expression-div calcite-action{flex:0 0 auto}#slider_Id{min-width:100%}";

const ArcgisLabelContent = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.closeLabelPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
        this.internalLabelUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalLabelUpdated", 7);
        this.labelContentReRender = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "labelContentReRender", 7);
        this.disableLabelPanel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disableLabelPanel", 7);
        this.defaultScript = "";
        this.aggregationExpressionMapping = new Map();
        this.fieldPickListChanges = async (event) => {
            var _a, _b;
            event.stopPropagation();
            const selectedField = (_b = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) === null || _b === void 0 ? void 0 : _b[0];
            if (selectedField) {
                if (this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage) {
                    this.labelClass.labelExpression = `[${selectedField}]`;
                }
                else {
                    if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
                        if (this.aggregationExpressionMapping.has(selectedField)) {
                            this.labelClass.labelExpressionInfo.expression =
                                this.aggregationExpressionMapping.get(selectedField);
                        }
                        else {
                            for (const [fieldName, expression] of this.aggregationExpressionMapping) {
                                if (fieldName === selectedField) {
                                    this.labelClass.labelExpressionInfo.expression = expression;
                                }
                            }
                        }
                    }
                    else {
                        this.labelClass.labelExpressionInfo = this.layer.fields.some((field) => {
                            var _a;
                            if (field.name === selectedField) {
                                return ((_a = field === null || field === void 0 ? void 0 : field.domain) === null || _a === void 0 ? void 0 : _a.type) === "coded-value";
                            }
                        })
                            ? {
                                expression: `$feature["${selectedField}"]\nDomainName($feature, "${selectedField}")`
                            }
                            : {
                                expression: `$feature["${selectedField}"]`
                            };
                    }
                }
                this.labelContentReRender.emit();
            }
            this.closeLabelPopovers.emit();
        };
        this.guid = undefined;
        this.blockOpen = false;
        this.labelClass = undefined;
        this.calciteFlowItem = undefined;
        this.reRender = undefined;
    }
    // lifecycle methods
    async componentWillLoad() {
        this.layer = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layer;
        this.mapView = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.mapView;
        this.portal = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.portal;
        this.config = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.config;
        this.strings = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.strings;
        this.currentLanguage = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.currentLanguage;
        this.layerDisplayType = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType;
        this.serviceType = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType;
        this.popupTemplate =
            this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature
                ? this.layer.popupTemplate
                : this.layer.featureReduction.popupTemplate;
        this.labelFields = await this.getFieldsForLabeling();
        this.defaultScript = `// ${this.strings.arcadeScriptLine1} \n// ${this.strings.arcadeScriptLine2}\n// $feature.name + " " + $feature.status\n`;
        if (!this.calciteFlowItem) {
            this.calciteFlowItem = this.hostElement.closest("#labelFlowItem_Id");
        }
        // setup mapping for cluster case. We dont want to use default values since there is no formatting.
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
            [this.binLabelCreator, this.clusterLabelCreator] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)([
                "esri/smartMapping/labels/bins",
                "esri/smartMapping/labels/clusters"
            ]);
            const getSchemesForField = async (fieldName) => {
                var _a, _b;
                let labelSchemes;
                if (((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
                    labelSchemes = await this.binLabelCreator.getLabelSchemes({
                        layer: this.layer,
                        field: fieldName
                    });
                }
                else {
                    labelSchemes = await this.clusterLabelCreator.getLabelSchemes({
                        layer: this.layer,
                        renderer: (_b = this.layer) === null || _b === void 0 ? void 0 : _b.renderer,
                        view: this.mapView,
                        field: fieldName
                    });
                }
                const allSchemes = [labelSchemes === null || labelSchemes === void 0 ? void 0 : labelSchemes.primaryScheme, ...labelSchemes === null || labelSchemes === void 0 ? void 0 : labelSchemes.secondarySchemes];
                allSchemes.forEach((clusterScheme) => {
                    var _a, _b, _c;
                    this.aggregationExpressionMapping.set(clusterScheme === null || clusterScheme === void 0 ? void 0 : clusterScheme.fieldName, (_c = (_b = (_a = clusterScheme === null || clusterScheme === void 0 ? void 0 : clusterScheme.labelingInfo) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.expression);
                });
            };
            const calls = [];
            this.labelFields.forEach((field) => {
                calls.push(getSchemesForField(field.name));
            });
            await Promise.all(calls);
        }
    }
    componentDidLoad() {
        this.addScaleRangeSlider();
    }
    componentDidUpdate() {
        this.internalLabelUpdated.emit();
    }
    disconnectedCallback() {
        if (this.arcgisFieldPickList) {
            document.body.removeChild(this.arcgisFieldPickList);
        }
        if (this.labelStyle) {
            document.body.removeChild(this.labelStyle);
        }
        if (this.popoverRenameForm) {
            document.body.removeChild(this.popoverRenameForm);
        }
        if (this.labelFilter) {
            document.body.removeChild(this.labelFilter);
        }
    }
    async setFocus() {
        if (this.blockOpen) {
            this.blockOptions.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
            this.blockOptions.setFocus();
        }
    }
    // Events
    calciteBlockToggleHandler() {
        this.closeLabelPopovers.emit();
    }
    labelContentReRenderHandler(event) {
        event.stopPropagation();
        this.reRender = this.reRender ? false : true;
    }
    closeLabelPopoversHandler() {
        if (this.arcgisFieldPickList) {
            document.body.removeChild(this.arcgisFieldPickList);
            this.arcgisFieldPickList = null;
            this.attributesBtn.focus();
        }
        if (this.labelStyle) {
            document.body.removeChild(this.labelStyle);
            this.labelStyle = null;
            this.styleBtn.focus();
        }
        if (this.popoverRenameForm) {
            document.body.removeChild(this.popoverRenameForm);
            this.popoverRenameForm = null;
            this.blockOptions.setFocus();
        }
        if (this.labelFilter) {
            document.body.removeChild(this.labelFilter);
            this.labelFilter = null;
            this.filterBtn.focus();
        }
        this.disableLabelPanel.emit(false);
    }
    notifySymbolChangesHandler(event) {
        if (this.guid === event.detail) {
            event.stopPropagation();
            this.labelContentReRender.emit();
        }
    }
    notifyFilterUpdatedHandler(event) {
        if (this.guid === event.detail) {
            event.stopPropagation();
            this.labelContentReRender.emit();
        }
    }
    renameComponentHandler(event) {
        if (this.guid === event.detail) {
            this.closeLabelPopovers.emit();
            event.stopPropagation();
            if (!this.popoverRenameForm) {
                this.popoverRenameForm = document.createElement("arcgis-popover-rename-form");
                this.popoverRenameForm.guid = this.guid;
                this.popoverRenameForm.refElement = this.hostElement;
                this.popoverRenameForm.popoverPanelWidth = this.hostElement.getBoundingClientRect().width;
                this.popoverRenameForm.intlRenameHeader = this.strings.popoverRenameHeader;
                this.popoverRenameForm.intlOk = this.strings.ok;
                this.popoverRenameForm.intlCancel = this.strings.cancel;
                this.popoverRenameForm.intlClose = this.strings.close;
                this.popoverRenameForm.inputValue =
                    this.labelClass.name || this.getDisplayFieldName() || this.strings.label;
                document.body.appendChild(this.popoverRenameForm);
                this.disableLabelPanel.emit(true);
            }
        }
    }
    popoverRenameFormEventHandler(event) {
        if (this.guid === event.detail[0]) {
            event.stopPropagation();
            this.closeLabelPopovers.emit();
            if (event.detail[1]) {
                this.labelClass.name = event.detail[1];
                this.labelContentReRender.emit();
            }
        }
    }
    // private methods and properties
    // lookup popupinfo for alias
    async getFieldsForLabeling() {
        var _a;
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature) {
            const layerFields = await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.j)(this.layer);
            if ((_a = this.popupTemplate) === null || _a === void 0 ? void 0 : _a.fieldInfos) {
                let fieldsWithAlias = [];
                layerFields
                    .filter((layerField) => [
                    "string",
                    "small-integer",
                    "big-integer",
                    "integer",
                    "single",
                    "double",
                    "long",
                    "date",
                    "date-only",
                    "time-only",
                    "timestamp-offset",
                    "oid",
                    "guid",
                    "global-id"
                ].indexOf(layerField.type) > -1)
                    .forEach((layerField) => {
                    fieldsWithAlias = [...fieldsWithAlias, layerField.clone()];
                    this.popupTemplate.fieldInfos.find((popupField) => {
                        if (popupField.fieldName === layerField.name) {
                            fieldsWithAlias[fieldsWithAlias.length - 1].alias = popupField.label;
                        }
                    });
                });
                return fieldsWithAlias;
            }
            else {
                return layerFields;
            }
        }
        else {
            return (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.k)(this.popupTemplate, false);
        }
    }
    // open popover
    async openAttributesList() {
        // close first since we can have multiple attributes open
        this.closeLabelPopovers.emit();
        this.calciteFlowItem.loading = true;
        // lazy load attribute selection component
        if (!this.arcgisFieldPickList) {
            this.arcgisFieldPickList = document.createElement("arcgis-field-pick-list");
            this.arcgisFieldPickList.popoverProps = {
                refElement: this.calciteFlowItem,
                offsetSkidding: 50
            };
            this.arcgisFieldPickList.fields = this.labelFields;
            this.arcgisFieldPickList.layer = this.layer;
            this.arcgisFieldPickList.mapView = this.mapView;
            this.arcgisFieldPickList.showFieldInfo =
                this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.feature;
            this.arcgisFieldPickList.selectedFields =
                [this.labelClass.getLabelExpressionSingleField()] || 0 ||
                    0;
            this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed", this.fieldPickListChanges);
            document.body.appendChild(this.arcgisFieldPickList);
            this.disableLabelPanel.emit(true);
        }
        this.calciteFlowItem.loading = false;
    }
    // get fieldname from cluster expression
    getFieldNameFromAggregationExpression() {
        var _a, _b;
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
            for (const [fieldName, expression] of this.aggregationExpressionMapping) {
                if (expression === ((_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.labelExpressionInfo) === null || _b === void 0 ? void 0 : _b.expression)) {
                    return fieldName;
                }
            }
        }
    }
    // open popover
    openLabelStyle() {
        // close first since we can have multiple attributes open
        this.closeLabelPopovers.emit();
        // lazy load attribute selection component
        if (!this.labelStyle) {
            this.labelStyle = document.createElement("arcgis-label-content-style");
            this.labelStyle.guid = this.guid;
            this.labelStyle.labelContentRefElement = this.calciteFlowItem;
            this.labelStyle.labelClass = this.labelClass;
            document.body.appendChild(this.labelStyle);
            this.disableLabelPanel.emit(true);
        }
    }
    async openArcadeEditor() {
        var _a, _b, _c;
        this.closeLabelPopovers.emit();
        if (!this.arcadeEditor) {
            this.calciteFlowItem.disabled = true;
            this.arcadeEditor = document.createElement("arcgis-modal-arcade");
            this.arcadeEditor.arcadeScript = ((_a = this.labelClass.labelExpressionInfo) === null || _a === void 0 ? void 0 : _a.expression) || "";
            this.arcadeEditor.arcadeProfile = this.getArcadeProfile();
            this.arcadeEditor.testData = await this.getArcadeTestData();
            this.arcadeEditor.addExistingExpressions = true;
            this.arcadeEditor.layer = this.layer;
            this.arcadeEditor.arcadeTitle =
                ((_b = this.labelClass.labelExpressionInfo) === null || _b === void 0 ? void 0 : _b.title) || this.strings.newExpression;
            this.arcadeEditor.arcadeTitleEditable = true;
            this.arcadeEditor.returnPredictOutputType = false;
            this.arcadeEditor.arcadeTitleEditingEnabled = !((_c = this.labelClass.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.title);
            document.body.appendChild(this.arcadeEditor);
            this.arcadeEditor.addEventListener("arcgisModalArcadeClose", (event) => this.arcadeSetup(event.detail));
        }
    }
    async arcadeSetup(arcadeObject) {
        var _a;
        if (arcadeObject) {
            if ((_a = this.labelClass.labelExpressionInfo) === null || _a === void 0 ? void 0 : _a.expression) {
                this.labelClass.labelExpressionInfo.expression = arcadeObject.script;
                this.labelClass.labelExpressionInfo.title = arcadeObject.title;
            }
            else {
                this.labelClass.labelExpressionInfo = {
                    expression: arcadeObject.script,
                    title: arcadeObject.title
                };
            }
            this.labelContentReRender.emit();
        }
        this.calciteFlowItem.disabled = false;
        document.body.removeChild(this.arcadeEditor);
        this.arcadeEditor = null;
        this.arcadeBtn.setFocus();
    }
    getArcadeProfile() {
        return {
            id: "labeling",
            definitions: {
                $feature: this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
                    ? { fields: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.k)(this.popupTemplate, false) }
                    : this.layer
            }
        };
    }
    async getArcadeTestData() {
        try {
            if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster) {
                return {
                    profileVariableInstances: {
                        $feature: await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.l)(this.mapView, this.layer, this.popupTemplate)
                    },
                    spatialReference: this.mapView.spatialReference,
                    timeZone: this.mapView.timeZone
                };
            }
            let url;
            if (this.layer.type === "subtype-sublayer") {
                url = this.layer.parent.url;
            }
            else {
                url = this.layer.url;
            }
            return {
                profileVariableInstances: {
                    $feature: (await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.m)(this.layer, this.mapView)).features[0],
                    $layer: this.layer,
                    $map: this.mapView.map,
                    $datastore: url
                },
                spatialReference: this.mapView.spatialReference,
                timeZone: this.mapView.timeZone
            };
        }
        catch (error) {
            console.log(error);
        }
    }
    getDisplayFieldName() {
        const labelFieldName = this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster
            ? this.getFieldNameFromAggregationExpression()
            : this.labelClass.getLabelExpressionSingleField();
        const tempField = this.labelFields.find((field) => {
            if (field.name === labelFieldName) {
                return field;
            }
        });
        return (tempField === null || tempField === void 0 ? void 0 : tempField.alias) || labelFieldName;
    }
    // rendor methods
    addScaleRangeSlider() {
        const { labelClass } = this;
        (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/widgets/ScaleRangeSlider"]).then(([ScaleRangeSlider]) => {
            var _a, _b;
            const sliderElement = this.hostElement.shadowRoot.getElementById("slider_Id");
            const scaleRangeSlider = new ScaleRangeSlider({
                view: this.mapView,
                region: ((_a = this.portal) === null || _a === void 0 ? void 0 : _a.region) || ((_b = this.portal) === null || _b === void 0 ? void 0 : _b.getRegion().toLowerCase()) || "wo",
                minScale: labelClass.minScale || 0,
                maxScale: labelClass.maxScale || 0
            }, sliderElement);
            sliderElement.insertAdjacentHTML("afterbegin", `<link rel="stylesheet" href="${this.config.jsapiUrl}/themes/light/main.css" />`);
            scaleRangeSlider.watch(["minScale", "maxScale"], (value, _oldValue, name) => {
                if (name === "minScale") {
                    labelClass.minScale = value;
                }
                else if (name === "maxScale") {
                    labelClass.maxScale = value;
                }
                this.closeLabelPopovers.emit();
                this.labelContentReRender.emit();
            });
        });
    }
    render() {
        var _a, _b, _c;
        const { blockOpen, guid, strings } = this;
        const allowExpressions = this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.feature ||
            (this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage &&
                ((_b = (_a = this.layer.layer.capabilities) === null || _a === void 0 ? void 0 : _a.exportMap) === null || _b === void 0 ? void 0 : _b.supportsArcadeExpressionForLabeling));
        const labelAttributeBlock = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.labelAttribute, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.fieldExpressionDiv }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: allowExpressions ? CSS.labelContentButtonExp : CSS.labelContentButtonSection }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.attributesBtn = el), class: CSS.labelContentButton, title: strings.field, onClick: (event) => {
                event.stopPropagation();
                this.openAttributesList();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, this.getDisplayFieldName() ||
            ((_c = this.labelClass.labelExpressionInfo) === null || _c === void 0 ? void 0 : _c.title) ||
            strings.newExpression), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" })))), allowExpressions && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { ref: (el) => (this.arcadeBtn = el), scale: "s", text: strings.expression, onClick: (event) => {
                event.stopPropagation();
                this.openArcadeEditor();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "code" }))))));
        const labelFilterBlock = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.filter, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.labelContentButtonSection }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.filterBtn = el), class: CSS.labelContentButton, title: strings.editLabelFilter, onClick: (event) => {
                event.stopPropagation();
                this.closeLabelPopovers.emit();
                if (!this.labelFilter) {
                    this.labelFilter = document.createElement("arcgis-label-content-filter");
                    this.labelFilter.guid = this.guid;
                    this.labelFilter.labelFilterRefElement = this.calciteFlowItem;
                    this.labelFilter.labelClass = this.labelClass;
                    document.body.appendChild(this.labelFilter);
                    this.disableLabelPanel.emit(true);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, strings.editLabelFilter), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" }))))));
        const labelStyleBlock = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.labelStyle, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.labelContentButtonSection }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { ref: (el) => (this.styleBtn = el), class: CSS.labelContentButton, title: strings.editLabelStyle, onClick: (event) => {
                event.stopPropagation();
                this.openLabelStyle();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonText }, strings.editLabelStyle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: CSS.labelContentButtonIcon }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" }))))));
        const sliderBlock = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.visibleRange, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "slider_Id" })));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement), heading: this.labelClass.name || this.getDisplayFieldName() || this.strings.label, collapsible: true, open: blockOpen }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "control" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-calcite-block-options", { ref: (el) => (this.blockOptions = el), guid: guid, intlOptions: strings.options, intlDelete: strings.delete, intlDuplicate: strings.duplicate, intlRename: strings.rename, calciteBlockOptions: { hasDelete: true, hasDuplicate: true, hasRename: true } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "icon" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "m", icon: "label" })), labelAttributeBlock, this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.ogcFeature ||
            this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.wfs ||
            this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.subtype
            ? null
            : labelFilterBlock, labelStyleBlock, sliderBlock)));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabelContent.style = arcgisLabelContentCss;

const arcgisLabelContentStyleCss = ".offset-div{align-items:center;display:flex;justify-content:space-between;gap:16px}";

const ArcgisLabelContentStyle = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.closeLabelPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeLabelPopovers", 7);
        this.notifySymbolChanges = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "notifySymbolChanges", 7);
        this.minMaxOffset = {
            minOffsetX: -20,
            minOffsetY: -20,
            maxOffsetX: 20,
            maxOffsetY: 20
        };
        // open font popover
        this.openFontPopover = () => {
            var _a, _b;
            if (!this.arcgisFontPicker) {
                this.panelElement.disabled = true;
                this.arcgisFontPicker = document.createElement("arcgis-font-picker");
                this.arcgisFontPicker.fontMap = this.fontMap;
                this.arcgisFontPicker.font = (_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.font;
                this.arcgisFontPicker.popoverProps = {
                    refElement: this.panelElement
                };
                this.arcgisFontPicker.addEventListener("arcgisFontPickerDismissed", this.closeFontPopver);
                this.arcgisFontPicker.addEventListener("arcgisFontPickerChange", this.changeFont);
                document.body.appendChild(this.arcgisFontPicker);
            }
        };
        this.closeFontPopver = () => {
            if (this.arcgisFontPicker) {
                this.panelElement.disabled = false;
                document.body.removeChild(this.arcgisFontPicker);
                this.arcgisFontPicker = null;
                setTimeout(() => {
                    // doesn't work without timeout
                    this.panelElement.setFocus();
                }, 100);
            }
        };
        this.changeFont = (event) => {
            var _a, _b;
            const font = event === null || event === void 0 ? void 0 : event.detail;
            const labelClassFont = (_b = (_a = this.labelClass) === null || _a === void 0 ? void 0 : _a.symbol) === null || _b === void 0 ? void 0 : _b.font;
            if (font && labelClassFont) {
                labelClassFont.family = font.family;
                labelClassFont.weight = font.weight;
                labelClassFont.style = font.style;
            }
            this.reRender = !this.reRender;
            this.notifySymbolChanges.emit(this.guid);
        };
        this.guid = undefined;
        this.labelContentRefElement = undefined;
        this.labelClass = undefined;
        this.isOpen = false;
        this.reRender = false;
    }
    // lifecycle methods
    componentWillLoad() {
        this.layer = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layer;
        this.portal = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.portal;
        this.strings = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.strings;
        this.layerGeometryType = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layerGeometryType;
        this.serviceType = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.serviceType;
        this.layerDisplayType = _labelStore_27fe3cde_js__WEBPACK_IMPORTED_MODULE_7__.l.layerDisplayType;
        this.fontMap =
            this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage ? _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.m : _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.f;
    }
    componentDidLoad() {
        this.isOpen = true;
        // need timeout because of re-render
        setTimeout(() => requestAnimationFrame(() => this.panelElement.setFocus()), 200);
    }
    // Public method
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    // Events
    async calciteBlockSectionToggleHandler(event) {
        event.stopPropagation();
        const composedPath = event.composedPath();
        // halo
        if ((composedPath === null || composedPath === void 0 ? void 0 : composedPath[0].id) === "haloBlock_Id") {
            if (this.labelClass.symbol.haloColor) {
                this.tempHaloColor = this.labelClass.symbol.haloColor;
                this.labelClass.symbol.haloColor = null;
            }
            else {
                await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(async ([Color]) => {
                    var _a;
                    this.labelClass.symbol.haloColor = this.tempHaloColor || new Color("white");
                    this.labelClass.symbol.haloSize = this.labelClass.symbol.haloSize || 1 * 0.75;
                    const haloColorPickerComponent = this.hostElement.shadowRoot.getElementById("haloColorPicker_Id");
                    haloColorPickerComponent.color = ((_a = this.labelClass.symbol.haloColor) === null || _a === void 0 ? void 0 : _a.toHex()) || "#ffffff";
                });
            }
        }
        this.notifySymbolChanges.emit(this.guid);
        this.hostElement.shadowRoot.getElementById("managePopover_Id")["reposition"]();
    }
    // private methods and properties
    getPlacementArray(layerGeometryType) {
        var _a;
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
            ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") {
            return [];
        }
        else if (layerGeometryType === "point" || layerGeometryType === "multipoint") {
            return _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.p;
        }
        else if (layerGeometryType === "polyline") {
            return _fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.a;
        }
        else {
            return [];
        }
    }
    changeOffset(offset) {
        this.labelClass.symbol.xoffset = offset.x;
        this.offsetXElement.value = this.labelClass.symbol.xoffset;
        this.offsetXYSlider.x = offset.x;
        this.labelClass.symbol.yoffset = offset.y;
        this.offsetYElement.value = this.labelClass.symbol.yoffset;
        this.offsetXYSlider.y = -offset.y;
        this.notifySymbolChanges.emit(this.guid);
    }
    // rendor methods
    placementSelection() {
        var _a;
        if (!(this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
            ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning") &&
            (([
                _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.feature,
                _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.csv,
                _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.geojson,
                _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.ogcFeature
            ].indexOf(this.serviceType) > -1 &&
                (this.layerGeometryType === "point" || this.layerGeometryType === "multipoint")) ||
                (this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.s.mapImage &&
                    (this.layerGeometryType === "point" ||
                        this.layerGeometryType === "multipoint" ||
                        this.layerGeometryType === "polyline")))) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.placement, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.strings.placement, onCalciteSelectChange: (event) => {
                    this.labelClass.labelPlacement = event.currentTarget.selectedOption.value;
                    this.notifySymbolChanges.emit(this.guid);
                }, ref: (node) => (this.placementNode = node) }, this.getPlacementArray(this.layerGeometryType).map((placement) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: placement, selected: this.labelClass.labelPlacement === placement ? true : false }, this.strings[placement] || placement))))));
        }
        else {
            return null;
        }
    }
    render() {
        var _a, _b, _c, _d, _e, _f, _g;
        const isBinning = this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__.l.cluster &&
            ((_a = this.layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning";
        const fontFamilySelection = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.font, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", iconEnd: "chevron-down", label: (0,_fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.b)((_c = (_b = this.labelClass) === null || _b === void 0 ? void 0 : _b.symbol) === null || _c === void 0 ? void 0 : _c.font), width: "full", scale: "m", onClick: this.openFontPopover, ref: (node) => (this.fontNode = node) }, (0,_fontUtil_bbe5d03d_js__WEBPACK_IMPORTED_MODULE_8__.b)((_e = (_d = this.labelClass) === null || _d === void 0 ? void 0 : _d.symbol) === null || _e === void 0 ? void 0 : _e.font))));
        const fontSizeSelection = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 5, max: 125, value: `${this.labelClass.symbol.font.size / 0.75 || 5}`, onCalciteInputInput: (event) => {
                this.waitOnUser(event, () => {
                    const node = event.target;
                    this.labelClass.symbol.font.size = Number(node.value) * 0.75;
                    this.notifySymbolChanges.emit(this.guid);
                }, 5);
            } })));
        const offset = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "offset-div" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.offset, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-xy-slider", { ref: (el) => {
                this.offsetXYSlider = el;
            }, x: this.labelClass.symbol.xoffset || 0, y: -this.labelClass.symbol.yoffset || 0, minX: this.minMaxOffset.minOffsetX, minY: this.minMaxOffset.minOffsetY, maxX: this.minMaxOffset.maxOffsetX, maxY: this.minMaxOffset.maxOffsetY, step: 1, snappable: true, onArcgisXYSliderInput: (event) => {
                event.stopPropagation();
                const slider = event.currentTarget;
                this.changeOffset({
                    x: slider.x || 0,
                    y: -slider.y || 0
                });
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, this.strings.offsetX, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", placeholder: this.strings.offsetX, value: `${this.labelClass.symbol.xoffset || 0}`, min: this.minMaxOffset.minOffsetX, max: this.minMaxOffset.maxOffsetX, ref: (element) => {
                this.offsetXElement = element;
            }, onCalciteInputInput: (event) => {
                this.waitOnUser(event, () => {
                    this.changeOffset({
                        x: Number(this.offsetXElement.value) || 0,
                        y: Number(this.offsetYElement.value) || 0
                    });
                }, 0);
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, this.strings.offsetY, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", placeholder: this.strings.offsetY, value: `${this.labelClass.symbol.yoffset || 0}`, min: this.minMaxOffset.minOffsetY, max: this.minMaxOffset.maxOffsetY, ref: (element) => {
                this.offsetYElement = element;
            }, onCalciteInputInput: (event) => {
                this.waitOnUser(event, () => {
                    this.changeOffset({
                        x: Number(this.offsetXElement.value) || 0,
                        y: Number(this.offsetYElement.value) || 0
                    });
                }, 0);
            } })))));
        const allowOverrun = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "start", layout: "inline-space-between" }, this.strings.allowOverrun, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: this.labelClass.allowOverrun, onCalciteSwitchChange: (event) => {
                this.labelClass.allowOverrun = event.target.checked;
                this.notifySymbolChanges.emit(this.guid);
            } })));
        const repeatLabel = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { alignment: "start", layout: "inline-space-between" }, this.strings.repeatLabel, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: this.labelClass.repeatLabel, onCalciteSwitchChange: (event) => {
                this.labelClass.repeatLabel = event.target.checked;
                this.reRender = !this.reRender;
                this.notifySymbolChanges.emit(this.guid);
            } })));
        const repeatLabelDistance = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.labelRepeat, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { disabled: !this.labelClass.repeatLabel, type: "number", scale: "s", min: 0, value: `${this.labelClass.repeatLabelDistance || 0}`, onCalciteInputInput: (event) => {
                this.waitOnUser(event, () => {
                    const node = event.target;
                    this.labelClass.repeatLabelDistance = Number(node.value);
                    this.notifySymbolChanges.emit(this.guid);
                }, 0);
            } })));
        const haloBlock = this.panelElement && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { id: "haloBlock_Id", text: this.strings.halo, toggleDisplay: "switch", open: this.labelClass.symbol.haloColor ? true : false }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { id: "haloColorPicker_Id", color: ((_f = this.labelClass.symbol.haloColor) === null || _f === void 0 ? void 0 : _f.toHex()) || "#ffffff", popoverProps: {
                refElement: this.panelElement,
                placement: "leading-start",
                offsetDistance: -Math.round(this.panelElement.getBoundingClientRect().width),
                offsetSkidding: 50
            }, onArcgisColorInputChange: async (event) => {
                const currColor = event.target.color;
                await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(([Color]) => {
                    this.labelClass.symbol.haloColor = new Color(currColor);
                    this.notifySymbolChanges.emit(this.guid);
                });
            }, onArcgisColorInputPopoverOpen: () => {
                // give it some time in case another arcgis-color-input has to close first
                setTimeout(() => {
                    this.fontNode.disabled = true;
                    this.placementNode.disabled = true;
                }, 200);
            }, onArcgisColorInputPopoverClose: () => {
                this.fontNode.disabled = false;
                this.placementNode.disabled = false;
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.size, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "number", scale: "s", min: 1, max: 10, value: `${Math.round(this.labelClass.symbol.haloSize / 0.75 || 1)}`, onCalciteInputInput: (event) => {
                this.waitOnUser(event, () => {
                    const node = event.target;
                    this.labelClass.symbol.haloSize = Number(node.value) * 0.75;
                    this.notifySymbolChanges.emit(this.guid);
                }, 1);
            } }))));
        const panelRect = this.labelContentRefElement.getBoundingClientRect();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.g)(this.hostElement), id: "managePopover_Id", placement: "leading-start", open: this.isOpen, pointerDisabled: true, referenceElement: this.labelContentRefElement, offsetDistance: -Math.round(this.labelContentRefElement.getBoundingClientRect().width), offsetSkidding: 50, label: "", style: {
                zIndex: "100"
            }, triggerDisabled: true, ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { ref: (el) => (this.panelElement = el), closable: true, class: "panel", style: {
                width: `${panelRect.width}px`,
                maxHeight: `${panelRect.height * 0.8}px`
            }, onCalcitePanelClose: () => this.closeLabelPopovers.emit() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content" }, this.strings.labelStyle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: "", collapsible: false, open: true }, fontFamilySelection, " ", fontSizeSelection, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.color, this.panelElement && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-input", { color: ((_g = this.labelClass.symbol.color) === null || _g === void 0 ? void 0 : _g.toHex()) || "#ffffff", popoverProps: {
                refElement: this.panelElement,
                placement: "leading-start",
                offsetDistance: -Math.round(this.panelElement.getBoundingClientRect().width),
                offsetSkidding: 50,
                maxHeight: `${panelRect.height * 0.8 - 52}px` // minus panelheader height
            }, onArcgisColorInputChange: async (event) => {
                const currColor = event.target.color;
                await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/Color"]).then(([Color]) => {
                    this.labelClass.symbol.color = new Color(currColor);
                    this.notifySymbolChanges.emit(this.guid);
                });
            }, onArcgisColorInputPopoverOpen: () => {
                // give it some time in case another arcgis-color-input has to close first
                setTimeout(() => {
                    this.fontNode.disabled = true;
                    this.placementNode.disabled = true;
                }, 200);
            }, onArcgisColorInputPopoverClose: () => {
                this.fontNode.disabled = false;
                this.placementNode.disabled = false;
            } }))), this.placementSelection(), isBinning || this.layerGeometryType !== "polyline" ? offset : null, !isBinning && this.layerGeometryType === "polyline" ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, allowOverrun, " ", repeatLabel, " ", repeatLabelDistance)) : null, haloBlock)))));
    }
    waitOnUser(event, doChange, defaultValue) {
        // for number fields we don't want to allow an empty value
        // or value outside the range
        // but the user might shortly use an empty input box
        // while typing a new value
        const node = event.target;
        if (this.typingHndl) {
            clearTimeout(this.typingHndl);
            this.typingHndl = undefined;
        }
        const val = node.value;
        console.log(">", val, "<");
        const parsedVal = parseFloat(val);
        if (!val) {
            // undefined or empty string
            // user might be in the middle of typing
            // give the user 2 seconds to fill in empty entry
            // otherwise use default value
            this.typingHndl = setTimeout(() => {
                this.typingHndl = undefined;
                node.value = `${defaultValue}`;
                doChange(event);
            }, 2000);
        }
        else if ((0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.i)(node.min) &&
            (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_5__.i)(node.max) &&
            (node.min > parsedVal || node.max < parsedVal)) {
            // invalid value
            this.typingHndl = setTimeout(() => {
                this.typingHndl = undefined;
                // we waited a bit; no user change; set value to within range
                if (node.min > parsedVal) {
                    node.value = `${node.min}`;
                    doChange(event);
                }
                else if (node.max < parsedVal) {
                    node.value = `${node.max}`;
                    doChange(event);
                }
            }, 750);
        }
        else if (val[0] !== "-" || (parsedVal !== 0 && !isNaN(parsedVal))) {
            // not '-', '-0', '-0.', '-0.0', ...
            doChange(event);
        } // else don't update anything; it's still keeping last value
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLabelContentStyle.style = arcgisLabelContentStyleCss;



//# sourceMappingURL=arcgis-label_3.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function generateId(counts) {
    return counts
        .map((count) => {
        let out = "";
        for (let i = 0; i < count; i++) {
            out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return out;
    })
        .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);



//# sourceMappingURL=guid-aeaed84d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};



//# sourceMappingURL=index-05956cab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-27fe3cde.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/labelStore-27fe3cde.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   l: () => (/* binding */ labelState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const labelStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    layer: null,
    mapView: null,
    portal: null,
    config: null,
    strings: null,
    currentLanguage: null,
    layerGeometryType: null,
    serviceType: null,
    layerDisplayType: null
});
const labelState = labelStore.state;



//# sourceMappingURL=labelStore-27fe3cde.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTkyN2M3Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ1Q7QUFDZDtBQUM2QztBQUN3SDtBQUNwSjtBQUNMO0FBQytGO0FBQy9IO0FBQ0U7O0FBRTdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzQ0FBc0MsOENBQThDLGFBQWEsK0dBQStHLGlEQUFpRCxvQkFBb0IsYUFBYSx3QkFBd0IsWUFBWSxnQkFBZ0IsY0FBYyxTQUFTLFlBQVksc0JBQXNCLGNBQWMseUNBQXlDLFVBQVU7O0FBRWhkO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qiw0QkFBNEIscURBQVc7QUFDdkMsMENBQTBDLHFEQUFXO0FBQ3JELG9DQUFvQyxxREFBVztBQUMvQyxrQ0FBa0MscURBQVc7QUFDN0MsZ0NBQWdDLHFEQUFXO0FBQzNDLDZCQUE2QixxREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQSxvQkFBb0IscURBQUMsVUFBVSxpQ0FBaUMsRUFBRSxxREFBQywyQkFBMkI7QUFDOUYsb0ZBQW9GO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsdURBQW9CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsc0RBQXlCO0FBQzlFLHVDQUF1QywrREFBb0I7QUFDM0QsMkJBQTJCLCtEQUFjO0FBQ3pDLFFBQVEsc0RBQVU7QUFDbEIsUUFBUSxzREFBVTtBQUNsQixRQUFRLHNEQUFVO0FBQ2xCLFFBQVEsc0RBQVU7QUFDbEIsUUFBUSxzREFBVTtBQUNsQixRQUFRLHNEQUFVO0FBQ2xCLFFBQVEsc0RBQVU7QUFDbEIsUUFBUSxzREFBVTtBQUNsQixRQUFRLHNEQUFVO0FBQ2xCO0FB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aW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbGFiZWxfMy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9ndWlkLWFlYWVkODRkLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2luZGV4LTA1OTU2Y2FiLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xhYmVsU3RvcmUtMjdmZTNjZGUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgZyBhcyBndWlkIH0gZnJvbSAnLi9ndWlkLWFlYWVkODRkLmpzJztcbmltcG9ydCB7IGwgYXMgbGF5ZXJEaXNwbGF5VHlwZUVudW0sIHMgYXMgc2VydmljZVR5cGVFbnVtIH0gZnJvbSAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBoIGFzIGdldExheWVyR2VvbWV0cnlUeXBlLCBjIGFzIGdldFNlcnZpY2VUeXBlLCBqIGFzIGdldEZpZWxkc0Zyb21MYXllciwgayBhcyBnZXRDbHVzdGVyRmllbGRzLCBsIGFzIGdldFNpbmdsZUNsdXN0ZXJGZWF0dXJlLCBtIGFzIGdldFNpbmdsZUZlYXR1cmUsIGkgYXMgaXNEZWZpbmVkIH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgbCBhcyBsYWJlbFN0YXRlIH0gZnJvbSAnLi9sYWJlbFN0b3JlLTI3ZmUzY2RlLmpzJztcbmltcG9ydCB7IG0gYXMgbWFwU2VydmljZWZvbnRNYXAsIGYgYXMgZmVhdHVyZVNlcnZpY2VGb250TWFwLCBwIGFzIHBsYWNlbWVudFBvaW50LCBhIGFzIHBsYWNlbWVudExpbmUsIGIgYXMgZm9udFRvRm9udE5hbWUgfSBmcm9tICcuL2ZvbnRVdGlsLWJiZTVkMDNkLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgQ1NTJDEgPSB7XG4gICAgZW5hYmxlTGFiZWw6IFwiZW5hYmxlLWxhYmVsXCIsXG4gICAgZW5hYmxlTGFiZWxMYWJlbDogXCJlbmFibGUtbGFiZWwtbGFiZWxcIixcbiAgICBsYWJlbFN3aXRjaDogXCJsYWJlbC1zd2l0Y2hcIixcbiAgICBjb21wb25lbnREaXY6IFwiY29tcG9uZW50LXVsXCJcbn07XG5cbmNvbnN0IGFyY2dpc0xhYmVsQ3NzID0gXCIuZW5hYmxlLWxhYmVse2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtkaXNwbGF5OmZsZXg7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nKSB2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpIHZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctcXVhcnRlcik7Ym9yZGVyLWJvdHRvbTpzb2xpZCAxcHggdmFyKC0tYXJjZ2lzLWFwcC1ib3JkZXIpfS5lbmFibGUtbGFiZWwtbGFiZWx7ZGlzcGxheTpmbGV4O2ZsZXgtZmxvdzpjb2x1bW4gbm93cmFwO2ZsZXg6MSAwIDAlO292ZXJmbG93OmhpZGRlbn0ubGFiZWwtc3dpdGNoe21hcmdpbjowO2ZsZXg6MCAwIDAlO2p1c3RpZnktc2VsZjpmbGV4LWVuZH0uY29tcG9uZW50LXVse21hcmdpbjowIDAgdmFyKC0tYXJjZ2lzLWFwcC1jYXAtc3BhY2luZyk7cGFkZGluZzowfVwiO1xuXG5jb25zdCBBcmNnaXNMYWJlbCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubGFiZWxVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJsYWJlbFVwZGF0ZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTGFiZWxEaXNtaXNzZWRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xhYmVsRGlzbWlzc2VkQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmludGVybmFsTGFiZWxVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbnRlcm5hbExhYmVsVXBkYXRlZFwiLCA3KTtcbiAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlTGFiZWxQb3BvdmVyc1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNGaWx0ZXJEb25lID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNGaWx0ZXJEb25lXCIsIDcpO1xuICAgICAgICB0aGlzLmxhYmVsUmVSZW5kZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImxhYmVsUmVSZW5kZXJcIiwgNyk7XG4gICAgICAgIC8vIHJlbmRvciBtZXRob2RzXG4gICAgICAgIHRoaXMubGFiZWxDb21wb25lbnQgPSAodW5pcXVlR3VpZCwgbGFiZWxDbGFzcywgYmxvY2tPcGVuKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBrZXk6IHVuaXF1ZUd1aWQsIGlkOiB1bmlxdWVHdWlkIH0sIGgoXCJhcmNnaXMtbGFiZWwtY29udGVudFwiLCB7IGd1aWQ6IHVuaXF1ZUd1aWQsIGxhYmVsQ2xhc3M6IGxhYmVsQ2xhc3MsIGJsb2NrT3BlbjogYmxvY2tPcGVuLCBjYWxjaXRlRmxvd0l0ZW06ICgoX2EgPSB0aGlzLmNhbGNpdGVGbG93UHJvcHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYWxjaXRlRmxvd0l0ZW0pIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcImxhYmVsRmxvd0l0ZW1fSWRcIikgfSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9IGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmU7XG4gICAgICAgIHRoaXMuZGlzbWlzc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oaWRlTGF5ZXJUaXRsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbGNpdGVGbG93UHJvcHMgPSBudWxsO1xuICAgICAgICB0aGlzLmxhYmVsQ29tcG9uZW50cyA9IFtdO1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLyBsaWZlY3ljbGUgbWV0aG9kc1xuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBbdGhpcy5zdHJpbmdzLCB0aGlzLmN1cnJlbnRMYW5ndWFnZV0gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLmxheWVyR2VvbWV0cnlUeXBlID0gYXdhaXQgZ2V0TGF5ZXJHZW9tZXRyeVR5cGUodGhpcy5sYXllcik7XG4gICAgICAgIHRoaXMuc2VydmljZVR5cGUgPSBnZXRTZXJ2aWNlVHlwZSh0aGlzLmxheWVyKTtcbiAgICAgICAgbGFiZWxTdGF0ZS5sYXllciA9IHRoaXMubGF5ZXI7XG4gICAgICAgIGxhYmVsU3RhdGUubWFwVmlldyA9IHRoaXMubWFwVmlldztcbiAgICAgICAgbGFiZWxTdGF0ZS5wb3J0YWwgPSB0aGlzLnBvcnRhbDtcbiAgICAgICAgbGFiZWxTdGF0ZS5jb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICAgICAgbGFiZWxTdGF0ZS5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICBsYWJlbFN0YXRlLmN1cnJlbnRMYW5ndWFnZSA9IHRoaXMuY3VycmVudExhbmd1YWdlO1xuICAgICAgICBsYWJlbFN0YXRlLmxheWVyR2VvbWV0cnlUeXBlID0gdGhpcy5sYXllckdlb21ldHJ5VHlwZTtcbiAgICAgICAgbGFiZWxTdGF0ZS5zZXJ2aWNlVHlwZSA9IHRoaXMuc2VydmljZVR5cGU7XG4gICAgICAgIGxhYmVsU3RhdGUubGF5ZXJEaXNwbGF5VHlwZSA9IHRoaXMubGF5ZXJEaXNwbGF5VHlwZTtcbiAgICAgICAgdGhpcy5sYWJlbGluZ0luZm8gPVxuICAgICAgICAgICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlXG4gICAgICAgICAgICAgICAgPyB0aGlzLmxheWVyLmxhYmVsaW5nSW5mb1xuICAgICAgICAgICAgICAgIDogdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uLmxhYmVsaW5nSW5mbztcbiAgICAgICAgLy8gdGVtcFxuICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgICAgICB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgPSB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgfHwgZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxzVmlzaWJsZSA9XG4gICAgICAgICAgICAgICAgdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uLmxhYmVsc1Zpc2libGUgfHxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gYWRkIGZvciBleGlzdGluZ1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmxhYmVsaW5nSW5mbykpIHtcbiAgICAgICAgICAgIHRoaXMubGFiZWxpbmdJbmZvLmZvckVhY2goKGxhYmVsQ2xhc3MpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZExhYmVsQ2xhc3MobGFiZWxDbGFzcywgdGhpcy5sYWJlbGluZ0luZm8ubGVuZ3RoID09PSAxID8gdHJ1ZSA6IGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zb3J0YWJsZUNvbXBvbmVudHMgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJTb3J0YWJsZUNvbXBvbmVudHNfSWRcIik7XG4gICAgICAgIHRoaXMuY2FsY2l0ZUZhYiA9XG4gICAgICAgICAgICAoKF9hID0gdGhpcy5jYWxjaXRlRmxvd1Byb3BzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsY2l0ZUZhYikgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJhZGRDb21wb25lbnRCdG5fSWRcIik7XG4gICAgICAgIHRoaXMuZW5hYmxlRGlzYWJsZUxhYmVsKHRoaXMuZ2V0TGFiZWxFbmFibGVkUHJvcCgpKTtcbiAgICAgICAgdGhpcy5jYWxjaXRlRmFiLm9uY2xpY2sgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAgICAgY29uc3QgbGFiZWxDbGFzcyA9IGF3YWl0IHRoaXMuZ2V0TGFiZWxDbGFzcygpO1xuICAgICAgICAgICAgaWYgKHRoaXMubGFiZWxpbmdJbmZvKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbGluZ0luZm8ucHVzaChsYWJlbENsYXNzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxpbmdJbmZvID0gW2xhYmVsQ2xhc3NdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hZGRMYWJlbENsYXNzKGxhYmVsQ2xhc3MsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5mb2N1c0xhc3RMYWJlbENsYXNzKCk7XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLmZsb3dJdGVtTm9kZSkge1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuZmxvd0l0ZW1Ob2RlLnNldEZvY3VzKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbExhYmVsVXBkYXRlZC5lbWl0KCk7XG4gICAgfVxuICAgIC8vIEV2ZW50c1xuICAgIG1haW5Qb3B1cFJlUmVuZGVySGFuZGxlcihldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9IHRoaXMucmVSZW5kZXIgPyBmYWxzZSA6IHRydWU7XG4gICAgfVxuICAgIGRlbGV0ZUNvbXBvbmVudEhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgLy8gZWFjaCBkaXYgaGFzIGlkLiBGaW5kIGlkLCBhbmQgc3BsaWNlIGJ5IGluZGV4XG4gICAgICAgIGNvbnN0IGFsbENvbXBvbmVudHMgPSB0aGlzLnNvcnRhYmxlQ29tcG9uZW50cy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRpdlwiKTtcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBhbGxDb21wb25lbnRzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICBpZiAoYWxsQ29tcG9uZW50c1t4XS5pZCA9PT0gZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbGluZ0luZm8uc3BsaWNlKHgsIDEpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDb21wb25lbnRzLnNwbGljZSh4LCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhYmVsUmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICB0aGlzLmNhbGNpdGVGYWIuc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgZHVwbGljYXRlQ29tcG9uZW50SGFuZGxlcihldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAvLyBlYWNoIGRpdiBoYXMgaWQuIEZpbmQgaWQsIGFuZCBjbG9uZVxuICAgICAgICBjb25zdCBhbGxDb21wb25lbnRzID0gdGhpcy5zb3J0YWJsZUNvbXBvbmVudHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkaXZcIik7XG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgYWxsQ29tcG9uZW50cy5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgaWYgKGFsbENvbXBvbmVudHNbeF0uaWQgPT09IGV2ZW50LmRldGFpbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBMYWJlbENsYXNzID0gdGhpcy5sYWJlbGluZ0luZm9beF0uY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsaW5nSW5mby5wdXNoKHRlbXBMYWJlbENsYXNzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZExhYmVsQ2xhc3ModGVtcExhYmVsQ2xhc3MsIHRydWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNMYXN0TGFiZWxDbGFzcygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGludGVybmFsTGFiZWxVcGRhdGVkSGFuZGxlcihldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgLy8gaWYgZXZlbnQuZGV0YWlsIGlzIHRydWUsIG9ubHkgdXBkYXRlIGV4dGVybmFsXG4gICAgICAgIGlmICh0aGlzLmxhYmVsaW5nSW5mbyAmJiAhZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXllci5sYWJlbGluZ0luZm8gPSBbLi4udGhpcy5sYWJlbGluZ0luZm9dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uLmxhYmVsaW5nSW5mbyA9IFtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5sYWJlbGluZ0luZm9cbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFiZWxVcGRhdGVkLmVtaXQoKTtcbiAgICB9XG4gICAgZGlzYWJsZUxhYmVsUGFuZWxIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IHBhbmVsID0gKChfYSA9IHRoaXMuY2FsY2l0ZUZsb3dQcm9wcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNhbGNpdGVGbG93SXRlbSkgfHxcbiAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcImxhYmVsRmxvd0l0ZW1fSWRcIik7XG4gICAgICAgIHBhbmVsLmRpc2FibGVkID0gZXZlbnQuZGV0YWlsO1xuICAgIH1cbiAgICAvLyBQdWJsaWMgTWV0aG9kc1xuICAgIGFzeW5jIGRvbmUoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzRmlsdGVyRG9uZS5lbWl0KCk7XG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICB9XG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKHRoaXMuZmxvd0l0ZW1Ob2RlKSB7XG4gICAgICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZS5zZXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5sYWJlbFN3aXRjaCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gcHJpdmF0ZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzXG4gICAgZW5hYmxlRGlzYWJsZUxhYmVsKGxhYmVsQm9vbCkge1xuICAgICAgICAvLyBoaWRlIHJlc3Qgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgICAgY29uc3QgbGFiZWxEaXYgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJsYWJlbERpdl9JZFwiKTtcbiAgICAgICAgbGFiZWxEaXYuc3R5bGUuZGlzcGxheSA9IGxhYmVsQm9vbCA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmNhbGNpdGVGYWIuc3R5bGUuZGlzcGxheSA9IGxhYmVsQm9vbCA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgfVxuICAgIGdldExhYmVsRW5hYmxlZFByb3AoKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5sYXllckRpc3BsYXlUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIGxheWVyRGlzcGxheVR5cGVFbnVtLmZlYXR1cmU6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYXllci5sYWJlbHNWaXNpYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgICAgICAubGFiZWxzVmlzaWJsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYXllci5sYWJlbHNWaXNpYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGFkZExhYmVsQ2xhc3MobGFiZWxDbGFzcywgYmxvY2tPcGVuID0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5sYWJlbENvbXBvbmVudHMgPSBbXG4gICAgICAgICAgICAuLi50aGlzLmxhYmVsQ29tcG9uZW50cyxcbiAgICAgICAgICAgIHRoaXMubGFiZWxDb21wb25lbnQoZ3VpZCgpLCBsYWJlbENsYXNzLCBibG9ja09wZW4pXG4gICAgICAgIF07XG4gICAgfVxuICAgIGFzeW5jIGdldExhYmVsQ2xhc3MoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgICAgICBjb25zdCBbTGFiZWxDbGFzcywgY29sb3JVdGlscywgY2x1c3RlckxhYmVsQ3JlYXRvciwgYmluTGFiZWxDcmVhdG9yXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgICAgICAgIFwiZXNyaS9sYXllcnMvc3VwcG9ydC9MYWJlbENsYXNzXCIsXG4gICAgICAgICAgICBcImVzcmkvdmlld3Mvc3VwcG9ydC9jb2xvclV0aWxzXCIsXG4gICAgICAgICAgICBcImVzcmkvc21hcnRNYXBwaW5nL2xhYmVscy9jbHVzdGVyc1wiLFxuICAgICAgICAgICAgXCJlc3JpL3NtYXJ0TWFwcGluZy9sYWJlbHMvYmluc1wiXG4gICAgICAgIF0pO1xuICAgICAgICAvLyBmZWF0dXJlIG9yIGNsdXN0ZXJcbiAgICAgICAgaWYgKHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBMYWJlbENsYXNzKHRoaXMuZGVmYXVsdExhYmVsUHJvcHModGhpcy5kZWZhdWx0U3ltYm9sUHJvcHMoYXdhaXQgY29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3IodGhpcy5tYXBWaWV3KSwgYXdhaXQgY29sb3JVdGlscy5nZXRCYWNrZ3JvdW5kQ29sb3JUaGVtZSh0aGlzLm1hcFZpZXcpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiAoKChfYyA9IChfYiA9IChhd2FpdCBiaW5MYWJlbENyZWF0b3IuZ2V0TGFiZWxTY2hlbWVzKHtcbiAgICAgICAgICAgICAgICBsYXllcjogdGhpcy5sYXllclxuICAgICAgICAgICAgfSkpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucHJpbWFyeVNjaGVtZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxhYmVsaW5nSW5mb1swXSkgfHwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKCgoX2YgPSAoX2UgPSAoYXdhaXQgY2x1c3RlckxhYmVsQ3JlYXRvci5nZXRMYWJlbFNjaGVtZXMoe1xuICAgICAgICAgICAgICAgIGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICAgICAgICAgIHJlbmRlcmVyOiAoX2QgPSB0aGlzLmxheWVyKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QucmVuZGVyZXIsXG4gICAgICAgICAgICAgICAgdmlldzogdGhpcy5tYXBWaWV3XG4gICAgICAgICAgICB9KSkpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5wcmltYXJ5U2NoZW1lKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YubGFiZWxpbmdJbmZvWzBdKSB8fCBudWxsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZWZhdWx0TGFiZWxQcm9wcyhzeW1ib2xQcm9wcykge1xuICAgICAgICBjb25zdCBkZWZhdWx0RmllbGROYW1lID0gdGhpcy5kZWZhdWx0TGFiZWxGaWVsZCgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLy8gYXV0b2Nhc3RzIGFzIG5ldyBMYWJlbENsYXNzKClcbiAgICAgICAgICAgIHN5bWJvbDoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBzeW1ib2xQcm9wcy5mb250Q29sb3IsXG4gICAgICAgICAgICAgICAgaGFsb0NvbG9yOiBzeW1ib2xQcm9wcy5oYWxvQ29sb3IsXG4gICAgICAgICAgICAgICAgaGFsb1NpemU6IHN5bWJvbFByb3BzLmhhbG9TaXplLFxuICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZmFtaWx5OiBzeW1ib2xQcm9wcy5mb250RmFtaWx5LFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBzeW1ib2xQcm9wcy5mb250U2l6ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsYWJlbEV4cHJlc3Npb25JbmZvOiB0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXJcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogYCRmZWF0dXJlW1wiJHtkZWZhdWx0RmllbGROYW1lfVwiXWBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiB0aGlzLnNlcnZpY2VUeXBlICE9PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiBkZWZhdWx0RmllbGROYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmxheWVyLmZpZWxkcy5zb21lKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZC5uYW1lID09PSBkZWZhdWx0RmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChfYSA9IGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC5kb21haW4pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJjb2RlZC12YWx1ZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBgJGZlYXR1cmVbXCIke2RlZmF1bHRGaWVsZE5hbWV9XCJdXFxuRG9tYWluTmFtZSgkZmVhdHVyZSwgXCIke2RlZmF1bHRGaWVsZE5hbWV9XCIpYFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGAkZmVhdHVyZVtcIiR7ZGVmYXVsdEZpZWxkTmFtZX1cIl1gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgbGFiZWxFeHByZXNzaW9uOiB0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UgPyBgWyR7ZGVmYXVsdEZpZWxkTmFtZX1dYCA6IG51bGwsXG4gICAgICAgICAgICBsYWJlbFBsYWNlbWVudDogdGhpcy5kZWZhdWx0UGxhY2VtZW50KCksXG4gICAgICAgICAgICBtYXhTY2FsZTogdGhpcy5sYXllci5tYXhTY2FsZSB8fCAwLFxuICAgICAgICAgICAgbWluU2NhbGU6IHRoaXMubGF5ZXIubWluU2NhbGUgfHwgMFxuICAgICAgICB9O1xuICAgIH1cbiAgICBkZWZhdWx0TGFiZWxGaWVsZCgpIHtcbiAgICAgICAgbGV0IGRlZmF1bHRGaWVsZCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIpIHtcbiAgICAgICAgICAgIC8vIHdlIGtub3cgd2UgaGF2ZSBhdCBsZWFzdCBvbmUgZmllbGRcbiAgICAgICAgICAgIGRlZmF1bHRGaWVsZCA9IHRoaXMubGF5ZXIuZmVhdHVyZVJlZHVjdGlvblxuICAgICAgICAgICAgICAgIC5maWVsZHNbMF0ubmFtZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChcImRpc3BsYXlGaWVsZFwiIGluIHRoaXMubGF5ZXIgJiZcbiAgICAgICAgICAgIHRoaXMubGF5ZXIuZGlzcGxheUZpZWxkICYmXG4gICAgICAgICAgICB0aGlzLmxheWVyLmZpZWxkc0luZGV4LmdldCh0aGlzLmxheWVyLmRpc3BsYXlGaWVsZCkpIHtcbiAgICAgICAgICAgIGRlZmF1bHRGaWVsZCA9IHRoaXMubGF5ZXIuZGlzcGxheUZpZWxkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYXllci5maWVsZHMuZmluZCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwic3RyaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGVmYXVsdEZpZWxkID0gZmllbGQubmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRGaWVsZCA/IGRlZmF1bHRGaWVsZCA6IHRoaXMubGF5ZXIuZmllbGRzWzBdLm5hbWU7XG4gICAgfVxuICAgIGRlZmF1bHRTeW1ib2xQcm9wcyhiYWNrZ3JvdW5kQ29sb3IsIGJhY2tncm91bmRDb2xvclRoZW1lKSB7XG4gICAgICAgIGlmIChiYWNrZ3JvdW5kQ29sb3JUaGVtZSA9PT0gXCJsaWdodFwiKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiQXJpYWxcIixcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTMgKiAwLjc1LFxuICAgICAgICAgICAgICAgIGZvbnRDb2xvcjogXCIjNjk2OTY5XCIsXG4gICAgICAgICAgICAgICAgaGFsb0NvbG9yOiBcIiNkM2QzZDNcIixcbiAgICAgICAgICAgICAgICBoYWxvU2l6ZTogMVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYWNrZ3JvdW5kQ29sb3JUaGVtZSA9PT0gXCJkYXJrXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZm9udEZhbWlseTogXCJBcmlhbFwiLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxMyAqIDAuNzUsXG4gICAgICAgICAgICAgICAgZm9udENvbG9yOiBcIiNkM2QzZDNcIixcbiAgICAgICAgICAgICAgICBoYWxvQ29sb3I6IFwiIzY5Njk2OVwiLFxuICAgICAgICAgICAgICAgIGhhbG9TaXplOiAxXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBcIkFyaWFsXCIsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDEzICogMC43NSxcbiAgICAgICAgICAgICAgICBmb250Q29sb3I6IGJhY2tncm91bmRDb2xvciB8fCBcIiM2OTY5NjlcIixcbiAgICAgICAgICAgICAgICBoYWxvQ29sb3I6IFwiI2QzZDNkM1wiLFxuICAgICAgICAgICAgICAgIGhhbG9TaXplOiAxICogMC43NVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZWZhdWx0UGxhY2VtZW50KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIgJiZcbiAgICAgICAgICAgICgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcImFsd2F5cy1ob3Jpem9udGFsXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiIHx8IHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwibXVsdGlwb2ludFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJhYm92ZS1jZW50ZXJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmxheWVyR2VvbWV0cnlUeXBlID09PSBcInBvbHlsaW5lXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcImNlbnRlci1hbG9uZ1wiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9seWdvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJhbHdheXMtaG9yaXpvbnRhbFwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9jdXNMYXN0TGFiZWxDbGFzcygpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvY2tzID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3JBbGwoXCJhcmNnaXMtbGFiZWwtY29udGVudFwiKTtcbiAgICAgICAgICAgIGlmIChibG9ja3MgPT09IG51bGwgfHwgYmxvY2tzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBibG9ja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tzW2Jsb2Nrcy5sZW5ndGggLSAxXS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgMjAwKTtcbiAgICB9XG4gICAgbGFiZWxTd2l0Y2hBbmRDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogQ1NTJDEuZW5hYmxlTGFiZWwsIGFsaWdubWVudDogXCJzdGFydFwiLCBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiB9LCB0aGlzLnN0cmluZ3MuZW5hYmxlTGFiZWxzLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMubGFiZWxTd2l0Y2ggPSBlbCksIHNjYWxlOiBcInNcIiwgY2xhc3M6IENTUyQxLmxhYmVsU3dpdGNoLCBjaGVja2VkOiB0aGlzLmdldExhYmVsRW5hYmxlZFByb3AoKSwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGVja2VkID0gZXZlbnQudGFyZ2V0LmNoZWNrZWQ7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLmxheWVyRGlzcGxheVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgPSBjaGVja2VkO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ubGFiZWxzVmlzaWJsZSA9IGNoZWNrZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxheWVyLmxhYmVsc1Zpc2libGUgPSBjaGVja2VkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlRGlzYWJsZUxhYmVsKGNoZWNrZWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxMYWJlbFVwZGF0ZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgICAgIH0gfSkpLCBoKFwiZGl2XCIsIHsgaWQ6IFwibGFiZWxEaXZfSWRcIiB9LCBoKFwiZGl2XCIsIHsgaWQ6IFwiU29ydGFibGVDb21wb25lbnRzX0lkXCIsIGNsYXNzOiBDU1MkMS5jb21wb25lbnREaXYgfSwgdGhpcy5sYWJlbENvbXBvbmVudHMpKSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGFkZExhYmVsQnRuID0gKGgoXCJjYWxjaXRlLWZhYlwiLCB7IGlkOiBcImFkZENvbXBvbmVudEJ0bl9JZFwiLCBpY29uOiBcInBsdXNcIiwgc2xvdDogXCJmYWJcIiwgc2NhbGU6IFwic1wiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgbGFiZWw6IHRoaXMuc3RyaW5ncy5hZGRMYWJlbCwgdGV4dDogdGhpcy5zdHJpbmdzLmFkZExhYmVsLCBcInRleHQtZW5hYmxlZFwiOiB0cnVlIH0pKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgc3R5bGU6IHRoaXMuY2FsY2l0ZUZsb3dQcm9wcyA/IHt9IDogeyBkaXNwbGF5OiBcImZsZXhcIiwgZmxleDogXCIxIDEgYXV0b1wiLCBvdmVyZmxvdzogXCJoaWRkZW5cIiB9IH0sIHRoaXMuY2FsY2l0ZUZsb3dQcm9wcyA/IChoKFwiZGl2XCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpIH0sIHRoaXMubGFiZWxTd2l0Y2hBbmRDb250ZW50KCkpKSA6IChoKFwiY2FsY2l0ZS1mbG93XCIsIHsgZGlyOiBnZXRFbGVtZW50RGlyKHRoaXMuaG9zdEVsZW1lbnQpIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGlkOiBcImxhYmVsRmxvd0l0ZW1fSWRcIiwgaGVhZGluZzogdGhpcy5zdHJpbmdzLmxhYmVsRmVhdHVyZXMsIGRlc2NyaXB0aW9uOiAhdGhpcy5oaWRlTGF5ZXJUaXRsZSA/IHRoaXMubGF5ZXIudGl0bGUgOiB1bmRlZmluZWQsIGNsb3NhYmxlOiB0aGlzLmRpc21pc3NpYmxlLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNMYWJlbERpc21pc3NlZENoYW5nZS5lbWl0KCk7XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5mbG93SXRlbU5vZGUgPSBub2RlKSB9LCB0aGlzLmxhYmVsU3dpdGNoQW5kQ29udGVudCgpLCBhZGRMYWJlbEJ0bikpKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTGFiZWwuc3R5bGUgPSBhcmNnaXNMYWJlbENzcztcblxuY29uc3QgQ1NTID0ge1xuICAgIGxhYmVsQ29udGVudEJ1dHRvblNlY3Rpb246IFwibGFiZWwtY29udGVudC1idG4tc2VjdGlvblwiLFxuICAgIGxhYmVsQ29udGVudEJ1dHRvbkV4cDogXCJsYWJlbC1jb250ZW50LWJ0bi1leHBcIixcbiAgICBsYWJlbENvbnRlbnRCdXR0b246IFwibGFiZWwtY29udGVudC1idG5cIixcbiAgICBsYWJlbENvbnRlbnRCdXR0b25UZXh0OiBcImxhYmVsLWNvbnRlbnQtYnRuLXRleHRcIixcbiAgICBsYWJlbENvbnRlbnRCdXR0b25JY29uOiBcImxhYmVsLWNvbnRlbnQtYnRuLWljb25cIixcbiAgICBmaWVsZEV4cHJlc3Npb25EaXY6IFwiZmllbGQtZXhwcmVzc2lvbi1kaXZcIlxufTtcblxuY29uc3QgYXJjZ2lzTGFiZWxDb250ZW50Q3NzID0gXCIubGFiZWwtY29udGVudC1idG4tc2VjdGlvbntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZCk7bWluLXdpZHRoOjEwMCV9LmxhYmVsLWNvbnRlbnQtYnRue2JhY2tncm91bmQ6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kLWNsZWFyKTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWFyY2dpcy1hcHAtYm9yZGVyKTtib3JkZXItcmFkaXVzOnZhcigtLWFyY2dpcy1hcHAtYm9yZGVyLXJhZGl1cyk7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctaGFsZikgdmFyKC0tYXJjZ2lzLWFwcC1zaWRlLXNwYWNpbmctcXVhcnRlcik7Y3Vyc29yOnBvaW50ZXI7d2lkdGg6MTAwJTt0ZXh0LWFsaWduOnVuc2V0O3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciB2YXIoLS1hcmNnaXMtYXBwLWFuaW1hdGlvbi10aW1lLWZhc3QpIHZhcigtLWFyY2dpcy1hcHAtZWFzaW5nLWZ1bmN0aW9uKSwgYm9yZGVyLWNvbG9yIHZhcigtLWFyY2dpcy1hcHAtYW5pbWF0aW9uLXRpbWUtZmFzdCkgdmFyKC0tYXJjZ2lzLWFwcC1lYXNpbmctZnVuY3Rpb24pfS5sYWJlbC1jb250ZW50LWJ0bjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYmFja2dyb3VuZC1ob3Zlcik7Ym9yZGVyLWNvbG9yOnZhcigtLWFyY2dpcy1hcHAtYm9yZGVyLWhvdmVyKX0ubGFiZWwtY29udGVudC1idG4tZXhwe3dpZHRoOmNhbGMoMTAwJSAtIDMycHgpfS5sYWJlbC1jb250ZW50LWJ0bi1leHAgLmxhYmVsLWNvbnRlbnQtYnRue2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6MDtib3JkZXItcmlnaHQ6MXB4IHNvbGlkIHZhcigtLWFyY2dpcy1hcHAtYm9yZGVyKX0ubGFiZWwtY29udGVudC1idG4tdGV4dHtmb250LWZhbWlseTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtZmFtaWx5KTtmb250LXNpemU6dmFyKC0tYXJjZ2lzLWFwcC1mb250LXNpemUtMCk7ZmxleDowIDEgYXV0bztvdmVyZmxvdzpoaWRkZW47cGFkZGluZzowIHZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWVpZ2h0aCk7dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXB9LmxhYmVsLWNvbnRlbnQtYnRuLWljb257ZmxleDowIDAgMCU7cGFkZGluZzowIHZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWhhbGYpfS5maWVsZC1leHByZXNzaW9uLWRpdnthbGlnbi1pdGVtczpjZW50ZXI7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO3dpZHRoOjEwMCU7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1hcmNnaXMtYXBwLWJvcmRlcik7Ym9yZGVyLXJhZGl1czp2YXIoLS1hcmNnaXMtYXBwLWJvcmRlci1yYWRpdXMpfS5maWVsZC1leHByZXNzaW9uLWRpdiBjYWxjaXRlLWFjdGlvbntmbGV4OjAgMCBhdXRvfSNzbGlkZXJfSWR7bWluLXdpZHRoOjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc0xhYmVsQ29udGVudCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzID0gY3JlYXRlRXZlbnQodGhpcywgXCJjbG9zZUxhYmVsUG9wb3ZlcnNcIiwgNyk7XG4gICAgICAgIHRoaXMuaW50ZXJuYWxMYWJlbFVwZGF0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImludGVybmFsTGFiZWxVcGRhdGVkXCIsIDcpO1xuICAgICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJsYWJlbENvbnRlbnRSZVJlbmRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5kaXNhYmxlTGFiZWxQYW5lbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZGlzYWJsZUxhYmVsUGFuZWxcIiwgNyk7XG4gICAgICAgIHRoaXMuZGVmYXVsdFNjcmlwdCA9IFwiXCI7XG4gICAgICAgIHRoaXMuYWdncmVnYXRpb25FeHByZXNzaW9uTWFwcGluZyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5maWVsZFBpY2tMaXN0Q2hhbmdlcyA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZCA9IChfYiA9IChfYSA9IGV2ZW50LmRldGFpbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlbGVjdGVkRmllbGRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF07XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRGaWVsZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbiA9IGBbJHtzZWxlY3RlZEZpZWxkfV1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3Rlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWdncmVnYXRpb25FeHByZXNzaW9uTWFwcGluZy5oYXMoc2VsZWN0ZWRGaWVsZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mby5leHByZXNzaW9uID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nLmdldChzZWxlY3RlZEZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZXhwcmVzc2lvbl0gb2YgdGhpcy5hZ2dyZWdhdGlvbkV4cHJlc3Npb25NYXBwaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZE5hbWUgPT09IHNlbGVjdGVkRmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5sYWJlbEV4cHJlc3Npb25JbmZvLmV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8gPSB0aGlzLmxheWVyLmZpZWxkcy5zb21lKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQubmFtZSA9PT0gc2VsZWN0ZWRGaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChfYSA9IGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC5kb21haW4pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJjb2RlZC12YWx1ZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IGAkZmVhdHVyZVtcIiR7c2VsZWN0ZWRGaWVsZH1cIl1cXG5Eb21haW5OYW1lKCRmZWF0dXJlLCBcIiR7c2VsZWN0ZWRGaWVsZH1cIilgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiBgJGZlYXR1cmVbXCIke3NlbGVjdGVkRmllbGR9XCJdYFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ3VpZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ibG9ja09wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sYWJlbENsYXNzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNhbGNpdGVGbG93SXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8gbGlmZWN5Y2xlIG1ldGhvZHNcbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5sYXllciA9IGxhYmVsU3RhdGUubGF5ZXI7XG4gICAgICAgIHRoaXMubWFwVmlldyA9IGxhYmVsU3RhdGUubWFwVmlldztcbiAgICAgICAgdGhpcy5wb3J0YWwgPSBsYWJlbFN0YXRlLnBvcnRhbDtcbiAgICAgICAgdGhpcy5jb25maWcgPSBsYWJlbFN0YXRlLmNvbmZpZztcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gbGFiZWxTdGF0ZS5zdHJpbmdzO1xuICAgICAgICB0aGlzLmN1cnJlbnRMYW5ndWFnZSA9IGxhYmVsU3RhdGUuY3VycmVudExhbmd1YWdlO1xuICAgICAgICB0aGlzLmxheWVyRGlzcGxheVR5cGUgPSBsYWJlbFN0YXRlLmxheWVyRGlzcGxheVR5cGU7XG4gICAgICAgIHRoaXMuc2VydmljZVR5cGUgPSBsYWJlbFN0YXRlLnNlcnZpY2VUeXBlO1xuICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUgPVxuICAgICAgICAgICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlXG4gICAgICAgICAgICAgICAgPyB0aGlzLmxheWVyLnBvcHVwVGVtcGxhdGVcbiAgICAgICAgICAgICAgICA6IHRoaXMubGF5ZXIuZmVhdHVyZVJlZHVjdGlvbi5wb3B1cFRlbXBsYXRlO1xuICAgICAgICB0aGlzLmxhYmVsRmllbGRzID0gYXdhaXQgdGhpcy5nZXRGaWVsZHNGb3JMYWJlbGluZygpO1xuICAgICAgICB0aGlzLmRlZmF1bHRTY3JpcHQgPSBgLy8gJHt0aGlzLnN0cmluZ3MuYXJjYWRlU2NyaXB0TGluZTF9IFxcbi8vICR7dGhpcy5zdHJpbmdzLmFyY2FkZVNjcmlwdExpbmUyfVxcbi8vICRmZWF0dXJlLm5hbWUgKyBcIiBcIiArICRmZWF0dXJlLnN0YXR1c1xcbmA7XG4gICAgICAgIGlmICghdGhpcy5jYWxjaXRlRmxvd0l0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuY2FsY2l0ZUZsb3dJdGVtID0gdGhpcy5ob3N0RWxlbWVudC5jbG9zZXN0KFwiI2xhYmVsRmxvd0l0ZW1fSWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc2V0dXAgbWFwcGluZyBmb3IgY2x1c3RlciBjYXNlLiBXZSBkb250IHdhbnQgdG8gdXNlIGRlZmF1bHQgdmFsdWVzIHNpbmNlIHRoZXJlIGlzIG5vIGZvcm1hdHRpbmcuXG4gICAgICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIpIHtcbiAgICAgICAgICAgIFt0aGlzLmJpbkxhYmVsQ3JlYXRvciwgdGhpcy5jbHVzdGVyTGFiZWxDcmVhdG9yXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcbiAgICAgICAgICAgICAgICBcImVzcmkvc21hcnRNYXBwaW5nL2xhYmVscy9iaW5zXCIsXG4gICAgICAgICAgICAgICAgXCJlc3JpL3NtYXJ0TWFwcGluZy9sYWJlbHMvY2x1c3RlcnNcIlxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBjb25zdCBnZXRTY2hlbWVzRm9yRmllbGQgPSBhc3luYyAoZmllbGROYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBsZXQgbGFiZWxTY2hlbWVzO1xuICAgICAgICAgICAgICAgIGlmICgoKF9hID0gdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsU2NoZW1lcyA9IGF3YWl0IHRoaXMuYmluTGFiZWxDcmVhdG9yLmdldExhYmVsU2NoZW1lcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllcjogdGhpcy5sYXllcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbFNjaGVtZXMgPSBhd2FpdCB0aGlzLmNsdXN0ZXJMYWJlbENyZWF0b3IuZ2V0TGFiZWxTY2hlbWVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXI6IChfYiA9IHRoaXMubGF5ZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZW5kZXJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFNjaGVtZXMgPSBbbGFiZWxTY2hlbWVzID09PSBudWxsIHx8IGxhYmVsU2NoZW1lcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGFiZWxTY2hlbWVzLnByaW1hcnlTY2hlbWUsIC4uLmxhYmVsU2NoZW1lcyA9PT0gbnVsbCB8fCBsYWJlbFNjaGVtZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxhYmVsU2NoZW1lcy5zZWNvbmRhcnlTY2hlbWVzXTtcbiAgICAgICAgICAgICAgICBhbGxTY2hlbWVzLmZvckVhY2goKGNsdXN0ZXJTY2hlbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWdncmVnYXRpb25FeHByZXNzaW9uTWFwcGluZy5zZXQoY2x1c3RlclNjaGVtZSA9PT0gbnVsbCB8fCBjbHVzdGVyU2NoZW1lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbHVzdGVyU2NoZW1lLmZpZWxkTmFtZSwgKF9jID0gKF9iID0gKF9hID0gY2x1c3RlclNjaGVtZSA9PT0gbnVsbCB8fCBjbHVzdGVyU2NoZW1lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbHVzdGVyU2NoZW1lLmxhYmVsaW5nSW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmV4cHJlc3Npb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGNhbGxzID0gW107XG4gICAgICAgICAgICB0aGlzLmxhYmVsRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FsbHMucHVzaChnZXRTY2hlbWVzRm9yRmllbGQoZmllbGQubmFtZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChjYWxscyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5hZGRTY2FsZVJhbmdlU2xpZGVyKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbExhYmVsVXBkYXRlZC5lbWl0KCk7XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAodGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGFiZWxTdHlsZSkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmxhYmVsU3R5bGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcG92ZXJSZW5hbWVGb3JtKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMucG9wb3ZlclJlbmFtZUZvcm0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxhYmVsRmlsdGVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMubGFiZWxGaWx0ZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy5ibG9ja09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tPcHRpb25zLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcIm5lYXJlc3RcIiwgaW5saW5lOiBcInN0YXJ0XCIgfSk7XG4gICAgICAgICAgICB0aGlzLmJsb2NrT3B0aW9ucy5zZXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIEV2ZW50c1xuICAgIGNhbGNpdGVCbG9ja1RvZ2dsZUhhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICB9XG4gICAgbGFiZWxDb250ZW50UmVSZW5kZXJIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gdGhpcy5yZVJlbmRlciA/IGZhbHNlIDogdHJ1ZTtcbiAgICB9XG4gICAgY2xvc2VMYWJlbFBvcG92ZXJzSGFuZGxlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3QpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlc0J0bi5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxhYmVsU3R5bGUpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5sYWJlbFN0eWxlKTtcbiAgICAgICAgICAgIHRoaXMubGFiZWxTdHlsZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnN0eWxlQnRuLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucG9wb3ZlclJlbmFtZUZvcm0pIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5wb3BvdmVyUmVuYW1lRm9ybSk7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJSZW5hbWVGb3JtID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tPcHRpb25zLnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGFiZWxGaWx0ZXIpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5sYWJlbEZpbHRlcik7XG4gICAgICAgICAgICB0aGlzLmxhYmVsRmlsdGVyID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyQnRuLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXNhYmxlTGFiZWxQYW5lbC5lbWl0KGZhbHNlKTtcbiAgICB9XG4gICAgbm90aWZ5U3ltYm9sQ2hhbmdlc0hhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuZ3VpZCA9PT0gZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMubGFiZWxDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG5vdGlmeUZpbHRlclVwZGF0ZWRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmd1aWQgPT09IGV2ZW50LmRldGFpbCkge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmxhYmVsQ29udGVudFJlUmVuZGVyLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5hbWVDb21wb25lbnRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmd1aWQgPT09IGV2ZW50LmRldGFpbCkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMucG9wb3ZlclJlbmFtZUZvcm0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJSZW5hbWVGb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1wb3BvdmVyLXJlbmFtZS1mb3JtXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uZ3VpZCA9IHRoaXMuZ3VpZDtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJSZW5hbWVGb3JtLnJlZkVsZW1lbnQgPSB0aGlzLmhvc3RFbGVtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0ucG9wb3ZlclBhbmVsV2lkdGggPSB0aGlzLmhvc3RFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uaW50bFJlbmFtZUhlYWRlciA9IHRoaXMuc3RyaW5ncy5wb3BvdmVyUmVuYW1lSGVhZGVyO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uaW50bE9rID0gdGhpcy5zdHJpbmdzLm9rO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclJlbmFtZUZvcm0uaW50bENhbmNlbCA9IHRoaXMuc3RyaW5ncy5jYW5jZWw7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5pbnRsQ2xvc2UgPSB0aGlzLnN0cmluZ3MuY2xvc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyUmVuYW1lRm9ybS5pbnB1dFZhbHVlID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLm5hbWUgfHwgdGhpcy5nZXREaXNwbGF5RmllbGROYW1lKCkgfHwgdGhpcy5zdHJpbmdzLmxhYmVsO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5wb3BvdmVyUmVuYW1lRm9ybSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlTGFiZWxQYW5lbC5lbWl0KHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHBvcG92ZXJSZW5hbWVGb3JtRXZlbnRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmd1aWQgPT09IGV2ZW50LmRldGFpbFswXSkge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsWzFdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLm5hbWUgPSBldmVudC5kZXRhaWxbMV07XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbENvbnRlbnRSZVJlbmRlci5lbWl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gcHJpdmF0ZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzXG4gICAgLy8gbG9va3VwIHBvcHVwaW5mbyBmb3IgYWxpYXNcbiAgICBhc3luYyBnZXRGaWVsZHNGb3JMYWJlbGluZygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgICAgICBjb25zdCBsYXllckZpZWxkcyA9IGF3YWl0IGdldEZpZWxkc0Zyb21MYXllcih0aGlzLmxheWVyKTtcbiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLnBvcHVwVGVtcGxhdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWVsZEluZm9zKSB7XG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkc1dpdGhBbGlhcyA9IFtdO1xuICAgICAgICAgICAgICAgIGxheWVyRmllbGRzXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGxheWVyRmllbGQpID0+IFtcbiAgICAgICAgICAgICAgICAgICAgXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzbWFsbC1pbnRlZ2VyXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYmlnLWludGVnZXJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJpbnRlZ2VyXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2luZ2xlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZG91YmxlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibG9uZ1wiLFxuICAgICAgICAgICAgICAgICAgICBcImRhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkYXRlLW9ubHlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0aW1lLW9ubHlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0aW1lc3RhbXAtb2Zmc2V0XCIsXG4gICAgICAgICAgICAgICAgICAgIFwib2lkXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZ3VpZFwiLFxuICAgICAgICAgICAgICAgICAgICBcImdsb2JhbC1pZFwiXG4gICAgICAgICAgICAgICAgXS5pbmRleE9mKGxheWVyRmllbGQudHlwZSkgPiAtMSlcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goKGxheWVyRmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzV2l0aEFsaWFzID0gWy4uLmZpZWxkc1dpdGhBbGlhcywgbGF5ZXJGaWVsZC5jbG9uZSgpXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3B1cFRlbXBsYXRlLmZpZWxkSW5mb3MuZmluZCgocG9wdXBGaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvcHVwRmllbGQuZmllbGROYW1lID09PSBsYXllckZpZWxkLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNXaXRoQWxpYXNbZmllbGRzV2l0aEFsaWFzLmxlbmd0aCAtIDFdLmFsaWFzID0gcG9wdXBGaWVsZC5sYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkc1dpdGhBbGlhcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBsYXllckZpZWxkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRDbHVzdGVyRmllbGRzKHRoaXMucG9wdXBUZW1wbGF0ZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIG9wZW4gcG9wb3ZlclxuICAgIGFzeW5jIG9wZW5BdHRyaWJ1dGVzTGlzdCgpIHtcbiAgICAgICAgLy8gY2xvc2UgZmlyc3Qgc2luY2Ugd2UgY2FuIGhhdmUgbXVsdGlwbGUgYXR0cmlidXRlcyBvcGVuXG4gICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgdGhpcy5jYWxjaXRlRmxvd0l0ZW0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIC8vIGxhenkgbG9hZCBhdHRyaWJ1dGUgc2VsZWN0aW9uIGNvbXBvbmVudFxuICAgICAgICBpZiAoIXRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1maWVsZC1waWNrLWxpc3RcIik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3QucG9wb3ZlclByb3BzID0ge1xuICAgICAgICAgICAgICAgIHJlZkVsZW1lbnQ6IHRoaXMuY2FsY2l0ZUZsb3dJdGVtLFxuICAgICAgICAgICAgICAgIG9mZnNldFNraWRkaW5nOiA1MFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5maWVsZHMgPSB0aGlzLmxhYmVsRmllbGRzO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0LmxheWVyID0gdGhpcy5sYXllcjtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5tYXBWaWV3ID0gdGhpcy5tYXBWaWV3O1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0LnNob3dGaWVsZEluZm8gPVxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5zZWxlY3RlZEZpZWxkcyA9XG4gICAgICAgICAgICAgICAgW3RoaXMubGFiZWxDbGFzcy5nZXRMYWJlbEV4cHJlc3Npb25TaW5nbGVGaWVsZCgpXSB8fCBbXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RmllbGROYW1lRnJvbUFnZ3JlZ2F0aW9uRXhwcmVzc2lvbigpXG4gICAgICAgICAgICAgICAgXSB8fFxuICAgICAgICAgICAgICAgICAgICBbXTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRmllbGRQaWNrTGlzdERpc21pc3NlZFwiLCB0aGlzLmZpZWxkUGlja0xpc3RDaGFuZ2VzKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0KTtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZUxhYmVsUGFuZWwuZW1pdCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGNpdGVGbG93SXRlbS5sb2FkaW5nID0gZmFsc2U7XG4gICAgfVxuICAgIC8vIGdldCBmaWVsZG5hbWUgZnJvbSBjbHVzdGVyIGV4cHJlc3Npb25cbiAgICBnZXRGaWVsZE5hbWVGcm9tQWdncmVnYXRpb25FeHByZXNzaW9uKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZE5hbWUsIGV4cHJlc3Npb25dIG9mIHRoaXMuYWdncmVnYXRpb25FeHByZXNzaW9uTWFwcGluZykge1xuICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uID09PSAoKF9iID0gKF9hID0gdGhpcy5sYWJlbENsYXNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmV4cHJlc3Npb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZE5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIG9wZW4gcG9wb3ZlclxuICAgIG9wZW5MYWJlbFN0eWxlKCkge1xuICAgICAgICAvLyBjbG9zZSBmaXJzdCBzaW5jZSB3ZSBjYW4gaGF2ZSBtdWx0aXBsZSBhdHRyaWJ1dGVzIG9wZW5cbiAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAvLyBsYXp5IGxvYWQgYXR0cmlidXRlIHNlbGVjdGlvbiBjb21wb25lbnRcbiAgICAgICAgaWYgKCF0aGlzLmxhYmVsU3R5bGUpIHtcbiAgICAgICAgICAgIHRoaXMubGFiZWxTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtbGFiZWwtY29udGVudC1zdHlsZVwiKTtcbiAgICAgICAgICAgIHRoaXMubGFiZWxTdHlsZS5ndWlkID0gdGhpcy5ndWlkO1xuICAgICAgICAgICAgdGhpcy5sYWJlbFN0eWxlLmxhYmVsQ29udGVudFJlZkVsZW1lbnQgPSB0aGlzLmNhbGNpdGVGbG93SXRlbTtcbiAgICAgICAgICAgIHRoaXMubGFiZWxTdHlsZS5sYWJlbENsYXNzID0gdGhpcy5sYWJlbENsYXNzO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmxhYmVsU3R5bGUpO1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlTGFiZWxQYW5lbC5lbWl0KHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIG9wZW5BcmNhZGVFZGl0b3IoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIGlmICghdGhpcy5hcmNhZGVFZGl0b3IpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsY2l0ZUZsb3dJdGVtLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjYWRlRWRpdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1tb2RhbC1hcmNhZGVcIik7XG4gICAgICAgICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVTY3JpcHQgPSAoKF9hID0gdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5leHByZXNzaW9uKSB8fCBcIlwiO1xuICAgICAgICAgICAgdGhpcy5hcmNhZGVFZGl0b3IuYXJjYWRlUHJvZmlsZSA9IHRoaXMuZ2V0QXJjYWRlUHJvZmlsZSgpO1xuICAgICAgICAgICAgdGhpcy5hcmNhZGVFZGl0b3IudGVzdERhdGEgPSBhd2FpdCB0aGlzLmdldEFyY2FkZVRlc3REYXRhKCk7XG4gICAgICAgICAgICB0aGlzLmFyY2FkZUVkaXRvci5hZGRFeGlzdGluZ0V4cHJlc3Npb25zID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLmxheWVyID0gdGhpcy5sYXllcjtcbiAgICAgICAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLmFyY2FkZVRpdGxlID1cbiAgICAgICAgICAgICAgICAoKF9iID0gdGhpcy5sYWJlbENsYXNzLmxhYmVsRXhwcmVzc2lvbkluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50aXRsZSkgfHwgdGhpcy5zdHJpbmdzLm5ld0V4cHJlc3Npb247XG4gICAgICAgICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVUaXRsZUVkaXRhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjYWRlRWRpdG9yLnJldHVyblByZWRpY3RPdXRwdXRUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmFyY2FkZUVkaXRvci5hcmNhZGVUaXRsZUVkaXRpbmdFbmFibGVkID0gISgoX2MgPSB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRpdGxlKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5hcmNhZGVFZGl0b3IpO1xuICAgICAgICAgICAgdGhpcy5hcmNhZGVFZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc01vZGFsQXJjYWRlQ2xvc2VcIiwgKGV2ZW50KSA9PiB0aGlzLmFyY2FkZVNldHVwKGV2ZW50LmRldGFpbCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGFyY2FkZVNldHVwKGFyY2FkZU9iamVjdCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChhcmNhZGVPYmplY3QpIHtcbiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mby5leHByZXNzaW9uID0gYXJjYWRlT2JqZWN0LnNjcmlwdDtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MubGFiZWxFeHByZXNzaW9uSW5mby50aXRsZSA9IGFyY2FkZU9iamVjdC50aXRsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5sYWJlbEV4cHJlc3Npb25JbmZvID0ge1xuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiBhcmNhZGVPYmplY3Quc2NyaXB0LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogYXJjYWRlT2JqZWN0LnRpdGxlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubGFiZWxDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FsY2l0ZUZsb3dJdGVtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5hcmNhZGVFZGl0b3IpO1xuICAgICAgICB0aGlzLmFyY2FkZUVkaXRvciA9IG51bGw7XG4gICAgICAgIHRoaXMuYXJjYWRlQnRuLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGdldEFyY2FkZVByb2ZpbGUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJsYWJlbGluZ1wiLFxuICAgICAgICAgICAgZGVmaW5pdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAkZmVhdHVyZTogdGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyXG4gICAgICAgICAgICAgICAgICAgID8geyBmaWVsZHM6IGdldENsdXN0ZXJGaWVsZHModGhpcy5wb3B1cFRlbXBsYXRlLCBmYWxzZSkgfVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMubGF5ZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0QXJjYWRlVGVzdERhdGEoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZVZhcmlhYmxlSW5zdGFuY2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkZmVhdHVyZTogYXdhaXQgZ2V0U2luZ2xlQ2x1c3RlckZlYXR1cmUodGhpcy5tYXBWaWV3LCB0aGlzLmxheWVyLCB0aGlzLnBvcHVwVGVtcGxhdGUpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNwYXRpYWxSZWZlcmVuY2U6IHRoaXMubWFwVmlldy5zcGF0aWFsUmVmZXJlbmNlLFxuICAgICAgICAgICAgICAgICAgICB0aW1lWm9uZTogdGhpcy5tYXBWaWV3LnRpbWVab25lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB1cmw7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllci50eXBlID09PSBcInN1YnR5cGUtc3VibGF5ZXJcIikge1xuICAgICAgICAgICAgICAgIHVybCA9IHRoaXMubGF5ZXIucGFyZW50LnVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHVybCA9IHRoaXMubGF5ZXIudXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwcm9maWxlVmFyaWFibGVJbnN0YW5jZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgJGZlYXR1cmU6IChhd2FpdCBnZXRTaW5nbGVGZWF0dXJlKHRoaXMubGF5ZXIsIHRoaXMubWFwVmlldykpLmZlYXR1cmVzWzBdLFxuICAgICAgICAgICAgICAgICAgICAkbGF5ZXI6IHRoaXMubGF5ZXIsXG4gICAgICAgICAgICAgICAgICAgICRtYXA6IHRoaXMubWFwVmlldy5tYXAsXG4gICAgICAgICAgICAgICAgICAgICRkYXRhc3RvcmU6IHVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZTogdGhpcy5tYXBWaWV3LnNwYXRpYWxSZWZlcmVuY2UsXG4gICAgICAgICAgICAgICAgdGltZVpvbmU6IHRoaXMubWFwVmlldy50aW1lWm9uZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXREaXNwbGF5RmllbGROYW1lKCkge1xuICAgICAgICBjb25zdCBsYWJlbEZpZWxkTmFtZSA9IHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uY2x1c3RlclxuICAgICAgICAgICAgPyB0aGlzLmdldEZpZWxkTmFtZUZyb21BZ2dyZWdhdGlvbkV4cHJlc3Npb24oKVxuICAgICAgICAgICAgOiB0aGlzLmxhYmVsQ2xhc3MuZ2V0TGFiZWxFeHByZXNzaW9uU2luZ2xlRmllbGQoKTtcbiAgICAgICAgY29uc3QgdGVtcEZpZWxkID0gdGhpcy5sYWJlbEZpZWxkcy5maW5kKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZpZWxkLm5hbWUgPT09IGxhYmVsRmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICh0ZW1wRmllbGQgPT09IG51bGwgfHwgdGVtcEZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wRmllbGQuYWxpYXMpIHx8IGxhYmVsRmllbGROYW1lO1xuICAgIH1cbiAgICAvLyByZW5kb3IgbWV0aG9kc1xuICAgIGFkZFNjYWxlUmFuZ2VTbGlkZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGFiZWxDbGFzcyB9ID0gdGhpcztcbiAgICAgICAgbG9hZE1vZHVsZXMoW1wiZXNyaS93aWRnZXRzL1NjYWxlUmFuZ2VTbGlkZXJcIl0pLnRoZW4oKFtTY2FsZVJhbmdlU2xpZGVyXSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGNvbnN0IHNsaWRlckVsZW1lbnQgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJzbGlkZXJfSWRcIik7XG4gICAgICAgICAgICBjb25zdCBzY2FsZVJhbmdlU2xpZGVyID0gbmV3IFNjYWxlUmFuZ2VTbGlkZXIoe1xuICAgICAgICAgICAgICAgIHZpZXc6IHRoaXMubWFwVmlldyxcbiAgICAgICAgICAgICAgICByZWdpb246ICgoX2EgPSB0aGlzLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlZ2lvbikgfHwgKChfYiA9IHRoaXMucG9ydGFsKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0UmVnaW9uKCkudG9Mb3dlckNhc2UoKSkgfHwgXCJ3b1wiLFxuICAgICAgICAgICAgICAgIG1pblNjYWxlOiBsYWJlbENsYXNzLm1pblNjYWxlIHx8IDAsXG4gICAgICAgICAgICAgICAgbWF4U2NhbGU6IGxhYmVsQ2xhc3MubWF4U2NhbGUgfHwgMFxuICAgICAgICAgICAgfSwgc2xpZGVyRWxlbWVudCk7XG4gICAgICAgICAgICBzbGlkZXJFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTChcImFmdGVyYmVnaW5cIiwgYDxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJHt0aGlzLmNvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzXCIgLz5gKTtcbiAgICAgICAgICAgIHNjYWxlUmFuZ2VTbGlkZXIud2F0Y2goW1wibWluU2NhbGVcIiwgXCJtYXhTY2FsZVwiXSwgKHZhbHVlLCBfb2xkVmFsdWUsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gXCJtaW5TY2FsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsQ2xhc3MubWluU2NhbGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZSA9PT0gXCJtYXhTY2FsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsQ2xhc3MubWF4U2NhbGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDb250ZW50UmVSZW5kZXIuZW1pdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBjb25zdCB7IGJsb2NrT3BlbiwgZ3VpZCwgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgYWxsb3dFeHByZXNzaW9ucyA9IHRoaXMuc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5mZWF0dXJlIHx8XG4gICAgICAgICAgICAodGhpcy5zZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLm1hcEltYWdlICYmXG4gICAgICAgICAgICAgICAgKChfYiA9IChfYSA9IHRoaXMubGF5ZXIubGF5ZXIuY2FwYWJpbGl0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXhwb3J0TWFwKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3VwcG9ydHNBcmNhZGVFeHByZXNzaW9uRm9yTGFiZWxpbmcpKTtcbiAgICAgICAgY29uc3QgbGFiZWxBdHRyaWJ1dGVCbG9jayA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLmxhYmVsQXR0cmlidXRlLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5maWVsZEV4cHJlc3Npb25EaXYgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBhbGxvd0V4cHJlc3Npb25zID8gQ1NTLmxhYmVsQ29udGVudEJ1dHRvbkV4cCA6IENTUy5sYWJlbENvbnRlbnRCdXR0b25TZWN0aW9uIH0sIGgoXCJidXR0b25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuYXR0cmlidXRlc0J0biA9IGVsKSwgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b24sIHRpdGxlOiBzdHJpbmdzLmZpZWxkLCBvbkNsaWNrOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5BdHRyaWJ1dGVzTGlzdCgpO1xuICAgICAgICAgICAgfSB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uVGV4dCB9LCB0aGlzLmdldERpc3BsYXlGaWVsZE5hbWUoKSB8fFxuICAgICAgICAgICAgKChfYyA9IHRoaXMubGFiZWxDbGFzcy5sYWJlbEV4cHJlc3Npb25JbmZvKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudGl0bGUpIHx8XG4gICAgICAgICAgICBzdHJpbmdzLm5ld0V4cHJlc3Npb24pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uSWNvbiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNoZXZyb24tZG93blwiIH0pKSkpLCBhbGxvd0V4cHJlc3Npb25zICYmIChoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuYXJjYWRlQnRuID0gZWwpLCBzY2FsZTogXCJzXCIsIHRleHQ6IHN0cmluZ3MuZXhwcmVzc2lvbiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuQXJjYWRlRWRpdG9yKCk7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY29kZVwiIH0pKSkpKSk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmlsdGVyQmxvY2sgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5maWx0ZXIsIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvblNlY3Rpb24gfSwgaChcImJ1dHRvblwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5maWx0ZXJCdG4gPSBlbCksIGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uLCB0aXRsZTogc3RyaW5ncy5lZGl0TGFiZWxGaWx0ZXIsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMYWJlbFBvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubGFiZWxGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbEZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtbGFiZWwtY29udGVudC1maWx0ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxGaWx0ZXIuZ3VpZCA9IHRoaXMuZ3VpZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbEZpbHRlci5sYWJlbEZpbHRlclJlZkVsZW1lbnQgPSB0aGlzLmNhbGNpdGVGbG93SXRlbTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbEZpbHRlci5sYWJlbENsYXNzID0gdGhpcy5sYWJlbENsYXNzO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubGFiZWxGaWx0ZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVMYWJlbFBhbmVsLmVtaXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uVGV4dCB9LCBzdHJpbmdzLmVkaXRMYWJlbEZpbHRlciksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b25JY29uIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY2hldnJvbi1kb3duXCIgfSkpKSkpKTtcbiAgICAgICAgY29uc3QgbGFiZWxTdHlsZUJsb2NrID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MubGFiZWxTdHlsZSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MubGFiZWxDb250ZW50QnV0dG9uU2VjdGlvbiB9LCBoKFwiYnV0dG9uXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnN0eWxlQnRuID0gZWwpLCBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvbiwgdGl0bGU6IHN0cmluZ3MuZWRpdExhYmVsU3R5bGUsIG9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbkxhYmVsU3R5bGUoKTtcbiAgICAgICAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogQ1NTLmxhYmVsQ29udGVudEJ1dHRvblRleHQgfSwgc3RyaW5ncy5lZGl0TGFiZWxTdHlsZSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IENTUy5sYWJlbENvbnRlbnRCdXR0b25JY29uIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY2hldnJvbi1kb3duXCIgfSkpKSkpKTtcbiAgICAgICAgY29uc3Qgc2xpZGVyQmxvY2sgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy52aXNpYmxlUmFuZ2UsIGgoXCJkaXZcIiwgeyBpZDogXCJzbGlkZXJfSWRcIiB9KSkpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtYmxvY2tcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCksIGhlYWRpbmc6IHRoaXMubGFiZWxDbGFzcy5uYW1lIHx8IHRoaXMuZ2V0RGlzcGxheUZpZWxkTmFtZSgpIHx8IHRoaXMuc3RyaW5ncy5sYWJlbCwgY29sbGFwc2libGU6IHRydWUsIG9wZW46IGJsb2NrT3BlbiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250cm9sXCIgfSwgaChcImFyY2dpcy1jYWxjaXRlLWJsb2NrLW9wdGlvbnNcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuYmxvY2tPcHRpb25zID0gZWwpLCBndWlkOiBndWlkLCBpbnRsT3B0aW9uczogc3RyaW5ncy5vcHRpb25zLCBpbnRsRGVsZXRlOiBzdHJpbmdzLmRlbGV0ZSwgaW50bER1cGxpY2F0ZTogc3RyaW5ncy5kdXBsaWNhdGUsIGludGxSZW5hbWU6IHN0cmluZ3MucmVuYW1lLCBjYWxjaXRlQmxvY2tPcHRpb25zOiB7IGhhc0RlbGV0ZTogdHJ1ZSwgaGFzRHVwbGljYXRlOiB0cnVlLCBoYXNSZW5hbWU6IHRydWUgfSB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImljb25cIiB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwibVwiLCBpY29uOiBcImxhYmVsXCIgfSkpLCBsYWJlbEF0dHJpYnV0ZUJsb2NrLCB0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ub2djRmVhdHVyZSB8fFxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLndmcyB8fFxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZSA9PT0gc2VydmljZVR5cGVFbnVtLnN1YnR5cGVcbiAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgOiBsYWJlbEZpbHRlckJsb2NrLCBsYWJlbFN0eWxlQmxvY2ssIHNsaWRlckJsb2NrKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTGFiZWxDb250ZW50LnN0eWxlID0gYXJjZ2lzTGFiZWxDb250ZW50Q3NzO1xuXG5jb25zdCBhcmNnaXNMYWJlbENvbnRlbnRTdHlsZUNzcyA9IFwiLm9mZnNldC1kaXZ7YWxpZ24taXRlbXM6Y2VudGVyO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtnYXA6MTZweH1cIjtcblxuY29uc3QgQXJjZ2lzTGFiZWxDb250ZW50U3R5bGUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmNsb3NlTGFiZWxQb3BvdmVycyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY2xvc2VMYWJlbFBvcG92ZXJzXCIsIDcpO1xuICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5vdGlmeVN5bWJvbENoYW5nZXNcIiwgNyk7XG4gICAgICAgIHRoaXMubWluTWF4T2Zmc2V0ID0ge1xuICAgICAgICAgICAgbWluT2Zmc2V0WDogLTIwLFxuICAgICAgICAgICAgbWluT2Zmc2V0WTogLTIwLFxuICAgICAgICAgICAgbWF4T2Zmc2V0WDogMjAsXG4gICAgICAgICAgICBtYXhPZmZzZXRZOiAyMFxuICAgICAgICB9O1xuICAgICAgICAvLyBvcGVuIGZvbnQgcG9wb3ZlclxuICAgICAgICB0aGlzLm9wZW5Gb250UG9wb3ZlciA9ICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXJjZ2lzRm9udFBpY2tlcikge1xuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZvbnQtcGlja2VyXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5mb250TWFwID0gdGhpcy5mb250TWFwO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlci5mb250ID0gKF9iID0gKF9hID0gdGhpcy5sYWJlbENsYXNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3ltYm9sKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9udDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIucG9wb3ZlclByb3BzID0ge1xuICAgICAgICAgICAgICAgICAgICByZWZFbGVtZW50OiB0aGlzLnBhbmVsRWxlbWVudFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGb250UGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGb250UGlja2VyRGlzbWlzc2VkXCIsIHRoaXMuY2xvc2VGb250UG9wdmVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZvbnRQaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc0ZvbnRQaWNrZXJDaGFuZ2VcIiwgdGhpcy5jaGFuZ2VGb250KTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXJjZ2lzRm9udFBpY2tlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xvc2VGb250UG9wdmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXJjZ2lzRm9udFBpY2tlcikge1xuICAgICAgICAgICAgICAgIHRoaXMucGFuZWxFbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmFyY2dpc0ZvbnRQaWNrZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzRm9udFBpY2tlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3Qgd29yayB3aXRob3V0IHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYW5lbEVsZW1lbnQuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNoYW5nZUZvbnQgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBjb25zdCBmb250ID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LmRldGFpbDtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsQ2xhc3NGb250ID0gKF9iID0gKF9hID0gdGhpcy5sYWJlbENsYXNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3ltYm9sKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9udDtcbiAgICAgICAgICAgIGlmIChmb250ICYmIGxhYmVsQ2xhc3NGb250KSB7XG4gICAgICAgICAgICAgICAgbGFiZWxDbGFzc0ZvbnQuZmFtaWx5ID0gZm9udC5mYW1pbHk7XG4gICAgICAgICAgICAgICAgbGFiZWxDbGFzc0ZvbnQud2VpZ2h0ID0gZm9udC53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgbGFiZWxDbGFzc0ZvbnQuc3R5bGUgPSBmb250LnN0eWxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ndWlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxhYmVsQ29udGVudFJlZkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFiZWxDbGFzcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9IGZhbHNlO1xuICAgIH1cbiAgICAvLyBsaWZlY3ljbGUgbWV0aG9kc1xuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmxheWVyID0gbGFiZWxTdGF0ZS5sYXllcjtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSBsYWJlbFN0YXRlLnBvcnRhbDtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gbGFiZWxTdGF0ZS5zdHJpbmdzO1xuICAgICAgICB0aGlzLmxheWVyR2VvbWV0cnlUeXBlID0gbGFiZWxTdGF0ZS5sYXllckdlb21ldHJ5VHlwZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZSA9IGxhYmVsU3RhdGUuc2VydmljZVR5cGU7XG4gICAgICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9IGxhYmVsU3RhdGUubGF5ZXJEaXNwbGF5VHlwZTtcbiAgICAgICAgdGhpcy5mb250TWFwID1cbiAgICAgICAgICAgIHRoaXMuc2VydmljZVR5cGUgPT09IHNlcnZpY2VUeXBlRW51bS5tYXBJbWFnZSA/IG1hcFNlcnZpY2Vmb250TWFwIDogZmVhdHVyZVNlcnZpY2VGb250TWFwO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgICAgIC8vIG5lZWQgdGltZW91dCBiZWNhdXNlIG9mIHJlLXJlbmRlclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnBhbmVsRWxlbWVudC5zZXRGb2N1cygpKSwgMjAwKTtcbiAgICB9XG4gICAgLy8gUHVibGljIG1ldGhvZFxuICAgIGFzeW5jIHJlcG9zaXRpb24oKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5wb3BvdmVyTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcG9zaXRpb24oKTtcbiAgICB9XG4gICAgLy8gRXZlbnRzXG4gICAgYXN5bmMgY2FsY2l0ZUJsb2NrU2VjdGlvblRvZ2dsZUhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbXBvc2VkUGF0aCA9IGV2ZW50LmNvbXBvc2VkUGF0aCgpO1xuICAgICAgICAvLyBoYWxvXG4gICAgICAgIGlmICgoY29tcG9zZWRQYXRoID09PSBudWxsIHx8IGNvbXBvc2VkUGF0aCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29tcG9zZWRQYXRoWzBdLmlkKSA9PT0gXCJoYWxvQmxvY2tfSWRcIikge1xuICAgICAgICAgICAgaWYgKHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZW1wSGFsb0NvbG9yID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvQ29sb3I7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvQ29sb3IgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9Db2xvclwiXSkudGhlbihhc3luYyAoW0NvbG9yXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yID0gdGhpcy50ZW1wSGFsb0NvbG9yIHx8IG5ldyBDb2xvcihcIndoaXRlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmhhbG9TaXplID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvU2l6ZSB8fCAxICogMC43NTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFsb0NvbG9yUGlja2VyQ29tcG9uZW50ID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwiaGFsb0NvbG9yUGlja2VyX0lkXCIpO1xuICAgICAgICAgICAgICAgICAgICBoYWxvQ29sb3JQaWNrZXJDb21wb25lbnQuY29sb3IgPSAoKF9hID0gdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvQ29sb3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0hleCgpKSB8fCBcIiNmZmZmZmZcIjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJtYW5hZ2VQb3BvdmVyX0lkXCIpW1wicmVwb3NpdGlvblwiXSgpO1xuICAgIH1cbiAgICAvLyBwcml2YXRlIG1ldGhvZHMgYW5kIHByb3BlcnRpZXNcbiAgICBnZXRQbGFjZW1lbnRBcnJheShsYXllckdlb21ldHJ5VHlwZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIgJiZcbiAgICAgICAgICAgICgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2ludFwiIHx8IGxheWVyR2VvbWV0cnlUeXBlID09PSBcIm11bHRpcG9pbnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIHBsYWNlbWVudFBvaW50O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxheWVyR2VvbWV0cnlUeXBlID09PSBcInBvbHlsaW5lXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBwbGFjZW1lbnRMaW5lO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNoYW5nZU9mZnNldChvZmZzZXQpIHtcbiAgICAgICAgdGhpcy5sYWJlbENsYXNzLnN5bWJvbC54b2Zmc2V0ID0gb2Zmc2V0Lng7XG4gICAgICAgIHRoaXMub2Zmc2V0WEVsZW1lbnQudmFsdWUgPSB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLnhvZmZzZXQ7XG4gICAgICAgIHRoaXMub2Zmc2V0WFlTbGlkZXIueCA9IG9mZnNldC54O1xuICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLnlvZmZzZXQgPSBvZmZzZXQueTtcbiAgICAgICAgdGhpcy5vZmZzZXRZRWxlbWVudC52YWx1ZSA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wueW9mZnNldDtcbiAgICAgICAgdGhpcy5vZmZzZXRYWVNsaWRlci55ID0gLW9mZnNldC55O1xuICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgIH1cbiAgICAvLyByZW5kb3IgbWV0aG9kc1xuICAgIHBsYWNlbWVudFNlbGVjdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoISh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIgJiZcbiAgICAgICAgICAgICgoX2EgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCIpICYmXG4gICAgICAgICAgICAoKFtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlVHlwZUVudW0uZmVhdHVyZSxcbiAgICAgICAgICAgICAgICBzZXJ2aWNlVHlwZUVudW0uY3N2LFxuICAgICAgICAgICAgICAgIHNlcnZpY2VUeXBlRW51bS5nZW9qc29uLFxuICAgICAgICAgICAgICAgIHNlcnZpY2VUeXBlRW51bS5vZ2NGZWF0dXJlXG4gICAgICAgICAgICBdLmluZGV4T2YodGhpcy5zZXJ2aWNlVHlwZSkgPiAtMSAmJlxuICAgICAgICAgICAgICAgICh0aGlzLmxheWVyR2VvbWV0cnlUeXBlID09PSBcInBvaW50XCIgfHwgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJtdWx0aXBvaW50XCIpKSB8fFxuICAgICAgICAgICAgICAgICh0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9pbnRcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJtdWx0aXBvaW50XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgPT09IFwicG9seWxpbmVcIikpKSkge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3MucGxhY2VtZW50LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogdGhpcy5zdHJpbmdzLnBsYWNlbWVudCwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLmxhYmVsUGxhY2VtZW50ID0gZXZlbnQuY3VycmVudFRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5wbGFjZW1lbnROb2RlID0gbm9kZSkgfSwgdGhpcy5nZXRQbGFjZW1lbnRBcnJheSh0aGlzLmxheWVyR2VvbWV0cnlUeXBlKS5tYXAoKHBsYWNlbWVudCkgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBwbGFjZW1lbnQsIHNlbGVjdGVkOiB0aGlzLmxhYmVsQ2xhc3MubGFiZWxQbGFjZW1lbnQgPT09IHBsYWNlbWVudCA/IHRydWUgOiBmYWxzZSB9LCB0aGlzLnN0cmluZ3NbcGxhY2VtZW50XSB8fCBwbGFjZW1lbnQpKSkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZztcbiAgICAgICAgY29uc3QgaXNCaW5uaW5nID0gdGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5jbHVzdGVyICYmXG4gICAgICAgICAgICAoKF9hID0gdGhpcy5sYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiO1xuICAgICAgICBjb25zdCBmb250RmFtaWx5U2VsZWN0aW9uID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5mb250LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhbGlnbm1lbnQ6IFwiaWNvbi1lbmQtc3BhY2UtYmV0d2VlblwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvbkVuZDogXCJjaGV2cm9uLWRvd25cIiwgbGFiZWw6IGZvbnRUb0ZvbnROYW1lKChfYyA9IChfYiA9IHRoaXMubGFiZWxDbGFzcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN5bWJvbCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZvbnQpLCB3aWR0aDogXCJmdWxsXCIsIHNjYWxlOiBcIm1cIiwgb25DbGljazogdGhpcy5vcGVuRm9udFBvcG92ZXIsIHJlZjogKG5vZGUpID0+ICh0aGlzLmZvbnROb2RlID0gbm9kZSkgfSwgZm9udFRvRm9udE5hbWUoKF9lID0gKF9kID0gdGhpcy5sYWJlbENsYXNzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3ltYm9sKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuZm9udCkpKSk7XG4gICAgICAgIGNvbnN0IGZvbnRTaXplU2VsZWN0aW9uID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5zaXplLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwibnVtYmVyXCIsIHNjYWxlOiBcInNcIiwgbWluOiA1LCBtYXg6IDEyNSwgdmFsdWU6IGAke3RoaXMubGFiZWxDbGFzcy5zeW1ib2wuZm9udC5zaXplIC8gMC43NSB8fCA1fWAsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdE9uVXNlcihldmVudCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLmZvbnQuc2l6ZSA9IE51bWJlcihub2RlLnZhbHVlKSAqIDAuNzU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U3ltYm9sQ2hhbmdlcy5lbWl0KHRoaXMuZ3VpZCk7XG4gICAgICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwib2Zmc2V0LWRpdlwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5vZmZzZXQsIGgoXCJhcmNnaXMteHktc2xpZGVyXCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldFhZU2xpZGVyID0gZWw7XG4gICAgICAgICAgICB9LCB4OiB0aGlzLmxhYmVsQ2xhc3Muc3ltYm9sLnhvZmZzZXQgfHwgMCwgeTogLXRoaXMubGFiZWxDbGFzcy5zeW1ib2wueW9mZnNldCB8fCAwLCBtaW5YOiB0aGlzLm1pbk1heE9mZnNldC5taW5PZmZzZXRYLCBtaW5ZOiB0aGlzLm1pbk1heE9mZnNldC5taW5PZmZzZXRZLCBtYXhYOiB0aGlzLm1pbk1heE9mZnNldC5tYXhPZmZzZXRYLCBtYXhZOiB0aGlzLm1pbk1heE9mZnNldC5tYXhPZmZzZXRZLCBzdGVwOiAxLCBzbmFwcGFibGU6IHRydWUsIG9uQXJjZ2lzWFlTbGlkZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2xpZGVyID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZU9mZnNldCh7XG4gICAgICAgICAgICAgICAgICAgIHg6IHNsaWRlci54IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHk6IC1zbGlkZXIueSB8fCAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IH0pKSwgaChcImRpdlwiLCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBcInNcIiB9LCB0aGlzLnN0cmluZ3Mub2Zmc2V0WCwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIHBsYWNlaG9sZGVyOiB0aGlzLnN0cmluZ3Mub2Zmc2V0WCwgdmFsdWU6IGAke3RoaXMubGFiZWxDbGFzcy5zeW1ib2wueG9mZnNldCB8fCAwfWAsIG1pbjogdGhpcy5taW5NYXhPZmZzZXQubWluT2Zmc2V0WCwgbWF4OiB0aGlzLm1pbk1heE9mZnNldC5tYXhPZmZzZXRYLCByZWY6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRYRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndhaXRPblVzZXIoZXZlbnQsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VPZmZzZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogTnVtYmVyKHRoaXMub2Zmc2V0WEVsZW1lbnQudmFsdWUpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBOdW1iZXIodGhpcy5vZmZzZXRZRWxlbWVudC52YWx1ZSkgfHwgMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0gfSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBcInNcIiB9LCB0aGlzLnN0cmluZ3Mub2Zmc2V0WSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIHBsYWNlaG9sZGVyOiB0aGlzLnN0cmluZ3Mub2Zmc2V0WSwgdmFsdWU6IGAke3RoaXMubGFiZWxDbGFzcy5zeW1ib2wueW9mZnNldCB8fCAwfWAsIG1pbjogdGhpcy5taW5NYXhPZmZzZXQubWluT2Zmc2V0WSwgbWF4OiB0aGlzLm1pbk1heE9mZnNldC5tYXhPZmZzZXRZLCByZWY6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRZRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndhaXRPblVzZXIoZXZlbnQsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VPZmZzZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogTnVtYmVyKHRoaXMub2Zmc2V0WEVsZW1lbnQudmFsdWUpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBOdW1iZXIodGhpcy5vZmZzZXRZRWxlbWVudC52YWx1ZSkgfHwgMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0gfSkpKSkpO1xuICAgICAgICBjb25zdCBhbGxvd092ZXJydW4gPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBhbGlnbm1lbnQ6IFwic3RhcnRcIiwgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgdGhpcy5zdHJpbmdzLmFsbG93T3ZlcnJ1biwgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgc2NhbGU6IFwic1wiLCBjaGVja2VkOiB0aGlzLmxhYmVsQ2xhc3MuYWxsb3dPdmVycnVuLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5hbGxvd092ZXJydW4gPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICBjb25zdCByZXBlYXRMYWJlbCA9IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGFsaWdubWVudDogXCJzdGFydFwiLCBsYXlvdXQ6IFwiaW5saW5lLXNwYWNlLWJldHdlZW5cIiB9LCB0aGlzLnN0cmluZ3MucmVwZWF0TGFiZWwsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogdGhpcy5sYWJlbENsYXNzLnJlcGVhdExhYmVsLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5yZXBlYXRMYWJlbCA9IGV2ZW50LnRhcmdldC5jaGVja2VkO1xuICAgICAgICAgICAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICBjb25zdCByZXBlYXRMYWJlbERpc3RhbmNlID0gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5sYWJlbFJlcGVhdCwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBkaXNhYmxlZDogIXRoaXMubGFiZWxDbGFzcy5yZXBlYXRMYWJlbCwgdHlwZTogXCJudW1iZXJcIiwgc2NhbGU6IFwic1wiLCBtaW46IDAsIHZhbHVlOiBgJHt0aGlzLmxhYmVsQ2xhc3MucmVwZWF0TGFiZWxEaXN0YW5jZSB8fCAwfWAsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdE9uVXNlcihldmVudCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2xhc3MucmVwZWF0TGFiZWxEaXN0YW5jZSA9IE51bWJlcihub2RlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICAgICAgY29uc3QgaGFsb0Jsb2NrID0gdGhpcy5wYW5lbEVsZW1lbnQgJiYgKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyBpZDogXCJoYWxvQmxvY2tfSWRcIiwgdGV4dDogdGhpcy5zdHJpbmdzLmhhbG8sIHRvZ2dsZURpc3BsYXk6IFwic3dpdGNoXCIsIG9wZW46IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yID8gdHJ1ZSA6IGZhbHNlIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgaChcImFyY2dpcy1jb2xvci1pbnB1dFwiLCB7IGlkOiBcImhhbG9Db2xvclBpY2tlcl9JZFwiLCBjb2xvcjogKChfZiA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb0NvbG9yKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YudG9IZXgoKSkgfHwgXCIjZmZmZmZmXCIsIHBvcG92ZXJQcm9wczoge1xuICAgICAgICAgICAgICAgIHJlZkVsZW1lbnQ6IHRoaXMucGFuZWxFbGVtZW50LFxuICAgICAgICAgICAgICAgIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsXG4gICAgICAgICAgICAgICAgb2Zmc2V0RGlzdGFuY2U6IC1NYXRoLnJvdW5kKHRoaXMucGFuZWxFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXRTa2lkZGluZzogNTBcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dENoYW5nZTogYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VyckNvbG9yID0gZXZlbnQudGFyZ2V0LmNvbG9yO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvQ29sb3JcIl0pLnRoZW4oKFtDb2xvcl0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvQ29sb3IgPSBuZXcgQ29sb3IoY3VyckNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJPcGVuOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gZ2l2ZSBpdCBzb21lIHRpbWUgaW4gY2FzZSBhbm90aGVyIGFyY2dpcy1jb2xvci1pbnB1dCBoYXMgdG8gY2xvc2UgZmlyc3RcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJDbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9udE5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudE5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gfSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLnN0cmluZ3Muc2l6ZSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcIm51bWJlclwiLCBzY2FsZTogXCJzXCIsIG1pbjogMSwgbWF4OiAxMCwgdmFsdWU6IGAke01hdGgucm91bmQodGhpcy5sYWJlbENsYXNzLnN5bWJvbC5oYWxvU2l6ZSAvIDAuNzUgfHwgMSl9YCwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy53YWl0T25Vc2VyKGV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuaGFsb1NpemUgPSBOdW1iZXIobm9kZS52YWx1ZSkgKiAwLjc1O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVN5bWJvbENoYW5nZXMuZW1pdCh0aGlzLmd1aWQpO1xuICAgICAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICAgICAgfSB9KSkpKTtcbiAgICAgICAgY29uc3QgcGFuZWxSZWN0ID0gdGhpcy5sYWJlbENvbnRlbnRSZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgaWQ6IFwibWFuYWdlUG9wb3Zlcl9JZFwiLCBwbGFjZW1lbnQ6IFwibGVhZGluZy1zdGFydFwiLCBvcGVuOiB0aGlzLmlzT3BlbiwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCByZWZlcmVuY2VFbGVtZW50OiB0aGlzLmxhYmVsQ29udGVudFJlZkVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiAtTWF0aC5yb3VuZCh0aGlzLmxhYmVsQ29udGVudFJlZkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGgpLCBvZmZzZXRTa2lkZGluZzogNTAsIGxhYmVsOiBcIlwiLCBzdHlsZToge1xuICAgICAgICAgICAgICAgIHpJbmRleDogXCIxMDBcIlxuICAgICAgICAgICAgfSwgdHJpZ2dlckRpc2FibGVkOiB0cnVlLCByZWY6IChub2RlKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnBhbmVsRWxlbWVudCA9IGVsKSwgY2xvc2FibGU6IHRydWUsIGNsYXNzOiBcInBhbmVsXCIsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke3BhbmVsUmVjdC53aWR0aH1weGAsXG4gICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBgJHtwYW5lbFJlY3QuaGVpZ2h0ICogMC44fXB4YFxuICAgICAgICAgICAgfSwgb25DYWxjaXRlUGFuZWxDbG9zZTogKCkgPT4gdGhpcy5jbG9zZUxhYmVsUG9wb3ZlcnMuZW1pdCgpIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlci1jb250ZW50XCIgfSwgdGhpcy5zdHJpbmdzLmxhYmVsU3R5bGUpLCBoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGhlYWRpbmc6IFwiXCIsIGNvbGxhcHNpYmxlOiBmYWxzZSwgb3BlbjogdHJ1ZSB9LCBmb250RmFtaWx5U2VsZWN0aW9uLCBcIiBcIiwgZm9udFNpemVTZWxlY3Rpb24sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jb2xvciwgdGhpcy5wYW5lbEVsZW1lbnQgJiYgKGgoXCJhcmNnaXMtY29sb3ItaW5wdXRcIiwgeyBjb2xvcjogKChfZyA9IHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuY29sb3IpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy50b0hleCgpKSB8fCBcIiNmZmZmZmZcIiwgcG9wb3ZlclByb3BzOiB7XG4gICAgICAgICAgICAgICAgcmVmRWxlbWVudDogdGhpcy5wYW5lbEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgcGxhY2VtZW50OiBcImxlYWRpbmctc3RhcnRcIixcbiAgICAgICAgICAgICAgICBvZmZzZXREaXN0YW5jZTogLU1hdGgucm91bmQodGhpcy5wYW5lbEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGgpLFxuICAgICAgICAgICAgICAgIG9mZnNldFNraWRkaW5nOiA1MCxcbiAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IGAke3BhbmVsUmVjdC5oZWlnaHQgKiAwLjggLSA1Mn1weGAgLy8gbWludXMgcGFuZWxoZWFkZXIgaGVpZ2h0XG4gICAgICAgICAgICB9LCBvbkFyY2dpc0NvbG9ySW5wdXRDaGFuZ2U6IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJDb2xvciA9IGV2ZW50LnRhcmdldC5jb2xvcjtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL0NvbG9yXCJdKS50aGVuKChbQ29sb3JdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDbGFzcy5zeW1ib2wuY29sb3IgPSBuZXcgQ29sb3IoY3VyckNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTeW1ib2xDaGFuZ2VzLmVtaXQodGhpcy5ndWlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJPcGVuOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gZ2l2ZSBpdCBzb21lIHRpbWUgaW4gY2FzZSBhbm90aGVyIGFyY2dpcy1jb2xvci1pbnB1dCBoYXMgdG8gY2xvc2UgZmlyc3RcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50Tm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzQ29sb3JJbnB1dFBvcG92ZXJDbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9udE5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudE5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gfSkpKSwgdGhpcy5wbGFjZW1lbnRTZWxlY3Rpb24oKSwgaXNCaW5uaW5nIHx8IHRoaXMubGF5ZXJHZW9tZXRyeVR5cGUgIT09IFwicG9seWxpbmVcIiA/IG9mZnNldCA6IG51bGwsICFpc0Jpbm5pbmcgJiYgdGhpcy5sYXllckdlb21ldHJ5VHlwZSA9PT0gXCJwb2x5bGluZVwiID8gKGgoXCJkaXZcIiwgbnVsbCwgYWxsb3dPdmVycnVuLCBcIiBcIiwgcmVwZWF0TGFiZWwsIFwiIFwiLCByZXBlYXRMYWJlbERpc3RhbmNlKSkgOiBudWxsLCBoYWxvQmxvY2spKSkpKTtcbiAgICB9XG4gICAgd2FpdE9uVXNlcihldmVudCwgZG9DaGFuZ2UsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAvLyBmb3IgbnVtYmVyIGZpZWxkcyB3ZSBkb24ndCB3YW50IHRvIGFsbG93IGFuIGVtcHR5IHZhbHVlXG4gICAgICAgIC8vIG9yIHZhbHVlIG91dHNpZGUgdGhlIHJhbmdlXG4gICAgICAgIC8vIGJ1dCB0aGUgdXNlciBtaWdodCBzaG9ydGx5IHVzZSBhbiBlbXB0eSBpbnB1dCBib3hcbiAgICAgICAgLy8gd2hpbGUgdHlwaW5nIGEgbmV3IHZhbHVlXG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmICh0aGlzLnR5cGluZ0huZGwpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnR5cGluZ0huZGwpO1xuICAgICAgICAgICAgdGhpcy50eXBpbmdIbmRsID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbCA9IG5vZGUudmFsdWU7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPlwiLCB2YWwsIFwiPFwiKTtcbiAgICAgICAgY29uc3QgcGFyc2VkVmFsID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgICAgICBpZiAoIXZhbCkge1xuICAgICAgICAgICAgLy8gdW5kZWZpbmVkIG9yIGVtcHR5IHN0cmluZ1xuICAgICAgICAgICAgLy8gdXNlciBtaWdodCBiZSBpbiB0aGUgbWlkZGxlIG9mIHR5cGluZ1xuICAgICAgICAgICAgLy8gZ2l2ZSB0aGUgdXNlciAyIHNlY29uZHMgdG8gZmlsbCBpbiBlbXB0eSBlbnRyeVxuICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHVzZSBkZWZhdWx0IHZhbHVlXG4gICAgICAgICAgICB0aGlzLnR5cGluZ0huZGwgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGluZ0huZGwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgbm9kZS52YWx1ZSA9IGAke2RlZmF1bHRWYWx1ZX1gO1xuICAgICAgICAgICAgICAgIGRvQ2hhbmdlKGV2ZW50KTtcbiAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzRGVmaW5lZChub2RlLm1pbikgJiZcbiAgICAgICAgICAgIGlzRGVmaW5lZChub2RlLm1heCkgJiZcbiAgICAgICAgICAgIChub2RlLm1pbiA+IHBhcnNlZFZhbCB8fCBub2RlLm1heCA8IHBhcnNlZFZhbCkpIHtcbiAgICAgICAgICAgIC8vIGludmFsaWQgdmFsdWVcbiAgICAgICAgICAgIHRoaXMudHlwaW5nSG5kbCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudHlwaW5nSG5kbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAvLyB3ZSB3YWl0ZWQgYSBiaXQ7IG5vIHVzZXIgY2hhbmdlOyBzZXQgdmFsdWUgdG8gd2l0aGluIHJhbmdlXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubWluID4gcGFyc2VkVmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUudmFsdWUgPSBgJHtub2RlLm1pbn1gO1xuICAgICAgICAgICAgICAgICAgICBkb0NoYW5nZShldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUubWF4IDwgcGFyc2VkVmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUudmFsdWUgPSBgJHtub2RlLm1heH1gO1xuICAgICAgICAgICAgICAgICAgICBkb0NoYW5nZShldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgNzUwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWxbMF0gIT09IFwiLVwiIHx8IChwYXJzZWRWYWwgIT09IDAgJiYgIWlzTmFOKHBhcnNlZFZhbCkpKSB7XG4gICAgICAgICAgICAvLyBub3QgJy0nLCAnLTAnLCAnLTAuJywgJy0wLjAnLCAuLi5cbiAgICAgICAgICAgIGRvQ2hhbmdlKGV2ZW50KTtcbiAgICAgICAgfSAvLyBlbHNlIGRvbid0IHVwZGF0ZSBhbnl0aGluZzsgaXQncyBzdGlsbCBrZWVwaW5nIGxhc3QgdmFsdWVcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xhYmVsQ29udGVudFN0eWxlLnN0eWxlID0gYXJjZ2lzTGFiZWxDb250ZW50U3R5bGVDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0xhYmVsIGFzIGFyY2dpc19sYWJlbCwgQXJjZ2lzTGFiZWxDb250ZW50IGFzIGFyY2dpc19sYWJlbF9jb250ZW50LCBBcmNnaXNMYWJlbENvbnRlbnRTdHlsZSBhcyBhcmNnaXNfbGFiZWxfY29udGVudF9zdHlsZSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbGFiZWxfMy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlSWQoY291bnRzKSB7XG4gICAgcmV0dXJuIGNvdW50c1xuICAgICAgICAubWFwKChjb3VudCkgPT4ge1xuICAgICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQgKz0gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfSlcbiAgICAgICAgLmpvaW4oXCItXCIpO1xufVxuY29uc3QgZ3VpZCA9ICgpID0+IGdlbmVyYXRlSWQoWzIsIDEsIDEsIDEsIDNdKTtcblxuZXhwb3J0IHsgZ3VpZCBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWd1aWQtYWVhZWQ4NGQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlbmRlcmluZ1JlZiwgZiBhcyBmb3JjZVVwZGF0ZSB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG5jb25zdCBhcHBlbmRUb01hcCA9IChtYXAsIHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IGl0ZW1zID0gbWFwLmdldChwcm9wTmFtZSk7XG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgICBtYXAuc2V0KHByb3BOYW1lLCBbdmFsdWVdKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWl0ZW1zLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTtcbiAgICB9XG59O1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIG1zKSA9PiB7XG4gICAgbGV0IHRpbWVvdXRJZDtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aW1lb3V0SWQgPSAwO1xuICAgICAgICAgICAgZm4oLi4uYXJncyk7XG4gICAgICAgIH0sIG1zKTtcbiAgICB9O1xufTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHBvc3NpYmxlIGVsZW1lbnQgaXNDb25uZWN0ZWQuXG4gKiBUaGUgcHJvcGVydHkgbWlnaHQgbm90IGJlIHRoZXJlLCBzbyB3ZSBjaGVjayBmb3IgaXQuXG4gKlxuICogV2Ugd2FudCBpdCB0byByZXR1cm4gdHJ1ZSBpZiBpc0Nvbm5lY3RlZCBpcyBub3QgYSBwcm9wZXJ0eSxcbiAqIG90aGVyd2lzZSB3ZSB3b3VsZCByZW1vdmUgdGhlc2UgZWxlbWVudHMgYW5kIHdvdWxkIG5vdCB1cGRhdGUuXG4gKlxuICogQmV0dGVyIGxlYWsgaW4gRWRnZSB0aGFuIHRvIGJlIHVzZWxlc3MuXG4gKi9cbmNvbnN0IGlzQ29ubmVjdGVkID0gKG1heWJlRWxlbWVudCkgPT4gISgnaXNDb25uZWN0ZWQnIGluIG1heWJlRWxlbWVudCkgfHwgbWF5YmVFbGVtZW50LmlzQ29ubmVjdGVkO1xuY29uc3QgY2xlYW51cEVsZW1lbnRzID0gZGVib3VuY2UoKG1hcCkgPT4ge1xuICAgIGZvciAobGV0IGtleSBvZiBtYXAua2V5cygpKSB7XG4gICAgICAgIG1hcC5zZXQoa2V5LCBtYXAuZ2V0KGtleSkuZmlsdGVyKGlzQ29ubmVjdGVkKSk7XG4gICAgfVxufSwgMjAwMCk7XG5jb25zdCBzdGVuY2lsU3Vic2NyaXB0aW9uID0gKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgZ2V0UmVuZGVyaW5nUmVmICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIElmIHdlIGFyZSBub3QgaW4gYSBzdGVuY2lsIHByb2plY3QsIHdlIGRvIG5vdGhpbmcuXG4gICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgbm90IHJlYWxseSBleHBvcnRlZCBieSBAc3RlbmNpbC9jb3JlLlxuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGVsbXNUb1VwZGF0ZSA9IG5ldyBNYXAoKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiAoKSA9PiBlbG1zVG9VcGRhdGUuY2xlYXIoKSxcbiAgICAgICAgZ2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsbSA9IGdldFJlbmRlcmluZ1JlZigpO1xuICAgICAgICAgICAgaWYgKGVsbSkge1xuICAgICAgICAgICAgICAgIGFwcGVuZFRvTWFwKGVsbXNUb1VwZGF0ZSwgcHJvcE5hbWUsIGVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGVsbXNUb1VwZGF0ZS5nZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgZWxtc1RvVXBkYXRlLnNldChwcm9wTmFtZSwgZWxlbWVudHMuZmlsdGVyKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5mb3JFYWNoKChlbG1zKSA9PiBlbG1zLmZvckVhY2goZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgIH07XG59O1xuXG5jb25zdCB1bndyYXAgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJyA/IHZhbCgpIDogdmFsKTtcbmNvbnN0IGNyZWF0ZU9ic2VydmFibGVNYXAgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUgPSAoYSwgYikgPT4gYSAhPT0gYikgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZFN0YXRlID0gdW53cmFwKGRlZmF1bHRTdGF0ZSk7XG4gICAgbGV0IHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXModW53cmFwcGVkU3RhdGUgIT09IG51bGwgJiYgdW53cmFwcGVkU3RhdGUgIT09IHZvaWQgMCA/IHVud3JhcHBlZFN0YXRlIDoge30pKTtcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcbiAgICAgICAgZGlzcG9zZTogW10sXG4gICAgICAgIGdldDogW10sXG4gICAgICAgIHNldDogW10sXG4gICAgICAgIHJlc2V0OiBbXSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIFdoZW4gcmVzZXR0aW5nIHRoZSBzdGF0ZSwgdGhlIGRlZmF1bHQgc3RhdGUgbWF5IGJlIGEgZnVuY3Rpb24gLSB1bndyYXAgaXQgdG8gaW52b2tlIGl0LlxuICAgICAgICAvLyBvdGhlcndpc2UsIHRoZSBzdGF0ZSB3b24ndCBiZSBwcm9wZXJseSByZXNldFxuICAgICAgICBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKChfYSA9IHVud3JhcChkZWZhdWx0U3RhdGUpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB7fSkpO1xuICAgICAgICBoYW5kbGVycy5yZXNldC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfTtcbiAgICBjb25zdCBkaXNwb3NlID0gKCkgPT4ge1xuICAgICAgICAvLyBDYWxsIGZpcnN0IGRpc3Bvc2UgYXMgcmVzZXR0aW5nIHRoZSBzdGF0ZSB3b3VsZFxuICAgICAgICAvLyBjYXVzZSBsZXNzIHVwZGF0ZXMgOylcbiAgICAgICAgaGFuZGxlcnMuZGlzcG9zZS5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgfTtcbiAgICBjb25zdCBnZXQgPSAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgaGFuZGxlcnMuZ2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSkpO1xuICAgICAgICByZXR1cm4gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgfTtcbiAgICBjb25zdCBzZXQgPSAocHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgICAgIGlmIChzaG91bGRVcGRhdGUodmFsdWUsIG9sZFZhbHVlLCBwcm9wTmFtZSkpIHtcbiAgICAgICAgICAgIHN0YXRlcy5zZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUsIHZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzdGF0ZSA9ICh0eXBlb2YgUHJveHkgPT09ICd1bmRlZmluZWQnXG4gICAgICAgID8ge31cbiAgICAgICAgOiBuZXcgUHJveHkodW53cmFwcGVkU3RhdGUsIHtcbiAgICAgICAgICAgIGdldChfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG93bktleXMoXykge1xuICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRlcy5rZXlzKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXMoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzLmhhcyhwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KF8sIHByb3BOYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpO1xuICAgIGNvbnN0IG9uID0gKGV2ZW50TmFtZSwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZUZyb21BcnJheShoYW5kbGVyc1tldmVudE5hbWVdLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBvbkNoYW5nZSA9IChwcm9wTmFtZSwgY2IpID0+IHtcbiAgICAgICAgY29uc3QgdW5TZXQgPSBvbignc2V0JywgKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2IobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gV2UgbmVlZCB0byB1bndyYXAgdGhlIGRlZmF1bHRTdGF0ZSBiZWNhdXNlIGl0IG1pZ2h0IGJlIGEgZnVuY3Rpb24uXG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBtaWdodCBub3QgYmUgc2VuZGluZyB0aGUgcmlnaHQgcmVzZXQgdmFsdWUuXG4gICAgICAgIGNvbnN0IHVuUmVzZXQgPSBvbigncmVzZXQnLCAoKSA9PiBjYih1bndyYXAoZGVmYXVsdFN0YXRlKVtwcm9wTmFtZV0pKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVuU2V0KCk7XG4gICAgICAgICAgICB1blJlc2V0KCk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCB1c2UgPSAoLi4uc3Vic2NyaXB0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCB1bnN1YnMgPSBzdWJzY3JpcHRpb25zLnJlZHVjZSgodW5zdWJzLCBzdWJzY3JpcHRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3NldCcsIHN1YnNjcmlwdGlvbi5zZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZ2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2dldCcsIHN1YnNjcmlwdGlvbi5nZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24ucmVzZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbigncmVzZXQnLCBzdWJzY3JpcHRpb24ucmVzZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZGlzcG9zZSkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdkaXNwb3NlJywgc3Vic2NyaXB0aW9uLmRpc3Bvc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bnN1YnM7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHVuc3Vicy5mb3JFYWNoKCh1bnN1YikgPT4gdW5zdWIoKSk7XG4gICAgfTtcbiAgICBjb25zdCBmb3JjZVVwZGF0ZSA9IChrZXkpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KGtleSk7XG4gICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2Ioa2V5LCBvbGRWYWx1ZSwgb2xkVmFsdWUpKTtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXRlLFxuICAgICAgICBnZXQsXG4gICAgICAgIHNldCxcbiAgICAgICAgb24sXG4gICAgICAgIG9uQ2hhbmdlLFxuICAgICAgICB1c2UsXG4gICAgICAgIGRpc3Bvc2UsXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBmb3JjZVVwZGF0ZSxcbiAgICB9O1xufTtcbmNvbnN0IHJlbW92ZUZyb21BcnJheSA9IChhcnJheSwgaXRlbSkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gYXJyYXkuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBhcnJheVthcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgYXJyYXkubGVuZ3RoLS07XG4gICAgfVxufTtcblxuY29uc3QgY3JlYXRlU3RvcmUgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpID0+IHtcbiAgICBjb25zdCBtYXAgPSBjcmVhdGVPYnNlcnZhYmxlTWFwKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKTtcbiAgICBtYXAudXNlKHN0ZW5jaWxTdWJzY3JpcHRpb24oKSk7XG4gICAgcmV0dXJuIG1hcDtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZVN0b3JlIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgtMDU5NTZjYWIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGxhYmVsU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gICAgbGF5ZXI6IG51bGwsXG4gICAgbWFwVmlldzogbnVsbCxcbiAgICBwb3J0YWw6IG51bGwsXG4gICAgY29uZmlnOiBudWxsLFxuICAgIHN0cmluZ3M6IG51bGwsXG4gICAgY3VycmVudExhbmd1YWdlOiBudWxsLFxuICAgIGxheWVyR2VvbWV0cnlUeXBlOiBudWxsLFxuICAgIHNlcnZpY2VUeXBlOiBudWxsLFxuICAgIGxheWVyRGlzcGxheVR5cGU6IG51bGxcbn0pO1xuY29uc3QgbGFiZWxTdGF0ZSA9IGxhYmVsU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGxhYmVsU3RhdGUgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYWJlbFN0b3JlLTI3ZmUzY2RlLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gICAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgICAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgICAgICAgIHJldHVybiBsYW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gICAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICAgIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgICBsZXQgc3RyaW5ncztcbiAgICB0cnkge1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gICAgfVxuICAgIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYWxlLTA1MGI2ZGI5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==