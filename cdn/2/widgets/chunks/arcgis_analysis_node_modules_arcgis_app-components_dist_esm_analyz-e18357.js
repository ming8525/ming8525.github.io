"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_analyz-e18357"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ analyze),
/* harmony export */   s: () => (/* binding */ setStandardizedFieldNames)
/* harmony export */ });
/* harmony import */ var _basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./basic-6db7ebd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */









/**
 * update fields property on for analyzeResults to reflect user changes to fields (e.g. selection, changes to displayName, etc.)
 */
function updateFields(response) {
    return updateFieldsInner(response, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a);
}
function updateFieldsInner(response, storeState) {
    var _a, _b, _c, _d;
    const { selectedFields, type, selectedSheet } = storeState;
    if (!selectedFields) {
        return response;
    }
    const publishParameters = response.publishParameters;
    let layerInfo = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layerInfo;
    switch (type) {
        case "Microsoft Excel":
            layerInfo = (_b = (_a = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _a === void 0 ? void 0 : _a[selectedSheet]) !== null && _b !== void 0 ? _b : (_c = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _c === void 0 ? void 0 : _c[0];
            break;
        case "GeoJson":
            layerInfo = (_d = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _d === void 0 ? void 0 : _d[0];
            break;
    }
    layerInfo.fields = layerInfo.fields.reduce((fields, field) => {
        const matchingField = selectedFields[field.name];
        if (matchingField) {
            field.alias = matchingField.alias;
            fields.push(field);
        }
        return fields;
    }, []);
    return response;
}
/**
 * Update locationType property on all fields based on analyze response
 */
function updateLocationFields(response) {
    var _a, _b, _c, _d, _e, _f;
    const { selectedSheet } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a;
    const { publishParameters } = response;
    const layer = (_d = (_b = (_a = publishParameters.layers) === null || _a === void 0 ? void 0 : _a[selectedSheet]) !== null && _b !== void 0 ? _b : (_c = publishParameters.layers) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : publishParameters.layerInfo;
    if (!layer) {
        return response;
    }
    const addressFields = (_f = (_e = layer.addressFields) !== null && _e !== void 0 ? _e : publishParameters.addressFields) !== null && _f !== void 0 ? _f : {};
    const addressFieldsHash = Object.keys(addressFields).reduce((acc, key) => (Object.assign(Object.assign({}, acc), { [addressFields[key]]: key })), {});
    layer.fields = layer.fields.map((field) => {
        return Object.assign(Object.assign({}, field), { locationType: getLocationType(field, layer, publishParameters, addressFieldsHash) });
    });
    // keep location types of selected fields in sync as well (WebGIS/arcgis-portal-app#37037)
    if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedFields) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedFields = Object.keys(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedFields).reduce((acc, key) => {
            const field = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.selectedFields[key];
            acc[key] = Object.assign(Object.assign({}, field), { locationType: getLocationType(field, layer, publishParameters, addressFieldsHash) });
            return acc;
        }, {});
    }
    return response;
}
function getLocationType(field, layer, publishParameters, addressFields) {
    var _a, _b, _c, _d;
    const latitudeFieldName = (_a = layer.latitudeFieldName) !== null && _a !== void 0 ? _a : publishParameters.latitudeFieldName;
    const longitudeFieldName = (_b = layer.longitudeFieldName) !== null && _b !== void 0 ? _b : publishParameters.longitudeFieldName;
    const coordinateFieldName = (_c = layer.coordinateFieldName) !== null && _c !== void 0 ? _c : publishParameters.coordinateFieldName;
    const coordinateFieldType = (_d = layer.coordinateFieldType) !== null && _d !== void 0 ? _d : publishParameters.coordinateFieldType;
    if (addressFields[field.name]) {
        return addressFields[field.name];
    }
    if (field.name === coordinateFieldName) {
        return coordinateFieldType === null || coordinateFieldType === void 0 ? void 0 : coordinateFieldType.toLowerCase();
    }
    if (field.name === latitudeFieldName) {
        return "latitude";
    }
    if (field.name === longitudeFieldName) {
        return "longitude";
    }
    return field.locationType || "unknown";
}

/**
 * Find the cost data for geocoding a given amount of records
 */
function getGeocodingCost(geocodeCount) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.g)()}portals/self/cost`, { geocodeCount });
}

/**
 * Update country codes list
 * based on geocoder's proxyFilter and sourceCountry list
 */
async function getCountryCodes(geocodeServiceUrl, restBaseUrl, geocodeServers) {
    const geocoder = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.f)(geocodeServiceUrl, geocodeServers);
    let filter;
    if (geocoder === null || geocoder === void 0 ? void 0 : geocoder.itemId) {
        const url = `${restBaseUrl}/content/items/${geocoder.itemId}`;
        const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url);
        const sourceCountry = response.proxyFilter && JSON.parse(response.proxyFilter).sourceCountry;
        if (sourceCountry) {
            filter = sourceCountry.split(",").map((country) => country.toLowerCase());
            filter.push("world");
        }
    }
    const options = Object.keys(_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.c)
        .map((key) => ({ label: _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.c[key], value: key }))
        .filter(({ value }) => !filter || filter.includes(value.toLowerCase()))
        .sort((a, b) => {
        if (a.label < b.label) {
            return -1;
        }
        if (a.label > b.label) {
            return 1;
        }
        return 0;
    });
    return options;
}

async function analyze({ analyzeArgs, configArgs, itemArgs, initialize }) {
    var _a, _b;
    const { config, lang, portal, user } = configArgs;
    const { itemType } = itemArgs;
    if (initialize && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_6__.m)(user)) {
        const info = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.b)((_b = (_a = portal.helperServices) === null || _a === void 0 ? void 0 : _a.geocode) !== null && _b !== void 0 ? _b : [], user, portal.isPortal);
        if (info) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.allowGeocode = info.allowGeocode;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.isAgoWorldGeocodeServer = info.isAgoWorldGeocodeServer;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.isServiceProxyAgoWorldGeocodeServer = info.isServiceProxyAgoWorldGeocodeServer; // ! careful for reset, use default
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.isWorldGeocodeServer = info.isWorldGeocodeServer; // ! careful for reset, use default
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServers = info.geocodeServers; // ! careful for reset, use default
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServiceUrl = info.geocodeServiceUrl; // ! careful for reset, use default
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServers) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceCountry = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.d)(user.region, portal.ipCntryCode); // ! careful for reset, use default
            try {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.countryCodes = await getCountryCodes(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServiceUrl, config.restBaseUrl, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServers);
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.standardizedFieldNames = await getFieldNamesFromGeocoder(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeServiceUrl, lang);
            }
            catch (error) {
                console.error("Geocoder unavailable", error);
                return { error: { code: "unavailableGeocoder" } };
            }
        }
    }
    const { locationType, // ! careful for reset, use default --- handleAnalyzeResponse
    isWorldGeocodeServer, // ! careful for reset, use default
    geocodeServiceUrl, // ! careful for reset, use default
    geocodeServers, // ! careful for reset, use default
    isServiceProxyAgoWorldGeocodeServer, // ! careful for reset, use default
    sourceCountry, // ! careful for reset, use default
    analyzeResults, // ! careful for reset, use default --- handleAnalyzeResponse
    analyzedLocationTypes // ! careful for reset, use default --- pushed below
     } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a;
    const url = `${config.restBaseUrl}content/features/analyze`;
    const { isPortal } = portal;
    let analyzeSelectedLayer = false;
    let filetype;
    if ((analyzeArgs === null || analyzeArgs === void 0 ? void 0 : analyzeArgs.type) === "item" && analyzeArgs.workflow === "append") {
        filetype = _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_4__.a[itemType];
        analyzeSelectedLayer = true;
    }
    else {
        filetype = itemType === "Microsoft Excel" ? "excel" : itemType.toLowerCase();
    }
    let params = {
        filetype
    };
    switch (analyzeArgs === null || analyzeArgs === void 0 ? void 0 : analyzeArgs.type) {
        case "url":
            params.sourceUrl = analyzeArgs.sourceUrl;
            break;
        case "item":
            params.itemid = analyzeArgs.itemid;
            break;
        case "file":
            params = new FormData();
            params.append("file", analyzeArgs.file);
            params.append("filetype", filetype);
            break;
        case "text":
            params.text = analyzeArgs.text;
            break;
    }
    const analyzeParameters = {
        enableGlobalGeocoding: true,
        sourceLocale: lang,
        locationType,
        returnEstimatedRowCount: true,
        returnSize: true
    };
    if ((isPortal && geocodeServiceUrl) || !isPortal) {
        if (isPortal || (!isPortal && (geocodeServers === null || geocodeServers === void 0 ? void 0 : geocodeServers.length))) {
            analyzeParameters.geocodeServiceUrl = encodeURI(geocodeServiceUrl);
        }
        if (analyzeResults || isPortal) {
            const analyzedValue = locationType === "address" ? "addressTypes" : "locationTypes";
            if (analyzedLocationTypes.indexOf(analyzedValue) === -1) {
                analyzedLocationTypes.push(analyzedValue);
            }
            analyzeParameters.locationType = locationType || "coordinates";
        }
        if ((!portal.isPortal && isWorldGeocodeServer) || (portal.isPortal && isServiceProxyAgoWorldGeocodeServer)) {
            analyzeParameters.sourceCountryHint = analyzeResults ? "" : sourceCountry.toLowerCase();
            analyzeParameters.sourceCountry = analyzeResults ? sourceCountry.toLowerCase() : "";
        }
        const stringifiedAnalyzeParameters = JSON.stringify(analyzeParameters);
        if (params instanceof FormData) {
            params.append("analyzeParameters", stringifiedAnalyzeParameters);
        }
        else {
            params.analyzeParameters = stringifiedAnalyzeParameters;
        }
    }
    try {
        const response = await (params instanceof FormData
            ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.d)(url, params, {}, "post")
            : (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params, {}, "post"));
        handleAnalyzeResponse({ response, initialize, analyzeSelectedLayer, geocodeServiceUrl, lang, portal, itemType });
        return {};
    }
    catch (error) {
        console.error(error);
        const errorMessage = (error === null || error === void 0 ? void 0 : error.message) || error || "";
        switch (true) {
            case errorMessage.includes("specify data to be analyzed"):
                return { error: { code: "emptyFile" } };
            case errorMessage.includes("Duplicate field names are not allowed"):
                return { error: { code: "duplicateFieldNames" } };
            case errorMessage.toLowerCase().includes("timeout"):
                return { error: { code: "timeout" } };
        }
        return { error: { code: "unhandledError" } };
    }
}
async function handleAnalyzeResponse({ response, analyzeSelectedLayer, initialize, geocodeServiceUrl, lang, portal, itemType }) {
    var _a, _b, _c, _d, _e, _f;
    const geocodeConfig = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a;
    const isPortal = portal.isPortal;
    const isExcel = itemType === "Microsoft Excel";
    const publishParameters = isExcel
        ? (_b = (_a = response.publishParameters.layers) === null || _a === void 0 ? void 0 : _a[geocodeConfig.selectedSheet]) !== null && _b !== void 0 ? _b : (_c = response.publishParameters.layers) === null || _c === void 0 ? void 0 : _c[0]
        : response.publishParameters;
    let sourceCountry;
    if ((!isPortal && geocodeConfig.isWorldGeocodeServer) ||
        (isPortal && geocodeConfig.isServiceProxyAgoWorldGeocodeServer)) {
        const isWorldGeocodeServer = (0,_basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_0__.a)(publishParameters.sourceCountry);
        sourceCountry = geocodeConfig.sourceCountry || publishParameters.sourceCountry || "world";
        sourceCountry = sourceCountry === "wo" ? "world" : sourceCountry;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.isWorldGeocodeServer = isWorldGeocodeServer;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.sourceCountry = sourceCountry;
    }
    if (!geocodeConfig.allowGeocode && publishParameters.locationType === "address") {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.locationType = "none";
    }
    updateLocationFields(response);
    const updatedResponse = updateFields(response);
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.analyzeResults = updatedResponse;
    if ((_d = updatedResponse === null || updatedResponse === void 0 ? void 0 : updatedResponse.publishParameters) === null || _d === void 0 ? void 0 : _d.layers) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.excelLayers = (_e = updatedResponse === null || updatedResponse === void 0 ? void 0 : updatedResponse.publishParameters) === null || _e === void 0 ? void 0 : _e.layers;
    }
    const layerInfo = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_5__.a)(response, analyzeSelectedLayer);
    if (initialize) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.backupLayerFields = JSON.parse(JSON.stringify(layerInfo.fields));
    }
    else {
        // Fall back to world geocoder if no field names found
        !!publishParameters.standardizedFieldNames
            ? (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.standardizedFieldNames = publishParameters.standardizedFieldNames)
            : setStandardizedFieldNames({
                lang,
                geocodeServiceUrl,
                // ! We set the location type above so we can't just use the destructed value
                // TODO: refactor that into a local variable
                locationType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.locationType
            });
    }
    // figure out how much this action will cost
    if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.locationType === "address" ||
        layerInfo.locationType === "address" ||
        ((_f = response === null || response === void 0 ? void 0 : response.publishParameters) === null || _f === void 0 ? void 0 : _f.locationType) === "address") {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeCost = await getGeocodingCost(layerInfo.estimatedRecordCount);
    }
    else {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.geocodeCost = null;
    }
}
async function setStandardizedFieldNames({ lang, geocodeServiceUrl, locationType }) {
    if (locationType === "address") {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_3__.a.standardizedFieldNames = await getFieldNamesFromGeocoder(geocodeServiceUrl, lang);
    }
}
async function getFieldNamesFromGeocoder(geocodeServiceUrl, lang) {
    const geocoderResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(geocodeServiceUrl, {}, { addTokenManually: false });
    return geocoderResponse.addressFields.reduce((acc, field) => {
        var _a;
        if (field.name !== "unknown") {
            acc[field.name] = ((_a = field === null || field === void 0 ? void 0 : field.localizedNames) === null || _a === void 0 ? void 0 : _a[`${lang}`]) || field.alias || field.name;
        }
        return acc;
    }, {});
}



//# sourceMappingURL=analyze-69ec08c8.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isDefined),
/* harmony export */   i: () => (/* binding */ isInNode),
/* harmony export */   s: () => (/* binding */ scales)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
var scales;
(function (scales) {
    scales["SMALL"] = "s";
    scales["MEDIUM"] = "m";
    scales["LARGE"] = "l";
})(scales || (scales = {}));
/**
 * Returns true if the value is defined
 * @param value - value to check
 */
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Returns true if node has nodeName or is contained in a parent node with nodeName
 * @param node
 * @param nodeName
 */
function isInNode(node, nodeName) {
    while (node) {
        if (node.nodeName === nodeName.toUpperCase()) {
            return true;
        }
        node = node.parentElement;
    }
    return false;
}



//# sourceMappingURL=basic-6db7ebd7.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   L: () => (/* binding */ LastSortyBy),
/* harmony export */   a: () => (/* binding */ fieldTypesEnum),
/* harmony export */   f: () => (/* binding */ fieldInfoPrefixEnum),
/* harmony export */   i: () => (/* binding */ imageComponentInputTypesEnum),
/* harmony export */   l: () => (/* binding */ layerDisplayTypeEnum),
/* harmony export */   s: () => (/* binding */ serviceTypeEnum)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
var imageComponentInputTypesEnum;
(function (imageComponentInputTypesEnum) {
    imageComponentInputTypesEnum["sourceUrl"] = "sourceUrl";
    imageComponentInputTypesEnum["title"] = "title";
    imageComponentInputTypesEnum["caption"] = "caption";
    imageComponentInputTypesEnum["linkUrl"] = "linkUrl";
    imageComponentInputTypesEnum["altText"] = "altText";
})(imageComponentInputTypesEnum || (imageComponentInputTypesEnum = {}));
var fieldInfoPrefixEnum;
(function (fieldInfoPrefixEnum) {
    fieldInfoPrefixEnum["expression"] = "expression/";
    fieldInfoPrefixEnum["relationship"] = "relationships/";
    fieldInfoPrefixEnum["raster"] = "Raster.";
})(fieldInfoPrefixEnum || (fieldInfoPrefixEnum = {}));
var layerDisplayTypeEnum;
(function (layerDisplayTypeEnum) {
    layerDisplayTypeEnum["feature"] = "feature";
    layerDisplayTypeEnum["cluster"] = "cluster";
    layerDisplayTypeEnum["mapNotes"] = "mapNotes";
})(layerDisplayTypeEnum || (layerDisplayTypeEnum = {}));
var serviceTypeEnum;
(function (serviceTypeEnum) {
    serviceTypeEnum["feature"] = "feature";
    serviceTypeEnum["mapImage"] = "map-image";
    serviceTypeEnum["scene"] = "scene";
    serviceTypeEnum["ogcFeature"] = "ogc-feature";
    serviceTypeEnum["imagery"] = "imagery";
    serviceTypeEnum["wfs"] = "wfs";
    serviceTypeEnum["wms"] = "wms";
    serviceTypeEnum["csv"] = "csv";
    serviceTypeEnum["geojson"] = "geojson";
    serviceTypeEnum["stream"] = "stream";
    serviceTypeEnum["imageryTile"] = "imagery-tile";
    serviceTypeEnum["tile"] = "tile";
    serviceTypeEnum["subtype"] = "subtype";
})(serviceTypeEnum || (serviceTypeEnum = {}));
// https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type
var fieldTypesEnum;
(function (fieldTypesEnum) {
    fieldTypesEnum["integer"] = "integer";
    fieldTypesEnum["smallInteger"] = "small-integer";
    fieldTypesEnum["bigInteger"] = "big-integer";
    fieldTypesEnum["single"] = "single";
    fieldTypesEnum["double"] = "double";
    fieldTypesEnum["long"] = "long";
    fieldTypesEnum["string"] = "string";
    fieldTypesEnum["date"] = "date";
    fieldTypesEnum["dateOnly"] = "date-only";
    fieldTypesEnum["timeOnly"] = "time-only";
    fieldTypesEnum["timestampOffset"] = "timestamp-offset";
    fieldTypesEnum["oid"] = "oid";
    fieldTypesEnum["guid"] = "guid";
    fieldTypesEnum["globalId"] = "global-id";
    fieldTypesEnum["number"] = "number"; // for arcade
})(fieldTypesEnum || (fieldTypesEnum = {}));
var LastSortyBy;
(function (LastSortyBy) {
    LastSortyBy["default"] = "default";
    LastSortyBy["display"] = "display";
    LastSortyBy["type"] = "type";
    LastSortyBy["field"] = "field";
})(LastSortyBy || (LastSortyBy = {}));



//# sourceMappingURL=commonEnums-fcf13661.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYW5hbHl6LWUxODM1Ny5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDcUQ7QUFDbEI7QUFDQTtBQUN3QjtBQUNDO0FBQ3lGO0FBQzFGO0FBQ2dDOztBQUUzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxvREFBWTtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxZQUFZLHNDQUFzQztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxnQkFBZ0IsRUFBRSxvREFBWTtBQUMxQyxZQUFZLG9CQUFvQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkdBQTZHLFVBQVUsMkJBQTJCLE1BQU07QUFDeEo7QUFDQSw2Q0FBNkMsWUFBWSxtRkFBbUY7QUFDNUksS0FBSztBQUNMO0FBQ0EsUUFBUSxvREFBWTtBQUNwQixRQUFRLG9EQUFZLDhCQUE4QixvREFBWTtBQUM5RCwwQkFBMEIsb0RBQVk7QUFDdEMscURBQXFELFlBQVksbUZBQW1GO0FBQ3BKO0FBQ0EsU0FBUyxJQUFJO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsc0RBQU8sSUFBSSxzREFBYyxHQUFHLHNCQUFzQixjQUFjO0FBQzNFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxrQ0FBa0M7O0FBRTRIOztBQUUvSiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FuYWx5emUtNjllYzA4YzguanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTRlMTEwMzJjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Jhc2ljLTZkYjdlYmQ3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBpc0RlZmluZWQgfSBmcm9tICcuL2Jhc2ljLTZkYjdlYmQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IGEgYXMgYXBwZW5kRmlsZVR5cGVzIH0gZnJvbSAnLi9hcHBlbmQtNGUxMTAzMmMuanMnO1xuaW1wb3J0IHsgZiBhcyBmaW5kR2VvY29kZXIsIGMgYXMgY291bnRyeUNvZGVzLCBiIGFzIGdldEdlb2NvZGVySW5mbywgZCBhcyBnZXRTb3VyY2VDb3VudHJ5LCBhIGFzIGdldEFuYWx5emVkTGF5ZXJJbmZvIH0gZnJvbSAnLi9nZW9jb2RlLTY0ZTBiMGQzLmpzJztcbmltcG9ydCB7IG0gYXMgY2FuR2VvY29kZSB9IGZyb20gJy4vcHJpdmlsZWdlcy03NDYzOWRhZS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwsIGQgYXMgZm9ybVJlcXVlc3QgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5cbi8qKlxuICogdXBkYXRlIGZpZWxkcyBwcm9wZXJ0eSBvbiBmb3IgYW5hbHl6ZVJlc3VsdHMgdG8gcmVmbGVjdCB1c2VyIGNoYW5nZXMgdG8gZmllbGRzIChlLmcuIHNlbGVjdGlvbiwgY2hhbmdlcyB0byBkaXNwbGF5TmFtZSwgZXRjLilcbiAqL1xuZnVuY3Rpb24gdXBkYXRlRmllbGRzKHJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIHVwZGF0ZUZpZWxkc0lubmVyKHJlc3BvbnNlLCBhZGRJdGVtU3RhdGUpO1xufVxuZnVuY3Rpb24gdXBkYXRlRmllbGRzSW5uZXIocmVzcG9uc2UsIHN0b3JlU3RhdGUpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZpZWxkcywgdHlwZSwgc2VsZWN0ZWRTaGVldCB9ID0gc3RvcmVTdGF0ZTtcbiAgICBpZiAoIXNlbGVjdGVkRmllbGRzKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgY29uc3QgcHVibGlzaFBhcmFtZXRlcnMgPSByZXNwb25zZS5wdWJsaXNoUGFyYW1ldGVycztcbiAgICBsZXQgbGF5ZXJJbmZvID0gcHVibGlzaFBhcmFtZXRlcnMgPT09IG51bGwgfHwgcHVibGlzaFBhcmFtZXRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVySW5mbztcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcIk1pY3Jvc29mdCBFeGNlbFwiOlxuICAgICAgICAgICAgbGF5ZXJJbmZvID0gKF9iID0gKF9hID0gcHVibGlzaFBhcmFtZXRlcnMgPT09IG51bGwgfHwgcHVibGlzaFBhcmFtZXRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW3NlbGVjdGVkU2hlZXRdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSBwdWJsaXNoUGFyYW1ldGVycyA9PT0gbnVsbCB8fCBwdWJsaXNoUGFyYW1ldGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbMF07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIkdlb0pzb25cIjpcbiAgICAgICAgICAgIGxheWVySW5mbyA9IChfZCA9IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSBudWxsIHx8IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZFswXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXllckluZm8uZmllbGRzID0gbGF5ZXJJbmZvLmZpZWxkcy5yZWR1Y2UoKGZpZWxkcywgZmllbGQpID0+IHtcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdGaWVsZCA9IHNlbGVjdGVkRmllbGRzW2ZpZWxkLm5hbWVdO1xuICAgICAgICBpZiAobWF0Y2hpbmdGaWVsZCkge1xuICAgICAgICAgICAgZmllbGQuYWxpYXMgPSBtYXRjaGluZ0ZpZWxkLmFsaWFzO1xuICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWVsZHM7XG4gICAgfSwgW10pO1xuICAgIHJldHVybiByZXNwb25zZTtcbn1cbi8qKlxuICogVXBkYXRlIGxvY2F0aW9uVHlwZSBwcm9wZXJ0eSBvbiBhbGwgZmllbGRzIGJhc2VkIG9uIGFuYWx5emUgcmVzcG9uc2VcbiAqL1xuZnVuY3Rpb24gdXBkYXRlTG9jYXRpb25GaWVsZHMocmVzcG9uc2UpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICBjb25zdCB7IHNlbGVjdGVkU2hlZXQgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB7IHB1Ymxpc2hQYXJhbWV0ZXJzIH0gPSByZXNwb25zZTtcbiAgICBjb25zdCBsYXllciA9IChfZCA9IChfYiA9IChfYSA9IHB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW3NlbGVjdGVkU2hlZXRdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1swXSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJJbmZvO1xuICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cbiAgICBjb25zdCBhZGRyZXNzRmllbGRzID0gKF9mID0gKF9lID0gbGF5ZXIuYWRkcmVzc0ZpZWxkcykgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogcHVibGlzaFBhcmFtZXRlcnMuYWRkcmVzc0ZpZWxkcykgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDoge307XG4gICAgY29uc3QgYWRkcmVzc0ZpZWxkc0hhc2ggPSBPYmplY3Qua2V5cyhhZGRyZXNzRmllbGRzKS5yZWR1Y2UoKGFjYywga2V5KSA9PiAoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBhY2MpLCB7IFthZGRyZXNzRmllbGRzW2tleV1dOiBrZXkgfSkpLCB7fSk7XG4gICAgbGF5ZXIuZmllbGRzID0gbGF5ZXIuZmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZmllbGQpLCB7IGxvY2F0aW9uVHlwZTogZ2V0TG9jYXRpb25UeXBlKGZpZWxkLCBsYXllciwgcHVibGlzaFBhcmFtZXRlcnMsIGFkZHJlc3NGaWVsZHNIYXNoKSB9KTtcbiAgICB9KTtcbiAgICAvLyBrZWVwIGxvY2F0aW9uIHR5cGVzIG9mIHNlbGVjdGVkIGZpZWxkcyBpbiBzeW5jIGFzIHdlbGwgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzNzAzNylcbiAgICBpZiAoYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkcyA9IE9iamVjdC5rZXlzKGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkcykucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHNba2V5XTtcbiAgICAgICAgICAgIGFjY1trZXldID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBmaWVsZCksIHsgbG9jYXRpb25UeXBlOiBnZXRMb2NhdGlvblR5cGUoZmllbGQsIGxheWVyLCBwdWJsaXNoUGFyYW1ldGVycywgYWRkcmVzc0ZpZWxkc0hhc2gpIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwge30pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5mdW5jdGlvbiBnZXRMb2NhdGlvblR5cGUoZmllbGQsIGxheWVyLCBwdWJsaXNoUGFyYW1ldGVycywgYWRkcmVzc0ZpZWxkcykge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCBsYXRpdHVkZUZpZWxkTmFtZSA9IChfYSA9IGxheWVyLmxhdGl0dWRlRmllbGROYW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBwdWJsaXNoUGFyYW1ldGVycy5sYXRpdHVkZUZpZWxkTmFtZTtcbiAgICBjb25zdCBsb25naXR1ZGVGaWVsZE5hbWUgPSAoX2IgPSBsYXllci5sb25naXR1ZGVGaWVsZE5hbWUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHB1Ymxpc2hQYXJhbWV0ZXJzLmxvbmdpdHVkZUZpZWxkTmFtZTtcbiAgICBjb25zdCBjb29yZGluYXRlRmllbGROYW1lID0gKF9jID0gbGF5ZXIuY29vcmRpbmF0ZUZpZWxkTmFtZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogcHVibGlzaFBhcmFtZXRlcnMuY29vcmRpbmF0ZUZpZWxkTmFtZTtcbiAgICBjb25zdCBjb29yZGluYXRlRmllbGRUeXBlID0gKF9kID0gbGF5ZXIuY29vcmRpbmF0ZUZpZWxkVHlwZSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogcHVibGlzaFBhcmFtZXRlcnMuY29vcmRpbmF0ZUZpZWxkVHlwZTtcbiAgICBpZiAoYWRkcmVzc0ZpZWxkc1tmaWVsZC5uYW1lXSkge1xuICAgICAgICByZXR1cm4gYWRkcmVzc0ZpZWxkc1tmaWVsZC5uYW1lXTtcbiAgICB9XG4gICAgaWYgKGZpZWxkLm5hbWUgPT09IGNvb3JkaW5hdGVGaWVsZE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVGaWVsZFR5cGUgPT09IG51bGwgfHwgY29vcmRpbmF0ZUZpZWxkVHlwZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29vcmRpbmF0ZUZpZWxkVHlwZS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICBpZiAoZmllbGQubmFtZSA9PT0gbGF0aXR1ZGVGaWVsZE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIFwibGF0aXR1ZGVcIjtcbiAgICB9XG4gICAgaWYgKGZpZWxkLm5hbWUgPT09IGxvbmdpdHVkZUZpZWxkTmFtZSkge1xuICAgICAgICByZXR1cm4gXCJsb25naXR1ZGVcIjtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkLmxvY2F0aW9uVHlwZSB8fCBcInVua25vd25cIjtcbn1cblxuLyoqXG4gKiBGaW5kIHRoZSBjb3N0IGRhdGEgZm9yIGdlb2NvZGluZyBhIGdpdmVuIGFtb3VudCBvZiByZWNvcmRzXG4gKi9cbmZ1bmN0aW9uIGdldEdlb2NvZGluZ0Nvc3QoZ2VvY29kZUNvdW50KSB7XG4gICAgcmV0dXJuIHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwoKX1wb3J0YWxzL3NlbGYvY29zdGAsIHsgZ2VvY29kZUNvdW50IH0pO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBjb3VudHJ5IGNvZGVzIGxpc3RcbiAqIGJhc2VkIG9uIGdlb2NvZGVyJ3MgcHJveHlGaWx0ZXIgYW5kIHNvdXJjZUNvdW50cnkgbGlzdFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDb3VudHJ5Q29kZXMoZ2VvY29kZVNlcnZpY2VVcmwsIHJlc3RCYXNlVXJsLCBnZW9jb2RlU2VydmVycykge1xuICAgIGNvbnN0IGdlb2NvZGVyID0gZmluZEdlb2NvZGVyKGdlb2NvZGVTZXJ2aWNlVXJsLCBnZW9jb2RlU2VydmVycyk7XG4gICAgbGV0IGZpbHRlcjtcbiAgICBpZiAoZ2VvY29kZXIgPT09IG51bGwgfHwgZ2VvY29kZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdlb2NvZGVyLml0ZW1JZCkge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHtyZXN0QmFzZVVybH0vY29udGVudC9pdGVtcy8ke2dlb2NvZGVyLml0ZW1JZH1gO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsKTtcbiAgICAgICAgY29uc3Qgc291cmNlQ291bnRyeSA9IHJlc3BvbnNlLnByb3h5RmlsdGVyICYmIEpTT04ucGFyc2UocmVzcG9uc2UucHJveHlGaWx0ZXIpLnNvdXJjZUNvdW50cnk7XG4gICAgICAgIGlmIChzb3VyY2VDb3VudHJ5KSB7XG4gICAgICAgICAgICBmaWx0ZXIgPSBzb3VyY2VDb3VudHJ5LnNwbGl0KFwiLFwiKS5tYXAoKGNvdW50cnkpID0+IGNvdW50cnkudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICBmaWx0ZXIucHVzaChcIndvcmxkXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3Qua2V5cyhjb3VudHJ5Q29kZXMpXG4gICAgICAgIC5tYXAoKGtleSkgPT4gKHsgbGFiZWw6IGNvdW50cnlDb2Rlc1trZXldLCB2YWx1ZToga2V5IH0pKVxuICAgICAgICAuZmlsdGVyKCh7IHZhbHVlIH0pID0+ICFmaWx0ZXIgfHwgZmlsdGVyLmluY2x1ZGVzKHZhbHVlLnRvTG93ZXJDYXNlKCkpKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBpZiAoYS5sYWJlbCA8IGIubGFiZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYS5sYWJlbCA+IGIubGFiZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0pO1xuICAgIHJldHVybiBvcHRpb25zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhbmFseXplKHsgYW5hbHl6ZUFyZ3MsIGNvbmZpZ0FyZ3MsIGl0ZW1BcmdzLCBpbml0aWFsaXplIH0pIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgY29uZmlnLCBsYW5nLCBwb3J0YWwsIHVzZXIgfSA9IGNvbmZpZ0FyZ3M7XG4gICAgY29uc3QgeyBpdGVtVHlwZSB9ID0gaXRlbUFyZ3M7XG4gICAgaWYgKGluaXRpYWxpemUgJiYgY2FuR2VvY29kZSh1c2VyKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gZ2V0R2VvY29kZXJJbmZvKChfYiA9IChfYSA9IHBvcnRhbC5oZWxwZXJTZXJ2aWNlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdlb2NvZGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdLCB1c2VyLCBwb3J0YWwuaXNQb3J0YWwpO1xuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFsbG93R2VvY29kZSA9IGluZm8uYWxsb3dHZW9jb2RlO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmlzQWdvV29ybGRHZW9jb2RlU2VydmVyID0gaW5mby5pc0Fnb1dvcmxkR2VvY29kZVNlcnZlcjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5pc1NlcnZpY2VQcm94eUFnb1dvcmxkR2VvY29kZVNlcnZlciA9IGluZm8uaXNTZXJ2aWNlUHJveHlBZ29Xb3JsZEdlb2NvZGVTZXJ2ZXI7IC8vICEgY2FyZWZ1bCBmb3IgcmVzZXQsIHVzZSBkZWZhdWx0XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuaXNXb3JsZEdlb2NvZGVTZXJ2ZXIgPSBpbmZvLmlzV29ybGRHZW9jb2RlU2VydmVyOyAvLyAhIGNhcmVmdWwgZm9yIHJlc2V0LCB1c2UgZGVmYXVsdFxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmdlb2NvZGVTZXJ2ZXJzID0gaW5mby5nZW9jb2RlU2VydmVyczsgLy8gISBjYXJlZnVsIGZvciByZXNldCwgdXNlIGRlZmF1bHRcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybCA9IGluZm8uZ2VvY29kZVNlcnZpY2VVcmw7IC8vICEgY2FyZWZ1bCBmb3IgcmVzZXQsIHVzZSBkZWZhdWx0XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmVycykge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNvdXJjZUNvdW50cnkgPSBnZXRTb3VyY2VDb3VudHJ5KHVzZXIucmVnaW9uLCBwb3J0YWwuaXBDbnRyeUNvZGUpOyAvLyAhIGNhcmVmdWwgZm9yIHJlc2V0LCB1c2UgZGVmYXVsdFxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuY291bnRyeUNvZGVzID0gYXdhaXQgZ2V0Q291bnRyeUNvZGVzKGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybCwgY29uZmlnLnJlc3RCYXNlVXJsLCBhZGRJdGVtU3RhdGUuZ2VvY29kZVNlcnZlcnMpO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zdGFuZGFyZGl6ZWRGaWVsZE5hbWVzID0gYXdhaXQgZ2V0RmllbGROYW1lc0Zyb21HZW9jb2RlcihhZGRJdGVtU3RhdGUuZ2VvY29kZVNlcnZpY2VVcmwsIGxhbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkdlb2NvZGVyIHVuYXZhaWxhYmxlXCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuYXZhaWxhYmxlR2VvY29kZXJcIiB9IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgeyBsb2NhdGlvblR5cGUsIC8vICEgY2FyZWZ1bCBmb3IgcmVzZXQsIHVzZSBkZWZhdWx0IC0tLSBoYW5kbGVBbmFseXplUmVzcG9uc2VcbiAgICBpc1dvcmxkR2VvY29kZVNlcnZlciwgLy8gISBjYXJlZnVsIGZvciByZXNldCwgdXNlIGRlZmF1bHRcbiAgICBnZW9jb2RlU2VydmljZVVybCwgLy8gISBjYXJlZnVsIGZvciByZXNldCwgdXNlIGRlZmF1bHRcbiAgICBnZW9jb2RlU2VydmVycywgLy8gISBjYXJlZnVsIGZvciByZXNldCwgdXNlIGRlZmF1bHRcbiAgICBpc1NlcnZpY2VQcm94eUFnb1dvcmxkR2VvY29kZVNlcnZlciwgLy8gISBjYXJlZnVsIGZvciByZXNldCwgdXNlIGRlZmF1bHRcbiAgICBzb3VyY2VDb3VudHJ5LCAvLyAhIGNhcmVmdWwgZm9yIHJlc2V0LCB1c2UgZGVmYXVsdFxuICAgIGFuYWx5emVSZXN1bHRzLCAvLyAhIGNhcmVmdWwgZm9yIHJlc2V0LCB1c2UgZGVmYXVsdCAtLS0gaGFuZGxlQW5hbHl6ZVJlc3BvbnNlXG4gICAgYW5hbHl6ZWRMb2NhdGlvblR5cGVzIC8vICEgY2FyZWZ1bCBmb3IgcmVzZXQsIHVzZSBkZWZhdWx0IC0tLSBwdXNoZWQgYmVsb3dcbiAgICAgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICBjb25zdCB1cmwgPSBgJHtjb25maWcucmVzdEJhc2VVcmx9Y29udGVudC9mZWF0dXJlcy9hbmFseXplYDtcbiAgICBjb25zdCB7IGlzUG9ydGFsIH0gPSBwb3J0YWw7XG4gICAgbGV0IGFuYWx5emVTZWxlY3RlZExheWVyID0gZmFsc2U7XG4gICAgbGV0IGZpbGV0eXBlO1xuICAgIGlmICgoYW5hbHl6ZUFyZ3MgPT09IG51bGwgfHwgYW5hbHl6ZUFyZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFuYWx5emVBcmdzLnR5cGUpID09PSBcIml0ZW1cIiAmJiBhbmFseXplQXJncy53b3JrZmxvdyA9PT0gXCJhcHBlbmRcIikge1xuICAgICAgICBmaWxldHlwZSA9IGFwcGVuZEZpbGVUeXBlc1tpdGVtVHlwZV07XG4gICAgICAgIGFuYWx5emVTZWxlY3RlZExheWVyID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZpbGV0eXBlID0gaXRlbVR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgPyBcImV4Y2VsXCIgOiBpdGVtVHlwZS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICBsZXQgcGFyYW1zID0ge1xuICAgICAgICBmaWxldHlwZVxuICAgIH07XG4gICAgc3dpdGNoIChhbmFseXplQXJncyA9PT0gbnVsbCB8fCBhbmFseXplQXJncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYW5hbHl6ZUFyZ3MudHlwZSkge1xuICAgICAgICBjYXNlIFwidXJsXCI6XG4gICAgICAgICAgICBwYXJhbXMuc291cmNlVXJsID0gYW5hbHl6ZUFyZ3Muc291cmNlVXJsO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJpdGVtXCI6XG4gICAgICAgICAgICBwYXJhbXMuaXRlbWlkID0gYW5hbHl6ZUFyZ3MuaXRlbWlkO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJmaWxlXCI6XG4gICAgICAgICAgICBwYXJhbXMgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoXCJmaWxlXCIsIGFuYWx5emVBcmdzLmZpbGUpO1xuICAgICAgICAgICAgcGFyYW1zLmFwcGVuZChcImZpbGV0eXBlXCIsIGZpbGV0eXBlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgICAgcGFyYW1zLnRleHQgPSBhbmFseXplQXJncy50ZXh0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IGFuYWx5emVQYXJhbWV0ZXJzID0ge1xuICAgICAgICBlbmFibGVHbG9iYWxHZW9jb2Rpbmc6IHRydWUsXG4gICAgICAgIHNvdXJjZUxvY2FsZTogbGFuZyxcbiAgICAgICAgbG9jYXRpb25UeXBlLFxuICAgICAgICByZXR1cm5Fc3RpbWF0ZWRSb3dDb3VudDogdHJ1ZSxcbiAgICAgICAgcmV0dXJuU2l6ZTogdHJ1ZVxuICAgIH07XG4gICAgaWYgKChpc1BvcnRhbCAmJiBnZW9jb2RlU2VydmljZVVybCkgfHwgIWlzUG9ydGFsKSB7XG4gICAgICAgIGlmIChpc1BvcnRhbCB8fCAoIWlzUG9ydGFsICYmIChnZW9jb2RlU2VydmVycyA9PT0gbnVsbCB8fCBnZW9jb2RlU2VydmVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ2VvY29kZVNlcnZlcnMubGVuZ3RoKSkpIHtcbiAgICAgICAgICAgIGFuYWx5emVQYXJhbWV0ZXJzLmdlb2NvZGVTZXJ2aWNlVXJsID0gZW5jb2RlVVJJKGdlb2NvZGVTZXJ2aWNlVXJsKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYW5hbHl6ZVJlc3VsdHMgfHwgaXNQb3J0YWwpIHtcbiAgICAgICAgICAgIGNvbnN0IGFuYWx5emVkVmFsdWUgPSBsb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiID8gXCJhZGRyZXNzVHlwZXNcIiA6IFwibG9jYXRpb25UeXBlc1wiO1xuICAgICAgICAgICAgaWYgKGFuYWx5emVkTG9jYXRpb25UeXBlcy5pbmRleE9mKGFuYWx5emVkVmFsdWUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGFuYWx5emVkTG9jYXRpb25UeXBlcy5wdXNoKGFuYWx5emVkVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYW5hbHl6ZVBhcmFtZXRlcnMubG9jYXRpb25UeXBlID0gbG9jYXRpb25UeXBlIHx8IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKCFwb3J0YWwuaXNQb3J0YWwgJiYgaXNXb3JsZEdlb2NvZGVTZXJ2ZXIpIHx8IChwb3J0YWwuaXNQb3J0YWwgJiYgaXNTZXJ2aWNlUHJveHlBZ29Xb3JsZEdlb2NvZGVTZXJ2ZXIpKSB7XG4gICAgICAgICAgICBhbmFseXplUGFyYW1ldGVycy5zb3VyY2VDb3VudHJ5SGludCA9IGFuYWx5emVSZXN1bHRzID8gXCJcIiA6IHNvdXJjZUNvdW50cnkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGFuYWx5emVQYXJhbWV0ZXJzLnNvdXJjZUNvdW50cnkgPSBhbmFseXplUmVzdWx0cyA/IHNvdXJjZUNvdW50cnkudG9Mb3dlckNhc2UoKSA6IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RyaW5naWZpZWRBbmFseXplUGFyYW1ldGVycyA9IEpTT04uc3RyaW5naWZ5KGFuYWx5emVQYXJhbWV0ZXJzKTtcbiAgICAgICAgaWYgKHBhcmFtcyBpbnN0YW5jZW9mIEZvcm1EYXRhKSB7XG4gICAgICAgICAgICBwYXJhbXMuYXBwZW5kKFwiYW5hbHl6ZVBhcmFtZXRlcnNcIiwgc3RyaW5naWZpZWRBbmFseXplUGFyYW1ldGVycyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYXJhbXMuYW5hbHl6ZVBhcmFtZXRlcnMgPSBzdHJpbmdpZmllZEFuYWx5emVQYXJhbWV0ZXJzO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKHBhcmFtcyBpbnN0YW5jZW9mIEZvcm1EYXRhXG4gICAgICAgICAgICA/IGZvcm1SZXF1ZXN0KHVybCwgcGFyYW1zLCB7fSwgXCJwb3N0XCIpXG4gICAgICAgICAgICA6IHJlcXVlc3QodXJsLCBwYXJhbXMsIHt9LCBcInBvc3RcIikpO1xuICAgICAgICBoYW5kbGVBbmFseXplUmVzcG9uc2UoeyByZXNwb25zZSwgaW5pdGlhbGl6ZSwgYW5hbHl6ZVNlbGVjdGVkTGF5ZXIsIGdlb2NvZGVTZXJ2aWNlVXJsLCBsYW5nLCBwb3J0YWwsIGl0ZW1UeXBlIH0pO1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSB8fCBlcnJvciB8fCBcIlwiO1xuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgZXJyb3JNZXNzYWdlLmluY2x1ZGVzKFwic3BlY2lmeSBkYXRhIHRvIGJlIGFuYWx5emVkXCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwiZW1wdHlGaWxlXCIgfSB9O1xuICAgICAgICAgICAgY2FzZSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJEdXBsaWNhdGUgZmllbGQgbmFtZXMgYXJlIG5vdCBhbGxvd2VkXCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwiZHVwbGljYXRlRmllbGROYW1lc1wiIH0gfTtcbiAgICAgICAgICAgIGNhc2UgZXJyb3JNZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJ0aW1lb3V0XCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidGltZW91dFwiIH0gfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFuYWx5emVSZXNwb25zZSh7IHJlc3BvbnNlLCBhbmFseXplU2VsZWN0ZWRMYXllciwgaW5pdGlhbGl6ZSwgZ2VvY29kZVNlcnZpY2VVcmwsIGxhbmcsIHBvcnRhbCwgaXRlbVR5cGUgfSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgIGNvbnN0IGdlb2NvZGVDb25maWcgPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgaXNQb3J0YWwgPSBwb3J0YWwuaXNQb3J0YWw7XG4gICAgY29uc3QgaXNFeGNlbCA9IGl0ZW1UeXBlID09PSBcIk1pY3Jvc29mdCBFeGNlbFwiO1xuICAgIGNvbnN0IHB1Ymxpc2hQYXJhbWV0ZXJzID0gaXNFeGNlbFxuICAgICAgICA/IChfYiA9IChfYSA9IHJlc3BvbnNlLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2dlb2NvZGVDb25maWcuc2VsZWN0ZWRTaGVldF0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IChfYyA9IHJlc3BvbnNlLnB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzBdXG4gICAgICAgIDogcmVzcG9uc2UucHVibGlzaFBhcmFtZXRlcnM7XG4gICAgbGV0IHNvdXJjZUNvdW50cnk7XG4gICAgaWYgKCghaXNQb3J0YWwgJiYgZ2VvY29kZUNvbmZpZy5pc1dvcmxkR2VvY29kZVNlcnZlcikgfHxcbiAgICAgICAgKGlzUG9ydGFsICYmIGdlb2NvZGVDb25maWcuaXNTZXJ2aWNlUHJveHlBZ29Xb3JsZEdlb2NvZGVTZXJ2ZXIpKSB7XG4gICAgICAgIGNvbnN0IGlzV29ybGRHZW9jb2RlU2VydmVyID0gaXNEZWZpbmVkKHB1Ymxpc2hQYXJhbWV0ZXJzLnNvdXJjZUNvdW50cnkpO1xuICAgICAgICBzb3VyY2VDb3VudHJ5ID0gZ2VvY29kZUNvbmZpZy5zb3VyY2VDb3VudHJ5IHx8IHB1Ymxpc2hQYXJhbWV0ZXJzLnNvdXJjZUNvdW50cnkgfHwgXCJ3b3JsZFwiO1xuICAgICAgICBzb3VyY2VDb3VudHJ5ID0gc291cmNlQ291bnRyeSA9PT0gXCJ3b1wiID8gXCJ3b3JsZFwiIDogc291cmNlQ291bnRyeTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmlzV29ybGRHZW9jb2RlU2VydmVyID0gaXNXb3JsZEdlb2NvZGVTZXJ2ZXI7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zb3VyY2VDb3VudHJ5ID0gc291cmNlQ291bnRyeTtcbiAgICB9XG4gICAgaWYgKCFnZW9jb2RlQ29uZmlnLmFsbG93R2VvY29kZSAmJiBwdWJsaXNoUGFyYW1ldGVycy5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcIm5vbmVcIjtcbiAgICB9XG4gICAgdXBkYXRlTG9jYXRpb25GaWVsZHMocmVzcG9uc2UpO1xuICAgIGNvbnN0IHVwZGF0ZWRSZXNwb25zZSA9IHVwZGF0ZUZpZWxkcyhyZXNwb25zZSk7XG4gICAgYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzID0gdXBkYXRlZFJlc3BvbnNlO1xuICAgIGlmICgoX2QgPSB1cGRhdGVkUmVzcG9uc2UgPT09IG51bGwgfHwgdXBkYXRlZFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1cGRhdGVkUmVzcG9uc2UucHVibGlzaFBhcmFtZXRlcnMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5sYXllcnMpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmV4Y2VsTGF5ZXJzID0gKF9lID0gdXBkYXRlZFJlc3BvbnNlID09PSBudWxsIHx8IHVwZGF0ZWRSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXBkYXRlZFJlc3BvbnNlLnB1Ymxpc2hQYXJhbWV0ZXJzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubGF5ZXJzO1xuICAgIH1cbiAgICBjb25zdCBsYXllckluZm8gPSBnZXRBbmFseXplZExheWVySW5mbyhyZXNwb25zZSwgYW5hbHl6ZVNlbGVjdGVkTGF5ZXIpO1xuICAgIGlmIChpbml0aWFsaXplKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5iYWNrdXBMYXllckZpZWxkcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobGF5ZXJJbmZvLmZpZWxkcykpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIHdvcmxkIGdlb2NvZGVyIGlmIG5vIGZpZWxkIG5hbWVzIGZvdW5kXG4gICAgICAgICEhcHVibGlzaFBhcmFtZXRlcnMuc3RhbmRhcmRpemVkRmllbGROYW1lc1xuICAgICAgICAgICAgPyAoYWRkSXRlbVN0YXRlLnN0YW5kYXJkaXplZEZpZWxkTmFtZXMgPSBwdWJsaXNoUGFyYW1ldGVycy5zdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKVxuICAgICAgICAgICAgOiBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKHtcbiAgICAgICAgICAgICAgICBsYW5nLFxuICAgICAgICAgICAgICAgIGdlb2NvZGVTZXJ2aWNlVXJsLFxuICAgICAgICAgICAgICAgIC8vICEgV2Ugc2V0IHRoZSBsb2NhdGlvbiB0eXBlIGFib3ZlIHNvIHdlIGNhbid0IGp1c3QgdXNlIHRoZSBkZXN0cnVjdGVkIHZhbHVlXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogcmVmYWN0b3IgdGhhdCBpbnRvIGEgbG9jYWwgdmFyaWFibGVcbiAgICAgICAgICAgICAgICBsb2NhdGlvblR5cGU6IGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGVcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBmaWd1cmUgb3V0IGhvdyBtdWNoIHRoaXMgYWN0aW9uIHdpbGwgY29zdFxuICAgIGlmIChhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiB8fFxuICAgICAgICBsYXllckluZm8ubG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiB8fFxuICAgICAgICAoKF9mID0gcmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnB1Ymxpc2hQYXJhbWV0ZXJzKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YubG9jYXRpb25UeXBlKSA9PT0gXCJhZGRyZXNzXCIpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmdlb2NvZGVDb3N0ID0gYXdhaXQgZ2V0R2VvY29kaW5nQ29zdChsYXllckluZm8uZXN0aW1hdGVkUmVjb3JkQ291bnQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmdlb2NvZGVDb3N0ID0gbnVsbDtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKHsgbGFuZywgZ2VvY29kZVNlcnZpY2VVcmwsIGxvY2F0aW9uVHlwZSB9KSB7XG4gICAgaWYgKGxvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnN0YW5kYXJkaXplZEZpZWxkTmFtZXMgPSBhd2FpdCBnZXRGaWVsZE5hbWVzRnJvbUdlb2NvZGVyKGdlb2NvZGVTZXJ2aWNlVXJsLCBsYW5nKTtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBnZXRGaWVsZE5hbWVzRnJvbUdlb2NvZGVyKGdlb2NvZGVTZXJ2aWNlVXJsLCBsYW5nKSB7XG4gICAgY29uc3QgZ2VvY29kZXJSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoZ2VvY29kZVNlcnZpY2VVcmwsIHt9LCB7IGFkZFRva2VuTWFudWFsbHk6IGZhbHNlIH0pO1xuICAgIHJldHVybiBnZW9jb2RlclJlc3BvbnNlLmFkZHJlc3NGaWVsZHMucmVkdWNlKChhY2MsIGZpZWxkKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKGZpZWxkLm5hbWUgIT09IFwidW5rbm93blwiKSB7XG4gICAgICAgICAgICBhY2NbZmllbGQubmFtZV0gPSAoKF9hID0gZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLmxvY2FsaXplZE5hbWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbYCR7bGFuZ31gXSkgfHwgZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcbn1cblxuZXhwb3J0IHsgYW5hbHl6ZSBhcyBhLCBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YW5hbHl6ZS02OWVjMDhjOC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IHVpZEZpZWxkcyA9IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIl07XG5jb25zdCBOT05FX1ZBTFVFID0gXCI8Tm9uZT5cIjtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyA9IHtcbiAgICBcImZpbGUgZ2VvZGF0YWJhc2VcIjogXCJmaWxlZ2VvZGF0YWJhc2VcIixcbiAgICBzaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgZ2VvanNvbjogXCJnZW9qc29uXCIsXG4gICAgY3N2OiBcIkNTVlwiLFxuICAgIFwibWljcm9zb2Z0IGV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBnZW9wYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IGFwcGVuZEZpbGVUeXBlcyA9IHtcbiAgICBTaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgXCJGaWxlIEdlb2RhdGFiYXNlXCI6IFwiZmlsZUdlb2RhdGFiYXNlXCIsXG4gICAgQ1NWOiBcImNzdlwiLFxuICAgIFwiTWljcm9zb2Z0IEV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBHZW9Kc29uOiBcImdlb2pzb25cIixcbiAgICBHZW9QYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzID0ge1xuICAgIGNzdjogXCJDU1ZcIixcbiAgICBleGNlbDogXCJNaWNyb3NvZnQgRXhjZWxcIixcbiAgICBzaGFwZWZpbGU6IFwiU2hhcGVmaWxlXCIsXG4gICAgZmdkYjogXCJGaWxlIEdlb2RhdGFiYXNlXCIsXG4gICAgZ2VvanNvbjogXCJHZW9Kc29uXCIsXG4gICAgZ29vZ2xlc2hlZXRzOiBcIk1pY3Jvc29mdCBFeGNlbFwiXG59O1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9ucyA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJnZW9qc29uXCIsIFwiZ3BrZ1wiLCBcImpzb25cIl07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIl07XG5cbmV4cG9ydCB7IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIGFzIEEsIE5PTkVfVkFMVUUgYXMgTiwgYXBwZW5kRmlsZVR5cGVzIGFzIGEsIEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyBhcyBiLCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSBhcyBjLCBhcHBlbmRFeHRlbnNpb25zIGFzIGQsIHVpZEZpZWxkcyBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGVuZC00ZTExMDMyYy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbnZhciBzY2FsZXM7XG4oZnVuY3Rpb24gKHNjYWxlcykge1xuICAgIHNjYWxlc1tcIlNNQUxMXCJdID0gXCJzXCI7XG4gICAgc2NhbGVzW1wiTUVESVVNXCJdID0gXCJtXCI7XG4gICAgc2NhbGVzW1wiTEFSR0VcIl0gPSBcImxcIjtcbn0pKHNjYWxlcyB8fCAoc2NhbGVzID0ge30pKTtcbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSB2YWx1ZSBpcyBkZWZpbmVkXG4gKiBAcGFyYW0gdmFsdWUgLSB2YWx1ZSB0byBjaGVja1xuICovXG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIG5vZGUgaGFzIG5vZGVOYW1lIG9yIGlzIGNvbnRhaW5lZCBpbiBhIHBhcmVudCBub2RlIHdpdGggbm9kZU5hbWVcbiAqIEBwYXJhbSBub2RlXG4gKiBAcGFyYW0gbm9kZU5hbWVcbiAqL1xuZnVuY3Rpb24gaXNJbk5vZGUobm9kZSwgbm9kZU5hbWUpIHtcbiAgICB3aGlsZSAobm9kZSkge1xuICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gbm9kZU5hbWUudG9VcHBlckNhc2UoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50RWxlbWVudDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgeyBpc0RlZmluZWQgYXMgYSwgaXNJbk5vZGUgYXMgaSwgc2NhbGVzIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YmFzaWMtNmRiN2ViZDcuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG52YXIgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bTtcbihmdW5jdGlvbiAoaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bSkge1xuICAgIGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW1bXCJzb3VyY2VVcmxcIl0gPSBcInNvdXJjZVVybFwiO1xuICAgIGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW1bXCJ0aXRsZVwiXSA9IFwidGl0bGVcIjtcbiAgICBpbWFnZUNvbXBvbmVudElucHV0VHlwZXNFbnVtW1wiY2FwdGlvblwiXSA9IFwiY2FwdGlvblwiO1xuICAgIGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW1bXCJsaW5rVXJsXCJdID0gXCJsaW5rVXJsXCI7XG4gICAgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bVtcImFsdFRleHRcIl0gPSBcImFsdFRleHRcIjtcbn0pKGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW0gfHwgKGltYWdlQ29tcG9uZW50SW5wdXRUeXBlc0VudW0gPSB7fSkpO1xudmFyIGZpZWxkSW5mb1ByZWZpeEVudW07XG4oZnVuY3Rpb24gKGZpZWxkSW5mb1ByZWZpeEVudW0pIHtcbiAgICBmaWVsZEluZm9QcmVmaXhFbnVtW1wiZXhwcmVzc2lvblwiXSA9IFwiZXhwcmVzc2lvbi9cIjtcbiAgICBmaWVsZEluZm9QcmVmaXhFbnVtW1wicmVsYXRpb25zaGlwXCJdID0gXCJyZWxhdGlvbnNoaXBzL1wiO1xuICAgIGZpZWxkSW5mb1ByZWZpeEVudW1bXCJyYXN0ZXJcIl0gPSBcIlJhc3Rlci5cIjtcbn0pKGZpZWxkSW5mb1ByZWZpeEVudW0gfHwgKGZpZWxkSW5mb1ByZWZpeEVudW0gPSB7fSkpO1xudmFyIGxheWVyRGlzcGxheVR5cGVFbnVtO1xuKGZ1bmN0aW9uIChsYXllckRpc3BsYXlUeXBlRW51bSkge1xuICAgIGxheWVyRGlzcGxheVR5cGVFbnVtW1wiZmVhdHVyZVwiXSA9IFwiZmVhdHVyZVwiO1xuICAgIGxheWVyRGlzcGxheVR5cGVFbnVtW1wiY2x1c3RlclwiXSA9IFwiY2x1c3RlclwiO1xuICAgIGxheWVyRGlzcGxheVR5cGVFbnVtW1wibWFwTm90ZXNcIl0gPSBcIm1hcE5vdGVzXCI7XG59KShsYXllckRpc3BsYXlUeXBlRW51bSB8fCAobGF5ZXJEaXNwbGF5VHlwZUVudW0gPSB7fSkpO1xudmFyIHNlcnZpY2VUeXBlRW51bTtcbihmdW5jdGlvbiAoc2VydmljZVR5cGVFbnVtKSB7XG4gICAgc2VydmljZVR5cGVFbnVtW1wiZmVhdHVyZVwiXSA9IFwiZmVhdHVyZVwiO1xuICAgIHNlcnZpY2VUeXBlRW51bVtcIm1hcEltYWdlXCJdID0gXCJtYXAtaW1hZ2VcIjtcbiAgICBzZXJ2aWNlVHlwZUVudW1bXCJzY2VuZVwiXSA9IFwic2NlbmVcIjtcbiAgICBzZXJ2aWNlVHlwZUVudW1bXCJvZ2NGZWF0dXJlXCJdID0gXCJvZ2MtZmVhdHVyZVwiO1xuICAgIHNlcnZpY2VUeXBlRW51bVtcImltYWdlcnlcIl0gPSBcImltYWdlcnlcIjtcbiAgICBzZXJ2aWNlVHlwZUVudW1bXCJ3ZnNcIl0gPSBcIndmc1wiO1xuICAgIHNlcnZpY2VUeXBlRW51bVtcIndtc1wiXSA9IFwid21zXCI7XG4gICAgc2VydmljZVR5cGVFbnVtW1wiY3N2XCJdID0gXCJjc3ZcIjtcbiAgICBzZXJ2aWNlVHlwZUVudW1bXCJnZW9qc29uXCJdID0gXCJnZW9qc29uXCI7XG4gICAgc2VydmljZVR5cGVFbnVtW1wic3RyZWFtXCJdID0gXCJzdHJlYW1cIjtcbiAgICBzZXJ2aWNlVHlwZUVudW1bXCJpbWFnZXJ5VGlsZVwiXSA9IFwiaW1hZ2VyeS10aWxlXCI7XG4gICAgc2VydmljZVR5cGVFbnVtW1widGlsZVwiXSA9IFwidGlsZVwiO1xuICAgIHNlcnZpY2VUeXBlRW51bVtcInN1YnR5cGVcIl0gPSBcInN1YnR5cGVcIjtcbn0pKHNlcnZpY2VUeXBlRW51bSB8fCAoc2VydmljZVR5cGVFbnVtID0ge30pKTtcbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5hcmNnaXMuY29tL2phdmFzY3JpcHQvbGF0ZXN0L2FwaS1yZWZlcmVuY2UvZXNyaS1sYXllcnMtc3VwcG9ydC1GaWVsZC5odG1sI3R5cGVcbnZhciBmaWVsZFR5cGVzRW51bTtcbihmdW5jdGlvbiAoZmllbGRUeXBlc0VudW0pIHtcbiAgICBmaWVsZFR5cGVzRW51bVtcImludGVnZXJcIl0gPSBcImludGVnZXJcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcInNtYWxsSW50ZWdlclwiXSA9IFwic21hbGwtaW50ZWdlclwiO1xuICAgIGZpZWxkVHlwZXNFbnVtW1wiYmlnSW50ZWdlclwiXSA9IFwiYmlnLWludGVnZXJcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcInNpbmdsZVwiXSA9IFwic2luZ2xlXCI7XG4gICAgZmllbGRUeXBlc0VudW1bXCJkb3VibGVcIl0gPSBcImRvdWJsZVwiO1xuICAgIGZpZWxkVHlwZXNFbnVtW1wibG9uZ1wiXSA9IFwibG9uZ1wiO1xuICAgIGZpZWxkVHlwZXNFbnVtW1wic3RyaW5nXCJdID0gXCJzdHJpbmdcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcImRhdGVcIl0gPSBcImRhdGVcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcImRhdGVPbmx5XCJdID0gXCJkYXRlLW9ubHlcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcInRpbWVPbmx5XCJdID0gXCJ0aW1lLW9ubHlcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcInRpbWVzdGFtcE9mZnNldFwiXSA9IFwidGltZXN0YW1wLW9mZnNldFwiO1xuICAgIGZpZWxkVHlwZXNFbnVtW1wib2lkXCJdID0gXCJvaWRcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcImd1aWRcIl0gPSBcImd1aWRcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcImdsb2JhbElkXCJdID0gXCJnbG9iYWwtaWRcIjtcbiAgICBmaWVsZFR5cGVzRW51bVtcIm51bWJlclwiXSA9IFwibnVtYmVyXCI7IC8vIGZvciBhcmNhZGVcbn0pKGZpZWxkVHlwZXNFbnVtIHx8IChmaWVsZFR5cGVzRW51bSA9IHt9KSk7XG52YXIgTGFzdFNvcnR5Qnk7XG4oZnVuY3Rpb24gKExhc3RTb3J0eUJ5KSB7XG4gICAgTGFzdFNvcnR5QnlbXCJkZWZhdWx0XCJdID0gXCJkZWZhdWx0XCI7XG4gICAgTGFzdFNvcnR5QnlbXCJkaXNwbGF5XCJdID0gXCJkaXNwbGF5XCI7XG4gICAgTGFzdFNvcnR5QnlbXCJ0eXBlXCJdID0gXCJ0eXBlXCI7XG4gICAgTGFzdFNvcnR5QnlbXCJmaWVsZFwiXSA9IFwiZmllbGRcIjtcbn0pKExhc3RTb3J0eUJ5IHx8IChMYXN0U29ydHlCeSA9IHt9KSk7XG5cbmV4cG9ydCB7IExhc3RTb3J0eUJ5IGFzIEwsIGZpZWxkVHlwZXNFbnVtIGFzIGEsIGZpZWxkSW5mb1ByZWZpeEVudW0gYXMgZiwgaW1hZ2VDb21wb25lbnRJbnB1dFR5cGVzRW51bSBhcyBpLCBsYXllckRpc3BsYXlUeXBlRW51bSBhcyBsLCBzZXJ2aWNlVHlwZUVudW0gYXMgcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tb25FbnVtcy1mY2YxMzY2MS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=