"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-52e580"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-field-info.entry.js":
/*!********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-field-info.entry.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_field_info: () => (/* binding */ ArcgisFieldInfo)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */








const CSS = {
    container: "container",
    section: "section",
    title: "title",
    missing: "missing",
    data: "data",
    count: "count",
    statisticsRow: "statistics-row",
    statisticsRowTopValues: "statistics-row-top-values"
};

var status;
(function (status) {
    status["MISSING"] = "missing";
    status["IN_PROGRESS"] = "inProgress";
    status["SUCCESS"] = "success";
    status["FAILED"] = "failed";
})(status || (status = {}));
var simpleFieldTypes;
(function (simpleFieldTypes) {
    simpleFieldTypes["NUMBER"] = "number";
    simpleFieldTypes["STRING"] = "string";
    simpleFieldTypes["DATE"] = "date";
    simpleFieldTypes["DATE_ONLY"] = "date-only";
    simpleFieldTypes["TIME_ONLY"] = "time-only";
    simpleFieldTypes["TIMESTAMP_OFFSET"] = "timestamp-offset";
    simpleFieldTypes["OID"] = "oid";
    simpleFieldTypes["GUID"] = "guid";
    simpleFieldTypes["UNKNOWN"] = "unknown";
})(simpleFieldTypes || (simpleFieldTypes = {}));
/**
 * Returns true if the value is defined
 * @param value - value to check
 */
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Returns the URL used for queries.
 * E.g. SceneLayers need to use the FeatureLayer URL for queries.
 * @param value - value to check
 */
function getQueryURL(layer) {
    var _a;
    if (layer.type === "scene") {
        return (_a = layer.associatedLayer) === null || _a === void 0 ? void 0 : _a.url;
    }
    return layer.url;
}

/**
 * Returns additional field information from layer
 * @param props - properties containing layer and fieldName
 */
function getFieldInfo(props) {
    var _a;
    const { layer, fieldName } = props;
    let fieldInfo;
    const { popupTemplate } = layer;
    const popupFieldInfos = popupTemplate ? popupTemplate.fieldInfos : [];
    (layer.type === "imagery-tile"
        ? layer.rasterFields
        : layer.type === "imagery" && ((_a = layer.rasterFields) === null || _a === void 0 ? void 0 : _a.length)
            ? layer.rasterFields
            : layer.fields)
        .filter((layerField) => layerField.name === fieldName)
        .forEach((layerField) => {
        const list = popupFieldInfos
            ? popupFieldInfos.filter((fInfo) => fInfo.fieldName === layerField.name)
            : null;
        const label = (list === null || list === void 0 ? void 0 : list.length) ? list[0].label : null;
        if (/^raster.(item|service)pixelvalue/i.test(fieldName)) {
            // e.g. "Raster.ServicePixelValue" | "Raster.ItemPixelValue" | "Raster.ServicePixelValue.Raw"
            // layer.rasterFields reports them as type "string"
            layerField.type = "double";
        }
        const featureFilterField = {
            layerField: layerField,
            label: label || layerField.alias || layerField.name
        };
        featureFilterField.codedValues = getCodedValues(fieldName, props);
        _getSimpleFieldType(featureFilterField);
        if (featureFilterField.simpleFieldType) {
            fieldInfo = featureFilterField;
        } // else can't use field
    });
    return fieldInfo;
}
/**
 * Returns feature count in layer
 * @param props - properties containing layer and fieldName
 */
async function getFeatureCount(props) {
    props.statisticsStatus = status.IN_PROGRESS;
    const { layer, view } = props;
    if (layer.type === "imagery" || layer.type === "imagery-tile" || layer.type === "stream") {
        throw new Error("could not get feature count");
    }
    try {
        return await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_3__.g)(layer, view);
    }
    catch (error) {
        return;
    }
}
/**
 * Returns summary statistics
 * @param props - properties containing layer and fieldName
 */
async function getStatistics(props) {
    const { layer, view, fieldName, fieldInfo } = props;
    if (layer.type === "imagery" || layer.type === "imagery-tile") {
        throw new Error("could not get statistics for ImageryLayer/ImageryTileLayer");
    }
    if (!fieldInfo ||
        fieldInfo.layerField.type === "oid" ||
        fieldInfo.layerField.type === "guid" ||
        fieldInfo.layerField.type === "global-id") {
        const count = await getFeatureCount(props);
        return Promise.resolve({ totalCount: count, nullcount: 0 });
    }
    try {
        const [summaryStatistics] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/smartMapping/statistics/summaryStatistics"]);
        const result = await summaryStatistics({
            layer,
            view,
            field: fieldName
        });
        if (!isDefined(result.count)) {
            // statistics is unusable
            throw new Error("could not get statistics");
        }
        // if we hit maxRecordCount other stats values are probably not correct either
        const hitMaxRecordCount = "sourceJSON" in layer && layer.sourceJSON.maxRecordCount === result.count;
        // count only contains features with a value (!= null)
        if (isDefined(result.nullcount) && !hitMaxRecordCount) {
            // we can add the feature count without null and the count of nulls
            const stats = Object.assign(Object.assign({}, result), { totalCount: result.count + result.nullcount });
            return stats;
        }
        else {
            // we want the total feature count
            // happens e.g. for SceneLayers with older stats cache
            const count = await getFeatureCount(props);
            const stats = Object.assign(Object.assign({}, result), { totalCount: count });
            return stats;
        }
    }
    catch (error) {
        throw new Error("could not get statistics");
    }
}
/**
 * Returns unique values
 * @param props - properties containing layer and fieldName
 */
async function getUniqueValues(props) {
    const { layer, view, fieldName } = props;
    if (layer.type === "imagery" || layer.type === "imagery-tile") {
        throw new Error("could not get unique values for ImageryLayer/ImageryTileLayer");
    }
    if (layer.type === "feature" && !layer.url) {
        layer.outFields = ["*"];
    }
    const [uniqueValues] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/smartMapping/statistics/uniqueValues"]);
    try {
        const result = await uniqueValues({
            layer,
            view,
            field: fieldName
        });
        return result;
    }
    catch (error) {
        throw new Error("could not get unique values");
    }
}
function _getSimpleFieldType(featureFilterField) {
    switch (featureFilterField.layerField.type) {
        case "string":
            featureFilterField.simpleFieldType = simpleFieldTypes.STRING;
            break;
        case "date":
            featureFilterField.simpleFieldType = simpleFieldTypes.DATE;
            break;
        case "timestamp-offset":
            featureFilterField.simpleFieldType = simpleFieldTypes.TIMESTAMP_OFFSET;
            break;
        case "date-only":
            featureFilterField.simpleFieldType = simpleFieldTypes.DATE_ONLY;
            break;
        case "time-only":
            featureFilterField.simpleFieldType = simpleFieldTypes.TIME_ONLY;
            break;
        case "oid":
            featureFilterField.simpleFieldType = simpleFieldTypes.OID;
            break;
        case "guid":
        case "global-id":
            featureFilterField.simpleFieldType = simpleFieldTypes.GUID;
            break;
        case "small-integer":
        case "big-integer":
        case "integer":
        case "single":
        case "double":
        case "long":
            featureFilterField.simpleFieldType = simpleFieldTypes.NUMBER;
            break;
    }
}
function getCodedValues(fieldName, props) {
    const { layer, modules } = props;
    if (layer.type !== "feature") {
        return;
    }
    const typeIdField = layer.typeIdField;
    const types = layer.types;
    let fieldDomains;
    const field = layer.fields.find((field) => field.name === fieldName);
    const fieldDomain = field.domain;
    if (typeIdField && types) {
        // layer has types
        if (typeIdField === fieldName) {
            // this is the field with the types
            fieldDomains = types.map((type) => {
                // fake coded Values
                return {
                    code: type.id,
                    name: type.name
                };
            });
        }
        else {
            // field does not have types; look farther inside the types
            fieldDomains = [];
            types.forEach((type) => {
                var _a, _b;
                if (!type.domains || !type.domains[fieldName] || type.domains[fieldName].type === "inherited") {
                    const domain = fieldDomain;
                    if (domain === null || domain === void 0 ? void 0 : domain.codedValues) {
                        domain.codedValues.forEach(async (codedValue) => {
                            let found = false;
                            fieldDomains.forEach((codedVal) => {
                                if (codedVal.code === codedValue.code) {
                                    found = true;
                                    if (`, ${codedVal.name},`.indexOf(`, ${codedValue.name},`) === -1) {
                                        codedVal.name += `, ${codedValue.name}`;
                                    }
                                }
                            });
                            if (!found) {
                                fieldDomains.push(modules.esriLang.clone(codedValue));
                            }
                        });
                    }
                }
                else if ((_b = (_a = type.domains) === null || _a === void 0 ? void 0 : _a[fieldName]) === null || _b === void 0 ? void 0 : _b.codedValues) {
                    type.domains[fieldName].codedValues.forEach(async (codedValue) => {
                        let found = false;
                        fieldDomains.forEach((codedVal) => {
                            if (codedVal.code === codedValue.code) {
                                found = true;
                                if (`, ${codedVal.name},`.indexOf(`, ${codedValue.name},`) === -1) {
                                    codedVal.name += `, ${codedValue.name}`;
                                }
                            }
                        });
                        if (!found) {
                            fieldDomains.push(modules.esriLang.clone(codedValue));
                        }
                    });
                }
            });
        }
        if (!(fieldDomains === null || fieldDomains === void 0 ? void 0 : fieldDomains.length) && (fieldDomain === null || fieldDomain === void 0 ? void 0 : fieldDomain.codedValues)) {
            fieldDomains = modules.esriLang.clone(fieldDomain.codedValues);
        }
    }
    else if (fieldDomain === null || fieldDomain === void 0 ? void 0 : fieldDomain.codedValues) {
        // domains directly on the layer field
        fieldDomains = field.domain.codedValues;
    }
    return (fieldDomains === null || fieldDomains === void 0 ? void 0 : fieldDomains.length) ? fieldDomains : null;
}

/**
 * Returns up to 5 features from the layer to get sample data
 * @param props - properties containing layer and view
 */
async function getOneFeature(props) {
    var _a, _b;
    const { view, layer } = props;
    if (layer.type === "imagery" || layer.type === "imagery-tile") {
        throw new Error("could not get feature");
    }
    if ((layer.type === "feature" && !layer.url) || layer.type === "wfs") {
        // feature collection or wfs
        const query = layer.createQuery();
        query.start = 0;
        query.num = 5;
        query.outFields = ["*"];
        const result = await layer.queryFeatures(query);
        if ((_a = result.features) === null || _a === void 0 ? void 0 : _a.length) {
            return result;
        }
        else {
            throw new Error("could not get feature");
        }
    }
    else {
        // service
        if (!view) {
            // get feature from service directly
            return _queryOneFeature(props);
        }
        const layerView = (await view.whenLayerView(layer));
        const hasAllFields = layerView.availableFields.length === layer.fields.length;
        if (hasAllFields || (["stream", "ogc-feature"].indexOf(layer.type) > -1 && layerView.availableFields.length > 0)) {
            // features on client have all fields
            // or we can't make a server query, so we take what we can get
            const query = layer.createQuery();
            query.start = 0;
            query.num = 5;
            query.outFields = ["*"];
            const result = await layerView.queryFeatures(query);
            if ((_b = result.features) === null || _b === void 0 ? void 0 : _b.length) {
                // client side features
                return result;
            }
            else {
                // get feature from service
                return _queryOneFeature(props);
            }
        }
        else {
            // get feature from service
            return _queryOneFeature(props);
        }
    }
}
async function _queryOneFeature(props) {
    const { layer } = props;
    if (["imagery", "imagery-tile", "stream", "ogc-feature"].indexOf(layer.type) > -1) {
        throw new Error("cannot get feature from service");
    }
    const [Query] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/rest/support/Query"]);
    const query = new Query({
        where: "1=1",
        outFields: ["*"],
        returnGeometry: false
    });
    return layer.queryFeatures(query);
}

const arcgisFieldInfoCss = ":host{height:100%}.container{padding:6px;background-color:white}.title{font-weight:bold;padding:5px 0}.missing{color:#a9a9a9}.data{color:#a9a9a9}.count{white-space:nowrap}.section{padding:6px 0}.statistics-row{border-top:1px solid #e0e0e0;padding:6px 0;display:flex;justify-content:space-between}.statistics-row-top-values{border-top:1px solid #e0e0e0;padding:20px 0 6px 0;display:flex;justify-content:space-between}";

const ArcgisFieldInfo = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisFieldInfoComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFieldInfoComplete", 7);
        this.view = undefined;
        this.layer = undefined;
        this.fieldName = undefined;
        this.hideStatistics = false;
        this.oneFeatureResponse = undefined;
        this.oneFeatureResponseStatus = status.MISSING;
        this.statistics = undefined;
        this.statisticsStatus = status.MISSING;
        this.uniqueValues = undefined;
        this.uniqueValuesStatus = status.MISSING;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const [strings, currentLanguage, currentLanguageIntl] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = strings;
        this.locale = currentLanguage;
        this.localIntl = currentLanguageIntl;
        const [esriLang, intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)([
            "esri/core/lang",
            "esri/intl"
        ]);
        const { view, layer, fieldName, hideStatistics } = this;
        let sublayerFL;
        if (layer.declaredClass === "esri.layers.support.Sublayer") {
            // need to create a FeatureLayer
            const sublayer = layer;
            const [reactiveUtils] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/core/reactiveUtils"]);
            view && (await reactiveUtils.whenOnce(() => !view.updating));
            sublayerFL = await sublayer.createFeatureLayer();
            await sublayerFL.load();
        }
        this.props = {
            view,
            layer: sublayerFL || layer,
            fieldName,
            hideStatistics,
            modules: { esriLang, intl }
        };
        // required for initial load
        this.props.fieldInfo = getFieldInfo(this.props);
    }
    async componentDidLoad() {
        var _a;
        // once component is visible make other calls
        const { props, hideStatistics } = this;
        const { layer, modules } = props;
        modules.intl.setLocale(this.localIntl);
        // modules.intl.setLocale(this.locale) not returning the correct formatting for e.g. it-ch
        // we don't know if the SceneLayer has an associated FL
        // don't prompt for a login if it's not accessible
        if (layer.type === "scene") {
            const [esriConfig] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/config"]);
            esriConfig.request.interceptors.push({
                urls: getQueryURL(layer) + "/" + layer.layerId,
                before: function (params) {
                    params.requestOptions.authMode = "no-prompt";
                }
            });
        }
        this.oneFeatureResponseStatus = status.IN_PROGRESS;
        try {
            const result = await getOneFeature(this.props);
            this.oneFeatureResponse = result;
            this.oneFeatureResponseStatus = status.SUCCESS;
        }
        catch (error) {
            this.oneFeatureResponseStatus = status.FAILED;
        }
        if (layer.type === "stream") {
            this.uniqueValuesStatus = status.FAILED;
            this.statisticsStatus = status.FAILED;
            return;
        }
        if (hideStatistics) {
            this.uniqueValuesStatus = status.FAILED;
        }
        else {
            this.uniqueValuesStatus = status.IN_PROGRESS;
            try {
                const uniqueValues = await getUniqueValues(this.props);
                this.uniqueValues = uniqueValues;
                if ((_a = uniqueValues === null || uniqueValues === void 0 ? void 0 : uniqueValues.uniqueValueInfos) === null || _a === void 0 ? void 0 : _a.length) {
                    this.uniqueValuesStatus = status.SUCCESS;
                }
                else {
                    this.uniqueValuesStatus = status.FAILED;
                }
            }
            catch (error) {
                this.uniqueValuesStatus = status.FAILED;
            }
        }
        if (hideStatistics) {
            this.statisticsStatus = status.FAILED;
        }
        else {
            this.statisticsStatus = status.IN_PROGRESS;
            try {
                const statistics = await getStatistics(this.props);
                if (!isDefined(statistics.totalCount) &&
                    isDefined(statistics.count) &&
                    this.uniqueValuesStatus === status.SUCCESS) {
                    // take null values count from unique values and add with non-null count from statistics
                    const infos = this.uniqueValues.uniqueValueInfos;
                    for (let i = 0; i < infos.length; i++) {
                        const info = infos[i];
                        if (info.value === null) {
                            statistics.totalCount = info.count + statistics.count;
                            break;
                        }
                    }
                    if (!isDefined(statistics.totalCount)) {
                        // no null values
                        statistics.totalCount = statistics.count;
                    }
                }
                this.statistics = statistics;
                this.statisticsStatus = status.SUCCESS;
            }
            catch (error) {
                this.statisticsStatus = status.FAILED;
            }
        }
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { props } = this;
        const { fieldInfo } = props;
        if (!fieldInfo) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.container }, this.renderFieldType(), this.renderFieldAlias(), this.renderFieldDescription(), this.renderFieldValueType(), this.renderFieldSampleValue(), this.renderFieldFormat(), this.renderFieldStatistics())));
    }
    renderFieldType() {
        const { strings, props } = this;
        const { fieldInfo } = props;
        const fieldType = this._getFieldTypeLabel(fieldInfo.layerField.type);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, fieldType)));
    }
    renderFieldAlias() {
        const { strings, props } = this;
        const { fieldInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldAlias), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, fieldInfo.label)));
    }
    renderFieldDescription() {
        const { strings, props } = this;
        const { layer } = props;
        if (layer.type !== "feature") {
            return null;
        }
        const { fieldInfo } = props;
        const description = fieldInfo.layerField.description;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldDescription), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                [CSS.missing]: !description
            } }, description || strings.fieldDescriptionNotSet)));
    }
    renderFieldValueType() {
        const { strings, props } = this;
        const { layer } = props;
        if (layer.type !== "feature") {
            return null;
        }
        const { fieldInfo } = props;
        const fieldValueType = this._getFieldValueTypeCamelCase(fieldInfo);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldValueType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: !fieldValueType ? CSS.missing : null }, fieldValueType ? strings.fieldValueTypes[fieldValueType] : strings.fieldValueTypeNotSet)));
    }
    renderFieldSampleValue() {
        var _a, _b, _c, _d, _e;
        const { oneFeatureResponse, oneFeatureResponseStatus, statisticsStatus, statistics, uniqueValuesStatus, uniqueValues, strings, props } = this;
        const { layer, fieldName, fieldInfo } = props;
        const { statistics: statStrings } = strings;
        let value;
        if (["imagery", "imagery-tile"].indexOf(layer.type) > -1) {
            return;
        }
        if (layer.type !== "stream" &&
            [simpleFieldTypes.STRING, simpleFieldTypes.OID, simpleFieldTypes.GUID].indexOf(this._getStatisticsType(fieldInfo)) > -1 &&
            uniqueValuesStatus !== status.FAILED) {
            // we show top values
            return null;
        }
        if (oneFeatureResponseStatus === status.SUCCESS) {
            // find first valid value entry
            oneFeatureResponse.features.forEach((feature) => {
                if (value === undefined || (value === null && feature.attributes[fieldName] !== null)) {
                    value = feature.attributes[fieldName];
                }
            });
        }
        else if (statisticsStatus === status.SUCCESS) {
            // use statistics min value
            value = statistics.min;
        }
        else if (uniqueValuesStatus === status.SUCCESS) {
            // use a non-null value
            value =
                ((_b = (_a = uniqueValues.uniqueValueInfos) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.value) || ((_d = (_c = uniqueValues.uniqueValueInfos) === null || _c === void 0 ? void 0 : _c[1]) === null || _d === void 0 ? void 0 : _d.value);
        }
        const codedValues = fieldInfo.codedValues;
        if (isDefined(value)) {
            if (codedValues) {
                value = ((_e = codedValues.find((codedValue) => value === codedValue.code)) === null || _e === void 0 ? void 0 : _e.name) || value;
            }
            else {
                value = this._getDisplayString(value);
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldSampleValue), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: (oneFeatureResponseStatus === status.FAILED &&
                statisticsStatus === status.FAILED &&
                uniqueValuesStatus === status.FAILED) ||
                !isDefined(value)
                ? CSS.missing
                : null }, oneFeatureResponseStatus === status.SUCCESS ||
            statisticsStatus === status.SUCCESS ||
            uniqueValuesStatus === status.SUCCESS
            ? !isDefined(value)
                ? statStrings.allNulls
                : `${value}`
            : oneFeatureResponseStatus === status.FAILED &&
                statisticsStatus === status.FAILED &&
                uniqueValuesStatus === status.FAILED
                ? strings.fieldSampleNotAvailable
                : strings.fieldSampleRetrieving)));
    }
    renderFieldFormat() {
        var _a, _b;
        const { strings, props } = this;
        const { fieldName, fieldInfo, layer } = props;
        if (["single", "double", "long"].indexOf(fieldInfo.layerField.type) === -1) {
            return null;
        }
        const popupTemplate = layer.popupTemplate;
        if (popupTemplate === null || popupTemplate === void 0 ? void 0 : popupTemplate.fieldInfos) {
            const popFieldInfos = (_a = popupTemplate.fieldInfos) === null || _a === void 0 ? void 0 : _a.filter((fieldInfo) => fieldInfo.fieldName === fieldName);
            if (popFieldInfos === null || popFieldInfos === void 0 ? void 0 : popFieldInfos.length) {
                const popFieldInfo = popFieldInfos[0];
                if (isDefined((_b = popFieldInfo === null || popFieldInfo === void 0 ? void 0 : popFieldInfo.format) === null || _b === void 0 ? void 0 : _b.places)) {
                    const num = popFieldInfo.format.places;
                    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldDecimalPlaces), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.fieldNumDecimalPlaces.replace("${number}", num.toString()))));
                }
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldDecimalPlaces), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.missing }, strings.fieldDecimalPlacesNotAvailable)));
    }
    renderFieldStatistics() {
        const { statisticsStatus, uniqueValuesStatus, hideStatistics, strings, props } = this;
        const { layer, fieldInfo } = props;
        if (hideStatistics) {
            this.arcgisFieldInfoComplete.emit();
            return null;
        }
        if (["stream", "imagery", "imagery-tile"].indexOf(layer.type) > -1 ||
            ["long"].indexOf(fieldInfo.layerField.type) > -1) {
            // can't get statistics
            this.arcgisFieldInfoComplete.emit();
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.section }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.title }, strings.fieldStatistics), !statisticsStatus ||
            statisticsStatus === status.MISSING ||
            statisticsStatus === status.IN_PROGRESS ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "field-info-statistics-content", class: CSS.missing }, strings.fieldStatisticsRetrieving)) : statisticsStatus === status.FAILED && uniqueValuesStatus !== status.SUCCESS ? (this.renderNoStatistics()) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "field-info-statistics-content", ref: () => this.arcgisFieldInfoComplete.emit() }, this.renderStatistics()))));
    }
    renderNoStatistics() {
        const { strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: "field-info-statistics-content", ref: () => this.arcgisFieldInfoComplete.emit(), class: CSS.missing }, strings.fieldStatisticsNotAvailable));
    }
    renderStatistics() {
        const { props } = this;
        const { fieldInfo } = props;
        switch (this._getStatisticsType(fieldInfo)) {
            case simpleFieldTypes.NUMBER:
                return this.renderNumberStatistics();
            case simpleFieldTypes.STRING:
            case simpleFieldTypes.OID:
            case simpleFieldTypes.GUID:
                return this.renderStringStatistics();
            case simpleFieldTypes.DATE:
            case simpleFieldTypes.DATE_ONLY:
            case simpleFieldTypes.TIME_ONLY:
            case simpleFieldTypes.TIMESTAMP_OFFSET:
                return this.renderDateStatistics();
            default:
                return null;
        }
    }
    renderNumberStatistics() {
        const { statistics, strings } = this;
        if (!statistics) {
            return this.renderNoStatistics();
        }
        const { statistics: statStrings } = strings;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.numberOfValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.totalCount))), isDefined(statistics.sum) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.sumOfValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.sum)))) : null, isDefined(statistics.min) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.minimum), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.min)))) : null, isDefined(statistics.max) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.maximum), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.max)))) : null, isDefined(statistics.avg) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.average), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.avg)))) : null, isDefined(statistics.stddev) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.standardDeviation), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics.stddev)))) : null, this.renderNullValues()));
    }
    renderStringStatistics() {
        const { statistics, uniqueValuesStatus, strings } = this;
        const { statistics: statStrings } = strings;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.numberOfValues), uniqueValuesStatus !== status.SUCCESS ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.missing }, "--")) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics === null || statistics === void 0 ? void 0 : statistics.totalCount)))), this.renderNullValues(), this.renderTopValues()));
    }
    renderDateStatistics() {
        // TODO UTC offset
        const { statistics, view, props, strings } = this;
        const { fieldInfo } = props;
        if (!statistics) {
            return this.renderNoStatistics();
        }
        const { statistics: statStrings } = strings;
        const dateRange = statistics.max - statistics.min;
        const years = Math.floor(dateRange / 31536000000);
        let months = Math.floor((dateRange - years * 31536000000) / 2628000000);
        let days = Math.ceil((dateRange - months * 2628000000) / 86400000);
        if (days >= 30) {
            months += 1;
            days = 0;
        }
        let timeSpan = years === 1
            ? statStrings.timeSpanOptions.year
            : years > 1
                ? statStrings.timeSpanOptions.years.replace("${years}", years.toString())
                : "";
        timeSpan += years > 0 && (months > 0 || days > 0) ? ", " : "";
        timeSpan +=
            months === 1
                ? statStrings.timeSpanOptions.month
                : months > 1
                    ? statStrings.timeSpanOptions.months.replace("${months}", months.toString())
                    : "";
        timeSpan += months > 0 && days > 0 ? ", " : "";
        timeSpan +=
            days === 1
                ? statStrings.timeSpanOptions.day
                : days > 1
                    ? statStrings.timeSpanOptions.days.replace("${days}", days.toString())
                    : "";
        const showStats = fieldInfo.simpleFieldType !== simpleFieldTypes.TIMESTAMP_OFFSET ||
            !view ||
            view.timeZone !== "unknown";
        const isTimeOnly = fieldInfo.simpleFieldType === simpleFieldTypes.TIME_ONLY;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.numberOfValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, this._printNumValue(statistics === null || statistics === void 0 ? void 0 : statistics.totalCount))), showStats && isDefined(statistics.min) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, isTimeOnly ? statStrings.minimumTime : statStrings.minimumDate), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, `${this._getDisplayString(statistics.min)}`))) : null, showStats && isDefined(statistics.max) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, isTimeOnly ? statStrings.maximumTime : statStrings.maximumDate), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, `${this._getDisplayString(statistics.max)}`))) : null, showStats && isDefined(statistics.avg) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, isTimeOnly ? statStrings.averageTime : statStrings.averageDate), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, `${this._getDisplayString(statistics.avg)}`))) : null, showStats &&
            !isTimeOnly &&
            isDefined(statistics.min) &&
            isDefined(statistics.max) &&
            dateRange > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.timespan), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, timeSpan))) : null, this.renderNullValues()));
    }
    renderTopValues() {
        var _a;
        const { uniqueValues, uniqueValuesStatus, strings, props } = this;
        const { fieldInfo } = props;
        const { statistics: statStrings } = strings;
        if ((_a = uniqueValues === null || uniqueValues === void 0 ? void 0 : uniqueValues.uniqueValueInfos) === null || _a === void 0 ? void 0 : _a.length) {
            const infos = uniqueValues.uniqueValueInfos;
            infos.sort((a, b) => (a.count < b.count ? 1 : a.count > b.count ? -1 : 0));
            const codedValues = fieldInfo.codedValues;
            const values = infos
                .filter((info) => info.value !== null)
                .filter((info, idx) => info && idx < 10)
                .map((info) => {
                let value = info.value;
                if (codedValues) {
                    codedValues.forEach((codeValue) => {
                        if (value === codeValue.code) {
                            value = codeValue.name;
                        }
                    });
                }
                else {
                    value = this._getDisplayString(value);
                }
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, `${value}`), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `${CSS.data} ${CSS.count}` }, this._printNumValue(info.count))));
            });
            if (!values.length) {
                return null;
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRowTopValues }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, infos.length > 10 ? statStrings.topTenValues : statStrings.topValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.count)), values));
        }
        else {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRowTopValues }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.topValues), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.count)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.missing }, uniqueValuesStatus === status.FAILED
                ? strings.fieldUniqueValuesNotAvailable
                : strings.fieldSampleRetrieving))));
        }
    }
    renderNullValues() {
        const { statistics, uniqueValues, strings } = this;
        const { statistics: statStrings } = strings;
        let count = statistics === null || statistics === void 0 ? void 0 : statistics.nullcount;
        if (!isDefined(count) && uniqueValues) {
            const infos = uniqueValues.uniqueValueInfos;
            for (let i = 0; i < infos.length; i++) {
                const info = infos[i];
                if (info.value === null) {
                    count = info.count;
                    break;
                }
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.statisticsRow }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, statStrings.numberOfNulls), !isDefined(count) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.missing }, "--")) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.data }, `${new Number(count).toLocaleString()}`))));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    _getFieldTypeLabel(fieldType) {
        const { strings } = this;
        const fieldTypes = strings.fieldTypes;
        switch (fieldType) {
            case "small-integer":
                return fieldTypes.smallInteger;
            case "big-integer":
                return fieldTypes.bigInteger;
            case "integer":
                return fieldTypes.integer;
            case "single":
                return fieldTypes.single;
            case "double":
                return fieldTypes.double;
            case "long":
                return fieldTypes.long;
            case "string":
                return fieldTypes.string;
            case "date":
                return fieldTypes.date;
            case "date-only":
                return fieldTypes.dateOnly;
            case "time-only":
                return fieldTypes.timeOnly;
            case "timestamp-offset":
                return fieldTypes.timestampOffset;
            case "oid":
                return fieldTypes.oid;
            case "guid":
                return fieldTypes.guid;
            case "global-id":
                return fieldTypes.globalId;
            default:
                return fieldTypes.string;
        }
    }
    _getStatisticsType(fieldInfo) {
        // "count-or-amount","percentage-or-ratio","measurement","unique-identifier","coordinate","binary"
        // "name-or-title","type-or-category","description","location-or-place-name","ordered-or-ranked","date-and-time"
        switch (fieldInfo.layerField.type) {
            case "small-integer":
            case "big-integer":
            case "integer":
            case "single":
            case "double": {
                if (fieldInfo.codedValues) {
                    return simpleFieldTypes.STRING;
                }
                switch (fieldInfo.layerField.valueType) {
                    case "name-or-title":
                    case "type-or-category":
                    case "description":
                    case "location-or-place-name":
                    case "ordered-or-ranked":
                    case "binary":
                        //case "date-and-time":
                        return simpleFieldTypes.STRING;
                    default:
                        return simpleFieldTypes.NUMBER;
                }
            }
            case "string":
                return simpleFieldTypes.STRING;
            case "date":
                return simpleFieldTypes.DATE;
            case "timestamp-offset":
                return simpleFieldTypes.TIMESTAMP_OFFSET;
            case "date-only":
                return simpleFieldTypes.DATE_ONLY;
            case "time-only":
                return simpleFieldTypes.TIME_ONLY;
            default:
                return simpleFieldTypes.STRING;
        }
    }
    _getFieldValueTypeCamelCase(field) {
        switch (field.layerField.valueType) {
            case "count-or-amount":
                return "countOrAmount";
            case "percentage-or-ratio":
                return "percentageOrRatio";
            case "unique-identifier":
                return "uniqueIdentifier";
            case "name-or-title":
                return "nameOrTitle";
            case "type-or-category":
                return "typeOrCategory";
            case "location-or-place-name":
                return "locationOrPlaceName";
            case "ordered-or-ranked":
                return "orderedOrRanked";
            case "date-and-time":
                return "dateAndTime";
            default:
                return field.layerField.valueType;
        }
    }
    _getDisplayString(value) {
        const { props } = this;
        const { fieldInfo } = props;
        switch (fieldInfo.simpleFieldType) {
            case simpleFieldTypes.DATE:
                return this._getDateString(value);
            case simpleFieldTypes.TIMESTAMP_OFFSET:
                return this._getTimestampOffsetString(value);
            case simpleFieldTypes.DATE_ONLY:
                return this._getDateOnlyString(value);
            case simpleFieldTypes.TIME_ONLY:
                return this._getTimeOnlyString(value);
            case simpleFieldTypes.NUMBER:
                return this._getNumberString(value);
            case simpleFieldTypes.GUID:
                return this._getGuidString(value);
            default:
                // string, oid, global-id
                return `${value}`;
        }
    }
    _getDateString(value) {
        const { modules, view } = this.props;
        if (view && view.timeZone === "unknown") {
            return modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions("short-date-short-time")), { timeZone: "utc", timeZoneName: "shortOffset" }));
        }
        else {
            // known issues with formatting it-CH
            return modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions("short-date-short-time")), { timeZone: (view === null || view === void 0 ? void 0 : view.timeZone) || "system" }));
        }
    }
    _getTimestampOffsetString(value) {
        /*
        const timestamp = "2023-03-19T16:00:00.123-01:00";
        console.log("timestamp", timestamp);
        console.log(
          "local Time",
          intl.formatTimestamp(timestamp, intl.convertDateFormatToIntlOptions("short-date-short-time"))
        );
        console.log(
          "mapView Time (except unknown)",
          intl.formatTimestamp(timestamp, {
            ...intl.convertDateFormatToIntlOptions("short-date-short-time"),
            timeZone: view.timeZone,
          })
        );
        console.log(
          "UTC Time (mapView time unknown)",
          intl.formatTimestamp(timestamp, {
            ...intl.convertDateFormatToIntlOptions("short-date-short-time"),
            timeZone: "utc",
            timeZoneName: "shortOffset"
          })
        );
        console.log(
          "Raw",
          intl.formatTimestamp(timestamp, {
            ...intl.convertDateFormatToIntlOptions("short-date-short-time"),
            timeZoneName: "shortOffset"
          })
        );
        */
        const { modules, view } = this.props;
        if (typeof value === "string") {
            // raw value from layer
            if (view && view.timeZone === "unknown") {
                return modules.intl.formatTimestamp(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions("short-date-short-time")), { timeZone: "utc", timeZoneName: "shortOffset" }));
            }
            else {
                return modules.intl.formatTimestamp(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions("short-date-short-time")), { timeZone: (view === null || view === void 0 ? void 0 : view.timeZone) || "system" }));
            }
        }
        else {
            // e.g. UNIX timestamp from statistics call
            return this._getDateString(value);
        }
    }
    _getDateOnlyString(value) {
        const { props } = this;
        const { modules } = props;
        return modules.intl.formatDateOnly(value, modules.intl.convertDateFormatToIntlOptions("short-date"));
    }
    _getTimeOnlyString(value) {
        const { props } = this;
        const { modules } = props;
        if (typeof value === "string") {
            return modules.intl.formatTimeOnly(value, modules.intl.convertDateFormatToIntlOptions("short-date-long-time"));
        }
        else {
            // UNIX timestamp
            return modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions("long-time")), { timeZone: "utc" }));
        }
    }
    _getGuidString(value) {
        return value.startsWith("{") ? value : `{${value}}`;
    }
    _getNumberString(value) {
        return this.props.modules.intl.formatNumber(value);
    }
    _printNumValue(value) {
        return isDefined(value) ? this._getNumberString(Math.round(value * 100) / 100) : `--`;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFieldInfo.style = arcgisFieldInfoCss;



//# sourceMappingURL=arcgis-field-info.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTUyZTU4MC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ1Q7QUFDVTtBQUM1QztBQUNTO0FBQ0Q7O0FBRW5DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0JBQXdCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDRDQUE0QztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1CQUFtQjtBQUMvQjtBQUNBLFlBQVksZ0JBQWdCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLCtEQUFpQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0NBQW9DO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxp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Q3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxlQUFlLEdBQUcsa0JBQWtCO0FBQzFFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RTs7QUFFNUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtZmllbGQtaW5mby5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMDUwYjZkYjkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEZlYXR1cmVDb3VudCQxIH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5cbmNvbnN0IENTUyA9IHtcbiAgICBjb250YWluZXI6IFwiY29udGFpbmVyXCIsXG4gICAgc2VjdGlvbjogXCJzZWN0aW9uXCIsXG4gICAgdGl0bGU6IFwidGl0bGVcIixcbiAgICBtaXNzaW5nOiBcIm1pc3NpbmdcIixcbiAgICBkYXRhOiBcImRhdGFcIixcbiAgICBjb3VudDogXCJjb3VudFwiLFxuICAgIHN0YXRpc3RpY3NSb3c6IFwic3RhdGlzdGljcy1yb3dcIixcbiAgICBzdGF0aXN0aWNzUm93VG9wVmFsdWVzOiBcInN0YXRpc3RpY3Mtcm93LXRvcC12YWx1ZXNcIlxufTtcblxudmFyIHN0YXR1cztcbihmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgc3RhdHVzW1wiTUlTU0lOR1wiXSA9IFwibWlzc2luZ1wiO1xuICAgIHN0YXR1c1tcIklOX1BST0dSRVNTXCJdID0gXCJpblByb2dyZXNzXCI7XG4gICAgc3RhdHVzW1wiU1VDQ0VTU1wiXSA9IFwic3VjY2Vzc1wiO1xuICAgIHN0YXR1c1tcIkZBSUxFRFwiXSA9IFwiZmFpbGVkXCI7XG59KShzdGF0dXMgfHwgKHN0YXR1cyA9IHt9KSk7XG52YXIgc2ltcGxlRmllbGRUeXBlcztcbihmdW5jdGlvbiAoc2ltcGxlRmllbGRUeXBlcykge1xuICAgIHNpbXBsZUZpZWxkVHlwZXNbXCJOVU1CRVJcIl0gPSBcIm51bWJlclwiO1xuICAgIHNpbXBsZUZpZWxkVHlwZXNbXCJTVFJJTkdcIl0gPSBcInN0cmluZ1wiO1xuICAgIHNpbXBsZUZpZWxkVHlwZXNbXCJEQVRFXCJdID0gXCJkYXRlXCI7XG4gICAgc2ltcGxlRmllbGRUeXBlc1tcIkRBVEVfT05MWVwiXSA9IFwiZGF0ZS1vbmx5XCI7XG4gICAgc2ltcGxlRmllbGRUeXBlc1tcIlRJTUVfT05MWVwiXSA9IFwidGltZS1vbmx5XCI7XG4gICAgc2ltcGxlRmllbGRUeXBlc1tcIlRJTUVTVEFNUF9PRkZTRVRcIl0gPSBcInRpbWVzdGFtcC1vZmZzZXRcIjtcbiAgICBzaW1wbGVGaWVsZFR5cGVzW1wiT0lEXCJdID0gXCJvaWRcIjtcbiAgICBzaW1wbGVGaWVsZFR5cGVzW1wiR1VJRFwiXSA9IFwiZ3VpZFwiO1xuICAgIHNpbXBsZUZpZWxkVHlwZXNbXCJVTktOT1dOXCJdID0gXCJ1bmtub3duXCI7XG59KShzaW1wbGVGaWVsZFR5cGVzIHx8IChzaW1wbGVGaWVsZFR5cGVzID0ge30pKTtcbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSB2YWx1ZSBpcyBkZWZpbmVkXG4gKiBAcGFyYW0gdmFsdWUgLSB2YWx1ZSB0byBjaGVja1xuICovXG5mdW5jdGlvbiBpc0RlZmluZWQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgVVJMIHVzZWQgZm9yIHF1ZXJpZXMuXG4gKiBFLmcuIFNjZW5lTGF5ZXJzIG5lZWQgdG8gdXNlIHRoZSBGZWF0dXJlTGF5ZXIgVVJMIGZvciBxdWVyaWVzLlxuICogQHBhcmFtIHZhbHVlIC0gdmFsdWUgdG8gY2hlY2tcbiAqL1xuZnVuY3Rpb24gZ2V0UXVlcnlVUkwobGF5ZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGxheWVyLnR5cGUgPT09IFwic2NlbmVcIikge1xuICAgICAgICByZXR1cm4gKF9hID0gbGF5ZXIuYXNzb2NpYXRlZExheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXJsO1xuICAgIH1cbiAgICByZXR1cm4gbGF5ZXIudXJsO1xufVxuXG4vKipcbiAqIFJldHVybnMgYWRkaXRpb25hbCBmaWVsZCBpbmZvcm1hdGlvbiBmcm9tIGxheWVyXG4gKiBAcGFyYW0gcHJvcHMgLSBwcm9wZXJ0aWVzIGNvbnRhaW5pbmcgbGF5ZXIgYW5kIGZpZWxkTmFtZVxuICovXG5mdW5jdGlvbiBnZXRGaWVsZEluZm8ocHJvcHMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYXllciwgZmllbGROYW1lIH0gPSBwcm9wcztcbiAgICBsZXQgZmllbGRJbmZvO1xuICAgIGNvbnN0IHsgcG9wdXBUZW1wbGF0ZSB9ID0gbGF5ZXI7XG4gICAgY29uc3QgcG9wdXBGaWVsZEluZm9zID0gcG9wdXBUZW1wbGF0ZSA/IHBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcyA6IFtdO1xuICAgIChsYXllci50eXBlID09PSBcImltYWdlcnktdGlsZVwiXG4gICAgICAgID8gbGF5ZXIucmFzdGVyRmllbGRzXG4gICAgICAgIDogbGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5XCIgJiYgKChfYSA9IGxheWVyLnJhc3RlckZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aClcbiAgICAgICAgICAgID8gbGF5ZXIucmFzdGVyRmllbGRzXG4gICAgICAgICAgICA6IGxheWVyLmZpZWxkcylcbiAgICAgICAgLmZpbHRlcigobGF5ZXJGaWVsZCkgPT4gbGF5ZXJGaWVsZC5uYW1lID09PSBmaWVsZE5hbWUpXG4gICAgICAgIC5mb3JFYWNoKChsYXllckZpZWxkKSA9PiB7XG4gICAgICAgIGNvbnN0IGxpc3QgPSBwb3B1cEZpZWxkSW5mb3NcbiAgICAgICAgICAgID8gcG9wdXBGaWVsZEluZm9zLmZpbHRlcigoZkluZm8pID0+IGZJbmZvLmZpZWxkTmFtZSA9PT0gbGF5ZXJGaWVsZC5uYW1lKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBjb25zdCBsYWJlbCA9IChsaXN0ID09PSBudWxsIHx8IGxpc3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpc3QubGVuZ3RoKSA/IGxpc3RbMF0ubGFiZWwgOiBudWxsO1xuICAgICAgICBpZiAoL15yYXN0ZXIuKGl0ZW18c2VydmljZSlwaXhlbHZhbHVlL2kudGVzdChmaWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAvLyBlLmcuIFwiUmFzdGVyLlNlcnZpY2VQaXhlbFZhbHVlXCIgfCBcIlJhc3Rlci5JdGVtUGl4ZWxWYWx1ZVwiIHwgXCJSYXN0ZXIuU2VydmljZVBpeGVsVmFsdWUuUmF3XCJcbiAgICAgICAgICAgIC8vIGxheWVyLnJhc3RlckZpZWxkcyByZXBvcnRzIHRoZW0gYXMgdHlwZSBcInN0cmluZ1wiXG4gICAgICAgICAgICBsYXllckZpZWxkLnR5cGUgPSBcImRvdWJsZVwiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZlYXR1cmVGaWx0ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIGxheWVyRmllbGQ6IGxheWVyRmllbGQsXG4gICAgICAgICAgICBsYWJlbDogbGFiZWwgfHwgbGF5ZXJGaWVsZC5hbGlhcyB8fCBsYXllckZpZWxkLm5hbWVcbiAgICAgICAgfTtcbiAgICAgICAgZmVhdHVyZUZpbHRlckZpZWxkLmNvZGVkVmFsdWVzID0gZ2V0Q29kZWRWYWx1ZXMoZmllbGROYW1lLCBwcm9wcyk7XG4gICAgICAgIF9nZXRTaW1wbGVGaWVsZFR5cGUoZmVhdHVyZUZpbHRlckZpZWxkKTtcbiAgICAgICAgaWYgKGZlYXR1cmVGaWx0ZXJGaWVsZC5zaW1wbGVGaWVsZFR5cGUpIHtcbiAgICAgICAgICAgIGZpZWxkSW5mbyA9IGZlYXR1cmVGaWx0ZXJGaWVsZDtcbiAgICAgICAgfSAvLyBlbHNlIGNhbid0IHVzZSBmaWVsZFxuICAgIH0pO1xuICAgIHJldHVybiBmaWVsZEluZm87XG59XG4vKipcbiAqIFJldHVybnMgZmVhdHVyZSBjb3VudCBpbiBsYXllclxuICogQHBhcmFtIHByb3BzIC0gcHJvcGVydGllcyBjb250YWluaW5nIGxheWVyIGFuZCBmaWVsZE5hbWVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RmVhdHVyZUNvdW50KHByb3BzKSB7XG4gICAgcHJvcHMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICBjb25zdCB7IGxheWVyLCB2aWV3IH0gPSBwcm9wcztcbiAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5XCIgfHwgbGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5LXRpbGVcIiB8fCBsYXllci50eXBlID09PSBcInN0cmVhbVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgZmVhdHVyZSBjb3VudFwiKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldEZlYXR1cmVDb3VudCQxKGxheWVyLCB2aWV3KTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgc3VtbWFyeSBzdGF0aXN0aWNzXG4gKiBAcGFyYW0gcHJvcHMgLSBwcm9wZXJ0aWVzIGNvbnRhaW5pbmcgbGF5ZXIgYW5kIGZpZWxkTmFtZVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTdGF0aXN0aWNzKHByb3BzKSB7XG4gICAgY29uc3QgeyBsYXllciwgdmlldywgZmllbGROYW1lLCBmaWVsZEluZm8gfSA9IHByb3BzO1xuICAgIGlmIChsYXllci50eXBlID09PSBcImltYWdlcnlcIiB8fCBsYXllci50eXBlID09PSBcImltYWdlcnktdGlsZVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgc3RhdGlzdGljcyBmb3IgSW1hZ2VyeUxheWVyL0ltYWdlcnlUaWxlTGF5ZXJcIik7XG4gICAgfVxuICAgIGlmICghZmllbGRJbmZvIHx8XG4gICAgICAgIGZpZWxkSW5mby5sYXllckZpZWxkLnR5cGUgPT09IFwib2lkXCIgfHxcbiAgICAgICAgZmllbGRJbmZvLmxheWVyRmllbGQudHlwZSA9PT0gXCJndWlkXCIgfHxcbiAgICAgICAgZmllbGRJbmZvLmxheWVyRmllbGQudHlwZSA9PT0gXCJnbG9iYWwtaWRcIikge1xuICAgICAgICBjb25zdCBjb3VudCA9IGF3YWl0IGdldEZlYXR1cmVDb3VudChwcm9wcyk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyB0b3RhbENvdW50OiBjb3VudCwgbnVsbGNvdW50OiAwIH0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBbc3VtbWFyeVN0YXRpc3RpY3NdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9zbWFydE1hcHBpbmcvc3RhdGlzdGljcy9zdW1tYXJ5U3RhdGlzdGljc1wiXSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN1bW1hcnlTdGF0aXN0aWNzKHtcbiAgICAgICAgICAgIGxheWVyLFxuICAgICAgICAgICAgdmlldyxcbiAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWVcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghaXNEZWZpbmVkKHJlc3VsdC5jb3VudCkpIHtcbiAgICAgICAgICAgIC8vIHN0YXRpc3RpY3MgaXMgdW51c2FibGVcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgc3RhdGlzdGljc1wiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB3ZSBoaXQgbWF4UmVjb3JkQ291bnQgb3RoZXIgc3RhdHMgdmFsdWVzIGFyZSBwcm9iYWJseSBub3QgY29ycmVjdCBlaXRoZXJcbiAgICAgICAgY29uc3QgaGl0TWF4UmVjb3JkQ291bnQgPSBcInNvdXJjZUpTT05cIiBpbiBsYXllciAmJiBsYXllci5zb3VyY2VKU09OLm1heFJlY29yZENvdW50ID09PSByZXN1bHQuY291bnQ7XG4gICAgICAgIC8vIGNvdW50IG9ubHkgY29udGFpbnMgZmVhdHVyZXMgd2l0aCBhIHZhbHVlICghPSBudWxsKVxuICAgICAgICBpZiAoaXNEZWZpbmVkKHJlc3VsdC5udWxsY291bnQpICYmICFoaXRNYXhSZWNvcmRDb3VudCkge1xuICAgICAgICAgICAgLy8gd2UgY2FuIGFkZCB0aGUgZmVhdHVyZSBjb3VudCB3aXRob3V0IG51bGwgYW5kIHRoZSBjb3VudCBvZiBudWxsc1xuICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlc3VsdCksIHsgdG90YWxDb3VudDogcmVzdWx0LmNvdW50ICsgcmVzdWx0Lm51bGxjb3VudCB9KTtcbiAgICAgICAgICAgIHJldHVybiBzdGF0cztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHdlIHdhbnQgdGhlIHRvdGFsIGZlYXR1cmUgY291bnRcbiAgICAgICAgICAgIC8vIGhhcHBlbnMgZS5nLiBmb3IgU2NlbmVMYXllcnMgd2l0aCBvbGRlciBzdGF0cyBjYWNoZVxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBnZXRGZWF0dXJlQ291bnQocHJvcHMpO1xuICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlc3VsdCksIHsgdG90YWxDb3VudDogY291bnQgfSk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdHM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgc3RhdGlzdGljc1wiKTtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgdW5pcXVlIHZhbHVlc1xuICogQHBhcmFtIHByb3BzIC0gcHJvcGVydGllcyBjb250YWluaW5nIGxheWVyIGFuZCBmaWVsZE5hbWVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0VW5pcXVlVmFsdWVzKHByb3BzKSB7XG4gICAgY29uc3QgeyBsYXllciwgdmlldywgZmllbGROYW1lIH0gPSBwcm9wcztcbiAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5XCIgfHwgbGF5ZXIudHlwZSA9PT0gXCJpbWFnZXJ5LXRpbGVcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb3VsZCBub3QgZ2V0IHVuaXF1ZSB2YWx1ZXMgZm9yIEltYWdlcnlMYXllci9JbWFnZXJ5VGlsZUxheWVyXCIpO1xuICAgIH1cbiAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJmZWF0dXJlXCIgJiYgIWxheWVyLnVybCkge1xuICAgICAgICBsYXllci5vdXRGaWVsZHMgPSBbXCIqXCJdO1xuICAgIH1cbiAgICBjb25zdCBbdW5pcXVlVmFsdWVzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvc21hcnRNYXBwaW5nL3N0YXRpc3RpY3MvdW5pcXVlVmFsdWVzXCJdKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1bmlxdWVWYWx1ZXMoe1xuICAgICAgICAgICAgbGF5ZXIsXG4gICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgdW5pcXVlIHZhbHVlc1wiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBfZ2V0U2ltcGxlRmllbGRUeXBlKGZlYXR1cmVGaWx0ZXJGaWVsZCkge1xuICAgIHN3aXRjaCAoZmVhdHVyZUZpbHRlckZpZWxkLmxheWVyRmllbGQudHlwZSkge1xuICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICBmZWF0dXJlRmlsdGVyRmllbGQuc2ltcGxlRmllbGRUeXBlID0gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRhdGVcIjpcbiAgICAgICAgICAgIGZlYXR1cmVGaWx0ZXJGaWVsZC5zaW1wbGVGaWVsZFR5cGUgPSBzaW1wbGVGaWVsZFR5cGVzLkRBVEU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInRpbWVzdGFtcC1vZmZzZXRcIjpcbiAgICAgICAgICAgIGZlYXR1cmVGaWx0ZXJGaWVsZC5zaW1wbGVGaWVsZFR5cGUgPSBzaW1wbGVGaWVsZFR5cGVzLlRJTUVTVEFNUF9PRkZTRVQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRhdGUtb25seVwiOlxuICAgICAgICAgICAgZmVhdHVyZUZpbHRlckZpZWxkLnNpbXBsZUZpZWxkVHlwZSA9IHNpbXBsZUZpZWxkVHlwZXMuREFURV9PTkxZO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0aW1lLW9ubHlcIjpcbiAgICAgICAgICAgIGZlYXR1cmVGaWx0ZXJGaWVsZC5zaW1wbGVGaWVsZFR5cGUgPSBzaW1wbGVGaWVsZFR5cGVzLlRJTUVfT05MWTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwib2lkXCI6XG4gICAgICAgICAgICBmZWF0dXJlRmlsdGVyRmllbGQuc2ltcGxlRmllbGRUeXBlID0gc2ltcGxlRmllbGRUeXBlcy5PSUQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImd1aWRcIjpcbiAgICAgICAgY2FzZSBcImdsb2JhbC1pZFwiOlxuICAgICAgICAgICAgZmVhdHVyZUZpbHRlckZpZWxkLnNpbXBsZUZpZWxkVHlwZSA9IHNpbXBsZUZpZWxkVHlwZXMuR1VJRDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic21hbGwtaW50ZWdlclwiOlxuICAgICAgICBjYXNlIFwiYmlnLWludGVnZXJcIjpcbiAgICAgICAgY2FzZSBcImludGVnZXJcIjpcbiAgICAgICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgICBjYXNlIFwiZG91YmxlXCI6XG4gICAgICAgIGNhc2UgXCJsb25nXCI6XG4gICAgICAgICAgICBmZWF0dXJlRmlsdGVyRmllbGQuc2ltcGxlRmllbGRUeXBlID0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVI7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRDb2RlZFZhbHVlcyhmaWVsZE5hbWUsIHByb3BzKSB7XG4gICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gcHJvcHM7XG4gICAgaWYgKGxheWVyLnR5cGUgIT09IFwiZmVhdHVyZVwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdHlwZUlkRmllbGQgPSBsYXllci50eXBlSWRGaWVsZDtcbiAgICBjb25zdCB0eXBlcyA9IGxheWVyLnR5cGVzO1xuICAgIGxldCBmaWVsZERvbWFpbnM7XG4gICAgY29uc3QgZmllbGQgPSBsYXllci5maWVsZHMuZmluZCgoZmllbGQpID0+IGZpZWxkLm5hbWUgPT09IGZpZWxkTmFtZSk7XG4gICAgY29uc3QgZmllbGREb21haW4gPSBmaWVsZC5kb21haW47XG4gICAgaWYgKHR5cGVJZEZpZWxkICYmIHR5cGVzKSB7XG4gICAgICAgIC8vIGxheWVyIGhhcyB0eXBlc1xuICAgICAgICBpZiAodHlwZUlkRmllbGQgPT09IGZpZWxkTmFtZSkge1xuICAgICAgICAgICAgLy8gdGhpcyBpcyB0aGUgZmllbGQgd2l0aCB0aGUgdHlwZXNcbiAgICAgICAgICAgIGZpZWxkRG9tYWlucyA9IHR5cGVzLm1hcCgodHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGZha2UgY29kZWQgVmFsdWVzXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogdHlwZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdHlwZS5uYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZmllbGQgZG9lcyBub3QgaGF2ZSB0eXBlczsgbG9vayBmYXJ0aGVyIGluc2lkZSB0aGUgdHlwZXNcbiAgICAgICAgICAgIGZpZWxkRG9tYWlucyA9IFtdO1xuICAgICAgICAgICAgdHlwZXMuZm9yRWFjaCgodHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgaWYgKCF0eXBlLmRvbWFpbnMgfHwgIXR5cGUuZG9tYWluc1tmaWVsZE5hbWVdIHx8IHR5cGUuZG9tYWluc1tmaWVsZE5hbWVdLnR5cGUgPT09IFwiaW5oZXJpdGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9tYWluID0gZmllbGREb21haW47XG4gICAgICAgICAgICAgICAgICAgIGlmIChkb21haW4gPT09IG51bGwgfHwgZG9tYWluID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkb21haW4uY29kZWRWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbi5jb2RlZFZhbHVlcy5mb3JFYWNoKGFzeW5jIChjb2RlZFZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGREb21haW5zLmZvckVhY2goKGNvZGVkVmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2RlZFZhbC5jb2RlID09PSBjb2RlZFZhbHVlLmNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChgLCAke2NvZGVkVmFsLm5hbWV9LGAuaW5kZXhPZihgLCAke2NvZGVkVmFsdWUubmFtZX0sYCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZWRWYWwubmFtZSArPSBgLCAke2NvZGVkVmFsdWUubmFtZX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZERvbWFpbnMucHVzaChtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGNvZGVkVmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoX2IgPSAoX2EgPSB0eXBlLmRvbWFpbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtmaWVsZE5hbWVdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY29kZWRWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZS5kb21haW5zW2ZpZWxkTmFtZV0uY29kZWRWYWx1ZXMuZm9yRWFjaChhc3luYyAoY29kZWRWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZERvbWFpbnMuZm9yRWFjaCgoY29kZWRWYWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29kZWRWYWwuY29kZSA9PT0gY29kZWRWYWx1ZS5jb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGAsICR7Y29kZWRWYWwubmFtZX0sYC5pbmRleE9mKGAsICR7Y29kZWRWYWx1ZS5uYW1lfSxgKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVkVmFsLm5hbWUgKz0gYCwgJHtjb2RlZFZhbHVlLm5hbWV9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkRG9tYWlucy5wdXNoKG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUoY29kZWRWYWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIShmaWVsZERvbWFpbnMgPT09IG51bGwgfHwgZmllbGREb21haW5zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZERvbWFpbnMubGVuZ3RoKSAmJiAoZmllbGREb21haW4gPT09IG51bGwgfHwgZmllbGREb21haW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkRG9tYWluLmNvZGVkVmFsdWVzKSkge1xuICAgICAgICAgICAgZmllbGREb21haW5zID0gbW9kdWxlcy5lc3JpTGFuZy5jbG9uZShmaWVsZERvbWFpbi5jb2RlZFZhbHVlcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoZmllbGREb21haW4gPT09IG51bGwgfHwgZmllbGREb21haW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkRG9tYWluLmNvZGVkVmFsdWVzKSB7XG4gICAgICAgIC8vIGRvbWFpbnMgZGlyZWN0bHkgb24gdGhlIGxheWVyIGZpZWxkXG4gICAgICAgIGZpZWxkRG9tYWlucyA9IGZpZWxkLmRvbWFpbi5jb2RlZFZhbHVlcztcbiAgICB9XG4gICAgcmV0dXJuIChmaWVsZERvbWFpbnMgPT09IG51bGwgfHwgZmllbGREb21haW5zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZERvbWFpbnMubGVuZ3RoKSA/IGZpZWxkRG9tYWlucyA6IG51bGw7XG59XG5cbi8qKlxuICogUmV0dXJucyB1cCB0byA1IGZlYXR1cmVzIGZyb20gdGhlIGxheWVyIHRvIGdldCBzYW1wbGUgZGF0YVxuICogQHBhcmFtIHByb3BzIC0gcHJvcGVydGllcyBjb250YWluaW5nIGxheWVyIGFuZCB2aWV3XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldE9uZUZlYXR1cmUocHJvcHMpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgdmlldywgbGF5ZXIgfSA9IHByb3BzO1xuICAgIGlmIChsYXllci50eXBlID09PSBcImltYWdlcnlcIiB8fCBsYXllci50eXBlID09PSBcImltYWdlcnktdGlsZVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvdWxkIG5vdCBnZXQgZmVhdHVyZVwiKTtcbiAgICB9XG4gICAgaWYgKChsYXllci50eXBlID09PSBcImZlYXR1cmVcIiAmJiAhbGF5ZXIudXJsKSB8fCBsYXllci50eXBlID09PSBcIndmc1wiKSB7XG4gICAgICAgIC8vIGZlYXR1cmUgY29sbGVjdGlvbiBvciB3ZnNcbiAgICAgICAgY29uc3QgcXVlcnkgPSBsYXllci5jcmVhdGVRdWVyeSgpO1xuICAgICAgICBxdWVyeS5zdGFydCA9IDA7XG4gICAgICAgIHF1ZXJ5Lm51bSA9IDU7XG4gICAgICAgIHF1ZXJ5Lm91dEZpZWxkcyA9IFtcIipcIl07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxheWVyLnF1ZXJ5RmVhdHVyZXMocXVlcnkpO1xuICAgICAgICBpZiAoKF9hID0gcmVzdWx0LmZlYXR1cmVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY291bGQgbm90IGdldCBmZWF0dXJlXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBzZXJ2aWNlXG4gICAgICAgIGlmICghdmlldykge1xuICAgICAgICAgICAgLy8gZ2V0IGZlYXR1cmUgZnJvbSBzZXJ2aWNlIGRpcmVjdGx5XG4gICAgICAgICAgICByZXR1cm4gX3F1ZXJ5T25lRmVhdHVyZShwcm9wcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGF5ZXJWaWV3ID0gKGF3YWl0IHZpZXcud2hlbkxheWVyVmlldyhsYXllcikpO1xuICAgICAgICBjb25zdCBoYXNBbGxGaWVsZHMgPSBsYXllclZpZXcuYXZhaWxhYmxlRmllbGRzLmxlbmd0aCA9PT0gbGF5ZXIuZmllbGRzLmxlbmd0aDtcbiAgICAgICAgaWYgKGhhc0FsbEZpZWxkcyB8fCAoW1wic3RyZWFtXCIsIFwib2djLWZlYXR1cmVcIl0uaW5kZXhPZihsYXllci50eXBlKSA+IC0xICYmIGxheWVyVmlldy5hdmFpbGFibGVGaWVsZHMubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgIC8vIGZlYXR1cmVzIG9uIGNsaWVudCBoYXZlIGFsbCBmaWVsZHNcbiAgICAgICAgICAgIC8vIG9yIHdlIGNhbid0IG1ha2UgYSBzZXJ2ZXIgcXVlcnksIHNvIHdlIHRha2Ugd2hhdCB3ZSBjYW4gZ2V0XG4gICAgICAgICAgICBjb25zdCBxdWVyeSA9IGxheWVyLmNyZWF0ZVF1ZXJ5KCk7XG4gICAgICAgICAgICBxdWVyeS5zdGFydCA9IDA7XG4gICAgICAgICAgICBxdWVyeS5udW0gPSA1O1xuICAgICAgICAgICAgcXVlcnkub3V0RmllbGRzID0gW1wiKlwiXTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxheWVyVmlldy5xdWVyeUZlYXR1cmVzKHF1ZXJ5KTtcbiAgICAgICAgICAgIGlmICgoX2IgPSByZXN1bHQuZmVhdHVyZXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBjbGllbnQgc2lkZSBmZWF0dXJlc1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgZmVhdHVyZSBmcm9tIHNlcnZpY2VcbiAgICAgICAgICAgICAgICByZXR1cm4gX3F1ZXJ5T25lRmVhdHVyZShwcm9wcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBnZXQgZmVhdHVyZSBmcm9tIHNlcnZpY2VcbiAgICAgICAgICAgIHJldHVybiBfcXVlcnlPbmVGZWF0dXJlKHByb3BzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIF9xdWVyeU9uZUZlYXR1cmUocHJvcHMpIHtcbiAgICBjb25zdCB7IGxheWVyIH0gPSBwcm9wcztcbiAgICBpZiAoW1wiaW1hZ2VyeVwiLCBcImltYWdlcnktdGlsZVwiLCBcInN0cmVhbVwiLCBcIm9nYy1mZWF0dXJlXCJdLmluZGV4T2YobGF5ZXIudHlwZSkgPiAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgZ2V0IGZlYXR1cmUgZnJvbSBzZXJ2aWNlXCIpO1xuICAgIH1cbiAgICBjb25zdCBbUXVlcnldID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9yZXN0L3N1cHBvcnQvUXVlcnlcIl0pO1xuICAgIGNvbnN0IHF1ZXJ5ID0gbmV3IFF1ZXJ5KHtcbiAgICAgICAgd2hlcmU6IFwiMT0xXCIsXG4gICAgICAgIG91dEZpZWxkczogW1wiKlwiXSxcbiAgICAgICAgcmV0dXJuR2VvbWV0cnk6IGZhbHNlXG4gICAgfSk7XG4gICAgcmV0dXJuIGxheWVyLnF1ZXJ5RmVhdHVyZXMocXVlcnkpO1xufVxuXG5jb25zdCBhcmNnaXNGaWVsZEluZm9Dc3MgPSBcIjpob3N0e2hlaWdodDoxMDAlfS5jb250YWluZXJ7cGFkZGluZzo2cHg7YmFja2dyb3VuZC1jb2xvcjp3aGl0ZX0udGl0bGV7Zm9udC13ZWlnaHQ6Ym9sZDtwYWRkaW5nOjVweCAwfS5taXNzaW5ne2NvbG9yOiNhOWE5YTl9LmRhdGF7Y29sb3I6I2E5YTlhOX0uY291bnR7d2hpdGUtc3BhY2U6bm93cmFwfS5zZWN0aW9ue3BhZGRpbmc6NnB4IDB9LnN0YXRpc3RpY3Mtcm93e2JvcmRlci10b3A6MXB4IHNvbGlkICNlMGUwZTA7cGFkZGluZzo2cHggMDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LnN0YXRpc3RpY3Mtcm93LXRvcC12YWx1ZXN7Ym9yZGVyLXRvcDoxcHggc29saWQgI2UwZTBlMDtwYWRkaW5nOjIwcHggMCA2cHggMDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59XCI7XG5cbmNvbnN0IEFyY2dpc0ZpZWxkSW5mbyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzRmllbGRJbmZvQ29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ZpZWxkSW5mb0NvbXBsZXRlXCIsIDcpO1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmllbGROYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhpZGVTdGF0aXN0aWNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25lRmVhdHVyZVJlc3BvbnNlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9uZUZlYXR1cmVSZXNwb25zZVN0YXR1cyA9IHN0YXR1cy5NSVNTSU5HO1xuICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5NSVNTSU5HO1xuICAgICAgICB0aGlzLnVuaXF1ZVZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51bmlxdWVWYWx1ZXNTdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBbc3RyaW5ncywgY3VycmVudExhbmd1YWdlLCBjdXJyZW50TGFuZ3VhZ2VJbnRsXSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgICAgIHRoaXMubG9jYWxlID0gY3VycmVudExhbmd1YWdlO1xuICAgICAgICB0aGlzLmxvY2FsSW50bCA9IGN1cnJlbnRMYW5ndWFnZUludGw7XG4gICAgICAgIGNvbnN0IFtlc3JpTGFuZywgaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXG4gICAgICAgICAgICBcImVzcmkvY29yZS9sYW5nXCIsXG4gICAgICAgICAgICBcImVzcmkvaW50bFwiXG4gICAgICAgIF0pO1xuICAgICAgICBjb25zdCB7IHZpZXcsIGxheWVyLCBmaWVsZE5hbWUsIGhpZGVTdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICBsZXQgc3VibGF5ZXJGTDtcbiAgICAgICAgaWYgKGxheWVyLmRlY2xhcmVkQ2xhc3MgPT09IFwiZXNyaS5sYXllcnMuc3VwcG9ydC5TdWJsYXllclwiKSB7XG4gICAgICAgICAgICAvLyBuZWVkIHRvIGNyZWF0ZSBhIEZlYXR1cmVMYXllclxuICAgICAgICAgICAgY29uc3Qgc3VibGF5ZXIgPSBsYXllcjtcbiAgICAgICAgICAgIGNvbnN0IFtyZWFjdGl2ZVV0aWxzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvY29yZS9yZWFjdGl2ZVV0aWxzXCJdKTtcbiAgICAgICAgICAgIHZpZXcgJiYgKGF3YWl0IHJlYWN0aXZlVXRpbHMud2hlbk9uY2UoKCkgPT4gIXZpZXcudXBkYXRpbmcpKTtcbiAgICAgICAgICAgIHN1YmxheWVyRkwgPSBhd2FpdCBzdWJsYXllci5jcmVhdGVGZWF0dXJlTGF5ZXIoKTtcbiAgICAgICAgICAgIGF3YWl0IHN1YmxheWVyRkwubG9hZCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgbGF5ZXI6IHN1YmxheWVyRkwgfHwgbGF5ZXIsXG4gICAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgICBoaWRlU3RhdGlzdGljcyxcbiAgICAgICAgICAgIG1vZHVsZXM6IHsgZXNyaUxhbmcsIGludGwgfVxuICAgICAgICB9O1xuICAgICAgICAvLyByZXF1aXJlZCBmb3IgaW5pdGlhbCBsb2FkXG4gICAgICAgIHRoaXMucHJvcHMuZmllbGRJbmZvID0gZ2V0RmllbGRJbmZvKHRoaXMucHJvcHMpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIG9uY2UgY29tcG9uZW50IGlzIHZpc2libGUgbWFrZSBvdGhlciBjYWxsc1xuICAgICAgICBjb25zdCB7IHByb3BzLCBoaWRlU3RhdGlzdGljcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gcHJvcHM7XG4gICAgICAgIG1vZHVsZXMuaW50bC5zZXRMb2NhbGUodGhpcy5sb2NhbEludGwpO1xuICAgICAgICAvLyBtb2R1bGVzLmludGwuc2V0TG9jYWxlKHRoaXMubG9jYWxlKSBub3QgcmV0dXJuaW5nIHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcgZm9yIGUuZy4gaXQtY2hcbiAgICAgICAgLy8gd2UgZG9uJ3Qga25vdyBpZiB0aGUgU2NlbmVMYXllciBoYXMgYW4gYXNzb2NpYXRlZCBGTFxuICAgICAgICAvLyBkb24ndCBwcm9tcHQgZm9yIGEgbG9naW4gaWYgaXQncyBub3QgYWNjZXNzaWJsZVxuICAgICAgICBpZiAobGF5ZXIudHlwZSA9PT0gXCJzY2VuZVwiKSB7XG4gICAgICAgICAgICBjb25zdCBbZXNyaUNvbmZpZ10gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2NvbmZpZ1wiXSk7XG4gICAgICAgICAgICBlc3JpQ29uZmlnLnJlcXVlc3QuaW50ZXJjZXB0b3JzLnB1c2goe1xuICAgICAgICAgICAgICAgIHVybHM6IGdldFF1ZXJ5VVJMKGxheWVyKSArIFwiL1wiICsgbGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICAgICAgICBiZWZvcmU6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnJlcXVlc3RPcHRpb25zLmF1dGhNb2RlID0gXCJuby1wcm9tcHRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9uZUZlYXR1cmVSZXNwb25zZVN0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldE9uZUZlYXR1cmUodGhpcy5wcm9wcyk7XG4gICAgICAgICAgICB0aGlzLm9uZUZlYXR1cmVSZXNwb25zZSA9IHJlc3VsdDtcbiAgICAgICAgICAgIHRoaXMub25lRmVhdHVyZVJlc3BvbnNlU3RhdHVzID0gc3RhdHVzLlNVQ0NFU1M7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLm9uZUZlYXR1cmVSZXNwb25zZVN0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxheWVyLnR5cGUgPT09IFwic3RyZWFtXCIpIHtcbiAgICAgICAgICAgIHRoaXMudW5pcXVlVmFsdWVzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhpZGVTdGF0aXN0aWNzKSB7XG4gICAgICAgICAgICB0aGlzLnVuaXF1ZVZhbHVlc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVuaXF1ZVZhbHVlc1N0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlVmFsdWVzID0gYXdhaXQgZ2V0VW5pcXVlVmFsdWVzKHRoaXMucHJvcHMpO1xuICAgICAgICAgICAgICAgIHRoaXMudW5pcXVlVmFsdWVzID0gdW5pcXVlVmFsdWVzO1xuICAgICAgICAgICAgICAgIGlmICgoX2EgPSB1bmlxdWVWYWx1ZXMgPT09IG51bGwgfHwgdW5pcXVlVmFsdWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1bmlxdWVWYWx1ZXMudW5pcXVlVmFsdWVJbmZvcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXF1ZVZhbHVlc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmlxdWVWYWx1ZXNTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMudW5pcXVlVmFsdWVzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaGlkZVN0YXRpc3RpY3MpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuSU5fUFJPR1JFU1M7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRpc3RpY3MgPSBhd2FpdCBnZXRTdGF0aXN0aWNzKHRoaXMucHJvcHMpO1xuICAgICAgICAgICAgICAgIGlmICghaXNEZWZpbmVkKHN0YXRpc3RpY3MudG90YWxDb3VudCkgJiZcbiAgICAgICAgICAgICAgICAgICAgaXNEZWZpbmVkKHN0YXRpc3RpY3MuY291bnQpICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5pcXVlVmFsdWVzU3RhdHVzID09PSBzdGF0dXMuU1VDQ0VTUykge1xuICAgICAgICAgICAgICAgICAgICAvLyB0YWtlIG51bGwgdmFsdWVzIGNvdW50IGZyb20gdW5pcXVlIHZhbHVlcyBhbmQgYWRkIHdpdGggbm9uLW51bGwgY291bnQgZnJvbSBzdGF0aXN0aWNzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZm9zID0gdGhpcy51bmlxdWVWYWx1ZXMudW5pcXVlVmFsdWVJbmZvcztcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmZvcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IGluZm9zW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzLnRvdGFsQ291bnQgPSBpbmZvLmNvdW50ICsgc3RhdGlzdGljcy5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRGVmaW5lZChzdGF0aXN0aWNzLnRvdGFsQ291bnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBudWxsIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGlzdGljcy50b3RhbENvdW50ID0gc3RhdGlzdGljcy5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSBzdGF0aXN0aWNzO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGZpZWxkSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIGlmICghZmllbGRJbmZvKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuY29udGFpbmVyIH0sIHRoaXMucmVuZGVyRmllbGRUeXBlKCksIHRoaXMucmVuZGVyRmllbGRBbGlhcygpLCB0aGlzLnJlbmRlckZpZWxkRGVzY3JpcHRpb24oKSwgdGhpcy5yZW5kZXJGaWVsZFZhbHVlVHlwZSgpLCB0aGlzLnJlbmRlckZpZWxkU2FtcGxlVmFsdWUoKSwgdGhpcy5yZW5kZXJGaWVsZEZvcm1hdCgpLCB0aGlzLnJlbmRlckZpZWxkU3RhdGlzdGljcygpKSkpO1xuICAgIH1cbiAgICByZW5kZXJGaWVsZFR5cGUoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmllbGRJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gdGhpcy5fZ2V0RmllbGRUeXBlTGFiZWwoZmllbGRJbmZvLmxheWVyRmllbGQudHlwZSk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCBzdHJpbmdzLmZpZWxkVHlwZSksIGgoXCJkaXZcIiwgbnVsbCwgZmllbGRUeXBlKSkpO1xuICAgIH1cbiAgICByZW5kZXJGaWVsZEFsaWFzKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGZpZWxkSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCBzdHJpbmdzLmZpZWxkQWxpYXMpLCBoKFwiZGl2XCIsIG51bGwsIGZpZWxkSW5mby5sYWJlbCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGREZXNjcmlwdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gcHJvcHM7XG4gICAgICAgIGlmIChsYXllci50eXBlICE9PSBcImZlYXR1cmVcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBmaWVsZEluZm8gfSA9IHByb3BzO1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGZpZWxkSW5mby5sYXllckZpZWxkLmRlc2NyaXB0aW9uO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnNlY3Rpb24gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MudGl0bGUgfSwgc3RyaW5ncy5maWVsZERlc2NyaXB0aW9uKSwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgW0NTUy5taXNzaW5nXTogIWRlc2NyaXB0aW9uXG4gICAgICAgICAgICB9IH0sIGRlc2NyaXB0aW9uIHx8IHN0cmluZ3MuZmllbGREZXNjcmlwdGlvbk5vdFNldCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRWYWx1ZVR5cGUoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHByb3BzO1xuICAgICAgICBpZiAobGF5ZXIudHlwZSAhPT0gXCJmZWF0dXJlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgZmllbGRJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3QgZmllbGRWYWx1ZVR5cGUgPSB0aGlzLl9nZXRGaWVsZFZhbHVlVHlwZUNhbWVsQ2FzZShmaWVsZEluZm8pO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnNlY3Rpb24gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MudGl0bGUgfSwgc3RyaW5ncy5maWVsZFZhbHVlVHlwZSksIGgoXCJkaXZcIiwgeyBjbGFzczogIWZpZWxkVmFsdWVUeXBlID8gQ1NTLm1pc3NpbmcgOiBudWxsIH0sIGZpZWxkVmFsdWVUeXBlID8gc3RyaW5ncy5maWVsZFZhbHVlVHlwZXNbZmllbGRWYWx1ZVR5cGVdIDogc3RyaW5ncy5maWVsZFZhbHVlVHlwZU5vdFNldCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRTYW1wbGVWYWx1ZSgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgY29uc3QgeyBvbmVGZWF0dXJlUmVzcG9uc2UsIG9uZUZlYXR1cmVSZXNwb25zZVN0YXR1cywgc3RhdGlzdGljc1N0YXR1cywgc3RhdGlzdGljcywgdW5pcXVlVmFsdWVzU3RhdHVzLCB1bmlxdWVWYWx1ZXMsIHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBmaWVsZE5hbWUsIGZpZWxkSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljczogc3RhdFN0cmluZ3MgfSA9IHN0cmluZ3M7XG4gICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgaWYgKFtcImltYWdlcnlcIiwgXCJpbWFnZXJ5LXRpbGVcIl0uaW5kZXhPZihsYXllci50eXBlKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxheWVyLnR5cGUgIT09IFwic3RyZWFtXCIgJiZcbiAgICAgICAgICAgIFtzaW1wbGVGaWVsZFR5cGVzLlNUUklORywgc2ltcGxlRmllbGRUeXBlcy5PSUQsIHNpbXBsZUZpZWxkVHlwZXMuR1VJRF0uaW5kZXhPZih0aGlzLl9nZXRTdGF0aXN0aWNzVHlwZShmaWVsZEluZm8pKSA+IC0xICYmXG4gICAgICAgICAgICB1bmlxdWVWYWx1ZXNTdGF0dXMgIT09IHN0YXR1cy5GQUlMRUQpIHtcbiAgICAgICAgICAgIC8vIHdlIHNob3cgdG9wIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9uZUZlYXR1cmVSZXNwb25zZVN0YXR1cyA9PT0gc3RhdHVzLlNVQ0NFU1MpIHtcbiAgICAgICAgICAgIC8vIGZpbmQgZmlyc3QgdmFsaWQgdmFsdWUgZW50cnlcbiAgICAgICAgICAgIG9uZUZlYXR1cmVSZXNwb25zZS5mZWF0dXJlcy5mb3JFYWNoKChmZWF0dXJlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgKHZhbHVlID09PSBudWxsICYmIGZlYXR1cmUuYXR0cmlidXRlc1tmaWVsZE5hbWVdICE9PSBudWxsKSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZlYXR1cmUuYXR0cmlidXRlc1tmaWVsZE5hbWVdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5TVUNDRVNTKSB7XG4gICAgICAgICAgICAvLyB1c2Ugc3RhdGlzdGljcyBtaW4gdmFsdWVcbiAgICAgICAgICAgIHZhbHVlID0gc3RhdGlzdGljcy5taW47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodW5pcXVlVmFsdWVzU3RhdHVzID09PSBzdGF0dXMuU1VDQ0VTUykge1xuICAgICAgICAgICAgLy8gdXNlIGEgbm9uLW51bGwgdmFsdWVcbiAgICAgICAgICAgIHZhbHVlID1cbiAgICAgICAgICAgICAgICAoKF9iID0gKF9hID0gdW5pcXVlVmFsdWVzLnVuaXF1ZVZhbHVlSW5mb3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlKSB8fCAoKF9kID0gKF9jID0gdW5pcXVlVmFsdWVzLnVuaXF1ZVZhbHVlSW5mb3MpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1sxXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2RlZFZhbHVlcyA9IGZpZWxkSW5mby5jb2RlZFZhbHVlcztcbiAgICAgICAgaWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGlmIChjb2RlZFZhbHVlcykge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gKChfZSA9IGNvZGVkVmFsdWVzLmZpbmQoKGNvZGVkVmFsdWUpID0+IHZhbHVlID09PSBjb2RlZFZhbHVlLmNvZGUpKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubmFtZSkgfHwgdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX2dldERpc3BsYXlTdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc2VjdGlvbiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50aXRsZSB9LCBzdHJpbmdzLmZpZWxkU2FtcGxlVmFsdWUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IChvbmVGZWF0dXJlUmVzcG9uc2VTdGF0dXMgPT09IHN0YXR1cy5GQUlMRUQgJiZcbiAgICAgICAgICAgICAgICBzdGF0aXN0aWNzU3RhdHVzID09PSBzdGF0dXMuRkFJTEVEICYmXG4gICAgICAgICAgICAgICAgdW5pcXVlVmFsdWVzU3RhdHVzID09PSBzdGF0dXMuRkFJTEVEKSB8fFxuICAgICAgICAgICAgICAgICFpc0RlZmluZWQodmFsdWUpXG4gICAgICAgICAgICAgICAgPyBDU1MubWlzc2luZ1xuICAgICAgICAgICAgICAgIDogbnVsbCB9LCBvbmVGZWF0dXJlUmVzcG9uc2VTdGF0dXMgPT09IHN0YXR1cy5TVUNDRVNTIHx8XG4gICAgICAgICAgICBzdGF0aXN0aWNzU3RhdHVzID09PSBzdGF0dXMuU1VDQ0VTUyB8fFxuICAgICAgICAgICAgdW5pcXVlVmFsdWVzU3RhdHVzID09PSBzdGF0dXMuU1VDQ0VTU1xuICAgICAgICAgICAgPyAhaXNEZWZpbmVkKHZhbHVlKVxuICAgICAgICAgICAgICAgID8gc3RhdFN0cmluZ3MuYWxsTnVsbHNcbiAgICAgICAgICAgICAgICA6IGAke3ZhbHVlfWBcbiAgICAgICAgICAgIDogb25lRmVhdHVyZVJlc3BvbnNlU3RhdHVzID09PSBzdGF0dXMuRkFJTEVEICYmXG4gICAgICAgICAgICAgICAgc3RhdGlzdGljc1N0YXR1cyA9PT0gc3RhdHVzLkZBSUxFRCAmJlxuICAgICAgICAgICAgICAgIHVuaXF1ZVZhbHVlc1N0YXR1cyA9PT0gc3RhdHVzLkZBSUxFRFxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5maWVsZFNhbXBsZU5vdEF2YWlsYWJsZVxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy5maWVsZFNhbXBsZVJldHJpZXZpbmcpKSk7XG4gICAgfVxuICAgIHJlbmRlckZpZWxkRm9ybWF0KCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGZpZWxkTmFtZSwgZmllbGRJbmZvLCBsYXllciB9ID0gcHJvcHM7XG4gICAgICAgIGlmIChbXCJzaW5nbGVcIiwgXCJkb3VibGVcIiwgXCJsb25nXCJdLmluZGV4T2YoZmllbGRJbmZvLmxheWVyRmllbGQudHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb3B1cFRlbXBsYXRlID0gbGF5ZXIucG9wdXBUZW1wbGF0ZTtcbiAgICAgICAgaWYgKHBvcHVwVGVtcGxhdGUgPT09IG51bGwgfHwgcG9wdXBUZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9wdXBUZW1wbGF0ZS5maWVsZEluZm9zKSB7XG4gICAgICAgICAgICBjb25zdCBwb3BGaWVsZEluZm9zID0gKF9hID0gcG9wdXBUZW1wbGF0ZS5maWVsZEluZm9zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKChmaWVsZEluZm8pID0+IGZpZWxkSW5mby5maWVsZE5hbWUgPT09IGZpZWxkTmFtZSk7XG4gICAgICAgICAgICBpZiAocG9wRmllbGRJbmZvcyA9PT0gbnVsbCB8fCBwb3BGaWVsZEluZm9zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3BGaWVsZEluZm9zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBvcEZpZWxkSW5mbyA9IHBvcEZpZWxkSW5mb3NbMF07XG4gICAgICAgICAgICAgICAgaWYgKGlzRGVmaW5lZCgoX2IgPSBwb3BGaWVsZEluZm8gPT09IG51bGwgfHwgcG9wRmllbGRJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3BGaWVsZEluZm8uZm9ybWF0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucGxhY2VzKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBudW0gPSBwb3BGaWVsZEluZm8uZm9ybWF0LnBsYWNlcztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zZWN0aW9uIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnRpdGxlIH0sIHN0cmluZ3MuZmllbGREZWNpbWFsUGxhY2VzKSwgaChcImRpdlwiLCBudWxsLCBzdHJpbmdzLmZpZWxkTnVtRGVjaW1hbFBsYWNlcy5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIG51bS50b1N0cmluZygpKSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zZWN0aW9uIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnRpdGxlIH0sIHN0cmluZ3MuZmllbGREZWNpbWFsUGxhY2VzKSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MubWlzc2luZyB9LCBzdHJpbmdzLmZpZWxkRGVjaW1hbFBsYWNlc05vdEF2YWlsYWJsZSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRTdGF0aXN0aWNzKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3NTdGF0dXMsIHVuaXF1ZVZhbHVlc1N0YXR1cywgaGlkZVN0YXRpc3RpY3MsIHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBmaWVsZEluZm8gfSA9IHByb3BzO1xuICAgICAgICBpZiAoaGlkZVN0YXRpc3RpY3MpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRJbmZvQ29tcGxldGUuZW1pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFtcInN0cmVhbVwiLCBcImltYWdlcnlcIiwgXCJpbWFnZXJ5LXRpbGVcIl0uaW5kZXhPZihsYXllci50eXBlKSA+IC0xIHx8XG4gICAgICAgICAgICBbXCJsb25nXCJdLmluZGV4T2YoZmllbGRJbmZvLmxheWVyRmllbGQudHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgLy8gY2FuJ3QgZ2V0IHN0YXRpc3RpY3NcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzRmllbGRJbmZvQ29tcGxldGUuZW1pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zZWN0aW9uIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnRpdGxlIH0sIHN0cmluZ3MuZmllbGRTdGF0aXN0aWNzKSwgIXN0YXRpc3RpY3NTdGF0dXMgfHxcbiAgICAgICAgICAgIHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5NSVNTSU5HIHx8XG4gICAgICAgICAgICBzdGF0aXN0aWNzU3RhdHVzID09PSBzdGF0dXMuSU5fUFJPR1JFU1MgPyAoaChcImRpdlwiLCB7IGtleTogXCJmaWVsZC1pbmZvLXN0YXRpc3RpY3MtY29udGVudFwiLCBjbGFzczogQ1NTLm1pc3NpbmcgfSwgc3RyaW5ncy5maWVsZFN0YXRpc3RpY3NSZXRyaWV2aW5nKSkgOiBzdGF0aXN0aWNzU3RhdHVzID09PSBzdGF0dXMuRkFJTEVEICYmIHVuaXF1ZVZhbHVlc1N0YXR1cyAhPT0gc3RhdHVzLlNVQ0NFU1MgPyAodGhpcy5yZW5kZXJOb1N0YXRpc3RpY3MoKSkgOiAoaChcImRpdlwiLCB7IGtleTogXCJmaWVsZC1pbmZvLXN0YXRpc3RpY3MtY29udGVudFwiLCByZWY6ICgpID0+IHRoaXMuYXJjZ2lzRmllbGRJbmZvQ29tcGxldGUuZW1pdCgpIH0sIHRoaXMucmVuZGVyU3RhdGlzdGljcygpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTm9TdGF0aXN0aWNzKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGtleTogXCJmaWVsZC1pbmZvLXN0YXRpc3RpY3MtY29udGVudFwiLCByZWY6ICgpID0+IHRoaXMuYXJjZ2lzRmllbGRJbmZvQ29tcGxldGUuZW1pdCgpLCBjbGFzczogQ1NTLm1pc3NpbmcgfSwgc3RyaW5ncy5maWVsZFN0YXRpc3RpY3NOb3RBdmFpbGFibGUpKTtcbiAgICB9XG4gICAgcmVuZGVyU3RhdGlzdGljcygpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBmaWVsZEluZm8gfSA9IHByb3BzO1xuICAgICAgICBzd2l0Y2ggKHRoaXMuX2dldFN0YXRpc3RpY3NUeXBlKGZpZWxkSW5mbykpIHtcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5OVU1CRVI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTnVtYmVyU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgY2FzZSBzaW1wbGVGaWVsZFR5cGVzLlNUUklORzpcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5PSUQ6XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuR1VJRDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJTdHJpbmdTdGF0aXN0aWNzKCk7XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuREFURTpcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5EQVRFX09OTFk6XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuVElNRV9PTkxZOlxuICAgICAgICAgICAgY2FzZSBzaW1wbGVGaWVsZFR5cGVzLlRJTUVTVEFNUF9PRkZTRVQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRGF0ZVN0YXRpc3RpY3MoKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyTnVtYmVyU3RhdGlzdGljcygpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIXN0YXRpc3RpY3MpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlck5vU3RhdGlzdGljcygpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljczogc3RhdFN0cmluZ3MgfSA9IHN0cmluZ3M7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgbnVsbCwgc3RhdFN0cmluZ3MubnVtYmVyT2ZWYWx1ZXMpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIHRoaXMuX3ByaW50TnVtVmFsdWUoc3RhdGlzdGljcy50b3RhbENvdW50KSkpLCBpc0RlZmluZWQoc3RhdGlzdGljcy5zdW0pID8gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnN0YXRpc3RpY3NSb3cgfSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5zdW1PZlZhbHVlcyksIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgdGhpcy5fcHJpbnROdW1WYWx1ZShzdGF0aXN0aWNzLnN1bSkpKSkgOiBudWxsLCBpc0RlZmluZWQoc3RhdGlzdGljcy5taW4pID8gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnN0YXRpc3RpY3NSb3cgfSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5taW5pbXVtKSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuZGF0YSB9LCB0aGlzLl9wcmludE51bVZhbHVlKHN0YXRpc3RpY3MubWluKSkpKSA6IG51bGwsIGlzRGVmaW5lZChzdGF0aXN0aWNzLm1heCkgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc3RhdGlzdGljc1JvdyB9LCBoKFwiZGl2XCIsIG51bGwsIHN0YXRTdHJpbmdzLm1heGltdW0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIHRoaXMuX3ByaW50TnVtVmFsdWUoc3RhdGlzdGljcy5tYXgpKSkpIDogbnVsbCwgaXNEZWZpbmVkKHN0YXRpc3RpY3MuYXZnKSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgbnVsbCwgc3RhdFN0cmluZ3MuYXZlcmFnZSksIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgdGhpcy5fcHJpbnROdW1WYWx1ZShzdGF0aXN0aWNzLmF2ZykpKSkgOiBudWxsLCBpc0RlZmluZWQoc3RhdGlzdGljcy5zdGRkZXYpID8gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnN0YXRpc3RpY3NSb3cgfSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5zdGFuZGFyZERldmlhdGlvbiksIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgdGhpcy5fcHJpbnROdW1WYWx1ZShzdGF0aXN0aWNzLnN0ZGRldikpKSkgOiBudWxsLCB0aGlzLnJlbmRlck51bGxWYWx1ZXMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJTdHJpbmdTdGF0aXN0aWNzKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3MsIHVuaXF1ZVZhbHVlc1N0YXR1cywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzOiBzdGF0U3RyaW5ncyB9ID0gc3RyaW5ncztcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnN0YXRpc3RpY3NSb3cgfSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5udW1iZXJPZlZhbHVlcyksIHVuaXF1ZVZhbHVlc1N0YXR1cyAhPT0gc3RhdHVzLlNVQ0NFU1MgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MubWlzc2luZyB9LCBcIi0tXCIpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIHRoaXMuX3ByaW50TnVtVmFsdWUoc3RhdGlzdGljcyA9PT0gbnVsbCB8fCBzdGF0aXN0aWNzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdGF0aXN0aWNzLnRvdGFsQ291bnQpKSkpLCB0aGlzLnJlbmRlck51bGxWYWx1ZXMoKSwgdGhpcy5yZW5kZXJUb3BWYWx1ZXMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJEYXRlU3RhdGlzdGljcygpIHtcbiAgICAgICAgLy8gVE9ETyBVVEMgb2Zmc2V0XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljcywgdmlldywgcHJvcHMsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmllbGRJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgaWYgKCFzdGF0aXN0aWNzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJOb1N0YXRpc3RpY3MoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3M6IHN0YXRTdHJpbmdzIH0gPSBzdHJpbmdzO1xuICAgICAgICBjb25zdCBkYXRlUmFuZ2UgPSBzdGF0aXN0aWNzLm1heCAtIHN0YXRpc3RpY3MubWluO1xuICAgICAgICBjb25zdCB5ZWFycyA9IE1hdGguZmxvb3IoZGF0ZVJhbmdlIC8gMzE1MzYwMDAwMDApO1xuICAgICAgICBsZXQgbW9udGhzID0gTWF0aC5mbG9vcigoZGF0ZVJhbmdlIC0geWVhcnMgKiAzMTUzNjAwMDAwMCkgLyAyNjI4MDAwMDAwKTtcbiAgICAgICAgbGV0IGRheXMgPSBNYXRoLmNlaWwoKGRhdGVSYW5nZSAtIG1vbnRocyAqIDI2MjgwMDAwMDApIC8gODY0MDAwMDApO1xuICAgICAgICBpZiAoZGF5cyA+PSAzMCkge1xuICAgICAgICAgICAgbW9udGhzICs9IDE7XG4gICAgICAgICAgICBkYXlzID0gMDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGltZVNwYW4gPSB5ZWFycyA9PT0gMVxuICAgICAgICAgICAgPyBzdGF0U3RyaW5ncy50aW1lU3Bhbk9wdGlvbnMueWVhclxuICAgICAgICAgICAgOiB5ZWFycyA+IDFcbiAgICAgICAgICAgICAgICA/IHN0YXRTdHJpbmdzLnRpbWVTcGFuT3B0aW9ucy55ZWFycy5yZXBsYWNlKFwiJHt5ZWFyc31cIiwgeWVhcnMudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgIHRpbWVTcGFuICs9IHllYXJzID4gMCAmJiAobW9udGhzID4gMCB8fCBkYXlzID4gMCkgPyBcIiwgXCIgOiBcIlwiO1xuICAgICAgICB0aW1lU3BhbiArPVxuICAgICAgICAgICAgbW9udGhzID09PSAxXG4gICAgICAgICAgICAgICAgPyBzdGF0U3RyaW5ncy50aW1lU3Bhbk9wdGlvbnMubW9udGhcbiAgICAgICAgICAgICAgICA6IG1vbnRocyA+IDFcbiAgICAgICAgICAgICAgICAgICAgPyBzdGF0U3RyaW5ncy50aW1lU3Bhbk9wdGlvbnMubW9udGhzLnJlcGxhY2UoXCIke21vbnRoc31cIiwgbW9udGhzLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgdGltZVNwYW4gKz0gbW9udGhzID4gMCAmJiBkYXlzID4gMCA/IFwiLCBcIiA6IFwiXCI7XG4gICAgICAgIHRpbWVTcGFuICs9XG4gICAgICAgICAgICBkYXlzID09PSAxXG4gICAgICAgICAgICAgICAgPyBzdGF0U3RyaW5ncy50aW1lU3Bhbk9wdGlvbnMuZGF5XG4gICAgICAgICAgICAgICAgOiBkYXlzID4gMVxuICAgICAgICAgICAgICAgICAgICA/IHN0YXRTdHJpbmdzLnRpbWVTcGFuT3B0aW9ucy5kYXlzLnJlcGxhY2UoXCIke2RheXN9XCIsIGRheXMudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICBjb25zdCBzaG93U3RhdHMgPSBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlICE9PSBzaW1wbGVGaWVsZFR5cGVzLlRJTUVTVEFNUF9PRkZTRVQgfHxcbiAgICAgICAgICAgICF2aWV3IHx8XG4gICAgICAgICAgICB2aWV3LnRpbWVab25lICE9PSBcInVua25vd25cIjtcbiAgICAgICAgY29uc3QgaXNUaW1lT25seSA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuVElNRV9PTkxZO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc3RhdGlzdGljc1JvdyB9LCBoKFwiZGl2XCIsIG51bGwsIHN0YXRTdHJpbmdzLm51bWJlck9mVmFsdWVzKSwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuZGF0YSB9LCB0aGlzLl9wcmludE51bVZhbHVlKHN0YXRpc3RpY3MgPT09IG51bGwgfHwgc3RhdGlzdGljcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhdGlzdGljcy50b3RhbENvdW50KSkpLCBzaG93U3RhdHMgJiYgaXNEZWZpbmVkKHN0YXRpc3RpY3MubWluKSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgbnVsbCwgaXNUaW1lT25seSA/IHN0YXRTdHJpbmdzLm1pbmltdW1UaW1lIDogc3RhdFN0cmluZ3MubWluaW11bURhdGUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIGAke3RoaXMuX2dldERpc3BsYXlTdHJpbmcoc3RhdGlzdGljcy5taW4pfWApKSkgOiBudWxsLCBzaG93U3RhdHMgJiYgaXNEZWZpbmVkKHN0YXRpc3RpY3MubWF4KSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgbnVsbCwgaXNUaW1lT25seSA/IHN0YXRTdHJpbmdzLm1heGltdW1UaW1lIDogc3RhdFN0cmluZ3MubWF4aW11bURhdGUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIGAke3RoaXMuX2dldERpc3BsYXlTdHJpbmcoc3RhdGlzdGljcy5tYXgpfWApKSkgOiBudWxsLCBzaG93U3RhdHMgJiYgaXNEZWZpbmVkKHN0YXRpc3RpY3MuYXZnKSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgbnVsbCwgaXNUaW1lT25seSA/IHN0YXRTdHJpbmdzLmF2ZXJhZ2VUaW1lIDogc3RhdFN0cmluZ3MuYXZlcmFnZURhdGUpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5kYXRhIH0sIGAke3RoaXMuX2dldERpc3BsYXlTdHJpbmcoc3RhdGlzdGljcy5hdmcpfWApKSkgOiBudWxsLCBzaG93U3RhdHMgJiZcbiAgICAgICAgICAgICFpc1RpbWVPbmx5ICYmXG4gICAgICAgICAgICBpc0RlZmluZWQoc3RhdGlzdGljcy5taW4pICYmXG4gICAgICAgICAgICBpc0RlZmluZWQoc3RhdGlzdGljcy5tYXgpICYmXG4gICAgICAgICAgICBkYXRlUmFuZ2UgPiAwID8gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLnN0YXRpc3RpY3NSb3cgfSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy50aW1lc3BhbiksIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgdGltZVNwYW4pKSkgOiBudWxsLCB0aGlzLnJlbmRlck51bGxWYWx1ZXMoKSkpO1xuICAgIH1cbiAgICByZW5kZXJUb3BWYWx1ZXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyB1bmlxdWVWYWx1ZXMsIHVuaXF1ZVZhbHVlc1N0YXR1cywgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmllbGRJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzOiBzdGF0U3RyaW5ncyB9ID0gc3RyaW5ncztcbiAgICAgICAgaWYgKChfYSA9IHVuaXF1ZVZhbHVlcyA9PT0gbnVsbCB8fCB1bmlxdWVWYWx1ZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVuaXF1ZVZhbHVlcy51bmlxdWVWYWx1ZUluZm9zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBpbmZvcyA9IHVuaXF1ZVZhbHVlcy51bmlxdWVWYWx1ZUluZm9zO1xuICAgICAgICAgICAgaW5mb3Muc29ydCgoYSwgYikgPT4gKGEuY291bnQgPCBiLmNvdW50ID8gMSA6IGEuY291bnQgPiBiLmNvdW50ID8gLTEgOiAwKSk7XG4gICAgICAgICAgICBjb25zdCBjb2RlZFZhbHVlcyA9IGZpZWxkSW5mby5jb2RlZFZhbHVlcztcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IGluZm9zXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoaW5mbykgPT4gaW5mby52YWx1ZSAhPT0gbnVsbClcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChpbmZvLCBpZHgpID0+IGluZm8gJiYgaWR4IDwgMTApXG4gICAgICAgICAgICAgICAgLm1hcCgoaW5mbykgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGluZm8udmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKGNvZGVkVmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGVkVmFsdWVzLmZvckVhY2goKGNvZGVWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBjb2RlVmFsdWUuY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29kZVZhbHVlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9nZXREaXNwbGF5U3RyaW5nKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgYCR7dmFsdWV9YCksIGgoXCJkaXZcIiwgeyBjbGFzczogYCR7Q1NTLmRhdGF9ICR7Q1NTLmNvdW50fWAgfSwgdGhpcy5fcHJpbnROdW1WYWx1ZShpbmZvLmNvdW50KSkpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF2YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc3RhdGlzdGljc1Jvd1RvcFZhbHVlcyB9LCBoKFwiZGl2XCIsIG51bGwsIGluZm9zLmxlbmd0aCA+IDEwID8gc3RhdFN0cmluZ3MudG9wVGVuVmFsdWVzIDogc3RhdFN0cmluZ3MudG9wVmFsdWVzKSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5jb3VudCkpLCB2YWx1ZXMpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93VG9wVmFsdWVzIH0sIGgoXCJkaXZcIiwgbnVsbCwgc3RhdFN0cmluZ3MudG9wVmFsdWVzKSwgaChcImRpdlwiLCBudWxsLCBzdGF0U3RyaW5ncy5jb3VudCkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5zdGF0aXN0aWNzUm93IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLm1pc3NpbmcgfSwgdW5pcXVlVmFsdWVzU3RhdHVzID09PSBzdGF0dXMuRkFJTEVEXG4gICAgICAgICAgICAgICAgPyBzdHJpbmdzLmZpZWxkVW5pcXVlVmFsdWVzTm90QXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgOiBzdHJpbmdzLmZpZWxkU2FtcGxlUmV0cmlldmluZykpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyTnVsbFZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzLCB1bmlxdWVWYWx1ZXMsIHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljczogc3RhdFN0cmluZ3MgfSA9IHN0cmluZ3M7XG4gICAgICAgIGxldCBjb3VudCA9IHN0YXRpc3RpY3MgPT09IG51bGwgfHwgc3RhdGlzdGljcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhdGlzdGljcy5udWxsY291bnQ7XG4gICAgICAgIGlmICghaXNEZWZpbmVkKGNvdW50KSAmJiB1bmlxdWVWYWx1ZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZm9zID0gdW5pcXVlVmFsdWVzLnVuaXF1ZVZhbHVlSW5mb3M7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZm9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IGluZm9zW2ldO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gaW5mby5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1Muc3RhdGlzdGljc1JvdyB9LCBoKFwiZGl2XCIsIG51bGwsIHN0YXRTdHJpbmdzLm51bWJlck9mTnVsbHMpLCAhaXNEZWZpbmVkKGNvdW50KSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5taXNzaW5nIH0sIFwiLS1cIikpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmRhdGEgfSwgYCR7bmV3IE51bWJlcihjb3VudCkudG9Mb2NhbGVTdHJpbmcoKX1gKSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgX2dldEZpZWxkVHlwZUxhYmVsKGZpZWxkVHlwZSkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGZpZWxkVHlwZXMgPSBzdHJpbmdzLmZpZWxkVHlwZXM7XG4gICAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwic21hbGwtaW50ZWdlclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLnNtYWxsSW50ZWdlcjtcbiAgICAgICAgICAgIGNhc2UgXCJiaWctaW50ZWdlclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLmJpZ0ludGVnZXI7XG4gICAgICAgICAgICBjYXNlIFwiaW50ZWdlclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLmludGVnZXI7XG4gICAgICAgICAgICBjYXNlIFwic2luZ2xlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZXMuc2luZ2xlO1xuICAgICAgICAgICAgY2FzZSBcImRvdWJsZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLmRvdWJsZTtcbiAgICAgICAgICAgIGNhc2UgXCJsb25nXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZXMubG9uZztcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGRUeXBlcy5zdHJpbmc7XG4gICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLmRhdGU7XG4gICAgICAgICAgICBjYXNlIFwiZGF0ZS1vbmx5XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZXMuZGF0ZU9ubHk7XG4gICAgICAgICAgICBjYXNlIFwidGltZS1vbmx5XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZXMudGltZU9ubHk7XG4gICAgICAgICAgICBjYXNlIFwidGltZXN0YW1wLW9mZnNldFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLnRpbWVzdGFtcE9mZnNldDtcbiAgICAgICAgICAgIGNhc2UgXCJvaWRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGRUeXBlcy5vaWQ7XG4gICAgICAgICAgICBjYXNlIFwiZ3VpZFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLmd1aWQ7XG4gICAgICAgICAgICBjYXNlIFwiZ2xvYmFsLWlkXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZXMuZ2xvYmFsSWQ7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGVzLnN0cmluZztcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZ2V0U3RhdGlzdGljc1R5cGUoZmllbGRJbmZvKSB7XG4gICAgICAgIC8vIFwiY291bnQtb3ItYW1vdW50XCIsXCJwZXJjZW50YWdlLW9yLXJhdGlvXCIsXCJtZWFzdXJlbWVudFwiLFwidW5pcXVlLWlkZW50aWZpZXJcIixcImNvb3JkaW5hdGVcIixcImJpbmFyeVwiXG4gICAgICAgIC8vIFwibmFtZS1vci10aXRsZVwiLFwidHlwZS1vci1jYXRlZ29yeVwiLFwiZGVzY3JpcHRpb25cIixcImxvY2F0aW9uLW9yLXBsYWNlLW5hbWVcIixcIm9yZGVyZWQtb3ItcmFua2VkXCIsXCJkYXRlLWFuZC10aW1lXCJcbiAgICAgICAgc3dpdGNoIChmaWVsZEluZm8ubGF5ZXJGaWVsZC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwic21hbGwtaW50ZWdlclwiOlxuICAgICAgICAgICAgY2FzZSBcImJpZy1pbnRlZ2VyXCI6XG4gICAgICAgICAgICBjYXNlIFwiaW50ZWdlclwiOlxuICAgICAgICAgICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgICAgICAgY2FzZSBcImRvdWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkSW5mby5jb2RlZFZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZmllbGRJbmZvLmxheWVyRmllbGQudmFsdWVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJuYW1lLW9yLXRpdGxlXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0eXBlLW9yLWNhdGVnb3J5XCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkZXNjcmlwdGlvblwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibG9jYXRpb24tb3ItcGxhY2UtbmFtZVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwib3JkZXJlZC1vci1yYW5rZWRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJpbmFyeVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jYXNlIFwiZGF0ZS1hbmQtdGltZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gc2ltcGxlRmllbGRUeXBlcy5TVFJJTkc7XG4gICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBzaW1wbGVGaWVsZFR5cGVzLkRBVEU7XG4gICAgICAgICAgICBjYXNlIFwidGltZXN0YW1wLW9mZnNldFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBzaW1wbGVGaWVsZFR5cGVzLlRJTUVTVEFNUF9PRkZTRVQ7XG4gICAgICAgICAgICBjYXNlIFwiZGF0ZS1vbmx5XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNpbXBsZUZpZWxkVHlwZXMuREFURV9PTkxZO1xuICAgICAgICAgICAgY2FzZSBcInRpbWUtb25seVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBzaW1wbGVGaWVsZFR5cGVzLlRJTUVfT05MWTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9nZXRGaWVsZFZhbHVlVHlwZUNhbWVsQ2FzZShmaWVsZCkge1xuICAgICAgICBzd2l0Y2ggKGZpZWxkLmxheWVyRmllbGQudmFsdWVUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiY291bnQtb3ItYW1vdW50XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiY291bnRPckFtb3VudFwiO1xuICAgICAgICAgICAgY2FzZSBcInBlcmNlbnRhZ2Utb3ItcmF0aW9cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJwZXJjZW50YWdlT3JSYXRpb1wiO1xuICAgICAgICAgICAgY2FzZSBcInVuaXF1ZS1pZGVudGlmaWVyXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidW5pcXVlSWRlbnRpZmllclwiO1xuICAgICAgICAgICAgY2FzZSBcIm5hbWUtb3ItdGl0bGVcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJuYW1lT3JUaXRsZVwiO1xuICAgICAgICAgICAgY2FzZSBcInR5cGUtb3ItY2F0ZWdvcnlcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ0eXBlT3JDYXRlZ29yeVwiO1xuICAgICAgICAgICAgY2FzZSBcImxvY2F0aW9uLW9yLXBsYWNlLW5hbWVcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJsb2NhdGlvbk9yUGxhY2VOYW1lXCI7XG4gICAgICAgICAgICBjYXNlIFwib3JkZXJlZC1vci1yYW5rZWRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJvcmRlcmVkT3JSYW5rZWRcIjtcbiAgICAgICAgICAgIGNhc2UgXCJkYXRlLWFuZC10aW1lXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZGF0ZUFuZFRpbWVcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmxheWVyRmllbGQudmFsdWVUeXBlO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9nZXREaXNwbGF5U3RyaW5nKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmllbGRJbmZvIH0gPSBwcm9wcztcbiAgICAgICAgc3dpdGNoIChmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuREFURTpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RGF0ZVN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuVElNRVNUQU1QX09GRlNFVDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VGltZXN0YW1wT2Zmc2V0U3RyaW5nKHZhbHVlKTtcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5EQVRFX09OTFk6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldERhdGVPbmx5U3RyaW5nKHZhbHVlKTtcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5USU1FX09OTFk6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFRpbWVPbmx5U3RyaW5nKHZhbHVlKTtcbiAgICAgICAgICAgIGNhc2Ugc2ltcGxlRmllbGRUeXBlcy5OVU1CRVI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldE51bWJlclN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICBjYXNlIHNpbXBsZUZpZWxkVHlwZXMuR1VJRDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0R3VpZFN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIHN0cmluZywgb2lkLCBnbG9iYWwtaWRcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7dmFsdWV9YDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZ2V0RGF0ZVN0cmluZyh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IG1vZHVsZXMsIHZpZXcgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh2aWV3ICYmIHZpZXcudGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlcy5pbnRsLmZvcm1hdERhdGUodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcInNob3J0LWRhdGUtc2hvcnQtdGltZVwiKSksIHsgdGltZVpvbmU6IFwidXRjXCIsIHRpbWVab25lTmFtZTogXCJzaG9ydE9mZnNldFwiIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGtub3duIGlzc3VlcyB3aXRoIGZvcm1hdHRpbmcgaXQtQ0hcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVzLmludGwuZm9ybWF0RGF0ZSh2YWx1ZSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBtb2R1bGVzLmludGwuY29udmVydERhdGVGb3JtYXRUb0ludGxPcHRpb25zKFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpKSwgeyB0aW1lWm9uZTogKHZpZXcgPT09IG51bGwgfHwgdmlldyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmlldy50aW1lWm9uZSkgfHwgXCJzeXN0ZW1cIiB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2dldFRpbWVzdGFtcE9mZnNldFN0cmluZyh2YWx1ZSkge1xuICAgICAgICAvKlxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBcIjIwMjMtMDMtMTlUMTY6MDA6MDAuMTIzLTAxOjAwXCI7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidGltZXN0YW1wXCIsIHRpbWVzdGFtcCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIFwibG9jYWwgVGltZVwiLFxuICAgICAgICAgIGludGwuZm9ybWF0VGltZXN0YW1wKHRpbWVzdGFtcCwgaW50bC5jb252ZXJ0RGF0ZUZvcm1hdFRvSW50bE9wdGlvbnMoXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIikpXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIFwibWFwVmlldyBUaW1lIChleGNlcHQgdW5rbm93bilcIixcbiAgICAgICAgICBpbnRsLmZvcm1hdFRpbWVzdGFtcCh0aW1lc3RhbXAsIHtcbiAgICAgICAgICAgIC4uLmludGwuY29udmVydERhdGVGb3JtYXRUb0ludGxPcHRpb25zKFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpLFxuICAgICAgICAgICAgdGltZVpvbmU6IHZpZXcudGltZVpvbmUsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgXCJVVEMgVGltZSAobWFwVmlldyB0aW1lIHVua25vd24pXCIsXG4gICAgICAgICAgaW50bC5mb3JtYXRUaW1lc3RhbXAodGltZXN0YW1wLCB7XG4gICAgICAgICAgICAuLi5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcInNob3J0LWRhdGUtc2hvcnQtdGltZVwiKSxcbiAgICAgICAgICAgIHRpbWVab25lOiBcInV0Y1wiLFxuICAgICAgICAgICAgdGltZVpvbmVOYW1lOiBcInNob3J0T2Zmc2V0XCJcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBcIlJhd1wiLFxuICAgICAgICAgIGludGwuZm9ybWF0VGltZXN0YW1wKHRpbWVzdGFtcCwge1xuICAgICAgICAgICAgLi4uaW50bC5jb252ZXJ0RGF0ZUZvcm1hdFRvSW50bE9wdGlvbnMoXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIiksXG4gICAgICAgICAgICB0aW1lWm9uZU5hbWU6IFwic2hvcnRPZmZzZXRcIlxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgICovXG4gICAgICAgIGNvbnN0IHsgbW9kdWxlcywgdmlldyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgLy8gcmF3IHZhbHVlIGZyb20gbGF5ZXJcbiAgICAgICAgICAgIGlmICh2aWV3ICYmIHZpZXcudGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vZHVsZXMuaW50bC5mb3JtYXRUaW1lc3RhbXAodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcInNob3J0LWRhdGUtc2hvcnQtdGltZVwiKSksIHsgdGltZVpvbmU6IFwidXRjXCIsIHRpbWVab25lTmFtZTogXCJzaG9ydE9mZnNldFwiIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2R1bGVzLmludGwuZm9ybWF0VGltZXN0YW1wKHZhbHVlLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG1vZHVsZXMuaW50bC5jb252ZXJ0RGF0ZUZvcm1hdFRvSW50bE9wdGlvbnMoXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIikpLCB7IHRpbWVab25lOiAodmlldyA9PT0gbnVsbCB8fCB2aWV3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2aWV3LnRpbWVab25lKSB8fCBcInN5c3RlbVwiIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGUuZy4gVU5JWCB0aW1lc3RhbXAgZnJvbSBzdGF0aXN0aWNzIGNhbGxcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXREYXRlU3RyaW5nKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZ2V0RGF0ZU9ubHlTdHJpbmcodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtb2R1bGVzIH0gPSBwcm9wcztcbiAgICAgICAgcmV0dXJuIG1vZHVsZXMuaW50bC5mb3JtYXREYXRlT25seSh2YWx1ZSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcInNob3J0LWRhdGVcIikpO1xuICAgIH1cbiAgICBfZ2V0VGltZU9ubHlTdHJpbmcodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtb2R1bGVzIH0gPSBwcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZXMuaW50bC5mb3JtYXRUaW1lT25seSh2YWx1ZSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcInNob3J0LWRhdGUtbG9uZy10aW1lXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFVOSVggdGltZXN0YW1wXG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlcy5pbnRsLmZvcm1hdERhdGUodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhcImxvbmctdGltZVwiKSksIHsgdGltZVpvbmU6IFwidXRjXCIgfSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9nZXRHdWlkU3RyaW5nKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS5zdGFydHNXaXRoKFwie1wiKSA/IHZhbHVlIDogYHske3ZhbHVlfX1gO1xuICAgIH1cbiAgICBfZ2V0TnVtYmVyU3RyaW5nKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLm1vZHVsZXMuaW50bC5mb3JtYXROdW1iZXIodmFsdWUpO1xuICAgIH1cbiAgICBfcHJpbnROdW1WYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gaXNEZWZpbmVkKHZhbHVlKSA/IHRoaXMuX2dldE51bWJlclN0cmluZyhNYXRoLnJvdW5kKHZhbHVlICogMTAwKSAvIDEwMCkgOiBgLS1gO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzRmllbGRJbmZvLnN0eWxlID0gYXJjZ2lzRmllbGRJbmZvQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNGaWVsZEluZm8gYXMgYXJjZ2lzX2ZpZWxkX2luZm8gfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWZpZWxkLWluZm8uZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9