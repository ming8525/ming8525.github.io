/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-restore-dca62d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-restore-dca62d"],{95970:(e,t,s)=>{s.r(t),s.d(t,{arcgis_restore_items:()=>a});var r=s(81149),i=s(70105),n=s(82218),o=s(20164);s(49853),s(70464),s(42577),s(51837),s(69283),s(79210);const a=class{constructor(e){(0,r.r)(this,e),this.arcgisRestoreItemsRestore=(0,r.c)(this,"arcgisRestoreItemsRestore",7),this.arcgisRestoreItemsClose=(0,r.c)(this,"arcgisRestoreItemsClose",7),this.headerTitle="",this.renderContent=()=>(0,r.h)(r.F,null,(0,r.h)("slot",{name:"message"}),this.restoreItemsBuckets.unrestorableItems.length>=1&&this.renderUnrestorableItems(),this.allRestorableItems.length>=1&&this.renderRestorableItems()),this.renderUnrestorableItems=()=>{const{i18n:e,restoreItemsBuckets:t}=this,{unrestorableItems:s}=t;return(0,r.h)(r.F,null,(0,r.h)("arcgis-items-summary",null,(0,r.h)("div",{slot:"title"},(0,r.h)("span",null,e.cannotRestore),(0,r.h)("arcgis-items-summary-bucket",{popoverId:"restore-bucket",summaryGroups:[{items:s}]})),(0,r.h)("div",{slot:"description",innerHTML:e.dependentItems[1===s.length?"single":"multiple"].replace("${parent}",`${s[0].item.title}`)})),this.allRestorableItems.length>0&&(0,r.h)("hr",{class:"divider"}))},this.renderRestorableItems=()=>{const{i18n:e}=this;return(0,r.h)(r.F,null,(0,r.h)("arcgis-items-summary",null,(0,r.h)("div",{slot:"title"},(0,r.h)("span",null,e.toRestore[1===this.allRestorableItems.length?"single":"multiple"]),(0,r.h)("arcgis-items-summary-bucket",{popoverId:"restore-bucket",summaryGroups:[{items:this.allRestorableItems}]}))),(0,r.h)("arcgis-folder-picker",{class:"folder-picker",label:this.i18n.restoreTo,user:this.user,onArcgisFolderPickerChange:e=>this.folder=e.detail}),(0,r.h)("calcite-notice",{open:!0,class:"leader-1"},(0,r.h)("div",{slot:"message"},this.i18n.noticeMessage)))},this.handleRestore=async()=>{this.isLoading=!0;const{restorableItems:e,sourceItems:t}=this.restoreItemsBuckets,{folder:s}=this,r=await this.restoreItems(t.map((e=>e.item)),s),i=await this.restoreItems(e.map((e=>e.item)),s);this.arcgisRestoreItemsRestore.emit({restoredItems:[...r,...i],folder:s}),this.active=!1,this.isLoading=!1},this.restoreItems=async(e,t=null)=>Promise.all(e.map((e=>((e,t,s)=>{const r=`${t.userContentUrl}/items/${e.id}/restore`;return(0,o.r)(r,{folderID:s},{},"post")})(e,this.user,t.id)))),this.user=void 0,this.portal=void 0,this.items=[],this.active=!1,this.restoreItemsBuckets={restorableItems:[],sourceItems:[],unrestorableItems:[]},this.showSelectedItemsCount=!0,this.isLoading=!1}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.folder=(0,i.b)(this.user.username),this.determineRestoreState()}async determineRestoreState(e={fetch:!0}){const{fetch:t}=e;t&&(this.isLoading=!0,this.restoreItemsBuckets=Object.assign({},await(async(e,t)=>{const s=[],r=[],i=[];return await Promise.all(e.map((async n=>{var a;try{await((e,t)=>{const s=`${t.userContentUrl}/items/${e.id}/canRestore`;return(0,o.r)(s)})(n,t),r.push({item:n})}catch(t){const r=Object.assign({},t.details.raw);if("CONT_00486"===r.messageCode){const{offendingItems:t}=r,o=null!==(a=null==t?void 0:t.map((e=>e.itemId)))&&void 0!==a?a:[];o.every((t=>e.map((e=>e.id)).includes(t)))?s.push({item:n}):i.push({item:n,error:r})}else i.push({item:n,error:r})}}))),{restorableItems:s,sourceItems:r,unrestorableItems:i}})(this.items,this.user)),this.isLoading=!1);const{restorableItems:s,sourceItems:r}=this.restoreItemsBuckets;this.allRestorableItems=[...s,...r],this.tooManyItems=this.items.length>20,this.allSameOwner=this.items.every((e=>e.owner===this.items[0].owner)),this.canRestore=!this.tooManyItems&&this.allSameOwner&&this.allRestorableItems.length>0,this.headerTitle=this.i18n[this.items.length>1?"restoreItems":"restoreItem"]}render(){const{i18n:e,active:t,isLoading:s,headerTitle:i,renderContent:n}=this;return(0,r.h)("calcite-modal",{open:t,widthScale:"s",kind:"brand",outsideCloseDisabled:!0,onCalciteModalBeforeClose:()=>{this.arcgisRestoreItemsClose.emit()},onCalciteModalClose:()=>{this.active=!1}},(0,r.h)("span",{slot:"header",class:"header"},(0,r.h)("slot",{name:"header"},i)),(0,r.h)("div",{slot:"content",class:"content"},s?(0,r.h)("calcite-scrim",{loading:!0}):n()),!s&&(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisRestoreItemsClose.emit(),this.active=!1},width:"full"},e.cancel),this.canRestore&&(0,r.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:()=>this.handleRestore(),width:"full",disabled:s},e.restore)))}get el(){return(0,r.d)(this)}static get watchers(){return{items:["determineRestoreState"]}}};a.style=".content{display:flex;min-height:72px;flex-direction:column}::slotted([slot=message]){margin-bottom:1rem}:host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}.folder-picker{margin-top:1rem}.divider{margin-left:0px;margin-right:0px;margin-top:1rem;margin-bottom:0px;border-style:none;border-top:1px solid #ccc}arcgis-items-summary:not(:first-of-type){margin-top:2rem}"},70105:(e,t,s)=>{s.d(t,{a:()=>m,b:()=>h,c:()=>d,d:()=>a,e:()=>l,f:()=>n,g:()=>u,u:()=>p});var r=s(20164),i=s(49853);async function n(e,t){return(0,r.r)(`${(0,r.g)(t)}/community/users/${e}`)}async function o(){return(0,r.r)(`${(0,r.g)()}/community/self`)}async function a(){var e;const t=null===i.c||void 0===i.c?void 0:i.c.user;if(!t)return[];const s=await(0,r.f)((()=>o()),"communitySelf",t.username);return null!==(e=null==s?void 0:s.groups)&&void 0!==e?e:[]}async function l(){const e=null===i.c||void 0===i.c?void 0:i.c.user;return e?(await(0,r.f)((()=>o()),"communitySelf",e.username)).favGroupId:null}function c(e,t){var s;return null!==(s=null==e?void 0:e.userContentUrl)&&void 0!==s?s:`${null==t?void 0:t.restUrl}/content/users/${e.username}`}async function u(e){var t;const s=null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,{folders:n}=await async function(e){var t;const s=c(null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,i.c.portal),n=await(0,r.r)(s,{num:1});return Promise.resolve(n)}(s),{username:o}=s;return[{username:o,id:o,title:o,created:"now"},...n.sort(((e,t)=>e.title.localeCompare(t.title)))]}async function m(e,t){var s;const r=null!==(s=null!=t?t:i.c.user)&&void 0!==s?s:i.c.portal.user;return(await u(r)).find((t=>t.id===e))}function h(e){return{username:e,id:e,title:e,created:"now"}}async function d(e,t){var s;const n=`${c(null!==(s=null!=t?t:i.c.user)&&void 0!==s?s:i.c.portal.user,i.c.portal)}/createFolder`;return await(0,r.r)(n,{title:e},{},"post")}async function p(e,t,s){var n;const o=`${c(null!==(n=null!=s?s:i.c.user)&&void 0!==n?n:i.c.portal.user,i.c.portal)}/${e}/updateFolder`;try{return{result:await(0,r.r)(o,{newTitle:t},{},"post")}}catch(e){return{error:{code:"unhandledError"}}}}}}]);