/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2a3893.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2a3893"],{60049:(e,s,t)=>{t.r(s),t.d(s,{arcgis_smart_mapping_panels_type:()=>d,arcgis_smart_mapping_type_actions_popover:()=>c,arcgis_smart_mapping_type_add_value:()=>p});var l=t(81149),o=t(9225),a=(t(69283),t(49306),t(89)),n=t(81555),i=t(51837),r=t(45449),u=t(95129);t(82218),t(42577),t(70464),t(10519),t(7659);const d=class{constructor(e){(0,l.r)(this,e),this.arcgisSmartMappingPanelsTypeBackClick=(0,l.c)(this,"arcgisSmartMappingPanelsTypeBackClick",7),this.arcgisSmartMappingPanelsTypeClose=(0,l.c)(this,"arcgisSmartMappingPanelsTypeClose",7),this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate=(0,l.c)(this,"arcgisSmartMappingPanelsTypeClusterRequiresUpdate",7),this.arcgisSmartMappingPanelsTypeError=(0,l.c)(this,"arcgisSmartMappingPanelsTypeError",7),this.groupMenuNodes=[],this.groupInputNodes=[],this.groupTextNodes=[],this.valueInputNodes=[],this.valueTextNodes=[],this.symbolNodes=[],this.checkedClasses=[],this.classSortable=[],this.groupSortable=void 0,this.otherSortable=void 0,this.maxCountOtherValues=200,this.symbolStylerOpen=!1,this.dragRenderToggle=!0,this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){var e;const{layer:s,mapView:t,modules:l,strings:a}=o.s,i=s,r=(0,o.h)(i),u=(0,o.g)();o.s.lastDefault={defaultSymbol:r.defaultSymbol||(0,o.S)(i,t),defaultLabel:r.defaultLabel||a.panels.type.other},this.originalRendererJSON=r.toJSON(),this.originalFeatureReduction="featureReduction"in i&&i.featureReduction?l.esriLang.clone(i.featureReduction):void 0,this.originalOrderBy=i.orderBy;try{const s=await(0,n.c)({fieldInfos:[{field:r.field,expression:r.valueExpression,expressionTitle:r.valueExpressionTitle}],typeScheme:(0,o._)()});if((0,o.q)(i)&&"type-size"===u){let a=(null===(e=r.uniqueValueInfos)||void 0===e?void 0:e.length)?r.uniqueValueInfos[0].symbol:(0,o.S)(i,t);"simple-marker"!==a.type&&(a=new l.SimpleMarkerSymbol),s.uniqueValueInfos.map((e=>{const s=l.esriLang.clone(a);(0,o.r)(s,(0,o.t)(e.symbol)),e.symbol=s}))}return o.s.allUniqueValues=s.uniqueValueInfos,Promise.resolve(s)}catch(e){return this.arcgisSmartMappingPanelsTypeError.emit({message:e,type:"error"}),Promise.reject(e)}}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.closePopovers()}render(){var e;const{hideLayerTitle:s,isRTL:t,layer:a,mapImageSublayer:n,strings:r}=o.s,u=s?void 0:null!==(e=null==n?void 0:n.title)&&void 0!==e?e:a.title;return(0,l.h)(l.H,{class:"calcite-match-height"},(0,l.h)("calcite-flow-item",{class:{"flow-item":!0,[i.C.rtl]:t},heading:r.panels.type.styleOptions,closable:(0,o.aa)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,description:u,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsTypeBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualizationContent(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualizationContent(){const{layer:e,strings:s}=o.s,t=!this.hideTransparency||!this.hideRotation,a=(0,o.h)(e),n=(0,o.u)(a.field),i=(null==n?void 0:n.simpleFieldType)===o.w.DATE||"date-only"===(0,o.z)(null==n?void 0:n.layerField);return(0,l.h)("calcite-block",{class:"type-block",heading:i?s.panels.type.typeStyleDate:s.panels.type.typeStyle,collapsible:t,open:!0},this.renderTypesSymbol(),this.renderDrawingOrder(),this.renderGroups(),this.renderBackgroundStyle())}renderTypesSymbol(){var e;const{layer:s,mapView:t,modules:a}=o.s,n=(0,o.h)(s).uniqueValueGroups;if(!(null==n?void 0:n.length)||!(null===(e=n[0].classes)||void 0===e?void 0:e.length))return null;const i=[];n.forEach((e=>e.classes.forEach((e=>i.push(e)))));const r=a.typeSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,o.D)(s)}),u=(0,o.a9)(r,Math.min(i.length,10))[0].colors;let d=(null==i?void 0:i.length)?i.slice(0,10).map(((e,s)=>(0,o.t)(e.symbol)||new a.esriColor(u[s%u.length]))):[];return(0,l.h)("arcgis-smart-mapping-symbol-button",{rampType:"discrete",colors:d,type:"type-ramp",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,l.f)(this.hostElement),this.rotationNode&&(0,l.f)(this.rotationNode)}})}renderDrawingOrder(){const{layer:e,mapImageSublayer:s,strings:t}=o.s;if(s)return null;const a=(0,o.h)(e);return(0,l.h)("calcite-label",{class:"toggle-div",layout:"inline-space-between"},t.panels.type.drawingOrder,(0,l.h)("calcite-switch",{class:"toggle-button",scale:"s",checked:a.orderByClassesEnabled,onCalciteSwitchChange:e=>{const s=e.target;this.handleDrawingOrderToggle(s.checked)}}))}renderGroups(){var e,s;const{layer:t,strings:a}=o.s,n=(0,o.h)(t),i=!(null===(e=n.uniqueValueGroups)||void 0===e?void 0:e.length),u=n.field?null===(s=(0,o.u)(n.field))||void 0===s?void 0:s.label:n.valueExpressionTitle||a.expression,d=i?[this.renderNoGroup()]:n.uniqueValueGroups.map(((e,s)=>this.renderGroup(e,s))),c=this.renderOtherValues();return(0,l.h)("div",{class:"top-padding"},(0,l.h)("calcite-label",null,u),(0,l.h)("div",{key:n.uniqueValueGroups.length,ref:e=>{var s;e&&(0,o.h)(t).uniqueValueGroups.length&&(null===(s=this.groupSortable)||void 0===s||s.destroy(),this.groupSortable=r.S.create(e,{group:{name:"shared",pull:!0,put:!1},dataIdAttr:"group-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortGroups(),handle:".group-handle"}))}},d),(0,l.h)("div",{class:"other",key:`${c.length}${this.dragRenderToggle}`},(0,l.h)("div",{class:d.length?"":"values-items-only"},this.renderDefaultValue()),(0,l.h)("div",{ref:e=>{var s;e&&(null===(s=this.otherSortable)||void 0===s||s.destroy(),this.otherSortable=r.S.create(e,{group:{name:"shared",pull:!1,put:!0},filter:".nodrag",sort:!1}))}},c,this.renderMsg())))}renderNoGroup(){const{strings:e}=o.s;return(0,l.h)("div",{class:"group"},(0,l.h)("div",{class:"group-header"},(0,l.h)("div",{class:"value-part1"},(0,l.h)("div",{class:"group-handle-disabled","aria-hidden":"true"},(0,l.h)("calcite-icon",{scale:"s",icon:"drag"})),(0,l.h)("div",{class:"group-text no-group-heading",role:"button",tabIndex:0,"aria-label":e.panels.type.accessibility.editLabelFor.replace("${value}",e.panels.type.groupNameHint)},e.panels.type.groupNameHint)),(0,l.h)("div",{class:"value-part2"},this.renderGroupMenuNode(-2))),(0,l.h)("div",null,"Â "))}renderGroup(e,s){const t=e.classes.map(((e,t)=>this.renderValue(e,s,t)));return(0,l.h)("div",{key:e.toJSON(),class:"group","group-sort-values":`${s}`},(0,l.h)("div",{class:"group-header"},(0,l.h)("div",{class:"value-part1"},this.renderGroupHandleNode(s),this.renderGroupTextNode(e,s)),(0,l.h)("div",{class:"value-part2"},this.renderGroupCountNode(e),this.renderGroupMenuNode(s,e))),(0,l.h)("div",{ref:e=>{var t,l;e&&(null===(l=null===(t=this.classSortable)||void 0===t?void 0:t[s])||void 0===l||l.destroy(),this.classSortable[s]=r.S.create(e,{group:{name:"nested",pull:!0,put:["nested"]},dataIdAttr:"class-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortClasses(s),handle:".class-handle"}))}},t))}renderGroupHandleNode(e){const{strings:s}=o.s,t=this.selectedValueText===`${e}`;return(0,l.h)("div",{class:t?"group-handle-disabled":"group-handle","aria-hidden":"true",onMouseOver:l=>{const o=l.target;!t&&this.onMouseOver(`values-${e}-handle-tooltip`,o,s.panels.type.tooltips.dragGroup)},onMouseOut:()=>this.onMouseOut(`values-${e}-handle-tooltip`)},(0,l.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderGroupTextNode(e,s){const{strings:t}=o.s;let a=!1;return(0,l.h)(l.F,null,(0,l.h)("calcite-input",{class:"hidden",value:e.heading||"",onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&!a){e.preventDefault(),e.stopPropagation(),a=!0;const t=e.target;this.handleGroupTextChange(s,t.value)}},onFocusout:e=>{if(!a){a=!0;const t=e.target;this.handleGroupTextChange(s,t.value)}},ref:e=>{e&&(this.groupInputNodes[s]=e)}}),(0,l.h)("div",{class:"group-text group-text-active "+(e.heading?"group-heading":"no-group-heading"),role:"button",tabIndex:0,"aria-label":t.panels.type.accessibility.editLabelFor.replace("${value}",e.heading||t.panels.type.groupNameHint),onClick:()=>{this.onMouseOut(`group-${s}-text-tooltip`),this.handleGroupTextClick(s)},onMouseOver:e=>{const l=e.target;this.onMouseOver(`group-${s}-text-tooltip`,l,t.panels.type.tooltips.renameGroup)},onMouseOut:()=>this.onMouseOut(`group-${s}-text-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleGroupTextClick(s))},ref:e=>{e&&(this.groupTextNodes[s]=e)}},e.heading||t.panels.type.groupNameHint))}renderValue(e,s,t){return(0,l.h)("div",{key:`values-${e.label}`,class:"value","class-sort-values":`${s}/${t}`},(0,l.h)("div",{class:"value-part1"},this.renderHandleNode(s,t),this.renderCheckNode(s,t),this.renderSymbolNode(e,s,t),this.renderTextNode(e,s,t)),(0,l.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderHandleNode(e,s){const{strings:t}=o.s,a=this.selectedValueText===`${e}/${s}`;return(0,l.h)("div",{class:a?"class-handle-disabled":"class-handle","aria-hidden":"true",onMouseOver:l=>{const o=l.target;this.onMouseOver(`values-${e}-${s}-handle-tooltip`,o,t.panels.type.tooltips.dragType)},onMouseOut:()=>this.onMouseOut(`values-${e}-${s}-handle-tooltip`)},(0,l.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderCheckNode(e,s,t){const{strings:a}=o.s,n=this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===s));return(0,l.h)("calcite-action",{scale:"s",icon:n?"check-square":"square",text:a.panels.type.checkValue,appearance:"transparent",onClick:t=>{const l=t.currentTarget;this.handleCheck(e,s,l)},onKeyDown:s=>{var l;-1===e&&t&&!s.shiftKey&&"Tab"===s.key&&(null===(l=this.actionsPopoverNode)||void 0===l||l.focusActionPad())},ref:s=>{-1===e&&t&&(this.lastOtherValueCheckNode=s)}})}renderSymbolNode(e,s,t){const{layer:a,strings:n}=o.s,i={"value-symbol":!0,"symbol-is-white":(0,o.aq)(e.symbol)},r={symbol:!0,[(0,o.D)(a)]:!0,"symbol-selector--selected":this.selectedValue===`${s}/${t}`};return(0,l.h)("div",{class:i,onClick:()=>this.handleValueSymbolClick(s,t),role:"button","aria-label":n.panels.type.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":this.selectedValue===`${s}/${t}`,onMouseOver:e=>{const l=e.target;this.onMouseOver(`values-${s}-${t}-icon-tooltip`,l,n.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut(`values-${s}-${t}-icon-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(s,t))}},(0,l.h)("div",{class:r,tabIndex:0,ref:e=>{e&&(this.symbolNodes[s]||(this.symbolNodes[s]=[]),this.symbolNodes[s][t]=e,this.afterCreateValueSymbol(s,t,e))},"aria-hidden":"true"}))}renderTextNode(e,s,t){var a;const{strings:i}=o.s;let r=!1;return(0,l.h)(l.F,null,(0,l.h)("calcite-input",{class:"hidden",value:e.label,onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),!r)){r=!0;const l=e.target;this.handleValueTextChange(s,t,l.value)}},onFocusout:e=>{if(!r){r=!0;const l=e.target;this.handleValueTextChange(s,t,l.value)}},ref:e=>{e&&(this.valueInputNodes[s]||(this.valueInputNodes[s]=[]),this.valueInputNodes[s][t]=e)}}),(0,l.h)("div",{class:"value-text",role:"button",tabIndex:0,"aria-label":i.panels.type.accessibility.editLabelFor.replace("${value}",e.label),onClick:()=>{this.onMouseOut(`value-${s}-${t}-text-tooltip`),this.handleValueTextClick(s,t)},onMouseOver:e=>{const l=e.target;this.onMouseOver(`value-${s}-${t}-text-tooltip`,l,i.panels.type.tooltips.renameType)},onMouseOut:()=>this.onMouseOut(`value-${s}-${t}-text-tooltip`),onKeyDown:e=>{if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleValueTextClick(s,t);else if(!e.shiftKey&&"Tab"===e.key&&-1===s){const{layer:e}=o.s,s=(0,o.h)(e),t=(0,n.g)();let l=0;s.uniqueValueGroups.forEach((e=>l+=e.classes.length)),(null==t?void 0:t.length)&&(1!==t.length||t[0].value)&&l<200||this.actionsPopoverNode.focusActionPad()}},ref:e=>{e&&(-1===s&&-1===t?this.otherTextNode=e:(this.valueTextNodes[s]||(this.valueTextNodes[s]=[]),this.valueTextNodes[s][t]=e))}},(null===(a=e.label)||void 0===a?void 0:a.trim().length)?e.label:"Â Â Â Â Â Â "))}renderCountNode(e){const{allUniqueValues:s,strings:t}=o.s;if(!(null==s?void 0:s.length))return;let a;if(e.values.length>1)a=e.values.reduce(((e,s)=>{var t;return e+(null===(t=this.getUniqueValue(s.value))||void 0===t?void 0:t.count)||0}),0);else{const t=e.values[0].value,l=this.getUniqueValue(t);if(l&&!(0,o.ac)(l.count))return null;if(!l&&(null==s?void 0:s.length)){const e=this.getUniqueValue(s[0].value);if(!(0,o.ac)(null==e?void 0:e.count))return null}a=l?l.count:0}return(0,l.h)("div",{class:"value-count","aria-label":t.panels.type.accessibility.countFor.replace("${value}",e.label)},`${a}`)}renderGroupCountNode(e){const{allUniqueValues:s,strings:t}=o.s;if(!(null==s?void 0:s.length))return;let a=0;return e.classes.forEach((e=>{e.values.forEach((e=>{var t;const l=this.getUniqueValue(e.value);if(!l||(0,o.ac)(l.count)){if(!l&&(null==s?void 0:s.length)){const e=this.getUniqueValue(s[0].value);if(!(0,o.ac)(null==e?void 0:e.count))return}a+=null!==(t=null==l?void 0:l.count)&&void 0!==t?t:0}}))})),(0,l.h)("div",{class:"group-count","aria-label":t.panels.type.accessibility.countFor.replace("${value}",e.heading)},`${s?a:""}`)}renderGroupMenuNode(e,s){const{layer:t,strings:a}=o.s,i=(0,o.h)(t),r=i.uniqueValueGroups;let u,d=!1,c=!1;if(-1===e){u=(0,n.b)();let e=0;i.uniqueValueGroups.forEach((s=>{var t,l;return e+=null!==(l=null===(t=s.classes)||void 0===t?void 0:t.length)&&void 0!==l?l:0})),e+u.length>200&&(u=u.slice(0,200-e)),d=!!u.find(((e,s)=>!this.checkedClasses.find((e=>-1===e.groupIdx&&e.classIdx===s))))}else d=!!(null==s?void 0:s.classes.find(((s,t)=>!this.checkedClasses.find((s=>s.groupIdx===e&&s.classIdx===t))))),c=!!(null==s?void 0:s.classes.find((e=>e.values.length>1)));return(0,l.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:s=>{s&&(this.groupMenuNodes[e]=s)}},(0,l.h)("calcite-action",{slot:"trigger",scale:"s",text:a.panels.type.tooltips.options},(0,l.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,l.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,l.h)("calcite-dropdown-item",{"icon-start":"pin-plus",label:a.panels.type.addValue,onClick:()=>this.handleAddValue(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.handleAddValue(e)}},a.panels.type.addValue),r.length>0&&(0,l.h)("calcite-dropdown-item",{"icon-start":"palette",label:a.panels.type.changeColors,onClick:()=>this.openSymbolStylerForGroup(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.openSymbolStylerForGroup(e)}},a.panels.type.changeColors)),(0,l.h)("calcite-dropdown-group",{"selection-mode":"none"},d&&(0,l.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:a.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.handleSelectAllValues(e)}},a.panels.type.selectAllValues),c&&(0,l.h)("calcite-dropdown-item",{"icon-start":"group-x",label:a.panels.type.separateValues,onClick:()=>this.handleSeparateValues(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.handleSeparateValues(e)}},a.panels.type.separateValues),e>0&&(0,l.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:a.panels.type.moveUp,onClick:()=>this.handleGroupMoveUp(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.handleGroupMoveUp(e)}},a.panels.type.moveUp),r.length>0&&e<r.length-1&&(0,l.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-down",label:a.panels.type.moveDown,onClick:()=>this.handleGroupMoveDown(e),onKeyDown:s=>{s.stopPropagation()," "!==s.key&&"Enter"!==s.key||this.handleGroupMoveDown(e)}},a.panels.type.moveDown)))}renderDefaultValue(){const{layer:e,lastDefault:s,strings:t}=o.s,a=(0,o.h)(e),i=a.defaultSymbol||s.defaultSymbol,r=a.defaultLabel||s.defaultLabel,u=(0,n.g)(),d=u?this.getOtherCount(u):-1;let c=0;a.uniqueValueGroups.forEach((e=>c+=e.classes.length));const p=!!(null==u?void 0:u.length)&&c<200,h=p&&1===u.length&&!u[0].value,g={"value-symbol":!0,"symbol-is-white":(0,o.aq)(i)},v={symbol:!0,[(0,o.D)(e)]:!0,"symbol-selector--selected":"-1"===this.selectedValue};return(0,l.h)("div",{class:"value "+(p?"default-value":"")},(0,l.h)("div",{class:"value-part1"},(0,l.h)("calcite-checkbox",{scale:"s",checked:!!a.defaultSymbol,onMouseOver:e=>{const s=e.target;this.onMouseOver("default-value-checkbox-tooltip",s,t.panels.type.tooltips.otherTooltip)},onMouseOut:()=>this.onMouseOut("default-value-checkbox-tooltip"),onClick:()=>this.handleDefaultCheckChange()}),(0,l.h)("div",{class:g,onClick:()=>this.handleValueSymbolClick(-1,0),role:"button","aria-haspopup":"true","aria-expanded":"-1/0"===this.selectedValue,"aria-label":t.panels.type.accessibility.editSymbolFor.replace("${fieldName}",r),onMouseOver:e=>{const s=e.target;this.onMouseOver("default-value-symbol-tooltip",s,t.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut("default-value-symbol-tooltip"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(-1,0))}},(0,l.h)("div",{class:v,tabIndex:0,ref:e=>{e&&(this.symbolNodes[-1]||(this.symbolNodes[-1]=[]),this.symbolNodes[-1][0]=e,this.afterCreateValueSymbol(-1,0,e))},"aria-hidden":"true"})),this.renderTextNode({symbol:i,label:r},-1,-1)),(0,l.h)("div",{class:"value-part2"},d>-1?(0,l.h)("div",{class:`group-count ${(!p||h)&&"group-count-no-menu"}`,"aria-label":t.panels.type.accessibility.countFor.replace("${value}",r)},`${d}`):null,p&&!h&&this.renderDefaultMenuNode()))}renderDefaultMenuNode(){const{strings:e}=o.s,s=(0,n.b)();return(0,l.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:e=>{e&&(this.groupMenuNodes[-1]=e)}},(0,l.h)("calcite-action",{slot:"trigger",scale:"s",text:e.panels.type.tooltips.options},(0,l.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,l.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,l.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:e.panels.type.moveUp,onClick:()=>this.handleMoveUpAll(s),onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.handleMoveUpAll(s)}},e.panels.type.moveUp)))}renderOtherValues(){const{allUniqueValues:e,layer:s}=o.s,t=(0,o.h)(s);if(!e||!e.length)return null;let l=(0,n.b)(),a=0;return t.uniqueValueGroups.forEach((e=>{var s,t;return a+=null!==(t=null===(s=e.classes)||void 0===s?void 0:s.length)&&void 0!==t?t:0})),a+l.length>200&&(l=l.slice(0,200-a)),l.map(((e,s)=>this.renderOtherValue(e,s,s===l.length-1)))}renderOtherValue(e,s,t){const{strings:a}=o.s;return(0,l.h)("div",{class:"value nodrag",key:e.toJSON()},(0,l.h)("div",{class:"value-part1"},(0,l.h)("div",{class:"value-handle-placeholder"},"Â "),e.values[0].value?this.renderCheckNode(-1,s,t):(0,l.h)("div",{class:"check-placeholder"},"Â "),(0,l.h)("div",{class:"value-text other-value-text","aria-label":e.label},null===e.values[0].value?a.panels.type.noData:e.label)),(0,l.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderMsg(){const{allUniqueValues:e,layer:s,lastDefault:t,strings:a}=o.s,n=(0,o.h)(s);return e&&e.length>this.maxCountOtherValues?(0,l.h)("div",{class:"type-panel-msg"},a.panels.type.errors.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):n.uniqueValueInfos.length||(null==e?void 0:e.length)?null:(0,l.h)("div",{class:"type-panel-msg"},a.panels.type.errors.noFeatures.replace("${other}",t.defaultLabel))}renderBackgroundStyle(){const{mapImageSublayer:e}=o.s;return"type-size"!==(0,o.g)()||e?null:(0,l.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return null;const{layer:e}=o.s,s=(0,o.a)((0,o.h)(e),"opacity");return(0,l.h)("arcgis-smart-mapping-transparency",{open:!!s,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),onKeyDown:e=>{"type"===(0,o.g)()&&e.shiftKey&&"Tab"===e.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>{e&&(this.transparencyNode=e)}})}renderRotation(){if(this.hideRotation)return null;const{layer:e}=o.s,s=(0,o.a)((0,o.h)(e),"opacity"),t=(0,o.a)((0,o.h)(e),"rotation");return(0,l.h)("arcgis-smart-mapping-rotation",{open:!s&&!!t,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),ref:e=>this.rotationNode=e})}renderDoneButton(){const{strings:e}=o.s;return(0,l.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsTypeClose.emit("save"),appearance:"solid",width:"half",onKeyDown:e=>{"type-size"===(0,o.g)()&&e.shiftKey&&"Tab"===e.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>this.doneButtonNode=e},e.done)}renderCancelButton(){const{strings:e}=o.s;return(0,l.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{layer:e}=o.s,s=e,{originalRendererJSON:t,originalFeatureReduction:l,originalOrderBy:a}=this;this.closePopovers(),s.orderBy=a,(0,o.j)(t,l),this.arcgisSmartMappingPanelsTypeClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}addActionsPopover(){this.closePopovers(),this.actionsPopoverNode=document.createElement("arcgis-smart-mapping-type-actions-popover"),this.actionsPopoverNode.referenceNode=this.flowItemNode,this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.groupMenuNodes=this.groupMenuNodes,this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverChange",(e=>{var s;(null===(s=e.detail)||void 0===s?void 0:s.checkedClasses)&&(this.checkedClasses=e.detail.checkedClasses),this.removeActionsPopover(),(0,l.f)(this.hostElement),this.checkCluster()})),this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverFocusExit",(e=>{var s,t;"bottom"===e.detail?"type"===(0,o.g)()?null===(s=this.transparencyNode)||void 0===s||s.setFocus():null===(t=this.doneButtonNode)||void 0===t||t.setFocus():"top"===e.detail&&(this.lastOtherValueCheckNode?this.lastOtherValueCheckNode.setFocus():this.otherTextNode.focus())})),document.body.appendChild(this.actionsPopoverNode)}afterCreateValueSymbol(e,s,t){var l;const{layer:a,lastDefault:n,modules:i}=o.s,r=(0,o.h)(a);let u;for(u=-1===e?r.defaultSymbol||n.defaultSymbol:r.uniqueValueGroups[e].classes[s].symbol.clone();null===(l=null==t?void 0:t.childNodes)||void 0===l?void 0:l.length;)t.removeChild(t.childNodes[0]);u&&i.symbolUtils.renderPreviewHTML(u,{size:(0,o.ar)(u),symbolConfig:"cim"===u.type&&"CIMPolygonSymbol"===u.data.symbol.type?{isSquareFill:!0}:void 0}).then((e=>t.appendChild(e)))}checkCluster(){const{layer:e}=o.s;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate.emit()}closePopovers(){this.removeActionsPopover(),(0,o.E)()}getOtherCount(e){let s=0;return e.map((e=>s+=e.count)),e.length?s:-1}getUniqueValue(e){const{allUniqueValues:s}=o.s;if(!s)return null;const t=s.filter((s=>s.value==e));return t.length?t[0]:null}handleAddValue(e){const s=document.createElement("arcgis-smart-mapping-type-add-value");s.groupIdx=e,s.flowItemNode=this.flowItemNode,s.referenceNode=this.groupMenuNodes[e],s.addEventListener("arcgisSmartMappingTypeAddValuePopoverClose",(()=>{setTimeout((()=>this.groupMenuNodes[e].setFocus()),300),null==s||s.parentElement.removeChild(s)})),s.addEventListener("arcgisSmartMappingTypeAddValuePopoverNewValue",(()=>{this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>this.groupMenuNodes[e].setFocus()),300),null==s||s.parentElement.removeChild(s)})),document.body.appendChild(s)}handleCheck(e,s,t){const o=this.checkedClasses.findIndex((t=>t.groupIdx===e&&t.classIdx===s));o>-1?(this.checkedClasses.splice(o,1),t.icon="square",this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,l.f)(this.actionsPopoverNode),this.checkedClasses.length||this.removeActionsPopover()):(this.checkedClasses=[...this.checkedClasses,{groupIdx:e,classIdx:s}],t.icon="check-square",this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,l.f)(this.actionsPopoverNode)):this.addActionsPopover())}handleDefaultCheckChange(){const{layer:e}=o.s,s=(0,o.h)(e);if(s.defaultSymbol)s.defaultSymbol=void 0,s.defaultLabel=void 0;else{const{lastDefault:e}=o.s;s.defaultSymbol=e.defaultSymbol,s.defaultLabel=e.defaultLabel}this.updateRendererAndUI()}handleDrawingOrderToggle(e){const{layer:s}=o.s,t=s,l=(0,o.h)(t);(0,o.E)(),l.orderByClassesEnabled=e,t.orderBy=e?null:this.originalOrderBy,this.updateRendererAndUI()}handleGroupMoveUp(e){this.closePopovers();const{layer:s}=o.s,t=(0,o.h)(s);if(e>0){const s=t,l=s.uniqueValueGroups,o=l.splice(e,1)[0];l.splice(e-1,0,o),s.uniqueValueGroups=l,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e-1])||void 0===s?void 0:s.setFocus()}),300)}}handleGroupMoveDown(e){this.closePopovers();const{layer:s}=o.s,t=(0,o.h)(s),l=t.uniqueValueGroups;if(e<l.length-1){const s=t,l=s.uniqueValueGroups,o=l.splice(e,1)[0];l.splice(e+1,0,o),s.uniqueValueGroups=l,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e+1])||void 0===s?void 0:s.setFocus()}),300)}}handleGroupTextChange(e,s){var t;const{layer:l}=o.s,a=(0,o.h)(l),n=a.uniqueValueGroups;this.groupInputNodes[e].classList.add("hidden"),(null==s?void 0:s.length)||(null===(t=a.uniqueValueGroups[e].heading)||void 0===t?void 0:t.length)&&(s=a.uniqueValueGroups[e].heading),n[e].heading=s,a.uniqueValueGroups=n,this.selectedValueText=void 0,this.updateRendererAndUI(),this.groupTextNodes[e].classList.remove("hidden"),setTimeout((()=>this.groupTextNodes[e].focus()),300)}handleGroupTextClick(e){this.selectedValueText=`${e}`,this.groupTextNodes[e].classList.add("hidden"),this.groupInputNodes[e].classList.remove("hidden"),this.groupInputNodes[e].setFocus()}handleMoveUpAll(e){e=e.filter((e=>null!==e.values[0].value));const{layer:s,modules:t}=o.s;this.selectedValue=void 0,this.selectedValueText=void 0,this.closePopovers();const l=(0,o.h)(s),a=l.uniqueValueGroups;let i=0;if(a.forEach((e=>{var s,t;return i+=null!==(t=null===(s=e.classes)||void 0===s?void 0:s.length)&&void 0!==t?t:0})),i+e.length>200&&(e.length=200-i),1!==a.length||a[0].heading){const s=new t.UniqueValueGroup({heading:(0,n.d)(a),classes:e});a.push(s)}else a[0].classes=a[0].classes.concat(e);l.uniqueValueGroups=a,this.updateRendererAndUI(),this.checkCluster()}handleSelectAllValues(e){(0,o.E)();const{layer:s}=o.s;(0,o.h)(s).uniqueValueGroups[e].classes.forEach(((s,t)=>{this.checkedClasses.find((s=>s.groupIdx===e&&s.classIdx===t))||this.checkedClasses.push({groupIdx:e,classIdx:t})})),(0,l.f)(this.hostElement),this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,l.f)(this.actionsPopoverNode)):this.addActionsPopover()}handleSeparateValues(e){this.closePopovers(),this.separateGroupValues(e),this.updateRendererAndUI(),this.checkCluster()}handleSortClasses(e){var s;const t=(null===(s=this.classSortable)||void 0===s?void 0:s[e].toArray())||[],{layer:l,modules:a}=o.s,i=(0,o.h)(l);this.closePopovers();const r=(0,n.b)().length;let u=0;i.uniqueValueGroups.forEach((e=>{var s,t;return u+=null!==(t=null===(s=e.classes)||void 0===s?void 0:s.length)&&void 0!==t?t:0}));const d=i.clone().uniqueValueGroups,c=[];d.forEach(((s,l)=>{if(l===e){const e=new a.UniqueValueGroup({heading:s.heading,classes:[]});t.forEach((s=>{const[t,l]=s.split("/").map((e=>parseInt(e)));e.classes.push(d[t].classes[l])})),c.push(e)}else c.push(d[l])})),i.uniqueValueGroups=c.filter((e=>!!e.classes.length));const p=(0,n.b)().length;this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],r===p&&(this.dragRenderToggle=!this.dragRenderToggle),setTimeout((()=>this.updateRendererAndUI()),300),this.checkCluster();let h=0;i.uniqueValueGroups.forEach((e=>{var s,t;return h+=null!==(t=null===(s=e.classes)||void 0===s?void 0:s.length)&&void 0!==t?t:0})),u!==h&&this.checkCluster()}handleSortGroups(){const e=this.groupSortable?this.groupSortable.toArray():[],{layer:s}=o.s,t=(0,o.h)(s);this.closePopovers();const a=t.uniqueValueGroups,n=[];e.forEach((e=>{n.push(a[parseInt(e)])})),t.uniqueValueGroups=n,this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],(0,l.f)(this.hostElement)}handleValueSymbolClick(e,s){if(this.symbolNodes[e][s].classList.remove("symbol-selector--selected"),this.symbolStylerOpen)this.selectedValue=void 0,this.selectedValueText=void 0,(0,o.E)(),this.symbolStylerOpen=!1;else{const t=`${e}/${s}`;this.selectedValue=this.selectedValue!==t?t:void 0,this.selectedValueText=void 0,(0,o.ac)(this.selectedValue)?this.openSymbolStylerForValue(e,s):(this.symbolNodes[e][s].classList.remove("symbol-selector--selected"),(0,o.E)(),this.symbolStylerOpen=!1)}}handleValueTextChange(e,s,t){var l;const{allUniqueValues:a,lastDefault:i,layer:r,modules:u,strings:d}=o.s,c=r,p=(0,o.h)(c),h=p.uniqueValueGroups;if(this.valueInputNodes[e][s].classList.add("hidden"),(null===(l=h[e])||void 0===l?void 0:l.classes[s].label)!==t){if(!(null==t?void 0:t.length))if(-1===e)t=this.originalRendererJSON.defaultLabel||d.panels.type.other;else{let l=a.find((t=>t.value===p.uniqueValueGroups[e].classes[s].values[0].value));t=(null==l?void 0:l.label)||p.uniqueValueGroups[e].classes[s].label}if(-1!==e||p.defaultSymbol||(i.defaultLabel=t),-1===e)p.defaultSymbol&&(p.defaultLabel=t||i.defaultLabel);else{const l=p.uniqueValueGroups,i=(0,o.u)(p.field);if(t)l[e].classes[s].label=t;else{const t=l[e].classes[s].values.map((e=>{var s;const t=e.value;return(null===(s=null==a?void 0:a.find((e=>e.value===t)))||void 0===s?void 0:s.label)||((null==i?void 0:i.simpleFieldType)===o.w.DATE||"date-only"===(0,o.z)(null==i?void 0:i.layerField)?(0,n.e)(t,i):(null==i?void 0:i.simpleFieldType)===o.w.NUMBER?u.intl.formatNumber(t):t)}));l[e].classes[s].label=t.join(", ")}p.uniqueValueGroups=l}}this.selectedValueText=void 0,this.updateRendererAndUI(),setTimeout((()=>{const t=-1===e&&-1===s?this.otherTextNode:this.valueTextNodes[e][s];t.classList.remove("hidden"),t.focus()}))}handleValueTextClick(e,s){var t,l;this.selectedValueText=`${e}/${s}`,(-1===e&&-1===s?this.otherTextNode:this.valueTextNodes[e][s]).classList.add("hidden"),null===(t=this.valueInputNodes[e][s])||void 0===t||t.classList.remove("hidden"),null===(l=this.valueInputNodes[e][s])||void 0===l||l.setFocus()}onMouseOver(e,s,t){(0,o.ae)(),(0,o.aF)(s,t,e)}onMouseOut(e){(0,o.aG)(e)}openSymbolStylerForGroup(e){const{strings:s}=o.s;(0,o.E)();const t=(0,a.c)({referenceElement:this.flowItemNode,heading:s.panels.type.symbolStyle});t.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,a.r)(t),this.selectedValue=void 0,this.selectedValueText=void 0,setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e])||void 0===s?void 0:s.setFocus()}),300)})),t.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{this.selectedValue=void 0,this.selectedValueText=void 0,(0,a.r)(t),setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e])||void 0===s?void 0:s.setFocus()}),300)})),(0,a.e)({groupIdx:e,popoverNode:t,onChange:()=>{this.updateRendererAndUI()}})}openSymbolStylerForValue(e,s){const{strings:t}=o.s;(0,o.E)();const n=(0,a.c)({referenceElement:this.flowItemNode,heading:t.panels.type.symbolStyle});n.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{let t=this.symbolNodes[e][s];this.selectedValue=void 0,this.selectedValueText=void 0,(0,a.r)(n),setTimeout((()=>{t.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,t.focus()}),300)})),n.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{let t=this.symbolNodes[e][s];this.selectedValue=void 0,this.selectedValueText=void 0,(0,a.r)(n),setTimeout((()=>{t.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,t.focus()}),300)})),(0,a.f)({selectedValue:this.selectedValue,popoverNode:n,onChange:()=>{this.updateRendererAndUI(),this.rotationNode&&(0,l.f)(this.rotationNode)}}),this.symbolStylerOpen=!0,this.symbolNodes[e][s].classList.add("symbol-selector--selected")}removeActionsPopover(){var e,s;null===(s=null===(e=this.actionsPopoverNode)||void 0===e?void 0:e.parentElement)||void 0===s||s.removeChild(this.actionsPopoverNode),this.actionsPopoverNode=null}separateGroupValues(e){const{layer:s}=o.s,t=(0,o.h)(s).uniqueValueGroups;(0,n.f)(t[e]),this.checkedClasses=[]}updateRendererAndUI(){(0,o.ab)(),(0,l.f)(this.hostElement)}get hostElement(){return(0,l.d)(this)}};d.style=":host{width:100%}.flow-item{height:100%}.hidden{display:none}.type-block{overflow-x:hidden}.check-placeholder{width:32px;height:24px}.type-panel-msg{font-size:80%;margin:5px}.toggle-button{margin-top:2px}.toggle-div{padding-top:6px}.top-padding{padding-top:10px}.symbol-selector{background-color:rgb(255, 255, 255);display:flex;padding:9px 9px;justify-content:space-between;align-items:center;border-radius:3px;cursor:pointer;transition:box-shadow 250ms ease-in-out;box-shadow:0 0 0 1px #e0e0e0}.symbol-selector :last-child{margin-bottom:0}.symbol-selector :last-child svg{fill:#c0c0c0}.symbol-selector :hover{box-shadow:0 0 0 1px #c0c0c0}.symbol-selector :hover svg{fill:#404040}.symbol-selector--selected,.symbol-selector--selected:hover{outline:1px solid var(--calcite-color-brand)}.symbol-selector--selected svg,.symbol-selector--selected:hover svg{fill:#404040}.symbol-is-white{background-color:#f3f3f3}.symbol-icon{min-width:26px;display:flex}.symbol-icon div{margin:auto}.symbol-icon.transparent{height:15px;width:100%}.symbol-icon.transparent svg{height:15px;width:95%;stroke:#e0e0e0;stroke-width:1px}.group-header{display:flex;padding:6px 0;justify-content:space-between;align-items:center;border-bottom:1px solid #e0e0e0}.group-heading{font-weight:bold}.no-group-heading{color:rgba(50, 50, 50, 0.4);font-style:italic}.group{border:1px solid #e0e0e0;margin:5px 0}.group-text{padding:3px 9px 0 9px;word-break:break-all}.group-text-active{cursor:pointer}.group-count{padding-top:7px}.group-count-no-menu{padding-right:3px}.values-items-only{padding:6px 6px}.value{display:flex;padding:6px 0;justify-content:space-between;align-items:center}.value-part1{display:flex;width:-webkit-fill-available;width:-moz-available;align-items:center;margin:0 5px}.value-part2{display:flex}.group-handle,.class-handle{color:rgba(50, 50, 50, 0.4);cursor:grab;width:16px;display:flex}.group-handle-disabled,.class-handle-disabled{color:#e0e0e0;width:16px;display:flex}.value-symbol{margin:0 5px;padding:4px;cursor:pointer}.value-text{padding:0 9px;word-break:break-all;cursor:pointer}.value-count{padding:3px 3px 0 3px}.menu-placeholder{width:32px}.value-handle-placeholder{min-width:16px}.other{border:1px solid #e0e0e0}.default-value{border-bottom:1px solid #e0e0e0}.other-value-text{cursor:default}.symbol-styler-panel{width:328px;min-height:300px}.symbol-styler-div{width:100%}.avatar{background-color:#f0efef}.value-text:focus,.group-text:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}";const c=class{constructor(e){(0,l.r)(this,e),this.arcgisSmartMappingTypeActionsPopoverChange=(0,l.c)(this,"arcgisSmartMappingTypeActionsPopoverChange",7),this.arcgisSmartMappingTypeActionsPopoverFocusExit=(0,l.c)(this,"arcgisSmartMappingTypeActionsPopoverFocusExit",7),this.checkedClasses=void 0,this.groupMenuNodes=void 0,this.referenceNode=void 0,this.showMoveToGroup=!1}componentWillLoad(){this.topActionHandler=e=>{e.shiftKey&&"Tab"===e.key&&this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("top")}}componentDidRender(){var e,s;const t=((null===(e=this.moveUpNode)||void 0===e?void 0:e.disabled)?void 0:this.moveUpNode)||((null===(s=this.moveDownNode)||void 0===s?void 0:s.disabled)?void 0:this.moveDownNode)||this.mergeNode||this.separateNode||this.moveToGroupNode;null==t||t.removeEventListener("keydown",this.topActionHandler),t.addEventListener("keydown",this.topActionHandler)}async focusActionPad(){var e;null===(e=this.actionPadNode)||void 0===e||e.setFocus()}async focusLastAction(){if(this.actionPadNode){let e=Array.from(this.actionPadNode.querySelectorAll("calcite-action")).filter((e=>!1===e.disabled));e[e.length-1].setFocus()}}render(){var e,s;const{strings:t}=o.s;if(!(null===(e=this.checkedClasses)||void 0===e?void 0:e.length))return null;const a=null===(s=this.referenceNode)||void 0===s?void 0:s.getBoundingClientRect();return(0,l.h)(l.H,null,(0,l.h)("calcite-popover",{class:"js-app-flyout",placement:"leading-start",offsetDistance:10,offsetSkidding:(a.height-120)/4+70,pointerDisabled:!0,label:t.panels.type.typeActions,triggerDisabled:!0,referenceElement:this.referenceNode,open:!0,ref:e=>this.popoverNode=e},this.showMoveToGroup?this.renderMoveToGroup():this.renderActions()))}renderActions(){return(0,l.h)("calcite-action-pad",{layout:"vertical",position:"start",expanded:!0,expandDisabled:!0,ref:e=>{e&&(this.actionPadNode=e)}},this.renderGroup1(),this.renderGroup2(),this.renderGroup3())}renderMoveToGroup(){if(!this.showMoveToGroup)return null;const{layer:e,strings:s}=o.s,t=(0,o.h)(e),a=t.uniqueValueGroups,n=!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx,i=a.map(((e,s)=>this.renderMoveToGroupListItem(e,s)));return(0,l.h)("calcite-panel",{heading:s.panels.type.moveToGroup,closable:!0,onCalcitePanelClose:()=>{this.showMoveToGroup=!1,(0,l.f)(this.hostElement),setTimeout((()=>this.moveToGroupNode.setFocus()),300)},ref:e=>null==e?void 0:e.setFocus()},(0,l.h)("calcite-list",{filterEnabled:a.length>=10,filterPlaceholder:s.panels.type.searchGroups,label:s.panels.type.selectGroup,selectionMode:"single"},i,!t.uniqueValueGroups.length&&(0,l.h)("calcite-list-item",{label:s.panels.type.untitledGroup,onCalciteListItemSelect:()=>this.moveToNewGroup(!0)}),(0,l.h)("calcite-list-item",{label:t.defaultLabel||s.panels.type.other,value:-1,disabled:-1===n,onCalciteListItemSelect:()=>{this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(a[e.groupIdx].classes.splice(e.classIdx,1),a[e.groupIdx].classes.length||a.splice(e.groupIdx,1))})),this.checkedClasses=[],t.uniqueValueGroups=a,(0,o.ab)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[-1])||void 0===e?void 0:e.setFocus()}),300)}})),(0,l.h)("calcite-button",{appearance:"outline",label:s.cancel,innerHTML:s.cancel,width:"full",slot:"footer",onClick:()=>{this.showMoveToGroup=!1,(0,l.f)(this.hostElement),setTimeout((()=>this.moveToGroupNode.setFocus()),300)}}))}renderMoveToGroupListItem(e,s){const{layer:t,strings:a}=o.s,i=(0,o.h)(t),r=i.uniqueValueGroups,u=!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx;return(0,l.h)("calcite-list-item",{label:e.heading||a.panels.type.untitledGroup,value:s,disabled:u===s,onCalciteListItemSelect:e=>{const s=e.target.value;let t=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>r[e.groupIdx].classes[e.classIdx]));const l=(0,n.b)();t=t.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>l[e.classIdx])));const a=r[s];a.classes=a.classes.concat(t),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(r[e.groupIdx].classes.splice(e.classIdx,1),r[e.groupIdx].classes.length||r.splice(e.groupIdx,1))})),this.checkedClasses=[],i.uniqueValueGroups=r,(0,o.ab)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[s])||void 0===e?void 0:e.setFocus()}),300)}})}renderGroup1(){var e;const{layer:s,strings:t}=o.s,a=(0,o.h)(s).uniqueValueGroups,n=this.checkedClasses.map((e=>e.classIdx)),i=n.length,r=null===(e=a[this.checkedClasses[0].groupIdx])||void 0===e?void 0:e.classes.length;n.sort(((e,s)=>e-s));const u=n[0]>0||!!n.find(((e,s)=>s>0&&e-1>n[s-1])),d=n[i-1]<r-1||!!n.find(((e,s)=>s<i-1&&e+1<n[s+1]));return(0,l.h)("calcite-action-group",null,(0,l.h)("calcite-action",{text:t.panels.type.moveUp,textEnabled:!0,disabled:!u,icon:"arrow-bold-up",onClick:()=>this.moveUp(),ref:e=>this.moveUpNode=e}),(0,l.h)("calcite-action",{text:t.panels.type.moveDown,textEnabled:!0,disabled:!d,icon:"arrow-bold-down",onClick:()=>this.moveDown(),ref:e=>this.moveDownNode=e}))}renderGroup2(){const{layer:e,strings:s}=o.s,t=(0,o.h)(e).uniqueValueGroups,a=!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx)),n=!!this.checkedClasses.find((e=>-1!==e.groupIdx))&&this.checkedClasses.length>1,i=!!this.checkedClasses.find((e=>-1!==e.groupIdx&&t[e.groupIdx].classes[e.classIdx].values.length>1)),r=!a&&-1!==this.checkedClasses[0].groupIdx&&this.checkedClasses.length===t[this.checkedClasses[0].groupIdx].classes.length;return(0,l.h)("calcite-action-group",null,n&&(0,l.h)("calcite-action",{text:s.panels.type.mergeValues,textEnabled:!0,onClick:()=>this.mergeValues(),ref:e=>this.mergeNode=e}),i&&(0,l.h)("calcite-action",{text:s.panels.type.separateValues,textEnabled:!0,onClick:()=>this.separateSelectedValues(),ref:e=>this.separateNode=e}),(0,l.h)("calcite-action",{text:s.panels.type.moveToGroup,textEnabled:!0,onClick:()=>this.moveToGroup(),ref:e=>{e&&(this.moveToGroupNode=e)}}),(0,l.h)("calcite-action",{text:s.panels.type.newGroup,textEnabled:!0,disabled:r,onClick:()=>this.moveToNewGroup(),ref:e=>this.moveToNewGroupNode=e}))}renderGroup3(){const{strings:e}=o.s;return(0,l.h)("calcite-action-group",null,(0,l.h)("calcite-action",{text:e.panels.type.clearSelection,textEnabled:!0,onClick:()=>this.clearSelection(),onKeyDown:e=>{e.shiftKey||"Tab"!==e.key||this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("bottom")}}))}clearSelection(){let e=-1;this.checkedClasses.forEach((s=>e=-1===s.groupIdx?e:-1===e?s.groupIdx:Math.min(e,s.groupIdx))),this.checkedClasses=[],this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var s;return null===(s=this.groupMenuNodes[e])||void 0===s?void 0:s.setFocus()}),300)}mergeValues(){const{layer:e}=o.s,s=(0,o.h)(e),t=s.uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:-1===e.groupIdx||-1===s.groupIdx?s.groupIdx-e.groupIdx:e.groupIdx-s.groupIdx));const l=t[this.checkedClasses[0].groupIdx].classes[this.checkedClasses[0].classIdx],a=(0,n.b)();this.checkedClasses.forEach(((e,s)=>{if(s>0){const s=-1===e.groupIdx?a[e.classIdx]:t[e.groupIdx].classes[e.classIdx];l.values=l.values.concat(s.values),l.label+=`, ${s.label}`}}));const i=[];t.forEach(((e,s)=>{const t=[];e.classes.forEach(((e,o)=>{this.checkedClasses[0].groupIdx===s&&this.checkedClasses[0].classIdx===o?t.push(l):this.checkedClasses.find((e=>e.groupIdx===s&&e.classIdx===o))||t.push(e)})),t.length&&(e.classes=t,i.push(e))})),s.uniqueValueGroups=i,this.checkedClasses=[],(0,o.ab)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}moveDown(){const{layer:e,modules:s}=o.s,t=(0,o.h)(e),l=t.uniqueValueGroups,a=l[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx));const n=s.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx<a.classes.length-1&&(0===s||s>0&&n[s-1].classIdx!==e.classIdx+1)){const t=a.classes.splice(e.classIdx,1)[0];a.classes.splice(e.classIdx+1,0,t),n[s].classIdx=e.classIdx+1}})),this.checkedClasses=n,t.uniqueValueGroups=l,(0,o.ab)(),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.moveDownNode.disabled?this.moveUpNode.setFocus():this.moveDownNode.setFocus()}),300)}moveToGroup(){this.showMoveToGroup=!0}moveToNewGroup(e=!1){const{layer:s,modules:t}=o.s,l=(0,o.h)(s),a=l.uniqueValueGroups;let i=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>a[e.groupIdx].classes[e.classIdx]));const r=(0,n.b)();i=i.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>r[e.classIdx])));const u=new t.UniqueValueGroup({heading:e?null:(0,n.d)(a),classes:i});a.push(u),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(a[e.groupIdx].classes.splice(e.classIdx,1),a[e.groupIdx].classes.length||a.splice(e.groupIdx,1))})),this.checkedClasses=[],l.uniqueValueGroups=a,(0,o.ab)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{var e;return null===(e=this.groupMenuNodes[a.length-1])||void 0===e?void 0:e.setFocus()}),300)}moveUp(){const{layer:e,modules:s}=o.s,t=(0,o.h)(e),l=t.uniqueValueGroups,a=l[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const n=s.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx>0&&(0===s||s>0&&n[s-1].classIdx!==e.classIdx-1)){const t=a.classes.splice(e.classIdx,1)[0];a.classes.splice(e.classIdx-1,0,t),n[s].classIdx=e.classIdx-1}})),this.checkedClasses=n,t.uniqueValueGroups=l,(0,o.ab)(),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.moveUpNode.disabled?this.moveDownNode.setFocus():this.moveUpNode.setFocus()}),300)}separateSelectedValues(){const{layer:e}=o.s,s=(0,o.h)(e).uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const t=[];let l=-2,a=[];this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(l!==e.groupIdx?(-2!==l&&t.push({groupIdx:l,classIdxs:a}),l=e.groupIdx,a=[e.classIdx]):a.push(e.classIdx))})),-2!==l&&t.push({groupIdx:l,classIdxs:a}),t.forEach((e=>(0,n.f)(s[e.groupIdx],e.classIdxs))),this.checkedClasses=[],(0,o.ab)(),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}get hostElement(){return(0,l.d)(this)}},p=class{constructor(e){(0,l.r)(this,e),this.arcgisSmartMappingTypeAddValuePopoverClose=(0,l.c)(this,"arcgisSmartMappingTypeAddValuePopoverClose",7),this.arcgisSmartMappingTypeAddValuePopoverNewValue=(0,l.c)(this,"arcgisSmartMappingTypeAddValuePopoverNewValue",7),this.userTouchedLabel=!1,this.flowItemNode=void 0,this.referenceNode=void 0,this.groupIdx=void 0}componentWillLoad(){var e,s;const{allUniqueValues:t,layer:l}=o.s,a=(0,o.h)(l);this.allValues=null==t?void 0:t.map((e=>""+e.value)),a.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{var s;const t=null===(s=e.values)||void 0===s?void 0:s[0].value;-1===this.allValues.indexOf(""+t)&&this.allValues.push(""+t)}))})),this.field=(0,o.u)(a.field),this.isDate=(null===(e=this.field)||void 0===e?void 0:e.simpleFieldType)===o.w.DATE,this.isNumber=(null===(s=this.field)||void 0===s?void 0:s.simpleFieldType)===o.w.NUMBER,this.isInt=this.field&&["small-integer","integer","long"].indexOf((0,o.z)(this.field.layerField))>-1}componentDidLoad(){var e;null===(e=this.panelNode)||void 0===e||e.setFocus()}render(){const{strings:e}=o.s;return(0,l.h)(l.H,null,(0,l.h)("calcite-popover",{referenceElement:this.referenceNode,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,label:e.panels.type.addValue,open:!0,ref:e=>this.popoverNode=e},this.renderContent()))}renderContent(){var e;const{strings:s}=o.s,t=null===(e=this.flowItemNode)||void 0===e?void 0:e.getBoundingClientRect().width;return(0,l.h)("calcite-panel",{heading:s.panels.type.addValue,closable:!0,onCalcitePanelClose:()=>this.arcgisSmartMappingTypeAddValuePopoverClose.emit(),ref:e=>this.panelNode=e},(0,l.h)("div",{ref:e=>{e&&(e.style.padding="15px",e.style.width=`${t?t+20:280}px`)}},this.renderValueInput(),this.renderLabelInput()),this.renderDoneButton())}renderValueInput(){const{strings:e}=o.s,{isDate:s,isInt:t,isNumber:a}=this;return(0,l.h)("calcite-label",{scale:"s"},e.panels.type.value,s?(0,l.h)("calcite-input-date-picker",{scale:"s",overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>{const s=e.target;this.handleAddDate(s.value)}}):a?(0,l.h)("calcite-input-number",{step:t?1:"any",scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputNumberInput:e=>{const s=e.target;this.handleAddNumber(s.value)}}):(0,l.h)("calcite-input",{scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputInput:()=>this.handleAddString(this.valueInputNode.value),ref:e=>{e&&(this.valueInputNode=e)}}),(0,l.h)("calcite-input-message",{hidden:!0,icon:"exclamation-mark-triangle",status:"invalid",ref:e=>this.valueInputMessageNode=e},e.panels.type.valueNotUnique))}renderLabelInput(){const{strings:e}=o.s;return(0,l.h)("calcite-label",{scale:"s"},e.panels.type.label,(0,l.h)("calcite-input",{type:"text",value:"",scale:"s",placeholder:e.panels.type.displayedValue,label:e.panels.type.label,onCalciteInputInput:()=>{this.userTouchedLabel=!0},ref:e=>this.labelInputNode=e}))}renderDoneButton(){const{locale:e,mapView:s,modules:t,strings:a}=o.s,{field:i,isDate:r,isInt:d,isNumber:c}=this;return(0,l.h)("calcite-button",{appearance:"solid",label:a.done,width:"full",slot:"footer",disabled:!0,onClick:()=>{this.popoverNode.open=!1;const l=this.valueInputNode.value;let o,a;r?(a=(0,u.d)(l,s.timeZone),t.intl.setLocale(e),o=this.labelInputNode.value||(0,n.e)(a,i)):c?(a=d?parseInt(l):parseFloat(l),o=this.labelInputNode.value||t.intl.formatNumber(a)):(o=this.labelInputNode.value||l,a=l),this.addValue(o,a)},ref:e=>this.doneButtonNode=e},a.done)}addValue(e,s){var t;const{layer:l,mapView:a,modules:n}=o.s,i=(0,o.h)(l),r=n.esriLang.clone((null===(t=i.uniqueValueInfos.find((e=>{var s;return["simple-marker","simple-line","simple-fill","cim"].indexOf(null===(s=e.symbol)||void 0===s?void 0:s.type)>-1})))||void 0===t?void 0:t.symbol)||(0,o.S)(l,a,(0,o.g)())),u=(0,o._)();if(u){const e=u.colors[i.uniqueValueInfos.length%u.colors.length];e&&(0,o.r)(r,e)}else{const e=(0,o.$)().colors,s=new n.esriColor(e[i.uniqueValueInfos.length%10]);s&&(0,o.r)(r,s)}let d=i.uniqueValueGroups;-2===this.groupIdx&&(d=[new n.UniqueValueGroup({heading:void 0,classes:[]})],this.groupIdx=0),d[this.groupIdx].classes.push(new n.UniqueValueClass({values:[new n.UniqueValue({value:s})],label:e,symbol:r})),i.uniqueValueGroups=d,this.arcgisSmartMappingTypeAddValuePopoverNewValue.emit()}handleAddDate(e){const{allUniqueValues:s,mapView:t,layer:l}=o.s,a=(0,o.h)(l),i=null==s?void 0:s.map((e=>""+e.value));a.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{var s;const t=null===(s=e.values)||void 0===s?void 0:s[0].value;-1===i.indexOf(""+t)&&i.push(""+t)}))}));const r=(0,o.u)(a.field);if(!this.userTouchedLabel){const s=(0,u.d)(e,t.timeZone);this.labelInputNode.value=(0,n.e)(s,r)}this.valueInputMessageNode.hidden=-1===i.indexOf(e),this.doneButtonNode.disabled=!e.length||i.indexOf(e)>-1}handleAddNumber(e){const{modules:s}=o.s;if(e.length&&this.isInt){let s=""+Math.round(parseFloat(e));s.indexOf(".")>-1&&(s=s.substring(0,s.indexOf("."))),s!==e&&(e=s)}if(!this.userTouchedLabel){const t=this.isInt?parseInt(e):parseFloat(e);this.labelInputNode.value=s.intl.formatNumber(t)}this.valueInputMessageNode.hidden=-1===this.allValues.indexOf(e),this.doneButtonNode.disabled=!e.length||this.allValues.indexOf(e)>-1}handleAddString(e){this.userTouchedLabel||(this.labelInputNode.value=e),this.valueInputMessageNode.hidden=-1===this.allValues.indexOf(e),this.doneButtonNode.disabled=!e.length||this.allValues.indexOf(e)>-1}get hostElement(){return(0,l.d)(this)}}},95129:(e,s,t)=>{t.d(s,{a:()=>o,b:()=>n,d:()=>i,u:()=>a});var l=t(9225);function o(e,s){e.labelFormatFunction=e=>r(e,s,"short-date"),e.inputFormatFunction=e=>r(e,s,"short-date"),e.inputParseFunction=e=>function(e,s){if(!e)return e;let t;if(s&&"system"!==s)if("unknown"===s)t=e;else{const l=new Date;t=e+(new Date(l.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(l.toLocaleString("en-US",{timeZone:s})).getTime())}else t=e+6e4*(new Date).getTimezoneOffset();return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(t).toISOString()),t}(Date.parse(e),s)}function a(e,s){let t;if(s&&"system"!==s)if("unknown"===s)t=new Date(e).toISOString();else{const l=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:s});t=new Date(new Date(o).getTime()-6e4*l).toISOString()}else{const s=(new Date).getTimezoneOffset();t=new Date(e-6e4*s).toISOString()}return t}function n(e,s,t){let l;if(s&&"system"!==s)if("unknown"===s)l=new Date(e).toISOString();else{const t=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:s});l=new Date(new Date(o).getTime()-6e4*t).toISOString()}else{const s=(new Date).getTimezoneOffset();l=new Date(e-6e4*s).toISOString()}return l=t?l.substring(11,19):l.substring(11,16),l}function i(e,s){let t,l=new Date(e);if(l=new Date(l.getTime()-6e4*l.getTimezoneOffset()),s&&"system"!==s)if("unknown"===s)t=l.getTime();else{const e=new Date(l.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(l.toLocaleString("en-US",{timeZone:s})).getTime();t=l.getTime()+e}else t=l.getTime()+6e4*l.getTimezoneOffset();return t}function r(e,s,t){const{modules:o}=l.s;let a;return a="unknown"===s?o.intl.formatDate(e,Object.assign(Object.assign({},o.intl.convertDateFormatToIntlOptions(t||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):o.intl.formatDate(e,Object.assign(Object.assign({},o.intl.convertDateFormatToIntlOptions(t||"short-date-short-time")),{timeZone:s})),a}t(69283),t(49306)},81555:(e,s,t)=>{t.d(s,{a:()=>n,b:()=>u,c:()=>a,d:()=>c,e:()=>r,f:()=>h,g:()=>d,s:()=>p});var l=t(9225),o=(t(69283),t(10519));function a(e){var s;const{layer:t,mapImageSublayer:a,mapView:n,modules:i}=l.s,r=t;e=e||{};const u=(0,l.m)((0,l.h)(r)),d=e.fieldInfos[0];return i.TypeCreator.createRenderer({layer:r,view:n,field:d.field,valueExpression:d.expression,valueExpressionTitle:d.expressionTitle,numTypes:e.numTypes||10,sortBy:e.sortBy||"count",typeScheme:e.typeScheme||(0,l._)(),returnAllCodedValues:!0,outlineOptimizationEnabled:!a&&(!(0,o.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!a&&(!(0,o.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!0,forBinning:"binning"===(null===(s=r.featureReduction)||void 0===s?void 0:s.type)}).then((s=>{if(s.excludedUniqueValueInfos.length||(s.renderer.defaultLabel=null,s.renderer.defaultSymbol=null),p(e)){const e=(0,l.h)(r).clone(),t=(0,l.a)(e,"size","auto"),o=(0,l.a)(e,"size","outline");if(s.renderer.visualVariables=[],t&&(s.renderer.visualVariables=s.renderer.visualVariables||[],s.renderer.visualVariables.push(t)),o&&(s.renderer.visualVariables=s.renderer.visualVariables||[],s.renderer.visualVariables.push(o)),s.renderer.uniqueValueInfos=e.uniqueValueInfos,s.renderer.field2=e.field2,s.renderer.field3=e.field3,(0,l.q)(r)&&"type-size"===(0,l.g)()){const e=(0,l.S)(r,n),t=s.renderer.uniqueValueInfos.slice();t.map((s=>{const t=(0,l.t)(s.symbol);s.symbol=e.clone(),(0,l.r)(s.symbol,t)})),s.renderer.uniqueValueInfos=t}}return(0,l.l)(u,s.renderer),Promise.resolve(s)}),(e=>Promise.reject(e)))}function n(e){var s;const{layer:t,mapImageSublayer:a,mapView:n,modules:i}=l.s,r=t;let u=(e=e||[]).fieldInfos?e.fieldInfos[0]:null;const d=(0,l.h)(r),c=(0,l.m)(d),p=d.uniqueValueInfos&&d.uniqueValueInfos.length?d.uniqueValueInfos[0].symbol:null,h=d.defaultSymbol,g=d.defaultLabel,v=u&&(u.field!=d.field||u.expression!=d.valueExpression);return e=e||{},i.TypeCreator.createRenderer({layer:r,view:n,field:u?u.field:d.field,valueExpression:u?u.expression:d.valueExpression,valueExpressionTitle:u?u.expressionTitle:d.valueExpressionTitle,numTypes:e.numTypes||(v?10:d.uniqueValueInfos.length),sortBy:e.sortBy||"count",typeScheme:(0,l._)(),outlineOptimizationEnabled:!a&&((0,o.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!c.sizeOutlineVisVar),sizeOptimizationEnabled:!a&&((0,o.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!c.sizeAutoVisVar),legendOptions:e.legendOptions||d.legendOptions,defaultSymbolEnabled:(0,o.i)(e.defaultSymbolEnabled)||!!d.defaultSymbol,forBinning:"binning"===(null===(s=r.featureReduction)||void 0===s?void 0:s.type)}).then((e=>{if((0,l.l)(c,e.renderer),p&&e.renderer.uniqueValueInfos&&e.renderer.uniqueValueInfos.length){const s=e.renderer.uniqueValueInfos.slice();s.map((e=>{const s=p.clone();(0,l.r)(s,(0,l.t)(e.symbol)),e.symbol=s})),e.renderer.uniqueValueInfos=s}return h&&(e.renderer.defaultSymbol=h,e.renderer.defaultLabel=g),Promise.resolve(e)}),(e=>Promise.reject(e)))}const i={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function r(e,s){const{allUniqueValues:t,locale:o,mapView:a,modules:n}=l.s;if(n.intl.setLocale(o),(null==s?void 0:s.simpleFieldType)===l.w.DATE){const s=t&&n.rendererSupportUtils.calculateDateFormatInterval(t.map((e=>e.value)));return"unknown"===a.timeZone?n.intl.formatDate(e,Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions(s?i[s]:"long-month-day-year")),{timeZone:"utc",timeZoneName:"shortOffset"})):n.intl.formatDate(e,Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions(s?i[s]:"long-month-day-year")),{timeZone:a.timeZone}))}return n.intl.formatDateOnly(e,n.intl.convertDateFormatToIntlOptions("long-month-day-year"))}function u(){const{allUniqueValues:e,layer:s,modules:t}=l.s,a=(0,l.h)(s);if(!(null==e?void 0:e.length)||!(0,o.i)(e[0].count))return[];let n=[];return a.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push(`${e.value}`))))),n=n.concat(s)})),e.filter((e=>-1===n.indexOf(`${e.value}`))).map((e=>new t.UniqueValueClass({label:e.label,symbol:e.symbol,values:[{value:e.value}]})))}function d(){const{allUniqueValues:e,layer:s}=l.s,t=(0,l.h)(s);if(!(null==e?void 0:e.length)||!(0,o.i)(e[0].count))return[];let a=[];return t.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push(`${e.value}`))))),a=a.concat(s)})),e.filter((e=>-1===a.indexOf(`${e.value}`)))}function c(e){const{strings:s}=l.s;let t=1,o=s.panels.type.defaultGroupName.replace("${number}",t.toString());for(;e.find((e=>e.heading===o));)o=s.panels.type.defaultGroupName.replace("${number}",(++t).toString());return o}function p(e){const{layer:s}=l.s;if(["type","type-size"].indexOf((0,l.g)())>-1){const t=(0,l.h)(s),o={field:t.field,expression:t.valueExpression,expressionTitle:t.valueExpressionTitle};if((0,l.x)(e.fieldInfos[0],o))return!0}return!1}function h(e,s){const{layer:t,mapView:o,modules:a}=l.s,n=(0,l.h)(t),i=(0,l.u)(n.field),r=i&&["small-integer","integer","big-integer","long"].indexOf((0,l.z)(i.layerField))>-1,u=(null==i?void 0:i.simpleFieldType)===l.w.DATE,d="date-only"===(0,l.z)(i.layerField),c=[],p=(0,l._)();let h=0;e.classes.forEach(((n,g)=>{var v;if(1===n.values.length||s&&-1===s.indexOf(g))c.push(n),h++;else if(!s||s.indexOf(g)>-1){const s=["simple-marker","simple-line","simple-fill","cim"].indexOf(null===(v=n.symbol)||void 0===v?void 0:v.type)>-1?n.symbol:(0,l.S)(t,o,(0,l.g)());n.values.forEach(((t,o)=>{const n=a.esriLang.clone(s);if(o>0)if(p){const s=p.colors[(e.classes.length+h)%p.colors.length];s&&(0,l.r)(n,s)}else{const s=(0,l.$)().colors,t=new a.esriColor(s[(e.classes.length+h)%10]);t&&(0,l.r)(n,t)}const g=u||d?this.getDateLabel(t.value,i):(null==i?void 0:i.simpleFieldType)===l.w.NUMBER?__esri.intl.formatNumber(r?parseInt(t.value):parseFloat(t.value)):t.value;c.push(new a.UniqueValueClass({values:[new a.UniqueValue({value:t.value})],label:g,symbol:n})),h++}))}})),e.classes=c}}}]);