"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-47d5c2"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js":
/*!*********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getAppSwitcherConfig),
/* harmony export */   b: () => (/* binding */ getMarketPlaceProvisionedListings),
/* harmony export */   c: () => (/* binding */ getUserProperties),
/* harmony export */   d: () => (/* binding */ getApprovedApps),
/* harmony export */   e: () => (/* binding */ getOrgCapabilities),
/* harmony export */   f: () => (/* binding */ getSigninSettings),
/* harmony export */   g: () => (/* binding */ getShowInAppLauncher),
/* harmony export */   h: () => (/* binding */ getBlockableApps),
/* harmony export */   i: () => (/* binding */ getServers),
/* harmony export */   j: () => (/* binding */ getPortalSettings),
/* harmony export */   k: () => (/* binding */ fetchAllResources),
/* harmony export */   q: () => (/* binding */ queryAppItemsForChanges),
/* harmony export */   u: () => (/* binding */ updateUserProperties)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const appSwitcherConfigItemQuery = `owner:"esri" AND title:"AppSwitcher Config" AND type: "Application Configuration"`;
async function getPortalSettings(portal) {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    if (!portalUrl) {
        return;
    }
    const url = `${portalUrl}portals/self/settings`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => request(url), "portalSettings", portalUrl);
}
async function getShowInAppLauncher() {
    var _a;
    const settings = await getPortalSettings();
    return ((_a = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties) === null || _a === void 0 ? void 0 : _a.showInAppLauncher) || [];
}
async function getAppSwitcherConfigItem() {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (!portalUrl) {
        return;
    }
    const url = `${portalUrl}search`;
    return request(url, {
        num: 1,
        start: 0,
        sortField: "title",
        sortOrder: "asc",
        q: appSwitcherConfigItemQuery
    });
}
async function getConfigData(itemId) {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (!portalUrl || !itemId) {
        return;
    }
    const url = `${portalUrl}content/items/${itemId}/data`;
    return request(url);
}
async function getAppSwitcherConfig() {
    var _a;
    const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || !user) {
        return;
    }
    const result = await getAppSwitcherConfigItem();
    const item = (_a = result === null || result === void 0 ? void 0 : result.results) === null || _a === void 0 ? void 0 : _a[0];
    if (!item) {
        return;
    }
    const itemId = item.id;
    const data = await getConfigData(itemId);
    return data;
}
async function getUserProperties() {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}community/users/${user.username}/properties`;
    return request(url);
}
async function getApprovedApps() {
    const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/${portal.id}/approvedApps`;
    return request(url, { returnAllApps: false });
}
async function fetchAllResources(url, content, resourceKey = "results") {
    const max = 100;
    let start = 1;
    let resources = [];
    let totalLeft;
    let numRequests;
    let promises;
    let i;
    content.start = start;
    if (!content.num) {
        content.num = max;
    }
    try {
        const result = await request(url, content);
        if (!(result === null || result === void 0 ? void 0 : result[resourceKey])) {
            return resources;
        }
        resources = [...resources, ...result[resourceKey]];
        // calculate whether further batches are needed
        start = result.nextStart;
        totalLeft = result.total - resources.length;
        numRequests = Math.ceil(totalLeft / max);
        promises = [];
        // request each necessary batch
        for (i = 0; i < numRequests; i++) {
            content.start = start + i * max;
            promises.push(request(url, content));
        }
        try {
            const results = await Promise.all(promises);
            results.forEach((r) => {
                resources = [...resources, ...r[resourceKey]];
            });
            return resources;
        }
        catch (_a) {
            return resources;
        }
    }
    catch (_b) {
        return resources;
    }
}
async function getMarketPlaceProvisionedListings() {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}community/users/${user.username}/provisionedListings`;
    return fetchAllResources(url, { returnAppClientIds: true, returnAllProvisions: true }, "provisionedListings");
}
async function getOrgCapabilities() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/subscriptionInfo`;
    try {
        const response = await request(url);
        return (response === null || response === void 0 ? void 0 : response.orgCapabilities) || [];
    }
    catch (_a) {
        return [];
    }
}
async function queryAppItemsForChanges(approvedApps, runQuery) {
    if (!runQuery || !(approvedApps === null || approvedApps === void 0 ? void 0 : approvedApps.length)) {
        return;
    }
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`;
    return request(url, {
        num: 100,
        q: `id:(${approvedApps.map((a) => `"${a.itemId}"`).join(" OR ")})`
    });
}
const blockedAppsConfigItemQuery = `owner:"esri" AND title:"BlockedApps Config" AND type: "Application Configuration"`;
async function getBlockableApps() {
    var _a, _b;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`;
    try {
        const response = await request(url, {
            num: 10,
            start: 0,
            sortField: "title",
            sortOrder: "asc",
            q: blockedAppsConfigItemQuery
        });
        if (!response) {
            return [];
        }
        const itemId = ((_b = (_a = response.results) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.id) || "";
        const data = await getConfigData(itemId);
        return (data === null || data === void 0 ? void 0 : data.blockedApps) || [];
    }
    catch (_c) {
        return [];
    }
}
async function getServers() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/servers`;
    const response = await request(url);
    return (response === null || response === void 0 ? void 0 : response.servers) || [];
}
async function getSigninSettings() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/signinSettings`;
    const response = await request(url);
    return response;
}
function getUrl(path) {
    let portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (portalUrl.slice(-1) !== "/") {
        portalUrl += "/";
    }
    return `${portalUrl}${path}`;
}
async function request(url, params) {
    if (!params) {
        params = {};
    }
    params.f = "json";
    const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)();
    if (token) {
        params.token = token;
    }
    const urlObj = new URL(url);
    Object.keys(params).forEach((key) => urlObj.searchParams.append(key, params[key]));
    const response = await fetch(urlObj);
    const responseData = await response.json();
    return responseData;
}
async function postRequest(url, data) {
    data.append("f", "json");
    const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)();
    if (token) {
        data.append("token", token);
    }
    fetch(url, { method: "POST", body: data });
}
async function updateUserProperties(properties) {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = getUrl(`community/users/${user.username}/setProperties`);
    const data = new FormData();
    data.append("properties", JSON.stringify(properties));
    return postRequest(url, data);
}



//# sourceMappingURL=api-2e3a136f.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-app-switcher_2.entry.js":
/*!************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-app-switcher_2.entry.js ***!
  \************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_app_switcher: () => (/* binding */ ArcgisAppSwitcher),
/* harmony export */   arcgis_app_switcher_link: () => (/* binding */ ArcgisAppLink)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _sortable_esm_7e785780_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sortable.esm-7e785780.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/sortable.esm-7e785780.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
















function cookieForQueryingItemsExists() {
    const cookie = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_6__.c)("APSW-query", true);
    if ((cookie === null || cookie === void 0 ? void 0 : cookie.expires) > new Date().setHours(new Date().getHours())) {
        return true;
    }
    // Query for approved app items every 5 hours
    const payload = { expires: new Date().setHours(new Date().getHours() + 5) };
    (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_6__.d)("APSW-query", payload, {
        path: "/",
        domain: document.domain,
        sameSite: "Strict"
    }, true);
    return false;
}

const licenses = {};
function hasLicense(clientId) {
    var _a;
    return ((_a = licenses[clientId.toLowerCase()]) === null || _a === void 0 ? void 0 : _a.valid) || false;
}
function isInPortalConfig(title, portal, showInAppLauncher) {
    return !portal.isPortal || showInAppLauncher.indexOf(title) > -1;
}
function hasAccessToOpenData(portal) {
    if ((portal === null || portal === void 0 ? void 0 : portal.portalProperties) && (!portal.portalProperties.openData || !portal.portalProperties.openData.enabled)) {
        return false;
    }
    return hasLicense("HubforArcGIS");
}
function hasAccessToVelocity(user) {
    const requiresOneOf = [
        "portal:publisher:publishFeeds",
        "portal:publisher:publishRealTimeAnalytics",
        "portal:publisher:publishBigDataAnalytics"
    ];
    const privileges = (user === null || user === void 0 ? void 0 : user.privileges) || [];
    const hasPrivilege = privileges.some((privilege) => requiresOneOf.indexOf(privilege) > -1);
    const hasCapability = hasLicense("velocity");
    return hasPrivilege && hasCapability;
}
function hasAccessToSites(portal, title, showInAppLauncher) {
    return isInPortalConfig(title, portal, showInAppLauncher) && hasLicense("HubforArcGIS");
}
function hasAccessToMapViewer(portal, newMapViewerEnabled) {
    var _a;
    const disabledInApp = portal.isPortal && ((_a = portal.portalProperties) === null || _a === void 0 ? void 0 : _a.newMapViewerEnabled) === false;
    return newMapViewerEnabled && !disabledInApp && hasLicense("arcgisWebApps");
}
function hasAccessToOrthoMaker(portal, showInAppLauncher) {
    var _a;
    return (!!((_a = portal.helperServices) === null || _a === void 0 ? void 0 : _a.rasterAnalytics) &&
        !!portal.helperServices.orthoMapping &&
        isInPortalConfig("Ortho Maker", portal, showInAppLauncher));
}
function hasAccessToNotebooks(title, portal, user, showInAppLauncher, notebookServerEnabled) {
    var _a;
    const notebookServerConfigured = notebookServerEnabled && (!portal.isPortal || portal.supportsHostedNotebooks);
    const canCreateNotebooks = !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.length) &&
        user.privileges.some((privilege) => privilege === "premium:publisher:createNotebooks");
    return notebookServerConfigured && canCreateNotebooks && isInPortalConfig(title, portal, showInAppLauncher);
}
function hasAccessToTrackViewer(portal, showInAppLauncher, trackViewerEnabled) {
    var _a;
    return (!!((_a = portal.helperServices) === null || _a === void 0 ? void 0 : _a.locationTracking) &&
        trackViewerEnabled &&
        isInPortalConfig("Track Viewer", portal, showInAppLauncher));
}

const arcgisAppSwitcherCss = ".apps-content-container{position:relative}.toggle-button{margin:0px;display:block;cursor:pointer;overflow:visible;border-width:0px;padding:0px;-webkit-appearance:button;background-color:transparent;height:3.5rem;width:3.5rem}.toggle-button:not(.toggle-button--expanded):hover{box-shadow:inset 0 -3px 0 0 rgba(0, 121, 193, 0.5)}.toggle-button--expanded{box-shadow:inset 0 -3px 0 0 var(--calcite-color-brand)}.toggle-button__icon{display:block;height:1.5rem;width:1.5rem}:host{position:relative;color:var(--calcite-color-text-2)}.apps-content{position:absolute;right:0px;display:none}.apps-content--rtl{left:0px;right:auto}.apps-content--expanded{display:block}.apps-content ::-webkit-scrollbar{width:0.5rem}.apps-content ::-webkit-scrollbar-thumb{border-radius:var(--calcite-border-radius);background-color:rgba(0, 0, 0, 0.5);box-shadow:0 0 1px rgba(255, 255, 255, 0.5)}.dropdown-menu{top:0px;cursor:default;overflow-y:auto;overflow-x:hidden;background-color:var(--calcite-color-background);border-top:1px solid var(--calcite-color-border-1);max-height:85vh;max-width:480px;min-width:475px}.intro-container{background-color:var(--calcite-color-background);text-align:center}.intro-text{margin:0px;background-color:var(--calcite-color-background);padding-left:4rem;padding-right:4rem;padding-top:1rem;padding-bottom:0.75rem;font-size:0.875rem;color:var(--calcite-color-text-3)}.apps-list{margin-top:0px;margin-bottom:0px;list-style-type:none;flex-direction:row;flex-wrap:wrap;overflow:hidden;background-color:var(--calcite-color-background);padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.5rem;padding-right:0.5rem;text-align:left}.apps-list .secondary-drag-text{display:none}.app-item{position:relative;float:none;margin:0px;box-sizing:border-box;display:inline-block;cursor:pointer;overflow-wrap:break-word;text-align:left;vertical-align:top;font-size:0.875rem;height:110px;width:150px}@-moz-document url-prefix(){.app-item{width:146px}}.apps-content:not(.apps-content--dragging) .app-item:not(.app-item--missing):hover{color:var(--calcite-color-text-1);outline:1px solid var(--calcite-color-brand)}.app-item--dragging{outline-offset:-1px}.app-item--missing{padding-top:0.5rem}.show-more{display:flex;width:100%;cursor:pointer;align-items:center;justify-content:center;border-style:none;background-color:var(--calcite-color-foreground-3);padding:0.25rem;font-size:0.875rem;color:var(--calcite-color-text-3)}.secondary-container{background-color:var(--calcite-color-foreground-2);padding-top:0.25rem;padding-bottom:0.25rem;border-top:1px solid var(--calcite-color-border-3)}.secondary-container--hidden{display:none}.secondary-target{margin-top:0.75rem;margin-bottom:0.75rem;margin-left:1.5rem;margin-right:1.5rem;overflow:hidden;padding-left:2rem;padding-right:2rem;text-align:center;font-size:0.875rem;border:2px dashed var(--calcite-color-border-2);letter-spacing:normal;height:100px}.secondary-target--hover{border-color:var(--calcite-color-brand)}.secondary-list{margin:0px;padding-top:0.75rem;padding-bottom:0.75rem;padding-left:0.5rem;padding-right:0.5rem;text-align:left}";

const ArcgisAppSwitcher = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisAppSwitcherToggle = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAppSwitcherToggle", 7);
        this.willQueryForItems = true;
        this.blockedApps = [];
        this.showInAppLauncher = [];
        this.servers = [];
        this.orgCapabilities = [];
        this.updateAppsProperties = async () => {
            const primaryIds = this.getIdsFromDOM(this.primaryContainer);
            const primaryApps = this.getAppsByIds(primaryIds);
            const primary = this.convertToAppData(primaryApps);
            const secondaryIds = this.getIdsFromDOM(this.secondaryContainer);
            const secondaryApps = this.getAppsByIds(secondaryIds);
            const secondary = this.convertToAppData(secondaryApps);
            const updatedProperties = Object.assign({}, this.userProperties);
            updatedProperties.appLauncher = { primary, secondary };
            await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.u)(updatedProperties);
            this.userProperties = updatedProperties;
            const previousSecondaryCount = this.secondaryApps.length;
            this.primaryApps = primaryApps;
            this.secondaryApps = secondaryApps;
            if (previousSecondaryCount > 0 && !this.secondaryApps.length) {
                // if all apps are removed from secondary, show the drag box and text
                this.hoveringOverSecondary = false;
            }
        };
        this.handleToggle = () => {
            this.isExpanded = !this.isExpanded;
            this.arcgisAppSwitcherToggle.emit(this.isExpanded);
        };
        this.handleShowMore = () => {
            this.secondaryExpanded = true;
        };
        this.handleDismissIntro = () => {
            this.updateAppsProperties();
            this.displayIntro = false;
        };
        this.keydownHandler = (event) => {
            var _a;
            if (event.key === "Escape" && this.isExpanded) {
                this.handleToggle();
                (_a = this.toggleButton) === null || _a === void 0 ? void 0 : _a.focus();
            }
        };
        this.api = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.newMapViewerEnabled = true;
        this.notebookServerEnabled = true;
        this.trackViewerEnabled = true;
        this.shouldExpand = false;
        this.displayIntro = false;
        this.primaryApps = [];
        this.secondaryApps = [];
        this.isExpanded = false;
        this.hoveringOverSecondary = false;
        this.secondaryExpanded = false;
        this.sorting = false;
        this.focusItemId = undefined;
        this.dragging = false;
    }
    handleLinkClick() {
        this.isExpanded = false;
        this.arcgisAppSwitcherToggle.emit(this.isExpanded);
    }
    handleLinkActivated() {
        this.secondaryExpanded = true;
    }
    async handleLinkMove(evt) {
        const { uid, keyCode, index } = evt.detail;
        this.focusItemId = uid;
        const primaryTotal = this.primaryApps.length;
        const secondaryTotal = this.secondaryApps.length;
        const isInPrimary = index < primaryTotal;
        let targetPrimary;
        if (isInPrimary) {
            const rowCount = Math.ceil(primaryTotal / 3);
            const lastRowFirstIndex = rowCount * 3 - 3;
            if (index < lastRowFirstIndex) {
                targetPrimary = true;
            }
            else if (keyCode === "ArrowLeft" || keyCode === "ArrowUp") {
                targetPrimary = true;
            }
            else if (keyCode === "ArrowRight" && index < primaryTotal - 1) {
                targetPrimary = true;
            }
            else {
                targetPrimary = false;
            }
        }
        else {
            if (index >= primaryTotal + 3) {
                targetPrimary = false;
            }
            else if (keyCode === "ArrowRight" || keyCode === "ArrowDown") {
                targetPrimary = false;
            }
            else if (keyCode === "ArrowLeft" && index > primaryTotal) {
                targetPrimary = false;
            }
            else {
                targetPrimary = true;
            }
        }
        let targetIndex = -1;
        const sameList = (isInPrimary && targetPrimary) || (!isInPrimary && !targetPrimary);
        if (sameList) {
            if (keyCode === "ArrowUp") {
                targetIndex = index - 3;
            }
            else if (keyCode === "ArrowRight") {
                targetIndex = index + 1;
            }
            else if (keyCode === "ArrowDown") {
                targetIndex = index + 3;
            }
            else if (keyCode === "ArrowLeft") {
                targetIndex = index - 1;
            }
        }
        else {
            if (isInPrimary) {
                if (keyCode === "ArrowRight") {
                    targetIndex = primaryTotal;
                }
                else if (keyCode === "ArrowDown") {
                    targetIndex = (index % 3) + primaryTotal;
                }
            }
            else {
                targetIndex = primaryTotal;
            }
        }
        let app;
        if (isInPrimary) {
            app = this.primaryApps.splice(index, 1)[0];
        }
        else {
            app = this.secondaryApps.splice(index - primaryTotal, 1)[0];
        }
        if (targetPrimary) {
            this.primaryApps.splice(targetIndex, 0, app);
        }
        else {
            const secondaryIndex = targetIndex - primaryTotal;
            this.secondaryApps.splice(secondaryIndex, 0, app);
        }
        const primary = this.convertToAppData(this.primaryApps);
        const secondary = this.convertToAppData(this.secondaryApps);
        const updatedProperties = Object.assign({}, this.userProperties);
        updatedProperties.appLauncher = { primary, secondary };
        await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.u)(updatedProperties);
        this.userProperties = updatedProperties;
        if (secondaryTotal > 0 && !this.secondaryApps.length) {
            this.hoveringOverSecondary = false;
        }
        window.setTimeout(() => {
            // reset after setting focus
            this.focusItemId = "";
        }, 100);
    }
    async handleLinkRemove(evt) {
        const id = evt.detail;
        const updatedProperties = Object.assign({}, this.userProperties);
        let { primary, secondary } = updatedProperties.appLauncher;
        primary = primary.filter((app) => app.uid !== id);
        secondary = secondary.filter((app) => app.uid !== id);
        updatedProperties.appLauncher = { primary, secondary };
        await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.u)(updatedProperties);
        this.userProperties = updatedProperties;
        this.primaryApps = this.primaryApps.filter((app) => {
            const appId = app.itemId || app.title;
            return appId !== id;
        });
        this.secondaryApps = this.secondaryApps.filter((app) => {
            const appId = app.itemId || app.title;
            return appId !== id;
        });
    }
    handleShouldExpandChange(newValue) {
        this.isExpanded = newValue;
    }
    componentDidLoad() {
        const mobileDevices = [/Android/i, /webOS/i, /iPhone/i, /iPad/i];
        const isMobile = mobileDevices.some((device) => navigator.userAgent.match(device));
        if (isMobile) {
            // currently sortableJS inside Shadow DOM is not working correctly on mobile, so avoiding this
            // this should also allow scrolling the apps list on mobile
            return;
        }
        _sortable_esm_7e785780_js__WEBPACK_IMPORTED_MODULE_1__.S.create(this.primaryContainer, {
            animation: 150,
            group: "apps",
            filter: ".secondary-drag-text",
            dragClass: "app-item--dragging",
            onUpdate: this.updateAppsProperties,
            onAdd: this.updateAppsProperties,
            onMove: (params) => {
                this.hoveringOverSecondary = params.to.className === "secondary-target";
            },
            onStart: () => {
                this.dragging = true;
            },
            onEnd: () => {
                this.dragging = false;
            }
        });
        _sortable_esm_7e785780_js__WEBPACK_IMPORTED_MODULE_1__.S.create(this.secondaryContainer, {
            animation: 150,
            group: "apps",
            filter: ".secondary-drag-text",
            dragClass: "app-item--dragging",
            onUpdate: this.updateAppsProperties,
            onAdd: this.updateAppsProperties
        });
    }
    componentDidRender() {
        if (this.primaryContainer.contains(this.secondaryDragText)) {
            this.secondaryContainer.appendChild(this.secondaryDragText);
        }
    }
    async componentWillLoad() {
        var _a, _b;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
        this.strings = locale[0];
        this.willQueryForItems = cookieForQueryingItemsExists();
        this.initializeConfig();
        if (!((_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal) === null || _a === void 0 ? void 0 : _a.id) || !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user) {
            return;
        }
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal.isPortal) {
            this.showInAppLauncher = await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.g)();
        }
        const [config, marketplace, preferences, customOrgApps, orgCapabilities] = await Promise.all([
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.a)(),
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.b)(),
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.c)(),
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.d)(),
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.e)()
        ]);
        this.orgCapabilities = orgCapabilities;
        this.userProperties = (preferences === null || preferences === void 0 ? void 0 : preferences.properties) || {};
        this.userApps = config === null || config === void 0 ? void 0 : config.appSwitcher;
        if (!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal.isPortal) {
            this.userApps.apps.unshift(this.getAgoApp());
        }
        this.approvedApps =
            ((_b = customOrgApps.approvedApps) === null || _b === void 0 ? void 0 : _b.filter((app) => !app.hideForNonPrivilegedMember)) || [];
        if (!this.userProperties.appLauncher) {
            this.willQueryForItems = false;
            this.displayIntro = true;
        }
        this.provisionedListings = marketplace || [];
        this.provisionedListings.forEach((listing) => {
            var _a;
            const clientId = (_a = listing.clientId) === null || _a === void 0 ? void 0 : _a.toLowerCase();
            if (clientId) {
                licenses[clientId] = {
                    valid: true,
                    itemId: listing.itemId,
                    clientId: listing.clientId
                };
            }
        });
        orgCapabilities === null || orgCapabilities === void 0 ? void 0 : orgCapabilities.forEach((capability) => {
            var _a;
            const capabilityId = (_a = capability.id) === null || _a === void 0 ? void 0 : _a.toLowerCase();
            if (capabilityId) {
                licenses[capabilityId] = {
                    valid: true,
                    clientId: capability.id
                };
            }
        });
        await this.init();
        this.primaryApps.forEach((app) => {
            app.fontSize = this.calcFontSize(app);
        });
    }
    convertToAppData(apps) {
        return apps.map((app) => ({ label: app.label, uid: app.itemId || app.title }));
    }
    getAppsByIds(ids) {
        const apps = [...this.primaryApps, ...this.secondaryApps];
        return ids.map((id) => apps.find((app) => app.itemId === id || app.title === id));
    }
    getIdsFromDOM(container) {
        const ids = [];
        container.querySelectorAll(".app-item").forEach((el) => {
            ids.push(el.dataset.id);
        });
        return ids;
    }
    getTextWidth(text) {
        const canvas = document.createElement("canvas"), context = canvas.getContext("2d");
        context.font = "avenir";
        const metrics = context.measureText(text);
        return metrics.width;
    }
    calcFontSize(app) {
        if (!app.abbr) {
            return;
        }
        const abbreviationSizes = [0, 32, 24, 20, 18, 16, 14, 12, 10, 8, 6];
        let strWidth = Math.ceil(this.getTextWidth(app.abbr) / 5);
        if (strWidth > abbreviationSizes.length - 1) {
            strWidth = abbreviationSizes.length - 1;
        }
        return `${abbreviationSizes[strWidth]}px`;
    }
    async getBlockedApps() {
        const [signinSettings, blockableApps] = await Promise.all([
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.f)(),
            (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.h)()
        ]);
        const clientIds = (signinSettings === null || signinSettings === void 0 ? void 0 : signinSettings.blockedApps) || [];
        if ((!clientIds.length && !signinSettings.blockBetaApps) || !(blockableApps === null || blockableApps === void 0 ? void 0 : blockableApps.length)) {
            return [];
        }
        if (signinSettings.blockBetaApps) {
            blockableApps.forEach((app) => {
                if (app.isBeta && !clientIds.includes(app.clientid)) {
                    clientIds.push(app.clientid);
                }
            });
        }
        clientIds.forEach((id) => {
            const match = blockableApps.find((app) => app.clientid === id);
            if (match) {
                this.blockedApps.push(match);
            }
        });
        return this.blockedApps;
    }
    filterBlockedApps(apps) {
        return apps.filter((app) => {
            var _a;
            const inBlockedList = (_a = this.blockedApps) === null || _a === void 0 ? void 0 : _a.some((ba) => {
                return (app.itemId && app.itemId === ba.itemid) || (app.title && app.title === ba.title);
            });
            return !inBlockedList;
        });
    }
    populateAppIdentifiers(prev, app) {
        const list = Object.keys(this.appDictionary).map((key) => this.appDictionary[key]);
        let populatedApp = list.filter((a) => a.itemId === app.uid || a.title === app.uid).shift();
        if (populatedApp && !this.appDictionary[app.uid]) {
            app.uid = populatedApp.itemId || populatedApp.title;
        }
        if (populatedApp === null || populatedApp === void 0 ? void 0 : populatedApp.hasBeenPopulated) {
            return prev;
        }
        if (!populatedApp) {
            // App Can't be Found
            populatedApp = app;
            populatedApp.canAccess = false;
            populatedApp.itemId = app.uid;
            this.appDictionary[app.uid] = populatedApp;
        }
        else {
            // -- Insert into Dictionary --
            if ((app.hasChanged ||
                populatedApp.hasChanged ||
                (!populatedApp.canAccess && !populatedApp.ignoreNoAccess)) &&
                this.isAdmin()) {
                this.appDictionary[app.uid].hasChanged = true;
                this.appDictionary[app.uid].ignoreNoAccess = app.ignoreNoAccess;
            }
            if (app.isNew) {
                this.appDictionary[app.uid].isNew = true;
            }
            delete this.newAppDictionary[app.uid];
        }
        // -- Prevent duplicates from any possible error states
        this.appDictionary[app.uid].hasBeenPopulated = true;
        prev.push(populatedApp);
        return prev;
    }
    isInPortalConfig(title) {
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        return isInPortalConfig(title, portal, this.showInAppLauncher);
    }
    getAppExceptions() {
        const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        return {
            "Open Data": {
                hasAccess: () => hasAccessToOpenData(portal)
            },
            AppStudio: {
                hasAccess: () => hasLicense("arcgisWebApps")
            },
            "ArcGIS Velocity": {
                hasAccess: () => hasAccessToVelocity(user)
            },
            "ArcGIS Hub": {
                hasAccess: () => hasLicense("HubforArcGIS")
            },
            "ArcGIS Enterprise Sites": {
                hasAccess: (title) => hasAccessToSites(portal, title, this.showInAppLauncher)
            },
            "ArcGIS Experience Builder": {
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS StoryMaps": {
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS QuickCapture Web Designer": {
                hasAccess: (title) => this.isInPortalConfig(title) && hasLicense("arcgisWebApps")
            },
            "ArcGIS Collector": {
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS Field Maps": {
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS Dashboards": {
                hasAccess: (title) => this.isInPortalConfig(title) && hasLicense("dashboards")
            },
            "ArcGIS Solutions": {
                // For Portal
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS Workforce": {
                // For Portal
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "Deep Learning Studio": {
                // For Portal
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "Map Viewer": {
                hasAccess: () => hasAccessToMapViewer(portal, this.newMapViewerEnabled) &&
                    this.isInPortalConfig("ArcGIS Map Viewer")
            },
            "Map Viewer Classic": {
                hasAccess: () => hasLicense("arcgisWebApps") && this.isInPortalConfig("ArcGIS Map Viewer Classic")
            },
            "Operations Dashboard for ArcGIS": {
                hasAccess: () => hasLicense("opsdashboard") && this.isInPortalConfig("ArcGIS Dashboards Classic")
            },
            "ArcGIS Dashboards Classic": {
                hasAccess: (title) => hasLicense("opsdashboard") && this.isInPortalConfig(title)
            },
            "Ortho Maker": {
                hasAccess: () => hasAccessToOrthoMaker(portal, this.showInAppLauncher)
            },
            Notebook: {
                hasAccess: (title) => hasAccessToNotebooks(title, portal, user, this.showInAppLauncher, this.notebookServerEnabled)
            },
            "Scene Viewer": {
                hasAccess: (title) => hasLicense("arcgisWebApps") && this.isInPortalConfig(title)
            },
            "Story Maps": {
                hasAccess: () => hasLicense("arcgisWebApps")
            },
            Survey123: {
                hasAccess: () => hasLicense("survey123")
            },
            "Track Viewer": {
                hasAccess: () => hasAccessToTrackViewer(portal, this.showInAppLauncher, this.trackViewerEnabled)
            },
            "Instant Apps": {
                // For Portal
                hasAccess: (title) => hasLicense("arcgisWebApps") && this.isInPortalConfig(title)
            },
            "Vector Tile Style Editor": {
                // For Portal
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS GeoBIM": {
                // For Portal
                hasAccess: (title) => this.isInPortalConfig(title)
            },
            "ArcGIS Maps for Adobe Creative Cloud": {
                hasAccess: () => {
                    return hasLicense("arcgisWebApps") && !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal.isPortal;
                }
            }
        };
    }
    getExcludedProvisionedListings() {
        let excluded = {
            opsdashboard: 1,
            arcgisWebApps: 1,
            Workforce: 1,
            geoplanner: 1,
            webappbuilder: 1,
            HubforArcGIS: 1,
            appstudio: 1,
            survey123: 1,
            storymaps: 1,
            mapsForOffice: 1,
            mapsForO365: 1,
            mapsForSharePoint: 1,
            mapsForCreativeCloud: 1
        };
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        if (portal.isPortal) {
            // exclude certain provisioned listings for Enterprise
            excluded = Object.assign(Object.assign({}, excluded), { arcgisonline: 1, arcgisUrban: 1, arcgisinstantapps: 1 });
        }
        return excluded;
    }
    getImagePath(app) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/${(app === null || app === void 0 ? void 0 : app.image) ? app.image : ""}`);
    }
    modifyWebAppForView(app) {
        var _a, _b;
        const img = ((_a = app.appSwitcher) === null || _a === void 0 ? void 0 : _a.image) || app.icon;
        if (img) {
            app.image = this.getWebMappingAppImgPath(app);
        }
        else {
            app.placeHolderIcon = `${this.getImagePath()}svg-app-circle.svg`;
        }
        app.abbr = ((_b = app.appSwitcher) === null || _b === void 0 ? void 0 : _b.abbr) || app.abbreviation;
        delete app.abbreviation;
        delete app.appSwitcher;
        delete app.approvedApp;
        delete app.webMappingApp;
        return app;
    }
    modifySystemAppForView(app, uniqueId) {
        var _a;
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        if (app.image) {
            app.image = this.getImagePath(app);
        }
        else {
            app.placeHolderIcon = `${this.getImagePath()}svg-app-icon.svg`;
        }
        // relative urls must be pointed at the org url (#25494)
        if (((_a = app.url) === null || _a === void 0 ? void 0 : _a.indexOf("../")) === 0) {
            const baseUrl = portal.urlKey
                ? `${portal.urlKey}.${portal.customBaseUrl}`
                : portal.portalHostname;
            app.url = `${location.protocol}//${baseUrl}${app.url.substring(2, app.url.length)}`;
        }
        delete app.isLicensed;
        delete app.privileges;
        app.itemId = uniqueId;
        return app;
    }
    getWebMappingAppImgPath(app) {
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.e)(portal);
        if (!app.icon) {
            return `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)()}content/items/${app.itemId}/resources/${app.appSwitcher.image}?token=${token}`;
        }
        return `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)()}portals/self/resources/${app.icon}?token=${token}`;
    }
    modifyPartnerAppForView(app) {
        var _a, _b, _c;
        app.appSwitcher = (_a = app.properties) === null || _a === void 0 ? void 0 : _a.appSwitcher;
        const customIcon = ((_b = app.appSwitcher) === null || _b === void 0 ? void 0 : _b.image) || app.icon;
        return {
            abbr: ((_c = app.appSwitcher) === null || _c === void 0 ? void 0 : _c.abbr) || app.abbreviation,
            itemId: app.itemId,
            canAccess: true,
            webMappingApp: true,
            image: customIcon ? this.getWebMappingAppImgPath(app) : null,
            label: app.title || app.label,
            url: app.url,
            placeHolderIcon: app.placeHolderIcon || `${this.getImagePath()}svg-app-circle.svg`
        };
    }
    async getLicensedApps() {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        const allAppUids = {};
        const appDictionary = {};
        const exceptions = this.getAppExceptions();
        const excludedProvisionedListings = this.getExcludedProvisionedListings();
        const legalApps = [];
        const appCount = this.userApps.apps.length;
        for (let i = 0; i < appCount; i++) {
            const app = this.userApps.apps[i];
            const uid = app.itemId || app.title;
            let isPrivileged = true;
            const inBlockedList = (_a = this.blockedApps) === null || _a === void 0 ? void 0 : _a.some((ba) => (app.itemId && app.itemId === ba.itemid) || (app.title && app.title === ba.title));
            allAppUids[uid] = 1;
            appDictionary[uid] = app;
            if (inBlockedList) {
                continue;
            }
            const portalDeploymentType = portal.portalDeploymentType || ((_b = portal.sourceJSON) === null || _b === void 0 ? void 0 : _b.portalDeploymentType);
            if (portalDeploymentType === "ArcGISEnterpriseOnKubernetes" &&
                app.supportsKubernetes === false) {
                continue;
            }
            if (exceptions[app.title] && !exceptions[app.title].hasAccess(app.title)) {
                continue;
            }
            const subscriptionInfo = portal.subscriptionInfo || ((_c = portal.sourceJSON) === null || _c === void 0 ? void 0 : _c.subscriptionInfo);
            if (app.subscriptionType) {
                if ((subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type) === app.subscriptionType) {
                    appDictionary[uid].canAccess = true;
                    legalApps.push(this.modifySystemAppForView(app, uid));
                }
                continue;
            }
            if (app.orgCapabilities) {
                if ((_d = this.orgCapabilities) === null || _d === void 0 ? void 0 : _d.length) {
                    const hasCapability = this.orgCapabilities.some((capability) => app.orgCapabilities.includes(capability.id));
                    if (hasCapability) {
                        appDictionary[uid].canAccess = true;
                        legalApps.push(this.modifySystemAppForView(app, uid));
                    }
                }
                continue;
            }
            if (!((_e = app.privileges) === null || _e === void 0 ? void 0 : _e.length) && !app.isLicensed && !app.serverFunction) {
                appDictionary[uid].canAccess = true;
                legalApps.push(this.modifySystemAppForView(app, uid));
                continue;
            }
            const skipPrivCheck = ((_g = ((user === null || user === void 0 ? void 0 : user.userLicenseTypeId) || ((_f = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _f === void 0 ? void 0 : _f.userLicenseTypeId))) === null || _g === void 0 ? void 0 : _g.toLowerCase()) === "storytellerut" && ((_h = app.label) === null || _h === void 0 ? void 0 : _h.toLowerCase()) === "storymaps";
            if (skipPrivCheck) {
                appDictionary[uid].canAccess = true;
                legalApps.push(this.modifySystemAppForView(app, uid));
                continue;
            }
            if (((_j = app.privileges) === null || _j === void 0 ? void 0 : _j.length) > 0 && (user === null || user === void 0 ? void 0 : user.privileges)) {
                for (let j = 0; j < app.privileges.length; j++) {
                    if (user.privileges.indexOf(app.privileges[j]) < 0) {
                        isPrivileged = false;
                        break;
                    }
                }
                if (!app.isLicensed && isPrivileged) {
                    appDictionary[uid].canAccess = true;
                    legalApps.push(this.modifySystemAppForView(app, uid));
                    continue;
                }
            }
            if (app.isLicensed && isPrivileged) {
                for (let k = 0; k < this.provisionedListings.length; k++) {
                    if (uid === this.provisionedListings[k].itemId ||
                        uid === this.provisionedListings[k].title) {
                        appDictionary[uid].canAccess = true;
                        legalApps.push(this.modifySystemAppForView(app, uid));
                        break;
                    }
                }
            }
            if (app.serverFunction && isPrivileged) {
                if (this.servers.some((server) => {
                    var _a;
                    const functions = ((_a = server.serverFunction) === null || _a === void 0 ? void 0 : _a.split(",")) || [];
                    return functions.includes(app.serverFunction);
                })) {
                    appDictionary[uid].canAccess = true;
                    legalApps.push(this.modifySystemAppForView(app, uid));
                    continue;
                }
            }
        }
        // - Web mapping apps from Markeplace
        this.provisionedListings.forEach((app) => {
            if (app.type === "Web Mapping Application" &&
                !excludedProvisionedListings[app.clientId] &&
                !allAppUids[app.itemId] &&
                app.url &&
                app.title &&
                !allAppUids[app.title] &&
                app.typeKeywords.indexOf("hideFromAppSwitcher") < 0) {
                const modifiedApp = this.modifyPartnerAppForView(app);
                appDictionary[app.itemId] = modifiedApp;
                legalApps.push(modifiedApp);
            }
        });
        const apps = [
            ...this.approvedApps.map((app) => {
                const appProperties = Object.assign(Object.assign({}, app.appProperties), { itemId: app.itemId, webMappingApp: true, approvedApp: true, canAccess: !this.willQueryForItems });
                appDictionary[app.itemId] = appProperties;
                return this.modifyWebAppForView(appProperties);
            }),
            ...legalApps
        ];
        return {
            apps,
            appDictionary
        };
    }
    isAdmin() {
        const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        if (!user) {
            return false;
        }
        return user.role === "org_admin" || user.role === "account_admin";
    }
    // Map the uid of existing user properties to match the new title
    mapAppTitles(apps) {
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        apps.forEach((app) => {
            if (app.uid === "Map Viewer Beta") {
                app.uid = "Map Viewer";
            }
            if (portal.isPortal) {
                if (app.uid === "Operations Dashboard for ArcGIS") {
                    app.uid = "ArcGIS Dashboards Classic";
                }
                else if (app.uid === "Workforce for ArcGIS") {
                    app.uid = "ArcGIS Workforce";
                }
            }
        });
    }
    async init() {
        var _a;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal.isPortal) {
            this.servers = await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.i)();
        }
        await this.getBlockedApps();
        const { apps, appDictionary } = await this.getLicensedApps();
        this.appDictionary = appDictionary;
        if (this.userProperties.appLauncher) {
            if (this.userProperties.appLauncher.primary) {
                this.mapAppTitles(this.userProperties.appLauncher.primary);
            }
            if (this.userProperties.appLauncher.secondary) {
                this.mapAppTitles(this.userProperties.appLauncher.secondary);
            }
        }
        if (!this.userProperties.appLauncher ||
            !this.userProperties.appLauncher.primary ||
            !this.userProperties.appLauncher.secondary) {
            this.primaryApps = apps.slice().sort((a, b) => (a.label < b.label ? -1 : 1));
            this.primaryApps = this.filterBlockedApps(this.primaryApps);
            this.secondaryApps = [];
            return;
        }
        else {
            const response = await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_4__.q)(this.approvedApps, this.willQueryForItems);
            if (((_a = response === null || response === void 0 ? void 0 : response.results) === null || _a === void 0 ? void 0 : _a.length) > 0) {
                response.results.forEach((item) => {
                    const app = this.appDictionary[item.id];
                    app.canAccess = true;
                    app.hasChanged = app.url !== item.url ? !!item.url : false;
                });
            }
            this.newAppDictionary = Object.assign({}, this.appDictionary);
            this.userProperties.appLauncher.primary.forEach((p) => {
                if (p.label === "Map Viewer") {
                    p.uid = "Map Viewer";
                }
            });
            this.primaryApps =
                this.userProperties.appLauncher.primary.reduce(this.populateAppIdentifiers.bind(this), []) || [];
            this.secondaryApps =
                this.userProperties.appLauncher.secondary.reduce(this.populateAppIdentifiers.bind(this), []) || [];
            this.primaryApps = this.filterBlockedApps(this.primaryApps);
            this.secondaryApps = this.filterBlockedApps(this.secondaryApps);
            // :: Check for New App Icons ::
            for (const app in this.newAppDictionary) {
                if (this.newAppDictionary[app].canAccess) {
                    this.newAppDictionary[app].isNew = true;
                    this.appDictionary[app] = this.newAppDictionary[app];
                    this.primaryApps.push(this.newAppDictionary[app]);
                }
            }
            return;
        }
    }
    getAgoApp() {
        const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c;
        const baseUrl = `${location.protocol}//${portal.urlKey ? `${portal.urlKey}.${portal.customBaseUrl}` : portal.portalHostname}/home/`;
        const { landingPage } = this.userProperties;
        const url = `${baseUrl}${(landingPage === null || landingPage === void 0 ? void 0 : landingPage.url) ? landingPage.url : (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_8__.b)(user) ? "organization.html" : "index.html"}`;
        return {
            image: "arcgis-online.png",
            label: "ArcGIS Online",
            title: "ArcGIS Online",
            url
        };
    }
    initializeConfig() {
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api = this.api;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.user = this.user;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.portal = this.portal;
    }
    render() {
        const total = this.primaryApps.length + this.secondaryApps.length;
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_7__.g)(this.el) === "rtl";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { onKeyDown: this.keydownHandler }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", kind: "neutral", class: { "toggle-button": true, "toggle-button--expanded": this.isExpanded }, "aria-label": this.strings.appLauncher, onClick: this.handleToggle, ref: (el) => (this.toggleButton = el), "aria-expanded": this.isExpanded }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "toggle-button__icon", icon: "app-launcher", scale: "m" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "apps-content-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "apps-content": true,
                "apps-content--rtl": rtl,
                "apps-content--expanded": this.isExpanded,
                "apps-content--dragging": this.dragging
            }, "aria-hidden": "false" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("nav", { class: "dropdown-menu dropdown-right", role: "menu" }, this.displayIntro && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "intro-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "drag-and-drop-intro intro-text" }, this.strings.dragDrop), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", onClick: this.handleDismissIntro }, this.strings.gotIt))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "apps-list", ref: (el) => (this.primaryContainer = el) }, this.primaryApps.map((app, index) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { "data-id": app.itemId || app.title, key: app.itemId, class: { "app-item": true, "app-item--missing": !app.canAccess } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-app-switcher-link", { app: app, index: index, total: total, focusItemId: this.focusItemId, openText: this.strings.openWindow }))))), !this.secondaryExpanded && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "show-more", onClick: this.handleShowMore }, this.strings.showMore, " ", (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "chevron-down", scale: "s" }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "secondary-container": true,
                "secondary-container--hidden": !this.secondaryExpanded
            }, "aria-expanded": "true" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: {
                "secondary-target": this.secondaryApps.length === 0,
                "secondary-list": this.secondaryApps.length !== 0,
                "secondary-target--hover": this.hoveringOverSecondary && this.secondaryApps.length === 0
            }, ref: (el) => (this.secondaryContainer = el) }, this.secondaryApps.length === 0 && !this.hoveringOverSecondary && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "secondary-drag-text", ref: (el) => (this.secondaryDragText = el) }, this.strings.dragSecondary)), this.secondaryApps.map((app, index) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { "data-id": app.itemId, key: app.itemId, class: { "app-item": true, "app-item--missing": !app.canAccess } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-app-switcher-link", { app: app, index: this.primaryApps.length + index, total: total, focusItemId: this.focusItemId, openText: this.strings.openWindow })))))))))));
    }
    static get assetsDirs() { return ["assets"]; }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "shouldExpand": ["handleShouldExpandChange"]
    }; }
};
ArcgisAppSwitcher.style = arcgisAppSwitcherCss;

const AppSwitcherLinkArrows = ({ index, total, active }) => {
    const isFirst = index === 0;
    const isFirstRow = index <= 2;
    const isLast = index === total - 1;
    const rowCount = Math.ceil(total / 3);
    const lastRowFirstIndex = rowCount * 3 - 3;
    const isLastRow = index >= lastRowFirstIndex;
    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { "arrow--hidden": !active } },
        !isFirst && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "arrow arrow--left" }),
        !isLast && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "arrow arrow--right" }),
        !isFirstRow && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "arrow arrow--top" }),
        !isLastRow && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "arrow arrow--bottom" })));
};

const arcgisAppSwitcherLinkCss = ":host{display:block;height:93%}.app-link{position:relative;display:block;height:100%;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;text-decoration-line:none;color:inherit}.app-link:focus{outline:1px solid var(--calcite-color-brand)}.arrow{position:absolute;height:0px;width:0px}.arrow--hidden{visibility:hidden}.arrow--left{border-right:5px solid var(--calcite-color-brand);border-bottom:5px solid transparent;border-top:5px solid transparent;left:38px;top:27px}.arrow--right{border-left:5px solid var(--calcite-color-brand);border-bottom:5px solid transparent;border-top:5px solid transparent;right:38px;top:27px}.arrow--top{border-bottom:5px solid var(--calcite-color-brand);border-left:5px solid transparent;border-right:5px solid transparent;top:0;right:70px}.arrow--bottom{border-top:5px solid var(--calcite-color-brand);border-left:5px solid transparent;border-right:5px solid transparent;top:59px;right:70px}.missing-icon .arrow--top{top:-4px}.icon-wrapper{margin-top:0px;margin-bottom:0px;margin-left:auto;margin-right:auto;margin-bottom:0.5rem;display:block;height:3rem;width:3rem;background-size:contain;background-repeat:no-repeat;text-align:center;font-size:1.125rem;color:var(--calcite-color-text-2)}.icon-abbr{position:absolute;width:3rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:1.25rem;font-weight:700;color:var(--calcite-color-foreground-1);line-height:3rem;text-shadow:0 1px 8px var(--calcite-color-text-3);transform:translateZ(0)}.icon-img{pointer-events:none;height:3rem;width:3rem}.indicator{position:absolute;clear:both;box-sizing:border-box;height:1rem;width:1rem;border-radius:50%;border:2px solid var(--calcite-color-foreground-1);z-index:50}.indicator--new{background-color:var(--calcite-color-status-success);top:4px;right:46px}.indicator--new-rtl{right:auto;left:46px}.indicator--remove{display:flex;cursor:pointer;align-items:center;justify-content:center;background-color:var(--calcite-color-foreground-1);line-height:2px;padding:1px;right:42px;top:2px}.indicator--remove-rtl{right:auto;left:42px}.indicator--remove:hover,.indicator--remove:focus{outline:2px solid transparent;outline-offset:2px;border-color:var(--calcite-color-status-danger);color:var(--calcite-color-status-danger)}.missing-icon{margin-top:0px;margin-bottom:0px;margin-left:auto;margin-right:auto;margin-bottom:0.5rem;box-sizing:border-box;display:block;height:3rem;width:3rem;cursor:pointer;background-color:var(--calcite-color-foreground-3);text-align:center;border:1px dashed var(--calcite-color-inverse);border-radius:6px;outline-color:var(--calcite-color-brand)}.label-text{margin-top:0px;margin-bottom:0px;margin-left:auto;margin-right:auto;display:block;text-align:center;line-height:17px;width:128px}.screen-readers{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

const ArcgisAppLink = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisAppSwitcherLinkActivated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAppSwitcherLinkActivated", 7);
        this.arcgisAppSwitcherLinkMove = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAppSwitcherLinkMove", 7);
        this.arcgisAppSwitcherLinkRemove = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAppSwitcherLinkRemove", 7);
        this.arcgisAppSwitcherLinkClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAppSwitcherLinkClick", 7);
        this.isFirstRow = false;
        this.isLastRow = false;
        this.moveElement = (keyCode) => {
            this.arcgisAppSwitcherLinkMove.emit({
                uid: this.app.itemId || this.app.title,
                index: this.index,
                keyCode
            });
        };
        this.handleKey = (evt) => {
            let keyMatch = true;
            switch (evt.code) {
                case "Space":
                    this.sortingActive = !this.sortingActive;
                    this.arcgisAppSwitcherLinkActivated.emit();
                    break;
                case "ArrowUp":
                case "ArrowRight":
                case "ArrowDown":
                case "ArrowLeft":
                    if (this.sortingActive) {
                        this.moveElement(evt.code);
                    }
                    break;
                default:
                    keyMatch = false;
                    break;
            }
            if (keyMatch) {
                evt.preventDefault();
                evt.stopPropagation();
            }
        };
        this.handleBlur = () => {
            this.sortingActive = false;
        };
        this.handleRemove = () => {
            this.arcgisAppSwitcherLinkRemove.emit(this.app.itemId || this.app.title);
        };
        this.handleRemoveKeydown = (evt) => {
            switch (evt.code) {
                case "Space":
                case "Enter":
                    this.handleRemove();
                    evt.preventDefault();
                    break;
            }
        };
        this.handleClick = () => {
            this.arcgisAppSwitcherLinkClick.emit();
        };
        this.app = undefined;
        this.index = undefined;
        this.total = undefined;
        this.focusItemId = undefined;
        this.openText = undefined;
        this.sortingActive = false;
    }
    componentDidRender() {
        var _a, _b;
        if (this.focusItemId &&
            (this.focusItemId === this.app.itemId || this.focusItemId === this.app.title)) {
            this.sortingActive = true;
            if (this.app.canAccess) {
                (_a = this.linkElement) === null || _a === void 0 ? void 0 : _a.focus();
            }
            else if (!this.app.canAccess) {
                (_b = this.missingElement) === null || _b === void 0 ? void 0 : _b.focus();
            }
        }
    }
    render() {
        var _a;
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_7__.g)(this.el) === "rtl";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_a = this.app) === null || _a === void 0 ? void 0 : _a.canAccess) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", { ref: (el) => (this.linkElement = el), href: this.app.url, class: "app-link", onKeyDown: this.handleKey, onBlur: this.handleBlur, onClick: this.handleClick, draggable: false, target: "_blank", role: "menuitem" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "icon-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(AppSwitcherLinkArrows, { active: this.sortingActive, index: this.index, total: this.total }), !this.app.image && this.app.abbr && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { style: { fontSize: this.app.fontSize || "20px" }, class: "avenir icon-abbr" }, this.app.abbr)), !this.app.image && this.app.abbr && this.app.placeHolderIcon && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { src: this.app.placeHolderIcon, alt: "" })), this.app.image && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { src: this.app.image, class: "icon-img", alt: "" })), this.app.isNew && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { indicator: true, "indicator--new": true, "indicator--new-rtl": rtl } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label-text" }, this.app.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers" }, this.openText))), this.app && !this.app.canAccess && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { indicator: true, "indicator--remove": true, "indicator--remove-rtl": rtl }, tabIndex: 0, onClick: this.handleRemove, onKeyDown: this.handleRemoveKeydown }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.missingElement = el), class: "missing-icon", tabIndex: 0, onKeyDown: this.handleKey, onBlur: this.handleBlur }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(AppSwitcherLinkArrows, { active: this.sortingActive, index: this.index, total: this.total })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "label-text" }, this.app.label)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisAppLink.style = arcgisAppSwitcherLinkCss;



//# sourceMappingURL=arcgis-app-switcher_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ setSessionStorageItem),
/* harmony export */   b: () => (/* binding */ getSessionStorageItem),
/* harmony export */   c: () => (/* binding */ getCookie),
/* harmony export */   d: () => (/* binding */ setCookie),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
    writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
    const cookie = readCookie(name);
    return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
    window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
    const item = window.localStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
    window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
    const item = window.sessionStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
    const cookie = document.cookie;
    const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
    const matchedCookies = cookie.match(cookieNameRE);
    return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
    properties = properties || {};
    let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
    if (typeof expires === "number") {
        const expirationDate = new Date();
        const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
        expirationDate.setTime(Date.now() + daysFromTodayInMs);
        expires = properties.expires = expirationDate;
    }
    if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
        properties.expires = expires.toUTCString();
    }
    let cookie = `${name}=${encodeURIComponent(value)}`;
    let property;
    for (property in properties) {
        cookie += `; ${property}`;
        const propertyValue = properties[property];
        if (propertyValue !== true) {
            cookie += `=${propertyValue}`;
        }
    }
    document.cookie = cookie;
}



//# sourceMappingURL=storage-0353a769.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTQ3ZDVjMi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMwRjtBQUNsQzs7QUFFeEQ7QUFDQTtBQUNBLHNCQUFzQixzREFBYztBQUNwQztBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsVUFBVTtBQUM3QixXQUFXLHNEQUFTO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHNEQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixVQUFVO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esc0JBQXNCLHNEQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixVQUFVLGdCQUFnQixPQUFPO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxlQUFlLEVBQUUsa0RBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU8sRUFBRSxrREFBVztBQUNoQyxtQkFBbUIsc0RBQWMsR0FBRyxrQkFBa0IsY0FBYztBQUNwRTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFNBQVMsRUFBRSxrREFBVztBQUNsQyxtQkFBbUIsc0RBQWMsR0FBRyxVQUFVLFVBQVU7QUFDeEQsMEJBQTBCLHNCQUFzQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFNBQVMsRUFBRSxrREFBVztBQUN0QztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsZUFBZSxFQUFFLGtEQUFXO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsMkRBQTJELGtEQUFXO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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O0FBQ0E7QUFDQTtBQUNBOztBQUVzSjs7QUFFdEoiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcGktMmUzYTEzNmYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWFwcC1zd2l0Y2hlcl8yLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tMzUzNTU1MmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0wNTBiNmRiOS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N0b3JhZ2UtMDM1M2E3NjkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlc3RCYXNlVXJsLCBlIGFzIGdldFRva2VuLCBmIGFzIGZyb21DYWNoZSB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5cbmNvbnN0IGFwcFN3aXRjaGVyQ29uZmlnSXRlbVF1ZXJ5ID0gYG93bmVyOlwiZXNyaVwiIEFORCB0aXRsZTpcIkFwcFN3aXRjaGVyIENvbmZpZ1wiIEFORCB0eXBlOiBcIkFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb25cImA7XG5hc3luYyBmdW5jdGlvbiBnZXRQb3J0YWxTZXR0aW5ncyhwb3J0YWwpIHtcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGlmICghcG9ydGFsVXJsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gYCR7cG9ydGFsVXJsfXBvcnRhbHMvc2VsZi9zZXR0aW5nc2A7XG4gICAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiByZXF1ZXN0KHVybCksIFwicG9ydGFsU2V0dGluZ3NcIiwgcG9ydGFsVXJsKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNob3dJbkFwcExhdW5jaGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGdldFBvcnRhbFNldHRpbmdzKCk7XG4gICAgcmV0dXJuICgoX2EgPSBzZXR0aW5ncyA9PT0gbnVsbCB8fCBzZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2V0dGluZ3MucG9ydGFsQ29uZmlnUHJvcGVydGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNob3dJbkFwcExhdW5jaGVyKSB8fCBbXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcFN3aXRjaGVyQ29uZmlnSXRlbSgpIHtcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybCgpO1xuICAgIGlmICghcG9ydGFsVXJsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gYCR7cG9ydGFsVXJsfXNlYXJjaGA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB7XG4gICAgICAgIG51bTogMSxcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHNvcnRGaWVsZDogXCJ0aXRsZVwiLFxuICAgICAgICBzb3J0T3JkZXI6IFwiYXNjXCIsXG4gICAgICAgIHE6IGFwcFN3aXRjaGVyQ29uZmlnSXRlbVF1ZXJ5XG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRDb25maWdEYXRhKGl0ZW1JZCkge1xuICAgIGNvbnN0IHBvcnRhbFVybCA9IGdldFJlc3RCYXNlVXJsKCk7XG4gICAgaWYgKCFwb3J0YWxVcmwgfHwgIWl0ZW1JZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IGAke3BvcnRhbFVybH1jb250ZW50L2l0ZW1zLyR7aXRlbUlkfS9kYXRhYDtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0QXBwU3dpdGNoZXJDb25maWcoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBpZiAoIShwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaWQpIHx8ICF1c2VyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0QXBwU3dpdGNoZXJDb25maWdJdGVtKCk7XG4gICAgY29uc3QgaXRlbSA9IChfYSA9IHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgaWYgKCFpdGVtKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXRlbUlkID0gaXRlbS5pZDtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0Q29uZmlnRGF0YShpdGVtSWQpO1xuICAgIHJldHVybiBkYXRhO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlclByb3BlcnRpZXMoKSB7XG4gICAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfWNvbW11bml0eS91c2Vycy8ke3VzZXIudXNlcm5hbWV9L3Byb3BlcnRpZXNgO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRBcHByb3ZlZEFwcHMoKSB7XG4gICAgY29uc3QgeyBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vYXBwcm92ZWRBcHBzYDtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIHsgcmV0dXJuQWxsQXBwczogZmFsc2UgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEFsbFJlc291cmNlcyh1cmwsIGNvbnRlbnQsIHJlc291cmNlS2V5ID0gXCJyZXN1bHRzXCIpIHtcbiAgICBjb25zdCBtYXggPSAxMDA7XG4gICAgbGV0IHN0YXJ0ID0gMTtcbiAgICBsZXQgcmVzb3VyY2VzID0gW107XG4gICAgbGV0IHRvdGFsTGVmdDtcbiAgICBsZXQgbnVtUmVxdWVzdHM7XG4gICAgbGV0IHByb21pc2VzO1xuICAgIGxldCBpO1xuICAgIGNvbnRlbnQuc3RhcnQgPSBzdGFydDtcbiAgICBpZiAoIWNvbnRlbnQubnVtKSB7XG4gICAgICAgIGNvbnRlbnQubnVtID0gbWF4O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0KHVybCwgY29udGVudCk7XG4gICAgICAgIGlmICghKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdFtyZXNvdXJjZUtleV0pKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgICAgICB9XG4gICAgICAgIHJlc291cmNlcyA9IFsuLi5yZXNvdXJjZXMsIC4uLnJlc3VsdFtyZXNvdXJjZUtleV1dO1xuICAgICAgICAvLyBjYWxjdWxhdGUgd2hldGhlciBmdXJ0aGVyIGJhdGNoZXMgYXJlIG5lZWRlZFxuICAgICAgICBzdGFydCA9IHJlc3VsdC5uZXh0U3RhcnQ7XG4gICAgICAgIHRvdGFsTGVmdCA9IHJlc3VsdC50b3RhbCAtIHJlc291cmNlcy5sZW5ndGg7XG4gICAgICAgIG51bVJlcXVlc3RzID0gTWF0aC5jZWlsKHRvdGFsTGVmdCAvIG1heCk7XG4gICAgICAgIHByb21pc2VzID0gW107XG4gICAgICAgIC8vIHJlcXVlc3QgZWFjaCBuZWNlc3NhcnkgYmF0Y2hcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bVJlcXVlc3RzOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnRlbnQuc3RhcnQgPSBzdGFydCArIGkgKiBtYXg7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHJlcXVlc3QodXJsLCBjb250ZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHIpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvdXJjZXMgPSBbLi4ucmVzb3VyY2VzLCAuLi5yW3Jlc291cmNlS2V5XV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZXM7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChfYikge1xuICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGdldE1hcmtldFBsYWNlUHJvdmlzaW9uZWRMaXN0aW5ncygpIHtcbiAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9Y29tbXVuaXR5L3VzZXJzLyR7dXNlci51c2VybmFtZX0vcHJvdmlzaW9uZWRMaXN0aW5nc2A7XG4gICAgcmV0dXJuIGZldGNoQWxsUmVzb3VyY2VzKHVybCwgeyByZXR1cm5BcHBDbGllbnRJZHM6IHRydWUsIHJldHVybkFsbFByb3Zpc2lvbnM6IHRydWUgfSwgXCJwcm92aXNpb25lZExpc3RpbmdzXCIpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0T3JnQ2FwYWJpbGl0aWVzKCkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy9zZWxmL3N1YnNjcmlwdGlvbkluZm9gO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh1cmwpO1xuICAgICAgICByZXR1cm4gKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5vcmdDYXBhYmlsaXRpZXMpIHx8IFtdO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5QXBwSXRlbXNGb3JDaGFuZ2VzKGFwcHJvdmVkQXBwcywgcnVuUXVlcnkpIHtcbiAgICBpZiAoIXJ1blF1ZXJ5IHx8ICEoYXBwcm92ZWRBcHBzID09PSBudWxsIHx8IGFwcHJvdmVkQXBwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwcm92ZWRBcHBzLmxlbmd0aCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfXNlYXJjaGA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB7XG4gICAgICAgIG51bTogMTAwLFxuICAgICAgICBxOiBgaWQ6KCR7YXBwcm92ZWRBcHBzLm1hcCgoYSkgPT4gYFwiJHthLml0ZW1JZH1cImApLmpvaW4oXCIgT1IgXCIpfSlgXG4gICAgfSk7XG59XG5jb25zdCBibG9ja2VkQXBwc0NvbmZpZ0l0ZW1RdWVyeSA9IGBvd25lcjpcImVzcmlcIiBBTkQgdGl0bGU6XCJCbG9ja2VkQXBwcyBDb25maWdcIiBBTkQgdHlwZTogXCJBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uXCJgO1xuYXN5bmMgZnVuY3Rpb24gZ2V0QmxvY2thYmxlQXBwcygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9c2VhcmNoYDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7XG4gICAgICAgICAgICBudW06IDEwLFxuICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICBzb3J0RmllbGQ6IFwidGl0bGVcIixcbiAgICAgICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIixcbiAgICAgICAgICAgIHE6IGJsb2NrZWRBcHBzQ29uZmlnSXRlbVF1ZXJ5XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbUlkID0gKChfYiA9IChfYSA9IHJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlkKSB8fCBcIlwiO1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0Q29uZmlnRGF0YShpdGVtSWQpO1xuICAgICAgICByZXR1cm4gKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5ibG9ja2VkQXBwcykgfHwgW107XG4gICAgfVxuICAgIGNhdGNoIChfYykge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVycygpIHtcbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfXBvcnRhbHMvc2VsZi9zZXJ2ZXJzYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsKTtcbiAgICByZXR1cm4gKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zZXJ2ZXJzKSB8fCBbXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNpZ25pblNldHRpbmdzKCkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy9zZWxmL3NpZ25pblNldHRpbmdzYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsKTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5mdW5jdGlvbiBnZXRVcmwocGF0aCkge1xuICAgIGxldCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybCgpO1xuICAgIGlmIChwb3J0YWxVcmwuc2xpY2UoLTEpICE9PSBcIi9cIikge1xuICAgICAgICBwb3J0YWxVcmwgKz0gXCIvXCI7XG4gICAgfVxuICAgIHJldHVybiBgJHtwb3J0YWxVcmx9JHtwYXRofWA7XG59XG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0KHVybCwgcGFyYW1zKSB7XG4gICAgaWYgKCFwYXJhbXMpIHtcbiAgICAgICAgcGFyYW1zID0ge307XG4gICAgfVxuICAgIHBhcmFtcy5mID0gXCJqc29uXCI7XG4gICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgICBwYXJhbXMudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwpO1xuICAgIE9iamVjdC5rZXlzKHBhcmFtcykuZm9yRWFjaCgoa2V5KSA9PiB1cmxPYmouc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHBhcmFtc1trZXldKSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmxPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4gcmVzcG9uc2VEYXRhO1xufVxuYXN5bmMgZnVuY3Rpb24gcG9zdFJlcXVlc3QodXJsLCBkYXRhKSB7XG4gICAgZGF0YS5hcHBlbmQoXCJmXCIsIFwianNvblwiKTtcbiAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKCk7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICAgIGRhdGEuYXBwZW5kKFwidG9rZW5cIiwgdG9rZW4pO1xuICAgIH1cbiAgICBmZXRjaCh1cmwsIHsgbWV0aG9kOiBcIlBPU1RcIiwgYm9keTogZGF0YSB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVVzZXJQcm9wZXJ0aWVzKHByb3BlcnRpZXMpIHtcbiAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGdldFVybChgY29tbXVuaXR5L3VzZXJzLyR7dXNlci51c2VybmFtZX0vc2V0UHJvcGVydGllc2ApO1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBkYXRhLmFwcGVuZChcInByb3BlcnRpZXNcIiwgSlNPTi5zdHJpbmdpZnkocHJvcGVydGllcykpO1xuICAgIHJldHVybiBwb3N0UmVxdWVzdCh1cmwsIGRhdGEpO1xufVxuXG5leHBvcnQgeyBnZXRBcHBTd2l0Y2hlckNvbmZpZyBhcyBhLCBnZXRNYXJrZXRQbGFjZVByb3Zpc2lvbmVkTGlzdGluZ3MgYXMgYiwgZ2V0VXNlclByb3BlcnRpZXMgYXMgYywgZ2V0QXBwcm92ZWRBcHBzIGFzIGQsIGdldE9yZ0NhcGFiaWxpdGllcyBhcyBlLCBnZXRTaWduaW5TZXR0aW5ncyBhcyBmLCBnZXRTaG93SW5BcHBMYXVuY2hlciBhcyBnLCBnZXRCbG9ja2FibGVBcHBzIGFzIGgsIGdldFNlcnZlcnMgYXMgaSwgZ2V0UG9ydGFsU2V0dGluZ3MgYXMgaiwgZmV0Y2hBbGxSZXNvdXJjZXMgYXMgaywgcXVlcnlBcHBJdGVtc0ZvckNoYW5nZXMgYXMgcSwgdXBkYXRlVXNlclByb3BlcnRpZXMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcGktMmUzYTEzNmYuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGEgYXMgZ2V0QXNzZXRQYXRoLCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCwgRiBhcyBGcmFnbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgUyBhcyBTb3J0YWJsZSB9IGZyb20gJy4vc29ydGFibGUuZXNtLTdlNzg1NzgwLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyB1IGFzIHVwZGF0ZVVzZXJQcm9wZXJ0aWVzLCBnIGFzIGdldFNob3dJbkFwcExhdW5jaGVyLCBhIGFzIGdldEFwcFN3aXRjaGVyQ29uZmlnLCBiIGFzIGdldE1hcmtldFBsYWNlUHJvdmlzaW9uZWRMaXN0aW5ncywgYyBhcyBnZXRVc2VyUHJvcGVydGllcywgZCBhcyBnZXRBcHByb3ZlZEFwcHMsIGUgYXMgZ2V0T3JnQ2FwYWJpbGl0aWVzLCBmIGFzIGdldFNpZ25pblNldHRpbmdzLCBoIGFzIGdldEJsb2NrYWJsZUFwcHMsIGkgYXMgZ2V0U2VydmVycywgcSBhcyBxdWVyeUFwcEl0ZW1zRm9yQ2hhbmdlcyB9IGZyb20gJy4vYXBpLTJlM2ExMzZmLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwsIGUgYXMgZ2V0VG9rZW4gfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGdldENvb2tpZSwgZCBhcyBzZXRDb29raWUgfSBmcm9tICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYiBhcyBpc09yZ0FkbWluIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9pdGVtLTM1MzU1NTJkLmpzJztcblxuZnVuY3Rpb24gY29va2llRm9yUXVlcnlpbmdJdGVtc0V4aXN0cygpIHtcbiAgICBjb25zdCBjb29raWUgPSBnZXRDb29raWUoXCJBUFNXLXF1ZXJ5XCIsIHRydWUpO1xuICAgIGlmICgoY29va2llID09PSBudWxsIHx8IGNvb2tpZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29va2llLmV4cGlyZXMpID4gbmV3IERhdGUoKS5zZXRIb3VycyhuZXcgRGF0ZSgpLmdldEhvdXJzKCkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBRdWVyeSBmb3IgYXBwcm92ZWQgYXBwIGl0ZW1zIGV2ZXJ5IDUgaG91cnNcbiAgICBjb25zdCBwYXlsb2FkID0geyBleHBpcmVzOiBuZXcgRGF0ZSgpLnNldEhvdXJzKG5ldyBEYXRlKCkuZ2V0SG91cnMoKSArIDUpIH07XG4gICAgc2V0Q29va2llKFwiQVBTVy1xdWVyeVwiLCBwYXlsb2FkLCB7XG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgICBkb21haW46IGRvY3VtZW50LmRvbWFpbixcbiAgICAgICAgc2FtZVNpdGU6IFwiU3RyaWN0XCJcbiAgICB9LCB0cnVlKTtcbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmNvbnN0IGxpY2Vuc2VzID0ge307XG5mdW5jdGlvbiBoYXNMaWNlbnNlKGNsaWVudElkKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoKF9hID0gbGljZW5zZXNbY2xpZW50SWQudG9Mb3dlckNhc2UoKV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWxpZCkgfHwgZmFsc2U7XG59XG5mdW5jdGlvbiBpc0luUG9ydGFsQ29uZmlnKHRpdGxlLCBwb3J0YWwsIHNob3dJbkFwcExhdW5jaGVyKSB7XG4gICAgcmV0dXJuICFwb3J0YWwuaXNQb3J0YWwgfHwgc2hvd0luQXBwTGF1bmNoZXIuaW5kZXhPZih0aXRsZSkgPiAtMTtcbn1cbmZ1bmN0aW9uIGhhc0FjY2Vzc1RvT3BlbkRhdGEocG9ydGFsKSB7XG4gICAgaWYgKChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwucG9ydGFsUHJvcGVydGllcykgJiYgKCFwb3J0YWwucG9ydGFsUHJvcGVydGllcy5vcGVuRGF0YSB8fCAhcG9ydGFsLnBvcnRhbFByb3BlcnRpZXMub3BlbkRhdGEuZW5hYmxlZCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gaGFzTGljZW5zZShcIkh1YmZvckFyY0dJU1wiKTtcbn1cbmZ1bmN0aW9uIGhhc0FjY2Vzc1RvVmVsb2NpdHkodXNlcikge1xuICAgIGNvbnN0IHJlcXVpcmVzT25lT2YgPSBbXG4gICAgICAgIFwicG9ydGFsOnB1Ymxpc2hlcjpwdWJsaXNoRmVlZHNcIixcbiAgICAgICAgXCJwb3J0YWw6cHVibGlzaGVyOnB1Ymxpc2hSZWFsVGltZUFuYWx5dGljc1wiLFxuICAgICAgICBcInBvcnRhbDpwdWJsaXNoZXI6cHVibGlzaEJpZ0RhdGFBbmFseXRpY3NcIlxuICAgIF07XG4gICAgY29uc3QgcHJpdmlsZWdlcyA9ICh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW107XG4gICAgY29uc3QgaGFzUHJpdmlsZWdlID0gcHJpdmlsZWdlcy5zb21lKChwcml2aWxlZ2UpID0+IHJlcXVpcmVzT25lT2YuaW5kZXhPZihwcml2aWxlZ2UpID4gLTEpO1xuICAgIGNvbnN0IGhhc0NhcGFiaWxpdHkgPSBoYXNMaWNlbnNlKFwidmVsb2NpdHlcIik7XG4gICAgcmV0dXJuIGhhc1ByaXZpbGVnZSAmJiBoYXNDYXBhYmlsaXR5O1xufVxuZnVuY3Rpb24gaGFzQWNjZXNzVG9TaXRlcyhwb3J0YWwsIHRpdGxlLCBzaG93SW5BcHBMYXVuY2hlcikge1xuICAgIHJldHVybiBpc0luUG9ydGFsQ29uZmlnKHRpdGxlLCBwb3J0YWwsIHNob3dJbkFwcExhdW5jaGVyKSAmJiBoYXNMaWNlbnNlKFwiSHViZm9yQXJjR0lTXCIpO1xufVxuZnVuY3Rpb24gaGFzQWNjZXNzVG9NYXBWaWV3ZXIocG9ydGFsLCBuZXdNYXBWaWV3ZXJFbmFibGVkKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGRpc2FibGVkSW5BcHAgPSBwb3J0YWwuaXNQb3J0YWwgJiYgKChfYSA9IHBvcnRhbC5wb3J0YWxQcm9wZXJ0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmV3TWFwVmlld2VyRW5hYmxlZCkgPT09IGZhbHNlO1xuICAgIHJldHVybiBuZXdNYXBWaWV3ZXJFbmFibGVkICYmICFkaXNhYmxlZEluQXBwICYmIGhhc0xpY2Vuc2UoXCJhcmNnaXNXZWJBcHBzXCIpO1xufVxuZnVuY3Rpb24gaGFzQWNjZXNzVG9PcnRob01ha2VyKHBvcnRhbCwgc2hvd0luQXBwTGF1bmNoZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICghISgoX2EgPSBwb3J0YWwuaGVscGVyU2VydmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yYXN0ZXJBbmFseXRpY3MpICYmXG4gICAgICAgICEhcG9ydGFsLmhlbHBlclNlcnZpY2VzLm9ydGhvTWFwcGluZyAmJlxuICAgICAgICBpc0luUG9ydGFsQ29uZmlnKFwiT3J0aG8gTWFrZXJcIiwgcG9ydGFsLCBzaG93SW5BcHBMYXVuY2hlcikpO1xufVxuZnVuY3Rpb24gaGFzQWNjZXNzVG9Ob3RlYm9va3ModGl0bGUsIHBvcnRhbCwgdXNlciwgc2hvd0luQXBwTGF1bmNoZXIsIG5vdGVib29rU2VydmVyRW5hYmxlZCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBub3RlYm9va1NlcnZlckNvbmZpZ3VyZWQgPSBub3RlYm9va1NlcnZlckVuYWJsZWQgJiYgKCFwb3J0YWwuaXNQb3J0YWwgfHwgcG9ydGFsLnN1cHBvcnRzSG9zdGVkTm90ZWJvb2tzKTtcbiAgICBjb25zdCBjYW5DcmVhdGVOb3RlYm9va3MgPSAhISgoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgJiZcbiAgICAgICAgdXNlci5wcml2aWxlZ2VzLnNvbWUoKHByaXZpbGVnZSkgPT4gcHJpdmlsZWdlID09PSBcInByZW1pdW06cHVibGlzaGVyOmNyZWF0ZU5vdGVib29rc1wiKTtcbiAgICByZXR1cm4gbm90ZWJvb2tTZXJ2ZXJDb25maWd1cmVkICYmIGNhbkNyZWF0ZU5vdGVib29rcyAmJiBpc0luUG9ydGFsQ29uZmlnKHRpdGxlLCBwb3J0YWwsIHNob3dJbkFwcExhdW5jaGVyKTtcbn1cbmZ1bmN0aW9uIGhhc0FjY2Vzc1RvVHJhY2tWaWV3ZXIocG9ydGFsLCBzaG93SW5BcHBMYXVuY2hlciwgdHJhY2tWaWV3ZXJFbmFibGVkKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoISEoKF9hID0gcG9ydGFsLmhlbHBlclNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubG9jYXRpb25UcmFja2luZykgJiZcbiAgICAgICAgdHJhY2tWaWV3ZXJFbmFibGVkICYmXG4gICAgICAgIGlzSW5Qb3J0YWxDb25maWcoXCJUcmFjayBWaWV3ZXJcIiwgcG9ydGFsLCBzaG93SW5BcHBMYXVuY2hlcikpO1xufVxuXG5jb25zdCBhcmNnaXNBcHBTd2l0Y2hlckNzcyA9IFwiLmFwcHMtY29udGVudC1jb250YWluZXJ7cG9zaXRpb246cmVsYXRpdmV9LnRvZ2dsZS1idXR0b257bWFyZ2luOjBweDtkaXNwbGF5OmJsb2NrO2N1cnNvcjpwb2ludGVyO292ZXJmbG93OnZpc2libGU7Ym9yZGVyLXdpZHRoOjBweDtwYWRkaW5nOjBweDstd2Via2l0LWFwcGVhcmFuY2U6YnV0dG9uO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7aGVpZ2h0OjMuNXJlbTt3aWR0aDozLjVyZW19LnRvZ2dsZS1idXR0b246bm90KC50b2dnbGUtYnV0dG9uLS1leHBhbmRlZCk6aG92ZXJ7Ym94LXNoYWRvdzppbnNldCAwIC0zcHggMCAwIHJnYmEoMCwgMTIxLCAxOTMsIDAuNSl9LnRvZ2dsZS1idXR0b24tLWV4cGFuZGVke2JveC1zaGFkb3c6aW5zZXQgMCAtM3B4IDAgMCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0udG9nZ2xlLWJ1dHRvbl9faWNvbntkaXNwbGF5OmJsb2NrO2hlaWdodDoxLjVyZW07d2lkdGg6MS41cmVtfTpob3N0e3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0yKX0uYXBwcy1jb250ZW50e3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjBweDtkaXNwbGF5Om5vbmV9LmFwcHMtY29udGVudC0tcnRse2xlZnQ6MHB4O3JpZ2h0OmF1dG99LmFwcHMtY29udGVudC0tZXhwYW5kZWR7ZGlzcGxheTpibG9ja30uYXBwcy1jb250ZW50IDo6LXdlYmtpdC1zY3JvbGxiYXJ7d2lkdGg6MC41cmVtfS5hcHBzLWNvbnRlbnQgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYntib3JkZXItcmFkaXVzOnZhcigtLWNhbGNpdGUtYm9yZGVyLXJhZGl1cyk7YmFja2dyb3VuZC1jb2xvcjpyZ2JhKDAsIDAsIDAsIDAuNSk7Ym94LXNoYWRvdzowIDAgMXB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC41KX0uZHJvcGRvd24tbWVudXt0b3A6MHB4O2N1cnNvcjpkZWZhdWx0O292ZXJmbG93LXk6YXV0bztvdmVyZmxvdy14OmhpZGRlbjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSk7bWF4LWhlaWdodDo4NXZoO21heC13aWR0aDo0ODBweDttaW4td2lkdGg6NDc1cHh9LmludHJvLWNvbnRhaW5lcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7dGV4dC1hbGlnbjpjZW50ZXJ9LmludHJvLXRleHR7bWFyZ2luOjBweDtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7cGFkZGluZy1sZWZ0OjRyZW07cGFkZGluZy1yaWdodDo0cmVtO3BhZGRpbmctdG9wOjFyZW07cGFkZGluZy1ib3R0b206MC43NXJlbTtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpfS5hcHBzLWxpc3R7bWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7bGlzdC1zdHlsZS10eXBlOm5vbmU7ZmxleC1kaXJlY3Rpb246cm93O2ZsZXgtd3JhcDp3cmFwO292ZXJmbG93OmhpZGRlbjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7cGFkZGluZy10b3A6MC41cmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3RleHQtYWxpZ246bGVmdH0uYXBwcy1saXN0IC5zZWNvbmRhcnktZHJhZy10ZXh0e2Rpc3BsYXk6bm9uZX0uYXBwLWl0ZW17cG9zaXRpb246cmVsYXRpdmU7ZmxvYXQ6bm9uZTttYXJnaW46MHB4O2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmlubGluZS1ibG9jaztjdXJzb3I6cG9pbnRlcjtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7dGV4dC1hbGlnbjpsZWZ0O3ZlcnRpY2FsLWFsaWduOnRvcDtmb250LXNpemU6MC44NzVyZW07aGVpZ2h0OjExMHB4O3dpZHRoOjE1MHB4fUAtbW96LWRvY3VtZW50IHVybC1wcmVmaXgoKXsuYXBwLWl0ZW17d2lkdGg6MTQ2cHh9fS5hcHBzLWNvbnRlbnQ6bm90KC5hcHBzLWNvbnRlbnQtLWRyYWdnaW5nKSAuYXBwLWl0ZW06bm90KC5hcHAtaXRlbS0tbWlzc2luZyk6aG92ZXJ7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5hcHAtaXRlbS0tZHJhZ2dpbmd7b3V0bGluZS1vZmZzZXQ6LTFweH0uYXBwLWl0ZW0tLW1pc3Npbmd7cGFkZGluZy10b3A6MC41cmVtfS5zaG93LW1vcmV7ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCU7Y3Vyc29yOnBvaW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7Ym9yZGVyLXN0eWxlOm5vbmU7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7cGFkZGluZzowLjI1cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LnNlY29uZGFyeS1jb250YWluZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMik7cGFkZGluZy10b3A6MC4yNXJlbTtwYWRkaW5nLWJvdHRvbTowLjI1cmVtO2JvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTMpfS5zZWNvbmRhcnktY29udGFpbmVyLS1oaWRkZW57ZGlzcGxheTpub25lfS5zZWNvbmRhcnktdGFyZ2V0e21hcmdpbi10b3A6MC43NXJlbTttYXJnaW4tYm90dG9tOjAuNzVyZW07bWFyZ2luLWxlZnQ6MS41cmVtO21hcmdpbi1yaWdodDoxLjVyZW07b3ZlcmZsb3c6aGlkZGVuO3BhZGRpbmctbGVmdDoycmVtO3BhZGRpbmctcmlnaHQ6MnJlbTt0ZXh0LWFsaWduOmNlbnRlcjtmb250LXNpemU6MC44NzVyZW07Ym9yZGVyOjJweCBkYXNoZWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMik7bGV0dGVyLXNwYWNpbmc6bm9ybWFsO2hlaWdodDoxMDBweH0uc2Vjb25kYXJ5LXRhcmdldC0taG92ZXJ7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5zZWNvbmRhcnktbGlzdHttYXJnaW46MHB4O3BhZGRpbmctdG9wOjAuNzVyZW07cGFkZGluZy1ib3R0b206MC43NXJlbTtwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3RleHQtYWxpZ246bGVmdH1cIjtcblxuY29uc3QgQXJjZ2lzQXBwU3dpdGNoZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyVG9nZ2xlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNBcHBTd2l0Y2hlclRvZ2dsZVwiLCA3KTtcbiAgICAgICAgdGhpcy53aWxsUXVlcnlGb3JJdGVtcyA9IHRydWU7XG4gICAgICAgIHRoaXMuYmxvY2tlZEFwcHMgPSBbXTtcbiAgICAgICAgdGhpcy5zaG93SW5BcHBMYXVuY2hlciA9IFtdO1xuICAgICAgICB0aGlzLnNlcnZlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5vcmdDYXBhYmlsaXRpZXMgPSBbXTtcbiAgICAgICAgdGhpcy51cGRhdGVBcHBzUHJvcGVydGllcyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlJZHMgPSB0aGlzLmdldElkc0Zyb21ET00odGhpcy5wcmltYXJ5Q29udGFpbmVyKTtcbiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlBcHBzID0gdGhpcy5nZXRBcHBzQnlJZHMocHJpbWFyeUlkcyk7XG4gICAgICAgICAgICBjb25zdCBwcmltYXJ5ID0gdGhpcy5jb252ZXJ0VG9BcHBEYXRhKHByaW1hcnlBcHBzKTtcbiAgICAgICAgICAgIGNvbnN0IHNlY29uZGFyeUlkcyA9IHRoaXMuZ2V0SWRzRnJvbURPTSh0aGlzLnNlY29uZGFyeUNvbnRhaW5lcik7XG4gICAgICAgICAgICBjb25zdCBzZWNvbmRhcnlBcHBzID0gdGhpcy5nZXRBcHBzQnlJZHMoc2Vjb25kYXJ5SWRzKTtcbiAgICAgICAgICAgIGNvbnN0IHNlY29uZGFyeSA9IHRoaXMuY29udmVydFRvQXBwRGF0YShzZWNvbmRhcnlBcHBzKTtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy51c2VyUHJvcGVydGllcyk7XG4gICAgICAgICAgICB1cGRhdGVkUHJvcGVydGllcy5hcHBMYXVuY2hlciA9IHsgcHJpbWFyeSwgc2Vjb25kYXJ5IH07XG4gICAgICAgICAgICBhd2FpdCB1cGRhdGVVc2VyUHJvcGVydGllcyh1cGRhdGVkUHJvcGVydGllcyk7XG4gICAgICAgICAgICB0aGlzLnVzZXJQcm9wZXJ0aWVzID0gdXBkYXRlZFByb3BlcnRpZXM7XG4gICAgICAgICAgICBjb25zdCBwcmV2aW91c1NlY29uZGFyeUNvdW50ID0gdGhpcy5zZWNvbmRhcnlBcHBzLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMucHJpbWFyeUFwcHMgPSBwcmltYXJ5QXBwcztcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QXBwcyA9IHNlY29uZGFyeUFwcHM7XG4gICAgICAgICAgICBpZiAocHJldmlvdXNTZWNvbmRhcnlDb3VudCA+IDAgJiYgIXRoaXMuc2Vjb25kYXJ5QXBwcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBhbGwgYXBwcyBhcmUgcmVtb3ZlZCBmcm9tIHNlY29uZGFyeSwgc2hvdyB0aGUgZHJhZyBib3ggYW5kIHRleHRcbiAgICAgICAgICAgICAgICB0aGlzLmhvdmVyaW5nT3ZlclNlY29uZGFyeSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVRvZ2dsZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNFeHBhbmRlZCA9ICF0aGlzLmlzRXhwYW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyVG9nZ2xlLmVtaXQodGhpcy5pc0V4cGFuZGVkKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVTaG93TW9yZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5RXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZURpc21pc3NJbnRybyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQXBwc1Byb3BlcnRpZXMoKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUludHJvID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMua2V5ZG93bkhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiYgdGhpcy5pc0V4cGFuZGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVUb2dnbGUoKTtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLnRvZ2dsZUJ1dHRvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5ld01hcFZpZXdlckVuYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLm5vdGVib29rU2VydmVyRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMudHJhY2tWaWV3ZXJFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG91bGRFeHBhbmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kaXNwbGF5SW50cm8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcmltYXJ5QXBwcyA9IFtdO1xuICAgICAgICB0aGlzLnNlY29uZGFyeUFwcHMgPSBbXTtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaG92ZXJpbmdPdmVyU2Vjb25kYXJ5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5RXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zb3J0aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZm9jdXNJdGVtSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFuZGxlTGlua0NsaWNrKCkge1xuICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hcmNnaXNBcHBTd2l0Y2hlclRvZ2dsZS5lbWl0KHRoaXMuaXNFeHBhbmRlZCk7XG4gICAgfVxuICAgIGhhbmRsZUxpbmtBY3RpdmF0ZWQoKSB7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5RXhwYW5kZWQgPSB0cnVlO1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVMaW5rTW92ZShldnQpIHtcbiAgICAgICAgY29uc3QgeyB1aWQsIGtleUNvZGUsIGluZGV4IH0gPSBldnQuZGV0YWlsO1xuICAgICAgICB0aGlzLmZvY3VzSXRlbUlkID0gdWlkO1xuICAgICAgICBjb25zdCBwcmltYXJ5VG90YWwgPSB0aGlzLnByaW1hcnlBcHBzLmxlbmd0aDtcbiAgICAgICAgY29uc3Qgc2Vjb25kYXJ5VG90YWwgPSB0aGlzLnNlY29uZGFyeUFwcHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBpc0luUHJpbWFyeSA9IGluZGV4IDwgcHJpbWFyeVRvdGFsO1xuICAgICAgICBsZXQgdGFyZ2V0UHJpbWFyeTtcbiAgICAgICAgaWYgKGlzSW5QcmltYXJ5KSB7XG4gICAgICAgICAgICBjb25zdCByb3dDb3VudCA9IE1hdGguY2VpbChwcmltYXJ5VG90YWwgLyAzKTtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RSb3dGaXJzdEluZGV4ID0gcm93Q291bnQgKiAzIC0gMztcbiAgICAgICAgICAgIGlmIChpbmRleCA8IGxhc3RSb3dGaXJzdEluZGV4KSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJpbWFyeSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChrZXlDb2RlID09PSBcIkFycm93TGVmdFwiIHx8IGtleUNvZGUgPT09IFwiQXJyb3dVcFwiKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJpbWFyeSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChrZXlDb2RlID09PSBcIkFycm93UmlnaHRcIiAmJiBpbmRleCA8IHByaW1hcnlUb3RhbCAtIDEpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRQcmltYXJ5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldFByaW1hcnkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA+PSBwcmltYXJ5VG90YWwgKyAzKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJpbWFyeSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5Q29kZSA9PT0gXCJBcnJvd1JpZ2h0XCIgfHwga2V5Q29kZSA9PT0gXCJBcnJvd0Rvd25cIikge1xuICAgICAgICAgICAgICAgIHRhcmdldFByaW1hcnkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGtleUNvZGUgPT09IFwiQXJyb3dMZWZ0XCIgJiYgaW5kZXggPiBwcmltYXJ5VG90YWwpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRQcmltYXJ5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRQcmltYXJ5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0SW5kZXggPSAtMTtcbiAgICAgICAgY29uc3Qgc2FtZUxpc3QgPSAoaXNJblByaW1hcnkgJiYgdGFyZ2V0UHJpbWFyeSkgfHwgKCFpc0luUHJpbWFyeSAmJiAhdGFyZ2V0UHJpbWFyeSk7XG4gICAgICAgIGlmIChzYW1lTGlzdCkge1xuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IFwiQXJyb3dVcFwiKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0SW5kZXggPSBpbmRleCAtIDM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChrZXlDb2RlID09PSBcIkFycm93UmlnaHRcIikge1xuICAgICAgICAgICAgICAgIHRhcmdldEluZGV4ID0gaW5kZXggKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5Q29kZSA9PT0gXCJBcnJvd0Rvd25cIikge1xuICAgICAgICAgICAgICAgIHRhcmdldEluZGV4ID0gaW5kZXggKyAzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5Q29kZSA9PT0gXCJBcnJvd0xlZnRcIikge1xuICAgICAgICAgICAgICAgIHRhcmdldEluZGV4ID0gaW5kZXggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGlzSW5QcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IFwiQXJyb3dSaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEluZGV4ID0gcHJpbWFyeVRvdGFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChrZXlDb2RlID09PSBcIkFycm93RG93blwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEluZGV4ID0gKGluZGV4ICUgMykgKyBwcmltYXJ5VG90YWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0SW5kZXggPSBwcmltYXJ5VG90YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGFwcDtcbiAgICAgICAgaWYgKGlzSW5QcmltYXJ5KSB7XG4gICAgICAgICAgICBhcHAgPSB0aGlzLnByaW1hcnlBcHBzLnNwbGljZShpbmRleCwgMSlbMF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhcHAgPSB0aGlzLnNlY29uZGFyeUFwcHMuc3BsaWNlKGluZGV4IC0gcHJpbWFyeVRvdGFsLCAxKVswXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGFyZ2V0UHJpbWFyeSkge1xuICAgICAgICAgICAgdGhpcy5wcmltYXJ5QXBwcy5zcGxpY2UodGFyZ2V0SW5kZXgsIDAsIGFwcCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzZWNvbmRhcnlJbmRleCA9IHRhcmdldEluZGV4IC0gcHJpbWFyeVRvdGFsO1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlBcHBzLnNwbGljZShzZWNvbmRhcnlJbmRleCwgMCwgYXBwKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmltYXJ5ID0gdGhpcy5jb252ZXJ0VG9BcHBEYXRhKHRoaXMucHJpbWFyeUFwcHMpO1xuICAgICAgICBjb25zdCBzZWNvbmRhcnkgPSB0aGlzLmNvbnZlcnRUb0FwcERhdGEodGhpcy5zZWNvbmRhcnlBcHBzKTtcbiAgICAgICAgY29uc3QgdXBkYXRlZFByb3BlcnRpZXMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnVzZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgdXBkYXRlZFByb3BlcnRpZXMuYXBwTGF1bmNoZXIgPSB7IHByaW1hcnksIHNlY29uZGFyeSB9O1xuICAgICAgICBhd2FpdCB1cGRhdGVVc2VyUHJvcGVydGllcyh1cGRhdGVkUHJvcGVydGllcyk7XG4gICAgICAgIHRoaXMudXNlclByb3BlcnRpZXMgPSB1cGRhdGVkUHJvcGVydGllcztcbiAgICAgICAgaWYgKHNlY29uZGFyeVRvdGFsID4gMCAmJiAhdGhpcy5zZWNvbmRhcnlBcHBzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5ob3ZlcmluZ092ZXJTZWNvbmRhcnkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyByZXNldCBhZnRlciBzZXR0aW5nIGZvY3VzXG4gICAgICAgICAgICB0aGlzLmZvY3VzSXRlbUlkID0gXCJcIjtcbiAgICAgICAgfSwgMTAwKTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlTGlua1JlbW92ZShldnQpIHtcbiAgICAgICAgY29uc3QgaWQgPSBldnQuZGV0YWlsO1xuICAgICAgICBjb25zdCB1cGRhdGVkUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudXNlclByb3BlcnRpZXMpO1xuICAgICAgICBsZXQgeyBwcmltYXJ5LCBzZWNvbmRhcnkgfSA9IHVwZGF0ZWRQcm9wZXJ0aWVzLmFwcExhdW5jaGVyO1xuICAgICAgICBwcmltYXJ5ID0gcHJpbWFyeS5maWx0ZXIoKGFwcCkgPT4gYXBwLnVpZCAhPT0gaWQpO1xuICAgICAgICBzZWNvbmRhcnkgPSBzZWNvbmRhcnkuZmlsdGVyKChhcHApID0+IGFwcC51aWQgIT09IGlkKTtcbiAgICAgICAgdXBkYXRlZFByb3BlcnRpZXMuYXBwTGF1bmNoZXIgPSB7IHByaW1hcnksIHNlY29uZGFyeSB9O1xuICAgICAgICBhd2FpdCB1cGRhdGVVc2VyUHJvcGVydGllcyh1cGRhdGVkUHJvcGVydGllcyk7XG4gICAgICAgIHRoaXMudXNlclByb3BlcnRpZXMgPSB1cGRhdGVkUHJvcGVydGllcztcbiAgICAgICAgdGhpcy5wcmltYXJ5QXBwcyA9IHRoaXMucHJpbWFyeUFwcHMuZmlsdGVyKChhcHApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFwcElkID0gYXBwLml0ZW1JZCB8fCBhcHAudGl0bGU7XG4gICAgICAgICAgICByZXR1cm4gYXBwSWQgIT09IGlkO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlBcHBzID0gdGhpcy5zZWNvbmRhcnlBcHBzLmZpbHRlcigoYXBwKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhcHBJZCA9IGFwcC5pdGVtSWQgfHwgYXBwLnRpdGxlO1xuICAgICAgICAgICAgcmV0dXJuIGFwcElkICE9PSBpZDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhhbmRsZVNob3VsZEV4cGFuZENoYW5nZShuZXdWYWx1ZSkge1xuICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSBuZXdWYWx1ZTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgY29uc3QgbW9iaWxlRGV2aWNlcyA9IFsvQW5kcm9pZC9pLCAvd2ViT1MvaSwgL2lQaG9uZS9pLCAvaVBhZC9pXTtcbiAgICAgICAgY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXZpY2VzLnNvbWUoKGRldmljZSkgPT4gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaChkZXZpY2UpKTtcbiAgICAgICAgaWYgKGlzTW9iaWxlKSB7XG4gICAgICAgICAgICAvLyBjdXJyZW50bHkgc29ydGFibGVKUyBpbnNpZGUgU2hhZG93IERPTSBpcyBub3Qgd29ya2luZyBjb3JyZWN0bHkgb24gbW9iaWxlLCBzbyBhdm9pZGluZyB0aGlzXG4gICAgICAgICAgICAvLyB0aGlzIHNob3VsZCBhbHNvIGFsbG93IHNjcm9sbGluZyB0aGUgYXBwcyBsaXN0IG9uIG1vYmlsZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFNvcnRhYmxlLmNyZWF0ZSh0aGlzLnByaW1hcnlDb250YWluZXIsIHtcbiAgICAgICAgICAgIGFuaW1hdGlvbjogMTUwLFxuICAgICAgICAgICAgZ3JvdXA6IFwiYXBwc1wiLFxuICAgICAgICAgICAgZmlsdGVyOiBcIi5zZWNvbmRhcnktZHJhZy10ZXh0XCIsXG4gICAgICAgICAgICBkcmFnQ2xhc3M6IFwiYXBwLWl0ZW0tLWRyYWdnaW5nXCIsXG4gICAgICAgICAgICBvblVwZGF0ZTogdGhpcy51cGRhdGVBcHBzUHJvcGVydGllcyxcbiAgICAgICAgICAgIG9uQWRkOiB0aGlzLnVwZGF0ZUFwcHNQcm9wZXJ0aWVzLFxuICAgICAgICAgICAgb25Nb3ZlOiAocGFyYW1zKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmluZ092ZXJTZWNvbmRhcnkgPSBwYXJhbXMudG8uY2xhc3NOYW1lID09PSBcInNlY29uZGFyeS10YXJnZXRcIjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblN0YXJ0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZ2luZyA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FbmQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBTb3J0YWJsZS5jcmVhdGUodGhpcy5zZWNvbmRhcnlDb250YWluZXIsIHtcbiAgICAgICAgICAgIGFuaW1hdGlvbjogMTUwLFxuICAgICAgICAgICAgZ3JvdXA6IFwiYXBwc1wiLFxuICAgICAgICAgICAgZmlsdGVyOiBcIi5zZWNvbmRhcnktZHJhZy10ZXh0XCIsXG4gICAgICAgICAgICBkcmFnQ2xhc3M6IFwiYXBwLWl0ZW0tLWRyYWdnaW5nXCIsXG4gICAgICAgICAgICBvblVwZGF0ZTogdGhpcy51cGRhdGVBcHBzUHJvcGVydGllcyxcbiAgICAgICAgICAgIG9uQWRkOiB0aGlzLnVwZGF0ZUFwcHNQcm9wZXJ0aWVzXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRSZW5kZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnByaW1hcnlDb250YWluZXIuY29udGFpbnModGhpcy5zZWNvbmRhcnlEcmFnVGV4dCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuc2Vjb25kYXJ5RHJhZ1RleHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVbMF07XG4gICAgICAgIHRoaXMud2lsbFF1ZXJ5Rm9ySXRlbXMgPSBjb29raWVGb3JRdWVyeWluZ0l0ZW1zRXhpc3RzKCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbmZpZygpO1xuICAgICAgICBpZiAoISgoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgfHwgIWNvbmZpZ1N0YXRlLnVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dJbkFwcExhdW5jaGVyID0gYXdhaXQgZ2V0U2hvd0luQXBwTGF1bmNoZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbY29uZmlnLCBtYXJrZXRwbGFjZSwgcHJlZmVyZW5jZXMsIGN1c3RvbU9yZ0FwcHMsIG9yZ0NhcGFiaWxpdGllc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICBnZXRBcHBTd2l0Y2hlckNvbmZpZygpLFxuICAgICAgICAgICAgZ2V0TWFya2V0UGxhY2VQcm92aXNpb25lZExpc3RpbmdzKCksXG4gICAgICAgICAgICBnZXRVc2VyUHJvcGVydGllcygpLFxuICAgICAgICAgICAgZ2V0QXBwcm92ZWRBcHBzKCksXG4gICAgICAgICAgICBnZXRPcmdDYXBhYmlsaXRpZXMoKVxuICAgICAgICBdKTtcbiAgICAgICAgdGhpcy5vcmdDYXBhYmlsaXRpZXMgPSBvcmdDYXBhYmlsaXRpZXM7XG4gICAgICAgIHRoaXMudXNlclByb3BlcnRpZXMgPSAocHJlZmVyZW5jZXMgPT09IG51bGwgfHwgcHJlZmVyZW5jZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZWZlcmVuY2VzLnByb3BlcnRpZXMpIHx8IHt9O1xuICAgICAgICB0aGlzLnVzZXJBcHBzID0gY29uZmlnID09PSBudWxsIHx8IGNvbmZpZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnLmFwcFN3aXRjaGVyO1xuICAgICAgICBpZiAoIWNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCkge1xuICAgICAgICAgICAgdGhpcy51c2VyQXBwcy5hcHBzLnVuc2hpZnQodGhpcy5nZXRBZ29BcHAoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHByb3ZlZEFwcHMgPVxuICAgICAgICAgICAgKChfYiA9IGN1c3RvbU9yZ0FwcHMuYXBwcm92ZWRBcHBzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZmlsdGVyKChhcHApID0+ICFhcHAuaGlkZUZvck5vblByaXZpbGVnZWRNZW1iZXIpKSB8fCBbXTtcbiAgICAgICAgaWYgKCF0aGlzLnVzZXJQcm9wZXJ0aWVzLmFwcExhdW5jaGVyKSB7XG4gICAgICAgICAgICB0aGlzLndpbGxRdWVyeUZvckl0ZW1zID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlJbnRybyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm92aXNpb25lZExpc3RpbmdzID0gbWFya2V0cGxhY2UgfHwgW107XG4gICAgICAgIHRoaXMucHJvdmlzaW9uZWRMaXN0aW5ncy5mb3JFYWNoKChsaXN0aW5nKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRJZCA9IChfYSA9IGxpc3RpbmcuY2xpZW50SWQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKGNsaWVudElkKSB7XG4gICAgICAgICAgICAgICAgbGljZW5zZXNbY2xpZW50SWRdID0ge1xuICAgICAgICAgICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaXRlbUlkOiBsaXN0aW5nLml0ZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50SWQ6IGxpc3RpbmcuY2xpZW50SWRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb3JnQ2FwYWJpbGl0aWVzID09PSBudWxsIHx8IG9yZ0NhcGFiaWxpdGllcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3JnQ2FwYWJpbGl0aWVzLmZvckVhY2goKGNhcGFiaWxpdHkpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IGNhcGFiaWxpdHlJZCA9IChfYSA9IGNhcGFiaWxpdHkuaWQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKGNhcGFiaWxpdHlJZCkge1xuICAgICAgICAgICAgICAgIGxpY2Vuc2VzW2NhcGFiaWxpdHlJZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjbGllbnRJZDogY2FwYWJpbGl0eS5pZFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgdGhpcy5wcmltYXJ5QXBwcy5mb3JFYWNoKChhcHApID0+IHtcbiAgICAgICAgICAgIGFwcC5mb250U2l6ZSA9IHRoaXMuY2FsY0ZvbnRTaXplKGFwcCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb252ZXJ0VG9BcHBEYXRhKGFwcHMpIHtcbiAgICAgICAgcmV0dXJuIGFwcHMubWFwKChhcHApID0+ICh7IGxhYmVsOiBhcHAubGFiZWwsIHVpZDogYXBwLml0ZW1JZCB8fCBhcHAudGl0bGUgfSkpO1xuICAgIH1cbiAgICBnZXRBcHBzQnlJZHMoaWRzKSB7XG4gICAgICAgIGNvbnN0IGFwcHMgPSBbLi4udGhpcy5wcmltYXJ5QXBwcywgLi4udGhpcy5zZWNvbmRhcnlBcHBzXTtcbiAgICAgICAgcmV0dXJuIGlkcy5tYXAoKGlkKSA9PiBhcHBzLmZpbmQoKGFwcCkgPT4gYXBwLml0ZW1JZCA9PT0gaWQgfHwgYXBwLnRpdGxlID09PSBpZCkpO1xuICAgIH1cbiAgICBnZXRJZHNGcm9tRE9NKGNvbnRhaW5lcikge1xuICAgICAgICBjb25zdCBpZHMgPSBbXTtcbiAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYXBwLWl0ZW1cIikuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICAgIGlkcy5wdXNoKGVsLmRhdGFzZXQuaWQpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGlkcztcbiAgICB9XG4gICAgZ2V0VGV4dFdpZHRoKHRleHQpIHtcbiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNvbnRleHQuZm9udCA9IFwiYXZlbmlyXCI7XG4gICAgICAgIGNvbnN0IG1ldHJpY3MgPSBjb250ZXh0Lm1lYXN1cmVUZXh0KHRleHQpO1xuICAgICAgICByZXR1cm4gbWV0cmljcy53aWR0aDtcbiAgICB9XG4gICAgY2FsY0ZvbnRTaXplKGFwcCkge1xuICAgICAgICBpZiAoIWFwcC5hYmJyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWJicmV2aWF0aW9uU2l6ZXMgPSBbMCwgMzIsIDI0LCAyMCwgMTgsIDE2LCAxNCwgMTIsIDEwLCA4LCA2XTtcbiAgICAgICAgbGV0IHN0cldpZHRoID0gTWF0aC5jZWlsKHRoaXMuZ2V0VGV4dFdpZHRoKGFwcC5hYmJyKSAvIDUpO1xuICAgICAgICBpZiAoc3RyV2lkdGggPiBhYmJyZXZpYXRpb25TaXplcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBzdHJXaWR0aCA9IGFiYnJldmlhdGlvblNpemVzLmxlbmd0aCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke2FiYnJldmlhdGlvblNpemVzW3N0cldpZHRoXX1weGA7XG4gICAgfVxuICAgIGFzeW5jIGdldEJsb2NrZWRBcHBzKCkge1xuICAgICAgICBjb25zdCBbc2lnbmluU2V0dGluZ3MsIGJsb2NrYWJsZUFwcHNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgZ2V0U2lnbmluU2V0dGluZ3MoKSxcbiAgICAgICAgICAgIGdldEJsb2NrYWJsZUFwcHMoKVxuICAgICAgICBdKTtcbiAgICAgICAgY29uc3QgY2xpZW50SWRzID0gKHNpZ25pblNldHRpbmdzID09PSBudWxsIHx8IHNpZ25pblNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaWduaW5TZXR0aW5ncy5ibG9ja2VkQXBwcykgfHwgW107XG4gICAgICAgIGlmICgoIWNsaWVudElkcy5sZW5ndGggJiYgIXNpZ25pblNldHRpbmdzLmJsb2NrQmV0YUFwcHMpIHx8ICEoYmxvY2thYmxlQXBwcyA9PT0gbnVsbCB8fCBibG9ja2FibGVBcHBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBibG9ja2FibGVBcHBzLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2lnbmluU2V0dGluZ3MuYmxvY2tCZXRhQXBwcykge1xuICAgICAgICAgICAgYmxvY2thYmxlQXBwcy5mb3JFYWNoKChhcHApID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYXBwLmlzQmV0YSAmJiAhY2xpZW50SWRzLmluY2x1ZGVzKGFwcC5jbGllbnRpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50SWRzLnB1c2goYXBwLmNsaWVudGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjbGllbnRJZHMuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gYmxvY2thYmxlQXBwcy5maW5kKChhcHApID0+IGFwcC5jbGllbnRpZCA9PT0gaWQpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VkQXBwcy5wdXNoKG1hdGNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmJsb2NrZWRBcHBzO1xuICAgIH1cbiAgICBmaWx0ZXJCbG9ja2VkQXBwcyhhcHBzKSB7XG4gICAgICAgIHJldHVybiBhcHBzLmZpbHRlcigoYXBwKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBpbkJsb2NrZWRMaXN0ID0gKF9hID0gdGhpcy5ibG9ja2VkQXBwcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNvbWUoKGJhKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhcHAuaXRlbUlkICYmIGFwcC5pdGVtSWQgPT09IGJhLml0ZW1pZCkgfHwgKGFwcC50aXRsZSAmJiBhcHAudGl0bGUgPT09IGJhLnRpdGxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuICFpbkJsb2NrZWRMaXN0O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcG9wdWxhdGVBcHBJZGVudGlmaWVycyhwcmV2LCBhcHApIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IE9iamVjdC5rZXlzKHRoaXMuYXBwRGljdGlvbmFyeSkubWFwKChrZXkpID0+IHRoaXMuYXBwRGljdGlvbmFyeVtrZXldKTtcbiAgICAgICAgbGV0IHBvcHVsYXRlZEFwcCA9IGxpc3QuZmlsdGVyKChhKSA9PiBhLml0ZW1JZCA9PT0gYXBwLnVpZCB8fCBhLnRpdGxlID09PSBhcHAudWlkKS5zaGlmdCgpO1xuICAgICAgICBpZiAocG9wdWxhdGVkQXBwICYmICF0aGlzLmFwcERpY3Rpb25hcnlbYXBwLnVpZF0pIHtcbiAgICAgICAgICAgIGFwcC51aWQgPSBwb3B1bGF0ZWRBcHAuaXRlbUlkIHx8IHBvcHVsYXRlZEFwcC50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9wdWxhdGVkQXBwID09PSBudWxsIHx8IHBvcHVsYXRlZEFwcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9wdWxhdGVkQXBwLmhhc0JlZW5Qb3B1bGF0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmV2O1xuICAgICAgICB9XG4gICAgICAgIGlmICghcG9wdWxhdGVkQXBwKSB7XG4gICAgICAgICAgICAvLyBBcHAgQ2FuJ3QgYmUgRm91bmRcbiAgICAgICAgICAgIHBvcHVsYXRlZEFwcCA9IGFwcDtcbiAgICAgICAgICAgIHBvcHVsYXRlZEFwcC5jYW5BY2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHBvcHVsYXRlZEFwcC5pdGVtSWQgPSBhcHAudWlkO1xuICAgICAgICAgICAgdGhpcy5hcHBEaWN0aW9uYXJ5W2FwcC51aWRdID0gcG9wdWxhdGVkQXBwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gLS0gSW5zZXJ0IGludG8gRGljdGlvbmFyeSAtLVxuICAgICAgICAgICAgaWYgKChhcHAuaGFzQ2hhbmdlZCB8fFxuICAgICAgICAgICAgICAgIHBvcHVsYXRlZEFwcC5oYXNDaGFuZ2VkIHx8XG4gICAgICAgICAgICAgICAgKCFwb3B1bGF0ZWRBcHAuY2FuQWNjZXNzICYmICFwb3B1bGF0ZWRBcHAuaWdub3JlTm9BY2Nlc3MpKSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuaXNBZG1pbigpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBEaWN0aW9uYXJ5W2FwcC51aWRdLmhhc0NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwRGljdGlvbmFyeVthcHAudWlkXS5pZ25vcmVOb0FjY2VzcyA9IGFwcC5pZ25vcmVOb0FjY2VzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcHAuaXNOZXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcERpY3Rpb25hcnlbYXBwLnVpZF0uaXNOZXcgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMubmV3QXBwRGljdGlvbmFyeVthcHAudWlkXTtcbiAgICAgICAgfVxuICAgICAgICAvLyAtLSBQcmV2ZW50IGR1cGxpY2F0ZXMgZnJvbSBhbnkgcG9zc2libGUgZXJyb3Igc3RhdGVzXG4gICAgICAgIHRoaXMuYXBwRGljdGlvbmFyeVthcHAudWlkXS5oYXNCZWVuUG9wdWxhdGVkID0gdHJ1ZTtcbiAgICAgICAgcHJldi5wdXNoKHBvcHVsYXRlZEFwcCk7XG4gICAgICAgIHJldHVybiBwcmV2O1xuICAgIH1cbiAgICBpc0luUG9ydGFsQ29uZmlnKHRpdGxlKSB7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIGlzSW5Qb3J0YWxDb25maWcodGl0bGUsIHBvcnRhbCwgdGhpcy5zaG93SW5BcHBMYXVuY2hlcik7XG4gICAgfVxuICAgIGdldEFwcEV4Y2VwdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiT3BlbiBEYXRhXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICgpID0+IGhhc0FjY2Vzc1RvT3BlbkRhdGEocG9ydGFsKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEFwcFN0dWRpbzoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKCkgPT4gaGFzTGljZW5zZShcImFyY2dpc1dlYkFwcHNcIilcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBWZWxvY2l0eVwiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAoKSA9PiBoYXNBY2Nlc3NUb1ZlbG9jaXR5KHVzZXIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBcmNHSVMgSHViXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICgpID0+IGhhc0xpY2Vuc2UoXCJIdWJmb3JBcmNHSVNcIilcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBFbnRlcnByaXNlIFNpdGVzXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICh0aXRsZSkgPT4gaGFzQWNjZXNzVG9TaXRlcyhwb3J0YWwsIHRpdGxlLCB0aGlzLnNob3dJbkFwcExhdW5jaGVyKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiQXJjR0lTIEV4cGVyaWVuY2UgQnVpbGRlclwiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBTdG9yeU1hcHNcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiB0aGlzLmlzSW5Qb3J0YWxDb25maWcodGl0bGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBcmNHSVMgUXVpY2tDYXB0dXJlIFdlYiBEZXNpZ25lclwiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSkgJiYgaGFzTGljZW5zZShcImFyY2dpc1dlYkFwcHNcIilcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBDb2xsZWN0b3JcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiB0aGlzLmlzSW5Qb3J0YWxDb25maWcodGl0bGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBcmNHSVMgRmllbGQgTWFwc1wiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBEYXNoYm9hcmRzXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICh0aXRsZSkgPT4gdGhpcy5pc0luUG9ydGFsQ29uZmlnKHRpdGxlKSAmJiBoYXNMaWNlbnNlKFwiZGFzaGJvYXJkc1wiKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiQXJjR0lTIFNvbHV0aW9uc1wiOiB7XG4gICAgICAgICAgICAgICAgLy8gRm9yIFBvcnRhbFxuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiB0aGlzLmlzSW5Qb3J0YWxDb25maWcodGl0bGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBcmNHSVMgV29ya2ZvcmNlXCI6IHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgUG9ydGFsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkRlZXAgTGVhcm5pbmcgU3R1ZGlvXCI6IHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgUG9ydGFsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIk1hcCBWaWV3ZXJcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKCkgPT4gaGFzQWNjZXNzVG9NYXBWaWV3ZXIocG9ydGFsLCB0aGlzLm5ld01hcFZpZXdlckVuYWJsZWQpICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNJblBvcnRhbENvbmZpZyhcIkFyY0dJUyBNYXAgVmlld2VyXCIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJNYXAgVmlld2VyIENsYXNzaWNcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKCkgPT4gaGFzTGljZW5zZShcImFyY2dpc1dlYkFwcHNcIikgJiYgdGhpcy5pc0luUG9ydGFsQ29uZmlnKFwiQXJjR0lTIE1hcCBWaWV3ZXIgQ2xhc3NpY1wiKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiT3BlcmF0aW9ucyBEYXNoYm9hcmQgZm9yIEFyY0dJU1wiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAoKSA9PiBoYXNMaWNlbnNlKFwib3BzZGFzaGJvYXJkXCIpICYmIHRoaXMuaXNJblBvcnRhbENvbmZpZyhcIkFyY0dJUyBEYXNoYm9hcmRzIENsYXNzaWNcIilcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBEYXNoYm9hcmRzIENsYXNzaWNcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiBoYXNMaWNlbnNlKFwib3BzZGFzaGJvYXJkXCIpICYmIHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIk9ydGhvIE1ha2VyXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICgpID0+IGhhc0FjY2Vzc1RvT3J0aG9NYWtlcihwb3J0YWwsIHRoaXMuc2hvd0luQXBwTGF1bmNoZXIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgTm90ZWJvb2s6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICh0aXRsZSkgPT4gaGFzQWNjZXNzVG9Ob3RlYm9va3ModGl0bGUsIHBvcnRhbCwgdXNlciwgdGhpcy5zaG93SW5BcHBMYXVuY2hlciwgdGhpcy5ub3RlYm9va1NlcnZlckVuYWJsZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJTY2VuZSBWaWV3ZXJcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiBoYXNMaWNlbnNlKFwiYXJjZ2lzV2ViQXBwc1wiKSAmJiB0aGlzLmlzSW5Qb3J0YWxDb25maWcodGl0bGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJTdG9yeSBNYXBzXCI6IHtcbiAgICAgICAgICAgICAgICBoYXNBY2Nlc3M6ICgpID0+IGhhc0xpY2Vuc2UoXCJhcmNnaXNXZWJBcHBzXCIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgU3VydmV5MTIzOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAoKSA9PiBoYXNMaWNlbnNlKFwic3VydmV5MTIzXCIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJUcmFjayBWaWV3ZXJcIjoge1xuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKCkgPT4gaGFzQWNjZXNzVG9UcmFja1ZpZXdlcihwb3J0YWwsIHRoaXMuc2hvd0luQXBwTGF1bmNoZXIsIHRoaXMudHJhY2tWaWV3ZXJFbmFibGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiSW5zdGFudCBBcHBzXCI6IHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgUG9ydGFsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IGhhc0xpY2Vuc2UoXCJhcmNnaXNXZWJBcHBzXCIpICYmIHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIlZlY3RvciBUaWxlIFN0eWxlIEVkaXRvclwiOiB7XG4gICAgICAgICAgICAgICAgLy8gRm9yIFBvcnRhbFxuICAgICAgICAgICAgICAgIGhhc0FjY2VzczogKHRpdGxlKSA9PiB0aGlzLmlzSW5Qb3J0YWxDb25maWcodGl0bGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJBcmNHSVMgR2VvQklNXCI6IHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgUG9ydGFsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAodGl0bGUpID0+IHRoaXMuaXNJblBvcnRhbENvbmZpZyh0aXRsZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkFyY0dJUyBNYXBzIGZvciBBZG9iZSBDcmVhdGl2ZSBDbG91ZFwiOiB7XG4gICAgICAgICAgICAgICAgaGFzQWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYXNMaWNlbnNlKFwiYXJjZ2lzV2ViQXBwc1wiKSAmJiAhY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0RXhjbHVkZWRQcm92aXNpb25lZExpc3RpbmdzKCkge1xuICAgICAgICBsZXQgZXhjbHVkZWQgPSB7XG4gICAgICAgICAgICBvcHNkYXNoYm9hcmQ6IDEsXG4gICAgICAgICAgICBhcmNnaXNXZWJBcHBzOiAxLFxuICAgICAgICAgICAgV29ya2ZvcmNlOiAxLFxuICAgICAgICAgICAgZ2VvcGxhbm5lcjogMSxcbiAgICAgICAgICAgIHdlYmFwcGJ1aWxkZXI6IDEsXG4gICAgICAgICAgICBIdWJmb3JBcmNHSVM6IDEsXG4gICAgICAgICAgICBhcHBzdHVkaW86IDEsXG4gICAgICAgICAgICBzdXJ2ZXkxMjM6IDEsXG4gICAgICAgICAgICBzdG9yeW1hcHM6IDEsXG4gICAgICAgICAgICBtYXBzRm9yT2ZmaWNlOiAxLFxuICAgICAgICAgICAgbWFwc0Zvck8zNjU6IDEsXG4gICAgICAgICAgICBtYXBzRm9yU2hhcmVQb2ludDogMSxcbiAgICAgICAgICAgIG1hcHNGb3JDcmVhdGl2ZUNsb3VkOiAxXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgaWYgKHBvcnRhbC5pc1BvcnRhbCkge1xuICAgICAgICAgICAgLy8gZXhjbHVkZSBjZXJ0YWluIHByb3Zpc2lvbmVkIGxpc3RpbmdzIGZvciBFbnRlcnByaXNlXG4gICAgICAgICAgICBleGNsdWRlZCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZXhjbHVkZWQpLCB7IGFyY2dpc29ubGluZTogMSwgYXJjZ2lzVXJiYW46IDEsIGFyY2dpc2luc3RhbnRhcHBzOiAxIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleGNsdWRlZDtcbiAgICB9XG4gICAgZ2V0SW1hZ2VQYXRoKGFwcCkge1xuICAgICAgICByZXR1cm4gZ2V0QXNzZXRQYXRoKGAuL2Fzc2V0cy8keyhhcHAgPT09IG51bGwgfHwgYXBwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHAuaW1hZ2UpID8gYXBwLmltYWdlIDogXCJcIn1gKTtcbiAgICB9XG4gICAgbW9kaWZ5V2ViQXBwRm9yVmlldyhhcHApIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgaW1nID0gKChfYSA9IGFwcC5hcHBTd2l0Y2hlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmltYWdlKSB8fCBhcHAuaWNvbjtcbiAgICAgICAgaWYgKGltZykge1xuICAgICAgICAgICAgYXBwLmltYWdlID0gdGhpcy5nZXRXZWJNYXBwaW5nQXBwSW1nUGF0aChhcHApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXBwLnBsYWNlSG9sZGVySWNvbiA9IGAke3RoaXMuZ2V0SW1hZ2VQYXRoKCl9c3ZnLWFwcC1jaXJjbGUuc3ZnYDtcbiAgICAgICAgfVxuICAgICAgICBhcHAuYWJiciA9ICgoX2IgPSBhcHAuYXBwU3dpdGNoZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hYmJyKSB8fCBhcHAuYWJicmV2aWF0aW9uO1xuICAgICAgICBkZWxldGUgYXBwLmFiYnJldmlhdGlvbjtcbiAgICAgICAgZGVsZXRlIGFwcC5hcHBTd2l0Y2hlcjtcbiAgICAgICAgZGVsZXRlIGFwcC5hcHByb3ZlZEFwcDtcbiAgICAgICAgZGVsZXRlIGFwcC53ZWJNYXBwaW5nQXBwO1xuICAgICAgICByZXR1cm4gYXBwO1xuICAgIH1cbiAgICBtb2RpZnlTeXN0ZW1BcHBGb3JWaWV3KGFwcCwgdW5pcXVlSWQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGlmIChhcHAuaW1hZ2UpIHtcbiAgICAgICAgICAgIGFwcC5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2VQYXRoKGFwcCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhcHAucGxhY2VIb2xkZXJJY29uID0gYCR7dGhpcy5nZXRJbWFnZVBhdGgoKX1zdmctYXBwLWljb24uc3ZnYDtcbiAgICAgICAgfVxuICAgICAgICAvLyByZWxhdGl2ZSB1cmxzIG11c3QgYmUgcG9pbnRlZCBhdCB0aGUgb3JnIHVybCAoIzI1NDk0KVxuICAgICAgICBpZiAoKChfYSA9IGFwcC51cmwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKFwiLi4vXCIpKSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgYmFzZVVybCA9IHBvcnRhbC51cmxLZXlcbiAgICAgICAgICAgICAgICA/IGAke3BvcnRhbC51cmxLZXl9LiR7cG9ydGFsLmN1c3RvbUJhc2VVcmx9YFxuICAgICAgICAgICAgICAgIDogcG9ydGFsLnBvcnRhbEhvc3RuYW1lO1xuICAgICAgICAgICAgYXBwLnVybCA9IGAke2xvY2F0aW9uLnByb3RvY29sfS8vJHtiYXNlVXJsfSR7YXBwLnVybC5zdWJzdHJpbmcoMiwgYXBwLnVybC5sZW5ndGgpfWA7XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIGFwcC5pc0xpY2Vuc2VkO1xuICAgICAgICBkZWxldGUgYXBwLnByaXZpbGVnZXM7XG4gICAgICAgIGFwcC5pdGVtSWQgPSB1bmlxdWVJZDtcbiAgICAgICAgcmV0dXJuIGFwcDtcbiAgICB9XG4gICAgZ2V0V2ViTWFwcGluZ0FwcEltZ1BhdGgoYXBwKSB7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbihwb3J0YWwpO1xuICAgICAgICBpZiAoIWFwcC5pY29uKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7Z2V0UmVzdEJhc2VVcmwoKX1jb250ZW50L2l0ZW1zLyR7YXBwLml0ZW1JZH0vcmVzb3VyY2VzLyR7YXBwLmFwcFN3aXRjaGVyLmltYWdlfT90b2tlbj0ke3Rva2VufWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy9zZWxmL3Jlc291cmNlcy8ke2FwcC5pY29ufT90b2tlbj0ke3Rva2VufWA7XG4gICAgfVxuICAgIG1vZGlmeVBhcnRuZXJBcHBGb3JWaWV3KGFwcCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgYXBwLmFwcFN3aXRjaGVyID0gKF9hID0gYXBwLnByb3BlcnRpZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hcHBTd2l0Y2hlcjtcbiAgICAgICAgY29uc3QgY3VzdG9tSWNvbiA9ICgoX2IgPSBhcHAuYXBwU3dpdGNoZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pbWFnZSkgfHwgYXBwLmljb247XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhYmJyOiAoKF9jID0gYXBwLmFwcFN3aXRjaGVyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuYWJicikgfHwgYXBwLmFiYnJldmlhdGlvbixcbiAgICAgICAgICAgIGl0ZW1JZDogYXBwLml0ZW1JZCxcbiAgICAgICAgICAgIGNhbkFjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHdlYk1hcHBpbmdBcHA6IHRydWUsXG4gICAgICAgICAgICBpbWFnZTogY3VzdG9tSWNvbiA/IHRoaXMuZ2V0V2ViTWFwcGluZ0FwcEltZ1BhdGgoYXBwKSA6IG51bGwsXG4gICAgICAgICAgICBsYWJlbDogYXBwLnRpdGxlIHx8IGFwcC5sYWJlbCxcbiAgICAgICAgICAgIHVybDogYXBwLnVybCxcbiAgICAgICAgICAgIHBsYWNlSG9sZGVySWNvbjogYXBwLnBsYWNlSG9sZGVySWNvbiB8fCBgJHt0aGlzLmdldEltYWdlUGF0aCgpfXN2Zy1hcHAtY2lyY2xlLnN2Z2BcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0TGljZW5zZWRBcHBzKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfajtcbiAgICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBjb25zdCBhbGxBcHBVaWRzID0ge307XG4gICAgICAgIGNvbnN0IGFwcERpY3Rpb25hcnkgPSB7fTtcbiAgICAgICAgY29uc3QgZXhjZXB0aW9ucyA9IHRoaXMuZ2V0QXBwRXhjZXB0aW9ucygpO1xuICAgICAgICBjb25zdCBleGNsdWRlZFByb3Zpc2lvbmVkTGlzdGluZ3MgPSB0aGlzLmdldEV4Y2x1ZGVkUHJvdmlzaW9uZWRMaXN0aW5ncygpO1xuICAgICAgICBjb25zdCBsZWdhbEFwcHMgPSBbXTtcbiAgICAgICAgY29uc3QgYXBwQ291bnQgPSB0aGlzLnVzZXJBcHBzLmFwcHMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFwcENvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGFwcCA9IHRoaXMudXNlckFwcHMuYXBwc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHVpZCA9IGFwcC5pdGVtSWQgfHwgYXBwLnRpdGxlO1xuICAgICAgICAgICAgbGV0IGlzUHJpdmlsZWdlZCA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCBpbkJsb2NrZWRMaXN0ID0gKF9hID0gdGhpcy5ibG9ja2VkQXBwcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNvbWUoKGJhKSA9PiAoYXBwLml0ZW1JZCAmJiBhcHAuaXRlbUlkID09PSBiYS5pdGVtaWQpIHx8IChhcHAudGl0bGUgJiYgYXBwLnRpdGxlID09PSBiYS50aXRsZSkpO1xuICAgICAgICAgICAgYWxsQXBwVWlkc1t1aWRdID0gMTtcbiAgICAgICAgICAgIGFwcERpY3Rpb25hcnlbdWlkXSA9IGFwcDtcbiAgICAgICAgICAgIGlmIChpbkJsb2NrZWRMaXN0KSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwb3J0YWxEZXBsb3ltZW50VHlwZSA9IHBvcnRhbC5wb3J0YWxEZXBsb3ltZW50VHlwZSB8fCAoKF9iID0gcG9ydGFsLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5wb3J0YWxEZXBsb3ltZW50VHlwZSk7XG4gICAgICAgICAgICBpZiAocG9ydGFsRGVwbG95bWVudFR5cGUgPT09IFwiQXJjR0lTRW50ZXJwcmlzZU9uS3ViZXJuZXRlc1wiICYmXG4gICAgICAgICAgICAgICAgYXBwLnN1cHBvcnRzS3ViZXJuZXRlcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChleGNlcHRpb25zW2FwcC50aXRsZV0gJiYgIWV4Y2VwdGlvbnNbYXBwLnRpdGxlXS5oYXNBY2Nlc3MoYXBwLnRpdGxlKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uSW5mbyA9IHBvcnRhbC5zdWJzY3JpcHRpb25JbmZvIHx8ICgoX2MgPSBwb3J0YWwuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN1YnNjcmlwdGlvbkluZm8pO1xuICAgICAgICAgICAgaWYgKGFwcC5zdWJzY3JpcHRpb25UeXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKChzdWJzY3JpcHRpb25JbmZvID09PSBudWxsIHx8IHN1YnNjcmlwdGlvbkluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1YnNjcmlwdGlvbkluZm8udHlwZSkgPT09IGFwcC5zdWJzY3JpcHRpb25UeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcERpY3Rpb25hcnlbdWlkXS5jYW5BY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBsZWdhbEFwcHMucHVzaCh0aGlzLm1vZGlmeVN5c3RlbUFwcEZvclZpZXcoYXBwLCB1aWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXBwLm9yZ0NhcGFiaWxpdGllcykge1xuICAgICAgICAgICAgICAgIGlmICgoX2QgPSB0aGlzLm9yZ0NhcGFiaWxpdGllcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNDYXBhYmlsaXR5ID0gdGhpcy5vcmdDYXBhYmlsaXRpZXMuc29tZSgoY2FwYWJpbGl0eSkgPT4gYXBwLm9yZ0NhcGFiaWxpdGllcy5pbmNsdWRlcyhjYXBhYmlsaXR5LmlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNDYXBhYmlsaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBEaWN0aW9uYXJ5W3VpZF0uY2FuQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2FsQXBwcy5wdXNoKHRoaXMubW9kaWZ5U3lzdGVtQXBwRm9yVmlldyhhcHAsIHVpZCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEoKF9lID0gYXBwLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5sZW5ndGgpICYmICFhcHAuaXNMaWNlbnNlZCAmJiAhYXBwLnNlcnZlckZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgYXBwRGljdGlvbmFyeVt1aWRdLmNhbkFjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbGVnYWxBcHBzLnB1c2godGhpcy5tb2RpZnlTeXN0ZW1BcHBGb3JWaWV3KGFwcCwgdWlkKSk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBza2lwUHJpdkNoZWNrID0gKChfZyA9ICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnVzZXJMaWNlbnNlVHlwZUlkKSB8fCAoKF9mID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi51c2VyTGljZW5zZVR5cGVJZCkpKSA9PT0gbnVsbCB8fCBfZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2cudG9Mb3dlckNhc2UoKSkgPT09IFwic3Rvcnl0ZWxsZXJ1dFwiICYmICgoX2ggPSBhcHAubGFiZWwpID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaC50b0xvd2VyQ2FzZSgpKSA9PT0gXCJzdG9yeW1hcHNcIjtcbiAgICAgICAgICAgIGlmIChza2lwUHJpdkNoZWNrKSB7XG4gICAgICAgICAgICAgICAgYXBwRGljdGlvbmFyeVt1aWRdLmNhbkFjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbGVnYWxBcHBzLnB1c2godGhpcy5tb2RpZnlTeXN0ZW1BcHBGb3JWaWV3KGFwcCwgdWlkKSk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKChfaiA9IGFwcC5wcml2aWxlZ2VzKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2oubGVuZ3RoKSA+IDAgJiYgKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXBwLnByaXZpbGVnZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIucHJpdmlsZWdlcy5pbmRleE9mKGFwcC5wcml2aWxlZ2VzW2pdKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzUHJpdmlsZWdlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFhcHAuaXNMaWNlbnNlZCAmJiBpc1ByaXZpbGVnZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwRGljdGlvbmFyeVt1aWRdLmNhbkFjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FsQXBwcy5wdXNoKHRoaXMubW9kaWZ5U3lzdGVtQXBwRm9yVmlldyhhcHAsIHVpZCkpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXBwLmlzTGljZW5zZWQgJiYgaXNQcml2aWxlZ2VkKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLnByb3Zpc2lvbmVkTGlzdGluZ3MubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVpZCA9PT0gdGhpcy5wcm92aXNpb25lZExpc3RpbmdzW2tdLml0ZW1JZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdWlkID09PSB0aGlzLnByb3Zpc2lvbmVkTGlzdGluZ3Nba10udGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcERpY3Rpb25hcnlbdWlkXS5jYW5BY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVnYWxBcHBzLnB1c2godGhpcy5tb2RpZnlTeXN0ZW1BcHBGb3JWaWV3KGFwcCwgdWlkKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcHAuc2VydmVyRnVuY3Rpb24gJiYgaXNQcml2aWxlZ2VkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVycy5zb21lKChzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jdGlvbnMgPSAoKF9hID0gc2VydmVyLnNlcnZlckZ1bmN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaXQoXCIsXCIpKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5pbmNsdWRlcyhhcHAuc2VydmVyRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcERpY3Rpb25hcnlbdWlkXS5jYW5BY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBsZWdhbEFwcHMucHVzaCh0aGlzLm1vZGlmeVN5c3RlbUFwcEZvclZpZXcoYXBwLCB1aWQpKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIC0gV2ViIG1hcHBpbmcgYXBwcyBmcm9tIE1hcmtlcGxhY2VcbiAgICAgICAgdGhpcy5wcm92aXNpb25lZExpc3RpbmdzLmZvckVhY2goKGFwcCkgPT4ge1xuICAgICAgICAgICAgaWYgKGFwcC50eXBlID09PSBcIldlYiBNYXBwaW5nIEFwcGxpY2F0aW9uXCIgJiZcbiAgICAgICAgICAgICAgICAhZXhjbHVkZWRQcm92aXNpb25lZExpc3RpbmdzW2FwcC5jbGllbnRJZF0gJiZcbiAgICAgICAgICAgICAgICAhYWxsQXBwVWlkc1thcHAuaXRlbUlkXSAmJlxuICAgICAgICAgICAgICAgIGFwcC51cmwgJiZcbiAgICAgICAgICAgICAgICBhcHAudGl0bGUgJiZcbiAgICAgICAgICAgICAgICAhYWxsQXBwVWlkc1thcHAudGl0bGVdICYmXG4gICAgICAgICAgICAgICAgYXBwLnR5cGVLZXl3b3Jkcy5pbmRleE9mKFwiaGlkZUZyb21BcHBTd2l0Y2hlclwiKSA8IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RpZmllZEFwcCA9IHRoaXMubW9kaWZ5UGFydG5lckFwcEZvclZpZXcoYXBwKTtcbiAgICAgICAgICAgICAgICBhcHBEaWN0aW9uYXJ5W2FwcC5pdGVtSWRdID0gbW9kaWZpZWRBcHA7XG4gICAgICAgICAgICAgICAgbGVnYWxBcHBzLnB1c2gobW9kaWZpZWRBcHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYXBwcyA9IFtcbiAgICAgICAgICAgIC4uLnRoaXMuYXBwcm92ZWRBcHBzLm1hcCgoYXBwKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXBwUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgYXBwLmFwcFByb3BlcnRpZXMpLCB7IGl0ZW1JZDogYXBwLml0ZW1JZCwgd2ViTWFwcGluZ0FwcDogdHJ1ZSwgYXBwcm92ZWRBcHA6IHRydWUsIGNhbkFjY2VzczogIXRoaXMud2lsbFF1ZXJ5Rm9ySXRlbXMgfSk7XG4gICAgICAgICAgICAgICAgYXBwRGljdGlvbmFyeVthcHAuaXRlbUlkXSA9IGFwcFByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5V2ViQXBwRm9yVmlldyhhcHBQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgLi4ubGVnYWxBcHBzXG4gICAgICAgIF07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhcHBzLFxuICAgICAgICAgICAgYXBwRGljdGlvbmFyeVxuICAgICAgICB9O1xuICAgIH1cbiAgICBpc0FkbWluKCkge1xuICAgICAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdXNlci5yb2xlID09PSBcIm9yZ19hZG1pblwiIHx8IHVzZXIucm9sZSA9PT0gXCJhY2NvdW50X2FkbWluXCI7XG4gICAgfVxuICAgIC8vIE1hcCB0aGUgdWlkIG9mIGV4aXN0aW5nIHVzZXIgcHJvcGVydGllcyB0byBtYXRjaCB0aGUgbmV3IHRpdGxlXG4gICAgbWFwQXBwVGl0bGVzKGFwcHMpIHtcbiAgICAgICAgY29uc3QgeyBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBhcHBzLmZvckVhY2goKGFwcCkgPT4ge1xuICAgICAgICAgICAgaWYgKGFwcC51aWQgPT09IFwiTWFwIFZpZXdlciBCZXRhXCIpIHtcbiAgICAgICAgICAgICAgICBhcHAudWlkID0gXCJNYXAgVmlld2VyXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9ydGFsLmlzUG9ydGFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFwcC51aWQgPT09IFwiT3BlcmF0aW9ucyBEYXNoYm9hcmQgZm9yIEFyY0dJU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC51aWQgPSBcIkFyY0dJUyBEYXNoYm9hcmRzIENsYXNzaWNcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYXBwLnVpZCA9PT0gXCJXb3JrZm9yY2UgZm9yIEFyY0dJU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC51aWQgPSBcIkFyY0dJUyBXb3JrZm9yY2VcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBpbml0KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVycyA9IGF3YWl0IGdldFNlcnZlcnMoKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmdldEJsb2NrZWRBcHBzKCk7XG4gICAgICAgIGNvbnN0IHsgYXBwcywgYXBwRGljdGlvbmFyeSB9ID0gYXdhaXQgdGhpcy5nZXRMaWNlbnNlZEFwcHMoKTtcbiAgICAgICAgdGhpcy5hcHBEaWN0aW9uYXJ5ID0gYXBwRGljdGlvbmFyeTtcbiAgICAgICAgaWYgKHRoaXMudXNlclByb3BlcnRpZXMuYXBwTGF1bmNoZXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZXJQcm9wZXJ0aWVzLmFwcExhdW5jaGVyLnByaW1hcnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcEFwcFRpdGxlcyh0aGlzLnVzZXJQcm9wZXJ0aWVzLmFwcExhdW5jaGVyLnByaW1hcnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudXNlclByb3BlcnRpZXMuYXBwTGF1bmNoZXIuc2Vjb25kYXJ5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBBcHBUaXRsZXModGhpcy51c2VyUHJvcGVydGllcy5hcHBMYXVuY2hlci5zZWNvbmRhcnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy51c2VyUHJvcGVydGllcy5hcHBMYXVuY2hlciB8fFxuICAgICAgICAgICAgIXRoaXMudXNlclByb3BlcnRpZXMuYXBwTGF1bmNoZXIucHJpbWFyeSB8fFxuICAgICAgICAgICAgIXRoaXMudXNlclByb3BlcnRpZXMuYXBwTGF1bmNoZXIuc2Vjb25kYXJ5KSB7XG4gICAgICAgICAgICB0aGlzLnByaW1hcnlBcHBzID0gYXBwcy5zbGljZSgpLnNvcnQoKGEsIGIpID0+IChhLmxhYmVsIDwgYi5sYWJlbCA/IC0xIDogMSkpO1xuICAgICAgICAgICAgdGhpcy5wcmltYXJ5QXBwcyA9IHRoaXMuZmlsdGVyQmxvY2tlZEFwcHModGhpcy5wcmltYXJ5QXBwcyk7XG4gICAgICAgICAgICB0aGlzLnNlY29uZGFyeUFwcHMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcXVlcnlBcHBJdGVtc0ZvckNoYW5nZXModGhpcy5hcHByb3ZlZEFwcHMsIHRoaXMud2lsbFF1ZXJ5Rm9ySXRlbXMpO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0cy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuYXBwRGljdGlvbmFyeVtpdGVtLmlkXTtcbiAgICAgICAgICAgICAgICAgICAgYXBwLmNhbkFjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5oYXNDaGFuZ2VkID0gYXBwLnVybCAhPT0gaXRlbS51cmwgPyAhIWl0ZW0udXJsIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5ld0FwcERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmFwcERpY3Rpb25hcnkpO1xuICAgICAgICAgICAgdGhpcy51c2VyUHJvcGVydGllcy5hcHBMYXVuY2hlci5wcmltYXJ5LmZvckVhY2goKHApID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocC5sYWJlbCA9PT0gXCJNYXAgVmlld2VyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcC51aWQgPSBcIk1hcCBWaWV3ZXJcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucHJpbWFyeUFwcHMgPVxuICAgICAgICAgICAgICAgIHRoaXMudXNlclByb3BlcnRpZXMuYXBwTGF1bmNoZXIucHJpbWFyeS5yZWR1Y2UodGhpcy5wb3B1bGF0ZUFwcElkZW50aWZpZXJzLmJpbmQodGhpcyksIFtdKSB8fCBbXTtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QXBwcyA9XG4gICAgICAgICAgICAgICAgdGhpcy51c2VyUHJvcGVydGllcy5hcHBMYXVuY2hlci5zZWNvbmRhcnkucmVkdWNlKHRoaXMucG9wdWxhdGVBcHBJZGVudGlmaWVycy5iaW5kKHRoaXMpLCBbXSkgfHwgW107XG4gICAgICAgICAgICB0aGlzLnByaW1hcnlBcHBzID0gdGhpcy5maWx0ZXJCbG9ja2VkQXBwcyh0aGlzLnByaW1hcnlBcHBzKTtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QXBwcyA9IHRoaXMuZmlsdGVyQmxvY2tlZEFwcHModGhpcy5zZWNvbmRhcnlBcHBzKTtcbiAgICAgICAgICAgIC8vIDo6IENoZWNrIGZvciBOZXcgQXBwIEljb25zIDo6XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFwcCBpbiB0aGlzLm5ld0FwcERpY3Rpb25hcnkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uZXdBcHBEaWN0aW9uYXJ5W2FwcF0uY2FuQWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV3QXBwRGljdGlvbmFyeVthcHBdLmlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBEaWN0aW9uYXJ5W2FwcF0gPSB0aGlzLm5ld0FwcERpY3Rpb25hcnlbYXBwXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmltYXJ5QXBwcy5wdXNoKHRoaXMubmV3QXBwRGljdGlvbmFyeVthcHBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0QWdvQXBwKCkge1xuICAgICAgICBjb25zdCB7IHBvcnRhbCwgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IGJhc2VVcmwgPSBgJHtsb2NhdGlvbi5wcm90b2NvbH0vLyR7cG9ydGFsLnVybEtleSA/IGAke3BvcnRhbC51cmxLZXl9LiR7cG9ydGFsLmN1c3RvbUJhc2VVcmx9YCA6IHBvcnRhbC5wb3J0YWxIb3N0bmFtZX0vaG9tZS9gO1xuICAgICAgICBjb25zdCB7IGxhbmRpbmdQYWdlIH0gPSB0aGlzLnVzZXJQcm9wZXJ0aWVzO1xuICAgICAgICBjb25zdCB1cmwgPSBgJHtiYXNlVXJsfSR7KGxhbmRpbmdQYWdlID09PSBudWxsIHx8IGxhbmRpbmdQYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYW5kaW5nUGFnZS51cmwpID8gbGFuZGluZ1BhZ2UudXJsIDogaXNPcmdBZG1pbih1c2VyKSA/IFwib3JnYW5pemF0aW9uLmh0bWxcIiA6IFwiaW5kZXguaHRtbFwifWA7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbWFnZTogXCJhcmNnaXMtb25saW5lLnBuZ1wiLFxuICAgICAgICAgICAgbGFiZWw6IFwiQXJjR0lTIE9ubGluZVwiLFxuICAgICAgICAgICAgdGl0bGU6IFwiQXJjR0lTIE9ubGluZVwiLFxuICAgICAgICAgICAgdXJsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGluaXRpYWxpemVDb25maWcoKSB7XG4gICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpO1xuICAgICAgICBjb25maWdTdGF0ZS51c2VyID0gdGhpcy51c2VyO1xuICAgICAgICBjb25maWdTdGF0ZS5wb3J0YWwgPSB0aGlzLnBvcnRhbDtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB0b3RhbCA9IHRoaXMucHJpbWFyeUFwcHMubGVuZ3RoICsgdGhpcy5zZWNvbmRhcnlBcHBzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcnRsID0gZ2V0RWxlbWVudERpcih0aGlzLmVsKSA9PT0gXCJydGxcIjtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgb25LZXlEb3duOiB0aGlzLmtleWRvd25IYW5kbGVyIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwga2luZDogXCJuZXV0cmFsXCIsIGNsYXNzOiB7IFwidG9nZ2xlLWJ1dHRvblwiOiB0cnVlLCBcInRvZ2dsZS1idXR0b24tLWV4cGFuZGVkXCI6IHRoaXMuaXNFeHBhbmRlZCB9LCBcImFyaWEtbGFiZWxcIjogdGhpcy5zdHJpbmdzLmFwcExhdW5jaGVyLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVRvZ2dsZSwgcmVmOiAoZWwpID0+ICh0aGlzLnRvZ2dsZUJ1dHRvbiA9IGVsKSwgXCJhcmlhLWV4cGFuZGVkXCI6IHRoaXMuaXNFeHBhbmRlZCB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgY2xhc3M6IFwidG9nZ2xlLWJ1dHRvbl9faWNvblwiLCBpY29uOiBcImFwcC1sYXVuY2hlclwiLCBzY2FsZTogXCJtXCIgfSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYXBwcy1jb250ZW50LWNvbnRhaW5lclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiYXBwcy1jb250ZW50XCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJhcHBzLWNvbnRlbnQtLXJ0bFwiOiBydGwsXG4gICAgICAgICAgICAgICAgXCJhcHBzLWNvbnRlbnQtLWV4cGFuZGVkXCI6IHRoaXMuaXNFeHBhbmRlZCxcbiAgICAgICAgICAgICAgICBcImFwcHMtY29udGVudC0tZHJhZ2dpbmdcIjogdGhpcy5kcmFnZ2luZ1xuICAgICAgICAgICAgfSwgXCJhcmlhLWhpZGRlblwiOiBcImZhbHNlXCIgfSwgaChcIm5hdlwiLCB7IGNsYXNzOiBcImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tcmlnaHRcIiwgcm9sZTogXCJtZW51XCIgfSwgdGhpcy5kaXNwbGF5SW50cm8gJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbnRyby1jb250YWluZXJcIiB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImRyYWctYW5kLWRyb3AtaW50cm8gaW50cm8tdGV4dFwiIH0sIHRoaXMuc3RyaW5ncy5kcmFnRHJvcCksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURpc21pc3NJbnRybyB9LCB0aGlzLnN0cmluZ3MuZ290SXQpKSksIGgoXCJ1bFwiLCB7IGNsYXNzOiBcImFwcHMtbGlzdFwiLCByZWY6IChlbCkgPT4gKHRoaXMucHJpbWFyeUNvbnRhaW5lciA9IGVsKSB9LCB0aGlzLnByaW1hcnlBcHBzLm1hcCgoYXBwLCBpbmRleCkgPT4gKGgoXCJsaVwiLCB7IFwiZGF0YS1pZFwiOiBhcHAuaXRlbUlkIHx8IGFwcC50aXRsZSwga2V5OiBhcHAuaXRlbUlkLCBjbGFzczogeyBcImFwcC1pdGVtXCI6IHRydWUsIFwiYXBwLWl0ZW0tLW1pc3NpbmdcIjogIWFwcC5jYW5BY2Nlc3MgfSB9LCBoKFwiYXJjZ2lzLWFwcC1zd2l0Y2hlci1saW5rXCIsIHsgYXBwOiBhcHAsIGluZGV4OiBpbmRleCwgdG90YWw6IHRvdGFsLCBmb2N1c0l0ZW1JZDogdGhpcy5mb2N1c0l0ZW1JZCwgb3BlblRleHQ6IHRoaXMuc3RyaW5ncy5vcGVuV2luZG93IH0pKSkpKSwgIXRoaXMuc2Vjb25kYXJ5RXhwYW5kZWQgJiYgKGgoXCJidXR0b25cIiwgeyBjbGFzczogXCJzaG93LW1vcmVcIiwgb25DbGljazogdGhpcy5oYW5kbGVTaG93TW9yZSB9LCB0aGlzLnN0cmluZ3Muc2hvd01vcmUsIFwiIFwiLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJjaGV2cm9uLWRvd25cIiwgc2NhbGU6IFwic1wiIH0pKSksIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwic2Vjb25kYXJ5LWNvbnRhaW5lclwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwic2Vjb25kYXJ5LWNvbnRhaW5lci0taGlkZGVuXCI6ICF0aGlzLnNlY29uZGFyeUV4cGFuZGVkXG4gICAgICAgICAgICB9LCBcImFyaWEtZXhwYW5kZWRcIjogXCJ0cnVlXCIgfSwgaChcInVsXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcInNlY29uZGFyeS10YXJnZXRcIjogdGhpcy5zZWNvbmRhcnlBcHBzLmxlbmd0aCA9PT0gMCxcbiAgICAgICAgICAgICAgICBcInNlY29uZGFyeS1saXN0XCI6IHRoaXMuc2Vjb25kYXJ5QXBwcy5sZW5ndGggIT09IDAsXG4gICAgICAgICAgICAgICAgXCJzZWNvbmRhcnktdGFyZ2V0LS1ob3ZlclwiOiB0aGlzLmhvdmVyaW5nT3ZlclNlY29uZGFyeSAmJiB0aGlzLnNlY29uZGFyeUFwcHMubGVuZ3RoID09PSAwXG4gICAgICAgICAgICB9LCByZWY6IChlbCkgPT4gKHRoaXMuc2Vjb25kYXJ5Q29udGFpbmVyID0gZWwpIH0sIHRoaXMuc2Vjb25kYXJ5QXBwcy5sZW5ndGggPT09IDAgJiYgIXRoaXMuaG92ZXJpbmdPdmVyU2Vjb25kYXJ5ICYmIChoKFwicFwiLCB7IGNsYXNzOiBcInNlY29uZGFyeS1kcmFnLXRleHRcIiwgcmVmOiAoZWwpID0+ICh0aGlzLnNlY29uZGFyeURyYWdUZXh0ID0gZWwpIH0sIHRoaXMuc3RyaW5ncy5kcmFnU2Vjb25kYXJ5KSksIHRoaXMuc2Vjb25kYXJ5QXBwcy5tYXAoKGFwcCwgaW5kZXgpID0+IChoKFwibGlcIiwgeyBcImRhdGEtaWRcIjogYXBwLml0ZW1JZCwga2V5OiBhcHAuaXRlbUlkLCBjbGFzczogeyBcImFwcC1pdGVtXCI6IHRydWUsIFwiYXBwLWl0ZW0tLW1pc3NpbmdcIjogIWFwcC5jYW5BY2Nlc3MgfSB9LCBoKFwiYXJjZ2lzLWFwcC1zd2l0Y2hlci1saW5rXCIsIHsgYXBwOiBhcHAsIGluZGV4OiB0aGlzLnByaW1hcnlBcHBzLmxlbmd0aCArIGluZGV4LCB0b3RhbDogdG90YWwsIGZvY3VzSXRlbUlkOiB0aGlzLmZvY3VzSXRlbUlkLCBvcGVuVGV4dDogdGhpcy5zdHJpbmdzLm9wZW5XaW5kb3cgfSkpKSkpKSkpKSkpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJhc3NldHNcIl07IH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJzaG91bGRFeHBhbmRcIjogW1wiaGFuZGxlU2hvdWxkRXhwYW5kQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0FwcFN3aXRjaGVyLnN0eWxlID0gYXJjZ2lzQXBwU3dpdGNoZXJDc3M7XG5cbmNvbnN0IEFwcFN3aXRjaGVyTGlua0Fycm93cyA9ICh7IGluZGV4LCB0b3RhbCwgYWN0aXZlIH0pID0+IHtcbiAgICBjb25zdCBpc0ZpcnN0ID0gaW5kZXggPT09IDA7XG4gICAgY29uc3QgaXNGaXJzdFJvdyA9IGluZGV4IDw9IDI7XG4gICAgY29uc3QgaXNMYXN0ID0gaW5kZXggPT09IHRvdGFsIC0gMTtcbiAgICBjb25zdCByb3dDb3VudCA9IE1hdGguY2VpbCh0b3RhbCAvIDMpO1xuICAgIGNvbnN0IGxhc3RSb3dGaXJzdEluZGV4ID0gcm93Q291bnQgKiAzIC0gMztcbiAgICBjb25zdCBpc0xhc3RSb3cgPSBpbmRleCA+PSBsYXN0Um93Rmlyc3RJbmRleDtcbiAgICByZXR1cm4gKGgoXCJzcGFuXCIsIHsgY2xhc3M6IHsgXCJhcnJvdy0taGlkZGVuXCI6ICFhY3RpdmUgfSB9LFxuICAgICAgICAhaXNGaXJzdCAmJiBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYXJyb3cgYXJyb3ctLWxlZnRcIiB9KSxcbiAgICAgICAgIWlzTGFzdCAmJiBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYXJyb3cgYXJyb3ctLXJpZ2h0XCIgfSksXG4gICAgICAgICFpc0ZpcnN0Um93ICYmIGgoXCJkaXZcIiwgeyBjbGFzczogXCJhcnJvdyBhcnJvdy0tdG9wXCIgfSksXG4gICAgICAgICFpc0xhc3RSb3cgJiYgaChcImRpdlwiLCB7IGNsYXNzOiBcImFycm93IGFycm93LS1ib3R0b21cIiB9KSkpO1xufTtcblxuY29uc3QgYXJjZ2lzQXBwU3dpdGNoZXJMaW5rQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrO2hlaWdodDo5MyV9LmFwcC1saW5re3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjEwMCU7LXdlYmtpdC11c2VyLXNlbGVjdDp0ZXh0Oy1tb3otdXNlci1zZWxlY3Q6dGV4dDt1c2VyLXNlbGVjdDp0ZXh0O3BhZGRpbmctbGVmdDowLjVyZW07cGFkZGluZy1yaWdodDowLjVyZW07cGFkZGluZy10b3A6MC41cmVtO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7Y29sb3I6aW5oZXJpdH0uYXBwLWxpbms6Zm9jdXN7b3V0bGluZToxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9LmFycm93e3Bvc2l0aW9uOmFic29sdXRlO2hlaWdodDowcHg7d2lkdGg6MHB4fS5hcnJvdy0taGlkZGVue3Zpc2liaWxpdHk6aGlkZGVufS5hcnJvdy0tbGVmdHtib3JkZXItcmlnaHQ6NXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO2JvcmRlci1ib3R0b206NXB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci10b3A6NXB4IHNvbGlkIHRyYW5zcGFyZW50O2xlZnQ6MzhweDt0b3A6MjdweH0uYXJyb3ctLXJpZ2h0e2JvcmRlci1sZWZ0OjVweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtib3JkZXItYm90dG9tOjVweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItdG9wOjVweCBzb2xpZCB0cmFuc3BhcmVudDtyaWdodDozOHB4O3RvcDoyN3B4fS5hcnJvdy0tdG9we2JvcmRlci1ib3R0b206NXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO2JvcmRlci1sZWZ0OjVweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItcmlnaHQ6NXB4IHNvbGlkIHRyYW5zcGFyZW50O3RvcDowO3JpZ2h0OjcwcHh9LmFycm93LS1ib3R0b217Ym9yZGVyLXRvcDo1cHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCk7Ym9yZGVyLWxlZnQ6NXB4IHNvbGlkIHRyYW5zcGFyZW50O2JvcmRlci1yaWdodDo1cHggc29saWQgdHJhbnNwYXJlbnQ7dG9wOjU5cHg7cmlnaHQ6NzBweH0ubWlzc2luZy1pY29uIC5hcnJvdy0tdG9we3RvcDotNHB4fS5pY29uLXdyYXBwZXJ7bWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7bWFyZ2luLWxlZnQ6YXV0bzttYXJnaW4tcmlnaHQ6YXV0bzttYXJnaW4tYm90dG9tOjAuNXJlbTtkaXNwbGF5OmJsb2NrO2hlaWdodDozcmVtO3dpZHRoOjNyZW07YmFja2dyb3VuZC1zaXplOmNvbnRhaW47YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtc2l6ZToxLjEyNXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMil9Lmljb24tYWJicntwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDozcmVtO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcDtmb250LXNpemU6MS4yNXJlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO2xpbmUtaGVpZ2h0OjNyZW07dGV4dC1zaGFkb3c6MCAxcHggOHB4IHZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKTt0cmFuc2Zvcm06dHJhbnNsYXRlWigwKX0uaWNvbi1pbWd7cG9pbnRlci1ldmVudHM6bm9uZTtoZWlnaHQ6M3JlbTt3aWR0aDozcmVtfS5pbmRpY2F0b3J7cG9zaXRpb246YWJzb2x1dGU7Y2xlYXI6Ym90aDtib3gtc2l6aW5nOmJvcmRlci1ib3g7aGVpZ2h0OjFyZW07d2lkdGg6MXJlbTtib3JkZXItcmFkaXVzOjUwJTtib3JkZXI6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTt6LWluZGV4OjUwfS5pbmRpY2F0b3ItLW5ld3tiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3Itc3RhdHVzLXN1Y2Nlc3MpO3RvcDo0cHg7cmlnaHQ6NDZweH0uaW5kaWNhdG9yLS1uZXctcnRse3JpZ2h0OmF1dG87bGVmdDo0NnB4fS5pbmRpY2F0b3ItLXJlbW92ZXtkaXNwbGF5OmZsZXg7Y3Vyc29yOnBvaW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7bGluZS1oZWlnaHQ6MnB4O3BhZGRpbmc6MXB4O3JpZ2h0OjQycHg7dG9wOjJweH0uaW5kaWNhdG9yLS1yZW1vdmUtcnRse3JpZ2h0OmF1dG87bGVmdDo0MnB4fS5pbmRpY2F0b3ItLXJlbW92ZTpob3ZlciwuaW5kaWNhdG9yLS1yZW1vdmU6Zm9jdXN7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1kYW5nZXIpO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3Itc3RhdHVzLWRhbmdlcil9Lm1pc3NpbmctaWNvbnttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tbGVmdDphdXRvO21hcmdpbi1yaWdodDphdXRvO21hcmdpbi1ib3R0b206MC41cmVtO2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO2hlaWdodDozcmVtO3dpZHRoOjNyZW07Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7dGV4dC1hbGlnbjpjZW50ZXI7Ym9yZGVyOjFweCBkYXNoZWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1pbnZlcnNlKTtib3JkZXItcmFkaXVzOjZweDtvdXRsaW5lLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5sYWJlbC10ZXh0e21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4O21hcmdpbi1sZWZ0OmF1dG87bWFyZ2luLXJpZ2h0OmF1dG87ZGlzcGxheTpibG9jazt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxN3B4O3dpZHRoOjEyOHB4fS5zY3JlZW4tcmVhZGVyc3twb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0FwcExpbmsgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyTGlua0FjdGl2YXRlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQXBwU3dpdGNoZXJMaW5rQWN0aXZhdGVkXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyTGlua01vdmUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0FwcFN3aXRjaGVyTGlua01vdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzQXBwU3dpdGNoZXJMaW5rUmVtb3ZlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNBcHBTd2l0Y2hlckxpbmtSZW1vdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzQXBwU3dpdGNoZXJMaW5rQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0FwcFN3aXRjaGVyTGlua0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmlzRmlyc3RSb3cgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0xhc3RSb3cgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tb3ZlRWxlbWVudCA9IChrZXlDb2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyTGlua01vdmUuZW1pdCh7XG4gICAgICAgICAgICAgICAgdWlkOiB0aGlzLmFwcC5pdGVtSWQgfHwgdGhpcy5hcHAudGl0bGUsXG4gICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuaW5kZXgsXG4gICAgICAgICAgICAgICAga2V5Q29kZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlS2V5ID0gKGV2dCkgPT4ge1xuICAgICAgICAgICAgbGV0IGtleU1hdGNoID0gdHJ1ZTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZ0LmNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiU3BhY2VcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nQWN0aXZlID0gIXRoaXMuc29ydGluZ0FjdGl2ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNBcHBTd2l0Y2hlckxpbmtBY3RpdmF0ZWQuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiQXJyb3dVcFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd1JpZ2h0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkFycm93RG93blwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd0xlZnRcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc29ydGluZ0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRWxlbWVudChldnQuY29kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAga2V5TWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoa2V5TWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQmx1ciA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc29ydGluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVJlbW92ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzQXBwU3dpdGNoZXJMaW5rUmVtb3ZlLmVtaXQodGhpcy5hcHAuaXRlbUlkIHx8IHRoaXMuYXBwLnRpdGxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVSZW1vdmVLZXlkb3duID0gKGV2dCkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChldnQuY29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJTcGFjZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJFbnRlclwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0FwcFN3aXRjaGVyTGlua0NsaWNrLmVtaXQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hcHAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW5kZXggPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudG90YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZm9jdXNJdGVtSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3BlblRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc29ydGluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRSZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGlmICh0aGlzLmZvY3VzSXRlbUlkICYmXG4gICAgICAgICAgICAodGhpcy5mb2N1c0l0ZW1JZCA9PT0gdGhpcy5hcHAuaXRlbUlkIHx8IHRoaXMuZm9jdXNJdGVtSWQgPT09IHRoaXMuYXBwLnRpdGxlKSkge1xuICAgICAgICAgICAgdGhpcy5zb3J0aW5nQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcC5jYW5BY2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLmxpbmtFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLmFwcC5jYW5BY2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAoX2IgPSB0aGlzLm1pc3NpbmdFbGVtZW50KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgcnRsID0gZ2V0RWxlbWVudERpcih0aGlzLmVsKSA9PT0gXCJydGxcIjtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICgoX2EgPSB0aGlzLmFwcCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNhbkFjY2VzcykgJiYgKGgoXCJhXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLmxpbmtFbGVtZW50ID0gZWwpLCBocmVmOiB0aGlzLmFwcC51cmwsIGNsYXNzOiBcImFwcC1saW5rXCIsIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXksIG9uQmx1cjogdGhpcy5oYW5kbGVCbHVyLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsaWNrLCBkcmFnZ2FibGU6IGZhbHNlLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIHJvbGU6IFwibWVudWl0ZW1cIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImljb24td3JhcHBlclwiIH0sIGgoQXBwU3dpdGNoZXJMaW5rQXJyb3dzLCB7IGFjdGl2ZTogdGhpcy5zb3J0aW5nQWN0aXZlLCBpbmRleDogdGhpcy5pbmRleCwgdG90YWw6IHRoaXMudG90YWwgfSksICF0aGlzLmFwcC5pbWFnZSAmJiB0aGlzLmFwcC5hYmJyICYmIChoKFwic3BhblwiLCB7IHN0eWxlOiB7IGZvbnRTaXplOiB0aGlzLmFwcC5mb250U2l6ZSB8fCBcIjIwcHhcIiB9LCBjbGFzczogXCJhdmVuaXIgaWNvbi1hYmJyXCIgfSwgdGhpcy5hcHAuYWJicikpLCAhdGhpcy5hcHAuaW1hZ2UgJiYgdGhpcy5hcHAuYWJiciAmJiB0aGlzLmFwcC5wbGFjZUhvbGRlckljb24gJiYgKGgoXCJpbWdcIiwgeyBzcmM6IHRoaXMuYXBwLnBsYWNlSG9sZGVySWNvbiwgYWx0OiBcIlwiIH0pKSwgdGhpcy5hcHAuaW1hZ2UgJiYgaChcImltZ1wiLCB7IHNyYzogdGhpcy5hcHAuaW1hZ2UsIGNsYXNzOiBcImljb24taW1nXCIsIGFsdDogXCJcIiB9KSksIHRoaXMuYXBwLmlzTmV3ICYmIChoKFwic3BhblwiLCB7IGNsYXNzOiB7IGluZGljYXRvcjogdHJ1ZSwgXCJpbmRpY2F0b3ItLW5ld1wiOiB0cnVlLCBcImluZGljYXRvci0tbmV3LXJ0bFwiOiBydGwgfSB9KSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWwtdGV4dFwiIH0sIHRoaXMuYXBwLmxhYmVsKSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVyc1wiIH0sIHRoaXMub3BlblRleHQpKSksIHRoaXMuYXBwICYmICF0aGlzLmFwcC5jYW5BY2Nlc3MgJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogeyBpbmRpY2F0b3I6IHRydWUsIFwiaW5kaWNhdG9yLS1yZW1vdmVcIjogdHJ1ZSwgXCJpbmRpY2F0b3ItLXJlbW92ZS1ydGxcIjogcnRsIH0sIHRhYkluZGV4OiAwLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVJlbW92ZSwgb25LZXlEb3duOiB0aGlzLmhhbmRsZVJlbW92ZUtleWRvd24gfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJ4XCIgfSkpLCBoKFwiZGl2XCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLm1pc3NpbmdFbGVtZW50ID0gZWwpLCBjbGFzczogXCJtaXNzaW5nLWljb25cIiwgdGFiSW5kZXg6IDAsIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXksIG9uQmx1cjogdGhpcy5oYW5kbGVCbHVyIH0sIGgoQXBwU3dpdGNoZXJMaW5rQXJyb3dzLCB7IGFjdGl2ZTogdGhpcy5zb3J0aW5nQWN0aXZlLCBpbmRleDogdGhpcy5pbmRleCwgdG90YWw6IHRoaXMudG90YWwgfSkpLCBoKFwicFwiLCB7IGNsYXNzOiBcImxhYmVsLXRleHRcIiB9LCB0aGlzLmFwcC5sYWJlbCkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzQXBwTGluay5zdHlsZSA9IGFyY2dpc0FwcFN3aXRjaGVyTGlua0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzQXBwU3dpdGNoZXIgYXMgYXJjZ2lzX2FwcF9zd2l0Y2hlciwgQXJjZ2lzQXBwTGluayBhcyBhcmNnaXNfYXBwX3N3aXRjaGVyX2xpbmsgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWFwcC1zd2l0Y2hlcl8yLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nIH0gZnJvbSAnLi91cmwtNGMzYWU1NGMuanMnO1xuXG5mdW5jdGlvbiBpc0VzcmkoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gaXRlbS5vd25lcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlc3JpXCIpKTtcbn1cbmZ1bmN0aW9uIGlzUHJlbWl1bShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIENyZWRpdHNcIikpO1xufVxuZnVuY3Rpb24gaXNTdWJzY3JpYmVyKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgU3Vic2NyaXB0aW9uXCIpKTtcbn1cbmZ1bmN0aW9uIGlzT3duZXIoaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpdGVtLm93bmVyID09PSB1c2VyLnVzZXJuYW1lO1xufVxuLyoqXG4gKiBDYW4gdGhlIHVzZXIgdXBkYXRlIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW0oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikgfHwgaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJ1cGRhdGVcIjtcbn1cbi8qKlxuICogSXMgdGhlIHVzZXIgZWl0aGVyIGFuIG93bmVyIG9yIGFkbWluIG9mIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGlzT3duZXIoaXRlbSwgdXNlcikgfHwgaXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG59XG4vKipcbiAqIERvZXMgdGhlIHVzZXIgaGF2ZSBhZG1pbiBjYXBhYmlsaXRpZXMgb24gdGhpcyBpdGVtXG4gKi9cbmZ1bmN0aW9uIGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gaWYgdGhpcyBmbGFnIGlzIGFscmVhZHkgc2V0IChwcm9iYWJseSBob21lIGFwcCksIHVzZSBpdFxuICAgIGlmIChpdGVtLmlzQWRtaW4gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gISFpdGVtLmlzQWRtaW47XG4gICAgfVxuICAgIGNvbnN0IGl0ZW1Pd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3QgaXRlbUNvbnRyb2xBZG1pbiA9IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwiYWRtaW5cIjtcbiAgICBjb25zdCBlc3JpVXNlcnMgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCIsIFwiZXNyaV9kZW1vZ3JhcGhpY3NcIiwgXCJlc3JpX2JvdW5kYXJpZXNcIl07XG4gICAgaWYgKCgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSAmJlxuICAgICAgICAhaXNPd25lcihpdGVtLCB1c2VyKSAmJlxuICAgICAgICBpdGVtQ29udHJvbEFkbWluICYmXG4gICAgICAgIGl0ZW1Pd25lci5pbmNsdWRlcyhcImVzcmlfXCIpICYmXG4gICAgICAgIC8vIHBvcnRhbCBpbmNvcnJlY3RseSByZXR1cm5zIFwiaXRlbUNvbnRyb2w9XCJhZG1pblwiIGZvciBlc3JpIG93bmVkIGl0ZW1zXG4gICAgICAgICFlc3JpVXNlcnMuaW5jbHVkZXMoaXRlbU93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBpdGVtQ29udHJvbEFkbWluO1xufVxuY29uc3QgaXRlbXNCZWxvbmdUb1VzZXJPcmcgPSAoaXRlbXMsIHVzZXIpID0+IHtcbiAgICByZXR1cm4gISF1c2VyLm9yZ0lkICYmIGl0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtLmlzT3JnSXRlbSk7XG59O1xuY29uc3QgZ2V0SXRlbUhvbWVBcHBVcmwgPSAoaXRlbUlkLCBiYXNlVXJsKSA9PiBgJHthZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nKGJhc2VVcmwpfWl0ZW0uaHRtbD9pZD0ke2l0ZW1JZH1gO1xuXG5leHBvcnQgeyBpc1N1YnNjcmliZXIgYXMgYSwgaXNQcmVtaXVtIGFzIGIsIGNhblVwZGF0ZUl0ZW0gYXMgYywgaXRlbXNCZWxvbmdUb1VzZXJPcmcgYXMgZCwgZ2V0SXRlbUhvbWVBcHBVcmwgYXMgZywgaXNPd25lciBhcyBpLCB1c2VySXNJdGVtQWRtaW4gYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pdGVtLTM1MzU1NTJkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gICAgW1wiYXJcIiwgXCJhclwiXSxcbiAgICBbXCJiZ1wiLCBcImJnXCJdLFxuICAgIFtcImJzXCIsIFwiYnNcIl0sXG4gICAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgICBbXCJjc1wiLCBcImNzXCJdLFxuICAgIFtcImRhXCIsIFwiZGFcIl0sXG4gICAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgICBbXCJlbFwiLCBcImVsXCJdLFxuICAgIFtcImVuXCIsIFwiZW5cIl0sXG4gICAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgICBbXCJldFwiLCBcImV0XCJdLFxuICAgIFtcImZpXCIsIFwiZmlcIl0sXG4gICAgW1wiZnJcIiwgXCJmclwiXSxcbiAgICBbXCJoZVwiLCBcImhlXCJdLFxuICAgIFtcImhyXCIsIFwiaHJcIl0sXG4gICAgW1wiaHVcIiwgXCJodVwiXSxcbiAgICBbXCJpZFwiLCBcImlkXCJdLFxuICAgIFtcIml0XCIsIFwiaXRcIl0sXG4gICAgW1wiamFcIiwgXCJqYVwiXSxcbiAgICBbXCJrb1wiLCBcImtvXCJdLFxuICAgIFtcImx0XCIsIFwibHRcIl0sXG4gICAgW1wibHZcIiwgXCJsdlwiXSxcbiAgICBbXCJuYlwiLCBcIm5iXCJdLFxuICAgIFtcIm5sXCIsIFwibmxcIl0sXG4gICAgW1wicGxcIiwgXCJwbFwiXSxcbiAgICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICAgIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gICAgW1wicm9cIiwgXCJyb1wiXSxcbiAgICBbXCJydVwiLCBcInJ1XCJdLFxuICAgIFtcInNrXCIsIFwic2tcIl0sXG4gICAgW1wic2xcIiwgXCJzbFwiXSxcbiAgICBbXCJzclwiLCBcInNyXCJdLFxuICAgIFtcInN2XCIsIFwic3ZcIl0sXG4gICAgW1widGhcIiwgXCJ0aFwiXSxcbiAgICBbXCJ0clwiLCBcInRyXCJdLFxuICAgIFtcInVrXCIsIFwidWtcIl0sXG4gICAgW1widmlcIiwgXCJ2aVwiXSxcbiAgICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICAgIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gICAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gICAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gICAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoYXBpID09PSA0KSB7XG4gICAgICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICAgICAgICBwbGFjZXMsXG4gICAgICAgICAgICBzdHlsZTogdHlwZSxcbiAgICAgICAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gICAgfVxuICAgIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIHBsYWNlcyxcbiAgICAgICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gICAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgICAgICBtb250aDogXCJzaG9ydFwiLFxuICAgICAgICBkYXk6IFwibnVtZXJpY1wiXG4gICAgfTtcbiAgICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFBsdXJhbChsYW5nLCBzdHJpbmdPYmosIG51bWJlcikge1xuICAgIGNvbnN0IHNpbmdsZXMgPSBbXCJpZFwiLCBcImphXCIsIFwia29cIiwgXCJ0aFwiLCBcInZpXCIsIFwiemgtY25cIiwgXCJ6aC1oa1wiLCBcInpoLXR3XCJdO1xuICAgIGNvbnN0IGxpa2VFbmdsaXNoID0gW1xuICAgICAgICBcImVuXCIsXG4gICAgICAgIFwiY2FcIixcbiAgICAgICAgXCJkYVwiLFxuICAgICAgICBcImRlXCIsXG4gICAgICAgIFwiZWxcIixcbiAgICAgICAgXCJlc1wiLFxuICAgICAgICBcImV0XCIsXG4gICAgICAgIFwiZmlcIixcbiAgICAgICAgXCJoaVwiLFxuICAgICAgICBcImh1XCIsXG4gICAgICAgIFwiaXRcIixcbiAgICAgICAgXCJuYlwiLFxuICAgICAgICBcIm5sXCIsXG4gICAgICAgIFwicHQtcHRcIixcbiAgICAgICAgXCJzdlwiLFxuICAgICAgICBcInRyXCJcbiAgICBdO1xuICAgIGNvbnN0IGxvY2FsZSA9IGxhbmcgIT09IG51bGwgJiYgbGFuZyAhPT0gdm9pZCAwID8gbGFuZyA6IFwiZW5cIjtcbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG9uZSwgb3IgaXQgaXMgYSBcInNpbXBsZVwiIGxhbmd1YWdlLCByZXR1cm4gdGhlIDEgc3RyaW5nXG4gICAgaWYgKG51bWJlciA9PT0gMSB8fCBzaW5nbGVzLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5zaW5nbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBcIjFcIik7XG4gICAgfVxuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgbm90IDEgYW5kIHRoZSBsYW5ndWFnZSB1c2VzIHRoZSBzYW1lIHBsdXJhbGl6YXRpb24gc3RyYXRlZ3kgYXMgZW5nbGlzaCxcbiAgICAvLyByZXR1cm4gdGhlIG11bHRpcGxlIHN0cmluZ1xuICAgIGlmIChudW1iZXIgIT09IDEgJiYgbGlrZUVuZ2xpc2guaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLm11bHRpcGxlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xuICAgIH1cbiAgICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSB3b3JrZWQsIHJldHVybiB0aGUgXCJ1bmtub3duXCIgc3RyaW5nXG4gICAgcmV0dXJuIHN0cmluZ09iai51bmtub3duLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdFBsdXJhbCBhcyBiLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAgIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAgICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICAgICAgICByZXR1cm4gbGFuZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICAgIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgICAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gICAgbGV0IHN0cmluZ3M7XG4gICAgdHJ5IHtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsZS0wNTBiNmRiOS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHUgYXMgdXNlcklzSXRlbUFkbWluLCBjIGFzIGNhblVwZGF0ZUl0ZW0sIGQgYXMgaXRlbXNCZWxvbmdUb1VzZXJPcmcgfSBmcm9tICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuXG5jb25zdCBnZXRVc2VyUm9sZSA9ICh1c2VyKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIHR5cGVvZiAodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGUpID09PSBcInN0cmluZ1wiICYmICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlKVxuICAgICAgICA/IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlXG4gICAgICAgIDogKF9iID0gKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGVJZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLmlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlkO1xufTtcbmZ1bmN0aW9uIGlzUHVibGljVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXIgJiYgIXVzZXIub3JnSWQ7XG59XG5mdW5jdGlvbiBpc0hvc3RlZFBvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gIXBvcnRhbC5pc1BvcnRhbCB8fCAhIXBvcnRhbC5pc0JhY2tlZEJ5U0RTO1xufVxuZnVuY3Rpb24gaXNEZXZlbG9wZXIoc3Vic2NyaXB0aW9uSW5mbykge1xuICAgIGNvbnN0IGRldlN1YnNjcmlwdGlvblR5cGVzID0gW1wiVHJpYWwgRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyIFN1YnNjcmlwdGlvblwiXTtcbiAgICByZXR1cm4gZGV2U3Vic2NyaXB0aW9uVHlwZXMuaW5jbHVkZXMoc3Vic2NyaXB0aW9uSW5mbyA9PT0gbnVsbCB8fCBzdWJzY3JpcHRpb25JbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xufVxuZnVuY3Rpb24gaXNPcmdBZG1pbih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ19hZG1pblwiIHx8IGdldFVzZXJSb2xlKHVzZXIpID09PSBcImFjY291bnRfYWRtaW5cIjtcbn1cbmZ1bmN0aW9uIGlzT3JnVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ191c2VyXCIgfHwgZ2V0VXNlclJvbGUodXNlcikgPT09IFwiYWNjb3VudF91c2VyXCI7XG59XG5mdW5jdGlvbiBpc0N1c3RvbVJvbGUodXNlcikge1xuICAgIC8vIFRoZSBIb21lIEFwcCBjb2xsYXBzZSB0aGUgYHJvbGVJZGAgYW5kIGByb2xlYCBpbnRvIGEgc2luZ2xlIGBpZGAgcHJvcGVydHksIHRoYXQncyB3aHlcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvYmxvYi9tYXN0ZXIvc3JjL2pzL2FyY2dpc29ubGluZS9zaGFyaW5nL2Rpaml0L1JvbGUudHMjTDQ2OSB3b3Jrc1xuICAgIC8vIEluIHByYWN0aWNlLCB3ZSBvbmx5IG5lZWQgdG8gY2hlY2sgaWYgYHJvbGVJZGAgZXhpc3RcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ0NjgyI2lzc3VlY29tbWVudC00MTQ2ODY2XG4gICAgcmV0dXJuICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlSWQpICYmIHVzZXIucm9sZUlkLmxlbmd0aCA+IDA7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBwcml2aWxlZ2UgXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbUNhdGVnb3J5U2NoZW1hXCIgaXMgZ3JhbnRlZC5cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXModXNlcikge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtQ2F0ZWdvcnlTY2hlbWFcIikpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgcHJpdmlsZWdlIFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiIGlzIGdyYW50ZWQuXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0dyb3Vwcyh1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gdXBkYXRlIG90aGVyIHVzZXIncyBpdGVtcyBpbiB0aGVpciBvcmdhbml6YXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3MgdG8gZW5zdXJlIHRoZSBwb3J0YWwgaXMgYW4gb3JnYW5pemF0aW9uIHBvcnRhbFxuICovXG5mdW5jdGlvbiBpc09yZ1BvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gISEocG9ydGFsLnVybEtleSAmJiBwb3J0YWwuY3VzdG9tQmFzZVVybCkgfHwgISFwb3J0YWwuaXNQb3J0YWw7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gc2hhcmUgdGhlaXIgaXRlbSB0byBncm91cHNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9Hcm91cCh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9Hcm91cFwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIGFuIGl0ZW0gb24gYSBnaXZlbiBwb3J0YWxcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmUodXNlciwgcG9ydGFsKSB7XG4gICAgcmV0dXJuICghaXNPcmdQb3J0YWwocG9ydGFsKSB8fFxuICAgICAgICBjYW5TaGFyZUl0ZW1Ub0dyb3VwKHVzZXIpIHx8XG4gICAgICAgIGNhblNoYXJlSXRlbVRvT3JnKHVzZXIpIHx8XG4gICAgICAgICghIXBvcnRhbC5jYW5TaGFyZVB1YmxpYyAmJiBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyh1c2VyKSkpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gb3QgdGhlIG9yZ2FuaXphdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvT3JnXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gdG8gcHVibGljXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvUHVibGljKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb09yZ1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBhZG1pbkNhblNoYXJlT3RoZXJzSXRlbVRvR3JvdXAodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb0dyb3VwXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBpbiBhbiBhbGxvd2VkIG9yZ2FuaXphdGlvbiBhbmQgaGFzIHRoZSBwb3dlciB0byBtYW5hZ2UgY29sbGFib3JhdGlvbnNcbiAqL1xuZnVuY3Rpb24gY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMoY29uZmlnLCB1c2VyLCBwb3J0YWwsIHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICBjb25zdCBleGNsdWRlZE9yZ1R5cGVzID0gW1wiVHJpYWxcIiwgXCJUcmlhbCBQcmVzc1wiLCBcIlRyaWFsIERldmVsb3BlclwiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIiwgXCJFdmFsdWF0aW9uXCJdO1xuICAgIGNvbnN0IGlzVmFsaWRPcmdUeXBlID0gc3Vic2NyaXB0aW9uSW5mbyAmJiAhZXhjbHVkZWRPcmdUeXBlcy5pbmNsdWRlcyhzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xuICAgIGNvbnN0IGhhc1ByaXZpbGVnZSA9ICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjptYW5hZ2VDb2xsYWJvcmF0aW9uc1wiKTtcbiAgICByZXR1cm4gISEoKGNvbmZpZyA9PT0gbnVsbCB8fCBjb25maWcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZy5jb2xsYWJvcmF0aW9uc0VuYWJsZWQpICYmXG4gICAgICAgIHVzZXIgJiZcbiAgICAgICAgKGlzT3JnQWRtaW4odXNlcikgfHwgaGFzUHJpdmlsZWdlKSAmJlxuICAgICAgICAoKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgfHwgaXNWYWxpZE9yZ1R5cGUpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHZpZXcgb3RoZXIgb3JnYW5pemF0aW9uIHVzZXJzJyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5WaWV3T3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dmlld0l0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gdmlldyBvdGhlciBvcmdhbml6YXRpb24gdXNlcnMnIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblZpZXdPdGhlcnNPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICEhdXNlciAmJiAoIWlzQ3VzdG9tUm9sZSh1c2VyKSB8fCAoaXNDdXN0b21Sb2xlKHVzZXIpICYmIGNhblZpZXdPcmdJdGVtcyh1c2VyKSkpO1xufVxuLy8gVE9ETzogYWRkIHVuaXQgdGVzdHNcbmNvbnN0IGhhc0FkbWluU2hhcmVQcml2aWxlZ2UgPSAoeyBpdGVtcywgdXNlciwgcG9ydGFsIH0pID0+IHtcbiAgICBjb25zdCBpdGVtID0gaXRlbXNbMF07XG4gICAgLy8gZW50ZXJwcmlzZSBpbmNvcnJlY3RseSByZXR1cm5zIGl0ZW1zIG93bmVkIGJ5IFwiZXNyaV9cIiBhcyBpdGVtIGNvbnRyb2wgYWRtaW4gKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzODY5NSlcbiAgICBjb25zdCBvd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3Qgd2hpdGVsaXN0T3duZXIgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCJdO1xuICAgIGlmIChwb3J0YWwuaXNQb3J0YWwgJiYgb3duZXIgIT09IHVzZXIudXNlcm5hbWUgJiYgb3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJiAhd2hpdGVsaXN0T3duZXIuaW5jbHVkZXMob3duZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgaXNPd25lck9yQWRtaW4gPSB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG4gICAgY29uc3QgaXNDdXN0b20gPSBpc0N1c3RvbVJvbGUodXNlcik7XG4gICAgY29uc3QgY2FuU2hhcmVPcmdJdGVtcyA9IGNhblNoYXJlT3RoZXJzSXRlbXModXNlcik7XG4gICAgY29uc3QgY2FuVXBkYXRlQW5kU2hhcmUgPSBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpICYmXG4gICAgICAgIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpICYmXG4gICAgICAgICFpc0N1c3RvbSAmJlxuICAgICAgICAoY2FuU2hhcmUodXNlciwgcG9ydGFsKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpKTtcbiAgICAvLyBpZiBpdCdzIHRoZSBpdGVtIG93bmVyIG9yIGFkbWluLCBvciBjdXN0b20gYWRtaW4gd2hvIGNhbiBzaGFyZVxuICAgIHJldHVybiBpc093bmVyT3JBZG1pbiB8fCBjYW5VcGRhdGVBbmRTaGFyZSB8fCAoaXRlbXNCZWxvbmdUb1VzZXJPcmcoaXRlbXMsIHVzZXIpICYmIGNhblNoYXJlT3JnSXRlbXMpO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwKHVzZXIpIHx8IGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyh1c2VyKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcik7XG59XG5cbmV4cG9ydCB7IGlzUHVibGljVXNlciBhcyBhLCBpc09yZ0FkbWluIGFzIGIsIGlzSG9zdGVkUG9ydGFsIGFzIGMsIGlzQ3VzdG9tUm9sZSBhcyBkLCBjYW5VcGRhdGVPcmdHcm91cHMgYXMgZSwgY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXMgYXMgZiwgY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMgYXMgZywgaXNPcmdVc2VyIGFzIGgsIGlzRGV2ZWxvcGVyIGFzIGksIGNhblNoYXJlSXRlbVRvR3JvdXAgYXMgaiwgY2FuU2hhcmVJdGVtVG9PcmcgYXMgaywgYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwIGFzIGwsIGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyBhcyBtLCBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyBhcyBuLCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWMgYXMgbywgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSBhcyBwLCBjYW5WaWV3T3RoZXJzT3JnSXRlbXMgYXMgcSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcml2aWxlZ2VzLTVjMzgyZjYxLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZSBhcyBlc2NhcGVSZWdFeHAgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuXG4vLyBpbXBvcnQgc3RyaW5nVXRpbCBmcm9tIFwiLi9zdHJpbmdzXCI7XG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHN0b3JhZ2Ugb2YgdmFyaW91cyBmb3JtcyAoY29va2llcywgbG9jYWwgc3RvcmFnZSwgYW5kIHNlc3Npb24gc3RvcmFnZSkuXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZShuYW1lLCBjb29raWUsIHByb3BlcnRpZXMsIHN0cmluZ2lmeSkge1xuICAgIHdyaXRlQ29va2llKG5hbWUsIHN0cmluZ2lmeSA/IEpTT04uc3RyaW5naWZ5KGNvb2tpZSkgOiBjb29raWUsIHByb3BlcnRpZXMpO1xufVxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUsIHBhcnNlKSB7XG4gICAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgICByZXR1cm4gY29va2llICYmIHBhcnNlID8gSlNPTi5wYXJzZShjb29raWUpIDogY29va2llO1xufVxuZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBpdGVtLCBzdHJpbmdpZnkpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgcGFyc2UpIHtcbiAgICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICAgIHJldHVybiBpdGVtICYmIHBhcnNlID8gSlNPTi5wYXJzZShpdGVtKSA6IGl0ZW07XG59XG5mdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldFNlc3Npb25TdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gcmVhZENvb2tpZShuYW1lKSB7XG4gICAgY29uc3QgY29va2llID0gZG9jdW1lbnQuY29va2llO1xuICAgIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgICBjb25zdCBtYXRjaGVkQ29va2llcyA9IGNvb2tpZS5tYXRjaChjb29raWVOYW1lUkUpO1xuICAgIHJldHVybiBtYXRjaGVkQ29va2llcyA/IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVkQ29va2llc1sxXSkgOiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiB3cml0ZUNvb2tpZShuYW1lLCB2YWx1ZSwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGxldCBleHBpcmVzID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLmV4cGlyZXM7XG4gICAgaWYgKHR5cGVvZiBleHBpcmVzID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShEYXRlLm5vdygpICsgZGF5c0Zyb21Ub2RheUluTXMpO1xuICAgICAgICBleHBpcmVzID0gcHJvcGVydGllcy5leHBpcmVzID0gZXhwaXJhdGlvbkRhdGU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmV4cGlyZXMgPSBleHBpcmVzLnRvVVRDU3RyaW5nKCk7XG4gICAgfVxuICAgIGxldCBjb29raWUgPSBgJHtuYW1lfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSl9YDtcbiAgICBsZXQgcHJvcGVydHk7XG4gICAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGNvb2tpZSArPSBgOyAke3Byb3BlcnR5fWA7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZTtcbn1cblxuZXhwb3J0IHsgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGEsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBiLCBnZXRDb29raWUgYXMgYywgc2V0Q29va2llIGFzIGQsIGdldExvY2FsU3RvcmFnZUl0ZW0gYXMgZywgc2V0TG9jYWxTdG9yYWdlSXRlbSBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0b3JhZ2UtMDM1M2E3NjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9