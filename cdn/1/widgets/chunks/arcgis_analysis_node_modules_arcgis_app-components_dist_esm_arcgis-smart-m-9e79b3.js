"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-smart-m-9e79b3"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-heatmap-slider.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-heatmap-slider.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_heatmap_slider: () => (/* binding */ ArcgisSmartMappingHeatmapSlider)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










const arcgisSmartMappingHeatmapSliderCss = ".slider-box{height:255px}.slider-box .esri-heatmap-slider__ramp{width:30px}.slider-box .esri-heatmap-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-heatmap-slider{min-width:200px}";

const ArcgisSmartMappingHeatmapSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.styleSheetStatus = "not-loaded";
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("link", { rel: "stylesheet", href: `${config.jsapiUrl}/themes/light/main.css`, onLoad: () => {
                this.styleSheetStatus = "loaded";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, onError: () => {
                this.styleSheetStatus = "failed";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.styleSheetStatus === "loaded"
            ? this.renderHeatmapSlider()
            : this.styleSheetStatus === "not-loaded"
                ? this.renderHeatmapSliderLoading()
                : null));
    }
    renderHeatmapSlider() {
        const ok = this.prepareHeatmapSlider();
        if (ok || this.heatmapSlider) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                    if (node) {
                        this.afterHeatmapSliderCreate(node);
                    }
                } })));
        }
        else {
            return this.renderHeatmapSliderLoading();
        }
    }
    renderHeatmapSliderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    prepareHeatmapSlider() {
        var _a;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (!this.heatmapSlider) {
            const colorStops = renderer.colorStops.map((stop) => new modules.HeatmapColorStop({
                color: new modules.esriColor(stop.color.toRgba()),
                ratio: stop.ratio
            }));
            const config = {
                stops: colorStops.splice(3, colorStops.length - 3)
            };
            this.heatmapSlider = new modules.HeatmapSlider(config);
            this.createHeatmapSliderChangeEvents();
        }
        else {
            const slider = this.heatmapSlider;
            if (((_a = slider.slider) === null || _a === void 0 ? void 0 : _a.state) === "dragging") {
                return true;
            }
            const colorStops = renderer.colorStops.map((stop) => new modules.HeatmapColorStop({
                color: new modules.esriColor(stop.color.toRgba()),
                ratio: stop.ratio
            }));
            const config = {
                stops: colorStops.splice(3, colorStops.length - 3)
            };
            this.heatmapSlider.set(config);
        }
        return (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.heatmapSlider);
    }
    afterHeatmapSliderCreate(node) {
        if (!this.heatmapSlider.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.heatmapSlider.container = divNode;
        }
    }
    createHeatmapSliderChangeEvents() {
        if (!this.heatmapSlider) {
            return;
        }
        this.heatmapSlider.on("thumb-change", () => {
            this.handleHeatmapSliderEvent();
        });
        this.heatmapSlider.on("thumb-drag", () => {
            this.handleHeatmapSliderEvent();
        });
    }
    handleHeatmapSliderEvent() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const firstThumb = this.heatmapSlider.values[0];
        const secondThumb = this.heatmapSlider.values[1];
        if (firstThumb === secondThumb) {
            // don't allow handles at same spot; causes issues with slider on ramp change
            if (firstThumb + 0.001 <= 1) {
                this.heatmapSlider.viewModel.setValue(1, firstThumb + 0.001);
            }
            else {
                this.heatmapSlider.viewModel.setValue(0, secondThumb - 0.001);
            }
        }
        const deletedStops = renderer.colorStops
            .filter((_, idx) => idx < 3)
            .map((stop) => new modules.HeatmapColorStop({
            color: new modules.esriColor(stop.color.toRgba()),
            ratio: stop.ratio
        }));
        const firstRatio = deletedStops[deletedStops.length - 1].ratio;
        if (firstThumb < firstRatio) {
            this.heatmapSlider.viewModel.setValue(0, firstRatio);
        }
        const newStops = deletedStops.concat(this.heatmapSlider.stops.slice());
        renderer.colorStops = newStops;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingHeatmapSlider.style = arcgisSmartMappingHeatmapSliderCss;



//# sourceMappingURL=arcgis-smart-mapping-heatmap-slider.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLXNtYXJ0LW0tOWU3OWIzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUN1QjtBQUNqRztBQUNBO0FBQ0M7QUFDVDtBQUNHO0FBQ0Q7QUFDVTs7QUFFdkMsd0RBQXdELGFBQWEsdUNBQXVDLFdBQVcsb0VBQW9FLGFBQWEsaUNBQWlDLGdCQUFnQjs7QUFFelA7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsU0FBUyxFQUFFLCtEQUFpQjtBQUM1QyxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLFdBQVcsNEJBQTRCLGdCQUFnQjtBQUN0RjtBQUNBLGdCQUFnQixxREFBVztBQUMzQixhQUFhO0FBQ2I7QUFDQSxnQkFBZ0IscURBQVc7QUFDM0IsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IscURBQUMsVUFBVSxxQkFBcUIsRUFBRSxxREFBQyxVQUFVO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVSxFQUFFLCtEQUFpQjtBQUM3QyxnQkFBZ0IscURBQUMsVUFBVSxxQkFBcUIsRUFBRSxxREFBQyxxQkFBcUIsd0JBQXdCO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaUJBQWlCLEVBQUUsK0RBQWlCO0FBQ3BELHlCQUF5QixtRUFBVztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLG9FQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsZ0JBQWdCLGlCQUFpQixFQUFFLCtEQUFpQjtBQUNwRCx5QkFBeUIsbUVBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLG9FQUFjO0FBQ3RCO0FBQ0Esd0JBQXdCLE9BQU8scURBQVU7QUFDekM7QUFDQTs7QUFFa0Y7O0FBRWxGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctaGVhdG1hcC1zbGlkZXIuZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIGYgYXMgZm9yY2VVcGRhdGUsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBhYyBhcyBpc0RlZmluZWQsIGFiIGFzIHVwZGF0ZVJlbmRlcmVyLCBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlLCBoIGFzIGdldFJlbmRlcmVyIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdIZWF0bWFwU2xpZGVyQ3NzID0gXCIuc2xpZGVyLWJveHtoZWlnaHQ6MjU1cHh9LnNsaWRlci1ib3ggLmVzcmktaGVhdG1hcC1zbGlkZXJfX3JhbXB7d2lkdGg6MzBweH0uc2xpZGVyLWJveCAuZXNyaS1oZWF0bWFwLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19jb250ZW50e2hlaWdodDoxNzVweH0uc2xpZGVyLWJveCAuZXNyaS1oZWF0bWFwLXNsaWRlcnttaW4td2lkdGg6MjAwcHh9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ0hlYXRtYXBTbGlkZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnN0eWxlU2hlZXRTdGF0dXMgPSBcIm5vdC1sb2FkZWRcIjtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNvbmZpZyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwibGlua1wiLCB7IHJlbDogXCJzdHlsZXNoZWV0XCIsIGhyZWY6IGAke2NvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzYCwgb25Mb2FkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID0gXCJsb2FkZWRcIjtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0sIG9uRXJyb3I6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlU2hlZXRTdGF0dXMgPSBcImZhaWxlZFwiO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSwgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID09PSBcImxvYWRlZFwiXG4gICAgICAgICAgICA/IHRoaXMucmVuZGVySGVhdG1hcFNsaWRlcigpXG4gICAgICAgICAgICA6IHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJub3QtbG9hZGVkXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMucmVuZGVySGVhdG1hcFNsaWRlckxvYWRpbmcoKVxuICAgICAgICAgICAgICAgIDogbnVsbCkpO1xuICAgIH1cbiAgICByZW5kZXJIZWF0bWFwU2xpZGVyKCkge1xuICAgICAgICBjb25zdCBvayA9IHRoaXMucHJlcGFyZUhlYXRtYXBTbGlkZXIoKTtcbiAgICAgICAgaWYgKG9rIHx8IHRoaXMuaGVhdG1hcFNsaWRlcikge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2xpZGVyLWJveFwiIH0sIGgoXCJkaXZcIiwgeyByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVySGVhdG1hcFNsaWRlckNyZWF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gfSkpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckhlYXRtYXBTbGlkZXJMb2FkaW5nKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVySGVhdG1hcFNsaWRlckxvYWRpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5sb2FkaW5nIH0pKSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBwcmVwYXJlSGVhdG1hcFNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGlmICghdGhpcy5oZWF0bWFwU2xpZGVyKSB7XG4gICAgICAgICAgICBjb25zdCBjb2xvclN0b3BzID0gcmVuZGVyZXIuY29sb3JTdG9wcy5tYXAoKHN0b3ApID0+IG5ldyBtb2R1bGVzLkhlYXRtYXBDb2xvclN0b3Aoe1xuICAgICAgICAgICAgICAgIGNvbG9yOiBuZXcgbW9kdWxlcy5lc3JpQ29sb3Ioc3RvcC5jb2xvci50b1JnYmEoKSksXG4gICAgICAgICAgICAgICAgcmF0aW86IHN0b3AucmF0aW9cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBzdG9wczogY29sb3JTdG9wcy5zcGxpY2UoMywgY29sb3JTdG9wcy5sZW5ndGggLSAzKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuaGVhdG1hcFNsaWRlciA9IG5ldyBtb2R1bGVzLkhlYXRtYXBTbGlkZXIoY29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlSGVhdG1hcFNsaWRlckNoYW5nZUV2ZW50cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc2xpZGVyID0gdGhpcy5oZWF0bWFwU2xpZGVyO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSBzbGlkZXIuc2xpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBcImRyYWdnaW5nXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3RvcHMgPSByZW5kZXJlci5jb2xvclN0b3BzLm1hcCgoc3RvcCkgPT4gbmV3IG1vZHVsZXMuSGVhdG1hcENvbG9yU3RvcCh7XG4gICAgICAgICAgICAgICAgY29sb3I6IG5ldyBtb2R1bGVzLmVzcmlDb2xvcihzdG9wLmNvbG9yLnRvUmdiYSgpKSxcbiAgICAgICAgICAgICAgICByYXRpbzogc3RvcC5yYXRpb1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHN0b3BzOiBjb2xvclN0b3BzLnNwbGljZSgzLCBjb2xvclN0b3BzLmxlbmd0aCAtIDMpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5oZWF0bWFwU2xpZGVyLnNldChjb25maWcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc0RlZmluZWQodGhpcy5oZWF0bWFwU2xpZGVyKTtcbiAgICB9XG4gICAgYWZ0ZXJIZWF0bWFwU2xpZGVyQ3JlYXRlKG5vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmhlYXRtYXBTbGlkZXIuY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIG5vZGUuYXBwZW5kKGRpdk5vZGUpO1xuICAgICAgICAgICAgdGhpcy5oZWF0bWFwU2xpZGVyLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlSGVhdG1hcFNsaWRlckNoYW5nZUV2ZW50cygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmhlYXRtYXBTbGlkZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhlYXRtYXBTbGlkZXIub24oXCJ0aHVtYi1jaGFuZ2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVIZWF0bWFwU2xpZGVyRXZlbnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaGVhdG1hcFNsaWRlci5vbihcInRodW1iLWRyYWdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVIZWF0bWFwU2xpZGVyRXZlbnQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhhbmRsZUhlYXRtYXBTbGlkZXJFdmVudCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBmaXJzdFRodW1iID0gdGhpcy5oZWF0bWFwU2xpZGVyLnZhbHVlc1swXTtcbiAgICAgICAgY29uc3Qgc2Vjb25kVGh1bWIgPSB0aGlzLmhlYXRtYXBTbGlkZXIudmFsdWVzWzFdO1xuICAgICAgICBpZiAoZmlyc3RUaHVtYiA9PT0gc2Vjb25kVGh1bWIpIHtcbiAgICAgICAgICAgIC8vIGRvbid0IGFsbG93IGhhbmRsZXMgYXQgc2FtZSBzcG90OyBjYXVzZXMgaXNzdWVzIHdpdGggc2xpZGVyIG9uIHJhbXAgY2hhbmdlXG4gICAgICAgICAgICBpZiAoZmlyc3RUaHVtYiArIDAuMDAxIDw9IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYXRtYXBTbGlkZXIudmlld01vZGVsLnNldFZhbHVlKDEsIGZpcnN0VGh1bWIgKyAwLjAwMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYXRtYXBTbGlkZXIudmlld01vZGVsLnNldFZhbHVlKDAsIHNlY29uZFRodW1iIC0gMC4wMDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRlbGV0ZWRTdG9wcyA9IHJlbmRlcmVyLmNvbG9yU3RvcHNcbiAgICAgICAgICAgIC5maWx0ZXIoKF8sIGlkeCkgPT4gaWR4IDwgMylcbiAgICAgICAgICAgIC5tYXAoKHN0b3ApID0+IG5ldyBtb2R1bGVzLkhlYXRtYXBDb2xvclN0b3Aoe1xuICAgICAgICAgICAgY29sb3I6IG5ldyBtb2R1bGVzLmVzcmlDb2xvcihzdG9wLmNvbG9yLnRvUmdiYSgpKSxcbiAgICAgICAgICAgIHJhdGlvOiBzdG9wLnJhdGlvXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgZmlyc3RSYXRpbyA9IGRlbGV0ZWRTdG9wc1tkZWxldGVkU3RvcHMubGVuZ3RoIC0gMV0ucmF0aW87XG4gICAgICAgIGlmIChmaXJzdFRodW1iIDwgZmlyc3RSYXRpbykge1xuICAgICAgICAgICAgdGhpcy5oZWF0bWFwU2xpZGVyLnZpZXdNb2RlbC5zZXRWYWx1ZSgwLCBmaXJzdFJhdGlvKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdTdG9wcyA9IGRlbGV0ZWRTdG9wcy5jb25jYXQodGhpcy5oZWF0bWFwU2xpZGVyLnN0b3BzLnNsaWNlKCkpO1xuICAgICAgICByZW5kZXJlci5jb2xvclN0b3BzID0gbmV3U3RvcHM7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdIZWF0bWFwU2xpZGVyLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nSGVhdG1hcFNsaWRlckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nSGVhdG1hcFNsaWRlciBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19oZWF0bWFwX3NsaWRlciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtc21hcnQtbWFwcGluZy1oZWF0bWFwLXNsaWRlci5lbnRyeS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=