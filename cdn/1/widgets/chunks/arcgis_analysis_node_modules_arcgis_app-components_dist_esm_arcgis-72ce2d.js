"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-72ce2d"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-contrast_8.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-contrast_8.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_color_contrast: () => (/* binding */ ArcgisColorContrast),
/* harmony export */   arcgis_color_edit: () => (/* binding */ ArcgisColorEdit),
/* harmony export */   arcgis_color_swatch: () => (/* binding */ ArcgisColorSwatch),
/* harmony export */   arcgis_color_text_input: () => (/* binding */ ArcgisColorTextInput),
/* harmony export */   arcgis_configure_colors_table: () => (/* binding */ ArcgisConfigureColorsTable),
/* harmony export */   arcgis_contrast_preview: () => (/* binding */ ArcgisContrastPreview),
/* harmony export */   arcgis_preset_colors: () => (/* binding */ ArcgisPresetColors),
/* harmony export */   arcgis_shared_theme_colors: () => (/* binding */ ArcgisSharedThemeColors)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */







function checkContrast(a, b) {
    // complete shorthand hex codes
    a = expandHexAbbr(a);
    b = expandHexAbbr(b);
    const lum = [a, b].map(hexRgb).map(relativeLuminance);
    const contrast = luminance(lum[0], lum[1]);
    return {
        contrast,
        passesDoubleA: contrast >= 4.5
    };
}
function expandHexAbbr(hex) {
    if (hex.length !== 4) {
        return hex;
    }
    const h = hex.split("");
    return `#${h[1]}${h[1]}${h[2]}${h[2]}${h[3]}${h[3]}`;
}
function hexRgb(hex) {
    hex = hex.replace(/^#/, "");
    const alpha = 255;
    const num = parseInt(hex, 16);
    const red = num >> 16;
    const green = (num >> 8) & 255;
    const blue = num & 255;
    return [red, green, blue, alpha];
}
function relativeLuminance(rgb) {
    const rc = 0.2126;
    const gc = 0.7152;
    const bc = 0.0722;
    const lowc = 1 / 12.92;
    const rsrgb = rgb[0] / 255;
    const gsrgb = rgb[1] / 255;
    const bsrgb = rgb[2] / 255;
    const r = rsrgb <= 0.03928 ? rsrgb * lowc : adjustGamma(rsrgb), g = gsrgb <= 0.03928 ? gsrgb * lowc : adjustGamma(gsrgb), b = bsrgb <= 0.03928 ? bsrgb * lowc : adjustGamma(bsrgb);
    return r * rc + g * gc + b * bc;
}
function adjustGamma(x) {
    return Math.pow((x + 0.055) / 1.055, 2.4);
}
function luminance(a, b) {
    const l1 = Math.max(a, b);
    const l2 = Math.min(a, b);
    return (l1 + 0.05) / (l2 + 0.05);
}

const arcgisColorContrastCss = ".color-contrast{--calcite-modal-width:830px}.contrast-warning-modal{--calcite-modal-width:415px}.color-contrast__modal-content{padding:var(--arcgis-app-cap-spacing-half);position:relative;min-height:500px}.color-contrast__container{display:flex}@media screen and (max-width: 640px){.color-contrast__container{flex-direction:column}}.config-color-panel{flex:1 1 auto;min-width:0;margin-right:var(--arcgis-app-side-spacing-double);width:50%}@media screen and (max-width: 640px){.config-color-panel{width:100%}}.color-contrast__preview-panel{width:45%;flex:1 1 auto;min-width:0;display:flex;flex-direction:column}@media screen and (max-width: 640px){.color-contrast__preview-panel{width:100%}}.color-contrast__color-picker-container{position:absolute;left:50%}.hide{display:none}html[dir=rtl] .config-color-panel{margin-right:0;margin-left:var(--arcgis-app-side-spacing-double)}";

const ArcgisColorContrast = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.save = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "save", 7);
        this.cancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "cancel", 7);
        this.handleProceedAnayway = () => {
            this.showWarning = false;
            this.proceedToSave();
        };
        this.handleAcceptWarning = () => {
            this.showWarning = false;
        };
        this.handleSaveClick = () => {
            const hasInvalid = Object.keys(this.colorValues).some((key) => !this.colorValues[key].isBackground && !this.colorValues[key].isValidContrast);
            if (hasInvalid) {
                this.showWarning = true;
                return;
            }
            this.proceedToSave();
        };
        this.proceedToSave = () => {
            const colorResults = {};
            Object.keys(this.colorValues).forEach((key) => {
                colorResults[key] = Object.assign({}, this.colorValues[key]);
                delete colorResults[key].isBackground;
                delete colorResults[key].isLink;
            });
            this.save.emit({
                textResults: Object.assign({}, this.textValues),
                colorResults
            });
        };
        this.handleCancelClick = () => {
            this.cancel.emit();
            this.isActive = false;
        };
        this.handleEditColorClick = async (evt) => {
            this.editingKey = evt.detail;
            this.showColorPicker = true;
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_2__.t)(100);
            this.colorPickerEl.setFocus();
        };
        this.handleColorPickerChange = (evt) => {
            if (this.colorValues[this.editingKey].color !== evt.target.value) {
                this.setColorValue(evt.target.value);
            }
        };
        this.handlePresetColorSelect = (evt) => {
            this.setColorValue(evt.detail);
        };
        this.handleTextInputChange = (evt) => {
            const { key, value } = evt.detail;
            this.textValues = Object.assign(Object.assign({}, this.textValues), { [key]: value });
        };
        this.handleModalClose = () => {
            this.isActive = false;
        };
        this.modalTitle = "";
        this.colorConfigs = undefined;
        this.textInputConfigs = undefined;
        this.sharedTheme = undefined;
        this.isActive = true;
        this.showColorPicker = false;
        this.colorValues = {};
        this.textValues = {};
        this.editingKey = "";
        this.showWarning = false;
    }
    // Public Methods
    async open() {
        this.isActive = true;
    }
    async close() {
        this.isActive = false;
    }
    handleBodyClick(evt) {
        if (!this.showColorPicker) {
            return;
        }
        if (!this.colorPickerContainer || evt.path.indexOf(this.colorPickerContainer) === -1) {
            this.showColorPicker = false;
        }
    }
    setColorValue(color) {
        var _a;
        const updateValue = (key, props) => {
            const value = this.colorValues[key];
            this.colorValues = Object.assign(Object.assign({}, this.colorValues), { [key]: Object.assign(Object.assign({}, value), props) });
        };
        const colorValue = this.colorValues[this.editingKey];
        if (colorValue.isBackground) {
            this.colorValues = Object.assign(Object.assign({}, this.colorValues), { [this.editingKey]: Object.assign(Object.assign({}, colorValue), { color }) });
            Object.keys(this.colorValues).forEach((key) => {
                const value = this.colorValues[key];
                if (value.isBackground) {
                    return;
                }
                const { contrast, passesDoubleA } = checkContrast(color, value.color);
                updateValue(key, { contrastRatio: +contrast.toFixed(1), isValidContrast: passesDoubleA });
            });
            return;
        }
        const backgroundConfig = this.getBackgroundConfig();
        const backgroundColor = (_a = this.colorValues[backgroundConfig.key]) === null || _a === void 0 ? void 0 : _a.color;
        const { contrast, passesDoubleA } = checkContrast(backgroundColor, color);
        updateValue(this.editingKey, {
            color,
            contrastRatio: +contrast.toFixed(1),
            isValidContrast: passesDoubleA
        });
    }
    getBackgroundConfig() {
        return this.colorConfigs.find((config) => config.isBackground);
    }
    async componentWillLoad() {
        var _a;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
        this.i18n = locale[0];
        this.colorValues = this.colorConfigs.reduce((acc, { key, defaultColor, isBackground, isLink }) => {
            acc[key] = {
                color: defaultColor,
                isBackground,
                isLink
            };
            return acc;
        }, {});
        const backgroundConfig = this.getBackgroundConfig();
        if (!backgroundConfig) {
            return;
        }
        const backgroundColor = (_a = this.colorValues[backgroundConfig.key]) === null || _a === void 0 ? void 0 : _a.color;
        Object.keys(this.colorValues).forEach((key) => {
            const value = this.colorValues[key];
            if (value.isBackground) {
                return;
            }
            const { contrast, passesDoubleA } = checkContrast(value.color, backgroundColor);
            value.contrastRatio = +contrast.toFixed(1);
            value.isValidContrast = passesDoubleA;
        });
        this.textInputConfigs.forEach((config) => {
            this.textValues[config.key] = config.defaultValue || "";
        });
    }
    render() {
        var _a;
        const backgroundConfig = this.getBackgroundConfig();
        const linkConfig = this.colorConfigs.filter((config) => config.isLink)[0];
        const otherConfigs = this.colorConfigs.filter((config) => !config.isBackground && !config.isLink);
        const backgroundColor = backgroundConfig ? this.colorValues[backgroundConfig.key].color : "";
        if (!backgroundConfig) {
            return;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: this.isActive, class: "color-contrast", onCalciteModalClose: this.handleModalClose }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header" }, this.modalTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "color-contrast__modal-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "config-color-panel" }, this.textInputConfigs.map((config) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-text-input", { key: config.key, keyValue: config.key, label: config.label, defaultValue: config.defaultValue, onInputChange: this.handleTextInputChange }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-configure-colors-table", { i18n: this.i18n, backgroundConfig: backgroundConfig, otherConfigs: otherConfigs, linkConfig: linkConfig, colorValues: this.colorValues, onEditClick: this.handleEditColorClick })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__preview-panel" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.preview), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-contrast-preview", { backgroundColor: backgroundColor, textColorConfigs: otherConfigs, linkConfig: linkConfig, colorValues: this.colorValues })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "color-contrast__color-picker-container": true,
                hide: !this.showColorPicker
            }, ref: (el) => (this.colorPickerContainer = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker", { scale: "s", value: (_a = this.colorValues[this.editingKey]) === null || _a === void 0 ? void 0 : _a.color, hideSaved: true, ref: (el) => (this.colorPickerEl = el), onCalciteColorPickerInput: this.handleColorPickerChange }), this.sharedTheme && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-shared-theme-colors", { sharedTheme: this.sharedTheme, i18n: this.i18n, onSelectColor: this.handlePresetColorSelect }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-preset-colors", { i18n: this.i18n, onSelectColor: this.handlePresetColorSelect }))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", onClick: this.handleCancelClick }, this.i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", onClick: this.handleSaveClick }, this.i18n.save)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: this.showWarning, kind: "danger", class: "contrast-warning-modal" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header", class: "trailer-0 font-size-1" }, this.i18n.contrastWarning.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content" }, this.i18n.contrastWarning.description), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", onClick: this.handleAcceptWarning }, this.i18n.contrastWarning.editColors), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", kind: "danger", appearance: "transparent", onClick: this.handleProceedAnayway }, this.i18n.contrastWarning.proceedAnyway))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisColorContrast.style = arcgisColorContrastCss;

const arcgisColorEditCss = ".color-edit-container{padding:var(--arcgis-app-side-spacing-quarter);display:flex;align-items:center;cursor:pointer}.color-tile{border:1px solid #a9a9a9;width:30px;height:30px;margin-right:var(--arcgis-app-side-spacing-three-quarters)}.color-edit__label-value{flex:1 1 auto;min-width:0;text-align:start}.color-edit-label{font-size:var(--arcgis-app-font-size--2);font-weight:normal}.color-edit-value{font-size:var(--arcgis-app-font-size--1);font-weight:var(--arcgis-app-font-weight-demi)}.color-edit-icon{margin-right:var(--arcgis-app-side-spacing-three-quarters)}html[dir=rtl] .color-tile{margin-right:0;margin-left:var(--arcgis-app-side-spacing-three-quarters)}html[dir=rtl] .color-edit-icon{margin-right:0;margin-left:var(--arcgis-app-side-spacing-three-quarters)}";

const ArcgisColorEdit = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.colorEditClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "colorEditClick", 7);
        this.handleClick = (evt) => {
            evt === null || evt === void 0 ? void 0 : evt.stopPropagation();
            this.colorEditClick.emit(this.editKey);
        };
        this.handleKeyup = (event) => {
            if (event.key === " " || event.key === "Enter") {
                event.preventDefault();
                this.handleClick(event);
            }
        };
        this.editKey = "";
        this.labelText = "";
        this.colorValue = "";
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-container", tabIndex: 0, onClick: this.handleClick, onKeyUp: this.handleKeyup }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-tile", style: { backgroundColor: this.colorValue } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit__label-value" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-label" }, this.labelText), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-value " }, this.colorValue)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-edit-icon" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "pencil" }))));
    }
};
ArcgisColorEdit.style = arcgisColorEditCss;

const arcgisColorSwatchCss = ".color-swatch{display:inline-block;height:16px;width:16px;box-sizing:border-box;margin-right:2px;overflow:hidden}";

const ArcgisColorSwatch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.swatchClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "swatchClick", 7);
        this.handleClick = () => {
            this.swatchClick.emit(this.color);
        };
        this.handleKeyUp = (event) => {
            if (event.key === " " || event.key === "Enter") {
                this.handleClick();
            }
        };
        this.color = "";
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-swatch", onClick: this.handleClick, onKeyUp: this.handleKeyUp, tabIndex: 0 }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { width: "16", height: "16" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { width: "16", height: "16", fill: this.color }))));
    }
};
ArcgisColorSwatch.style = arcgisColorSwatchCss;

const ArcgisColorTextInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.inputChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "inputChange", 7);
        this.handleInputChange = (evt) => {
            const node = evt.target;
            this.value = node.value;
            this.inputChange.emit({
                key: this.keyValue,
                value: node.value
            });
        };
        this.keyValue = undefined;
        this.label = undefined;
        this.defaultValue = undefined;
        this.value = "";
    }
    componentWillLoad() {
        if (this.defaultValue) {
            this.value = this.defaultValue;
        }
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { value: this.value, onCalciteInputInput: this.handleInputChange, scale: "s" })));
    }
};

const ColorRow = ({ key, colorConfig, color, contrastRatio, isValidContrast, i18n, onColorEditClick }) => {
    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", { "data-key": key },
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__color-col" },
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-edit", { editKey: colorConfig.key, labelText: colorConfig.label, colorValue: color, onColorEditClick: onColorEditClick })),
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__ratio-col" }, contrastRatio),
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { class: "color-contrast__legibility-col" },
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-row__legibility" }, isValidContrast ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null,
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "check-circle-f", class: "color-contrast--valid" }),
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__legible-label" }, i18n.legible))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null,
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "x-circle-f", class: "color-contrast--invalid" }),
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "color-contrast__legible-label" }, i18n.notLegible)))))));
};

const arcgisConfigureColorsTableCss = ".config-color-table{width:100%;border-collapse:collapse}th,td{border:1px solid rgba(221, 221, 221, 0.8666666667);text-align:center;font-size:var(--arcgis-app-font-size--1)}.color-contrast__legibility-col{padding:0.5rem;text-align:start;width:6rem}.color-contrast--valid{color:green}.color-contrast--invalid{color:red}.color-row__legibility{display:flex;align-items:center}.color-contrast__legible-label{margin:0 0.5rem}.contrast-info{font-size:0.8rem}";

const ArcgisConfigureColorsTable = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.editClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "editClick", 7);
        this.handleEditClick = (evt) => {
            this.editClick.emit(evt.detail);
        };
        this.i18n = undefined;
        this.backgroundConfig = undefined;
        this.otherConfigs = undefined;
        this.linkConfig = undefined;
        this.colorValues = {};
    }
    render() {
        var _a;
        const backgroundColor = this.colorValues[this.backgroundConfig.key].color;
        const linkValue = this.colorValues[(_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.key];
        const linkColor = (linkValue === null || linkValue === void 0 ? void 0 : linkValue.color) || "";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.configure, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("table", { class: "config-color-table" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("thead", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-edit", { editKey: this.backgroundConfig.key, labelText: this.backgroundConfig.label || this.i18n.background, colorValue: backgroundColor, onColorEditClick: this.handleEditClick })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", { class: "color-edit-label" }, this.i18n.contrastRatio), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", { class: "color-edit-label" }, this.i18n.legibility))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("tbody", null, this.otherConfigs.map((config) => {
            const { color, contrastRatio, isValidContrast } = this.colorValues[config.key];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(ColorRow, { key: config.key, colorConfig: config, color: color, contrastRatio: contrastRatio, isValidContrast: isValidContrast, i18n: this.i18n, onColorEditClick: this.handleEditClick }));
        }), this.linkConfig && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(ColorRow, { key: this.linkConfig.key, colorConfig: this.linkConfig, color: linkColor, contrastRatio: linkValue === null || linkValue === void 0 ? void 0 : linkValue.contrastRatio, isValidContrast: linkValue === null || linkValue === void 0 ? void 0 : linkValue.isValidContrast, i18n: this.i18n, onColorEditClick: this.handleEditClick })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "contrast-info" }, this.i18n.contrastInfo)));
    }
};
ArcgisConfigureColorsTable.style = arcgisConfigureColorsTableCss;

const arcgisContrastPreviewCss = ".contrast-preview{padding:1rem;flex:1 1 auto;min-width:0}.contrast-preview h2,.contrast-preview p,.contrast-preview button{margin-bottom:1rem;margin-top:0}";

const ArcgisContrastPreview = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.backgroundColor = "";
        this.textColorConfigs = undefined;
        this.linkConfig = undefined;
        this.colorValues = undefined;
    }
    renderLinkConfig() {
        var _a;
        if (!((_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.preview)) {
            return;
        }
        const { preview } = this.linkConfig;
        if (preview.isButton) {
            return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", null, preview.text);
        }
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, preview.text);
    }
    render() {
        var _a;
        const linkColor = this.colorValues[(_a = this.linkConfig) === null || _a === void 0 ? void 0 : _a.key].color || "#00a0ff";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", { innerHTML: `.contrast-preview a {
          color: ${linkColor || "inherit"};
        } .contrast-preview button {
          color: ${linkColor || "inherit"};
          border: ${linkColor ? `1px solid ${linkColor}` : "inherit"};
          background: ${linkColor ? "none" : "inherit"};
          padding: 0.375rem 1rem;
        }` }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "contrast-preview", style: { backgroundColor: this.backgroundColor } }, this.textColorConfigs.map(({ preview, key }) => {
            const { color } = this.colorValues[key];
            if (!preview) {
                return;
            }
            if (preview.isHeading) {
                return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h2", { style: { color }, innerHTML: preview.text });
            }
            return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { style: { color }, innerHTML: preview.text });
        }), this.renderLinkConfig())));
    }
};
ArcgisContrastPreview.style = arcgisContrastPreviewCss;

const arcgisPresetColorsCss = ".preset-colors{max-width:160px;padding:8px 16px;background-color:#fff;border:1px solid #ccc;border-top:none;box-sizing:border-box}.preset-colors .preset-colors__title{font-size:0.825rem}.preset-colors .preset-row{max-height:16px;margin-bottom:2px}";

const ArcgisPresetColors = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.selectColor = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "selectColor", 7);
        this.presetColors = {
            brown: ["f2ece6", "7c410a", "3e2105"],
            blue: ["e5f1f9", "0079c1", "003d61"],
            green: ["e9f3ea", "288835", "14441b"],
            yellow: ["fefced", "f9e54e", "7d7327"],
            orange: ["fef5e9", "f89927", "7c4d14"],
            red: ["fbeae8", "d83020", "6c1810"],
            violet: ["efebf5", "633b9b", "321e4e"]
        };
        this.handleSwatchClick = (evt) => {
            this.selectColor.emit(evt.detail);
        };
        this.i18n = undefined;
    }
    render() {
        const colorRows = [];
        for (let i = 2; i >= 0; i--) {
            const row = [];
            Object.keys(this.presetColors).forEach((key) => {
                const colorArr = this.presetColors[key];
                row.push(`#${colorArr[i]}`);
            });
            colorRows.push(row);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-colors" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-colors__title" }, this.i18n.presetColors), colorRows.map((row) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "preset-row" }, row.map((color) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-swatch", { key: color, color: color, onSwatchClick: this.handleSwatchClick }))))))));
    }
};
ArcgisPresetColors.style = arcgisPresetColorsCss;

const arcgisSharedThemeColorsCss = ".shared-theme{max-width:160px;padding:8px 16px;background-color:#fff;border:1px solid #ccc;border-top:none;box-sizing:border-box}.shared-theme-colors__title{font-size:0.825rem}.shared-theme__row{max-height:16px;margin-bottom:2px}";

const ArcgisSharedThemeColors = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.selectColor = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "selectColor", 7);
        this.handleSwatchClick = (evt) => {
            this.selectColor.emit(evt.detail);
        };
        this.i18n = undefined;
        this.sharedTheme = undefined;
    }
    render() {
        if (!this.sharedTheme) {
            return;
        }
        const colors = {};
        Object.keys(this.sharedTheme).forEach((key) => {
            if (!this.sharedTheme[key]) {
                return;
            }
            const { background, text, link } = this.sharedTheme[key];
            if (background) {
                colors[background] = true;
            }
            if (text) {
                colors[text] = true;
            }
            if (link) {
                colors[link] = true;
            }
        });
        if (!Object.keys(colors).length) {
            return;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme-colors__title" }, this.i18n.sharedTheme), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "shared-theme__row" }, Object.keys(colors).sort().map((color) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-color-swatch", { key: color, color: color, onSwatchClick: this.handleSwatchClick }))))));
    }
};
ArcgisSharedThemeColors.style = arcgisSharedThemeColorsCss;



//# sourceMappingURL=arcgis-color-contrast_8.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
    let timeout;
    let status = "idle";
    function flush(...args) {
        status = "flushed";
        return debounced(...args);
    }
    function invoke(...args) {
        status = "invoked";
        return debounced(...args);
    }
    function cancel(...args) {
        status = "cancelled";
        return debounced(...args);
    }
    function getStatus() {
        return status;
    }
    const debounced = (...args) => new Promise((resolve) => {
        switch (status) {
            case "flushed":
                status = "idle";
                if (timeout) {
                    clearTimeout(timeout);
                    resolve(fn(...args));
                }
                else {
                    resolve(null);
                }
                break;
            case "invoked":
                clearTimeout(timeout);
                status = "idle";
                resolve(fn(...args));
                break;
            case "cancelled":
                clearTimeout(timeout);
                status = "idle";
                resolve(null);
                break;
            default:
                if (timeout) {
                    clearTimeout(timeout);
                }
                status = "pending";
                timeout = setTimeout(() => {
                    status = "idle";
                    return resolve(fn(...args));
                }, delay);
                break;
        }
    });
    debounced.flush = flush;
    debounced.invoke = invoke;
    debounced.cancel = cancel;
    debounced.getStatus = getStatus;
    return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
    let timeout;
    return (...args) => new Promise((resolve) => {
        if (timeout) {
            return;
        }
        timeout = setTimeout(() => {
            clearTimeout(timeout);
            timeout = undefined;
            resolve(fn(...args));
        }, delay);
    });
};
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
    await Promise.all([promise, timeout(minDelay)]);
    return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
    const { key, data } = getKeyAndItem(item);
    return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
    const resultArr = [];
    const lookupMap = {};
    myArr.forEach((item) => {
        const id = getItemId(item);
        if (lookupMap[id] == null) {
            lookupMap[id] = item;
            resultArr.push(item);
        }
    });
    return resultArr;
}
function unique(myArr) {
    const primitives = { boolean: {}, number: {}, string: {} };
    const objs = [];
    return myArr.filter((item) => {
        let type = typeof item;
        if (type in primitives) {
            return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
        }
        else {
            return objs.indexOf(item) >= 0 ? false : objs.push(item);
        }
    });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));



//# sourceMappingURL=functional-44de8fcf.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTcyY2UyZC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3REO0FBQ2Q7QUFDN0I7QUFDUztBQUNEOztBQUVuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsZ0RBQWdELDRCQUE0Qix3QkFBd0IsNEJBQTRCLCtCQUErQiwyQ0FBMkMsa0JBQWtCLGlCQUFpQiwyQkFBMkIsYUFBYSxxQ0FBcUMsMkJBQTJCLHVCQUF1QixvQkFBb0IsY0FBYyxZQUFZLG1EQUFtRCxVQUFVLHFDQUFxQyxvQkFBb0IsWUFBWSwrQkFBK0IsVUFBVSxjQUFjLFlBQVksYUFBYSxzQkFBc0IscUNBQXFDLCtCQUErQixZQUFZLHdDQUF3QyxrQkFBa0IsU0FBUyxNQUFNLGFBQWEsa0NBQWtDLGVBQWUsa0RBQWtEOztBQUUzNEI7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLG9CQUFvQixxREFBVztBQUMvQixzQkFBc0IscURBQVc7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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Li9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1jb2xvci1jb250cmFzdF84LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0wNTBiNmRiOS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQsIEYgYXMgRnJhZ21lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IHQgYXMgdGltZW91dCB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcblxuZnVuY3Rpb24gY2hlY2tDb250cmFzdChhLCBiKSB7XG4gICAgLy8gY29tcGxldGUgc2hvcnRoYW5kIGhleCBjb2Rlc1xuICAgIGEgPSBleHBhbmRIZXhBYmJyKGEpO1xuICAgIGIgPSBleHBhbmRIZXhBYmJyKGIpO1xuICAgIGNvbnN0IGx1bSA9IFthLCBiXS5tYXAoaGV4UmdiKS5tYXAocmVsYXRpdmVMdW1pbmFuY2UpO1xuICAgIGNvbnN0IGNvbnRyYXN0ID0gbHVtaW5hbmNlKGx1bVswXSwgbHVtWzFdKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBjb250cmFzdCxcbiAgICAgICAgcGFzc2VzRG91YmxlQTogY29udHJhc3QgPj0gNC41XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGV4cGFuZEhleEFiYnIoaGV4KSB7XG4gICAgaWYgKGhleC5sZW5ndGggIT09IDQpIHtcbiAgICAgICAgcmV0dXJuIGhleDtcbiAgICB9XG4gICAgY29uc3QgaCA9IGhleC5zcGxpdChcIlwiKTtcbiAgICByZXR1cm4gYCMke2hbMV19JHtoWzFdfSR7aFsyXX0ke2hbMl19JHtoWzNdfSR7aFszXX1gO1xufVxuZnVuY3Rpb24gaGV4UmdiKGhleCkge1xuICAgIGhleCA9IGhleC5yZXBsYWNlKC9eIy8sIFwiXCIpO1xuICAgIGNvbnN0IGFscGhhID0gMjU1O1xuICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KGhleCwgMTYpO1xuICAgIGNvbnN0IHJlZCA9IG51bSA+PiAxNjtcbiAgICBjb25zdCBncmVlbiA9IChudW0gPj4gOCkgJiAyNTU7XG4gICAgY29uc3QgYmx1ZSA9IG51bSAmIDI1NTtcbiAgICByZXR1cm4gW3JlZCwgZ3JlZW4sIGJsdWUsIGFscGhhXTtcbn1cbmZ1bmN0aW9uIHJlbGF0aXZlTHVtaW5hbmNlKHJnYikge1xuICAgIGNvbnN0IHJjID0gMC4yMTI2O1xuICAgIGNvbnN0IGdjID0gMC43MTUyO1xuICAgIGNvbnN0IGJjID0gMC4wNzIyO1xuICAgIGNvbnN0IGxvd2MgPSAxIC8gMTIuOTI7XG4gICAgY29uc3QgcnNyZ2IgPSByZ2JbMF0gLyAyNTU7XG4gICAgY29uc3QgZ3NyZ2IgPSByZ2JbMV0gLyAyNTU7XG4gICAgY29uc3QgYnNyZ2IgPSByZ2JbMl0gLyAyNTU7XG4gICAgY29uc3QgciA9IHJzcmdiIDw9IDAuMDM5MjggPyByc3JnYiAqIGxvd2MgOiBhZGp1c3RHYW1tYShyc3JnYiksIGcgPSBnc3JnYiA8PSAwLjAzOTI4ID8gZ3NyZ2IgKiBsb3djIDogYWRqdXN0R2FtbWEoZ3NyZ2IpLCBiID0gYnNyZ2IgPD0gMC4wMzkyOCA/IGJzcmdiICogbG93YyA6IGFkanVzdEdhbW1hKGJzcmdiKTtcbiAgICByZXR1cm4gciAqIHJjICsgZyAqIGdjICsgYiAqIGJjO1xufVxuZnVuY3Rpb24gYWRqdXN0R2FtbWEoeCkge1xuICAgIHJldHVybiBNYXRoLnBvdygoeCArIDAuMDU1KSAvIDEuMDU1LCAyLjQpO1xufVxuZnVuY3Rpb24gbHVtaW5hbmNlKGEsIGIpIHtcbiAgICBjb25zdCBsMSA9IE1hdGgubWF4KGEsIGIpO1xuICAgIGNvbnN0IGwyID0gTWF0aC5taW4oYSwgYik7XG4gICAgcmV0dXJuIChsMSArIDAuMDUpIC8gKGwyICsgMC4wNSk7XG59XG5cbmNvbnN0IGFyY2dpc0NvbG9yQ29udHJhc3RDc3MgPSBcIi5jb2xvci1jb250cmFzdHstLWNhbGNpdGUtbW9kYWwtd2lkdGg6ODMwcHh9LmNvbnRyYXN0LXdhcm5pbmctbW9kYWx7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjQxNXB4fS5jb2xvci1jb250cmFzdF9fbW9kYWwtY29udGVudHtwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtY2FwLXNwYWNpbmctaGFsZik7cG9zaXRpb246cmVsYXRpdmU7bWluLWhlaWdodDo1MDBweH0uY29sb3ItY29udHJhc3RfX2NvbnRhaW5lcntkaXNwbGF5OmZsZXh9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjQwcHgpey5jb2xvci1jb250cmFzdF9fY29udGFpbmVye2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn19LmNvbmZpZy1jb2xvci1wYW5lbHtmbGV4OjEgMSBhdXRvO21pbi13aWR0aDowO21hcmdpbi1yaWdodDp2YXIoLS1hcmNnaXMtYXBwLXNpZGUtc3BhY2luZy1kb3VibGUpO3dpZHRoOjUwJX1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NDBweCl7LmNvbmZpZy1jb2xvci1wYW5lbHt3aWR0aDoxMDAlfX0uY29sb3ItY29udHJhc3RfX3ByZXZpZXctcGFuZWx7d2lkdGg6NDUlO2ZsZXg6MSAxIGF1dG87bWluLXdpZHRoOjA7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NDBweCl7LmNvbG9yLWNvbnRyYXN0X19wcmV2aWV3LXBhbmVse3dpZHRoOjEwMCV9fS5jb2xvci1jb250cmFzdF9fY29sb3ItcGlja2VyLWNvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjUwJX0uaGlkZXtkaXNwbGF5Om5vbmV9aHRtbFtkaXI9cnRsXSAuY29uZmlnLWNvbG9yLXBhbmVse21hcmdpbi1yaWdodDowO21hcmdpbi1sZWZ0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLWRvdWJsZSl9XCI7XG5cbmNvbnN0IEFyY2dpc0NvbG9yQ29udHJhc3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnNhdmUgPSBjcmVhdGVFdmVudCh0aGlzLCBcInNhdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuY2FuY2VsID0gY3JlYXRlRXZlbnQodGhpcywgXCJjYW5jZWxcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFuZGxlUHJvY2VlZEFuYXl3YXkgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNob3dXYXJuaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnByb2NlZWRUb1NhdmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVBY2NlcHRXYXJuaW5nID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93V2FybmluZyA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVNhdmVDbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhhc0ludmFsaWQgPSBPYmplY3Qua2V5cyh0aGlzLmNvbG9yVmFsdWVzKS5zb21lKChrZXkpID0+ICF0aGlzLmNvbG9yVmFsdWVzW2tleV0uaXNCYWNrZ3JvdW5kICYmICF0aGlzLmNvbG9yVmFsdWVzW2tleV0uaXNWYWxpZENvbnRyYXN0KTtcbiAgICAgICAgICAgIGlmIChoYXNJbnZhbGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93V2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wcm9jZWVkVG9TYXZlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJvY2VlZFRvU2F2ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yUmVzdWx0cyA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5jb2xvclZhbHVlcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29sb3JSZXN1bHRzW2tleV0gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbG9yVmFsdWVzW2tleV0pO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb2xvclJlc3VsdHNba2V5XS5pc0JhY2tncm91bmQ7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGNvbG9yUmVzdWx0c1trZXldLmlzTGluaztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zYXZlLmVtaXQoe1xuICAgICAgICAgICAgICAgIHRleHRSZXN1bHRzOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRleHRWYWx1ZXMpLFxuICAgICAgICAgICAgICAgIGNvbG9yUmVzdWx0c1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FuY2VsQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbC5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRWRpdENvbG9yQ2xpY2sgPSBhc3luYyAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVkaXRpbmdLZXkgPSBldnQuZGV0YWlsO1xuICAgICAgICAgICAgdGhpcy5zaG93Q29sb3JQaWNrZXIgPSB0cnVlO1xuICAgICAgICAgICAgYXdhaXQgdGltZW91dCgxMDApO1xuICAgICAgICAgICAgdGhpcy5jb2xvclBpY2tlckVsLnNldEZvY3VzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ29sb3JQaWNrZXJDaGFuZ2UgPSAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5jb2xvclZhbHVlc1t0aGlzLmVkaXRpbmdLZXldLmNvbG9yICE9PSBldnQudGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb2xvclZhbHVlKGV2dC50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVByZXNldENvbG9yU2VsZWN0ID0gKGV2dCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRDb2xvclZhbHVlKGV2dC5kZXRhaWwpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVRleHRJbnB1dENoYW5nZSA9IChldnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsga2V5LCB2YWx1ZSB9ID0gZXZ0LmRldGFpbDtcbiAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy50ZXh0VmFsdWVzKSwgeyBba2V5XTogdmFsdWUgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlTW9kYWxDbG9zZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tb2RhbFRpdGxlID0gXCJcIjtcbiAgICAgICAgdGhpcy5jb2xvckNvbmZpZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudGV4dElucHV0Q29uZmlncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaGFyZWRUaGVtZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd0NvbG9yUGlja2VyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSB7fTtcbiAgICAgICAgdGhpcy50ZXh0VmFsdWVzID0ge307XG4gICAgICAgIHRoaXMuZWRpdGluZ0tleSA9IFwiXCI7XG4gICAgICAgIHRoaXMuc2hvd1dhcm5pbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gUHVibGljIE1ldGhvZHNcbiAgICBhc3luYyBvcGVuKCkge1xuICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFuZGxlQm9keUNsaWNrKGV2dCkge1xuICAgICAgICBpZiAoIXRoaXMuc2hvd0NvbG9yUGlja2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNvbG9yUGlja2VyQ29udGFpbmVyIHx8IGV2dC5wYXRoLmluZGV4T2YodGhpcy5jb2xvclBpY2tlckNvbnRhaW5lcikgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dDb2xvclBpY2tlciA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldENvbG9yVmFsdWUoY29sb3IpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB1cGRhdGVWYWx1ZSA9IChrZXksIHByb3BzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY29sb3JWYWx1ZXNba2V5XTtcbiAgICAgICAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29sb3JWYWx1ZXMpLCB7IFtrZXldOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHZhbHVlKSwgcHJvcHMpIH0pO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb2xvclZhbHVlID0gdGhpcy5jb2xvclZhbHVlc1t0aGlzLmVkaXRpbmdLZXldO1xuICAgICAgICBpZiAoY29sb3JWYWx1ZS5pc0JhY2tncm91bmQpIHtcbiAgICAgICAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29sb3JWYWx1ZXMpLCB7IFt0aGlzLmVkaXRpbmdLZXldOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGNvbG9yVmFsdWUpLCB7IGNvbG9yIH0pIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5jb2xvclZhbHVlcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmNvbG9yVmFsdWVzW2tleV07XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlzQmFja2dyb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHsgY29udHJhc3QsIHBhc3Nlc0RvdWJsZUEgfSA9IGNoZWNrQ29udHJhc3QoY29sb3IsIHZhbHVlLmNvbG9yKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVWYWx1ZShrZXksIHsgY29udHJhc3RSYXRpbzogK2NvbnRyYXN0LnRvRml4ZWQoMSksIGlzVmFsaWRDb250cmFzdDogcGFzc2VzRG91YmxlQSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJhY2tncm91bmRDb25maWcgPSB0aGlzLmdldEJhY2tncm91bmRDb25maWcoKTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gKF9hID0gdGhpcy5jb2xvclZhbHVlc1tiYWNrZ3JvdW5kQ29uZmlnLmtleV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb2xvcjtcbiAgICAgICAgY29uc3QgeyBjb250cmFzdCwgcGFzc2VzRG91YmxlQSB9ID0gY2hlY2tDb250cmFzdChiYWNrZ3JvdW5kQ29sb3IsIGNvbG9yKTtcbiAgICAgICAgdXBkYXRlVmFsdWUodGhpcy5lZGl0aW5nS2V5LCB7XG4gICAgICAgICAgICBjb2xvcixcbiAgICAgICAgICAgIGNvbnRyYXN0UmF0aW86ICtjb250cmFzdC50b0ZpeGVkKDEpLFxuICAgICAgICAgICAgaXNWYWxpZENvbnRyYXN0OiBwYXNzZXNEb3VibGVBXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRCYWNrZ3JvdW5kQ29uZmlnKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvckNvbmZpZ3MuZmluZCgoY29uZmlnKSA9PiBjb25maWcuaXNCYWNrZ3JvdW5kKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICB0aGlzLmNvbG9yVmFsdWVzID0gdGhpcy5jb2xvckNvbmZpZ3MucmVkdWNlKChhY2MsIHsga2V5LCBkZWZhdWx0Q29sb3IsIGlzQmFja2dyb3VuZCwgaXNMaW5rIH0pID0+IHtcbiAgICAgICAgICAgIGFjY1trZXldID0ge1xuICAgICAgICAgICAgICAgIGNvbG9yOiBkZWZhdWx0Q29sb3IsXG4gICAgICAgICAgICAgICAgaXNCYWNrZ3JvdW5kLFxuICAgICAgICAgICAgICAgIGlzTGlua1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbmZpZyA9IHRoaXMuZ2V0QmFja2dyb3VuZENvbmZpZygpO1xuICAgICAgICBpZiAoIWJhY2tncm91bmRDb25maWcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSAoX2EgPSB0aGlzLmNvbG9yVmFsdWVzW2JhY2tncm91bmRDb25maWcua2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbG9yO1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmNvbG9yVmFsdWVzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb2xvclZhbHVlc1trZXldO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlzQmFja2dyb3VuZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgY29udHJhc3QsIHBhc3Nlc0RvdWJsZUEgfSA9IGNoZWNrQ29udHJhc3QodmFsdWUuY29sb3IsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICB2YWx1ZS5jb250cmFzdFJhdGlvID0gK2NvbnRyYXN0LnRvRml4ZWQoMSk7XG4gICAgICAgICAgICB2YWx1ZS5pc1ZhbGlkQ29udHJhc3QgPSBwYXNzZXNEb3VibGVBO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50ZXh0SW5wdXRDb25maWdzLmZvckVhY2goKGNvbmZpZykgPT4ge1xuICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWVzW2NvbmZpZy5rZXldID0gY29uZmlnLmRlZmF1bHRWYWx1ZSB8fCBcIlwiO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGJhY2tncm91bmRDb25maWcgPSB0aGlzLmdldEJhY2tncm91bmRDb25maWcoKTtcbiAgICAgICAgY29uc3QgbGlua0NvbmZpZyA9IHRoaXMuY29sb3JDb25maWdzLmZpbHRlcigoY29uZmlnKSA9PiBjb25maWcuaXNMaW5rKVswXTtcbiAgICAgICAgY29uc3Qgb3RoZXJDb25maWdzID0gdGhpcy5jb2xvckNvbmZpZ3MuZmlsdGVyKChjb25maWcpID0+ICFjb25maWcuaXNCYWNrZ3JvdW5kICYmICFjb25maWcuaXNMaW5rKTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbmZpZyA/IHRoaXMuY29sb3JWYWx1ZXNbYmFja2dyb3VuZENvbmZpZy5rZXldLmNvbG9yIDogXCJcIjtcbiAgICAgICAgaWYgKCFiYWNrZ3JvdW5kQ29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgb3BlbjogdGhpcy5pc0FjdGl2ZSwgY2xhc3M6IFwiY29sb3ItY29udHJhc3RcIiwgb25DYWxjaXRlTW9kYWxDbG9zZTogdGhpcy5oYW5kbGVNb2RhbENsb3NlIH0sIGgoXCJoM1wiLCB7IHNsb3Q6IFwiaGVhZGVyXCIgfSwgdGhpcy5tb2RhbFRpdGxlKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBjbGFzczogXCJjb2xvci1jb250cmFzdF9fbW9kYWwtY29udGVudFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvci1jb250cmFzdF9fY29udGFpbmVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbmZpZy1jb2xvci1wYW5lbFwiIH0sIHRoaXMudGV4dElucHV0Q29uZmlncy5tYXAoKGNvbmZpZykgPT4gKGgoXCJhcmNnaXMtY29sb3ItdGV4dC1pbnB1dFwiLCB7IGtleTogY29uZmlnLmtleSwga2V5VmFsdWU6IGNvbmZpZy5rZXksIGxhYmVsOiBjb25maWcubGFiZWwsIGRlZmF1bHRWYWx1ZTogY29uZmlnLmRlZmF1bHRWYWx1ZSwgb25JbnB1dENoYW5nZTogdGhpcy5oYW5kbGVUZXh0SW5wdXRDaGFuZ2UgfSkpKSwgaChcImFyY2dpcy1jb25maWd1cmUtY29sb3JzLXRhYmxlXCIsIHsgaTE4bjogdGhpcy5pMThuLCBiYWNrZ3JvdW5kQ29uZmlnOiBiYWNrZ3JvdW5kQ29uZmlnLCBvdGhlckNvbmZpZ3M6IG90aGVyQ29uZmlncywgbGlua0NvbmZpZzogbGlua0NvbmZpZywgY29sb3JWYWx1ZXM6IHRoaXMuY29sb3JWYWx1ZXMsIG9uRWRpdENsaWNrOiB0aGlzLmhhbmRsZUVkaXRDb2xvckNsaWNrIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19wcmV2aWV3LXBhbmVsXCIgfSwgaChcImRpdlwiLCBudWxsLCB0aGlzLmkxOG4ucHJldmlldyksIGgoXCJhcmNnaXMtY29udHJhc3QtcHJldmlld1wiLCB7IGJhY2tncm91bmRDb2xvcjogYmFja2dyb3VuZENvbG9yLCB0ZXh0Q29sb3JDb25maWdzOiBvdGhlckNvbmZpZ3MsIGxpbmtDb25maWc6IGxpbmtDb25maWcsIGNvbG9yVmFsdWVzOiB0aGlzLmNvbG9yVmFsdWVzIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJjb2xvci1jb250cmFzdF9fY29sb3ItcGlja2VyLWNvbnRhaW5lclwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhpZGU6ICF0aGlzLnNob3dDb2xvclBpY2tlclxuICAgICAgICAgICAgfSwgcmVmOiAoZWwpID0+ICh0aGlzLmNvbG9yUGlja2VyQ29udGFpbmVyID0gZWwpIH0sIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlclwiLCB7IHNjYWxlOiBcInNcIiwgdmFsdWU6IChfYSA9IHRoaXMuY29sb3JWYWx1ZXNbdGhpcy5lZGl0aW5nS2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbG9yLCBoaWRlU2F2ZWQ6IHRydWUsIHJlZjogKGVsKSA9PiAodGhpcy5jb2xvclBpY2tlckVsID0gZWwpLCBvbkNhbGNpdGVDb2xvclBpY2tlcklucHV0OiB0aGlzLmhhbmRsZUNvbG9yUGlja2VyQ2hhbmdlIH0pLCB0aGlzLnNoYXJlZFRoZW1lICYmIChoKFwiZGl2XCIsIG51bGwsIGgoXCJhcmNnaXMtc2hhcmVkLXRoZW1lLWNvbG9yc1wiLCB7IHNoYXJlZFRoZW1lOiB0aGlzLnNoYXJlZFRoZW1lLCBpMThuOiB0aGlzLmkxOG4sIG9uU2VsZWN0Q29sb3I6IHRoaXMuaGFuZGxlUHJlc2V0Q29sb3JTZWxlY3QgfSkpKSwgaChcImRpdlwiLCBudWxsLCBoKFwiYXJjZ2lzLXByZXNldC1jb2xvcnNcIiwgeyBpMThuOiB0aGlzLmkxOG4sIG9uU2VsZWN0Q29sb3I6IHRoaXMuaGFuZGxlUHJlc2V0Q29sb3JTZWxlY3QgfSkpKSkpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhbmNlbENsaWNrIH0sIHRoaXMuaTE4bi5jYW5jZWwpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgb25DbGljazogdGhpcy5oYW5kbGVTYXZlQ2xpY2sgfSwgdGhpcy5pMThuLnNhdmUpKSwgaChcImNhbGNpdGUtbW9kYWxcIiwgeyBvcGVuOiB0aGlzLnNob3dXYXJuaW5nLCBraW5kOiBcImRhbmdlclwiLCBjbGFzczogXCJjb250cmFzdC13YXJuaW5nLW1vZGFsXCIgfSwgaChcImgzXCIsIHsgc2xvdDogXCJoZWFkZXJcIiwgY2xhc3M6IFwidHJhaWxlci0wIGZvbnQtc2l6ZS0xXCIgfSwgdGhpcy5pMThuLmNvbnRyYXN0V2FybmluZy50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiB9LCB0aGlzLmkxOG4uY29udHJhc3RXYXJuaW5nLmRlc2NyaXB0aW9uKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQWNjZXB0V2FybmluZyB9LCB0aGlzLmkxOG4uY29udHJhc3RXYXJuaW5nLmVkaXRDb2xvcnMpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInNlY29uZGFyeVwiLCBraW5kOiBcImRhbmdlclwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlUHJvY2VlZEFuYXl3YXkgfSwgdGhpcy5pMThuLmNvbnRyYXN0V2FybmluZy5wcm9jZWVkQW55d2F5KSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0NvbG9yQ29udHJhc3Quc3R5bGUgPSBhcmNnaXNDb2xvckNvbnRyYXN0Q3NzO1xuXG5jb25zdCBhcmNnaXNDb2xvckVkaXRDc3MgPSBcIi5jb2xvci1lZGl0LWNvbnRhaW5lcntwYWRkaW5nOnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLXF1YXJ0ZXIpO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Y3Vyc29yOnBvaW50ZXJ9LmNvbG9yLXRpbGV7Ym9yZGVyOjFweCBzb2xpZCAjYTlhOWE5O3dpZHRoOjMwcHg7aGVpZ2h0OjMwcHg7bWFyZ2luLXJpZ2h0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLXRocmVlLXF1YXJ0ZXJzKX0uY29sb3ItZWRpdF9fbGFiZWwtdmFsdWV7ZmxleDoxIDEgYXV0bzttaW4td2lkdGg6MDt0ZXh0LWFsaWduOnN0YXJ0fS5jb2xvci1lZGl0LWxhYmVse2ZvbnQtc2l6ZTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtc2l6ZS0tMik7Zm9udC13ZWlnaHQ6bm9ybWFsfS5jb2xvci1lZGl0LXZhbHVle2ZvbnQtc2l6ZTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtc2l6ZS0tMSk7Zm9udC13ZWlnaHQ6dmFyKC0tYXJjZ2lzLWFwcC1mb250LXdlaWdodC1kZW1pKX0uY29sb3ItZWRpdC1pY29ue21hcmdpbi1yaWdodDp2YXIoLS1hcmNnaXMtYXBwLXNpZGUtc3BhY2luZy10aHJlZS1xdWFydGVycyl9aHRtbFtkaXI9cnRsXSAuY29sb3ItdGlsZXttYXJnaW4tcmlnaHQ6MDttYXJnaW4tbGVmdDp2YXIoLS1hcmNnaXMtYXBwLXNpZGUtc3BhY2luZy10aHJlZS1xdWFydGVycyl9aHRtbFtkaXI9cnRsXSAuY29sb3ItZWRpdC1pY29ue21hcmdpbi1yaWdodDowO21hcmdpbi1sZWZ0OnZhcigtLWFyY2dpcy1hcHAtc2lkZS1zcGFjaW5nLXRocmVlLXF1YXJ0ZXJzKX1cIjtcblxuY29uc3QgQXJjZ2lzQ29sb3JFZGl0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5jb2xvckVkaXRDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiY29sb3JFZGl0Q2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBldnQgPT09IG51bGwgfHwgZXZ0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmNvbG9yRWRpdENsaWNrLmVtaXQodGhpcy5lZGl0S2V5KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVLZXl1cCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2xpY2soZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVkaXRLZXkgPSBcIlwiO1xuICAgICAgICB0aGlzLmxhYmVsVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXMuY29sb3JWYWx1ZSA9IFwiXCI7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItZWRpdC1jb250YWluZXJcIiwgdGFiSW5kZXg6IDAsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2xpY2ssIG9uS2V5VXA6IHRoaXMuaGFuZGxlS2V5dXAgfSwgaChcImRpdlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItdGlsZVwiLCBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuY29sb3JWYWx1ZSB9IH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWVkaXRfX2xhYmVsLXZhbHVlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWVkaXQtbGFiZWxcIiB9LCB0aGlzLmxhYmVsVGV4dCksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LXZhbHVlIFwiIH0sIHRoaXMuY29sb3JWYWx1ZSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29sb3ItZWRpdC1pY29uXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJwZW5jaWxcIiB9KSkpKTtcbiAgICB9XG59O1xuQXJjZ2lzQ29sb3JFZGl0LnN0eWxlID0gYXJjZ2lzQ29sb3JFZGl0Q3NzO1xuXG5jb25zdCBhcmNnaXNDb2xvclN3YXRjaENzcyA9IFwiLmNvbG9yLXN3YXRjaHtkaXNwbGF5OmlubGluZS1ibG9jaztoZWlnaHQ6MTZweDt3aWR0aDoxNnB4O2JveC1zaXppbmc6Ym9yZGVyLWJveDttYXJnaW4tcmlnaHQ6MnB4O292ZXJmbG93OmhpZGRlbn1cIjtcblxuY29uc3QgQXJjZ2lzQ29sb3JTd2F0Y2ggPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnN3YXRjaENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJzd2F0Y2hDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVDbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3dhdGNoQ2xpY2suZW1pdCh0aGlzLmNvbG9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVLZXlVcCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29sb3IgPSBcIlwiO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLXN3YXRjaFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsaWNrLCBvbktleVVwOiB0aGlzLmhhbmRsZUtleVVwLCB0YWJJbmRleDogMCB9LCBoKFwic3ZnXCIsIHsgd2lkdGg6IFwiMTZcIiwgaGVpZ2h0OiBcIjE2XCIgfSwgaChcInJlY3RcIiwgeyB3aWR0aDogXCIxNlwiLCBoZWlnaHQ6IFwiMTZcIiwgZmlsbDogdGhpcy5jb2xvciB9KSkpKTtcbiAgICB9XG59O1xuQXJjZ2lzQ29sb3JTd2F0Y2guc3R5bGUgPSBhcmNnaXNDb2xvclN3YXRjaENzcztcblxuY29uc3QgQXJjZ2lzQ29sb3JUZXh0SW5wdXQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmlucHV0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbnB1dENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVJbnB1dENoYW5nZSA9IChldnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldnQudGFyZ2V0O1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG5vZGUudmFsdWU7XG4gICAgICAgICAgICB0aGlzLmlucHV0Q2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgICAgIGtleTogdGhpcy5rZXlWYWx1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogbm9kZS52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMua2V5VmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnZhbHVlID0gXCJcIjtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLmxhYmVsLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHZhbHVlOiB0aGlzLnZhbHVlLCBvbkNhbGNpdGVJbnB1dElucHV0OiB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlLCBzY2FsZTogXCJzXCIgfSkpKTtcbiAgICB9XG59O1xuXG5jb25zdCBDb2xvclJvdyA9ICh7IGtleSwgY29sb3JDb25maWcsIGNvbG9yLCBjb250cmFzdFJhdGlvLCBpc1ZhbGlkQ29udHJhc3QsIGkxOG4sIG9uQ29sb3JFZGl0Q2xpY2sgfSkgPT4ge1xuICAgIHJldHVybiAoaChcInRyXCIsIHsgXCJkYXRhLWtleVwiOiBrZXkgfSxcbiAgICAgICAgaChcInRkXCIsIHsgY2xhc3M6IFwiY29sb3ItY29udHJhc3RfX2NvbG9yLWNvbFwiIH0sXG4gICAgICAgICAgICBoKFwiYXJjZ2lzLWNvbG9yLWVkaXRcIiwgeyBlZGl0S2V5OiBjb2xvckNvbmZpZy5rZXksIGxhYmVsVGV4dDogY29sb3JDb25maWcubGFiZWwsIGNvbG9yVmFsdWU6IGNvbG9yLCBvbkNvbG9yRWRpdENsaWNrOiBvbkNvbG9yRWRpdENsaWNrIH0pKSxcbiAgICAgICAgaChcInRkXCIsIHsgY2xhc3M6IFwiY29sb3ItY29udHJhc3RfX3JhdGlvLWNvbFwiIH0sIGNvbnRyYXN0UmF0aW8pLFxuICAgICAgICBoKFwidGRcIiwgeyBjbGFzczogXCJjb2xvci1jb250cmFzdF9fbGVnaWJpbGl0eS1jb2xcIiB9LFxuICAgICAgICAgICAgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLXJvd19fbGVnaWJpbGl0eVwiIH0sIGlzVmFsaWRDb250cmFzdCA/IChoKEZyYWdtZW50LCBudWxsLFxuICAgICAgICAgICAgICAgIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiY2hlY2stY2lyY2xlLWZcIiwgY2xhc3M6IFwiY29sb3ItY29udHJhc3QtLXZhbGlkXCIgfSksXG4gICAgICAgICAgICAgICAgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19sZWdpYmxlLWxhYmVsXCIgfSwgaTE4bi5sZWdpYmxlKSkpIDogKGgoRnJhZ21lbnQsIG51bGwsXG4gICAgICAgICAgICAgICAgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJ4LWNpcmNsZS1mXCIsIGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0LS1pbnZhbGlkXCIgfSksXG4gICAgICAgICAgICAgICAgaChcImRpdlwiLCB7IGNsYXNzOiBcImNvbG9yLWNvbnRyYXN0X19sZWdpYmxlLWxhYmVsXCIgfSwgaTE4bi5ub3RMZWdpYmxlKSkpKSkpKTtcbn07XG5cbmNvbnN0IGFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlQ3NzID0gXCIuY29uZmlnLWNvbG9yLXRhYmxle3dpZHRoOjEwMCU7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlfXRoLHRke2JvcmRlcjoxcHggc29saWQgcmdiYSgyMjEsIDIyMSwgMjIxLCAwLjg2NjY2NjY2NjcpO3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtc2l6ZTp2YXIoLS1hcmNnaXMtYXBwLWZvbnQtc2l6ZS0tMSl9LmNvbG9yLWNvbnRyYXN0X19sZWdpYmlsaXR5LWNvbHtwYWRkaW5nOjAuNXJlbTt0ZXh0LWFsaWduOnN0YXJ0O3dpZHRoOjZyZW19LmNvbG9yLWNvbnRyYXN0LS12YWxpZHtjb2xvcjpncmVlbn0uY29sb3ItY29udHJhc3QtLWludmFsaWR7Y29sb3I6cmVkfS5jb2xvci1yb3dfX2xlZ2liaWxpdHl7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcn0uY29sb3ItY29udHJhc3RfX2xlZ2libGUtbGFiZWx7bWFyZ2luOjAgMC41cmVtfS5jb250cmFzdC1pbmZve2ZvbnQtc2l6ZTowLjhyZW19XCI7XG5cbmNvbnN0IEFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5lZGl0Q2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImVkaXRDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVFZGl0Q2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVkaXRDbGljay5lbWl0KGV2dC5kZXRhaWwpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZENvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vdGhlckNvbmZpZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGlua0NvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb2xvclZhbHVlcyA9IHt9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gdGhpcy5jb2xvclZhbHVlc1t0aGlzLmJhY2tncm91bmRDb25maWcua2V5XS5jb2xvcjtcbiAgICAgICAgY29uc3QgbGlua1ZhbHVlID0gdGhpcy5jb2xvclZhbHVlc1soX2EgPSB0aGlzLmxpbmtDb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5rZXldO1xuICAgICAgICBjb25zdCBsaW5rQ29sb3IgPSAobGlua1ZhbHVlID09PSBudWxsIHx8IGxpbmtWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGlua1ZhbHVlLmNvbG9yKSB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5pMThuLmNvbmZpZ3VyZSwgaChcInRhYmxlXCIsIHsgY2xhc3M6IFwiY29uZmlnLWNvbG9yLXRhYmxlXCIgfSwgaChcInRoZWFkXCIsIG51bGwsIGgoXCJ0clwiLCBudWxsLCBoKFwidGhcIiwgbnVsbCwgaChcImFyY2dpcy1jb2xvci1lZGl0XCIsIHsgZWRpdEtleTogdGhpcy5iYWNrZ3JvdW5kQ29uZmlnLmtleSwgbGFiZWxUZXh0OiB0aGlzLmJhY2tncm91bmRDb25maWcubGFiZWwgfHwgdGhpcy5pMThuLmJhY2tncm91bmQsIGNvbG9yVmFsdWU6IGJhY2tncm91bmRDb2xvciwgb25Db2xvckVkaXRDbGljazogdGhpcy5oYW5kbGVFZGl0Q2xpY2sgfSkpLCBoKFwidGhcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LWxhYmVsXCIgfSwgdGhpcy5pMThuLmNvbnRyYXN0UmF0aW8pLCBoKFwidGhcIiwgeyBjbGFzczogXCJjb2xvci1lZGl0LWxhYmVsXCIgfSwgdGhpcy5pMThuLmxlZ2liaWxpdHkpKSksIGgoXCJ0Ym9keVwiLCBudWxsLCB0aGlzLm90aGVyQ29uZmlncy5tYXAoKGNvbmZpZykgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjb2xvciwgY29udHJhc3RSYXRpbywgaXNWYWxpZENvbnRyYXN0IH0gPSB0aGlzLmNvbG9yVmFsdWVzW2NvbmZpZy5rZXldO1xuICAgICAgICAgICAgcmV0dXJuIChoKENvbG9yUm93LCB7IGtleTogY29uZmlnLmtleSwgY29sb3JDb25maWc6IGNvbmZpZywgY29sb3I6IGNvbG9yLCBjb250cmFzdFJhdGlvOiBjb250cmFzdFJhdGlvLCBpc1ZhbGlkQ29udHJhc3Q6IGlzVmFsaWRDb250cmFzdCwgaTE4bjogdGhpcy5pMThuLCBvbkNvbG9yRWRpdENsaWNrOiB0aGlzLmhhbmRsZUVkaXRDbGljayB9KSk7XG4gICAgICAgIH0pLCB0aGlzLmxpbmtDb25maWcgJiYgKGgoQ29sb3JSb3csIHsga2V5OiB0aGlzLmxpbmtDb25maWcua2V5LCBjb2xvckNvbmZpZzogdGhpcy5saW5rQ29uZmlnLCBjb2xvcjogbGlua0NvbG9yLCBjb250cmFzdFJhdGlvOiBsaW5rVmFsdWUgPT09IG51bGwgfHwgbGlua1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsaW5rVmFsdWUuY29udHJhc3RSYXRpbywgaXNWYWxpZENvbnRyYXN0OiBsaW5rVmFsdWUgPT09IG51bGwgfHwgbGlua1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsaW5rVmFsdWUuaXNWYWxpZENvbnRyYXN0LCBpMThuOiB0aGlzLmkxOG4sIG9uQ29sb3JFZGl0Q2xpY2s6IHRoaXMuaGFuZGxlRWRpdENsaWNrIH0pKSkpLCBoKFwicFwiLCB7IGNsYXNzOiBcImNvbnRyYXN0LWluZm9cIiB9LCB0aGlzLmkxOG4uY29udHJhc3RJbmZvKSkpO1xuICAgIH1cbn07XG5BcmNnaXNDb25maWd1cmVDb2xvcnNUYWJsZS5zdHlsZSA9IGFyY2dpc0NvbmZpZ3VyZUNvbG9yc1RhYmxlQ3NzO1xuXG5jb25zdCBhcmNnaXNDb250cmFzdFByZXZpZXdDc3MgPSBcIi5jb250cmFzdC1wcmV2aWV3e3BhZGRpbmc6MXJlbTtmbGV4OjEgMSBhdXRvO21pbi13aWR0aDowfS5jb250cmFzdC1wcmV2aWV3IGgyLC5jb250cmFzdC1wcmV2aWV3IHAsLmNvbnRyYXN0LXByZXZpZXcgYnV0dG9ue21hcmdpbi1ib3R0b206MXJlbTttYXJnaW4tdG9wOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0NvbnRyYXN0UHJldmlldyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gXCJcIjtcbiAgICAgICAgdGhpcy50ZXh0Q29sb3JDb25maWdzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxpbmtDb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29sb3JWYWx1ZXMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJlbmRlckxpbmtDb25maWcoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKCEoKF9hID0gdGhpcy5saW5rQ29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucHJldmlldykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHByZXZpZXcgfSA9IHRoaXMubGlua0NvbmZpZztcbiAgICAgICAgaWYgKHByZXZpZXcuaXNCdXR0b24pIHtcbiAgICAgICAgICAgIHJldHVybiBoKFwiYnV0dG9uXCIsIG51bGwsIHByZXZpZXcudGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGgoXCJhXCIsIG51bGwsIHByZXZpZXcudGV4dCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBsaW5rQ29sb3IgPSB0aGlzLmNvbG9yVmFsdWVzWyhfYSA9IHRoaXMubGlua0NvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmtleV0uY29sb3IgfHwgXCIjMDBhMGZmXCI7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcInN0eWxlXCIsIHsgaW5uZXJIVE1MOiBgLmNvbnRyYXN0LXByZXZpZXcgYSB7XG4gICAgICAgICAgY29sb3I6ICR7bGlua0NvbG9yIHx8IFwiaW5oZXJpdFwifTtcbiAgICAgICAgfSAuY29udHJhc3QtcHJldmlldyBidXR0b24ge1xuICAgICAgICAgIGNvbG9yOiAke2xpbmtDb2xvciB8fCBcImluaGVyaXRcIn07XG4gICAgICAgICAgYm9yZGVyOiAke2xpbmtDb2xvciA/IGAxcHggc29saWQgJHtsaW5rQ29sb3J9YCA6IFwiaW5oZXJpdFwifTtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiAke2xpbmtDb2xvciA/IFwibm9uZVwiIDogXCJpbmhlcml0XCJ9O1xuICAgICAgICAgIHBhZGRpbmc6IDAuMzc1cmVtIDFyZW07XG4gICAgICAgIH1gIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udHJhc3QtcHJldmlld1wiLCBzdHlsZTogeyBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yIH0gfSwgdGhpcy50ZXh0Q29sb3JDb25maWdzLm1hcCgoeyBwcmV2aWV3LCBrZXkgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjb2xvciB9ID0gdGhpcy5jb2xvclZhbHVlc1trZXldO1xuICAgICAgICAgICAgaWYgKCFwcmV2aWV3KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByZXZpZXcuaXNIZWFkaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGgoXCJoMlwiLCB7IHN0eWxlOiB7IGNvbG9yIH0sIGlubmVySFRNTDogcHJldmlldy50ZXh0IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGgoXCJwXCIsIHsgc3R5bGU6IHsgY29sb3IgfSwgaW5uZXJIVE1MOiBwcmV2aWV3LnRleHQgfSk7XG4gICAgICAgIH0pLCB0aGlzLnJlbmRlckxpbmtDb25maWcoKSkpKTtcbiAgICB9XG59O1xuQXJjZ2lzQ29udHJhc3RQcmV2aWV3LnN0eWxlID0gYXJjZ2lzQ29udHJhc3RQcmV2aWV3Q3NzO1xuXG5jb25zdCBhcmNnaXNQcmVzZXRDb2xvcnNDc3MgPSBcIi5wcmVzZXQtY29sb3Jze21heC13aWR0aDoxNjBweDtwYWRkaW5nOjhweCAxNnB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNjY2M7Ym9yZGVyLXRvcDpub25lO2JveC1zaXppbmc6Ym9yZGVyLWJveH0ucHJlc2V0LWNvbG9ycyAucHJlc2V0LWNvbG9yc19fdGl0bGV7Zm9udC1zaXplOjAuODI1cmVtfS5wcmVzZXQtY29sb3JzIC5wcmVzZXQtcm93e21heC1oZWlnaHQ6MTZweDttYXJnaW4tYm90dG9tOjJweH1cIjtcblxuY29uc3QgQXJjZ2lzUHJlc2V0Q29sb3JzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5zZWxlY3RDb2xvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwic2VsZWN0Q29sb3JcIiwgNyk7XG4gICAgICAgIHRoaXMucHJlc2V0Q29sb3JzID0ge1xuICAgICAgICAgICAgYnJvd246IFtcImYyZWNlNlwiLCBcIjdjNDEwYVwiLCBcIjNlMjEwNVwiXSxcbiAgICAgICAgICAgIGJsdWU6IFtcImU1ZjFmOVwiLCBcIjAwNzljMVwiLCBcIjAwM2Q2MVwiXSxcbiAgICAgICAgICAgIGdyZWVuOiBbXCJlOWYzZWFcIiwgXCIyODg4MzVcIiwgXCIxNDQ0MWJcIl0sXG4gICAgICAgICAgICB5ZWxsb3c6IFtcImZlZmNlZFwiLCBcImY5ZTU0ZVwiLCBcIjdkNzMyN1wiXSxcbiAgICAgICAgICAgIG9yYW5nZTogW1wiZmVmNWU5XCIsIFwiZjg5OTI3XCIsIFwiN2M0ZDE0XCJdLFxuICAgICAgICAgICAgcmVkOiBbXCJmYmVhZThcIiwgXCJkODMwMjBcIiwgXCI2YzE4MTBcIl0sXG4gICAgICAgICAgICB2aW9sZXQ6IFtcImVmZWJmNVwiLCBcIjYzM2I5YlwiLCBcIjMyMWU0ZVwiXVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVN3YXRjaENsaWNrID0gKGV2dCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RDb2xvci5lbWl0KGV2dC5kZXRhaWwpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgY29sb3JSb3dzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAyOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3Qgcm93ID0gW107XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnByZXNldENvbG9ycykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sb3JBcnIgPSB0aGlzLnByZXNldENvbG9yc1trZXldO1xuICAgICAgICAgICAgICAgIHJvdy5wdXNoKGAjJHtjb2xvckFycltpXX1gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29sb3JSb3dzLnB1c2gocm93KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJwcmVzZXQtY29sb3JzXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInByZXNldC1jb2xvcnNfX3RpdGxlXCIgfSwgdGhpcy5pMThuLnByZXNldENvbG9ycyksIGNvbG9yUm93cy5tYXAoKHJvdykgPT4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJwcmVzZXQtcm93XCIgfSwgcm93Lm1hcCgoY29sb3IpID0+IChoKFwiYXJjZ2lzLWNvbG9yLXN3YXRjaFwiLCB7IGtleTogY29sb3IsIGNvbG9yOiBjb2xvciwgb25Td2F0Y2hDbGljazogdGhpcy5oYW5kbGVTd2F0Y2hDbGljayB9KSkpKSkpKSk7XG4gICAgfVxufTtcbkFyY2dpc1ByZXNldENvbG9ycy5zdHlsZSA9IGFyY2dpc1ByZXNldENvbG9yc0NzcztcblxuY29uc3QgYXJjZ2lzU2hhcmVkVGhlbWVDb2xvcnNDc3MgPSBcIi5zaGFyZWQtdGhlbWV7bWF4LXdpZHRoOjE2MHB4O3BhZGRpbmc6OHB4IDE2cHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgI2NjYztib3JkZXItdG9wOm5vbmU7Ym94LXNpemluZzpib3JkZXItYm94fS5zaGFyZWQtdGhlbWUtY29sb3JzX190aXRsZXtmb250LXNpemU6MC44MjVyZW19LnNoYXJlZC10aGVtZV9fcm93e21heC1oZWlnaHQ6MTZweDttYXJnaW4tYm90dG9tOjJweH1cIjtcblxuY29uc3QgQXJjZ2lzU2hhcmVkVGhlbWVDb2xvcnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnNlbGVjdENvbG9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJzZWxlY3RDb2xvclwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVTd2F0Y2hDbGljayA9IChldnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q29sb3IuZW1pdChldnQuZGV0YWlsKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNoYXJlZFRoZW1lID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGlmICghdGhpcy5zaGFyZWRUaGVtZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbG9ycyA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnNoYXJlZFRoZW1lKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zaGFyZWRUaGVtZVtrZXldKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBiYWNrZ3JvdW5kLCB0ZXh0LCBsaW5rIH0gPSB0aGlzLnNoYXJlZFRoZW1lW2tleV07XG4gICAgICAgICAgICBpZiAoYmFja2dyb3VuZCkge1xuICAgICAgICAgICAgICAgIGNvbG9yc1tiYWNrZ3JvdW5kXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgICAgIGNvbG9yc1t0ZXh0XSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGluaykge1xuICAgICAgICAgICAgICAgIGNvbG9yc1tsaW5rXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIU9iamVjdC5rZXlzKGNvbG9ycykubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2hhcmVkLXRoZW1lXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNoYXJlZC10aGVtZS1jb2xvcnNfX3RpdGxlXCIgfSwgdGhpcy5pMThuLnNoYXJlZFRoZW1lKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNoYXJlZC10aGVtZV9fcm93XCIgfSwgT2JqZWN0LmtleXMoY29sb3JzKS5zb3J0KCkubWFwKChjb2xvcikgPT4gKGgoXCJhcmNnaXMtY29sb3Itc3dhdGNoXCIsIHsga2V5OiBjb2xvciwgY29sb3I6IGNvbG9yLCBvblN3YXRjaENsaWNrOiB0aGlzLmhhbmRsZVN3YXRjaENsaWNrIH0pKSkpKSk7XG4gICAgfVxufTtcbkFyY2dpc1NoYXJlZFRoZW1lQ29sb3JzLnN0eWxlID0gYXJjZ2lzU2hhcmVkVGhlbWVDb2xvcnNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0NvbG9yQ29udHJhc3QgYXMgYXJjZ2lzX2NvbG9yX2NvbnRyYXN0LCBBcmNnaXNDb2xvckVkaXQgYXMgYXJjZ2lzX2NvbG9yX2VkaXQsIEFyY2dpc0NvbG9yU3dhdGNoIGFzIGFyY2dpc19jb2xvcl9zd2F0Y2gsIEFyY2dpc0NvbG9yVGV4dElucHV0IGFzIGFyY2dpc19jb2xvcl90ZXh0X2lucHV0LCBBcmNnaXNDb25maWd1cmVDb2xvcnNUYWJsZSBhcyBhcmNnaXNfY29uZmlndXJlX2NvbG9yc190YWJsZSwgQXJjZ2lzQ29udHJhc3RQcmV2aWV3IGFzIGFyY2dpc19jb250cmFzdF9wcmV2aWV3LCBBcmNnaXNQcmVzZXRDb2xvcnMgYXMgYXJjZ2lzX3ByZXNldF9jb2xvcnMsIEFyY2dpc1NoYXJlZFRoZW1lQ29sb3JzIGFzIGFyY2dpc19zaGFyZWRfdGhlbWVfY29sb3JzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1jb2xvci1jb250cmFzdF84LmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuLyoqXG4gKiBDYWxsIGEgZnVuY3Rpb24gb25seSBhZnRlciBpdCBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBuIG1pbGxpc2Vjb25kc1xuICogQHBhcmFtIGZuICAgIC0gZnVuY3Rpb24gdG8gY2FsbFxuICogQHBhcmFtIGRlbGF5IC0gZGVsYXkgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmNvbnN0IGRlYm91bmNlID0gKGZuLCBkZWxheSkgPT4ge1xuICAgIGxldCB0aW1lb3V0O1xuICAgIGxldCBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICBmdW5jdGlvbiBmbHVzaCguLi5hcmdzKSB7XG4gICAgICAgIHN0YXR1cyA9IFwiZmx1c2hlZFwiO1xuICAgICAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBpbnZva2UoLi4uYXJncykge1xuICAgICAgICBzdGF0dXMgPSBcImludm9rZWRcIjtcbiAgICAgICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY2FuY2VsKC4uLmFyZ3MpIHtcbiAgICAgICAgc3RhdHVzID0gXCJjYW5jZWxsZWRcIjtcbiAgICAgICAgcmV0dXJuIGRlYm91bmNlZCguLi5hcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0U3RhdHVzKCkge1xuICAgICAgICByZXR1cm4gc3RhdHVzO1xuICAgIH1cbiAgICBjb25zdCBkZWJvdW5jZWQgPSAoLi4uYXJncykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmbHVzaGVkXCI6XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImludm9rZWRcIjpcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY2FuY2VsbGVkXCI6XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gXCJwZW5kaW5nXCI7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGRlYm91bmNlZC5mbHVzaCA9IGZsdXNoO1xuICAgIGRlYm91bmNlZC5pbnZva2UgPSBpbnZva2U7XG4gICAgZGVib3VuY2VkLmNhbmNlbCA9IGNhbmNlbDtcbiAgICBkZWJvdW5jZWQuZ2V0U3RhdHVzID0gZ2V0U3RhdHVzO1xuICAgIHJldHVybiBkZWJvdW5jZWQ7XG59O1xuLyoqXG4gKiBDYWxsIGEgZnVuY3Rpb24gb25seSBhZnRlciBuIG1pbGxpc2Vjb25kcyBoYXZlIGVsYXBzZWRcbiAqIEBwYXJhbSBmbiAgICAtIGZ1bmN0aW9uIHRvIGNhbGxcbiAqIEBwYXJhbSBkZWxheSAtIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xuICovXG5jb25zdCB0aHJvdHRsZSA9IChmbiwgZGVsYXkpID0+IHtcbiAgICBsZXQgdGltZW91dDtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgdGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICB9LCBkZWxheSk7XG4gICAgfSk7XG59O1xuZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpOyAvLyAkJiBtZWFucyB0aGUgd2hvbGUgbWF0Y2hlZCBzdHJpbmdcbn1cbmZ1bmN0aW9uIGlzRGVmaW5lZCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsO1xufVxuLyoqXG4gKiBTZXQgYSBtaW5pbXVtIHRpbWUgZm9yIGEgcHJvbWlzZSB0byByZXNvbHZlICh1c2VmdWwgZm9yIHByZXZlbnRpbmcgZmxhc2ggb2YgbG9hZGVycylcbiAqL1xuYXN5bmMgZnVuY3Rpb24gbWluRGVsYXkocHJvbWlzZSwgbWluRGVsYXkpIHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChbcHJvbWlzZSwgdGltZW91dChtaW5EZWxheSldKTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbn1cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBpbmxpbmUgc2V0VGltZW91dCBhcyBhbiBhd2FpdCBpbiBhc3luYyBmdW5jdGlvbnNcbiAqL1xuZnVuY3Rpb24gdGltZW91dChtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuY29uc3QgYXJyYXlUb0xvb2t1cE1hcCA9IChkYXRhQXJyLCBnZXRLZXlBbmRJdGVtKSA9PiBPYmplY3QuZnJvbUVudHJpZXMoKGRhdGFBcnIgfHwgW10pLm1hcCgoaXRlbSkgPT4ge1xuICAgIGNvbnN0IHsga2V5LCBkYXRhIH0gPSBnZXRLZXlBbmRJdGVtKGl0ZW0pO1xuICAgIHJldHVybiBba2V5LCBkYXRhXTtcbn0pKTtcbi8qKlxuICogQ2hlY2sgd2hldGhlciB0d28gYXJyYXlzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIGVsZW1lbnRzXG4gKiBhbmQgd2hldGhlciB0aGV5IGNvbnRhaW4gdGhlIHNhbWUgZWxlbWVudHNcbiAqIHJlZ2FyZGxlc3Mgb2Ygb3JkZXJcbiAqL1xuY29uc3QgYXJyYXlzQXJlRXF1aXZhbGVudCA9IChhcnIxLCBhcnIyKSA9PiBhcnIxLmxlbmd0aCA9PT0gYXJyMi5sZW5ndGggJiYgYXJyMS5yZWR1Y2UoKG1lbW8sIHN0cikgPT4gbWVtbyAmJiBhcnIyLmluZGV4T2Yoc3RyKSA+IC0xLCB0cnVlKTtcbmZ1bmN0aW9uIHVuaXF1ZUJ5KG15QXJyLCBnZXRJdGVtSWQpIHtcbiAgICBjb25zdCByZXN1bHRBcnIgPSBbXTtcbiAgICBjb25zdCBsb29rdXBNYXAgPSB7fTtcbiAgICBteUFyci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNvbnN0IGlkID0gZ2V0SXRlbUlkKGl0ZW0pO1xuICAgICAgICBpZiAobG9va3VwTWFwW2lkXSA9PSBudWxsKSB7XG4gICAgICAgICAgICBsb29rdXBNYXBbaWRdID0gaXRlbTtcbiAgICAgICAgICAgIHJlc3VsdEFyci5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdEFycjtcbn1cbmZ1bmN0aW9uIHVuaXF1ZShteUFycikge1xuICAgIGNvbnN0IHByaW1pdGl2ZXMgPSB7IGJvb2xlYW46IHt9LCBudW1iZXI6IHt9LCBzdHJpbmc6IHt9IH07XG4gICAgY29uc3Qgb2JqcyA9IFtdO1xuICAgIHJldHVybiBteUFyci5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgICAgbGV0IHR5cGUgPSB0eXBlb2YgaXRlbTtcbiAgICAgICAgaWYgKHR5cGUgaW4gcHJpbWl0aXZlcykge1xuICAgICAgICAgICAgcmV0dXJuIHByaW1pdGl2ZXNbdHlwZV0uaGFzT3duUHJvcGVydHkoaXRlbSkgPyBmYWxzZSA6IChwcmltaXRpdmVzW3R5cGVdW2l0ZW1dID0gdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gb2Jqcy5pbmRleE9mKGl0ZW0pID49IDAgPyBmYWxzZSA6IG9ianMucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuY29uc3QgY2h1bmsgPSAoYXJyLCBzaXplKSA9PiBbLi4uQXJyYXkoTWF0aC5jZWlsKGFyci5sZW5ndGggLyBzaXplKSldLm1hcCgoXywgaSkgPT4gYXJyLnNsaWNlKHNpemUgKiBpLCBzaXplICsgc2l6ZSAqIGkpKTtcblxuZXhwb3J0IHsgYXJyYXlUb0xvb2t1cE1hcCBhcyBhLCB1bmlxdWUgYXMgYiwgdGhyb3R0bGUgYXMgYywgZGVib3VuY2UgYXMgZCwgZXNjYXBlUmVnRXhwIGFzIGUsIGFycmF5c0FyZUVxdWl2YWxlbnQgYXMgZiwgY2h1bmsgYXMgZywgaXNEZWZpbmVkIGFzIGksIG1pbkRlbGF5IGFzIG0sIHRpbWVvdXQgYXMgdCwgdW5pcXVlQnkgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gICAgW1wiYXJcIiwgXCJhclwiXSxcbiAgICBbXCJiZ1wiLCBcImJnXCJdLFxuICAgIFtcImJzXCIsIFwiYnNcIl0sXG4gICAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgICBbXCJjc1wiLCBcImNzXCJdLFxuICAgIFtcImRhXCIsIFwiZGFcIl0sXG4gICAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgICBbXCJlbFwiLCBcImVsXCJdLFxuICAgIFtcImVuXCIsIFwiZW5cIl0sXG4gICAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgICBbXCJldFwiLCBcImV0XCJdLFxuICAgIFtcImZpXCIsIFwiZmlcIl0sXG4gICAgW1wiZnJcIiwgXCJmclwiXSxcbiAgICBbXCJoZVwiLCBcImhlXCJdLFxuICAgIFtcImhyXCIsIFwiaHJcIl0sXG4gICAgW1wiaHVcIiwgXCJodVwiXSxcbiAgICBbXCJpZFwiLCBcImlkXCJdLFxuICAgIFtcIml0XCIsIFwiaXRcIl0sXG4gICAgW1wiamFcIiwgXCJqYVwiXSxcbiAgICBbXCJrb1wiLCBcImtvXCJdLFxuICAgIFtcImx0XCIsIFwibHRcIl0sXG4gICAgW1wibHZcIiwgXCJsdlwiXSxcbiAgICBbXCJuYlwiLCBcIm5iXCJdLFxuICAgIFtcIm5sXCIsIFwibmxcIl0sXG4gICAgW1wicGxcIiwgXCJwbFwiXSxcbiAgICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICAgIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gICAgW1wicm9cIiwgXCJyb1wiXSxcbiAgICBbXCJydVwiLCBcInJ1XCJdLFxuICAgIFtcInNrXCIsIFwic2tcIl0sXG4gICAgW1wic2xcIiwgXCJzbFwiXSxcbiAgICBbXCJzclwiLCBcInNyXCJdLFxuICAgIFtcInN2XCIsIFwic3ZcIl0sXG4gICAgW1widGhcIiwgXCJ0aFwiXSxcbiAgICBbXCJ0clwiLCBcInRyXCJdLFxuICAgIFtcInVrXCIsIFwidWtcIl0sXG4gICAgW1widmlcIiwgXCJ2aVwiXSxcbiAgICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICAgIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gICAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gICAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gICAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoYXBpID09PSA0KSB7XG4gICAgICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICAgICAgICBwbGFjZXMsXG4gICAgICAgICAgICBzdHlsZTogdHlwZSxcbiAgICAgICAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gICAgfVxuICAgIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIHBsYWNlcyxcbiAgICAgICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gICAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgICAgICBtb250aDogXCJzaG9ydFwiLFxuICAgICAgICBkYXk6IFwibnVtZXJpY1wiXG4gICAgfTtcbiAgICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFBsdXJhbChsYW5nLCBzdHJpbmdPYmosIG51bWJlcikge1xuICAgIGNvbnN0IHNpbmdsZXMgPSBbXCJpZFwiLCBcImphXCIsIFwia29cIiwgXCJ0aFwiLCBcInZpXCIsIFwiemgtY25cIiwgXCJ6aC1oa1wiLCBcInpoLXR3XCJdO1xuICAgIGNvbnN0IGxpa2VFbmdsaXNoID0gW1xuICAgICAgICBcImVuXCIsXG4gICAgICAgIFwiY2FcIixcbiAgICAgICAgXCJkYVwiLFxuICAgICAgICBcImRlXCIsXG4gICAgICAgIFwiZWxcIixcbiAgICAgICAgXCJlc1wiLFxuICAgICAgICBcImV0XCIsXG4gICAgICAgIFwiZmlcIixcbiAgICAgICAgXCJoaVwiLFxuICAgICAgICBcImh1XCIsXG4gICAgICAgIFwiaXRcIixcbiAgICAgICAgXCJuYlwiLFxuICAgICAgICBcIm5sXCIsXG4gICAgICAgIFwicHQtcHRcIixcbiAgICAgICAgXCJzdlwiLFxuICAgICAgICBcInRyXCJcbiAgICBdO1xuICAgIGNvbnN0IGxvY2FsZSA9IGxhbmcgIT09IG51bGwgJiYgbGFuZyAhPT0gdm9pZCAwID8gbGFuZyA6IFwiZW5cIjtcbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG9uZSwgb3IgaXQgaXMgYSBcInNpbXBsZVwiIGxhbmd1YWdlLCByZXR1cm4gdGhlIDEgc3RyaW5nXG4gICAgaWYgKG51bWJlciA9PT0gMSB8fCBzaW5nbGVzLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5zaW5nbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBcIjFcIik7XG4gICAgfVxuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgbm90IDEgYW5kIHRoZSBsYW5ndWFnZSB1c2VzIHRoZSBzYW1lIHBsdXJhbGl6YXRpb24gc3RyYXRlZ3kgYXMgZW5nbGlzaCxcbiAgICAvLyByZXR1cm4gdGhlIG11bHRpcGxlIHN0cmluZ1xuICAgIGlmIChudW1iZXIgIT09IDEgJiYgbGlrZUVuZ2xpc2guaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLm11bHRpcGxlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xuICAgIH1cbiAgICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSB3b3JrZWQsIHJldHVybiB0aGUgXCJ1bmtub3duXCIgc3RyaW5nXG4gICAgcmV0dXJuIHN0cmluZ09iai51bmtub3duLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdFBsdXJhbCBhcyBiLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAgIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAgICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICAgICAgICByZXR1cm4gbGFuZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICAgIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgICAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gICAgbGV0IHN0cmluZ3M7XG4gICAgdHJ5IHtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsZS0wNTBiNmRiOS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=