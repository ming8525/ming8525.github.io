"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2ff20f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ canMatchField),
/* harmony export */   g: () => (/* binding */ getAppendParameters)
/* harmony export */ });
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





var __rest = ( false) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
function canMatchField(field, matchField) {
    var _a;
    const fieldType = (field === null || field === void 0 ? void 0 : field.type) || null;
    const matchFieldType = (matchField === null || matchField === void 0 ? void 0 : matchField.type) || null;
    const matchFields = {
        esriFieldTypeSmallInteger: ["esriFieldTypeSmallInteger"],
        esriFieldTypeInteger: ["esriFieldTypeInteger", "esriFieldTypeSmallInteger"],
        esriFieldTypeSingle: ["esriFieldTypeSingle", "esriFieldTypeDouble"],
        esriFieldTypeDouble: [
            "esriFieldTypeDouble",
            "esriFieldTypeSingle",
            "esriFieldTypeInteger",
            "esriFieldTypeSmallInteger"
        ],
        esriFieldTypeDate: ["esriFieldTypeDate"],
        esriFieldTypeString: [
            "esriFieldTypeString",
            "esriFieldTypeSmallInteger",
            "esriFieldTypeInteger",
            "esriFieldTypeSingle",
            "esriFieldTypeDouble",
            "esriFieldTypeDate",
            "esriFieldTypeGUID"
        ],
        esriFieldTypeGUID: ["esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeOID: ["esriFieldTypeOID", "esriFieldTypeSmallInteger", "esriFieldTypeInteger"],
        esriFieldTypeGlobalID: ["esriFieldTypeGlobalID", "esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeDateOnly: ["esriFieldTypeDateOnly"],
        esriFieldTypeTimeOnly: ["esriFieldTypeTimeOnly"],
        esriFieldTypeTimestampOffset: ["esriFieldTypeTimestampOffset"],
        esriFieldTypeBigInteger: ["esriFieldTypeBigInteger"]
    };
    return matchFieldType && (matchFieldType === fieldType || ((_a = matchFields[fieldType]) === null || _a === void 0 ? void 0 : _a.indexOf(matchFieldType)) > -1);
}
function getAppendParameters(addItemProps) {
    var _a;
    const { timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption, sourceDataLayer } = addItemProps;
    let finalAppendParameters, appendSourceInfo;
    const { publishParameters } = analyzeResults, rest = __rest(analyzeResults, ["publishParameters"]);
    const upsert = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
    const finalFieldMappings = formatFieldMappings(fieldMappings);
    const appendFields = createAppendFields(finalFieldMappings);
    const timezoneInfo = {
        dateFieldsTimeReference: {
            timeZone: timezone || "UTC",
            respectsDaylightSaving: true
        }
    };
    const defaultAppendParams = {
        sourceTableName: dataLayer.name,
        fieldMappings: (finalFieldMappings === null || finalFieldMappings === void 0 ? void 0 : finalFieldMappings.length) ? JSON.stringify(finalFieldMappings) : null,
        upsert,
        skipInserts: addAppendSelectOption === "update",
        skipUpdates: false,
        useGlobalIds: upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.type) === "esriFieldTypeGlobalID",
        updateGeometry: upsert ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.addAppendSelectUpdateTypeOption === "attributeAndGeometry" : true,
        appendFields: appendFields.length ? JSON.stringify(appendFields) : null,
        appendItemId: id,
        appendUploadFormat: _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__.a[_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.type].appendUploadFormat,
        rollbackOnFailure: true
    };
    const publishInfo = __rest(publishParameters, ["layers"]);
    if (type === "CSV") {
        publishParameters.layerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    else if (type === "Microsoft Excel") {
        const layerInfo = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__.a)({}, true);
        const formattedLayerInfo = getLayerToAppend(layerInfo, publishInfo); //Updated info needs to be added to the layers [] rather than the root for excel
        formattedLayerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        publishInfo.name = dataLayer.name;
        appendSourceInfo = Object.assign(Object.assign(Object.assign(Object.assign({}, timezoneInfo), { layers: [formattedLayerInfo] }), publishInfo), rest);
    }
    else {
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    finalAppendParameters = Object.assign(Object.assign({}, defaultAppendParams), { appendSourceInfo: JSON.stringify(appendSourceInfo) });
    if (addAppendSelectOption === "add") {
        finalAppendParameters.upsertMatchingField = sourceDataLayer.objectIdField || ((_a = sourceDataLayer.uniqueField) === null || _a === void 0 ? void 0 : _a.name);
    }
    else {
        if (upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.isUniqueIndex)) {
            finalAppendParameters.upsertMatchingField = uidPair === null || uidPair === void 0 ? void 0 : uidPair.name;
        }
    }
    return finalAppendParameters;
}
function getLayerToAppend(layerInfo, updatedInfo) {
    const formattedLayer = Object.assign({}, layerInfo);
    formattedLayer.locationType = updatedInfo.locationType;
    if (formattedLayer.locationType === "address") {
        formattedLayer.addressFields = updatedInfo.addressFields;
        formattedLayer.sourceCountry = updatedInfo.sourceCountry;
    }
    else if (formattedLayer.locationType === "coordinates") {
        formattedLayer.coordinateFieldType = updatedInfo.coordinateFieldType;
        if (formattedLayer.coordinateFieldType === "LatitudeAndLongitude") {
            formattedLayer.latitudeFieldName = updatedInfo.latitudeFieldName;
            formattedLayer.longitudeFieldName = updatedInfo.longitudeFieldName;
        }
        else {
            formattedLayer.coordinateFieldName = updatedInfo.coordinateFieldName;
        }
    }
    return formattedLayer;
}
function formatFieldMappings(fieldMappings) {
    const fields = fieldMappings.filter((fieldMapping) => {
        return fieldMapping.source !== _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__.N;
    });
    const finalFieldMappings = fields.map(({ source, name }) => {
        return { source, name };
    });
    return finalFieldMappings;
}
function createAppendFields(fieldMappings) {
    const appendFields = fieldMappings.map((mapping) => {
        return mapping.name;
    });
    return appendFields;
}



//# sourceMappingURL=append-3f264d56.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ append)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _append_3f264d56_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-3f264d56.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




async function append(addItemProps) {
    var _a;
    const appendParameters = (0,_append_3f264d56_js__WEBPACK_IMPORTED_MODULE_1__.g)(addItemProps);
    const serviceUrl = (_a = addItemProps.existingItem) === null || _a === void 0 ? void 0 : _a.url;
    const appendUrl = `${serviceUrl}/${addItemProps.sourceDataLayer.id}/append`;
    try {
        const appendResponse = (await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(appendUrl, appendParameters, {}, "post"));
        const { status, recordCount } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.x)(addItemProps.id, {}, appendResponse === null || appendResponse === void 0 ? void 0 : appendResponse.statusUrl);
        return { result: { status, recordCount } };
    }
    catch ({ error }) {
        console.error(error);
        return { error: { code: "unhandledError", message: JSON.stringify(error) } };
    }
}



//# sourceMappingURL=append-5bb9576c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-update.entry.js":
/*!*********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select-update.entry.js ***!
  \*********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_select_update: () => (/* binding */ ArcgisNewItemPagesAppendSelectUpdate)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _append_5bb9576c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-5bb9576c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js");
/* harmony import */ var _overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./overwrite-7eb8dfd4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-7eb8dfd4.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./geometries-6ca39907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _append_3f264d56_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./append-3f264d56.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/* harmony import */ var _publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./publish-item-17d2f9a3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-17d2f9a3.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










































const arcgisNewItemPagesAppendSelectUpdateCss = ".tile-select{margin-top:1.25rem}.need-geometries-notice{margin-top:1.5rem}";

const ArcgisNewItemPagesAppendSelectUpdate = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.newItemDisableCloseButtons = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.appendOptions = {
            attribute: {
                icon: "table",
                updateGeometry: false
            },
            attributeAndGeometry: {
                icon: "multiple-variables",
                updateGeometry: true
            }
        };
        this.updateOptions = {
            uploaded: {
                icon: "upload-to",
                keepDescription: false
            },
            existing: {
                icon: "feature-details",
                keepDescription: true
            }
        };
        this.noticeMessage = null;
        this.selected = undefined;
        this.cannotUpdateGeometry = false;
        this.loading = false;
        this.loaderType = "indeterminate";
        this.loaderMessage = undefined;
        this.error = undefined;
    }
    async componentWillLoad() {
        var _a;
        this.selected = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append" ? "attribute" : "uploaded";
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.appendSelectUpdateType;
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append") {
            (_a = this.noticeMessage) !== null && _a !== void 0 ? _a : (this.noticeMessage = (0,_geometries_6ca39907_js__WEBPACK_IMPORTED_MODULE_6__.v)({
                dataLayer: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer,
                type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
                sourceDataLayer: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer
            }));
            this.cannotUpdateGeometry = !!this.noticeMessage;
        }
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.nextText = "updateAppend";
    }
    async handleNext() {
        const selected = this.selected;
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "update") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addUpdateItemPropertiesOption = selected;
            const keepDescription = selected === "uploaded" ? true : false;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.keepDescription = keepDescription;
            this.handleUpdate();
        }
        else {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectUpdateTypeOption = selected;
            this.handleAppend();
        }
    }
    async handlePrev(event) {
        event.preventDefault();
        !this.loading && this.newItemPrevPage.emit();
    }
    async handleUpdate() {
        this.loading = true;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendLoadingMessages.updating;
        const { file, overwrite, keepDescription, existingItem } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const response = await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_2__.b)(existingItem, existingItem.itemOwner.userContentUrl, // ! Use fetchUser if itemOwner is not available
        { file, overwrite, keepDescription });
        if (!response.success) {
            this.loading = false;
            this.error = {
                title: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.error,
                description: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.appendOverwrite.errors.errorWhileUpdate
            };
        }
        else {
            this.workflowComplete.emit({
                success: response.success
            });
        }
    }
    disableModalButtons(disable) {
        this.newItemToggleNavigationEnabled.emit(!disable);
        this.newItemDisableCloseButtons.emit(disable);
    }
    async handleAppend() {
        var _a;
        this.disableModalButtons(true);
        this.loading = true;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendLoadingMessages.appendCloseNotice;
        const response = await (0,_append_5bb9576c_js__WEBPACK_IMPORTED_MODULE_1__.a)({
            sourceDataLayer: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer,
            existingItem: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.existingItem,
            timezone: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.timezone,
            analyzeResults: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults,
            type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
            fieldMappings: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.fieldMappings,
            dataLayer: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer,
            id: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.id,
            uidPair: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.uidPair,
            addAppendSelectOption: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption
        });
        if (((_a = response === null || response === void 0 ? void 0 : response.result) === null || _a === void 0 ? void 0 : _a.status.toLowerCase()) === "completed") {
            await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_3__.d)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.id, { permanentDelete: true });
            const emitPayload = Object.assign({ appendType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption }, response);
            this.workflowComplete.emit(emitPayload);
            return;
        }
        else {
            this.disableModalButtons(false);
            this.loading = false;
            this.error = {
                title: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.error,
                description: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.append.appendErrorMessages.appendError
            };
        }
    }
    render() {
        const { i18n, appendOptions, updateOptions, noticeMessage, error } = this;
        let options = appendOptions;
        let header = i18n.header;
        let optionsString = "appendOptions";
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "update") {
            options = updateOptions;
            header = i18n.itemPropertiesHeader;
            optionsString = "updateOptions";
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": this.loading } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: header }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical", class: "tile-select" }, Object.keys(options).map((key) => {
            const { icon } = options[key];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, checked: this.selected === key, heading: i18n[optionsString][key].title, description: i18n[optionsString][key].description, icon: icon, name: "feature-layer-create-mode", "input-enabled": true, width: "full", type: "radio", value: key, disabled: key === "attributeAndGeometry" && this.cannotUpdateGeometry, onCalciteTileSelectChange: (e) => {
                    this.selected = e.target.value;
                } }));
        })), _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append" && this.cannotUpdateGeometry && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "need-geometries-notice", open: true, icon: "lightbulb" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, i18n[noticeMessage.title]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, i18n[noticeMessage.description]))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, active: this.loading, text: this.loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendSelectUpdate.style = arcgisNewItemPagesAppendSelectUpdateCss;



//# sourceMappingURL=arcgis-new-item-pages-append-select-update.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geometries-6ca39907.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ checkCompatibleGeometries),
/* harmony export */   v: () => (/* binding */ verifyGeometries)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function verifyGeometries(args) {
    var _a, _b;
    const { dataLayer, type, sourceDataLayer } = args;
    const dataLayerGeometry = (_a = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) !== null && _a !== void 0 ? _a : (_b = dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.layerInfo) === null || _b === void 0 ? void 0 : _b.geometryType;
    if (type === "Microsoft Excel" || type === "CSV") {
        if (((dataLayer.locationType === "address" && dataLayer.addressFields) || dataLayer.locationType === "coordinates") && //check location type is address in case "none" is selected and addressFields linger
            (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return null;
        }
        else if (!dataLayerGeometry || dataLayer.locationType === "none" || (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return { title: "noGeometryMatchTitle", description: "noGeometryTableMessage" };
        }
        else if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== dataLayerGeometry) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
    else {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) !== (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType)) {
            return { title: "noGeometryMatchTitle", description: "noGeometryMatchMessage" };
        }
    }
}
function checkCompatibleGeometries(dataLayer, sourceDataLayer, type) {
    if (type === "Microsoft Excel" || type === "CSV") {
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table") {
            return true;
        }
        else if (((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") &&
            (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.locationType) === "none") {
            return true;
        }
        if ((sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType) === "esriGeometryPoint") {
            return !!dataLayer.addressFields || dataLayer.locationType !== "none";
        }
        return false;
    }
    else {
        return (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.type) === "Table" || (dataLayer === null || dataLayer === void 0 ? void 0 : dataLayer.geometryType) === (sourceDataLayer === null || sourceDataLayer === void 0 ? void 0 : sourceDataLayer.geometryType);
    }
}



//# sourceMappingURL=geometries-6ca39907.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTJmZjIwZi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMyRDtBQUNKO0FBQ1c7QUFDQzs7QUFFbkUsY0FBYyxNQUE2QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxjQUFjO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGdIQUFnSDtBQUM1SDtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG9EQUFZO0FBQzdDO0FBQ0E7QUFDQSw0QkFBNEIsc0RBQWtCLENBQUMsb0RBQVk7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0EsMEJBQTBCLHVEQUFvQixHQUFHO0FBQ2pELDZFQUE2RTtBQUM3RTtBQUNBO0FBQ0EscUZBQXFGLG1CQUFtQiw4QkFBOEI7QUFDdEk7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBLDBEQUEwRCwwQkFBMEIsb0RBQW9EO0FBQ3hJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1DQUFtQztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFaUU7O0FBRWpFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTNmMjY0ZDU2LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC00ZTExMDMyYy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtNWJiOTU3NmMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1zZWxlY3QtdXBkYXRlLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2dlb21ldHJpZXMtNmNhMzk5MDcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuaW1wb3J0IHsgTiBhcyBOT05FX1ZBTFVFIH0gZnJvbSAnLi9hcHBlbmQtNGUxMTAzMmMuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBbmFseXplZExheWVySW5mbyB9IGZyb20gJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5cbnZhciBfX3Jlc3QgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX3Jlc3QpIHx8IGZ1bmN0aW9uIChzLCBlKSB7XG4gICAgdmFyIHQgPSB7fTtcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcbiAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XG4gICAgICAgIH1cbiAgICByZXR1cm4gdDtcbn07XG5mdW5jdGlvbiBjYW5NYXRjaEZpZWxkKGZpZWxkLCBtYXRjaEZpZWxkKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGZpZWxkVHlwZSA9IChmaWVsZCA9PT0gbnVsbCB8fCBmaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGQudHlwZSkgfHwgbnVsbDtcbiAgICBjb25zdCBtYXRjaEZpZWxkVHlwZSA9IChtYXRjaEZpZWxkID09PSBudWxsIHx8IG1hdGNoRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoRmllbGQudHlwZSkgfHwgbnVsbDtcbiAgICBjb25zdCBtYXRjaEZpZWxkcyA9IHtcbiAgICAgICAgZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZUludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZVNpbmdsZTogW1wiZXNyaUZpZWxkVHlwZVNpbmdsZVwiLCBcImVzcmlGaWVsZFR5cGVEb3VibGVcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVEb3VibGU6IFtcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIlxuICAgICAgICBdLFxuICAgICAgICBlc3JpRmllbGRUeXBlRGF0ZTogW1wiZXNyaUZpZWxkVHlwZURhdGVcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVTdHJpbmc6IFtcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVJbnRlZ2VyXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTaW5nbGVcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlRGF0ZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlR1VJRFwiXG4gICAgICAgIF0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVHVUlEOiBbXCJlc3JpRmllbGRUeXBlR1VJRFwiLCBcImVzcmlGaWVsZFR5cGVTdHJpbmdcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVPSUQ6IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCIsIFwiZXNyaUZpZWxkVHlwZUludGVnZXJcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVHbG9iYWxJRDogW1wiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCIsIFwiZXNyaUZpZWxkVHlwZUdVSURcIiwgXCJlc3JpRmllbGRUeXBlU3RyaW5nXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlRGF0ZU9ubHk6IFtcImVzcmlGaWVsZFR5cGVEYXRlT25seVwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZVRpbWVPbmx5OiBbXCJlc3JpRmllbGRUeXBlVGltZU9ubHlcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXQ6IFtcImVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXRcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVCaWdJbnRlZ2VyOiBbXCJlc3JpRmllbGRUeXBlQmlnSW50ZWdlclwiXVxuICAgIH07XG4gICAgcmV0dXJuIG1hdGNoRmllbGRUeXBlICYmIChtYXRjaEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlIHx8ICgoX2EgPSBtYXRjaEZpZWxkc1tmaWVsZFR5cGVdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihtYXRjaEZpZWxkVHlwZSkpID4gLTEpO1xufVxuZnVuY3Rpb24gZ2V0QXBwZW5kUGFyYW1ldGVycyhhZGRJdGVtUHJvcHMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyB0aW1lem9uZSwgYW5hbHl6ZVJlc3VsdHMsIHR5cGUsIGZpZWxkTWFwcGluZ3MsIGRhdGFMYXllciwgaWQsIHVpZFBhaXIsIGFkZEFwcGVuZFNlbGVjdE9wdGlvbiwgc291cmNlRGF0YUxheWVyIH0gPSBhZGRJdGVtUHJvcHM7XG4gICAgbGV0IGZpbmFsQXBwZW5kUGFyYW1ldGVycywgYXBwZW5kU291cmNlSW5mbztcbiAgICBjb25zdCB7IHB1Ymxpc2hQYXJhbWV0ZXJzIH0gPSBhbmFseXplUmVzdWx0cywgcmVzdCA9IF9fcmVzdChhbmFseXplUmVzdWx0cywgW1wicHVibGlzaFBhcmFtZXRlcnNcIl0pO1xuICAgIGNvbnN0IHVwc2VydCA9IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cHNlcnRcIiB8fCBhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwidXBkYXRlXCI7XG4gICAgY29uc3QgZmluYWxGaWVsZE1hcHBpbmdzID0gZm9ybWF0RmllbGRNYXBwaW5ncyhmaWVsZE1hcHBpbmdzKTtcbiAgICBjb25zdCBhcHBlbmRGaWVsZHMgPSBjcmVhdGVBcHBlbmRGaWVsZHMoZmluYWxGaWVsZE1hcHBpbmdzKTtcbiAgICBjb25zdCB0aW1lem9uZUluZm8gPSB7XG4gICAgICAgIGRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlOiB7XG4gICAgICAgICAgICB0aW1lWm9uZTogdGltZXpvbmUgfHwgXCJVVENcIixcbiAgICAgICAgICAgIHJlc3BlY3RzRGF5bGlnaHRTYXZpbmc6IHRydWVcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZGVmYXVsdEFwcGVuZFBhcmFtcyA9IHtcbiAgICAgICAgc291cmNlVGFibGVOYW1lOiBkYXRhTGF5ZXIubmFtZSxcbiAgICAgICAgZmllbGRNYXBwaW5nczogKGZpbmFsRmllbGRNYXBwaW5ncyA9PT0gbnVsbCB8fCBmaW5hbEZpZWxkTWFwcGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbmFsRmllbGRNYXBwaW5ncy5sZW5ndGgpID8gSlNPTi5zdHJpbmdpZnkoZmluYWxGaWVsZE1hcHBpbmdzKSA6IG51bGwsXG4gICAgICAgIHVwc2VydCxcbiAgICAgICAgc2tpcEluc2VydHM6IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cGRhdGVcIixcbiAgICAgICAgc2tpcFVwZGF0ZXM6IGZhbHNlLFxuICAgICAgICB1c2VHbG9iYWxJZHM6IHVwc2VydCAmJiAodWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLnR5cGUpID09PSBcImVzcmlGaWVsZFR5cGVHbG9iYWxJRFwiLFxuICAgICAgICB1cGRhdGVHZW9tZXRyeTogdXBzZXJ0ID8gYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdFVwZGF0ZVR5cGVPcHRpb24gPT09IFwiYXR0cmlidXRlQW5kR2VvbWV0cnlcIiA6IHRydWUsXG4gICAgICAgIGFwcGVuZEZpZWxkczogYXBwZW5kRmllbGRzLmxlbmd0aCA/IEpTT04uc3RyaW5naWZ5KGFwcGVuZEZpZWxkcykgOiBudWxsLFxuICAgICAgICBhcHBlbmRJdGVtSWQ6IGlkLFxuICAgICAgICBhcHBlbmRVcGxvYWRGb3JtYXQ6IGFkZENyZWF0ZUl0ZW1UeXBlc1thZGRJdGVtU3RhdGUudHlwZV0uYXBwZW5kVXBsb2FkRm9ybWF0LFxuICAgICAgICByb2xsYmFja09uRmFpbHVyZTogdHJ1ZVxuICAgIH07XG4gICAgY29uc3QgcHVibGlzaEluZm8gPSBfX3Jlc3QocHVibGlzaFBhcmFtZXRlcnMsIFtcImxheWVyc1wiXSk7XG4gICAgaWYgKHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICAgICAgcHVibGlzaFBhcmFtZXRlcnMubGF5ZXJJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlID0gdGltZXpvbmVJbmZvLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlO1xuICAgICAgICBhcHBlbmRTb3VyY2VJbmZvID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRpbWV6b25lSW5mbyksIHB1Ymxpc2hQYXJhbWV0ZXJzKSwgcmVzdCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIpIHtcbiAgICAgICAgY29uc3QgbGF5ZXJJbmZvID0gZ2V0QW5hbHl6ZWRMYXllckluZm8oe30sIHRydWUpO1xuICAgICAgICBjb25zdCBmb3JtYXR0ZWRMYXllckluZm8gPSBnZXRMYXllclRvQXBwZW5kKGxheWVySW5mbywgcHVibGlzaEluZm8pOyAvL1VwZGF0ZWQgaW5mbyBuZWVkcyB0byBiZSBhZGRlZCB0byB0aGUgbGF5ZXJzIFtdIHJhdGhlciB0aGFuIHRoZSByb290IGZvciBleGNlbFxuICAgICAgICBmb3JtYXR0ZWRMYXllckluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2UgPSB0aW1lem9uZUluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U7XG4gICAgICAgIHB1Ymxpc2hJbmZvLm5hbWUgPSBkYXRhTGF5ZXIubmFtZTtcbiAgICAgICAgYXBwZW5kU291cmNlSW5mbyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRpbWV6b25lSW5mbyksIHsgbGF5ZXJzOiBbZm9ybWF0dGVkTGF5ZXJJbmZvXSB9KSwgcHVibGlzaEluZm8pLCByZXN0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgcHVibGlzaFBhcmFtZXRlcnMpLCByZXN0KTtcbiAgICB9XG4gICAgZmluYWxBcHBlbmRQYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0QXBwZW5kUGFyYW1zKSwgeyBhcHBlbmRTb3VyY2VJbmZvOiBKU09OLnN0cmluZ2lmeShhcHBlbmRTb3VyY2VJbmZvKSB9KTtcbiAgICBpZiAoYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgIGZpbmFsQXBwZW5kUGFyYW1ldGVycy51cHNlcnRNYXRjaGluZ0ZpZWxkID0gc291cmNlRGF0YUxheWVyLm9iamVjdElkRmllbGQgfHwgKChfYSA9IHNvdXJjZURhdGFMYXllci51bmlxdWVGaWVsZCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKHVwc2VydCAmJiAodWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLmlzVW5pcXVlSW5kZXgpKSB7XG4gICAgICAgICAgICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMudXBzZXJ0TWF0Y2hpbmdGaWVsZCA9IHVpZFBhaXIgPT09IG51bGwgfHwgdWlkUGFpciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdWlkUGFpci5uYW1lO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmaW5hbEFwcGVuZFBhcmFtZXRlcnM7XG59XG5mdW5jdGlvbiBnZXRMYXllclRvQXBwZW5kKGxheWVySW5mbywgdXBkYXRlZEluZm8pIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRMYXllciA9IE9iamVjdC5hc3NpZ24oe30sIGxheWVySW5mbyk7XG4gICAgZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID0gdXBkYXRlZEluZm8ubG9jYXRpb25UeXBlO1xuICAgIGlmIChmb3JtYXR0ZWRMYXllci5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiKSB7XG4gICAgICAgIGZvcm1hdHRlZExheWVyLmFkZHJlc3NGaWVsZHMgPSB1cGRhdGVkSW5mby5hZGRyZXNzRmllbGRzO1xuICAgICAgICBmb3JtYXR0ZWRMYXllci5zb3VyY2VDb3VudHJ5ID0gdXBkYXRlZEluZm8uc291cmNlQ291bnRyeTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9ybWF0dGVkTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCIpIHtcbiAgICAgICAgZm9ybWF0dGVkTGF5ZXIuY29vcmRpbmF0ZUZpZWxkVHlwZSA9IHVwZGF0ZWRJbmZvLmNvb3JkaW5hdGVGaWVsZFR5cGU7XG4gICAgICAgIGlmIChmb3JtYXR0ZWRMYXllci5jb29yZGluYXRlRmllbGRUeXBlID09PSBcIkxhdGl0dWRlQW5kTG9uZ2l0dWRlXCIpIHtcbiAgICAgICAgICAgIGZvcm1hdHRlZExheWVyLmxhdGl0dWRlRmllbGROYW1lID0gdXBkYXRlZEluZm8ubGF0aXR1ZGVGaWVsZE5hbWU7XG4gICAgICAgICAgICBmb3JtYXR0ZWRMYXllci5sb25naXR1ZGVGaWVsZE5hbWUgPSB1cGRhdGVkSW5mby5sb25naXR1ZGVGaWVsZE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRMYXllci5jb29yZGluYXRlRmllbGROYW1lID0gdXBkYXRlZEluZm8uY29vcmRpbmF0ZUZpZWxkTmFtZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZm9ybWF0dGVkTGF5ZXI7XG59XG5mdW5jdGlvbiBmb3JtYXRGaWVsZE1hcHBpbmdzKGZpZWxkTWFwcGluZ3MpIHtcbiAgICBjb25zdCBmaWVsZHMgPSBmaWVsZE1hcHBpbmdzLmZpbHRlcigoZmllbGRNYXBwaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiBmaWVsZE1hcHBpbmcuc291cmNlICE9PSBOT05FX1ZBTFVFO1xuICAgIH0pO1xuICAgIGNvbnN0IGZpbmFsRmllbGRNYXBwaW5ncyA9IGZpZWxkcy5tYXAoKHsgc291cmNlLCBuYW1lIH0pID0+IHtcbiAgICAgICAgcmV0dXJuIHsgc291cmNlLCBuYW1lIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIGZpbmFsRmllbGRNYXBwaW5ncztcbn1cbmZ1bmN0aW9uIGNyZWF0ZUFwcGVuZEZpZWxkcyhmaWVsZE1hcHBpbmdzKSB7XG4gICAgY29uc3QgYXBwZW5kRmllbGRzID0gZmllbGRNYXBwaW5ncy5tYXAoKG1hcHBpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIG1hcHBpbmcubmFtZTtcbiAgICB9KTtcbiAgICByZXR1cm4gYXBwZW5kRmllbGRzO1xufVxuXG5leHBvcnQgeyBjYW5NYXRjaEZpZWxkIGFzIGMsIGdldEFwcGVuZFBhcmFtZXRlcnMgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHBlbmQtM2YyNjRkNTYuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5jb25zdCB1aWRGaWVsZHMgPSBbXCJlc3JpRmllbGRUeXBlT0lEXCIsIFwiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCJdO1xuY29uc3QgTk9ORV9WQUxVRSA9IFwiPE5vbmU+XCI7XG5jb25zdCBBcHBlbmRPdmVyd3JpdGVQdWJsaXNoVHlwZXMgPSB7XG4gICAgXCJmaWxlIGdlb2RhdGFiYXNlXCI6IFwiZmlsZWdlb2RhdGFiYXNlXCIsXG4gICAgc2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICAgIGdlb2pzb246IFwiZ2VvanNvblwiLFxuICAgIGNzdjogXCJDU1ZcIixcbiAgICBcIm1pY3Jvc29mdCBleGNlbFwiOiBcImV4Y2VsXCIsXG4gICAgZ2VvcGFja2FnZTogXCJnZW9QYWNrYWdlXCJcbn07XG5jb25zdCBhcHBlbmRGaWxlVHlwZXMgPSB7XG4gICAgU2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICAgIFwiRmlsZSBHZW9kYXRhYmFzZVwiOiBcImZpbGVHZW9kYXRhYmFzZVwiLFxuICAgIENTVjogXCJjc3ZcIixcbiAgICBcIk1pY3Jvc29mdCBFeGNlbFwiOiBcImV4Y2VsXCIsXG4gICAgR2VvSnNvbjogXCJnZW9qc29uXCIsXG4gICAgR2VvUGFja2FnZTogXCJnZW9QYWNrYWdlXCJcbn07XG5jb25zdCBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlcyA9IHtcbiAgICBjc3Y6IFwiQ1NWXCIsXG4gICAgZXhjZWw6IFwiTWljcm9zb2Z0IEV4Y2VsXCIsXG4gICAgc2hhcGVmaWxlOiBcIlNoYXBlZmlsZVwiLFxuICAgIGZnZGI6IFwiRmlsZSBHZW9kYXRhYmFzZVwiLFxuICAgIGdlb2pzb246IFwiR2VvSnNvblwiLFxuICAgIGdvb2dsZXNoZWV0czogXCJNaWNyb3NvZnQgRXhjZWxcIlxufTtcbmNvbnN0IGFwcGVuZEV4dGVuc2lvbnMgPSBbXCJ6aXBcIiwgXCJjc3ZcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwiZ2VvanNvblwiLCBcImdwa2dcIiwgXCJqc29uXCJdO1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9uc0ZvckVudGVycHJpc2UgPSBbXCJ6aXBcIiwgXCJjc3ZcIiwgXCJ4bHNcIiwgXCJ4bHN4XCJdO1xuXG5leHBvcnQgeyBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlcyBhcyBBLCBOT05FX1ZBTFVFIGFzIE4sIGFwcGVuZEZpbGVUeXBlcyBhcyBhLCBBcHBlbmRPdmVyd3JpdGVQdWJsaXNoVHlwZXMgYXMgYiwgYXBwZW5kRXh0ZW5zaW9uc0ZvckVudGVycHJpc2UgYXMgYywgYXBwZW5kRXh0ZW5zaW9ucyBhcyBkLCB1aWRGaWVsZHMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHBlbmQtNGUxMTAzMmMuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlcXVlc3QgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEFwcGVuZFBhcmFtZXRlcnMgfSBmcm9tICcuL2FwcGVuZC0zZjI2NGQ1Ni5qcyc7XG5pbXBvcnQgeyB4IGFzIGdldEl0ZW1TdGF0dXMgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItNTczYmI0NzMuanMnO1xuXG5hc3luYyBmdW5jdGlvbiBhcHBlbmQoYWRkSXRlbVByb3BzKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGFwcGVuZFBhcmFtZXRlcnMgPSBnZXRBcHBlbmRQYXJhbWV0ZXJzKGFkZEl0ZW1Qcm9wcyk7XG4gICAgY29uc3Qgc2VydmljZVVybCA9IChfYSA9IGFkZEl0ZW1Qcm9wcy5leGlzdGluZ0l0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51cmw7XG4gICAgY29uc3QgYXBwZW5kVXJsID0gYCR7c2VydmljZVVybH0vJHthZGRJdGVtUHJvcHMuc291cmNlRGF0YUxheWVyLmlkfS9hcHBlbmRgO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFwcGVuZFJlc3BvbnNlID0gKGF3YWl0IHJlcXVlc3QoYXBwZW5kVXJsLCBhcHBlbmRQYXJhbWV0ZXJzLCB7fSwgXCJwb3N0XCIpKTtcbiAgICAgICAgY29uc3QgeyBzdGF0dXMsIHJlY29yZENvdW50IH0gPSBhd2FpdCBnZXRJdGVtU3RhdHVzKGFkZEl0ZW1Qcm9wcy5pZCwge30sIGFwcGVuZFJlc3BvbnNlID09PSBudWxsIHx8IGFwcGVuZFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBlbmRSZXNwb25zZS5zdGF0dXNVcmwpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IHsgc3RhdHVzLCByZWNvcmRDb3VudCB9IH07XG4gICAgfVxuICAgIGNhdGNoICh7IGVycm9yIH0pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiwgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZXJyb3IpIH0gfTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IGFwcGVuZCBhcyBhIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGVuZC01YmI5NTc2Yy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGEgYXMgYXBwZW5kIH0gZnJvbSAnLi9hcHBlbmQtNWJiOTU3NmMuanMnO1xuaW1wb3J0IHsgYiBhcyB1cGRhdGVJdGVtT3ZlcndyaXRlIH0gZnJvbSAnLi9vdmVyd3JpdGUtN2ViOGRmZDQuanMnO1xuaW1wb3J0IHsgZCBhcyBkZWxldGVJdGVtIH0gZnJvbSAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuaW1wb3J0IHsgdSBhcyB1aVN0b3JlU3RhdGUgfSBmcm9tICcuL3VpLWJjYTdiY2QxLmpzJztcbmltcG9ydCB7IHYgYXMgdmVyaWZ5R2VvbWV0cmllcyB9IGZyb20gJy4vZ2VvbWV0cmllcy02Y2EzOTkwNy5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9hcHBlbmQtM2YyNjRkNTYuanMnO1xuaW1wb3J0ICcuL2FwcGVuZC00ZTExMDMyYy5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy03NDYzOWRhZS5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci01NzNiYjQ3My5qcyc7XG5pbXBvcnQgJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTc5ZmIzMDJjLmpzJztcbmltcG9ydCAnLi9ndWlkLWFlYWVkODRkLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtYmNiODllNjkuanMnO1xuaW1wb3J0ICcuL3NlcnZpY2UtOGMyYzQyNDEuanMnO1xuaW1wb3J0ICcuL3VzZXItM2VhNjljM2EuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCAnLi9hcGktMmUzYTEzNmYuanMnO1xuaW1wb3J0ICcuL3N0cmluZy01OGE1ZmVmMy5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTE3YjY0OTQ2LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTgxMzczZjZkLmpzJztcbmltcG9ydCAnLi9hZ3MtZWI0NThhMDMuanMnO1xuaW1wb3J0ICcuL3VybC0zNTg3NWExMC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS0wMzUzYTc2OS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtNmE4OGU2YzUuanMnO1xuaW1wb3J0ICcuL3B1Ymxpc2gtaXRlbS0xN2QyZjlhMy5qcyc7XG5pbXBvcnQgJy4vdGlsZS1sYXllci1jZjA0ZmE5Ny5qcyc7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdFVwZGF0ZUNzcyA9IFwiLnRpbGUtc2VsZWN0e21hcmdpbi10b3A6MS4yNXJlbX0ubmVlZC1nZW9tZXRyaWVzLW5vdGljZXttYXJnaW4tdG9wOjEuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0VXBkYXRlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1EaXNhYmxlQ2xvc2VCdXR0b25zID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9uc1wiLCA3KTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVByZXZQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtUHJldlBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXBwZW5kT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZToge1xuICAgICAgICAgICAgICAgIGljb246IFwidGFibGVcIixcbiAgICAgICAgICAgICAgICB1cGRhdGVHZW9tZXRyeTogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdHRyaWJ1dGVBbmRHZW9tZXRyeToge1xuICAgICAgICAgICAgICAgIGljb246IFwibXVsdGlwbGUtdmFyaWFibGVzXCIsXG4gICAgICAgICAgICAgICAgdXBkYXRlR2VvbWV0cnk6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zID0ge1xuICAgICAgICAgICAgdXBsb2FkZWQ6IHtcbiAgICAgICAgICAgICAgICBpY29uOiBcInVwbG9hZC10b1wiLFxuICAgICAgICAgICAgICAgIGtlZXBEZXNjcmlwdGlvbjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGlzdGluZzoge1xuICAgICAgICAgICAgICAgIGljb246IFwiZmVhdHVyZS1kZXRhaWxzXCIsXG4gICAgICAgICAgICAgICAga2VlcERlc2NyaXB0aW9uOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubm90aWNlTWVzc2FnZSA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2Fubm90VXBkYXRlR2VvbWV0cnkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIgPyBcImF0dHJpYnV0ZVwiIDogXCJ1cGxvYWRlZFwiO1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3RVcGRhdGVUeXBlO1xuICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcImFwcGVuZFwiKSB7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLm5vdGljZU1lc3NhZ2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLm5vdGljZU1lc3NhZ2UgPSB2ZXJpZnlHZW9tZXRyaWVzKHtcbiAgICAgICAgICAgICAgICBkYXRhTGF5ZXI6IGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIsXG4gICAgICAgICAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgICAgICAgICAgc291cmNlRGF0YUxheWVyOiBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB0aGlzLmNhbm5vdFVwZGF0ZUdlb21ldHJ5ID0gISF0aGlzLm5vdGljZU1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJ1cGRhdGVBcHBlbmRcIjtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlTmV4dCgpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuYWRkVXBkYXRlSXRlbVByb3BlcnRpZXNPcHRpb24gPSBzZWxlY3RlZDtcbiAgICAgICAgICAgIGNvbnN0IGtlZXBEZXNjcmlwdGlvbiA9IHNlbGVjdGVkID09PSBcInVwbG9hZGVkXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUua2VlcERlc2NyaXB0aW9uID0ga2VlcERlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVVcGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RVcGRhdGVUeXBlT3B0aW9uID0gc2VsZWN0ZWQ7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUFwcGVuZCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVByZXYoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgIXRoaXMubG9hZGluZyAmJiB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy51cGRhdGluZztcbiAgICAgICAgY29uc3QgeyBmaWxlLCBvdmVyd3JpdGUsIGtlZXBEZXNjcmlwdGlvbiwgZXhpc3RpbmdJdGVtIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdXBkYXRlSXRlbU92ZXJ3cml0ZShleGlzdGluZ0l0ZW0sIGV4aXN0aW5nSXRlbS5pdGVtT3duZXIudXNlckNvbnRlbnRVcmwsIC8vICEgVXNlIGZldGNoVXNlciBpZiBpdGVtT3duZXIgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgICB7IGZpbGUsIG92ZXJ3cml0ZSwga2VlcERlc2NyaXB0aW9uIH0pO1xuICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogdWlTdG9yZVN0YXRlLmkxOG4uZXJyb3IsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZE92ZXJ3cml0ZS5lcnJvcnMuZXJyb3JXaGlsZVVwZGF0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiByZXNwb25zZS5zdWNjZXNzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkaXNhYmxlTW9kYWxCdXR0b25zKGRpc2FibGUpIHtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCghZGlzYWJsZSk7XG4gICAgICAgIHRoaXMubmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnMuZW1pdChkaXNhYmxlKTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlQXBwZW5kKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuZGlzYWJsZU1vZGFsQnV0dG9ucyh0cnVlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy5hcHBlbmRDbG9zZU5vdGljZTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcHBlbmQoe1xuICAgICAgICAgICAgc291cmNlRGF0YUxheWVyOiBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLFxuICAgICAgICAgICAgZXhpc3RpbmdJdGVtOiBhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtLFxuICAgICAgICAgICAgdGltZXpvbmU6IGFkZEl0ZW1TdGF0ZS50aW1lem9uZSxcbiAgICAgICAgICAgIGFuYWx5emVSZXN1bHRzOiBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMsXG4gICAgICAgICAgICB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSxcbiAgICAgICAgICAgIGZpZWxkTWFwcGluZ3M6IGFkZEl0ZW1TdGF0ZS5maWVsZE1hcHBpbmdzLFxuICAgICAgICAgICAgZGF0YUxheWVyOiBhZGRJdGVtU3RhdGUuZGF0YUxheWVyLFxuICAgICAgICAgICAgaWQ6IGFkZEl0ZW1TdGF0ZS5pZCxcbiAgICAgICAgICAgIHVpZFBhaXI6IGFkZEl0ZW1TdGF0ZS51aWRQYWlyLFxuICAgICAgICAgICAgYWRkQXBwZW5kU2VsZWN0T3B0aW9uOiBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoKChfYSA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0dXMudG9Mb3dlckNhc2UoKSkgPT09IFwiY29tcGxldGVkXCIpIHtcbiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IGFwcGVuZFR5cGU6IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gfSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlTW9kYWxCdXR0b25zKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogdWlTdG9yZVN0YXRlLmkxOG4uZXJyb3IsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRFcnJvck1lc3NhZ2VzLmFwcGVuZEVycm9yXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBhcHBlbmRPcHRpb25zLCB1cGRhdGVPcHRpb25zLCBub3RpY2VNZXNzYWdlLCBlcnJvciB9ID0gdGhpcztcbiAgICAgICAgbGV0IG9wdGlvbnMgPSBhcHBlbmRPcHRpb25zO1xuICAgICAgICBsZXQgaGVhZGVyID0gaTE4bi5oZWFkZXI7XG4gICAgICAgIGxldCBvcHRpb25zU3RyaW5nID0gXCJhcHBlbmRPcHRpb25zXCI7XG4gICAgICAgIGlmICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwidXBkYXRlXCIpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB1cGRhdGVPcHRpb25zO1xuICAgICAgICAgICAgaGVhZGVyID0gaTE4bi5pdGVtUHJvcGVydGllc0hlYWRlcjtcbiAgICAgICAgICAgIG9wdGlvbnNTdHJpbmcgPSBcInVwZGF0ZU9wdGlvbnNcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogeyBcIm92ZXJmbG93LWhpZGRlblwiOiB0aGlzLmxvYWRpbmcgfSB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgaGVhZGVyOiBoZWFkZXIgfSksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIsIGNsYXNzOiBcInRpbGUtc2VsZWN0XCIgfSwgT2JqZWN0LmtleXMob3B0aW9ucykubWFwKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaWNvbiB9ID0gb3B0aW9uc1trZXldO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdFwiLCB7IGtleToga2V5LCBjaGVja2VkOiB0aGlzLnNlbGVjdGVkID09PSBrZXksIGhlYWRpbmc6IGkxOG5bb3B0aW9uc1N0cmluZ11ba2V5XS50aXRsZSwgZGVzY3JpcHRpb246IGkxOG5bb3B0aW9uc1N0cmluZ11ba2V5XS5kZXNjcmlwdGlvbiwgaWNvbjogaWNvbiwgbmFtZTogXCJmZWF0dXJlLWxheWVyLWNyZWF0ZS1tb2RlXCIsIFwiaW5wdXQtZW5hYmxlZFwiOiB0cnVlLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IGtleSwgZGlzYWJsZWQ6IGtleSA9PT0gXCJhdHRyaWJ1dGVBbmRHZW9tZXRyeVwiICYmIHRoaXMuY2Fubm90VXBkYXRlR2VvbWV0cnksIG9uQ2FsY2l0ZVRpbGVTZWxlY3RDaGFuZ2U6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICB9IH0pKTtcbiAgICAgICAgfSkpLCB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIgJiYgdGhpcy5jYW5ub3RVcGRhdGVHZW9tZXRyeSAmJiAoaChcImNhbGNpdGUtbm90aWNlXCIsIHsgY2xhc3M6IFwibmVlZC1nZW9tZXRyaWVzLW5vdGljZVwiLCBvcGVuOiB0cnVlLCBpY29uOiBcImxpZ2h0YnVsYlwiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcInRpdGxlXCIgfSwgaTE4bltub3RpY2VNZXNzYWdlLnRpdGxlXSksIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBpMThuW25vdGljZU1lc3NhZ2UuZGVzY3JpcHRpb25dKSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IHR5cGU6IHRoaXMubG9hZGVyVHlwZSwgYWN0aXZlOiB0aGlzLmxvYWRpbmcsIHRleHQ6IHRoaXMubG9hZGVyTWVzc2FnZSB9KSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGhlYWRpbmc6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci50aXRsZSwgZGVzY3JpcHRpb246IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5kZXNjcmlwdGlvbiwgbGluazogeyBocmVmOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubGluaywgdGl0bGU6IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5saW5rVGV4dCB9LCBhY3RpdmU6ICEhZXJyb3IsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5lcnJvciA9IG51bGwpIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3RVcGRhdGUuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3RVcGRhdGVDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdFVwZGF0ZSBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfYXBwZW5kX3NlbGVjdF91cGRhdGUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1zZWxlY3QtdXBkYXRlLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuZnVuY3Rpb24gdmVyaWZ5R2VvbWV0cmllcyhhcmdzKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCB7IGRhdGFMYXllciwgdHlwZSwgc291cmNlRGF0YUxheWVyIH0gPSBhcmdzO1xuICAgIGNvbnN0IGRhdGFMYXllckdlb21ldHJ5ID0gKF9hID0gZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9iID0gZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmxheWVySW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdlb21ldHJ5VHlwZTtcbiAgICBpZiAodHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIiB8fCB0eXBlID09PSBcIkNTVlwiKSB7XG4gICAgICAgIGlmICgoKGRhdGFMYXllci5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiICYmIGRhdGFMYXllci5hZGRyZXNzRmllbGRzKSB8fCBkYXRhTGF5ZXIubG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCIpICYmIC8vY2hlY2sgbG9jYXRpb24gdHlwZSBpcyBhZGRyZXNzIGluIGNhc2UgXCJub25lXCIgaXMgc2VsZWN0ZWQgYW5kIGFkZHJlc3NGaWVsZHMgbGluZ2VyXG4gICAgICAgICAgICAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgPT09IFwiZXNyaUdlb21ldHJ5UG9pbnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWRhdGFMYXllckdlb21ldHJ5IHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgPT09IFwibm9uZVwiIHx8IChzb3VyY2VEYXRhTGF5ZXIgPT09IG51bGwgfHwgc291cmNlRGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VEYXRhTGF5ZXIudHlwZSkgPT09IFwiVGFibGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeVRhYmxlTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpICE9PSBkYXRhTGF5ZXJHZW9tZXRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICgoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSkgIT09IChkYXRhTGF5ZXIgPT09IG51bGwgfHwgZGF0YUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhTGF5ZXIuZ2VvbWV0cnlUeXBlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IFwibm9HZW9tZXRyeU1hdGNoVGl0bGVcIiwgZGVzY3JpcHRpb246IFwibm9HZW9tZXRyeU1hdGNoTWVzc2FnZVwiIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzKGRhdGFMYXllciwgc291cmNlRGF0YUxheWVyLCB0eXBlKSB7XG4gICAgaWYgKHR5cGUgPT09IFwiTWljcm9zb2Z0IEV4Y2VsXCIgfHwgdHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci50eXBlKSA9PT0gXCJUYWJsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpICYmXG4gICAgICAgICAgICAoZGF0YUxheWVyID09PSBudWxsIHx8IGRhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YUxheWVyLmxvY2F0aW9uVHlwZSkgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKHNvdXJjZURhdGFMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VEYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZURhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvaW50XCIpIHtcbiAgICAgICAgICAgIHJldHVybiAhIWRhdGFMYXllci5hZGRyZXNzRmllbGRzIHx8IGRhdGFMYXllci5sb2NhdGlvblR5cGUgIT09IFwibm9uZVwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLnR5cGUpID09PSBcIlRhYmxlXCIgfHwgKGRhdGFMYXllciA9PT0gbnVsbCB8fCBkYXRhTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGFMYXllci5nZW9tZXRyeVR5cGUpID09PSAoc291cmNlRGF0YUxheWVyID09PSBudWxsIHx8IHNvdXJjZURhdGFMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBjaGVja0NvbXBhdGlibGVHZW9tZXRyaWVzIGFzIGMsIHZlcmlmeUdlb21ldHJpZXMgYXMgdiB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1nZW9tZXRyaWVzLTZjYTM5OTA3LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==