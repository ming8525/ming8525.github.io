"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6cd7c6"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-flow-color-slider.entry.js":
/*!*****************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-flow-color-slider.entry.js ***!
  \*****************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_flow_color_slider: () => (/* binding */ ArcgisSmartMappingFlowColorSlider)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _precision_06a73672_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./precision-06a73672.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/precision-06a73672.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./raster-flow-761a3470.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-flow-761a3470.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */













const arcgisSmartMappingFlowColorSliderCss = ".slider-box{height:275px}.slider-box .esri-color-slider{min-width:200px}.slider-box .esri-color-slider .esri-slider .esri-slider__content{height:130px}.slider-box .esri-color-slider .esri-slider .esri-slider__label,.slider-box .esri-color-slider .esri-slider .esri-slider__min,.slider-box .esri-color-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-color-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-color-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-color-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}";

const ArcgisSmartMappingFlowColorSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingFlowColorSliderChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingFlowColorSliderChange", 7);
        this.arcgisSmartMappingFlowColorSliderError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingFlowColorSliderError", 7);
        /**
         * Necessary for tracking stops for non-classed sliders,
         * whose values are updated immediately even given incorrect inputs.
         */
        this.currentStopValues = [];
        this.styleSheetStatus = "not-loaded";
    }
    // -------------------------------------------------------------------
    //
    // Lifecycle
    //
    // -------------------------------------------------------------------
    componentDidLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("link", { rel: "stylesheet", href: `${config.jsapiUrl}/themes/light/main.css`, onLoad: () => {
                this.styleSheetStatus = "loaded";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, onError: () => {
                this.styleSheetStatus = "failed";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.styleSheetStatus === "loaded"
            ? this.renderFlowColorSlider()
            : this.styleSheetStatus === "not-loaded"
                ? this.renderFlowColorSliderLoading()
                : null));
    }
    renderFlowColorSlider() {
        var _a, _b;
        const { layer: smLayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return;
        }
        const { sourceJSON } = layer;
        const { minValues, maxValues } = sourceJSON;
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
        const min = (_a = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue) !== null && _a !== void 0 ? _a : minValues === null || minValues === void 0 ? void 0 : minValues[0];
        const max = (_b = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : maxValues === null || maxValues === void 0 ? void 0 : maxValues[0];
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(min) || !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(max) || min === max || (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.stops.length) === 1) {
            if (this.flowColorSlider) {
                this.flowColorSlider.destroy();
                this.flowColorSlider = undefined;
            }
        }
        else {
            const ok = this.prepareFlowColorSlider();
            colorVisVar.stops.forEach((stop, idx) => {
                this.currentStopValues[idx] = stop.value;
            });
            if (ok || this.flowColorSlider) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.flow.dataRange), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box-buttons-front" }, this.renderInvertButton(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderResetButton()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                        if (node) {
                            this.afterFlowColorSliderCreate(node);
                        }
                    } })));
            }
            else {
                return this.renderFlowColorSliderLoading();
            }
        }
    }
    renderFlowColorSliderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderInvertButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.panels.flow.invertSlider, icon: "arrowUpDown", onClick: () => this.handleInvertSlider() }));
    }
    renderResetButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.panels.flow.resetSlider, icon: "undo", onClick: () => this.handleResetSlider() }));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    prepareFlowColorSlider() {
        var _a, _b, _c, _d;
        const { layer: smLayer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const { sourceJSON } = layer;
        const { minValues, maxValues } = sourceJSON;
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
        const min = (_a = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.minSliderValue) !== null && _a !== void 0 ? _a : minValues === null || minValues === void 0 ? void 0 : minValues[0];
        const max = (_b = authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : maxValues === null || maxValues === void 0 ? void 0 : maxValues[0];
        const handleInfo = authColorVisVar
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aD)(authColorVisVar.theme, colorVisVar.stops)
            : undefined;
        if (!this.flowColorSlider ||
            (!colorVisVar && this.flowColorSlider.stops)) {
            (_c = this.flowColorSlider) === null || _c === void 0 ? void 0 : _c.destroy();
            let config = {
                min,
                max
            };
            config = Object.assign(Object.assign({}, config), handleInfo);
            config.stops = colorVisVar.stops;
            config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_4__.g)(colorVisVar.stops);
            config.labelFormatFunction = (value) => {
                return value.toFixed(config.precision);
            };
            this.flowColorSlider = new modules.ColorSlider(config);
            this.createFlowColorSliderChangeEvents();
        }
        else {
            if (((_d = this.flowColorSlider.slider) === null || _d === void 0 ? void 0 : _d.state) === "dragging") {
                return true;
            }
            let config = {
                min,
                max
            };
            config = Object.assign(Object.assign({}, config), handleInfo);
            config.stops = colorVisVar.stops;
            config.precision = (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_4__.g)(colorVisVar.stops);
            this.flowColorSlider.set(config);
        }
        return (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(this.flowColorSlider);
    }
    handleInvertSlider() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        let colors = colorVisVar.stops.map((stop) => {
            return stop.color;
        });
        colors = colors.reverse();
        colorVisVar.stops.forEach((stop, idx) => {
            stop.color = colors[idx];
        });
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        this.arcgisSmartMappingFlowColorSliderChange.emit();
    }
    handleResetSlider() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)((0,_raster_flow_761a3470_js__WEBPACK_IMPORTED_MODULE_6__.c)({ includeColorVariable: true }), this.flowItemNode).then((result) => {
            const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(layer.renderer, "color");
            const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color");
            const newColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, "color");
            const newAuthColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, "color");
            authColorVisVar.minSliderValue = newAuthColorVisVar.minSliderValue;
            authColorVisVar.maxSliderValue = newAuthColorVisVar.maxSliderValue;
            colorVisVar.stops.forEach((stop, idx) => {
                stop.value = newColorVisVar.stops[idx].value;
            });
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        }, (error) => this.arcgisSmartMappingFlowColorSliderError.emit(error));
    }
    afterFlowColorSliderCreate(node) {
        if (!this.flowColorSlider.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.flowColorSlider.container = divNode;
        }
    }
    createFlowColorSliderChangeEvents() {
        if (!this.flowColorSlider) {
            return;
        }
        this.flowColorSlider.on("min-change", (info) => {
            if (info.value > this.currentStopValues[0]) {
                this.flowColorSlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentStopValues[idx];
                });
                this.handleMinMaxChange(this.currentStopValues[0], this.flowColorSlider.max);
            }
            else {
                this.handleMinMaxChange(info.value, this.flowColorSlider.max);
            }
        });
        this.flowColorSlider.on("max-change", (info) => {
            if (info.value < this.currentStopValues[this.currentStopValues.length - 1]) {
                this.flowColorSlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentStopValues[idx];
                });
                this.handleMinMaxChange(this.flowColorSlider.min, this.currentStopValues[this.currentStopValues.length - 1]);
            }
            else {
                this.handleMinMaxChange(this.flowColorSlider.min, info.value);
            }
        });
        this.flowColorSlider.on("thumb-change", () => this.updateRendererStops(this.flowColorSlider.stops));
        this.flowColorSlider.on("thumb-drag", () => this.updateRendererStops(this.flowColorSlider.stops));
        this.flowColorSlider.on("segment-drag", () => this.updateRendererStops(this.flowColorSlider.stops));
    }
    handleMinMaxChange(min, max) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "color") || {};
        authColorVisVar.minSliderValue = min;
        authColorVisVar.maxSliderValue = max;
        renderer.authoringInfo.classificationMethod = "manual";
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
        this.arcgisSmartMappingFlowColorSliderChange.emit();
    }
    updateRendererStops(stops) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        colorVisVar.stops = stops;
        colorVisVar.stops.forEach((stop, idx) => {
            this.currentStopValues[idx] = stop.value;
        });
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        this.arcgisSmartMappingFlowColorSliderChange.emit();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingFlowColorSlider.style = arcgisSmartMappingFlowColorSliderCss;



//# sourceMappingURL=arcgis-smart-mapping-flow-color-slider.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ requestWrapper)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
let _loadingTimer;
let _requestCancelled;
function startLoading(node) {
    node.loading = true;
    _requestCancelled = false;
    if (_loadingTimer) {
        clearTimeout(_loadingTimer);
    }
    _loadingTimer = setTimeout(() => {
        // took too long
        endLoading(node);
        _requestCancelled = true;
    }, 60000);
}
function endLoading(node) {
    node.loading = false;
}
function requestWrapper(request, node) {
    startLoading(node);
    return request
        .then((result) => {
        endLoading(node);
        if (!_requestCancelled) {
            return Promise.resolve(result);
        }
        else {
            return Promise.reject(new Error("timeout"));
        }
    })
        .catch((error) => {
        endLoading(node);
        return Promise.reject(error);
    });
}



//# sourceMappingURL=loading-69139907.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-flow-761a3470.js":
/*!*****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-flow-761a3470.js ***!
  \*****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ createFlowRendererFromExisting),
/* harmony export */   c: () => (/* binding */ createFlowRenderer),
/* harmony export */   f: () => (/* binding */ findFlowScheme)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * creates a Flow renderer with default settings
 * @param options: options
 */
function createFlowRenderer(options) {
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    return modules.RasterFlowCreator.createRenderer({
        layer,
        view: mapView,
        theme: options.flowTheme || "flow-line",
        includeColorVariable: options.includeColorVariable,
        legendOptions: options.legendOptions,
        flowRepresentation: options.flowRepresentation,
        flowScheme: options.flowScheme || findFlowScheme()
    }).then((result) => {
        if (result.layerEffect && result.layerEffect.indexOf("drop-shadow") === -1) {
            layer.effect = result.layerEffect;
        }
        result.renderer.color = result.renderer.color && (options.color || result.renderer.color);
        layer.renderer = result.renderer;
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
/**
 * Creates a Flow renderer with some settings from the current renderer
 * @param options: options
 */
function createFlowRendererFromExisting(options) {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const renderer = layer.renderer;
    const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(renderer, "color");
    const authoringInfo = renderer.authoringInfo;
    const theme = options.flowTheme || (authoringInfo === null || authoringInfo === void 0 ? void 0 : authoringInfo.flowTheme) || "flow-line";
    return modules.RasterFlowCreator.createRenderer({
        layer,
        view: mapView,
        theme,
        includeColorVariable: (_a = options.includeColorVariable) !== null && _a !== void 0 ? _a : !!colorVisVar,
        legendOptions: options.legendOptions || (colorVisVar === null || colorVisVar === void 0 ? void 0 : colorVisVar.legendOptions),
        flowRepresentation: options.flowRepresentation || renderer.flowRepresentation,
        // flowScheme: theme === "flow-line" ? options.flowScheme || findFlowScheme() : undefined /* bug */
        flowScheme: options.flowScheme
    }).then((result) => {
        // keep old slider min/max
        const colorAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(renderer, "color");
        const newColorAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(result.renderer, "color");
        if ((colorAuthVisVar === null || colorAuthVisVar === void 0 ? void 0 : colorAuthVisVar.minSliderValue) && (colorAuthVisVar === null || colorAuthVisVar === void 0 ? void 0 : colorAuthVisVar.maxSliderValue) && newColorAuthVisVar) {
            newColorAuthVisVar.minSliderValue = colorAuthVisVar.minSliderValue;
            newColorAuthVisVar.maxSliderValue = colorAuthVisVar.maxSliderValue;
        }
        // keep old stops
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(layer.renderer, "color");
        const newColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "color");
        if (colorVisVar && newColorVisVar) {
            colorVisVar.stops.forEach((stop, idx) => {
                newColorVisVar.stops[idx].value = stop.value;
            });
        }
        // keep old single color
        result.renderer.color = result.renderer.color && (options.color || renderer.color || result.renderer.color);
        // keep old stop colors
        const scheme = options.flowScheme || findFlowScheme();
        if (scheme && colorVisVar && newColorVisVar) {
            colorVisVar.stops.forEach((stop, idx) => {
                newColorVisVar.stops[idx].color = new modules.esriColor(stop.color.toJSON());
            });
        }
        if (theme === authoringInfo.flowTheme) {
            result.renderer.flowSpeed = renderer.flowSpeed;
            result.renderer.density = renderer.density;
            result.renderer.trailLength = renderer.trailLength;
            result.renderer.trailWidth = renderer.trailWidth;
            result.renderer.trailCap = renderer.trailCap;
        }
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
function findFlowScheme() {
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    const renderer = layer.renderer;
    const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(renderer, "color");
    if (!colorVisVar) {
        return null;
    }
    const colors = colorVisVar.stops.map((stop) => {
        return stop.color;
    });
    const schemes = modules.flowSchemes.getSchemes({
        basemap: mapView.map.basemap || "topo"
    });
    const allSchemes = [schemes.primaryScheme].concat(schemes.secondarySchemes);
    const matchingSchemes = [];
    allSchemes.forEach((scheme) => {
        let hasNoMatch = colors.some((color, idx) => {
            return !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a4)(scheme.colors[idx], color);
        });
        if (!hasNoMatch) {
            matchingSchemes.push(scheme);
        }
        else {
            // try flipped ramp
            scheme.colors = scheme.colors.reverse();
            hasNoMatch = colors.some((color, idx) => {
                return !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a4)(scheme.colors[idx], color);
            });
            if (!hasNoMatch) {
                matchingSchemes.push(scheme);
            }
        }
    });
    return matchingSchemes.length ? matchingSchemes[0] : null;
}



//# sourceMappingURL=raster-flow-761a3470.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTZjZDdjNi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDK0g7QUFDaUU7QUFDcEk7QUFDekI7QUFDNkI7QUFDN0I7QUFDaUM7QUFDaEM7QUFDVDtBQUNHO0FBQ0Q7QUFDVTs7QUFFdkMsMERBQTBELGFBQWEsK0JBQStCLGdCQUFnQixrRUFBa0UsYUFBYSw0TEFBNEwsMEJBQTBCLDhNQUE4TSxzQkFBc0IseUJBQXlCLHFCQUFxQixVQUFVLDBCQUEwQixhQUFhOztBQUU5dEI7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHVEQUF1RCxxREFBVztBQUNsRSxzREFBc0QscURBQVc7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsbUVBQWM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsU0FBUyxFQUFFLCtEQUFpQjtBQUM1QyxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLFdBQVcsNEJBQTRCLGdCQUFnQjtBQUN0RjtBQUNBLGdCQUFnQixxREFBVztBQUMzQixhQUFhO0FBQ2I7QUFDQSxnQkFBZ0IscURBQVc7QUFDM0IsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQixFQUFFLCtEQUFpQjtBQUM3RDtBQUNBO0FBQ0EsNEJBQTRCLG1FQUFTO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixhQUFhO0FBQzdCLGdCQUFnQix1QkFBdUI7QUFDdkMsZ0NBQWdDLG1FQUFhO0FBQzdDO0FBQ0E7QUFDQSxhQUFhLG9FQUFTLFVBQVUsb0VBQVM7QUFDekM7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LEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG9FQUFXO0FBQy9CLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvRUFBVztBQUNuQyxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFNkY7O0FBRTdGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZmxvdy1jb2xvci1zbGlkZXIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9hZGluZy02OTEzOTkwNy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9yYXN0ZXItZmxvdy03NjFhMzQ3MC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZiBhcyBmb3JjZVVwZGF0ZSwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IEYgYXMgZmluZFBhcmVudE5vZGUsIGEgYXMgZ2V0VmlzVmFyLCBwIGFzIGdldEF1dGhWaXNWYXIsIGFjIGFzIGlzRGVmaW5lZCwgYWIgYXMgdXBkYXRlUmVuZGVyZXIsIHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGFEIGFzIGdldEhhbmRsZUluZm8gfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0V3JhcHBlciB9IGZyb20gJy4vbG9hZGluZy02OTEzOTkwNy5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRTdG9wUHJlY2lzaW9uIH0gZnJvbSAnLi9wcmVjaXNpb24tMDZhNzM2NzIuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlRmxvd1JlbmRlcmVyIH0gZnJvbSAnLi9yYXN0ZXItZmxvdy03NjFhMzQ3MC5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkZ1bmN0aW9ucy1iMDgzMGU5ZS5qcyc7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckNzcyA9IFwiLnNsaWRlci1ib3h7aGVpZ2h0OjI3NXB4fS5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNsaWRlcnttaW4td2lkdGg6MjAwcHh9LnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX2NvbnRlbnR7aGVpZ2h0OjEzMHB4fS5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19sYWJlbCwuc2xpZGVyLWJveCAuZXNyaS1jb2xvci1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWluLC5zbGlkZXItYm94IC5lc3JpLWNvbG9yLXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19tYXh7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0uc2xpZGVyLWJveCAuZXNyaS1jb2xvci1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWw6aG92ZXIsLnNsaWRlci1ib3ggLmVzcmktY29sb3Itc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21pbjpob3Zlciwuc2xpZGVyLWJveCAuZXNyaS1jb2xvci1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWF4OmhvdmVye2JvcmRlcjoxcHggc29saWQgI2JiYjtiYWNrZ3JvdW5kLWNvbG9yOiNmM2YzZjM7dGV4dC1kZWNvcmF0aW9uOm5vbmU7ei1pbmRleDoxfS5zbGlkZXItYm94LWJ1dHRvbnMtZnJvbnR7ZGlzcGxheTpmbGV4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdGbG93Q29sb3JTbGlkZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nRmxvd0NvbG9yU2xpZGVyQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdGbG93Q29sb3JTbGlkZXJFcnJvclwiLCA3KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5lY2Vzc2FyeSBmb3IgdHJhY2tpbmcgc3RvcHMgZm9yIG5vbi1jbGFzc2VkIHNsaWRlcnMsXG4gICAgICAgICAqIHdob3NlIHZhbHVlcyBhcmUgdXBkYXRlZCBpbW1lZGlhdGVseSBldmVuIGdpdmVuIGluY29ycmVjdCBpbnB1dHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzID0gW107XG4gICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibm90LWxvYWRlZFwiO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjb25maWcgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImxpbmtcIiwgeyByZWw6IFwic3R5bGVzaGVldFwiLCBocmVmOiBgJHtjb25maWcuanNhcGlVcmx9L3RoZW1lcy9saWdodC9tYWluLmNzc2AsIG9uTG9hZDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibG9hZGVkXCI7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9LCBvbkVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZVNoZWV0U3RhdHVzID0gXCJmYWlsZWRcIjtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSksIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJsb2FkZWRcIlxuICAgICAgICAgICAgPyB0aGlzLnJlbmRlckZsb3dDb2xvclNsaWRlcigpXG4gICAgICAgICAgICA6IHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJub3QtbG9hZGVkXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMucmVuZGVyRmxvd0NvbG9yU2xpZGVyTG9hZGluZygpXG4gICAgICAgICAgICAgICAgOiBudWxsKSk7XG4gICAgfVxuICAgIHJlbmRlckZsb3dDb2xvclNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmICghY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IHNvdXJjZUpTT04gfSA9IGxheWVyO1xuICAgICAgICBjb25zdCB7IG1pblZhbHVlcywgbWF4VmFsdWVzIH0gPSBzb3VyY2VKU09OO1xuICAgICAgICBjb25zdCBhdXRoQ29sb3JWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBtaW4gPSAoX2EgPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG1pblZhbHVlcyA9PT0gbnVsbCB8fCBtaW5WYWx1ZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1pblZhbHVlc1swXTtcbiAgICAgICAgY29uc3QgbWF4ID0gKF9iID0gYXV0aENvbG9yVmlzVmFyID09PSBudWxsIHx8IGF1dGhDb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBtYXhWYWx1ZXMgPT09IG51bGwgfHwgbWF4VmFsdWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXhWYWx1ZXNbMF07XG4gICAgICAgIGlmICghaXNEZWZpbmVkKG1pbikgfHwgIWlzRGVmaW5lZChtYXgpIHx8IG1pbiA9PT0gbWF4IHx8IChjb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvclZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JWaXNWYXIuc3RvcHMubGVuZ3RoKSA9PT0gMSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmxvd0NvbG9yU2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvd0NvbG9yU2xpZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgb2sgPSB0aGlzLnByZXBhcmVGbG93Q29sb3JTbGlkZXIoKTtcbiAgICAgICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbaWR4XSA9IHN0b3AudmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvayB8fCB0aGlzLmZsb3dDb2xvclNsaWRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5mbG93LmRhdGFSYW5nZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItYm94LWJ1dHRvbnMtZnJvbnRcIiB9LCB0aGlzLnJlbmRlckludmVydEJ1dHRvbigpLCBoKFwiZGl2XCIsIG51bGwsIFwiXFx1MDBBMFwiKSwgdGhpcy5yZW5kZXJSZXNldEJ1dHRvbigpKSwgaChcImRpdlwiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckZsb3dDb2xvclNsaWRlckNyZWF0ZShub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRmxvd0NvbG9yU2xpZGVyTG9hZGluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlckZsb3dDb2xvclNsaWRlckxvYWRpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3hcIiB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBsYWJlbDogc3RyaW5ncy5sb2FkaW5nIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckludmVydEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5wYW5lbHMuZmxvdy5pbnZlcnRTbGlkZXIsIGljb246IFwiYXJyb3dVcERvd25cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVJbnZlcnRTbGlkZXIoKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclJlc2V0QnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLnBhbmVscy5mbG93LnJlc2V0U2xpZGVyLCBpY29uOiBcInVuZG9cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVSZXNldFNsaWRlcigpIH0pKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHByZXBhcmVGbG93Q29sb3JTbGlkZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IHsgc291cmNlSlNPTiB9ID0gbGF5ZXI7XG4gICAgICAgIGNvbnN0IHsgbWluVmFsdWVzLCBtYXhWYWx1ZXMgfSA9IHNvdXJjZUpTT047XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IG1pbiA9IChfYSA9IGF1dGhDb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoQ29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhDb2xvclZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbWluVmFsdWVzID09PSBudWxsIHx8IG1pblZhbHVlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWluVmFsdWVzWzBdO1xuICAgICAgICBjb25zdCBtYXggPSAoX2IgPSBhdXRoQ29sb3JWaXNWYXIgPT09IG51bGwgfHwgYXV0aENvbG9yVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoQ29sb3JWaXNWYXIubWF4U2xpZGVyVmFsdWUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG1heFZhbHVlcyA9PT0gbnVsbCB8fCBtYXhWYWx1ZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1heFZhbHVlc1swXTtcbiAgICAgICAgY29uc3QgaGFuZGxlSW5mbyA9IGF1dGhDb2xvclZpc1ZhclxuICAgICAgICAgICAgPyBnZXRIYW5kbGVJbmZvKGF1dGhDb2xvclZpc1Zhci50aGVtZSwgY29sb3JWaXNWYXIuc3RvcHMpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCF0aGlzLmZsb3dDb2xvclNsaWRlciB8fFxuICAgICAgICAgICAgKCFjb2xvclZpc1ZhciAmJiB0aGlzLmZsb3dDb2xvclNsaWRlci5zdG9wcykpIHtcbiAgICAgICAgICAgIChfYyA9IHRoaXMuZmxvd0NvbG9yU2xpZGVyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZGVzdHJveSgpO1xuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBtaW4sXG4gICAgICAgICAgICAgICAgbWF4XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uZmlnID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBjb25maWcpLCBoYW5kbGVJbmZvKTtcbiAgICAgICAgICAgIGNvbmZpZy5zdG9wcyA9IGNvbG9yVmlzVmFyLnN0b3BzO1xuICAgICAgICAgICAgY29uZmlnLnByZWNpc2lvbiA9IGdldFN0b3BQcmVjaXNpb24oY29sb3JWaXNWYXIuc3RvcHMpO1xuICAgICAgICAgICAgY29uZmlnLmxhYmVsRm9ybWF0RnVuY3Rpb24gPSAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9GaXhlZChjb25maWcucHJlY2lzaW9uKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmZsb3dDb2xvclNsaWRlciA9IG5ldyBtb2R1bGVzLkNvbG9yU2xpZGVyKGNvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUZsb3dDb2xvclNsaWRlckNoYW5nZUV2ZW50cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCgoX2QgPSB0aGlzLmZsb3dDb2xvclNsaWRlci5zbGlkZXIpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdGF0ZSkgPT09IFwiZHJhZ2dpbmdcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBtaW4sXG4gICAgICAgICAgICAgICAgbWF4XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uZmlnID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBjb25maWcpLCBoYW5kbGVJbmZvKTtcbiAgICAgICAgICAgIGNvbmZpZy5zdG9wcyA9IGNvbG9yVmlzVmFyLnN0b3BzO1xuICAgICAgICAgICAgY29uZmlnLnByZWNpc2lvbiA9IGdldFN0b3BQcmVjaXNpb24oY29sb3JWaXNWYXIuc3RvcHMpO1xuICAgICAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXIuc2V0KGNvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzRGVmaW5lZCh0aGlzLmZsb3dDb2xvclNsaWRlcik7XG4gICAgfVxuICAgIGhhbmRsZUludmVydFNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGxldCBjb2xvcnMgPSBjb2xvclZpc1Zhci5zdG9wcy5tYXAoKHN0b3ApID0+IHtcbiAgICAgICAgICAgIHJldHVybiBzdG9wLmNvbG9yO1xuICAgICAgICB9KTtcbiAgICAgICAgY29sb3JzID0gY29sb3JzLnJldmVyc2UoKTtcbiAgICAgICAgY29sb3JWaXNWYXIuc3RvcHMuZm9yRWFjaCgoc3RvcCwgaWR4KSA9PiB7XG4gICAgICAgICAgICBzdG9wLmNvbG9yID0gY29sb3JzW2lkeF07XG4gICAgICAgIH0pO1xuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdGbG93Q29sb3JTbGlkZXJDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBoYW5kbGVSZXNldFNsaWRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgcmVxdWVzdFdyYXBwZXIoY3JlYXRlRmxvd1JlbmRlcmVyKHsgaW5jbHVkZUNvbG9yVmFyaWFibGU6IHRydWUgfSksIHRoaXMuZmxvd0l0ZW1Ob2RlKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKGxheWVyLnJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICAgICAgY29uc3QgYXV0aENvbG9yVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0F1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVzdWx0LnJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICAgICAgYXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlID0gbmV3QXV0aENvbG9yVmlzVmFyLm1pblNsaWRlclZhbHVlO1xuICAgICAgICAgICAgYXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlID0gbmV3QXV0aENvbG9yVmlzVmFyLm1heFNsaWRlclZhbHVlO1xuICAgICAgICAgICAgY29sb3JWaXNWYXIuc3RvcHMuZm9yRWFjaCgoc3RvcCwgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IG5ld0NvbG9yVmlzVmFyLnN0b3BzW2lkeF0udmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckVycm9yLmVtaXQoZXJyb3IpKTtcbiAgICB9XG4gICAgYWZ0ZXJGbG93Q29sb3JTbGlkZXJDcmVhdGUobm9kZSkge1xuICAgICAgICBpZiAoIXRoaXMuZmxvd0NvbG9yU2xpZGVyLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBub2RlLmFwcGVuZChkaXZOb2RlKTtcbiAgICAgICAgICAgIHRoaXMuZmxvd0NvbG9yU2xpZGVyLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlRmxvd0NvbG9yU2xpZGVyQ2hhbmdlRXZlbnRzKCkge1xuICAgICAgICBpZiAoIXRoaXMuZmxvd0NvbG9yU2xpZGVyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXIub24oXCJtaW4tY2hhbmdlXCIsIChpbmZvKSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5mby52YWx1ZSA+IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dDb2xvclNsaWRlci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbaWR4XTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU1pbk1heENoYW5nZSh0aGlzLmN1cnJlbnRTdG9wVmFsdWVzWzBdLCB0aGlzLmZsb3dDb2xvclNsaWRlci5tYXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVNaW5NYXhDaGFuZ2UoaW5mby52YWx1ZSwgdGhpcy5mbG93Q29sb3JTbGlkZXIubWF4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmxvd0NvbG9yU2xpZGVyLm9uKFwibWF4LWNoYW5nZVwiLCAoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPCB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzW3RoaXMuY3VycmVudFN0b3BWYWx1ZXMubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dDb2xvclNsaWRlci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3RvcC52YWx1ZSA9IHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbaWR4XTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU1pbk1heENoYW5nZSh0aGlzLmZsb3dDb2xvclNsaWRlci5taW4sIHRoaXMuY3VycmVudFN0b3BWYWx1ZXNbdGhpcy5jdXJyZW50U3RvcFZhbHVlcy5sZW5ndGggLSAxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU1pbk1heENoYW5nZSh0aGlzLmZsb3dDb2xvclNsaWRlci5taW4sIGluZm8udmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXIub24oXCJ0aHVtYi1jaGFuZ2VcIiwgKCkgPT4gdGhpcy51cGRhdGVSZW5kZXJlclN0b3BzKHRoaXMuZmxvd0NvbG9yU2xpZGVyLnN0b3BzKSk7XG4gICAgICAgIHRoaXMuZmxvd0NvbG9yU2xpZGVyLm9uKFwidGh1bWItZHJhZ1wiLCAoKSA9PiB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHModGhpcy5mbG93Q29sb3JTbGlkZXIuc3RvcHMpKTtcbiAgICAgICAgdGhpcy5mbG93Q29sb3JTbGlkZXIub24oXCJzZWdtZW50LWRyYWdcIiwgKCkgPT4gdGhpcy51cGRhdGVSZW5kZXJlclN0b3BzKHRoaXMuZmxvd0NvbG9yU2xpZGVyLnN0b3BzKSk7XG4gICAgfVxuICAgIGhhbmRsZU1pbk1heENoYW5nZShtaW4sIG1heCkge1xuICAgICAgICBjb25zdCB7IGxheWVyOiBzbUxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGxheWVyLnJlbmRlcmVyO1xuICAgICAgICBjb25zdCBhdXRoQ29sb3JWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpIHx8IHt9O1xuICAgICAgICBhdXRoQ29sb3JWaXNWYXIubWluU2xpZGVyVmFsdWUgPSBtaW47XG4gICAgICAgIGF1dGhDb2xvclZpc1Zhci5tYXhTbGlkZXJWYWx1ZSA9IG1heDtcbiAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby5jbGFzc2lmaWNhdGlvbk1ldGhvZCA9IFwibWFudWFsXCI7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckNoYW5nZS5lbWl0KCk7XG4gICAgfVxuICAgIHVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzID0gc3RvcHM7XG4gICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RvcFZhbHVlc1tpZHhdID0gc3RvcC52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRmxvd0NvbG9yU2xpZGVyQ2hhbmdlLmVtaXQoKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlci5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ0Zsb3dDb2xvclNsaWRlckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nRmxvd0NvbG9yU2xpZGVyIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX2Zsb3dfY29sb3Jfc2xpZGVyIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1zbWFydC1tYXBwaW5nLWZsb3ctY29sb3Itc2xpZGVyLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xubGV0IF9sb2FkaW5nVGltZXI7XG5sZXQgX3JlcXVlc3RDYW5jZWxsZWQ7XG5mdW5jdGlvbiBzdGFydExvYWRpbmcobm9kZSkge1xuICAgIG5vZGUubG9hZGluZyA9IHRydWU7XG4gICAgX3JlcXVlc3RDYW5jZWxsZWQgPSBmYWxzZTtcbiAgICBpZiAoX2xvYWRpbmdUaW1lcikge1xuICAgICAgICBjbGVhclRpbWVvdXQoX2xvYWRpbmdUaW1lcik7XG4gICAgfVxuICAgIF9sb2FkaW5nVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgLy8gdG9vayB0b28gbG9uZ1xuICAgICAgICBlbmRMb2FkaW5nKG5vZGUpO1xuICAgICAgICBfcmVxdWVzdENhbmNlbGxlZCA9IHRydWU7XG4gICAgfSwgNjAwMDApO1xufVxuZnVuY3Rpb24gZW5kTG9hZGluZyhub2RlKSB7XG4gICAgbm9kZS5sb2FkaW5nID0gZmFsc2U7XG59XG5mdW5jdGlvbiByZXF1ZXN0V3JhcHBlcihyZXF1ZXN0LCBub2RlKSB7XG4gICAgc3RhcnRMb2FkaW5nKG5vZGUpO1xuICAgIHJldHVybiByZXF1ZXN0XG4gICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgZW5kTG9hZGluZyhub2RlKTtcbiAgICAgICAgaWYgKCFfcmVxdWVzdENhbmNlbGxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcInRpbWVvdXRcIikpO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBlbmRMb2FkaW5nKG5vZGUpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgeyByZXF1ZXN0V3JhcHBlciBhcyByIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvYWRpbmctNjkxMzk5MDcuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBwIGFzIGdldEF1dGhWaXNWYXIsIGEgYXMgZ2V0VmlzVmFyLCBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlLCBhNCBhcyBpc1NhbWVDb2xvciB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcblxuLyoqXG4gKiBjcmVhdGVzIGEgRmxvdyByZW5kZXJlciB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAqIEBwYXJhbSBvcHRpb25zOiBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUZsb3dSZW5kZXJlcihvcHRpb25zKSB7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHJldHVybiBtb2R1bGVzLlJhc3RlckZsb3dDcmVhdG9yLmNyZWF0ZVJlbmRlcmVyKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIHRoZW1lOiBvcHRpb25zLmZsb3dUaGVtZSB8fCBcImZsb3ctbGluZVwiLFxuICAgICAgICBpbmNsdWRlQ29sb3JWYXJpYWJsZTogb3B0aW9ucy5pbmNsdWRlQ29sb3JWYXJpYWJsZSxcbiAgICAgICAgbGVnZW5kT3B0aW9uczogb3B0aW9ucy5sZWdlbmRPcHRpb25zLFxuICAgICAgICBmbG93UmVwcmVzZW50YXRpb246IG9wdGlvbnMuZmxvd1JlcHJlc2VudGF0aW9uLFxuICAgICAgICBmbG93U2NoZW1lOiBvcHRpb25zLmZsb3dTY2hlbWUgfHwgZmluZEZsb3dTY2hlbWUoKVxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0LmxheWVyRWZmZWN0ICYmIHJlc3VsdC5sYXllckVmZmVjdC5pbmRleE9mKFwiZHJvcC1zaGFkb3dcIikgPT09IC0xKSB7XG4gICAgICAgICAgICBsYXllci5lZmZlY3QgPSByZXN1bHQubGF5ZXJFZmZlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmNvbG9yID0gcmVzdWx0LnJlbmRlcmVyLmNvbG9yICYmIChvcHRpb25zLmNvbG9yIHx8IHJlc3VsdC5yZW5kZXJlci5jb2xvcik7XG4gICAgICAgIGxheWVyLnJlbmRlcmVyID0gcmVzdWx0LnJlbmRlcmVyO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgfSwgKGVycm9yKSA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgRmxvdyByZW5kZXJlciB3aXRoIHNvbWUgc2V0dGluZ3MgZnJvbSB0aGUgY3VycmVudCByZW5kZXJlclxuICogQHBhcmFtIG9wdGlvbnM6IG9wdGlvbnNcbiAqL1xuZnVuY3Rpb24gY3JlYXRlRmxvd1JlbmRlcmVyRnJvbUV4aXN0aW5nKG9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgY29uc3QgYXV0aG9yaW5nSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgY29uc3QgdGhlbWUgPSBvcHRpb25zLmZsb3dUaGVtZSB8fCAoYXV0aG9yaW5nSW5mbyA9PT0gbnVsbCB8fCBhdXRob3JpbmdJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRob3JpbmdJbmZvLmZsb3dUaGVtZSkgfHwgXCJmbG93LWxpbmVcIjtcbiAgICByZXR1cm4gbW9kdWxlcy5SYXN0ZXJGbG93Q3JlYXRvci5jcmVhdGVSZW5kZXJlcih7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICB0aGVtZSxcbiAgICAgICAgaW5jbHVkZUNvbG9yVmFyaWFibGU6IChfYSA9IG9wdGlvbnMuaW5jbHVkZUNvbG9yVmFyaWFibGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICEhY29sb3JWaXNWYXIsXG4gICAgICAgIGxlZ2VuZE9wdGlvbnM6IG9wdGlvbnMubGVnZW5kT3B0aW9ucyB8fCAoY29sb3JWaXNWYXIgPT09IG51bGwgfHwgY29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnMpLFxuICAgICAgICBmbG93UmVwcmVzZW50YXRpb246IG9wdGlvbnMuZmxvd1JlcHJlc2VudGF0aW9uIHx8IHJlbmRlcmVyLmZsb3dSZXByZXNlbnRhdGlvbixcbiAgICAgICAgLy8gZmxvd1NjaGVtZTogdGhlbWUgPT09IFwiZmxvdy1saW5lXCIgPyBvcHRpb25zLmZsb3dTY2hlbWUgfHwgZmluZEZsb3dTY2hlbWUoKSA6IHVuZGVmaW5lZCAvKiBidWcgKi9cbiAgICAgICAgZmxvd1NjaGVtZTogb3B0aW9ucy5mbG93U2NoZW1lXG4gICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIC8vIGtlZXAgb2xkIHNsaWRlciBtaW4vbWF4XG4gICAgICAgIGNvbnN0IGNvbG9yQXV0aFZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IG5ld0NvbG9yQXV0aFZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVzdWx0LnJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBpZiAoKGNvbG9yQXV0aFZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvckF1dGhWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yQXV0aFZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgJiYgKGNvbG9yQXV0aFZpc1ZhciA9PT0gbnVsbCB8fCBjb2xvckF1dGhWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbG9yQXV0aFZpc1Zhci5tYXhTbGlkZXJWYWx1ZSkgJiYgbmV3Q29sb3JBdXRoVmlzVmFyKSB7XG4gICAgICAgICAgICBuZXdDb2xvckF1dGhWaXNWYXIubWluU2xpZGVyVmFsdWUgPSBjb2xvckF1dGhWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgICAgICBuZXdDb2xvckF1dGhWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSBjb2xvckF1dGhWaXNWYXIubWF4U2xpZGVyVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8ga2VlcCBvbGQgc3RvcHNcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIobGF5ZXIucmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IG5ld0NvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgaWYgKGNvbG9yVmlzVmFyICYmIG5ld0NvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5zdG9wcy5mb3JFYWNoKChzdG9wLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICBuZXdDb2xvclZpc1Zhci5zdG9wc1tpZHhdLnZhbHVlID0gc3RvcC52YWx1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIGtlZXAgb2xkIHNpbmdsZSBjb2xvclxuICAgICAgICByZXN1bHQucmVuZGVyZXIuY29sb3IgPSByZXN1bHQucmVuZGVyZXIuY29sb3IgJiYgKG9wdGlvbnMuY29sb3IgfHwgcmVuZGVyZXIuY29sb3IgfHwgcmVzdWx0LnJlbmRlcmVyLmNvbG9yKTtcbiAgICAgICAgLy8ga2VlcCBvbGQgc3RvcCBjb2xvcnNcbiAgICAgICAgY29uc3Qgc2NoZW1lID0gb3B0aW9ucy5mbG93U2NoZW1lIHx8IGZpbmRGbG93U2NoZW1lKCk7XG4gICAgICAgIGlmIChzY2hlbWUgJiYgY29sb3JWaXNWYXIgJiYgbmV3Q29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIGNvbG9yVmlzVmFyLnN0b3BzLmZvckVhY2goKHN0b3AsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIG5ld0NvbG9yVmlzVmFyLnN0b3BzW2lkeF0uY29sb3IgPSBuZXcgbW9kdWxlcy5lc3JpQ29sb3Ioc3RvcC5jb2xvci50b0pTT04oKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhlbWUgPT09IGF1dGhvcmluZ0luZm8uZmxvd1RoZW1lKSB7XG4gICAgICAgICAgICByZXN1bHQucmVuZGVyZXIuZmxvd1NwZWVkID0gcmVuZGVyZXIuZmxvd1NwZWVkO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmRlbnNpdHkgPSByZW5kZXJlci5kZW5zaXR5O1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnRyYWlsTGVuZ3RoID0gcmVuZGVyZXIudHJhaWxMZW5ndGg7XG4gICAgICAgICAgICByZXN1bHQucmVuZGVyZXIudHJhaWxXaWR0aCA9IHJlbmRlcmVyLnRyYWlsV2lkdGg7XG4gICAgICAgICAgICByZXN1bHQucmVuZGVyZXIudHJhaWxDYXAgPSByZW5kZXJlci50cmFpbENhcDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgfSwgKGVycm9yKSA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xufVxuZnVuY3Rpb24gZmluZEZsb3dTY2hlbWUoKSB7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgaWYgKCFjb2xvclZpc1Zhcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgY29sb3JzID0gY29sb3JWaXNWYXIuc3RvcHMubWFwKChzdG9wKSA9PiB7XG4gICAgICAgIHJldHVybiBzdG9wLmNvbG9yO1xuICAgIH0pO1xuICAgIGNvbnN0IHNjaGVtZXMgPSBtb2R1bGVzLmZsb3dTY2hlbWVzLmdldFNjaGVtZXMoe1xuICAgICAgICBiYXNlbWFwOiBtYXBWaWV3Lm1hcC5iYXNlbWFwIHx8IFwidG9wb1wiXG4gICAgfSk7XG4gICAgY29uc3QgYWxsU2NoZW1lcyA9IFtzY2hlbWVzLnByaW1hcnlTY2hlbWVdLmNvbmNhdChzY2hlbWVzLnNlY29uZGFyeVNjaGVtZXMpO1xuICAgIGNvbnN0IG1hdGNoaW5nU2NoZW1lcyA9IFtdO1xuICAgIGFsbFNjaGVtZXMuZm9yRWFjaCgoc2NoZW1lKSA9PiB7XG4gICAgICAgIGxldCBoYXNOb01hdGNoID0gY29sb3JzLnNvbWUoKGNvbG9yLCBpZHgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhaXNTYW1lQ29sb3Ioc2NoZW1lLmNvbG9yc1tpZHhdLCBjb2xvcik7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWhhc05vTWF0Y2gpIHtcbiAgICAgICAgICAgIG1hdGNoaW5nU2NoZW1lcy5wdXNoKHNjaGVtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyB0cnkgZmxpcHBlZCByYW1wXG4gICAgICAgICAgICBzY2hlbWUuY29sb3JzID0gc2NoZW1lLmNvbG9ycy5yZXZlcnNlKCk7XG4gICAgICAgICAgICBoYXNOb01hdGNoID0gY29sb3JzLnNvbWUoKGNvbG9yLCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWlzU2FtZUNvbG9yKHNjaGVtZS5jb2xvcnNbaWR4XSwgY29sb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIWhhc05vTWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGluZ1NjaGVtZXMucHVzaChzY2hlbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG1hdGNoaW5nU2NoZW1lcy5sZW5ndGggPyBtYXRjaGluZ1NjaGVtZXNbMF0gOiBudWxsO1xufVxuXG5leHBvcnQgeyBjcmVhdGVGbG93UmVuZGVyZXJGcm9tRXhpc3RpbmcgYXMgYSwgY3JlYXRlRmxvd1JlbmRlcmVyIGFzIGMsIGZpbmRGbG93U2NoZW1lIGFzIGYgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmFzdGVyLWZsb3ctNzYxYTM0NzAuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9