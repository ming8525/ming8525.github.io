"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-24da61"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const addItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    typeKeywords: [],
    customParameters: [],
    analyzedLocationTypes: [],
    allowStoredAuth: true,
    isSecured: null,
    checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;



//# sourceMappingURL=add-item-dbbe2f57.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-append-key-value-pair.entry.js":
/*!****************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-append-key-value-pair.entry.js ***!
  \****************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_append_key_value_pair: () => (/* binding */ ArcgisNewItemAppendKeyValuePair)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






const arcgisNewItemAppendKeyValuePairCss = ".description{margin-bottom:1rem;font-size:0.875rem;font-weight:300}.header{margin-bottom:0.5rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.description-label{margin-top:0.5rem;font-size:0.75rem}.key-pair-select{font-size:0.875rem}.key-pair-page{margin-bottom:1rem}.select-wrapper{margin-top:0.5rem;margin-bottom:2rem;display:flex;flex-direction:row;background-color:var(--calcite-color-background);padding-top:1rem;padding-bottom:0.75rem}.source-key-pair-select{margin-left:0.75rem;margin-right:1rem;width:100%}.name-key-pair-select{margin-right:0.75rem;margin-left:1rem;width:100%}.select-and-label{display:flex;flex-direction:column}.popover-icon{cursor:pointer;color:var(--calcite-color-text-3);margin-inline-start:0.75rem;margin-top:0.125rem}.popover-content{margin:0px;font-size:0.75rem;font-weight:400}.original-field,.uploaded-field{display:flex}.original-field-header,.uploaded-field-header{font-weight:500}.original-field-popover,.uploaded-field-popover{margin-top:-0.313rem}";

const ArcgisNewItemAppendKeyValuePair = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.keyPairChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "keyPairChange", 7);
        this.keyPairs = undefined;
        this.i18n = undefined;
        this.sourceValues = undefined;
        this.nameValues = undefined;
        this.selectedKeyPair = undefined;
        this.selectedSource = null;
    }
    async componentWillLoad() {
        var _a;
        const { existingItem, originalFileName } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        let selectedName = _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_3__.N;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__.u.i18n.appendKeyValuePair;
        if (!!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair) {
            selectedName = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair.name;
            this.selectedSource = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.uidPair.source;
        }
        this.selectedKeyPair = this.keyPairs[selectedName];
        this.sourceValues = (_a = this.selectedKeyPair) === null || _a === void 0 ? void 0 : _a.possibleMatches;
        this.nameValues = Object.keys(this.keyPairs);
        this.originalFieldInfo = this.i18n.originalField.moreInfo.replace("${featureLayerName}", existingItem.title);
        this.uploadedFieldInfo = this.i18n.uploadedField.moreInfo.replace("${uploadedFileName}", originalFileName);
    }
    handleKeyPairChange(ev) {
        const value = ev.target.selectedOption.value;
        this.selectedKeyPair = this.keyPairs[value];
        const possibleMatches = this.selectedKeyPair.possibleMatches.length > 0
            ? [...this.selectedKeyPair.possibleMatches]
            : [_append_4e11032c_js__WEBPACK_IMPORTED_MODULE_3__.N];
        this.sourceValues = possibleMatches;
        this.selectedSource = possibleMatches[0];
        const payload = Object.assign(Object.assign({}, this.selectedKeyPair), { source: this.selectedSource, initialMatch: this.selectedSource });
        this.keyPairChange.emit(payload);
    }
    handleSourceKeyPairChange(ev) {
        const value = ev.target.selectedOption.value;
        const payload = Object.assign(Object.assign({}, this.selectedKeyPair), { source: value, initialMatch: value });
        this.keyPairChange.emit(payload);
    }
    render() {
        const { originalFieldInfo, uploadedFieldInfo, i18n, selectedKeyPair, selectedSource } = this;
        const names = this.nameValues;
        const sources = this.sourceValues;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "key-pair-page" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-and-label" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: i18n.selectUniqueIdentifier, content: i18n.selectUniqueIdentifierDescription }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "name-key-pair-select" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "original-field", role: "columnheader" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "original-field-header" }, i18n.originalField.header), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { class: "original-field-popover", label: originalFieldInfo, placement: "top-start", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "popover-content" }, originalFieldInfo))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", label: i18n.selectUniqueIdentifier, onCalciteSelectChange: this.handleKeyPairChange.bind(this) }, names.map((nameField, idx) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { key: idx, selected: nameField === selectedKeyPair.name }, `${nameField}`));
        }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "source-key-pair-select" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "uploaded-field" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "uploaded-field-header" }, i18n.uploadedField.header), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { class: "uploaded-field-popover", label: uploadedFieldInfo, placement: "top-start", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "popover-content" }, uploadedFieldInfo))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", label: i18n.selectUniqueIdentifier, onCalciteSelectChange: this.handleSourceKeyPairChange.bind(this) }, (sources || []).map((sourceField, idx) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { key: idx, selected: sourceField === selectedSource }, `${sourceField}`));
        })))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemAppendKeyValuePair.style = arcgisNewItemAppendKeyValuePairCss;



//# sourceMappingURL=arcgis-new-item-append-key-value-pair.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};



//# sourceMappingURL=index-05956cab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const uiStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    nextText: "next",
    workflow: "content",
    scale: "m",
    disableScroll: false,
    featureFlags: {}
});
const uiStoreState = uiStore.state;



//# sourceMappingURL=ui-bca7bcd1.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTI0ZGE2MS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOztBQUVoRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcU07O0FBRXJNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ2tHO0FBQ3ZDO0FBQ047QUFDRTtBQUMxQjs7QUFFN0IseURBQXlELG1CQUFtQixtQkFBbUIsZ0JBQWdCLFFBQVEscUJBQXFCLGVBQWUsZ0JBQWdCLGtDQUFrQyxtQkFBbUIsa0JBQWtCLGtCQUFrQixpQkFBaUIsbUJBQW1CLGVBQWUsbUJBQW1CLGdCQUFnQixrQkFBa0IsbUJBQW1CLGFBQWEsbUJBQW1CLGlEQUFpRCxpQkFBaUIsdUJBQXVCLHdCQUF3QixvQkFBb0Isa0JBQWtCLFdBQVcsc0JBQXNCLHFCQUFxQixpQkFBaUIsV0FBVyxrQkFBa0IsYUFBYSxzQkFBc0IsY0FBYyxlQUFlLGtDQUFrQyw0QkFBNEIsb0JBQW9CLGlCQUFpQixXQUFXLGtCQUFrQixnQkFBZ0IsZ0NBQWdDLGFBQWEsOENBQThDLGdCQUFnQixnREFBZ0QscUJBQXFCOztBQUUxaEM7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLDZCQUE2QixxREFBVztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaUNBQWlDLEVBQUUsb0RBQVk7QUFDL0QsMkJBQTJCLGtEQUFVO0FBQ3JDLG9CQUFvQiw4Q0FBWTtBQUNoQyxjQUFjLG9EQUFZO0FBQzFCLDJCQUEyQixvREFBWTtBQUN2QyxrQ0FBa0Msb0RBQVk7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsaUJBQWlCO0FBQzlGLDZFQUE2RSxpQkFBaUI7QUFDOUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBVTtBQUN6QjtBQUNBO0FBQ0Esc0RBQXNELDJCQUEyQixnRUFBZ0U7QUFDako7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsMkJBQTJCLG9DQUFvQztBQUNySDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsOEVBQThFO0FBQzlGO0FBQ0E7QUFDQSxnQkFBZ0IscURBQUMsVUFBVSx3QkFBd0IsRUFBRSxxREFBQyxVQUFVLDJCQUEyQixFQUFFLHFEQUFDLGtDQUFrQyxzRkFBc0YsR0FBRyxxREFBQyxVQUFVLHlCQUF5QixFQUFFLHFEQUFDLG9CQUFvQiwrQkFBK0IsRUFBRSxxREFBQyxXQUFXLCtDQUErQyxFQUFFLHFEQUFDLFdBQVcsZ0NBQWdDLDhCQUE4QixxREFBQyx5QkFBeUIsd0dBQXdHLEVBQUUscURBQUMsUUFBUSwwQkFBMEIsd0JBQXdCLHFEQUFDLHFCQUFxQiwrR0FBK0c7QUFDaHdCLG9CQUFvQixxREFBQyxxQkFBcUIsd0RBQXdELEtBQUssVUFBVTtBQUNqSCxTQUFTLEtBQUsscURBQUMsb0JBQW9CLGlDQUFpQyxFQUFFLHFEQUFDLFdBQVcseUJBQXlCLEVBQUUscURBQUMsV0FBVyxnQ0FBZ0MsOEJBQThCLHFEQUFDLHlCQUF5Qix3R0FBd0csRUFBRSxxREFBQyxRQUFRLDBCQUEwQix3QkFBd0IscURBQUMscUJBQXFCLHFIQUFxSDtBQUNqZ0Isb0JBQW9CLHFEQUFDLHFCQUFxQixvREFBb0QsS0FBSyxZQUFZO0FBQy9HLFNBQVM7QUFDVDtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQztBQUNBOztBQUVvRjs7QUFFcEY7Ozs7Ozs7Ozs7Ozs7OztBQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RTs7QUFFN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLGVBQWUsaURBQWU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixxREFBZTtBQUN2QztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELGlEQUFXO0FBQ3RFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSx3REFBd0QsaURBQVc7QUFDbkU7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrSEFBa0g7QUFDbEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1R0FBdUc7QUFDdkc7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEI7O0FBRTVCOzs7Ozs7Ozs7Ozs7Ozs7O0FDdk1BO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxnQkFBZ0IscURBQVc7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDs7QUFFMkM7O0FBRTNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYWRkLWl0ZW0tZGJiZTJmNTcuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTRlMTEwMzJjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1uZXctaXRlbS1hcHBlbmQta2V5LXZhbHVlLXBhaXIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaW5kZXgtMDU5NTZjYWIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdWktYmNhN2JjZDEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICB0eXBlS2V5d29yZHM6IFtdLFxuICAgIGN1c3RvbVBhcmFtZXRlcnM6IFtdLFxuICAgIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gICAgYWxsb3dTdG9yZWRBdXRoOiB0cnVlLFxuICAgIGlzU2VjdXJlZDogbnVsbCxcbiAgICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZGQtaXRlbS1kYmJlMmY1Ny5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IHVpZEZpZWxkcyA9IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIl07XG5jb25zdCBOT05FX1ZBTFVFID0gXCI8Tm9uZT5cIjtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyA9IHtcbiAgICBcImZpbGUgZ2VvZGF0YWJhc2VcIjogXCJmaWxlZ2VvZGF0YWJhc2VcIixcbiAgICBzaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgZ2VvanNvbjogXCJnZW9qc29uXCIsXG4gICAgY3N2OiBcIkNTVlwiLFxuICAgIFwibWljcm9zb2Z0IGV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBnZW9wYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IGFwcGVuZEZpbGVUeXBlcyA9IHtcbiAgICBTaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgXCJGaWxlIEdlb2RhdGFiYXNlXCI6IFwiZmlsZUdlb2RhdGFiYXNlXCIsXG4gICAgQ1NWOiBcImNzdlwiLFxuICAgIFwiTWljcm9zb2Z0IEV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBHZW9Kc29uOiBcImdlb2pzb25cIixcbiAgICBHZW9QYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzID0ge1xuICAgIGNzdjogXCJDU1ZcIixcbiAgICBleGNlbDogXCJNaWNyb3NvZnQgRXhjZWxcIixcbiAgICBzaGFwZWZpbGU6IFwiU2hhcGVmaWxlXCIsXG4gICAgZmdkYjogXCJGaWxlIEdlb2RhdGFiYXNlXCIsXG4gICAgZ2VvanNvbjogXCJHZW9Kc29uXCIsXG4gICAgZ29vZ2xlc2hlZXRzOiBcIk1pY3Jvc29mdCBFeGNlbFwiXG59O1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9ucyA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJnZW9qc29uXCIsIFwiZ3BrZ1wiLCBcImpzb25cIl07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIl07XG5cbmV4cG9ydCB7IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIGFzIEEsIE5PTkVfVkFMVUUgYXMgTiwgYXBwZW5kRmlsZVR5cGVzIGFzIGEsIEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyBhcyBiLCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSBhcyBjLCBhcHBlbmRFeHRlbnNpb25zIGFzIGQsIHVpZEZpZWxkcyBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGVuZC00ZTExMDMyYy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuaW1wb3J0IHsgdSBhcyB1aVN0b3JlU3RhdGUgfSBmcm9tICcuL3VpLWJjYTdiY2QxLmpzJztcbmltcG9ydCB7IE4gYXMgTk9ORV9WQUxVRSB9IGZyb20gJy4vYXBwZW5kLTRlMTEwMzJjLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1BcHBlbmRLZXlWYWx1ZVBhaXJDc3MgPSBcIi5kZXNjcmlwdGlvbnttYXJnaW4tYm90dG9tOjFyZW07Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjMwMH0uaGVhZGVye21hcmdpbi1ib3R0b206MC41cmVtO2ZvbnQtc2l6ZToxcmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmRlc2NyaXB0aW9uLWxhYmVse21hcmdpbi10b3A6MC41cmVtO2ZvbnQtc2l6ZTowLjc1cmVtfS5rZXktcGFpci1zZWxlY3R7Zm9udC1zaXplOjAuODc1cmVtfS5rZXktcGFpci1wYWdle21hcmdpbi1ib3R0b206MXJlbX0uc2VsZWN0LXdyYXBwZXJ7bWFyZ2luLXRvcDowLjVyZW07bWFyZ2luLWJvdHRvbToycmVtO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpyb3c7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpO3BhZGRpbmctdG9wOjFyZW07cGFkZGluZy1ib3R0b206MC43NXJlbX0uc291cmNlLWtleS1wYWlyLXNlbGVjdHttYXJnaW4tbGVmdDowLjc1cmVtO21hcmdpbi1yaWdodDoxcmVtO3dpZHRoOjEwMCV9Lm5hbWUta2V5LXBhaXItc2VsZWN0e21hcmdpbi1yaWdodDowLjc1cmVtO21hcmdpbi1sZWZ0OjFyZW07d2lkdGg6MTAwJX0uc2VsZWN0LWFuZC1sYWJlbHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5wb3BvdmVyLWljb257Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpO21hcmdpbi1pbmxpbmUtc3RhcnQ6MC43NXJlbTttYXJnaW4tdG9wOjAuMTI1cmVtfS5wb3BvdmVyLWNvbnRlbnR7bWFyZ2luOjBweDtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo0MDB9Lm9yaWdpbmFsLWZpZWxkLC51cGxvYWRlZC1maWVsZHtkaXNwbGF5OmZsZXh9Lm9yaWdpbmFsLWZpZWxkLWhlYWRlciwudXBsb2FkZWQtZmllbGQtaGVhZGVye2ZvbnQtd2VpZ2h0OjUwMH0ub3JpZ2luYWwtZmllbGQtcG9wb3ZlciwudXBsb2FkZWQtZmllbGQtcG9wb3ZlcnttYXJnaW4tdG9wOi0wLjMxM3JlbX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbUFwcGVuZEtleVZhbHVlUGFpciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMua2V5UGFpckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwia2V5UGFpckNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5rZXlQYWlycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNvdXJjZVZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5uYW1lVmFsdWVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkS2V5UGFpciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFNvdXJjZSA9IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgZXhpc3RpbmdJdGVtLCBvcmlnaW5hbEZpbGVOYW1lIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGxldCBzZWxlY3RlZE5hbWUgPSBOT05FX1ZBTFVFO1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRLZXlWYWx1ZVBhaXI7XG4gICAgICAgIGlmICghIWFkZEl0ZW1TdGF0ZS51aWRQYWlyKSB7XG4gICAgICAgICAgICBzZWxlY3RlZE5hbWUgPSBhZGRJdGVtU3RhdGUudWlkUGFpci5uYW1lO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFNvdXJjZSA9IGFkZEl0ZW1TdGF0ZS51aWRQYWlyLnNvdXJjZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbGVjdGVkS2V5UGFpciA9IHRoaXMua2V5UGFpcnNbc2VsZWN0ZWROYW1lXTtcbiAgICAgICAgdGhpcy5zb3VyY2VWYWx1ZXMgPSAoX2EgPSB0aGlzLnNlbGVjdGVkS2V5UGFpcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBvc3NpYmxlTWF0Y2hlcztcbiAgICAgICAgdGhpcy5uYW1lVmFsdWVzID0gT2JqZWN0LmtleXModGhpcy5rZXlQYWlycyk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxGaWVsZEluZm8gPSB0aGlzLmkxOG4ub3JpZ2luYWxGaWVsZC5tb3JlSW5mby5yZXBsYWNlKFwiJHtmZWF0dXJlTGF5ZXJOYW1lfVwiLCBleGlzdGluZ0l0ZW0udGl0bGUpO1xuICAgICAgICB0aGlzLnVwbG9hZGVkRmllbGRJbmZvID0gdGhpcy5pMThuLnVwbG9hZGVkRmllbGQubW9yZUluZm8ucmVwbGFjZShcIiR7dXBsb2FkZWRGaWxlTmFtZX1cIiwgb3JpZ2luYWxGaWxlTmFtZSk7XG4gICAgfVxuICAgIGhhbmRsZUtleVBhaXJDaGFuZ2UoZXYpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBldi50YXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRLZXlQYWlyID0gdGhpcy5rZXlQYWlyc1t2YWx1ZV07XG4gICAgICAgIGNvbnN0IHBvc3NpYmxlTWF0Y2hlcyA9IHRoaXMuc2VsZWN0ZWRLZXlQYWlyLnBvc3NpYmxlTWF0Y2hlcy5sZW5ndGggPiAwXG4gICAgICAgICAgICA/IFsuLi50aGlzLnNlbGVjdGVkS2V5UGFpci5wb3NzaWJsZU1hdGNoZXNdXG4gICAgICAgICAgICA6IFtOT05FX1ZBTFVFXTtcbiAgICAgICAgdGhpcy5zb3VyY2VWYWx1ZXMgPSBwb3NzaWJsZU1hdGNoZXM7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTb3VyY2UgPSBwb3NzaWJsZU1hdGNoZXNbMF07XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc2VsZWN0ZWRLZXlQYWlyKSwgeyBzb3VyY2U6IHRoaXMuc2VsZWN0ZWRTb3VyY2UsIGluaXRpYWxNYXRjaDogdGhpcy5zZWxlY3RlZFNvdXJjZSB9KTtcbiAgICAgICAgdGhpcy5rZXlQYWlyQ2hhbmdlLmVtaXQocGF5bG9hZCk7XG4gICAgfVxuICAgIGhhbmRsZVNvdXJjZUtleVBhaXJDaGFuZ2UoZXYpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBldi50YXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWU7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc2VsZWN0ZWRLZXlQYWlyKSwgeyBzb3VyY2U6IHZhbHVlLCBpbml0aWFsTWF0Y2g6IHZhbHVlIH0pO1xuICAgICAgICB0aGlzLmtleVBhaXJDaGFuZ2UuZW1pdChwYXlsb2FkKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IG9yaWdpbmFsRmllbGRJbmZvLCB1cGxvYWRlZEZpZWxkSW5mbywgaTE4biwgc2VsZWN0ZWRLZXlQYWlyLCBzZWxlY3RlZFNvdXJjZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgbmFtZXMgPSB0aGlzLm5hbWVWYWx1ZXM7XG4gICAgICAgIGNvbnN0IHNvdXJjZXMgPSB0aGlzLnNvdXJjZVZhbHVlcztcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwia2V5LXBhaXItcGFnZVwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWxlY3QtYW5kLWxhYmVsXCIgfSwgaChcImFyY2dpcy1uZXctaXRlbS1kZXNjcmlwdGlvblwiLCB7IGhlYWRlcjogaTE4bi5zZWxlY3RVbmlxdWVJZGVudGlmaWVyLCBjb250ZW50OiBpMThuLnNlbGVjdFVuaXF1ZUlkZW50aWZpZXJEZXNjcmlwdGlvbiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlbGVjdC13cmFwcGVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJuYW1lLWtleS1wYWlyLXNlbGVjdFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwib3JpZ2luYWwtZmllbGRcIiwgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcIm9yaWdpbmFsLWZpZWxkLWhlYWRlclwiIH0sIGkxOG4ub3JpZ2luYWxGaWVsZC5oZWFkZXIpLCBoKFwiYXJjZ2lzLWluZm9ybWF0aW9uXCIsIHsgY2xhc3M6IFwib3JpZ2luYWwtZmllbGQtcG9wb3ZlclwiLCBsYWJlbDogb3JpZ2luYWxGaWVsZEluZm8sIHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgcGFkZGVkQ29udGVudDogdHJ1ZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcInBvcG92ZXItY29udGVudFwiIH0sIG9yaWdpbmFsRmllbGRJbmZvKSkpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyB3aWR0aDogXCJmdWxsXCIsIGxhYmVsOiBpMThuLnNlbGVjdFVuaXF1ZUlkZW50aWZpZXIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogdGhpcy5oYW5kbGVLZXlQYWlyQ2hhbmdlLmJpbmQodGhpcykgfSwgbmFtZXMubWFwKChuYW1lRmllbGQsIGlkeCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBrZXk6IGlkeCwgc2VsZWN0ZWQ6IG5hbWVGaWVsZCA9PT0gc2VsZWN0ZWRLZXlQYWlyLm5hbWUgfSwgYCR7bmFtZUZpZWxkfWApKTtcbiAgICAgICAgfSkpKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzb3VyY2Uta2V5LXBhaXItc2VsZWN0XCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJ1cGxvYWRlZC1maWVsZFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwidXBsb2FkZWQtZmllbGQtaGVhZGVyXCIgfSwgaTE4bi51cGxvYWRlZEZpZWxkLmhlYWRlciksIGgoXCJhcmNnaXMtaW5mb3JtYXRpb25cIiwgeyBjbGFzczogXCJ1cGxvYWRlZC1maWVsZC1wb3BvdmVyXCIsIGxhYmVsOiB1cGxvYWRlZEZpZWxkSW5mbywgcGxhY2VtZW50OiBcInRvcC1zdGFydFwiLCBwYWRkZWRDb250ZW50OiB0cnVlIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwicG9wb3Zlci1jb250ZW50XCIgfSwgdXBsb2FkZWRGaWVsZEluZm8pKSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IHdpZHRoOiBcImZ1bGxcIiwgbGFiZWw6IGkxOG4uc2VsZWN0VW5pcXVlSWRlbnRpZmllciwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiB0aGlzLmhhbmRsZVNvdXJjZUtleVBhaXJDaGFuZ2UuYmluZCh0aGlzKSB9LCAoc291cmNlcyB8fCBbXSkubWFwKChzb3VyY2VGaWVsZCwgaWR4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IGtleTogaWR4LCBzZWxlY3RlZDogc291cmNlRmllbGQgPT09IHNlbGVjdGVkU291cmNlIH0sIGAke3NvdXJjZUZpZWxkfWApKTtcbiAgICAgICAgfSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtQXBwZW5kS2V5VmFsdWVQYWlyLnN0eWxlID0gYXJjZ2lzTmV3SXRlbUFwcGVuZEtleVZhbHVlUGFpckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbUFwcGVuZEtleVZhbHVlUGFpciBhcyBhcmNnaXNfbmV3X2l0ZW1fYXBwZW5kX2tleV92YWx1ZV9wYWlyIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1uZXctaXRlbS1hcHBlbmQta2V5LXZhbHVlLXBhaXIuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlbmRlcmluZ1JlZiwgZiBhcyBmb3JjZVVwZGF0ZSB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG5jb25zdCBhcHBlbmRUb01hcCA9IChtYXAsIHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IGl0ZW1zID0gbWFwLmdldChwcm9wTmFtZSk7XG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgICBtYXAuc2V0KHByb3BOYW1lLCBbdmFsdWVdKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWl0ZW1zLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTtcbiAgICB9XG59O1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIG1zKSA9PiB7XG4gICAgbGV0IHRpbWVvdXRJZDtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aW1lb3V0SWQgPSAwO1xuICAgICAgICAgICAgZm4oLi4uYXJncyk7XG4gICAgICAgIH0sIG1zKTtcbiAgICB9O1xufTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHBvc3NpYmxlIGVsZW1lbnQgaXNDb25uZWN0ZWQuXG4gKiBUaGUgcHJvcGVydHkgbWlnaHQgbm90IGJlIHRoZXJlLCBzbyB3ZSBjaGVjayBmb3IgaXQuXG4gKlxuICogV2Ugd2FudCBpdCB0byByZXR1cm4gdHJ1ZSBpZiBpc0Nvbm5lY3RlZCBpcyBub3QgYSBwcm9wZXJ0eSxcbiAqIG90aGVyd2lzZSB3ZSB3b3VsZCByZW1vdmUgdGhlc2UgZWxlbWVudHMgYW5kIHdvdWxkIG5vdCB1cGRhdGUuXG4gKlxuICogQmV0dGVyIGxlYWsgaW4gRWRnZSB0aGFuIHRvIGJlIHVzZWxlc3MuXG4gKi9cbmNvbnN0IGlzQ29ubmVjdGVkID0gKG1heWJlRWxlbWVudCkgPT4gISgnaXNDb25uZWN0ZWQnIGluIG1heWJlRWxlbWVudCkgfHwgbWF5YmVFbGVtZW50LmlzQ29ubmVjdGVkO1xuY29uc3QgY2xlYW51cEVsZW1lbnRzID0gZGVib3VuY2UoKG1hcCkgPT4ge1xuICAgIGZvciAobGV0IGtleSBvZiBtYXAua2V5cygpKSB7XG4gICAgICAgIG1hcC5zZXQoa2V5LCBtYXAuZ2V0KGtleSkuZmlsdGVyKGlzQ29ubmVjdGVkKSk7XG4gICAgfVxufSwgMjAwMCk7XG5jb25zdCBzdGVuY2lsU3Vic2NyaXB0aW9uID0gKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgZ2V0UmVuZGVyaW5nUmVmICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIElmIHdlIGFyZSBub3QgaW4gYSBzdGVuY2lsIHByb2plY3QsIHdlIGRvIG5vdGhpbmcuXG4gICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgbm90IHJlYWxseSBleHBvcnRlZCBieSBAc3RlbmNpbC9jb3JlLlxuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGVsbXNUb1VwZGF0ZSA9IG5ldyBNYXAoKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiAoKSA9PiBlbG1zVG9VcGRhdGUuY2xlYXIoKSxcbiAgICAgICAgZ2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsbSA9IGdldFJlbmRlcmluZ1JlZigpO1xuICAgICAgICAgICAgaWYgKGVsbSkge1xuICAgICAgICAgICAgICAgIGFwcGVuZFRvTWFwKGVsbXNUb1VwZGF0ZSwgcHJvcE5hbWUsIGVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGVsbXNUb1VwZGF0ZS5nZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgZWxtc1RvVXBkYXRlLnNldChwcm9wTmFtZSwgZWxlbWVudHMuZmlsdGVyKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5mb3JFYWNoKChlbG1zKSA9PiBlbG1zLmZvckVhY2goZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgIH07XG59O1xuXG5jb25zdCB1bndyYXAgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJyA/IHZhbCgpIDogdmFsKTtcbmNvbnN0IGNyZWF0ZU9ic2VydmFibGVNYXAgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUgPSAoYSwgYikgPT4gYSAhPT0gYikgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZFN0YXRlID0gdW53cmFwKGRlZmF1bHRTdGF0ZSk7XG4gICAgbGV0IHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXModW53cmFwcGVkU3RhdGUgIT09IG51bGwgJiYgdW53cmFwcGVkU3RhdGUgIT09IHZvaWQgMCA/IHVud3JhcHBlZFN0YXRlIDoge30pKTtcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcbiAgICAgICAgZGlzcG9zZTogW10sXG4gICAgICAgIGdldDogW10sXG4gICAgICAgIHNldDogW10sXG4gICAgICAgIHJlc2V0OiBbXSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIFdoZW4gcmVzZXR0aW5nIHRoZSBzdGF0ZSwgdGhlIGRlZmF1bHQgc3RhdGUgbWF5IGJlIGEgZnVuY3Rpb24gLSB1bndyYXAgaXQgdG8gaW52b2tlIGl0LlxuICAgICAgICAvLyBvdGhlcndpc2UsIHRoZSBzdGF0ZSB3b24ndCBiZSBwcm9wZXJseSByZXNldFxuICAgICAgICBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKChfYSA9IHVud3JhcChkZWZhdWx0U3RhdGUpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB7fSkpO1xuICAgICAgICBoYW5kbGVycy5yZXNldC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfTtcbiAgICBjb25zdCBkaXNwb3NlID0gKCkgPT4ge1xuICAgICAgICAvLyBDYWxsIGZpcnN0IGRpc3Bvc2UgYXMgcmVzZXR0aW5nIHRoZSBzdGF0ZSB3b3VsZFxuICAgICAgICAvLyBjYXVzZSBsZXNzIHVwZGF0ZXMgOylcbiAgICAgICAgaGFuZGxlcnMuZGlzcG9zZS5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgfTtcbiAgICBjb25zdCBnZXQgPSAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgaGFuZGxlcnMuZ2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSkpO1xuICAgICAgICByZXR1cm4gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgfTtcbiAgICBjb25zdCBzZXQgPSAocHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgICAgIGlmIChzaG91bGRVcGRhdGUodmFsdWUsIG9sZFZhbHVlLCBwcm9wTmFtZSkpIHtcbiAgICAgICAgICAgIHN0YXRlcy5zZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUsIHZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzdGF0ZSA9ICh0eXBlb2YgUHJveHkgPT09ICd1bmRlZmluZWQnXG4gICAgICAgID8ge31cbiAgICAgICAgOiBuZXcgUHJveHkodW53cmFwcGVkU3RhdGUsIHtcbiAgICAgICAgICAgIGdldChfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG93bktleXMoXykge1xuICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRlcy5rZXlzKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXMoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzLmhhcyhwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KF8sIHByb3BOYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpO1xuICAgIGNvbnN0IG9uID0gKGV2ZW50TmFtZSwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZUZyb21BcnJheShoYW5kbGVyc1tldmVudE5hbWVdLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBvbkNoYW5nZSA9IChwcm9wTmFtZSwgY2IpID0+IHtcbiAgICAgICAgY29uc3QgdW5TZXQgPSBvbignc2V0JywgKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2IobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gV2UgbmVlZCB0byB1bndyYXAgdGhlIGRlZmF1bHRTdGF0ZSBiZWNhdXNlIGl0IG1pZ2h0IGJlIGEgZnVuY3Rpb24uXG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBtaWdodCBub3QgYmUgc2VuZGluZyB0aGUgcmlnaHQgcmVzZXQgdmFsdWUuXG4gICAgICAgIGNvbnN0IHVuUmVzZXQgPSBvbigncmVzZXQnLCAoKSA9PiBjYih1bndyYXAoZGVmYXVsdFN0YXRlKVtwcm9wTmFtZV0pKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVuU2V0KCk7XG4gICAgICAgICAgICB1blJlc2V0KCk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCB1c2UgPSAoLi4uc3Vic2NyaXB0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCB1bnN1YnMgPSBzdWJzY3JpcHRpb25zLnJlZHVjZSgodW5zdWJzLCBzdWJzY3JpcHRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3NldCcsIHN1YnNjcmlwdGlvbi5zZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZ2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2dldCcsIHN1YnNjcmlwdGlvbi5nZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24ucmVzZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbigncmVzZXQnLCBzdWJzY3JpcHRpb24ucmVzZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZGlzcG9zZSkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdkaXNwb3NlJywgc3Vic2NyaXB0aW9uLmRpc3Bvc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bnN1YnM7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHVuc3Vicy5mb3JFYWNoKCh1bnN1YikgPT4gdW5zdWIoKSk7XG4gICAgfTtcbiAgICBjb25zdCBmb3JjZVVwZGF0ZSA9IChrZXkpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KGtleSk7XG4gICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2Ioa2V5LCBvbGRWYWx1ZSwgb2xkVmFsdWUpKTtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXRlLFxuICAgICAgICBnZXQsXG4gICAgICAgIHNldCxcbiAgICAgICAgb24sXG4gICAgICAgIG9uQ2hhbmdlLFxuICAgICAgICB1c2UsXG4gICAgICAgIGRpc3Bvc2UsXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBmb3JjZVVwZGF0ZSxcbiAgICB9O1xufTtcbmNvbnN0IHJlbW92ZUZyb21BcnJheSA9IChhcnJheSwgaXRlbSkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gYXJyYXkuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBhcnJheVthcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgYXJyYXkubGVuZ3RoLS07XG4gICAgfVxufTtcblxuY29uc3QgY3JlYXRlU3RvcmUgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpID0+IHtcbiAgICBjb25zdCBtYXAgPSBjcmVhdGVPYnNlcnZhYmxlTWFwKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKTtcbiAgICBtYXAudXNlKHN0ZW5jaWxTdWJzY3JpcHRpb24oKSk7XG4gICAgcmV0dXJuIG1hcDtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZVN0b3JlIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgtMDU5NTZjYWIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IHVpU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gICAgbmV4dFRleHQ6IFwibmV4dFwiLFxuICAgIHdvcmtmbG93OiBcImNvbnRlbnRcIixcbiAgICBzY2FsZTogXCJtXCIsXG4gICAgZGlzYWJsZVNjcm9sbDogZmFsc2UsXG4gICAgZmVhdHVyZUZsYWdzOiB7fVxufSk7XG5jb25zdCB1aVN0b3JlU3RhdGUgPSB1aVN0b3JlLnN0YXRlO1xuXG5leHBvcnQgeyB1aVN0b3JlIGFzIGEsIHVpU3RvcmVTdGF0ZSBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVpLWJjYTdiY2QxLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==