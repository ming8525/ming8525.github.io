"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_guid-a-a32c89"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js":
/*!*********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getAppSwitcherConfig),
/* harmony export */   b: () => (/* binding */ getMarketPlaceProvisionedListings),
/* harmony export */   c: () => (/* binding */ getUserProperties),
/* harmony export */   d: () => (/* binding */ getApprovedApps),
/* harmony export */   e: () => (/* binding */ getOrgCapabilities),
/* harmony export */   f: () => (/* binding */ getSigninSettings),
/* harmony export */   g: () => (/* binding */ getShowInAppLauncher),
/* harmony export */   h: () => (/* binding */ getBlockableApps),
/* harmony export */   i: () => (/* binding */ getServers),
/* harmony export */   j: () => (/* binding */ getPortalSettings),
/* harmony export */   k: () => (/* binding */ fetchAllResources),
/* harmony export */   q: () => (/* binding */ queryAppItemsForChanges),
/* harmony export */   u: () => (/* binding */ updateUserProperties)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const appSwitcherConfigItemQuery = `owner:"esri" AND title:"AppSwitcher Config" AND type: "Application Configuration"`;
async function getPortalSettings(portal) {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    if (!portalUrl) {
        return;
    }
    const url = `${portalUrl}portals/self/settings`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => request(url), "portalSettings", portalUrl);
}
async function getShowInAppLauncher() {
    var _a;
    const settings = await getPortalSettings();
    return ((_a = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties) === null || _a === void 0 ? void 0 : _a.showInAppLauncher) || [];
}
async function getAppSwitcherConfigItem() {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (!portalUrl) {
        return;
    }
    const url = `${portalUrl}search`;
    return request(url, {
        num: 1,
        start: 0,
        sortField: "title",
        sortOrder: "asc",
        q: appSwitcherConfigItemQuery
    });
}
async function getConfigData(itemId) {
    const portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (!portalUrl || !itemId) {
        return;
    }
    const url = `${portalUrl}content/items/${itemId}/data`;
    return request(url);
}
async function getAppSwitcherConfig() {
    var _a;
    const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || !user) {
        return;
    }
    const result = await getAppSwitcherConfigItem();
    const item = (_a = result === null || result === void 0 ? void 0 : result.results) === null || _a === void 0 ? void 0 : _a[0];
    if (!item) {
        return;
    }
    const itemId = item.id;
    const data = await getConfigData(itemId);
    return data;
}
async function getUserProperties() {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}community/users/${user.username}/properties`;
    return request(url);
}
async function getApprovedApps() {
    const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/${portal.id}/approvedApps`;
    return request(url, { returnAllApps: false });
}
async function fetchAllResources(url, content, resourceKey = "results") {
    const max = 100;
    let start = 1;
    let resources = [];
    let totalLeft;
    let numRequests;
    let promises;
    let i;
    content.start = start;
    if (!content.num) {
        content.num = max;
    }
    try {
        const result = await request(url, content);
        if (!(result === null || result === void 0 ? void 0 : result[resourceKey])) {
            return resources;
        }
        resources = [...resources, ...result[resourceKey]];
        // calculate whether further batches are needed
        start = result.nextStart;
        totalLeft = result.total - resources.length;
        numRequests = Math.ceil(totalLeft / max);
        promises = [];
        // request each necessary batch
        for (i = 0; i < numRequests; i++) {
            content.start = start + i * max;
            promises.push(request(url, content));
        }
        try {
            const results = await Promise.all(promises);
            results.forEach((r) => {
                resources = [...resources, ...r[resourceKey]];
            });
            return resources;
        }
        catch (_a) {
            return resources;
        }
    }
    catch (_b) {
        return resources;
    }
}
async function getMarketPlaceProvisionedListings() {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}community/users/${user.username}/provisionedListings`;
    return fetchAllResources(url, { returnAppClientIds: true, returnAllProvisions: true }, "provisionedListings");
}
async function getOrgCapabilities() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/subscriptionInfo`;
    try {
        const response = await request(url);
        return (response === null || response === void 0 ? void 0 : response.orgCapabilities) || [];
    }
    catch (_a) {
        return [];
    }
}
async function queryAppItemsForChanges(approvedApps, runQuery) {
    if (!runQuery || !(approvedApps === null || approvedApps === void 0 ? void 0 : approvedApps.length)) {
        return;
    }
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`;
    return request(url, {
        num: 100,
        q: `id:(${approvedApps.map((a) => `"${a.itemId}"`).join(" OR ")})`
    });
}
const blockedAppsConfigItemQuery = `owner:"esri" AND title:"BlockedApps Config" AND type: "Application Configuration"`;
async function getBlockableApps() {
    var _a, _b;
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}search`;
    try {
        const response = await request(url, {
            num: 10,
            start: 0,
            sortField: "title",
            sortOrder: "asc",
            q: blockedAppsConfigItemQuery
        });
        if (!response) {
            return [];
        }
        const itemId = ((_b = (_a = response.results) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.id) || "";
        const data = await getConfigData(itemId);
        return (data === null || data === void 0 ? void 0 : data.blockedApps) || [];
    }
    catch (_c) {
        return [];
    }
}
async function getServers() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/servers`;
    const response = await request(url);
    return (response === null || response === void 0 ? void 0 : response.servers) || [];
}
async function getSigninSettings() {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}portals/self/signinSettings`;
    const response = await request(url);
    return response;
}
function getUrl(path) {
    let portalUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)();
    if (portalUrl.slice(-1) !== "/") {
        portalUrl += "/";
    }
    return `${portalUrl}${path}`;
}
async function request(url, params) {
    if (!params) {
        params = {};
    }
    params.f = "json";
    const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)();
    if (token) {
        params.token = token;
    }
    const urlObj = new URL(url);
    Object.keys(params).forEach((key) => urlObj.searchParams.append(key, params[key]));
    const response = await fetch(urlObj);
    const responseData = await response.json();
    return responseData;
}
async function postRequest(url, data) {
    data.append("f", "json");
    const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)();
    if (token) {
        data.append("token", token);
    }
    fetch(url, { method: "POST", body: data });
}
async function updateUserProperties(properties) {
    const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const url = getUrl(`community/users/${user.username}/setProperties`);
    const data = new FormData();
    data.append("properties", JSON.stringify(properties));
    return postRequest(url, data);
}



//# sourceMappingURL=api-2e3a136f.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ guid)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function generateId(counts) {
    return counts
        .map((count) => {
        let out = "";
        for (let i = 0; i < count; i++) {
            out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return out;
    })
        .join("-");
}
const guid = () => generateId([2, 1, 1, 1, 3]);



//# sourceMappingURL=guid-aeaed84d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getHydratedItem),
/* harmony export */   b: () => (/* binding */ getItemDataUrl),
/* harmony export */   c: () => (/* binding */ getItem),
/* harmony export */   d: () => (/* binding */ getItemGroups),
/* harmony export */   g: () => (/* binding */ getItemData),
/* harmony export */   i: () => (/* binding */ isEditableItem)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




const getHydratedItem = async (itemId, portal) => {
    try {
        const item = await (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.r)(getItemUrl(itemId, portal), portal);
        // TODO: check if we still need to do this
        // if (isHostedService(item.typeKeywords, item.type)) {
        //   const itemData = getItemData(item.id, portal);
        //   return { result: { ...item, ...itemInfo, ...itemData } };
        // }
        return { result: item };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const getItemDataUrl = (itemId, portal) => `${getItemUrl(itemId, portal)}/data`;
const getItemData = async (itemId, portal) => {
    return (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.r)(getItemDataUrl(itemId, portal), portal);
};
// TODO: remove these once we figure out how to efficiently disable the toast on the Home App
const getItemUrl = (itemId, portal) => `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}`;
const getItem = async (itemId, portal, requestOptions) => {
    try {
        const url = getItemUrl(itemId, portal);
        return await (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.r)(url, portal, requestOptions);
    }
    catch (error) {
        console.warn(error);
    }
};
const getItemGroups = async (itemId, portal) => {
    try {
        const url = `${getItemUrl(itemId, portal)}/groups`;
        return { result: await (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.r)(url, portal) };
    }
    catch (error) {
        // TODO: handle error
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const isEditableItem = async (item, portal) => {
    let isEditable = false;
    if ((0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.i)(item.typeKeywords, item.type)) {
        isEditable = await hasEditingCapability(item.url, portal);
    }
    return isEditable;
};
const hasEditingCapability = async (layerUrl, portal, requiredNoToken = false) => {
    var _a, _b, _c;
    if (layerUrl) {
        try {
            const result = await (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${(_a = (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_2__.p)(layerUrl)) === null || _a === void 0 ? void 0 : _a.baseServerUrl}/layers`, portal, { addTokenManually: !requiredNoToken });
            return (_b = result === null || result === void 0 ? void 0 : result.layers) === null || _b === void 0 ? void 0 : _b.reduce((memo, layer) => memo || (layer === null || layer === void 0 ? void 0 : layer.capabilities.includes("Editing")), false);
        }
        catch (error) {
            if ((_c = error === null || error === void 0 ? void 0 : error.message) === null || _c === void 0 ? void 0 : _c.toLowerCase().includes("token required")) {
                return hasEditingCapability(layerUrl, portal, true);
            }
        }
    }
    return false;
};



//# sourceMappingURL=item-c58ffced.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   H: () => (/* binding */ HIDDEN_ITEMS_QUERY)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const HIDDEN_ITEMS_QUERY = `-type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" -type:"Map Area" -typekeywords:"MapAreaPackage" -type:"Indoors Map Configuration" -typekeywords:"SMX"`;



//# sourceMappingURL=query-d62660d4.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getServiceUrlResponse),
/* harmony export */   g: () => (/* binding */ getRelatedItems),
/* harmony export */   i: () => (/* binding */ isHostedService),
/* harmony export */   r: () => (/* binding */ requestFetch)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



/** Work-around since using `request` directly will trigger unwanted toast on the Home App if the layer is unavailable */
const requestFetch = async (url, portal, options = {}) => {
    const { body, usePost, addTokenManually, api = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.api, customToken } = options;
    const data = new URLSearchParams();
    if (body) {
        Object.entries(body).forEach(([key, value]) => {
            if (value !== undefined) {
                data.append(key, value);
            }
        });
    }
    const urlToSend = new URL(url);
    urlToSend.searchParams.append("f", "json");
    if (customToken) {
        urlToSend.searchParams.append("token", customToken);
    }
    else {
        const token = addTokenManually === false ? null : await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.h)(portal, api);
        if (token) {
            urlToSend.searchParams.append("token", token);
        }
    }
    const response = await fetch(urlToSend.toString(), {
        body: usePost ? data : undefined,
        method: usePost ? "POST" : "GET"
    });
    const result = await response.json();
    const error = result.error;
    if (error) {
        throw typeof error === "string" ? new Error(error) : error;
    }
    return result;
};

/**
 * Send a request to get data for `url`. This request will not include a token to avoid token leak
 */
const getServiceUrlResponse = async (url, portal) => {
    var _a;
    try {
        return { result: await requestFetch(url, portal, { addTokenManually: false }) };
    }
    catch (error) {
        const tokenRequiredMessage = "token required";
        if ((_a = error === null || error === void 0 ? void 0 : error.message) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(tokenRequiredMessage)) {
            return { error: { code: "tokenRequired" } };
        }
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function getRelatedItems(itemId, portal, { relationshipType, direction }) {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${itemId}/relatedItems`;
    return await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { relationshipType, direction });
}

const isHostedService = (typeKeywords, type) => type === "Feature Service" && typeKeywords.includes("Hosted Service");



//# sourceMappingURL=service-8c2c4241.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ cleanSearchTerm)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function cleanSearchTerm(term = "") {
    // sanitize input if it contains html
    const sanitizedSearchTerm = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.s)(term);
    // escape question marks, angle brackets, square brackets, etc
    const escapedTerm = sanitizedSearchTerm.replace(/[<>\/\\[\]\?]/g, "\\$&");
    return escapedTerm.trim();
}



//# sourceMappingURL=string-58a5fef3.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js":
/*!***************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js ***!
  \***************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getTags),
/* harmony export */   b: () => (/* binding */ getHighlights),
/* harmony export */   c: () => (/* binding */ cleanFilters),
/* harmony export */   d: () => (/* binding */ defaultGeometries),
/* harmony export */   e: () => (/* binding */ getProvisionedListings),
/* harmony export */   f: () => (/* binding */ getDefaultThumbnail),
/* harmony export */   g: () => (/* binding */ getItemThumbnail),
/* harmony export */   h: () => (/* binding */ getAdjustedThumbnail),
/* harmony export */   i: () => (/* binding */ isPortalViewingArcGISOnline),
/* harmony export */   j: () => (/* binding */ isBlankImage),
/* harmony export */   k: () => (/* binding */ fetchPreviewItem),
/* harmony export */   q: () => (/* binding */ queryItems)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */











const defaultGeometries = ["nonspatial", "point", "polygon", "multipoint", "polyline"];
let abortController;
function getTags(response, knownTags, activeTags) {
    var _a;
    const tagCounts = {};
    (_a = response.results) === null || _a === void 0 ? void 0 : _a.forEach((item) => {
        item.tags.forEach((tag) => {
            if (tag) {
                tagCounts[tag] = (tagCounts[tag] || 0) + 1;
            }
        });
    });
    const newTags = Object.entries(tagCounts)
        .sort((a, b) => b[1] - a[1])
        .map(([tag]) => tag);
    return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.b)([...(knownTags || []), ...(newTags || []), ...(activeTags || [])]);
}
async function queryItems({ portal, query, user, store, config, allowedSubscriptionContentTypes, groupId }) {
    var _a, _b, _c, _d, _e, _f, _g;
    let restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal);
    let options = {};
    const { num, start, sortOrder, sortField, filters, baseQuery, baseFilter, searchTerm, bucket, allowedGeometries } = query;
    // if a recycle bin request is in flight, cancel it
    if (abortController === null || abortController === void 0 ? void 0 : abortController.signal) {
        abortController.abort();
    }
    if (store.state.recycleBin) {
        abortController = new AbortController();
        return bucket === "my"
            ? fetchUserRecycleBinContent({ query, portal, user })
            : fetchOrgRecycleBinContent({ query, portal });
    }
    // TODO: set the groupId(s) in the store outside of the following called functions
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/pull/4731#discussion_r1039570
    const group = groupId ||
        (bucket === "group" && ((_a = filters === null || filters === void 0 ? void 0 : filters.group) === null || _a === void 0 ? void 0 : _a.id) && ((_b = filters === null || filters === void 0 ? void 0 : filters.group) === null || _b === void 0 ? void 0 : _b.group) !== "all" && ((_c = filters === null || filters === void 0 ? void 0 : filters.group) === null || _c === void 0 ? void 0 : _c.group)) ||
        (bucket === "living atlas" && ((_d = store === null || store === void 0 ? void 0 : store.state.livingAtlasGroupId) !== null && _d !== void 0 ? _d : (await getLivingAtlasGroupId(portal, store)))) ||
        (bucket === "living atlas analysis" &&
            ((_e = store === null || store === void 0 ? void 0 : store.state.livingAtlasAnalysisGroupId) !== null && _e !== void 0 ? _e : (await getLivingAtlasAnalysisGroupId(portal, store))));
    if (bucket === "subscription content") {
        return getSubscriptionContent(portal, user, allowedSubscriptionContentTypes);
    }
    // if the portal allows it, and we're looking at the "online" bucket, use the online search endpoint
    if (await isPortalViewingArcGISOnline(portal, bucket)) {
        restBase = "https://www.arcgis.com/sharing/rest/";
        options.addTokenManually = false;
    }
    const groupPath = group ? `content/groups/${group}/` : "";
    const url = `${restBase}${groupPath}search`;
    const geometryType = getGeometryQuery(allowedGeometries, portal);
    const filterIds = Object.keys(filters || {});
    const contentArea = bucket ? await getBucketQuery({ bucket, user, portal, store, filters }) : "";
    const term = searchTerm ? `(${(0,_string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_7__.c)(searchTerm)}) ` : "";
    const enriched = !!((config === null || config === void 0 ? void 0 : config.semanticSearchEnabled) && ((_f = portal === null || portal === void 0 ? void 0 : portal.portalProperties) === null || _f === void 0 ? void 0 : _f.semanticSearchEnabled)) || (user && !user.orgId);
    const baseParams = Object.assign(Object.assign(Object.assign({}, (baseFilter ? { filter: `${baseFilter}` } : {})), (enriched ? { enriched: true } : {})), { q: `${baseQuery || ""} ${geometryType} ${contentArea} ${term} ${_query_d62660d4_js__WEBPACK_IMPORTED_MODULE_4__.H}`, displaySublayers: true, displayHighlights: true });
    const categories = [];
    const queryParams = filterIds.reduce((params, key) => {
        const { param, value, additionalParams } = filters[key];
        // discard filters from hidden buckets
        if ((bucket && key === "group" && bucket !== "group") ||
            // if we're using the group endpoint, don't also use the group id filter
            (key === "group" && groupPath) ||
            (key === "folder" && bucket !== "my") ||
            (key === "region" && !["living atlas", "living atlas analysis"].includes(bucket))) {
            return params;
        }
        if (key === "categories" && value) {
            categories.push(filters[key].category);
        }
        if (key === "region" && value) {
            categories.push(filters[key].categoryValue);
        }
        const filterParam = param === "categories" ? {} : { [param]: `${params[param] || ""} ${value}` };
        return Object.assign(Object.assign(Object.assign({}, params), filterParam), (additionalParams !== null && additionalParams !== void 0 ? additionalParams : {}));
    }, baseParams);
    const params = Object.assign(Object.assign({ num,
        start }, (sortField === "relevance"
        ? {}
        : {
            sortField,
            sortOrder
        })), (queryParams || {}));
    const categoryParam = categories.length
        ? categories.map((category) => `categories=${JSON.stringify([category])}`).join("&")
        : "";
    const divider = categories.length ? "?" : "";
    try {
        const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${url}${divider}${categoryParam}`, params, options);
        return Object.assign(Object.assign({}, response), { queryParams: params });
    }
    catch (error) {
        // really what we should do is completely remove the token from our request function
        // it's not needed and causes a lot of things to not work.
        // for a patch, though, instead we'll check for the error that should trigger the log in
        // and just disable adding the token so the jsapi will call getCredential
        if (((_g = error === null || error === void 0 ? void 0 : error.details) === null || _g === void 0 ? void 0 : _g.httpStatus) === 498 && (error === null || error === void 0 ? void 0 : error.message) === "Invalid token.") {
            const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${url}${divider}${categoryParam}`, params, Object.assign(Object.assign({}, options), { addTokenManually: false }));
            return Object.assign(Object.assign({}, response), { queryParams: params });
        }
    }
}
function getGeometryQuery(geometries, portal) {
    // if undeclared or we're using all of them, no need to query,
    // additionally, enterprise does not support sublayer indexing
    if (!geometries || geometries.length === (defaultGeometries === null || defaultGeometries === void 0 ? void 0 : defaultGeometries.length) || (portal === null || portal === void 0 ? void 0 : portal.isPortal)) {
        return "";
    }
    const types = geometries.map((geometry) => `"${geometry}"`).join(" OR ");
    return `((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${types})))`;
}
function getHighlights(response, config) {
    if (!config.deepLayerSearchEnabled) {
        return {};
    }
    const highlights = {};
    (response.highlights || []).forEach((highlight) => {
        var _a;
        const item = (_a = response.results) === null || _a === void 0 ? void 0 : _a.find((item) => item.id === highlight.id);
        if (!(item === null || item === void 0 ? void 0 : item.sublayers)) {
            return;
        }
        const highlightedFields = Object.keys(highlight)
            .filter((key) => key !== "id" && key.includes("sublayers."))
            .reduce((acc, key) => {
            acc[key.replace("sublayers.", "")] = highlight[key].map((value) => value.replaceAll("<em>", "").replaceAll("</em>", ""));
            return acc;
        }, {});
        const sublayers = item.sublayers
            .filter((sublayer) => {
            return Object.keys(sublayer).some((key) => {
                var _a;
                return (_a = highlightedFields[key]) === null || _a === void 0 ? void 0 : _a.some((value) => sublayer[key].includes(value));
            });
        })
            .map((sublayer) => sublayer.id);
        highlights[highlight.id] = Object.assign(Object.assign({}, highlight), { sublayers });
    });
    return highlights;
}
async function getLivingAtlasGroupId(portal, store) {
    var _a, _b;
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.q)(
    // We must set sort here to make sure the correct living atlas group comes first in case of multiple
    // @ts-ignore - this does exist on 4.x Portals, their types are wrong
    { q: portal.livingAtlasGroupQuery, num: 1, sortField: "title", sortOrder: "asc" }, portal);
    const id = ((_b = (_a = response.results) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.id) || "";
    // TODO: Move to set outside function to avoid side-effects / argument mutation & combine functions
    if (store) {
        store.state.livingAtlasGroupId = id;
    }
    return id;
}
async function getLivingAtlasAnalysisGroupId(portal, store) {
    var _a, _b;
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.q)({
        q: getLivingAtlasAnalysisGroupQuery(portal),
        num: 1,
        sortField: "title",
        sortOrder: "asc"
    }, portal);
    const id = ((_b = (_a = response.results) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.id) || "";
    // TODO: Move to set outside function to avoid side-effects / argument mutation & combine functions
    if (store) {
        store.state.livingAtlasAnalysisGroupId = id;
    }
    return id;
}
/**
 * Formats the correct analysis living atlas query based on portal configuration
 * @param {Portal} portal
 * @returns {string}
 */
function getLivingAtlasAnalysisGroupQuery(portal) {
    // Use `esri_livingatlas` in enterprise and `esri` in online
    const groupOwner = portal.isPortal === true ? "esri_livingatlas" : "esri";
    return `title:"Living Atlas Analysis Layers" AND owner:${groupOwner}`;
}
async function getBucketQuery({ bucket, user, portal, filters }) {
    switch (bucket) {
        case "my":
            return `owner: ${user.username}`;
        case "org":
            return `orgid:${portal.id} ${portal.isPortal ? `-owner:esri_apps` : ""}`;
        case "favorites":
            const favoritesGroupId = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_3__.e)();
            return `group: ${favoritesGroupId}`;
        case "group":
            if (!(filters === null || filters === void 0 ? void 0 : filters.group) || (filters === null || filters === void 0 ? void 0 : filters.group.group) === "all") {
                const groups = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_3__.d)();
                return `group:(${groups === null || groups === void 0 ? void 0 : groups.map(({ id }) => id).join(" OR ")})`;
            }
        default:
            return "";
    }
}
async function isPortalViewingArcGISOnline(portal, bucket) {
    var _a;
    if ((portal === null || portal === void 0 ? void 0 : portal.isPortal) && bucket === "all") {
        const settings = await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_6__.j)(portal);
        if ((_a = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties) === null || _a === void 0 ? void 0 : _a.searchArcGISOnlineEnabled) {
            return true;
        }
    }
    return false;
}
async function getProvisionedListings(user, portal) {
    if (!user || !portal) {
        return [];
    }
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.f)(async () => {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal)}community/users/${user.username}/provisionedListings`;
        return (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_6__.k)(url, {}, "provisionedListings");
    }, "provisionedListings", `${portal.id}-${user.username}`);
}
async function unwrapRelatedItems(id, portal) {
    var _a;
    const response = await (0,_service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_2__.g)(id, portal, {
        relationshipType: "Listed2ImplicitlyListed",
        direction: "forward"
    });
    return (_a = response.relatedItems) !== null && _a !== void 0 ? _a : [];
}
function filterSubscriptionContent(item, allowedSubscriptionContentTypes) {
    // by default, user will see just layers (the set used in the map viewer)
    allowedSubscriptionContentTypes !== null && allowedSubscriptionContentTypes !== void 0 ? allowedSubscriptionContentTypes : (allowedSubscriptionContentTypes = [
        "Map Service",
        "Image Service",
        "Feature Service",
        "Stream Service",
        "Vector Tile Service",
        "WMS",
        "WFS",
        "WMTS",
        "KML",
        "Feature Collection",
        "Feed"
    ]);
    return allowedSubscriptionContentTypes.includes(item.type);
}
async function getSubscriptionContent(portal, user, allowedItemTypes) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.f)(async () => {
        const listings = await getProvisionedListings(user, portal);
        if (!(listings === null || listings === void 0 ? void 0 : listings.length)) {
            return { total: 0, results: [], start: -1, num: 100, nextStart: 0 };
        }
        const ids = listings === null || listings === void 0 ? void 0 : listings.map((listing) => listing.itemId);
        const items = await Promise.all(ids.map((id) => (0,_item_c58ffced_js__WEBPACK_IMPORTED_MODULE_8__.c)(id, portal)));
        const relatedItemsArrays = await Promise.all(ids === null || ids === void 0 ? void 0 : ids.map((id) => unwrapRelatedItems(id, portal)));
        const allItems = relatedItemsArrays
            .reduce((all, relatedItems) => {
            return all.concat(relatedItems);
        }, items)
            .filter((item) => filterSubscriptionContent(item, allowedItemTypes));
        return {
            total: allItems.length,
            results: allItems,
            start: allItems.length ? 1 : 0,
            num: 100,
            nextStart: 0
        };
    }, "subscriptionContent", `${portal.id}-${user.username}`);
}
async function fetchRecycleBinContent(query, url) {
    return new Promise(async (resolve, reject) => {
        var _a;
        (_a = abortController === null || abortController === void 0 ? void 0 : abortController.signal) === null || _a === void 0 ? void 0 : _a.addEventListener("abort", () => {
            reject(new DOMException("Aborted", "AbortError"));
        });
        const { start, num, sortField, sortOrder } = query;
        const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(url, {
            foldersContent: true,
            inRecycleBin: true,
            start,
            num,
            sortField,
            sortOrder
        });
        return resolve(Object.assign(Object.assign({}, response), { results: response.items, queryParams: query }));
    });
}
async function fetchUserRecycleBinContent({ query, portal, user }) {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal)}content/users/${user.username}/`;
    return fetchRecycleBinContent(query, url);
}
async function fetchOrgRecycleBinContent({ query, portal }) {
    const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal)}content/portals/${portal.id}/`;
    return fetchRecycleBinContent(query, url);
}
async function fetchPreviewItem(item, portal, user, store) {
    var _a;
    const portalToOnline = await isPortalViewingArcGISOnline(portal, store.state.bucket);
    const url = portalToOnline
        ? `https://www.arcgis.com/sharing/rest/content/items/${item.id}`
        : (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_9__.g)(item.id, portal);
    const options = portalToOnline || !user ? { disableIdentityLookup: true, addTokenManually: false } : {};
    try {
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(url, {}, options) };
    }
    catch (error) {
        if (((_a = error === null || error === void 0 ? void 0 : error.details) === null || _a === void 0 ? void 0 : _a.messageCode) === "SB_0005") {
            return { error: { code: "disabledSubscription" } };
        }
    }
    return { error: { code: "unhandledError" } };
}
function cleanFilters(filters, bucket) {
    const cleanFilters = Object.assign({}, filters);
    if (bucket !== "my") {
        delete cleanFilters.folder;
    }
    if (bucket !== "group") {
        delete cleanFilters.group;
    }
    return cleanFilters;
}

function getItemThumbnail(portal, item, restBase, noToken) {
    restBase !== null && restBase !== void 0 ? restBase : (restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(portal));
    const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.e)(portal);
    const tokenParam = token && !noToken ? `token=${token}` : "";
    const itemUrl = `${restBase}content/items/${item.id}`;
    // @ts-ignore - the 4.x api _does_ include this property
    if (item.thumbnail) {
        // 4.x items have a thumbnail url which includes the token, so just use that
        if (item.thumbnailUrl) {
            return item.thumbnailUrl;
        }
        return `${itemUrl}/info/${item.thumbnail}?w=400${token ? "&" : ""}${tokenParam}`;
    }
    else if (item.type === "Image" && !noToken) {
        return `${itemUrl}/data?${tokenParam}`;
    }
    return getDefaultThumbnail(item);
}
/** This is just like getItemThumbnail but it will use an arcgis.com base in certain portal conditions */
async function getAdjustedThumbnail(portal, item, bucket) {
    if (await isPortalViewingArcGISOnline(portal, bucket)) {
        return getItemThumbnail(portal, item, "https://www.arcgis.com/sharing/rest/", true);
    }
    return getItemThumbnail(portal, item);
}
function getDefaultThumbnail(item) {
    var _a;
    const fileName = ((_a = item.type) === null || _a === void 0 ? void 0 : _a.toLowerCase()) !== "notebook" ? "default_thumb.png" : "notebook-thumb.png";
    return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/arcgis-item-browser-card-thumbnail/${fileName}`);
}
/**
 * Checks if the given image is blank.
 * Drawing the image on canvas, get the image data,
 * generate a hash and compare this against a known blank hash.
 */
function isBlankImage(image) {
    if (!image) {
        return true;
    }
    const canvas = document.createElement("canvas");
    const context = canvas.getContext("2d");
    canvas.height = image.naturalHeight;
    canvas.width = image.naturalWidth;
    context.fillStyle = "#ffffff";
    context.fillRect(0, 0, image.naturalWidth, image.naturalHeight);
    const blank = canvas.toDataURL("image/jpeg");
    context.drawImage(image, 0, 0);
    return blank === canvas.toDataURL("image/jpeg");
}



//# sourceMappingURL=thumbnail-bcb89e69.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getFolderFromId),
/* harmony export */   b: () => (/* binding */ getHomeFolderForUser),
/* harmony export */   c: () => (/* binding */ createFolder),
/* harmony export */   d: () => (/* binding */ getSignedInUsersGroups),
/* harmony export */   e: () => (/* binding */ getSignedInUsersFavoritesGroup),
/* harmony export */   f: () => (/* binding */ fetchUser),
/* harmony export */   g: () => (/* binding */ getFolders),
/* harmony export */   u: () => (/* binding */ updateFolder)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



async function fetchUser(username, portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/users/${username}`);
}
async function fetchSelf() {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)()}/community/self`);
}
async function getSignedInUsersGroups() {
    var _a;
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return [];
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return (_a = self === null || self === void 0 ? void 0 : self.groups) !== null && _a !== void 0 ? _a : [];
}
async function getSignedInUsersFavoritesGroup() {
    const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
    if (!user) {
        return null;
    }
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(() => fetchSelf(), "communitySelf", user.username);
    return self.favGroupId;
}
function getUserContentUrl(user, portal) {
    var _a;
    return (_a = user === null || user === void 0 ? void 0 : user.userContentUrl) !== null && _a !== void 0 ? _a : `${portal === null || portal === void 0 ? void 0 : portal.restUrl}/content/users/${user.username}`;
}
async function getUserContent(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal;
    const url = getUserContentUrl(user, portal);
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { num: 1 });
    return Promise.resolve(response);
}
async function getFolders(portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const { folders } = await getUserContent(user);
    const { username } = user;
    const sortedFolders = folders.sort((a, b) => a.title.localeCompare(b.title));
    // add the home folder as if it's in the list
    return [{ username, id: username, title: username, created: "now" }, ...sortedFolders];
}
async function getFolderFromId(folderId, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const folders = await getFolders(user);
    return folders.find((folder) => folder.id === folderId);
}
function getHomeFolderForUser(username) {
    return { username, id: username, title: username, created: "now" };
}
async function createFolder(folderName, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/createFolder`;
    const folderResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { title: folderName }, {}, "post");
    return folderResponse;
}
async function updateFolder(id, newTitle, portalUser) {
    var _a;
    const user = (_a = portalUser !== null && portalUser !== void 0 ? portalUser : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.user;
    const url = `${getUserContentUrl(user, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal)}/${id}/updateFolder`;
    try {
        const result = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { newTitle }, {}, "post");
        return { result };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=user-3ea69c3a.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fZ3VpZC1hLWEzMmM4OS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMwRjtBQUNsQzs7QUFFeEQ7QUFDQTtBQUNBLHNCQUFzQixzREFBYztBQUNwQztBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsVUFBVTtBQUM3QixXQUFXLHNEQUFTO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHNEQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixVQUFVO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esc0JBQXNCLHNEQUFjO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixVQUFVLGdCQUFnQixPQUFPO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxlQUFlLEVBQUUsa0RBQVc7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU8sRUFBRSxrREFBVztBQUNoQyxtQkFBbUIsc0RBQWMsR0FBRyxrQkFBa0IsY0FBYztBQUNwRTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFNBQVMsRUFBRSxrREFBVztBQUNsQyxtQkFBbUIsc0RBQWMsR0FBRyxVQUFVLFVBQVU7QUFDeEQsMEJBQTBCLHNCQUFzQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FB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QUFDdkU7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLGtEQUFXLHdDQUF3QyxrREFBVztBQUNqSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxtRkFBbUYsa0RBQVcsd0NBQXdDLGtEQUFXO0FBQ2pKLG1CQUFtQix3QkFBd0Isa0RBQVcsU0FBUztBQUMvRCxpQ0FBaUMsc0RBQU8sUUFBUSxtQkFBbUIsSUFBSTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRixrREFBVyx3Q0FBd0Msa0RBQVc7QUFDakosbUJBQW1CLHdCQUF3QixrREFBVyxTQUFTLEdBQUcsR0FBRztBQUNyRTtBQUNBLDZCQUE2QixzREFBTyxRQUFRLFVBQVUsSUFBSTtBQUMxRCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQixTQUFTO0FBQzFCO0FBQ0E7O0FBRW9NOztBQUVwTSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwaS0yZTNhMTM2Zi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9ndWlkLWFlYWVkODRkLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tYzU4ZmZjZWQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vcXVlcnktZDYyNjYwZDQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc2VydmljZS04YzJjNDI0MS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdHJpbmctNThhNWZlZjMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdGh1bWJuYWlsLWJjYjg5ZTY5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3VzZXItM2VhNjljM2EuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlc3RCYXNlVXJsLCBlIGFzIGdldFRva2VuLCBmIGFzIGZyb21DYWNoZSB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5cbmNvbnN0IGFwcFN3aXRjaGVyQ29uZmlnSXRlbVF1ZXJ5ID0gYG93bmVyOlwiZXNyaVwiIEFORCB0aXRsZTpcIkFwcFN3aXRjaGVyIENvbmZpZ1wiIEFORCB0eXBlOiBcIkFwcGxpY2F0aW9uIENvbmZpZ3VyYXRpb25cImA7XG5hc3luYyBmdW5jdGlvbiBnZXRQb3J0YWxTZXR0aW5ncyhwb3J0YWwpIHtcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGlmICghcG9ydGFsVXJsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gYCR7cG9ydGFsVXJsfXBvcnRhbHMvc2VsZi9zZXR0aW5nc2A7XG4gICAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiByZXF1ZXN0KHVybCksIFwicG9ydGFsU2V0dGluZ3NcIiwgcG9ydGFsVXJsKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNob3dJbkFwcExhdW5jaGVyKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGdldFBvcnRhbFNldHRpbmdzKCk7XG4gICAgcmV0dXJuICgoX2EgPSBzZXR0aW5ncyA9PT0gbnVsbCB8fCBzZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2V0dGluZ3MucG9ydGFsQ29uZmlnUHJvcGVydGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNob3dJbkFwcExhdW5jaGVyKSB8fCBbXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcFN3aXRjaGVyQ29uZmlnSXRlbSgpIHtcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybCgpO1xuICAgIGlmICghcG9ydGFsVXJsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gYCR7cG9ydGFsVXJsfXNlYXJjaGA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB7XG4gICAgICAgIG51bTogMSxcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHNvcnRGaWVsZDogXCJ0aXRsZVwiLFxuICAgICAgICBzb3J0T3JkZXI6IFwiYXNjXCIsXG4gICAgICAgIHE6IGFwcFN3aXRjaGVyQ29uZmlnSXRlbVF1ZXJ5XG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRDb25maWdEYXRhKGl0ZW1JZCkge1xuICAgIGNvbnN0IHBvcnRhbFVybCA9IGdldFJlc3RCYXNlVXJsKCk7XG4gICAgaWYgKCFwb3J0YWxVcmwgfHwgIWl0ZW1JZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHVybCA9IGAke3BvcnRhbFVybH1jb250ZW50L2l0ZW1zLyR7aXRlbUlkfS9kYXRhYDtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0QXBwU3dpdGNoZXJDb25maWcoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBpZiAoIShwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaWQpIHx8ICF1c2VyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0QXBwU3dpdGNoZXJDb25maWdJdGVtKCk7XG4gICAgY29uc3QgaXRlbSA9IChfYSA9IHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgaWYgKCFpdGVtKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXRlbUlkID0gaXRlbS5pZDtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0Q29uZmlnRGF0YShpdGVtSWQpO1xuICAgIHJldHVybiBkYXRhO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlclByb3BlcnRpZXMoKSB7XG4gICAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfWNvbW11bml0eS91c2Vycy8ke3VzZXIudXNlcm5hbWV9L3Byb3BlcnRpZXNgO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRBcHByb3ZlZEFwcHMoKSB7XG4gICAgY29uc3QgeyBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vYXBwcm92ZWRBcHBzYDtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIHsgcmV0dXJuQWxsQXBwczogZmFsc2UgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEFsbFJlc291cmNlcyh1cmwsIGNvbnRlbnQsIHJlc291cmNlS2V5ID0gXCJyZXN1bHRzXCIpIHtcbiAgICBjb25zdCBtYXggPSAxMDA7XG4gICAgbGV0IHN0YXJ0ID0gMTtcbiAgICBsZXQgcmVzb3VyY2VzID0gW107XG4gICAgbGV0IHRvdGFsTGVmdDtcbiAgICBsZXQgbnVtUmVxdWVzdHM7XG4gICAgbGV0IHByb21pc2VzO1xuICAgIGxldCBpO1xuICAgIGNvbnRlbnQuc3RhcnQgPSBzdGFydDtcbiAgICBpZiAoIWNvbnRlbnQubnVtKSB7XG4gICAgICAgIGNvbnRlbnQubnVtID0gbWF4O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0KHVybCwgY29udGVudCk7XG4gICAgICAgIGlmICghKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdFtyZXNvdXJjZUtleV0pKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgICAgICB9XG4gICAgICAgIHJlc291cmNlcyA9IFsuLi5yZXNvdXJjZXMsIC4uLnJlc3VsdFtyZXNvdXJjZUtleV1dO1xuICAgICAgICAvLyBjYWxjdWxhdGUgd2hldGhlciBmdXJ0aGVyIGJhdGNoZXMgYXJlIG5lZWRlZFxuICAgICAgICBzdGFydCA9IHJlc3VsdC5uZXh0U3RhcnQ7XG4gICAgICAgIHRvdGFsTGVmdCA9IHJlc3VsdC50b3RhbCAtIHJlc291cmNlcy5sZW5ndGg7XG4gICAgICAgIG51bVJlcXVlc3RzID0gTWF0aC5jZWlsKHRvdGFsTGVmdCAvIG1heCk7XG4gICAgICAgIHByb21pc2VzID0gW107XG4gICAgICAgIC8vIHJlcXVlc3QgZWFjaCBuZWNlc3NhcnkgYmF0Y2hcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bVJlcXVlc3RzOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnRlbnQuc3RhcnQgPSBzdGFydCArIGkgKiBtYXg7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHJlcXVlc3QodXJsLCBjb250ZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHIpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvdXJjZXMgPSBbLi4ucmVzb3VyY2VzLCAuLi5yW3Jlc291cmNlS2V5XV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZXM7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChfYikge1xuICAgICAgICByZXR1cm4gcmVzb3VyY2VzO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGdldE1hcmtldFBsYWNlUHJvdmlzaW9uZWRMaXN0aW5ncygpIHtcbiAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9Y29tbXVuaXR5L3VzZXJzLyR7dXNlci51c2VybmFtZX0vcHJvdmlzaW9uZWRMaXN0aW5nc2A7XG4gICAgcmV0dXJuIGZldGNoQWxsUmVzb3VyY2VzKHVybCwgeyByZXR1cm5BcHBDbGllbnRJZHM6IHRydWUsIHJldHVybkFsbFByb3Zpc2lvbnM6IHRydWUgfSwgXCJwcm92aXNpb25lZExpc3RpbmdzXCIpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0T3JnQ2FwYWJpbGl0aWVzKCkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy9zZWxmL3N1YnNjcmlwdGlvbkluZm9gO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh1cmwpO1xuICAgICAgICByZXR1cm4gKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5vcmdDYXBhYmlsaXRpZXMpIHx8IFtdO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5QXBwSXRlbXNGb3JDaGFuZ2VzKGFwcHJvdmVkQXBwcywgcnVuUXVlcnkpIHtcbiAgICBpZiAoIXJ1blF1ZXJ5IHx8ICEoYXBwcm92ZWRBcHBzID09PSBudWxsIHx8IGFwcHJvdmVkQXBwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwcm92ZWRBcHBzLmxlbmd0aCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfXNlYXJjaGA7XG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCB7XG4gICAgICAgIG51bTogMTAwLFxuICAgICAgICBxOiBgaWQ6KCR7YXBwcm92ZWRBcHBzLm1hcCgoYSkgPT4gYFwiJHthLml0ZW1JZH1cImApLmpvaW4oXCIgT1IgXCIpfSlgXG4gICAgfSk7XG59XG5jb25zdCBibG9ja2VkQXBwc0NvbmZpZ0l0ZW1RdWVyeSA9IGBvd25lcjpcImVzcmlcIiBBTkQgdGl0bGU6XCJCbG9ja2VkQXBwcyBDb25maWdcIiBBTkQgdHlwZTogXCJBcHBsaWNhdGlvbiBDb25maWd1cmF0aW9uXCJgO1xuYXN5bmMgZnVuY3Rpb24gZ2V0QmxvY2thYmxlQXBwcygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9c2VhcmNoYDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCB7XG4gICAgICAgICAgICBudW06IDEwLFxuICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICBzb3J0RmllbGQ6IFwidGl0bGVcIixcbiAgICAgICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIixcbiAgICAgICAgICAgIHE6IGJsb2NrZWRBcHBzQ29uZmlnSXRlbVF1ZXJ5XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbUlkID0gKChfYiA9IChfYSA9IHJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlkKSB8fCBcIlwiO1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0Q29uZmlnRGF0YShpdGVtSWQpO1xuICAgICAgICByZXR1cm4gKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5ibG9ja2VkQXBwcykgfHwgW107XG4gICAgfVxuICAgIGNhdGNoIChfYykge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVycygpIHtcbiAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybCgpfXBvcnRhbHMvc2VsZi9zZXJ2ZXJzYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsKTtcbiAgICByZXR1cm4gKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zZXJ2ZXJzKSB8fCBbXTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNpZ25pblNldHRpbmdzKCkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKCl9cG9ydGFscy9zZWxmL3NpZ25pblNldHRpbmdzYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsKTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5mdW5jdGlvbiBnZXRVcmwocGF0aCkge1xuICAgIGxldCBwb3J0YWxVcmwgPSBnZXRSZXN0QmFzZVVybCgpO1xuICAgIGlmIChwb3J0YWxVcmwuc2xpY2UoLTEpICE9PSBcIi9cIikge1xuICAgICAgICBwb3J0YWxVcmwgKz0gXCIvXCI7XG4gICAgfVxuICAgIHJldHVybiBgJHtwb3J0YWxVcmx9JHtwYXRofWA7XG59XG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0KHVybCwgcGFyYW1zKSB7XG4gICAgaWYgKCFwYXJhbXMpIHtcbiAgICAgICAgcGFyYW1zID0ge307XG4gICAgfVxuICAgIHBhcmFtcy5mID0gXCJqc29uXCI7XG4gICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgIGlmICh0b2tlbikge1xuICAgICAgICBwYXJhbXMudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwpO1xuICAgIE9iamVjdC5rZXlzKHBhcmFtcykuZm9yRWFjaCgoa2V5KSA9PiB1cmxPYmouc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHBhcmFtc1trZXldKSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmxPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4gcmVzcG9uc2VEYXRhO1xufVxuYXN5bmMgZnVuY3Rpb24gcG9zdFJlcXVlc3QodXJsLCBkYXRhKSB7XG4gICAgZGF0YS5hcHBlbmQoXCJmXCIsIFwianNvblwiKTtcbiAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKCk7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICAgIGRhdGEuYXBwZW5kKFwidG9rZW5cIiwgdG9rZW4pO1xuICAgIH1cbiAgICBmZXRjaCh1cmwsIHsgbWV0aG9kOiBcIlBPU1RcIiwgYm9keTogZGF0YSB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVVzZXJQcm9wZXJ0aWVzKHByb3BlcnRpZXMpIHtcbiAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHVybCA9IGdldFVybChgY29tbXVuaXR5L3VzZXJzLyR7dXNlci51c2VybmFtZX0vc2V0UHJvcGVydGllc2ApO1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBkYXRhLmFwcGVuZChcInByb3BlcnRpZXNcIiwgSlNPTi5zdHJpbmdpZnkocHJvcGVydGllcykpO1xuICAgIHJldHVybiBwb3N0UmVxdWVzdCh1cmwsIGRhdGEpO1xufVxuXG5leHBvcnQgeyBnZXRBcHBTd2l0Y2hlckNvbmZpZyBhcyBhLCBnZXRNYXJrZXRQbGFjZVByb3Zpc2lvbmVkTGlzdGluZ3MgYXMgYiwgZ2V0VXNlclByb3BlcnRpZXMgYXMgYywgZ2V0QXBwcm92ZWRBcHBzIGFzIGQsIGdldE9yZ0NhcGFiaWxpdGllcyBhcyBlLCBnZXRTaWduaW5TZXR0aW5ncyBhcyBmLCBnZXRTaG93SW5BcHBMYXVuY2hlciBhcyBnLCBnZXRCbG9ja2FibGVBcHBzIGFzIGgsIGdldFNlcnZlcnMgYXMgaSwgZ2V0UG9ydGFsU2V0dGluZ3MgYXMgaiwgZmV0Y2hBbGxSZXNvdXJjZXMgYXMgaywgcXVlcnlBcHBJdGVtc0ZvckNoYW5nZXMgYXMgcSwgdXBkYXRlVXNlclByb3BlcnRpZXMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcGktMmUzYTEzNmYuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5mdW5jdGlvbiBnZW5lcmF0ZUlkKGNvdW50cykge1xuICAgIHJldHVybiBjb3VudHNcbiAgICAgICAgLm1hcCgoY291bnQpID0+IHtcbiAgICAgICAgbGV0IG91dCA9IFwiXCI7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgb3V0ICs9ICgoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH0pXG4gICAgICAgIC5qb2luKFwiLVwiKTtcbn1cbmNvbnN0IGd1aWQgPSAoKSA9PiBnZW5lcmF0ZUlkKFsyLCAxLCAxLCAxLCAzXSk7XG5cbmV4cG9ydCB7IGd1aWQgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ndWlkLWFlYWVkODRkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGkgYXMgaXNIb3N0ZWRTZXJ2aWNlLCByIGFzIHJlcXVlc3RGZXRjaCB9IGZyb20gJy4vc2VydmljZS04YzJjNDI0MS5qcyc7XG5pbXBvcnQgeyBwIGFzIHBhcnNlQUdTU2VydmVySW5mbyB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcblxuY29uc3QgZ2V0SHlkcmF0ZWRJdGVtID0gYXN5bmMgKGl0ZW1JZCwgcG9ydGFsKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGF3YWl0IHJlcXVlc3RGZXRjaChnZXRJdGVtVXJsKGl0ZW1JZCwgcG9ydGFsKSwgcG9ydGFsKTtcbiAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgd2Ugc3RpbGwgbmVlZCB0byBkbyB0aGlzXG4gICAgICAgIC8vIGlmIChpc0hvc3RlZFNlcnZpY2UoaXRlbS50eXBlS2V5d29yZHMsIGl0ZW0udHlwZSkpIHtcbiAgICAgICAgLy8gICBjb25zdCBpdGVtRGF0YSA9IGdldEl0ZW1EYXRhKGl0ZW0uaWQsIHBvcnRhbCk7XG4gICAgICAgIC8vICAgcmV0dXJuIHsgcmVzdWx0OiB7IC4uLml0ZW0sIC4uLml0ZW1JbmZvLCAuLi5pdGVtRGF0YSB9IH07XG4gICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBpdGVtIH07XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgICB9XG59O1xuY29uc3QgZ2V0SXRlbURhdGFVcmwgPSAoaXRlbUlkLCBwb3J0YWwpID0+IGAke2dldEl0ZW1VcmwoaXRlbUlkLCBwb3J0YWwpfS9kYXRhYDtcbmNvbnN0IGdldEl0ZW1EYXRhID0gYXN5bmMgKGl0ZW1JZCwgcG9ydGFsKSA9PiB7XG4gICAgcmV0dXJuIHJlcXVlc3RGZXRjaChnZXRJdGVtRGF0YVVybChpdGVtSWQsIHBvcnRhbCksIHBvcnRhbCk7XG59O1xuLy8gVE9ETzogcmVtb3ZlIHRoZXNlIG9uY2Ugd2UgZmlndXJlIG91dCBob3cgdG8gZWZmaWNpZW50bHkgZGlzYWJsZSB0aGUgdG9hc3Qgb24gdGhlIEhvbWUgQXBwXG5jb25zdCBnZXRJdGVtVXJsID0gKGl0ZW1JZCwgcG9ydGFsKSA9PiBgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfWNvbnRlbnQvaXRlbXMvJHtpdGVtSWR9YDtcbmNvbnN0IGdldEl0ZW0gPSBhc3luYyAoaXRlbUlkLCBwb3J0YWwsIHJlcXVlc3RPcHRpb25zKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXJsID0gZ2V0SXRlbVVybChpdGVtSWQsIHBvcnRhbCk7XG4gICAgICAgIHJldHVybiBhd2FpdCByZXF1ZXN0RmV0Y2godXJsLCBwb3J0YWwsIHJlcXVlc3RPcHRpb25zKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihlcnJvcik7XG4gICAgfVxufTtcbmNvbnN0IGdldEl0ZW1Hcm91cHMgPSBhc3luYyAoaXRlbUlkLCBwb3J0YWwpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHtnZXRJdGVtVXJsKGl0ZW1JZCwgcG9ydGFsKX0vZ3JvdXBzYDtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBhd2FpdCByZXF1ZXN0RmV0Y2godXJsLCBwb3J0YWwpIH07XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBUT0RPOiBoYW5kbGUgZXJyb3JcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmNvbnN0IGlzRWRpdGFibGVJdGVtID0gYXN5bmMgKGl0ZW0sIHBvcnRhbCkgPT4ge1xuICAgIGxldCBpc0VkaXRhYmxlID0gZmFsc2U7XG4gICAgaWYgKGlzSG9zdGVkU2VydmljZShpdGVtLnR5cGVLZXl3b3JkcywgaXRlbS50eXBlKSkge1xuICAgICAgICBpc0VkaXRhYmxlID0gYXdhaXQgaGFzRWRpdGluZ0NhcGFiaWxpdHkoaXRlbS51cmwsIHBvcnRhbCk7XG4gICAgfVxuICAgIHJldHVybiBpc0VkaXRhYmxlO1xufTtcbmNvbnN0IGhhc0VkaXRpbmdDYXBhYmlsaXR5ID0gYXN5bmMgKGxheWVyVXJsLCBwb3J0YWwsIHJlcXVpcmVkTm9Ub2tlbiA9IGZhbHNlKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgaWYgKGxheWVyVXJsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXF1ZXN0RmV0Y2goYCR7KF9hID0gcGFyc2VBR1NTZXJ2ZXJJbmZvKGxheWVyVXJsKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmJhc2VTZXJ2ZXJVcmx9L2xheWVyc2AsIHBvcnRhbCwgeyBhZGRUb2tlbk1hbnVhbGx5OiAhcmVxdWlyZWROb1Rva2VuIH0pO1xuICAgICAgICAgICAgcmV0dXJuIChfYiA9IHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC5sYXllcnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZWR1Y2UoKG1lbW8sIGxheWVyKSA9PiBtZW1vIHx8IChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIuY2FwYWJpbGl0aWVzLmluY2x1ZGVzKFwiRWRpdGluZ1wiKSksIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICgoX2MgPSBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJ0b2tlbiByZXF1aXJlZFwiKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXNFZGl0aW5nQ2FwYWJpbGl0eShsYXllclVybCwgcG9ydGFsLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5leHBvcnQgeyBnZXRIeWRyYXRlZEl0ZW0gYXMgYSwgZ2V0SXRlbURhdGFVcmwgYXMgYiwgZ2V0SXRlbSBhcyBjLCBnZXRJdGVtR3JvdXBzIGFzIGQsIGdldEl0ZW1EYXRhIGFzIGcsIGlzRWRpdGFibGVJdGVtIGFzIGkgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS1jNThmZmNlZC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IEhJRERFTl9JVEVNU19RVUVSWSA9IGAtdHlwZTpcIkNvZGUgQXR0YWNobWVudFwiIC10eXBlOlwiRmVhdHVyZWQgSXRlbXNcIiAtdHlwZTpcIlN5bWJvbCBTZXRcIiAtdHlwZTpcIkNvbG9yIFNldFwiIC10eXBlOlwiV2luZG93cyBWaWV3ZXIgQWRkIEluXCIgLXR5cGU6XCJXaW5kb3dzIFZpZXdlciBDb25maWd1cmF0aW9uXCIgLXR5cGU6XCJNYXAgQXJlYVwiIC10eXBla2V5d29yZHM6XCJNYXBBcmVhUGFja2FnZVwiIC10eXBlOlwiSW5kb29ycyBNYXAgQ29uZmlndXJhdGlvblwiIC10eXBla2V5d29yZHM6XCJTTVhcImA7XG5cbmV4cG9ydCB7IEhJRERFTl9JVEVNU19RVUVSWSBhcyBIIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXF1ZXJ5LWQ2MjY2MGQ0LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgaCBhcyBnZXRQb3J0YWxUb2tlbiwgciBhcyByZXF1ZXN0LCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcblxuLyoqIFdvcmstYXJvdW5kIHNpbmNlIHVzaW5nIGByZXF1ZXN0YCBkaXJlY3RseSB3aWxsIHRyaWdnZXIgdW53YW50ZWQgdG9hc3Qgb24gdGhlIEhvbWUgQXBwIGlmIHRoZSBsYXllciBpcyB1bmF2YWlsYWJsZSAqL1xuY29uc3QgcmVxdWVzdEZldGNoID0gYXN5bmMgKHVybCwgcG9ydGFsLCBvcHRpb25zID0ge30pID0+IHtcbiAgICBjb25zdCB7IGJvZHksIHVzZVBvc3QsIGFkZFRva2VuTWFudWFsbHksIGFwaSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5hcGksIGN1c3RvbVRva2VuIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgaWYgKGJvZHkpIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoYm9keSkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdXJsVG9TZW5kID0gbmV3IFVSTCh1cmwpO1xuICAgIHVybFRvU2VuZC5zZWFyY2hQYXJhbXMuYXBwZW5kKFwiZlwiLCBcImpzb25cIik7XG4gICAgaWYgKGN1c3RvbVRva2VuKSB7XG4gICAgICAgIHVybFRvU2VuZC5zZWFyY2hQYXJhbXMuYXBwZW5kKFwidG9rZW5cIiwgY3VzdG9tVG9rZW4pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBhZGRUb2tlbk1hbnVhbGx5ID09PSBmYWxzZSA/IG51bGwgOiBhd2FpdCBnZXRQb3J0YWxUb2tlbihwb3J0YWwsIGFwaSk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdXJsVG9TZW5kLnNlYXJjaFBhcmFtcy5hcHBlbmQoXCJ0b2tlblwiLCB0b2tlbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmxUb1NlbmQudG9TdHJpbmcoKSwge1xuICAgICAgICBib2R5OiB1c2VQb3N0ID8gZGF0YSA6IHVuZGVmaW5lZCxcbiAgICAgICAgbWV0aG9kOiB1c2VQb3N0ID8gXCJQT1NUXCIgOiBcIkdFVFwiXG4gICAgfSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIGNvbnN0IGVycm9yID0gcmVzdWx0LmVycm9yO1xuICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBuZXcgRXJyb3IoZXJyb3IpIDogZXJyb3I7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG4vKipcbiAqIFNlbmQgYSByZXF1ZXN0IHRvIGdldCBkYXRhIGZvciBgdXJsYC4gVGhpcyByZXF1ZXN0IHdpbGwgbm90IGluY2x1ZGUgYSB0b2tlbiB0byBhdm9pZCB0b2tlbiBsZWFrXG4gKi9cbmNvbnN0IGdldFNlcnZpY2VVcmxSZXNwb25zZSA9IGFzeW5jICh1cmwsIHBvcnRhbCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3RGZXRjaCh1cmwsIHBvcnRhbCwgeyBhZGRUb2tlbk1hbnVhbGx5OiBmYWxzZSB9KSB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgdG9rZW5SZXF1aXJlZE1lc3NhZ2UgPSBcInRva2VuIHJlcXVpcmVkXCI7XG4gICAgICAgIGlmICgoX2EgPSBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModG9rZW5SZXF1aXJlZE1lc3NhZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInRva2VuUmVxdWlyZWRcIiB9IH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmFzeW5jIGZ1bmN0aW9uIGdldFJlbGF0ZWRJdGVtcyhpdGVtSWQsIHBvcnRhbCwgeyByZWxhdGlvbnNoaXBUeXBlLCBkaXJlY3Rpb24gfSkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC9pdGVtcy8ke2l0ZW1JZH0vcmVsYXRlZEl0ZW1zYDtcbiAgICByZXR1cm4gYXdhaXQgcmVxdWVzdCh1cmwsIHsgcmVsYXRpb25zaGlwVHlwZSwgZGlyZWN0aW9uIH0pO1xufVxuXG5jb25zdCBpc0hvc3RlZFNlcnZpY2UgPSAodHlwZUtleXdvcmRzLCB0eXBlKSA9PiB0eXBlID09PSBcIkZlYXR1cmUgU2VydmljZVwiICYmIHR5cGVLZXl3b3Jkcy5pbmNsdWRlcyhcIkhvc3RlZCBTZXJ2aWNlXCIpO1xuXG5leHBvcnQgeyBnZXRTZXJ2aWNlVXJsUmVzcG9uc2UgYXMgYSwgZ2V0UmVsYXRlZEl0ZW1zIGFzIGcsIGlzSG9zdGVkU2VydmljZSBhcyBpLCByZXF1ZXN0RmV0Y2ggYXMgciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2aWNlLThjMmM0MjQxLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgcyBhcyBzYW5pdGl6ZUhUTUwgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmZ1bmN0aW9uIGNsZWFuU2VhcmNoVGVybSh0ZXJtID0gXCJcIikge1xuICAgIC8vIHNhbml0aXplIGlucHV0IGlmIGl0IGNvbnRhaW5zIGh0bWxcbiAgICBjb25zdCBzYW5pdGl6ZWRTZWFyY2hUZXJtID0gc2FuaXRpemVIVE1MKHRlcm0pO1xuICAgIC8vIGVzY2FwZSBxdWVzdGlvbiBtYXJrcywgYW5nbGUgYnJhY2tldHMsIHNxdWFyZSBicmFja2V0cywgZXRjXG4gICAgY29uc3QgZXNjYXBlZFRlcm0gPSBzYW5pdGl6ZWRTZWFyY2hUZXJtLnJlcGxhY2UoL1s8PlxcL1xcXFxbXFxdXFw/XS9nLCBcIlxcXFwkJlwiKTtcbiAgICByZXR1cm4gZXNjYXBlZFRlcm0udHJpbSgpO1xufVxuXG5leHBvcnQgeyBjbGVhblNlYXJjaFRlcm0gYXMgYyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdHJpbmctNThhNWZlZjMuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRSZXN0QmFzZVVybCwgciBhcyByZXF1ZXN0LCBmIGFzIGZyb21DYWNoZSwgcSBhcyBxdWVyeUdyb3VwcywgZSBhcyBnZXRUb2tlbiB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UmVsYXRlZEl0ZW1zIH0gZnJvbSAnLi9zZXJ2aWNlLThjMmM0MjQxLmpzJztcbmltcG9ydCB7IGQgYXMgZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcywgZSBhcyBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAgfSBmcm9tICcuL3VzZXItM2VhNjljM2EuanMnO1xuaW1wb3J0IHsgSCBhcyBISURERU5fSVRFTVNfUVVFUlkgfSBmcm9tICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCB7IGIgYXMgdW5pcXVlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGogYXMgZ2V0UG9ydGFsU2V0dGluZ3MsIGsgYXMgZmV0Y2hBbGxSZXNvdXJjZXMgfSBmcm9tICcuL2FwaS0yZTNhMTM2Zi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsZWFuU2VhcmNoVGVybSB9IGZyb20gJy4vc3RyaW5nLTU4YTVmZWYzLmpzJztcbmltcG9ydCB7IGMgYXMgZ2V0SXRlbSB9IGZyb20gJy4vaXRlbS1jNThmZmNlZC5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEl0ZW1VcmwgfSBmcm9tICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcblxuY29uc3QgZGVmYXVsdEdlb21ldHJpZXMgPSBbXCJub25zcGF0aWFsXCIsIFwicG9pbnRcIiwgXCJwb2x5Z29uXCIsIFwibXVsdGlwb2ludFwiLCBcInBvbHlsaW5lXCJdO1xubGV0IGFib3J0Q29udHJvbGxlcjtcbmZ1bmN0aW9uIGdldFRhZ3MocmVzcG9uc2UsIGtub3duVGFncywgYWN0aXZlVGFncykge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB0YWdDb3VudHMgPSB7fTtcbiAgICAoX2EgPSByZXNwb25zZS5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtLnRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnQ291bnRzW3RhZ10gPSAodGFnQ291bnRzW3RhZ10gfHwgMCkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBjb25zdCBuZXdUYWdzID0gT2JqZWN0LmVudHJpZXModGFnQ291bnRzKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXG4gICAgICAgIC5tYXAoKFt0YWddKSA9PiB0YWcpO1xuICAgIHJldHVybiB1bmlxdWUoWy4uLihrbm93blRhZ3MgfHwgW10pLCAuLi4obmV3VGFncyB8fCBbXSksIC4uLihhY3RpdmVUYWdzIHx8IFtdKV0pO1xufVxuYXN5bmMgZnVuY3Rpb24gcXVlcnlJdGVtcyh7IHBvcnRhbCwgcXVlcnksIHVzZXIsIHN0b3JlLCBjb25maWcsIGFsbG93ZWRTdWJzY3JpcHRpb25Db250ZW50VHlwZXMsIGdyb3VwSWQgfSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZztcbiAgICBsZXQgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGxldCBvcHRpb25zID0ge307XG4gICAgY29uc3QgeyBudW0sIHN0YXJ0LCBzb3J0T3JkZXIsIHNvcnRGaWVsZCwgZmlsdGVycywgYmFzZVF1ZXJ5LCBiYXNlRmlsdGVyLCBzZWFyY2hUZXJtLCBidWNrZXQsIGFsbG93ZWRHZW9tZXRyaWVzIH0gPSBxdWVyeTtcbiAgICAvLyBpZiBhIHJlY3ljbGUgYmluIHJlcXVlc3QgaXMgaW4gZmxpZ2h0LCBjYW5jZWwgaXRcbiAgICBpZiAoYWJvcnRDb250cm9sbGVyID09PSBudWxsIHx8IGFib3J0Q29udHJvbGxlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWJvcnRDb250cm9sbGVyLnNpZ25hbCkge1xuICAgICAgICBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9XG4gICAgaWYgKHN0b3JlLnN0YXRlLnJlY3ljbGVCaW4pIHtcbiAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICByZXR1cm4gYnVja2V0ID09PSBcIm15XCJcbiAgICAgICAgICAgID8gZmV0Y2hVc2VyUmVjeWNsZUJpbkNvbnRlbnQoeyBxdWVyeSwgcG9ydGFsLCB1c2VyIH0pXG4gICAgICAgICAgICA6IGZldGNoT3JnUmVjeWNsZUJpbkNvbnRlbnQoeyBxdWVyeSwgcG9ydGFsIH0pO1xuICAgIH1cbiAgICAvLyBUT0RPOiBzZXQgdGhlIGdyb3VwSWQocykgaW4gdGhlIHN0b3JlIG91dHNpZGUgb2YgdGhlIGZvbGxvd2luZyBjYWxsZWQgZnVuY3Rpb25zXG4gICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL3B1bGwvNDczMSNkaXNjdXNzaW9uX3IxMDM5NTcwXG4gICAgY29uc3QgZ3JvdXAgPSBncm91cElkIHx8XG4gICAgICAgIChidWNrZXQgPT09IFwiZ3JvdXBcIiAmJiAoKF9hID0gZmlsdGVycyA9PT0gbnVsbCB8fCBmaWx0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWx0ZXJzLmdyb3VwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQpICYmICgoX2IgPSBmaWx0ZXJzID09PSBudWxsIHx8IGZpbHRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbHRlcnMuZ3JvdXApID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5ncm91cCkgIT09IFwiYWxsXCIgJiYgKChfYyA9IGZpbHRlcnMgPT09IG51bGwgfHwgZmlsdGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsdGVycy5ncm91cCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmdyb3VwKSkgfHxcbiAgICAgICAgKGJ1Y2tldCA9PT0gXCJsaXZpbmcgYXRsYXNcIiAmJiAoKF9kID0gc3RvcmUgPT09IG51bGwgfHwgc3RvcmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN0b3JlLnN0YXRlLmxpdmluZ0F0bGFzR3JvdXBJZCkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogKGF3YWl0IGdldExpdmluZ0F0bGFzR3JvdXBJZChwb3J0YWwsIHN0b3JlKSkpKSB8fFxuICAgICAgICAoYnVja2V0ID09PSBcImxpdmluZyBhdGxhcyBhbmFseXNpc1wiICYmXG4gICAgICAgICAgICAoKF9lID0gc3RvcmUgPT09IG51bGwgfHwgc3RvcmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN0b3JlLnN0YXRlLmxpdmluZ0F0bGFzQW5hbHlzaXNHcm91cElkKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAoYXdhaXQgZ2V0TGl2aW5nQXRsYXNBbmFseXNpc0dyb3VwSWQocG9ydGFsLCBzdG9yZSkpKSk7XG4gICAgaWYgKGJ1Y2tldCA9PT0gXCJzdWJzY3JpcHRpb24gY29udGVudFwiKSB7XG4gICAgICAgIHJldHVybiBnZXRTdWJzY3JpcHRpb25Db250ZW50KHBvcnRhbCwgdXNlciwgYWxsb3dlZFN1YnNjcmlwdGlvbkNvbnRlbnRUeXBlcyk7XG4gICAgfVxuICAgIC8vIGlmIHRoZSBwb3J0YWwgYWxsb3dzIGl0LCBhbmQgd2UncmUgbG9va2luZyBhdCB0aGUgXCJvbmxpbmVcIiBidWNrZXQsIHVzZSB0aGUgb25saW5lIHNlYXJjaCBlbmRwb2ludFxuICAgIGlmIChhd2FpdCBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUocG9ydGFsLCBidWNrZXQpKSB7XG4gICAgICAgIHJlc3RCYXNlID0gXCJodHRwczovL3d3dy5hcmNnaXMuY29tL3NoYXJpbmcvcmVzdC9cIjtcbiAgICAgICAgb3B0aW9ucy5hZGRUb2tlbk1hbnVhbGx5ID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGdyb3VwUGF0aCA9IGdyb3VwID8gYGNvbnRlbnQvZ3JvdXBzLyR7Z3JvdXB9L2AgOiBcIlwiO1xuICAgIGNvbnN0IHVybCA9IGAke3Jlc3RCYXNlfSR7Z3JvdXBQYXRofXNlYXJjaGA7XG4gICAgY29uc3QgZ2VvbWV0cnlUeXBlID0gZ2V0R2VvbWV0cnlRdWVyeShhbGxvd2VkR2VvbWV0cmllcywgcG9ydGFsKTtcbiAgICBjb25zdCBmaWx0ZXJJZHMgPSBPYmplY3Qua2V5cyhmaWx0ZXJzIHx8IHt9KTtcbiAgICBjb25zdCBjb250ZW50QXJlYSA9IGJ1Y2tldCA/IGF3YWl0IGdldEJ1Y2tldFF1ZXJ5KHsgYnVja2V0LCB1c2VyLCBwb3J0YWwsIHN0b3JlLCBmaWx0ZXJzIH0pIDogXCJcIjtcbiAgICBjb25zdCB0ZXJtID0gc2VhcmNoVGVybSA/IGAoJHtjbGVhblNlYXJjaFRlcm0oc2VhcmNoVGVybSl9KSBgIDogXCJcIjtcbiAgICBjb25zdCBlbnJpY2hlZCA9ICEhKChjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWcuc2VtYW50aWNTZWFyY2hFbmFibGVkKSAmJiAoKF9mID0gcG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLnBvcnRhbFByb3BlcnRpZXMpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zZW1hbnRpY1NlYXJjaEVuYWJsZWQpKSB8fCAodXNlciAmJiAhdXNlci5vcmdJZCk7XG4gICAgY29uc3QgYmFzZVBhcmFtcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAoYmFzZUZpbHRlciA/IHsgZmlsdGVyOiBgJHtiYXNlRmlsdGVyfWAgfSA6IHt9KSksIChlbnJpY2hlZCA/IHsgZW5yaWNoZWQ6IHRydWUgfSA6IHt9KSksIHsgcTogYCR7YmFzZVF1ZXJ5IHx8IFwiXCJ9ICR7Z2VvbWV0cnlUeXBlfSAke2NvbnRlbnRBcmVhfSAke3Rlcm19ICR7SElEREVOX0lURU1TX1FVRVJZfWAsIGRpc3BsYXlTdWJsYXllcnM6IHRydWUsIGRpc3BsYXlIaWdobGlnaHRzOiB0cnVlIH0pO1xuICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBbXTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IGZpbHRlcklkcy5yZWR1Y2UoKHBhcmFtcywga2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcGFyYW0sIHZhbHVlLCBhZGRpdGlvbmFsUGFyYW1zIH0gPSBmaWx0ZXJzW2tleV07XG4gICAgICAgIC8vIGRpc2NhcmQgZmlsdGVycyBmcm9tIGhpZGRlbiBidWNrZXRzXG4gICAgICAgIGlmICgoYnVja2V0ICYmIGtleSA9PT0gXCJncm91cFwiICYmIGJ1Y2tldCAhPT0gXCJncm91cFwiKSB8fFxuICAgICAgICAgICAgLy8gaWYgd2UncmUgdXNpbmcgdGhlIGdyb3VwIGVuZHBvaW50LCBkb24ndCBhbHNvIHVzZSB0aGUgZ3JvdXAgaWQgZmlsdGVyXG4gICAgICAgICAgICAoa2V5ID09PSBcImdyb3VwXCIgJiYgZ3JvdXBQYXRoKSB8fFxuICAgICAgICAgICAgKGtleSA9PT0gXCJmb2xkZXJcIiAmJiBidWNrZXQgIT09IFwibXlcIikgfHxcbiAgICAgICAgICAgIChrZXkgPT09IFwicmVnaW9uXCIgJiYgIVtcImxpdmluZyBhdGxhc1wiLCBcImxpdmluZyBhdGxhcyBhbmFseXNpc1wiXS5pbmNsdWRlcyhidWNrZXQpKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ID09PSBcImNhdGVnb3JpZXNcIiAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGZpbHRlcnNba2V5XS5jYXRlZ29yeSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PT0gXCJyZWdpb25cIiAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGZpbHRlcnNba2V5XS5jYXRlZ29yeVZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWx0ZXJQYXJhbSA9IHBhcmFtID09PSBcImNhdGVnb3JpZXNcIiA/IHt9IDogeyBbcGFyYW1dOiBgJHtwYXJhbXNbcGFyYW1dIHx8IFwiXCJ9ICR7dmFsdWV9YCB9O1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyksIGZpbHRlclBhcmFtKSwgKGFkZGl0aW9uYWxQYXJhbXMgIT09IG51bGwgJiYgYWRkaXRpb25hbFBhcmFtcyAhPT0gdm9pZCAwID8gYWRkaXRpb25hbFBhcmFtcyA6IHt9KSk7XG4gICAgfSwgYmFzZVBhcmFtcyk7XG4gICAgY29uc3QgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgbnVtLFxuICAgICAgICBzdGFydCB9LCAoc29ydEZpZWxkID09PSBcInJlbGV2YW5jZVwiXG4gICAgICAgID8ge31cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBzb3J0RmllbGQsXG4gICAgICAgICAgICBzb3J0T3JkZXJcbiAgICAgICAgfSkpLCAocXVlcnlQYXJhbXMgfHwge30pKTtcbiAgICBjb25zdCBjYXRlZ29yeVBhcmFtID0gY2F0ZWdvcmllcy5sZW5ndGhcbiAgICAgICAgPyBjYXRlZ29yaWVzLm1hcCgoY2F0ZWdvcnkpID0+IGBjYXRlZ29yaWVzPSR7SlNPTi5zdHJpbmdpZnkoW2NhdGVnb3J5XSl9YCkuam9pbihcIiZcIilcbiAgICAgICAgOiBcIlwiO1xuICAgIGNvbnN0IGRpdmlkZXIgPSBjYXRlZ29yaWVzLmxlbmd0aCA/IFwiP1wiIDogXCJcIjtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYCR7dXJsfSR7ZGl2aWRlcn0ke2NhdGVnb3J5UGFyYW19YCwgcGFyYW1zLCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVzcG9uc2UpLCB7IHF1ZXJ5UGFyYW1zOiBwYXJhbXMgfSk7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyByZWFsbHkgd2hhdCB3ZSBzaG91bGQgZG8gaXMgY29tcGxldGVseSByZW1vdmUgdGhlIHRva2VuIGZyb20gb3VyIHJlcXVlc3QgZnVuY3Rpb25cbiAgICAgICAgLy8gaXQncyBub3QgbmVlZGVkIGFuZCBjYXVzZXMgYSBsb3Qgb2YgdGhpbmdzIHRvIG5vdCB3b3JrLlxuICAgICAgICAvLyBmb3IgYSBwYXRjaCwgdGhvdWdoLCBpbnN0ZWFkIHdlJ2xsIGNoZWNrIGZvciB0aGUgZXJyb3IgdGhhdCBzaG91bGQgdHJpZ2dlciB0aGUgbG9nIGluXG4gICAgICAgIC8vIGFuZCBqdXN0IGRpc2FibGUgYWRkaW5nIHRoZSB0b2tlbiBzbyB0aGUganNhcGkgd2lsbCBjYWxsIGdldENyZWRlbnRpYWxcbiAgICAgICAgaWYgKCgoX2cgPSBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuZGV0YWlscykgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLmh0dHBTdGF0dXMpID09PSA0OTggJiYgKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSA9PT0gXCJJbnZhbGlkIHRva2VuLlwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYCR7dXJsfSR7ZGl2aWRlcn0ke2NhdGVnb3J5UGFyYW19YCwgcGFyYW1zLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpLCB7IGFkZFRva2VuTWFudWFsbHk6IGZhbHNlIH0pKTtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlc3BvbnNlKSwgeyBxdWVyeVBhcmFtczogcGFyYW1zIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0R2VvbWV0cnlRdWVyeShnZW9tZXRyaWVzLCBwb3J0YWwpIHtcbiAgICAvLyBpZiB1bmRlY2xhcmVkIG9yIHdlJ3JlIHVzaW5nIGFsbCBvZiB0aGVtLCBubyBuZWVkIHRvIHF1ZXJ5LFxuICAgIC8vIGFkZGl0aW9uYWxseSwgZW50ZXJwcmlzZSBkb2VzIG5vdCBzdXBwb3J0IHN1YmxheWVyIGluZGV4aW5nXG4gICAgaWYgKCFnZW9tZXRyaWVzIHx8IGdlb21ldHJpZXMubGVuZ3RoID09PSAoZGVmYXVsdEdlb21ldHJpZXMgPT09IG51bGwgfHwgZGVmYXVsdEdlb21ldHJpZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlZmF1bHRHZW9tZXRyaWVzLmxlbmd0aCkgfHwgKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIGNvbnN0IHR5cGVzID0gZ2VvbWV0cmllcy5tYXAoKGdlb21ldHJ5KSA9PiBgXCIke2dlb21ldHJ5fVwiYCkuam9pbihcIiBPUiBcIik7XG4gICAgcmV0dXJuIGAoKC10eXBla2V5d29yZHM6XCJIb3N0ZWQgU2VydmljZVwiKSBPUiAodHlwZWtleXdvcmRzOlwiSG9zdGVkIFNlcnZpY2VcIiBBTkQgZ2VvbWV0cnl0eXBlOigke3R5cGVzfSkpKWA7XG59XG5mdW5jdGlvbiBnZXRIaWdobGlnaHRzKHJlc3BvbnNlLCBjb25maWcpIHtcbiAgICBpZiAoIWNvbmZpZy5kZWVwTGF5ZXJTZWFyY2hFbmFibGVkKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY29uc3QgaGlnaGxpZ2h0cyA9IHt9O1xuICAgIChyZXNwb25zZS5oaWdobGlnaHRzIHx8IFtdKS5mb3JFYWNoKChoaWdobGlnaHQpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBpdGVtID0gKF9hID0gcmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGhpZ2hsaWdodC5pZCk7XG4gICAgICAgIGlmICghKGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5zdWJsYXllcnMpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGlnaGxpZ2h0ZWRGaWVsZHMgPSBPYmplY3Qua2V5cyhoaWdobGlnaHQpXG4gICAgICAgICAgICAuZmlsdGVyKChrZXkpID0+IGtleSAhPT0gXCJpZFwiICYmIGtleS5pbmNsdWRlcyhcInN1YmxheWVycy5cIikpXG4gICAgICAgICAgICAucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgICAgICAgYWNjW2tleS5yZXBsYWNlKFwic3VibGF5ZXJzLlwiLCBcIlwiKV0gPSBoaWdobGlnaHRba2V5XS5tYXAoKHZhbHVlKSA9PiB2YWx1ZS5yZXBsYWNlQWxsKFwiPGVtPlwiLCBcIlwiKS5yZXBsYWNlQWxsKFwiPC9lbT5cIiwgXCJcIikpO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwge30pO1xuICAgICAgICBjb25zdCBzdWJsYXllcnMgPSBpdGVtLnN1YmxheWVyc1xuICAgICAgICAgICAgLmZpbHRlcigoc3VibGF5ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhzdWJsYXllcikuc29tZSgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIHJldHVybiAoX2EgPSBoaWdobGlnaHRlZEZpZWxkc1trZXldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc29tZSgodmFsdWUpID0+IHN1YmxheWVyW2tleV0uaW5jbHVkZXModmFsdWUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcCgoc3VibGF5ZXIpID0+IHN1YmxheWVyLmlkKTtcbiAgICAgICAgaGlnaGxpZ2h0c1toaWdobGlnaHQuaWRdID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBoaWdobGlnaHQpLCB7IHN1YmxheWVycyB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gaGlnaGxpZ2h0cztcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldExpdmluZ0F0bGFzR3JvdXBJZChwb3J0YWwsIHN0b3JlKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHF1ZXJ5R3JvdXBzKFxuICAgIC8vIFdlIG11c3Qgc2V0IHNvcnQgaGVyZSB0byBtYWtlIHN1cmUgdGhlIGNvcnJlY3QgbGl2aW5nIGF0bGFzIGdyb3VwIGNvbWVzIGZpcnN0IGluIGNhc2Ugb2YgbXVsdGlwbGVcbiAgICAvLyBAdHMtaWdub3JlIC0gdGhpcyBkb2VzIGV4aXN0IG9uIDQueCBQb3J0YWxzLCB0aGVpciB0eXBlcyBhcmUgd3JvbmdcbiAgICB7IHE6IHBvcnRhbC5saXZpbmdBdGxhc0dyb3VwUXVlcnksIG51bTogMSwgc29ydEZpZWxkOiBcInRpdGxlXCIsIHNvcnRPcmRlcjogXCJhc2NcIiB9LCBwb3J0YWwpO1xuICAgIGNvbnN0IGlkID0gKChfYiA9IChfYSA9IHJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlkKSB8fCBcIlwiO1xuICAgIC8vIFRPRE86IE1vdmUgdG8gc2V0IG91dHNpZGUgZnVuY3Rpb24gdG8gYXZvaWQgc2lkZS1lZmZlY3RzIC8gYXJndW1lbnQgbXV0YXRpb24gJiBjb21iaW5lIGZ1bmN0aW9uc1xuICAgIGlmIChzdG9yZSkge1xuICAgICAgICBzdG9yZS5zdGF0ZS5saXZpbmdBdGxhc0dyb3VwSWQgPSBpZDtcbiAgICB9XG4gICAgcmV0dXJuIGlkO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0TGl2aW5nQXRsYXNBbmFseXNpc0dyb3VwSWQocG9ydGFsLCBzdG9yZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBxdWVyeUdyb3Vwcyh7XG4gICAgICAgIHE6IGdldExpdmluZ0F0bGFzQW5hbHlzaXNHcm91cFF1ZXJ5KHBvcnRhbCksXG4gICAgICAgIG51bTogMSxcbiAgICAgICAgc29ydEZpZWxkOiBcInRpdGxlXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIlxuICAgIH0sIHBvcnRhbCk7XG4gICAgY29uc3QgaWQgPSAoKF9iID0gKF9hID0gcmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaWQpIHx8IFwiXCI7XG4gICAgLy8gVE9ETzogTW92ZSB0byBzZXQgb3V0c2lkZSBmdW5jdGlvbiB0byBhdm9pZCBzaWRlLWVmZmVjdHMgLyBhcmd1bWVudCBtdXRhdGlvbiAmIGNvbWJpbmUgZnVuY3Rpb25zXG4gICAgaWYgKHN0b3JlKSB7XG4gICAgICAgIHN0b3JlLnN0YXRlLmxpdmluZ0F0bGFzQW5hbHlzaXNHcm91cElkID0gaWQ7XG4gICAgfVxuICAgIHJldHVybiBpZDtcbn1cbi8qKlxuICogRm9ybWF0cyB0aGUgY29ycmVjdCBhbmFseXNpcyBsaXZpbmcgYXRsYXMgcXVlcnkgYmFzZWQgb24gcG9ydGFsIGNvbmZpZ3VyYXRpb25cbiAqIEBwYXJhbSB7UG9ydGFsfSBwb3J0YWxcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGdldExpdmluZ0F0bGFzQW5hbHlzaXNHcm91cFF1ZXJ5KHBvcnRhbCkge1xuICAgIC8vIFVzZSBgZXNyaV9saXZpbmdhdGxhc2AgaW4gZW50ZXJwcmlzZSBhbmQgYGVzcmlgIGluIG9ubGluZVxuICAgIGNvbnN0IGdyb3VwT3duZXIgPSBwb3J0YWwuaXNQb3J0YWwgPT09IHRydWUgPyBcImVzcmlfbGl2aW5nYXRsYXNcIiA6IFwiZXNyaVwiO1xuICAgIHJldHVybiBgdGl0bGU6XCJMaXZpbmcgQXRsYXMgQW5hbHlzaXMgTGF5ZXJzXCIgQU5EIG93bmVyOiR7Z3JvdXBPd25lcn1gO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0QnVja2V0UXVlcnkoeyBidWNrZXQsIHVzZXIsIHBvcnRhbCwgZmlsdGVycyB9KSB7XG4gICAgc3dpdGNoIChidWNrZXQpIHtcbiAgICAgICAgY2FzZSBcIm15XCI6XG4gICAgICAgICAgICByZXR1cm4gYG93bmVyOiAke3VzZXIudXNlcm5hbWV9YDtcbiAgICAgICAgY2FzZSBcIm9yZ1wiOlxuICAgICAgICAgICAgcmV0dXJuIGBvcmdpZDoke3BvcnRhbC5pZH0gJHtwb3J0YWwuaXNQb3J0YWwgPyBgLW93bmVyOmVzcmlfYXBwc2AgOiBcIlwifWA7XG4gICAgICAgIGNhc2UgXCJmYXZvcml0ZXNcIjpcbiAgICAgICAgICAgIGNvbnN0IGZhdm9yaXRlc0dyb3VwSWQgPSBhd2FpdCBnZXRTaWduZWRJblVzZXJzRmF2b3JpdGVzR3JvdXAoKTtcbiAgICAgICAgICAgIHJldHVybiBgZ3JvdXA6ICR7ZmF2b3JpdGVzR3JvdXBJZH1gO1xuICAgICAgICBjYXNlIFwiZ3JvdXBcIjpcbiAgICAgICAgICAgIGlmICghKGZpbHRlcnMgPT09IG51bGwgfHwgZmlsdGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsdGVycy5ncm91cCkgfHwgKGZpbHRlcnMgPT09IG51bGwgfHwgZmlsdGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsdGVycy5ncm91cC5ncm91cCkgPT09IFwiYWxsXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cHMgPSBhd2FpdCBnZXRTaWduZWRJblVzZXJzR3JvdXBzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGBncm91cDooJHtncm91cHMgPT09IG51bGwgfHwgZ3JvdXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cHMubWFwKCh7IGlkIH0pID0+IGlkKS5qb2luKFwiIE9SIFwiKX0pYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIGlzUG9ydGFsVmlld2luZ0FyY0dJU09ubGluZShwb3J0YWwsIGJ1Y2tldCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgJiYgYnVja2V0ID09PSBcImFsbFwiKSB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gYXdhaXQgZ2V0UG9ydGFsU2V0dGluZ3MocG9ydGFsKTtcbiAgICAgICAgaWYgKChfYSA9IHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5wb3J0YWxDb25maWdQcm9wZXJ0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VhcmNoQXJjR0lTT25saW5lRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvdmlzaW9uZWRMaXN0aW5ncyh1c2VyLCBwb3J0YWwpIHtcbiAgICBpZiAoIXVzZXIgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBmcm9tQ2FjaGUoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfWNvbW11bml0eS91c2Vycy8ke3VzZXIudXNlcm5hbWV9L3Byb3Zpc2lvbmVkTGlzdGluZ3NgO1xuICAgICAgICByZXR1cm4gZmV0Y2hBbGxSZXNvdXJjZXModXJsLCB7fSwgXCJwcm92aXNpb25lZExpc3RpbmdzXCIpO1xuICAgIH0sIFwicHJvdmlzaW9uZWRMaXN0aW5nc1wiLCBgJHtwb3J0YWwuaWR9LSR7dXNlci51c2VybmFtZX1gKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVud3JhcFJlbGF0ZWRJdGVtcyhpZCwgcG9ydGFsKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0UmVsYXRlZEl0ZW1zKGlkLCBwb3J0YWwsIHtcbiAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogXCJMaXN0ZWQySW1wbGljaXRseUxpc3RlZFwiLFxuICAgICAgICBkaXJlY3Rpb246IFwiZm9yd2FyZFwiXG4gICAgfSk7XG4gICAgcmV0dXJuIChfYSA9IHJlc3BvbnNlLnJlbGF0ZWRJdGVtcykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG59XG5mdW5jdGlvbiBmaWx0ZXJTdWJzY3JpcHRpb25Db250ZW50KGl0ZW0sIGFsbG93ZWRTdWJzY3JpcHRpb25Db250ZW50VHlwZXMpIHtcbiAgICAvLyBieSBkZWZhdWx0LCB1c2VyIHdpbGwgc2VlIGp1c3QgbGF5ZXJzICh0aGUgc2V0IHVzZWQgaW4gdGhlIG1hcCB2aWV3ZXIpXG4gICAgYWxsb3dlZFN1YnNjcmlwdGlvbkNvbnRlbnRUeXBlcyAhPT0gbnVsbCAmJiBhbGxvd2VkU3Vic2NyaXB0aW9uQ29udGVudFR5cGVzICE9PSB2b2lkIDAgPyBhbGxvd2VkU3Vic2NyaXB0aW9uQ29udGVudFR5cGVzIDogKGFsbG93ZWRTdWJzY3JpcHRpb25Db250ZW50VHlwZXMgPSBbXG4gICAgICAgIFwiTWFwIFNlcnZpY2VcIixcbiAgICAgICAgXCJJbWFnZSBTZXJ2aWNlXCIsXG4gICAgICAgIFwiRmVhdHVyZSBTZXJ2aWNlXCIsXG4gICAgICAgIFwiU3RyZWFtIFNlcnZpY2VcIixcbiAgICAgICAgXCJWZWN0b3IgVGlsZSBTZXJ2aWNlXCIsXG4gICAgICAgIFwiV01TXCIsXG4gICAgICAgIFwiV0ZTXCIsXG4gICAgICAgIFwiV01UU1wiLFxuICAgICAgICBcIktNTFwiLFxuICAgICAgICBcIkZlYXR1cmUgQ29sbGVjdGlvblwiLFxuICAgICAgICBcIkZlZWRcIlxuICAgIF0pO1xuICAgIHJldHVybiBhbGxvd2VkU3Vic2NyaXB0aW9uQ29udGVudFR5cGVzLmluY2x1ZGVzKGl0ZW0udHlwZSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRTdWJzY3JpcHRpb25Db250ZW50KHBvcnRhbCwgdXNlciwgYWxsb3dlZEl0ZW1UeXBlcykge1xuICAgIHJldHVybiBmcm9tQ2FjaGUoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBsaXN0aW5ncyA9IGF3YWl0IGdldFByb3Zpc2lvbmVkTGlzdGluZ3ModXNlciwgcG9ydGFsKTtcbiAgICAgICAgaWYgKCEobGlzdGluZ3MgPT09IG51bGwgfHwgbGlzdGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpc3RpbmdzLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRvdGFsOiAwLCByZXN1bHRzOiBbXSwgc3RhcnQ6IC0xLCBudW06IDEwMCwgbmV4dFN0YXJ0OiAwIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaWRzID0gbGlzdGluZ3MgPT09IG51bGwgfHwgbGlzdGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpc3RpbmdzLm1hcCgobGlzdGluZykgPT4gbGlzdGluZy5pdGVtSWQpO1xuICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IFByb21pc2UuYWxsKGlkcy5tYXAoKGlkKSA9PiBnZXRJdGVtKGlkLCBwb3J0YWwpKSk7XG4gICAgICAgIGNvbnN0IHJlbGF0ZWRJdGVtc0FycmF5cyA9IGF3YWl0IFByb21pc2UuYWxsKGlkcyA9PT0gbnVsbCB8fCBpZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkcy5tYXAoKGlkKSA9PiB1bndyYXBSZWxhdGVkSXRlbXMoaWQsIHBvcnRhbCkpKTtcbiAgICAgICAgY29uc3QgYWxsSXRlbXMgPSByZWxhdGVkSXRlbXNBcnJheXNcbiAgICAgICAgICAgIC5yZWR1Y2UoKGFsbCwgcmVsYXRlZEl0ZW1zKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYWxsLmNvbmNhdChyZWxhdGVkSXRlbXMpO1xuICAgICAgICB9LCBpdGVtcylcbiAgICAgICAgICAgIC5maWx0ZXIoKGl0ZW0pID0+IGZpbHRlclN1YnNjcmlwdGlvbkNvbnRlbnQoaXRlbSwgYWxsb3dlZEl0ZW1UeXBlcykpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG90YWw6IGFsbEl0ZW1zLmxlbmd0aCxcbiAgICAgICAgICAgIHJlc3VsdHM6IGFsbEl0ZW1zLFxuICAgICAgICAgICAgc3RhcnQ6IGFsbEl0ZW1zLmxlbmd0aCA/IDEgOiAwLFxuICAgICAgICAgICAgbnVtOiAxMDAsXG4gICAgICAgICAgICBuZXh0U3RhcnQ6IDBcbiAgICAgICAgfTtcbiAgICB9LCBcInN1YnNjcmlwdGlvbkNvbnRlbnRcIiwgYCR7cG9ydGFsLmlkfS0ke3VzZXIudXNlcm5hbWV9YCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaFJlY3ljbGVCaW5Db250ZW50KHF1ZXJ5LCB1cmwpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGFib3J0Q29udHJvbGxlciA9PT0gbnVsbCB8fCBhYm9ydENvbnRyb2xsZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFib3J0Q29udHJvbGxlci5zaWduYWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hZGRFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBET01FeGNlcHRpb24oXCJBYm9ydGVkXCIsIFwiQWJvcnRFcnJvclwiKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IHN0YXJ0LCBudW0sIHNvcnRGaWVsZCwgc29ydE9yZGVyIH0gPSBxdWVyeTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwge1xuICAgICAgICAgICAgZm9sZGVyc0NvbnRlbnQ6IHRydWUsXG4gICAgICAgICAgICBpblJlY3ljbGVCaW46IHRydWUsXG4gICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgIG51bSxcbiAgICAgICAgICAgIHNvcnRGaWVsZCxcbiAgICAgICAgICAgIHNvcnRPcmRlclxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSksIHsgcmVzdWx0czogcmVzcG9uc2UuaXRlbXMsIHF1ZXJ5UGFyYW1zOiBxdWVyeSB9KSk7XG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaFVzZXJSZWN5Y2xlQmluQ29udGVudCh7IHF1ZXJ5LCBwb3J0YWwsIHVzZXIgfSkge1xuICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC91c2Vycy8ke3VzZXIudXNlcm5hbWV9L2A7XG4gICAgcmV0dXJuIGZldGNoUmVjeWNsZUJpbkNvbnRlbnQocXVlcnksIHVybCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaE9yZ1JlY3ljbGVCaW5Db250ZW50KHsgcXVlcnksIHBvcnRhbCB9KSB7XG4gICAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1jb250ZW50L3BvcnRhbHMvJHtwb3J0YWwuaWR9L2A7XG4gICAgcmV0dXJuIGZldGNoUmVjeWNsZUJpbkNvbnRlbnQocXVlcnksIHVybCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaFByZXZpZXdJdGVtKGl0ZW0sIHBvcnRhbCwgdXNlciwgc3RvcmUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgcG9ydGFsVG9PbmxpbmUgPSBhd2FpdCBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUocG9ydGFsLCBzdG9yZS5zdGF0ZS5idWNrZXQpO1xuICAgIGNvbnN0IHVybCA9IHBvcnRhbFRvT25saW5lXG4gICAgICAgID8gYGh0dHBzOi8vd3d3LmFyY2dpcy5jb20vc2hhcmluZy9yZXN0L2NvbnRlbnQvaXRlbXMvJHtpdGVtLmlkfWBcbiAgICAgICAgOiBnZXRJdGVtVXJsKGl0ZW0uaWQsIHBvcnRhbCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHBvcnRhbFRvT25saW5lIHx8ICF1c2VyID8geyBkaXNhYmxlSWRlbnRpdHlMb29rdXA6IHRydWUsIGFkZFRva2VuTWFudWFsbHk6IGZhbHNlIH0gOiB7fTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3QodXJsLCB7fSwgb3B0aW9ucykgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmICgoKF9hID0gZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRldGFpbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZXNzYWdlQ29kZSkgPT09IFwiU0JfMDAwNVwiKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcImRpc2FibGVkU3Vic2NyaXB0aW9uXCIgfSB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG59XG5mdW5jdGlvbiBjbGVhbkZpbHRlcnMoZmlsdGVycywgYnVja2V0KSB7XG4gICAgY29uc3QgY2xlYW5GaWx0ZXJzID0gT2JqZWN0LmFzc2lnbih7fSwgZmlsdGVycyk7XG4gICAgaWYgKGJ1Y2tldCAhPT0gXCJteVwiKSB7XG4gICAgICAgIGRlbGV0ZSBjbGVhbkZpbHRlcnMuZm9sZGVyO1xuICAgIH1cbiAgICBpZiAoYnVja2V0ICE9PSBcImdyb3VwXCIpIHtcbiAgICAgICAgZGVsZXRlIGNsZWFuRmlsdGVycy5ncm91cDtcbiAgICB9XG4gICAgcmV0dXJuIGNsZWFuRmlsdGVycztcbn1cblxuZnVuY3Rpb24gZ2V0SXRlbVRodW1ibmFpbChwb3J0YWwsIGl0ZW0sIHJlc3RCYXNlLCBub1Rva2VuKSB7XG4gICAgcmVzdEJhc2UgIT09IG51bGwgJiYgcmVzdEJhc2UgIT09IHZvaWQgMCA/IHJlc3RCYXNlIDogKHJlc3RCYXNlID0gZ2V0UmVzdEJhc2VVcmwocG9ydGFsKSk7XG4gICAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbihwb3J0YWwpO1xuICAgIGNvbnN0IHRva2VuUGFyYW0gPSB0b2tlbiAmJiAhbm9Ub2tlbiA/IGB0b2tlbj0ke3Rva2VufWAgOiBcIlwiO1xuICAgIGNvbnN0IGl0ZW1VcmwgPSBgJHtyZXN0QmFzZX1jb250ZW50L2l0ZW1zLyR7aXRlbS5pZH1gO1xuICAgIC8vIEB0cy1pZ25vcmUgLSB0aGUgNC54IGFwaSBfZG9lc18gaW5jbHVkZSB0aGlzIHByb3BlcnR5XG4gICAgaWYgKGl0ZW0udGh1bWJuYWlsKSB7XG4gICAgICAgIC8vIDQueCBpdGVtcyBoYXZlIGEgdGh1bWJuYWlsIHVybCB3aGljaCBpbmNsdWRlcyB0aGUgdG9rZW4sIHNvIGp1c3QgdXNlIHRoYXRcbiAgICAgICAgaWYgKGl0ZW0udGh1bWJuYWlsVXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbS50aHVtYm5haWxVcmw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke2l0ZW1Vcmx9L2luZm8vJHtpdGVtLnRodW1ibmFpbH0/dz00MDAke3Rva2VuID8gXCImXCIgOiBcIlwifSR7dG9rZW5QYXJhbX1gO1xuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwiSW1hZ2VcIiAmJiAhbm9Ub2tlbikge1xuICAgICAgICByZXR1cm4gYCR7aXRlbVVybH0vZGF0YT8ke3Rva2VuUGFyYW19YDtcbiAgICB9XG4gICAgcmV0dXJuIGdldERlZmF1bHRUaHVtYm5haWwoaXRlbSk7XG59XG4vKiogVGhpcyBpcyBqdXN0IGxpa2UgZ2V0SXRlbVRodW1ibmFpbCBidXQgaXQgd2lsbCB1c2UgYW4gYXJjZ2lzLmNvbSBiYXNlIGluIGNlcnRhaW4gcG9ydGFsIGNvbmRpdGlvbnMgKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFkanVzdGVkVGh1bWJuYWlsKHBvcnRhbCwgaXRlbSwgYnVja2V0KSB7XG4gICAgaWYgKGF3YWl0IGlzUG9ydGFsVmlld2luZ0FyY0dJU09ubGluZShwb3J0YWwsIGJ1Y2tldCkpIHtcbiAgICAgICAgcmV0dXJuIGdldEl0ZW1UaHVtYm5haWwocG9ydGFsLCBpdGVtLCBcImh0dHBzOi8vd3d3LmFyY2dpcy5jb20vc2hhcmluZy9yZXN0L1wiLCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIGdldEl0ZW1UaHVtYm5haWwocG9ydGFsLCBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldERlZmF1bHRUaHVtYm5haWwoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBmaWxlTmFtZSA9ICgoX2EgPSBpdGVtLnR5cGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpKSAhPT0gXCJub3RlYm9va1wiID8gXCJkZWZhdWx0X3RodW1iLnBuZ1wiIDogXCJub3RlYm9vay10aHVtYi5wbmdcIjtcbiAgICByZXR1cm4gZ2V0QXNzZXRQYXRoKGAuL2Fzc2V0cy9hcmNnaXMtaXRlbS1icm93c2VyLWNhcmQtdGh1bWJuYWlsLyR7ZmlsZU5hbWV9YCk7XG59XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gaW1hZ2UgaXMgYmxhbmsuXG4gKiBEcmF3aW5nIHRoZSBpbWFnZSBvbiBjYW52YXMsIGdldCB0aGUgaW1hZ2UgZGF0YSxcbiAqIGdlbmVyYXRlIGEgaGFzaCBhbmQgY29tcGFyZSB0aGlzIGFnYWluc3QgYSBrbm93biBibGFuayBoYXNoLlxuICovXG5mdW5jdGlvbiBpc0JsYW5rSW1hZ2UoaW1hZ2UpIHtcbiAgICBpZiAoIWltYWdlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5uYXR1cmFsSGVpZ2h0O1xuICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLm5hdHVyYWxXaWR0aDtcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IFwiI2ZmZmZmZlwiO1xuICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgaW1hZ2UubmF0dXJhbFdpZHRoLCBpbWFnZS5uYXR1cmFsSGVpZ2h0KTtcbiAgICBjb25zdCBibGFuayA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9qcGVnXCIpO1xuICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTtcbiAgICByZXR1cm4gYmxhbmsgPT09IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9qcGVnXCIpO1xufVxuXG5leHBvcnQgeyBnZXRUYWdzIGFzIGEsIGdldEhpZ2hsaWdodHMgYXMgYiwgY2xlYW5GaWx0ZXJzIGFzIGMsIGRlZmF1bHRHZW9tZXRyaWVzIGFzIGQsIGdldFByb3Zpc2lvbmVkTGlzdGluZ3MgYXMgZSwgZ2V0RGVmYXVsdFRodW1ibmFpbCBhcyBmLCBnZXRJdGVtVGh1bWJuYWlsIGFzIGcsIGdldEFkanVzdGVkVGh1bWJuYWlsIGFzIGgsIGlzUG9ydGFsVmlld2luZ0FyY0dJU09ubGluZSBhcyBpLCBpc0JsYW5rSW1hZ2UgYXMgaiwgZmV0Y2hQcmV2aWV3SXRlbSBhcyBrLCBxdWVyeUl0ZW1zIGFzIHEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGh1bWJuYWlsLWJjYjg5ZTY5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoVXNlcih1c2VybmFtZSwgcG9ydGFsKSB7XG4gICAgcmV0dXJuIHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29tbXVuaXR5L3VzZXJzLyR7dXNlcm5hbWV9YCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaFNlbGYoKSB7XG4gICAgcmV0dXJuIHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwoKX0vY29tbXVuaXR5L3NlbGZgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFNpZ25lZEluVXNlcnNHcm91cHMoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUudXNlcjtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBzZWxmID0gYXdhaXQgZnJvbUNhY2hlKCgpID0+IGZldGNoU2VsZigpLCBcImNvbW11bml0eVNlbGZcIiwgdXNlci51c2VybmFtZSk7XG4gICAgcmV0dXJuIChfYSA9IHNlbGYgPT09IG51bGwgfHwgc2VsZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZi5ncm91cHMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmVkSW5Vc2Vyc0Zhdm9yaXRlc0dyb3VwKCkge1xuICAgIGNvbnN0IHVzZXIgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUudXNlcjtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHNlbGYgPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gZmV0Y2hTZWxmKCksIFwiY29tbXVuaXR5U2VsZlwiLCB1c2VyLnVzZXJuYW1lKTtcbiAgICByZXR1cm4gc2VsZi5mYXZHcm91cElkO1xufVxuZnVuY3Rpb24gZ2V0VXNlckNvbnRlbnRVcmwodXNlciwgcG9ydGFsKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIudXNlckNvbnRlbnRVcmwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGAke3BvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5yZXN0VXJsfS9jb250ZW50L3VzZXJzLyR7dXNlci51c2VybmFtZX1gO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckNvbnRlbnQocG9ydGFsVXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB1c2VyID0gKF9hID0gcG9ydGFsVXNlciAhPT0gbnVsbCAmJiBwb3J0YWxVc2VyICE9PSB2b2lkIDAgPyBwb3J0YWxVc2VyIDogY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsLnVzZXI7XG4gICAgY29uc3QgcG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsO1xuICAgIGNvbnN0IHVybCA9IGdldFVzZXJDb250ZW50VXJsKHVzZXIsIHBvcnRhbCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwgeyBudW06IDEgfSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRGb2xkZXJzKHBvcnRhbFVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICAgIGNvbnN0IHsgZm9sZGVycyB9ID0gYXdhaXQgZ2V0VXNlckNvbnRlbnQodXNlcik7XG4gICAgY29uc3QgeyB1c2VybmFtZSB9ID0gdXNlcjtcbiAgICBjb25zdCBzb3J0ZWRGb2xkZXJzID0gZm9sZGVycy5zb3J0KChhLCBiKSA9PiBhLnRpdGxlLmxvY2FsZUNvbXBhcmUoYi50aXRsZSkpO1xuICAgIC8vIGFkZCB0aGUgaG9tZSBmb2xkZXIgYXMgaWYgaXQncyBpbiB0aGUgbGlzdFxuICAgIHJldHVybiBbeyB1c2VybmFtZSwgaWQ6IHVzZXJuYW1lLCB0aXRsZTogdXNlcm5hbWUsIGNyZWF0ZWQ6IFwibm93XCIgfSwgLi4uc29ydGVkRm9sZGVyc107XG59XG5hc3luYyBmdW5jdGlvbiBnZXRGb2xkZXJGcm9tSWQoZm9sZGVySWQsIHBvcnRhbFVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICAgIGNvbnN0IGZvbGRlcnMgPSBhd2FpdCBnZXRGb2xkZXJzKHVzZXIpO1xuICAgIHJldHVybiBmb2xkZXJzLmZpbmQoKGZvbGRlcikgPT4gZm9sZGVyLmlkID09PSBmb2xkZXJJZCk7XG59XG5mdW5jdGlvbiBnZXRIb21lRm9sZGVyRm9yVXNlcih1c2VybmFtZSkge1xuICAgIHJldHVybiB7IHVzZXJuYW1lLCBpZDogdXNlcm5hbWUsIHRpdGxlOiB1c2VybmFtZSwgY3JlYXRlZDogXCJub3dcIiB9O1xufVxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRm9sZGVyKGZvbGRlck5hbWUsIHBvcnRhbFVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFVzZXJDb250ZW50VXJsKHVzZXIsIGNvbmZpZ1N0YXRlLnBvcnRhbCl9L2NyZWF0ZUZvbGRlcmA7XG4gICAgY29uc3QgZm9sZGVyUmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwgeyB0aXRsZTogZm9sZGVyTmFtZSB9LCB7fSwgXCJwb3N0XCIpO1xuICAgIHJldHVybiBmb2xkZXJSZXNwb25zZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZvbGRlcihpZCwgbmV3VGl0bGUsIHBvcnRhbFVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdXNlciA9IChfYSA9IHBvcnRhbFVzZXIgIT09IG51bGwgJiYgcG9ydGFsVXNlciAhPT0gdm9pZCAwID8gcG9ydGFsVXNlciA6IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLnBvcnRhbC51c2VyO1xuICAgIGNvbnN0IHVybCA9IGAke2dldFVzZXJDb250ZW50VXJsKHVzZXIsIGNvbmZpZ1N0YXRlLnBvcnRhbCl9LyR7aWR9L3VwZGF0ZUZvbGRlcmA7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVxdWVzdCh1cmwsIHsgbmV3VGl0bGUgfSwge30sIFwicG9zdFwiKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0IH07XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZ2V0Rm9sZGVyRnJvbUlkIGFzIGEsIGdldEhvbWVGb2xkZXJGb3JVc2VyIGFzIGIsIGNyZWF0ZUZvbGRlciBhcyBjLCBnZXRTaWduZWRJblVzZXJzR3JvdXBzIGFzIGQsIGdldFNpZ25lZEluVXNlcnNGYXZvcml0ZXNHcm91cCBhcyBlLCBmZXRjaFVzZXIgYXMgZiwgZ2V0Rm9sZGVycyBhcyBnLCB1cGRhdGVGb2xkZXIgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD11c2VyLTNlYTY5YzNhLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==