"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-563af0"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-field-pick-list_3.entry.js":
/*!***************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-field-pick-list_3.entry.js ***!
  \***************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_field_pick_list: () => (/* binding */ ArcgisFieldPickList),
/* harmony export */   arcgis_smart_mapping_action: () => (/* binding */ ArcgisSmartMappingAction),
/* harmony export */   arcgis_smart_mapping_attribute_input: () => (/* binding */ ArcgisSmartMappingAttributeInput)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _feature_1ce1b984_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./feature-1ce1b984.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-1ce1b984.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */











const arcgisFieldPickListCss = ".popover{z-index:100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}";

const ArcgisFieldPickList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisFieldPickListDismissed = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFieldPickListDismissed", 7);
        this.arcgisFieldPickListChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFieldPickListChange", 7);
        this.arcgisFieldPickListSortByChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisFieldPickListSortByChange", 7);
        this.calciteValueList = (field) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { key: field.name, label: field.alias || field.name, description: (() => {
                if (this.showFieldName) {
                    return `{${field.name}}`;
                }
                if (this.showDescription && field.description) {
                    return field.description;
                }
                return null;
            })(), value: field.name, selected: (!this.multiple && field.name === this.selectedFields[0]) ||
                (this.multiple && this.selectedFields.indexOf(field.name) > -1), metadata: {
                label: field.alias,
                fieldName: field.name
            } }, this.showFieldInfoCheck(field) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: this.strings.info, title: this.strings.info, scale: "s", icon: "information", onClick: (event) => {
                var _a;
                event.stopPropagation();
                const action = event.target;
                const fieldInfoFlowItem = document.createElement("calcite-flow-item");
                fieldInfoFlowItem.heading = (_a = field.alias) !== null && _a !== void 0 ? _a : field.name;
                fieldInfoFlowItem.description = field.name;
                const fieldInfo = document.createElement("arcgis-field-info");
                fieldInfo.lang = this.currentLanguageIntl;
                fieldInfo.fieldName = field.name;
                fieldInfo.layer = this.layer;
                fieldInfo.view = this.mapView;
                fieldInfo.classList.add("content");
                fieldInfoFlowItem.appendChild(fieldInfo);
                fieldInfoFlowItem.addEventListener("calciteFlowItemBack", () => setTimeout(() => requestAnimationFrame(() => action.setFocus()), 200));
                this.flowElement.appendChild(fieldInfoFlowItem);
                setTimeout(() => requestAnimationFrame(() => fieldInfoFlowItem.setFocus()), 200);
            } }))));
        this.selectedFields = [];
        this.fields = undefined;
        this.popoverProps = undefined;
        this.layer = undefined;
        this.mapView = undefined;
        this.showFieldInfo = false;
        this.showFieldName = false;
        this.showDescription = false;
        this.showSelectionAll = false;
        this.showCancel = true;
        this.showSort = true;
        this.showFilterLength = 10;
        this.multiple = false;
        this.heading = undefined;
        this.okBtnText = undefined;
        this.filterPlaceholderText = undefined;
        this.sortBy = undefined;
        this.lastSortyBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.default;
        this.filterFields = null;
    }
    // --------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    // --------------------------------------------------------------------------
    async componentWillLoad() {
        const localeSettings = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.hostElement);
        this.strings = localeSettings[0];
        this.currentLanguage = localeSettings[1];
        this.currentLanguageIntl = localeSettings[2];
        // in case more than 1 selected field and multiple is set to false
        if (!this.multiple && this.selectedFields.length > 1) {
            this.selectedFields = [this.selectedFields[0]];
        }
        this.lastSortyBy = this.sortBy || this.lastSortyBy;
    }
    componentDidLoad() {
        this.setUpObserver();
        this.popoverNode.open = true;
        // need timeout because of re-render
        setTimeout(() => requestAnimationFrame(() => this.panelElement.setFocus()), 200);
    }
    disconnectedCallback() {
        var _a;
        (_a = this.observer) === null || _a === void 0 ? void 0 : _a.disconnect();
    }
    // temp: https://github.com/Esri/calcite-components/issues/4333
    calciteFilterChangeHandler(event) {
        var _a, _b;
        event.stopPropagation();
        const filterNode = (_a = event === null || event === void 0 ? void 0 : event.path) === null || _a === void 0 ? void 0 : _a.find((item) => item.nodeName === "CALCITE-FILTER");
        this.filterFields = (_b = filterNode === null || filterNode === void 0 ? void 0 : filterNode.filteredItems) === null || _b === void 0 ? void 0 : _b.map((item) => {
            return item.value;
        });
    }
    // --------------------------------------------------------------------------
    //
    // Public Methods
    //
    // --------------------------------------------------------------------------
    async setFocus() {
        setTimeout(() => requestAnimationFrame(() => this.panelElement.setFocus()), 1);
    }
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    // --------------------------------------------------------------------------
    //
    // Private Methods
    //
    // --------------------------------------------------------------------------
    getSortedList() {
        const tempSorted = [...this.fields];
        if (this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.display) {
            tempSorted.sort((a, b) => a.alias.localeCompare(b.alias));
        }
        else if (this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.field) {
            tempSorted.sort((a, b) => a.name.localeCompare(b.name));
        }
        else if (this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.type) {
            tempSorted.sort((a, b) => a.type.localeCompare(b.type));
        }
        return tempSorted;
    }
    showFieldInfoCheck(field) {
        if (this.showFieldInfo) {
            // dont want info for arcade and relation fields
            if (field.name.includes(_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.f.expression) ||
                field.name.includes(_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.f.relationship)) {
                return false;
            }
            else {
                return true;
            }
        }
        else {
            return false;
        }
    }
    // return true for deselect all, false for select all
    selectDeselect() {
        var _a;
        return ((_a = this.filterFields) === null || _a === void 0 ? void 0 : _a.length)
            ? this.filterContainsAll()
            : this.selectedFields.length === this.fields.length;
    }
    // check if filter has all current field info
    filterContainsAll() {
        return this.filterFields.every((filter) => {
            return this.selectedFields.some((curr) => {
                return curr === filter;
            });
        });
    }
    // --------------------------------------------------------------------------
    //
    // Rendor  Methods
    //
    // --------------------------------------------------------------------------
    render() {
        var _a;
        const addBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", appearance: this.showCancel ? "solid" : "outline-fill", width: this.showCancel ? "half" : "full", scale: "m", onClick: () => {
                this.arcgisFieldPickListDismissed.emit({ selectedFields: this.selectedFields });
            } }, this.okBtnText || (this.multiple ? this.strings.done : this.strings.ok)));
        const cancelBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", appearance: "outline-fill", width: this.multiple ? "half" : "full", scale: "m", onClick: () => this.arcgisFieldPickListDismissed.emit() }, this.strings.cancel));
        const hasType = this.fields.every((field) => !!field.type);
        const sort = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { slot: "menu-actions", placement: "bottom-end", overlayPositioning: "fixed", ref: (node) => (this.dropdownNode = node), onCalciteDropdownOpen: () => {
                var _a;
                (_a = this.observer) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.observer.observe(this.popoverNode, { attributes: true });
            }, onCalciteDropdownClose: () => { var _a; return (_a = this.observer) === null || _a === void 0 ? void 0 : _a.disconnect(); } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "trigger", text: this.strings.sort, title: this.strings.sort }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "sortDescending" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.default, onClick: () => {
                this.lastSortyBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.default;
                this.arcgisFieldPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.default), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.display, onClick: () => {
                this.lastSortyBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.display;
                this.arcgisFieldPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.displayName), hasType && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.type, onClick: () => {
                this.lastSortyBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.type;
                this.arcgisFieldPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.type)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: this.lastSortyBy === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.field, onClick: () => {
                this.lastSortyBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.L.field;
                this.arcgisFieldPickListSortByChange.emit(this.lastSortyBy);
            } }, this.strings.fieldName))));
        const selectionBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "selection-button-div" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", scale: "s", width: "full", onClick: () => {
                var _a, _b;
                if (this.selectDeselect()) {
                    //deselect all
                    this.selectedFields = ((_a = this.filterFields) === null || _a === void 0 ? void 0 : _a.length)
                        ? this.selectedFields.filter((item) => !this.filterFields.includes(item))
                        : [];
                }
                else {
                    //select all
                    this.selectedFields = ((_b = this.filterFields) === null || _b === void 0 ? void 0 : _b.length)
                        ? [...new Set([...this.selectedFields, ...this.filterFields])]
                        : this.fields.map((field) => {
                            return field.name;
                        });
                }
            } }, this.selectDeselect() ? this.strings.deselectAll : this.strings.selectAll)));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement), class: "popover", placement: this.popoverProps.placement || "leading-start", open: false, pointerDisabled: true, referenceElement: this.popoverProps.refElement, offsetDistance: this.popoverProps.offsetDistance ||
                -Math.round(this.popoverProps.refElement.getBoundingClientRect().width), offsetSkidding: this.popoverProps.offsetSkidding || 0, overlayPositioning: this.popoverProps.overlayPositioning, triggerDisabled: this.popoverProps.triggerDisabled, autoClose: this.popoverProps.autoClose, label: this.heading || (this.multiple ? this.strings.headerSelect : this.strings.header), onCalcitePopoverClose: () => this.arcgisFieldPickListDismissed.emit(), ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (node) => {
                this.flowElement = node;
            }, style: {
                width: `${this.popoverProps.popoverWidth ||
                    this.popoverProps.refElement.getBoundingClientRect().width}px`
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { ref: (el) => (this.panelElement = el), class: "panel", heading: this.heading || (this.multiple ? this.strings.headerSelect : this.strings.header), closable: true, onCalciteFlowItemClose: () => this.arcgisFieldPickListDismissed.emit() }, this.multiple && addBtn, this.showCancel && cancelBtn, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { multiple: this.multiple, ref: (node) => {
                this.pickListNode = node;
            }, class: "content", filterEnabled: this.fields.length >= this.showFilterLength ? true : false, filterPlaceholder: (_a = this.filterPlaceholderText) !== null && _a !== void 0 ? _a : this.strings.filter, onCalciteListChange: async () => {
                // keep original order. Add addional values at the end
                const tempSelectedFields = await this.pickListNode.getSelectedItems();
                this.selectedFields = [
                    ...new Set([
                        ...this.selectedFields.filter((item) => {
                            return tempSelectedFields.has(item);
                        }),
                        ...tempSelectedFields.keys()
                    ])
                ];
                this.arcgisFieldPickListChange.emit({ selectedFields: this.selectedFields });
                if (!this.multiple) {
                    this.arcgisFieldPickListDismissed.emit({ selectedFields: this.selectedFields });
                }
            } }, this.fields.length >= this.showFilterLength && this.showSort && sort, this.multiple && this.showSelectionAll && selectionBtn, [...this.getSortedList()].map((field) => {
            return this.calciteValueList(field);
        })))))));
    }
    // --------------------------------------------------------------------------
    //
    // Private  Methods
    //
    // --------------------------------------------------------------------------
    setUpObserver() {
        this.observer = new MutationObserver((mutationList /* , observer */) => {
            for (const mutation of mutationList) {
                if (mutation.attributeName === "style") {
                    if (this.popoverNode.style.visibility === "hidden") {
                        this.dropdownNode.open = false;
                    }
                }
            }
        });
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFieldPickList.style = arcgisFieldPickListCss;

const arcgisSmartMappingActionCss = ".smart-mapping-action-outline{border:#eaeaea 1px solid}";

const ArcgisSmartMappingAction = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.hasOutline = true;
        this.text = undefined;
        this.icon = undefined;
        this.disabled = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    /**
     * Set focus on component
     */
    async setFocus() {
        var _a;
        (_a = this.calciteActionNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    disconnectedCallback() {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.ae)();
    }
    //--------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { class: `${this.hasOutline ? "smart-mapping-action-outline" : ""}`, scale: "s", text: this.text, icon: this.icon, disabled: this.disabled, ref: (node) => (this.calciteActionNode = node), onMouseOver: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.af)(this.calciteActionNode, this.text), onMouseOut: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.ae)(), onFocus: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.af)(this.calciteActionNode, this.text), onFocusout: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.ae)() }));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingAction.style = arcgisSmartMappingActionCss;

const arcgisSmartMappingAttributeInputCss = ".field-select-with-icon{display:flex;width:100%;justify-content:space-between;align-items:stretch;min-width:0}.field-button:focus{z-index:10}.non-simple-field-button{width:calc(100% - 32px)}";

const ArcgisSmartMappingAttributeInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingAttributeInputChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingAttributeInputChange", 7);
        this.arcgisSmartMappingAttributeInputError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingAttributeInputError", 7);
        this.fieldList = undefined;
        this.selectedField = undefined;
        this.label = undefined;
        this.mode = "simple";
        this.popoverReferenceElement = undefined;
        this.hideLabel = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Calls
    //
    //--------------------------------------------------------------------------
    async clear() {
        this.currentField = null;
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    // --------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    // --------------------------------------------------------------------------
    componentWillLoad() {
        this.currentField = this.selectedField;
        if (!this.popoverReferenceElement) {
            this.popoverReferenceElement = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.F)(this.hostElement, "calcite-flow-item");
        }
    }
    componentWillUpdate() {
        // handles rendering the date field correctly when a renderer re-creation fails in arcgis-smart-mapping-age
        if (this.currentField !== this.selectedField) {
            this.currentField = this.selectedField;
        }
    }
    // --------------------------------------------------------------------------
    //
    // Render  Methods
    //
    // --------------------------------------------------------------------------
    render() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        if (this.hideLabel) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-select-with-icon" }, this.renderFieldButton(), this.mode === "remove" && this.currentField && this.renderRemoveButton(), this.mode === "expression" && this.renderArcadeButton()));
        }
        else {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label || strings.attributeInput.attribute, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-select-with-icon" }, this.renderFieldButton(), this.mode === "remove" && this.currentField && this.renderRemoveButton(), this.mode === "expression" && this.renderArcadeButton())));
        }
    }
    renderArcadeButton() {
        var _a;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        const label = this.currentField.field
            ? strings.attributeInput.useExpression
            : strings.attributeInput.useField;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: "smart-mapping-attribute-switch", appearance: "outline-fill", kind: "neutral", iconStart: ((_a = this.currentField) === null || _a === void 0 ? void 0 : _a.field) ? "code" : "brackets-curly", label: label, class: "field-button", onClick: () => this.handleSwitchAttributeType(), ref: (node) => (this.switchButtonNode = node) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "smart-mapping-attribute-switch", label: label }, label)));
    }
    renderFieldButton() {
        var _a, _b, _c, _d, _e, _f;
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        const buttonType = (this.mode === "remove" || this.mode === "expression") && this.currentField
            ? "non-simple-field-button"
            : "";
        const disabled = ((_a = this.currentField) === null || _a === void 0 ? void 0 : _a.field) && this.fieldList.length === 1 && this.mode !== "remove";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { alignment: "icon-end-space-between", appearance: "outline-fill", kind: "neutral", disabled: disabled, iconEnd: ((_b = this.currentField) === null || _b === void 0 ? void 0 : _b.expression) ? "pencil" : disabled ? undefined : "chevron-down", width: "full", class: `field-button ${buttonType}`, onClick: async () => {
                var _a;
                if ((_a = this.currentField) === null || _a === void 0 ? void 0 : _a.expression) {
                    await this.openArcadeEditorModal(this.currentField);
                    this.fieldButtonNode.setFocus();
                }
                else {
                    this.openFieldPickList();
                }
            }, ref: (node) => {
                if (node) {
                    this.fieldButtonNode = node;
                }
            } }, ((_c = this.currentField) === null || _c === void 0 ? void 0 : _c.field)
            ? (_d = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.currentField.field)) === null || _d === void 0 ? void 0 : _d.label
            : ((_e = this.currentField) === null || _e === void 0 ? void 0 : _e.expression)
                ? (_f = this.currentField) === null || _f === void 0 ? void 0 : _f.expressionTitle
                : strings.attributeInput.chooseField));
    }
    renderRemoveButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: "smart-mapping-attribute-switch", appearance: "outline-fill", kind: "neutral", iconStart: "x", label: strings.clear, class: "field-button", onClick: () => this.handleRemoveField() }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: "smart-mapping-attribute-switch", label: strings.clear }, strings.clear)));
    }
    // --------------------------------------------------------------------------
    //
    // Private Methods
    //
    // --------------------------------------------------------------------------
    async handleRemoveField() {
        this.currentField = null;
        this.arcgisSmartMappingAttributeInputChange.emit();
    }
    async handleSwitchAttributeType() {
        var _a, _b;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.E)();
        if ((_a = this.currentField) === null || _a === void 0 ? void 0 : _a.field) {
            // switch to expression
            if ((_b = this.lastSettings) === null || _b === void 0 ? void 0 : _b.expression) {
                const fieldInfo = {
                    expression: this.lastSettings.expression,
                    expressionTitle: this.lastSettings.expressionTitle,
                    simpleFieldType: this.lastSettings.simpleFieldType
                };
                this.currentField.field = null;
                this.currentField = fieldInfo;
                this.arcgisSmartMappingAttributeInputChange.emit(this.currentField);
            }
            else {
                try {
                    await this.openArcadeEditorModal();
                    this.fieldButtonNode.setFocus();
                }
                catch (e) {
                    this.switchButtonNode.setFocus();
                }
            }
        }
        else {
            // switch to field
            this.openFieldPickList();
        }
    }
    async openArcadeEditorModal(fieldInfo) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.E)();
        try {
            fieldInfo = await (0,_feature_1ce1b984_js__WEBPACK_IMPORTED_MODULE_6__.u)(fieldInfo);
            if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.w.STRING) {
                this.arcgisSmartMappingAttributeInputError.emit({
                    message: strings.attributeInput.errors.expressionMustBeNumber,
                    type: "warning"
                });
                return;
            }
            else if (fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.w.UNKNOWN) {
                // let's just assume it's a number; maybe it didn't have good test data
                fieldInfo.simpleFieldType = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.w.NUMBER;
            }
            this.currentField.field = null;
            this.currentField.expression = fieldInfo.expression;
            this.currentField.expressionTitle = fieldInfo.expressionTitle;
            this.currentField.simpleFieldType = fieldInfo.simpleFieldType;
            this.arcgisSmartMappingAttributeInputChange.emit(this.currentField);
            return new Promise((resolve) => {
                resolve();
            });
        }
        catch (e) {
            return new Promise((__, reject) => {
                reject();
            });
        }
    }
    openFieldPickList() {
        const { layer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.s;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.E)();
        const fieldPickList = document.createElement("arcgis-field-pick-list");
        fieldPickList.fields = this.fieldList.map((field) => {
            return {
                name: field.layerField.name,
                alias: field.label,
                type: field.simpleFieldType,
                description: "description" in field.layerField ? field.layerField.description : undefined
            };
        });
        if (this.currentField) {
            fieldPickList.heading = strings.replaceField;
            fieldPickList.selectedFields = [this.currentField.field];
        }
        else {
            fieldPickList.heading = strings.addField;
        }
        fieldPickList.popoverProps = {
            refElement: this.popoverReferenceElement,
            placement: "leading",
            offsetDistance: 0,
            popoverWidth: this.popoverReferenceElement.getBoundingClientRect().width * 1.05,
            overlayPositioning: "absolute",
            flipDisabled: false,
            triggerDisabled: false
        };
        fieldPickList.layer = layer;
        fieldPickList.mapView = mapView;
        fieldPickList.showFieldInfo = true;
        fieldPickList.sortBy = this.lastFieldSortBy;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.L)(this.popoverReferenceElement, true);
        document.body.appendChild(fieldPickList);
        fieldPickList.addEventListener("arcgisFieldPickListSortByChange", (event) => {
            this.lastFieldSortBy = event.detail;
        });
        fieldPickList.addEventListener("arcgisFieldPickListDismissed", (event) => {
            var _a, _b;
            if ((_a = event.detail) === null || _a === void 0 ? void 0 : _a.selectedFields) {
                const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.u)(event.detail.selectedFields[0]);
                const fieldInfo = {
                    field: field.layerField.name,
                    simpleFieldType: field.simpleFieldType
                };
                if ((_b = this.currentField) === null || _b === void 0 ? void 0 : _b.expression) {
                    this.lastSettings = {
                        expression: this.currentField.expression,
                        expressionTitle: this.currentField.expressionTitle,
                        simpleFieldType: this.currentField.simpleFieldType
                    };
                }
                this.currentField = fieldInfo;
                this.arcgisSmartMappingAttributeInputChange.emit(this.currentField);
            }
            this.fieldButtonNode.setFocus();
            document.body.removeChild(fieldPickList);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_4__.L)(this.popoverReferenceElement, false);
        });
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingAttributeInput.style = arcgisSmartMappingAttributeInputCss;



//# sourceMappingURL=arcgis-field-pick-list_3.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTU2M2FmMC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDOEk7QUFDOUU7QUFDdUI7QUFDakI7QUFDc0s7QUFDek07QUFDMEI7QUFDbEM7QUFDRTtBQUNVOztBQUV2Qyx5Q0FBeUMsWUFBWSxPQUFPLGlCQUFpQixTQUFTLGdCQUFnQixzQkFBc0IsaUJBQWlCOztBQUU3STtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsNENBQTRDLHFEQUFXO0FBQ3ZELHlDQUF5QyxxREFBVztBQUNwRCwrQ0FBK0MscURBQVc7QUFDMUQsNENBQTRDLHFEQUFDLDZCQUE2QjtBQUMxRTtBQUNBLDZCQUE2QixFQUFFLFlBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxlQUFlLHFDQUFxQyxxREFBQyxxQkFBcUI7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1REFBVztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHNEQUF5QjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FB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O0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsbUVBQVE7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1FQUFZO0FBQ3hCLFNBQVM7QUFDVDtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRTRMOztBQUU1TCIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1maWVsZC1waWNrLWxpc3RfMy5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQsIGYgYXMgZm9yY2VVcGRhdGUsIEYgYXMgRnJhZ21lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0RWxlbWVudERpciB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IEwgYXMgTGFzdFNvcnR5QnksIGYgYXMgZmllbGRJbmZvUHJlZml4RW51bSB9IGZyb20gJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgYWUgYXMgcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCwgYWYgYXMgYWRkU21hcnRNYXBwaW5nVG9vbHRpcCwgRiBhcyBmaW5kUGFyZW50Tm9kZSwgdSBhcyBnZXRGaWVsZCwgRSBhcyBjbG9zZVBvcG92ZXJzLCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIEwgYXMgZGlzYWJsZVBhbmVsLCBzIGFzIHNtYXJ0TWFwcGluZ1N0YXRlIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyB1IGFzIHVzZUFyY2FkZUVkaXRvciB9IGZyb20gJy4vZmVhdHVyZS0xY2UxYjk4NC5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcblxuY29uc3QgYXJjZ2lzRmllbGRQaWNrTGlzdENzcyA9IFwiLnBvcG92ZXJ7ei1pbmRleDoxMDB9LnBhbmVse21pbi1oZWlnaHQ6MzAwcHh9LmNvbnRlbnR7bWF4LWhlaWdodDo2MHZofS5zZWxlY3Rpb24tYnV0dG9uLWRpdntwYWRkaW5nOjRweCAxMHB4fVwiO1xuXG5jb25zdCBBcmNnaXNGaWVsZFBpY2tMaXN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3RDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ZpZWxkUGlja0xpc3RDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdFNvcnRCeUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzRmllbGRQaWNrTGlzdFNvcnRCeUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5jYWxjaXRlVmFsdWVMaXN0ID0gKGZpZWxkKSA9PiAoaChcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIiwgeyBrZXk6IGZpZWxkLm5hbWUsIGxhYmVsOiBmaWVsZC5hbGlhcyB8fCBmaWVsZC5uYW1lLCBkZXNjcmlwdGlvbjogKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG93RmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgeyR7ZmllbGQubmFtZX19YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0Rlc2NyaXB0aW9uICYmIGZpZWxkLmRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9KSgpLCB2YWx1ZTogZmllbGQubmFtZSwgc2VsZWN0ZWQ6ICghdGhpcy5tdWx0aXBsZSAmJiBmaWVsZC5uYW1lID09PSB0aGlzLnNlbGVjdGVkRmllbGRzWzBdKSB8fFxuICAgICAgICAgICAgICAgICh0aGlzLm11bHRpcGxlICYmIHRoaXMuc2VsZWN0ZWRGaWVsZHMuaW5kZXhPZihmaWVsZC5uYW1lKSA+IC0xKSwgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogZmllbGQuYWxpYXMsXG4gICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lXG4gICAgICAgICAgICB9IH0sIHRoaXMuc2hvd0ZpZWxkSW5mb0NoZWNrKGZpZWxkKSAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2xvdDogXCJhY3Rpb25zLWVuZFwiLCB0ZXh0OiB0aGlzLnN0cmluZ3MuaW5mbywgdGl0bGU6IHRoaXMuc3RyaW5ncy5pbmZvLCBzY2FsZTogXCJzXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm9GbG93SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm9GbG93SXRlbS5oZWFkaW5nID0gKF9hID0gZmllbGQuYWxpYXMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGZpZWxkLm5hbWU7XG4gICAgICAgICAgICAgICAgZmllbGRJbmZvRmxvd0l0ZW0uZGVzY3JpcHRpb24gPSBmaWVsZC5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZmllbGQtaW5mb1wiKTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8ubGFuZyA9IHRoaXMuY3VycmVudExhbmd1YWdlSW50bDtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8uZmllbGROYW1lID0gZmllbGQubmFtZTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8ubGF5ZXIgPSB0aGlzLmxheWVyO1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mby52aWV3ID0gdGhpcy5tYXBWaWV3O1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mby5jbGFzc0xpc3QuYWRkKFwiY29udGVudFwiKTtcbiAgICAgICAgICAgICAgICBmaWVsZEluZm9GbG93SXRlbS5hcHBlbmRDaGlsZChmaWVsZEluZm8pO1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mb0Zsb3dJdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlRmxvd0l0ZW1CYWNrXCIsICgpID0+IHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IGFjdGlvbi5zZXRGb2N1cygpKSwgMjAwKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5mbG93RWxlbWVudC5hcHBlbmRDaGlsZChmaWVsZEluZm9GbG93SXRlbSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gZmllbGRJbmZvRmxvd0l0ZW0uc2V0Rm9jdXMoKSksIDIwMCk7XG4gICAgICAgICAgICB9IH0pKSkpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRzID0gW107XG4gICAgICAgIHRoaXMuZmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcG92ZXJQcm9wcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dGaWVsZEluZm8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93RmllbGROYW1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd0Rlc2NyaXB0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd1NlbGVjdGlvbkFsbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNob3dDYW5jZWwgPSB0cnVlO1xuICAgICAgICB0aGlzLnNob3dTb3J0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93RmlsdGVyTGVuZ3RoID0gMTA7XG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oZWFkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9rQnRuVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWx0ZXJQbGFjZWhvbGRlclRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc29ydEJ5ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gTGFzdFNvcnR5QnkuZGVmYXVsdDtcbiAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHMgPSBudWxsO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgbG9jYWxlU2V0dGluZ3MgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVTZXR0aW5nc1swXTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2UgPSBsb2NhbGVTZXR0aW5nc1sxXTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2VJbnRsID0gbG9jYWxlU2V0dGluZ3NbMl07XG4gICAgICAgIC8vIGluIGNhc2UgbW9yZSB0aGFuIDEgc2VsZWN0ZWQgZmllbGQgYW5kIG11bHRpcGxlIGlzIHNldCB0byBmYWxzZVxuICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUgJiYgdGhpcy5zZWxlY3RlZEZpZWxkcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRzID0gW3RoaXMuc2VsZWN0ZWRGaWVsZHNbMF1dO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFzdFNvcnR5QnkgPSB0aGlzLnNvcnRCeSB8fCB0aGlzLmxhc3RTb3J0eUJ5O1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLnNldFVwT2JzZXJ2ZXIoKTtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5vcGVuID0gdHJ1ZTtcbiAgICAgICAgLy8gbmVlZCB0aW1lb3V0IGJlY2F1c2Ugb2YgcmUtcmVuZGVyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMucGFuZWxFbGVtZW50LnNldEZvY3VzKCkpLCAyMDApO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLm9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICAvLyB0ZW1wOiBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWNvbXBvbmVudHMvaXNzdWVzLzQzMzNcbiAgICBjYWxjaXRlRmlsdGVyQ2hhbmdlSGFuZGxlcihldmVudCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgZmlsdGVyTm9kZSA9IChfYSA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5wYXRoKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgoaXRlbSkgPT4gaXRlbS5ub2RlTmFtZSA9PT0gXCJDQUxDSVRFLUZJTFRFUlwiKTtcbiAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHMgPSAoX2IgPSBmaWx0ZXJOb2RlID09PSBudWxsIHx8IGZpbHRlck5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbHRlck5vZGUuZmlsdGVyZWRJdGVtcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMucGFuZWxFbGVtZW50LnNldEZvY3VzKCkpLCAxKTtcbiAgICB9XG4gICAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGdldFNvcnRlZExpc3QoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBTb3J0ZWQgPSBbLi4udGhpcy5maWVsZHNdO1xuICAgICAgICBpZiAodGhpcy5sYXN0U29ydHlCeSA9PT0gTGFzdFNvcnR5QnkuZGlzcGxheSkge1xuICAgICAgICAgICAgdGVtcFNvcnRlZC5zb3J0KChhLCBiKSA9PiBhLmFsaWFzLmxvY2FsZUNvbXBhcmUoYi5hbGlhcykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdFNvcnR5QnkgPT09IExhc3RTb3J0eUJ5LmZpZWxkKSB7XG4gICAgICAgICAgICB0ZW1wU29ydGVkLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdFNvcnR5QnkgPT09IExhc3RTb3J0eUJ5LnR5cGUpIHtcbiAgICAgICAgICAgIHRlbXBTb3J0ZWQuc29ydCgoYSwgYikgPT4gYS50eXBlLmxvY2FsZUNvbXBhcmUoYi50eXBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRlbXBTb3J0ZWQ7XG4gICAgfVxuICAgIHNob3dGaWVsZEluZm9DaGVjayhmaWVsZCkge1xuICAgICAgICBpZiAodGhpcy5zaG93RmllbGRJbmZvKSB7XG4gICAgICAgICAgICAvLyBkb250IHdhbnQgaW5mbyBmb3IgYXJjYWRlIGFuZCByZWxhdGlvbiBmaWVsZHNcbiAgICAgICAgICAgIGlmIChmaWVsZC5uYW1lLmluY2x1ZGVzKGZpZWxkSW5mb1ByZWZpeEVudW0uZXhwcmVzc2lvbikgfHxcbiAgICAgICAgICAgICAgICBmaWVsZC5uYW1lLmluY2x1ZGVzKGZpZWxkSW5mb1ByZWZpeEVudW0ucmVsYXRpb25zaGlwKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIHJldHVybiB0cnVlIGZvciBkZXNlbGVjdCBhbGwsIGZhbHNlIGZvciBzZWxlY3QgYWxsXG4gICAgc2VsZWN0RGVzZWxlY3QoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmZpbHRlckZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aClcbiAgICAgICAgICAgID8gdGhpcy5maWx0ZXJDb250YWluc0FsbCgpXG4gICAgICAgICAgICA6IHRoaXMuc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSB0aGlzLmZpZWxkcy5sZW5ndGg7XG4gICAgfVxuICAgIC8vIGNoZWNrIGlmIGZpbHRlciBoYXMgYWxsIGN1cnJlbnQgZmllbGQgaW5mb1xuICAgIGZpbHRlckNvbnRhaW5zQWxsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJGaWVsZHMuZXZlcnkoKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRGaWVsZHMuc29tZSgoY3VycikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyID09PSBmaWx0ZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kb3IgIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGFkZEJ0biA9IChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBhcHBlYXJhbmNlOiB0aGlzLnNob3dDYW5jZWwgPyBcInNvbGlkXCIgOiBcIm91dGxpbmUtZmlsbFwiLCB3aWR0aDogdGhpcy5zaG93Q2FuY2VsID8gXCJoYWxmXCIgOiBcImZ1bGxcIiwgc2NhbGU6IFwibVwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkLmVtaXQoeyBzZWxlY3RlZEZpZWxkczogdGhpcy5zZWxlY3RlZEZpZWxkcyB9KTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5va0J0blRleHQgfHwgKHRoaXMubXVsdGlwbGUgPyB0aGlzLnN0cmluZ3MuZG9uZSA6IHRoaXMuc3RyaW5ncy5vaykpKTtcbiAgICAgICAgY29uc3QgY2FuY2VsQnRuID0gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiB0aGlzLm11bHRpcGxlID8gXCJoYWxmXCIgOiBcImZ1bGxcIiwgc2NhbGU6IFwibVwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3REaXNtaXNzZWQuZW1pdCgpIH0sIHRoaXMuc3RyaW5ncy5jYW5jZWwpKTtcbiAgICAgICAgY29uc3QgaGFzVHlwZSA9IHRoaXMuZmllbGRzLmV2ZXJ5KChmaWVsZCkgPT4gISFmaWVsZC50eXBlKTtcbiAgICAgICAgY29uc3Qgc29ydCA9IChoKFwiY2FsY2l0ZS1kcm9wZG93blwiLCB7IHNsb3Q6IFwibWVudS1hY3Rpb25zXCIsIHBsYWNlbWVudDogXCJib3R0b20tZW5kXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCByZWY6IChub2RlKSA9PiAodGhpcy5kcm9wZG93bk5vZGUgPSBub2RlKSwgb25DYWxjaXRlRHJvcGRvd25PcGVuOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIChfYSA9IHRoaXMub2JzZXJ2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vYnNlcnZlci5vYnNlcnZlKHRoaXMucG9wb3Zlck5vZGUsIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZURyb3Bkb3duQ2xvc2U6ICgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5vYnNlcnZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRpc2Nvbm5lY3QoKTsgfSB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcInRyaWdnZXJcIiwgdGV4dDogdGhpcy5zdHJpbmdzLnNvcnQsIHRpdGxlOiB0aGlzLnN0cmluZ3Muc29ydCB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcInNvcnREZXNjZW5kaW5nXCIgfSkpLCBoKFwiY2FsY2l0ZS1kcm9wZG93bi1ncm91cFwiLCBudWxsLCBoKFwiY2FsY2l0ZS1kcm9wZG93bi1pdGVtXCIsIHsgc2VsZWN0ZWQ6IHRoaXMubGFzdFNvcnR5QnkgPT09IExhc3RTb3J0eUJ5LmRlZmF1bHQsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gTGFzdFNvcnR5QnkuZGVmYXVsdDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3RTb3J0QnlDaGFuZ2UuZW1pdCh0aGlzLmxhc3RTb3J0eUJ5KTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLmRlZmF1bHQpLCBoKFwiY2FsY2l0ZS1kcm9wZG93bi1pdGVtXCIsIHsgc2VsZWN0ZWQ6IHRoaXMubGFzdFNvcnR5QnkgPT09IExhc3RTb3J0eUJ5LmRpc3BsYXksIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gTGFzdFNvcnR5QnkuZGlzcGxheTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3RTb3J0QnlDaGFuZ2UuZW1pdCh0aGlzLmxhc3RTb3J0eUJ5KTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLmRpc3BsYXlOYW1lKSwgaGFzVHlwZSAmJiAoaChcImNhbGNpdGUtZHJvcGRvd24taXRlbVwiLCB7IHNlbGVjdGVkOiB0aGlzLmxhc3RTb3J0eUJ5ID09PSBMYXN0U29ydHlCeS50eXBlLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U29ydHlCeSA9IExhc3RTb3J0eUJ5LnR5cGU7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydHlCeSk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy50eXBlKSksIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogdGhpcy5sYXN0U29ydHlCeSA9PT0gTGFzdFNvcnR5QnkuZmllbGQsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTb3J0eUJ5ID0gTGFzdFNvcnR5QnkuZmllbGQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlLmVtaXQodGhpcy5sYXN0U29ydHlCeSk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy5maWVsZE5hbWUpKSkpO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25CdG4gPSAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlbGVjdGlvbi1idXR0b24tZGl2XCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0RGVzZWxlY3QoKSkge1xuICAgICAgICAgICAgICAgICAgICAvL2Rlc2VsZWN0IGFsbFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRzID0gKChfYSA9IHRoaXMuZmlsdGVyRmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnNlbGVjdGVkRmllbGRzLmZpbHRlcigoaXRlbSkgPT4gIXRoaXMuZmlsdGVyRmllbGRzLmluY2x1ZGVzKGl0ZW0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vc2VsZWN0IGFsbFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRzID0gKChfYiA9IHRoaXMuZmlsdGVyRmllbGRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBbLi4ubmV3IFNldChbLi4udGhpcy5zZWxlY3RlZEZpZWxkcywgLi4udGhpcy5maWx0ZXJGaWVsZHNdKV1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5maWVsZHMubWFwKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCB0aGlzLnNlbGVjdERlc2VsZWN0KCkgPyB0aGlzLnN0cmluZ3MuZGVzZWxlY3RBbGwgOiB0aGlzLnN0cmluZ3Muc2VsZWN0QWxsKSkpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGRpcjogZ2V0RWxlbWVudERpcih0aGlzLmhvc3RFbGVtZW50KSwgY2xhc3M6IFwicG9wb3ZlclwiLCBwbGFjZW1lbnQ6IHRoaXMucG9wb3ZlclByb3BzLnBsYWNlbWVudCB8fCBcImxlYWRpbmctc3RhcnRcIiwgb3BlbjogZmFsc2UsIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudCwgb2Zmc2V0RGlzdGFuY2U6IHRoaXMucG9wb3ZlclByb3BzLm9mZnNldERpc3RhbmNlIHx8XG4gICAgICAgICAgICAgICAgLU1hdGgucm91bmQodGhpcy5wb3BvdmVyUHJvcHMucmVmRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksIG9mZnNldFNraWRkaW5nOiB0aGlzLnBvcG92ZXJQcm9wcy5vZmZzZXRTa2lkZGluZyB8fCAwLCBvdmVybGF5UG9zaXRpb25pbmc6IHRoaXMucG9wb3ZlclByb3BzLm92ZXJsYXlQb3NpdGlvbmluZywgdHJpZ2dlckRpc2FibGVkOiB0aGlzLnBvcG92ZXJQcm9wcy50cmlnZ2VyRGlzYWJsZWQsIGF1dG9DbG9zZTogdGhpcy5wb3BvdmVyUHJvcHMuYXV0b0Nsb3NlLCBsYWJlbDogdGhpcy5oZWFkaW5nIHx8ICh0aGlzLm11bHRpcGxlID8gdGhpcy5zdHJpbmdzLmhlYWRlclNlbGVjdCA6IHRoaXMuc3RyaW5ncy5oZWFkZXIpLCBvbkNhbGNpdGVQb3BvdmVyQ2xvc2U6ICgpID0+IHRoaXMuYXJjZ2lzRmllbGRQaWNrTGlzdERpc21pc3NlZC5lbWl0KCksIHJlZjogKG5vZGUpID0+ICh0aGlzLnBvcG92ZXJOb2RlID0gbm9kZSkgfSwgaChcImNhbGNpdGUtZmxvd1wiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dFbGVtZW50ID0gbm9kZTtcbiAgICAgICAgICAgIH0sIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke3RoaXMucG9wb3ZlclByb3BzLnBvcG92ZXJXaWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJQcm9wcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRofXB4YFxuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyByZWY6IChlbCkgPT4gKHRoaXMucGFuZWxFbGVtZW50ID0gZWwpLCBjbGFzczogXCJwYW5lbFwiLCBoZWFkaW5nOiB0aGlzLmhlYWRpbmcgfHwgKHRoaXMubXVsdGlwbGUgPyB0aGlzLnN0cmluZ3MuaGVhZGVyU2VsZWN0IDogdGhpcy5zdHJpbmdzLmhlYWRlciksIGNsb3NhYmxlOiB0cnVlLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoKSA9PiB0aGlzLmFyY2dpc0ZpZWxkUGlja0xpc3REaXNtaXNzZWQuZW1pdCgpIH0sIHRoaXMubXVsdGlwbGUgJiYgYWRkQnRuLCB0aGlzLnNob3dDYW5jZWwgJiYgY2FuY2VsQnRuLCBoKFwiY2FsY2l0ZS1waWNrLWxpc3RcIiwgeyBtdWx0aXBsZTogdGhpcy5tdWx0aXBsZSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGlja0xpc3ROb2RlID0gbm9kZTtcbiAgICAgICAgICAgIH0sIGNsYXNzOiBcImNvbnRlbnRcIiwgZmlsdGVyRW5hYmxlZDogdGhpcy5maWVsZHMubGVuZ3RoID49IHRoaXMuc2hvd0ZpbHRlckxlbmd0aCA/IHRydWUgOiBmYWxzZSwgZmlsdGVyUGxhY2Vob2xkZXI6IChfYSA9IHRoaXMuZmlsdGVyUGxhY2Vob2xkZXJUZXh0KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB0aGlzLnN0cmluZ3MuZmlsdGVyLCBvbkNhbGNpdGVMaXN0Q2hhbmdlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8ga2VlcCBvcmlnaW5hbCBvcmRlci4gQWRkIGFkZGlvbmFsIHZhbHVlcyBhdCB0aGUgZW5kXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcFNlbGVjdGVkRmllbGRzID0gYXdhaXQgdGhpcy5waWNrTGlzdE5vZGUuZ2V0U2VsZWN0ZWRJdGVtcygpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZHMgPSBbXG4gICAgICAgICAgICAgICAgICAgIC4uLm5ldyBTZXQoW1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5zZWxlY3RlZEZpZWxkcy5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcFNlbGVjdGVkRmllbGRzLmhhcyhpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4udGVtcFNlbGVjdGVkRmllbGRzLmtleXMoKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0Q2hhbmdlLmVtaXQoeyBzZWxlY3RlZEZpZWxkczogdGhpcy5zZWxlY3RlZEZpZWxkcyB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkLmVtaXQoeyBzZWxlY3RlZEZpZWxkczogdGhpcy5zZWxlY3RlZEZpZWxkcyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIHRoaXMuZmllbGRzLmxlbmd0aCA+PSB0aGlzLnNob3dGaWx0ZXJMZW5ndGggJiYgdGhpcy5zaG93U29ydCAmJiBzb3J0LCB0aGlzLm11bHRpcGxlICYmIHRoaXMuc2hvd1NlbGVjdGlvbkFsbCAmJiBzZWxlY3Rpb25CdG4sIFsuLi50aGlzLmdldFNvcnRlZExpc3QoKV0ubWFwKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FsY2l0ZVZhbHVlTGlzdChmaWVsZCk7XG4gICAgICAgIH0pKSkpKSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSAgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBzZXRVcE9ic2VydmVyKCkge1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uTGlzdCAvKiAsIG9ic2VydmVyICovKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9uTGlzdCkge1xuICAgICAgICAgICAgICAgIGlmIChtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSBcInN0eWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucG9wb3Zlck5vZGUuc3R5bGUudmlzaWJpbGl0eSA9PT0gXCJoaWRkZW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bk5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0ZpZWxkUGlja0xpc3Quc3R5bGUgPSBhcmNnaXNGaWVsZFBpY2tMaXN0Q3NzO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdBY3Rpb25Dc3MgPSBcIi5zbWFydC1tYXBwaW5nLWFjdGlvbi1vdXRsaW5le2JvcmRlcjojZWFlYWVhIDFweCBzb2xpZH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nQWN0aW9uID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5oYXNPdXRsaW5lID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50ZXh0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmljb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLyoqXG4gICAgICogU2V0IGZvY3VzIG9uIGNvbXBvbmVudFxuICAgICAqL1xuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMuY2FsY2l0ZUFjdGlvbk5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgY2xhc3M6IGAke3RoaXMuaGFzT3V0bGluZSA/IFwic21hcnQtbWFwcGluZy1hY3Rpb24tb3V0bGluZVwiIDogXCJcIn1gLCBzY2FsZTogXCJzXCIsIHRleHQ6IHRoaXMudGV4dCwgaWNvbjogdGhpcy5pY29uLCBkaXNhYmxlZDogdGhpcy5kaXNhYmxlZCwgcmVmOiAobm9kZSkgPT4gKHRoaXMuY2FsY2l0ZUFjdGlvbk5vZGUgPSBub2RlKSwgb25Nb3VzZU92ZXI6ICgpID0+IGFkZFNtYXJ0TWFwcGluZ1Rvb2x0aXAodGhpcy5jYWxjaXRlQWN0aW9uTm9kZSwgdGhpcy50ZXh0KSwgb25Nb3VzZU91dDogKCkgPT4gcmVtb3ZlU21hcnRNYXBwaW5nVG9vbHRpcCgpLCBvbkZvY3VzOiAoKSA9PiBhZGRTbWFydE1hcHBpbmdUb29sdGlwKHRoaXMuY2FsY2l0ZUFjdGlvbk5vZGUsIHRoaXMudGV4dCksIG9uRm9jdXNvdXQ6ICgpID0+IHJlbW92ZVNtYXJ0TWFwcGluZ1Rvb2x0aXAoKSB9KSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdBY3Rpb24uc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdBY3Rpb25Dc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q3NzID0gXCIuZmllbGQtc2VsZWN0LXdpdGgtaWNvbntkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJTtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpzdHJldGNoO21pbi13aWR0aDowfS5maWVsZC1idXR0b246Zm9jdXN7ei1pbmRleDoxMH0ubm9uLXNpbXBsZS1maWVsZC1idXR0b257d2lkdGg6Y2FsYygxMDAlIC0gMzJweCl9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRFcnJvclwiLCA3KTtcbiAgICAgICAgdGhpcy5maWVsZExpc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tb2RlID0gXCJzaW1wbGVcIjtcbiAgICAgICAgdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oaWRlTGFiZWwgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBDYWxsc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRGaWVsZCA9IG51bGw7XG4gICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RmllbGQgPSB0aGlzLnNlbGVjdGVkRmllbGQ7XG4gICAgICAgIGlmICghdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVwZGF0ZSgpIHtcbiAgICAgICAgLy8gaGFuZGxlcyByZW5kZXJpbmcgdGhlIGRhdGUgZmllbGQgY29ycmVjdGx5IHdoZW4gYSByZW5kZXJlciByZS1jcmVhdGlvbiBmYWlscyBpbiBhcmNnaXMtc21hcnQtbWFwcGluZy1hZ2VcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEZpZWxkICE9PSB0aGlzLnNlbGVjdGVkRmllbGQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpZWxkID0gdGhpcy5zZWxlY3RlZEZpZWxkO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBSZW5kZXIgIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAodGhpcy5oaWRlTGFiZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkLXNlbGVjdC13aXRoLWljb25cIiB9LCB0aGlzLnJlbmRlckZpZWxkQnV0dG9uKCksIHRoaXMubW9kZSA9PT0gXCJyZW1vdmVcIiAmJiB0aGlzLmN1cnJlbnRGaWVsZCAmJiB0aGlzLnJlbmRlclJlbW92ZUJ1dHRvbigpLCB0aGlzLm1vZGUgPT09IFwiZXhwcmVzc2lvblwiICYmIHRoaXMucmVuZGVyQXJjYWRlQnV0dG9uKCkpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5sYWJlbCB8fCBzdHJpbmdzLmF0dHJpYnV0ZUlucHV0LmF0dHJpYnV0ZSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkLXNlbGVjdC13aXRoLWljb25cIiB9LCB0aGlzLnJlbmRlckZpZWxkQnV0dG9uKCksIHRoaXMubW9kZSA9PT0gXCJyZW1vdmVcIiAmJiB0aGlzLmN1cnJlbnRGaWVsZCAmJiB0aGlzLnJlbmRlclJlbW92ZUJ1dHRvbigpLCB0aGlzLm1vZGUgPT09IFwiZXhwcmVzc2lvblwiICYmIHRoaXMucmVuZGVyQXJjYWRlQnV0dG9uKCkpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyQXJjYWRlQnV0dG9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5jdXJyZW50RmllbGQuZmllbGRcbiAgICAgICAgICAgID8gc3RyaW5ncy5hdHRyaWJ1dGVJbnB1dC51c2VFeHByZXNzaW9uXG4gICAgICAgICAgICA6IHN0cmluZ3MuYXR0cmlidXRlSW5wdXQudXNlRmllbGQ7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImRpdlwiLCBudWxsLCBcIlxcdTAwQTBcIiksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGlkOiBcInNtYXJ0LW1hcHBpbmctYXR0cmlidXRlLXN3aXRjaFwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvblN0YXJ0OiAoKF9hID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWVsZCkgPyBcImNvZGVcIiA6IFwiYnJhY2tldHMtY3VybHlcIiwgbGFiZWw6IGxhYmVsLCBjbGFzczogXCJmaWVsZC1idXR0b25cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVTd2l0Y2hBdHRyaWJ1dGVUeXBlKCksIHJlZjogKG5vZGUpID0+ICh0aGlzLnN3aXRjaEJ1dHRvbk5vZGUgPSBub2RlKSB9KSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IHJlZmVyZW5jZUVsZW1lbnQ6IFwic21hcnQtbWFwcGluZy1hdHRyaWJ1dGUtc3dpdGNoXCIsIGxhYmVsOiBsYWJlbCB9LCBsYWJlbCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGRCdXR0b24oKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBidXR0b25UeXBlID0gKHRoaXMubW9kZSA9PT0gXCJyZW1vdmVcIiB8fCB0aGlzLm1vZGUgPT09IFwiZXhwcmVzc2lvblwiKSAmJiB0aGlzLmN1cnJlbnRGaWVsZFxuICAgICAgICAgICAgPyBcIm5vbi1zaW1wbGUtZmllbGQtYnV0dG9uXCJcbiAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgY29uc3QgZGlzYWJsZWQgPSAoKF9hID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWVsZCkgJiYgdGhpcy5maWVsZExpc3QubGVuZ3RoID09PSAxICYmIHRoaXMubW9kZSAhPT0gXCJyZW1vdmVcIjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhbGlnbm1lbnQ6IFwiaWNvbi1lbmQtc3BhY2UtYmV0d2VlblwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgZGlzYWJsZWQ6IGRpc2FibGVkLCBpY29uRW5kOiAoKF9iID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5leHByZXNzaW9uKSA/IFwicGVuY2lsXCIgOiBkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IFwiY2hldnJvbi1kb3duXCIsIHdpZHRoOiBcImZ1bGxcIiwgY2xhc3M6IGBmaWVsZC1idXR0b24gJHtidXR0b25UeXBlfWAsIG9uQ2xpY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMuY3VycmVudEZpZWxkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9wZW5BcmNhZGVFZGl0b3JNb2RhbCh0aGlzLmN1cnJlbnRGaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRCdXR0b25Ob2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5GaWVsZFBpY2tMaXN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRCdXR0b25Ob2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sICgoX2MgPSB0aGlzLmN1cnJlbnRGaWVsZCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZpZWxkKVxuICAgICAgICAgICAgPyAoX2QgPSBnZXRGaWVsZCh0aGlzLmN1cnJlbnRGaWVsZC5maWVsZCkpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5sYWJlbFxuICAgICAgICAgICAgOiAoKF9lID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5leHByZXNzaW9uKVxuICAgICAgICAgICAgICAgID8gKF9mID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5leHByZXNzaW9uVGl0bGVcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MuYXR0cmlidXRlSW5wdXQuY2hvb3NlRmllbGQpKTtcbiAgICB9XG4gICAgcmVuZGVyUmVtb3ZlQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJkaXZcIiwgbnVsbCwgXCJcXHUwMEEwXCIpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBpZDogXCJzbWFydC1tYXBwaW5nLWF0dHJpYnV0ZS1zd2l0Y2hcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25TdGFydDogXCJ4XCIsIGxhYmVsOiBzdHJpbmdzLmNsZWFyLCBjbGFzczogXCJmaWVsZC1idXR0b25cIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVSZW1vdmVGaWVsZCgpIH0pLCBoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogXCJzbWFydC1tYXBwaW5nLWF0dHJpYnV0ZS1zd2l0Y2hcIiwgbGFiZWw6IHN0cmluZ3MuY2xlYXIgfSwgc3RyaW5ncy5jbGVhcikpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFByaXZhdGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBoYW5kbGVSZW1vdmVGaWVsZCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RmllbGQgPSBudWxsO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q2hhbmdlLmVtaXQoKTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlU3dpdGNoQXR0cmlidXRlVHlwZSgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBpZiAoKF9hID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWVsZCkge1xuICAgICAgICAgICAgLy8gc3dpdGNoIHRvIGV4cHJlc3Npb25cbiAgICAgICAgICAgIGlmICgoX2IgPSB0aGlzLmxhc3RTZXR0aW5ncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHRoaXMubGFzdFNldHRpbmdzLmV4cHJlc3Npb24sXG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogdGhpcy5sYXN0U2V0dGluZ3MuZXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHRoaXMubGFzdFNldHRpbmdzLnNpbXBsZUZpZWxkVHlwZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmllbGQuZmllbGQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEZpZWxkID0gZmllbGRJbmZvO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRDaGFuZ2UuZW1pdCh0aGlzLmN1cnJlbnRGaWVsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9wZW5BcmNhZGVFZGl0b3JNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkQnV0dG9uTm9kZS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaEJ1dHRvbk5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBzd2l0Y2ggdG8gZmllbGRcbiAgICAgICAgICAgIHRoaXMub3BlbkZpZWxkUGlja0xpc3QoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBvcGVuQXJjYWRlRWRpdG9yTW9kYWwoZmllbGRJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZpZWxkSW5mbyA9IGF3YWl0IHVzZUFyY2FkZUVkaXRvcihmaWVsZEluZm8pO1xuICAgICAgICAgICAgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuU1RSSU5HKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dEVycm9yLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBzdHJpbmdzLmF0dHJpYnV0ZUlucHV0LmVycm9ycy5leHByZXNzaW9uTXVzdEJlTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuVU5LTk9XTikge1xuICAgICAgICAgICAgICAgIC8vIGxldCdzIGp1c3QgYXNzdW1lIGl0J3MgYSBudW1iZXI7IG1heWJlIGl0IGRpZG4ndCBoYXZlIGdvb2QgdGVzdCBkYXRhXG4gICAgICAgICAgICAgICAgZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSA9IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmllbGQuZmllbGQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmllbGQuZXhwcmVzc2lvbiA9IGZpZWxkSW5mby5leHByZXNzaW9uO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmllbGQuZXhwcmVzc2lvblRpdGxlID0gZmllbGRJbmZvLmV4cHJlc3Npb25UaXRsZTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpZWxkLnNpbXBsZUZpZWxkVHlwZSA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGU7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q2hhbmdlLmVtaXQodGhpcy5jdXJyZW50RmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoX18sIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb3BlbkZpZWxkUGlja0xpc3QoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgIGNvbnN0IGZpZWxkUGlja0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZpZWxkLXBpY2stbGlzdFwiKTtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5maWVsZHMgPSB0aGlzLmZpZWxkTGlzdC5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IGZpZWxkLmxheWVyRmllbGQubmFtZSxcbiAgICAgICAgICAgICAgICBhbGlhczogZmllbGQubGFiZWwsXG4gICAgICAgICAgICAgICAgdHlwZTogZmllbGQuc2ltcGxlRmllbGRUeXBlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcImRlc2NyaXB0aW9uXCIgaW4gZmllbGQubGF5ZXJGaWVsZCA/IGZpZWxkLmxheWVyRmllbGQuZGVzY3JpcHRpb24gOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50RmllbGQpIHtcbiAgICAgICAgICAgIGZpZWxkUGlja0xpc3QuaGVhZGluZyA9IHN0cmluZ3MucmVwbGFjZUZpZWxkO1xuICAgICAgICAgICAgZmllbGRQaWNrTGlzdC5zZWxlY3RlZEZpZWxkcyA9IFt0aGlzLmN1cnJlbnRGaWVsZC5maWVsZF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaWVsZFBpY2tMaXN0LmhlYWRpbmcgPSBzdHJpbmdzLmFkZEZpZWxkO1xuICAgICAgICB9XG4gICAgICAgIGZpZWxkUGlja0xpc3QucG9wb3ZlclByb3BzID0ge1xuICAgICAgICAgICAgcmVmRWxlbWVudDogdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCxcbiAgICAgICAgICAgIHBsYWNlbWVudDogXCJsZWFkaW5nXCIsXG4gICAgICAgICAgICBvZmZzZXREaXN0YW5jZTogMCxcbiAgICAgICAgICAgIHBvcG92ZXJXaWR0aDogdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAqIDEuMDUsXG4gICAgICAgICAgICBvdmVybGF5UG9zaXRpb25pbmc6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgIGZsaXBEaXNhYmxlZDogZmFsc2UsXG4gICAgICAgICAgICB0cmlnZ2VyRGlzYWJsZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIGZpZWxkUGlja0xpc3QubGF5ZXIgPSBsYXllcjtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5tYXBWaWV3ID0gbWFwVmlldztcbiAgICAgICAgZmllbGRQaWNrTGlzdC5zaG93RmllbGRJbmZvID0gdHJ1ZTtcbiAgICAgICAgZmllbGRQaWNrTGlzdC5zb3J0QnkgPSB0aGlzLmxhc3RGaWVsZFNvcnRCeTtcbiAgICAgICAgZGlzYWJsZVBhbmVsKHRoaXMucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQsIHRydWUpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpZWxkUGlja0xpc3QpO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGaWVsZFBpY2tMaXN0U29ydEJ5Q2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sYXN0RmllbGRTb3J0QnkgPSBldmVudC5kZXRhaWw7XG4gICAgICAgIH0pO1xuICAgICAgICBmaWVsZFBpY2tMaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNGaWVsZFBpY2tMaXN0RGlzbWlzc2VkXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGlmICgoX2EgPSBldmVudC5kZXRhaWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZWxlY3RlZEZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQoZXZlbnQuZGV0YWlsLnNlbGVjdGVkRmllbGRzWzBdKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBmaWVsZC5sYXllckZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGQuc2ltcGxlRmllbGRUeXBlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAoKF9iID0gdGhpcy5jdXJyZW50RmllbGQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jdXJyZW50RmllbGQuZXhwcmVzc2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogdGhpcy5jdXJyZW50RmllbGQuZXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiB0aGlzLmN1cnJlbnRGaWVsZC5zaW1wbGVGaWVsZFR5cGVcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmllbGQgPSBmaWVsZEluZm87XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dENoYW5nZS5lbWl0KHRoaXMuY3VycmVudEZpZWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZmllbGRCdXR0b25Ob2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGZpZWxkUGlja0xpc3QpO1xuICAgICAgICAgICAgZGlzYWJsZVBhbmVsKHRoaXMucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQsIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dC5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q3NzO1xuXG5leHBvcnQgeyBBcmNnaXNGaWVsZFBpY2tMaXN0IGFzIGFyY2dpc19maWVsZF9waWNrX2xpc3QsIEFyY2dpc1NtYXJ0TWFwcGluZ0FjdGlvbiBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19hY3Rpb24sIEFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0IGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX2F0dHJpYnV0ZV9pbnB1dCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtZmllbGQtcGljay1saXN0XzMuZW50cnkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9