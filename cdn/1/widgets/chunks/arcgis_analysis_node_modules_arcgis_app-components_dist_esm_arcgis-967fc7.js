"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-967fc7"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-background-symbol_6.entry.js":
/*!*******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-background-symbol_6.entry.js ***!
  \*******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_background_symbol: () => (/* binding */ ArcgisSmartMappingBackgroundSymbol),
/* harmony export */   arcgis_smart_mapping_default_symbol: () => (/* binding */ ArcgisSmartMappingDefaultSymbol),
/* harmony export */   arcgis_smart_mapping_method_button: () => (/* binding */ ArcgisSmartMappingMethodButton),
/* harmony export */   arcgis_smart_mapping_rotation: () => (/* binding */ ArcgisSmartMappingRotation),
/* harmony export */   arcgis_smart_mapping_theme_button: () => (/* binding */ ArcgisSmartMappingThemeButton),
/* harmony export */   arcgis_smart_mapping_transparency: () => (/* binding */ ArcgisSmartMappingTransparency)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./date-79c7d93c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js");
/* harmony import */ var _precision_06a73672_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./precision-06a73672.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/precision-06a73672.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./predominance-a1a2d74d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */













/**
 * Updates the layer with a DotDensity renderer with default settings
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function createOpacityVisualVariable(options) {
    var _a, _b;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
    const layer = smLayer;
    options = options || {};
    if (!options.fieldInfos && !((_a = options.fieldInfos) === null || _a === void 0 ? void 0 : _a.length)) {
        return Promise.reject();
    }
    const fieldInfo = options.fieldInfos[0];
    return modules.OpacityVariableCreator.createVisualVariable({
        layer,
        field: fieldInfo.field,
        view: mapView,
        valueExpression: fieldInfo.expression,
        valueExpressionTitle: fieldInfo.expressionTitle,
        normalizationField: options.normalizationField,
        forBinning: ((_b = layer.featureReduction) === null || _b === void 0 ? void 0 : _b.type) === "binning"
    });
}

const arcgisSmartMappingBackgroundSymbolCss = ".background-symbol-content{padding-top:6px;border-bottom:1px solid #e0e0e0}";

const ArcgisSmartMappingBackgroundSymbol = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingBackgroundSymbolChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingBackgroundSymbolChange", 7);
        // -------------------------------------------------------------------
        //
        //  Private Properties
        //
        // -------------------------------------------------------------------
        this.lastSettings = {};
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.popoverReferenceElement =
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item") ||
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-panel");
    }
    // -------------------------------------------------------------------
    //
    //  Render Methods
    //
    // -------------------------------------------------------------------
    render() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.q)(layer)) {
            return null;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const backgroundObj = rendererType === "dot-density"
            ? renderer.backgroundColor || renderer.outline
            : renderer.backgroundFillSymbol;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.backgroundSymbol.showBackgroundSymbol, open: !!backgroundObj, "toggle-display": "switch", onCalciteBlockSectionToggle: (e) => {
                this.handleBackgroundSymbolToggle(e);
            } }, this.renderBackgroundSymbolContent()));
    }
    renderBackgroundSymbolContent() {
        const { layer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isDotDensity = rendererType === "dot-density";
        let symbol;
        if (isDotDensity) {
            if (renderer.outline || renderer.backgroundColor) {
                symbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
                symbol.outline = renderer.outline;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(symbol, renderer.backgroundColor);
            }
        }
        else {
            symbol = renderer.backgroundFillSymbol;
        }
        if (!symbol) {
            return null;
        }
        this.popoverReferenceElement =
            this.popoverReferenceElement ||
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item") ||
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-panel");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "background-symbol-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { type: isDotDensity ? "dot-density-background" : "background", label: strings.backgroundSymbol.backgroundStyle, symbol: symbol, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.arcgisSmartMappingBackgroundSymbolChange.emit();
            }, popoverReferenceElement: this.popoverReferenceElement })));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    handleBackgroundSymbolToggle(e) {
        const { layer, mapImageSublayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const blockSection = e.currentTarget;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (rendererType === "dot-density") {
            if (blockSection.open) {
                if (this.lastSettings.backgroundColor || this.lastSettings.outline) {
                    renderer.backgroundColor = this.lastSettings.backgroundColor;
                    renderer.outline = this.lastSettings.outline;
                }
                else {
                    renderer.backgroundColor = new modules.esriColor({
                        r: 64,
                        g: 64,
                        b: 64,
                        a: 1
                    });
                    renderer.outline = new modules.SimpleLineSymbol();
                }
                if (this.lastSettings.outlineVisVar) {
                    renderer.visualVariables = renderer.visualVariables || [];
                    renderer.visualVariables.push(this.lastSettings.outlineVisVar);
                }
                this.lastSettings.backgroundColor = undefined;
                this.lastSettings.outline = undefined;
                this.lastSettings.outlineVisVar = undefined;
            }
            else {
                this.lastSettings.backgroundColor = renderer.backgroundColor;
                this.lastSettings.outline = renderer.outline;
                this.lastSettings.outlineVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size", "outline");
                renderer.backgroundColor = new modules.esriColor({
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                });
                renderer.outline = undefined;
                // remove auto outline sizing
                renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "size", "outline");
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
            }
        }
        else {
            if (blockSection.open) {
                if (this.lastSettings.backgroundFillSymbol) {
                    renderer.backgroundFillSymbol = this.lastSettings.backgroundFillSymbol;
                }
                else {
                    const newSymbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
                    newSymbol.color = null;
                    renderer.backgroundFillSymbol = newSymbol;
                }
                this.lastSettings.backgroundFillSymbol = undefined;
            }
            else {
                this.lastSettings.backgroundFillSymbol = renderer.backgroundFillSymbol;
                renderer.backgroundFillSymbol = undefined;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
            }
        }
        if (mapImageSublayer) {
            mapImageSublayer.renderer = renderer.clone();
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingBackgroundSymbol.style = arcgisSmartMappingBackgroundSymbolCss;

const arcgisSmartMappingDefaultSymbolCss = ".open{border-bottom:1px solid #e0e0e0}.block-section-padding{padding-top:6px}";

const ArcgisSmartMappingDefaultSymbol = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingDefaultSymbolChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingDefaultSymbolChange", 7);
        this.arcgisSmartMappingDefaultSymbolBeforeToggle = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingDefaultSymbolBeforeToggle", 7);
        this.lastSettings = {};
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        let text = strings.defaultSymbol.showDefaultSymbol;
        if (rendererType === "color") {
            const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
            if (!colorVisVar) {
                text = strings.defaultSymbol.showDefaultSymbolClassed;
            }
        }
        else if (rendererType === "size") {
            const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "size");
            if (!sizeVisVar) {
                text = strings.defaultSymbol.showDefaultSymbolClassed;
            }
        }
        const symbol = renderer.defaultSymbol;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: text, open: !!symbol, "toggle-display": "switch", onCalciteBlockSectionToggle: (event) => {
                this.arcgisSmartMappingDefaultSymbolBeforeToggle.emit();
                this.handleDefaultSymbolToggle(event);
            }, ref: (node) => (this.blockSectionNode = node) }, this.renderDefaultSymbolContent()));
    }
    renderDefaultSymbolContent() {
        const { layer, mapView } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let symbol;
        if (renderer.defaultSymbol) {
            symbol = renderer.defaultSymbol;
        }
        else if (this.lastSettings.defaultSymbol) {
            symbol = this.lastSettings.defaultSymbol;
        }
        else {
            symbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
        }
        if (!symbol) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "symbol-button-content block-section-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, type: "default", popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                this.lastSettings.defaultSymbol = renderer.defaultSymbol;
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.renderLabel()));
    }
    renderLabel() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const defaultLabel = renderer.defaultLabel || strings.defaultSymbol.other;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.defaultSymbol.label, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", value: defaultLabel, onCalciteInputChange: () => {
                if (!this.defaultLabelNode.value) {
                    this.labelChangeHandle = setTimeout(() => this.handleLabelChange(), 3000);
                }
                else {
                    clearTimeout(this.labelChangeHandle);
                    this.handleLabelChange();
                }
            }, onFocusout: (event) => {
                event.preventDefault();
                event.stopPropagation();
                this.handleLabelChange();
            }, onKeyUp: () => {
                if (!this.defaultLabelNode.value) {
                    this.labelChangeHandle = setTimeout(() => this.handleLabelChange(), 3000);
                }
                else {
                    clearTimeout(this.labelChangeHandle);
                    this.handleLabelChange();
                }
            }, ref: (node) => (this.defaultLabelNode = node) })));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    handleDefaultSymbolToggle(event) {
        const { layer, mapView, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const defaultSymbolToggle = event.currentTarget;
        if (defaultSymbolToggle.open) {
            this.blockSectionNode.classList.add("open");
            if (this.lastSettings.defaultSymbol) {
                renderer.defaultSymbol = this.lastSettings.defaultSymbol;
                renderer.defaultLabel = this.lastSettings.defaultLabel || strings.defaultSymbol.other;
            }
            else {
                const newSymbol = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
                renderer.defaultSymbol = newSymbol;
                renderer.defaultLabel = renderer.defaultLabel || strings.defaultSymbol.other;
                this.lastSettings.defaultSymbol = renderer.defaultSymbol;
                this.lastSettings.defaultLabel = renderer.defaultLabel;
            }
        }
        else {
            this.blockSectionNode.classList.remove("open");
            this.lastSettings.defaultSymbol = renderer.defaultSymbol;
            this.lastSettings.defaultLabel = renderer.defaultLabel;
            renderer.defaultSymbol = undefined;
            renderer.defaultLabel = undefined;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        this.arcgisSmartMappingDefaultSymbolChange.emit();
    }
    handleLabelChange() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        if (!this.defaultLabelNode.value) {
            renderer.defaultLabel = strings.defaultSymbol.other;
            this.defaultLabelNode.value = strings.defaultSymbol.other;
        }
        else {
            renderer.defaultLabel = this.defaultLabelNode.value;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingDefaultSymbol.style = arcgisSmartMappingDefaultSymbolCss;

const arcgisSmartMappingMethodButtonCss = ".method-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:2px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.method-button:active{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.method-button:focus{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.method-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.method-content{justify-content:space-between;display:flex;align-items:center;width:100%}.method-button-text{display:inline-block;padding:0 10px}.method-button-title{font-weight:bold}.method-button-msg{font-size:80%;line-height:16px}";

const ArcgisSmartMappingMethodButton = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingMethodButtonChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingMethodButtonChange", 7);
        this.arcgisSmartMappingMethodButtonBeforeOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingMethodButtonBeforeOpen", 7);
        this.methodInfos = [];
        this.open = false;
        this.showStdDev = false;
        this.showDefinedInterval = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    /**
     * Set focus on component
     */
    async setFocus() {
        this.buttonNode.focus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.populateMethodInfo();
        this.setSelection();
    }
    componentWillUpdate() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const method = authInfo.classificationMethod;
        if (this.selectedMethodInfo.value !== method) {
            this.setSelection();
        }
    }
    //--------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.methodButton.method, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "method-button", role: "button", tabindex: "0", "aria-haspopup": "true", "aria-label": strings.methodButton.selectMethod, ref: (node) => {
                if (node) {
                    this.buttonNode = node;
                }
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.openMethodDropdown();
                }
            }, onClick: () => this.openMethodDropdown() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "method-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "method-button-text" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "method-button-title" }, this.selectedMethodInfo.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "method-button-msg" }, this.selectedMethodInfo.msg)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" })))))));
    }
    //--------------------------------------------------------------------------
    //
    // Private Methods
    //
    //--------------------------------------------------------------------------
    setSelection() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const method = authInfo.classificationMethod;
        this.selectedMethodInfo = this.methodInfos.find((info) => info.value === method);
        this.methodInfos.forEach((methodInfo) => {
            methodInfo.selected = methodInfo.value === this.selectedMethodInfo.value;
        });
    }
    populateMethodInfo() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.methodInfos.push({
            value: "natural-breaks",
            title: strings.methodButton.naturalBreaks,
            msg: strings.methodButton.naturalBreaksMsg,
            iconPath: null,
            selected: false
        }, {
            value: "equal-interval",
            title: strings.methodButton.equalInterval,
            msg: strings.methodButton.equalIntervalMsg,
            iconPath: null,
            selected: false
        });
        if (this.showStdDev) {
            this.methodInfos.push({
                value: "standard-deviation",
                title: strings.methodButton.standardDeviation,
                msg: strings.methodButton.standardDeviationMsg,
                iconPath: null,
                selected: false
            });
        }
        this.methodInfos.push({
            value: "quantile",
            title: strings.methodButton.quantile,
            msg: strings.methodButton.quantileMsg,
            iconPath: null,
            selected: false
        });
        if (this.showDefinedInterval) {
            this.methodInfos.push({
                value: "defined-interval",
                title: strings.methodButton.definedInterval,
                msg: strings.methodButton.definedIntervalMsg,
                iconPath: null,
                selected: false
            });
        }
        this.methodInfos.push({
            value: "manual",
            title: strings.methodButton.manualBreaks,
            msg: strings.methodButton.manualBreaksMsg,
            iconPath: null,
            selected: false
        });
    }
    closePopover() {
        var _a;
        this.open = false;
        if (this.dropdownNode) {
            (_a = this.dropdownNode.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.dropdownNode);
            this.dropdownNode = null;
            this.buttonNode.classList.remove("active");
        }
    }
    openMethodDropdown() {
        if (!this.open) {
            this.arcgisSmartMappingMethodButtonBeforeOpen.emit();
            const dropdown = document.createElement("arcgis-smart-mapping-dropdown");
            dropdown.buttonNode = this.buttonNode;
            dropdown.infos = this.methodInfos;
            this.dropdownNode = dropdown;
            dropdown.addEventListener("arcgisSmartMappingDropdownClose", (event) => {
                this.closePopover();
                event.detail === "Escape" && this.setFocus();
            });
            dropdown.addEventListener("arcgisSmartMappingDropdownChange", (event) => this.setMethod(event.detail));
            this.buttonNode.classList.add("active");
            document.body.appendChild(dropdown);
            this.open = true;
        }
        else {
            this.open = false;
        }
    }
    setMethod(newMethodInfo) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const currentMethod = authInfo.classificationMethod;
        const newMethod = newMethodInfo.value;
        if (newMethod === currentMethod) {
            this.closePopover();
            setTimeout(() => this.setFocus(), 300);
            return;
        }
        for (let i = 0; i < this.methodInfos.length; i++) {
            this.methodInfos[i].selected = this.methodInfos[i].value === newMethod;
        }
        this.selectedMethodInfo = newMethodInfo;
        this.arcgisSmartMappingMethodButtonChange.emit(this.selectedMethodInfo.value);
        this.closePopover();
        setTimeout(() => this.setFocus(), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingMethodButton.style = arcgisSmartMappingMethodButtonCss;

const arcgisSmartMappingRotationCss = ".toggle-button{margin-top:2px}.block-section-padding{padding-top:6px}.block-content-padding{margin:6px 0}.block-content-loading{height:150px}.rotation-type{margin-top:5px}.rotation-type-selection{margin-top:15px}.rotation-type-display{margin:10px 20px 0 20px;position:relative}.rotation-type-display svg{height:120px}.rotation-type-symbol{position:absolute;top:56px;left:33px}.arcgis--rtl .rotation-type-symbol{left:auto;right:61px}";

const ArcgisSmartMappingRotation = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingRotationError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingRotationError", 7);
        this.open = false;
        this.isLoading = false;
        this.rotationType = "geographic";
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "rotation");
        this.isBlockOpen = this.open || !!rotationVisVar;
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { isRTL, layer, mapImageSublayer, strings, supportsArcade } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "size");
        const isGeoRSSLayer = layer.type === "geo-rss";
        if ((mapImageSublayer && !supportsArcade) ||
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.B)(layer) ||
            ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.q)(layer) && !sizeVisVar) ||
            !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ag)() ||
            isGeoRSSLayer) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { id: "rotation-block", class: {
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.C.rtl]: isRTL
            }, heading: strings.rotation.rotationByAttribute, collapsible: true, open: this.isBlockOpen, loading: this.isLoading, ref: (node) => (this.blockNode = node), onCalciteBlockOpen: () => {
                this.isBlockOpen = true;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }, onCalciteBlockClose: () => (this.isBlockOpen = false) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderRotationToggle()))));
    }
    renderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-content-loading" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderRotationToggle() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.rotation.rotationLabel, class: "toggle-button", toggleDisplay: "switch", open: !!rotationVisVar, onCalciteBlockSectionToggle: () => this.handleToggle() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-section-padding" }, this.isLoading
            ? this.renderLoading()
            : rotationVisVar
                ? this.renderRotationContent()
                : this.renderLoading())));
    }
    renderRotationContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.renderRotationAttribute(), this.renderRotationType()));
    }
    renderRotationAttribute() {
        const { layer, fields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "rotation");
        const fieldInfo = {
            field: rotationVisVar.field,
            expression: rotationVisVar.valueExpression,
            expressionTitle: rotationVisVar.valueExpressionTitle,
            simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { fieldList: fields.filter((field) => field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER), selectedField: fieldInfo, label: strings.rotation.field, mode: "expression", popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingAttributeInputChange: (event) => {
                if (event.detail) {
                    const fieldInfo = event.detail;
                    this.setRotationVisualVariable(fieldInfo);
                }
            }, onArcgisSmartMappingAttributeInputError: (event) => {
                this.arcgisSmartMappingRotationError.emit(event.detail);
            } }));
    }
    renderRotationType() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        let leadingDegree = false;
        if (strings.rotation.rotateZeroDegrees.indexOf("°") === 0) {
            leadingDegree = true;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "rotation-type block-content-padding" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { class: "rotation-type-selection", name: "rotationType", onCalciteRadioButtonGroupChange: (event) => {
                this.handleTypeChange(event.target.selectedItem.value);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.rotationType === "geographic", value: "geographic" }), strings.rotation.geographic), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.rotationType === "arithmetic", value: "arithmetic" }), strings.rotation.arithmetic)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "rotation-type-display", "aria-hidden": "true" }, this.rotationType === "arithmetic"
            ? leadingDegree
                ? this.renderRotationSVG_Ari_leading()
                : this.renderRotationSVG_Ari()
            : leadingDegree
                ? this.renderRotationSVG_Geo_leading()
                : this.renderRotationSVG_Geo(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "rotation-type-symbol", ref: (node) => this.createSymbol(node) }))));
    }
    renderRotationSVG_Geo() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 80 80" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", null, ".cls-1,.cls-4", `{fill:none;}`, ".cls-2", `{fill:#f3f3f3;}`, ".cls-3", `{fill:#ccc;}`, ".cls-4", `{stroke:#353535;stroke-miterlimit:10;}`, ".cls-5", `{fill:#353535;}`, ".cls-6", `{fill:#595959;}`)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-1", width: "80", height: "80" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("circle", { class: "cls-2", cx: "30.5", cy: "46.5", r: "30.5" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "16", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "71", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "57.5", y: "43.5", width: "1", height: "6", transform: "translate(11.5 104.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "2.5", y: "43.5", width: "1", height: "6", transform: "translate(-43.5 49.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-4", d: "M35.8,16.46A30.51,30.51,0,0,1,60.39,40.4" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("polygon", { class: "cls-5", points: "57.06 38.77 57.46 38.2 60.31 40.15 62.05 37.16 62.65 37.51 60.53 41.15 57.06 38.77" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M29.12,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,7.77,7.77,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19A2.34,2.34,0,0,1,28,4.56,1.85,1.85,0,0,1,29.12,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,27.52,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.15,1.15,0,0,0,.78.28,1.12,1.12,0,0,0,.77-.28,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,30.72,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.08,1.08,0,0,0,29.12,4.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M35.52,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0A1.38,1.38,0,0,1,33,6.86a1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18A1.21,1.21,0,0,1,33,4.72a1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,35.52,5.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22A1,1,0,0,0,34,6.8a1,1,0,0,0,.4-.08.87.87,0,0,0,.32-.22A1,1,0,0,0,35,6.19,1.09,1.09,0,0,0,35,5.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M66.94,46.41l0,0a1.33,1.33,0,0,1-.46.19,2.2,2.2,0,0,1-.56.07,2.18,2.18,0,0,1-.85-.16,2.12,2.12,0,0,1-.68-.45,1.9,1.9,0,0,1-.46-.68,2.38,2.38,0,0,1-.16-.89,2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.45,2.45,0,0,1,.73-.46,2.7,2.7,0,0,1,1.83,0,2.33,2.33,0,0,1,.73.46,1.9,1.9,0,0,1,.48.7,2.27,2.27,0,0,1,.18.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L65.77,49.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.92,1.92,0,0,0-.5-.34,1.79,1.79,0,0,0-1.29,0,1.77,1.77,0,0,0-.5.34,1.82,1.82,0,0,0-.32.52,1.77,1.77,0,0,0,0,1.28,1.49,1.49,0,0,0,.31.51,1.45,1.45,0,0,0,.5.33,1.75,1.75,0,0,0,.65.12A1.73,1.73,0,0,0,66.7,46a1.45,1.45,0,0,0,.5-.33,1.69,1.69,0,0,0,.32-.51A1.91,1.91,0,0,0,67.63,44.47Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M71.82,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86A4.16,4.16,0,0,1,74,44.61a8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,8.46,8.46,0,0,1,0-2.72A4.16,4.16,0,0,1,70,43.42a2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,71.82,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,4.31,4.31,0,0,0-.26,1A10.3,10.3,0,0,0,70.22,46a10.11,10.11,0,0,0,.07,1.08,4,4,0,0,0,.26,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,73.42,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,71.82,42.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M78.21,43.79a1.44,1.44,0,0,1-.11.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.64,1.64,0,0,1,0-1.18,1.47,1.47,0,0,1,.31-.48,1.52,1.52,0,0,1,.48-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.44,1.44,0,0,1,78.21,43.79Zm-.48,0a.92.92,0,0,0-.08-.4,1,1,0,0,0-.21-.31.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1,1,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,77.73,43.79Z" })));
    }
    renderRotationSVG_Ari() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 80 80" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", null, ".cls-1,.cls-4", `{fill:none;}`, ".cls-2", `{fill:#f3f3f3;}`, ".cls-3", `{fill:#ccc;}`, ".cls-4", `{stroke:#353535;stroke-miterlimit:10;}`, ".cls-5", `{fill:#353535;}`, ".cls-6", `{fill:#595959;}`)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-1", width: "80", height: "80" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("circle", { class: "cls-2", cx: "30.5", cy: "46.5", r: "30.5" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "16", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "71", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "57.5", y: "43.5", width: "1", height: "6", transform: "translate(11.5 104.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "2.5", y: "43.5", width: "1", height: "6", transform: "translate(-43.5 49.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-4", d: "M36.54,16.6a30.55,30.55,0,0,1,24,24.55" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("polygon", { class: "cls-5", points: "38.19 19.92 38.76 19.52 36.8 16.69 39.77 14.94 39.42 14.33 35.8 16.46 38.19 19.92" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M27.14,8.41l0,0a1.35,1.35,0,0,1-.45.19,2.28,2.28,0,0,1-.57.07,2.18,2.18,0,0,1-.85-.16A2.12,2.12,0,0,1,24.57,8a1.94,1.94,0,0,1-.46-.69A2.3,2.3,0,0,1,24,6.47a2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.32,2.32,0,0,1,1.65-.62,2.51,2.51,0,0,1,.92.16,2.59,2.59,0,0,1,.73.46,2.18,2.18,0,0,1,.48.7,2.46,2.46,0,0,1,.17.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L26,11.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.56,1.56,0,0,0-.5-.33A1.67,1.67,0,0,0,25.6,5a1.67,1.67,0,0,0-.5.33,1.82,1.82,0,0,0-.32.52,1.69,1.69,0,0,0-.11.64,1.61,1.61,0,0,0,.11.63,1.35,1.35,0,0,0,.81.85,1.76,1.76,0,0,0,.66.12A1.71,1.71,0,0,0,26.9,8a1.45,1.45,0,0,0,.5-.33,1.62,1.62,0,0,0,.32-.52A1.81,1.81,0,0,0,27.83,6.47Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M32,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19A7.72,7.72,0,0,1,34.33,8a7.72,7.72,0,0,1-.11,1.36,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,32,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,30.42,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,1.92,1.92,0,0,0,.49.73,1.18,1.18,0,0,0,1.55,0,1.92,1.92,0,0,0,.49-.73,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,33.62,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,32,4.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M38.42,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.63,1.63,0,0,1-.11-.59,1.73,1.73,0,0,1,.11-.6,1.38,1.38,0,0,1,.79-.78,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,38.42,5.79Zm-.49,0a.85.85,0,0,0-.08-.39.89.89,0,0,0-.21-.32.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22A1.07,1.07,0,0,0,36,5.4a1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,37.93,5.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M67,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,67,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,65.42,46a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,68.62,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,67,42.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M73.42,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.63,1.63,0,0,1-.11-.59,1.73,1.73,0,0,1,.11-.6,1.38,1.38,0,0,1,.79-.78,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,73.42,43.79Zm-.49,0a.85.85,0,0,0-.08-.39.89.89,0,0,0-.21-.32.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.07,1.07,0,0,0-.22.32,1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,72.93,43.79Z" })));
    }
    renderRotationSVG_Geo_leading() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 80 80" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", null, ".cls-1,.cls-4", `{fill:none;}`, ".cls-2", `{fill:#f3f3f3;}`, ".cls-3", `{fill:#ccc;}`, ".cls-4", `{stroke:#353535;stroke-miterlimit:10;}`, ".cls-5", `{fill:#353535;}`, ".cls-6", `{fill:#595959;}`)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-1", width: "80", height: "80" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("circle", { class: "cls-2", cx: "30.5", cy: "46.5", r: "30.5" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "16", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "71", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "57.5", y: "43.5", width: "1", height: "6", transform: "translate(11.5 104.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "2.5", y: "43.5", width: "1", height: "6", transform: "translate(-43.5 49.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-4", d: "M35.8,16.46A30.51,30.51,0,0,1,60.39,40.4" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("polygon", { class: "cls-5", points: "57.06 38.77 57.46 38.2 60.31 40.15 62.05 37.16 62.65 37.51 60.53 41.15 57.06 38.77" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M28.72,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18,1.21,1.21,0,0,1,.31-.48,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,28.72,5.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,28.23,5.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M32.12,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,7.77,7.77,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19A2.34,2.34,0,0,1,31,4.56,1.85,1.85,0,0,1,32.12,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,30.52,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.15,1.15,0,0,0,.78.28,1.12,1.12,0,0,0,.77-.28,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,33.72,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.08,1.08,0,0,0,32.12,4.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M66.62,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18,1.21,1.21,0,0,1,.31-.48,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,66.62,43.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,66.13,43.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M70.94,46.41l0,0a1.33,1.33,0,0,1-.46.19,2.2,2.2,0,0,1-.56.07,2.18,2.18,0,0,1-.85-.16,2.12,2.12,0,0,1-.68-.45,1.9,1.9,0,0,1-.46-.68,2.38,2.38,0,0,1-.16-.89,2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.45,2.45,0,0,1,.73-.46,2.7,2.7,0,0,1,1.83,0,2.33,2.33,0,0,1,.73.46,1.9,1.9,0,0,1,.48.7,2.27,2.27,0,0,1,.18.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L69.77,49.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.92,1.92,0,0,0-.5-.34,1.79,1.79,0,0,0-1.29,0,1.77,1.77,0,0,0-.5.34,1.82,1.82,0,0,0-.32.52,1.77,1.77,0,0,0,0,1.28,1.49,1.49,0,0,0,.31.51,1.45,1.45,0,0,0,.5.33,1.75,1.75,0,0,0,.65.12A1.73,1.73,0,0,0,70.7,46a1.45,1.45,0,0,0,.5-.33,1.69,1.69,0,0,0,.32-.51A1.91,1.91,0,0,0,71.63,44.47Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M75.82,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86A4.16,4.16,0,0,1,78,44.61a8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,8.46,8.46,0,0,1,0-2.72A4.16,4.16,0,0,1,74,43.42a2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,75.82,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,4.31,4.31,0,0,0-.26,1A10.3,10.3,0,0,0,74.22,46a10.11,10.11,0,0,0,.07,1.08,4,4,0,0,0,.26,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,77.42,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,75.82,42.85Z" })));
    }
    renderRotationSVG_Ari_leading() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 80 80" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("style", null, ".cls-1,.cls-4", `{fill:none;}`, ".cls-2", `{fill:#f3f3f3;}`, ".cls-3", `{fill:#ccc;}`, ".cls-4", `{stroke:#353535;stroke-miterlimit:10;}`, ".cls-5", `{fill:#353535;}`, ".cls-6", `{fill:#595959;}`)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-1", width: "80", height: "80" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("circle", { class: "cls-2", cx: "30.5", cy: "46.5", r: "30.5" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "16", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "30", y: "71", width: "1", height: "6" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "57.5", y: "43.5", width: "1", height: "6", transform: "translate(11.5 104.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { class: "cls-3", x: "2.5", y: "43.5", width: "1", height: "6", transform: "translate(-43.5 49.5) rotate(-90)" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-4", d: "M36.54,16.6a30.55,30.55,0,0,1,24,24.55" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("polygon", { class: "cls-5", points: "38.19 19.92 38.76 19.52 36.8 16.69 39.77 14.94 39.42 14.33 35.8 16.46 38.19 19.92" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M24.82,5.79a1.63,1.63,0,0,1-.11.59,1.47,1.47,0,0,1-.31.48,1.52,1.52,0,0,1-.48.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31A1.21,1.21,0,0,1,22,6.38a1.45,1.45,0,0,1-.12-.59,1.53,1.53,0,0,1,.12-.6,1.25,1.25,0,0,1,.31-.47,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.79.78A1.73,1.73,0,0,1,24.82,5.79Zm-.49,0a1,1,0,0,0-.07-.39A1.07,1.07,0,0,0,24,5.08a.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1.06,1.06,0,0,0-.4.08.87.87,0,0,0-.32.22.89.89,0,0,0-.21.32.85.85,0,0,0-.08.39.92.92,0,0,0,.08.4.85.85,0,0,0,.21.31.87.87,0,0,0,.32.22,1.06,1.06,0,0,0,.4.08,1,1,0,0,0,.39-.08A.87.87,0,0,0,24,6.5a1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,24.33,5.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M29.14,8.41l0,0a1.35,1.35,0,0,1-.45.19,2.28,2.28,0,0,1-.57.07,2.18,2.18,0,0,1-.85-.16A2.12,2.12,0,0,1,26.57,8a1.94,1.94,0,0,1-.46-.69A2.3,2.3,0,0,1,26,6.47a2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.32,2.32,0,0,1,1.65-.62,2.51,2.51,0,0,1,.92.16,2.59,2.59,0,0,1,.73.46,2.18,2.18,0,0,1,.48.7,2.46,2.46,0,0,1,.17.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L28,11.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.56,1.56,0,0,0-.5-.33A1.67,1.67,0,0,0,27.6,5a1.67,1.67,0,0,0-.5.33,1.82,1.82,0,0,0-.32.52,1.69,1.69,0,0,0-.11.64,1.61,1.61,0,0,0,.11.63,1.35,1.35,0,0,0,.81.85,1.76,1.76,0,0,0,.66.12A1.71,1.71,0,0,0,28.9,8a1.45,1.45,0,0,0,.5-.33,1.62,1.62,0,0,0,.32-.52A1.81,1.81,0,0,0,29.83,6.47Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M34,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19A7.72,7.72,0,0,1,36.33,8a7.72,7.72,0,0,1-.11,1.36,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,34,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,32.42,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,1.92,1.92,0,0,0,.49.73,1.18,1.18,0,0,0,1.55,0,1.92,1.92,0,0,0,.49-.73,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,35.62,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,34,4.85Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M67.62,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.45,1.45,0,0,1-.12-.59,1.53,1.53,0,0,1,.12-.6,1.25,1.25,0,0,1,.31-.47,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,67.62,43.79Zm-.49,0a1,1,0,0,0-.07-.39,1.07,1.07,0,0,0-.22-.32.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.07,1.07,0,0,0-.22.32,1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,67.13,43.79Z" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { class: "cls-6", d: "M71,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,71,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,69.42,46a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,72.62,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,71,42.85Z" })));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    createSymbol(symbolNode) {
        var _a, _b, _c;
        if (!symbolNode) {
            return;
        }
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let symbol = renderer.symbol ||
            (((_a = renderer.classBreakInfos) === null || _a === void 0 ? void 0 : _a.length) && renderer.classBreakInfos[0].symbol) ||
            (((_b = renderer.uniqueValueInfos) === null || _b === void 0 ? void 0 : _b.length) && renderer.uniqueValueInfos[0].symbol) ||
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView);
        symbol = symbol.clone();
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.r)(symbol, new modules.esriColor({ r: 170, g: 170, b: 170, a: 1 }));
        // remove old symbol if there is one
        while ((_c = symbolNode.childNodes) === null || _c === void 0 ? void 0 : _c.length) {
            symbolNode.removeChild(symbolNode.childNodes[0]);
        }
        if (symbol) {
            // add new symbol
            modules.symbolUtils
                .renderPreviewHTML(symbol, {
                size: 20
            })
                .then((node) => symbolNode.appendChild(node));
        }
    }
    handleToggle() {
        var _a;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "rotation");
        if (rotationVisVar) {
            this.lastSettings = { rotationVisVar };
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aJ)("rotation", layer);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        }
        else {
            if ((_a = this.lastSettings) === null || _a === void 0 ? void 0 : _a.rotationVisVar) {
                renderer.visualVariables = renderer.visualVariables || [];
                renderer.visualVariables.push(this.lastSettings.rotationVisVar);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }
            else {
                // pick first field by default if active
                const firstNumField = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aK)();
                const field = firstNumField ? firstNumField.layerField.name : "";
                const rVisVar = new modules.RotationVariable({
                    field,
                    rotationType: "geographic"
                });
                renderer.visualVariables = renderer.visualVariables || [];
                renderer.visualVariables.push(rVisVar);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }
        }
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleTypeChange(type) {
        if (type === this.rotationType) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "rotation");
        rotationVisVar.rotationType = type;
        this.rotationType = rotationVisVar.rotationType;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    setRotationVisualVariable(fieldInfo) {
        this.isLoading = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        try {
            let rotationVisVar;
            if (fieldInfo.expression) {
                rotationVisVar = new modules.RotationVariable({
                    valueExpression: fieldInfo.expression,
                    valueExpressionTitle: fieldInfo.expressionTitle,
                    rotationType: this.rotationType
                });
            }
            else if (fieldInfo.field) {
                rotationVisVar = new modules.RotationVariable({
                    field: fieldInfo.field,
                    rotationType: this.rotationType
                });
            }
            this.rotationType = this.rotationType;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aJ)("rotation", layer);
            renderer.visualVariables = renderer.visualVariables || [];
            renderer.visualVariables.push(rotationVisVar);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            this.isLoading = false;
        }
        catch (e) {
            console.log(e);
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingRotation.style = arcgisSmartMappingRotationCss;

var ImagePaths;
(function (ImagePaths) {
    ImagePaths["highToLow"] = "HighToLow.svg";
    ImagePaths["aboveAndBelow"] = "AboveAndBelow.svg";
    ImagePaths["above"] = "Above.svg";
    ImagePaths["below"] = "Below.svg";
    ImagePaths["centeredOn"] = "CenteredOn.svg";
    ImagePaths["extremes"] = "Extremes.svg";
})(ImagePaths || (ImagePaths = {}));

const arcgisSmartMappingThemeButtonCss = ".theme-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:1px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.theme-button:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.theme-button:active{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}.theme-button:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.theme-button.active,.calcite-theme-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.theme-content{display:flex;align-items:center;width:100%}.theme-sub-content{display:flex;justify-content:space-between;align-items:center;width:100%}.theme-button-icon{min-width:16px;background-repeat:no-repeat;height:48px;padding:0;display:inline-block}.theme-button-text{display:inline-block;padding:0 10px}.theme-button-title{font-weight:bold}.theme-button-msg{font-size:80%;line-height:16px}";

const ArcgisSmartMappingThemeButton = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingThemeButtonChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingThemeButtonChange", 7);
        this.arcgisSmartMappingThemeButtonBeforeOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingThemeButtonBeforeOpen", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Properties
        //
        //--------------------------------------------------------------------------
        this.open = false;
        this.themeInfos = [];
        this.rendererSubtype = undefined;
        this.buttonVersion = "default";
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    /**
     * Set focus on component
     */
    async setFocus() {
        if (this.buttonVersion === "minimal") {
            this.buttonNode.setFocus();
        }
        else {
            this.buttonNode.focus();
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.populateThemeInfo();
        this.setSelection();
    }
    componentWillUpdate() {
        const theme = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.J)();
        if (this.selectedThemeInfo.value !== theme) {
            this.setSelection();
        }
    }
    // --------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.buttonVersion === "minimal" ? this.renderMinimalButton() : this.renderDefaultButton()));
    }
    renderDefaultButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.themeButton.theme, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-button", role: "button", tabindex: "0", "aria-haspopup": "true", "aria-label": strings.themeButton.selectTheme, ref: (node) => (this.buttonNode = node), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.openThemeDropdown();
                }
            }, onClick: () => this.openThemeDropdown() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-button-icon", style: {
                backgroundImage: `url(${(0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.a)(`./assets/arcgis-smart-mapping-dropdown-images/`)}${this.selectedThemeInfo.iconPath})`
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-sub-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-button-text" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-button-title" }, this.selectedThemeInfo.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "theme-button-msg" }, this.selectedThemeInfo.msg)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" })))))));
    }
    renderMinimalButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { onClick: (event) => event.stopImmediatePropagation() }, strings.themeButton.theme, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "m", class: "calcite-theme-button", alignment: "icon-end-space-between", iconEnd: "chevron-down", appearance: "outline-fill", width: "full", tabindex: "0", role: "button", kind: "neutral", "aria-haspopup": "true", label: strings.themeButton.selectTheme, ref: (node) => (this.buttonNode = node), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.openThemeDropdown();
                }
            }, onClick: () => this.openThemeDropdown() }, this.selectedThemeInfo.title)));
    }
    // --------------------------------------------------------------------------
    //
    // Private methods
    //
    // --------------------------------------------------------------------------
    setSelection() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const authInfo = renderer.authoringInfo;
        const authColorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "color");
        const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "size");
        let newValue = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.univariateTheme) ||
            (this.rendererSubtype === "size" ? authSizeVisVar === null || authSizeVisVar === void 0 ? void 0 : authSizeVisVar.theme : authColorVisVar === null || authColorVisVar === void 0 ? void 0 : authColorVisVar.theme);
        if (rendererType === "color-size" &&
            (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) !== "univariate-color-size" &&
            this.rendererSubtype === "size") {
            newValue = authSizeVisVar.theme;
        }
        this.selectedThemeInfo = !newValue
            ? this.themeInfos.find((info) => info.value === "high-to-low")
            : this.themeInfos.find((info) => info.value === newValue);
        this.themeInfos.forEach((themeInfo) => {
            themeInfo.selected = themeInfo.value === this.selectedThemeInfo.value;
        });
    }
    closePopover() {
        var _a;
        this.open = false;
        if (this.dropdownNode) {
            (_a = this.dropdownNode.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.dropdownNode);
            this.dropdownNode = null;
            this.buttonNode.classList.remove("active");
        }
    }
    openThemeDropdown() {
        if (!this.open) {
            this.arcgisSmartMappingThemeButtonBeforeOpen.emit();
            const dropdown = document.createElement("arcgis-smart-mapping-dropdown");
            dropdown.buttonNode = this.buttonNode;
            dropdown.infos = this.themeInfos;
            this.dropdownNode = dropdown;
            dropdown.addEventListener("arcgisSmartMappingDropdownClose", (event) => {
                this.closePopover();
                event.detail === "Escape" && this.setFocus();
            });
            dropdown.addEventListener("arcgisSmartMappingDropdownChange", (event) => this.setTheme(event.detail));
            this.buttonNode.classList.add("active");
            document.body.appendChild(dropdown);
            this.open = true;
        }
        else {
            this.open = false;
        }
    }
    setTheme(newThemeInfo) {
        const currentTheme = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.J)(this.rendererSubtype);
        const newTheme = newThemeInfo.value;
        if (newTheme === currentTheme) {
            this.closePopover();
            setTimeout(() => this.setFocus(), 300);
            return;
        }
        for (let i = 0; i < this.themeInfos.length; i++) {
            this.themeInfos[i].selected = this.themeInfos[i].value === newTheme;
        }
        this.selectedThemeInfo = newThemeInfo;
        this.arcgisSmartMappingThemeButtonChange.emit(newTheme);
        this.closePopover();
        setTimeout(() => this.setFocus(), 300);
    }
    populateThemeInfo() {
        const { layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const newMS = mapImageSublayer && layer.version >= 11;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["color-age", "size-age"].indexOf(rendererType) > -1 ||
            (this.rendererSubtype !== "size" && ["color-age-size"].indexOf(rendererType) > -1) ||
            (this.rendererSubtype === "size" &&
                ["color-size-age", "type-size-age"].indexOf(rendererType) > -1);
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const authInfo = renderer.authoringInfo;
        const isUnivariate = (authInfo === null || authInfo === void 0 ? void 0 : authInfo.type) === "univariate-color-size";
        const visVar = rendererType === "color-size" && isUnivariate
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "size")
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), this.rendererSubtype);
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(visVar.field);
        this.isDate = (field === null || field === void 0 ? void 0 : field.simpleFieldType) === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE && !isAgeRenderer;
        const imgStr = rendererType === "color-size" && isUnivariate
            ? "ColorAndSize_"
            : this.rendererSubtype === "color"
                ? "Color_"
                : "Size_";
        this.themeInfos.push({
            value: "high-to-low",
            title: this.isDate ? strings.themeButton.newToOld : strings.themeButton.highToLow,
            msg: this.isDate
                ? strings.themeButton[this.rendererSubtype].newToOldMsg
                : strings.themeButton[this.rendererSubtype].highToLowMsg,
            iconPath: `${imgStr}${ImagePaths.highToLow}`,
            selected: false
        });
        if (rendererType === "color" ||
            (rendererType === "color-size" &&
                this.rendererSubtype !== "size" &&
                (!mapImageSublayer || newMS))) {
            this.themeInfos.push({
                value: "above-and-below",
                title: this.isDate ? strings.themeButton.beforeAndAfter : strings.themeButton.aboveAndBelow,
                msg: this.isDate
                    ? strings.themeButton[this.rendererSubtype].beforeAndAfterMsg
                    : strings.themeButton[this.rendererSubtype].aboveAndBelowMsg,
                iconPath: `${imgStr}${ImagePaths.aboveAndBelow}`,
                selected: false
            });
        }
        this.themeInfos.push({
            value: "above",
            title: this.isDate ? strings.themeButton.after : strings.themeButton.above,
            msg: this.isDate
                ? strings.themeButton[this.rendererSubtype].afterMsg
                : strings.themeButton[this.rendererSubtype].aboveMsg,
            iconPath: `${imgStr}${ImagePaths.above}`,
            selected: false
        });
        this.themeInfos.push({
            value: "below",
            title: this.isDate ? strings.themeButton.before : strings.themeButton.below,
            msg: this.isDate
                ? strings.themeButton[this.rendererSubtype].beforeMsg
                : strings.themeButton[this.rendererSubtype].belowMsg,
            iconPath: `${imgStr}${ImagePaths.below}`,
            selected: false
        });
        if (rendererType === "color") {
            this.themeInfos.push({
                value: "centered-on",
                title: strings.themeButton.centered,
                msg: strings.themeButton[this.rendererSubtype].centeredMsg,
                iconPath: `${imgStr}${ImagePaths.centeredOn}`,
                selected: false
            });
            this.themeInfos.push({
                value: "extremes",
                title: strings.themeButton.extremes,
                msg: strings.themeButton[this.rendererSubtype].extremesMsg,
                iconPath: `${imgStr}${ImagePaths.extremes}`,
                selected: false
            });
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingThemeButton.style = arcgisSmartMappingThemeButtonCss;

const arcgisSmartMappingTransparencyCss = ".block-content-loading{height:150px}.transparency-block{overflow-x:hidden}.block-section-padding{padding-top:6px}.transparency-range{display:flex;justify-content:space-between}.transparency-range-item{width:49%;display:flex;flex-flow:column;justify-content:space-between}.include-legend{margin:10px 0 0 0}.slider-box{height:300px}.slider-box .esri-opacity-slider__histogram-container{width:85px}.slider-box .esri-opacity-slider .esri-slider .esri-slider__content{height:175px}.slider-box .esri-opacity-slider{min-width:200px}.slider-box .esri-opacity-slider .esri-slider .esri-slider__label,.slider-box .esri-opacity-slider .esri-slider .esri-slider__min,.slider-box .esri-opacity-slider .esri-slider .esri-slider__max{text-decoration:underline}.slider-box .esri-opacity-slider .esri-slider .esri-slider__label:hover,.slider-box .esri-opacity-slider .esri-slider .esri-slider__min:hover,.slider-box .esri-opacity-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-box-buttons-front{display:flex}";

const ArcgisSmartMappingTransparency = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingSymbolTransparencyError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingSymbolTransparencyError", 7);
        /*
         * When toggling off remember settings
         */
        this.lastSettings = {};
        /**
         * Necessary for tracking stops for non-classed sliders,
         * whose values are updated immediately even given incorrect inputs.
         */
        this.currentStopValues = [];
        this.zigzagClick = false;
        this.lastFieldSortBy = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_3__.L.default;
        this.styleSheetStatus = "not-loaded";
        this.open = false;
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.sliderZoomed = false;
        this.isLoading = false;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.blockNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    async updateStatistics() {
        var _a;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.statistics = null;
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.histogram = null;
        (_a = this.transparencySlider) === null || _a === void 0 ? void 0 : _a.destroy();
        this.transparencySlider = undefined;
        this.sliderZoomed = false;
        this.getStatistics();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        this.isBlockOpen = this.open || !!opacityVisVar;
        this.getStatistics();
        this.percentLabelFlip = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.at)(this.hostElement);
    }
    componentDidLoad() {
        this.flowItemNode = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.F)(this.hostElement, "calcite-flow-item");
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { config, strings, mapImageSublayer, supportsArcade, layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { isBlockOpen, isLoading } = this;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if ((mapImageSublayer && !supportsArcade) || layer.type === "geo-rss" || !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ag)()) {
            return null;
        }
        const isPredominance = ["predominance", "predominance-size"].indexOf(rendererType) > -1;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("link", { rel: "stylesheet", href: `${config.jsapiUrl}/themes/light/main.css`, onLoad: () => {
                this.styleSheetStatus = "loaded";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            }, onError: () => {
                this.styleSheetStatus = "failed";
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: isPredominance
                ? strings.transparency.transparencyByPredominance
                : strings.transparency.transparencyByAttribute, collapsible: true, open: isBlockOpen, loading: isLoading, class: "transparency-block", ref: (node) => (this.blockNode = node), onCalciteBlockOpen: () => {
                this.isBlockOpen = true;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }, onCalciteBlockClose: () => (this.isBlockOpen = false) }, this.renderTransparencyToggle())));
    }
    renderTransparencyToggle() {
        const { styleSheetStatus } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const isPredominance = ["predominance", "predominance-size"].indexOf(rendererType) > -1;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: isPredominance
                ? strings.transparency.transparencyLabelPredominance
                : strings.transparency.transparencyLabel, "toggle-display": "switch", open: !!opacityVisVar, onCalciteBlockSectionToggle: (event) => this.handleToggle(event), ref: (node) => (this.blockSectionNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-section-padding" }, opacityVisVar && styleSheetStatus === "loaded"
            ? this.renderContent()
            : opacityVisVar && styleSheetStatus === "not-loaded"
                ? this.renderLoading()
                : null)));
    }
    renderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "block-content-loading" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.renderAttributes(), this.renderSlider(), this.renderRange(), this.renderLegend()));
    }
    renderAttributes() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (["predominance", "predominance-size"].indexOf(rendererType) > -1) {
            return null;
        }
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const normalizationField = opacityVisVar.normalizationField && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.normalizationField);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.renderAttributeMain(fieldInfo), this.renderAttributeDividedBy(normalizationField)));
    }
    renderAttributeMain(fieldInfo) {
        var _a;
        const { fields, layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const isBinningLayer = "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning";
        const canArcade = !isBinningLayer;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { fieldList: fields.filter((field) => [_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE, _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER].includes(field.simpleFieldType)), popoverReferenceElement: this.flowItemNode, selectedField: fieldInfo, label: strings.transparency.field, mode: canArcade ? "expression" : "simple", ref: (node) => (this.attributeInputNode = node), onArcgisSmartMappingAttributeInputChange: async (event) => {
                var _a;
                if (event.detail) {
                    const fieldInfo = event.detail;
                    await this.getOpacityVisualVariable(fieldInfo);
                    (_a = this.dividedByAttributeInputNode) === null || _a === void 0 ? void 0 : _a.clear();
                }
                // refresh slider when switching between fields and Arcade expressions
                this.updateStatistics();
            }, onArcgisSmartMappingAttributeInputError: (event) => {
                this.arcgisSmartMappingSymbolTransparencyError.emit(event.detail);
            } }));
    }
    renderAttributeDividedBy(normalizationField) {
        const { layer, fields, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        if (fieldInfo.expression || fieldInfo.simpleFieldType !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER) {
            // main field is expression or not a number, we don't support dividedBy
            return null;
        }
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.I)(fields);
        if (counts.number < 2) {
            // the layer has only 1 or no number field
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-attribute-input", { fieldList: fields.filter((field) => field.layerField.name !== opacityVisVar.field &&
                field.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER), popoverReferenceElement: this.flowItemNode, label: strings.transparency.dividedBy, selectedField: normalizationField
                ? {
                    field: normalizationField.layerField.name,
                    simpleFieldType: normalizationField.simpleFieldType
                }
                : null, mode: "remove", ref: (node) => {
                if (node) {
                    this.dividedByAttributeInputNode = node;
                }
            }, onArcgisSmartMappingAttributeInputChange: async (event) => {
                if (event.detail) {
                    const fieldInfo = event.detail;
                    await this.getOpacityVisualVariable({
                        field: opacityVisVar.field,
                        simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
                    }, fieldInfo.field);
                }
                else {
                    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                    const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
                    await this.getOpacityVisualVariable({
                        field: opacityVisVar.field,
                        simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
                    }, null);
                }
                // refresh slider when normalizing and removing the normalization field
                this.updateStatistics();
            } }));
    }
    renderSlider() {
        var _a;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { statisticsStatus, histogramStatus, sliderZoomed } = this;
        if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED || statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING) {
            (_a = this.transparencySlider) === null || _a === void 0 ? void 0 : _a.destroy();
            this.transparencySlider = undefined;
        }
        else if (statisticsStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS ||
            (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS && !this.transparencySlider)) {
            return this.renderTransparencySliderLoading();
        }
        else {
            const ok = this.prepareTransparencySlider();
            let disableZoomButton = false;
            const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
            const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
            if (!sliderZoomed) {
                const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "opacity");
                const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(opacityVisVar.stops, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue);
                if ((zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.minMaxSame) ||
                    (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.min) && !(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions === null || zoomOptions === void 0 ? void 0 : zoomOptions.max))) {
                    disableZoomButton = true;
                    if (this.zoomButtonNode) {
                        this.zoomButtonNode.disabled = true;
                    }
                }
            }
            this.currentStopValues = opacityVisVar.stops.map((stop) => stop.value);
            if (ok || this.transparencySlider) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box-buttons-front" }, this.renderZoomButton(disableZoomButton), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, "\u00A0"), this.renderResetButton()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (node) => {
                        if (node) {
                            this.afterTransparencySliderCreate(node);
                        }
                    } })));
            }
            else {
                return this.renderTransparencySliderLoading();
            }
        }
    }
    renderTransparencySliderLoading() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider-box" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: strings.loading })));
    }
    renderZoomButton(disableZoomButton) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const { sliderZoomed } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.transparency.zoomSlider, icon: sliderZoomed ? "magnifyingGlassMinus" : "magnifyingGlassPlus", disabled: disableZoomButton, onClick: () => this.handleZoomSlider(), ref: (node) => (this.zoomButtonNode = node) }));
    }
    renderResetButton() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-action", { text: strings.transparency.resetSlider, icon: "undo", onClick: () => this.handleResetSlider() }));
    }
    renderRange() {
        const { percentLabelFlip } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const stops = opacityVisVar.stops;
        const highValue = Math.round(100 - stops[1].opacity * 100);
        const lowValue = Math.round(100 - stops[0].opacity * 100);
        // We don't want to re-create the input whenever the value changes,
        // otherwise that affects the multiple up/down-clicking.
        // But we need to refresh if the value of the input needs to get corrected
        if (this.highInputNode) {
            this.highInputNode.value = "" + highValue;
        }
        if (this.lowInputNode) {
            this.lowInputNode.value = "" + lowValue;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.transparency.transparencyRange), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "transparency-range" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "transparency-range-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.transparency.transparencyHighValues, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { prefixText: percentLabelFlip ? "%" : undefined, suffixText: !percentLabelFlip ? "%" : undefined, value: `${100 - Math.round(stops[1].opacity * 100)}`, min: 0, max: 100, step: 1, scale: "s", numberButtonType: "vertical", ref: (node) => (this.highInputNode = node), onCalciteInputNumberInput: (event) => this.handleRangeChange(event, "high"), label: strings.transparency.transparencyHighValues }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "transparency-range-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.transparency.transparencyLowValues, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { prefixText: percentLabelFlip ? "%" : undefined, suffixText: !percentLabelFlip ? "%" : undefined, value: `${100 - Math.round(stops[0].opacity * 100)}`, min: 0, max: 100, step: 1, scale: "s", numberButtonType: "vertical", ref: (node) => (this.lowInputNode = node), onCalciteInputNumberInput: (event) => this.handleRangeChange(event, "low"), label: strings.transparency.transparencyLowValues }))))));
    }
    renderLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        let isChecked = true;
        const legendOptions = opacityVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            isChecked = false;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "include-legend", layout: "inline-space-between" }, strings.transparency.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    prepareTransparencySlider() {
        var _a;
        const { statistics, histogram, histogramStatus, sliderZoomed } = this;
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: (field === null || field === void 0 ? void 0 : field.simpleFieldType) || _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        const isDateField = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aH)(fieldInfo);
        if (histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return false;
        }
        let min = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue;
        let max = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue;
        ({ min, max } = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)({ min, max }));
        if (!this.transparencySlider) {
            const config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                style: {
                    trackFillColor: new modules.esriColor([84, 84, 84])
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max,
                stops: modules.esriLang.clone(opacityVisVar.stops),
                precision: (0,_precision_06a73672_js__WEBPACK_IMPORTED_MODULE_6__.g)(opacityVisVar.stops)
            };
            if (isDateField) {
                config.hasTimeData = true;
                (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_5__.a)(config, mapView.timeZone);
            }
            this.transparencySlider = new modules.OpacitySlider(config);
            this.createTransparencySliderChangeEvents();
        }
        else {
            const slider = this.transparencySlider;
            if (((_a = slider.slider) === null || _a === void 0 ? void 0 : _a.state) === "dragging") {
                return true;
            }
            const config = {
                histogramConfig: {
                    bins: histogram === null || histogram === void 0 ? void 0 : histogram.bins,
                    average: Math.round(statistics.avg * 10) / 10,
                    standardDeviation: statistics.stddev,
                    standardDeviationCount: 1
                },
                min: min !== null && min !== void 0 ? min : statistics.min,
                max: max !== null && max !== void 0 ? max : statistics.max,
                stops: modules.esriLang.clone(opacityVisVar.stops),
                hasTimeData: isDateField
            };
            isDateField && (0,_date_79c7d93c_js__WEBPACK_IMPORTED_MODULE_5__.a)(config, mapView.timeZone);
            if (sliderZoomed) {
                /**
                 * clicking a zigzag already updates the internal slider zoomOptions;
                 * setting them here again would incorrectly override a user's decision
                 * to manually zoom out one side of the slider.
                 */
                if (!this.zigzagClick) {
                    config.zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(opacityVisVar.stops, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue);
                }
            }
            else {
                config.zoomOptions = null;
            }
            if (this.sliderZoomed && this.adjustedZoomOptions && !this.zigzagClick) {
                config.zoomOptions = this.adjustedZoomOptions;
                /**
                 * handles edge cases where the slider is zoomed, handles have been manually modified,
                 * and a user executes a label change. This prevents zoom options from changing and preserves
                 * the histogram display.
                 */
                if (this.zoomAdjustment === "min") {
                    this.transparencySlider.slider.min = config.zoomOptions.min;
                    config.zoomOptions.min = null;
                }
                else {
                    this.transparencySlider.slider.max = config.zoomOptions.max;
                    config.zoomOptions.max = null;
                }
            }
            this.adjustedZoomOptions = null;
            this.zoomAdjustment = null;
            this.transparencySlider.set(config);
            this.zigzagClick = false;
        }
        return true;
    }
    createTransparencySliderChangeEvents() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        const isDateField = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aH)(fieldInfo);
        if (!this.transparencySlider) {
            return;
        }
        // handles zigzag click
        this.transparencySlider.watch("zoomOptions", (newValue, oldValue) => {
            if (this.sliderZoomed &&
                (((oldValue === null || oldValue === void 0 ? void 0 : oldValue.min) && !(newValue === null || newValue === void 0 ? void 0 : newValue.min)) || ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.max) && !(newValue === null || newValue === void 0 ? void 0 : newValue.max)))) {
                this.zigzagClick = true;
                this.handleZigzagClick(newValue);
            }
        });
        this.transparencySlider.on("min-change", (info) => {
            if (info.value > this.currentStopValues[0]) {
                this.transparencySlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentStopValues[idx];
                });
                this.onMinMaxChange(this.currentStopValues[0], this.transparencySlider.slider.max, "min");
            }
            else {
                this.onMinMaxChange(info.value, this.transparencySlider.slider.max, "min");
            }
        });
        this.transparencySlider.on("max-change", (info) => {
            if (info.value < this.currentStopValues[this.currentStopValues.length - 1]) {
                this.transparencySlider.stops.forEach((stop, idx) => {
                    stop.value = this.currentStopValues[idx];
                });
                this.onMinMaxChange(this.transparencySlider.slider.min, this.currentStopValues[this.currentStopValues.length - 1], "max");
            }
            else {
                this.onMinMaxChange(this.transparencySlider.slider.min, info.value, "max");
            }
        });
        this.transparencySlider.on("thumb-change", (info) => {
            if (isDateField && info.value === 0) {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                return;
            }
            const stops = this.transparencySlider.stops;
            this.updateRendererStops(stops);
        });
        this.transparencySlider.on("thumb-drag", () => {
            const stops = this.transparencySlider.stops;
            this.updateRendererStops(stops);
        });
    }
    afterTransparencySliderCreate(node) {
        if (!this.transparencySlider.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.transparencySlider.container = divNode;
        }
    }
    handleToggle(event) {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const sectionNode = event.target;
        if ((sectionNode.open && opacityVisVar) || (!sectionNode.open && !opacityVisVar)) {
            // nothing has changed; happens when we leave
            return;
        }
        if (opacityVisVar) {
            const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
            this.lastSettings.opacityVisVar = opacityVisVar;
            this.lastSettings.authOpacityVisVar = authOpacityVisVar;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aJ)("opacity", layer);
            this.sliderZoomed = false;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        }
        else {
            if (this.lastSettings.opacityVisVar) {
                renderer.visualVariables = renderer.visualVariables || [];
                renderer.visualVariables.push(this.lastSettings.opacityVisVar);
                renderer.authoringInfo = renderer.authoringInfo || new modules.AuthoringInfo({});
                if (this.lastSettings.authOpacityVisVar) {
                    renderer.authoringInfo.visualVariables = renderer.authoringInfo.visualVariables || [];
                    renderer.authoringInfo.visualVariables.push(this.lastSettings.authOpacityVisVar);
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }
            else {
                // pick first field by default if active
                const firstNumField = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aK)();
                const field = firstNumField ? firstNumField.layerField.name : "";
                this.getOpacityVisualVariable({
                    field,
                    simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
                });
            }
        }
    }
    handleResetSlider() {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.sliderZoomed = false;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        const normalizationField = opacityVisVar.normalizationField;
        createOpacityVisualVariable({
            fieldInfos: [fieldInfo],
            normalizationField
        })
            .then((result) => {
            var _a;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aJ)("opacity", layer);
            if (result.statistics &&
                (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(result.statistics.min) &&
                (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(result.statistics.max) &&
                result.statistics.min <= result.statistics.max) {
                this.statistics = result.statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, result.statistics, result.statistics.min, result.statistics.max);
            }
            else if (((_a = result.statistics) === null || _a === void 0 ? void 0 : _a.count) === 0) {
                // empty layer
                const [defaultMin, defaultMax] = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aL)(fieldInfo);
                this.statistics = {
                    min: defaultMin,
                    max: defaultMax,
                    avg: (defaultMax - defaultMin) / 2,
                    count: 0,
                    median: undefined,
                    stddev: undefined,
                    sum: undefined,
                    variance: undefined
                };
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
            }
            else {
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            }
            renderer.visualVariables = renderer.visualVariables || [];
            renderer.visualVariables.push(result.visualVariable);
            renderer.authoringInfo = renderer.authoringInfo || new modules.AuthoringInfo({});
            renderer.authoringInfo.visualVariables = renderer.authoringInfo.visualVariables || [];
            renderer.authoringInfo.visualVariables.push(result.authoringInfo.visualVariables[0]);
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
        })
            .catch((err) => {
            console.log(err);
        });
    }
    handleZoomSlider(zoomed) {
        var _a, _b, _c, _d;
        if (this.histogramStatus === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.sliderZoomed = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomed) ? zoomed : !this.sliderZoomed;
        const { sliderZoomed, statistics } = this;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
        const zoomOptions = sliderZoomed
            ? (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(opacityVisVar.stops, (_a = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue) !== null && _a !== void 0 ? _a : statistics.min, (_b = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue) !== null && _b !== void 0 ? _b : statistics.max)
            : null;
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        this.getHistogram({
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        }, opacityVisVar.normalizationField, statistics, (zoomOptions && zoomOptions.min) || ((_c = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue) !== null && _c !== void 0 ? _c : statistics.min), (zoomOptions && zoomOptions.max) || ((_d = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue) !== null && _d !== void 0 ? _d : statistics.max));
    }
    handleRangeChange(event, type) {
        const node = event.target;
        let value = node.value ? parseInt(node.value) : 0;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        if (value < 0) {
            value = 0;
        }
        else if (value > 100) {
            value = 100;
        }
        const stops = opacityVisVar.stops;
        let newVal = Math.round((1 - value / 100) * 100) / 100;
        if (type === "high") {
            stops[1].opacity = newVal;
        }
        else {
            // "low"
            stops[0].opacity = newVal;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleIncludeInLegendToggle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const legendOptions = opacityVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions && legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                opacityVisVar.legendOptions = undefined;
            }
        }
        else {
            opacityVisVar.legendOptions = legendOptions || {};
            opacityVisVar.legendOptions.showLegend = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    updateRendererStops(stops) {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
        opacityVisVar.stops = stops;
        this.transparencySlider.stops = stops;
        this.currentStopValues = opacityVisVar.stops.map((stop) => stop.value);
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(opacityVisVar === null || opacityVisVar === void 0 ? void 0 : opacityVisVar.stops, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue, authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue);
        if (this.sliderZoomed) {
            this.zoomButtonNode.disabled = false;
        }
        else if (!zoomOptions ||
            zoomOptions.minMaxSame ||
            (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions.min) && !(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions.max))) {
            this.zoomButtonNode.disabled = true;
        }
        else {
            this.zoomButtonNode.disabled = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    async getOpacityVisualVariable(fieldInfo, normalizationField) {
        var _a;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        this.statistics = undefined;
        this.histogram = undefined;
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.MISSING;
        this.sliderZoomed = false;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        if (["predominance", "predominance-size"].indexOf(rendererType) > -1) {
            try {
                const result = await (0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_8__.a)({
                    includeOpacityVariable: true
                });
                //console.log("createPredominanceRendererFromExisting-result", result);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.e)(result.renderer, layer);
                this.getStatistics();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }
            catch (error) {
                this.arcgisSmartMappingSymbolTransparencyError.emit({
                    message: error.message,
                    type: "error"
                });
            }
        }
        else {
            try {
                const result = await createOpacityVisualVariable({
                    fieldInfos: [fieldInfo],
                    normalizationField
                });
                //console.log("createOpacityVisualVariable-result", result);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aJ)("opacity", layer);
                if (result.statistics &&
                    (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(result.statistics.min) &&
                    (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(result.statistics.max) &&
                    result.statistics.min <= result.statistics.max) {
                    this.statistics = result.statistics;
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                    this.getHistogram(fieldInfo, normalizationField, result.statistics, result.statistics.min, result.statistics.max);
                }
                else if (((_a = result.statistics) === null || _a === void 0 ? void 0 : _a.count) === 0) {
                    // empty layer
                    const [defaultMin, defaultMax] = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aL)(fieldInfo);
                    this.statistics = {
                        min: defaultMin,
                        max: defaultMax,
                        avg: (defaultMax - defaultMin) / 2,
                        count: 0,
                        median: undefined,
                        stddev: undefined,
                        sum: undefined,
                        variance: undefined
                    };
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                }
                else {
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                }
                renderer.visualVariables = renderer.visualVariables || [];
                renderer.visualVariables.push(result.visualVariable);
                renderer.authoringInfo = renderer.authoringInfo || new modules.AuthoringInfo({});
                renderer.authoringInfo.visualVariables = renderer.authoringInfo.visualVariables || [];
                renderer.authoringInfo.visualVariables.push(result.authoringInfo.visualVariables[0]);
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aI)(this.blockNode);
            }
            catch (e) {
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                // can't toggle on without an opacityVisVar
                this.blockSectionNode.open = false;
                console.log(e);
            }
        }
    }
    getStatistics() {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let normalizationField;
        let opacityVisVar;
        let min;
        let max;
        opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        if (!opacityVisVar) {
            // no transparency set
            return;
        }
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        normalizationField = opacityVisVar.normalizationField;
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
        min = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.minSliderValue;
        max = authOpacityVisVar === null || authOpacityVisVar === void 0 ? void 0 : authOpacityVisVar.maxSliderValue;
        this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        if (!this.statistics && layer) {
            modules
                .summaryStatistics({
                layer,
                view: mapView,
                field: fieldInfo.field,
                valueExpression: fieldInfo.expression,
                normalizationField,
                forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
            })
                .then((statistics) => {
                if (statistics.count === 0) {
                    // field has no values
                    // make up some basic statistics so we can show a slider
                    const [defaultMin, defaultMax] = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aL)(fieldInfo);
                    const min = authOpacityVisVar.minSliderValue || defaultMin;
                    const max = authOpacityVisVar.maxSliderValue || defaultMax;
                    statistics = {
                        min,
                        max,
                        avg: (max + min) / 2,
                        count: 0,
                        median: undefined,
                        stddev: undefined,
                        sum: undefined,
                        variance: undefined
                    };
                    this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                    return;
                }
                else if (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(statistics.avg) ||
                    !(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(statistics.min) ||
                    !(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(statistics.max)) {
                    // statistics unusable
                    this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
                    return;
                }
                statistics = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ad)(statistics);
                min = statistics.min;
                max = statistics.max;
                this.statistics = statistics;
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
                this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
            }, (error) => {
                console.log("error-summaryStatistics", error);
                this.statisticsStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
            });
        }
    }
    getHistogram(fieldInfo, normalizationField, statistics, min, max) {
        var _a;
        const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        statistics = statistics || this.statistics;
        if (!statistics || statistics.count === 0) {
            return;
        }
        this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.IN_PROGRESS;
        modules
            .histogram({
            layer: layer,
            view: mapView,
            field: fieldInfo.field,
            valueExpression: fieldInfo.expression,
            numBins: 50,
            minValue: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(min) ? min : statistics.min,
            maxValue: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(max) ? max : statistics.max,
            normalizationField,
            forBinning: "featureReduction" in layer && ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
        })
            .then((histogram) => {
            //console.log("success-histogram", histogram, min, max);
            //isDefined(min) ? min : statistics.min,
            //isDefined(max) ? max : statistics.max,
            this.histogram = histogram;
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.SUCCESS;
        }, (error) => {
            console.log("error-histogram", error);
            this.histogramStatus = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.b.FAILED;
        });
    }
    onMinMaxChange(min, max, changing) {
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity") || {};
        // update only the label that the user is changing
        changing === "min"
            ? (authOpacityVisVar.minSliderValue = min)
            : (authOpacityVisVar.maxSliderValue = max);
        // determine if label updates merit zooming or not
        const zoomOptions = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aC)(opacityVisVar === null || opacityVisVar === void 0 ? void 0 : opacityVisVar.stops, authOpacityVisVar.minSliderValue, authOpacityVisVar.maxSliderValue);
        // handles zoom button display for transparency slider
        if (this.sliderZoomed) {
            this.zoomButtonNode.disabled = false;
        }
        else if (!zoomOptions ||
            zoomOptions.minMaxSame ||
            (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions.min) && !(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_7__.i)(zoomOptions.max))) {
            this.zoomButtonNode.disabled = true;
        }
        else {
            this.zoomButtonNode.disabled = false;
        }
        // zoom adjustment
        if (this.sliderZoomed) {
            this.adjustedZoomOptions = this.transparencySlider.zoomOptions;
            if (changing === "min") {
                this.adjustedZoomOptions.min = min;
                this.zoomAdjustment = "min";
            }
            else {
                this.adjustedZoomOptions.max = max;
                this.zoomAdjustment = "max";
            }
        }
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        const normalizationField = opacityVisVar.normalizationField;
        this.getHistogram(fieldInfo, normalizationField, statistics, min, max);
        if (min === authOpacityVisVar.minSliderValue && max === authOpacityVisVar.maxSliderValue) {
            this.sliderZoomed = false;
        }
    }
    handleZigzagClick(newValue) {
        var _a, _b;
        const { statistics } = this;
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const authOpacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(renderer, "opacity");
        const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(opacityVisVar.field);
        const normalizationField = opacityVisVar === null || opacityVisVar === void 0 ? void 0 : opacityVisVar.normalizationField;
        const fieldInfo = {
            field: opacityVisVar.field,
            expression: opacityVisVar.valueExpression,
            expressionTitle: opacityVisVar.valueExpressionTitle,
            simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
        };
        this.getHistogram(fieldInfo, normalizationField, statistics, (_a = newValue === null || newValue === void 0 ? void 0 : newValue.min) !== null && _a !== void 0 ? _a : authOpacityVisVar.minSliderValue, (_b = newValue === null || newValue === void 0 ? void 0 : newValue.max) !== null && _b !== void 0 ? _b : authOpacityVisVar.maxSliderValue);
        if (!newValue) {
            this.sliderZoomed = false;
        }
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingTransparency.style = arcgisSmartMappingTransparencyCss;



//# sourceMappingURL=arcgis-smart-mapping-background-symbol_6.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/date-79c7d93c.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addDateFormatFunctions),
/* harmony export */   b: () => (/* binding */ utcToTimePicker),
/* harmony export */   d: () => (/* binding */ datePickerToUTC),
/* harmony export */   u: () => (/* binding */ utcToDatePicker)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function addDateFormatFunctions(config, timeZone) {
    config.labelFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputFormatFunction = (value) => {
        return getDateDisplayString(value, timeZone, "short-date");
    };
    config.inputParseFunction = (value) => {
        return mapTZToUTC(Date.parse(value), timeZone);
    };
}
function utcToDatePicker(value, timeZone) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // console.log("utcToDatePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function utcToTimePicker(value, timeZone, addSeconds) {
    // date is in UTC
    // we need a map timezone
    let str;
    if (!timeZone || timeZone === "system") {
        const diff = new Date().getTimezoneOffset();
        str = new Date(value - diff * 60000).toISOString();
    }
    else if (timeZone === "unknown") {
        str = new Date(value).toISOString();
    }
    else {
        const diff = new Date().getTimezoneOffset();
        const mapDateStr = new Date(value).toLocaleString("en-US", { timeZone });
        str = new Date(new Date(mapDateStr).getTime() - diff * 60000).toISOString();
    }
    // str = "2023-09-20T13:06:00.000Z"
    str = addSeconds ? str.substring(11, 19) : str.substring(11, 16);
    // console.log("utcToTimePicker", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}
function datePickerToUTC(dateString, timeZone) {
    // date is in map timezone
    // we need a UTC UNIX timestamp
    let date = new Date(dateString);
    // this is read as current time; toISOString() would reaturn UTC time (e.g. +7 hours from pacific)
    // fix the offset
    date = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
    // date now contains the user's entered time
    let value;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        value = date.getTime() + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        value = date.getTime();
    }
    else {
        // add difference between map time and UTC
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        value = date.getTime() + diff;
    }
    // console.log("datePickerToUTC", date.toISOString(), " -> ", new Date(value).toISOString());
    return value;
}
function mapTZToUTC(value, timeZone) {
    if (!value) {
        return value;
    }
    // value is in map timezone
    // we need a UTC timestamp
    let newValue;
    if (!timeZone || timeZone === "system") {
        // add difference between local time and UTC
        const date = new Date();
        newValue = value + date.getTimezoneOffset() * 60000;
    }
    else if (timeZone === "unknown") {
        // take what you get
        newValue = value;
    }
    else {
        // add difference between map time and UTC
        const date = new Date();
        const diff = new Date(date.toLocaleString("en-US", { timeZone: "utc" })).getTime() -
            new Date(date.toLocaleString("en-US", { timeZone })).getTime();
        newValue = value + diff;
    }
    console.log("mapTZToUTC", value, " - ", new Date(value).toISOString(), " - ", new Date(newValue).toISOString());
    return newValue;
}
function getDateDisplayString(value, timeZone, dateFormat) {
    const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    let str;
    if (timeZone === "unknown") {
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone: "utc", timeZoneName: "shortOffset" }));
    }
    else {
        // known issues with formatting it-CH
        str = modules.intl.formatDate(value, Object.assign(Object.assign({}, modules.intl.convertDateFormatToIntlOptions(dateFormat || "short-date-short-time")), { timeZone }));
    }
    // console.log("getDateDisplayString", value, " - ", new Date(value).toISOString(), " -> ", str);
    return str;
}



//# sourceMappingURL=date-79c7d93c.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTk2N2ZjNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNpSztBQUN5ZTtBQUN2bUI7QUFDMEI7QUFDQztBQUNHO0FBQ0Q7QUFDRDtBQUMwQjtBQUMzRDtBQUNIO0FBQ0U7O0FBRTdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtQ0FBbUMsRUFBRSwrREFBaUI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQSwwRUFBMEUsZ0JBQWdCLGdDQUFnQzs7QUFFMUg7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHdEQUF3RCxxREFBVztBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtRUFBYztBQUMxQixnQkFBZ0IsbUVBQWM7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaUJBQWlCLEVBQUUsK0RBQWlCO0FBQ3BELGFBQWEsbUVBQWE7QUFDMUI7QUFDQTtBQUNBLHlCQUF5QixtRUFBVztBQUNwQyw2QkFBNkIsbUVBQWU7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLDRCQUE0QjtBQUM3QztBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQixFQUFFLCtEQUFpQjtBQUM3RCx5QkFBeUIsbUVBQVc7QUFDcEMsNkJBQTZCLG1FQUFlO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLG1FQUFnQjtBQUN6QztBQUNBLGdCQUFn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QUFDQTtBQUNBOztBQUV5Rzs7QUFFekciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtc21hcnQtbWFwcGluZy1iYWNrZ3JvdW5kLXN5bWJvbF82LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2RhdGUtNzljN2Q5M2MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGYgYXMgZm9yY2VVcGRhdGUsIGQgYXMgZ2V0RWxlbWVudCwgSCBhcyBIb3N0LCBhIGFzIGdldEFzc2V0UGF0aCwgRiBhcyBGcmFnbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSwgRiBhcyBmaW5kUGFyZW50Tm9kZSwgcSBhcyBpc1BvbHlnb25UeXBlLCBnIGFzIGdldFJlbmRlcmVyVHlwZSwgUyBhcyBnZXREZWZhdWx0U3ltYm9sLCByIGFzIGFwcGx5U3ltYm9sQ29sb3IsIGEgYXMgZ2V0VmlzVmFyLCBuIGFzIGdldFZpc1ZhcnNFeGNlcHQsIEUgYXMgY2xvc2VQb3BvdmVycywgaCBhcyBnZXRSZW5kZXJlciwgYWIgYXMgdXBkYXRlUmVuZGVyZXIsIEIgYXMgaXNQb2x5bGluZVR5cGUsIGFnIGFzIGhhc051bWJlckZpZWxkLCBhSSBhcyBzY3JvbGxJbnRvVmlldywgdyBhcyBzaW1wbGVGaWVsZFR5cGVzLCBhSiBhcyByZW1vdmVWaXNWYXIsIGFLIGFzIGdldEZpcnN0TnVtYmVyRmllbGQsIEogYXMgZ2V0UmVuZGVyZXJUaGVtZSwgcCBhcyBnZXRBdXRoVmlzVmFyLCB1IGFzIGdldEZpZWxkLCBiIGFzIHN0YXR1cywgYXQgYXMgZ2V0UGVyY2VudExhYmVsRmxpcCwgSSBhcyBnZXRMYXllckZpZWxkVHlwZUNvdW50LCBhZCBhcyB2YWxpZGF0ZU1pbk1heCwgYUwgYXMgZ2V0RGVmYXVsdERhdGFSYW5nZSwgZSBhcyBhcHBseVJlbmRlcmVyLCBhQyBhcyBnZXRab29tT3B0aW9ucywgYUggYXMgaXNEYXRlIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBMIGFzIExhc3RTb3J0eUJ5IH0gZnJvbSAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGREYXRlRm9ybWF0RnVuY3Rpb25zIH0gZnJvbSAnLi9kYXRlLTc5YzdkOTNjLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0U3RvcFByZWNpc2lvbiB9IGZyb20gJy4vcHJlY2lzaW9uLTA2YTczNjcyLmpzJztcbmltcG9ydCB7IGkgYXMgaXNEZWZpbmVkIH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuaW1wb3J0IHsgYSBhcyBjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlckZyb21FeGlzdGluZyB9IGZyb20gJy4vcHJlZG9taW5hbmNlLWExYTJkNzRkLmpzJztcbmltcG9ydCAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIGxheWVyIHdpdGggYSBEb3REZW5zaXR5IHJlbmRlcmVyIHdpdGggZGVmYXVsdCBzZXR0aW5nc1xuICogQHBhcmFtIHByb3BzOiBtdXN0IGNvbnRhaW4gbGF5ZXIsIG1hcFZpZXcsIEdhbGxlcnlGaWVsZHNbXVxuICogQHBhcmFtIG9wdGlvbnM6IG9wdGlvbnNcbiAqL1xuZnVuY3Rpb24gY3JlYXRlT3BhY2l0eVZpc3VhbFZhcmlhYmxlKG9wdGlvbnMpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoIW9wdGlvbnMuZmllbGRJbmZvcyAmJiAhKChfYSA9IG9wdGlvbnMuZmllbGRJbmZvcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG4gICAgfVxuICAgIGNvbnN0IGZpZWxkSW5mbyA9IG9wdGlvbnMuZmllbGRJbmZvc1swXTtcbiAgICByZXR1cm4gbW9kdWxlcy5PcGFjaXR5VmFyaWFibGVDcmVhdG9yLmNyZWF0ZVZpc3VhbFZhcmlhYmxlKHtcbiAgICAgICAgbGF5ZXIsXG4gICAgICAgIGZpZWxkOiBmaWVsZEluZm8uZmllbGQsXG4gICAgICAgIHZpZXc6IG1hcFZpZXcsXG4gICAgICAgIHZhbHVlRXhwcmVzc2lvbjogZmllbGRJbmZvLmV4cHJlc3Npb24sXG4gICAgICAgIHZhbHVlRXhwcmVzc2lvblRpdGxlOiBmaWVsZEluZm8uZXhwcmVzc2lvblRpdGxlLFxuICAgICAgICBub3JtYWxpemF0aW9uRmllbGQ6IG9wdGlvbnMubm9ybWFsaXphdGlvbkZpZWxkLFxuICAgICAgICBmb3JCaW5uaW5nOiAoKF9iID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgIH0pO1xufVxuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdCYWNrZ3JvdW5kU3ltYm9sQ3NzID0gXCIuYmFja2dyb3VuZC1zeW1ib2wtY29udGVudHtwYWRkaW5nLXRvcDo2cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2UwZTBlMH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbENoYW5nZVwiLCA3KTtcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBQcm9wZXJ0aWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3MgPSB7fTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50ID1cbiAgICAgICAgICAgIGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIikgfHxcbiAgICAgICAgICAgICAgICBmaW5kUGFyZW50Tm9kZSh0aGlzLmhvc3RFbGVtZW50LCBcImNhbGNpdGUtcGFuZWxcIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmICghaXNQb2x5Z29uVHlwZShsYXllcikpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZE9iaiA9IHJlbmRlcmVyVHlwZSA9PT0gXCJkb3QtZGVuc2l0eVwiXG4gICAgICAgICAgICA/IHJlbmRlcmVyLmJhY2tncm91bmRDb2xvciB8fCByZW5kZXJlci5vdXRsaW5lXG4gICAgICAgICAgICA6IHJlbmRlcmVyLmJhY2tncm91bmRGaWxsU3ltYm9sO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmJhY2tncm91bmRTeW1ib2wuc2hvd0JhY2tncm91bmRTeW1ib2wsIG9wZW46ICEhYmFja2dyb3VuZE9iaiwgXCJ0b2dnbGUtZGlzcGxheVwiOiBcInN3aXRjaFwiLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVCYWNrZ3JvdW5kU3ltYm9sVG9nZ2xlKGUpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnJlbmRlckJhY2tncm91bmRTeW1ib2xDb250ZW50KCkpKTtcbiAgICB9XG4gICAgcmVuZGVyQmFja2dyb3VuZFN5bWJvbENvbnRlbnQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IGlzRG90RGVuc2l0eSA9IHJlbmRlcmVyVHlwZSA9PT0gXCJkb3QtZGVuc2l0eVwiO1xuICAgICAgICBsZXQgc3ltYm9sO1xuICAgICAgICBpZiAoaXNEb3REZW5zaXR5KSB7XG4gICAgICAgICAgICBpZiAocmVuZGVyZXIub3V0bGluZSB8fCByZW5kZXJlci5iYWNrZ3JvdW5kQ29sb3IpIHtcbiAgICAgICAgICAgICAgICBzeW1ib2wgPSBnZXREZWZhdWx0U3ltYm9sKGxheWVyLCBtYXBWaWV3KTtcbiAgICAgICAgICAgICAgICBzeW1ib2wub3V0bGluZSA9IHJlbmRlcmVyLm91dGxpbmU7XG4gICAgICAgICAgICAgICAgYXBwbHlTeW1ib2xDb2xvcihzeW1ib2wsIHJlbmRlcmVyLmJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzeW1ib2wgPSByZW5kZXJlci5iYWNrZ3JvdW5kRmlsbFN5bWJvbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN5bWJvbCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCA9XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50IHx8XG4gICAgICAgICAgICAgICAgZmluZFBhcmVudE5vZGUodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3ctaXRlbVwiKSB8fFxuICAgICAgICAgICAgICAgIGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1wYW5lbFwiKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYmFja2dyb3VuZC1zeW1ib2wtY29udGVudFwiIH0sIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgdHlwZTogaXNEb3REZW5zaXR5ID8gXCJkb3QtZGVuc2l0eS1iYWNrZ3JvdW5kXCIgOiBcImJhY2tncm91bmRcIiwgbGFiZWw6IHN0cmluZ3MuYmFja2dyb3VuZFN5bWJvbC5iYWNrZ3JvdW5kU3R5bGUsIHN5bWJvbDogc3ltYm9sLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbENoYW5nZS5lbWl0KCk7XG4gICAgICAgICAgICB9LCBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudDogdGhpcy5wb3BvdmVyUmVmZXJlbmNlRWxlbWVudCB9KSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgaGFuZGxlQmFja2dyb3VuZFN5bWJvbFRvZ2dsZShlKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcEltYWdlU3VibGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBibG9ja1NlY3Rpb24gPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJkb3QtZGVuc2l0eVwiKSB7XG4gICAgICAgICAgICBpZiAoYmxvY2tTZWN0aW9uLm9wZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0U2V0dGluZ3MuYmFja2dyb3VuZENvbG9yIHx8IHRoaXMubGFzdFNldHRpbmdzLm91dGxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYmFja2dyb3VuZENvbG9yID0gdGhpcy5sYXN0U2V0dGluZ3MuYmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5vdXRsaW5lID0gdGhpcy5sYXN0U2V0dGluZ3Mub3V0bGluZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmJhY2tncm91bmRDb2xvciA9IG5ldyBtb2R1bGVzLmVzcmlDb2xvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICByOiA2NCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGc6IDY0LFxuICAgICAgICAgICAgICAgICAgICAgICAgYjogNjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBhOiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5vdXRsaW5lID0gbmV3IG1vZHVsZXMuU2ltcGxlTGluZVN5bWJvbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0U2V0dGluZ3Mub3V0bGluZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHRoaXMubGFzdFNldHRpbmdzLm91dGxpbmVWaXNWYXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTZXR0aW5ncy5iYWNrZ3JvdW5kQ29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3Mub3V0bGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTZXR0aW5ncy5vdXRsaW5lVmlzVmFyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3MuYmFja2dyb3VuZENvbG9yID0gcmVuZGVyZXIuYmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLm91dGxpbmUgPSByZW5kZXJlci5vdXRsaW5lO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLm91dGxpbmVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiLCBcIm91dGxpbmVcIik7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYmFja2dyb3VuZENvbG9yID0gbmV3IG1vZHVsZXMuZXNyaUNvbG9yKHtcbiAgICAgICAgICAgICAgICAgICAgcjogMCxcbiAgICAgICAgICAgICAgICAgICAgZzogMCxcbiAgICAgICAgICAgICAgICAgICAgYjogMCxcbiAgICAgICAgICAgICAgICAgICAgYTogMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLm91dGxpbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGF1dG8gb3V0bGluZSBzaXppbmdcbiAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlbmRlcmVyLCBcInNpemVcIiwgXCJvdXRsaW5lXCIpO1xuICAgICAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChibG9ja1NlY3Rpb24ub3Blbikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxhc3RTZXR0aW5ncy5iYWNrZ3JvdW5kRmlsbFN5bWJvbCkge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5iYWNrZ3JvdW5kRmlsbFN5bWJvbCA9IHRoaXMubGFzdFNldHRpbmdzLmJhY2tncm91bmRGaWxsU3ltYm9sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3U3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgICAgICAgICAgICAgIG5ld1N5bWJvbC5jb2xvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmJhY2tncm91bmRGaWxsU3ltYm9sID0gbmV3U3ltYm9sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RTZXR0aW5ncy5iYWNrZ3JvdW5kRmlsbFN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLmJhY2tncm91bmRGaWxsU3ltYm9sID0gcmVuZGVyZXIuYmFja2dyb3VuZEZpbGxTeW1ib2w7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYmFja2dyb3VuZEZpbGxTeW1ib2wgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChtYXBJbWFnZVN1YmxheWVyKSB7XG4gICAgICAgICAgICBtYXBJbWFnZVN1YmxheWVyLnJlbmRlcmVyID0gcmVuZGVyZXIuY2xvbmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbC5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ0JhY2tncm91bmRTeW1ib2xDc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xDc3MgPSBcIi5vcGVue2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlMGUwZTB9LmJsb2NrLXNlY3Rpb24tcGFkZGluZ3twYWRkaW5nLXRvcDo2cHh9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2wgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nRGVmYXVsdFN5bWJvbEJlZm9yZVRvZ2dsZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nRGVmYXVsdFN5bWJvbEJlZm9yZVRvZ2dsZVwiLCA3KTtcbiAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3MgPSB7fTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGxldCB0ZXh0ID0gc3RyaW5ncy5kZWZhdWx0U3ltYm9sLnNob3dEZWZhdWx0U3ltYm9sO1xuICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICAgICAgaWYgKCFjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgICAgIHRleHQgPSBzdHJpbmdzLmRlZmF1bHRTeW1ib2wuc2hvd0RlZmF1bHRTeW1ib2xDbGFzc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlbmRlcmVyVHlwZSA9PT0gXCJzaXplXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgIGlmICghc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgICAgIHRleHQgPSBzdHJpbmdzLmRlZmF1bHRTeW1ib2wuc2hvd0RlZmF1bHRTeW1ib2xDbGFzc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN5bWJvbCA9IHJlbmRlcmVyLmRlZmF1bHRTeW1ib2w7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2stc2VjdGlvblwiLCB7IHRleHQ6IHRleHQsIG9wZW46ICEhc3ltYm9sLCBcInRvZ2dsZS1kaXNwbGF5XCI6IFwic3dpdGNoXCIsIG9uQ2FsY2l0ZUJsb2NrU2VjdGlvblRvZ2dsZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sQmVmb3JlVG9nZ2xlLmVtaXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURlZmF1bHRTeW1ib2xUb2dnbGUoZXZlbnQpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYmxvY2tTZWN0aW9uTm9kZSA9IG5vZGUpIH0sIHRoaXMucmVuZGVyRGVmYXVsdFN5bWJvbENvbnRlbnQoKSkpO1xuICAgIH1cbiAgICByZW5kZXJEZWZhdWx0U3ltYm9sQ29udGVudCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwVmlldyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBsZXQgc3ltYm9sO1xuICAgICAgICBpZiAocmVuZGVyZXIuZGVmYXVsdFN5bWJvbCkge1xuICAgICAgICAgICAgc3ltYm9sID0gcmVuZGVyZXIuZGVmYXVsdFN5bWJvbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmxhc3RTZXR0aW5ncy5kZWZhdWx0U3ltYm9sKSB7XG4gICAgICAgICAgICBzeW1ib2wgPSB0aGlzLmxhc3RTZXR0aW5ncy5kZWZhdWx0U3ltYm9sO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzeW1ib2wpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInN5bWJvbC1idXR0b24tY29udGVudCBibG9jay1zZWN0aW9uLXBhZGRpbmdcIiB9LCBoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctc3ltYm9sLWJ1dHRvblwiLCB7IHN5bWJvbDogc3ltYm9sLCB0eXBlOiBcImRlZmF1bHRcIiwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbEJ1dHRvblN5bWJvbENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLmRlZmF1bHRTeW1ib2wgPSByZW5kZXJlci5kZWZhdWx0U3ltYm9sO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSB9KSwgdGhpcy5yZW5kZXJMYWJlbCgpKSk7XG4gICAgfVxuICAgIHJlbmRlckxhYmVsKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRMYWJlbCA9IHJlbmRlcmVyLmRlZmF1bHRMYWJlbCB8fCBzdHJpbmdzLmRlZmF1bHRTeW1ib2wub3RoZXI7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5kZWZhdWx0U3ltYm9sLmxhYmVsLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogZGVmYXVsdExhYmVsLCBvbkNhbGNpdGVJbnB1dENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0TGFiZWxOb2RlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxDaGFuZ2VIYW5kbGUgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlTGFiZWxDaGFuZ2UoKSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5sYWJlbENoYW5nZUhhbmRsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGFiZWxDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkZvY3Vzb3V0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGFiZWxDaGFuZ2UoKTtcbiAgICAgICAgICAgIH0sIG9uS2V5VXA6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdExhYmVsTm9kZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsQ2hhbmdlSGFuZGxlID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZUxhYmVsQ2hhbmdlKCksIDMwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubGFiZWxDaGFuZ2VIYW5kbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUxhYmVsQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZGVmYXVsdExhYmVsTm9kZSA9IG5vZGUpIH0pKSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGhhbmRsZURlZmF1bHRTeW1ib2xUb2dnbGUoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwVmlldywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBkZWZhdWx0U3ltYm9sVG9nZ2xlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgaWYgKGRlZmF1bHRTeW1ib2xUb2dnbGUub3Blbikge1xuICAgICAgICAgICAgdGhpcy5ibG9ja1NlY3Rpb25Ob2RlLmNsYXNzTGlzdC5hZGQoXCJvcGVuXCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMubGFzdFNldHRpbmdzLmRlZmF1bHRTeW1ib2wpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0U3ltYm9sID0gdGhpcy5sYXN0U2V0dGluZ3MuZGVmYXVsdFN5bWJvbDtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0TGFiZWwgPSB0aGlzLmxhc3RTZXR0aW5ncy5kZWZhdWx0TGFiZWwgfHwgc3RyaW5ncy5kZWZhdWx0U3ltYm9sLm90aGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3U3ltYm9sID0gZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCA9IG5ld1N5bWJvbDtcbiAgICAgICAgICAgICAgICByZW5kZXJlci5kZWZhdWx0TGFiZWwgPSByZW5kZXJlci5kZWZhdWx0TGFiZWwgfHwgc3RyaW5ncy5kZWZhdWx0U3ltYm9sLm90aGVyO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLmRlZmF1bHRTeW1ib2wgPSByZW5kZXJlci5kZWZhdWx0U3ltYm9sO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLmRlZmF1bHRMYWJlbCA9IHJlbmRlcmVyLmRlZmF1bHRMYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tTZWN0aW9uTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwib3BlblwiKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFNldHRpbmdzLmRlZmF1bHRTeW1ib2wgPSByZW5kZXJlci5kZWZhdWx0U3ltYm9sO1xuICAgICAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3MuZGVmYXVsdExhYmVsID0gcmVuZGVyZXIuZGVmYXVsdExhYmVsO1xuICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ0RlZmF1bHRTeW1ib2xDaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBoYW5kbGVMYWJlbENoYW5nZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdExhYmVsTm9kZS52YWx1ZSkge1xuICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gc3RyaW5ncy5kZWZhdWx0U3ltYm9sLm90aGVyO1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0TGFiZWxOb2RlLnZhbHVlID0gc3RyaW5ncy5kZWZhdWx0U3ltYm9sLm90aGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gdGhpcy5kZWZhdWx0TGFiZWxOb2RlLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sLnN0eWxlID0gYXJjZ2lzU21hcnRNYXBwaW5nRGVmYXVsdFN5bWJvbENzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nTWV0aG9kQnV0dG9uQ3NzID0gXCIubWV0aG9kLWJ1dHRvbntkaXNwbGF5OmZsZXg7cGFkZGluZzo2cHg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO2JvcmRlci1yYWRpdXM6MDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKTtib3JkZXItd2lkdGg6MnB4O2JvcmRlci1zdHlsZTpzb2xpZDtib3gtc2hhZG93OnRyYW5zcGFyZW50IDBweCAwcHggMHB4IDFweCBpbnNldH0ubWV0aG9kLWJ1dHRvbjphY3RpdmV7Ym94LXNoYWRvdzppbnNldCAwIDAgMCAxcHggdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS5tZXRob2QtYnV0dG9uOmZvY3Vze2JveC1zaGFkb3c6aW5zZXQgMCAwIDAgMXB4IHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKTtvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9Lm1ldGhvZC1idXR0b24uYWN0aXZle291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktZm9jdXMtY29sb3IsIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpKX0ubWV0aG9kLWNvbnRlbnR7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjt3aWR0aDoxMDAlfS5tZXRob2QtYnV0dG9uLXRleHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzowIDEwcHh9Lm1ldGhvZC1idXR0b24tdGl0bGV7Zm9udC13ZWlnaHQ6Ym9sZH0ubWV0aG9kLWJ1dHRvbi1tc2d7Zm9udC1zaXplOjgwJTtsaW5lLWhlaWdodDoxNnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdNZXRob2RCdXR0b24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nTWV0aG9kQnV0dG9uQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkJlZm9yZU9wZW4gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkJlZm9yZU9wZW5cIiwgNyk7XG4gICAgICAgIHRoaXMubWV0aG9kSW5mb3MgPSBbXTtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd1N0ZERldiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNob3dEZWZpbmVkSW50ZXJ2YWwgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLyoqXG4gICAgICogU2V0IGZvY3VzIG9uIGNvbXBvbmVudFxuICAgICAqL1xuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB0aGlzLmJ1dHRvbk5vZGUuZm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnBvcHVsYXRlTWV0aG9kSW5mbygpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbigpO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVXBkYXRlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgbWV0aG9kID0gYXV0aEluZm8uY2xhc3NpZmljYXRpb25NZXRob2Q7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkTWV0aG9kSW5mby52YWx1ZSAhPT0gbWV0aG9kKSB7XG4gICAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5tZXRob2RCdXR0b24ubWV0aG9kLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwibWV0aG9kLWJ1dHRvblwiLCByb2xlOiBcImJ1dHRvblwiLCB0YWJpbmRleDogXCIwXCIsIFwiYXJpYS1oYXNwb3B1cFwiOiBcInRydWVcIiwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MubWV0aG9kQnV0dG9uLnNlbGVjdE1ldGhvZCwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIiBcIiB8fCBldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuTWV0aG9kRHJvcGRvd24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB0aGlzLm9wZW5NZXRob2REcm9wZG93bigpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJtZXRob2QtY29udGVudFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJtZXRob2QtYnV0dG9uLXRleHRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwibWV0aG9kLWJ1dHRvbi10aXRsZVwiIH0sIHRoaXMuc2VsZWN0ZWRNZXRob2RJbmZvLnRpdGxlKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIm1ldGhvZC1idXR0b24tbXNnXCIgfSwgdGhpcy5zZWxlY3RlZE1ldGhvZEluZm8ubXNnKSksIGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJjaGV2cm9uLWRvd25cIiB9KSkpKSkpKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgc2V0U2VsZWN0aW9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGF1dGhJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbztcbiAgICAgICAgY29uc3QgbWV0aG9kID0gYXV0aEluZm8uY2xhc3NpZmljYXRpb25NZXRob2Q7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRNZXRob2RJbmZvID0gdGhpcy5tZXRob2RJbmZvcy5maW5kKChpbmZvKSA9PiBpbmZvLnZhbHVlID09PSBtZXRob2QpO1xuICAgICAgICB0aGlzLm1ldGhvZEluZm9zLmZvckVhY2goKG1ldGhvZEluZm8pID0+IHtcbiAgICAgICAgICAgIG1ldGhvZEluZm8uc2VsZWN0ZWQgPSBtZXRob2RJbmZvLnZhbHVlID09PSB0aGlzLnNlbGVjdGVkTWV0aG9kSW5mby52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHBvcHVsYXRlTWV0aG9kSW5mbygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgdGhpcy5tZXRob2RJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgIHZhbHVlOiBcIm5hdHVyYWwtYnJlYWtzXCIsXG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5tZXRob2RCdXR0b24ubmF0dXJhbEJyZWFrcyxcbiAgICAgICAgICAgIG1zZzogc3RyaW5ncy5tZXRob2RCdXR0b24ubmF0dXJhbEJyZWFrc01zZyxcbiAgICAgICAgICAgIGljb25QYXRoOiBudWxsLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHZhbHVlOiBcImVxdWFsLWludGVydmFsXCIsXG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5tZXRob2RCdXR0b24uZXF1YWxJbnRlcnZhbCxcbiAgICAgICAgICAgIG1zZzogc3RyaW5ncy5tZXRob2RCdXR0b24uZXF1YWxJbnRlcnZhbE1zZyxcbiAgICAgICAgICAgIGljb25QYXRoOiBudWxsLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5zaG93U3RkRGV2KSB7XG4gICAgICAgICAgICB0aGlzLm1ldGhvZEluZm9zLnB1c2goe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBcInN0YW5kYXJkLWRldmlhdGlvblwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLm1ldGhvZEJ1dHRvbi5zdGFuZGFyZERldmlhdGlvbixcbiAgICAgICAgICAgICAgICBtc2c6IHN0cmluZ3MubWV0aG9kQnV0dG9uLnN0YW5kYXJkRGV2aWF0aW9uTXNnLFxuICAgICAgICAgICAgICAgIGljb25QYXRoOiBudWxsLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tZXRob2RJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgIHZhbHVlOiBcInF1YW50aWxlXCIsXG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5tZXRob2RCdXR0b24ucXVhbnRpbGUsXG4gICAgICAgICAgICBtc2c6IHN0cmluZ3MubWV0aG9kQnV0dG9uLnF1YW50aWxlTXNnLFxuICAgICAgICAgICAgaWNvblBhdGg6IG51bGwsXG4gICAgICAgICAgICBzZWxlY3RlZDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLnNob3dEZWZpbmVkSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHRoaXMubWV0aG9kSW5mb3MucHVzaCh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiZGVmaW5lZC1pbnRlcnZhbFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLm1ldGhvZEJ1dHRvbi5kZWZpbmVkSW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgbXNnOiBzdHJpbmdzLm1ldGhvZEJ1dHRvbi5kZWZpbmVkSW50ZXJ2YWxNc2csXG4gICAgICAgICAgICAgICAgaWNvblBhdGg6IG51bGwsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1ldGhvZEluZm9zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IFwibWFudWFsXCIsXG4gICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5tZXRob2RCdXR0b24ubWFudWFsQnJlYWtzLFxuICAgICAgICAgICAgbXNnOiBzdHJpbmdzLm1ldGhvZEJ1dHRvbi5tYW51YWxCcmVha3NNc2csXG4gICAgICAgICAgICBpY29uUGF0aDogbnVsbCxcbiAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2xvc2VQb3BvdmVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5kcm9wZG93bk5vZGUpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuZHJvcGRvd25Ob2RlLnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmVDaGlsZCh0aGlzLmRyb3Bkb3duTm9kZSk7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duTm9kZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvbk5vZGUuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvcGVuTWV0aG9kRHJvcGRvd24oKSB7XG4gICAgICAgIGlmICghdGhpcy5vcGVuKSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkJlZm9yZU9wZW4uZW1pdCgpO1xuICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZHJvcGRvd25cIik7XG4gICAgICAgICAgICBkcm9wZG93bi5idXR0b25Ob2RlID0gdGhpcy5idXR0b25Ob2RlO1xuICAgICAgICAgICAgZHJvcGRvd24uaW5mb3MgPSB0aGlzLm1ldGhvZEluZm9zO1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93bk5vZGUgPSBkcm9wZG93bjtcbiAgICAgICAgICAgIGRyb3Bkb3duLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNTbWFydE1hcHBpbmdEcm9wZG93bkNsb3NlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQuZGV0YWlsID09PSBcIkVzY2FwZVwiICYmIHRoaXMuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ0Ryb3Bkb3duQ2hhbmdlXCIsIChldmVudCkgPT4gdGhpcy5zZXRNZXRob2QoZXZlbnQuZGV0YWlsKSk7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvbk5vZGUuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZHJvcGRvd24pO1xuICAgICAgICAgICAgdGhpcy5vcGVuID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldE1ldGhvZChuZXdNZXRob2RJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgYXV0aEluZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvO1xuICAgICAgICBjb25zdCBjdXJyZW50TWV0aG9kID0gYXV0aEluZm8uY2xhc3NpZmljYXRpb25NZXRob2Q7XG4gICAgICAgIGNvbnN0IG5ld01ldGhvZCA9IG5ld01ldGhvZEluZm8udmFsdWU7XG4gICAgICAgIGlmIChuZXdNZXRob2QgPT09IGN1cnJlbnRNZXRob2QpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VQb3BvdmVyKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc2V0Rm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWV0aG9kSW5mb3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubWV0aG9kSW5mb3NbaV0uc2VsZWN0ZWQgPSB0aGlzLm1ldGhvZEluZm9zW2ldLnZhbHVlID09PSBuZXdNZXRob2Q7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZWxlY3RlZE1ldGhvZEluZm8gPSBuZXdNZXRob2RJbmZvO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ01ldGhvZEJ1dHRvbkNoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWRNZXRob2RJbmZvLnZhbHVlKTtcbiAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldEZvY3VzKCksIDMwMCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdNZXRob2RCdXR0b24uc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdNZXRob2RCdXR0b25Dc3M7XG5cbmNvbnN0IGFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uQ3NzID0gXCIudG9nZ2xlLWJ1dHRvbnttYXJnaW4tdG9wOjJweH0uYmxvY2stc2VjdGlvbi1wYWRkaW5ne3BhZGRpbmctdG9wOjZweH0uYmxvY2stY29udGVudC1wYWRkaW5ne21hcmdpbjo2cHggMH0uYmxvY2stY29udGVudC1sb2FkaW5ne2hlaWdodDoxNTBweH0ucm90YXRpb24tdHlwZXttYXJnaW4tdG9wOjVweH0ucm90YXRpb24tdHlwZS1zZWxlY3Rpb257bWFyZ2luLXRvcDoxNXB4fS5yb3RhdGlvbi10eXBlLWRpc3BsYXl7bWFyZ2luOjEwcHggMjBweCAwIDIwcHg7cG9zaXRpb246cmVsYXRpdmV9LnJvdGF0aW9uLXR5cGUtZGlzcGxheSBzdmd7aGVpZ2h0OjEyMHB4fS5yb3RhdGlvbi10eXBlLXN5bWJvbHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NTZweDtsZWZ0OjMzcHh9LmFyY2dpcy0tcnRsIC5yb3RhdGlvbi10eXBlLXN5bWJvbHtsZWZ0OmF1dG87cmlnaHQ6NjFweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUm90YXRpb24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvdGF0aW9uVHlwZSA9IFwiZ2VvZ3JhcGhpY1wiO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwicm90YXRpb25cIik7XG4gICAgICAgIHRoaXMuaXNCbG9ja09wZW4gPSB0aGlzLm9wZW4gfHwgISFyb3RhdGlvblZpc1ZhcjtcbiAgICAgICAgdGhpcy5mbG93SXRlbU5vZGUgPSBmaW5kUGFyZW50Tm9kZSh0aGlzLmhvc3RFbGVtZW50LCBcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGlzUlRMLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncywgc3VwcG9ydHNBcmNhZGUgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJzaXplXCIpO1xuICAgICAgICBjb25zdCBpc0dlb1JTU0xheWVyID0gbGF5ZXIudHlwZSA9PT0gXCJnZW8tcnNzXCI7XG4gICAgICAgIGlmICgobWFwSW1hZ2VTdWJsYXllciAmJiAhc3VwcG9ydHNBcmNhZGUpIHx8XG4gICAgICAgICAgICBpc1BvbHlsaW5lVHlwZShsYXllcikgfHxcbiAgICAgICAgICAgIChpc1BvbHlnb25UeXBlKGxheWVyKSAmJiAhc2l6ZVZpc1ZhcikgfHxcbiAgICAgICAgICAgICFoYXNOdW1iZXJGaWVsZCgpIHx8XG4gICAgICAgICAgICBpc0dlb1JTU0xheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtYmxvY2tcIiwgeyBpZDogXCJyb3RhdGlvbi1ibG9ja1wiLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBpc1JUTFxuICAgICAgICAgICAgfSwgaGVhZGluZzogc3RyaW5ncy5yb3RhdGlvbi5yb3RhdGlvbkJ5QXR0cmlidXRlLCBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogdGhpcy5pc0Jsb2NrT3BlbiwgbG9hZGluZzogdGhpcy5pc0xvYWRpbmcsIHJlZjogKG5vZGUpID0+ICh0aGlzLmJsb2NrTm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVCbG9ja09wZW46ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQmxvY2tPcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLmJsb2NrTm9kZSk7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVCbG9ja0Nsb3NlOiAoKSA9PiAodGhpcy5pc0Jsb2NrT3BlbiA9IGZhbHNlKSB9LCBoKFwiZGl2XCIsIG51bGwsIHRoaXMucmVuZGVyUm90YXRpb25Ub2dnbGUoKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckxvYWRpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImJsb2NrLWNvbnRlbnQtbG9hZGluZ1wiIH0sIGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiBzdHJpbmdzLmxvYWRpbmcgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb25Ub2dnbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwicm90YXRpb25cIik7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2stc2VjdGlvblwiLCB7IHRleHQ6IHN0cmluZ3Mucm90YXRpb24ucm90YXRpb25MYWJlbCwgY2xhc3M6IFwidG9nZ2xlLWJ1dHRvblwiLCB0b2dnbGVEaXNwbGF5OiBcInN3aXRjaFwiLCBvcGVuOiAhIXJvdGF0aW9uVmlzVmFyLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6ICgpID0+IHRoaXMuaGFuZGxlVG9nZ2xlKCkgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImJsb2NrLXNlY3Rpb24tcGFkZGluZ1wiIH0sIHRoaXMuaXNMb2FkaW5nXG4gICAgICAgICAgICA/IHRoaXMucmVuZGVyTG9hZGluZygpXG4gICAgICAgICAgICA6IHJvdGF0aW9uVmlzVmFyXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlbmRlclJvdGF0aW9uQ29udGVudCgpXG4gICAgICAgICAgICAgICAgOiB0aGlzLnJlbmRlckxvYWRpbmcoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb25Db250ZW50KCkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5yZW5kZXJSb3RhdGlvbkF0dHJpYnV0ZSgpLCB0aGlzLnJlbmRlclJvdGF0aW9uVHlwZSgpKSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uQXR0cmlidXRlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBmaWVsZHMsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwicm90YXRpb25cIik7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiByb3RhdGlvblZpc1Zhci5maWVsZCxcbiAgICAgICAgICAgIGV4cHJlc3Npb246IHJvdGF0aW9uVmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogcm90YXRpb25WaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWF0dHJpYnV0ZS1pbnB1dFwiLCB7IGZpZWxkTGlzdDogZmllbGRzLmZpbHRlcigoZmllbGQpID0+IGZpZWxkLnNpbXBsZUZpZWxkVHlwZSA9PT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpLCBzZWxlY3RlZEZpZWxkOiBmaWVsZEluZm8sIGxhYmVsOiBzdHJpbmdzLnJvdGF0aW9uLmZpZWxkLCBtb2RlOiBcImV4cHJlc3Npb25cIiwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRSb3RhdGlvblZpc3VhbFZhcmlhYmxlKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dEVycm9yOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uRXJyb3IuZW1pdChldmVudC5kZXRhaWwpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uVHlwZSgpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgbGV0IGxlYWRpbmdEZWdyZWUgPSBmYWxzZTtcbiAgICAgICAgaWYgKHN0cmluZ3Mucm90YXRpb24ucm90YXRlWmVyb0RlZ3JlZXMuaW5kZXhPZihcIsKwXCIpID09PSAwKSB7XG4gICAgICAgICAgICBsZWFkaW5nRGVncmVlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJyb3RhdGlvbi10eXBlIGJsb2NrLWNvbnRlbnQtcGFkZGluZ1wiIH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvbi1ncm91cFwiLCB7IGNsYXNzOiBcInJvdGF0aW9uLXR5cGUtc2VsZWN0aW9uXCIsIG5hbWU6IFwicm90YXRpb25UeXBlXCIsIG9uQ2FsY2l0ZVJhZGlvQnV0dG9uR3JvdXBDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVHlwZUNoYW5nZShldmVudC50YXJnZXQuc2VsZWN0ZWRJdGVtLnZhbHVlKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lXCIgfSwgaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uXCIsIHsgY2hlY2tlZDogdGhpcy5yb3RhdGlvblR5cGUgPT09IFwiZ2VvZ3JhcGhpY1wiLCB2YWx1ZTogXCJnZW9ncmFwaGljXCIgfSksIHN0cmluZ3Mucm90YXRpb24uZ2VvZ3JhcGhpYyksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZVwiIH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNoZWNrZWQ6IHRoaXMucm90YXRpb25UeXBlID09PSBcImFyaXRobWV0aWNcIiwgdmFsdWU6IFwiYXJpdGhtZXRpY1wiIH0pLCBzdHJpbmdzLnJvdGF0aW9uLmFyaXRobWV0aWMpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInJvdGF0aW9uLXR5cGUtZGlzcGxheVwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIHRoaXMucm90YXRpb25UeXBlID09PSBcImFyaXRobWV0aWNcIlxuICAgICAgICAgICAgPyBsZWFkaW5nRGVncmVlXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlbmRlclJvdGF0aW9uU1ZHX0FyaV9sZWFkaW5nKClcbiAgICAgICAgICAgICAgICA6IHRoaXMucmVuZGVyUm90YXRpb25TVkdfQXJpKClcbiAgICAgICAgICAgIDogbGVhZGluZ0RlZ3JlZVxuICAgICAgICAgICAgICAgID8gdGhpcy5yZW5kZXJSb3RhdGlvblNWR19HZW9fbGVhZGluZygpXG4gICAgICAgICAgICAgICAgOiB0aGlzLnJlbmRlclJvdGF0aW9uU1ZHX0dlbygpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm90YXRpb24tdHlwZS1zeW1ib2xcIiwgcmVmOiAobm9kZSkgPT4gdGhpcy5jcmVhdGVTeW1ib2wobm9kZSkgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uU1ZHX0dlbygpIHtcbiAgICAgICAgcmV0dXJuIChoKFwic3ZnXCIsIHsgeG1sbnM6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgdmlld0JveDogXCIwIDAgODAgODBcIiB9LCBoKFwiZGVmc1wiLCBudWxsLCBoKFwic3R5bGVcIiwgbnVsbCwgXCIuY2xzLTEsLmNscy00XCIsIGB7ZmlsbDpub25lO31gLCBcIi5jbHMtMlwiLCBge2ZpbGw6I2YzZjNmMzt9YCwgXCIuY2xzLTNcIiwgYHtmaWxsOiNjY2M7fWAsIFwiLmNscy00XCIsIGB7c3Ryb2tlOiMzNTM1MzU7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fWAsIFwiLmNscy01XCIsIGB7ZmlsbDojMzUzNTM1O31gLCBcIi5jbHMtNlwiLCBge2ZpbGw6IzU5NTk1OTt9YCkpLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0xXCIsIHdpZHRoOiBcIjgwXCIsIGhlaWdodDogXCI4MFwiIH0pLCBoKFwiY2lyY2xlXCIsIHsgY2xhc3M6IFwiY2xzLTJcIiwgY3g6IFwiMzAuNVwiLCBjeTogXCI0Ni41XCIsIHI6IFwiMzAuNVwiIH0pLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0zXCIsIHg6IFwiMzBcIiwgeTogXCIxNlwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIgfSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTNcIiwgeDogXCIzMFwiLCB5OiBcIjcxXCIsIHdpZHRoOiBcIjFcIiwgaGVpZ2h0OiBcIjZcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjU3LjVcIiwgeTogXCI0My41XCIsIHdpZHRoOiBcIjFcIiwgaGVpZ2h0OiBcIjZcIiwgdHJhbnNmb3JtOiBcInRyYW5zbGF0ZSgxMS41IDEwNC41KSByb3RhdGUoLTkwKVwiIH0pLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0zXCIsIHg6IFwiMi41XCIsIHk6IFwiNDMuNVwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIsIHRyYW5zZm9ybTogXCJ0cmFuc2xhdGUoLTQzLjUgNDkuNSkgcm90YXRlKC05MClcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNFwiLCBkOiBcIk0zNS44LDE2LjQ2QTMwLjUxLDMwLjUxLDAsMCwxLDYwLjM5LDQwLjRcIiB9KSwgaChcInBvbHlnb25cIiwgeyBjbGFzczogXCJjbHMtNVwiLCBwb2ludHM6IFwiNTcuMDYgMzguNzcgNTcuNDYgMzguMiA2MC4zMSA0MC4xNSA2Mi4wNSAzNy4xNiA2Mi42NSAzNy41MSA2MC41MyA0MS4xNSA1Ny4wNiAzOC43N1wiIH0pLCBoKFwicGF0aFwiLCB7IGNsYXNzOiBcImNscy02XCIsIGQ6IFwiTTI5LjEyLDQuMjRhMS44NCwxLjg0LDAsMCwxLDEuMS4zMiwyLjM0LDIuMzQsMCwwLDEsLjcyLjg2LDQuMTYsNC4xNiwwLDAsMSwuMzgsMS4xOSw3Ljc3LDcuNzcsMCwwLDEsMCwyLjcyLDQuMjYsNC4yNiwwLDAsMS0uMzgsMS4xOSwyLjI3LDIuMjcsMCwwLDEtLjcyLjg0LDIuMDcsMi4wNywwLDAsMS0yLjIxLDAsMi4yNywyLjI3LDAsMCwxLS43Mi0uODQsNC4yNiw0LjI2LDAsMCwxLS4zOC0xLjE5LDkuMyw5LjMsMCwwLDEsMC0yLjcyLDQuMTYsNC4xNiwwLDAsMSwuMzgtMS4xOUEyLjM0LDIuMzQsMCwwLDEsMjgsNC41NiwxLjg1LDEuODUsMCwwLDEsMjkuMTIsNC4yNFptMCwuNjFhMS4xMSwxLjExLDAsMCwwLS43OC4yOSwyLDIsMCwwLDAtLjQ5Ljc0LDMuODYsMy44NiwwLDAsMC0uMjUsMUE4LjIzLDguMjMsMCwwLDAsMjcuNTIsOGE4LjA5LDguMDksMCwwLDAsLjA4LDEuMDgsMy41OSwzLjU5LDAsMCwwLC4yNSwxLDIsMiwwLDAsMCwuNDkuNzQsMS4xNSwxLjE1LDAsMCwwLC43OC4yOCwxLjEyLDEuMTIsMCwwLDAsLjc3LS4yOCwyLDIsMCwwLDAsLjQ5LS43NCw0LDQsMCwwLDAsLjI2LTFBOC4wOSw4LjA5LDAsMCwwLDMwLjcyLDhhOC4yMyw4LjIzLDAsMCwwLS4wOC0xLjA5LDQuMzEsNC4zMSwwLDAsMC0uMjYtMSwyLDIsMCwwLDAtLjQ5LS43NEExLjA4LDEuMDgsMCwwLDAsMjkuMTIsNC44NVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk0zNS41Miw1Ljc5YTEuNDUsMS40NSwwLDAsMS0uMTIuNTksMS4yMSwxLjIxLDAsMCwxLS4zMS40OCwxLjM4LDEuMzgsMCwwLDEtLjQ3LjMxLDEuNjYsMS42NiwwLDAsMS0xLjE5LDBBMS4zOCwxLjM4LDAsMCwxLDMzLDYuODZhMS4yMSwxLjIxLDAsMCwxLS4zMS0uNDgsMS41MSwxLjUxLDAsMCwxLDAtMS4xOEExLjIxLDEuMjEsMCwwLDEsMzMsNC43MmExLjM4LDEuMzgsMCwwLDEsLjQ3LS4zMSwxLjY2LDEuNjYsMCwwLDEsMS4xOSwwLDEuMzgsMS4zOCwwLDAsMSwuNDcuMzEsMS4yMSwxLjIxLDAsMCwxLC4zMS40OEExLjQ1LDEuNDUsMCwwLDEsMzUuNTIsNS43OVptLS40OSwwYTEuMDksMS4wOSwwLDAsMC0uMDctLjQsMS4xNiwxLjE2LDAsMCwwLS4yMi0uMzEuODcuODcsMCwwLDAtLjMyLS4yMiwxLDEsMCwwLDAtLjQtLjA4LDEsMSwwLDAsMC0uMzkuMDguODcuODcsMCwwLDAtLjMyLjIyLDEuMTYsMS4xNiwwLDAsMC0uMjIuMzEsMS4xOCwxLjE4LDAsMCwwLDAsLjgsMSwxLDAsMCwwLC4yMi4zMS44Ny44NywwLDAsMCwuMzIuMjJBMSwxLDAsMCwwLDM0LDYuOGExLDEsMCwwLDAsLjQtLjA4Ljg3Ljg3LDAsMCwwLC4zMi0uMjJBMSwxLDAsMCwwLDM1LDYuMTksMS4wOSwxLjA5LDAsMCwwLDM1LDUuNzlaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNNjYuOTQsNDYuNDFsMCwwYTEuMzMsMS4zMywwLDAsMS0uNDYuMTksMi4yLDIuMiwwLDAsMS0uNTYuMDcsMi4xOCwyLjE4LDAsMCwxLS44NS0uMTYsMi4xMiwyLjEyLDAsMCwxLS42OC0uNDUsMS45LDEuOSwwLDAsMS0uNDYtLjY4LDIuMzgsMi4zOCwwLDAsMS0uMTYtLjg5LDIuMjcsMi4yNywwLDAsMSwuMTctLjkxLDEuOSwxLjksMCwwLDEsLjQ4LS43LDIuNDUsMi40NSwwLDAsMSwuNzMtLjQ2LDIuNywyLjcsMCwwLDEsMS44MywwLDIuMzMsMi4zMywwLDAsMSwuNzMuNDYsMS45LDEuOSwwLDAsMSwuNDguNywyLjI3LDIuMjcsMCwwLDEsLjE4LjkxLDIuNjEsMi42MSwwLDAsMS0uMiwxLDYuMjQsNi4yNCwwLDAsMS0uNDQuOUw2NS43Nyw0OS41aC0uODNabS42OS0xLjk0YTEuNjksMS42OSwwLDAsMC0uMTItLjY0LDEuNjIsMS42MiwwLDAsMC0uMzItLjUyLDEuOTIsMS45MiwwLDAsMC0uNS0uMzQsMS43OSwxLjc5LDAsMCwwLTEuMjksMCwxLjc3LDEuNzcsMCwwLDAtLjUuMzQsMS44MiwxLjgyLDAsMCwwLS4zMi41MiwxLjc3LDEuNzcsMCwwLDAsMCwxLjI4LDEuNDksMS40OSwwLDAsMCwuMzEuNTEsMS40NSwxLjQ1LDAsMCwwLC41LjMzLDEuNzUsMS43NSwwLDAsMCwuNjUuMTJBMS43MywxLjczLDAsMCwwLDY2LjcsNDZhMS40NSwxLjQ1LDAsMCwwLC41LS4zMywxLjY5LDEuNjksMCwwLDAsLjMyLS41MUExLjkxLDEuOTEsMCwwLDAsNjcuNjMsNDQuNDdaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNNzEuODIsNDIuMjRhMS44NCwxLjg0LDAsMCwxLDEuMS4zMiwyLjM0LDIuMzQsMCwwLDEsLjcyLjg2QTQuMTYsNC4xNiwwLDAsMSw3NCw0NC42MWE4LjQ2LDguNDYsMCwwLDEsMCwyLjcyLDQuMjYsNC4yNiwwLDAsMS0uMzgsMS4xOSwyLjI3LDIuMjcsMCwwLDEtLjcyLjg0LDIuMDcsMi4wNywwLDAsMS0yLjIxLDAsMi4yNywyLjI3LDAsMCwxLS43Mi0uODQsNC4yNiw0LjI2LDAsMCwxLS4zOC0xLjE5LDguNDYsOC40NiwwLDAsMSwwLTIuNzJBNC4xNiw0LjE2LDAsMCwxLDcwLDQzLjQyYTIuMzQsMi4zNCwwLDAsMSwuNzItLjg2QTEuODUsMS44NSwwLDAsMSw3MS44Miw0Mi4yNFptMCwuNjFhMS4xMSwxLjExLDAsMCwwLS43OC4yOSwyLDIsMCwwLDAtLjQ5Ljc0LDQuMzEsNC4zMSwwLDAsMC0uMjYsMUExMC4zLDEwLjMsMCwwLDAsNzAuMjIsNDZhMTAuMTEsMTAuMTEsMCwwLDAsLjA3LDEuMDgsNCw0LDAsMCwwLC4yNiwxLDIsMiwwLDAsMCwuNDkuNzQsMS4yMSwxLjIxLDAsMCwwLDEuNTUsMCwyLDIsMCwwLDAsLjQ5LS43NCw0LDQsMCwwLDAsLjI2LTFBOC4wOSw4LjA5LDAsMCwwLDczLjQyLDQ2YTguMjMsOC4yMywwLDAsMC0uMDgtMS4wOSw0LjMxLDQuMzEsMCwwLDAtLjI2LTEsMiwyLDAsMCwwLS40OS0uNzRBMS4xLDEuMSwwLDAsMCw3MS44Miw0Mi44NVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk03OC4yMSw0My43OWExLjQ0LDEuNDQsMCwwLDEtLjExLjU5LDEuMjEsMS4yMSwwLDAsMS0uMzEuNDgsMS4zOCwxLjM4LDAsMCwxLS40Ny4zMSwxLjY2LDEuNjYsMCwwLDEtMS4xOSwwLDEuNTIsMS41MiwwLDAsMS0uNDgtLjMxLDEuNDcsMS40NywwLDAsMS0uMzEtLjQ4LDEuNjQsMS42NCwwLDAsMSwwLTEuMTgsMS40NywxLjQ3LDAsMCwxLC4zMS0uNDgsMS41MiwxLjUyLDAsMCwxLC40OC0uMzEsMS42NiwxLjY2LDAsMCwxLDEuMTksMCwxLjM4LDEuMzgsMCwwLDEsLjQ3LjMxLDEuMjEsMS4yMSwwLDAsMSwuMzEuNDhBMS40NCwxLjQ0LDAsMCwxLDc4LjIxLDQzLjc5Wm0tLjQ4LDBhLjkyLjkyLDAsMCwwLS4wOC0uNCwxLDEsMCwwLDAtLjIxLS4zMS44Ny44NywwLDAsMC0uMzItLjIyLDEuMDYsMS4wNiwwLDAsMC0uNC0uMDgsMSwxLDAsMCwwLS4zOS4wOC44Ny44NywwLDAsMC0uMzIuMjIsMS4xNiwxLjE2LDAsMCwwLS4yMi4zMSwxLDEsMCwwLDAsMCwuOCwxLDEsMCwwLDAsLjIyLjMxLjg3Ljg3LDAsMCwwLC4zMi4yMiwxLDEsMCwwLDAsLjM5LjA4LDEuMDYsMS4wNiwwLDAsMCwuNC0uMDguODcuODcsMCwwLDAsLjMyLS4yMi44NS44NSwwLDAsMCwuMjEtLjMxQS45Mi45MiwwLDAsMCw3Ny43Myw0My43OVpcIiB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJSb3RhdGlvblNWR19BcmkoKSB7XG4gICAgICAgIHJldHVybiAoaChcInN2Z1wiLCB7IHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIHZpZXdCb3g6IFwiMCAwIDgwIDgwXCIgfSwgaChcImRlZnNcIiwgbnVsbCwgaChcInN0eWxlXCIsIG51bGwsIFwiLmNscy0xLC5jbHMtNFwiLCBge2ZpbGw6bm9uZTt9YCwgXCIuY2xzLTJcIiwgYHtmaWxsOiNmM2YzZjM7fWAsIFwiLmNscy0zXCIsIGB7ZmlsbDojY2NjO31gLCBcIi5jbHMtNFwiLCBge3N0cm9rZTojMzUzNTM1O3N0cm9rZS1taXRlcmxpbWl0OjEwO31gLCBcIi5jbHMtNVwiLCBge2ZpbGw6IzM1MzUzNTt9YCwgXCIuY2xzLTZcIiwgYHtmaWxsOiM1OTU5NTk7fWApKSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtMVwiLCB3aWR0aDogXCI4MFwiLCBoZWlnaHQ6IFwiODBcIiB9KSwgaChcImNpcmNsZVwiLCB7IGNsYXNzOiBcImNscy0yXCIsIGN4OiBcIjMwLjVcIiwgY3k6IFwiNDYuNVwiLCByOiBcIjMwLjVcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjMwXCIsIHk6IFwiMTZcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiIH0pLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0zXCIsIHg6IFwiMzBcIiwgeTogXCI3MVwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIgfSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTNcIiwgeDogXCI1Ny41XCIsIHk6IFwiNDMuNVwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIsIHRyYW5zZm9ybTogXCJ0cmFuc2xhdGUoMTEuNSAxMDQuNSkgcm90YXRlKC05MClcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjIuNVwiLCB5OiBcIjQzLjVcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiLCB0cmFuc2Zvcm06IFwidHJhbnNsYXRlKC00My41IDQ5LjUpIHJvdGF0ZSgtOTApXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTRcIiwgZDogXCJNMzYuNTQsMTYuNmEzMC41NSwzMC41NSwwLDAsMSwyNCwyNC41NVwiIH0pLCBoKFwicG9seWdvblwiLCB7IGNsYXNzOiBcImNscy01XCIsIHBvaW50czogXCIzOC4xOSAxOS45MiAzOC43NiAxOS41MiAzNi44IDE2LjY5IDM5Ljc3IDE0Ljk0IDM5LjQyIDE0LjMzIDM1LjggMTYuNDYgMzguMTkgMTkuOTJcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk0yNy4xNCw4LjQxbDAsMGExLjM1LDEuMzUsMCwwLDEtLjQ1LjE5LDIuMjgsMi4yOCwwLDAsMS0uNTcuMDcsMi4xOCwyLjE4LDAsMCwxLS44NS0uMTZBMi4xMiwyLjEyLDAsMCwxLDI0LjU3LDhhMS45NCwxLjk0LDAsMCwxLS40Ni0uNjlBMi4zLDIuMywwLDAsMSwyNCw2LjQ3YTIuMjcsMi4yNywwLDAsMSwuMTctLjkxLDEuOSwxLjksMCwwLDEsLjQ4LS43LDIuMzIsMi4zMiwwLDAsMSwxLjY1LS42MiwyLjUxLDIuNTEsMCwwLDEsLjkyLjE2LDIuNTksMi41OSwwLDAsMSwuNzMuNDYsMi4xOCwyLjE4LDAsMCwxLC40OC43LDIuNDYsMi40NiwwLDAsMSwuMTcuOTEsMi42MSwyLjYxLDAsMCwxLS4yLDEsNi4yNCw2LjI0LDAsMCwxLS40NC45TDI2LDExLjVoLS44M1ptLjY5LTEuOTRhMS42OSwxLjY5LDAsMCwwLS4xMi0uNjQsMS42MiwxLjYyLDAsMCwwLS4zMi0uNTIsMS41NiwxLjU2LDAsMCwwLS41LS4zM0ExLjY3LDEuNjcsMCwwLDAsMjUuNiw1YTEuNjcsMS42NywwLDAsMC0uNS4zMywxLjgyLDEuODIsMCwwLDAtLjMyLjUyLDEuNjksMS42OSwwLDAsMC0uMTEuNjQsMS42MSwxLjYxLDAsMCwwLC4xMS42MywxLjM1LDEuMzUsMCwwLDAsLjgxLjg1LDEuNzYsMS43NiwwLDAsMCwuNjYuMTJBMS43MSwxLjcxLDAsMCwwLDI2LjksOGExLjQ1LDEuNDUsMCwwLDAsLjUtLjMzLDEuNjIsMS42MiwwLDAsMCwuMzItLjUyQTEuODEsMS44MSwwLDAsMCwyNy44Myw2LjQ3WlwiIH0pLCBoKFwicGF0aFwiLCB7IGNsYXNzOiBcImNscy02XCIsIGQ6IFwiTTMyLDQuMjRhMS44NCwxLjg0LDAsMCwxLDEuMS4zMiwyLjM0LDIuMzQsMCwwLDEsLjcyLjg2LDQuMTYsNC4xNiwwLDAsMSwuMzgsMS4xOUE3LjcyLDcuNzIsMCwwLDEsMzQuMzMsOGE3LjcyLDcuNzIsMCwwLDEtLjExLDEuMzYsNC4yNiw0LjI2LDAsMCwxLS4zOCwxLjE5LDIuMjcsMi4yNywwLDAsMS0uNzIuODQsMi4wNywyLjA3LDAsMCwxLTIuMjEsMCwyLjI3LDIuMjcsMCwwLDEtLjcyLS44NCw0LjI2LDQuMjYsMCwwLDEtLjM4LTEuMTksOS4zLDkuMywwLDAsMSwwLTIuNzIsNC4xNiw0LjE2LDAsMCwxLC4zOC0xLjE5LDIuMzQsMi4zNCwwLDAsMSwuNzItLjg2QTEuODUsMS44NSwwLDAsMSwzMiw0LjI0Wm0wLC42MWExLjExLDEuMTEsMCwwLDAtLjc4LjI5LDIsMiwwLDAsMC0uNDkuNzQsMy44NiwzLjg2LDAsMCwwLS4yNSwxQTguMjMsOC4yMywwLDAsMCwzMC40Miw4YTguMDksOC4wOSwwLDAsMCwuMDgsMS4wOCwzLjU5LDMuNTksMCwwLDAsLjI1LDEsMS45MiwxLjkyLDAsMCwwLC40OS43MywxLjE4LDEuMTgsMCwwLDAsMS41NSwwLDEuOTIsMS45MiwwLDAsMCwuNDktLjczLDQsNCwwLDAsMCwuMjYtMUE4LjA5LDguMDksMCwwLDAsMzMuNjIsOGE4LjIzLDguMjMsMCwwLDAtLjA4LTEuMDksNC4zMSw0LjMxLDAsMCwwLS4yNi0xLDIsMiwwLDAsMC0uNDktLjc0QTEuMSwxLjEsMCwwLDAsMzIsNC44NVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk0zOC40Miw1Ljc5YTEuNDUsMS40NSwwLDAsMS0uMTIuNTksMS4yMSwxLjIxLDAsMCwxLS4zMS40OCwxLjM4LDEuMzgsMCwwLDEtLjQ3LjMxLDEuNjYsMS42NiwwLDAsMS0xLjE5LDAsMS41MiwxLjUyLDAsMCwxLS40OC0uMzEsMS40NywxLjQ3LDAsMCwxLS4zMS0uNDgsMS42MywxLjYzLDAsMCwxLS4xMS0uNTksMS43MywxLjczLDAsMCwxLC4xMS0uNiwxLjM4LDEuMzgsMCwwLDEsLjc5LS43OCwxLjY2LDEuNjYsMCwwLDEsMS4xOSwwLDEuMzgsMS4zOCwwLDAsMSwuNDcuMzEsMS4yNSwxLjI1LDAsMCwxLC4zMS40N0ExLjUzLDEuNTMsMCwwLDEsMzguNDIsNS43OVptLS40OSwwYS44NS44NSwwLDAsMC0uMDgtLjM5Ljg5Ljg5LDAsMCwwLS4yMS0uMzIuODcuODcsMCwwLDAtLjMyLS4yMiwxLjA2LDEuMDYsMCwwLDAtLjQtLjA4LDEsMSwwLDAsMC0uMzkuMDguODcuODcsMCwwLDAtLjMyLjIyQTEuMDcsMS4wNywwLDAsMCwzNiw1LjRhMSwxLDAsMCwwLS4wNy4zOSwxLjA5LDEuMDksMCwwLDAsLjA3LjQsMSwxLDAsMCwwLC4yMi4zMS44Ny44NywwLDAsMCwuMzIuMjIsMSwxLDAsMCwwLC4zOS4wOCwxLjA2LDEuMDYsMCwwLDAsLjQtLjA4Ljg3Ljg3LDAsMCwwLC4zMi0uMjIuODUuODUsMCwwLDAsLjIxLS4zMUEuOTIuOTIsMCwwLDAsMzcuOTMsNS43OVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk02Nyw0Mi4yNGExLjg0LDEuODQsMCwwLDEsMS4xLjMyLDIuMzQsMi4zNCwwLDAsMSwuNzIuODYsNC4xNiw0LjE2LDAsMCwxLC4zOCwxLjE5LDguNDYsOC40NiwwLDAsMSwwLDIuNzIsNC4yNiw0LjI2LDAsMCwxLS4zOCwxLjE5LDIuMjcsMi4yNywwLDAsMS0uNzIuODQsMi4wNywyLjA3LDAsMCwxLTIuMjEsMCwyLjI3LDIuMjcsMCwwLDEtLjcyLS44NCw0LjI2LDQuMjYsMCwwLDEtLjM4LTEuMTksOS4zLDkuMywwLDAsMSwwLTIuNzIsNC4xNiw0LjE2LDAsMCwxLC4zOC0xLjE5LDIuMzQsMi4zNCwwLDAsMSwuNzItLjg2QTEuODUsMS44NSwwLDAsMSw2Nyw0Mi4yNFptMCwuNjFhMS4xMSwxLjExLDAsMCwwLS43OC4yOSwyLDIsMCwwLDAtLjQ5Ljc0LDMuODYsMy44NiwwLDAsMC0uMjUsMUE4LjIzLDguMjMsMCwwLDAsNjUuNDIsNDZhOC4wOSw4LjA5LDAsMCwwLC4wOCwxLjA4LDMuNTksMy41OSwwLDAsMCwuMjUsMSwyLDIsMCwwLDAsLjQ5Ljc0LDEuMjEsMS4yMSwwLDAsMCwxLjU1LDAsMiwyLDAsMCwwLC40OS0uNzQsNCw0LDAsMCwwLC4yNi0xQTguMDksOC4wOSwwLDAsMCw2OC42Miw0NmE4LjIzLDguMjMsMCwwLDAtLjA4LTEuMDksNC4zMSw0LjMxLDAsMCwwLS4yNi0xLDIsMiwwLDAsMC0uNDktLjc0QTEuMSwxLjEsMCwwLDAsNjcsNDIuODVaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNNzMuNDIsNDMuNzlhMS40NSwxLjQ1LDAsMCwxLS4xMi41OSwxLjIxLDEuMjEsMCwwLDEtLjMxLjQ4LDEuMzgsMS4zOCwwLDAsMS0uNDcuMzEsMS42NiwxLjY2LDAsMCwxLTEuMTksMCwxLjUyLDEuNTIsMCwwLDEtLjQ4LS4zMSwxLjQ3LDEuNDcsMCwwLDEtLjMxLS40OCwxLjYzLDEuNjMsMCwwLDEtLjExLS41OSwxLjczLDEuNzMsMCwwLDEsLjExLS42LDEuMzgsMS4zOCwwLDAsMSwuNzktLjc4LDEuNjYsMS42NiwwLDAsMSwxLjE5LDAsMS4zOCwxLjM4LDAsMCwxLC40Ny4zMSwxLjI1LDEuMjUsMCwwLDEsLjMxLjQ3QTEuNTMsMS41MywwLDAsMSw3My40Miw0My43OVptLS40OSwwYS44NS44NSwwLDAsMC0uMDgtLjM5Ljg5Ljg5LDAsMCwwLS4yMS0uMzIuODcuODcsMCwwLDAtLjMyLS4yMiwxLjA2LDEuMDYsMCwwLDAtLjQtLjA4LDEsMSwwLDAsMC0uMzkuMDguODcuODcsMCwwLDAtLjMyLjIyLDEuMDcsMS4wNywwLDAsMC0uMjIuMzIsMSwxLDAsMCwwLS4wNy4zOSwxLjA5LDEuMDksMCwwLDAsLjA3LjQsMSwxLDAsMCwwLC4yMi4zMS44Ny44NywwLDAsMCwuMzIuMjIsMSwxLDAsMCwwLC4zOS4wOCwxLjA2LDEuMDYsMCwwLDAsLjQtLjA4Ljg3Ljg3LDAsMCwwLC4zMi0uMjIuODUuODUsMCwwLDAsLjIxLS4zMUEuOTIuOTIsMCwwLDAsNzIuOTMsNDMuNzlaXCIgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyUm90YXRpb25TVkdfR2VvX2xlYWRpbmcoKSB7XG4gICAgICAgIHJldHVybiAoaChcInN2Z1wiLCB7IHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIHZpZXdCb3g6IFwiMCAwIDgwIDgwXCIgfSwgaChcImRlZnNcIiwgbnVsbCwgaChcInN0eWxlXCIsIG51bGwsIFwiLmNscy0xLC5jbHMtNFwiLCBge2ZpbGw6bm9uZTt9YCwgXCIuY2xzLTJcIiwgYHtmaWxsOiNmM2YzZjM7fWAsIFwiLmNscy0zXCIsIGB7ZmlsbDojY2NjO31gLCBcIi5jbHMtNFwiLCBge3N0cm9rZTojMzUzNTM1O3N0cm9rZS1taXRlcmxpbWl0OjEwO31gLCBcIi5jbHMtNVwiLCBge2ZpbGw6IzM1MzUzNTt9YCwgXCIuY2xzLTZcIiwgYHtmaWxsOiM1OTU5NTk7fWApKSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtMVwiLCB3aWR0aDogXCI4MFwiLCBoZWlnaHQ6IFwiODBcIiB9KSwgaChcImNpcmNsZVwiLCB7IGNsYXNzOiBcImNscy0yXCIsIGN4OiBcIjMwLjVcIiwgY3k6IFwiNDYuNVwiLCByOiBcIjMwLjVcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjMwXCIsIHk6IFwiMTZcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiIH0pLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0zXCIsIHg6IFwiMzBcIiwgeTogXCI3MVwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIgfSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTNcIiwgeDogXCI1Ny41XCIsIHk6IFwiNDMuNVwiLCB3aWR0aDogXCIxXCIsIGhlaWdodDogXCI2XCIsIHRyYW5zZm9ybTogXCJ0cmFuc2xhdGUoMTEuNSAxMDQuNSkgcm90YXRlKC05MClcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjIuNVwiLCB5OiBcIjQzLjVcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiLCB0cmFuc2Zvcm06IFwidHJhbnNsYXRlKC00My41IDQ5LjUpIHJvdGF0ZSgtOTApXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTRcIiwgZDogXCJNMzUuOCwxNi40NkEzMC41MSwzMC41MSwwLDAsMSw2MC4zOSw0MC40XCIgfSksIGgoXCJwb2x5Z29uXCIsIHsgY2xhc3M6IFwiY2xzLTVcIiwgcG9pbnRzOiBcIjU3LjA2IDM4Ljc3IDU3LjQ2IDM4LjIgNjAuMzEgNDAuMTUgNjIuMDUgMzcuMTYgNjIuNjUgMzcuNTEgNjAuNTMgNDEuMTUgNTcuMDYgMzguNzdcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk0yOC43Miw1Ljc5YTEuNDUsMS40NSwwLDAsMS0uMTIuNTksMS4yMSwxLjIxLDAsMCwxLS4zMS40OCwxLjM4LDEuMzgsMCwwLDEtLjQ3LjMxLDEuNjYsMS42NiwwLDAsMS0xLjE5LDAsMS4zOCwxLjM4LDAsMCwxLS40Ny0uMzEsMS4yMSwxLjIxLDAsMCwxLS4zMS0uNDgsMS41MSwxLjUxLDAsMCwxLDAtMS4xOCwxLjIxLDEuMjEsMCwwLDEsLjMxLS40OCwxLjM4LDEuMzgsMCwwLDEsLjQ3LS4zMSwxLjY2LDEuNjYsMCwwLDEsMS4xOSwwLDEuMzgsMS4zOCwwLDAsMSwuNDcuMzEsMS4yMSwxLjIxLDAsMCwxLC4zMS40OEExLjQ1LDEuNDUsMCwwLDEsMjguNzIsNS43OVptLS40OSwwYTEuMDksMS4wOSwwLDAsMC0uMDctLjQsMS4xNiwxLjE2LDAsMCwwLS4yMi0uMzEuODcuODcsMCwwLDAtLjMyLS4yMiwxLDEsMCwwLDAtLjM5LS4wOCwxLDEsMCwwLDAtLjQuMDguODcuODcsMCwwLDAtLjMyLjIyLDEuMTYsMS4xNiwwLDAsMC0uMjIuMzEsMS4xOCwxLjE4LDAsMCwwLDAsLjgsMSwxLDAsMCwwLC4yMi4zMS44Ny44NywwLDAsMCwuMzIuMjIsMSwxLDAsMCwwLC40LjA4LDEsMSwwLDAsMCwuMzktLjA4Ljg3Ljg3LDAsMCwwLC4zMi0uMjIsMSwxLDAsMCwwLC4yMi0uMzFBMS4wOSwxLjA5LDAsMCwwLDI4LjIzLDUuNzlaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNMzIuMTIsNC4yNGExLjg0LDEuODQsMCwwLDEsMS4xLjMyLDIuMzQsMi4zNCwwLDAsMSwuNzIuODYsNC4xNiw0LjE2LDAsMCwxLC4zOCwxLjE5LDcuNzcsNy43NywwLDAsMSwwLDIuNzIsNC4yNiw0LjI2LDAsMCwxLS4zOCwxLjE5LDIuMjcsMi4yNywwLDAsMS0uNzIuODQsMi4wNywyLjA3LDAsMCwxLTIuMjEsMCwyLjI3LDIuMjcsMCwwLDEtLjcyLS44NCw0LjI2LDQuMjYsMCwwLDEtLjM4LTEuMTksOS4zLDkuMywwLDAsMSwwLTIuNzIsNC4xNiw0LjE2LDAsMCwxLC4zOC0xLjE5QTIuMzQsMi4zNCwwLDAsMSwzMSw0LjU2LDEuODUsMS44NSwwLDAsMSwzMi4xMiw0LjI0Wm0wLC42MWExLjExLDEuMTEsMCwwLDAtLjc4LjI5LDIsMiwwLDAsMC0uNDkuNzQsMy44NiwzLjg2LDAsMCwwLS4yNSwxQTguMjMsOC4yMywwLDAsMCwzMC41Miw4YTguMDksOC4wOSwwLDAsMCwuMDgsMS4wOCwzLjU5LDMuNTksMCwwLDAsLjI1LDEsMiwyLDAsMCwwLC40OS43NCwxLjE1LDEuMTUsMCwwLDAsLjc4LjI4LDEuMTIsMS4xMiwwLDAsMCwuNzctLjI4LDIsMiwwLDAsMCwuNDktLjc0LDQsNCwwLDAsMCwuMjYtMUE4LjA5LDguMDksMCwwLDAsMzMuNzIsOGE4LjIzLDguMjMsMCwwLDAtLjA4LTEuMDksNC4zMSw0LjMxLDAsMCwwLS4yNi0xLDIsMiwwLDAsMC0uNDktLjc0QTEuMDgsMS4wOCwwLDAsMCwzMi4xMiw0Ljg1WlwiIH0pLCBoKFwicGF0aFwiLCB7IGNsYXNzOiBcImNscy02XCIsIGQ6IFwiTTY2LjYyLDQzLjc5YTEuNDUsMS40NSwwLDAsMS0uMTIuNTksMS4yMSwxLjIxLDAsMCwxLS4zMS40OCwxLjM4LDEuMzgsMCwwLDEtLjQ3LjMxLDEuNjYsMS42NiwwLDAsMS0xLjE5LDAsMS4zOCwxLjM4LDAsMCwxLS40Ny0uMzEsMS4yMSwxLjIxLDAsMCwxLS4zMS0uNDgsMS41MSwxLjUxLDAsMCwxLDAtMS4xOCwxLjIxLDEuMjEsMCwwLDEsLjMxLS40OCwxLjM4LDEuMzgsMCwwLDEsLjQ3LS4zMSwxLjY2LDEuNjYsMCwwLDEsMS4xOSwwLDEuMzgsMS4zOCwwLDAsMSwuNDcuMzEsMS4yMSwxLjIxLDAsMCwxLC4zMS40OEExLjQ1LDEuNDUsMCwwLDEsNjYuNjIsNDMuNzlabS0uNDksMGExLjA5LDEuMDksMCwwLDAtLjA3LS40LDEuMTYsMS4xNiwwLDAsMC0uMjItLjMxLjg3Ljg3LDAsMCwwLS4zMi0uMjIsMSwxLDAsMCwwLS4zOS0uMDgsMSwxLDAsMCwwLS40LjA4Ljg3Ljg3LDAsMCwwLS4zMi4yMiwxLjE2LDEuMTYsMCwwLDAtLjIyLjMxLDEuMTgsMS4xOCwwLDAsMCwwLC44LDEsMSwwLDAsMCwuMjIuMzEuODcuODcsMCwwLDAsLjMyLjIyLDEsMSwwLDAsMCwuNC4wOCwxLDEsMCwwLDAsLjM5LS4wOC44Ny44NywwLDAsMCwuMzItLjIyLDEsMSwwLDAsMCwuMjItLjMxQTEuMDksMS4wOSwwLDAsMCw2Ni4xMyw0My43OVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk03MC45NCw0Ni40MWwwLDBhMS4zMywxLjMzLDAsMCwxLS40Ni4xOSwyLjIsMi4yLDAsMCwxLS41Ni4wNywyLjE4LDIuMTgsMCwwLDEtLjg1LS4xNiwyLjEyLDIuMTIsMCwwLDEtLjY4LS40NSwxLjksMS45LDAsMCwxLS40Ni0uNjgsMi4zOCwyLjM4LDAsMCwxLS4xNi0uODksMi4yNywyLjI3LDAsMCwxLC4xNy0uOTEsMS45LDEuOSwwLDAsMSwuNDgtLjcsMi40NSwyLjQ1LDAsMCwxLC43My0uNDYsMi43LDIuNywwLDAsMSwxLjgzLDAsMi4zMywyLjMzLDAsMCwxLC43My40NiwxLjksMS45LDAsMCwxLC40OC43LDIuMjcsMi4yNywwLDAsMSwuMTguOTEsMi42MSwyLjYxLDAsMCwxLS4yLDEsNi4yNCw2LjI0LDAsMCwxLS40NC45TDY5Ljc3LDQ5LjVoLS44M1ptLjY5LTEuOTRhMS42OSwxLjY5LDAsMCwwLS4xMi0uNjQsMS42MiwxLjYyLDAsMCwwLS4zMi0uNTIsMS45MiwxLjkyLDAsMCwwLS41LS4zNCwxLjc5LDEuNzksMCwwLDAtMS4yOSwwLDEuNzcsMS43NywwLDAsMC0uNS4zNCwxLjgyLDEuODIsMCwwLDAtLjMyLjUyLDEuNzcsMS43NywwLDAsMCwwLDEuMjgsMS40OSwxLjQ5LDAsMCwwLC4zMS41MSwxLjQ1LDEuNDUsMCwwLDAsLjUuMzMsMS43NSwxLjc1LDAsMCwwLC42NS4xMkExLjczLDEuNzMsMCwwLDAsNzAuNyw0NmExLjQ1LDEuNDUsMCwwLDAsLjUtLjMzLDEuNjksMS42OSwwLDAsMCwuMzItLjUxQTEuOTEsMS45MSwwLDAsMCw3MS42Myw0NC40N1pcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk03NS44Miw0Mi4yNGExLjg0LDEuODQsMCwwLDEsMS4xLjMyLDIuMzQsMi4zNCwwLDAsMSwuNzIuODZBNC4xNiw0LjE2LDAsMCwxLDc4LDQ0LjYxYTguNDYsOC40NiwwLDAsMSwwLDIuNzIsNC4yNiw0LjI2LDAsMCwxLS4zOCwxLjE5LDIuMjcsMi4yNywwLDAsMS0uNzIuODQsMi4wNywyLjA3LDAsMCwxLTIuMjEsMCwyLjI3LDIuMjcsMCwwLDEtLjcyLS44NCw0LjI2LDQuMjYsMCwwLDEtLjM4LTEuMTksOC40Niw4LjQ2LDAsMCwxLDAtMi43MkE0LjE2LDQuMTYsMCwwLDEsNzQsNDMuNDJhMi4zNCwyLjM0LDAsMCwxLC43Mi0uODZBMS44NSwxLjg1LDAsMCwxLDc1LjgyLDQyLjI0Wm0wLC42MWExLjExLDEuMTEsMCwwLDAtLjc4LjI5LDIsMiwwLDAsMC0uNDkuNzQsNC4zMSw0LjMxLDAsMCwwLS4yNiwxQTEwLjMsMTAuMywwLDAsMCw3NC4yMiw0NmExMC4xMSwxMC4xMSwwLDAsMCwuMDcsMS4wOCw0LDQsMCwwLDAsLjI2LDEsMiwyLDAsMCwwLC40OS43NCwxLjIxLDEuMjEsMCwwLDAsMS41NSwwLDIsMiwwLDAsMCwuNDktLjc0LDQsNCwwLDAsMCwuMjYtMUE4LjA5LDguMDksMCwwLDAsNzcuNDIsNDZhOC4yMyw4LjIzLDAsMCwwLS4wOC0xLjA5LDQuMzEsNC4zMSwwLDAsMC0uMjYtMSwyLDIsMCwwLDAtLjQ5LS43NEExLjEsMS4xLDAsMCwwLDc1LjgyLDQyLjg1WlwiIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uU1ZHX0FyaV9sZWFkaW5nKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJzdmdcIiwgeyB4bWxuczogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCB2aWV3Qm94OiBcIjAgMCA4MCA4MFwiIH0sIGgoXCJkZWZzXCIsIG51bGwsIGgoXCJzdHlsZVwiLCBudWxsLCBcIi5jbHMtMSwuY2xzLTRcIiwgYHtmaWxsOm5vbmU7fWAsIFwiLmNscy0yXCIsIGB7ZmlsbDojZjNmM2YzO31gLCBcIi5jbHMtM1wiLCBge2ZpbGw6I2NjYzt9YCwgXCIuY2xzLTRcIiwgYHtzdHJva2U6IzM1MzUzNTtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9YCwgXCIuY2xzLTVcIiwgYHtmaWxsOiMzNTM1MzU7fWAsIFwiLmNscy02XCIsIGB7ZmlsbDojNTk1OTU5O31gKSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTFcIiwgd2lkdGg6IFwiODBcIiwgaGVpZ2h0OiBcIjgwXCIgfSksIGgoXCJjaXJjbGVcIiwgeyBjbGFzczogXCJjbHMtMlwiLCBjeDogXCIzMC41XCIsIGN5OiBcIjQ2LjVcIiwgcjogXCIzMC41XCIgfSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTNcIiwgeDogXCIzMFwiLCB5OiBcIjE2XCIsIHdpZHRoOiBcIjFcIiwgaGVpZ2h0OiBcIjZcIiB9KSwgaChcInJlY3RcIiwgeyBjbGFzczogXCJjbHMtM1wiLCB4OiBcIjMwXCIsIHk6IFwiNzFcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiIH0pLCBoKFwicmVjdFwiLCB7IGNsYXNzOiBcImNscy0zXCIsIHg6IFwiNTcuNVwiLCB5OiBcIjQzLjVcIiwgd2lkdGg6IFwiMVwiLCBoZWlnaHQ6IFwiNlwiLCB0cmFuc2Zvcm06IFwidHJhbnNsYXRlKDExLjUgMTA0LjUpIHJvdGF0ZSgtOTApXCIgfSksIGgoXCJyZWN0XCIsIHsgY2xhc3M6IFwiY2xzLTNcIiwgeDogXCIyLjVcIiwgeTogXCI0My41XCIsIHdpZHRoOiBcIjFcIiwgaGVpZ2h0OiBcIjZcIiwgdHJhbnNmb3JtOiBcInRyYW5zbGF0ZSgtNDMuNSA0OS41KSByb3RhdGUoLTkwKVwiIH0pLCBoKFwicGF0aFwiLCB7IGNsYXNzOiBcImNscy00XCIsIGQ6IFwiTTM2LjU0LDE2LjZhMzAuNTUsMzAuNTUsMCwwLDEsMjQsMjQuNTVcIiB9KSwgaChcInBvbHlnb25cIiwgeyBjbGFzczogXCJjbHMtNVwiLCBwb2ludHM6IFwiMzguMTkgMTkuOTIgMzguNzYgMTkuNTIgMzYuOCAxNi42OSAzOS43NyAxNC45NCAzOS40MiAxNC4zMyAzNS44IDE2LjQ2IDM4LjE5IDE5LjkyXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNMjQuODIsNS43OWExLjYzLDEuNjMsMCwwLDEtLjExLjU5LDEuNDcsMS40NywwLDAsMS0uMzEuNDgsMS41MiwxLjUyLDAsMCwxLS40OC4zMSwxLjY2LDEuNjYsMCwwLDEtMS4xOSwwLDEuMzgsMS4zOCwwLDAsMS0uNDctLjMxQTEuMjEsMS4yMSwwLDAsMSwyMiw2LjM4YTEuNDUsMS40NSwwLDAsMS0uMTItLjU5LDEuNTMsMS41MywwLDAsMSwuMTItLjYsMS4yNSwxLjI1LDAsMCwxLC4zMS0uNDcsMS4zOCwxLjM4LDAsMCwxLC40Ny0uMzEsMS42NiwxLjY2LDAsMCwxLDEuMTksMCwxLjM4LDEuMzgsMCwwLDEsLjc5Ljc4QTEuNzMsMS43MywwLDAsMSwyNC44Miw1Ljc5Wm0tLjQ5LDBhMSwxLDAsMCwwLS4wNy0uMzlBMS4wNywxLjA3LDAsMCwwLDI0LDUuMDhhLjg3Ljg3LDAsMCwwLS4zMi0uMjIsMSwxLDAsMCwwLS4zOS0uMDgsMS4wNiwxLjA2LDAsMCwwLS40LjA4Ljg3Ljg3LDAsMCwwLS4zMi4yMi44OS44OSwwLDAsMC0uMjEuMzIuODUuODUsMCwwLDAtLjA4LjM5LjkyLjkyLDAsMCwwLC4wOC40Ljg1Ljg1LDAsMCwwLC4yMS4zMS44Ny44NywwLDAsMCwuMzIuMjIsMS4wNiwxLjA2LDAsMCwwLC40LjA4LDEsMSwwLDAsMCwuMzktLjA4QS44Ny44NywwLDAsMCwyNCw2LjVhMSwxLDAsMCwwLC4yMi0uMzFBMS4wOSwxLjA5LDAsMCwwLDI0LjMzLDUuNzlaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNMjkuMTQsOC40MWwwLDBhMS4zNSwxLjM1LDAsMCwxLS40NS4xOSwyLjI4LDIuMjgsMCwwLDEtLjU3LjA3LDIuMTgsMi4xOCwwLDAsMS0uODUtLjE2QTIuMTIsMi4xMiwwLDAsMSwyNi41Nyw4YTEuOTQsMS45NCwwLDAsMS0uNDYtLjY5QTIuMywyLjMsMCwwLDEsMjYsNi40N2EyLjI3LDIuMjcsMCwwLDEsLjE3LS45MSwxLjksMS45LDAsMCwxLC40OC0uNywyLjMyLDIuMzIsMCwwLDEsMS42NS0uNjIsMi41MSwyLjUxLDAsMCwxLC45Mi4xNiwyLjU5LDIuNTksMCwwLDEsLjczLjQ2LDIuMTgsMi4xOCwwLDAsMSwuNDguNywyLjQ2LDIuNDYsMCwwLDEsLjE3LjkxLDIuNjEsMi42MSwwLDAsMS0uMiwxLDYuMjQsNi4yNCwwLDAsMS0uNDQuOUwyOCwxMS41aC0uODNabS42OS0xLjk0YTEuNjksMS42OSwwLDAsMC0uMTItLjY0LDEuNjIsMS42MiwwLDAsMC0uMzItLjUyLDEuNTYsMS41NiwwLDAsMC0uNS0uMzNBMS42NywxLjY3LDAsMCwwLDI3LjYsNWExLjY3LDEuNjcsMCwwLDAtLjUuMzMsMS44MiwxLjgyLDAsMCwwLS4zMi41MiwxLjY5LDEuNjksMCwwLDAtLjExLjY0LDEuNjEsMS42MSwwLDAsMCwuMTEuNjMsMS4zNSwxLjM1LDAsMCwwLC44MS44NSwxLjc2LDEuNzYsMCwwLDAsLjY2LjEyQTEuNzEsMS43MSwwLDAsMCwyOC45LDhhMS40NSwxLjQ1LDAsMCwwLC41LS4zMywxLjYyLDEuNjIsMCwwLDAsLjMyLS41MkExLjgxLDEuODEsMCwwLDAsMjkuODMsNi40N1pcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk0zNCw0LjI0YTEuODQsMS44NCwwLDAsMSwxLjEuMzIsMi4zNCwyLjM0LDAsMCwxLC43Mi44Niw0LjE2LDQuMTYsMCwwLDEsLjM4LDEuMTlBNy43Miw3LjcyLDAsMCwxLDM2LjMzLDhhNy43Miw3LjcyLDAsMCwxLS4xMSwxLjM2LDQuMjYsNC4yNiwwLDAsMS0uMzgsMS4xOSwyLjI3LDIuMjcsMCwwLDEtLjcyLjg0LDIuMDcsMi4wNywwLDAsMS0yLjIxLDAsMi4yNywyLjI3LDAsMCwxLS43Mi0uODQsNC4yNiw0LjI2LDAsMCwxLS4zOC0xLjE5LDkuMyw5LjMsMCwwLDEsMC0yLjcyLDQuMTYsNC4xNiwwLDAsMSwuMzgtMS4xOSwyLjM0LDIuMzQsMCwwLDEsLjcyLS44NkExLjg1LDEuODUsMCwwLDEsMzQsNC4yNFptMCwuNjFhMS4xMSwxLjExLDAsMCwwLS43OC4yOSwyLDIsMCwwLDAtLjQ5Ljc0LDMuODYsMy44NiwwLDAsMC0uMjUsMUE4LjIzLDguMjMsMCwwLDAsMzIuNDIsOGE4LjA5LDguMDksMCwwLDAsLjA4LDEuMDgsMy41OSwzLjU5LDAsMCwwLC4yNSwxLDEuOTIsMS45MiwwLDAsMCwuNDkuNzMsMS4xOCwxLjE4LDAsMCwwLDEuNTUsMCwxLjkyLDEuOTIsMCwwLDAsLjQ5LS43Myw0LDQsMCwwLDAsLjI2LTFBOC4wOSw4LjA5LDAsMCwwLDM1LjYyLDhhOC4yMyw4LjIzLDAsMCwwLS4wOC0xLjA5LDQuMzEsNC4zMSwwLDAsMC0uMjYtMSwyLDIsMCwwLDAtLjQ5LS43NEExLjEsMS4xLDAsMCwwLDM0LDQuODVaXCIgfSksIGgoXCJwYXRoXCIsIHsgY2xhc3M6IFwiY2xzLTZcIiwgZDogXCJNNjcuNjIsNDMuNzlhMS40NSwxLjQ1LDAsMCwxLS4xMi41OSwxLjIxLDEuMjEsMCwwLDEtLjMxLjQ4LDEuMzgsMS4zOCwwLDAsMS0uNDcuMzEsMS42NiwxLjY2LDAsMCwxLTEuMTksMCwxLjM4LDEuMzgsMCwwLDEtLjQ3LS4zMSwxLjIxLDEuMjEsMCwwLDEtLjMxLS40OCwxLjQ1LDEuNDUsMCwwLDEtLjEyLS41OSwxLjUzLDEuNTMsMCwwLDEsLjEyLS42LDEuMjUsMS4yNSwwLDAsMSwuMzEtLjQ3LDEuMzgsMS4zOCwwLDAsMSwuNDctLjMxLDEuNjYsMS42NiwwLDAsMSwxLjE5LDAsMS4zOCwxLjM4LDAsMCwxLC40Ny4zMSwxLjI1LDEuMjUsMCwwLDEsLjMxLjQ3QTEuNTMsMS41MywwLDAsMSw2Ny42Miw0My43OVptLS40OSwwYTEsMSwwLDAsMC0uMDctLjM5LDEuMDcsMS4wNywwLDAsMC0uMjItLjMyLjg3Ljg3LDAsMCwwLS4zMi0uMjIsMSwxLDAsMCwwLS4zOS0uMDgsMSwxLDAsMCwwLS40LjA4Ljg3Ljg3LDAsMCwwLS4zMi4yMiwxLjA3LDEuMDcsMCwwLDAtLjIyLjMyLDEsMSwwLDAsMC0uMDcuMzksMS4wOSwxLjA5LDAsMCwwLC4wNy40LDEsMSwwLDAsMCwuMjIuMzEuODcuODcsMCwwLDAsLjMyLjIyLDEsMSwwLDAsMCwuNC4wOCwxLDEsMCwwLDAsLjM5LS4wOC44Ny44NywwLDAsMCwuMzItLjIyLDEsMSwwLDAsMCwuMjItLjMxQTEuMDksMS4wOSwwLDAsMCw2Ny4xMyw0My43OVpcIiB9KSwgaChcInBhdGhcIiwgeyBjbGFzczogXCJjbHMtNlwiLCBkOiBcIk03MSw0Mi4yNGExLjg0LDEuODQsMCwwLDEsMS4xLjMyLDIuMzQsMi4zNCwwLDAsMSwuNzIuODYsNC4xNiw0LjE2LDAsMCwxLC4zOCwxLjE5LDguNDYsOC40NiwwLDAsMSwwLDIuNzIsNC4yNiw0LjI2LDAsMCwxLS4zOCwxLjE5LDIuMjcsMi4yNywwLDAsMS0uNzIuODQsMi4wNywyLjA3LDAsMCwxLTIuMjEsMCwyLjI3LDIuMjcsMCwwLDEtLjcyLS44NCw0LjI2LDQuMjYsMCwwLDEtLjM4LTEuMTksOS4zLDkuMywwLDAsMSwwLTIuNzIsNC4xNiw0LjE2LDAsMCwxLC4zOC0xLjE5LDIuMzQsMi4zNCwwLDAsMSwuNzItLjg2QTEuODUsMS44NSwwLDAsMSw3MSw0Mi4yNFptMCwuNjFhMS4xMSwxLjExLDAsMCwwLS43OC4yOSwyLDIsMCwwLDAtLjQ5Ljc0LDMuODYsMy44NiwwLDAsMC0uMjUsMUE4LjIzLDguMjMsMCwwLDAsNjkuNDIsNDZhOC4wOSw4LjA5LDAsMCwwLC4wOCwxLjA4LDMuNTksMy41OSwwLDAsMCwuMjUsMSwyLDIsMCwwLDAsLjQ5Ljc0LDEuMjEsMS4yMSwwLDAsMCwxLjU1LDAsMiwyLDAsMCwwLC40OS0uNzQsNCw0LDAsMCwwLC4yNi0xQTguMDksOC4wOSwwLDAsMCw3Mi42Miw0NmE4LjIzLDguMjMsMCwwLDAtLjA4LTEuMDksNC4zMSw0LjMxLDAsMCwwLS4yNi0xLDIsMiwwLDAsMC0uNDktLjc0QTEuMSwxLjEsMCwwLDAsNzEsNDIuODVaXCIgfSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY3JlYXRlU3ltYm9sKHN5bWJvbE5vZGUpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIGlmICghc3ltYm9sTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgbGV0IHN5bWJvbCA9IHJlbmRlcmVyLnN5bWJvbCB8fFxuICAgICAgICAgICAgKCgoX2EgPSByZW5kZXJlci5jbGFzc0JyZWFrSW5mb3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpICYmIHJlbmRlcmVyLmNsYXNzQnJlYWtJbmZvc1swXS5zeW1ib2wpIHx8XG4gICAgICAgICAgICAoKChfYiA9IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpICYmIHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3NbMF0uc3ltYm9sKSB8fFxuICAgICAgICAgICAgZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyk7XG4gICAgICAgIHN5bWJvbCA9IHN5bWJvbC5jbG9uZSgpO1xuICAgICAgICBhcHBseVN5bWJvbENvbG9yKHN5bWJvbCwgbmV3IG1vZHVsZXMuZXNyaUNvbG9yKHsgcjogMTcwLCBnOiAxNzAsIGI6IDE3MCwgYTogMSB9KSk7XG4gICAgICAgIC8vIHJlbW92ZSBvbGQgc3ltYm9sIGlmIHRoZXJlIGlzIG9uZVxuICAgICAgICB3aGlsZSAoKF9jID0gc3ltYm9sTm9kZS5jaGlsZE5vZGVzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubGVuZ3RoKSB7XG4gICAgICAgICAgICBzeW1ib2xOb2RlLnJlbW92ZUNoaWxkKHN5bWJvbE5vZGUuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN5bWJvbCkge1xuICAgICAgICAgICAgLy8gYWRkIG5ldyBzeW1ib2xcbiAgICAgICAgICAgIG1vZHVsZXMuc3ltYm9sVXRpbHNcbiAgICAgICAgICAgICAgICAucmVuZGVyUHJldmlld0hUTUwoc3ltYm9sLCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogMjBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKG5vZGUpID0+IHN5bWJvbE5vZGUuYXBwZW5kQ2hpbGQobm9kZSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVRvZ2dsZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgY29uc3Qgcm90YXRpb25WaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwicm90YXRpb25cIik7XG4gICAgICAgIGlmIChyb3RhdGlvblZpc1Zhcikge1xuICAgICAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3MgPSB7IHJvdGF0aW9uVmlzVmFyIH07XG4gICAgICAgICAgICByZW1vdmVWaXNWYXIoXCJyb3RhdGlvblwiLCBsYXllcik7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMubGFzdFNldHRpbmdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eucm90YXRpb25WaXNWYXIpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2godGhpcy5sYXN0U2V0dGluZ3Mucm90YXRpb25WaXNWYXIpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgc2Nyb2xsSW50b1ZpZXcodGhpcy5ibG9ja05vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gcGljayBmaXJzdCBmaWVsZCBieSBkZWZhdWx0IGlmIGFjdGl2ZVxuICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0TnVtRmllbGQgPSBnZXRGaXJzdE51bWJlckZpZWxkKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBmaXJzdE51bUZpZWxkID8gZmlyc3ROdW1GaWVsZC5sYXllckZpZWxkLm5hbWUgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJWaXNWYXIgPSBuZXcgbW9kdWxlcy5Sb3RhdGlvblZhcmlhYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQsXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uVHlwZTogXCJnZW9ncmFwaGljXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2goclZpc1Zhcik7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLmJsb2NrTm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgfVxuICAgIGhhbmRsZVR5cGVDaGFuZ2UodHlwZSkge1xuICAgICAgICBpZiAodHlwZSA9PT0gdGhpcy5yb3RhdGlvblR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJvdGF0aW9uVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcInJvdGF0aW9uXCIpO1xuICAgICAgICByb3RhdGlvblZpc1Zhci5yb3RhdGlvblR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLnJvdGF0aW9uVHlwZSA9IHJvdGF0aW9uVmlzVmFyLnJvdGF0aW9uVHlwZTtcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgc2V0Um90YXRpb25WaXN1YWxWYXJpYWJsZShmaWVsZEluZm8pIHtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgcm90YXRpb25WaXNWYXI7XG4gICAgICAgICAgICBpZiAoZmllbGRJbmZvLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgICByb3RhdGlvblZpc1ZhciA9IG5ldyBtb2R1bGVzLlJvdGF0aW9uVmFyaWFibGUoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZUV4cHJlc3Npb246IGZpZWxkSW5mby5leHByZXNzaW9uLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUV4cHJlc3Npb25UaXRsZTogZmllbGRJbmZvLmV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb25UeXBlOiB0aGlzLnJvdGF0aW9uVHlwZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmllbGRJbmZvLmZpZWxkKSB7XG4gICAgICAgICAgICAgICAgcm90YXRpb25WaXNWYXIgPSBuZXcgbW9kdWxlcy5Sb3RhdGlvblZhcmlhYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb25UeXBlOiB0aGlzLnJvdGF0aW9uVHlwZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yb3RhdGlvblR5cGUgPSB0aGlzLnJvdGF0aW9uVHlwZTtcbiAgICAgICAgICAgIHJlbW92ZVZpc1ZhcihcInJvdGF0aW9uXCIsIGxheWVyKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyB8fCBbXTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHJvdGF0aW9uVmlzVmFyKTtcbiAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLmJsb2NrTm9kZSk7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUm90YXRpb24uc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdSb3RhdGlvbkNzcztcblxudmFyIEltYWdlUGF0aHM7XG4oZnVuY3Rpb24gKEltYWdlUGF0aHMpIHtcbiAgICBJbWFnZVBhdGhzW1wiaGlnaFRvTG93XCJdID0gXCJIaWdoVG9Mb3cuc3ZnXCI7XG4gICAgSW1hZ2VQYXRoc1tcImFib3ZlQW5kQmVsb3dcIl0gPSBcIkFib3ZlQW5kQmVsb3cuc3ZnXCI7XG4gICAgSW1hZ2VQYXRoc1tcImFib3ZlXCJdID0gXCJBYm92ZS5zdmdcIjtcbiAgICBJbWFnZVBhdGhzW1wiYmVsb3dcIl0gPSBcIkJlbG93LnN2Z1wiO1xuICAgIEltYWdlUGF0aHNbXCJjZW50ZXJlZE9uXCJdID0gXCJDZW50ZXJlZE9uLnN2Z1wiO1xuICAgIEltYWdlUGF0aHNbXCJleHRyZW1lc1wiXSA9IFwiRXh0cmVtZXMuc3ZnXCI7XG59KShJbWFnZVBhdGhzIHx8IChJbWFnZVBhdGhzID0ge30pKTtcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b25Dc3MgPSBcIi50aGVtZS1idXR0b257ZGlzcGxheTpmbGV4O3BhZGRpbmc6NnB4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtib3JkZXItcmFkaXVzOjA7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7Ym9yZGVyLXdpZHRoOjFweDtib3JkZXItc3R5bGU6c29saWQ7Ym94LXNoYWRvdzp0cmFuc3BhcmVudCAwcHggMHB4IDBweCAxcHggaW5zZXR9LnRoZW1lLWJ1dHRvbjpob3Zlcntib3gtc2hhZG93Omluc2V0IDAgMCAwIDFweCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyl9LnRoZW1lLWJ1dHRvbjphY3RpdmV7Ym94LXNoYWRvdzppbnNldCAwIDAgMCAycHggdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS50aGVtZS1idXR0b246Zm9jdXN7Ym94LXNoYWRvdzppbnNldCAwIDAgMCAycHggdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpO291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweH0udGhlbWUtYnV0dG9uLmFjdGl2ZSwuY2FsY2l0ZS10aGVtZS1idXR0b24uYWN0aXZle291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktZm9jdXMtY29sb3IsIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpKX0udGhlbWUtY29udGVudHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3dpZHRoOjEwMCV9LnRoZW1lLXN1Yi1jb250ZW50e2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7d2lkdGg6MTAwJX0udGhlbWUtYnV0dG9uLWljb257bWluLXdpZHRoOjE2cHg7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2hlaWdodDo0OHB4O3BhZGRpbmc6MDtkaXNwbGF5OmlubGluZS1ibG9ja30udGhlbWUtYnV0dG9uLXRleHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzowIDEwcHh9LnRoZW1lLWJ1dHRvbi10aXRsZXtmb250LXdlaWdodDpib2xkfS50aGVtZS1idXR0b24tbXNne2ZvbnQtc2l6ZTo4MCU7bGluZS1oZWlnaHQ6MTZweH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQ2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTbWFydE1hcHBpbmdUaGVtZUJ1dHRvbkNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaGVtZUJ1dHRvbkJlZm9yZU9wZW4gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQmVmb3JlT3BlblwiLCA3KTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBQcm9wZXJ0aWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMudGhlbWVJbmZvcyA9IFtdO1xuICAgICAgICB0aGlzLnJlbmRlcmVyU3VidHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5idXR0b25WZXJzaW9uID0gXCJkZWZhdWx0XCI7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8qKlxuICAgICAqIFNldCBmb2N1cyBvbiBjb21wb25lbnRcbiAgICAgKi9cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uVmVyc2lvbiA9PT0gXCJtaW5pbWFsXCIpIHtcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uTm9kZS5zZXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5idXR0b25Ob2RlLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnBvcHVsYXRlVGhlbWVJbmZvKCk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVcGRhdGUoKSB7XG4gICAgICAgIGNvbnN0IHRoZW1lID0gZ2V0UmVuZGVyZXJUaGVtZSgpO1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRoZW1lSW5mby52YWx1ZSAhPT0gdGhlbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgdGhpcy5idXR0b25WZXJzaW9uID09PSBcIm1pbmltYWxcIiA/IHRoaXMucmVuZGVyTWluaW1hbEJ1dHRvbigpIDogdGhpcy5yZW5kZXJEZWZhdWx0QnV0dG9uKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyRGVmYXVsdEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBzdHJpbmdzLnRoZW1lQnV0dG9uLnRoZW1lLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGhlbWUtYnV0dG9uXCIsIHJvbGU6IFwiYnV0dG9uXCIsIHRhYmluZGV4OiBcIjBcIiwgXCJhcmlhLWhhc3BvcHVwXCI6IFwidHJ1ZVwiLCBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy50aGVtZUJ1dHRvbi5zZWxlY3RUaGVtZSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYnV0dG9uTm9kZSA9IG5vZGUpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5UaGVtZURyb3Bkb3duKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25DbGljazogKCkgPT4gdGhpcy5vcGVuVGhlbWVEcm9wZG93bigpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aGVtZS1jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRoZW1lLWJ1dHRvbi1pY29uXCIsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBgdXJsKCR7Z2V0QXNzZXRQYXRoKGAuL2Fzc2V0cy9hcmNnaXMtc21hcnQtbWFwcGluZy1kcm9wZG93bi1pbWFnZXMvYCl9JHt0aGlzLnNlbGVjdGVkVGhlbWVJbmZvLmljb25QYXRofSlgXG4gICAgICAgICAgICB9IH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGhlbWUtc3ViLWNvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGhlbWUtYnV0dG9uLXRleHRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGhlbWUtYnV0dG9uLXRpdGxlXCIgfSwgdGhpcy5zZWxlY3RlZFRoZW1lSW5mby50aXRsZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aGVtZS1idXR0b24tbXNnXCIgfSwgdGhpcy5zZWxlY3RlZFRoZW1lSW5mby5tc2cpKSwgaChcImRpdlwiLCBudWxsLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNoZXZyb24tZG93blwiIH0pKSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXJNaW5pbWFsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgb25DbGljazogKGV2ZW50KSA9PiBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSB9LCBzdHJpbmdzLnRoZW1lQnV0dG9uLnRoZW1lLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzY2FsZTogXCJtXCIsIGNsYXNzOiBcImNhbGNpdGUtdGhlbWUtYnV0dG9uXCIsIGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImZ1bGxcIiwgdGFiaW5kZXg6IFwiMFwiLCByb2xlOiBcImJ1dHRvblwiLCBraW5kOiBcIm5ldXRyYWxcIiwgXCJhcmlhLWhhc3BvcHVwXCI6IFwidHJ1ZVwiLCBsYWJlbDogc3RyaW5ncy50aGVtZUJ1dHRvbi5zZWxlY3RUaGVtZSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYnV0dG9uTm9kZSA9IG5vZGUpLCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5UaGVtZURyb3Bkb3duKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25DbGljazogKCkgPT4gdGhpcy5vcGVuVGhlbWVEcm9wZG93bigpIH0sIHRoaXMuc2VsZWN0ZWRUaGVtZUluZm8udGl0bGUpKSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgc2V0U2VsZWN0aW9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGF1dGhDb2xvclZpc1ZhciA9IGdldEF1dGhWaXNWYXIoZ2V0UmVuZGVyZXIobGF5ZXIpLCBcImNvbG9yXCIpO1xuICAgICAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIoZ2V0UmVuZGVyZXIobGF5ZXIpLCBcInNpemVcIik7XG4gICAgICAgIGxldCBuZXdWYWx1ZSA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udW5pdmFyaWF0ZVRoZW1lKSB8fFxuICAgICAgICAgICAgKHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcInNpemVcIiA/IGF1dGhTaXplVmlzVmFyID09PSBudWxsIHx8IGF1dGhTaXplVmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoU2l6ZVZpc1Zhci50aGVtZSA6IGF1dGhDb2xvclZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoQ29sb3JWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhDb2xvclZpc1Zhci50aGVtZSk7XG4gICAgICAgIGlmIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3Itc2l6ZVwiICYmXG4gICAgICAgICAgICAoYXV0aEluZm8gPT09IG51bGwgfHwgYXV0aEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhJbmZvLnR5cGUpICE9PSBcInVuaXZhcmlhdGUtY29sb3Itc2l6ZVwiICYmXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyU3VidHlwZSA9PT0gXCJzaXplXCIpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gYXV0aFNpemVWaXNWYXIudGhlbWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZWxlY3RlZFRoZW1lSW5mbyA9ICFuZXdWYWx1ZVxuICAgICAgICAgICAgPyB0aGlzLnRoZW1lSW5mb3MuZmluZCgoaW5mbykgPT4gaW5mby52YWx1ZSA9PT0gXCJoaWdoLXRvLWxvd1wiKVxuICAgICAgICAgICAgOiB0aGlzLnRoZW1lSW5mb3MuZmluZCgoaW5mbykgPT4gaW5mby52YWx1ZSA9PT0gbmV3VmFsdWUpO1xuICAgICAgICB0aGlzLnRoZW1lSW5mb3MuZm9yRWFjaCgodGhlbWVJbmZvKSA9PiB7XG4gICAgICAgICAgICB0aGVtZUluZm8uc2VsZWN0ZWQgPSB0aGVtZUluZm8udmFsdWUgPT09IHRoaXMuc2VsZWN0ZWRUaGVtZUluZm8udmFsdWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZVBvcG92ZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duTm9kZSkge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5kcm9wZG93bk5vZGUucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHRoaXMuZHJvcGRvd25Ob2RlKTtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd25Ob2RlID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9wZW5UaGVtZURyb3Bkb3duKCkge1xuICAgICAgICBpZiAoIXRoaXMub3Blbikge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdUaGVtZUJ1dHRvbkJlZm9yZU9wZW4uZW1pdCgpO1xuICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZHJvcGRvd25cIik7XG4gICAgICAgICAgICBkcm9wZG93bi5idXR0b25Ob2RlID0gdGhpcy5idXR0b25Ob2RlO1xuICAgICAgICAgICAgZHJvcGRvd24uaW5mb3MgPSB0aGlzLnRoZW1lSW5mb3M7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duTm9kZSA9IGRyb3Bkb3duO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ0Ryb3Bkb3duQ2xvc2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICBldmVudC5kZXRhaWwgPT09IFwiRXNjYXBlXCIgJiYgdGhpcy5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nRHJvcGRvd25DaGFuZ2VcIiwgKGV2ZW50KSA9PiB0aGlzLnNldFRoZW1lKGV2ZW50LmRldGFpbCkpO1xuICAgICAgICAgICAgdGhpcy5idXR0b25Ob2RlLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRyb3Bkb3duKTtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRUaGVtZShuZXdUaGVtZUluZm8pIHtcbiAgICAgICAgY29uc3QgY3VycmVudFRoZW1lID0gZ2V0UmVuZGVyZXJUaGVtZSh0aGlzLnJlbmRlcmVyU3VidHlwZSk7XG4gICAgICAgIGNvbnN0IG5ld1RoZW1lID0gbmV3VGhlbWVJbmZvLnZhbHVlO1xuICAgICAgICBpZiAobmV3VGhlbWUgPT09IGN1cnJlbnRUaGVtZSkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRGb2N1cygpLCAzMDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50aGVtZUluZm9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnRoZW1lSW5mb3NbaV0uc2VsZWN0ZWQgPSB0aGlzLnRoZW1lSW5mb3NbaV0udmFsdWUgPT09IG5ld1RoZW1lO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUaGVtZUluZm8gPSBuZXdUaGVtZUluZm87XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b25DaGFuZ2UuZW1pdChuZXdUaGVtZSk7XG4gICAgICAgIHRoaXMuY2xvc2VQb3BvdmVyKCk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRGb2N1cygpLCAzMDApO1xuICAgIH1cbiAgICBwb3B1bGF0ZVRoZW1lSW5mbygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IG5ld01TID0gbWFwSW1hZ2VTdWJsYXllciAmJiBsYXllci52ZXJzaW9uID49IDExO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcImNvbG9yLWFnZVwiLCBcInNpemUtYWdlXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xIHx8XG4gICAgICAgICAgICAodGhpcy5yZW5kZXJlclN1YnR5cGUgIT09IFwic2l6ZVwiICYmIFtcImNvbG9yLWFnZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB8fFxuICAgICAgICAgICAgKHRoaXMucmVuZGVyZXJTdWJ0eXBlID09PSBcInNpemVcIiAmJlxuICAgICAgICAgICAgICAgIFtcImNvbG9yLXNpemUtYWdlXCIsIFwidHlwZS1zaXplLWFnZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMSk7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBhdXRoSW5mbyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm87XG4gICAgICAgIGNvbnN0IGlzVW5pdmFyaWF0ZSA9IChhdXRoSW5mbyA9PT0gbnVsbCB8fCBhdXRoSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aEluZm8udHlwZSkgPT09IFwidW5pdmFyaWF0ZS1jb2xvci1zaXplXCI7XG4gICAgICAgIGNvbnN0IHZpc1ZhciA9IHJlbmRlcmVyVHlwZSA9PT0gXCJjb2xvci1zaXplXCIgJiYgaXNVbml2YXJpYXRlXG4gICAgICAgICAgICA/IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwic2l6ZVwiKVxuICAgICAgICAgICAgOiBnZXRWaXNWYXIoZ2V0UmVuZGVyZXIobGF5ZXIpLCB0aGlzLnJlbmRlcmVyU3VidHlwZSk7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQodmlzVmFyLmZpZWxkKTtcbiAgICAgICAgdGhpcy5pc0RhdGUgPSAoZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLnNpbXBsZUZpZWxkVHlwZSkgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURSAmJiAhaXNBZ2VSZW5kZXJlcjtcbiAgICAgICAgY29uc3QgaW1nU3RyID0gcmVuZGVyZXJUeXBlID09PSBcImNvbG9yLXNpemVcIiAmJiBpc1VuaXZhcmlhdGVcbiAgICAgICAgICAgID8gXCJDb2xvckFuZFNpemVfXCJcbiAgICAgICAgICAgIDogdGhpcy5yZW5kZXJlclN1YnR5cGUgPT09IFwiY29sb3JcIlxuICAgICAgICAgICAgICAgID8gXCJDb2xvcl9cIlxuICAgICAgICAgICAgICAgIDogXCJTaXplX1wiO1xuICAgICAgICB0aGlzLnRoZW1lSW5mb3MucHVzaCh7XG4gICAgICAgICAgICB2YWx1ZTogXCJoaWdoLXRvLWxvd1wiLFxuICAgICAgICAgICAgdGl0bGU6IHRoaXMuaXNEYXRlID8gc3RyaW5ncy50aGVtZUJ1dHRvbi5uZXdUb09sZCA6IHN0cmluZ3MudGhlbWVCdXR0b24uaGlnaFRvTG93LFxuICAgICAgICAgICAgbXNnOiB0aGlzLmlzRGF0ZVxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy50aGVtZUJ1dHRvblt0aGlzLnJlbmRlcmVyU3VidHlwZV0ubmV3VG9PbGRNc2dcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MudGhlbWVCdXR0b25bdGhpcy5yZW5kZXJlclN1YnR5cGVdLmhpZ2hUb0xvd01zZyxcbiAgICAgICAgICAgIGljb25QYXRoOiBgJHtpbWdTdHJ9JHtJbWFnZVBhdGhzLmhpZ2hUb0xvd31gLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yXCIgfHxcbiAgICAgICAgICAgIChyZW5kZXJlclR5cGUgPT09IFwiY29sb3Itc2l6ZVwiICYmXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlclN1YnR5cGUgIT09IFwic2l6ZVwiICYmXG4gICAgICAgICAgICAgICAgKCFtYXBJbWFnZVN1YmxheWVyIHx8IG5ld01TKSkpIHtcbiAgICAgICAgICAgIHRoaXMudGhlbWVJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJhYm92ZS1hbmQtYmVsb3dcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5pc0RhdGUgPyBzdHJpbmdzLnRoZW1lQnV0dG9uLmJlZm9yZUFuZEFmdGVyIDogc3RyaW5ncy50aGVtZUJ1dHRvbi5hYm92ZUFuZEJlbG93LFxuICAgICAgICAgICAgICAgIG1zZzogdGhpcy5pc0RhdGVcbiAgICAgICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRoZW1lQnV0dG9uW3RoaXMucmVuZGVyZXJTdWJ0eXBlXS5iZWZvcmVBbmRBZnRlck1zZ1xuICAgICAgICAgICAgICAgICAgICA6IHN0cmluZ3MudGhlbWVCdXR0b25bdGhpcy5yZW5kZXJlclN1YnR5cGVdLmFib3ZlQW5kQmVsb3dNc2csXG4gICAgICAgICAgICAgICAgaWNvblBhdGg6IGAke2ltZ1N0cn0ke0ltYWdlUGF0aHMuYWJvdmVBbmRCZWxvd31gLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aGVtZUluZm9zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IFwiYWJvdmVcIixcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmlzRGF0ZSA/IHN0cmluZ3MudGhlbWVCdXR0b24uYWZ0ZXIgOiBzdHJpbmdzLnRoZW1lQnV0dG9uLmFib3ZlLFxuICAgICAgICAgICAgbXNnOiB0aGlzLmlzRGF0ZVxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy50aGVtZUJ1dHRvblt0aGlzLnJlbmRlcmVyU3VidHlwZV0uYWZ0ZXJNc2dcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MudGhlbWVCdXR0b25bdGhpcy5yZW5kZXJlclN1YnR5cGVdLmFib3ZlTXNnLFxuICAgICAgICAgICAgaWNvblBhdGg6IGAke2ltZ1N0cn0ke0ltYWdlUGF0aHMuYWJvdmV9YCxcbiAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50aGVtZUluZm9zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IFwiYmVsb3dcIixcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmlzRGF0ZSA/IHN0cmluZ3MudGhlbWVCdXR0b24uYmVmb3JlIDogc3RyaW5ncy50aGVtZUJ1dHRvbi5iZWxvdyxcbiAgICAgICAgICAgIG1zZzogdGhpcy5pc0RhdGVcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MudGhlbWVCdXR0b25bdGhpcy5yZW5kZXJlclN1YnR5cGVdLmJlZm9yZU1zZ1xuICAgICAgICAgICAgICAgIDogc3RyaW5ncy50aGVtZUJ1dHRvblt0aGlzLnJlbmRlcmVyU3VidHlwZV0uYmVsb3dNc2csXG4gICAgICAgICAgICBpY29uUGF0aDogYCR7aW1nU3RyfSR7SW1hZ2VQYXRocy5iZWxvd31gLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocmVuZGVyZXJUeXBlID09PSBcImNvbG9yXCIpIHtcbiAgICAgICAgICAgIHRoaXMudGhlbWVJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJjZW50ZXJlZC1vblwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnRoZW1lQnV0dG9uLmNlbnRlcmVkLFxuICAgICAgICAgICAgICAgIG1zZzogc3RyaW5ncy50aGVtZUJ1dHRvblt0aGlzLnJlbmRlcmVyU3VidHlwZV0uY2VudGVyZWRNc2csXG4gICAgICAgICAgICAgICAgaWNvblBhdGg6IGAke2ltZ1N0cn0ke0ltYWdlUGF0aHMuY2VudGVyZWRPbn1gLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnRoZW1lSW5mb3MucHVzaCh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiZXh0cmVtZXNcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy50aGVtZUJ1dHRvbi5leHRyZW1lcyxcbiAgICAgICAgICAgICAgICBtc2c6IHN0cmluZ3MudGhlbWVCdXR0b25bdGhpcy5yZW5kZXJlclN1YnR5cGVdLmV4dHJlbWVzTXNnLFxuICAgICAgICAgICAgICAgIGljb25QYXRoOiBgJHtpbWdTdHJ9JHtJbWFnZVBhdGhzLmV4dHJlbWVzfWAsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nVGhlbWVCdXR0b24uc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdUaGVtZUJ1dHRvbkNzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nVHJhbnNwYXJlbmN5Q3NzID0gXCIuYmxvY2stY29udGVudC1sb2FkaW5ne2hlaWdodDoxNTBweH0udHJhbnNwYXJlbmN5LWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5ibG9jay1zZWN0aW9uLXBhZGRpbmd7cGFkZGluZy10b3A6NnB4fS50cmFuc3BhcmVuY3ktcmFuZ2V7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS50cmFuc3BhcmVuY3ktcmFuZ2UtaXRlbXt3aWR0aDo0OSU7ZGlzcGxheTpmbGV4O2ZsZXgtZmxvdzpjb2x1bW47anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmluY2x1ZGUtbGVnZW5ke21hcmdpbjoxMHB4IDAgMCAwfS5zbGlkZXItYm94e2hlaWdodDozMDBweH0uc2xpZGVyLWJveCAuZXNyaS1vcGFjaXR5LXNsaWRlcl9faGlzdG9ncmFtLWNvbnRhaW5lcnt3aWR0aDo4NXB4fS5zbGlkZXItYm94IC5lc3JpLW9wYWNpdHktc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX2NvbnRlbnR7aGVpZ2h0OjE3NXB4fS5zbGlkZXItYm94IC5lc3JpLW9wYWNpdHktc2xpZGVye21pbi13aWR0aDoyMDBweH0uc2xpZGVyLWJveCAuZXNyaS1vcGFjaXR5LXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19sYWJlbCwuc2xpZGVyLWJveCAuZXNyaS1vcGFjaXR5LXNsaWRlciAuZXNyaS1zbGlkZXIgLmVzcmktc2xpZGVyX19taW4sLnNsaWRlci1ib3ggLmVzcmktb3BhY2l0eS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWF4e3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9LnNsaWRlci1ib3ggLmVzcmktb3BhY2l0eS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbGFiZWw6aG92ZXIsLnNsaWRlci1ib3ggLmVzcmktb3BhY2l0eS1zbGlkZXIgLmVzcmktc2xpZGVyIC5lc3JpLXNsaWRlcl9fbWluOmhvdmVyLC5zbGlkZXItYm94IC5lc3JpLW9wYWNpdHktc2xpZGVyIC5lc3JpLXNsaWRlciAuZXNyaS1zbGlkZXJfX21heDpob3Zlcntib3JkZXI6MXB4IHNvbGlkICNiYmI7YmFja2dyb3VuZC1jb2xvcjojZjNmM2YzO3RleHQtZGVjb3JhdGlvbjpub25lO3otaW5kZXg6MX0uc2xpZGVyLWJveC1idXR0b25zLWZyb250e2Rpc3BsYXk6ZmxleH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nVHJhbnNwYXJlbmN5ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xUcmFuc3BhcmVuY3lFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sVHJhbnNwYXJlbmN5RXJyb3JcIiwgNyk7XG4gICAgICAgIC8qXG4gICAgICAgICAqIFdoZW4gdG9nZ2xpbmcgb2ZmIHJlbWVtYmVyIHNldHRpbmdzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxhc3RTZXR0aW5ncyA9IHt9O1xuICAgICAgICAvKipcbiAgICAgICAgICogTmVjZXNzYXJ5IGZvciB0cmFja2luZyBzdG9wcyBmb3Igbm9uLWNsYXNzZWQgc2xpZGVycyxcbiAgICAgICAgICogd2hvc2UgdmFsdWVzIGFyZSB1cGRhdGVkIGltbWVkaWF0ZWx5IGV2ZW4gZ2l2ZW4gaW5jb3JyZWN0IGlucHV0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3VycmVudFN0b3BWYWx1ZXMgPSBbXTtcbiAgICAgICAgdGhpcy56aWd6YWdDbGljayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhc3RGaWVsZFNvcnRCeSA9IExhc3RTb3J0eUJ5LmRlZmF1bHQ7XG4gICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwibm90LWxvYWRlZFwiO1xuICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oaXN0b2dyYW1TdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBwdWJsaWMgY2FsbHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmJsb2NrTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZVN0YXRpc3RpY3MoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IG51bGw7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLk1JU1NJTkc7XG4gICAgICAgIHRoaXMuaGlzdG9ncmFtID0gbnVsbDtcbiAgICAgICAgKF9hID0gdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdldFN0YXRpc3RpY3MoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgdGhpcy5pc0Jsb2NrT3BlbiA9IHRoaXMub3BlbiB8fCAhIW9wYWNpdHlWaXNWYXI7XG4gICAgICAgIHRoaXMuZ2V0U3RhdGlzdGljcygpO1xuICAgICAgICB0aGlzLnBlcmNlbnRMYWJlbEZsaXAgPSBnZXRQZXJjZW50TGFiZWxGbGlwKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmZsb3dJdGVtTm9kZSA9IGZpbmRQYXJlbnROb2RlKHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCBzdHJpbmdzLCBtYXBJbWFnZVN1YmxheWVyLCBzdXBwb3J0c0FyY2FkZSwgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB7IGlzQmxvY2tPcGVuLCBpc0xvYWRpbmcgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBpZiAoKG1hcEltYWdlU3VibGF5ZXIgJiYgIXN1cHBvcnRzQXJjYWRlKSB8fCBsYXllci50eXBlID09PSBcImdlby1yc3NcIiB8fCAhaGFzTnVtYmVyRmllbGQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNQcmVkb21pbmFuY2UgPSBbXCJwcmVkb21pbmFuY2VcIiwgXCJwcmVkb21pbmFuY2Utc2l6ZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJsaW5rXCIsIHsgcmVsOiBcInN0eWxlc2hlZXRcIiwgaHJlZjogYCR7Y29uZmlnLmpzYXBpVXJsfS90aGVtZXMvbGlnaHQvbWFpbi5jc3NgLCBvbkxvYWQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlU2hlZXRTdGF0dXMgPSBcImxvYWRlZFwiO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgb25FcnJvcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVTaGVldFN0YXR1cyA9IFwiZmFpbGVkXCI7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGhlYWRpbmc6IGlzUHJlZG9taW5hbmNlXG4gICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRyYW5zcGFyZW5jeS50cmFuc3BhcmVuY3lCeVByZWRvbWluYW5jZVxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy50cmFuc3BhcmVuY3kudHJhbnNwYXJlbmN5QnlBdHRyaWJ1dGUsIGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiBpc0Jsb2NrT3BlbiwgbG9hZGluZzogaXNMb2FkaW5nLCBjbGFzczogXCJ0cmFuc3BhcmVuY3ktYmxvY2tcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYmxvY2tOb2RlID0gbm9kZSksIG9uQ2FsY2l0ZUJsb2NrT3BlbjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNCbG9ja09wZW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNjcm9sbEludG9WaWV3KHRoaXMuYmxvY2tOb2RlKTtcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUJsb2NrQ2xvc2U6ICgpID0+ICh0aGlzLmlzQmxvY2tPcGVuID0gZmFsc2UpIH0sIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5VG9nZ2xlKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclRyYW5zcGFyZW5jeVRvZ2dsZSgpIHtcbiAgICAgICAgY29uc3QgeyBzdHlsZVNoZWV0U3RhdHVzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IGlzUHJlZG9taW5hbmNlID0gW1wicHJlZG9taW5hbmNlXCIsIFwicHJlZG9taW5hbmNlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTE7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2stc2VjdGlvblwiLCB7IHRleHQ6IGlzUHJlZG9taW5hbmNlXG4gICAgICAgICAgICAgICAgPyBzdHJpbmdzLnRyYW5zcGFyZW5jeS50cmFuc3BhcmVuY3lMYWJlbFByZWRvbWluYW5jZVxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy50cmFuc3BhcmVuY3kudHJhbnNwYXJlbmN5TGFiZWwsIFwidG9nZ2xlLWRpc3BsYXlcIjogXCJzd2l0Y2hcIiwgb3BlbjogISFvcGFjaXR5VmlzVmFyLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6IChldmVudCkgPT4gdGhpcy5oYW5kbGVUb2dnbGUoZXZlbnQpLCByZWY6IChub2RlKSA9PiAodGhpcy5ibG9ja1NlY3Rpb25Ob2RlID0gbm9kZSkgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImJsb2NrLXNlY3Rpb24tcGFkZGluZ1wiIH0sIG9wYWNpdHlWaXNWYXIgJiYgc3R5bGVTaGVldFN0YXR1cyA9PT0gXCJsb2FkZWRcIlxuICAgICAgICAgICAgPyB0aGlzLnJlbmRlckNvbnRlbnQoKVxuICAgICAgICAgICAgOiBvcGFjaXR5VmlzVmFyICYmIHN0eWxlU2hlZXRTdGF0dXMgPT09IFwibm90LWxvYWRlZFwiXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlbmRlckxvYWRpbmcoKVxuICAgICAgICAgICAgICAgIDogbnVsbCkpKTtcbiAgICB9XG4gICAgcmVuZGVyTG9hZGluZygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYmxvY2stY29udGVudC1sb2FkaW5nXCIgfSwgaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IHN0cmluZ3MubG9hZGluZyB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIHRoaXMucmVuZGVyQXR0cmlidXRlcygpLCB0aGlzLnJlbmRlclNsaWRlcigpLCB0aGlzLnJlbmRlclJhbmdlKCksIHRoaXMucmVuZGVyTGVnZW5kKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyQXR0cmlidXRlcygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgaWYgKFtcInByZWRvbWluYW5jZVwiLCBcInByZWRvbWluYW5jZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQob3BhY2l0eVZpc1Zhci5maWVsZCk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IG9wYWNpdHlWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkICYmIGdldEZpZWxkKG9wYWNpdHlWaXNWYXIubm9ybWFsaXphdGlvbkZpZWxkKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0ge1xuICAgICAgICAgICAgZmllbGQ6IG9wYWNpdHlWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICBleHByZXNzaW9uOiBvcGFjaXR5VmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGQgPyBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIHRoaXMucmVuZGVyQXR0cmlidXRlTWFpbihmaWVsZEluZm8pLCB0aGlzLnJlbmRlckF0dHJpYnV0ZURpdmlkZWRCeShub3JtYWxpemF0aW9uRmllbGQpKSk7XG4gICAgfVxuICAgIHJlbmRlckF0dHJpYnV0ZU1haW4oZmllbGRJbmZvKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBmaWVsZHMsIGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgaXNCaW5uaW5nTGF5ZXIgPSBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIjtcbiAgICAgICAgY29uc3QgY2FuQXJjYWRlID0gIWlzQmlubmluZ0xheWVyO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hdHRyaWJ1dGUtaW5wdXRcIiwgeyBmaWVsZExpc3Q6IGZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiBbc2ltcGxlRmllbGRUeXBlcy5EQVRFLCBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUl0uaW5jbHVkZXMoZmllbGQuc2ltcGxlRmllbGRUeXBlKSksIHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50OiB0aGlzLmZsb3dJdGVtTm9kZSwgc2VsZWN0ZWRGaWVsZDogZmllbGRJbmZvLCBsYWJlbDogc3RyaW5ncy50cmFuc3BhcmVuY3kuZmllbGQsIG1vZGU6IGNhbkFyY2FkZSA/IFwiZXhwcmVzc2lvblwiIDogXCJzaW1wbGVcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuYXR0cmlidXRlSW5wdXROb2RlID0gbm9kZSksIG9uQXJjZ2lzU21hcnRNYXBwaW5nQXR0cmlidXRlSW5wdXRDaGFuZ2U6IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRPcGFjaXR5VmlzdWFsVmFyaWFibGUoZmllbGRJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgKF9hID0gdGhpcy5kaXZpZGVkQnlBdHRyaWJ1dGVJbnB1dE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGVhcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyByZWZyZXNoIHNsaWRlciB3aGVuIHN3aXRjaGluZyBiZXR3ZWVuIGZpZWxkcyBhbmQgQXJjYWRlIGV4cHJlc3Npb25zXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0aXN0aWNzKCk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0F0dHJpYnV0ZUlucHV0RXJyb3I6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sVHJhbnNwYXJlbmN5RXJyb3IuZW1pdChldmVudC5kZXRhaWwpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckF0dHJpYnV0ZURpdmlkZWRCeShub3JtYWxpemF0aW9uRmllbGQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgZmllbGRzLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZChvcGFjaXR5VmlzVmFyLmZpZWxkKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0ge1xuICAgICAgICAgICAgZmllbGQ6IG9wYWNpdHlWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICBleHByZXNzaW9uOiBvcGFjaXR5VmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGQgPyBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICB9O1xuICAgICAgICBpZiAoZmllbGRJbmZvLmV4cHJlc3Npb24gfHwgZmllbGRJbmZvLnNpbXBsZUZpZWxkVHlwZSAhPT0gc2ltcGxlRmllbGRUeXBlcy5OVU1CRVIpIHtcbiAgICAgICAgICAgIC8vIG1haW4gZmllbGQgaXMgZXhwcmVzc2lvbiBvciBub3QgYSBudW1iZXIsIHdlIGRvbid0IHN1cHBvcnQgZGl2aWRlZEJ5XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb3VudHMgPSBnZXRMYXllckZpZWxkVHlwZUNvdW50KGZpZWxkcyk7XG4gICAgICAgIGlmIChjb3VudHMubnVtYmVyIDwgMikge1xuICAgICAgICAgICAgLy8gdGhlIGxheWVyIGhhcyBvbmx5IDEgb3Igbm8gbnVtYmVyIGZpZWxkXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hdHRyaWJ1dGUtaW5wdXRcIiwgeyBmaWVsZExpc3Q6IGZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiBmaWVsZC5sYXllckZpZWxkLm5hbWUgIT09IG9wYWNpdHlWaXNWYXIuZmllbGQgJiZcbiAgICAgICAgICAgICAgICBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSKSwgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZmxvd0l0ZW1Ob2RlLCBsYWJlbDogc3RyaW5ncy50cmFuc3BhcmVuY3kuZGl2aWRlZEJ5LCBzZWxlY3RlZEZpZWxkOiBub3JtYWxpemF0aW9uRmllbGRcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IG5vcm1hbGl6YXRpb25GaWVsZC5sYXllckZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogbm9ybWFsaXphdGlvbkZpZWxkLnNpbXBsZUZpZWxkVHlwZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IG51bGwsIG1vZGU6IFwicmVtb3ZlXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpdmlkZWRCeUF0dHJpYnV0ZUlucHV0Tm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdBdHRyaWJ1dGVJbnB1dENoYW5nZTogYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0T3BhY2l0eVZpc3VhbFZhcmlhYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBvcGFjaXR5VmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgICAgICAgICB9LCBmaWVsZEluZm8uZmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRPcGFjaXR5VmlzdWFsVmFyaWFibGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IG9wYWNpdHlWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSXG4gICAgICAgICAgICAgICAgICAgIH0sIG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyByZWZyZXNoIHNsaWRlciB3aGVuIG5vcm1hbGl6aW5nIGFuZCByZW1vdmluZyB0aGUgbm9ybWFsaXphdGlvbiBmaWVsZFxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNsaWRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzU3RhdHVzLCBoaXN0b2dyYW1TdGF0dXMsIHNsaWRlclpvb21lZCB9ID0gdGhpcztcbiAgICAgICAgaWYgKHN0YXRpc3RpY3NTdGF0dXMgPT09IHN0YXR1cy5GQUlMRUQgfHwgc3RhdGlzdGljc1N0YXR1cyA9PT0gc3RhdHVzLk1JU1NJTkcpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3RhdGlzdGljc1N0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTIHx8XG4gICAgICAgICAgICAoaGlzdG9ncmFtU3RhdHVzID09PSBzdGF0dXMuSU5fUFJPR1JFU1MgJiYgIXRoaXMudHJhbnNwYXJlbmN5U2xpZGVyKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5U2xpZGVyTG9hZGluZygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgb2sgPSB0aGlzLnByZXBhcmVUcmFuc3BhcmVuY3lTbGlkZXIoKTtcbiAgICAgICAgICAgIGxldCBkaXNhYmxlWm9vbUJ1dHRvbiA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgICAgICBpZiAoIXNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhPcGFjaXR5VmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwib3BhY2l0eVwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKG9wYWNpdHlWaXNWYXIuc3RvcHMsIGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5taW5TbGlkZXJWYWx1ZSwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoKHpvb21PcHRpb25zID09PSBudWxsIHx8IHpvb21PcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiB6b29tT3B0aW9ucy5taW5NYXhTYW1lKSB8fFxuICAgICAgICAgICAgICAgICAgICAoIWlzRGVmaW5lZCh6b29tT3B0aW9ucyA9PT0gbnVsbCB8fCB6b29tT3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogem9vbU9wdGlvbnMubWluKSAmJiAhaXNEZWZpbmVkKHpvb21PcHRpb25zID09PSBudWxsIHx8IHpvb21PcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiB6b29tT3B0aW9ucy5tYXgpKSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlWm9vbUJ1dHRvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnpvb21CdXR0b25Ob2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0b3BWYWx1ZXMgPSBvcGFjaXR5VmlzVmFyLnN0b3BzLm1hcCgoc3RvcCkgPT4gc3RvcC52YWx1ZSk7XG4gICAgICAgICAgICBpZiAob2sgfHwgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzbGlkZXItYm94XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlci1ib3gtYnV0dG9ucy1mcm9udFwiIH0sIHRoaXMucmVuZGVyWm9vbUJ1dHRvbihkaXNhYmxlWm9vbUJ1dHRvbiksIGgoXCJkaXZcIiwgbnVsbCwgXCJcXHUwMEEwXCIpLCB0aGlzLnJlbmRlclJlc2V0QnV0dG9uKCkpLCBoKFwiZGl2XCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyVHJhbnNwYXJlbmN5U2xpZGVyQ3JlYXRlKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IH0pKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJUcmFuc3BhcmVuY3lTbGlkZXJMb2FkaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyVHJhbnNwYXJlbmN5U2xpZGVyTG9hZGluZygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2xpZGVyLWJveFwiIH0sIGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiBzdHJpbmdzLmxvYWRpbmcgfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyWm9vbUJ1dHRvbihkaXNhYmxlWm9vbUJ1dHRvbikge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCB7IHNsaWRlclpvb21lZCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy50cmFuc3BhcmVuY3kuem9vbVNsaWRlciwgaWNvbjogc2xpZGVyWm9vbWVkID8gXCJtYWduaWZ5aW5nR2xhc3NNaW51c1wiIDogXCJtYWduaWZ5aW5nR2xhc3NQbHVzXCIsIGRpc2FibGVkOiBkaXNhYmxlWm9vbUJ1dHRvbiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVab29tU2xpZGVyKCksIHJlZjogKG5vZGUpID0+ICh0aGlzLnpvb21CdXR0b25Ob2RlID0gbm9kZSkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJSZXNldEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy50cmFuc3BhcmVuY3kucmVzZXRTbGlkZXIsIGljb246IFwidW5kb1wiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVJlc2V0U2xpZGVyKCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJSYW5nZSgpIHtcbiAgICAgICAgY29uc3QgeyBwZXJjZW50TGFiZWxGbGlwIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3Qgc3RvcHMgPSBvcGFjaXR5VmlzVmFyLnN0b3BzO1xuICAgICAgICBjb25zdCBoaWdoVmFsdWUgPSBNYXRoLnJvdW5kKDEwMCAtIHN0b3BzWzFdLm9wYWNpdHkgKiAxMDApO1xuICAgICAgICBjb25zdCBsb3dWYWx1ZSA9IE1hdGgucm91bmQoMTAwIC0gc3RvcHNbMF0ub3BhY2l0eSAqIDEwMCk7XG4gICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gcmUtY3JlYXRlIHRoZSBpbnB1dCB3aGVuZXZlciB0aGUgdmFsdWUgY2hhbmdlcyxcbiAgICAgICAgLy8gb3RoZXJ3aXNlIHRoYXQgYWZmZWN0cyB0aGUgbXVsdGlwbGUgdXAvZG93bi1jbGlja2luZy5cbiAgICAgICAgLy8gQnV0IHdlIG5lZWQgdG8gcmVmcmVzaCBpZiB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IG5lZWRzIHRvIGdldCBjb3JyZWN0ZWRcbiAgICAgICAgaWYgKHRoaXMuaGlnaElucHV0Tm9kZSkge1xuICAgICAgICAgICAgdGhpcy5oaWdoSW5wdXROb2RlLnZhbHVlID0gXCJcIiArIGhpZ2hWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5sb3dJbnB1dE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMubG93SW5wdXROb2RlLnZhbHVlID0gXCJcIiArIGxvd1ZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy50cmFuc3BhcmVuY3kudHJhbnNwYXJlbmN5UmFuZ2UpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidHJhbnNwYXJlbmN5LXJhbmdlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRyYW5zcGFyZW5jeS1yYW5nZS1pdGVtXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgc3RyaW5ncy50cmFuc3BhcmVuY3kudHJhbnNwYXJlbmN5SGlnaFZhbHVlcywgaChcImNhbGNpdGUtaW5wdXQtbnVtYmVyXCIsIHsgcHJlZml4VGV4dDogcGVyY2VudExhYmVsRmxpcCA/IFwiJVwiIDogdW5kZWZpbmVkLCBzdWZmaXhUZXh0OiAhcGVyY2VudExhYmVsRmxpcCA/IFwiJVwiIDogdW5kZWZpbmVkLCB2YWx1ZTogYCR7MTAwIC0gTWF0aC5yb3VuZChzdG9wc1sxXS5vcGFjaXR5ICogMTAwKX1gLCBtaW46IDAsIG1heDogMTAwLCBzdGVwOiAxLCBzY2FsZTogXCJzXCIsIG51bWJlckJ1dHRvblR5cGU6IFwidmVydGljYWxcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuaGlnaElucHV0Tm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVJbnB1dE51bWJlcklucHV0OiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlUmFuZ2VDaGFuZ2UoZXZlbnQsIFwiaGlnaFwiKSwgbGFiZWw6IHN0cmluZ3MudHJhbnNwYXJlbmN5LnRyYW5zcGFyZW5jeUhpZ2hWYWx1ZXMgfSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRyYW5zcGFyZW5jeS1yYW5nZS1pdGVtXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgc3RyaW5ncy50cmFuc3BhcmVuY3kudHJhbnNwYXJlbmN5TG93VmFsdWVzLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyBwcmVmaXhUZXh0OiBwZXJjZW50TGFiZWxGbGlwID8gXCIlXCIgOiB1bmRlZmluZWQsIHN1ZmZpeFRleHQ6ICFwZXJjZW50TGFiZWxGbGlwID8gXCIlXCIgOiB1bmRlZmluZWQsIHZhbHVlOiBgJHsxMDAgLSBNYXRoLnJvdW5kKHN0b3BzWzBdLm9wYWNpdHkgKiAxMDApfWAsIG1pbjogMCwgbWF4OiAxMDAsIHN0ZXA6IDEsIHNjYWxlOiBcInNcIiwgbnVtYmVyQnV0dG9uVHlwZTogXCJ2ZXJ0aWNhbFwiLCByZWY6IChub2RlKSA9PiAodGhpcy5sb3dJbnB1dE5vZGUgPSBub2RlKSwgb25DYWxjaXRlSW5wdXROdW1iZXJJbnB1dDogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZVJhbmdlQ2hhbmdlKGV2ZW50LCBcImxvd1wiKSwgbGFiZWw6IHN0cmluZ3MudHJhbnNwYXJlbmN5LnRyYW5zcGFyZW5jeUxvd1ZhbHVlcyB9KSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXJMZWdlbmQoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBsZXQgaXNDaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgbGVnZW5kT3B0aW9ucyA9IG9wYWNpdHlWaXNWYXIubGVnZW5kT3B0aW9ucztcbiAgICAgICAgaWYgKGxlZ2VuZE9wdGlvbnMgJiYgbGVnZW5kT3B0aW9ucy5zaG93TGVnZW5kID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaXNDaGVja2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImluY2x1ZGUtbGVnZW5kXCIsIGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiIH0sIHN0cmluZ3MudHJhbnNwYXJlbmN5LmluY2x1ZGVJbkxlZ2VuZCwgaChcImNhbGNpdGUtc3dpdGNoXCIsIHsgc2NhbGU6IFwic1wiLCBjaGVja2VkOiBpc0NoZWNrZWQsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKCkgPT4gdGhpcy5oYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB9KSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBwcmVwYXJlVHJhbnNwYXJlbmN5U2xpZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgc3RhdGlzdGljcywgaGlzdG9ncmFtLCBoaXN0b2dyYW1TdGF0dXMsIHNsaWRlclpvb21lZCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IGF1dGhPcGFjaXR5VmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCBmaWVsZCA9IGdldEZpZWxkKG9wYWNpdHlWaXNWYXIuZmllbGQpO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB7XG4gICAgICAgICAgICBmaWVsZDogb3BhY2l0eVZpc1Zhci5maWVsZCxcbiAgICAgICAgICAgIGV4cHJlc3Npb246IG9wYWNpdHlWaXNWYXIudmFsdWVFeHByZXNzaW9uLFxuICAgICAgICAgICAgZXhwcmVzc2lvblRpdGxlOiBvcGFjaXR5VmlzVmFyLnZhbHVlRXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiAoZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLnNpbXBsZUZpZWxkVHlwZSkgfHwgc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXNEYXRlRmllbGQgPSBpc0RhdGUoZmllbGRJbmZvKTtcbiAgICAgICAgaWYgKGhpc3RvZ3JhbVN0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG1pbiA9IGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5taW5TbGlkZXJWYWx1ZTtcbiAgICAgICAgbGV0IG1heCA9IGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5tYXhTbGlkZXJWYWx1ZTtcbiAgICAgICAgKHsgbWluLCBtYXggfSA9IHZhbGlkYXRlTWluTWF4KHsgbWluLCBtYXggfSkpO1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwYXJlbmN5U2xpZGVyKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgaGlzdG9ncmFtQ29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIGJpbnM6IGhpc3RvZ3JhbSA9PT0gbnVsbCB8fCBoaXN0b2dyYW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhpc3RvZ3JhbS5iaW5zLFxuICAgICAgICAgICAgICAgICAgICBhdmVyYWdlOiBNYXRoLnJvdW5kKHN0YXRpc3RpY3MuYXZnICogMTApIC8gMTAsXG4gICAgICAgICAgICAgICAgICAgIHN0YW5kYXJkRGV2aWF0aW9uOiBzdGF0aXN0aWNzLnN0ZGRldixcbiAgICAgICAgICAgICAgICAgICAgc3RhbmRhcmREZXZpYXRpb25Db3VudDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tGaWxsQ29sb3I6IG5ldyBtb2R1bGVzLmVzcmlDb2xvcihbODQsIDg0LCA4NF0pXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtaW46IG1pbiAhPT0gbnVsbCAmJiBtaW4gIT09IHZvaWQgMCA/IG1pbiA6IHN0YXRpc3RpY3MubWluLFxuICAgICAgICAgICAgICAgIG1heDogbWF4ICE9PSBudWxsICYmIG1heCAhPT0gdm9pZCAwID8gbWF4IDogc3RhdGlzdGljcy5tYXgsXG4gICAgICAgICAgICAgICAgc3RvcHM6IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUob3BhY2l0eVZpc1Zhci5zdG9wcyksXG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uOiBnZXRTdG9wUHJlY2lzaW9uKG9wYWNpdHlWaXNWYXIuc3RvcHMpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGlzRGF0ZUZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhhc1RpbWVEYXRhID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBhZGREYXRlRm9ybWF0RnVuY3Rpb25zKGNvbmZpZywgbWFwVmlldy50aW1lWm9uZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlciA9IG5ldyBtb2R1bGVzLk9wYWNpdHlTbGlkZXIoY29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVHJhbnNwYXJlbmN5U2xpZGVyQ2hhbmdlRXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzbGlkZXIgPSB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlcjtcbiAgICAgICAgICAgIGlmICgoKF9hID0gc2xpZGVyLnNsaWRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gXCJkcmFnZ2luZ1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgaGlzdG9ncmFtQ29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIGJpbnM6IGhpc3RvZ3JhbSA9PT0gbnVsbCB8fCBoaXN0b2dyYW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhpc3RvZ3JhbS5iaW5zLFxuICAgICAgICAgICAgICAgICAgICBhdmVyYWdlOiBNYXRoLnJvdW5kKHN0YXRpc3RpY3MuYXZnICogMTApIC8gMTAsXG4gICAgICAgICAgICAgICAgICAgIHN0YW5kYXJkRGV2aWF0aW9uOiBzdGF0aXN0aWNzLnN0ZGRldixcbiAgICAgICAgICAgICAgICAgICAgc3RhbmRhcmREZXZpYXRpb25Db3VudDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWluOiBtaW4gIT09IG51bGwgJiYgbWluICE9PSB2b2lkIDAgPyBtaW4gOiBzdGF0aXN0aWNzLm1pbixcbiAgICAgICAgICAgICAgICBtYXg6IG1heCAhPT0gbnVsbCAmJiBtYXggIT09IHZvaWQgMCA/IG1heCA6IHN0YXRpc3RpY3MubWF4LFxuICAgICAgICAgICAgICAgIHN0b3BzOiBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKG9wYWNpdHlWaXNWYXIuc3RvcHMpLFxuICAgICAgICAgICAgICAgIGhhc1RpbWVEYXRhOiBpc0RhdGVGaWVsZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlzRGF0ZUZpZWxkICYmIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMoY29uZmlnLCBtYXBWaWV3LnRpbWVab25lKTtcbiAgICAgICAgICAgIGlmIChzbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjbGlja2luZyBhIHppZ3phZyBhbHJlYWR5IHVwZGF0ZXMgdGhlIGludGVybmFsIHNsaWRlciB6b29tT3B0aW9ucztcbiAgICAgICAgICAgICAgICAgKiBzZXR0aW5nIHRoZW0gaGVyZSBhZ2FpbiB3b3VsZCBpbmNvcnJlY3RseSBvdmVycmlkZSBhIHVzZXIncyBkZWNpc2lvblxuICAgICAgICAgICAgICAgICAqIHRvIG1hbnVhbGx5IHpvb20gb3V0IG9uZSBzaWRlIG9mIHRoZSBzbGlkZXIuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnppZ3phZ0NsaWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKG9wYWNpdHlWaXNWYXIuc3RvcHMsIGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5taW5TbGlkZXJWYWx1ZSwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25maWcuem9vbU9wdGlvbnMgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVyWm9vbWVkICYmIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucyAmJiAhdGhpcy56aWd6YWdDbGljaykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy56b29tT3B0aW9ucyA9IHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucztcbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBoYW5kbGVzIGVkZ2UgY2FzZXMgd2hlcmUgdGhlIHNsaWRlciBpcyB6b29tZWQsIGhhbmRsZXMgaGF2ZSBiZWVuIG1hbnVhbGx5IG1vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAqIGFuZCBhIHVzZXIgZXhlY3V0ZXMgYSBsYWJlbCBjaGFuZ2UuIFRoaXMgcHJldmVudHMgem9vbSBvcHRpb25zIGZyb20gY2hhbmdpbmcgYW5kIHByZXNlcnZlc1xuICAgICAgICAgICAgICAgICAqIHRoZSBoaXN0b2dyYW0gZGlzcGxheS5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBpZiAodGhpcy56b29tQWRqdXN0bWVudCA9PT0gXCJtaW5cIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zbGlkZXIubWluID0gY29uZmlnLnpvb21PcHRpb25zLm1pbjtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zLm1pbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zbGlkZXIubWF4ID0gY29uZmlnLnpvb21PcHRpb25zLm1heDtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnpvb21PcHRpb25zLm1heCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hZGp1c3RlZFpvb21PcHRpb25zID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuem9vbUFkanVzdG1lbnQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc2V0KGNvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLnppZ3phZ0NsaWNrID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNyZWF0ZVRyYW5zcGFyZW5jeVNsaWRlckNoYW5nZUV2ZW50cygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQob3BhY2l0eVZpc1Zhci5maWVsZCk7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiBvcGFjaXR5VmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb24sXG4gICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IG9wYWNpdHlWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXNEYXRlRmllbGQgPSBpc0RhdGUoZmllbGRJbmZvKTtcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcGFyZW5jeVNsaWRlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhhbmRsZXMgemlnemFnIGNsaWNrXG4gICAgICAgIHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyLndhdGNoKFwiem9vbU9wdGlvbnNcIiwgKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVyWm9vbWVkICYmXG4gICAgICAgICAgICAgICAgKCgob2xkVmFsdWUgPT09IG51bGwgfHwgb2xkVmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9sZFZhbHVlLm1pbikgJiYgIShuZXdWYWx1ZSA9PT0gbnVsbCB8fCBuZXdWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV3VmFsdWUubWluKSkgfHwgKChvbGRWYWx1ZSA9PT0gbnVsbCB8fCBvbGRWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2xkVmFsdWUubWF4KSAmJiAhKG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5tYXgpKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnppZ3phZ0NsaWNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVppZ3phZ0NsaWNrKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyLm9uKFwibWluLWNoYW5nZVwiLCAoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGluZm8udmFsdWUgPiB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzWzBdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc3RvcHMuZm9yRWFjaCgoc3RvcCwgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN0b3AudmFsdWUgPSB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzW2lkeF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLmN1cnJlbnRTdG9wVmFsdWVzWzBdLCB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zbGlkZXIubWF4LCBcIm1pblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub25NaW5NYXhDaGFuZ2UoaW5mby52YWx1ZSwgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc2xpZGVyLm1heCwgXCJtaW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5vbihcIm1heC1jaGFuZ2VcIiwgKGluZm8pID0+IHtcbiAgICAgICAgICAgIGlmIChpbmZvLnZhbHVlIDwgdGhpcy5jdXJyZW50U3RvcFZhbHVlc1t0aGlzLmN1cnJlbnRTdG9wVmFsdWVzLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc3RvcHMuZm9yRWFjaCgoc3RvcCwgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN0b3AudmFsdWUgPSB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzW2lkeF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zbGlkZXIubWluLCB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzW3RoaXMuY3VycmVudFN0b3BWYWx1ZXMubGVuZ3RoIC0gMV0sIFwibWF4XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbk1pbk1heENoYW5nZSh0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zbGlkZXIubWluLCBpbmZvLnZhbHVlLCBcIm1heFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyLm9uKFwidGh1bWItY2hhbmdlXCIsIChpbmZvKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNEYXRlRmllbGQgJiYgaW5mby52YWx1ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHN0b3BzID0gdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc3RvcHM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIub24oXCJ0aHVtYi1kcmFnXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0b3BzID0gdGhpcy50cmFuc3BhcmVuY3lTbGlkZXIuc3RvcHM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVyU3RvcHMoc3RvcHMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWZ0ZXJUcmFuc3BhcmVuY3lTbGlkZXJDcmVhdGUobm9kZSkge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwYXJlbmN5U2xpZGVyLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBub2RlLmFwcGVuZChkaXZOb2RlKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNwYXJlbmN5U2xpZGVyLmNvbnRhaW5lciA9IGRpdk5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlVG9nZ2xlKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IHNlY3Rpb25Ob2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBpZiAoKHNlY3Rpb25Ob2RlLm9wZW4gJiYgb3BhY2l0eVZpc1ZhcikgfHwgKCFzZWN0aW9uTm9kZS5vcGVuICYmICFvcGFjaXR5VmlzVmFyKSkge1xuICAgICAgICAgICAgLy8gbm90aGluZyBoYXMgY2hhbmdlZDsgaGFwcGVucyB3aGVuIHdlIGxlYXZlXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wYWNpdHlWaXNWYXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGF1dGhPcGFjaXR5VmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICAgICAgdGhpcy5sYXN0U2V0dGluZ3Mub3BhY2l0eVZpc1ZhciA9IG9wYWNpdHlWaXNWYXI7XG4gICAgICAgICAgICB0aGlzLmxhc3RTZXR0aW5ncy5hdXRoT3BhY2l0eVZpc1ZhciA9IGF1dGhPcGFjaXR5VmlzVmFyO1xuICAgICAgICAgICAgcmVtb3ZlVmlzVmFyKFwib3BhY2l0eVwiLCBsYXllcik7XG4gICAgICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGZhbHNlO1xuICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RTZXR0aW5ncy5vcGFjaXR5VmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzID0gcmVuZGVyZXIudmlzdWFsVmFyaWFibGVzIHx8IFtdO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHRoaXMubGFzdFNldHRpbmdzLm9wYWNpdHlWaXNWYXIpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmF1dGhvcmluZ0luZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvIHx8IG5ldyBtb2R1bGVzLkF1dGhvcmluZ0luZm8oe30pO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxhc3RTZXR0aW5ncy5hdXRoT3BhY2l0eVZpc1Zhcikge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcyA9IHJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHRoaXMubGFzdFNldHRpbmdzLmF1dGhPcGFjaXR5VmlzVmFyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLmJsb2NrTm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBwaWNrIGZpcnN0IGZpZWxkIGJ5IGRlZmF1bHQgaWYgYWN0aXZlXG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3ROdW1GaWVsZCA9IGdldEZpcnN0TnVtYmVyRmllbGQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGZpcnN0TnVtRmllbGQgPyBmaXJzdE51bUZpZWxkLmxheWVyRmllbGQubmFtZSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRPcGFjaXR5VmlzdWFsVmFyaWFibGUoe1xuICAgICAgICAgICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlRmllbGRUeXBlOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVJlc2V0U2xpZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3QgZmllbGRJbmZvID0ge1xuICAgICAgICAgICAgZmllbGQ6IG9wYWNpdHlWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICBleHByZXNzaW9uOiBvcGFjaXR5VmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gb3BhY2l0eVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGNyZWF0ZU9wYWNpdHlWaXN1YWxWYXJpYWJsZSh7XG4gICAgICAgICAgICBmaWVsZEluZm9zOiBbZmllbGRJbmZvXSxcbiAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmVtb3ZlVmlzVmFyKFwib3BhY2l0eVwiLCBsYXllcik7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnN0YXRpc3RpY3MgJiZcbiAgICAgICAgICAgICAgICBpc0RlZmluZWQocmVzdWx0LnN0YXRpc3RpY3MubWluKSAmJlxuICAgICAgICAgICAgICAgIGlzRGVmaW5lZChyZXN1bHQuc3RhdGlzdGljcy5tYXgpICYmXG4gICAgICAgICAgICAgICAgcmVzdWx0LnN0YXRpc3RpY3MubWluIDw9IHJlc3VsdC5zdGF0aXN0aWNzLm1heCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IHJlc3VsdC5zdGF0aXN0aWNzO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCByZXN1bHQuc3RhdGlzdGljcywgcmVzdWx0LnN0YXRpc3RpY3MubWluLCByZXN1bHQuc3RhdGlzdGljcy5tYXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoKChfYSA9IHJlc3VsdC5zdGF0aXN0aWNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY291bnQpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gZW1wdHkgbGF5ZXJcbiAgICAgICAgICAgICAgICBjb25zdCBbZGVmYXVsdE1pbiwgZGVmYXVsdE1heF0gPSBnZXREZWZhdWx0RGF0YVJhbmdlKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0ge1xuICAgICAgICAgICAgICAgICAgICBtaW46IGRlZmF1bHRNaW4sXG4gICAgICAgICAgICAgICAgICAgIG1heDogZGVmYXVsdE1heCxcbiAgICAgICAgICAgICAgICAgICAgYXZnOiAoZGVmYXVsdE1heCAtIGRlZmF1bHRNaW4pIC8gMixcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG1lZGlhbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBzdGRkZXY6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgc3VtOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHZhcmlhbmNlOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyB8fCBbXTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHJlc3VsdC52aXN1YWxWYXJpYWJsZSk7XG4gICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mbyB8fCBuZXcgbW9kdWxlcy5BdXRob3JpbmdJbmZvKHt9KTtcbiAgICAgICAgICAgIHJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcy5wdXNoKHJlc3VsdC5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlc1swXSk7XG4gICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgc2Nyb2xsSW50b1ZpZXcodGhpcy5ibG9ja05vZGUpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVab29tU2xpZGVyKHpvb21lZCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGlmICh0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9PT0gc3RhdHVzLklOX1BST0dSRVNTKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLnNsaWRlclpvb21lZCA9IGlzRGVmaW5lZCh6b29tZWQpID8gem9vbWVkIDogIXRoaXMuc2xpZGVyWm9vbWVkO1xuICAgICAgICBjb25zdCB7IHNsaWRlclpvb21lZCwgc3RhdGlzdGljcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCBhdXRoT3BhY2l0eVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3Qgem9vbU9wdGlvbnMgPSBzbGlkZXJab29tZWRcbiAgICAgICAgICAgID8gZ2V0Wm9vbU9wdGlvbnMob3BhY2l0eVZpc1Zhci5zdG9wcywgKF9hID0gYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBzdGF0aXN0aWNzLm1pbiwgKF9iID0gYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBzdGF0aXN0aWNzLm1heClcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZChvcGFjaXR5VmlzVmFyLmZpZWxkKTtcbiAgICAgICAgdGhpcy5nZXRIaXN0b2dyYW0oe1xuICAgICAgICAgICAgZmllbGQ6IG9wYWNpdHlWaXNWYXIuZmllbGQsXG4gICAgICAgICAgICBleHByZXNzaW9uOiBvcGFjaXR5VmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgIGV4cHJlc3Npb25UaXRsZTogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb25UaXRsZSxcbiAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGQgPyBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICB9LCBvcGFjaXR5VmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZCwgc3RhdGlzdGljcywgKHpvb21PcHRpb25zICYmIHpvb21PcHRpb25zLm1pbikgfHwgKChfYyA9IGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5taW5TbGlkZXJWYWx1ZSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogc3RhdGlzdGljcy5taW4pLCAoem9vbU9wdGlvbnMgJiYgem9vbU9wdGlvbnMubWF4KSB8fCAoKF9kID0gYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBzdGF0aXN0aWNzLm1heCkpO1xuICAgIH1cbiAgICBoYW5kbGVSYW5nZUNoYW5nZShldmVudCwgdHlwZSkge1xuICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBsZXQgdmFsdWUgPSBub2RlLnZhbHVlID8gcGFyc2VJbnQobm9kZS52YWx1ZSkgOiAwO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgaWYgKHZhbHVlIDwgMCkge1xuICAgICAgICAgICAgdmFsdWUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMTAwKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IDEwMDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdG9wcyA9IG9wYWNpdHlWaXNWYXIuc3RvcHM7XG4gICAgICAgIGxldCBuZXdWYWwgPSBNYXRoLnJvdW5kKCgxIC0gdmFsdWUgLyAxMDApICogMTAwKSAvIDEwMDtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiaGlnaFwiKSB7XG4gICAgICAgICAgICBzdG9wc1sxXS5vcGFjaXR5ID0gbmV3VmFsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gXCJsb3dcIlxuICAgICAgICAgICAgc3RvcHNbMF0ub3BhY2l0eSA9IG5ld1ZhbDtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICB9XG4gICAgaGFuZGxlSW5jbHVkZUluTGVnZW5kVG9nZ2xlKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3QgbGVnZW5kT3B0aW9ucyA9IG9wYWNpdHlWaXNWYXIubGVnZW5kT3B0aW9ucztcbiAgICAgICAgaWYgKGxlZ2VuZE9wdGlvbnMgJiYgbGVnZW5kT3B0aW9ucy5zaG93TGVnZW5kID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKGxlZ2VuZE9wdGlvbnMgJiYgbGVnZW5kT3B0aW9ucy50aXRsZSkge1xuICAgICAgICAgICAgICAgIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5VmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvcGFjaXR5VmlzVmFyLmxlZ2VuZE9wdGlvbnMgPSBsZWdlbmRPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgb3BhY2l0eVZpc1Zhci5sZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICB1cGRhdGVSZW5kZXJlclN0b3BzKHN0b3BzKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCBhdXRoT3BhY2l0eVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgb3BhY2l0eVZpc1Zhci5zdG9wcyA9IHN0b3BzO1xuICAgICAgICB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci5zdG9wcyA9IHN0b3BzO1xuICAgICAgICB0aGlzLmN1cnJlbnRTdG9wVmFsdWVzID0gb3BhY2l0eVZpc1Zhci5zdG9wcy5tYXAoKHN0b3ApID0+IHN0b3AudmFsdWUpO1xuICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKG9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgb3BhY2l0eVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3BhY2l0eVZpc1Zhci5zdG9wcywgYXV0aE9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgYXV0aE9wYWNpdHlWaXNWYXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlLCBhdXRoT3BhY2l0eVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoT3BhY2l0eVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aE9wYWNpdHlWaXNWYXIubWF4U2xpZGVyVmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5zbGlkZXJab29tZWQpIHtcbiAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghem9vbU9wdGlvbnMgfHxcbiAgICAgICAgICAgIHpvb21PcHRpb25zLm1pbk1heFNhbWUgfHxcbiAgICAgICAgICAgICghaXNEZWZpbmVkKHpvb21PcHRpb25zLm1pbikgJiYgIWlzRGVmaW5lZCh6b29tT3B0aW9ucy5tYXgpKSkge1xuICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0T3BhY2l0eVZpc3VhbFZhcmlhYmxlKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhpc3RvZ3JhbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oaXN0b2dyYW1TdGF0dXMgPSBzdGF0dXMuTUlTU0lORztcbiAgICAgICAgdGhpcy5zbGlkZXJab29tZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLklOX1BST0dSRVNTO1xuICAgICAgICBpZiAoW1wicHJlZG9taW5hbmNlXCIsIFwicHJlZG9taW5hbmNlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTEpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXJGcm9tRXhpc3Rpbmcoe1xuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlT3BhY2l0eVZhcmlhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImNyZWF0ZVByZWRvbWluYW5jZVJlbmRlcmVyRnJvbUV4aXN0aW5nLXJlc3VsdFwiLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIGFwcGx5UmVuZGVyZXIocmVzdWx0LnJlbmRlcmVyLCBsYXllcik7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRTdGF0aXN0aWNzKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLmJsb2NrTm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1N5bWJvbFRyYW5zcGFyZW5jeUVycm9yLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVycm9yXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlT3BhY2l0eVZpc3VhbFZhcmlhYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvczogW2ZpZWxkSW5mb10sXG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6YXRpb25GaWVsZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJjcmVhdGVPcGFjaXR5VmlzdWFsVmFyaWFibGUtcmVzdWx0XCIsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlVmlzVmFyKFwib3BhY2l0eVwiLCBsYXllcik7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0aXN0aWNzICYmXG4gICAgICAgICAgICAgICAgICAgIGlzRGVmaW5lZChyZXN1bHQuc3RhdGlzdGljcy5taW4pICYmXG4gICAgICAgICAgICAgICAgICAgIGlzRGVmaW5lZChyZXN1bHQuc3RhdGlzdGljcy5tYXgpICYmXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiA8PSByZXN1bHQuc3RhdGlzdGljcy5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0gcmVzdWx0LnN0YXRpc3RpY3M7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEhpc3RvZ3JhbShmaWVsZEluZm8sIG5vcm1hbGl6YXRpb25GaWVsZCwgcmVzdWx0LnN0YXRpc3RpY3MsIHJlc3VsdC5zdGF0aXN0aWNzLm1pbiwgcmVzdWx0LnN0YXRpc3RpY3MubWF4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoKChfYSA9IHJlc3VsdC5zdGF0aXN0aWNzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY291bnQpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVtcHR5IGxheWVyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtkZWZhdWx0TWluLCBkZWZhdWx0TWF4XSA9IGdldERlZmF1bHREYXRhUmFuZ2UoZmllbGRJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0aXN0aWNzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWluOiBkZWZhdWx0TWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiBkZWZhdWx0TWF4LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZnOiAoZGVmYXVsdE1heCAtIGRlZmF1bHRNaW4pIC8gMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFuOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGRkZXY6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFuY2U6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuU1VDQ0VTUztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyB8fCBbXTtcbiAgICAgICAgICAgICAgICByZW5kZXJlci52aXN1YWxWYXJpYWJsZXMucHVzaChyZXN1bHQudmlzdWFsVmFyaWFibGUpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmF1dGhvcmluZ0luZm8gPSByZW5kZXJlci5hdXRob3JpbmdJbmZvIHx8IG5ldyBtb2R1bGVzLkF1dGhvcmluZ0luZm8oe30pO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID0gcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMgfHwgW107XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMucHVzaChyZXN1bHQuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXNbMF0pO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgc2Nyb2xsSW50b1ZpZXcodGhpcy5ibG9ja05vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgICAgIC8vIGNhbid0IHRvZ2dsZSBvbiB3aXRob3V0IGFuIG9wYWNpdHlWaXNWYXJcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrU2VjdGlvbk5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldFN0YXRpc3RpY3MoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGxldCBub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGxldCBvcGFjaXR5VmlzVmFyO1xuICAgICAgICBsZXQgbWluO1xuICAgICAgICBsZXQgbWF4O1xuICAgICAgICBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGlmICghb3BhY2l0eVZpc1Zhcikge1xuICAgICAgICAgICAgLy8gbm8gdHJhbnNwYXJlbmN5IHNldFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQob3BhY2l0eVZpc1Zhci5maWVsZCk7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiBvcGFjaXR5VmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb24sXG4gICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IG9wYWNpdHlWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgbm9ybWFsaXphdGlvbkZpZWxkID0gb3BhY2l0eVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGNvbnN0IGF1dGhPcGFjaXR5VmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBtaW4gPSBhdXRoT3BhY2l0eVZpc1ZhciA9PT0gbnVsbCB8fCBhdXRoT3BhY2l0eVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aE9wYWNpdHlWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgIG1heCA9IGF1dGhPcGFjaXR5VmlzVmFyID09PSBudWxsIHx8IGF1dGhPcGFjaXR5VmlzVmFyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdXRoT3BhY2l0eVZpc1Zhci5tYXhTbGlkZXJWYWx1ZTtcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzU3RhdHVzID0gc3RhdHVzLklOX1BST0dSRVNTO1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGlzdGljcyAmJiBsYXllcikge1xuICAgICAgICAgICAgbW9kdWxlc1xuICAgICAgICAgICAgICAgIC5zdW1tYXJ5U3RhdGlzdGljcyh7XG4gICAgICAgICAgICAgICAgbGF5ZXIsXG4gICAgICAgICAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRJbmZvLmZpZWxkLFxuICAgICAgICAgICAgICAgIHZhbHVlRXhwcmVzc2lvbjogZmllbGRJbmZvLmV4cHJlc3Npb24sXG4gICAgICAgICAgICAgICAgbm9ybWFsaXphdGlvbkZpZWxkLFxuICAgICAgICAgICAgICAgIGZvckJpbm5pbmc6IFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKChzdGF0aXN0aWNzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRpc3RpY3MuY291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmllbGQgaGFzIG5vIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHVwIHNvbWUgYmFzaWMgc3RhdGlzdGljcyBzbyB3ZSBjYW4gc2hvdyBhIHNsaWRlclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBbZGVmYXVsdE1pbiwgZGVmYXVsdE1heF0gPSBnZXREZWZhdWx0RGF0YVJhbmdlKGZpZWxkSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlIHx8IGRlZmF1bHRNaW47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlIHx8IGRlZmF1bHRNYXg7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmc6IChtYXggKyBtaW4pIC8gMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFuOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGRkZXY6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFuY2U6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5GQUlMRUQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIWlzRGVmaW5lZChzdGF0aXN0aWNzLmF2ZykgfHxcbiAgICAgICAgICAgICAgICAgICAgIWlzRGVmaW5lZChzdGF0aXN0aWNzLm1pbikgfHxcbiAgICAgICAgICAgICAgICAgICAgIWlzRGVmaW5lZChzdGF0aXN0aWNzLm1heCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGlzdGljcyB1bnVzYWJsZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MgPSB2YWxpZGF0ZU1pbk1heChzdGF0aXN0aWNzKTtcbiAgICAgICAgICAgICAgICBtaW4gPSBzdGF0aXN0aWNzLm1pbjtcbiAgICAgICAgICAgICAgICBtYXggPSBzdGF0aXN0aWNzLm1heDtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3MgPSBzdGF0aXN0aWNzO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljc1N0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCk7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yLXN1bW1hcnlTdGF0aXN0aWNzXCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRpc3RpY3NTdGF0dXMgPSBzdGF0dXMuRkFJTEVEO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIHN0YXRpc3RpY3MgPSBzdGF0aXN0aWNzIHx8IHRoaXMuc3RhdGlzdGljcztcbiAgICAgICAgaWYgKCFzdGF0aXN0aWNzIHx8IHN0YXRpc3RpY3MuY291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5JTl9QUk9HUkVTUztcbiAgICAgICAgbW9kdWxlc1xuICAgICAgICAgICAgLmhpc3RvZ3JhbSh7XG4gICAgICAgICAgICBsYXllcjogbGF5ZXIsXG4gICAgICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgIHZhbHVlRXhwcmVzc2lvbjogZmllbGRJbmZvLmV4cHJlc3Npb24sXG4gICAgICAgICAgICBudW1CaW5zOiA1MCxcbiAgICAgICAgICAgIG1pblZhbHVlOiBpc0RlZmluZWQobWluKSA/IG1pbiA6IHN0YXRpc3RpY3MubWluLFxuICAgICAgICAgICAgbWF4VmFsdWU6IGlzRGVmaW5lZChtYXgpID8gbWF4IDogc3RhdGlzdGljcy5tYXgsXG4gICAgICAgICAgICBub3JtYWxpemF0aW9uRmllbGQsXG4gICAgICAgICAgICBmb3JCaW5uaW5nOiBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiAoKF9hID0gbGF5ZXIuZmVhdHVyZVJlZHVjdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpID09PSBcImJpbm5pbmdcIlxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGhpc3RvZ3JhbSkgPT4ge1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcInN1Y2Nlc3MtaGlzdG9ncmFtXCIsIGhpc3RvZ3JhbSwgbWluLCBtYXgpO1xuICAgICAgICAgICAgLy9pc0RlZmluZWQobWluKSA/IG1pbiA6IHN0YXRpc3RpY3MubWluLFxuICAgICAgICAgICAgLy9pc0RlZmluZWQobWF4KSA/IG1heCA6IHN0YXRpc3RpY3MubWF4LFxuICAgICAgICAgICAgdGhpcy5oaXN0b2dyYW0gPSBoaXN0b2dyYW07XG4gICAgICAgICAgICB0aGlzLmhpc3RvZ3JhbVN0YXR1cyA9IHN0YXR1cy5TVUNDRVNTO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3ItaGlzdG9ncmFtXCIsIGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9ncmFtU3RhdHVzID0gc3RhdHVzLkZBSUxFRDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9uTWluTWF4Q2hhbmdlKG1pbiwgbWF4LCBjaGFuZ2luZykge1xuICAgICAgICBjb25zdCB7IHN0YXRpc3RpY3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3Qgb3BhY2l0eVZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCBhdXRoT3BhY2l0eVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKSB8fCB7fTtcbiAgICAgICAgLy8gdXBkYXRlIG9ubHkgdGhlIGxhYmVsIHRoYXQgdGhlIHVzZXIgaXMgY2hhbmdpbmdcbiAgICAgICAgY2hhbmdpbmcgPT09IFwibWluXCJcbiAgICAgICAgICAgID8gKGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlID0gbWluKVxuICAgICAgICAgICAgOiAoYXV0aE9wYWNpdHlWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSBtYXgpO1xuICAgICAgICAvLyBkZXRlcm1pbmUgaWYgbGFiZWwgdXBkYXRlcyBtZXJpdCB6b29taW5nIG9yIG5vdFxuICAgICAgICBjb25zdCB6b29tT3B0aW9ucyA9IGdldFpvb21PcHRpb25zKG9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgb3BhY2l0eVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3BhY2l0eVZpc1Zhci5zdG9wcywgYXV0aE9wYWNpdHlWaXNWYXIubWluU2xpZGVyVmFsdWUsIGF1dGhPcGFjaXR5VmlzVmFyLm1heFNsaWRlclZhbHVlKTtcbiAgICAgICAgLy8gaGFuZGxlcyB6b29tIGJ1dHRvbiBkaXNwbGF5IGZvciB0cmFuc3BhcmVuY3kgc2xpZGVyXG4gICAgICAgIGlmICh0aGlzLnNsaWRlclpvb21lZCkge1xuICAgICAgICAgICAgdGhpcy56b29tQnV0dG9uTm9kZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF6b29tT3B0aW9ucyB8fFxuICAgICAgICAgICAgem9vbU9wdGlvbnMubWluTWF4U2FtZSB8fFxuICAgICAgICAgICAgKCFpc0RlZmluZWQoem9vbU9wdGlvbnMubWluKSAmJiAhaXNEZWZpbmVkKHpvb21PcHRpb25zLm1heCkpKSB7XG4gICAgICAgICAgICB0aGlzLnpvb21CdXR0b25Ob2RlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuem9vbUJ1dHRvbk5vZGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyB6b29tIGFkanVzdG1lbnRcbiAgICAgICAgaWYgKHRoaXMuc2xpZGVyWm9vbWVkKSB7XG4gICAgICAgICAgICB0aGlzLmFkanVzdGVkWm9vbU9wdGlvbnMgPSB0aGlzLnRyYW5zcGFyZW5jeVNsaWRlci56b29tT3B0aW9ucztcbiAgICAgICAgICAgIGlmIChjaGFuZ2luZyA9PT0gXCJtaW5cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0ZWRab29tT3B0aW9ucy5taW4gPSBtaW47XG4gICAgICAgICAgICAgICAgdGhpcy56b29tQWRqdXN0bWVudCA9IFwibWluXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkanVzdGVkWm9vbU9wdGlvbnMubWF4ID0gbWF4O1xuICAgICAgICAgICAgICAgIHRoaXMuem9vbUFkanVzdG1lbnQgPSBcIm1heFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQob3BhY2l0eVZpc1Zhci5maWVsZCk7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiBvcGFjaXR5VmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb24sXG4gICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IG9wYWNpdHlWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXphdGlvbkZpZWxkID0gb3BhY2l0eVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIHRoaXMuZ2V0SGlzdG9ncmFtKGZpZWxkSW5mbywgbm9ybWFsaXphdGlvbkZpZWxkLCBzdGF0aXN0aWNzLCBtaW4sIG1heCk7XG4gICAgICAgIGlmIChtaW4gPT09IGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlICYmIG1heCA9PT0gYXV0aE9wYWNpdHlWaXNWYXIubWF4U2xpZGVyVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlWmlnemFnQ2xpY2sobmV3VmFsdWUpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBzdGF0aXN0aWNzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3QgYXV0aE9wYWNpdHlWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGQob3BhY2l0eVZpc1Zhci5maWVsZCk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6YXRpb25GaWVsZCA9IG9wYWNpdHlWaXNWYXIgPT09IG51bGwgfHwgb3BhY2l0eVZpc1ZhciA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3BhY2l0eVZpc1Zhci5ub3JtYWxpemF0aW9uRmllbGQ7XG4gICAgICAgIGNvbnN0IGZpZWxkSW5mbyA9IHtcbiAgICAgICAgICAgIGZpZWxkOiBvcGFjaXR5VmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogb3BhY2l0eVZpc1Zhci52YWx1ZUV4cHJlc3Npb24sXG4gICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IG9wYWNpdHlWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUsXG4gICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IGZpZWxkID8gZmllbGQuc2ltcGxlRmllbGRUeXBlIDogc2ltcGxlRmllbGRUeXBlcy5OVU1CRVJcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRIaXN0b2dyYW0oZmllbGRJbmZvLCBub3JtYWxpemF0aW9uRmllbGQsIHN0YXRpc3RpY3MsIChfYSA9IG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXdWYWx1ZS5taW4pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGF1dGhPcGFjaXR5VmlzVmFyLm1pblNsaWRlclZhbHVlLCAoX2IgPSBuZXdWYWx1ZSA9PT0gbnVsbCB8fCBuZXdWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV3VmFsdWUubWF4KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBhdXRoT3BhY2l0eVZpc1Zhci5tYXhTbGlkZXJWYWx1ZSk7XG4gICAgICAgIGlmICghbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVyWm9vbWVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc1NtYXJ0TWFwcGluZ1RyYW5zcGFyZW5jeS5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1RyYW5zcGFyZW5jeUNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nQmFja2dyb3VuZFN5bWJvbCBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19iYWNrZ3JvdW5kX3N5bWJvbCwgQXJjZ2lzU21hcnRNYXBwaW5nRGVmYXVsdFN5bWJvbCBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19kZWZhdWx0X3N5bWJvbCwgQXJjZ2lzU21hcnRNYXBwaW5nTWV0aG9kQnV0dG9uIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX21ldGhvZF9idXR0b24sIEFyY2dpc1NtYXJ0TWFwcGluZ1JvdGF0aW9uIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3JvdGF0aW9uLCBBcmNnaXNTbWFydE1hcHBpbmdUaGVtZUJ1dHRvbiBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ190aGVtZV9idXR0b24sIEFyY2dpc1NtYXJ0TWFwcGluZ1RyYW5zcGFyZW5jeSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ190cmFuc3BhcmVuY3kgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctYmFja2dyb3VuZC1zeW1ib2xfNi5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHMgYXMgc21hcnRNYXBwaW5nU3RhdGUgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5cbmZ1bmN0aW9uIGFkZERhdGVGb3JtYXRGdW5jdGlvbnMoY29uZmlnLCB0aW1lWm9uZSkge1xuICAgIGNvbmZpZy5sYWJlbEZvcm1hdEZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBnZXREYXRlRGlzcGxheVN0cmluZyh2YWx1ZSwgdGltZVpvbmUsIFwic2hvcnQtZGF0ZVwiKTtcbiAgICB9O1xuICAgIGNvbmZpZy5pbnB1dEZvcm1hdEZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBnZXREYXRlRGlzcGxheVN0cmluZyh2YWx1ZSwgdGltZVpvbmUsIFwic2hvcnQtZGF0ZVwiKTtcbiAgICB9O1xuICAgIGNvbmZpZy5pbnB1dFBhcnNlRnVuY3Rpb24gPSAodmFsdWUpID0+IHtcbiAgICAgICAgcmV0dXJuIG1hcFRaVG9VVEMoRGF0ZS5wYXJzZSh2YWx1ZSksIHRpbWVab25lKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gdXRjVG9EYXRlUGlja2VyKHZhbHVlLCB0aW1lWm9uZSkge1xuICAgIC8vIGRhdGUgaXMgaW4gVVRDXG4gICAgLy8gd2UgbmVlZCBhIG1hcCB0aW1lem9uZVxuICAgIGxldCBzdHI7XG4gICAgaWYgKCF0aW1lWm9uZSB8fCB0aW1lWm9uZSA9PT0gXCJzeXN0ZW1cIikge1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbWFwRGF0ZVN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmUgfSk7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKG5ldyBEYXRlKG1hcERhdGVTdHIpLmdldFRpbWUoKSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJ1dGNUb0RhdGVQaWNrZXJcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgc3RyKTtcbiAgICByZXR1cm4gc3RyO1xufVxuZnVuY3Rpb24gdXRjVG9UaW1lUGlja2VyKHZhbHVlLCB0aW1lWm9uZSwgYWRkU2Vjb25kcykge1xuICAgIC8vIGRhdGUgaXMgaW4gVVRDXG4gICAgLy8gd2UgbmVlZCBhIG1hcCB0aW1lem9uZVxuICAgIGxldCBzdHI7XG4gICAgaWYgKCF0aW1lWm9uZSB8fCB0aW1lWm9uZSA9PT0gXCJzeXN0ZW1cIikge1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBzdHIgPSBuZXcgRGF0ZSh2YWx1ZSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbWFwRGF0ZVN0ciA9IG5ldyBEYXRlKHZhbHVlKS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmUgfSk7XG4gICAgICAgIHN0ciA9IG5ldyBEYXRlKG5ldyBEYXRlKG1hcERhdGVTdHIpLmdldFRpbWUoKSAtIGRpZmYgKiA2MDAwMCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgLy8gc3RyID0gXCIyMDIzLTA5LTIwVDEzOjA2OjAwLjAwMFpcIlxuICAgIHN0ciA9IGFkZFNlY29uZHMgPyBzdHIuc3Vic3RyaW5nKDExLCAxOSkgOiBzdHIuc3Vic3RyaW5nKDExLCAxNik7XG4gICAgLy8gY29uc29sZS5sb2coXCJ1dGNUb1RpbWVQaWNrZXJcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgc3RyKTtcbiAgICByZXR1cm4gc3RyO1xufVxuZnVuY3Rpb24gZGF0ZVBpY2tlclRvVVRDKGRhdGVTdHJpbmcsIHRpbWVab25lKSB7XG4gICAgLy8gZGF0ZSBpcyBpbiBtYXAgdGltZXpvbmVcbiAgICAvLyB3ZSBuZWVkIGEgVVRDIFVOSVggdGltZXN0YW1wXG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKTtcbiAgICAvLyB0aGlzIGlzIHJlYWQgYXMgY3VycmVudCB0aW1lOyB0b0lTT1N0cmluZygpIHdvdWxkIHJlYXR1cm4gVVRDIHRpbWUgKGUuZy4gKzcgaG91cnMgZnJvbSBwYWNpZmljKVxuICAgIC8vIGZpeCB0aGUgb2Zmc2V0XG4gICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpIC0gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApO1xuICAgIC8vIGRhdGUgbm93IGNvbnRhaW5zIHRoZSB1c2VyJ3MgZW50ZXJlZCB0aW1lXG4gICAgbGV0IHZhbHVlO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgLy8gYWRkIGRpZmZlcmVuY2UgYmV0d2VlbiBsb2NhbCB0aW1lIGFuZCBVVENcbiAgICAgICAgdmFsdWUgPSBkYXRlLmdldFRpbWUoKSArIGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aW1lWm9uZSA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgLy8gdGFrZSB3aGF0IHlvdSBnZXRcbiAgICAgICAgdmFsdWUgPSBkYXRlLmdldFRpbWUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIGFkZCBkaWZmZXJlbmNlIGJldHdlZW4gbWFwIHRpbWUgYW5kIFVUQ1xuICAgICAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoZGF0ZS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHsgdGltZVpvbmU6IFwidXRjXCIgfSkpLmdldFRpbWUoKSAtXG4gICAgICAgICAgICBuZXcgRGF0ZShkYXRlLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZSB9KSkuZ2V0VGltZSgpO1xuICAgICAgICB2YWx1ZSA9IGRhdGUuZ2V0VGltZSgpICsgZGlmZjtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJkYXRlUGlja2VyVG9VVENcIiwgZGF0ZS50b0lTT1N0cmluZygpLCBcIiAtPiBcIiwgbmV3IERhdGUodmFsdWUpLnRvSVNPU3RyaW5nKCkpO1xuICAgIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIG1hcFRaVG9VVEModmFsdWUsIHRpbWVab25lKSB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIC8vIHZhbHVlIGlzIGluIG1hcCB0aW1lem9uZVxuICAgIC8vIHdlIG5lZWQgYSBVVEMgdGltZXN0YW1wXG4gICAgbGV0IG5ld1ZhbHVlO1xuICAgIGlmICghdGltZVpvbmUgfHwgdGltZVpvbmUgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgLy8gYWRkIGRpZmZlcmVuY2UgYmV0d2VlbiBsb2NhbCB0aW1lIGFuZCBVVENcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWUgKyBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZVpvbmUgPT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIC8vIHRha2Ugd2hhdCB5b3UgZ2V0XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBhZGQgZGlmZmVyZW5jZSBiZXR3ZWVuIG1hcCB0aW1lIGFuZCBVVENcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBuZXcgRGF0ZShkYXRlLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwgeyB0aW1lWm9uZTogXCJ1dGNcIiB9KSkuZ2V0VGltZSgpIC1cbiAgICAgICAgICAgIG5ldyBEYXRlKGRhdGUudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7IHRpbWVab25lIH0pKS5nZXRUaW1lKCk7XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWUgKyBkaWZmO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIm1hcFRaVG9VVENcIiwgdmFsdWUsIFwiIC0gXCIsIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpLCBcIiAtIFwiLCBuZXcgRGF0ZShuZXdWYWx1ZSkudG9JU09TdHJpbmcoKSk7XG4gICAgcmV0dXJuIG5ld1ZhbHVlO1xufVxuZnVuY3Rpb24gZ2V0RGF0ZURpc3BsYXlTdHJpbmcodmFsdWUsIHRpbWVab25lLCBkYXRlRm9ybWF0KSB7XG4gICAgY29uc3QgeyBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBsZXQgc3RyO1xuICAgIGlmICh0aW1lWm9uZSA9PT0gXCJ1bmtub3duXCIpIHtcbiAgICAgICAgc3RyID0gbW9kdWxlcy5pbnRsLmZvcm1hdERhdGUodmFsdWUsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbW9kdWxlcy5pbnRsLmNvbnZlcnREYXRlRm9ybWF0VG9JbnRsT3B0aW9ucyhkYXRlRm9ybWF0IHx8IFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpKSwgeyB0aW1lWm9uZTogXCJ1dGNcIiwgdGltZVpvbmVOYW1lOiBcInNob3J0T2Zmc2V0XCIgfSkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8ga25vd24gaXNzdWVzIHdpdGggZm9ybWF0dGluZyBpdC1DSFxuICAgICAgICBzdHIgPSBtb2R1bGVzLmludGwuZm9ybWF0RGF0ZSh2YWx1ZSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBtb2R1bGVzLmludGwuY29udmVydERhdGVGb3JtYXRUb0ludGxPcHRpb25zKGRhdGVGb3JtYXQgfHwgXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIikpLCB7IHRpbWVab25lIH0pKTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coXCJnZXREYXRlRGlzcGxheVN0cmluZ1wiLCB2YWx1ZSwgXCIgLSBcIiwgbmV3IERhdGUodmFsdWUpLnRvSVNPU3RyaW5nKCksIFwiIC0+IFwiLCBzdHIpO1xuICAgIHJldHVybiBzdHI7XG59XG5cbmV4cG9ydCB7IGFkZERhdGVGb3JtYXRGdW5jdGlvbnMgYXMgYSwgdXRjVG9UaW1lUGlja2VyIGFzIGIsIGRhdGVQaWNrZXJUb1VUQyBhcyBkLCB1dGNUb0RhdGVQaWNrZXIgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRlLTc5YzdkOTNjLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==