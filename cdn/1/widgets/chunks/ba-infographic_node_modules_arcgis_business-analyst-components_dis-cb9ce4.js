"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-cb9ce4"],{

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-selector_2.entry.js":
/*!********************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-selector_2.entry.js ***!
  \********************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_infographic_selector: () => (/* binding */ ArcgisInfographicSelector),
/* harmony export */   arcgis_infographic_tree: () => (/* reexport safe */ _arcgis_infographic_tree_b71f4b45_js__WEBPACK_IMPORTED_MODULE_0__.A)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");
/* harmony import */ var _arcgis_infographic_tree_b71f4b45_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arcgis-infographic-tree-b71f4b45.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-b71f4b45.js");






const arcgisInfographicSelectorCss = ":host{display:block}.infographicSelectorOuter{position:relative;width:100%;height:30px;justify-content:left;align-items:center}.selector-label-placeholder{color:gray}.infoSel-magnify{position:absolute;top:2px;left:100px;height:32px;width:32px;background-color:blue}.arcSel-combo{width:100%;height:32px;font-size:11pt;color:darkslategray}.arcSel-reports{width:calc(100% - 16px);height:100%;overflow:auto}.selector-dropdown-label{position:absolute;top:7px;left:6px;width:calc(100% - 35px);height:25px;font-size:10.5pt;font-weight:300;text-align:left;text-overflow:ellipsis;border-radius:0px;overflow:hidden;white-space:nowrap;cursor:pointer}.selector-dropdown{position:relative;height:32px;width:100%;cursor:pointer}.selector-dropdown-arrow{position:absolute;top:9px;right:7px;width:12px;height:12px;transition:all 0.15s 0.15s;transform:rotate(0)}.selector-drop-open{transform:rotate(180deg)}calcite-popover ::-webkit-scrollbar{background-color:var(--calcite-ui-background-1);width:8px;height:8px}calcite-popover ::-webkit-scrollbar-thumb{background-color:var(--calcite-ui-foreground-3)}calcite-popover ::-webkit-scrollbar-track{background-color:transparent}calcite-popover ::-webkit-scrollbar-corner{background-color:var(--calcite-ui-background-1);width:8px;height:8px}";

const ArcgisInfographicSelector = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.r)(this, hostRef);
    this.infographicSelectorPopupOpened = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "infographicSelectorPopupOpened", 6);
    this.infographicSelectorPopupClosed = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "infographicSelectorPopupClosed", 6);
    this._localeSettings = {};
    this._popoverIsOpen = false;
    this._idPrefix = 'arcgis-infographic-selector-';
    this._elementIds = {}; // button
    this._idButtonPrefix = 'selector-dropdown-button-';
    this._idDropdownArrowPrefix = 'selector-dropdown-arrow-';
    this._idDropdownLabelPrefix = 'selector-dropdown-label-';
    this._idReportListPrefix = 'selector-report-list-';
    this._idPopoverPrefix = 'selector-popover-';
    this._idPopoverContentPrefix = 'selector-popover-content-';
    this._report = { id: null, name: '' };
    this.baseConfig = new _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a('selector', this, this.onUpdateUI);
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.announceVersion();
    this.langCode = this.langCode || 'en-us';
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.B._initialize(this.langCode);
    this.setLocaleStrings();
    this.sourceCountry = this.sourceCountry || 'US';
    this.baseConfig.updateLocaleSettings({ language: this.langCode, country: this.sourceCountry });
  }
  onEnvChanged() {
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_3__.E.setEnvironment(this.env);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ env: this.env }, null);
    }
  }
  onTokenChanged() {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Log('selector: token changed', this.token);
    const t = this.token;
    const u = this.baseConfig?.config?.username;
    if (t && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(t) && u && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(u)) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_3__.T.setToken(u, t);
    }
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ token: this.token }, null);
    }
  }
  onUsernameChanged() {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Log('selector: username changed', this.username);
    const u = this.username;
    const t = this.baseConfig?.config?.token;
    if (t && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(t) && u && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(u)) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_3__.T.setToken(u, t);
    }
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ username: this.username }, null);
    }
  }
  onLangCodeChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ langCode: this.langCode }, null);
    }
  }
  onGeoenrichmentUrlChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ geoenrichmentUrl: this.geoenrichmentUrl }, null);
    }
  }
  onSelectedReportIdChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
  }
  onSourceCountryChanged() {
    if (this.baseConfig) {
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
  }
  onThemeChanged() {
    this.stTheme = this.theme;
    if (this.baseConfig) {
      this.baseConfig.setTheme(this.theme);
    }
  }
  onConfigChange(newConfig, oldConfig) {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Log('arcgis-infographic-selector Config changed:', newConfig);
    // let changed: string[] = [];
    if (this.baseConfig) {
      if (newConfig && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(newConfig)) {
        const newCfg = JSON.parse(newConfig);
        const oldCfg = (oldConfig && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(oldConfig)) ? JSON.parse(oldConfig) : null;
        // changed = this._base.updateConfig(newCfg, oldCfg);
        this.baseConfig.updateConfig(newCfg, oldCfg);
      }
    }
  }
  async getConfig() {
    const myCfg = this.baseConfig;
    return myCfg;
  }
  // infographic tree report id changed
  reportSelectedEventHandler(e) {
    const report = e.detail?.report;
    if (report?.id && report?.name) {
      this.selectedReportId = report.id;
      this.onSelectedReportIdChanged();
      this._hidePlaceholderAndShowLabel(report.name);
      this.hidePopover();
    }
  }
  // Default infographic selected
  defaultReportSelectedEventHandler(e) {
    const reportId = e.detail?.reportId;
    const reportName = e.detail?.name;
    if (reportId && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(reportId)) {
      this.selectedReportId = reportId;
      this.onSelectedReportIdChanged();
      if (reportName) {
        const elem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this, this._elementIds.label);
        if (elem) {
          elem.innerText = reportName;
          this.hidePopover();
        }
      }
    }
  }
  onUpdateUI() { }
  _loadInstances() {
    // this.searchPlaceholder
    if (!this._instanceId)
      this._instanceId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idPrefix).id;
    if (!this._elementIds.label)
      this._elementIds.label = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idDropdownLabelPrefix).id;
    if (!this._elementIds.button)
      this._elementIds.button = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idButtonPrefix).id;
    if (!this._elementIds.popover)
      this._elementIds.popover = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idPopoverPrefix).id;
    if (!this._elementIds.content)
      this._elementIds.content = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idPopoverContentPrefix).id;
    if (!this._elementIds.arrow)
      this._elementIds.arrow = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idDropdownArrowPrefix).id;
    if (!this._elementIds.reports)
      this._elementIds.reports = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.E.generateId(this._idReportListPrefix).id;
  }
  setLocaleStrings() {
    // console.log("setLocaleStrings() for infographic-selector")
    // example:
    // this.labels = {
    //   dropdownLocation: BaReportsLanguage.i18n('address-location-or-place'),
    //   dropdownBoundary: BaReportsLanguage.i18n('boundary-name'),
    //   dropdownAll: BaReportsLanguage.i18n('dropdown-all'),
    //   watermarkAll: BaReportsLanguage.i18n('all-placeholder'),
    //   watermarkLocation: BaReportsLanguage.i18n('enter-address-loc-or-place'),
    //   watermarkBoundary: BaReportsLanguage.i18n('enter-boundary-name')
    // }
    // this.showSearch = BaReportsLanguage.i18n('show-search')
    // this.searchPlaceholder = BaReportsLanguage.i18n('search-placeholder')
    // this.searchLabel = BaReportsLanguage.i18n('search-label')
    // this.searchAll = BaReportsLanguage.i18n('dropdown-all')
    // this.searchAllPlaceholder = BaReportsLanguage.i18n('all-placeholder')
    // this.searchPlaceholderShort = BaReportsLanguage.i18n('search-placeholder-short')
    // this.searchEnterBoundary = BaReportsLanguage.i18n('search-enter-boundary')
    // this.searchBoundary = BaReportsLanguage.i18n('search-boundary')
  }
  // Stencil lifecycle - called once after component is first connected to the DOM
  async componentWillLoad() {
    // Load props that may have values but no Watches have triggered yet
    if (this.env) {
      this.onEnvChanged();
    }
    if (this.token) {
      this.onTokenChanged();
    }
    if (this.username) {
      this.onUsernameChanged();
    }
    if (this.langCode) {
      this.onLangCodeChanged();
    }
    if (this.geoenrichmentUrl) {
      this.onGeoenrichmentUrlChanged();
    }
    if (this.sourceCountry) {
      this.onSourceCountryChanged();
    }
    if (this.config) {
      this.onConfigChange(this.config, '');
    }
    if (this.selectedReportId) {
      this.onSelectedReportIdChanged();
    }
    if (this.theme) {
      this.baseConfig.setTheme(this.theme);
    }
    else {
      this.baseConfig.setTheme('light');
    }
    this._loadInstances();
    // if (!this.baseConfig.hasSubComponents()) {
    //   // add the step's sub components for config updates
    //   this.baseConfig.addSubComponents([{name:'tree', @@@@ the subcomponent's baseConfig @@@}]);
    // }
  }
  // Stencil lifecycle - called just after component updates, but not called during first render()
  componentDidUpdate() {
    const self = this;
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
  }
  onClickDropdown(e) {
    e.stopPropagation();
    this.onUpdatePopoverSize();
    this._popoverIsOpen = !this._popoverIsOpen;
    if (this._popoverIsOpen) {
      this.infographicSelectorPopupOpened.emit();
    }
    else {
      this.infographicSelectorPopupClosed.emit();
    }
    const arrow = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.arrow);
    if (arrow) {
      if (this._popoverIsOpen) {
        arrow.classList.add('selector-drop-open');
      }
      else {
        arrow.classList.remove('selector-drop-open');
      }
    }
    return false;
  }
  // Stencil lifecycle - called once after component is fully loaded and 1st render occurred
  componentDidLoad() {
    const self = this;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Log('arcgis-infographic-selector didUpdate');
    self._loadInstances();
    function _clicked(e) {
      self.onClickDropdown.call(self, e);
    }
    // Component configuration notify sub-components is duplicated in all components
    // if (!self._base.hasSubComponents()) {
    //   // add the workflow sub components for config updates
    //   self._base.addSubComponents([self._elementIds.list]);
    //   //
    // }
    const dropButton = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(self.el, this._elementIds.button);
    if (dropButton) {
      dropButton.removeEventListener('click', _clicked);
      dropButton.addEventListener('click', _clicked);
    }
    const dropLabel = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(self.el, this._elementIds.label);
    if (dropLabel) {
      dropLabel.removeEventListener('click', _clicked);
      dropLabel.addEventListener('click', _clicked);
    }
    const dropArrow = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(self.el, this._elementIds.arrow);
    if (dropArrow) {
      dropArrow.removeEventListener('click', _clicked);
      dropArrow.addEventListener('click', _clicked);
    }
    function _onResize() {
      self.hidePopover();
      self.onUpdatePopoverSize();
    }
    window.removeEventListener('resize', _onResize);
    window.addEventListener('resize', _onResize);
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
  }
  hidePopover() {
    const popover = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popover) {
      popover.setAttribute('open', 'false');
    }
    this._popoverIsOpen = false;
    this.infographicSelectorPopupClosed.emit();
    const arrow = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.arrow);
    if (arrow) {
      arrow.classList.remove('selector-drop-open');
    }
  }
  onUpdatePopoverSize() {
    if (!this.el) {
      return;
    }
    let fullContentHt = 100;
    const minContentHt = 100;
    const maxPopoverWt = 450;
    const vpad = 36;
    const hpad = 16;
    const clientHt = document.documentElement.clientHeight;
    const clientWt = document.documentElement.clientWidth;
    const brr = this.el.getBoundingClientRect();
    const htAbove = brr.top;
    const htBelow = clientHt - (brr.top + brr.height) + window.scrollY;
    let fullContentWt = clientWt / 2;
    const wtRight = clientWt - brr.left + window.scrollX;
    if ((htBelow < minContentHt && htBelow < htAbove) ||
      (htAbove > htBelow && htAbove >= minContentHt)) {
      // popover max height = ht above if that space is larger than below
      fullContentHt = htAbove - vpad;
    }
    else {
      fullContentHt = htBelow - vpad;
    }
    if ((wtRight < brr.width && brr.left > wtRight) ||
      (brr.left > wtRight && brr.left >= brr.width)) {
      fullContentWt = brr.left - hpad;
    }
    else {
      fullContentWt = clientWt - brr.left - hpad;
    }
    fullContentWt = Math.min(maxPopoverWt, fullContentWt);
    // fullContentWt = Math.max(minPopoverWt, Math.min(wtRight - hpad, maxPopoverWt))
    const contentElem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.content);
    if (contentElem) {
      if (contentElem) {
        contentElem.style.height = fullContentHt + 'px';
      }
    }
    const popoverElem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popoverElem) {
      popoverElem.style.width = Math.min(450, fullContentWt) + 'px';
    }
    // notify tree that our size may have changed
    const tree = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this.el, this._elementIds.reports);
    if (tree) {
      tree.updateLayout();
    }
  }
  _showPlaceholder() {
    const txt = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.B.i18n('select-infographic');
    const elem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this, this._elementIds.label);
    if (elem) {
      elem.classList.add('selector-label-placeholder');
      elem.innerText = txt;
    }
  }
  _hidePlaceholderAndShowLabel(replacementText) {
    const elem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.queryElementById.call(this, this._elementIds.label);
    if (elem) {
      elem.classList.remove('selector-label-placeholder');
      if (replacementText) {
        elem.innerText = replacementText;
      }
    }
  }
  render() {
    // const cfg = this.baseConfig.config
    // let reportList: string = '{}'
    if (!this.baseConfig.config?.username || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(this.baseConfig.config.username)) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Error('ERROR: arcgis-infographic-selector missing [username]');
    }
    if (!this.baseConfig.config?.token || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.A.hasText(this.baseConfig.config.token)) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.a.Error('ERROR: arcgis-infographic-selector missing [token]');
    }
    const pText = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_2__.B.i18n('select-infographic');
    const popStyle = {
      // 'padding-right': '20px',
      'position': 'absolute',
      'top': '0px',
      'left': '0px',
      'transform': 'translate(-312px, 7px)',
      'border': 'none',
      'box-shadow': 'none',
      'width': '450px'
    };
    const popoverStyle = {
      'padding': '6px',
      'width': '300px',
      'height': '200px'
    };
    const popupCloseHandler = () => {
      this.infographicSelectorPopupClosed.emit();
    };
    return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._instanceId, class: "infographicSelectorOuter" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.button, class: "selector-dropdown" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.label, class: "selector-dropdown-label" }, pText), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("svg", { id: this._elementIds.arrow, class: "selector-dropdown-arrow", width: "24", height: "24", viewBox: "0 0 16 16", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("path", { fill: "currentColor", "fill-rule": "evenodd", stroke: "currentColor", d: "M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z", "clip-rule": "evenodd" }))), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-popover", { id: this._elementIds.popover, style: popStyle, label: "Choose infographics", "pointer-disabled": "true", "overlay-positioning": "absolute", placement: "bottom-start", "offset-skidding": "4", "auto-close": "true", "reference-element": this._elementIds.button, onCalcitePopoverClose: popupCloseHandler }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.content, style: popoverStyle }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("arcgis-infographic-tree", { id: this._elementIds.reports, portalOnlineGEProxy: this.portalOnlineGEProxy, class: "arcSel-reports", config: this.baseConfig.getConfigString() })))));
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.g)(this); }
  static get watchers() { return {
    "env": ["onEnvChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "langCode": ["onLangCodeChanged"],
    "geoenrichmentUrl": ["onGeoenrichmentUrlChanged"],
    "selectedReportId": ["onSelectedReportIdChanged"],
    "sourceCountry": ["onSourceCountryChanged"],
    "theme": ["onThemeChanged"],
    "config": ["onConfigChange"]
  }; }
};
ArcgisInfographicSelector.style = arcgisInfographicSelectorCss;



//# sourceMappingURL=arcgis-infographic-selector_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-b71f4b45.js":
/*!*****************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-tree-b71f4b45.js ***!
  \*****************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ ArcgisInfographicTree)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");
/* harmony import */ var _arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./arcgisReports-a1dc26aa.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js");





var _a;
class PreviewPopup {
  static nextCallback(f) {
    if (f) {
      this._callbackNext = f;
    }
  }
  static previousCallback(f) {
    if (f) {
      this._callbackPrev = f;
    }
  }
  static hidePopup() {
    // remove popup elements
    this._cancelTimer();
    this._removePopup();
    this._reportId = '';
  }
  static _onTimerTick() {
    this._timer = undefined;
    this.hidePopup();
  }
  static _onGoToNext() {
    if (this._callbackNext) {
      this._callbackNext(this._reportId);
    }
  }
  static _onGoToPrev() {
    if (this._callbackPrev) {
      this._callbackPrev(this._reportId);
    }
  }
  static _startTimer() {
    const self = this;
    self._cancelTimer();
    self._timer = setTimeout(() => { self._onTimerTick.call(self); }, this.timeoutSeconds * 1000);
  }
  static _cancelTimer() {
    if (this._timer) {
      clearTimeout(this._timer);
      this._timer = undefined;
    }
  }
  static _resetTimer() {
    this._cancelTimer();
    this._startTimer();
  }
  static _removePopup() {
    if (this._popupElement)
      this._popupElement.remove();
    this._popupElement = undefined;
  }
  static _generatePopup(y, ratio, src) {
    const self = this;
    // create the full size mask div that is transparent
    const maskDiv = document.createElement('div');
    maskDiv.style.position = 'absolute';
    maskDiv.style.left = '0';
    maskDiv.style.top = '0';
    maskDiv.style.width = (this._container.offsetWidth - this._rightPad) + 'px';
    maskDiv.style.height = this._container.offsetHeight + 'px';
    maskDiv.style.backgroundColor = 'transparent';
    maskDiv.style.zIndex = '900';
    this._popupElement = maskDiv;
    this._container.appendChild(this._popupElement);
    maskDiv.addEventListener('mouseover', () => { self.hidePopup(); });
    // create the image div with calculated size and placement
    this._placeImageDiv(y, ratio, src);
  }
  static _placeImageDiv(y, ratio, url) {
    // console.log( y, url)
    try {
      //Image padding constants
      const pad = 20;
      const popElem = document.createElement('img');
      let o = {
        click: { y: y },
        popup: { top: 0, right: 0, wt: 1, ht: 1 },
        adjustedContHt: 0,
        adjustedContWt: 0,
        ratio: ratio
      };
      o.adjustedContHt = this._popupElement.offsetHeight - (pad * 2);
      o.adjustedContWt = this._popupElement.offsetWidth - pad;
      // place popup centered and to the left of the click point x,y and fit as needed
      // If W >= H
      if (o.ratio >= 1) {
        // width >= height
        o.popup.wt = o.adjustedContWt;
        o.popup.ht = o.popup.wt / o.ratio;
        if (o.popup.ht > o.adjustedContHt) {
          // reduce target height to fit
          o.popup.ht = o.adjustedContHt;
          o.popup.wt = o.adjustedContHt * o.ratio;
        }
      }
      else {
        // height > width
        o.popup.ht = o.adjustedContHt;
        o.popup.wt = o.popup.ht * o.ratio;
        if (o.popup.wt > o.adjustedContWt) {
          // reduce target width to fit
          o.popup.wt = o.adjustedContWt;
          o.popup.ht = o.adjustedContWt / o.ratio;
        }
      }
      // Place in container
      const desiredTop = Math.max(o.click.y - (o.popup.ht / 2), pad);
      const maxTop = o.adjustedContHt - o.popup.ht + pad;
      o.popup.top = Math.min(desiredTop, maxTop);
      o.popup.right = 0;
      // Set the popup placement
      popElem.style.position = 'absolute';
      popElem.style.right = o.popup.right + 'px';
      popElem.style.top = o.popup.top + 'px';
      popElem.style.width = o.popup.wt + 'px';
      popElem.style.height = o.popup.ht + 'px';
      popElem.src = url;
      // Add the image source url
      this._popupElement.appendChild(popElem);
      popElem.addEventListener('mouseover', (e) => {
        e.stopPropagation();
        e.preventDefault();
        return false;
      });
    }
    catch (ex) {
      console.log('%c PreviewPopup error', 'color:red;font-size:10pt', ex);
    }
    return document.createElement('img');
  }
}
_a = PreviewPopup;
/** showPopup
*
*  applies the src attribute to the image element in the popup
*
* @param imageSrcUrl  = valid url for image
*/
PreviewPopup.show = (reportId, containerElement, clickY, ratioW2H, imageSrcUrl) => {
  if (containerElement && clickY && imageSrcUrl && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.U.hasText(imageSrcUrl)) {
    if (reportId == _a._reportId) {
      _a._resetTimer();
    }
    else {
      _a.hidePopup();
      if (!_a.timeoutSeconds) {
        _a.timeoutSeconds = 6;
      }
      _a._container = containerElement;
      _a._reportId = reportId;
      _a._generatePopup(clickY, ratioW2H, imageSrcUrl);
      _a._startTimer();
    }
  }
};
PreviewPopup._rightPad = 60;

const arcgisInfographicTreeCss = ":host{display:block}::slotted([slot=\"children\"]){width:100%}.reportList{font-weight:200}.reportItems{font-weight:200;margin-inline-end:0.25rem}.report-item-buttons{position:relative;width:23px;height:28px}.report-item-preview{position:absolute;top:5px;width:22px;height:22px}.report-item-dots{position:absolute;top:7px;left:34px;width:22px;height:22px}.reportTree{padding-bottom:2px}.infographic-tree-busy{position:absolute;top:0;left:0;width:100%;height:100%;background:url(./assets/largeBusy.gif);background-repeat:no-repeat;background-position:center;z-index:999;display:none}calcite-tree-item [selected]{font-weight:bold}.report-item-content{width:100%;height:32px;display:flex}.report-refresh-button{position:absolute;top:8px;right:10px;width:18px;height:18px}.info-tree-search-div{position:absolute;top:3px;left:3px;width:calc(100% - 165px);height:33px;display:flex}.info-tree-search{flex:1 1 0%;width:calc(100% - 29px);height:24px;float:left}.info-tree-icon{position:relative;top:4px;left:2px;width:24px;height:26px;float:right;transform:scale(0.6);background-repeat:no-repeat}.info-tree-sort{position:absolute;top:3px;left:calc(100% - 148px);width:144px;height:32px;z-index:6}.info-tree-list{position:absolute;top:36px;left:3px;height:calc(100% - 40px);width:calc(100% - 6px)}.report-item-text{position:relative;top:7px;flex:1 1 0%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-weight:200}.report-item-popover{width:auto;height:auto;min-width:300px;min-height:200px;background-color:transparent}.report-item-popover-content{min-height:32px;line-height:200px;text-align:right}.report-item-default-popover{min-width:160px;padding:3px;height:42px}.tree-container{position:absolute;width:calc(100% - 12px);height:calc(100% - 18px);overflow-x:hidden;overflow-y:scroll}.thumbnail-preview{position:absolute;top:0;right:0;max-width:300px;max-height:200px;background-color:transparent;border:none;z-index:6;opacity:1;object-fit:cover}.report-item-popover-not-found{position:absolute;top:4px;right:41px;min-width:160px;height:32px !important;line-height:24px !important}";

const ArcgisInfographicTree = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.r)(this, hostRef);
    this.reportSelected = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.c)(this, "reportSelected", 7);
    this._idPrefix = 'arcgis-infographic-tree-';
    this._idPrefixBusy = 'arcgis-infographic-tree-busy-';
    this._busyIdPrefix = 'ig-tree-busy-';
    this._containerPrefix = 'ait-container-';
    this._elementIds = {}; // list, search, sort
    this._idListPrefix = 'ig-tree-list-';
    this._idSearchPrefix = 'ig-tree-search-';
    this._idSortPrefix = 'ig-tree-sort-';
    this._idPrefixReports = 'selector-popover-reports-';
    this._imgOffset = 1;
    this._dbg = false;
    this.stSourceCountry = 'US';
    this.stMultipleChoice = false;
    this.stSortType = 'newest';
    // Internal use only --------------------------------
    this._isInitialized = false;
    this.openPopoverId = null;
    this.baseConfig = new _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a('tree', this, this.onUpdateUI);
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.announceVersion();
    this._instanceId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefix).id;
    this._busyId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._busyIdPrefix).id;
    this._infographics = {
      MyInfographics: {
        dataId: 2,
        tag: 'report-my-infographics',
        data: undefined,
      },
      EsriInfographics: {
        dataId: 3,
        tag: 'report-esri-infographics',
        data: undefined,
      },
      SharedInfographics: {
        dataId: 4,
        tag: 'report-shared-infographics',
        data: undefined,
      },
      GalleryInfographics: {
        dataId: 5,
        tag: 'report-gallery-infographics',
        data: undefined,
      }
    };
    this.langCode = 'en-us';
    this.sourceCountry = 'US';
    this.stMultipleChoice = false;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B._initialize(this.langCode);
  }
  //
  // Update Props/States and base config when the component config changes
  onConfigChange(newConfig, oldConfig) {
    if (!newConfig || typeof newConfig != 'string') {
      return;
    }
    if (this.baseConfig && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(newConfig)) {
      const newCfg = JSON.parse(newConfig);
      const oldCfg = (oldConfig && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(oldConfig)) ? JSON.parse(oldConfig) : null;
      this.baseConfig.updateConfig(newCfg, oldCfg);
      // Filter out reports not checked
      //
      // Handle reportList where items are unchecked and we dont want to show them
      if (this.baseConfig.config?.reportList) {
        // config reportList filtered to contain only checked reports
        let filtered = {};
        const raw = typeof (this.baseConfig.config.reportList) === 'string' ? JSON.parse(this.baseConfig.config.reportList) : this.baseConfig.config.reportList;
        const keys = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.getKeys(raw);
        if (keys && keys.length > 0) {
          for (let k = 0; k < keys.length; k++) {
            let reports = [];
            const key = keys[k];
            const category = raw[key];
            if (category.length > 0) {
              category.forEach((r) => {
                if (r.isChecked) {
                  reports.push(r);
                }
              });
            }
            if (reports.length > 0) {
              filtered[key] = reports;
            }
          }
        }
        // update our tree list
        this._configFilteredReports = filtered;
      }
      else {
        this._configFilteredReports = undefined;
      }
    }
  }
  // ---------------------------------------------------------------------------------------------------
  // watches
  onEnvChanged() {
    this.stEnv = this.env;
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setEnvironment(this.env);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ env: this.env }, null);
    }
  }
  onLangCodeChanged() {
    this.stLangCode = this.langCode;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B._initialize(this.stLangCode);
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ langCode: this.langCode }, null);
    }
  }
  onSourceCountryChanged() {
    this.stSourceCountry = this.sourceCountry;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ sourceCountry: this.sourceCountry }, null);
    }
    // Clear cached reports when country changes
    this._configFilteredReports = undefined;
    this._cachedReports = undefined;
    this.stReportList = undefined;
  }
  onTokenChanged() {
    this.stToken = this.token;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ token: this.token }, null);
    }
    if (this.username && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.username) && this.token && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.token)) {
      (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.s)(this.username, this.token); // set the ba-reports token
    }
  }
  onUsernameChanged() {
    this.stUsername = this.username;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ username: this.username }, null);
    }
    if (this.username && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.username) && this.token && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(this.token)) {
      (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.s)(this.username, this.token); // set the ba-reports token
    }
  }
  onSelectedReportChanged() {
    this.stSelectedReportId = this.selectedReportId;
  }
  onReportListChanged() {
    this.stReportList = Object.keys(this.reportList).length ? JSON.parse(this.reportList) : {};
  }
  onThemeChanged() {
    this.stTheme = this.theme;
    if (this.baseConfig) {
      this.baseConfig.setTheme(this.theme);
    }
  }
  onPortalUrlChanged() {
    // Set if PortalUrl was optionally passed in
    if (this.portalUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setPortalUrl(this.portalUrl);
    }
  }
  onGeoenrichmentUrlChanged() {
    this.stGeoenrichmentUrl = this.geoenrichmentUrl;
    if (this.baseConfig) {
      // updates config and sub-component configs
      this.baseConfig.updateConfig({ geoenrichmentUrl: this.geoenrichmentUrl }, null);
    }
    // Set if GeoenrichmentUrl was optionally passed in
    if (this.geoenrichmentUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setGeoenrichmentUrl(this.geoenrichmentUrl);
    }
  }
  async updateLayout() {
    this.adjustTreeItemsWidth();
  }
  async getConfig() {
    const myCfg = this.baseConfig;
    return myCfg;
  }
  async initialize(username, token, env, country, language, reportList) {
    const self = this;
    self.token = token;
    self.username = username;
    self.sourceCountry = country;
    self.langCode = language;
    self.env = env;
    self.stReportList = Object.keys(reportList).length ? JSON.parse(reportList) : {};
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setEnvironment(self.env);
    // Set if GeoenrichmentUrl was optionally passed in
    if (self.geoenrichmentUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setGeoenrichmentUrl(self.geoenrichmentUrl);
    }
    // Set if PortalUrl was optionally passed in
    if (self.portalUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setPortalUrl(self.portalUrl);
    }
    (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.s)(username, token); // set the ba-reports token
    try {
      let userReports, publicReports, sharedReports, galleryReports;
      const infos = await (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.g)(country, false);
      if (Object.keys(self.stReportList).length) {
        userReports = self.stReportList.user;
        publicReports = self.stReportList.public;
        sharedReports = self.stReportList.shared;
      }
      else {
        userReports = infos.user.map(report => { return { ...report, isChecked: true }; });
        publicReports = infos.public.map(report => { return { ...report, isChecked: true }; });
        sharedReports = infos.shared.map(report => { return { ...report, isChecked: true }; });
        galleryReports = infos.gallery.map(report => { return { ...report, isChecked: false }; });
        self.stReportList = { user: userReports, public: publicReports, shared: sharedReports, gallery: galleryReports };
      }
      if (infos) {
        self._infographics.MyInfographics.data = userReports;
        self._infographics.EsriInfographics.data = publicReports;
        self._infographics.SharedInfographics.data = sharedReports;
        self._infographics.GalleryInfographics.data = galleryReports;
      }
      else {
        self._infographics.MyInfographics.data = undefined;
        self._infographics.EsriInfographics.data = undefined;
        self._infographics.SharedInfographics.data = undefined;
        self._infographics.GalleryInfographics.data = undefined;
      }
      this._isInitialized = true;
      const content = ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { scale: "m", selectionMode: "single" }, self.renderList('EsriInfographics', true), self.renderList('MyInfographics', this.isOnlyConfiguredReportList('MyInfographics')), self.renderList('SharedInfographics', this.isOnlyConfiguredReportList('SharedInfographics')), self.renderList('GalleryInfographics', this.isOnlyConfiguredReportList('GalleryInfographics'))));
      self._content = content;
      self.showBusy.call(self, false);
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Log('arcgis-infographic-tree request for esri reports failed', ex);
    }
  }
  setLocaleStrings() {
  }
  showBusy(flag) {
    const b = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this, this._busyId);
    if (b) {
      if (flag) {
        b.style.display = 'block';
      }
      else {
        b.style.display = 'none';
      }
    }
  }
  async setColorTheme(name) {
    if (name && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(name) && this.el) {
      this.stColorTheme = name.trim().toLowerCase();
      const n = name.trim().toLowerCase();
      if (n === 'light') {
        this.el.style.setProperty('--calcite-ui-brand', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#00619b');
        this.el.style.setProperty('--calcite-ui-brand-press', '#004874');
        this.el.style.setProperty('--calcite-ui-background', '#f8f8f8');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#f3f3f3');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#eaeaea');
        this.el.style.setProperty('--calcite-ui-text-1', '#151515');
        this.el.style.setProperty('--calcite-ui-text-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-text-3', '#6a6a6a');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-link', '#00619b');
        this.el.style.setProperty('--calcite-ui-border-1', '#cacaca');
        this.el.style.setProperty('--calcite-ui-border-2', '#d4d4d4');
        this.el.style.setProperty('--calcite-ui-border-3', '#dfdfdf');
        this.el.style.setProperty('--calcite-ui-border-input', '#949494');
        this.el.style.setProperty('--calcite-ui-info', '#00619b');
        this.el.style.setProperty('--calcite-ui-success', '#35ac46');
        this.el.style.setProperty('--calcite-tree-padding-y', '0');
      }
      else if (n === 'dark') {
        this.el.style.setProperty('--calcite-ui-brand', '#009af2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-press', '#00619b');
        this.el.style.setProperty('--calcite-ui-background', '#353535');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#2b2b2b');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#202020');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#151515');
        this.el.style.setProperty('--calcite-ui-text-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-2', '#bfbfbf');
        this.el.style.setProperty('--calcite-ui-text-3', '#9f9f9f');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#151515');
        this.el.style.setProperty('--calcite-ui-text-link', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-border-1', '#555555');
        this.el.style.setProperty('--calcite-ui-border-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-border-3', '#404040');
        this.el.style.setProperty('--calcite-ui-border-input', '#757575');
        this.el.style.setProperty('--calcite-ui-info', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-success', '#36da43');
      }
    }
  }
  _loadInstances() {
    if (!this._instanceId)
      this._instanceId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefix).id;
    if (!this._busyId)
      this._busyId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idPrefixBusy).id;
    if (!this._elementIds.list)
      this._elementIds.list = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idListPrefix).id;
    if (!this._elementIds.search)
      this._elementIds.search = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idSearchPrefix).id;
    if (!this._elementIds.sort)
      this._elementIds.sort = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.E.generateId(this._idSortPrefix).id;
  }
  // BaseUtil config-changed render callback
  onUpdateUI() {
  }
  onClickTreeItem(e, data) {
    PreviewPopup.hidePopup();
    this.reportSelected.emit({ report: data });
    e.stopPropagation();
    e.preventDefault();
    return false;
  }
  applySort(list) {
    if (list && list.length > 0) {
      const sortedList = [...list];
      let sortType = this.stSortType || 'newest';
      const elem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this, _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(this._elementIds.sort));
      if (typeof elem != 'undefined') {
        sortType = elem.value;
      }
      if (sortType) {
        switch (sortType) {
          case ('oldest'): {
            sortedList.sort((a, b) => {
              let da = a.date;
              let db = b.date;
              return da - db;
            });
            break;
          }
          case ('ascending'): {
            sortedList.sort((a, b) => {
              let s1 = a.title;
              let s2 = b.title;
              if (s1 < s2) {
                return -1;
              }
              if (s1 > s2) {
                return 1;
              }
              return 0;
            });
            break;
          }
          case ('descending'): {
            sortedList.sort((a, b) => {
              let s1 = a.title;
              let s2 = b.title;
              if (s1 > s2) {
                return -1;
              }
              if (s1 < s2) {
                return 1;
              }
              return 0;
            });
            break;
          }
          default: {
            // newest
            sortedList.sort((a, b) => {
              let da = a.date;
              let db = b.date;
              return db - da;
            });
            break;
          }
        }
      }
      return sortedList;
    }
    return list;
  }
  // Returns search-filtered list that is also sorted
  getFilteredReportList(name) {
    const tree = this;
    const searchFilteredList = [];
    const listNames = { 'MyInfographics': 'user', 'EsriInfographics': 'public', 'SharedInfographics': 'shared', 'GalleryInfographics': 'gallery' };
    const objName = listNames[name];
    const list = this._configFilteredReports || this.stReportList || this._cachedReports;
    const defaultList = list[objName];
    const searchInput = tree.el.querySelector('#' + tree._elementIds.search);
    if (searchInput) {
      const query = searchInput.value.trim().toLowerCase();
      if (query && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(query)) {
        if (list && list[objName] && list[objName].length > 0) {
          list[objName].forEach((item) => {
            const n = item.title;
            if (n && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(n) && n.toLowerCase().includes(query)) {
              searchFilteredList.push(item);
            }
          });
        }
      }
      else {
        return this.applySort(defaultList);
      }
    }
    else {
      return this.applySort(defaultList);
    }
    return this.applySort(searchFilteredList);
  }
  isOnlyConfiguredReportList(name) {
    const listNames = { 'MyInfographics': 'user', 'EsriInfographics': 'public', 'SharedInfographics': 'shared', 'GalleryInfographics': 'gallery' };
    const objName = listNames[name];
    const list = this._configFilteredReports || this.stReportList || this._cachedReports;
    const defaultList = list[objName];
    // If list is not configured, return false
    if (!defaultList)
      return false;
    return Object.keys(list).length === 1;
  }
  onUpdateThumbnailPopoverSize() {
    if (!this.el) {
      return;
    }
    let fullContentHt = 100;
    const minContentHt = 100;
    const minPopoverWt = 200;
    const maxPopoverWt = 735;
    const vpad = 36;
    const hpad = 16;
    const clientHt = document.documentElement.clientHeight;
    const clientWt = document.documentElement.clientWidth;
    const htAbove = this.el.offsetTop;
    const htBelow = clientHt - (this.el.offsetTop + this.el.offsetHeight) + window.scrollY;
    let fullContentWt = clientWt / 2;
    const rightSpace = clientWt - this.el.offsetLeft + window.scrollX;
    if (htBelow < minContentHt && htBelow < htAbove) {
      // popover max height = ht above if that space is larger than below
      fullContentHt = htAbove - vpad;
    }
    else {
      fullContentHt = htBelow - vpad;
    }
    fullContentWt = Math.max(minPopoverWt, Math.min(rightSpace - hpad, maxPopoverWt));
    const contentElem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.content);
    if (contentElem) {
      if (contentElem) {
        contentElem.style.height = fullContentHt + 'px';
      }
    }
    const popoverElem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.popover);
    if (popoverElem) {
      popoverElem.style.width = fullContentWt + 'px';
      // popoverElem.style.left = this.el.offsetLeft + 'px'
    }
    // notify tree that our size may have changed
    const tree = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(this.el, this._elementIds.reports);
    if (tree) {
      tree.updateLayout();
    }
  }
  handleMouseOver(ev, reportId) {
    const y = ev.clientY;
    const id = reportId;
    this._debounce2(() => {
      PreviewPopup.hidePopup();
      const imgData = ArcgisInfographicTree._getThumbnailUrl(id);
      if (imgData && imgData.isOk) {
        const popover = this.el.closest('calcite-popover');
        if (popover) {
          const rr = popover.getBoundingClientRect();
          const clickY = y - rr.top;
          PreviewPopup.show(id, popover, clickY, imgData.ratio, imgData.url);
        }
      }
    }, 200);
    return true;
  }
  handleMouseOut() {
    this._debounce2(() => {
      PreviewPopup.hidePopup();
    }, 300);
  }
  static _setThumbnailIndex(id, ratioW2H, url, isValid) {
    ArcgisInfographicTree.ThumbnailIndex[id] = { url: url, ratio: ratioW2H, isOk: isValid };
  }
  static _getThumbnailUrl(id) {
    return ArcgisInfographicTree.ThumbnailIndex[id];
  }
  renderList(name, expanded) {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Log(' TREE renderList', name);
    const self = this;
    const tags = {
      'MyInfographics': 'report-my-infographics',
      'EsriInfographics': 'report-esri-infographics',
      'SharedInfographics': 'report-shared-infographics',
      'GalleryInfographics': 'report-gallery-infographics',
      'NoPreviewAvailable': 'preview-not-available'
    };
    function _getImgId() {
      return self._instanceId + '-' + 'img' + self._imgOffset++;
    }
    // this function operates asynchronously to check image urls.  The results from requesting
    // an image are added to the Thumbnail Index for future reference
    function _cacheThumbnailUrlAndData(imgId, id, popoverId, prevId, name) {
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(imgId) && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(id) && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(popoverId)) {
        _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Log('TREE _getThumbnail');
        // const imgElementId = imgId
        const thumbnailId = id;
        const popId = popoverId;
        const treePrevId = prevId;
        // Adds tooltips to preview items that do not have a valid thumbnail
        function _addNoPreviewTooltip(itemId) {
          const pop = self.el.querySelector(_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(popId));
          if (pop) {
            pop.remove();
          }
          const prevElem = self.el.querySelector(_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(itemId));
          if (prevElem) {
            // add no-preview tooltip
            const tip = document.createElement('calcite-tooltip');
            tip.setAttribute('reference-element', itemId);
            tip.style.minWidth = '160px';
            tip.style.left = '-40px';
            const sp = document.createElement('span');
            sp.innerText = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags.NoPreviewAvailable);
            tip.appendChild(sp);
            prevElem.appendChild(tip);
          }
        }
        function _useAGOForThumbnail(name) {
          if (name !== "EsriInfographics")
            return false;
          if (self.portalOnlineGEProxy && !_GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.isAGOPortal(_GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.getPortalBase()))
            return true;
          return false;
        }
        // use pre-cached info if possible
        let fetchItem = true;
        const imgData = ArcgisInfographicTree._getThumbnailUrl(id);
        if (imgData) {
          if (imgData.isOk || imgData.isOk == false) {
            // already have cached results
            fetchItem = false;
          }
        }
        // check server if the thumbnail can be used
        if (fetchItem) {
          // determine if the image url is valid or not by creating an image in memory
          // const p = new Promise((resolve, reject) => {
          let url = '';
          // If we have a GE Online proxy setup and are connected to a portal (not AGO), we need to use www.arcgis.com for the Esri Infographics thumbnails
          if (_useAGOForThumbnail(name)) {
            url = 'https://www.arcgis.com/sharing/rest/content/items/' + thumbnailId + '/resources/thumbnail.png';
          }
          else {
            url = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.getPortalBase() + '/sharing/rest/content/items/' + thumbnailId + '/resources/thumbnail.png?token=' + self.token;
          }
          function urlIsValid(pid, u, rid, wt, ht) {
            // const w: number = imgInstance.width
            // const h: number = imgInstance.height
            // save our results into the thumbnail index to avoid this step later
            ArcgisInfographicTree._setThumbnailIndex(rid, (wt / ht), u, true);
            // remove the no-preview tooltip
            const prevElem = self.el.querySelector(_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(pid));
            if (prevElem) {
              const oldTip = prevElem.querySelector('calcite-tooltip');
              if (oldTip) {
                oldTip.remove();
              }
            }
          }
          function urlHadError(pid, u, rid) {
            ArcgisInfographicTree._setThumbnailIndex(rid, 1, u, false);
            _addNoPreviewTooltip(pid);
          }
          try {
            const img = new Image();
            img.onload = function () {
              const imgInst = this;
              const w = imgInst.width;
              const h = imgInst.height;
              urlIsValid(treePrevId, url, thumbnailId, w, h);
            };
            img.onerror = () => { urlHadError(treePrevId, url, thumbnailId); };
            img.src = url;
          }
          catch (ex) {
            urlHadError(treePrevId, url, thumbnailId);
          }
          // })
        }
      }
    }
    const outerStyle = {
      'position': 'relative',
      'width': '100%',
      'height': '100%'
    };
    // const noPreviewStyle = {
    //   'position': 'absolute',
    //   'top': '0',
    //   'left': '0',
    //   'width': '100%',
    //   'height': '100%',
    //   'zIndex': '5'
    // }
    // const iconName = 'file-text'
    // function getThumbnailStyle(id: string) {
    //   return {
    //     'position': 'absolute',
    //     'top': '0',
    //     'left': '0',
    //     'width': '100%',
    //     'height': '100%',
    //     'zIndex': '6',
    //     'backgroundImage': 'url(' + _getThumbnail(id) + ')',
    //     'backgroundSize': 'auto'
    //   }
    // }
    // const thumbnailDiv = {
    //   'width':'100%',
    //   'height':'100%',
    //   'backgroundImage' : 'url(https://www.arcgis.com/sharing/rest/content/items/697887220b9f47b8a22383a1acd4f203/resources/thumbnail.png)',
    //   'backgroundSize' : 'contain'
    // }
    // const reports = self._infographics[name].data
    const reports = self.getFilteredReportList(name);
    if (reports && reports.length > 0) {
      // let arr: any[] = reports.map((v) => { return {id: v.id, name: v.title}})
      let displayName = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags[name]);
      if (displayName === '??') {
        _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Error('Missing Report Category name', tags[name]);
        displayName = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n(tags[name]); // without the option
      }
      const filteredReportList = this.getFilteredReportList(name);
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Log('TREE renderList[' + name + '] filtered=', filteredReportList);
      if (!filteredReportList) {
        return;
      }
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.isDef(filteredReportList)) {
        let showReportCat = false;
        filteredReportList.forEach((element) => {
          if (element.isChecked) {
            showReportCat = true;
          }
        });
        // create a tree node for this level with all records
        if (showReportCat) {
          return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { style: outerStyle }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree-item", { class: "reportList", slot: "children", expanded: expanded }, displayName, reports.length > 0 && ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { slot: "children", class: "reportTree" }, reports.map(report => {
            if (filteredReportList.some(obj => { return obj.id === report.id && obj.isChecked === true; })) {
              const itemId = 'tree-item-' + report.id;
              const prevId = itemId + '-prev';
              const thumbnailPopId = itemId + '-pop';
              const imgId = _getImgId();
              _cacheThumbnailUrlAndData(imgId, report.id, thumbnailPopId, prevId, name);
              return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-tree-dropdown" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree-item", { id: itemId, selected: report.id === self.stSelectedReportId ? true : false, class: "reportItems", data: report.id, onClick: (e) => self.onClickTreeItem(e, { thumbnail: thumbnailPopId, id: report.id, name: report.title }) }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-content" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-text" }, report.title), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "report-item-buttons" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", null, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: prevId, class: "report-item-preview", onMouseOver: (e) => this.handleMouseOver(e, report.id), onMouseOut: () => this.handleMouseOut() }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("svg", { "aria-hidden": "true", class: "svg", fill: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("path", { d: "M17 16h-5.525a5.95 5.95 0 0 0-.172-1H17zm2-7h-9v1h9zm0 3h-9v.544q.193.22.364.456H19zm3 8H11.818l-.913-.913c.014-.028.023-.059.037-.087H21V7h-4V3H8v8.053a5.945 5.945 0 0 0-1-.356V2h11.4L22 5.6zM21 5.69L18.31 3H18v3h3zM8.926 19.23l3.085 3.084a.476.476 0 0 1 0 .674l-.017.017a.476.476 0 0 1-.673 0L8.237 19.92A4.383 4.383 0 1 1 9.9 16.5a4.358 4.358 0 0 1-.974 2.73zM5.5 19.9a3.4 3.4 0 1 0-3.4-3.4 3.404 3.404 0 0 0 3.4 3.4z" })))))))));
            }
          }))))));
        }
        else {
          return '';
        }
      }
      else {
        return '';
      }
    }
    else {
      return '';
    }
  }
  async refreshInfographicList() {
    const self = this;
    let userReports, publicReports, sharedReports, galleryReports;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Log('TREE refreshInfographicList', self.stReportList);
    const list = this._configFilteredReports || this.stReportList || this._cachedReports;
    // If no reports configuration is specified, default to ONLY Esri Reports (public)
    if (this.baseConfig.config?.reportList) {
      const raw = typeof (this.baseConfig.config.reportList) === 'string' ? JSON.parse(this.baseConfig.config.reportList) : this.baseConfig.config.reportList;
      const keys = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.getKeys(raw);
      if (keys?.length == 0) {
        delete list?.user;
        delete list?.shared;
        delete list?.gallery;
      }
    }
    let infos;
    if (list && Object.keys(list).length) {
      userReports = list.user;
      publicReports = list.public;
      sharedReports = list.shared;
      galleryReports = list.gallery;
    }
    else {
      // fetch reports from server
      self._isInitialized = false;
      infos = await (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.g)(self.sourceCountry, false);
      userReports = infos.user.map(report => { return { ...report, isChecked: true }; });
      publicReports = infos.public.map(report => { return { ...report, isChecked: true }; });
      sharedReports = infos.shared.map(report => { return { ...report, isChecked: true }; });
      galleryReports = infos.gallery.map(report => { return { ...report, isChecked: true }; });
      this._configFilteredReports = undefined;
      // do not update stReportList here or we have endless render loop
      self._cachedReports = { user: userReports, public: publicReports, shared: sharedReports, gallery: galleryReports };
      self._isInitialized = true;
    }
    if (list || infos) {
      self._infographics.MyInfographics.data = userReports;
      self._infographics.EsriInfographics.data = publicReports;
      self._infographics.SharedInfographics.data = sharedReports;
      self._infographics.GalleryInfographics.data = galleryReports;
    }
    else {
      self._infographics.MyInfographics.data = undefined;
      self._infographics.EsriInfographics.data = undefined;
      self._infographics.SharedInfographics.data = undefined;
      self._infographics.GalleryInfographics.data = undefined;
    }
    const content = ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-tree", { scale: "m", selectionMode: "single" }, self.renderList('EsriInfographics', true), self.renderList('MyInfographics', this.isOnlyConfiguredReportList('MyInfographics')), self.renderList('SharedInfographics', this.isOnlyConfiguredReportList('SharedInfographics')), self.renderList('GalleryInfographics', this.isOnlyConfiguredReportList('GalleryInfographics'))));
    self._content = content;
    self.adjustTreeItemsWidth();
  }
  async getLocalFilteredInfographicsList() {
  }
  // Stencil lifecycle - called once after component is first connected to the DOM
  async componentWillLoad() {
    const self = this;
    if (self.env) {
      self.onEnvChanged();
    }
    if (self.token) {
      self.onTokenChanged();
    }
    if (self.username) {
      self.onUsernameChanged();
    }
    if (self.selectedReportId) {
      self.onSelectedReportChanged();
    }
    if (self.reportList) {
      self.onReportListChanged();
    }
    if (self.langCode) {
      self.onLangCodeChanged();
    }
    if (self.geoenrichmentUrl) {
      self.onGeoenrichmentUrlChanged();
    }
    if (self.sourceCountry) {
      self.onSourceCountryChanged();
    }
    if (self.portalUrl) {
      self.onPortalUrlChanged();
    }
    if (self.config) {
      self.onConfigChange(self.config, '');
    }
    if (this.theme) {
      this.baseConfig.setTheme(this.theme);
    }
    else {
      this.baseConfig.setTheme('light');
    }
    self._loadInstances();
    try {
      await self.refreshInfographicList();
      self._isInitialized = true;
      // TODO: at some point we should add ba-accordion as a subcomponent
      // when it starts using baseConfig
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.a.Error('arcgis-infographic-tree request for esri reports failed', ex);
    }
  }
  // Stencil lifecycle - called just after component updates, but not called during first render()
  componentDidUpdate() {
    const self = this;
    self.showBusy.call(this, false);
    if (self.baseConfig) {
      self.baseConfig.onComponentHasRendered();
    }
    if (self._cachedReports) {
      self.stReportList = self._cachedReports;
      // cached reports only updates in refreshInfographicList() and resets here after render
      self._cachedReports = undefined;
    }
  }
  // Stencil lifecycle - called once after component is fully loaded and 1st render occurred
  componentDidLoad() {
    const self = this;
    self._loadInstances();
    self.showBusy.call(self, false);
    const searchInput = this.el.querySelector('#' + this._elementIds.search);
    function _onResize() {
      self.adjustTreeItemsWidth();
    }
    window.removeEventListener('resize', _onResize);
    window.addEventListener('resize', _onResize);
    self.adjustTreeItemsWidth();
    const onClickItemMakeDefault = (e) => {
      const item = e.currentTarget.closest('calcite-tree-item');
      if (item) {
        const itemId = item.id;
        const reportId = itemId.substring(10);
        if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(reportId)) {
          self.selectedReportId = reportId;
          self.onSelectedReportChanged();
          let n = '';
          const textElem = item.querySelector('div.report-item-text');
          if (textElem) {
            n = textElem.innerText;
          }
          self.onClickTreeItem(e, { id: reportId, name: n });
        }
      }
    };
    // item 'make default' click handler
    const items = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementAll.call(self, 'div.default-popover-content');
    if (!items || items.length > 0) {
      for (let ii = 0; ii < items.length; ii++) {
        items[ii].removeEventListener('click', onClickItemMakeDefault);
        items[ii].addEventListener('click', onClickItemMakeDefault);
      }
    }
    // called when the tree search text changes
    const onSearchQueryChanged = () => {
      self._debounce2(() => {
        //self.refreshInfographicList.call(self)
        self.stTimestamp = new Date().getTime();
      }, 500);
    };
    const sortElem = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.queryElementById.call(self, _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.fixId(self._elementIds.sort));
    if (sortElem) {
      sortElem.addEventListener('calciteSelectChange', () => {
        self.stSortType = sortElem.value;
        //self.refreshInfographicList()
      });
    }
    if (searchInput) {
      searchInput.removeEventListener('input', onSearchQueryChanged);
      searchInput.addEventListener('input', onSearchQueryChanged);
      searchInput.addEventListener('calciteInputChange', onSearchQueryChanged);
    }
    self.adjustTreeItemsWidth();
  }
  /**
   * Filters out multiple rapid events of the same type.  The callback
   * function will be called if no new events have happened during the
   * 'wait' time.
   * @param callback - your function to call when the events have settled
   * @param wait     - milliseconds delay (ex: 250)
   */
  _debounce2(callback, wait) {
    const self = this;
    const delayedCall = function () {
      self._debounceTimer = null;
      callback.apply(self);
    };
    // everytime _debounce2 is called we kill the previous timer
    if (self._debounceTimer)
      clearTimeout(self._debounceTimer);
    self._debounceTimer = setTimeout(delayedCall, wait);
  }
  adjustTreeItemsWidth() {
    if (this.el) {
      const items = this.el.querySelectorAll('div.report-item-content');
      if (!items || items.length <= 0) {
        return;
      }
      const p = items[0].closest('.reportList');
      if (p) {
        const wt = p.offsetWidth;
        items.forEach((item) => {
          item.style.width = (wt - 60) + 'px';
        });
      }
    }
    // adjust infographic preview size
    const pop = this.el.parentElement?.parentElement;
    const sWt = pop?.style?.width;
    if (sWt && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.A.hasText(sWt)) {
      const wt = parseInt(sWt);
      if (!Number.isNaN(wt)) {
        const adjustedWidth = wt * 0.9;
        if (adjustedWidth > 300) {
          // apply new width
          const pops = this.el.querySelectorAll('img.thumbnail-preview');
          if (pops) {
            pops.forEach((t) => {
              t.style.maxWidth = adjustedWidth + 'px';
              t.style.maxHeight = (adjustedWidth * 0.66) + 'px';
            });
          }
        }
      }
    }
  }
  render() {
    const outerDivStyle = {
      'position': 'absolute',
      'width': 'calc(100% - 12px)',
      'height': 'calc(100% - 8px)',
      'overflow-x': 'hidden',
      'overflow-y': 'scroll'
    };
    const placeText = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('search-infos-by-name');
    const sortNewest = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('date-sort-newest');
    const sortOldest = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('date-sort-oldest');
    const nameAsc = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('name-sort-asc');
    const nameDesc = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_0__.B.i18n('name-sort-desc');
    this.refreshInfographicList();
    // Render just the outer div and busy spinner until the component
    // initialize() function is called - and the infographic data is
    // received.  The content is added in the initialize() function.
    return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._instanceId, style: outerDivStyle, class: "arcgis-tree-outer" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._busyId, class: "infographic-tree-busy" }), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { class: "info-tree-search-div" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-input", { clearable: "true", id: this._elementIds.search, placeholder: placeText, class: "info-tree-search" }), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.icon, class: "info-tree-icon" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-icon", { scale: 'l', icon: 'search' }))), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-select", { id: this._elementIds.sort, class: "info-tree-sort" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "newest" }, sortNewest), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "oldest" }, sortOldest), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "ascending" }, nameAsc), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("calcite-option", { value: "descending" }, nameDesc)), (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", { id: this._elementIds.list, class: "info-tree-list" }, (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.h)("div", null, this._content))));
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_1__.g)(this); }
  static get watchers() { return {
    "config": ["onConfigChange"],
    "env": ["onEnvChanged"],
    "langCode": ["onLangCodeChanged"],
    "sourceCountry": ["onSourceCountryChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "selectedReportId": ["onSelectedReportChanged"],
    "reportList": ["onReportListChanged"],
    "theme": ["onThemeChanged"],
    "portalUrl": ["onPortalUrlChanged"],
    "geoenrichmentUrl": ["onGeoenrichmentUrlChanged"]
  }; }
};
ArcgisInfographicTree.ThumbnailIndex = {};
ArcgisInfographicTree.style = arcgisInfographicTreeCss;



//# sourceMappingURL=arcgis-infographic-tree-b71f4b45.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js":
/*!*******************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js ***!
  \*******************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getInfographicTemplatesList),
/* harmony export */   s: () => (/* binding */ setToken)
/* harmony export */ });
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");



function setToken(username, token) {
    try {
        if (username != null && username.length > 0) {
            if (token != null && token.length > 0) {
                _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.setToken(username, token);
                return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ok');
            }
            else {
                return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-token');
            }
        }
        else {
            return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-username');
        }
    }
    catch (ex) {
        return ex;
    }
}
async function getInfographicTemplatesList(countryCode, full = false) {
    return await _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.G.getInfographicTemplatesList(countryCode, full);
}



//# sourceMappingURL=arcgisReports-a1dc26aa.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYmEtaW5mb2dyYXBoaWNfbm9kZV9tb2R1bGVzX2FyY2dpc19idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHNfZGlzLWNiOWNlNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBa0c7QUFDZTtBQUNsQztBQUNNO0FBQ2hEOztBQUVyQyw0Q0FBNEMsY0FBYywwQkFBMEIsa0JBQWtCLFdBQVcsWUFBWSxxQkFBcUIsbUJBQW1CLDRCQUE0QixXQUFXLGlCQUFpQixrQkFBa0IsUUFBUSxXQUFXLFlBQVksV0FBVyxzQkFBc0IsY0FBYyxXQUFXLFlBQVksZUFBZSxvQkFBb0IsZ0JBQWdCLHdCQUF3QixZQUFZLGNBQWMseUJBQXlCLGtCQUFrQixRQUFRLFNBQVMsd0JBQXdCLFlBQVksaUJBQWlCLGdCQUFnQixnQkFBZ0IsdUJBQXVCLGtCQUFrQixnQkFBZ0IsbUJBQW1CLGVBQWUsbUJBQW1CLGtCQUFrQixZQUFZLFdBQVcsZUFBZSx5QkFBeUIsa0JBQWtCLFFBQVEsVUFBVSxXQUFXLFlBQVksMkJBQTJCLG9CQUFvQixvQkFBb0IseUJBQXlCLG9DQUFvQyxnREFBZ0QsVUFBVSxXQUFXLDBDQUEwQyxnREFBZ0QsMENBQTBDLDZCQUE2QiwyQ0FBMkMsZ0RBQWdELFVBQVUsV0FBVzs7QUFFMXhDO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQiwwQ0FBMEMscURBQVc7QUFDckQsMENBQTBDLHFEQUFXO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsMEJBQTBCLHNEQUFRO0FBQ2xDLElBQUksc0RBQVE7QUFDWjtBQUNBLElBQUksc0RBQWlCO0FBQ3JCO0FBQ0E7QUFDQSwyQ0FBMkMsc0RBQXNEO0FBQ2pHO0FBQ0E7QUFDQSxJQUFJLG9EQUFZO0FBQ2hCO0FBQ0E7QUFDQSxxQ0FBcUMsZUFBZTtBQUNwRDtBQUNBO0FBQ0E7QUFDQSxJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBLGFBQWEsc0RBQVEsb0JBQW9CLHNEQUFRO0FBQ2pELE1BQU0sb0RBQWE7QUFDbkI7QUFDQTtBQUNBLHFDQUFxQyxtQkFBbUI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EsSUFBSSxzREFBUTtBQUNaO0FBQ0E7QUFDQSxhQUFhLHNEQUFRLG9CQUFvQixzREFBUTtBQUNqRCxNQUFNLG9EQUFhO0FBQ25CO0FBQ0E7QUFDQSxxQ0FBcUMseUJBQXlCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHlCQUF5QjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyx5Q0FBeUM7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsbUNBQW1DO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLG1DQUFtQztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBLHVCQUF1QixzREFBUTtBQUMvQjtBQUNBLHFDQUFxQyxzREFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNEQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzREFBUTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLHNEQUFVO0FBQ25DO0FBQ0EsK0JBQStCLHNEQUFVO0FBQ3pDO0FBQ0EsZ0NBQWdDLHNEQUFVO0FBQzFDO0FBQ0EsaUNBQWlDLHNEQUFVO0FBQzNDO0FBQ0EsaUNBQWlDLHNEQUFVO0FBQzNDO0FBQ0EsK0JBQStCLHNEQUFVO0FBQ3pDO0FBQ0EsaUNBQWlDLHNEQUFVO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxvREFBb0Q7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isc0RBQVE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0RBQVE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0Isc0RBQVE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0Isc0RBQVE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNEQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isc0RBQVE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDLFVBQVUsb0RBQW9ELEVBQUUscURBQUMsbUJBQW1CLDRCQUE0QixLQUFLLHFEQUFDLHFCQUFxQixvREFBb0QsRUFBRSxxREFBQyxxQkFBcUIsaUJBQWlCLGVBQWUscURBQUMscUJBQXFCLGlCQUFpQixlQUFlLHFEQUFDLHFCQUFxQixvQkFBb0IsWUFBWSxxREFBQyxxQkFBcUIscUJBQXFCLGNBQWMscURBQUMsVUFBVSxvREFBb0QsRUFBRSxxREFBQztBQUN2eUI7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFc0M7O0FBRXRDOzs7Ozs7Ozs7Ozs7Ozs7OztBQzNrQzJFO0FBQ1Q7O0FBRWxFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9EQUFhO0FBQzdCLHVCQUF1QixzREFBaUI7QUFDeEM7QUFDQTtBQUNBLHVCQUF1QixzREFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHNEQUFpQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvREFBUTtBQUN6Qjs7QUFFMkQ7O0FBRTNEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWluZm9ncmFwaGljLXNlbGVjdG9yXzIuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWluZm9ncmFwaGljLXRyZWUtYjcxZjRiNDUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzUmVwb3J0cy1hMWRjMjZhYS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGcgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtNGU2NDc0MTEuanMnO1xuaW1wb3J0IHsgYSBhcyBCYXNlVXRpbCwgQSBhcyBBQ0xVdGlscywgQiBhcyBCYVJlcG9ydHNMYW5ndWFnZSwgRSBhcyBFbGVtZW50SWRzIH0gZnJvbSAnLi9FbGVtZW50SWRzLWY3ZDI1N2U4LmpzJztcbmltcG9ydCB7IEUgYXMgRW52aXJvbm1lbnRzLCBUIGFzIFRva2VuUHJvdmlkZXIgfSBmcm9tICcuL0dFQ2xpZW50LTFhODNhNjU3LmpzJztcbmV4cG9ydCB7IEEgYXMgYXJjZ2lzX2luZm9ncmFwaGljX3RyZWUgfSBmcm9tICcuL2FyY2dpcy1pbmZvZ3JhcGhpYy10cmVlLWI3MWY0YjQ1LmpzJztcbmltcG9ydCAnLi9hcmNnaXNSZXBvcnRzLWExZGMyNmFhLmpzJztcblxuY29uc3QgYXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3RvckNzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9ja30uaW5mb2dyYXBoaWNTZWxlY3Rvck91dGVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7aGVpZ2h0OjMwcHg7anVzdGlmeS1jb250ZW50OmxlZnQ7YWxpZ24taXRlbXM6Y2VudGVyfS5zZWxlY3Rvci1sYWJlbC1wbGFjZWhvbGRlcntjb2xvcjpncmF5fS5pbmZvU2VsLW1hZ25pZnl7cG9zaXRpb246YWJzb2x1dGU7dG9wOjJweDtsZWZ0OjEwMHB4O2hlaWdodDozMnB4O3dpZHRoOjMycHg7YmFja2dyb3VuZC1jb2xvcjpibHVlfS5hcmNTZWwtY29tYm97d2lkdGg6MTAwJTtoZWlnaHQ6MzJweDtmb250LXNpemU6MTFwdDtjb2xvcjpkYXJrc2xhdGVncmF5fS5hcmNTZWwtcmVwb3J0c3t3aWR0aDpjYWxjKDEwMCUgLSAxNnB4KTtoZWlnaHQ6MTAwJTtvdmVyZmxvdzphdXRvfS5zZWxlY3Rvci1kcm9wZG93bi1sYWJlbHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6N3B4O2xlZnQ6NnB4O3dpZHRoOmNhbGMoMTAwJSAtIDM1cHgpO2hlaWdodDoyNXB4O2ZvbnQtc2l6ZToxMC41cHQ7Zm9udC13ZWlnaHQ6MzAwO3RleHQtYWxpZ246bGVmdDt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO2JvcmRlci1yYWRpdXM6MHB4O292ZXJmbG93OmhpZGRlbjt3aGl0ZS1zcGFjZTpub3dyYXA7Y3Vyc29yOnBvaW50ZXJ9LnNlbGVjdG9yLWRyb3Bkb3due3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozMnB4O3dpZHRoOjEwMCU7Y3Vyc29yOnBvaW50ZXJ9LnNlbGVjdG9yLWRyb3Bkb3duLWFycm93e3Bvc2l0aW9uOmFic29sdXRlO3RvcDo5cHg7cmlnaHQ6N3B4O3dpZHRoOjEycHg7aGVpZ2h0OjEycHg7dHJhbnNpdGlvbjphbGwgMC4xNXMgMC4xNXM7dHJhbnNmb3JtOnJvdGF0ZSgwKX0uc2VsZWN0b3ItZHJvcC1vcGVue3RyYW5zZm9ybTpyb3RhdGUoMTgwZGVnKX1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZC0xKTt3aWR0aDo4cHg7aGVpZ2h0OjhweH1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zKX1jYWxjaXRlLXBvcG92ZXIgOjotd2Via2l0LXNjcm9sbGJhci10cmFja3tiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50fWNhbGNpdGUtcG9wb3ZlciA6Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktYmFja2dyb3VuZC0xKTt3aWR0aDo4cHg7aGVpZ2h0OjhweH1cIjtcblxuY29uc3QgQXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3RvciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBPcGVuZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImluZm9ncmFwaGljU2VsZWN0b3JQb3B1cE9wZW5lZFwiLCA2KTtcbiAgICB0aGlzLmluZm9ncmFwaGljU2VsZWN0b3JQb3B1cENsb3NlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiaW5mb2dyYXBoaWNTZWxlY3RvclBvcHVwQ2xvc2VkXCIsIDYpO1xuICAgIHRoaXMuX2xvY2FsZVNldHRpbmdzID0ge307XG4gICAgdGhpcy5fcG9wb3ZlcklzT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuX2lkUHJlZml4ID0gJ2FyY2dpcy1pbmZvZ3JhcGhpYy1zZWxlY3Rvci0nO1xuICAgIHRoaXMuX2VsZW1lbnRJZHMgPSB7fTsgLy8gYnV0dG9uXG4gICAgdGhpcy5faWRCdXR0b25QcmVmaXggPSAnc2VsZWN0b3ItZHJvcGRvd24tYnV0dG9uLSc7XG4gICAgdGhpcy5faWREcm9wZG93bkFycm93UHJlZml4ID0gJ3NlbGVjdG9yLWRyb3Bkb3duLWFycm93LSc7XG4gICAgdGhpcy5faWREcm9wZG93bkxhYmVsUHJlZml4ID0gJ3NlbGVjdG9yLWRyb3Bkb3duLWxhYmVsLSc7XG4gICAgdGhpcy5faWRSZXBvcnRMaXN0UHJlZml4ID0gJ3NlbGVjdG9yLXJlcG9ydC1saXN0LSc7XG4gICAgdGhpcy5faWRQb3BvdmVyUHJlZml4ID0gJ3NlbGVjdG9yLXBvcG92ZXItJztcbiAgICB0aGlzLl9pZFBvcG92ZXJDb250ZW50UHJlZml4ID0gJ3NlbGVjdG9yLXBvcG92ZXItY29udGVudC0nO1xuICAgIHRoaXMuX3JlcG9ydCA9IHsgaWQ6IG51bGwsIG5hbWU6ICcnIH07XG4gICAgdGhpcy5iYXNlQ29uZmlnID0gbmV3IEJhc2VVdGlsKCdzZWxlY3RvcicsIHRoaXMsIHRoaXMub25VcGRhdGVVSSk7XG4gICAgQUNMVXRpbHMuYW5ub3VuY2VWZXJzaW9uKCk7XG4gICAgdGhpcy5sYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGUgfHwgJ2VuLXVzJztcbiAgICBCYVJlcG9ydHNMYW5ndWFnZS5faW5pdGlhbGl6ZSh0aGlzLmxhbmdDb2RlKTtcbiAgICB0aGlzLnNldExvY2FsZVN0cmluZ3MoKTtcbiAgICB0aGlzLnNvdXJjZUNvdW50cnkgPSB0aGlzLnNvdXJjZUNvdW50cnkgfHwgJ1VTJztcbiAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlTG9jYWxlU2V0dGluZ3MoeyBsYW5ndWFnZTogdGhpcy5sYW5nQ29kZSwgY291bnRyeTogdGhpcy5zb3VyY2VDb3VudHJ5IH0pO1xuICB9XG4gIG9uRW52Q2hhbmdlZCgpIHtcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQodGhpcy5lbnYpO1xuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBlbnY6IHRoaXMuZW52IH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvblRva2VuQ2hhbmdlZCgpIHtcbiAgICBCYXNlVXRpbC5Mb2coJ3NlbGVjdG9yOiB0b2tlbiBjaGFuZ2VkJywgdGhpcy50b2tlbik7XG4gICAgY29uc3QgdCA9IHRoaXMudG9rZW47XG4gICAgY29uc3QgdSA9IHRoaXMuYmFzZUNvbmZpZz8uY29uZmlnPy51c2VybmFtZTtcbiAgICBpZiAodCAmJiBBQ0xVdGlscy5oYXNUZXh0KHQpICYmIHUgJiYgQUNMVXRpbHMuaGFzVGV4dCh1KSkge1xuICAgICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1LCB0KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHRva2VuOiB0aGlzLnRva2VuIH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvblVzZXJuYW1lQ2hhbmdlZCgpIHtcbiAgICBCYXNlVXRpbC5Mb2coJ3NlbGVjdG9yOiB1c2VybmFtZSBjaGFuZ2VkJywgdGhpcy51c2VybmFtZSk7XG4gICAgY29uc3QgdSA9IHRoaXMudXNlcm5hbWU7XG4gICAgY29uc3QgdCA9IHRoaXMuYmFzZUNvbmZpZz8uY29uZmlnPy50b2tlbjtcbiAgICBpZiAodCAmJiBBQ0xVdGlscy5oYXNUZXh0KHQpICYmIHUgJiYgQUNMVXRpbHMuaGFzVGV4dCh1KSkge1xuICAgICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1LCB0KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lIH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvbkxhbmdDb2RlQ2hhbmdlZCgpIHtcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgbGFuZ0NvZGU6IHRoaXMubGFuZ0NvZGUgfSwgbnVsbCk7XG4gICAgfVxuICB9XG4gIG9uR2VvZW5yaWNobWVudFVybENoYW5nZWQoKSB7XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IGdlb2VucmljaG1lbnRVcmw6IHRoaXMuZ2VvZW5yaWNobWVudFVybCB9LCBudWxsKTtcbiAgICB9XG4gIH1cbiAgb25TZWxlY3RlZFJlcG9ydElkQ2hhbmdlZCgpIHtcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgc291cmNlQ291bnRyeTogdGhpcy5zb3VyY2VDb3VudHJ5IH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvblNvdXJjZUNvdW50cnlDaGFuZ2VkKCkge1xuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBzb3VyY2VDb3VudHJ5OiB0aGlzLnNvdXJjZUNvdW50cnkgfSwgbnVsbCk7XG4gICAgfVxuICB9XG4gIG9uVGhlbWVDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RUaGVtZSA9IHRoaXMudGhlbWU7XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnNldFRoZW1lKHRoaXMudGhlbWUpO1xuICAgIH1cbiAgfVxuICBvbkNvbmZpZ0NoYW5nZShuZXdDb25maWcsIG9sZENvbmZpZykge1xuICAgIEJhc2VVdGlsLkxvZygnYXJjZ2lzLWluZm9ncmFwaGljLXNlbGVjdG9yIENvbmZpZyBjaGFuZ2VkOicsIG5ld0NvbmZpZyk7XG4gICAgLy8gbGV0IGNoYW5nZWQ6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgaWYgKG5ld0NvbmZpZyAmJiBBQ0xVdGlscy5oYXNUZXh0KG5ld0NvbmZpZykpIHtcbiAgICAgICAgY29uc3QgbmV3Q2ZnID0gSlNPTi5wYXJzZShuZXdDb25maWcpO1xuICAgICAgICBjb25zdCBvbGRDZmcgPSAob2xkQ29uZmlnICYmIEFDTFV0aWxzLmhhc1RleHQob2xkQ29uZmlnKSkgPyBKU09OLnBhcnNlKG9sZENvbmZpZykgOiBudWxsO1xuICAgICAgICAvLyBjaGFuZ2VkID0gdGhpcy5fYmFzZS51cGRhdGVDb25maWcobmV3Q2ZnLCBvbGRDZmcpO1xuICAgICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKG5ld0NmZywgb2xkQ2ZnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgYXN5bmMgZ2V0Q29uZmlnKCkge1xuICAgIGNvbnN0IG15Q2ZnID0gdGhpcy5iYXNlQ29uZmlnO1xuICAgIHJldHVybiBteUNmZztcbiAgfVxuICAvLyBpbmZvZ3JhcGhpYyB0cmVlIHJlcG9ydCBpZCBjaGFuZ2VkXG4gIHJlcG9ydFNlbGVjdGVkRXZlbnRIYW5kbGVyKGUpIHtcbiAgICBjb25zdCByZXBvcnQgPSBlLmRldGFpbD8ucmVwb3J0O1xuICAgIGlmIChyZXBvcnQ/LmlkICYmIHJlcG9ydD8ubmFtZSkge1xuICAgICAgdGhpcy5zZWxlY3RlZFJlcG9ydElkID0gcmVwb3J0LmlkO1xuICAgICAgdGhpcy5vblNlbGVjdGVkUmVwb3J0SWRDaGFuZ2VkKCk7XG4gICAgICB0aGlzLl9oaWRlUGxhY2Vob2xkZXJBbmRTaG93TGFiZWwocmVwb3J0Lm5hbWUpO1xuICAgICAgdGhpcy5oaWRlUG9wb3ZlcigpO1xuICAgIH1cbiAgfVxuICAvLyBEZWZhdWx0IGluZm9ncmFwaGljIHNlbGVjdGVkXG4gIGRlZmF1bHRSZXBvcnRTZWxlY3RlZEV2ZW50SGFuZGxlcihlKSB7XG4gICAgY29uc3QgcmVwb3J0SWQgPSBlLmRldGFpbD8ucmVwb3J0SWQ7XG4gICAgY29uc3QgcmVwb3J0TmFtZSA9IGUuZGV0YWlsPy5uYW1lO1xuICAgIGlmIChyZXBvcnRJZCAmJiBBQ0xVdGlscy5oYXNUZXh0KHJlcG9ydElkKSkge1xuICAgICAgdGhpcy5zZWxlY3RlZFJlcG9ydElkID0gcmVwb3J0SWQ7XG4gICAgICB0aGlzLm9uU2VsZWN0ZWRSZXBvcnRJZENoYW5nZWQoKTtcbiAgICAgIGlmIChyZXBvcnROYW1lKSB7XG4gICAgICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fZWxlbWVudElkcy5sYWJlbCk7XG4gICAgICAgIGlmIChlbGVtKSB7XG4gICAgICAgICAgZWxlbS5pbm5lclRleHQgPSByZXBvcnROYW1lO1xuICAgICAgICAgIHRoaXMuaGlkZVBvcG92ZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBvblVwZGF0ZVVJKCkgeyB9XG4gIF9sb2FkSW5zdGFuY2VzKCkge1xuICAgIC8vIHRoaXMuc2VhcmNoUGxhY2Vob2xkZXJcbiAgICBpZiAoIXRoaXMuX2luc3RhbmNlSWQpXG4gICAgICB0aGlzLl9pbnN0YW5jZUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KS5pZDtcbiAgICBpZiAoIXRoaXMuX2VsZW1lbnRJZHMubGFiZWwpXG4gICAgICB0aGlzLl9lbGVtZW50SWRzLmxhYmVsID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkRHJvcGRvd25MYWJlbFByZWZpeCkuaWQ7XG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLmJ1dHRvbilcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuYnV0dG9uID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkQnV0dG9uUHJlZml4KS5pZDtcbiAgICBpZiAoIXRoaXMuX2VsZW1lbnRJZHMucG9wb3ZlcilcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMucG9wb3ZlciA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFBvcG92ZXJQcmVmaXgpLmlkO1xuICAgIGlmICghdGhpcy5fZWxlbWVudElkcy5jb250ZW50KVxuICAgICAgdGhpcy5fZWxlbWVudElkcy5jb250ZW50ID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUG9wb3ZlckNvbnRlbnRQcmVmaXgpLmlkO1xuICAgIGlmICghdGhpcy5fZWxlbWVudElkcy5hcnJvdylcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuYXJyb3cgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faWREcm9wZG93bkFycm93UHJlZml4KS5pZDtcbiAgICBpZiAoIXRoaXMuX2VsZW1lbnRJZHMucmVwb3J0cylcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMucmVwb3J0cyA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFJlcG9ydExpc3RQcmVmaXgpLmlkO1xuICB9XG4gIHNldExvY2FsZVN0cmluZ3MoKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJzZXRMb2NhbGVTdHJpbmdzKCkgZm9yIGluZm9ncmFwaGljLXNlbGVjdG9yXCIpXG4gICAgLy8gZXhhbXBsZTpcbiAgICAvLyB0aGlzLmxhYmVscyA9IHtcbiAgICAvLyAgIGRyb3Bkb3duTG9jYXRpb246IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2FkZHJlc3MtbG9jYXRpb24tb3ItcGxhY2UnKSxcbiAgICAvLyAgIGRyb3Bkb3duQm91bmRhcnk6IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2JvdW5kYXJ5LW5hbWUnKSxcbiAgICAvLyAgIGRyb3Bkb3duQWxsOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdkcm9wZG93bi1hbGwnKSxcbiAgICAvLyAgIHdhdGVybWFya0FsbDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignYWxsLXBsYWNlaG9sZGVyJyksXG4gICAgLy8gICB3YXRlcm1hcmtMb2NhdGlvbjogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZW50ZXItYWRkcmVzcy1sb2Mtb3ItcGxhY2UnKSxcbiAgICAvLyAgIHdhdGVybWFya0JvdW5kYXJ5OiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdlbnRlci1ib3VuZGFyeS1uYW1lJylcbiAgICAvLyB9XG4gICAgLy8gdGhpcy5zaG93U2VhcmNoID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignc2hvdy1zZWFyY2gnKVxuICAgIC8vIHRoaXMuc2VhcmNoUGxhY2Vob2xkZXIgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtcGxhY2Vob2xkZXInKVxuICAgIC8vIHRoaXMuc2VhcmNoTGFiZWwgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtbGFiZWwnKVxuICAgIC8vIHRoaXMuc2VhcmNoQWxsID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZHJvcGRvd24tYWxsJylcbiAgICAvLyB0aGlzLnNlYXJjaEFsbFBsYWNlaG9sZGVyID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignYWxsLXBsYWNlaG9sZGVyJylcbiAgICAvLyB0aGlzLnNlYXJjaFBsYWNlaG9sZGVyU2hvcnQgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtcGxhY2Vob2xkZXItc2hvcnQnKVxuICAgIC8vIHRoaXMuc2VhcmNoRW50ZXJCb3VuZGFyeSA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3NlYXJjaC1lbnRlci1ib3VuZGFyeScpXG4gICAgLy8gdGhpcy5zZWFyY2hCb3VuZGFyeSA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3NlYXJjaC1ib3VuZGFyeScpXG4gIH1cbiAgLy8gU3RlbmNpbCBsaWZlY3ljbGUgLSBjYWxsZWQgb25jZSBhZnRlciBjb21wb25lbnQgaXMgZmlyc3QgY29ubmVjdGVkIHRvIHRoZSBET01cbiAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgLy8gTG9hZCBwcm9wcyB0aGF0IG1heSBoYXZlIHZhbHVlcyBidXQgbm8gV2F0Y2hlcyBoYXZlIHRyaWdnZXJlZCB5ZXRcbiAgICBpZiAodGhpcy5lbnYpIHtcbiAgICAgIHRoaXMub25FbnZDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnRva2VuKSB7XG4gICAgICB0aGlzLm9uVG9rZW5DaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnVzZXJuYW1lKSB7XG4gICAgICB0aGlzLm9uVXNlcm5hbWVDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxhbmdDb2RlKSB7XG4gICAgICB0aGlzLm9uTGFuZ0NvZGVDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdlb2VucmljaG1lbnRVcmwpIHtcbiAgICAgIHRoaXMub25HZW9lbnJpY2htZW50VXJsQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5zb3VyY2VDb3VudHJ5KSB7XG4gICAgICB0aGlzLm9uU291cmNlQ291bnRyeUNoYW5nZWQoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29uZmlnKSB7XG4gICAgICB0aGlzLm9uQ29uZmlnQ2hhbmdlKHRoaXMuY29uZmlnLCAnJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNlbGVjdGVkUmVwb3J0SWQpIHtcbiAgICAgIHRoaXMub25TZWxlY3RlZFJlcG9ydElkQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy50aGVtZSkge1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnNldFRoZW1lKHRoaXMudGhlbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSgnbGlnaHQnKTtcbiAgICB9XG4gICAgdGhpcy5fbG9hZEluc3RhbmNlcygpO1xuICAgIC8vIGlmICghdGhpcy5iYXNlQ29uZmlnLmhhc1N1YkNvbXBvbmVudHMoKSkge1xuICAgIC8vICAgLy8gYWRkIHRoZSBzdGVwJ3Mgc3ViIGNvbXBvbmVudHMgZm9yIGNvbmZpZyB1cGRhdGVzXG4gICAgLy8gICB0aGlzLmJhc2VDb25maWcuYWRkU3ViQ29tcG9uZW50cyhbe25hbWU6J3RyZWUnLCBAQEBAIHRoZSBzdWJjb21wb25lbnQncyBiYXNlQ29uZmlnIEBAQH1dKTtcbiAgICAvLyB9XG4gIH1cbiAgLy8gU3RlbmNpbCBsaWZlY3ljbGUgLSBjYWxsZWQganVzdCBhZnRlciBjb21wb25lbnQgdXBkYXRlcywgYnV0IG5vdCBjYWxsZWQgZHVyaW5nIGZpcnN0IHJlbmRlcigpXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBpZiAoc2VsZi5iYXNlQ29uZmlnKSB7XG4gICAgICBzZWxmLmJhc2VDb25maWcub25Db21wb25lbnRIYXNSZW5kZXJlZCgpO1xuICAgIH1cbiAgfVxuICBvbkNsaWNrRHJvcGRvd24oZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5vblVwZGF0ZVBvcG92ZXJTaXplKCk7XG4gICAgdGhpcy5fcG9wb3ZlcklzT3BlbiA9ICF0aGlzLl9wb3BvdmVySXNPcGVuO1xuICAgIGlmICh0aGlzLl9wb3BvdmVySXNPcGVuKSB7XG4gICAgICB0aGlzLmluZm9ncmFwaGljU2VsZWN0b3JQb3B1cE9wZW5lZC5lbWl0KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBDbG9zZWQuZW1pdCgpO1xuICAgIH1cbiAgICBjb25zdCBhcnJvdyA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLmFycm93KTtcbiAgICBpZiAoYXJyb3cpIHtcbiAgICAgIGlmICh0aGlzLl9wb3BvdmVySXNPcGVuKSB7XG4gICAgICAgIGFycm93LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdG9yLWRyb3Atb3BlbicpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdG9yLWRyb3Atb3BlbicpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gU3RlbmNpbCBsaWZlY3ljbGUgLSBjYWxsZWQgb25jZSBhZnRlciBjb21wb25lbnQgaXMgZnVsbHkgbG9hZGVkIGFuZCAxc3QgcmVuZGVyIG9jY3VycmVkXG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgQmFzZVV0aWwuTG9nKCdhcmNnaXMtaW5mb2dyYXBoaWMtc2VsZWN0b3IgZGlkVXBkYXRlJyk7XG4gICAgc2VsZi5fbG9hZEluc3RhbmNlcygpO1xuICAgIGZ1bmN0aW9uIF9jbGlja2VkKGUpIHtcbiAgICAgIHNlbGYub25DbGlja0Ryb3Bkb3duLmNhbGwoc2VsZiwgZSk7XG4gICAgfVxuICAgIC8vIENvbXBvbmVudCBjb25maWd1cmF0aW9uIG5vdGlmeSBzdWItY29tcG9uZW50cyBpcyBkdXBsaWNhdGVkIGluIGFsbCBjb21wb25lbnRzXG4gICAgLy8gaWYgKCFzZWxmLl9iYXNlLmhhc1N1YkNvbXBvbmVudHMoKSkge1xuICAgIC8vICAgLy8gYWRkIHRoZSB3b3JrZmxvdyBzdWIgY29tcG9uZW50cyBmb3IgY29uZmlnIHVwZGF0ZXNcbiAgICAvLyAgIHNlbGYuX2Jhc2UuYWRkU3ViQ29tcG9uZW50cyhbc2VsZi5fZWxlbWVudElkcy5saXN0XSk7XG4gICAgLy8gICAvL1xuICAgIC8vIH1cbiAgICBjb25zdCBkcm9wQnV0dG9uID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHNlbGYuZWwsIHRoaXMuX2VsZW1lbnRJZHMuYnV0dG9uKTtcbiAgICBpZiAoZHJvcEJ1dHRvbikge1xuICAgICAgZHJvcEJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIF9jbGlja2VkKTtcbiAgICAgIGRyb3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XG4gICAgfVxuICAgIGNvbnN0IGRyb3BMYWJlbCA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbChzZWxmLmVsLCB0aGlzLl9lbGVtZW50SWRzLmxhYmVsKTtcbiAgICBpZiAoZHJvcExhYmVsKSB7XG4gICAgICBkcm9wTGFiZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XG4gICAgICBkcm9wTGFiZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XG4gICAgfVxuICAgIGNvbnN0IGRyb3BBcnJvdyA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbChzZWxmLmVsLCB0aGlzLl9lbGVtZW50SWRzLmFycm93KTtcbiAgICBpZiAoZHJvcEFycm93KSB7XG4gICAgICBkcm9wQXJyb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XG4gICAgICBkcm9wQXJyb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xpY2tlZCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9vblJlc2l6ZSgpIHtcbiAgICAgIHNlbGYuaGlkZVBvcG92ZXIoKTtcbiAgICAgIHNlbGYub25VcGRhdGVQb3BvdmVyU2l6ZSgpO1xuICAgIH1cbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgX29uUmVzaXplKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgX29uUmVzaXplKTtcbiAgICBpZiAoc2VsZi5iYXNlQ29uZmlnKSB7XG4gICAgICBzZWxmLmJhc2VDb25maWcub25Db21wb25lbnRIYXNSZW5kZXJlZCgpO1xuICAgIH1cbiAgfVxuICBoaWRlUG9wb3ZlcigpIHtcbiAgICBjb25zdCBwb3BvdmVyID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMuZWwsIHRoaXMuX2VsZW1lbnRJZHMucG9wb3Zlcik7XG4gICAgaWYgKHBvcG92ZXIpIHtcbiAgICAgIHBvcG92ZXIuc2V0QXR0cmlidXRlKCdvcGVuJywgJ2ZhbHNlJyk7XG4gICAgfVxuICAgIHRoaXMuX3BvcG92ZXJJc09wZW4gPSBmYWxzZTtcbiAgICB0aGlzLmluZm9ncmFwaGljU2VsZWN0b3JQb3B1cENsb3NlZC5lbWl0KCk7XG4gICAgY29uc3QgYXJyb3cgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5hcnJvdyk7XG4gICAgaWYgKGFycm93KSB7XG4gICAgICBhcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rvci1kcm9wLW9wZW4nKTtcbiAgICB9XG4gIH1cbiAgb25VcGRhdGVQb3BvdmVyU2l6ZSgpIHtcbiAgICBpZiAoIXRoaXMuZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGZ1bGxDb250ZW50SHQgPSAxMDA7XG4gICAgY29uc3QgbWluQ29udGVudEh0ID0gMTAwO1xuICAgIGNvbnN0IG1heFBvcG92ZXJXdCA9IDQ1MDtcbiAgICBjb25zdCB2cGFkID0gMzY7XG4gICAgY29uc3QgaHBhZCA9IDE2O1xuICAgIGNvbnN0IGNsaWVudEh0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBjbGllbnRXdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBicnIgPSB0aGlzLmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IGh0QWJvdmUgPSBicnIudG9wO1xuICAgIGNvbnN0IGh0QmVsb3cgPSBjbGllbnRIdCAtIChicnIudG9wICsgYnJyLmhlaWdodCkgKyB3aW5kb3cuc2Nyb2xsWTtcbiAgICBsZXQgZnVsbENvbnRlbnRXdCA9IGNsaWVudFd0IC8gMjtcbiAgICBjb25zdCB3dFJpZ2h0ID0gY2xpZW50V3QgLSBicnIubGVmdCArIHdpbmRvdy5zY3JvbGxYO1xuICAgIGlmICgoaHRCZWxvdyA8IG1pbkNvbnRlbnRIdCAmJiBodEJlbG93IDwgaHRBYm92ZSkgfHxcbiAgICAgIChodEFib3ZlID4gaHRCZWxvdyAmJiBodEFib3ZlID49IG1pbkNvbnRlbnRIdCkpIHtcbiAgICAgIC8vIHBvcG92ZXIgbWF4IGhlaWdodCA9IGh0IGFib3ZlIGlmIHRoYXQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gYmVsb3dcbiAgICAgIGZ1bGxDb250ZW50SHQgPSBodEFib3ZlIC0gdnBhZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBmdWxsQ29udGVudEh0ID0gaHRCZWxvdyAtIHZwYWQ7XG4gICAgfVxuICAgIGlmICgod3RSaWdodCA8IGJyci53aWR0aCAmJiBicnIubGVmdCA+IHd0UmlnaHQpIHx8XG4gICAgICAoYnJyLmxlZnQgPiB3dFJpZ2h0ICYmIGJyci5sZWZ0ID49IGJyci53aWR0aCkpIHtcbiAgICAgIGZ1bGxDb250ZW50V3QgPSBicnIubGVmdCAtIGhwYWQ7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgZnVsbENvbnRlbnRXdCA9IGNsaWVudFd0IC0gYnJyLmxlZnQgLSBocGFkO1xuICAgIH1cbiAgICBmdWxsQ29udGVudFd0ID0gTWF0aC5taW4obWF4UG9wb3Zlcld0LCBmdWxsQ29udGVudFd0KTtcbiAgICAvLyBmdWxsQ29udGVudFd0ID0gTWF0aC5tYXgobWluUG9wb3Zlcld0LCBNYXRoLm1pbih3dFJpZ2h0IC0gaHBhZCwgbWF4UG9wb3Zlcld0KSlcbiAgICBjb25zdCBjb250ZW50RWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLmNvbnRlbnQpO1xuICAgIGlmIChjb250ZW50RWxlbSkge1xuICAgICAgaWYgKGNvbnRlbnRFbGVtKSB7XG4gICAgICAgIGNvbnRlbnRFbGVtLnN0eWxlLmhlaWdodCA9IGZ1bGxDb250ZW50SHQgKyAncHgnO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwb3BvdmVyRWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLnBvcG92ZXIpO1xuICAgIGlmIChwb3BvdmVyRWxlbSkge1xuICAgICAgcG9wb3ZlckVsZW0uc3R5bGUud2lkdGggPSBNYXRoLm1pbig0NTAsIGZ1bGxDb250ZW50V3QpICsgJ3B4JztcbiAgICB9XG4gICAgLy8gbm90aWZ5IHRyZWUgdGhhdCBvdXIgc2l6ZSBtYXkgaGF2ZSBjaGFuZ2VkXG4gICAgY29uc3QgdHJlZSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLnJlcG9ydHMpO1xuICAgIGlmICh0cmVlKSB7XG4gICAgICB0cmVlLnVwZGF0ZUxheW91dCgpO1xuICAgIH1cbiAgfVxuICBfc2hvd1BsYWNlaG9sZGVyKCkge1xuICAgIGNvbnN0IHR4dCA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3NlbGVjdC1pbmZvZ3JhcGhpYycpO1xuICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fZWxlbWVudElkcy5sYWJlbCk7XG4gICAgaWYgKGVsZW0pIHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0b3ItbGFiZWwtcGxhY2Vob2xkZXInKTtcbiAgICAgIGVsZW0uaW5uZXJUZXh0ID0gdHh0O1xuICAgIH1cbiAgfVxuICBfaGlkZVBsYWNlaG9sZGVyQW5kU2hvd0xhYmVsKHJlcGxhY2VtZW50VGV4dCkge1xuICAgIGNvbnN0IGVsZW0gPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcywgdGhpcy5fZWxlbWVudElkcy5sYWJlbCk7XG4gICAgaWYgKGVsZW0pIHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0b3ItbGFiZWwtcGxhY2Vob2xkZXInKTtcbiAgICAgIGlmIChyZXBsYWNlbWVudFRleHQpIHtcbiAgICAgICAgZWxlbS5pbm5lclRleHQgPSByZXBsYWNlbWVudFRleHQ7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICAvLyBjb25zdCBjZmcgPSB0aGlzLmJhc2VDb25maWcuY29uZmlnXG4gICAgLy8gbGV0IHJlcG9ydExpc3Q6IHN0cmluZyA9ICd7fSdcbiAgICBpZiAoIXRoaXMuYmFzZUNvbmZpZy5jb25maWc/LnVzZXJuYW1lIHx8ICFBQ0xVdGlscy5oYXNUZXh0KHRoaXMuYmFzZUNvbmZpZy5jb25maWcudXNlcm5hbWUpKSB7XG4gICAgICBCYXNlVXRpbC5FcnJvcignRVJST1I6IGFyY2dpcy1pbmZvZ3JhcGhpYy1zZWxlY3RvciBtaXNzaW5nIFt1c2VybmFtZV0nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmJhc2VDb25maWcuY29uZmlnPy50b2tlbiB8fCAhQUNMVXRpbHMuaGFzVGV4dCh0aGlzLmJhc2VDb25maWcuY29uZmlnLnRva2VuKSkge1xuICAgICAgQmFzZVV0aWwuRXJyb3IoJ0VSUk9SOiBhcmNnaXMtaW5mb2dyYXBoaWMtc2VsZWN0b3IgbWlzc2luZyBbdG9rZW5dJyk7XG4gICAgfVxuICAgIGNvbnN0IHBUZXh0ID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignc2VsZWN0LWluZm9ncmFwaGljJyk7XG4gICAgY29uc3QgcG9wU3R5bGUgPSB7XG4gICAgICAvLyAncGFkZGluZy1yaWdodCc6ICcyMHB4JyxcbiAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXG4gICAgICAndG9wJzogJzBweCcsXG4gICAgICAnbGVmdCc6ICcwcHgnLFxuICAgICAgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGUoLTMxMnB4LCA3cHgpJyxcbiAgICAgICdib3JkZXInOiAnbm9uZScsXG4gICAgICAnYm94LXNoYWRvdyc6ICdub25lJyxcbiAgICAgICd3aWR0aCc6ICc0NTBweCdcbiAgICB9O1xuICAgIGNvbnN0IHBvcG92ZXJTdHlsZSA9IHtcbiAgICAgICdwYWRkaW5nJzogJzZweCcsXG4gICAgICAnd2lkdGgnOiAnMzAwcHgnLFxuICAgICAgJ2hlaWdodCc6ICcyMDBweCdcbiAgICB9O1xuICAgIGNvbnN0IHBvcHVwQ2xvc2VIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgdGhpcy5pbmZvZ3JhcGhpY1NlbGVjdG9yUG9wdXBDbG9zZWQuZW1pdCgpO1xuICAgIH07XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgaWQ6IHRoaXMuX2luc3RhbmNlSWQsIGNsYXNzOiBcImluZm9ncmFwaGljU2VsZWN0b3JPdXRlclwiIH0sIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fZWxlbWVudElkcy5idXR0b24sIGNsYXNzOiBcInNlbGVjdG9yLWRyb3Bkb3duXCIgfSwgaChcImRpdlwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmxhYmVsLCBjbGFzczogXCJzZWxlY3Rvci1kcm9wZG93bi1sYWJlbFwiIH0sIHBUZXh0KSwgaChcInN2Z1wiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmFycm93LCBjbGFzczogXCJzZWxlY3Rvci1kcm9wZG93bi1hcnJvd1wiLCB3aWR0aDogXCIyNFwiLCBoZWlnaHQ6IFwiMjRcIiwgdmlld0JveDogXCIwIDAgMTYgMTZcIiwgZmlsbDogXCJub25lXCIsIHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgfSwgaChcInBhdGhcIiwgeyBmaWxsOiBcImN1cnJlbnRDb2xvclwiLCBcImZpbGwtcnVsZVwiOiBcImV2ZW5vZGRcIiwgc3Ryb2tlOiBcImN1cnJlbnRDb2xvclwiLCBkOiBcIk0yLjE0NiA0LjY1M2EuNDg1LjQ4NSAwIDAgMSAuNzA4IDBMOCAxMC4yNGw1LjE0Ni01LjU4N2EuNDg1LjQ4NSAwIDAgMSAuNzA4IDAgLjUzOC41MzggMCAwIDEgMCAuNzM4bC01LjUgNS45NTZhLjQ4NS40ODUgMCAwIDEtLjcwOCAwbC01LjUtNS45NTZhLjUzOC41MzggMCAwIDEgMC0uNzM4WlwiLCBcImNsaXAtcnVsZVwiOiBcImV2ZW5vZGRcIiB9KSkpLCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgaWQ6IHRoaXMuX2VsZW1lbnRJZHMucG9wb3Zlciwgc3R5bGU6IHBvcFN0eWxlLCBsYWJlbDogXCJDaG9vc2UgaW5mb2dyYXBoaWNzXCIsIFwicG9pbnRlci1kaXNhYmxlZFwiOiBcInRydWVcIiwgXCJvdmVybGF5LXBvc2l0aW9uaW5nXCI6IFwiYWJzb2x1dGVcIiwgcGxhY2VtZW50OiBcImJvdHRvbS1zdGFydFwiLCBcIm9mZnNldC1za2lkZGluZ1wiOiBcIjRcIiwgXCJhdXRvLWNsb3NlXCI6IFwidHJ1ZVwiLCBcInJlZmVyZW5jZS1lbGVtZW50XCI6IHRoaXMuX2VsZW1lbnRJZHMuYnV0dG9uLCBvbkNhbGNpdGVQb3BvdmVyQ2xvc2U6IHBvcHVwQ2xvc2VIYW5kbGVyIH0sIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fZWxlbWVudElkcy5jb250ZW50LCBzdHlsZTogcG9wb3ZlclN0eWxlIH0sIGgoXCJhcmNnaXMtaW5mb2dyYXBoaWMtdHJlZVwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLnJlcG9ydHMsIHBvcnRhbE9ubGluZUdFUHJveHk6IHRoaXMucG9ydGFsT25saW5lR0VQcm94eSwgY2xhc3M6IFwiYXJjU2VsLXJlcG9ydHNcIiwgY29uZmlnOiB0aGlzLmJhc2VDb25maWcuZ2V0Q29uZmlnU3RyaW5nKCkgfSkpKSkpO1xuICB9XG4gIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICBcImVudlwiOiBbXCJvbkVudkNoYW5nZWRcIl0sXG4gICAgXCJ0b2tlblwiOiBbXCJvblRva2VuQ2hhbmdlZFwiXSxcbiAgICBcInVzZXJuYW1lXCI6IFtcIm9uVXNlcm5hbWVDaGFuZ2VkXCJdLFxuICAgIFwibGFuZ0NvZGVcIjogW1wib25MYW5nQ29kZUNoYW5nZWRcIl0sXG4gICAgXCJnZW9lbnJpY2htZW50VXJsXCI6IFtcIm9uR2VvZW5yaWNobWVudFVybENoYW5nZWRcIl0sXG4gICAgXCJzZWxlY3RlZFJlcG9ydElkXCI6IFtcIm9uU2VsZWN0ZWRSZXBvcnRJZENoYW5nZWRcIl0sXG4gICAgXCJzb3VyY2VDb3VudHJ5XCI6IFtcIm9uU291cmNlQ291bnRyeUNoYW5nZWRcIl0sXG4gICAgXCJ0aGVtZVwiOiBbXCJvblRoZW1lQ2hhbmdlZFwiXSxcbiAgICBcImNvbmZpZ1wiOiBbXCJvbkNvbmZpZ0NoYW5nZVwiXVxuICB9OyB9XG59O1xuQXJjZ2lzSW5mb2dyYXBoaWNTZWxlY3Rvci5zdHlsZSA9IGFyY2dpc0luZm9ncmFwaGljU2VsZWN0b3JDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0luZm9ncmFwaGljU2VsZWN0b3IgYXMgYXJjZ2lzX2luZm9ncmFwaGljX3NlbGVjdG9yIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1pbmZvZ3JhcGhpYy1zZWxlY3Rvcl8yLmVudHJ5LmpzLm1hcCIsImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgeyBVIGFzIFV0aWxzLCBhIGFzIEJhc2VVdGlsLCBBIGFzIEFDTFV0aWxzLCBFIGFzIEVsZW1lbnRJZHMsIEIgYXMgQmFSZXBvcnRzTGFuZ3VhZ2UgfSBmcm9tICcuL0VsZW1lbnRJZHMtZjdkMjU3ZTguanMnO1xuaW1wb3J0IHsgRSBhcyBFbnZpcm9ubWVudHMgfSBmcm9tICcuL0dFQ2xpZW50LTFhODNhNjU3LmpzJztcbmltcG9ydCB7IHMgYXMgc2V0VG9rZW4sIGcgYXMgZ2V0SW5mb2dyYXBoaWNUZW1wbGF0ZXNMaXN0IH0gZnJvbSAnLi9hcmNnaXNSZXBvcnRzLWExZGMyNmFhLmpzJztcblxudmFyIF9hO1xuY2xhc3MgUHJldmlld1BvcHVwIHtcbiAgc3RhdGljIG5leHRDYWxsYmFjayhmKSB7XG4gICAgaWYgKGYpIHtcbiAgICAgIHRoaXMuX2NhbGxiYWNrTmV4dCA9IGY7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBwcmV2aW91c0NhbGxiYWNrKGYpIHtcbiAgICBpZiAoZikge1xuICAgICAgdGhpcy5fY2FsbGJhY2tQcmV2ID0gZjtcbiAgICB9XG4gIH1cbiAgc3RhdGljIGhpZGVQb3B1cCgpIHtcbiAgICAvLyByZW1vdmUgcG9wdXAgZWxlbWVudHNcbiAgICB0aGlzLl9jYW5jZWxUaW1lcigpO1xuICAgIHRoaXMuX3JlbW92ZVBvcHVwKCk7XG4gICAgdGhpcy5fcmVwb3J0SWQgPSAnJztcbiAgfVxuICBzdGF0aWMgX29uVGltZXJUaWNrKCkge1xuICAgIHRoaXMuX3RpbWVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaGlkZVBvcHVwKCk7XG4gIH1cbiAgc3RhdGljIF9vbkdvVG9OZXh0KCkge1xuICAgIGlmICh0aGlzLl9jYWxsYmFja05leHQpIHtcbiAgICAgIHRoaXMuX2NhbGxiYWNrTmV4dCh0aGlzLl9yZXBvcnRJZCk7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBfb25Hb1RvUHJldigpIHtcbiAgICBpZiAodGhpcy5fY2FsbGJhY2tQcmV2KSB7XG4gICAgICB0aGlzLl9jYWxsYmFja1ByZXYodGhpcy5fcmVwb3J0SWQpO1xuICAgIH1cbiAgfVxuICBzdGF0aWMgX3N0YXJ0VGltZXIoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5fY2FuY2VsVGltZXIoKTtcbiAgICBzZWxmLl90aW1lciA9IHNldFRpbWVvdXQoKCkgPT4geyBzZWxmLl9vblRpbWVyVGljay5jYWxsKHNlbGYpOyB9LCB0aGlzLnRpbWVvdXRTZWNvbmRzICogMTAwMCk7XG4gIH1cbiAgc3RhdGljIF9jYW5jZWxUaW1lcigpIHtcbiAgICBpZiAodGhpcy5fdGltZXIpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lcik7XG4gICAgICB0aGlzLl90aW1lciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbiAgc3RhdGljIF9yZXNldFRpbWVyKCkge1xuICAgIHRoaXMuX2NhbmNlbFRpbWVyKCk7XG4gICAgdGhpcy5fc3RhcnRUaW1lcigpO1xuICB9XG4gIHN0YXRpYyBfcmVtb3ZlUG9wdXAoKSB7XG4gICAgaWYgKHRoaXMuX3BvcHVwRWxlbWVudClcbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5yZW1vdmUoKTtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gIH1cbiAgc3RhdGljIF9nZW5lcmF0ZVBvcHVwKHksIHJhdGlvLCBzcmMpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAvLyBjcmVhdGUgdGhlIGZ1bGwgc2l6ZSBtYXNrIGRpdiB0aGF0IGlzIHRyYW5zcGFyZW50XG4gICAgY29uc3QgbWFza0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIG1hc2tEaXYuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIG1hc2tEaXYuc3R5bGUubGVmdCA9ICcwJztcbiAgICBtYXNrRGl2LnN0eWxlLnRvcCA9ICcwJztcbiAgICBtYXNrRGl2LnN0eWxlLndpZHRoID0gKHRoaXMuX2NvbnRhaW5lci5vZmZzZXRXaWR0aCAtIHRoaXMuX3JpZ2h0UGFkKSArICdweCc7XG4gICAgbWFza0Rpdi5zdHlsZS5oZWlnaHQgPSB0aGlzLl9jb250YWluZXIub2Zmc2V0SGVpZ2h0ICsgJ3B4JztcbiAgICBtYXNrRGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCc7XG4gICAgbWFza0Rpdi5zdHlsZS56SW5kZXggPSAnOTAwJztcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBtYXNrRGl2O1xuICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9wb3B1cEVsZW1lbnQpO1xuICAgIG1hc2tEaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4geyBzZWxmLmhpZGVQb3B1cCgpOyB9KTtcbiAgICAvLyBjcmVhdGUgdGhlIGltYWdlIGRpdiB3aXRoIGNhbGN1bGF0ZWQgc2l6ZSBhbmQgcGxhY2VtZW50XG4gICAgdGhpcy5fcGxhY2VJbWFnZURpdih5LCByYXRpbywgc3JjKTtcbiAgfVxuICBzdGF0aWMgX3BsYWNlSW1hZ2VEaXYoeSwgcmF0aW8sIHVybCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCB5LCB1cmwpXG4gICAgdHJ5IHtcbiAgICAgIC8vSW1hZ2UgcGFkZGluZyBjb25zdGFudHNcbiAgICAgIGNvbnN0IHBhZCA9IDIwO1xuICAgICAgY29uc3QgcG9wRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgbGV0IG8gPSB7XG4gICAgICAgIGNsaWNrOiB7IHk6IHkgfSxcbiAgICAgICAgcG9wdXA6IHsgdG9wOiAwLCByaWdodDogMCwgd3Q6IDEsIGh0OiAxIH0sXG4gICAgICAgIGFkanVzdGVkQ29udEh0OiAwLFxuICAgICAgICBhZGp1c3RlZENvbnRXdDogMCxcbiAgICAgICAgcmF0aW86IHJhdGlvXG4gICAgICB9O1xuICAgICAgby5hZGp1c3RlZENvbnRIdCA9IHRoaXMuX3BvcHVwRWxlbWVudC5vZmZzZXRIZWlnaHQgLSAocGFkICogMik7XG4gICAgICBvLmFkanVzdGVkQ29udFd0ID0gdGhpcy5fcG9wdXBFbGVtZW50Lm9mZnNldFdpZHRoIC0gcGFkO1xuICAgICAgLy8gcGxhY2UgcG9wdXAgY2VudGVyZWQgYW5kIHRvIHRoZSBsZWZ0IG9mIHRoZSBjbGljayBwb2ludCB4LHkgYW5kIGZpdCBhcyBuZWVkZWRcbiAgICAgIC8vIElmIFcgPj0gSFxuICAgICAgaWYgKG8ucmF0aW8gPj0gMSkge1xuICAgICAgICAvLyB3aWR0aCA+PSBoZWlnaHRcbiAgICAgICAgby5wb3B1cC53dCA9IG8uYWRqdXN0ZWRDb250V3Q7XG4gICAgICAgIG8ucG9wdXAuaHQgPSBvLnBvcHVwLnd0IC8gby5yYXRpbztcbiAgICAgICAgaWYgKG8ucG9wdXAuaHQgPiBvLmFkanVzdGVkQ29udEh0KSB7XG4gICAgICAgICAgLy8gcmVkdWNlIHRhcmdldCBoZWlnaHQgdG8gZml0XG4gICAgICAgICAgby5wb3B1cC5odCA9IG8uYWRqdXN0ZWRDb250SHQ7XG4gICAgICAgICAgby5wb3B1cC53dCA9IG8uYWRqdXN0ZWRDb250SHQgKiBvLnJhdGlvO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgLy8gaGVpZ2h0ID4gd2lkdGhcbiAgICAgICAgby5wb3B1cC5odCA9IG8uYWRqdXN0ZWRDb250SHQ7XG4gICAgICAgIG8ucG9wdXAud3QgPSBvLnBvcHVwLmh0ICogby5yYXRpbztcbiAgICAgICAgaWYgKG8ucG9wdXAud3QgPiBvLmFkanVzdGVkQ29udFd0KSB7XG4gICAgICAgICAgLy8gcmVkdWNlIHRhcmdldCB3aWR0aCB0byBmaXRcbiAgICAgICAgICBvLnBvcHVwLnd0ID0gby5hZGp1c3RlZENvbnRXdDtcbiAgICAgICAgICBvLnBvcHVwLmh0ID0gby5hZGp1c3RlZENvbnRXdCAvIG8ucmF0aW87XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFBsYWNlIGluIGNvbnRhaW5lclxuICAgICAgY29uc3QgZGVzaXJlZFRvcCA9IE1hdGgubWF4KG8uY2xpY2sueSAtIChvLnBvcHVwLmh0IC8gMiksIHBhZCk7XG4gICAgICBjb25zdCBtYXhUb3AgPSBvLmFkanVzdGVkQ29udEh0IC0gby5wb3B1cC5odCArIHBhZDtcbiAgICAgIG8ucG9wdXAudG9wID0gTWF0aC5taW4oZGVzaXJlZFRvcCwgbWF4VG9wKTtcbiAgICAgIG8ucG9wdXAucmlnaHQgPSAwO1xuICAgICAgLy8gU2V0IHRoZSBwb3B1cCBwbGFjZW1lbnRcbiAgICAgIHBvcEVsZW0uc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgcG9wRWxlbS5zdHlsZS5yaWdodCA9IG8ucG9wdXAucmlnaHQgKyAncHgnO1xuICAgICAgcG9wRWxlbS5zdHlsZS50b3AgPSBvLnBvcHVwLnRvcCArICdweCc7XG4gICAgICBwb3BFbGVtLnN0eWxlLndpZHRoID0gby5wb3B1cC53dCArICdweCc7XG4gICAgICBwb3BFbGVtLnN0eWxlLmhlaWdodCA9IG8ucG9wdXAuaHQgKyAncHgnO1xuICAgICAgcG9wRWxlbS5zcmMgPSB1cmw7XG4gICAgICAvLyBBZGQgdGhlIGltYWdlIHNvdXJjZSB1cmxcbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hcHBlbmRDaGlsZChwb3BFbGVtKTtcbiAgICAgIHBvcEVsZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICBjb25zb2xlLmxvZygnJWMgUHJldmlld1BvcHVwIGVycm9yJywgJ2NvbG9yOnJlZDtmb250LXNpemU6MTBwdCcsIGV4KTtcbiAgICB9XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICB9XG59XG5fYSA9IFByZXZpZXdQb3B1cDtcbi8qKiBzaG93UG9wdXBcbipcbiogIGFwcGxpZXMgdGhlIHNyYyBhdHRyaWJ1dGUgdG8gdGhlIGltYWdlIGVsZW1lbnQgaW4gdGhlIHBvcHVwXG4qXG4qIEBwYXJhbSBpbWFnZVNyY1VybCAgPSB2YWxpZCB1cmwgZm9yIGltYWdlXG4qL1xuUHJldmlld1BvcHVwLnNob3cgPSAocmVwb3J0SWQsIGNvbnRhaW5lckVsZW1lbnQsIGNsaWNrWSwgcmF0aW9XMkgsIGltYWdlU3JjVXJsKSA9PiB7XG4gIGlmIChjb250YWluZXJFbGVtZW50ICYmIGNsaWNrWSAmJiBpbWFnZVNyY1VybCAmJiBVdGlscy5oYXNUZXh0KGltYWdlU3JjVXJsKSkge1xuICAgIGlmIChyZXBvcnRJZCA9PSBfYS5fcmVwb3J0SWQpIHtcbiAgICAgIF9hLl9yZXNldFRpbWVyKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgX2EuaGlkZVBvcHVwKCk7XG4gICAgICBpZiAoIV9hLnRpbWVvdXRTZWNvbmRzKSB7XG4gICAgICAgIF9hLnRpbWVvdXRTZWNvbmRzID0gNjtcbiAgICAgIH1cbiAgICAgIF9hLl9jb250YWluZXIgPSBjb250YWluZXJFbGVtZW50O1xuICAgICAgX2EuX3JlcG9ydElkID0gcmVwb3J0SWQ7XG4gICAgICBfYS5fZ2VuZXJhdGVQb3B1cChjbGlja1ksIHJhdGlvVzJILCBpbWFnZVNyY1VybCk7XG4gICAgICBfYS5fc3RhcnRUaW1lcigpO1xuICAgIH1cbiAgfVxufTtcblByZXZpZXdQb3B1cC5fcmlnaHRQYWQgPSA2MDtcblxuY29uc3QgYXJjZ2lzSW5mb2dyYXBoaWNUcmVlQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrfTo6c2xvdHRlZChbc2xvdD1cXFwiY2hpbGRyZW5cXFwiXSl7d2lkdGg6MTAwJX0ucmVwb3J0TGlzdHtmb250LXdlaWdodDoyMDB9LnJlcG9ydEl0ZW1ze2ZvbnQtd2VpZ2h0OjIwMDttYXJnaW4taW5saW5lLWVuZDowLjI1cmVtfS5yZXBvcnQtaXRlbS1idXR0b25ze3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjIzcHg7aGVpZ2h0OjI4cHh9LnJlcG9ydC1pdGVtLXByZXZpZXd7cG9zaXRpb246YWJzb2x1dGU7dG9wOjVweDt3aWR0aDoyMnB4O2hlaWdodDoyMnB4fS5yZXBvcnQtaXRlbS1kb3Rze3Bvc2l0aW9uOmFic29sdXRlO3RvcDo3cHg7bGVmdDozNHB4O3dpZHRoOjIycHg7aGVpZ2h0OjIycHh9LnJlcG9ydFRyZWV7cGFkZGluZy1ib3R0b206MnB4fS5pbmZvZ3JhcGhpYy10cmVlLWJ1c3l7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDp1cmwoLi9hc3NldHMvbGFyZ2VCdXN5LmdpZik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO3otaW5kZXg6OTk5O2Rpc3BsYXk6bm9uZX1jYWxjaXRlLXRyZWUtaXRlbSBbc2VsZWN0ZWRde2ZvbnQtd2VpZ2h0OmJvbGR9LnJlcG9ydC1pdGVtLWNvbnRlbnR7d2lkdGg6MTAwJTtoZWlnaHQ6MzJweDtkaXNwbGF5OmZsZXh9LnJlcG9ydC1yZWZyZXNoLWJ1dHRvbntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6OHB4O3JpZ2h0OjEwcHg7d2lkdGg6MThweDtoZWlnaHQ6MThweH0uaW5mby10cmVlLXNlYXJjaC1kaXZ7cG9zaXRpb246YWJzb2x1dGU7dG9wOjNweDtsZWZ0OjNweDt3aWR0aDpjYWxjKDEwMCUgLSAxNjVweCk7aGVpZ2h0OjMzcHg7ZGlzcGxheTpmbGV4fS5pbmZvLXRyZWUtc2VhcmNoe2ZsZXg6MSAxIDAlO3dpZHRoOmNhbGMoMTAwJSAtIDI5cHgpO2hlaWdodDoyNHB4O2Zsb2F0OmxlZnR9LmluZm8tdHJlZS1pY29ue3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDo0cHg7bGVmdDoycHg7d2lkdGg6MjRweDtoZWlnaHQ6MjZweDtmbG9hdDpyaWdodDt0cmFuc2Zvcm06c2NhbGUoMC42KTtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXR9LmluZm8tdHJlZS1zb3J0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDozcHg7bGVmdDpjYWxjKDEwMCUgLSAxNDhweCk7d2lkdGg6MTQ0cHg7aGVpZ2h0OjMycHg7ei1pbmRleDo2fS5pbmZvLXRyZWUtbGlzdHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MzZweDtsZWZ0OjNweDtoZWlnaHQ6Y2FsYygxMDAlIC0gNDBweCk7d2lkdGg6Y2FsYygxMDAlIC0gNnB4KX0ucmVwb3J0LWl0ZW0tdGV4dHtwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6N3B4O2ZsZXg6MSAxIDAlO3RleHQtYWxpZ246bGVmdDt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO292ZXJmbG93OmhpZGRlbjt3aGl0ZS1zcGFjZTpub3dyYXA7Zm9udC13ZWlnaHQ6MjAwfS5yZXBvcnQtaXRlbS1wb3BvdmVye3dpZHRoOmF1dG87aGVpZ2h0OmF1dG87bWluLXdpZHRoOjMwMHB4O21pbi1oZWlnaHQ6MjAwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudH0ucmVwb3J0LWl0ZW0tcG9wb3Zlci1jb250ZW50e21pbi1oZWlnaHQ6MzJweDtsaW5lLWhlaWdodDoyMDBweDt0ZXh0LWFsaWduOnJpZ2h0fS5yZXBvcnQtaXRlbS1kZWZhdWx0LXBvcG92ZXJ7bWluLXdpZHRoOjE2MHB4O3BhZGRpbmc6M3B4O2hlaWdodDo0MnB4fS50cmVlLWNvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDpjYWxjKDEwMCUgLSAxMnB4KTtoZWlnaHQ6Y2FsYygxMDAlIC0gMThweCk7b3ZlcmZsb3cteDpoaWRkZW47b3ZlcmZsb3cteTpzY3JvbGx9LnRodW1ibmFpbC1wcmV2aWV3e3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO3JpZ2h0OjA7bWF4LXdpZHRoOjMwMHB4O21heC1oZWlnaHQ6MjAwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXI6bm9uZTt6LWluZGV4OjY7b3BhY2l0eToxO29iamVjdC1maXQ6Y292ZXJ9LnJlcG9ydC1pdGVtLXBvcG92ZXItbm90LWZvdW5ke3Bvc2l0aW9uOmFic29sdXRlO3RvcDo0cHg7cmlnaHQ6NDFweDttaW4td2lkdGg6MTYwcHg7aGVpZ2h0OjMycHggIWltcG9ydGFudDtsaW5lLWhlaWdodDoyNHB4ICFpbXBvcnRhbnR9XCI7XG5cbmNvbnN0IEFyY2dpc0luZm9ncmFwaGljVHJlZSA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgdGhpcy5yZXBvcnRTZWxlY3RlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmVwb3J0U2VsZWN0ZWRcIiwgNyk7XG4gICAgdGhpcy5faWRQcmVmaXggPSAnYXJjZ2lzLWluZm9ncmFwaGljLXRyZWUtJztcbiAgICB0aGlzLl9pZFByZWZpeEJ1c3kgPSAnYXJjZ2lzLWluZm9ncmFwaGljLXRyZWUtYnVzeS0nO1xuICAgIHRoaXMuX2J1c3lJZFByZWZpeCA9ICdpZy10cmVlLWJ1c3ktJztcbiAgICB0aGlzLl9jb250YWluZXJQcmVmaXggPSAnYWl0LWNvbnRhaW5lci0nO1xuICAgIHRoaXMuX2VsZW1lbnRJZHMgPSB7fTsgLy8gbGlzdCwgc2VhcmNoLCBzb3J0XG4gICAgdGhpcy5faWRMaXN0UHJlZml4ID0gJ2lnLXRyZWUtbGlzdC0nO1xuICAgIHRoaXMuX2lkU2VhcmNoUHJlZml4ID0gJ2lnLXRyZWUtc2VhcmNoLSc7XG4gICAgdGhpcy5faWRTb3J0UHJlZml4ID0gJ2lnLXRyZWUtc29ydC0nO1xuICAgIHRoaXMuX2lkUHJlZml4UmVwb3J0cyA9ICdzZWxlY3Rvci1wb3BvdmVyLXJlcG9ydHMtJztcbiAgICB0aGlzLl9pbWdPZmZzZXQgPSAxO1xuICAgIHRoaXMuX2RiZyA9IGZhbHNlO1xuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gJ1VTJztcbiAgICB0aGlzLnN0TXVsdGlwbGVDaG9pY2UgPSBmYWxzZTtcbiAgICB0aGlzLnN0U29ydFR5cGUgPSAnbmV3ZXN0JztcbiAgICAvLyBJbnRlcm5hbCB1c2Ugb25seSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB0aGlzLm9wZW5Qb3BvdmVySWQgPSBudWxsO1xuICAgIHRoaXMuYmFzZUNvbmZpZyA9IG5ldyBCYXNlVXRpbCgndHJlZScsIHRoaXMsIHRoaXMub25VcGRhdGVVSSk7XG4gICAgQUNMVXRpbHMuYW5ub3VuY2VWZXJzaW9uKCk7XG4gICAgdGhpcy5faW5zdGFuY2VJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFByZWZpeCkuaWQ7XG4gICAgdGhpcy5fYnVzeUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2J1c3lJZFByZWZpeCkuaWQ7XG4gICAgdGhpcy5faW5mb2dyYXBoaWNzID0ge1xuICAgICAgTXlJbmZvZ3JhcGhpY3M6IHtcbiAgICAgICAgZGF0YUlkOiAyLFxuICAgICAgICB0YWc6ICdyZXBvcnQtbXktaW5mb2dyYXBoaWNzJyxcbiAgICAgICAgZGF0YTogdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICAgIEVzcmlJbmZvZ3JhcGhpY3M6IHtcbiAgICAgICAgZGF0YUlkOiAzLFxuICAgICAgICB0YWc6ICdyZXBvcnQtZXNyaS1pbmZvZ3JhcGhpY3MnLFxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgICAgU2hhcmVkSW5mb2dyYXBoaWNzOiB7XG4gICAgICAgIGRhdGFJZDogNCxcbiAgICAgICAgdGFnOiAncmVwb3J0LXNoYXJlZC1pbmZvZ3JhcGhpY3MnLFxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgICAgR2FsbGVyeUluZm9ncmFwaGljczoge1xuICAgICAgICBkYXRhSWQ6IDUsXG4gICAgICAgIHRhZzogJ3JlcG9ydC1nYWxsZXJ5LWluZm9ncmFwaGljcycsXG4gICAgICAgIGRhdGE6IHVuZGVmaW5lZCxcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMubGFuZ0NvZGUgPSAnZW4tdXMnO1xuICAgIHRoaXMuc291cmNlQ291bnRyeSA9ICdVUyc7XG4gICAgdGhpcy5zdE11bHRpcGxlQ2hvaWNlID0gZmFsc2U7XG4gICAgQmFSZXBvcnRzTGFuZ3VhZ2UuX2luaXRpYWxpemUodGhpcy5sYW5nQ29kZSk7XG4gIH1cbiAgLy9cbiAgLy8gVXBkYXRlIFByb3BzL1N0YXRlcyBhbmQgYmFzZSBjb25maWcgd2hlbiB0aGUgY29tcG9uZW50IGNvbmZpZyBjaGFuZ2VzXG4gIG9uQ29uZmlnQ2hhbmdlKG5ld0NvbmZpZywgb2xkQ29uZmlnKSB7XG4gICAgaWYgKCFuZXdDb25maWcgfHwgdHlwZW9mIG5ld0NvbmZpZyAhPSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnICYmIEFDTFV0aWxzLmhhc1RleHQobmV3Q29uZmlnKSkge1xuICAgICAgY29uc3QgbmV3Q2ZnID0gSlNPTi5wYXJzZShuZXdDb25maWcpO1xuICAgICAgY29uc3Qgb2xkQ2ZnID0gKG9sZENvbmZpZyAmJiBBQ0xVdGlscy5oYXNUZXh0KG9sZENvbmZpZykpID8gSlNPTi5wYXJzZShvbGRDb25maWcpIDogbnVsbDtcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcobmV3Q2ZnLCBvbGRDZmcpO1xuICAgICAgLy8gRmlsdGVyIG91dCByZXBvcnRzIG5vdCBjaGVja2VkXG4gICAgICAvL1xuICAgICAgLy8gSGFuZGxlIHJlcG9ydExpc3Qgd2hlcmUgaXRlbXMgYXJlIHVuY2hlY2tlZCBhbmQgd2UgZG9udCB3YW50IHRvIHNob3cgdGhlbVxuICAgICAgaWYgKHRoaXMuYmFzZUNvbmZpZy5jb25maWc/LnJlcG9ydExpc3QpIHtcbiAgICAgICAgLy8gY29uZmlnIHJlcG9ydExpc3QgZmlsdGVyZWQgdG8gY29udGFpbiBvbmx5IGNoZWNrZWQgcmVwb3J0c1xuICAgICAgICBsZXQgZmlsdGVyZWQgPSB7fTtcbiAgICAgICAgY29uc3QgcmF3ID0gdHlwZW9mICh0aGlzLmJhc2VDb25maWcuY29uZmlnLnJlcG9ydExpc3QpID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UodGhpcy5iYXNlQ29uZmlnLmNvbmZpZy5yZXBvcnRMaXN0KSA6IHRoaXMuYmFzZUNvbmZpZy5jb25maWcucmVwb3J0TGlzdDtcbiAgICAgICAgY29uc3Qga2V5cyA9IEFDTFV0aWxzLmdldEtleXMocmF3KTtcbiAgICAgICAgaWYgKGtleXMgJiYga2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBrZXlzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBsZXQgcmVwb3J0cyA9IFtdO1xuICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1trXTtcbiAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gcmF3W2tleV07XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjYXRlZ29yeS5mb3JFYWNoKChyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHIuaXNDaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICByZXBvcnRzLnB1c2gocik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXBvcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgZmlsdGVyZWRba2V5XSA9IHJlcG9ydHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBvdXIgdHJlZSBsaXN0XG4gICAgICAgIHRoaXMuX2NvbmZpZ0ZpbHRlcmVkUmVwb3J0cyA9IGZpbHRlcmVkO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX2NvbmZpZ0ZpbHRlcmVkUmVwb3J0cyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIHdhdGNoZXNcbiAgb25FbnZDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQodGhpcy5lbnYpO1xuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBlbnY6IHRoaXMuZW52IH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvbkxhbmdDb2RlQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0TGFuZ0NvZGUgPSB0aGlzLmxhbmdDb2RlO1xuICAgIEJhUmVwb3J0c0xhbmd1YWdlLl9pbml0aWFsaXplKHRoaXMuc3RMYW5nQ29kZSk7XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgLy8gdXBkYXRlcyBjb25maWcgYW5kIHN1Yi1jb21wb25lbnQgY29uZmlnc1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IGxhbmdDb2RlOiB0aGlzLmxhbmdDb2RlIH0sIG51bGwpO1xuICAgIH1cbiAgfVxuICBvblNvdXJjZUNvdW50cnlDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gdGhpcy5zb3VyY2VDb3VudHJ5O1xuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcbiAgICAgIC8vIHVwZGF0ZXMgY29uZmlnIGFuZCBzdWItY29tcG9uZW50IGNvbmZpZ3NcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy51cGRhdGVDb25maWcoeyBzb3VyY2VDb3VudHJ5OiB0aGlzLnNvdXJjZUNvdW50cnkgfSwgbnVsbCk7XG4gICAgfVxuICAgIC8vIENsZWFyIGNhY2hlZCByZXBvcnRzIHdoZW4gY291bnRyeSBjaGFuZ2VzXG4gICAgdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2NhY2hlZFJlcG9ydHMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zdFJlcG9ydExpc3QgPSB1bmRlZmluZWQ7XG4gIH1cbiAgb25Ub2tlbkNoYW5nZWQoKSB7XG4gICAgdGhpcy5zdFRva2VuID0gdGhpcy50b2tlbjtcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgdG9rZW46IHRoaXMudG9rZW4gfSwgbnVsbCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnVzZXJuYW1lICYmIEFDTFV0aWxzLmhhc1RleHQodGhpcy51c2VybmFtZSkgJiYgdGhpcy50b2tlbiAmJiBBQ0xVdGlscy5oYXNUZXh0KHRoaXMudG9rZW4pKSB7XG4gICAgICBzZXRUb2tlbih0aGlzLnVzZXJuYW1lLCB0aGlzLnRva2VuKTsgLy8gc2V0IHRoZSBiYS1yZXBvcnRzIHRva2VuXG4gICAgfVxuICB9XG4gIG9uVXNlcm5hbWVDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RVc2VybmFtZSA9IHRoaXMudXNlcm5hbWU7XG4gICAgaWYgKHRoaXMuYmFzZUNvbmZpZykge1xuICAgICAgLy8gdXBkYXRlcyBjb25maWcgYW5kIHN1Yi1jb21wb25lbnQgY29uZmlnc1xuICAgICAgdGhpcy5iYXNlQ29uZmlnLnVwZGF0ZUNvbmZpZyh7IHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lIH0sIG51bGwpO1xuICAgIH1cbiAgICBpZiAodGhpcy51c2VybmFtZSAmJiBBQ0xVdGlscy5oYXNUZXh0KHRoaXMudXNlcm5hbWUpICYmIHRoaXMudG9rZW4gJiYgQUNMVXRpbHMuaGFzVGV4dCh0aGlzLnRva2VuKSkge1xuICAgICAgc2V0VG9rZW4odGhpcy51c2VybmFtZSwgdGhpcy50b2tlbik7IC8vIHNldCB0aGUgYmEtcmVwb3J0cyB0b2tlblxuICAgIH1cbiAgfVxuICBvblNlbGVjdGVkUmVwb3J0Q2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0U2VsZWN0ZWRSZXBvcnRJZCA9IHRoaXMuc2VsZWN0ZWRSZXBvcnRJZDtcbiAgfVxuICBvblJlcG9ydExpc3RDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RSZXBvcnRMaXN0ID0gT2JqZWN0LmtleXModGhpcy5yZXBvcnRMaXN0KS5sZW5ndGggPyBKU09OLnBhcnNlKHRoaXMucmVwb3J0TGlzdCkgOiB7fTtcbiAgfVxuICBvblRoZW1lQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0VGhlbWUgPSB0aGlzLnRoZW1lO1xuICAgIGlmICh0aGlzLmJhc2VDb25maWcpIHtcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSh0aGlzLnRoZW1lKTtcbiAgICB9XG4gIH1cbiAgb25Qb3J0YWxVcmxDaGFuZ2VkKCkge1xuICAgIC8vIFNldCBpZiBQb3J0YWxVcmwgd2FzIG9wdGlvbmFsbHkgcGFzc2VkIGluXG4gICAgaWYgKHRoaXMucG9ydGFsVXJsKSB7XG4gICAgICBFbnZpcm9ubWVudHMuc2V0UG9ydGFsVXJsKHRoaXMucG9ydGFsVXJsKTtcbiAgICB9XG4gIH1cbiAgb25HZW9lbnJpY2htZW50VXJsQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0R2VvZW5yaWNobWVudFVybCA9IHRoaXMuZ2VvZW5yaWNobWVudFVybDtcbiAgICBpZiAodGhpcy5iYXNlQ29uZmlnKSB7XG4gICAgICAvLyB1cGRhdGVzIGNvbmZpZyBhbmQgc3ViLWNvbXBvbmVudCBjb25maWdzXG4gICAgICB0aGlzLmJhc2VDb25maWcudXBkYXRlQ29uZmlnKHsgZ2VvZW5yaWNobWVudFVybDogdGhpcy5nZW9lbnJpY2htZW50VXJsIH0sIG51bGwpO1xuICAgIH1cbiAgICAvLyBTZXQgaWYgR2VvZW5yaWNobWVudFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cbiAgICBpZiAodGhpcy5nZW9lbnJpY2htZW50VXJsKSB7XG4gICAgICBFbnZpcm9ubWVudHMuc2V0R2VvZW5yaWNobWVudFVybCh0aGlzLmdlb2VucmljaG1lbnRVcmwpO1xuICAgIH1cbiAgfVxuICBhc3luYyB1cGRhdGVMYXlvdXQoKSB7XG4gICAgdGhpcy5hZGp1c3RUcmVlSXRlbXNXaWR0aCgpO1xuICB9XG4gIGFzeW5jIGdldENvbmZpZygpIHtcbiAgICBjb25zdCBteUNmZyA9IHRoaXMuYmFzZUNvbmZpZztcbiAgICByZXR1cm4gbXlDZmc7XG4gIH1cbiAgYXN5bmMgaW5pdGlhbGl6ZSh1c2VybmFtZSwgdG9rZW4sIGVudiwgY291bnRyeSwgbGFuZ3VhZ2UsIHJlcG9ydExpc3QpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBzZWxmLnRva2VuID0gdG9rZW47XG4gICAgc2VsZi51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgIHNlbGYuc291cmNlQ291bnRyeSA9IGNvdW50cnk7XG4gICAgc2VsZi5sYW5nQ29kZSA9IGxhbmd1YWdlO1xuICAgIHNlbGYuZW52ID0gZW52O1xuICAgIHNlbGYuc3RSZXBvcnRMaXN0ID0gT2JqZWN0LmtleXMocmVwb3J0TGlzdCkubGVuZ3RoID8gSlNPTi5wYXJzZShyZXBvcnRMaXN0KSA6IHt9O1xuICAgIEVudmlyb25tZW50cy5zZXRFbnZpcm9ubWVudChzZWxmLmVudik7XG4gICAgLy8gU2V0IGlmIEdlb2VucmljaG1lbnRVcmwgd2FzIG9wdGlvbmFsbHkgcGFzc2VkIGluXG4gICAgaWYgKHNlbGYuZ2VvZW5yaWNobWVudFVybCkge1xuICAgICAgRW52aXJvbm1lbnRzLnNldEdlb2VucmljaG1lbnRVcmwoc2VsZi5nZW9lbnJpY2htZW50VXJsKTtcbiAgICB9XG4gICAgLy8gU2V0IGlmIFBvcnRhbFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cbiAgICBpZiAoc2VsZi5wb3J0YWxVcmwpIHtcbiAgICAgIEVudmlyb25tZW50cy5zZXRQb3J0YWxVcmwoc2VsZi5wb3J0YWxVcmwpO1xuICAgIH1cbiAgICBzZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pOyAvLyBzZXQgdGhlIGJhLXJlcG9ydHMgdG9rZW5cbiAgICB0cnkge1xuICAgICAgbGV0IHVzZXJSZXBvcnRzLCBwdWJsaWNSZXBvcnRzLCBzaGFyZWRSZXBvcnRzLCBnYWxsZXJ5UmVwb3J0cztcbiAgICAgIGNvbnN0IGluZm9zID0gYXdhaXQgZ2V0SW5mb2dyYXBoaWNUZW1wbGF0ZXNMaXN0KGNvdW50cnksIGZhbHNlKTtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhzZWxmLnN0UmVwb3J0TGlzdCkubGVuZ3RoKSB7XG4gICAgICAgIHVzZXJSZXBvcnRzID0gc2VsZi5zdFJlcG9ydExpc3QudXNlcjtcbiAgICAgICAgcHVibGljUmVwb3J0cyA9IHNlbGYuc3RSZXBvcnRMaXN0LnB1YmxpYztcbiAgICAgICAgc2hhcmVkUmVwb3J0cyA9IHNlbGYuc3RSZXBvcnRMaXN0LnNoYXJlZDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB1c2VyUmVwb3J0cyA9IGluZm9zLnVzZXIubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xuICAgICAgICBwdWJsaWNSZXBvcnRzID0gaW5mb3MucHVibGljLm1hcChyZXBvcnQgPT4geyByZXR1cm4geyAuLi5yZXBvcnQsIGlzQ2hlY2tlZDogdHJ1ZSB9OyB9KTtcbiAgICAgICAgc2hhcmVkUmVwb3J0cyA9IGluZm9zLnNoYXJlZC5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IHRydWUgfTsgfSk7XG4gICAgICAgIGdhbGxlcnlSZXBvcnRzID0gaW5mb3MuZ2FsbGVyeS5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IGZhbHNlIH07IH0pO1xuICAgICAgICBzZWxmLnN0UmVwb3J0TGlzdCA9IHsgdXNlcjogdXNlclJlcG9ydHMsIHB1YmxpYzogcHVibGljUmVwb3J0cywgc2hhcmVkOiBzaGFyZWRSZXBvcnRzLCBnYWxsZXJ5OiBnYWxsZXJ5UmVwb3J0cyB9O1xuICAgICAgfVxuICAgICAgaWYgKGluZm9zKSB7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5NeUluZm9ncmFwaGljcy5kYXRhID0gdXNlclJlcG9ydHM7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5Fc3JpSW5mb2dyYXBoaWNzLmRhdGEgPSBwdWJsaWNSZXBvcnRzO1xuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuU2hhcmVkSW5mb2dyYXBoaWNzLmRhdGEgPSBzaGFyZWRSZXBvcnRzO1xuICAgICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuR2FsbGVyeUluZm9ncmFwaGljcy5kYXRhID0gZ2FsbGVyeVJlcG9ydHM7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLk15SW5mb2dyYXBoaWNzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5Fc3JpSW5mb2dyYXBoaWNzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5TaGFyZWRJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkdhbGxlcnlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgY29uc3QgY29udGVudCA9IChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2NhbGU6IFwibVwiLCBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiIH0sIHNlbGYucmVuZGVyTGlzdCgnRXNyaUluZm9ncmFwaGljcycsIHRydWUpLCBzZWxmLnJlbmRlckxpc3QoJ015SW5mb2dyYXBoaWNzJywgdGhpcy5pc09ubHlDb25maWd1cmVkUmVwb3J0TGlzdCgnTXlJbmZvZ3JhcGhpY3MnKSksIHNlbGYucmVuZGVyTGlzdCgnU2hhcmVkSW5mb2dyYXBoaWNzJywgdGhpcy5pc09ubHlDb25maWd1cmVkUmVwb3J0TGlzdCgnU2hhcmVkSW5mb2dyYXBoaWNzJykpLCBzZWxmLnJlbmRlckxpc3QoJ0dhbGxlcnlJbmZvZ3JhcGhpY3MnLCB0aGlzLmlzT25seUNvbmZpZ3VyZWRSZXBvcnRMaXN0KCdHYWxsZXJ5SW5mb2dyYXBoaWNzJykpKSk7XG4gICAgICBzZWxmLl9jb250ZW50ID0gY29udGVudDtcbiAgICAgIHNlbGYuc2hvd0J1c3kuY2FsbChzZWxmLCBmYWxzZSk7XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgQmFzZVV0aWwuTG9nKCdhcmNnaXMtaW5mb2dyYXBoaWMtdHJlZSByZXF1ZXN0IGZvciBlc3JpIHJlcG9ydHMgZmFpbGVkJywgZXgpO1xuICAgIH1cbiAgfVxuICBzZXRMb2NhbGVTdHJpbmdzKCkge1xuICB9XG4gIHNob3dCdXN5KGZsYWcpIHtcbiAgICBjb25zdCBiID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMsIHRoaXMuX2J1c3lJZCk7XG4gICAgaWYgKGIpIHtcbiAgICAgIGlmIChmbGFnKSB7XG4gICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBhc3luYyBzZXRDb2xvclRoZW1lKG5hbWUpIHtcbiAgICBpZiAobmFtZSAmJiBBQ0xVdGlscy5oYXNUZXh0KG5hbWUpICYmIHRoaXMuZWwpIHtcbiAgICAgIHRoaXMuc3RDb2xvclRoZW1lID0gbmFtZS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IG4gPSBuYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKG4gPT09ICdsaWdodCcpIHtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJyYW5kJywgJyMwMDdhYzInKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJyYW5kLWhvdmVyJywgJyMwMDYxOWInKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJyYW5kLXByZXNzJywgJyMwMDQ4NzQnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJhY2tncm91bmQnLCAnI2Y4ZjhmOCcpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xJywgJyNmZmZmZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMicsICcjZjNmM2YzJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMnLCAnI2VhZWFlYScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0xJywgJyMxNTE1MTUnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtMicsICcjNGE0YTRhJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTMnLCAnIzZhNmE2YScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC1pbnZlcnNlJywgJyNmZmZmZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtbGluaycsICcjMDA2MTliJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMScsICcjY2FjYWNhJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMicsICcjZDRkNGQ0Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMycsICcjZGZkZmRmJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItaW5wdXQnLCAnIzk0OTQ5NCcpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktaW5mbycsICcjMDA2MTliJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1zdWNjZXNzJywgJyMzNWFjNDYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXRyZWUtcGFkZGluZy15JywgJzAnKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKG4gPT09ICdkYXJrJykge1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQnLCAnIzAwOWFmMicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtaG92ZXInLCAnIzAwN2FjMicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtcHJlc3MnLCAnIzAwNjE5YicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYmFja2dyb3VuZCcsICcjMzUzNTM1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEnLCAnIzJiMmIyYicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yJywgJyMyMDIwMjAnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMycsICcjMTUxNTE1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTEnLCAnI2ZmZmZmZicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0yJywgJyNiZmJmYmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtMycsICcjOWY5ZjlmJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LWludmVyc2UnLCAnIzE1MTUxNScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC1saW5rJywgJyMwMGEwZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0xJywgJyM1NTU1NTUnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0yJywgJyM0YTRhNGEnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0zJywgJyM0MDQwNDAnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCcsICcjNzU3NTc1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1pbmZvJywgJyMwMGEwZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXN1Y2Nlc3MnLCAnIzM2ZGE0MycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBfbG9hZEluc3RhbmNlcygpIHtcbiAgICBpZiAoIXRoaXMuX2luc3RhbmNlSWQpXG4gICAgICB0aGlzLl9pbnN0YW5jZUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KS5pZDtcbiAgICBpZiAoIXRoaXMuX2J1c3lJZClcbiAgICAgIHRoaXMuX2J1c3lJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFByZWZpeEJ1c3kpLmlkO1xuICAgIGlmICghdGhpcy5fZWxlbWVudElkcy5saXN0KVxuICAgICAgdGhpcy5fZWxlbWVudElkcy5saXN0ID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkTGlzdFByZWZpeCkuaWQ7XG4gICAgaWYgKCF0aGlzLl9lbGVtZW50SWRzLnNlYXJjaClcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuc2VhcmNoID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkU2VhcmNoUHJlZml4KS5pZDtcbiAgICBpZiAoIXRoaXMuX2VsZW1lbnRJZHMuc29ydClcbiAgICAgIHRoaXMuX2VsZW1lbnRJZHMuc29ydCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCh0aGlzLl9pZFNvcnRQcmVmaXgpLmlkO1xuICB9XG4gIC8vIEJhc2VVdGlsIGNvbmZpZy1jaGFuZ2VkIHJlbmRlciBjYWxsYmFja1xuICBvblVwZGF0ZVVJKCkge1xuICB9XG4gIG9uQ2xpY2tUcmVlSXRlbShlLCBkYXRhKSB7XG4gICAgUHJldmlld1BvcHVwLmhpZGVQb3B1cCgpO1xuICAgIHRoaXMucmVwb3J0U2VsZWN0ZWQuZW1pdCh7IHJlcG9ydDogZGF0YSB9KTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgYXBwbHlTb3J0KGxpc3QpIHtcbiAgICBpZiAobGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHNvcnRlZExpc3QgPSBbLi4ubGlzdF07XG4gICAgICBsZXQgc29ydFR5cGUgPSB0aGlzLnN0U29ydFR5cGUgfHwgJ25ld2VzdCc7XG4gICAgICBjb25zdCBlbGVtID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMsIEFDTFV0aWxzLmZpeElkKHRoaXMuX2VsZW1lbnRJZHMuc29ydCkpO1xuICAgICAgaWYgKHR5cGVvZiBlbGVtICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHNvcnRUeXBlID0gZWxlbS52YWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzb3J0VHlwZSkge1xuICAgICAgICBzd2l0Y2ggKHNvcnRUeXBlKSB7XG4gICAgICAgICAgY2FzZSAoJ29sZGVzdCcpOiB7XG4gICAgICAgICAgICBzb3J0ZWRMaXN0LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgbGV0IGRhID0gYS5kYXRlO1xuICAgICAgICAgICAgICBsZXQgZGIgPSBiLmRhdGU7XG4gICAgICAgICAgICAgIHJldHVybiBkYSAtIGRiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSAoJ2FzY2VuZGluZycpOiB7XG4gICAgICAgICAgICBzb3J0ZWRMaXN0LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgbGV0IHMxID0gYS50aXRsZTtcbiAgICAgICAgICAgICAgbGV0IHMyID0gYi50aXRsZTtcbiAgICAgICAgICAgICAgaWYgKHMxIDwgczIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKHMxID4gczIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgKCdkZXNjZW5kaW5nJyk6IHtcbiAgICAgICAgICAgIHNvcnRlZExpc3Quc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICBsZXQgczEgPSBhLnRpdGxlO1xuICAgICAgICAgICAgICBsZXQgczIgPSBiLnRpdGxlO1xuICAgICAgICAgICAgICBpZiAoczEgPiBzMikge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoczEgPCBzMikge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgLy8gbmV3ZXN0XG4gICAgICAgICAgICBzb3J0ZWRMaXN0LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgbGV0IGRhID0gYS5kYXRlO1xuICAgICAgICAgICAgICBsZXQgZGIgPSBiLmRhdGU7XG4gICAgICAgICAgICAgIHJldHVybiBkYiAtIGRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBzb3J0ZWRMaXN0O1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbiAgfVxuICAvLyBSZXR1cm5zIHNlYXJjaC1maWx0ZXJlZCBsaXN0IHRoYXQgaXMgYWxzbyBzb3J0ZWRcbiAgZ2V0RmlsdGVyZWRSZXBvcnRMaXN0KG5hbWUpIHtcbiAgICBjb25zdCB0cmVlID0gdGhpcztcbiAgICBjb25zdCBzZWFyY2hGaWx0ZXJlZExpc3QgPSBbXTtcbiAgICBjb25zdCBsaXN0TmFtZXMgPSB7ICdNeUluZm9ncmFwaGljcyc6ICd1c2VyJywgJ0VzcmlJbmZvZ3JhcGhpY3MnOiAncHVibGljJywgJ1NoYXJlZEluZm9ncmFwaGljcyc6ICdzaGFyZWQnLCAnR2FsbGVyeUluZm9ncmFwaGljcyc6ICdnYWxsZXJ5JyB9O1xuICAgIGNvbnN0IG9iak5hbWUgPSBsaXN0TmFtZXNbbmFtZV07XG4gICAgY29uc3QgbGlzdCA9IHRoaXMuX2NvbmZpZ0ZpbHRlcmVkUmVwb3J0cyB8fCB0aGlzLnN0UmVwb3J0TGlzdCB8fCB0aGlzLl9jYWNoZWRSZXBvcnRzO1xuICAgIGNvbnN0IGRlZmF1bHRMaXN0ID0gbGlzdFtvYmpOYW1lXTtcbiAgICBjb25zdCBzZWFyY2hJbnB1dCA9IHRyZWUuZWwucXVlcnlTZWxlY3RvcignIycgKyB0cmVlLl9lbGVtZW50SWRzLnNlYXJjaCk7XG4gICAgaWYgKHNlYXJjaElucHV0KSB7XG4gICAgICBjb25zdCBxdWVyeSA9IHNlYXJjaElucHV0LnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKHF1ZXJ5ICYmIEFDTFV0aWxzLmhhc1RleHQocXVlcnkpKSB7XG4gICAgICAgIGlmIChsaXN0ICYmIGxpc3Rbb2JqTmFtZV0gJiYgbGlzdFtvYmpOYW1lXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbGlzdFtvYmpOYW1lXS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gaXRlbS50aXRsZTtcbiAgICAgICAgICAgIGlmIChuICYmIEFDTFV0aWxzLmhhc1RleHQobikgJiYgbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgICAgICAgICBzZWFyY2hGaWx0ZXJlZExpc3QucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGx5U29ydChkZWZhdWx0TGlzdCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuYXBwbHlTb3J0KGRlZmF1bHRMaXN0KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYXBwbHlTb3J0KHNlYXJjaEZpbHRlcmVkTGlzdCk7XG4gIH1cbiAgaXNPbmx5Q29uZmlndXJlZFJlcG9ydExpc3QobmFtZSkge1xuICAgIGNvbnN0IGxpc3ROYW1lcyA9IHsgJ015SW5mb2dyYXBoaWNzJzogJ3VzZXInLCAnRXNyaUluZm9ncmFwaGljcyc6ICdwdWJsaWMnLCAnU2hhcmVkSW5mb2dyYXBoaWNzJzogJ3NoYXJlZCcsICdHYWxsZXJ5SW5mb2dyYXBoaWNzJzogJ2dhbGxlcnknIH07XG4gICAgY29uc3Qgb2JqTmFtZSA9IGxpc3ROYW1lc1tuYW1lXTtcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzIHx8IHRoaXMuc3RSZXBvcnRMaXN0IHx8IHRoaXMuX2NhY2hlZFJlcG9ydHM7XG4gICAgY29uc3QgZGVmYXVsdExpc3QgPSBsaXN0W29iak5hbWVdO1xuICAgIC8vIElmIGxpc3QgaXMgbm90IGNvbmZpZ3VyZWQsIHJldHVybiBmYWxzZVxuICAgIGlmICghZGVmYXVsdExpc3QpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKGxpc3QpLmxlbmd0aCA9PT0gMTtcbiAgfVxuICBvblVwZGF0ZVRodW1ibmFpbFBvcG92ZXJTaXplKCkge1xuICAgIGlmICghdGhpcy5lbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgZnVsbENvbnRlbnRIdCA9IDEwMDtcbiAgICBjb25zdCBtaW5Db250ZW50SHQgPSAxMDA7XG4gICAgY29uc3QgbWluUG9wb3Zlcld0ID0gMjAwO1xuICAgIGNvbnN0IG1heFBvcG92ZXJXdCA9IDczNTtcbiAgICBjb25zdCB2cGFkID0gMzY7XG4gICAgY29uc3QgaHBhZCA9IDE2O1xuICAgIGNvbnN0IGNsaWVudEh0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBjbGllbnRXdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBodEFib3ZlID0gdGhpcy5lbC5vZmZzZXRUb3A7XG4gICAgY29uc3QgaHRCZWxvdyA9IGNsaWVudEh0IC0gKHRoaXMuZWwub2Zmc2V0VG9wICsgdGhpcy5lbC5vZmZzZXRIZWlnaHQpICsgd2luZG93LnNjcm9sbFk7XG4gICAgbGV0IGZ1bGxDb250ZW50V3QgPSBjbGllbnRXdCAvIDI7XG4gICAgY29uc3QgcmlnaHRTcGFjZSA9IGNsaWVudFd0IC0gdGhpcy5lbC5vZmZzZXRMZWZ0ICsgd2luZG93LnNjcm9sbFg7XG4gICAgaWYgKGh0QmVsb3cgPCBtaW5Db250ZW50SHQgJiYgaHRCZWxvdyA8IGh0QWJvdmUpIHtcbiAgICAgIC8vIHBvcG92ZXIgbWF4IGhlaWdodCA9IGh0IGFib3ZlIGlmIHRoYXQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gYmVsb3dcbiAgICAgIGZ1bGxDb250ZW50SHQgPSBodEFib3ZlIC0gdnBhZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBmdWxsQ29udGVudEh0ID0gaHRCZWxvdyAtIHZwYWQ7XG4gICAgfVxuICAgIGZ1bGxDb250ZW50V3QgPSBNYXRoLm1heChtaW5Qb3BvdmVyV3QsIE1hdGgubWluKHJpZ2h0U3BhY2UgLSBocGFkLCBtYXhQb3BvdmVyV3QpKTtcbiAgICBjb25zdCBjb250ZW50RWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLmNvbnRlbnQpO1xuICAgIGlmIChjb250ZW50RWxlbSkge1xuICAgICAgaWYgKGNvbnRlbnRFbGVtKSB7XG4gICAgICAgIGNvbnRlbnRFbGVtLnN0eWxlLmhlaWdodCA9IGZ1bGxDb250ZW50SHQgKyAncHgnO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwb3BvdmVyRWxlbSA9IEFDTFV0aWxzLnF1ZXJ5RWxlbWVudEJ5SWQuY2FsbCh0aGlzLmVsLCB0aGlzLl9lbGVtZW50SWRzLnBvcG92ZXIpO1xuICAgIGlmIChwb3BvdmVyRWxlbSkge1xuICAgICAgcG9wb3ZlckVsZW0uc3R5bGUud2lkdGggPSBmdWxsQ29udGVudFd0ICsgJ3B4JztcbiAgICAgIC8vIHBvcG92ZXJFbGVtLnN0eWxlLmxlZnQgPSB0aGlzLmVsLm9mZnNldExlZnQgKyAncHgnXG4gICAgfVxuICAgIC8vIG5vdGlmeSB0cmVlIHRoYXQgb3VyIHNpemUgbWF5IGhhdmUgY2hhbmdlZFxuICAgIGNvbnN0IHRyZWUgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkLmNhbGwodGhpcy5lbCwgdGhpcy5fZWxlbWVudElkcy5yZXBvcnRzKTtcbiAgICBpZiAodHJlZSkge1xuICAgICAgdHJlZS51cGRhdGVMYXlvdXQoKTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlTW91c2VPdmVyKGV2LCByZXBvcnRJZCkge1xuICAgIGNvbnN0IHkgPSBldi5jbGllbnRZO1xuICAgIGNvbnN0IGlkID0gcmVwb3J0SWQ7XG4gICAgdGhpcy5fZGVib3VuY2UyKCgpID0+IHtcbiAgICAgIFByZXZpZXdQb3B1cC5oaWRlUG9wdXAoKTtcbiAgICAgIGNvbnN0IGltZ0RhdGEgPSBBcmNnaXNJbmZvZ3JhcGhpY1RyZWUuX2dldFRodW1ibmFpbFVybChpZCk7XG4gICAgICBpZiAoaW1nRGF0YSAmJiBpbWdEYXRhLmlzT2spIHtcbiAgICAgICAgY29uc3QgcG9wb3ZlciA9IHRoaXMuZWwuY2xvc2VzdCgnY2FsY2l0ZS1wb3BvdmVyJyk7XG4gICAgICAgIGlmIChwb3BvdmVyKSB7XG4gICAgICAgICAgY29uc3QgcnIgPSBwb3BvdmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgIGNvbnN0IGNsaWNrWSA9IHkgLSByci50b3A7XG4gICAgICAgICAgUHJldmlld1BvcHVwLnNob3coaWQsIHBvcG92ZXIsIGNsaWNrWSwgaW1nRGF0YS5yYXRpbywgaW1nRGF0YS51cmwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMjAwKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBoYW5kbGVNb3VzZU91dCgpIHtcbiAgICB0aGlzLl9kZWJvdW5jZTIoKCkgPT4ge1xuICAgICAgUHJldmlld1BvcHVwLmhpZGVQb3B1cCgpO1xuICAgIH0sIDMwMCk7XG4gIH1cbiAgc3RhdGljIF9zZXRUaHVtYm5haWxJbmRleChpZCwgcmF0aW9XMkgsIHVybCwgaXNWYWxpZCkge1xuICAgIEFyY2dpc0luZm9ncmFwaGljVHJlZS5UaHVtYm5haWxJbmRleFtpZF0gPSB7IHVybDogdXJsLCByYXRpbzogcmF0aW9XMkgsIGlzT2s6IGlzVmFsaWQgfTtcbiAgfVxuICBzdGF0aWMgX2dldFRodW1ibmFpbFVybChpZCkge1xuICAgIHJldHVybiBBcmNnaXNJbmZvZ3JhcGhpY1RyZWUuVGh1bWJuYWlsSW5kZXhbaWRdO1xuICB9XG4gIHJlbmRlckxpc3QobmFtZSwgZXhwYW5kZWQpIHtcbiAgICBCYXNlVXRpbC5Mb2coJyBUUkVFIHJlbmRlckxpc3QnLCBuYW1lKTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCB0YWdzID0ge1xuICAgICAgJ015SW5mb2dyYXBoaWNzJzogJ3JlcG9ydC1teS1pbmZvZ3JhcGhpY3MnLFxuICAgICAgJ0VzcmlJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LWVzcmktaW5mb2dyYXBoaWNzJyxcbiAgICAgICdTaGFyZWRJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LXNoYXJlZC1pbmZvZ3JhcGhpY3MnLFxuICAgICAgJ0dhbGxlcnlJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LWdhbGxlcnktaW5mb2dyYXBoaWNzJyxcbiAgICAgICdOb1ByZXZpZXdBdmFpbGFibGUnOiAncHJldmlldy1ub3QtYXZhaWxhYmxlJ1xuICAgIH07XG4gICAgZnVuY3Rpb24gX2dldEltZ0lkKCkge1xuICAgICAgcmV0dXJuIHNlbGYuX2luc3RhbmNlSWQgKyAnLScgKyAnaW1nJyArIHNlbGYuX2ltZ09mZnNldCsrO1xuICAgIH1cbiAgICAvLyB0aGlzIGZ1bmN0aW9uIG9wZXJhdGVzIGFzeW5jaHJvbm91c2x5IHRvIGNoZWNrIGltYWdlIHVybHMuICBUaGUgcmVzdWx0cyBmcm9tIHJlcXVlc3RpbmdcbiAgICAvLyBhbiBpbWFnZSBhcmUgYWRkZWQgdG8gdGhlIFRodW1ibmFpbCBJbmRleCBmb3IgZnV0dXJlIHJlZmVyZW5jZVxuICAgIGZ1bmN0aW9uIF9jYWNoZVRodW1ibmFpbFVybEFuZERhdGEoaW1nSWQsIGlkLCBwb3BvdmVySWQsIHByZXZJZCwgbmFtZSkge1xuICAgICAgaWYgKEFDTFV0aWxzLmhhc1RleHQoaW1nSWQpICYmIEFDTFV0aWxzLmhhc1RleHQoaWQpICYmIEFDTFV0aWxzLmhhc1RleHQocG9wb3ZlcklkKSkge1xuICAgICAgICBCYXNlVXRpbC5Mb2coJ1RSRUUgX2dldFRodW1ibmFpbCcpO1xuICAgICAgICAvLyBjb25zdCBpbWdFbGVtZW50SWQgPSBpbWdJZFxuICAgICAgICBjb25zdCB0aHVtYm5haWxJZCA9IGlkO1xuICAgICAgICBjb25zdCBwb3BJZCA9IHBvcG92ZXJJZDtcbiAgICAgICAgY29uc3QgdHJlZVByZXZJZCA9IHByZXZJZDtcbiAgICAgICAgLy8gQWRkcyB0b29sdGlwcyB0byBwcmV2aWV3IGl0ZW1zIHRoYXQgZG8gbm90IGhhdmUgYSB2YWxpZCB0aHVtYm5haWxcbiAgICAgICAgZnVuY3Rpb24gX2FkZE5vUHJldmlld1Rvb2x0aXAoaXRlbUlkKSB7XG4gICAgICAgICAgY29uc3QgcG9wID0gc2VsZi5lbC5xdWVyeVNlbGVjdG9yKEFDTFV0aWxzLmZpeElkKHBvcElkKSk7XG4gICAgICAgICAgaWYgKHBvcCkge1xuICAgICAgICAgICAgcG9wLnJlbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBwcmV2RWxlbSA9IHNlbGYuZWwucXVlcnlTZWxlY3RvcihBQ0xVdGlscy5maXhJZChpdGVtSWQpKTtcbiAgICAgICAgICBpZiAocHJldkVsZW0pIHtcbiAgICAgICAgICAgIC8vIGFkZCBuby1wcmV2aWV3IHRvb2x0aXBcbiAgICAgICAgICAgIGNvbnN0IHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbGNpdGUtdG9vbHRpcCcpO1xuICAgICAgICAgICAgdGlwLnNldEF0dHJpYnV0ZSgncmVmZXJlbmNlLWVsZW1lbnQnLCBpdGVtSWQpO1xuICAgICAgICAgICAgdGlwLnN0eWxlLm1pbldpZHRoID0gJzE2MHB4JztcbiAgICAgICAgICAgIHRpcC5zdHlsZS5sZWZ0ID0gJy00MHB4JztcbiAgICAgICAgICAgIGNvbnN0IHNwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgc3AuaW5uZXJUZXh0ID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bih0YWdzLk5vUHJldmlld0F2YWlsYWJsZSk7XG4gICAgICAgICAgICB0aXAuYXBwZW5kQ2hpbGQoc3ApO1xuICAgICAgICAgICAgcHJldkVsZW0uYXBwZW5kQ2hpbGQodGlwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gX3VzZUFHT0ZvclRodW1ibmFpbChuYW1lKSB7XG4gICAgICAgICAgaWYgKG5hbWUgIT09IFwiRXNyaUluZm9ncmFwaGljc1wiKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIGlmIChzZWxmLnBvcnRhbE9ubGluZUdFUHJveHkgJiYgIUVudmlyb25tZW50cy5pc0FHT1BvcnRhbChFbnZpcm9ubWVudHMuZ2V0UG9ydGFsQmFzZSgpKSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1c2UgcHJlLWNhY2hlZCBpbmZvIGlmIHBvc3NpYmxlXG4gICAgICAgIGxldCBmZXRjaEl0ZW0gPSB0cnVlO1xuICAgICAgICBjb25zdCBpbWdEYXRhID0gQXJjZ2lzSW5mb2dyYXBoaWNUcmVlLl9nZXRUaHVtYm5haWxVcmwoaWQpO1xuICAgICAgICBpZiAoaW1nRGF0YSkge1xuICAgICAgICAgIGlmIChpbWdEYXRhLmlzT2sgfHwgaW1nRGF0YS5pc09rID09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBhbHJlYWR5IGhhdmUgY2FjaGVkIHJlc3VsdHNcbiAgICAgICAgICAgIGZldGNoSXRlbSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjaGVjayBzZXJ2ZXIgaWYgdGhlIHRodW1ibmFpbCBjYW4gYmUgdXNlZFxuICAgICAgICBpZiAoZmV0Y2hJdGVtKSB7XG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoZSBpbWFnZSB1cmwgaXMgdmFsaWQgb3Igbm90IGJ5IGNyZWF0aW5nIGFuIGltYWdlIGluIG1lbW9yeVxuICAgICAgICAgIC8vIGNvbnN0IHAgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgbGV0IHVybCA9ICcnO1xuICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBHRSBPbmxpbmUgcHJveHkgc2V0dXAgYW5kIGFyZSBjb25uZWN0ZWQgdG8gYSBwb3J0YWwgKG5vdCBBR08pLCB3ZSBuZWVkIHRvIHVzZSB3d3cuYXJjZ2lzLmNvbSBmb3IgdGhlIEVzcmkgSW5mb2dyYXBoaWNzIHRodW1ibmFpbHNcbiAgICAgICAgICBpZiAoX3VzZUFHT0ZvclRodW1ibmFpbChuYW1lKSkge1xuICAgICAgICAgICAgdXJsID0gJ2h0dHBzOi8vd3d3LmFyY2dpcy5jb20vc2hhcmluZy9yZXN0L2NvbnRlbnQvaXRlbXMvJyArIHRodW1ibmFpbElkICsgJy9yZXNvdXJjZXMvdGh1bWJuYWlsLnBuZyc7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdXJsID0gRW52aXJvbm1lbnRzLmdldFBvcnRhbEJhc2UoKSArICcvc2hhcmluZy9yZXN0L2NvbnRlbnQvaXRlbXMvJyArIHRodW1ibmFpbElkICsgJy9yZXNvdXJjZXMvdGh1bWJuYWlsLnBuZz90b2tlbj0nICsgc2VsZi50b2tlbjtcbiAgICAgICAgICB9XG4gICAgICAgICAgZnVuY3Rpb24gdXJsSXNWYWxpZChwaWQsIHUsIHJpZCwgd3QsIGh0KSB7XG4gICAgICAgICAgICAvLyBjb25zdCB3OiBudW1iZXIgPSBpbWdJbnN0YW5jZS53aWR0aFxuICAgICAgICAgICAgLy8gY29uc3QgaDogbnVtYmVyID0gaW1nSW5zdGFuY2UuaGVpZ2h0XG4gICAgICAgICAgICAvLyBzYXZlIG91ciByZXN1bHRzIGludG8gdGhlIHRodW1ibmFpbCBpbmRleCB0byBhdm9pZCB0aGlzIHN0ZXAgbGF0ZXJcbiAgICAgICAgICAgIEFyY2dpc0luZm9ncmFwaGljVHJlZS5fc2V0VGh1bWJuYWlsSW5kZXgocmlkLCAod3QgLyBodCksIHUsIHRydWUpO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBuby1wcmV2aWV3IHRvb2x0aXBcbiAgICAgICAgICAgIGNvbnN0IHByZXZFbGVtID0gc2VsZi5lbC5xdWVyeVNlbGVjdG9yKEFDTFV0aWxzLmZpeElkKHBpZCkpO1xuICAgICAgICAgICAgaWYgKHByZXZFbGVtKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG9sZFRpcCA9IHByZXZFbGVtLnF1ZXJ5U2VsZWN0b3IoJ2NhbGNpdGUtdG9vbHRpcCcpO1xuICAgICAgICAgICAgICBpZiAob2xkVGlwKSB7XG4gICAgICAgICAgICAgICAgb2xkVGlwLnJlbW92ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGZ1bmN0aW9uIHVybEhhZEVycm9yKHBpZCwgdSwgcmlkKSB7XG4gICAgICAgICAgICBBcmNnaXNJbmZvZ3JhcGhpY1RyZWUuX3NldFRodW1ibmFpbEluZGV4KHJpZCwgMSwgdSwgZmFsc2UpO1xuICAgICAgICAgICAgX2FkZE5vUHJldmlld1Rvb2x0aXAocGlkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgY29uc3QgaW1nSW5zdCA9IHRoaXM7XG4gICAgICAgICAgICAgIGNvbnN0IHcgPSBpbWdJbnN0LndpZHRoO1xuICAgICAgICAgICAgICBjb25zdCBoID0gaW1nSW5zdC5oZWlnaHQ7XG4gICAgICAgICAgICAgIHVybElzVmFsaWQodHJlZVByZXZJZCwgdXJsLCB0aHVtYm5haWxJZCwgdywgaCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7IHVybEhhZEVycm9yKHRyZWVQcmV2SWQsIHVybCwgdGh1bWJuYWlsSWQpOyB9O1xuICAgICAgICAgICAgaW1nLnNyYyA9IHVybDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICB1cmxIYWRFcnJvcih0cmVlUHJldklkLCB1cmwsIHRodW1ibmFpbElkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBvdXRlclN0eWxlID0ge1xuICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcbiAgICAgICd3aWR0aCc6ICcxMDAlJyxcbiAgICAgICdoZWlnaHQnOiAnMTAwJSdcbiAgICB9O1xuICAgIC8vIGNvbnN0IG5vUHJldmlld1N0eWxlID0ge1xuICAgIC8vICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcbiAgICAvLyAgICd0b3AnOiAnMCcsXG4gICAgLy8gICAnbGVmdCc6ICcwJyxcbiAgICAvLyAgICd3aWR0aCc6ICcxMDAlJyxcbiAgICAvLyAgICdoZWlnaHQnOiAnMTAwJScsXG4gICAgLy8gICAnekluZGV4JzogJzUnXG4gICAgLy8gfVxuICAgIC8vIGNvbnN0IGljb25OYW1lID0gJ2ZpbGUtdGV4dCdcbiAgICAvLyBmdW5jdGlvbiBnZXRUaHVtYm5haWxTdHlsZShpZDogc3RyaW5nKSB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgIC8vICAgICAndG9wJzogJzAnLFxuICAgIC8vICAgICAnbGVmdCc6ICcwJyxcbiAgICAvLyAgICAgJ3dpZHRoJzogJzEwMCUnLFxuICAgIC8vICAgICAnaGVpZ2h0JzogJzEwMCUnLFxuICAgIC8vICAgICAnekluZGV4JzogJzYnLFxuICAgIC8vICAgICAnYmFja2dyb3VuZEltYWdlJzogJ3VybCgnICsgX2dldFRodW1ibmFpbChpZCkgKyAnKScsXG4gICAgLy8gICAgICdiYWNrZ3JvdW5kU2l6ZSc6ICdhdXRvJ1xuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBjb25zdCB0aHVtYm5haWxEaXYgPSB7XG4gICAgLy8gICAnd2lkdGgnOicxMDAlJyxcbiAgICAvLyAgICdoZWlnaHQnOicxMDAlJyxcbiAgICAvLyAgICdiYWNrZ3JvdW5kSW1hZ2UnIDogJ3VybChodHRwczovL3d3dy5hcmNnaXMuY29tL3NoYXJpbmcvcmVzdC9jb250ZW50L2l0ZW1zLzY5Nzg4NzIyMGI5ZjQ3YjhhMjIzODNhMWFjZDRmMjAzL3Jlc291cmNlcy90aHVtYm5haWwucG5nKScsXG4gICAgLy8gICAnYmFja2dyb3VuZFNpemUnIDogJ2NvbnRhaW4nXG4gICAgLy8gfVxuICAgIC8vIGNvbnN0IHJlcG9ydHMgPSBzZWxmLl9pbmZvZ3JhcGhpY3NbbmFtZV0uZGF0YVxuICAgIGNvbnN0IHJlcG9ydHMgPSBzZWxmLmdldEZpbHRlcmVkUmVwb3J0TGlzdChuYW1lKTtcbiAgICBpZiAocmVwb3J0cyAmJiByZXBvcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIGxldCBhcnI6IGFueVtdID0gcmVwb3J0cy5tYXAoKHYpID0+IHsgcmV0dXJuIHtpZDogdi5pZCwgbmFtZTogdi50aXRsZX19KVxuICAgICAgbGV0IGRpc3BsYXlOYW1lID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bih0YWdzW25hbWVdKTtcbiAgICAgIGlmIChkaXNwbGF5TmFtZSA9PT0gJz8/Jykge1xuICAgICAgICBCYXNlVXRpbC5FcnJvcignTWlzc2luZyBSZXBvcnQgQ2F0ZWdvcnkgbmFtZScsIHRhZ3NbbmFtZV0pO1xuICAgICAgICBkaXNwbGF5TmFtZSA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4odGFnc1tuYW1lXSk7IC8vIHdpdGhvdXQgdGhlIG9wdGlvblxuICAgICAgfVxuICAgICAgY29uc3QgZmlsdGVyZWRSZXBvcnRMaXN0ID0gdGhpcy5nZXRGaWx0ZXJlZFJlcG9ydExpc3QobmFtZSk7XG4gICAgICBCYXNlVXRpbC5Mb2coJ1RSRUUgcmVuZGVyTGlzdFsnICsgbmFtZSArICddIGZpbHRlcmVkPScsIGZpbHRlcmVkUmVwb3J0TGlzdCk7XG4gICAgICBpZiAoIWZpbHRlcmVkUmVwb3J0TGlzdCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoQUNMVXRpbHMuaXNEZWYoZmlsdGVyZWRSZXBvcnRMaXN0KSkge1xuICAgICAgICBsZXQgc2hvd1JlcG9ydENhdCA9IGZhbHNlO1xuICAgICAgICBmaWx0ZXJlZFJlcG9ydExpc3QuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgIGlmIChlbGVtZW50LmlzQ2hlY2tlZCkge1xuICAgICAgICAgICAgc2hvd1JlcG9ydENhdCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gY3JlYXRlIGEgdHJlZSBub2RlIGZvciB0aGlzIGxldmVsIHdpdGggYWxsIHJlY29yZHNcbiAgICAgICAgaWYgKHNob3dSZXBvcnRDYXQpIHtcbiAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzdHlsZTogb3V0ZXJTdHlsZSB9LCBoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBjbGFzczogXCJyZXBvcnRMaXN0XCIsIHNsb3Q6IFwiY2hpbGRyZW5cIiwgZXhwYW5kZWQ6IGV4cGFuZGVkIH0sIGRpc3BsYXlOYW1lLCByZXBvcnRzLmxlbmd0aCA+IDAgJiYgKGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzbG90OiBcImNoaWxkcmVuXCIsIGNsYXNzOiBcInJlcG9ydFRyZWVcIiB9LCByZXBvcnRzLm1hcChyZXBvcnQgPT4ge1xuICAgICAgICAgICAgaWYgKGZpbHRlcmVkUmVwb3J0TGlzdC5zb21lKG9iaiA9PiB7IHJldHVybiBvYmouaWQgPT09IHJlcG9ydC5pZCAmJiBvYmouaXNDaGVja2VkID09PSB0cnVlOyB9KSkge1xuICAgICAgICAgICAgICBjb25zdCBpdGVtSWQgPSAndHJlZS1pdGVtLScgKyByZXBvcnQuaWQ7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZJZCA9IGl0ZW1JZCArICctcHJldic7XG4gICAgICAgICAgICAgIGNvbnN0IHRodW1ibmFpbFBvcElkID0gaXRlbUlkICsgJy1wb3AnO1xuICAgICAgICAgICAgICBjb25zdCBpbWdJZCA9IF9nZXRJbWdJZCgpO1xuICAgICAgICAgICAgICBfY2FjaGVUaHVtYm5haWxVcmxBbmREYXRhKGltZ0lkLCByZXBvcnQuaWQsIHRodW1ibmFpbFBvcElkLCBwcmV2SWQsIG5hbWUpO1xuICAgICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJyZXBvcnQtdHJlZS1kcm9wZG93blwiIH0sIGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IGlkOiBpdGVtSWQsIHNlbGVjdGVkOiByZXBvcnQuaWQgPT09IHNlbGYuc3RTZWxlY3RlZFJlcG9ydElkID8gdHJ1ZSA6IGZhbHNlLCBjbGFzczogXCJyZXBvcnRJdGVtc1wiLCBkYXRhOiByZXBvcnQuaWQsIG9uQ2xpY2s6IChlKSA9PiBzZWxmLm9uQ2xpY2tUcmVlSXRlbShlLCB7IHRodW1ibmFpbDogdGh1bWJuYWlsUG9wSWQsIGlkOiByZXBvcnQuaWQsIG5hbWU6IHJlcG9ydC50aXRsZSB9KSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwicmVwb3J0LWl0ZW0tY29udGVudFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJyZXBvcnQtaXRlbS10ZXh0XCIgfSwgcmVwb3J0LnRpdGxlKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInJlcG9ydC1pdGVtLWJ1dHRvbnNcIiB9LCBoKFwiZGl2XCIsIG51bGwsIGgoXCJkaXZcIiwgeyBpZDogcHJldklkLCBjbGFzczogXCJyZXBvcnQtaXRlbS1wcmV2aWV3XCIsIG9uTW91c2VPdmVyOiAoZSkgPT4gdGhpcy5oYW5kbGVNb3VzZU92ZXIoZSwgcmVwb3J0LmlkKSwgb25Nb3VzZU91dDogKCkgPT4gdGhpcy5oYW5kbGVNb3VzZU91dCgpIH0sIGgoXCJzdmdcIiwgeyBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiLCBjbGFzczogXCJzdmdcIiwgZmlsbDogXCJjdXJyZW50Q29sb3JcIiwgdmlld0JveDogXCIwIDAgMjQgMjRcIiwgeG1sbnM6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB9LCBoKFwicGF0aFwiLCB7IGQ6IFwiTTE3IDE2aC01LjUyNWE1Ljk1IDUuOTUgMCAwIDAtLjE3Mi0xSDE3em0yLTdoLTl2MWg5em0wIDNoLTl2LjU0NHEuMTkzLjIyLjM2NC40NTZIMTl6bTMgOEgxMS44MThsLS45MTMtLjkxM2MuMDE0LS4wMjguMDIzLS4wNTkuMDM3LS4wODdIMjFWN2gtNFYzSDh2OC4wNTNhNS45NDUgNS45NDUgMCAwIDAtMS0uMzU2VjJoMTEuNEwyMiA1LjZ6TTIxIDUuNjlMMTguMzEgM0gxOHYzaDN6TTguOTI2IDE5LjIzbDMuMDg1IDMuMDg0YS40NzYuNDc2IDAgMCAxIDAgLjY3NGwtLjAxNy4wMTdhLjQ3Ni40NzYgMCAwIDEtLjY3MyAwTDguMjM3IDE5LjkyQTQuMzgzIDQuMzgzIDAgMSAxIDkuOSAxNi41YTQuMzU4IDQuMzU4IDAgMCAxLS45NzQgMi43M3pNNS41IDE5LjlhMy40IDMuNCAwIDEgMC0zLjQtMy40IDMuNDA0IDMuNDA0IDAgMCAwIDMuNCAzLjR6XCIgfSkpKSkpKSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSkpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG4gIGFzeW5jIHJlZnJlc2hJbmZvZ3JhcGhpY0xpc3QoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgbGV0IHVzZXJSZXBvcnRzLCBwdWJsaWNSZXBvcnRzLCBzaGFyZWRSZXBvcnRzLCBnYWxsZXJ5UmVwb3J0cztcbiAgICBCYXNlVXRpbC5Mb2coJ1RSRUUgcmVmcmVzaEluZm9ncmFwaGljTGlzdCcsIHNlbGYuc3RSZXBvcnRMaXN0KTtcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5fY29uZmlnRmlsdGVyZWRSZXBvcnRzIHx8IHRoaXMuc3RSZXBvcnRMaXN0IHx8IHRoaXMuX2NhY2hlZFJlcG9ydHM7XG4gICAgLy8gSWYgbm8gcmVwb3J0cyBjb25maWd1cmF0aW9uIGlzIHNwZWNpZmllZCwgZGVmYXVsdCB0byBPTkxZIEVzcmkgUmVwb3J0cyAocHVibGljKVxuICAgIGlmICh0aGlzLmJhc2VDb25maWcuY29uZmlnPy5yZXBvcnRMaXN0KSB7XG4gICAgICBjb25zdCByYXcgPSB0eXBlb2YgKHRoaXMuYmFzZUNvbmZpZy5jb25maWcucmVwb3J0TGlzdCkgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZSh0aGlzLmJhc2VDb25maWcuY29uZmlnLnJlcG9ydExpc3QpIDogdGhpcy5iYXNlQ29uZmlnLmNvbmZpZy5yZXBvcnRMaXN0O1xuICAgICAgY29uc3Qga2V5cyA9IEFDTFV0aWxzLmdldEtleXMocmF3KTtcbiAgICAgIGlmIChrZXlzPy5sZW5ndGggPT0gMCkge1xuICAgICAgICBkZWxldGUgbGlzdD8udXNlcjtcbiAgICAgICAgZGVsZXRlIGxpc3Q/LnNoYXJlZDtcbiAgICAgICAgZGVsZXRlIGxpc3Q/LmdhbGxlcnk7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBpbmZvcztcbiAgICBpZiAobGlzdCAmJiBPYmplY3Qua2V5cyhsaXN0KS5sZW5ndGgpIHtcbiAgICAgIHVzZXJSZXBvcnRzID0gbGlzdC51c2VyO1xuICAgICAgcHVibGljUmVwb3J0cyA9IGxpc3QucHVibGljO1xuICAgICAgc2hhcmVkUmVwb3J0cyA9IGxpc3Quc2hhcmVkO1xuICAgICAgZ2FsbGVyeVJlcG9ydHMgPSBsaXN0LmdhbGxlcnk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gZmV0Y2ggcmVwb3J0cyBmcm9tIHNlcnZlclxuICAgICAgc2VsZi5faXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAgICAgaW5mb3MgPSBhd2FpdCBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3Qoc2VsZi5zb3VyY2VDb3VudHJ5LCBmYWxzZSk7XG4gICAgICB1c2VyUmVwb3J0cyA9IGluZm9zLnVzZXIubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiB0cnVlIH07IH0pO1xuICAgICAgcHVibGljUmVwb3J0cyA9IGluZm9zLnB1YmxpYy5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IHRydWUgfTsgfSk7XG4gICAgICBzaGFyZWRSZXBvcnRzID0gaW5mb3Muc2hhcmVkLm1hcChyZXBvcnQgPT4geyByZXR1cm4geyAuLi5yZXBvcnQsIGlzQ2hlY2tlZDogdHJ1ZSB9OyB9KTtcbiAgICAgIGdhbGxlcnlSZXBvcnRzID0gaW5mb3MuZ2FsbGVyeS5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IHRydWUgfTsgfSk7XG4gICAgICB0aGlzLl9jb25maWdGaWx0ZXJlZFJlcG9ydHMgPSB1bmRlZmluZWQ7XG4gICAgICAvLyBkbyBub3QgdXBkYXRlIHN0UmVwb3J0TGlzdCBoZXJlIG9yIHdlIGhhdmUgZW5kbGVzcyByZW5kZXIgbG9vcFxuICAgICAgc2VsZi5fY2FjaGVkUmVwb3J0cyA9IHsgdXNlcjogdXNlclJlcG9ydHMsIHB1YmxpYzogcHVibGljUmVwb3J0cywgc2hhcmVkOiBzaGFyZWRSZXBvcnRzLCBnYWxsZXJ5OiBnYWxsZXJ5UmVwb3J0cyB9O1xuICAgICAgc2VsZi5faXNJbml0aWFsaXplZCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsaXN0IHx8IGluZm9zKSB7XG4gICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuTXlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVzZXJSZXBvcnRzO1xuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkVzcmlJbmZvZ3JhcGhpY3MuZGF0YSA9IHB1YmxpY1JlcG9ydHM7XG4gICAgICBzZWxmLl9pbmZvZ3JhcGhpY3MuU2hhcmVkSW5mb2dyYXBoaWNzLmRhdGEgPSBzaGFyZWRSZXBvcnRzO1xuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkdhbGxlcnlJbmZvZ3JhcGhpY3MuZGF0YSA9IGdhbGxlcnlSZXBvcnRzO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5NeUluZm9ncmFwaGljcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkVzcmlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5TaGFyZWRJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5HYWxsZXJ5SW5mb2dyYXBoaWNzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRlbnQgPSAoaChcImNhbGNpdGUtdHJlZVwiLCB7IHNjYWxlOiBcIm1cIiwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiB9LCBzZWxmLnJlbmRlckxpc3QoJ0VzcmlJbmZvZ3JhcGhpY3MnLCB0cnVlKSwgc2VsZi5yZW5kZXJMaXN0KCdNeUluZm9ncmFwaGljcycsIHRoaXMuaXNPbmx5Q29uZmlndXJlZFJlcG9ydExpc3QoJ015SW5mb2dyYXBoaWNzJykpLCBzZWxmLnJlbmRlckxpc3QoJ1NoYXJlZEluZm9ncmFwaGljcycsIHRoaXMuaXNPbmx5Q29uZmlndXJlZFJlcG9ydExpc3QoJ1NoYXJlZEluZm9ncmFwaGljcycpKSwgc2VsZi5yZW5kZXJMaXN0KCdHYWxsZXJ5SW5mb2dyYXBoaWNzJywgdGhpcy5pc09ubHlDb25maWd1cmVkUmVwb3J0TGlzdCgnR2FsbGVyeUluZm9ncmFwaGljcycpKSkpO1xuICAgIHNlbGYuX2NvbnRlbnQgPSBjb250ZW50O1xuICAgIHNlbGYuYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKTtcbiAgfVxuICBhc3luYyBnZXRMb2NhbEZpbHRlcmVkSW5mb2dyYXBoaWNzTGlzdCgpIHtcbiAgfVxuICAvLyBTdGVuY2lsIGxpZmVjeWNsZSAtIGNhbGxlZCBvbmNlIGFmdGVyIGNvbXBvbmVudCBpcyBmaXJzdCBjb25uZWN0ZWQgdG8gdGhlIERPTVxuICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBpZiAoc2VsZi5lbnYpIHtcbiAgICAgIHNlbGYub25FbnZDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLnRva2VuKSB7XG4gICAgICBzZWxmLm9uVG9rZW5DaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLnVzZXJuYW1lKSB7XG4gICAgICBzZWxmLm9uVXNlcm5hbWVDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLnNlbGVjdGVkUmVwb3J0SWQpIHtcbiAgICAgIHNlbGYub25TZWxlY3RlZFJlcG9ydENoYW5nZWQoKTtcbiAgICB9XG4gICAgaWYgKHNlbGYucmVwb3J0TGlzdCkge1xuICAgICAgc2VsZi5vblJlcG9ydExpc3RDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLmxhbmdDb2RlKSB7XG4gICAgICBzZWxmLm9uTGFuZ0NvZGVDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLmdlb2VucmljaG1lbnRVcmwpIHtcbiAgICAgIHNlbGYub25HZW9lbnJpY2htZW50VXJsQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBpZiAoc2VsZi5zb3VyY2VDb3VudHJ5KSB7XG4gICAgICBzZWxmLm9uU291cmNlQ291bnRyeUNoYW5nZWQoKTtcbiAgICB9XG4gICAgaWYgKHNlbGYucG9ydGFsVXJsKSB7XG4gICAgICBzZWxmLm9uUG9ydGFsVXJsQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBpZiAoc2VsZi5jb25maWcpIHtcbiAgICAgIHNlbGYub25Db25maWdDaGFuZ2Uoc2VsZi5jb25maWcsICcnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGhlbWUpIHtcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5zZXRUaGVtZSh0aGlzLnRoZW1lKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmJhc2VDb25maWcuc2V0VGhlbWUoJ2xpZ2h0Jyk7XG4gICAgfVxuICAgIHNlbGYuX2xvYWRJbnN0YW5jZXMoKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc2VsZi5yZWZyZXNoSW5mb2dyYXBoaWNMaXN0KCk7XG4gICAgICBzZWxmLl9pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgIC8vIFRPRE86IGF0IHNvbWUgcG9pbnQgd2Ugc2hvdWxkIGFkZCBiYS1hY2NvcmRpb24gYXMgYSBzdWJjb21wb25lbnRcbiAgICAgIC8vIHdoZW4gaXQgc3RhcnRzIHVzaW5nIGJhc2VDb25maWdcbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICBCYXNlVXRpbC5FcnJvcignYXJjZ2lzLWluZm9ncmFwaGljLXRyZWUgcmVxdWVzdCBmb3IgZXNyaSByZXBvcnRzIGZhaWxlZCcsIGV4KTtcbiAgICB9XG4gIH1cbiAgLy8gU3RlbmNpbCBsaWZlY3ljbGUgLSBjYWxsZWQganVzdCBhZnRlciBjb21wb25lbnQgdXBkYXRlcywgYnV0IG5vdCBjYWxsZWQgZHVyaW5nIGZpcnN0IHJlbmRlcigpXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBzZWxmLnNob3dCdXN5LmNhbGwodGhpcywgZmFsc2UpO1xuICAgIGlmIChzZWxmLmJhc2VDb25maWcpIHtcbiAgICAgIHNlbGYuYmFzZUNvbmZpZy5vbkNvbXBvbmVudEhhc1JlbmRlcmVkKCk7XG4gICAgfVxuICAgIGlmIChzZWxmLl9jYWNoZWRSZXBvcnRzKSB7XG4gICAgICBzZWxmLnN0UmVwb3J0TGlzdCA9IHNlbGYuX2NhY2hlZFJlcG9ydHM7XG4gICAgICAvLyBjYWNoZWQgcmVwb3J0cyBvbmx5IHVwZGF0ZXMgaW4gcmVmcmVzaEluZm9ncmFwaGljTGlzdCgpIGFuZCByZXNldHMgaGVyZSBhZnRlciByZW5kZXJcbiAgICAgIHNlbGYuX2NhY2hlZFJlcG9ydHMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIC8vIFN0ZW5jaWwgbGlmZWN5Y2xlIC0gY2FsbGVkIG9uY2UgYWZ0ZXIgY29tcG9uZW50IGlzIGZ1bGx5IGxvYWRlZCBhbmQgMXN0IHJlbmRlciBvY2N1cnJlZFxuICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuX2xvYWRJbnN0YW5jZXMoKTtcbiAgICBzZWxmLnNob3dCdXN5LmNhbGwoc2VsZiwgZmFsc2UpO1xuICAgIGNvbnN0IHNlYXJjaElucHV0ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuX2VsZW1lbnRJZHMuc2VhcmNoKTtcbiAgICBmdW5jdGlvbiBfb25SZXNpemUoKSB7XG4gICAgICBzZWxmLmFkanVzdFRyZWVJdGVtc1dpZHRoKCk7XG4gICAgfVxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBfb25SZXNpemUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBfb25SZXNpemUpO1xuICAgIHNlbGYuYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKTtcbiAgICBjb25zdCBvbkNsaWNrSXRlbU1ha2VEZWZhdWx0ID0gKGUpID0+IHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBlLmN1cnJlbnRUYXJnZXQuY2xvc2VzdCgnY2FsY2l0ZS10cmVlLWl0ZW0nKTtcbiAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0uaWQ7XG4gICAgICAgIGNvbnN0IHJlcG9ydElkID0gaXRlbUlkLnN1YnN0cmluZygxMCk7XG4gICAgICAgIGlmIChBQ0xVdGlscy5oYXNUZXh0KHJlcG9ydElkKSkge1xuICAgICAgICAgIHNlbGYuc2VsZWN0ZWRSZXBvcnRJZCA9IHJlcG9ydElkO1xuICAgICAgICAgIHNlbGYub25TZWxlY3RlZFJlcG9ydENoYW5nZWQoKTtcbiAgICAgICAgICBsZXQgbiA9ICcnO1xuICAgICAgICAgIGNvbnN0IHRleHRFbGVtID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdkaXYucmVwb3J0LWl0ZW0tdGV4dCcpO1xuICAgICAgICAgIGlmICh0ZXh0RWxlbSkge1xuICAgICAgICAgICAgbiA9IHRleHRFbGVtLmlubmVyVGV4dDtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VsZi5vbkNsaWNrVHJlZUl0ZW0oZSwgeyBpZDogcmVwb3J0SWQsIG5hbWU6IG4gfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIC8vIGl0ZW0gJ21ha2UgZGVmYXVsdCcgY2xpY2sgaGFuZGxlclxuICAgIGNvbnN0IGl0ZW1zID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QWxsLmNhbGwoc2VsZiwgJ2Rpdi5kZWZhdWx0LXBvcG92ZXItY29udGVudCcpO1xuICAgIGlmICghaXRlbXMgfHwgaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGl0ZW1zLmxlbmd0aDsgaWkrKykge1xuICAgICAgICBpdGVtc1tpaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsaWNrSXRlbU1ha2VEZWZhdWx0KTtcbiAgICAgICAgaXRlbXNbaWldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGlja0l0ZW1NYWtlRGVmYXVsdCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGNhbGxlZCB3aGVuIHRoZSB0cmVlIHNlYXJjaCB0ZXh0IGNoYW5nZXNcbiAgICBjb25zdCBvblNlYXJjaFF1ZXJ5Q2hhbmdlZCA9ICgpID0+IHtcbiAgICAgIHNlbGYuX2RlYm91bmNlMigoKSA9PiB7XG4gICAgICAgIC8vc2VsZi5yZWZyZXNoSW5mb2dyYXBoaWNMaXN0LmNhbGwoc2VsZilcbiAgICAgICAgc2VsZi5zdFRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgfSwgNTAwKTtcbiAgICB9O1xuICAgIGNvbnN0IHNvcnRFbGVtID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHNlbGYsIEFDTFV0aWxzLmZpeElkKHNlbGYuX2VsZW1lbnRJZHMuc29ydCkpO1xuICAgIGlmIChzb3J0RWxlbSkge1xuICAgICAgc29ydEVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2FsY2l0ZVNlbGVjdENoYW5nZScsICgpID0+IHtcbiAgICAgICAgc2VsZi5zdFNvcnRUeXBlID0gc29ydEVsZW0udmFsdWU7XG4gICAgICAgIC8vc2VsZi5yZWZyZXNoSW5mb2dyYXBoaWNMaXN0KClcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoc2VhcmNoSW5wdXQpIHtcbiAgICAgIHNlYXJjaElucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25TZWFyY2hRdWVyeUNoYW5nZWQpO1xuICAgICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvblNlYXJjaFF1ZXJ5Q2hhbmdlZCk7XG4gICAgICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjYWxjaXRlSW5wdXRDaGFuZ2UnLCBvblNlYXJjaFF1ZXJ5Q2hhbmdlZCk7XG4gICAgfVxuICAgIHNlbGYuYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKTtcbiAgfVxuICAvKipcbiAgICogRmlsdGVycyBvdXQgbXVsdGlwbGUgcmFwaWQgZXZlbnRzIG9mIHRoZSBzYW1lIHR5cGUuICBUaGUgY2FsbGJhY2tcbiAgICogZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgaWYgbm8gbmV3IGV2ZW50cyBoYXZlIGhhcHBlbmVkIGR1cmluZyB0aGVcbiAgICogJ3dhaXQnIHRpbWUuXG4gICAqIEBwYXJhbSBjYWxsYmFjayAtIHlvdXIgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBldmVudHMgaGF2ZSBzZXR0bGVkXG4gICAqIEBwYXJhbSB3YWl0ICAgICAtIG1pbGxpc2Vjb25kcyBkZWxheSAoZXg6IDI1MClcbiAgICovXG4gIF9kZWJvdW5jZTIoY2FsbGJhY2ssIHdhaXQpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBkZWxheWVkQ2FsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHNlbGYuX2RlYm91bmNlVGltZXIgPSBudWxsO1xuICAgICAgY2FsbGJhY2suYXBwbHkoc2VsZik7XG4gICAgfTtcbiAgICAvLyBldmVyeXRpbWUgX2RlYm91bmNlMiBpcyBjYWxsZWQgd2Uga2lsbCB0aGUgcHJldmlvdXMgdGltZXJcbiAgICBpZiAoc2VsZi5fZGVib3VuY2VUaW1lcilcbiAgICAgIGNsZWFyVGltZW91dChzZWxmLl9kZWJvdW5jZVRpbWVyKTtcbiAgICBzZWxmLl9kZWJvdW5jZVRpbWVyID0gc2V0VGltZW91dChkZWxheWVkQ2FsbCwgd2FpdCk7XG4gIH1cbiAgYWRqdXN0VHJlZUl0ZW1zV2lkdGgoKSB7XG4gICAgaWYgKHRoaXMuZWwpIHtcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYucmVwb3J0LWl0ZW0tY29udGVudCcpO1xuICAgICAgaWYgKCFpdGVtcyB8fCBpdGVtcy5sZW5ndGggPD0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBwID0gaXRlbXNbMF0uY2xvc2VzdCgnLnJlcG9ydExpc3QnKTtcbiAgICAgIGlmIChwKSB7XG4gICAgICAgIGNvbnN0IHd0ID0gcC5vZmZzZXRXaWR0aDtcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgIGl0ZW0uc3R5bGUud2lkdGggPSAod3QgLSA2MCkgKyAncHgnO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gYWRqdXN0IGluZm9ncmFwaGljIHByZXZpZXcgc2l6ZVxuICAgIGNvbnN0IHBvcCA9IHRoaXMuZWwucGFyZW50RWxlbWVudD8ucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBzV3QgPSBwb3A/LnN0eWxlPy53aWR0aDtcbiAgICBpZiAoc1d0ICYmIEFDTFV0aWxzLmhhc1RleHQoc1d0KSkge1xuICAgICAgY29uc3Qgd3QgPSBwYXJzZUludChzV3QpO1xuICAgICAgaWYgKCFOdW1iZXIuaXNOYU4od3QpKSB7XG4gICAgICAgIGNvbnN0IGFkanVzdGVkV2lkdGggPSB3dCAqIDAuOTtcbiAgICAgICAgaWYgKGFkanVzdGVkV2lkdGggPiAzMDApIHtcbiAgICAgICAgICAvLyBhcHBseSBuZXcgd2lkdGhcbiAgICAgICAgICBjb25zdCBwb3BzID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCdpbWcudGh1bWJuYWlsLXByZXZpZXcnKTtcbiAgICAgICAgICBpZiAocG9wcykge1xuICAgICAgICAgICAgcG9wcy5mb3JFYWNoKCh0KSA9PiB7XG4gICAgICAgICAgICAgIHQuc3R5bGUubWF4V2lkdGggPSBhZGp1c3RlZFdpZHRoICsgJ3B4JztcbiAgICAgICAgICAgICAgdC5zdHlsZS5tYXhIZWlnaHQgPSAoYWRqdXN0ZWRXaWR0aCAqIDAuNjYpICsgJ3B4JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qgb3V0ZXJEaXZTdHlsZSA9IHtcbiAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXG4gICAgICAnd2lkdGgnOiAnY2FsYygxMDAlIC0gMTJweCknLFxuICAgICAgJ2hlaWdodCc6ICdjYWxjKDEwMCUgLSA4cHgpJyxcbiAgICAgICdvdmVyZmxvdy14JzogJ2hpZGRlbicsXG4gICAgICAnb3ZlcmZsb3cteSc6ICdzY3JvbGwnXG4gICAgfTtcbiAgICBjb25zdCBwbGFjZVRleHQgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdzZWFyY2gtaW5mb3MtYnktbmFtZScpO1xuICAgIGNvbnN0IHNvcnROZXdlc3QgPSBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdkYXRlLXNvcnQtbmV3ZXN0Jyk7XG4gICAgY29uc3Qgc29ydE9sZGVzdCA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2RhdGUtc29ydC1vbGRlc3QnKTtcbiAgICBjb25zdCBuYW1lQXNjID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignbmFtZS1zb3J0LWFzYycpO1xuICAgIGNvbnN0IG5hbWVEZXNjID0gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignbmFtZS1zb3J0LWRlc2MnKTtcbiAgICB0aGlzLnJlZnJlc2hJbmZvZ3JhcGhpY0xpc3QoKTtcbiAgICAvLyBSZW5kZXIganVzdCB0aGUgb3V0ZXIgZGl2IGFuZCBidXN5IHNwaW5uZXIgdW50aWwgdGhlIGNvbXBvbmVudFxuICAgIC8vIGluaXRpYWxpemUoKSBmdW5jdGlvbiBpcyBjYWxsZWQgLSBhbmQgdGhlIGluZm9ncmFwaGljIGRhdGEgaXNcbiAgICAvLyByZWNlaXZlZC4gIFRoZSBjb250ZW50IGlzIGFkZGVkIGluIHRoZSBpbml0aWFsaXplKCkgZnVuY3Rpb24uXG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgaWQ6IHRoaXMuX2luc3RhbmNlSWQsIHN0eWxlOiBvdXRlckRpdlN0eWxlLCBjbGFzczogXCJhcmNnaXMtdHJlZS1vdXRlclwiIH0sIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fYnVzeUlkLCBjbGFzczogXCJpbmZvZ3JhcGhpYy10cmVlLWJ1c3lcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImluZm8tdHJlZS1zZWFyY2gtZGl2XCIgfSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBjbGVhcmFibGU6IFwidHJ1ZVwiLCBpZDogdGhpcy5fZWxlbWVudElkcy5zZWFyY2gsIHBsYWNlaG9sZGVyOiBwbGFjZVRleHQsIGNsYXNzOiBcImluZm8tdHJlZS1zZWFyY2hcIiB9KSwgaChcImRpdlwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLmljb24sIGNsYXNzOiBcImluZm8tdHJlZS1pY29uXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiAnbCcsIGljb246ICdzZWFyY2gnIH0pKSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGlkOiB0aGlzLl9lbGVtZW50SWRzLnNvcnQsIGNsYXNzOiBcImluZm8tdHJlZS1zb3J0XCIgfSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwibmV3ZXN0XCIgfSwgc29ydE5ld2VzdCksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcIm9sZGVzdFwiIH0sIHNvcnRPbGRlc3QpLCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogXCJhc2NlbmRpbmdcIiB9LCBuYW1lQXNjKSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwiZGVzY2VuZGluZ1wiIH0sIG5hbWVEZXNjKSksIGgoXCJkaXZcIiwgeyBpZDogdGhpcy5fZWxlbWVudElkcy5saXN0LCBjbGFzczogXCJpbmZvLXRyZWUtbGlzdFwiIH0sIGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5fY29udGVudCkpKSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiY29uZmlnXCI6IFtcIm9uQ29uZmlnQ2hhbmdlXCJdLFxuICAgIFwiZW52XCI6IFtcIm9uRW52Q2hhbmdlZFwiXSxcbiAgICBcImxhbmdDb2RlXCI6IFtcIm9uTGFuZ0NvZGVDaGFuZ2VkXCJdLFxuICAgIFwic291cmNlQ291bnRyeVwiOiBbXCJvblNvdXJjZUNvdW50cnlDaGFuZ2VkXCJdLFxuICAgIFwidG9rZW5cIjogW1wib25Ub2tlbkNoYW5nZWRcIl0sXG4gICAgXCJ1c2VybmFtZVwiOiBbXCJvblVzZXJuYW1lQ2hhbmdlZFwiXSxcbiAgICBcInNlbGVjdGVkUmVwb3J0SWRcIjogW1wib25TZWxlY3RlZFJlcG9ydENoYW5nZWRcIl0sXG4gICAgXCJyZXBvcnRMaXN0XCI6IFtcIm9uUmVwb3J0TGlzdENoYW5nZWRcIl0sXG4gICAgXCJ0aGVtZVwiOiBbXCJvblRoZW1lQ2hhbmdlZFwiXSxcbiAgICBcInBvcnRhbFVybFwiOiBbXCJvblBvcnRhbFVybENoYW5nZWRcIl0sXG4gICAgXCJnZW9lbnJpY2htZW50VXJsXCI6IFtcIm9uR2VvZW5yaWNobWVudFVybENoYW5nZWRcIl1cbiAgfTsgfVxufTtcbkFyY2dpc0luZm9ncmFwaGljVHJlZS5UaHVtYm5haWxJbmRleCA9IHt9O1xuQXJjZ2lzSW5mb2dyYXBoaWNUcmVlLnN0eWxlID0gYXJjZ2lzSW5mb2dyYXBoaWNUcmVlQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNJbmZvZ3JhcGhpY1RyZWUgYXMgQSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaW5mb2dyYXBoaWMtdHJlZS1iNzFmNGI0NS5qcy5tYXAiLCJpbXBvcnQgeyBHIGFzIEdFQ2xpZW50LCBUIGFzIFRva2VuUHJvdmlkZXIgfSBmcm9tICcuL0dFQ2xpZW50LTFhODNhNjU3LmpzJztcbmltcG9ydCB7IEIgYXMgQmFSZXBvcnRzTGFuZ3VhZ2UgfSBmcm9tICcuL0VsZW1lbnRJZHMtZjdkMjU3ZTguanMnO1xuXG5mdW5jdGlvbiBzZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodXNlcm5hbWUgIT0gbnVsbCAmJiB1c2VybmFtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAodG9rZW4gIT0gbnVsbCAmJiB0b2tlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pO1xuICAgICAgICAgICAgICAgIHJldHVybiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdvaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2ludmFsaWQtdG9rZW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdpbnZhbGlkLXVzZXJuYW1lJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgIHJldHVybiBleDtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QoY291bnRyeUNvZGUsIGZ1bGwgPSBmYWxzZSkge1xuICAgIHJldHVybiBhd2FpdCBHRUNsaWVudC5nZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QoY291bnRyeUNvZGUsIGZ1bGwpO1xufVxuXG5leHBvcnQgeyBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QgYXMgZywgc2V0VG9rZW4gYXMgcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXNSZXBvcnRzLWExZGMyNmFhLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==