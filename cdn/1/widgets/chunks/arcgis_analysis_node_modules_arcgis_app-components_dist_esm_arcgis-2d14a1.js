"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-select.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_select: () => (/* binding */ ArcgisNewItemPagesAppendSelect)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-0a84b068.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-0a84b068.js");
/* harmony import */ var _publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./publish-item-17d2f9a3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-17d2f9a3.js");
/* harmony import */ var _overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./overwrite-7eb8dfd4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/overwrite-7eb8dfd4.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */








































const arcgisNewItemPagesAppendSelectCss = ".tile-select{margin-right:0.75rem;margin-left:0.75rem;margin-top:1rem;display:grid;padding-bottom:6rem;font-size:1.125rem}@media (min-width: 480px){.tile-select{grid-template-columns:repeat(2, 1fr)}}.tile-card:hover{--tw-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.08), 0 2px 8px 0 rgba(0, 0, 0, 0.04);--tw-shadow-colored:0 4px 16px 0 var(--tw-shadow-color), 0 2px 8px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.header{margin-left:0.75rem;font-size:1rem;font-weight:500}.insert-only-info{margin-left:0.75rem;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-1)}";

const ArcgisNewItemPagesAppendSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.insertOnly = false;
        this.isCloudItem = false;
        this.isUrlItem = false;
        this.options = {
            add: {
                icon: "add-features",
                updateType: "add",
                hidden: false,
                disabled: false
            },
            update: {
                icon: "update-features",
                updateType: "update",
                hidden: false,
                disabled: false
            },
            upsert: {
                icon: "add-and-update-features",
                updateType: "upsert",
                hidden: false,
                disabled: false
            },
            overwrite: {
                icon: "overwrite-features",
                updateType: "overwrite",
                hidden: false,
                disabled: false
            }
        };
        this.selected = "add";
        this.error = undefined;
        this.loading = false;
        this.loaderType = "indeterminate";
        this.loaderMessage = undefined;
    }
    handleNext() {
        let nextPage;
        const { item, selected, layer, layerId, appendLayerEntry } = this;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption = selected;
        if (!appendLayerEntry && selected !== "overwrite" && item.layers.length > 1) {
            //feature layer is multi-layered
            nextPage = "appendSelectLayer";
        }
        else {
            if (item.cloudProviderInfo && selected === "overwrite") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.newItemMode = "file";
                if (item.cloudProviderInfo.cloudProvider) {
                    const { id, mimeType, cloudProvider } = item.cloudProviderInfo;
                    this.assignCloudItemStore(item.cloudProviderInfo);
                    this.handleOverwriteURL(item, id, mimeType, cloudProvider);
                    return;
                }
                else {
                    this.handleOverwriteURL(item);
                    return;
                }
            }
            else if (appendLayerEntry) {
                let sourceDataLayer = layer !== null && layer !== void 0 ? layer : item.layers[layerId];
                if (!sourceDataLayer) {
                    //STGL items return a layerId that is greater than length of possible layer indexes
                    sourceDataLayer = item.layers[0];
                }
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.sourceDataLayer = sourceDataLayer;
            }
            else {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.sourceDataLayer = item.layers[0];
            }
            nextPage = "appendUpload";
        }
        this.newItemUpdatePage.emit(nextPage);
    }
    createOptions() {
        var _a, _b;
        const item = this.item;
        const hasJoinedView = item.serviceInfo.sourceSchemaChangesAllowed === false;
        const noSourceData = !item.sourceData && !item.cloudProviderInfo;
        const isGeoPackageAndEnterprise = ((_a = item.sourceData) === null || _a === void 0 ? void 0 : _a.type) === "GeoPackage" && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__.c.portal.isPortal;
        const capabilities = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__.c.portal.isPortal && !item.isSDS
            ? item.serviceInfo.capabilities // portal hosted feature layer w/o 'providerSDS' typeKeyword
            : item.adminServiceInfo.capabilities; // every other hosted feature layer impl,
        if (capabilities.indexOf("ChangeTracking") !== -1 || item.serviceInfo.syncEnabled) {
            this.insertOnly = true;
            this.options.overwrite.disabled = true;
            this.options.update.disabled = true;
            this.options.upsert.disabled = true;
        } //insert only when change tracking OR sync enabled
        if (this.appendLayerEntry ||
            isGeoPackageAndEnterprise ||
            ((_b = item.sourceData) === null || _b === void 0 ? void 0 : _b.type) === "Service Definition" ||
            noSourceData ||
            hasJoinedView) {
            this.options.overwrite.disabled = true;
        }
    }
    createOverwriteNextText() {
        switch (true) {
            case this.isCloudItem:
                return "signInAndOverwrite";
            case this.isUrlItem:
                return "overwriteAndComplete";
            default:
                return "next";
        }
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o;
        this.selected = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption || "add";
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendSelect;
        this.item = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem;
        this.appendLayerEntry = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.layerId !== undefined || !!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.sublayer;
        this.layerId = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.layerId;
        this.layer = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.sublayer;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.id = null; //Set existingItem to be null so that on close, it does not delete the HFL item
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.dateFieldsTimeReference =
            (_g = (_c = (_b = (_a = this.item) === null || _a === void 0 ? void 0 : _a.publishParameters) === null || _b === void 0 ? void 0 : _b.dateFieldsTimeReference) !== null && _c !== void 0 ? _c : (_f = (_e = (_d = this.item) === null || _d === void 0 ? void 0 : _d.publishParameters) === null || _e === void 0 ? void 0 : _e.layers) === null || _f === void 0 ? void 0 : _f[0].dateFieldsTimeReference) !== null && _g !== void 0 ? _g : (_j = (_h = this.item) === null || _h === void 0 ? void 0 : _h.layers) === null || _j === void 0 ? void 0 : _j[0].dateFieldsTimeReference;
        this.isUrlItem = !!((_l = (_k = this.item) === null || _k === void 0 ? void 0 : _k.cloudProviderInfo) === null || _l === void 0 ? void 0 : _l.url);
        this.isCloudItem = !!((_o = (_m = this.item) === null || _m === void 0 ? void 0 : _m.cloudProviderInfo) === null || _o === void 0 ? void 0 : _o.cloudProvider);
        this.createOptions();
    }
    assignCloudItemStore(cloudProviderInfo) {
        const { cloudProvider, id, mimeType, cloudDriveFileName, cloudFileType, zipItemType } = cloudProviderInfo;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.cloudProvider = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__.d)(cloudProvider);
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.cloudProviderResource = {
            cloudProvider,
            id,
            mimeType,
            cloudDriveFileName,
            cloudFileType,
            zipItemType
        };
    }
    async setUpCloud(cloudProvider) {
        const provider = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__.e)(cloudProvider);
        const { result, error } = await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.g)(provider);
        if (error) {
            this.handleError();
            return null;
        }
        return result;
    }
    async handleOverwriteURL(item, id, mimeType, cloudProvider) {
        var _a, _b, _c, _d, _e, _f, _g;
        //for CSV, GeoJSON url-made items
        let dataUrl, type, typeKeywords;
        this.loading = true;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.overwriting;
        const cloudProviderInfo = item.cloudProviderInfo;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.fileName = item.title;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.title = item.title;
        if (cloudProviderInfo.cloudProvider) {
            type = _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.A[mimeType];
            typeKeywords = [_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.type];
            const token = await this.setUpCloud(cloudProvider);
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_5__.t)(200);
            switch (cloudProvider) {
                case "googleConnect":
                    dataUrl = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__.f)(id, mimeType, token);
                    break;
                case "dropBoxConnect":
                    dataUrl = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__.i)(id, token);
                    break;
                case "oneDriveConnect":
                    dataUrl = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_6__.h)(id, token);
                    break;
            }
        }
        else {
            if (cloudProviderInfo.mimeType === "geojson") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.geoJSONResource = {
                    fileName: cloudProviderInfo.fileName,
                    url: cloudProviderInfo.url,
                    mimeType: cloudProviderInfo.mimeType
                };
            }
            else {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.csvResource = {
                    fileName: cloudProviderInfo.fileName,
                    url: cloudProviderInfo.url,
                    mimeType: cloudProviderInfo.mimeType
                };
            }
            const resource = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.csvResource) !== null && _a !== void 0 ? _a : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.geoJSONResource;
            type = _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.A[resource.mimeType];
            dataUrl = resource.url;
            typeKeywords = [type];
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.dataUrl = dataUrl;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.type = type;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.typeKeywords = typeKeywords;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.overwrite = true;
        try {
            this.newItemToggleNavigationEnabled.emit(false);
            await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_9__.y)();
            const overwritePublishParameters = await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.a)(item, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__.c.portal, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__.c.user, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.id);
            const publishResponse = await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_7__.p)({
                itemId: (_c = (_b = item === null || item === void 0 ? void 0 : item.sourceData) === null || _b === void 0 ? void 0 : _b.id) !== null && _c !== void 0 ? _c : item.id,
                user: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_4__.c.user,
                title: (item === null || item === void 0 ? void 0 : item.title) || "",
                itemOwnerUrl: item.itemOwner.userContentUrl // ! Use fetchUser if itemOwner is not available
            }, overwritePublishParameters);
            await (0,_overwrite_7eb8dfd4_js__WEBPACK_IMPORTED_MODULE_8__.u)(overwritePublishParameters.publishParameters, item, (_e = (_d = publishResponse.result) === null || _d === void 0 ? void 0 : _d.services) === null || _e === void 0 ? void 0 : _e[0].serviceItemId);
            await this.checkStatus({ itemId: item.id, jobId: (_g = (_f = publishResponse.result) === null || _f === void 0 ? void 0 : _f.services) === null || _g === void 0 ? void 0 : _g[0].jobId }, publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.result);
        }
        catch (error) {
            this.handleError();
        }
    }
    async checkStatus(jobInfo, publishResponse) {
        var _a;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.overwriting;
        this.newItemToggleNavigationEnabled.emit(true);
        const response = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_9__.x)(jobInfo.itemId, { jobId: jobInfo.jobId }); //checking update of source data's job.
        const overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
        const emitPayload = Object.assign({ id: (_a = publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.services) === null || _a === void 0 ? void 0 : _a[0].serviceItemId, item: Object.assign({}, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a), overwriteStatus, appendType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption }, publishResponse);
        if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "completed") {
            emitPayload.overwriteStatus = response === null || response === void 0 ? void 0 : response.status;
            this.workflowComplete.emit(emitPayload);
            return null;
        }
        else if ((response === null || response === void 0 ? void 0 : response.status.toLowerCase()) === "failed") {
            this.handleError();
        }
        return response;
    }
    handleError() {
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText = "next";
        this.newItemToggleNavigationEnabled.emit(true);
        this.loading = false;
        this.error = {
            title: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error,
            description: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendUpload.errors.errorWhileUpload
        };
    }
    render() {
        const { i18n, options, insertOnly, error, loaderType, loading, loaderMessage } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, active: loading, text: loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "header" }, insertOnly ? i18n.insertOnlyEnabled : i18n.chooseUpdate), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "tile-select" }, Object.keys(options).map((key) => {
            const { icon, hidden, disabled } = options[key];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: key, checked: this.selected === key, heading: i18n.options[key].title, icon: icon, name: "append-select-update", width: "full", type: "radio", value: key, class: "tile-card", hidden: hidden, disabled: disabled, inputEnabled: true, onCalciteTileSelectChange: (e) => {
                    this.selected = e.target.value;
                    _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText =
                        this.selected === "overwrite" ? this.createOverwriteNextText() : "next";
                } }));
        })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, active: !!error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendSelect.style = arcgisNewItemPagesAppendSelectCss;



//# sourceMappingURL=arcgis-new-item-pages-append-select.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTJkMTRhMS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFcU07O0FBRXJNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNsRDtBQUNrQjtBQUN4QjtBQUNHO0FBQ0E7QUFDd0c7QUFDL0Y7QUFDdUQ7QUFDdEM7QUFDckQ7QUFDSztBQUNBO0FBQ0g7QUFDRztBQUNOO0FBQ0Q7QUFDTztBQUNKO0FBQ0s7QUFDQTtBQUNJO0FBQ0w7QUFDRztBQUNUO0FBQ0s7QUFDRjtBQUNIO0FBQ0M7QUFDRjtBQUNHO0FBQ0g7QUFDQztBQUNTO0FBQ1Y7QUFDQTtBQUNJO0FBQ0g7QUFDQzs7QUFFN0Isd0RBQXdELHFCQUFxQixvQkFBb0IsZ0JBQWdCLGFBQWEsb0JBQW9CLG1CQUFtQiwwQkFBMEIsYUFBYSxzQ0FBc0MsaUJBQWlCLDhFQUE4RSw0RkFBNEYsdUdBQXVHLFFBQVEsb0JBQW9CLGVBQWUsZ0JBQWdCLGtCQUFrQixvQkFBb0Isa0JBQWtCLGdCQUFnQixrQ0FBa0M7O0FBRXpyQjtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsaUNBQWlDLHFEQUFXO0FBQzVDLDhDQUE4QyxxREFBVztBQUN6RCxnQ0FBZ0MscURBQVc7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtB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LHNMQUFzTCxFQUFFLG9EQUFZLGdDQUFnQyxvREFBWSx3QkFBd0I7QUFDcFQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsOENBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDhDQUFZO0FBQy9CLHlCQUF5Qiw4Q0FBWTtBQUNyQztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsdUVBQXVFO0FBQ3ZGLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLElBQUksU0FBUyw4QkFBOEIsRUFBRSxxREFBQyw2QkFBNkIsd0RBQXdELEdBQUcscURBQUMsVUFBVSxpQkFBaUIsNERBQTRELHFEQUFDLFVBQVUsc0JBQXNCO0FBQ3JSLG9CQUFvQix5QkFBeUI7QUFDN0Msb0JBQW9CLHFEQUFDLDBCQUEwQjtBQUMvQztBQUNBLG9CQUFvQiw4Q0FBWTtBQUNoQztBQUNBLG1CQUFtQjtBQUNuQixTQUFTLElBQUkscURBQUMsNEJBQTRCLDhNQUE4TTtBQUN4UDtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQztBQUNBOztBQUVpRjs7QUFFakYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtNGUxMTAzMmMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1zZWxlY3QuZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5jb25zdCB1aWRGaWVsZHMgPSBbXCJlc3JpRmllbGRUeXBlT0lEXCIsIFwiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCJdO1xuY29uc3QgTk9ORV9WQUxVRSA9IFwiPE5vbmU+XCI7XG5jb25zdCBBcHBlbmRPdmVyd3JpdGVQdWJsaXNoVHlwZXMgPSB7XG4gICAgXCJmaWxlIGdlb2RhdGFiYXNlXCI6IFwiZmlsZWdlb2RhdGFiYXNlXCIsXG4gICAgc2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICAgIGdlb2pzb246IFwiZ2VvanNvblwiLFxuICAgIGNzdjogXCJDU1ZcIixcbiAgICBcIm1pY3Jvc29mdCBleGNlbFwiOiBcImV4Y2VsXCIsXG4gICAgZ2VvcGFja2FnZTogXCJnZW9QYWNrYWdlXCJcbn07XG5jb25zdCBhcHBlbmRGaWxlVHlwZXMgPSB7XG4gICAgU2hhcGVmaWxlOiBcInNoYXBlZmlsZVwiLFxuICAgIFwiRmlsZSBHZW9kYXRhYmFzZVwiOiBcImZpbGVHZW9kYXRhYmFzZVwiLFxuICAgIENTVjogXCJjc3ZcIixcbiAgICBcIk1pY3Jvc29mdCBFeGNlbFwiOiBcImV4Y2VsXCIsXG4gICAgR2VvSnNvbjogXCJnZW9qc29uXCIsXG4gICAgR2VvUGFja2FnZTogXCJnZW9QYWNrYWdlXCJcbn07XG5jb25zdCBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlcyA9IHtcbiAgICBjc3Y6IFwiQ1NWXCIsXG4gICAgZXhjZWw6IFwiTWljcm9zb2Z0IEV4Y2VsXCIsXG4gICAgc2hhcGVmaWxlOiBcIlNoYXBlZmlsZVwiLFxuICAgIGZnZGI6IFwiRmlsZSBHZW9kYXRhYmFzZVwiLFxuICAgIGdlb2pzb246IFwiR2VvSnNvblwiLFxuICAgIGdvb2dsZXNoZWV0czogXCJNaWNyb3NvZnQgRXhjZWxcIlxufTtcbmNvbnN0IGFwcGVuZEV4dGVuc2lvbnMgPSBbXCJ6aXBcIiwgXCJjc3ZcIiwgXCJ4bHNcIiwgXCJ4bHN4XCIsIFwiZ2VvanNvblwiLCBcImdwa2dcIiwgXCJqc29uXCJdO1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9uc0ZvckVudGVycHJpc2UgPSBbXCJ6aXBcIiwgXCJjc3ZcIiwgXCJ4bHNcIiwgXCJ4bHN4XCJdO1xuXG5leHBvcnQgeyBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlcyBhcyBBLCBOT05FX1ZBTFVFIGFzIE4sIGFwcGVuZEZpbGVUeXBlcyBhcyBhLCBBcHBlbmRPdmVyd3JpdGVQdWJsaXNoVHlwZXMgYXMgYiwgYXBwZW5kRXh0ZW5zaW9uc0ZvckVudGVycHJpc2UgYXMgYywgYXBwZW5kRXh0ZW5zaW9ucyBhcyBkLCB1aWRGaWVsZHMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHBlbmQtNGUxMTAzMmMuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuaW1wb3J0IHsgQSBhcyBBcHBlbmRPdmVyd3JpdGVDbG91ZFB1Ymxpc2hUeXBlcyB9IGZyb20gJy4vYXBwZW5kLTRlMTEwMzJjLmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1iY2E3YmNkMS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgdCBhcyB0aW1lb3V0IH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCB7IGQgYXMgZ2V0Q2xvdWRPcHRpb24sIGUgYXMgZ2V0UHJvdmlkZXJPcHRpb24sIGYgYXMgZ2V0RG93bmxvYWRVcmwsIGggYXMgZ2V0T25lRHJpdmVEb3dubG9hZFVybCwgaSBhcyBnZXREcm9wQm94RG93bmxvYWRVcmwgfSBmcm9tICcuL2luZGV4LTBhODRiMDY4LmpzJztcbmltcG9ydCB7IHAgYXMgcHVibGlzaFNlcnZpY2UgfSBmcm9tICcuL3B1Ymxpc2gtaXRlbS0xN2QyZjlhMy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFRva2VuRnJvbVByb3ZpZGVyLCBhIGFzIGdldFB1Ymxpc2hQYXJhbWV0ZXJzLCB1IGFzIHVwZGF0ZVR5cGVLZXl3b3JkcyB9IGZyb20gJy4vb3ZlcndyaXRlLTdlYjhkZmQ0LmpzJztcbmltcG9ydCB7IHkgYXMgdXBsb2FkRmlsZSwgeCBhcyBnZXRJdGVtU3RhdHVzIH0gZnJvbSAnLi9mZWF0dXJlLWxheWVyLTU3M2JiNDczLmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vdGlsZS1sYXllci1jZjA0ZmE5Ny5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC04MTM3M2Y2ZC5qcyc7XG5pbXBvcnQgJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTc0NjM5ZGFlLmpzJztcbmltcG9ydCAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTc5ZmIzMDJjLmpzJztcbmltcG9ydCAnLi9ndWlkLWFlYWVkODRkLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtYmNiODllNjkuanMnO1xuaW1wb3J0ICcuL3NlcnZpY2UtOGMyYzQyNDEuanMnO1xuaW1wb3J0ICcuL3VzZXItM2VhNjljM2EuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCAnLi9hcGktMmUzYTEzNmYuanMnO1xuaW1wb3J0ICcuL3N0cmluZy01OGE1ZmVmMy5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTE3YjY0OTQ2LmpzJztcbmltcG9ydCAnLi9hZ3MtZWI0NThhMDMuanMnO1xuaW1wb3J0ICcuL3VybC0zNTg3NWExMC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS0wMzUzYTc2OS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtNmE4OGU2YzUuanMnO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3RDc3MgPSBcIi50aWxlLXNlbGVjdHttYXJnaW4tcmlnaHQ6MC43NXJlbTttYXJnaW4tbGVmdDowLjc1cmVtO21hcmdpbi10b3A6MXJlbTtkaXNwbGF5OmdyaWQ7cGFkZGluZy1ib3R0b206NnJlbTtmb250LXNpemU6MS4xMjVyZW19QG1lZGlhIChtaW4td2lkdGg6IDQ4MHB4KXsudGlsZS1zZWxlY3R7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgyLCAxZnIpfX0udGlsZS1jYXJkOmhvdmVyey0tdHctc2hhZG93OjAgNHB4IDE2cHggMCByZ2JhKDAsIDAsIDAsIDAuMDgpLCAwIDJweCA4cHggMCByZ2JhKDAsIDAsIDAsIDAuMDQpOy0tdHctc2hhZG93LWNvbG9yZWQ6MCA0cHggMTZweCAwIHZhcigtLXR3LXNoYWRvdy1jb2xvciksIDAgMnB4IDhweCAwIHZhcigtLXR3LXNoYWRvdy1jb2xvcik7Ym94LXNoYWRvdzp2YXIoLS10dy1yaW5nLW9mZnNldC1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXJpbmctc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1zaGFkb3cpfS5oZWFkZXJ7bWFyZ2luLWxlZnQ6MC43NXJlbTtmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo1MDB9Lmluc2VydC1vbmx5LWluZm97bWFyZ2luLWxlZnQ6MC43NXJlbTtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRTZWxlY3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgICAgICB0aGlzLmluc2VydE9ubHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0Nsb3VkSXRlbSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzVXJsSXRlbSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICBhZGQ6IHtcbiAgICAgICAgICAgICAgICBpY29uOiBcImFkZC1mZWF0dXJlc1wiLFxuICAgICAgICAgICAgICAgIHVwZGF0ZVR5cGU6IFwiYWRkXCIsXG4gICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpY29uOiBcInVwZGF0ZS1mZWF0dXJlc1wiLFxuICAgICAgICAgICAgICAgIHVwZGF0ZVR5cGU6IFwidXBkYXRlXCIsXG4gICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cHNlcnQ6IHtcbiAgICAgICAgICAgICAgICBpY29uOiBcImFkZC1hbmQtdXBkYXRlLWZlYXR1cmVzXCIsXG4gICAgICAgICAgICAgICAgdXBkYXRlVHlwZTogXCJ1cHNlcnRcIixcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG92ZXJ3cml0ZToge1xuICAgICAgICAgICAgICAgIGljb246IFwib3ZlcndyaXRlLWZlYXR1cmVzXCIsXG4gICAgICAgICAgICAgICAgdXBkYXRlVHlwZTogXCJvdmVyd3JpdGVcIixcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gXCJhZGRcIjtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGVyVHlwZSA9IFwiaW5kZXRlcm1pbmF0ZVwiO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGhhbmRsZU5leHQoKSB7XG4gICAgICAgIGxldCBuZXh0UGFnZTtcbiAgICAgICAgY29uc3QgeyBpdGVtLCBzZWxlY3RlZCwgbGF5ZXIsIGxheWVySWQsIGFwcGVuZExheWVyRW50cnkgfSA9IHRoaXM7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPSBzZWxlY3RlZDtcbiAgICAgICAgaWYgKCFhcHBlbmRMYXllckVudHJ5ICYmIHNlbGVjdGVkICE9PSBcIm92ZXJ3cml0ZVwiICYmIGl0ZW0ubGF5ZXJzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIC8vZmVhdHVyZSBsYXllciBpcyBtdWx0aS1sYXllcmVkXG4gICAgICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kU2VsZWN0TGF5ZXJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpdGVtLmNsb3VkUHJvdmlkZXJJbmZvICYmIHNlbGVjdGVkID09PSBcIm92ZXJ3cml0ZVwiKSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJmaWxlXCI7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2xvdWRQcm92aWRlckluZm8uY2xvdWRQcm92aWRlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGlkLCBtaW1lVHlwZSwgY2xvdWRQcm92aWRlciB9ID0gaXRlbS5jbG91ZFByb3ZpZGVySW5mbztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hc3NpZ25DbG91ZEl0ZW1TdG9yZShpdGVtLmNsb3VkUHJvdmlkZXJJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPdmVyd3JpdGVVUkwoaXRlbSwgaWQsIG1pbWVUeXBlLCBjbG91ZFByb3ZpZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVPdmVyd3JpdGVVUkwoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBlbmRMYXllckVudHJ5KSB7XG4gICAgICAgICAgICAgICAgbGV0IHNvdXJjZURhdGFMYXllciA9IGxheWVyICE9PSBudWxsICYmIGxheWVyICE9PSB2b2lkIDAgPyBsYXllciA6IGl0ZW0ubGF5ZXJzW2xheWVySWRdO1xuICAgICAgICAgICAgICAgIGlmICghc291cmNlRGF0YUxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU1RHTCBpdGVtcyByZXR1cm4gYSBsYXllcklkIHRoYXQgaXMgZ3JlYXRlciB0aGFuIGxlbmd0aCBvZiBwb3NzaWJsZSBsYXllciBpbmRleGVzXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZURhdGFMYXllciA9IGl0ZW0ubGF5ZXJzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyID0gc291cmNlRGF0YUxheWVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNvdXJjZURhdGFMYXllciA9IGl0ZW0ubGF5ZXJzWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV4dFBhZ2UgPSBcImFwcGVuZFVwbG9hZFwiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChuZXh0UGFnZSk7XG4gICAgfVxuICAgIGNyZWF0ZU9wdGlvbnMoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLml0ZW07XG4gICAgICAgIGNvbnN0IGhhc0pvaW5lZFZpZXcgPSBpdGVtLnNlcnZpY2VJbmZvLnNvdXJjZVNjaGVtYUNoYW5nZXNBbGxvd2VkID09PSBmYWxzZTtcbiAgICAgICAgY29uc3Qgbm9Tb3VyY2VEYXRhID0gIWl0ZW0uc291cmNlRGF0YSAmJiAhaXRlbS5jbG91ZFByb3ZpZGVySW5mbztcbiAgICAgICAgY29uc3QgaXNHZW9QYWNrYWdlQW5kRW50ZXJwcmlzZSA9ICgoX2EgPSBpdGVtLnNvdXJjZURhdGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJHZW9QYWNrYWdlXCIgJiYgY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsO1xuICAgICAgICBjb25zdCBjYXBhYmlsaXRpZXMgPSBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgJiYgIWl0ZW0uaXNTRFNcbiAgICAgICAgICAgID8gaXRlbS5zZXJ2aWNlSW5mby5jYXBhYmlsaXRpZXMgLy8gcG9ydGFsIGhvc3RlZCBmZWF0dXJlIGxheWVyIHcvbyAncHJvdmlkZXJTRFMnIHR5cGVLZXl3b3JkXG4gICAgICAgICAgICA6IGl0ZW0uYWRtaW5TZXJ2aWNlSW5mby5jYXBhYmlsaXRpZXM7IC8vIGV2ZXJ5IG90aGVyIGhvc3RlZCBmZWF0dXJlIGxheWVyIGltcGwsXG4gICAgICAgIGlmIChjYXBhYmlsaXRpZXMuaW5kZXhPZihcIkNoYW5nZVRyYWNraW5nXCIpICE9PSAtMSB8fCBpdGVtLnNlcnZpY2VJbmZvLnN5bmNFbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydE9ubHkgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm92ZXJ3cml0ZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudXBkYXRlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy51cHNlcnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9IC8vaW5zZXJ0IG9ubHkgd2hlbiBjaGFuZ2UgdHJhY2tpbmcgT1Igc3luYyBlbmFibGVkXG4gICAgICAgIGlmICh0aGlzLmFwcGVuZExheWVyRW50cnkgfHxcbiAgICAgICAgICAgIGlzR2VvUGFja2FnZUFuZEVudGVycHJpc2UgfHxcbiAgICAgICAgICAgICgoX2IgPSBpdGVtLnNvdXJjZURhdGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSA9PT0gXCJTZXJ2aWNlIERlZmluaXRpb25cIiB8fFxuICAgICAgICAgICAgbm9Tb3VyY2VEYXRhIHx8XG4gICAgICAgICAgICBoYXNKb2luZWRWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMub3ZlcndyaXRlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGVPdmVyd3JpdGVOZXh0VGV4dCgpIHtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIHRoaXMuaXNDbG91ZEl0ZW06XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwic2lnbkluQW5kT3ZlcndyaXRlXCI7XG4gICAgICAgICAgICBjYXNlIHRoaXMuaXNVcmxJdGVtOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm92ZXJ3cml0ZUFuZENvbXBsZXRlXCI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm5leHRcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaCwgX2osIF9rLCBfbCwgX20sIF9vO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiB8fCBcImFkZFwiO1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRTZWxlY3Q7XG4gICAgICAgIHRoaXMuaXRlbSA9IGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW07XG4gICAgICAgIHRoaXMuYXBwZW5kTGF5ZXJFbnRyeSA9IGFkZEl0ZW1TdGF0ZS5sYXllcklkICE9PSB1bmRlZmluZWQgfHwgISFhZGRJdGVtU3RhdGUuc3VibGF5ZXI7XG4gICAgICAgIHRoaXMubGF5ZXJJZCA9IGFkZEl0ZW1TdGF0ZS5sYXllcklkO1xuICAgICAgICB0aGlzLmxheWVyID0gYWRkSXRlbVN0YXRlLnN1YmxheWVyO1xuICAgICAgICBhZGRJdGVtU3RhdGUuaWQgPSBudWxsOyAvL1NldCBleGlzdGluZ0l0ZW0gdG8gYmUgbnVsbCBzbyB0aGF0IG9uIGNsb3NlLCBpdCBkb2VzIG5vdCBkZWxldGUgdGhlIEhGTCBpdGVtXG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRlRmllbGRzVGltZVJlZmVyZW5jZSA9XG4gICAgICAgICAgICAoX2cgPSAoX2MgPSAoX2IgPSAoX2EgPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wdWJsaXNoUGFyYW1ldGVycykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAoX2YgPSAoX2UgPSAoX2QgPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5wdWJsaXNoUGFyYW1ldGVycykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmxheWVycykgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mWzBdLmRhdGVGaWVsZHNUaW1lUmVmZXJlbmNlKSAhPT0gbnVsbCAmJiBfZyAhPT0gdm9pZCAwID8gX2cgOiAoX2ogPSAoX2ggPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaC5sYXllcnMpID09PSBudWxsIHx8IF9qID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfalswXS5kYXRlRmllbGRzVGltZVJlZmVyZW5jZTtcbiAgICAgICAgdGhpcy5pc1VybEl0ZW0gPSAhISgoX2wgPSAoX2sgPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfay5jbG91ZFByb3ZpZGVySW5mbykgPT09IG51bGwgfHwgX2wgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9sLnVybCk7XG4gICAgICAgIHRoaXMuaXNDbG91ZEl0ZW0gPSAhISgoX28gPSAoX20gPSB0aGlzLml0ZW0pID09PSBudWxsIHx8IF9tID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbS5jbG91ZFByb3ZpZGVySW5mbykgPT09IG51bGwgfHwgX28gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9vLmNsb3VkUHJvdmlkZXIpO1xuICAgICAgICB0aGlzLmNyZWF0ZU9wdGlvbnMoKTtcbiAgICB9XG4gICAgYXNzaWduQ2xvdWRJdGVtU3RvcmUoY2xvdWRQcm92aWRlckluZm8pIHtcbiAgICAgICAgY29uc3QgeyBjbG91ZFByb3ZpZGVyLCBpZCwgbWltZVR5cGUsIGNsb3VkRHJpdmVGaWxlTmFtZSwgY2xvdWRGaWxlVHlwZSwgemlwSXRlbVR5cGUgfSA9IGNsb3VkUHJvdmlkZXJJbmZvO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlciA9IGdldENsb3VkT3B0aW9uKGNsb3VkUHJvdmlkZXIpO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlclJlc291cmNlID0ge1xuICAgICAgICAgICAgY2xvdWRQcm92aWRlcixcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgbWltZVR5cGUsXG4gICAgICAgICAgICBjbG91ZERyaXZlRmlsZU5hbWUsXG4gICAgICAgICAgICBjbG91ZEZpbGVUeXBlLFxuICAgICAgICAgICAgemlwSXRlbVR5cGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgc2V0VXBDbG91ZChjbG91ZFByb3ZpZGVyKSB7XG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gZ2V0UHJvdmlkZXJPcHRpb24oY2xvdWRQcm92aWRlcik7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgZ2V0VG9rZW5Gcm9tUHJvdmlkZXIocHJvdmlkZXIpO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU92ZXJ3cml0ZVVSTChpdGVtLCBpZCwgbWltZVR5cGUsIGNsb3VkUHJvdmlkZXIpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nO1xuICAgICAgICAvL2ZvciBDU1YsIEdlb0pTT04gdXJsLW1hZGUgaXRlbXNcbiAgICAgICAgbGV0IGRhdGFVcmwsIHR5cGUsIHR5cGVLZXl3b3JkcztcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy5vdmVyd3JpdGluZztcbiAgICAgICAgY29uc3QgY2xvdWRQcm92aWRlckluZm8gPSBpdGVtLmNsb3VkUHJvdmlkZXJJbmZvO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSBpdGVtLnRpdGxlO1xuICAgICAgICBhZGRJdGVtU3RhdGUudGl0bGUgPSBpdGVtLnRpdGxlO1xuICAgICAgICBpZiAoY2xvdWRQcm92aWRlckluZm8uY2xvdWRQcm92aWRlcikge1xuICAgICAgICAgICAgdHlwZSA9IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzW21pbWVUeXBlXTtcbiAgICAgICAgICAgIHR5cGVLZXl3b3JkcyA9IFthZGRJdGVtU3RhdGUudHlwZV07XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuc2V0VXBDbG91ZChjbG91ZFByb3ZpZGVyKTtcbiAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMjAwKTtcbiAgICAgICAgICAgIHN3aXRjaCAoY2xvdWRQcm92aWRlcikge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJnb29nbGVDb25uZWN0XCI6XG4gICAgICAgICAgICAgICAgICAgIGRhdGFVcmwgPSBnZXREb3dubG9hZFVybChpZCwgbWltZVR5cGUsIHRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRyb3BCb3hDb25uZWN0XCI6XG4gICAgICAgICAgICAgICAgICAgIGRhdGFVcmwgPSBnZXREcm9wQm94RG93bmxvYWRVcmwoaWQsIHRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm9uZURyaXZlQ29ubmVjdFwiOlxuICAgICAgICAgICAgICAgICAgICBkYXRhVXJsID0gZ2V0T25lRHJpdmVEb3dubG9hZFVybChpZCwgdG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjbG91ZFByb3ZpZGVySW5mby5taW1lVHlwZSA9PT0gXCJnZW9qc29uXCIpIHtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuZ2VvSlNPTlJlc291cmNlID0ge1xuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogY2xvdWRQcm92aWRlckluZm8uZmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogY2xvdWRQcm92aWRlckluZm8udXJsLFxuICAgICAgICAgICAgICAgICAgICBtaW1lVHlwZTogY2xvdWRQcm92aWRlckluZm8ubWltZVR5cGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmNzdlJlc291cmNlID0ge1xuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogY2xvdWRQcm92aWRlckluZm8uZmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogY2xvdWRQcm92aWRlckluZm8udXJsLFxuICAgICAgICAgICAgICAgICAgICBtaW1lVHlwZTogY2xvdWRQcm92aWRlckluZm8ubWltZVR5cGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2UgPSAoX2EgPSBhZGRJdGVtU3RhdGUuY3N2UmVzb3VyY2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGFkZEl0ZW1TdGF0ZS5nZW9KU09OUmVzb3VyY2U7XG4gICAgICAgICAgICB0eXBlID0gQXBwZW5kT3ZlcndyaXRlQ2xvdWRQdWJsaXNoVHlwZXNbcmVzb3VyY2UubWltZVR5cGVdO1xuICAgICAgICAgICAgZGF0YVVybCA9IHJlc291cmNlLnVybDtcbiAgICAgICAgICAgIHR5cGVLZXl3b3JkcyA9IFt0eXBlXTtcbiAgICAgICAgfVxuICAgICAgICBhZGRJdGVtU3RhdGUuZGF0YVVybCA9IGRhdGFVcmw7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gdHlwZTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGVLZXl3b3JkcyA9IHR5cGVLZXl3b3JkcztcbiAgICAgICAgYWRkSXRlbVN0YXRlLm92ZXJ3cml0ZSA9IHRydWU7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KGZhbHNlKTtcbiAgICAgICAgICAgIGF3YWl0IHVwbG9hZEZpbGUoKTtcbiAgICAgICAgICAgIGNvbnN0IG92ZXJ3cml0ZVB1Ymxpc2hQYXJhbWV0ZXJzID0gYXdhaXQgZ2V0UHVibGlzaFBhcmFtZXRlcnMoaXRlbSwgY29uZmlnU3RhdGUucG9ydGFsLCBjb25maWdTdGF0ZS51c2VyLCBhZGRJdGVtU3RhdGUuaWQpO1xuICAgICAgICAgICAgY29uc3QgcHVibGlzaFJlc3BvbnNlID0gYXdhaXQgcHVibGlzaFNlcnZpY2Uoe1xuICAgICAgICAgICAgICAgIGl0ZW1JZDogKF9jID0gKF9iID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLnNvdXJjZURhdGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogaXRlbS5pZCxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb25maWdTdGF0ZS51c2VyLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLnRpdGxlKSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgIGl0ZW1Pd25lclVybDogaXRlbS5pdGVtT3duZXIudXNlckNvbnRlbnRVcmwgLy8gISBVc2UgZmV0Y2hVc2VyIGlmIGl0ZW1Pd25lciBpcyBub3QgYXZhaWxhYmxlXG4gICAgICAgICAgICB9LCBvdmVyd3JpdGVQdWJsaXNoUGFyYW1ldGVycyk7XG4gICAgICAgICAgICBhd2FpdCB1cGRhdGVUeXBlS2V5d29yZHMob3ZlcndyaXRlUHVibGlzaFBhcmFtZXRlcnMucHVibGlzaFBhcmFtZXRlcnMsIGl0ZW0sIChfZSA9IChfZCA9IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lWzBdLnNlcnZpY2VJdGVtSWQpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGVja1N0YXR1cyh7IGl0ZW1JZDogaXRlbS5pZCwgam9iSWQ6IChfZyA9IChfZiA9IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nWzBdLmpvYklkIH0sIHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5yZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGNoZWNrU3RhdHVzKGpvYkluZm8sIHB1Ymxpc2hSZXNwb25zZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZC5hcHBlbmRMb2FkaW5nTWVzc2FnZXMub3ZlcndyaXRpbmc7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQodHJ1ZSk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0SXRlbVN0YXR1cyhqb2JJbmZvLml0ZW1JZCwgeyBqb2JJZDogam9iSW5mby5qb2JJZCB9KTsgLy9jaGVja2luZyB1cGRhdGUgb2Ygc291cmNlIGRhdGEncyBqb2IuXG4gICAgICAgIGNvbnN0IG92ZXJ3cml0ZVN0YXR1cyA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXM7XG4gICAgICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IGlkOiAoX2EgPSBwdWJsaXNoUmVzcG9uc2UgPT09IG51bGwgfHwgcHVibGlzaFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUmVzcG9uc2Uuc2VydmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXS5zZXJ2aWNlSXRlbUlkLCBpdGVtOiBPYmplY3QuYXNzaWduKHt9LCBhZGRJdGVtU3RhdGUpLCBvdmVyd3JpdGVTdGF0dXMsIGFwcGVuZFR5cGU6IGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gfSwgcHVibGlzaFJlc3BvbnNlKTtcbiAgICAgICAgaWYgKChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2Uuc3RhdHVzLnRvTG93ZXJDYXNlKCkpID09PSBcImNvbXBsZXRlZFwiKSB7XG4gICAgICAgICAgICBlbWl0UGF5bG9hZC5vdmVyd3JpdGVTdGF0dXMgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5zdGF0dXMudG9Mb3dlckNhc2UoKSkgPT09IFwiZmFpbGVkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxuICAgIGhhbmRsZUVycm9yKCkge1xuICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcIm5leHRcIjtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB7XG4gICAgICAgICAgICB0aXRsZTogdWlTdG9yZVN0YXRlLmkxOG4uZXJyb3IsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kVXBsb2FkLmVycm9ycy5lcnJvcldoaWxlVXBsb2FkXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBvcHRpb25zLCBpbnNlcnRPbmx5LCBlcnJvciwgbG9hZGVyVHlwZSwgbG9hZGluZywgbG9hZGVyTWVzc2FnZSB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IHsgXCJvdmVyZmxvdy1oaWRkZW5cIjogbG9hZGluZyB9IH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogbG9hZGVyVHlwZSwgYWN0aXZlOiBsb2FkaW5nLCB0ZXh0OiBsb2FkZXJNZXNzYWdlIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGVhZGVyXCIgfSwgaW5zZXJ0T25seSA/IGkxOG4uaW5zZXJ0T25seUVuYWJsZWQgOiBpMThuLmNob29zZVVwZGF0ZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJ0aWxlLXNlbGVjdFwiIH0sIE9iamVjdC5rZXlzKG9wdGlvbnMpLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGljb24sIGhpZGRlbiwgZGlzYWJsZWQgfSA9IG9wdGlvbnNba2V5XTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBrZXk6IGtleSwgY2hlY2tlZDogdGhpcy5zZWxlY3RlZCA9PT0ga2V5LCBoZWFkaW5nOiBpMThuLm9wdGlvbnNba2V5XS50aXRsZSwgaWNvbjogaWNvbiwgbmFtZTogXCJhcHBlbmQtc2VsZWN0LXVwZGF0ZVwiLCB3aWR0aDogXCJmdWxsXCIsIHR5cGU6IFwicmFkaW9cIiwgdmFsdWU6IGtleSwgY2xhc3M6IFwidGlsZS1jYXJkXCIsIGhpZGRlbjogaGlkZGVuLCBkaXNhYmxlZDogZGlzYWJsZWQsIGlucHV0RW5hYmxlZDogdHJ1ZSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9PT0gXCJvdmVyd3JpdGVcIiA/IHRoaXMuY3JlYXRlT3ZlcndyaXRlTmV4dFRleHQoKSA6IFwibmV4dFwiO1xuICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICB9KSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBoZWFkaW5nOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IudGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuZGVzY3JpcHRpb24sIGFjdGl2ZTogISFlcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0FwcGVuZFNlbGVjdENzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hcHBlbmRfc2VsZWN0IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LmVudHJ5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==