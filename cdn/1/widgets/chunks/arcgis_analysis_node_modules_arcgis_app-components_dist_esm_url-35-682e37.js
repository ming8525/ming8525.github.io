"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_url-35-682e37"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js":
/*!*********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ agsServerMap),
/* harmony export */   i: () => (/* binding */ isAGS)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const agsServerMap = {
    FeatureServer: "Feature Service",
    GeocodeServer: "Geocoding Service",
    GeoDataServer: "Geodata Service",
    GeometryServer: "Geometry Service",
    GeoenrichmentServer: "Geoenrichment Service",
    GPServer: "Geoprocessing Service",
    GlobeServer: "Globe Service",
    ImageServer: "Image Service",
    MapServer: "Map Service",
    NAServer: "Network Analysis Service",
    ElevationServer: "Image Service",
    VectorTileServer: "Vector Tile Service",
    SceneServer: "Scene Service",
    StreamServer: "Stream Service",
    WMServer: "Workflow Manager Service",
    TiledImageServer: "Image Service",
    VideoServer: "Video Service"
};
const isAGS = (type) => !!Object.values(agsServerMap).includes(type);



//# sourceMappingURL=ags-eb458a03.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ setSessionStorageItem),
/* harmony export */   b: () => (/* binding */ getSessionStorageItem),
/* harmony export */   c: () => (/* binding */ getCookie),
/* harmony export */   d: () => (/* binding */ setCookie),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
    writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
    const cookie = readCookie(name);
    return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
    window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
    const item = window.localStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
    window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
    const item = window.sessionStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
    const cookie = document.cookie;
    const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
    const matchedCookies = cookie.match(cookieNameRE);
    return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
    properties = properties || {};
    let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
    if (typeof expires === "number") {
        const expirationDate = new Date();
        const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
        expirationDate.setTime(Date.now() + daysFromTodayInMs);
        expires = properties.expires = expirationDate;
    }
    if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
        properties.expires = expires.toUTCString();
    }
    let cookie = `${name}=${encodeURIComponent(value)}`;
    let property;
    for (property in properties) {
        cookie += `; ${property}`;
        const propertyValue = properties[property];
        if (propertyValue !== true) {
            cookie += `=${propertyValue}`;
        }
    }
    document.cookie = cookie;
}



//# sourceMappingURL=storage-0353a769.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js":
/*!*********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js ***!
  \*********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isHostedService),
/* harmony export */   b: () => (/* binding */ supportsHttps),
/* harmony export */   c: () => (/* binding */ urlToObject),
/* harmony export */   d: () => (/* binding */ formatGISUrl),
/* harmony export */   e: () => (/* binding */ checkProtocol),
/* harmony export */   f: () => (/* binding */ formatUrl),
/* harmony export */   g: () => (/* binding */ getUrlType),
/* harmony export */   i: () => (/* binding */ isHttp),
/* harmony export */   r: () => (/* binding */ removeTrailingSlash),
/* harmony export */   s: () => (/* binding */ supportsDirect),
/* harmony export */   u: () => (/* binding */ urlToTitle)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */







function removeTrailingSlash(url) {
    if ((url === null || url === void 0 ? void 0 : url.slice(-1)) === "/") {
        // Remove the "/" from the end of the url
        return url.slice(0, url.length - 1);
    }
    return url;
}
// borrowed from arcgisonline.sharing.util
async function urlToObject(url) {
    var _a;
    const apiVersion = (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : 4;
    const [urlUtils] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__.l)([apiVersion === 4 ? "esri/core/urlUtils" : "esri/urlUtils"]);
    let urlObj = urlUtils.urlToObject(url);
    urlObj.query = urlObj.query || {};
    for (let key in urlObj.query || {}) {
        if (urlObj.query.hasOwnProperty(key)) {
            // strip out some HTML (<,>,%3C,%3E,&lt;,&gt;)
            if (!Array.isArray(urlObj.query[key])) {
                urlObj.query[key] = urlObj.query[key].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g, "");
            }
        }
    }
    return urlObj;
}
function urlToTitle(url) {
    return (url === null || url === void 0 ? void 0 : url.replace(/^.*\//, "").replace(/.[^.]*$/, "")) || "";
}
function supportsDirect(type) {
    // TODO: Set mapped AGSTypes to UrlType, then re-enable here
    const direct = ["WFS", "GeoJson", "CSV", "GeoRSS", "KML", "OGCFeatureServer", "WMS", "WMTS"];
    return direct.includes(type);
}
function supportsHttps(url) {
    const { config, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
    let supportsHttps = false;
    if (!url) {
        return false;
    }
    (config.httpsDomains || []).forEach((domain) => {
        if (url.indexOf(`.${domain}/`) > -1 || url.indexOf(`/${domain}/`) > -1) {
            supportsHttps = true;
        }
    });
    if (!supportsHttps) {
        let portalHostname = portal.portalHostname;
        if (portalHostname.indexOf("/") > -1) {
            portalHostname = portalHostname.substring(0, portalHostname.indexOf("/"));
        }
        if (url.indexOf(portalHostname) > -1) {
            supportsHttps = true;
        }
    }
    return supportsHttps;
}
function isHostedService(url) {
    if (!url) {
        return false;
    }
    const { config, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const restBaseUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const hostname = new URL(restBaseUrl).hostname;
    const isSingleTenant = false === config.isMultiTenant;
    // only consider locally hosted if the restBaseUrl is on same domain as url
    // and esriGeowConfig.self.supportsHostedServices flag is enabled
    const isAGOL = url.indexOf(".arcgis.com/") !== -1;
    const isHostedServer = url.indexOf("//services") !== -1 ||
        url.indexOf("//tiles") !== -1 ||
        url.indexOf("//features") !== -1 ||
        url.indexOf("//locationservices") !== -1;
    const isLocallyHosted = portal.supportsHostedServices && url.indexOf(hostname) !== -1 && !isSingleTenant;
    return (isAGOL && isHostedServer) || (!isAGOL && isLocallyHosted);
}
function checkProtocol() {
    var _a;
    // For portal case, if adding a secure proxy, and page is http
    // we need to reload on https - IWS invalid case
    const protocol = window.location.protocol;
    if (protocol.toLowerCase().indexOf("https") === -1) {
        const cookie = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_4__.c)("esri_auth", true);
        if (((_a = cookie === null || cookie === void 0 ? void 0 : cookie.auth_tier) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === "web") {
            return false;
        }
        else {
            return true;
        }
    }
    else {
        return true;
    }
}
function formatGISUrl(url) {
    /*
       User  entered :
       http://sampleserver3.arcgisonline.com
       Software completes to :
       http://sampleserver3.arcgisonline.com/arcgis/rest/services
  
       User  entered :
       http://sampleserver3.arcgisonline.com/arcgis
       Software completes to:
       http://sampleserver3.arcgisonline.com/arcgis/rest/services
  
       User  entered :
       http://sampleserver3.arcgisonline.com/arcgis/rest/services
       Software completes to:
       http://sampleserver3.arcgisonline.com/arcgis/rest/services
  
       User entered a url to a folder in a server :
       http://sampleserver3.arcgisonline.com/arcgis/rest/services/petro
       Software completes to:
       http://sampleserver3.arcgisonline.com/arcgis/rest/services/petro
  
       User entered a url to a folder in a server :
       http://sampleserver3.arcgisonline.com/arcgis/rest/services/water/MapServer
       Software completes to:
       http://sampleserver3.arcgisonline.com/arcgis/rest/services/water/MapServer
       */
    let u = url.toLowerCase();
    // add http:// if it's missing
    if (u.indexOf("http://") == -1 && u.indexOf("https://") == -1) {
        url = "https://" + url;
        u = url.toLowerCase();
    }
    // find path part of URL
    let pathPos = u.indexOf("//");
    pathPos = u.indexOf("/", pathPos + 2);
    // just domain?
    if (pathPos == -1) {
        url += "/arcgis/rest/services";
        u = url.toLowerCase();
    }
    else if (pathPos == u.length - 1) {
        url += "arcgis/rest/services";
        u = url.toLowerCase();
    }
    // just arcgis path?
    let p0 = u.indexOf("/arcgis", pathPos);
    if (p0 == u.length - 7) {
        url += "/rest/services";
        u = url.toLowerCase();
    }
    else if (p0 == u.length - 8) {
        url += "rest/services";
        u = url.toLowerCase();
    }
    // just server path? (WebAdaptor)
    p0 = u.indexOf("/server", pathPos);
    if (u.endsWith("/server")) {
        url += "/rest/services";
        u = url.toLowerCase();
    }
    else if (u.endsWith("/server/")) {
        url += "rest/services";
        u = url.toLowerCase();
    }
    // replace SOAP end point or short REST end point with REST end point
    const p1 = u.indexOf("/rest/services", pathPos);
    const p2 = u.indexOf("/services", pathPos);
    const p3 = u.indexOf("/rest", pathPos);
    if (p1 == -1 && p2 > -1) {
        url = `${url.substring(0, p2)}/rest/services${url.substring(p2 + 9)}`;
        u = url.toLowerCase();
    }
    else if (p1 == -1 && p3 > -1) {
        url = `${url.substring(0, p3)}/rest/services${url.substring(p3 + 5)}`;
        u = url.toLowerCase();
    }
    // is it a REST end point?
    if (u.indexOf("/rest/services") == -1) ;
    return url;
}
const formatUrl = (url, allSSL = false) => {
    const protocolRegex = /(http|https|ftp):\/\/?/;
    url = removeTrailingSlash(url);
    if (!protocolRegex.exec(url)) {
        url = `https://${url}`;
    }
    if ((allSSL || location.protocol === "https:") && (isHostedService(url) || supportsHttps(url))) {
        url = url.replace("http:/", "https:/");
    }
    // Filter out dynamicLayer
    url = url.indexOf("/dynamicLayer?") > -1 ? url.substring(0, url.indexOf("/dynamicLayer?")) : url;
    return url;
};
/** Get type based on input url and also returns a fix if url is malformed
 */
const getUrlType = (url, isPortal = false) => {
    var _a, _b, _c;
    if (!url) {
        return { error: { code: "invalidUrl" } };
    }
    if (isHttp(url, isPortal)) {
        return { error: { code: "httpWarning" } };
    }
    const decodedUrl = decodeURIComponent(url);
    const kmlType = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(/((\.|\/)*(kml|kmz))/gi);
    const ogcType = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(/((\/|\=)(wmts|wms|wfs))/gi);
    const ogcFeatureType = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(/((\/|\=)(OGC|OGCFeatureServer))/gi);
    const rssType = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(/((\.|\/)*(rss))/gi);
    const serverType = (_a = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.r)) === null || _a === void 0 ? void 0 : _a[1];
    const containsAGS = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.c);
    const csvType = decodedUrl.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "").match(/((\.|\/)*(csv))/gi);
    const tileLayerType = decodedUrl
        .replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.v, "")
        .match(/(\.|\/)((\$?{(z|level)})\/*(\$?{(x|col)})\/*(\$?{(y|row)}))/gi);
    let type = null;
    if (decodedUrl.match(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.b)) {
        type = "GeoJson";
    }
    else if (ogcFeatureType && !ogcType && !serverType) {
        type = "OGCFeatureServer";
    }
    else if (serverType && !ogcType) {
        type = _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_5__.a[serverType];
    }
    else if (containsAGS) {
        // Assume URLS with /ags/ and no specified server are Map Services
        type = "Map Service";
    }
    else if (ogcType) {
        const symbol = (ogcType === null || ogcType === void 0 ? void 0 : ogcType[0].charAt(0)) === "/" ? "/" : "=";
        type = (_c = (_b = ogcType === null || ogcType === void 0 ? void 0 : ogcType[0]) === null || _b === void 0 ? void 0 : _b.split(symbol)[1]) === null || _c === void 0 ? void 0 : _c.toUpperCase();
    }
    else if (kmlType) {
        type = "KML";
    }
    else if (rssType) {
        type = "GeoRSS";
    }
    else if (csvType) {
        type = "CSV";
    }
    else if (tileLayerType) {
        type = "Tile Layer";
    }
    return { result: type };
};
/**
 * Checks if url includes http://
 * Not applicable to enterprise
 */
const isHttp = (url, isPortal) => {
    return !isPortal && url.includes("http://");
};



//# sourceMappingURL=url-35875a10.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fdXJsLTM1LTY4MmUzNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFeUM7O0FBRXpDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RDs7QUFFN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLEdBQUcsMERBQVksT0FBTyxLQUFLO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixLQUFLLEdBQUcsMEJBQTBCO0FBQ3REO0FBQ0E7QUFDQSxxQkFBcUIsRUFBRSxTQUFTO0FBQ2hDO0FBQ0E7QUFDQSwwQkFBMEIsY0FBYztBQUN4QztBQUNBO0FBQ0E7QUFDQTs7QUFFc0o7O0FBRXRKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDMkQ7QUFDbUU7QUFDdEU7QUFDSztBQUNOO0FBQ0Q7O0FBRXREO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGtEQUFXLGFBQWEsa0RBQVcsdUJBQXVCLGtEQUFXO0FBQ2xHLDZCQUE2QiwyREFBVztBQUN4QztBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0Esb0RBQW9ELEtBQUs7QUFDekQ7QUFDQSxvRUFBb0UsS0FBSztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpQkFBaUIsRUFBRSxrREFBVztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLE9BQU8sNEJBQTRCLE9BQU87QUFDdEU7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGlCQUFpQixFQUFFLGtEQUFXO0FBQzFDLHdCQUF3QixzREFBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsdURBQVM7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHFCQUFxQixnQkFBZ0Isc0JBQXNCO0FBQzVFO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixxQkFBcUIsZ0JBQWdCLHNCQUFzQjtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixJQUFJO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFNBQVM7QUFDMUI7QUFDQTtBQUNBLGlCQUFpQixTQUFTO0FBQzFCO0FBQ0E7QUFDQSx1Q0FBdUMsK0NBQTBCO0FBQ2pFLHVDQUF1QywrQ0FBMEI7QUFDakUsOENBQThDLCtDQUEwQjtBQUN4RSx1Q0FBdUMsK0NBQTBCO0FBQ2pFLGdEQUFnRCwrQ0FBMEIsWUFBWSwrQ0FBZTtBQUNyRywyQ0FBMkMsK0NBQTBCLFlBQVksK0NBQVM7QUFDMUYsdUNBQXVDLCtDQUEwQjtBQUNqRTtBQUNBLGlCQUFpQiwrQ0FBMEI7QUFDM0MsNkJBQTZCLFVBQVUsU0FBUyxRQUFRLFNBQVMsUUFBUTtBQUN6RTtBQUNBLHlCQUF5QiwrQ0FBYTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLCtDQUFZO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUyTjs7QUFFM04iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hZ3MtZWI0NThhMDMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc3RvcmFnZS0wMzUzYTc2OS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS91cmwtMzU4NzVhMTAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5jb25zdCBhZ3NTZXJ2ZXJNYXAgPSB7XG4gICAgRmVhdHVyZVNlcnZlcjogXCJGZWF0dXJlIFNlcnZpY2VcIixcbiAgICBHZW9jb2RlU2VydmVyOiBcIkdlb2NvZGluZyBTZXJ2aWNlXCIsXG4gICAgR2VvRGF0YVNlcnZlcjogXCJHZW9kYXRhIFNlcnZpY2VcIixcbiAgICBHZW9tZXRyeVNlcnZlcjogXCJHZW9tZXRyeSBTZXJ2aWNlXCIsXG4gICAgR2VvZW5yaWNobWVudFNlcnZlcjogXCJHZW9lbnJpY2htZW50IFNlcnZpY2VcIixcbiAgICBHUFNlcnZlcjogXCJHZW9wcm9jZXNzaW5nIFNlcnZpY2VcIixcbiAgICBHbG9iZVNlcnZlcjogXCJHbG9iZSBTZXJ2aWNlXCIsXG4gICAgSW1hZ2VTZXJ2ZXI6IFwiSW1hZ2UgU2VydmljZVwiLFxuICAgIE1hcFNlcnZlcjogXCJNYXAgU2VydmljZVwiLFxuICAgIE5BU2VydmVyOiBcIk5ldHdvcmsgQW5hbHlzaXMgU2VydmljZVwiLFxuICAgIEVsZXZhdGlvblNlcnZlcjogXCJJbWFnZSBTZXJ2aWNlXCIsXG4gICAgVmVjdG9yVGlsZVNlcnZlcjogXCJWZWN0b3IgVGlsZSBTZXJ2aWNlXCIsXG4gICAgU2NlbmVTZXJ2ZXI6IFwiU2NlbmUgU2VydmljZVwiLFxuICAgIFN0cmVhbVNlcnZlcjogXCJTdHJlYW0gU2VydmljZVwiLFxuICAgIFdNU2VydmVyOiBcIldvcmtmbG93IE1hbmFnZXIgU2VydmljZVwiLFxuICAgIFRpbGVkSW1hZ2VTZXJ2ZXI6IFwiSW1hZ2UgU2VydmljZVwiLFxuICAgIFZpZGVvU2VydmVyOiBcIlZpZGVvIFNlcnZpY2VcIlxufTtcbmNvbnN0IGlzQUdTID0gKHR5cGUpID0+ICEhT2JqZWN0LnZhbHVlcyhhZ3NTZXJ2ZXJNYXApLmluY2x1ZGVzKHR5cGUpO1xuXG5leHBvcnQgeyBhZ3NTZXJ2ZXJNYXAgYXMgYSwgaXNBR1MgYXMgaSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZ3MtZWI0NThhMDMuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBlIGFzIGVzY2FwZVJlZ0V4cCB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5cbi8vIGltcG9ydCBzdHJpbmdVdGlsIGZyb20gXCIuL3N0cmluZ3NcIjtcbi8qKlxuICogVXRpbGl0eSBtZXRob2RzIGZvciBkZWFsaW5nIHdpdGggc3RvcmFnZSBvZiB2YXJpb3VzIGZvcm1zIChjb29raWVzLCBsb2NhbCBzdG9yYWdlLCBhbmQgc2Vzc2lvbiBzdG9yYWdlKS5cbiAqL1xuZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsIGNvb2tpZSwgcHJvcGVydGllcywgc3RyaW5naWZ5KSB7XG4gICAgd3JpdGVDb29raWUobmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoY29va2llKSA6IGNvb2tpZSwgcHJvcGVydGllcyk7XG59XG5mdW5jdGlvbiBnZXRDb29raWUobmFtZSwgcGFyc2UpIHtcbiAgICBjb25zdCBjb29raWUgPSByZWFkQ29va2llKG5hbWUpO1xuICAgIHJldHVybiBjb29raWUgJiYgcGFyc2UgPyBKU09OLnBhcnNlKGNvb2tpZSkgOiBjb29raWU7XG59XG5mdW5jdGlvbiBzZXRMb2NhbFN0b3JhZ2VJdGVtKG5hbWUsIGl0ZW0sIHN0cmluZ2lmeSkge1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0obmFtZSk7XG4gICAgcmV0dXJuIGl0ZW0gJiYgcGFyc2UgPyBKU09OLnBhcnNlKGl0ZW0pIDogaXRlbTtcbn1cbmZ1bmN0aW9uIHNldFNlc3Npb25TdG9yYWdlSXRlbShuYW1lLCBpdGVtLCBzdHJpbmdpZnkpIHtcbiAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShuYW1lLCBzdHJpbmdpZnkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW0pO1xufVxuZnVuY3Rpb24gZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtKG5hbWUsIHBhcnNlKSB7XG4gICAgY29uc3QgaXRlbSA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICAgIHJldHVybiBpdGVtICYmIHBhcnNlID8gSlNPTi5wYXJzZShpdGVtKSA6IGl0ZW07XG59XG5mdW5jdGlvbiByZWFkQ29va2llKG5hbWUpIHtcbiAgICBjb25zdCBjb29raWUgPSBkb2N1bWVudC5jb29raWU7XG4gICAgY29uc3QgY29va2llTmFtZVJFID0gbmV3IFJlZ0V4cChgKD86Xnw7ICkke2VzY2FwZVJlZ0V4cChuYW1lKX09KFteO10qKWApO1xuICAgIGNvbnN0IG1hdGNoZWRDb29raWVzID0gY29va2llLm1hdGNoKGNvb2tpZU5hbWVSRSk7XG4gICAgcmV0dXJuIG1hdGNoZWRDb29raWVzID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoZWRDb29raWVzWzFdKSA6IHVuZGVmaW5lZDtcbn1cbmZ1bmN0aW9uIHdyaXRlQ29va2llKG5hbWUsIHZhbHVlLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwge307XG4gICAgbGV0IGV4cGlyZXMgPSBwcm9wZXJ0aWVzID09PSBudWxsIHx8IHByb3BlcnRpZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3BlcnRpZXMuZXhwaXJlcztcbiAgICBpZiAodHlwZW9mIGV4cGlyZXMgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBkYXlzRnJvbVRvZGF5SW5NcyA9IGV4cGlyZXMgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xuICAgICAgICBleHBpcmF0aW9uRGF0ZS5zZXRUaW1lKERhdGUubm93KCkgKyBkYXlzRnJvbVRvZGF5SW5Ncyk7XG4gICAgICAgIGV4cGlyZXMgPSBwcm9wZXJ0aWVzLmV4cGlyZXMgPSBleHBpcmF0aW9uRGF0ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBleHBpcmVzICE9PSBcInN0cmluZ1wiICYmIChleHBpcmVzID09PSBudWxsIHx8IGV4cGlyZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4cGlyZXMudG9VVENTdHJpbmcpKSB7XG4gICAgICAgIHByb3BlcnRpZXMuZXhwaXJlcyA9IGV4cGlyZXMudG9VVENTdHJpbmcoKTtcbiAgICB9XG4gICAgbGV0IGNvb2tpZSA9IGAke25hbWV9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKX1gO1xuICAgIGxldCBwcm9wZXJ0eTtcbiAgICBmb3IgKHByb3BlcnR5IGluIHByb3BlcnRpZXMpIHtcbiAgICAgICAgY29va2llICs9IGA7ICR7cHJvcGVydHl9YDtcbiAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IHByb3BlcnRpZXNbcHJvcGVydHldO1xuICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29va2llICs9IGA9JHtwcm9wZXJ0eVZhbHVlfWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZG9jdW1lbnQuY29va2llID0gY29va2llO1xufVxuXG5leHBvcnQgeyBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0gYXMgYSwgZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGIsIGdldENvb2tpZSBhcyBjLCBzZXRDb29raWUgYXMgZCwgZ2V0TG9jYWxTdG9yYWdlSXRlbSBhcyBnLCBzZXRMb2NhbFN0b3JhZ2VJdGVtIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RvcmFnZS0wMzUzYTc2OS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyB2IGFzIHZhbGlkQXJjZ2lzUmVzdFNlcnZpY2VQYXRoLCByIGFzIHJlZ2V4U2VydmVyVHlwZSwgYyBhcyBhZ3NSZWdFeHAsIGIgYXMgZ2VvSnNvblJlZ0V4cCB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGdldENvb2tpZSB9IGZyb20gJy4vc3RvcmFnZS0wMzUzYTc2OS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFnc1NlcnZlck1hcCB9IGZyb20gJy4vYWdzLWViNDU4YTAzLmpzJztcblxuZnVuY3Rpb24gcmVtb3ZlVHJhaWxpbmdTbGFzaCh1cmwpIHtcbiAgICBpZiAoKHVybCA9PT0gbnVsbCB8fCB1cmwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVybC5zbGljZSgtMSkpID09PSBcIi9cIikge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIFwiL1wiIGZyb20gdGhlIGVuZCBvZiB0aGUgdXJsXG4gICAgICAgIHJldHVybiB1cmwuc2xpY2UoMCwgdXJsLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgICByZXR1cm4gdXJsO1xufVxuLy8gYm9ycm93ZWQgZnJvbSBhcmNnaXNvbmxpbmUuc2hhcmluZy51dGlsXG5hc3luYyBmdW5jdGlvbiB1cmxUb09iamVjdCh1cmwpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYXBpVmVyc2lvbiA9IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5hcGkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDQ7XG4gICAgY29uc3QgW3VybFV0aWxzXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFthcGlWZXJzaW9uID09PSA0ID8gXCJlc3JpL2NvcmUvdXJsVXRpbHNcIiA6IFwiZXNyaS91cmxVdGlsc1wiXSk7XG4gICAgbGV0IHVybE9iaiA9IHVybFV0aWxzLnVybFRvT2JqZWN0KHVybCk7XG4gICAgdXJsT2JqLnF1ZXJ5ID0gdXJsT2JqLnF1ZXJ5IHx8IHt9O1xuICAgIGZvciAobGV0IGtleSBpbiB1cmxPYmoucXVlcnkgfHwge30pIHtcbiAgICAgICAgaWYgKHVybE9iai5xdWVyeS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAvLyBzdHJpcCBvdXQgc29tZSBIVE1MICg8LD4sJTNDLCUzRSwmbHQ7LCZndDspXG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodXJsT2JqLnF1ZXJ5W2tleV0pKSB7XG4gICAgICAgICAgICAgICAgdXJsT2JqLnF1ZXJ5W2tleV0gPSB1cmxPYmoucXVlcnlba2V5XS5yZXBsYWNlKC8oJmx0O3wmZ3Q7fDx8PnwlM0N8JTNFKS9nLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXJsT2JqO1xufVxuZnVuY3Rpb24gdXJsVG9UaXRsZSh1cmwpIHtcbiAgICByZXR1cm4gKHVybCA9PT0gbnVsbCB8fCB1cmwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVybC5yZXBsYWNlKC9eLipcXC8vLCBcIlwiKS5yZXBsYWNlKC8uW14uXSokLywgXCJcIikpIHx8IFwiXCI7XG59XG5mdW5jdGlvbiBzdXBwb3J0c0RpcmVjdCh0eXBlKSB7XG4gICAgLy8gVE9ETzogU2V0IG1hcHBlZCBBR1NUeXBlcyB0byBVcmxUeXBlLCB0aGVuIHJlLWVuYWJsZSBoZXJlXG4gICAgY29uc3QgZGlyZWN0ID0gW1wiV0ZTXCIsIFwiR2VvSnNvblwiLCBcIkNTVlwiLCBcIkdlb1JTU1wiLCBcIktNTFwiLCBcIk9HQ0ZlYXR1cmVTZXJ2ZXJcIiwgXCJXTVNcIiwgXCJXTVRTXCJdO1xuICAgIHJldHVybiBkaXJlY3QuaW5jbHVkZXModHlwZSk7XG59XG5mdW5jdGlvbiBzdXBwb3J0c0h0dHBzKHVybCkge1xuICAgIGNvbnN0IHsgY29uZmlnLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGxldCBzdXBwb3J0c0h0dHBzID0gZmFsc2U7XG4gICAgaWYgKCF1cmwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAoY29uZmlnLmh0dHBzRG9tYWlucyB8fCBbXSkuZm9yRWFjaCgoZG9tYWluKSA9PiB7XG4gICAgICAgIGlmICh1cmwuaW5kZXhPZihgLiR7ZG9tYWlufS9gKSA+IC0xIHx8IHVybC5pbmRleE9mKGAvJHtkb21haW59L2ApID4gLTEpIHtcbiAgICAgICAgICAgIHN1cHBvcnRzSHR0cHMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFzdXBwb3J0c0h0dHBzKSB7XG4gICAgICAgIGxldCBwb3J0YWxIb3N0bmFtZSA9IHBvcnRhbC5wb3J0YWxIb3N0bmFtZTtcbiAgICAgICAgaWYgKHBvcnRhbEhvc3RuYW1lLmluZGV4T2YoXCIvXCIpID4gLTEpIHtcbiAgICAgICAgICAgIHBvcnRhbEhvc3RuYW1lID0gcG9ydGFsSG9zdG5hbWUuc3Vic3RyaW5nKDAsIHBvcnRhbEhvc3RuYW1lLmluZGV4T2YoXCIvXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXJsLmluZGV4T2YocG9ydGFsSG9zdG5hbWUpID4gLTEpIHtcbiAgICAgICAgICAgIHN1cHBvcnRzSHR0cHMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdXBwb3J0c0h0dHBzO1xufVxuZnVuY3Rpb24gaXNIb3N0ZWRTZXJ2aWNlKHVybCkge1xuICAgIGlmICghdXJsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgeyBjb25maWcsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgY29uc3QgcmVzdEJhc2VVcmwgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGNvbnN0IGhvc3RuYW1lID0gbmV3IFVSTChyZXN0QmFzZVVybCkuaG9zdG5hbWU7XG4gICAgY29uc3QgaXNTaW5nbGVUZW5hbnQgPSBmYWxzZSA9PT0gY29uZmlnLmlzTXVsdGlUZW5hbnQ7XG4gICAgLy8gb25seSBjb25zaWRlciBsb2NhbGx5IGhvc3RlZCBpZiB0aGUgcmVzdEJhc2VVcmwgaXMgb24gc2FtZSBkb21haW4gYXMgdXJsXG4gICAgLy8gYW5kIGVzcmlHZW93Q29uZmlnLnNlbGYuc3VwcG9ydHNIb3N0ZWRTZXJ2aWNlcyBmbGFnIGlzIGVuYWJsZWRcbiAgICBjb25zdCBpc0FHT0wgPSB1cmwuaW5kZXhPZihcIi5hcmNnaXMuY29tL1wiKSAhPT0gLTE7XG4gICAgY29uc3QgaXNIb3N0ZWRTZXJ2ZXIgPSB1cmwuaW5kZXhPZihcIi8vc2VydmljZXNcIikgIT09IC0xIHx8XG4gICAgICAgIHVybC5pbmRleE9mKFwiLy90aWxlc1wiKSAhPT0gLTEgfHxcbiAgICAgICAgdXJsLmluZGV4T2YoXCIvL2ZlYXR1cmVzXCIpICE9PSAtMSB8fFxuICAgICAgICB1cmwuaW5kZXhPZihcIi8vbG9jYXRpb25zZXJ2aWNlc1wiKSAhPT0gLTE7XG4gICAgY29uc3QgaXNMb2NhbGx5SG9zdGVkID0gcG9ydGFsLnN1cHBvcnRzSG9zdGVkU2VydmljZXMgJiYgdXJsLmluZGV4T2YoaG9zdG5hbWUpICE9PSAtMSAmJiAhaXNTaW5nbGVUZW5hbnQ7XG4gICAgcmV0dXJuIChpc0FHT0wgJiYgaXNIb3N0ZWRTZXJ2ZXIpIHx8ICghaXNBR09MICYmIGlzTG9jYWxseUhvc3RlZCk7XG59XG5mdW5jdGlvbiBjaGVja1Byb3RvY29sKCkge1xuICAgIHZhciBfYTtcbiAgICAvLyBGb3IgcG9ydGFsIGNhc2UsIGlmIGFkZGluZyBhIHNlY3VyZSBwcm94eSwgYW5kIHBhZ2UgaXMgaHR0cFxuICAgIC8vIHdlIG5lZWQgdG8gcmVsb2FkIG9uIGh0dHBzIC0gSVdTIGludmFsaWQgY2FzZVxuICAgIGNvbnN0IHByb3RvY29sID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sO1xuICAgIGlmIChwcm90b2NvbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJodHRwc1wiKSA9PT0gLTEpIHtcbiAgICAgICAgY29uc3QgY29va2llID0gZ2V0Q29va2llKFwiZXNyaV9hdXRoXCIsIHRydWUpO1xuICAgICAgICBpZiAoKChfYSA9IGNvb2tpZSA9PT0gbnVsbCB8fCBjb29raWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvb2tpZS5hdXRoX3RpZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpKSA9PT0gXCJ3ZWJcIikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGZvcm1hdEdJU1VybCh1cmwpIHtcbiAgICAvKlxuICAgICAgIFVzZXIgIGVudGVyZWQgOlxuICAgICAgIGh0dHA6Ly9zYW1wbGVzZXJ2ZXIzLmFyY2dpc29ubGluZS5jb21cbiAgICAgICBTb2Z0d2FyZSBjb21wbGV0ZXMgdG8gOlxuICAgICAgIGh0dHA6Ly9zYW1wbGVzZXJ2ZXIzLmFyY2dpc29ubGluZS5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXNcbiAgXG4gICAgICAgVXNlciAgZW50ZXJlZCA6XG4gICAgICAgaHR0cDovL3NhbXBsZXNlcnZlcjMuYXJjZ2lzb25saW5lLmNvbS9hcmNnaXNcbiAgICAgICBTb2Z0d2FyZSBjb21wbGV0ZXMgdG86XG4gICAgICAgaHR0cDovL3NhbXBsZXNlcnZlcjMuYXJjZ2lzb25saW5lLmNvbS9hcmNnaXMvcmVzdC9zZXJ2aWNlc1xuICBcbiAgICAgICBVc2VyICBlbnRlcmVkIDpcbiAgICAgICBodHRwOi8vc2FtcGxlc2VydmVyMy5hcmNnaXNvbmxpbmUuY29tL2FyY2dpcy9yZXN0L3NlcnZpY2VzXG4gICAgICAgU29mdHdhcmUgY29tcGxldGVzIHRvOlxuICAgICAgIGh0dHA6Ly9zYW1wbGVzZXJ2ZXIzLmFyY2dpc29ubGluZS5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXNcbiAgXG4gICAgICAgVXNlciBlbnRlcmVkIGEgdXJsIHRvIGEgZm9sZGVyIGluIGEgc2VydmVyIDpcbiAgICAgICBodHRwOi8vc2FtcGxlc2VydmVyMy5hcmNnaXNvbmxpbmUuY29tL2FyY2dpcy9yZXN0L3NlcnZpY2VzL3BldHJvXG4gICAgICAgU29mdHdhcmUgY29tcGxldGVzIHRvOlxuICAgICAgIGh0dHA6Ly9zYW1wbGVzZXJ2ZXIzLmFyY2dpc29ubGluZS5jb20vYXJjZ2lzL3Jlc3Qvc2VydmljZXMvcGV0cm9cbiAgXG4gICAgICAgVXNlciBlbnRlcmVkIGEgdXJsIHRvIGEgZm9sZGVyIGluIGEgc2VydmVyIDpcbiAgICAgICBodHRwOi8vc2FtcGxlc2VydmVyMy5hcmNnaXNvbmxpbmUuY29tL2FyY2dpcy9yZXN0L3NlcnZpY2VzL3dhdGVyL01hcFNlcnZlclxuICAgICAgIFNvZnR3YXJlIGNvbXBsZXRlcyB0bzpcbiAgICAgICBodHRwOi8vc2FtcGxlc2VydmVyMy5hcmNnaXNvbmxpbmUuY29tL2FyY2dpcy9yZXN0L3NlcnZpY2VzL3dhdGVyL01hcFNlcnZlclxuICAgICAgICovXG4gICAgbGV0IHUgPSB1cmwudG9Mb3dlckNhc2UoKTtcbiAgICAvLyBhZGQgaHR0cDovLyBpZiBpdCdzIG1pc3NpbmdcbiAgICBpZiAodS5pbmRleE9mKFwiaHR0cDovL1wiKSA9PSAtMSAmJiB1LmluZGV4T2YoXCJodHRwczovL1wiKSA9PSAtMSkge1xuICAgICAgICB1cmwgPSBcImh0dHBzOi8vXCIgKyB1cmw7XG4gICAgICAgIHUgPSB1cmwudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgLy8gZmluZCBwYXRoIHBhcnQgb2YgVVJMXG4gICAgbGV0IHBhdGhQb3MgPSB1LmluZGV4T2YoXCIvL1wiKTtcbiAgICBwYXRoUG9zID0gdS5pbmRleE9mKFwiL1wiLCBwYXRoUG9zICsgMik7XG4gICAgLy8ganVzdCBkb21haW4/XG4gICAgaWYgKHBhdGhQb3MgPT0gLTEpIHtcbiAgICAgICAgdXJsICs9IFwiL2FyY2dpcy9yZXN0L3NlcnZpY2VzXCI7XG4gICAgICAgIHUgPSB1cmwudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAocGF0aFBvcyA9PSB1Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgdXJsICs9IFwiYXJjZ2lzL3Jlc3Qvc2VydmljZXNcIjtcbiAgICAgICAgdSA9IHVybC50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICAvLyBqdXN0IGFyY2dpcyBwYXRoP1xuICAgIGxldCBwMCA9IHUuaW5kZXhPZihcIi9hcmNnaXNcIiwgcGF0aFBvcyk7XG4gICAgaWYgKHAwID09IHUubGVuZ3RoIC0gNykge1xuICAgICAgICB1cmwgKz0gXCIvcmVzdC9zZXJ2aWNlc1wiO1xuICAgICAgICB1ID0gdXJsLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHAwID09IHUubGVuZ3RoIC0gOCkge1xuICAgICAgICB1cmwgKz0gXCJyZXN0L3NlcnZpY2VzXCI7XG4gICAgICAgIHUgPSB1cmwudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgLy8ganVzdCBzZXJ2ZXIgcGF0aD8gKFdlYkFkYXB0b3IpXG4gICAgcDAgPSB1LmluZGV4T2YoXCIvc2VydmVyXCIsIHBhdGhQb3MpO1xuICAgIGlmICh1LmVuZHNXaXRoKFwiL3NlcnZlclwiKSkge1xuICAgICAgICB1cmwgKz0gXCIvcmVzdC9zZXJ2aWNlc1wiO1xuICAgICAgICB1ID0gdXJsLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHUuZW5kc1dpdGgoXCIvc2VydmVyL1wiKSkge1xuICAgICAgICB1cmwgKz0gXCJyZXN0L3NlcnZpY2VzXCI7XG4gICAgICAgIHUgPSB1cmwudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgLy8gcmVwbGFjZSBTT0FQIGVuZCBwb2ludCBvciBzaG9ydCBSRVNUIGVuZCBwb2ludCB3aXRoIFJFU1QgZW5kIHBvaW50XG4gICAgY29uc3QgcDEgPSB1LmluZGV4T2YoXCIvcmVzdC9zZXJ2aWNlc1wiLCBwYXRoUG9zKTtcbiAgICBjb25zdCBwMiA9IHUuaW5kZXhPZihcIi9zZXJ2aWNlc1wiLCBwYXRoUG9zKTtcbiAgICBjb25zdCBwMyA9IHUuaW5kZXhPZihcIi9yZXN0XCIsIHBhdGhQb3MpO1xuICAgIGlmIChwMSA9PSAtMSAmJiBwMiA+IC0xKSB7XG4gICAgICAgIHVybCA9IGAke3VybC5zdWJzdHJpbmcoMCwgcDIpfS9yZXN0L3NlcnZpY2VzJHt1cmwuc3Vic3RyaW5nKHAyICsgOSl9YDtcbiAgICAgICAgdSA9IHVybC50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChwMSA9PSAtMSAmJiBwMyA+IC0xKSB7XG4gICAgICAgIHVybCA9IGAke3VybC5zdWJzdHJpbmcoMCwgcDMpfS9yZXN0L3NlcnZpY2VzJHt1cmwuc3Vic3RyaW5nKHAzICsgNSl9YDtcbiAgICAgICAgdSA9IHVybC50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICAvLyBpcyBpdCBhIFJFU1QgZW5kIHBvaW50P1xuICAgIGlmICh1LmluZGV4T2YoXCIvcmVzdC9zZXJ2aWNlc1wiKSA9PSAtMSkgO1xuICAgIHJldHVybiB1cmw7XG59XG5jb25zdCBmb3JtYXRVcmwgPSAodXJsLCBhbGxTU0wgPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0IHByb3RvY29sUmVnZXggPSAvKGh0dHB8aHR0cHN8ZnRwKTpcXC9cXC8/LztcbiAgICB1cmwgPSByZW1vdmVUcmFpbGluZ1NsYXNoKHVybCk7XG4gICAgaWYgKCFwcm90b2NvbFJlZ2V4LmV4ZWModXJsKSkge1xuICAgICAgICB1cmwgPSBgaHR0cHM6Ly8ke3VybH1gO1xuICAgIH1cbiAgICBpZiAoKGFsbFNTTCB8fCBsb2NhdGlvbi5wcm90b2NvbCA9PT0gXCJodHRwczpcIikgJiYgKGlzSG9zdGVkU2VydmljZSh1cmwpIHx8IHN1cHBvcnRzSHR0cHModXJsKSkpIHtcbiAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoXCJodHRwOi9cIiwgXCJodHRwczovXCIpO1xuICAgIH1cbiAgICAvLyBGaWx0ZXIgb3V0IGR5bmFtaWNMYXllclxuICAgIHVybCA9IHVybC5pbmRleE9mKFwiL2R5bmFtaWNMYXllcj9cIikgPiAtMSA/IHVybC5zdWJzdHJpbmcoMCwgdXJsLmluZGV4T2YoXCIvZHluYW1pY0xheWVyP1wiKSkgOiB1cmw7XG4gICAgcmV0dXJuIHVybDtcbn07XG4vKiogR2V0IHR5cGUgYmFzZWQgb24gaW5wdXQgdXJsIGFuZCBhbHNvIHJldHVybnMgYSBmaXggaWYgdXJsIGlzIG1hbGZvcm1lZFxuICovXG5jb25zdCBnZXRVcmxUeXBlID0gKHVybCwgaXNQb3J0YWwgPSBmYWxzZSkgPT4ge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGlmICghdXJsKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwiaW52YWxpZFVybFwiIH0gfTtcbiAgICB9XG4gICAgaWYgKGlzSHR0cCh1cmwsIGlzUG9ydGFsKSkge1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcImh0dHBXYXJuaW5nXCIgfSB9O1xuICAgIH1cbiAgICBjb25zdCBkZWNvZGVkVXJsID0gZGVjb2RlVVJJQ29tcG9uZW50KHVybCk7XG4gICAgY29uc3Qga21sVHlwZSA9IGRlY29kZWRVcmwucmVwbGFjZSh2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCwgXCJcIikubWF0Y2goLygoXFwufFxcLykqKGttbHxrbXopKS9naSk7XG4gICAgY29uc3Qgb2djVHlwZSA9IGRlY29kZWRVcmwucmVwbGFjZSh2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCwgXCJcIikubWF0Y2goLygoXFwvfFxcPSkod210c3x3bXN8d2ZzKSkvZ2kpO1xuICAgIGNvbnN0IG9nY0ZlYXR1cmVUeXBlID0gZGVjb2RlZFVybC5yZXBsYWNlKHZhbGlkQXJjZ2lzUmVzdFNlcnZpY2VQYXRoLCBcIlwiKS5tYXRjaCgvKChcXC98XFw9KShPR0N8T0dDRmVhdHVyZVNlcnZlcikpL2dpKTtcbiAgICBjb25zdCByc3NUeXBlID0gZGVjb2RlZFVybC5yZXBsYWNlKHZhbGlkQXJjZ2lzUmVzdFNlcnZpY2VQYXRoLCBcIlwiKS5tYXRjaCgvKChcXC58XFwvKSoocnNzKSkvZ2kpO1xuICAgIGNvbnN0IHNlcnZlclR5cGUgPSAoX2EgPSBkZWNvZGVkVXJsLnJlcGxhY2UodmFsaWRBcmNnaXNSZXN0U2VydmljZVBhdGgsIFwiXCIpLm1hdGNoKHJlZ2V4U2VydmVyVHlwZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVsxXTtcbiAgICBjb25zdCBjb250YWluc0FHUyA9IGRlY29kZWRVcmwucmVwbGFjZSh2YWxpZEFyY2dpc1Jlc3RTZXJ2aWNlUGF0aCwgXCJcIikubWF0Y2goYWdzUmVnRXhwKTtcbiAgICBjb25zdCBjc3ZUeXBlID0gZGVjb2RlZFVybC5yZXBsYWNlKHZhbGlkQXJjZ2lzUmVzdFNlcnZpY2VQYXRoLCBcIlwiKS5tYXRjaCgvKChcXC58XFwvKSooY3N2KSkvZ2kpO1xuICAgIGNvbnN0IHRpbGVMYXllclR5cGUgPSBkZWNvZGVkVXJsXG4gICAgICAgIC5yZXBsYWNlKHZhbGlkQXJjZ2lzUmVzdFNlcnZpY2VQYXRoLCBcIlwiKVxuICAgICAgICAubWF0Y2goLyhcXC58XFwvKSgoXFwkP3soenxsZXZlbCl9KVxcLyooXFwkP3soeHxjb2wpfSlcXC8qKFxcJD97KHl8cm93KX0pKS9naSk7XG4gICAgbGV0IHR5cGUgPSBudWxsO1xuICAgIGlmIChkZWNvZGVkVXJsLm1hdGNoKGdlb0pzb25SZWdFeHApKSB7XG4gICAgICAgIHR5cGUgPSBcIkdlb0pzb25cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAob2djRmVhdHVyZVR5cGUgJiYgIW9nY1R5cGUgJiYgIXNlcnZlclR5cGUpIHtcbiAgICAgICAgdHlwZSA9IFwiT0dDRmVhdHVyZVNlcnZlclwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChzZXJ2ZXJUeXBlICYmICFvZ2NUeXBlKSB7XG4gICAgICAgIHR5cGUgPSBhZ3NTZXJ2ZXJNYXBbc2VydmVyVHlwZV07XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbnRhaW5zQUdTKSB7XG4gICAgICAgIC8vIEFzc3VtZSBVUkxTIHdpdGggL2Fncy8gYW5kIG5vIHNwZWNpZmllZCBzZXJ2ZXIgYXJlIE1hcCBTZXJ2aWNlc1xuICAgICAgICB0eXBlID0gXCJNYXAgU2VydmljZVwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChvZ2NUeXBlKSB7XG4gICAgICAgIGNvbnN0IHN5bWJvbCA9IChvZ2NUeXBlID09PSBudWxsIHx8IG9nY1R5cGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9nY1R5cGVbMF0uY2hhckF0KDApKSA9PT0gXCIvXCIgPyBcIi9cIiA6IFwiPVwiO1xuICAgICAgICB0eXBlID0gKF9jID0gKF9iID0gb2djVHlwZSA9PT0gbnVsbCB8fCBvZ2NUeXBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvZ2NUeXBlWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3BsaXQoc3ltYm9sKVsxXSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGttbFR5cGUpIHtcbiAgICAgICAgdHlwZSA9IFwiS01MXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKHJzc1R5cGUpIHtcbiAgICAgICAgdHlwZSA9IFwiR2VvUlNTXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNzdlR5cGUpIHtcbiAgICAgICAgdHlwZSA9IFwiQ1NWXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbGVMYXllclR5cGUpIHtcbiAgICAgICAgdHlwZSA9IFwiVGlsZSBMYXllclwiO1xuICAgIH1cbiAgICByZXR1cm4geyByZXN1bHQ6IHR5cGUgfTtcbn07XG4vKipcbiAqIENoZWNrcyBpZiB1cmwgaW5jbHVkZXMgaHR0cDovL1xuICogTm90IGFwcGxpY2FibGUgdG8gZW50ZXJwcmlzZVxuICovXG5jb25zdCBpc0h0dHAgPSAodXJsLCBpc1BvcnRhbCkgPT4ge1xuICAgIHJldHVybiAhaXNQb3J0YWwgJiYgdXJsLmluY2x1ZGVzKFwiaHR0cDovL1wiKTtcbn07XG5cbmV4cG9ydCB7IGlzSG9zdGVkU2VydmljZSBhcyBhLCBzdXBwb3J0c0h0dHBzIGFzIGIsIHVybFRvT2JqZWN0IGFzIGMsIGZvcm1hdEdJU1VybCBhcyBkLCBjaGVja1Byb3RvY29sIGFzIGUsIGZvcm1hdFVybCBhcyBmLCBnZXRVcmxUeXBlIGFzIGcsIGlzSHR0cCBhcyBpLCByZW1vdmVUcmFpbGluZ1NsYXNoIGFzIHIsIHN1cHBvcnRzRGlyZWN0IGFzIHMsIHVybFRvVGl0bGUgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD11cmwtMzU4NzVhMTAuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9