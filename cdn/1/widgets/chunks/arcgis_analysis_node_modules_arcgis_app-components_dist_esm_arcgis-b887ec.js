/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b887ec.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b887ec"],{74340:(i,t,e)=>{e.r(t),e.d(t,{arcgis_image_upload:()=>r,arcgis_image_upload_edit_step:()=>n,arcgis_image_upload_file_step:()=>l});var a=e(81149),s=e(82218),o=e(51837);e(42577),e(69283);const r=class{constructor(i){(0,a.r)(this,i),this.arcgisImageUploadCancel=(0,a.c)(this,"arcgisImageUploadCancel",7),this.arcgisImageUploadError=(0,a.c)(this,"arcgisImageUploadError",7),this.arcgisImageUploadSave=(0,a.c)(this,"arcgisImageUploadSave",7),this.imageFormat="png",this.fileName="",this.handleCancel=()=>{this.showError=!1,this.arcgisImageUploadCancel.emit()},this.handleChooseDiffClick=()=>{this.activeStep="file",this.previewSrc="",this.editExisting=!1},this.handleSaveClick=async()=>{if("file"===this.activeStep)return void(this.showError=!0);if(this.showError=!1,this.saving=!0,"map"===this.activeStep)return void this.takeMapScreenshot();const i=await this.getCanvasImage();this.arcgisImageUploadSave.emit(i)},this.takeMapScreenshot=async()=>{this.mapView._stage&&(this.mapView._stage._supersampleScreenshots=!1);const i=await this.mapView.takeScreenshot({format:"png"}),t={blob:this.dataURIToBlob(i.dataUrl),base64:i.dataUrl,format:"png",fileName:""};this.arcgisImageUploadSave.emit(t)},this.handleFromMapClick=()=>{this.activeStep="map"},this.handleMapViewLoaded=i=>{this.mapView=i.detail},this.modalTitle=void 0,this.sizeDescription=void 0,this.zoomToFit=!0,this.maxWidth=void 0,this.maxHeight=void 0,this.fillBackground=!1,this.active=void 0,this.height=window.innerWidth<412?200:300,this.aspectRatio=1,this.portal=void 0,this.itemId=void 0,this.jsapiUrl=void 0,this.previewSrc=void 0,this.saving=!1,this.editExisting=!1,this.isModified=!1,this.activeStep="file",this.showError=!1}handleFileChange(i){const{fileName:t,dataURL:e}=i.detail;this.fileName=t,this.previewSrc=e,this.activeStep="edit",this.showError=!1}handleInvalidFile(){this.showError=!0,this.arcgisImageUploadError.emit("invalid file type.")}handleImageChange(){this.isModified=!0}handleActiveChange(){var i;this.active||(this.activeStep="file",this.saving=!1,this.isModified=!1,this.previewSrc="",this.editExisting=!1,null===(i=this.fileStep)||void 0===i||i.resetFileInput())}async componentWillLoad(){const i=await(0,s.g)(this.el);this.strings=i[0]}dataURIToBlob(i){const t=atob(i.split(",")[1]),e=i.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),s=new Uint8Array(a);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return new Blob([a],{type:e})}drawImage({selectionX:i,selectionY:t,selectionWidth:e,selectionHeight:a,canvasWidth:s,canvasHeight:o,minWidth:r,minHeight:n,drawDimensions:l},h,g,c){this.canvasEl.width=s<r?r:s*h,this.canvasEl.height=o<n?n:o*h,this.maxWidth&&this.canvasEl.width>this.maxWidth&&(this.canvasEl.width=this.maxWidth),this.maxHeight&&this.canvasEl.height>this.maxHeight&&(this.canvasEl.height=this.maxHeight);const d=l.left*this.canvasEl.width,p=l.top*this.canvasEl.height,m=l.width*this.canvasEl.width,f=l.height*this.canvasEl.height;this.fillBackground&&(c.fillStyle="#efefef",c.fillRect(0,0,this.canvasEl.width,this.canvasEl.height)),c.drawImage(g,i,t,e,a,d,p,m,f);const v=this.canvasEl.toDataURL("image/png");return{base64:v,blob:this.dataURIToBlob(v)}}async getScaledImageData(i){const t=this.canvasEl.getContext("2d"),e=await this.editStepEl.getDrawParameters();let a;function s(){return t.clearRect(0,0,this.canvasEl.width,this.canvasEl.height),this.drawImage(e,1600/i.width,i,t)}try{a=this.drawImage(e,1,i,t),(a.blob.size>1e7||0===a.blob.size)&&(a=s())}catch(i){"NS_ERROR_FAILURE"!==i.name?this.arcgisImageUploadError.emit("unable to save the image provided."):a=s()}return{blob:null==a?void 0:a.blob,base64:null==a?void 0:a.base64,format:this.imageFormat,fileName:this.fileName}}getCanvasImage(){return new Promise((i=>{const t=new Image;this.previewSrc.indexOf("arcgis.com")>-1&&(t.crossOrigin="Anonymous"),t.onload=()=>{Math.abs(this.aspectRatio-t.width/t.height)<.01&&!this.isModified?i({blob:this.dataURIToBlob(this.previewSrc),base64:this.previewSrc,format:this.imageFormat,fileName:this.fileName}):i(this.getScaledImageData(t))},t.src=this.previewSrc}))}render(){const i=!!this.portal&&!!this.itemId&&!!this.jsapiUrl;return(0,a.h)("calcite-modal",{class:"image-upload__modal",open:this.active,role:"dialog","aria-modal":"true","aria-labelledby":"image-upload-modal-title",outsideCloseDisabled:!0,onCalciteModalClose:this.handleCancel},(0,a.h)("h3",{slot:"header",id:"image-upload-modal-title",class:"image-upload__title","aria-label":this.modalTitle},this.modalTitle),(0,a.h)("div",{slot:"content",class:{"image-upload__content":!0,"image-upload__content--with-map":i,"image-upload__content--no-padding":"map"===this.activeStep}},"file"===this.activeStep&&(0,a.h)("div",null,(0,a.h)("arcgis-image-upload-file-step",{ref:i=>{this.fileStep=i},strings:this.strings,sizeDescription:this.sizeDescription}),i&&(0,a.h)(a.F,null,(0,a.h)("div",{class:"or-container"},(0,a.h)("span",{class:"or-wrapper"},this.strings.or)),(0,a.h)("div",{class:"image-upload__from-map-button",tabIndex:0,onClick:this.handleFromMapClick,onKeyDown:i=>{"Space"!==i.code&&"Enter"!==i.code||this.handleFromMapClick()}},(0,a.h)("div",{class:"image-upload__from-map-title"},(0,a.h)("div",{class:"from-map-title-wrapper"},(0,a.h)("calcite-icon",{icon:"map",scale:"m",class:"from-map-icon"}),this.strings.fromMap)),(0,a.h)("p",{class:"image-upload__from-map-desc"},this.strings.fromMapDesc)))),"map"===this.activeStep&&(0,a.h)("arcgis-image-upload-from-map",{portal:this.portal,itemId:this.itemId,jsapiUrl:this.jsapiUrl,changeBasemapText:this.strings.changeBasemap,loadingText:this.strings.loading,onArcgisImageUploadFromMapReady:this.handleMapViewLoaded}),"edit"===this.activeStep&&(0,a.h)("arcgis-image-upload-edit-step",{ref:i=>{this.editStepEl=i},strings:this.strings,height:this.height,aspectRatio:this.aspectRatio,previewSrc:this.previewSrc,zoomToFit:this.zoomToFit}),"edit"===this.activeStep&&(0,a.h)("canvas",{ref:i=>{this.canvasEl=i},class:"image-upload__canvas"}),(0,a.h)("calcite-alert",{label:this.strings.imageRequired,open:this.showError,ref:i=>{this.alertEl=i},icon:"exclamation-mark-circle",placement:"bottom",kind:"danger"},(0,a.h)("div",{slot:"message"},this.strings.imageRequired))),("edit"===this.activeStep||"map"===this.activeStep)&&(0,a.h)("calcite-button",{slot:"back",appearance:"transparent","icon-start":"chevron-left",width:"full",disabled:this.saving,onClick:this.handleChooseDiffClick,iconFlipRtl:"start"},this.strings.chooseDiff),(0,a.h)("calcite-button",{slot:"secondary",appearance:"outline-fill",width:"full",disabled:this.saving,onClick:this.handleCancel},this.strings.cancel),(0,a.h)("calcite-button",{slot:"primary",appearance:"solid",width:"full",loading:this.saving,onClick:this.handleSaveClick},this.strings.save))}get el(){return(0,a.d)(this)}static get watchers(){return{active:["handleActiveChange"]}}};r.style='.image-upload__modal{--calcite-modal-width:650px}.image-upload__title{margin-bottom:0px;font-size:1.25rem}.image-upload__content{box-sizing:border-box;background-color:var(--calcite-color-background);padding-left:2rem;padding-right:2rem;padding-top:1rem;padding-bottom:1.5rem;border:1px solid var(--calcite-color-border-3)}.image-upload__content--with-map{min-height:400px}.image-upload__content--no-padding{padding:0px}.image-upload__canvas{visibility:hidden;position:fixed;left:-10000px}.or-container{margin-top:1rem;margin-bottom:1rem;text-align:center;font-weight:500}.or-container:before,.or-container:after{display:inline-block;vertical-align:middle;content:"";border-top:solid 1px var(--calcite-color-border-input);width:15%;height:1px;z-index:1}.or-wrapper{padding-left:0.5rem;padding-right:0.5rem}.image-upload__from-map-button{background-color:var(--calcite-color-foreground-1);padding:1rem;text-align:center;border:1px solid var(--calcite-color-foreground-3)}.image-upload__from-map-button:hover{border:1px solid var(--calcite-color-brand)}.image-upload__from-map-title{display:inline-block}.from-map-title-wrapper{display:flex;align-items:center}.from-map-icon{margin-right:0.5rem}.image-upload__from-map-desc{margin:0px;font-size:0.875rem}';const n=class{constructor(i){(0,a.r)(this,i),this.arcgisImageUploadEditStepImageChanged=(0,a.c)(this,"arcgisImageUploadEditStepImageChanged",7),this.handleWheel=i=>{i.preventDefault();const t=i.deltaY>0?1*this.imageProperties.scale/1.1:1.1*this.imageProperties.scale;this.zoomValue=""+(50+Math.log(t)/Math.log(1.1)),this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:t})},this.handleDragStart=()=>{this.dragging=!0},this.handleDrag=i=>{if(!this.dragging)return;const{touches:t}=i;let{clientX:e,clientY:a}=i;if(void 0===e||void 0===a){if(!t.length)return;e=t[0].clientX,a=t[0].clientY}if(!this.previousPosition)return void(this.previousPosition={top:a,left:e});const{top:s,left:o}=this.previousPosition,r=a-s,n=e-o;this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top+r,left:this.imageProperties.left+n}),this.previousPosition={top:s+r,left:o+n}},this.handleDragEnd=()=>{this.dragging=!1,this.previousPosition=void 0},this.handleImageLoaded=()=>{if(this.editingExisting)return this.loadingImage=!1,this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:this.height/this.imageEl.width,top:0,left:0,origin:{x:"0%",y:"0%"}}),void(this.isLoading=!1);const i=this.height*this.aspectRatio,{clientWidth:t,clientHeight:e}=this.imageEl,a=(this.height+2)/e,s=(i+2)/t,o=a>s?a:s;let r=Object.assign({},this.imageProperties);r=Object.assign(Object.assign({},r),{top:Math.floor(this.height/2-e/2),left:Math.floor(this.height*this.aspectRatio/2-t/2),origin:{x:"50%",y:"50%"}}),this.zoomToFit&&(r=Object.assign(Object.assign({},r),{top:r.top-1,left:r.left-1,scale:o}),this.initiallySettingZoom=!0,this.zoomValue=""+(50+Math.log(o)/Math.log(1.1))),this.imageProperties=Object.assign({},r),this.isLoading=!1},this.handleZoomInput=i=>{this.initiallySettingZoom&&(this.initiallySettingZoom=!1),this.zoomValue=i.target.value,this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:Math.pow(1.1,i.target.value-50)})},this.handleImageKeydown=i=>{let t=!1;switch(i.key){case"ArrowUp":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top-1}),t=!0;break;case"ArrowDown":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top+1}),t=!0;break;case"ArrowLeft":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{left:this.imageProperties.left-1}),t=!0;break;case"ArrowRight":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{left:this.imageProperties.left+1}),t=!0}t&&i.preventDefault()},this.strings=void 0,this.aspectRatio=void 0,this.previewSrc=void 0,this.loadingImage=!1,this.editingExisting=!1,this.zoomToFit=!1,this.height=void 0,this.imageProperties={scale:1,top:0,left:0,origin:{x:"50%",y:"50%"}},this.dragging=!1,this.previousPosition=void 0,this.previewStyle=void 0,this.zoomValue="50",this.initiallySettingZoom=!1,this.firstImagePropertiesChange=!0,this.isLoading=!0}componentWillLoad(){const i=this.height*this.aspectRatio,t=`${this.height+60}px`;this.thumbContainerStyle={height:t},this.translucentContainerStyle={width:`${i+60}px`,height:t},this.transparentContainerStyle={width:`${i}px`,height:`${this.height}px`},this.previewStyle={transform:`scale(${this.imageProperties.scale})`,top:`${this.imageProperties.top}px`,left:`${this.imageProperties.left}px`,transformOrigin:`${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`}}componentDidLoad(){this.imageContainerEl.focus()}getImageExtent(){const i=this.imageEl.getBoundingClientRect(),t=this.imageContainerEl.getBoundingClientRect();return{left:(t.left-i.left)/i.width,right:(t.right-i.left)/i.width,top:(t.top-i.top)/i.height,bottom:(t.bottom-i.top)/i.height}}getDrawDimensions(){const i=this.imageEl.getBoundingClientRect(),t=this.imageContainerEl.getBoundingClientRect(),e=i.top-t.top>0?i.top-t.top:0,a=i.left-t.left>0?i.left-t.left:0,s=i.left<t.left?t.left:i.left,o=i.top<t.top?t.top:i.top,r=i.right>t.right?t.right:i.right,n=i.bottom>t.bottom?t.bottom:i.bottom;return{left:a/t.width,top:e/t.height,width:(r-s)/t.width,height:(n-o)/t.height}}async getDrawParameters(){const i=this.height*this.aspectRatio,t=this.height,{left:e,right:a,top:s,bottom:o}=this.getImageExtent(),r=e<0?0:e,n=s<0?0:s,l=a>1?1:a,h=o>1?1:o,g=this.getDrawDimensions(),c=this.imageEl.clientWidth,d=this.imageEl.clientHeight;return{selectionX:r*c,selectionY:n*d,selectionWidth:l*c-r*c,selectionHeight:h*d-n*d,canvasWidth:a*c-e*c,canvasHeight:o*d-s*d,minWidth:i,minHeight:t,drawDimensions:g}}handleImagePropertiesChange(){this.previewStyle={transform:`scale(${this.imageProperties.scale})`,top:`${this.imageProperties.top}px`,left:`${this.imageProperties.left}px`,transformOrigin:`${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`},this.firstImagePropertiesChange?(this.firstImagePropertiesChange=!1,this.zoomToFit&&this.arcgisImageUploadEditStepImageChanged.emit()):this.arcgisImageUploadEditStepImageChanged.emit()}render(){return(0,a.h)(a.H,{onWheel:this.handleWheel},(0,a.h)("calcite-loader",{class:"edit-step__loader",label:"",hidden:!this.isLoading}),(0,a.h)("div",{class:"edit-step__crop-thumb-container "+(this.isLoading?"edit-step__crop-thumb-container--hidden":""),style:this.thumbContainerStyle},(0,a.h)("div",{class:"edit-step__translucent-container",style:this.translucentContainerStyle,onMouseDown:this.handleDragStart,onTouchStart:this.handleDragStart,onMouseMove:this.handleDrag,onTouchMove:this.handleDrag,onMouseUp:this.handleDragEnd,onTouchEnd:this.handleDragEnd,onMouseOut:this.handleDragEnd},(0,a.h)("div",{ref:i=>{this.imageContainerEl=i},class:"edit-step__transparent-container",tabIndex:0,style:this.transparentContainerStyle,onKeyDown:this.handleImageKeydown},(0,a.h)("img",{ref:i=>{this.imageEl=i},src:this.previewSrc,alt:"",class:"edit-step__preview-image "+(this.loadingImage?"edit-step__preview-image--loading":""),style:this.previewStyle,onLoad:this.handleImageLoaded})))),(0,a.h)("calcite-label",{class:{"edit-step__zoom-control":!0,"edit-step__zoom-control--hidden":this.isLoading}},this.strings.zoom,(0,a.h)("calcite-slider",{"aria-label":this.strings.zoom,scale:"l",min:0,max:100,value:+this.zoomValue,onCalciteSliderInput:this.handleZoomInput,mirrored:"rtl"===(0,o.g)(this.el)}),(0,a.h)("div",{class:"edit-step__zoom-control-label"},(0,a.h)("div",{class:"edit-step__zoom-control-icon-s"},(0,a.h)("calcite-icon",{icon:"image",scale:"s"})),(0,a.h)("div",{class:"edit-step__zoom-control-label-spacer"}),(0,a.h)("div",{class:"edit-step__zoom-control-icon-l"},(0,a.h)("calcite-icon",{icon:"image",scale:"l"})))))}get el(){return(0,a.d)(this)}static get watchers(){return{imageProperties:["handleImagePropertiesChange"]}}};n.style=':host{position:relative;display:block;overflow:hidden;min-height:20.625rem}.edit-step__loader{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__crop-thumb-container{position:relative;width:100%;overflow:hidden}.edit-step__crop-thumb-container--hidden{visibility:hidden}.edit-step__translucent-container{position:absolute;top:0px;overflow:hidden;left:50%;cursor:all-scroll;transform:translate(-50%)}.edit-step__translucent-container:after{position:absolute;top:0px;right:0px;bottom:0px;left:0px;box-sizing:border-box;height:100%;width:100%;content:"";opacity:0.9;border:1.875rem solid white}.edit-step__transparent-container{position:absolute;box-sizing:border-box;overflow-x:visible;outline:2px solid transparent;outline-offset:2px;background-color:var(--calcite-color-foreground-3);border:1px solid var(--calcite-color-border-1);margin-right:-50%;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__preview-image{position:absolute;left:0px;top:0px;margin:0px;transform-origin:50% 50%}.edit-step__preview-image--loading{visibility:hidden}.edit-step__transparent-container:focus .edit-step__preview-image{box-shadow:0px 0px 6px 4px var(--calcite-color-brand)}.edit-step__zoom-control{--calcite-label-margin-bottom:0}.edit-step__zoom-control--hidden{visibility:hidden}.edit-step__zoom-control-label{display:flex;height:2rem}.edit-step__zoom-control-label-spacer{flex:1 1 0%}';const l=class{constructor(i){(0,a.r)(this,i),this.arcgisImageUploadFileStepFileChange=(0,a.c)(this,"arcgisImageUploadFileStepFileChange",7),this.arcgisImageUploadFileStepInvalidFile=(0,a.c)(this,"arcgisImageUploadFileStepInvalidFile",7),this.handleDragOver=i=>{i.preventDefault()},this.handleDrop=i=>{i.preventDefault(),this.processFile(i.dataTransfer.files[0])},this.handleFileInputChange=i=>{this.processFile(i.target.files[0])},this.strings=void 0,this.sizeDescription=void 0}async resetFileInput(){this.fileInput.value=""}processFile(i){if(i&&i){if(!this.isValidFile(i))return void this.arcgisImageUploadFileStepInvalidFile.emit();const t=new FileReader;t.onload=async t=>{this.arcgisImageUploadFileStepFileChange.emit({dataURL:t.target.result,fileName:i.name||""})},t.readAsDataURL(i)}}isValidFile(i){return(null==i?void 0:i.name)&&/\.(gif|jpg|jpeg|png)$/i.test(i.name)}render(){return(0,a.h)("div",{class:"file-step","aria-label":this.strings.dragDrop,onDragOver:this.handleDragOver,onDragEnter:this.handleDragOver,onDrop:this.handleDrop},(0,a.h)("div",{class:"file-step__upload-icon"},(0,a.h)("calcite-icon",{icon:"upload"})),(0,a.h)("div",null,(0,a.h)("div",{class:"file-step__drag-text","aria-label":this.strings.dragDrop},this.strings.dragDrop),this.sizeDescription&&(0,a.h)("div",{"aria-label":this.sizeDescription},this.sizeDescription),(0,a.h)("calcite-button",{class:"file-step__browse-button",appearance:"transparent",iconStart:"image",scale:"l",onClick:()=>{this.fileInput.click()}},this.strings.browse),(0,a.h)("input",{ref:i=>{this.fileInput=i},onChange:this.handleFileInputChange,class:"file-step__file-input",type:"file",accept:".jpg,.gif,.png,.jpeg"})))}get el(){return(0,a.d)(this)}};l.style=".file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-color-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{margin-bottom:0.25rem;font-size:1.25rem}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}"}}]);