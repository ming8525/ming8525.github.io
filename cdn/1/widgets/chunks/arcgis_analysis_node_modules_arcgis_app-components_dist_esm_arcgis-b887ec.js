"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b887ec"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload_3.entry.js":
/*!************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-image-upload_3.entry.js ***!
  \************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_image_upload: () => (/* binding */ ArcgisImageUpload),
/* harmony export */   arcgis_image_upload_edit_step: () => (/* binding */ ArcgisImageUploadEditStep),
/* harmony export */   arcgis_image_upload_file_step: () => (/* binding */ ArcgisImageUploadFileStep)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






const arcgisImageUploadCss = ".image-upload__modal{--calcite-modal-width:650px}.image-upload__title{margin-bottom:0px;font-size:1.25rem}.image-upload__content{box-sizing:border-box;background-color:var(--calcite-color-background);padding-left:2rem;padding-right:2rem;padding-top:1rem;padding-bottom:1.5rem;border:1px solid var(--calcite-color-border-3)}.image-upload__content--with-map{min-height:400px}.image-upload__content--no-padding{padding:0px}.image-upload__canvas{visibility:hidden;position:fixed;left:-10000px}.or-container{margin-top:1rem;margin-bottom:1rem;text-align:center;font-weight:500}.or-container:before,.or-container:after{display:inline-block;vertical-align:middle;content:\"\";border-top:solid 1px var(--calcite-color-border-input);width:15%;height:1px;z-index:1}.or-wrapper{padding-left:0.5rem;padding-right:0.5rem}.image-upload__from-map-button{background-color:var(--calcite-color-foreground-1);padding:1rem;text-align:center;border:1px solid var(--calcite-color-foreground-3)}.image-upload__from-map-button:hover{border:1px solid var(--calcite-color-brand)}.image-upload__from-map-title{display:inline-block}.from-map-title-wrapper{display:flex;align-items:center}.from-map-icon{margin-right:0.5rem}.image-upload__from-map-desc{margin:0px;font-size:0.875rem}";

const ArcgisImageUpload = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisImageUploadCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadCancel", 7);
        this.arcgisImageUploadError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadError", 7);
        this.arcgisImageUploadSave = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadSave", 7);
        this.imageFormat = "png";
        this.fileName = "";
        this.handleCancel = () => {
            this.showError = false;
            this.arcgisImageUploadCancel.emit();
        };
        this.handleChooseDiffClick = () => {
            this.activeStep = "file";
            this.previewSrc = "";
            this.editExisting = false;
        };
        this.handleSaveClick = async () => {
            if (this.activeStep === "file") {
                this.showError = true;
                return;
            }
            this.showError = false;
            this.saving = true;
            if (this.activeStep === "map") {
                this.takeMapScreenshot();
                return;
            }
            const data = await this.getCanvasImage();
            this.arcgisImageUploadSave.emit(data);
        };
        this.takeMapScreenshot = async () => {
            if (this.mapView["_stage"]) {
                this.mapView["_stage"]["_supersampleScreenshots"] = false;
            }
            const result = await this.mapView.takeScreenshot({
                format: "png"
            });
            const data = {
                blob: this.dataURIToBlob(result.dataUrl),
                base64: result.dataUrl,
                format: "png",
                fileName: ""
            };
            this.arcgisImageUploadSave.emit(data);
        };
        this.handleFromMapClick = () => {
            this.activeStep = "map";
        };
        this.handleMapViewLoaded = (evt) => {
            this.mapView = evt.detail;
        };
        this.modalTitle = undefined;
        this.sizeDescription = undefined;
        this.zoomToFit = true;
        this.maxWidth = undefined;
        this.maxHeight = undefined;
        this.fillBackground = false;
        this.active = undefined;
        this.height = window.innerWidth < 412 ? 200 : 300;
        this.aspectRatio = 1;
        this.portal = undefined;
        this.itemId = undefined;
        this.jsapiUrl = undefined;
        this.previewSrc = undefined;
        this.saving = false;
        this.editExisting = false;
        this.isModified = false;
        this.activeStep = "file";
        this.showError = false;
    }
    handleFileChange(evt) {
        const { fileName, dataURL } = evt.detail;
        this.fileName = fileName;
        this.previewSrc = dataURL;
        this.activeStep = "edit";
        this.showError = false;
    }
    handleInvalidFile() {
        this.showError = true;
        this.arcgisImageUploadError.emit("invalid file type.");
    }
    handleImageChange() {
        this.isModified = true;
    }
    handleActiveChange() {
        var _a;
        if (!this.active) {
            this.activeStep = "file";
            this.saving = false;
            this.isModified = false;
            this.previewSrc = "";
            this.editExisting = false;
            (_a = this.fileStep) === null || _a === void 0 ? void 0 : _a.resetFileInput();
        }
    }
    async componentWillLoad() {
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
        this.strings = locale[0];
    }
    dataURIToBlob(dataURI) {
        const byteString = atob(dataURI.split(",")[1]);
        const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
        const arrayBuffer = new ArrayBuffer(byteString.length);
        const uintArray = new Uint8Array(arrayBuffer);
        for (let i = 0; i < byteString.length; i++) {
            uintArray[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([arrayBuffer], {
            type: mimeString
        });
        return blob;
    }
    drawImage({ selectionX, selectionY, selectionWidth, selectionHeight, canvasWidth, canvasHeight, minWidth, minHeight, drawDimensions }, scaleFactor, img, context) {
        this.canvasEl.width = canvasWidth < minWidth ? minWidth : canvasWidth * scaleFactor;
        this.canvasEl.height = canvasHeight < minHeight ? minHeight : canvasHeight * scaleFactor;
        if (this.maxWidth) {
            if (this.canvasEl.width > this.maxWidth) {
                this.canvasEl.width = this.maxWidth;
            }
        }
        if (this.maxHeight) {
            if (this.canvasEl.height > this.maxHeight) {
                this.canvasEl.height = this.maxHeight;
            }
        }
        const left = drawDimensions.left * this.canvasEl.width;
        const top = drawDimensions.top * this.canvasEl.height;
        const width = drawDimensions.width * this.canvasEl.width;
        const height = drawDimensions.height * this.canvasEl.height;
        if (this.fillBackground) {
            context.fillStyle = "#efefef";
            context.fillRect(0, 0, this.canvasEl.width, this.canvasEl.height);
        }
        context.drawImage(img, selectionX, selectionY, selectionWidth, selectionHeight, left, top, width, height);
        const base64 = this.canvasEl.toDataURL("image/png");
        const blob = this.dataURIToBlob(base64);
        return {
            base64,
            blob
        };
    }
    async getScaledImageData(img) {
        const context = this.canvasEl.getContext("2d");
        const drawParameters = await this.editStepEl.getDrawParameters();
        let results;
        function retry() {
            context.clearRect(0, 0, this.canvasEl.width, this.canvasEl.height);
            return this.drawImage(drawParameters, 1600 / img.width, img, context);
        }
        try {
            results = this.drawImage(drawParameters, 1, img, context);
            if (results.blob.size > 10000000 || results.blob.size === 0) {
                results = retry();
            }
        }
        catch (e) {
            if (e.name !== "NS_ERROR_FAILURE") {
                this.arcgisImageUploadError.emit("unable to save the image provided.");
            }
            else {
                results = retry();
            }
        }
        return {
            blob: results === null || results === void 0 ? void 0 : results.blob,
            base64: results === null || results === void 0 ? void 0 : results.base64,
            format: this.imageFormat,
            fileName: this.fileName
        };
    }
    getCanvasImage() {
        return new Promise((resolve) => {
            const img = new Image();
            if (this.previewSrc.indexOf("arcgis.com") > -1) {
                img.crossOrigin = "Anonymous";
            }
            img.onload = () => {
                const properAspectRatio = Math.abs(this.aspectRatio - img.width / img.height) < 0.01;
                if (properAspectRatio && !this.isModified) {
                    resolve({
                        blob: this.dataURIToBlob(this.previewSrc),
                        base64: this.previewSrc,
                        format: this.imageFormat,
                        fileName: this.fileName
                    });
                    return;
                }
                resolve(this.getScaledImageData(img));
            };
            img.src = this.previewSrc;
        });
    }
    render() {
        const hasMap = !!this.portal && !!this.itemId && !!this.jsapiUrl;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { class: "image-upload__modal", open: this.active, role: "dialog", "aria-modal": "true", "aria-labelledby": "image-upload-modal-title", outsideCloseDisabled: true, onCalciteModalClose: this.handleCancel }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header", id: "image-upload-modal-title", class: "image-upload__title", "aria-label": this.modalTitle }, this.modalTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: {
                "image-upload__content": true,
                "image-upload__content--with-map": hasMap,
                "image-upload__content--no-padding": this.activeStep === "map"
            } }, this.activeStep === "file" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-file-step", { ref: (el) => {
                this.fileStep = el;
            }, strings: this.strings, sizeDescription: this.sizeDescription }), hasMap && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "or-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "or-wrapper" }, this.strings.or)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-upload__from-map-button", tabIndex: 0, onClick: this.handleFromMapClick, onKeyDown: (evt) => {
                if (evt.code === "Space" || evt.code === "Enter") {
                    this.handleFromMapClick();
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "image-upload__from-map-title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "from-map-title-wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "map", scale: "m", class: "from-map-icon" }), this.strings.fromMap)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "image-upload__from-map-desc" }, this.strings.fromMapDesc)))))), this.activeStep === "map" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-from-map", { portal: this.portal, itemId: this.itemId, jsapiUrl: this.jsapiUrl, changeBasemapText: this.strings.changeBasemap, loadingText: this.strings.loading, onArcgisImageUploadFromMapReady: this.handleMapViewLoaded })), this.activeStep === "edit" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-image-upload-edit-step", { ref: (el) => {
                this.editStepEl = el;
            }, strings: this.strings, height: this.height, aspectRatio: this.aspectRatio, previewSrc: this.previewSrc, zoomToFit: this.zoomToFit })), this.activeStep === "edit" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("canvas", { ref: (el) => {
                this.canvasEl = el;
            }, class: "image-upload__canvas" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { label: this.strings.imageRequired, open: this.showError, ref: (el) => {
                this.alertEl = el;
            }, icon: "exclamation-mark-circle", placement: "bottom", kind: "danger" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.strings.imageRequired))), (this.activeStep === "edit" || this.activeStep === "map") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "back", appearance: "transparent", "icon-start": "chevron-left", width: "full", disabled: this.saving, onClick: this.handleChooseDiffClick, iconFlipRtl: "start" }, this.strings.chooseDiff)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", width: "full", disabled: this.saving, onClick: this.handleCancel }, this.strings.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", width: "full", loading: this.saving, onClick: this.handleSaveClick }, this.strings.save)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "active": ["handleActiveChange"]
    }; }
};
ArcgisImageUpload.style = arcgisImageUploadCss;

const arcgisImageUploadEditStepCss = ":host{position:relative;display:block;overflow:hidden;min-height:20.625rem}.edit-step__loader{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__crop-thumb-container{position:relative;width:100%;overflow:hidden}.edit-step__crop-thumb-container--hidden{visibility:hidden}.edit-step__translucent-container{position:absolute;top:0px;overflow:hidden;left:50%;cursor:all-scroll;transform:translate(-50%)}.edit-step__translucent-container:after{position:absolute;top:0px;right:0px;bottom:0px;left:0px;box-sizing:border-box;height:100%;width:100%;content:\"\";opacity:0.9;border:1.875rem solid white}.edit-step__transparent-container{position:absolute;box-sizing:border-box;overflow-x:visible;outline:2px solid transparent;outline-offset:2px;background-color:var(--calcite-color-foreground-3);border:1px solid var(--calcite-color-border-1);margin-right:-50%;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__preview-image{position:absolute;left:0px;top:0px;margin:0px;transform-origin:50% 50%}.edit-step__preview-image--loading{visibility:hidden}.edit-step__transparent-container:focus .edit-step__preview-image{box-shadow:0px 0px 6px 4px var(--calcite-color-brand)}.edit-step__zoom-control{--calcite-label-margin-bottom:0}.edit-step__zoom-control--hidden{visibility:hidden}.edit-step__zoom-control-label{display:flex;height:2rem}.edit-step__zoom-control-label-spacer{flex:1 1 0%}";

const ArcgisImageUploadEditStep = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisImageUploadEditStepImageChanged = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadEditStepImageChanged", 7);
        this.handleWheel = (event) => {
            event.preventDefault();
            const imageScale = event.deltaY > 0 ? (this.imageProperties.scale * 1) / 1.1 : this.imageProperties.scale * 1.1;
            this.zoomValue = `${50 + Math.log(imageScale) / Math.log(1.1)}`;
            this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: imageScale });
        };
        this.handleDragStart = () => {
            this.dragging = true;
        };
        this.handleDrag = (event) => {
            if (!this.dragging) {
                return;
            }
            const { touches } = event;
            let { clientX, clientY } = event;
            if (clientX === undefined || clientY === undefined) {
                // on touch devices, use the clientX and clientY properties inside touches array property
                if (!touches.length) {
                    return;
                }
                clientX = touches[0].clientX;
                clientY = touches[0].clientY;
            }
            if (!this.previousPosition) {
                this.previousPosition = {
                    top: clientY,
                    left: clientX
                };
                return;
            }
            const { top, left } = this.previousPosition;
            const yDiff = clientY - top;
            const xDiff = clientX - left;
            this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top + yDiff, left: this.imageProperties.left + xDiff });
            this.previousPosition = {
                top: top + yDiff,
                left: left + xDiff
            };
        };
        this.handleDragEnd = () => {
            this.dragging = false;
            this.previousPosition = undefined;
        };
        this.handleImageLoaded = () => {
            if (this.editingExisting) {
                this.loadingImage = false;
                this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: this.height / this.imageEl.width, top: 0, left: 0, origin: { x: "0%", y: "0%" } });
                this.isLoading = false;
                return;
            }
            const width = this.height * this.aspectRatio;
            const { clientWidth, clientHeight } = this.imageEl;
            const heightScale = (this.height + 2) / clientHeight;
            const widthScale = (width + 2) / clientWidth;
            const imageScale = heightScale > widthScale ? heightScale : widthScale;
            let updates = Object.assign({}, this.imageProperties);
            updates = Object.assign(Object.assign({}, updates), { top: Math.floor(this.height / 2 - clientHeight / 2), left: Math.floor((this.height * this.aspectRatio) / 2 - clientWidth / 2), origin: { x: "50%", y: "50%" } });
            if (this.zoomToFit) {
                updates = Object.assign(Object.assign({}, updates), { top: updates.top - 1, left: updates.left - 1, scale: imageScale });
                this.initiallySettingZoom = true;
                this.zoomValue = `${50 + Math.log(imageScale) / Math.log(1.1)}`;
            }
            this.imageProperties = Object.assign({}, updates);
            this.isLoading = false;
        };
        this.handleZoomInput = (event) => {
            if (this.initiallySettingZoom) {
                this.initiallySettingZoom = false;
            }
            this.zoomValue = event.target.value;
            this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { scale: Math.pow(1.1, event.target.value - 50) });
        };
        this.handleImageKeydown = (event) => {
            const key = event.key;
            let modified = false;
            switch (key) {
                case "ArrowUp":
                    this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top - 1 });
                    modified = true;
                    break;
                case "ArrowDown":
                    this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { top: this.imageProperties.top + 1 });
                    modified = true;
                    break;
                case "ArrowLeft":
                    this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { left: this.imageProperties.left - 1 });
                    modified = true;
                    break;
                case "ArrowRight":
                    this.imageProperties = Object.assign(Object.assign({}, this.imageProperties), { left: this.imageProperties.left + 1 });
                    modified = true;
                    break;
            }
            if (modified) {
                event.preventDefault();
            }
        };
        this.strings = undefined;
        this.aspectRatio = undefined;
        this.previewSrc = undefined;
        this.loadingImage = false;
        this.editingExisting = false;
        this.zoomToFit = false;
        this.height = undefined;
        this.imageProperties = {
            scale: 1,
            top: 0,
            left: 0,
            origin: {
                x: "50%",
                y: "50%"
            }
        };
        this.dragging = false;
        this.previousPosition = undefined;
        this.previewStyle = undefined;
        this.zoomValue = "50";
        this.initiallySettingZoom = false;
        this.firstImagePropertiesChange = true;
        this.isLoading = true;
    }
    componentWillLoad() {
        const padding = 60;
        const width = this.height * this.aspectRatio;
        const heightWithPaddingPx = `${this.height + padding}px`;
        this.thumbContainerStyle = {
            height: heightWithPaddingPx
        };
        this.translucentContainerStyle = {
            width: `${width + padding}px`,
            height: heightWithPaddingPx
        };
        this.transparentContainerStyle = {
            width: `${width}px`,
            height: `${this.height}px`
        };
        this.previewStyle = {
            transform: `scale(${this.imageProperties.scale})`,
            top: `${this.imageProperties.top}px`,
            left: `${this.imageProperties.left}px`,
            transformOrigin: `${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`
        };
    }
    componentDidLoad() {
        this.imageContainerEl.focus();
    }
    getImageExtent() {
        const imageRect = this.imageEl.getBoundingClientRect();
        const containerRect = this.imageContainerEl.getBoundingClientRect();
        return {
            left: (containerRect.left - imageRect.left) / imageRect.width,
            right: (containerRect.right - imageRect.left) / imageRect.width,
            top: (containerRect.top - imageRect.top) / imageRect.height,
            bottom: (containerRect.bottom - imageRect.top) / imageRect.height
        };
    }
    getDrawDimensions() {
        const imageRect = this.imageEl.getBoundingClientRect();
        const selectedRect = this.imageContainerEl.getBoundingClientRect();
        const top = imageRect.top - selectedRect.top > 0 ? imageRect.top - selectedRect.top : 0;
        const left = imageRect.left - selectedRect.left > 0 ? imageRect.left - selectedRect.left : 0;
        const newImgLeft = imageRect.left < selectedRect.left ? selectedRect.left : imageRect.left;
        const newImgTop = imageRect.top < selectedRect.top ? selectedRect.top : imageRect.top;
        const newImgRight = imageRect.right > selectedRect.right ? selectedRect.right : imageRect.right;
        const newImgBottom = imageRect.bottom > selectedRect.bottom ? selectedRect.bottom : imageRect.bottom;
        return {
            left: left / selectedRect.width,
            top: top / selectedRect.height,
            width: (newImgRight - newImgLeft) / selectedRect.width,
            height: (newImgBottom - newImgTop) / selectedRect.height
        };
    }
    async getDrawParameters() {
        const minWidth = this.height * this.aspectRatio;
        const minHeight = this.height;
        const { left, right, top, bottom } = this.getImageExtent();
        const sourceExtent = {
            left: left < 0 ? 0 : left,
            top: top < 0 ? 0 : top,
            right: right > 1 ? 1 : right,
            bottom: bottom > 1 ? 1 : bottom
        };
        const drawDimensions = this.getDrawDimensions();
        const imageWidth = this.imageEl.clientWidth;
        const imageHeight = this.imageEl.clientHeight;
        const selectionX = sourceExtent.left * imageWidth;
        const selectionY = sourceExtent.top * imageHeight;
        const selectionWidth = sourceExtent.right * imageWidth - sourceExtent.left * imageWidth;
        const selectionHeight = sourceExtent.bottom * imageHeight - sourceExtent.top * imageHeight;
        const canvasWidth = right * imageWidth - left * imageWidth;
        const canvasHeight = bottom * imageHeight - top * imageHeight;
        return {
            selectionX,
            selectionY,
            selectionWidth,
            selectionHeight,
            canvasWidth,
            canvasHeight,
            minWidth,
            minHeight,
            drawDimensions
        };
    }
    handleImagePropertiesChange() {
        this.previewStyle = {
            transform: `scale(${this.imageProperties.scale})`,
            top: `${this.imageProperties.top}px`,
            left: `${this.imageProperties.left}px`,
            transformOrigin: `${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`
        };
        if (this.firstImagePropertiesChange) {
            this.firstImagePropertiesChange = false;
            if (this.zoomToFit) {
                this.arcgisImageUploadEditStepImageChanged.emit();
            }
        }
        else {
            this.arcgisImageUploadEditStepImageChanged.emit();
        }
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { onWheel: this.handleWheel }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { class: "edit-step__loader", label: "", hidden: !this.isLoading }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `edit-step__crop-thumb-container ${this.isLoading ? "edit-step__crop-thumb-container--hidden" : ""}`, style: this.thumbContainerStyle }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__translucent-container", style: this.translucentContainerStyle, onMouseDown: this.handleDragStart, onTouchStart: this.handleDragStart, onMouseMove: this.handleDrag, onTouchMove: this.handleDrag, onMouseUp: this.handleDragEnd, onTouchEnd: this.handleDragEnd, onMouseOut: this.handleDragEnd }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => {
                this.imageContainerEl = el;
            }, class: "edit-step__transparent-container", tabIndex: 0, style: this.transparentContainerStyle, onKeyDown: this.handleImageKeydown }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { ref: (el) => {
                this.imageEl = el;
            }, src: this.previewSrc, alt: "", class: `edit-step__preview-image ${this.loadingImage ? "edit-step__preview-image--loading" : ""}`, style: this.previewStyle, onLoad: this.handleImageLoaded })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: {
                "edit-step__zoom-control": true,
                "edit-step__zoom-control--hidden": this.isLoading
            } }, this.strings.zoom, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-slider", { "aria-label": this.strings.zoom, scale: "l", min: 0, max: 100, value: +this.zoomValue, onCalciteSliderInput: this.handleZoomInput, mirrored: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el) === "rtl" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-label" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-icon-s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "image", scale: "s" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-label-spacer" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "edit-step__zoom-control-icon-l" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "image", scale: "l" }))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "imageProperties": ["handleImagePropertiesChange"]
    }; }
};
ArcgisImageUploadEditStep.style = arcgisImageUploadEditStepCss;

const arcgisImageUploadFileStepCss = ".file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-color-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{margin-bottom:0.25rem;font-size:1.25rem}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}";

const ArcgisImageUploadFileStep = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisImageUploadFileStepFileChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadFileStepFileChange", 7);
        this.arcgisImageUploadFileStepInvalidFile = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisImageUploadFileStepInvalidFile", 7);
        this.handleDragOver = (event) => {
            event.preventDefault();
        };
        this.handleDrop = (event) => {
            event.preventDefault();
            this.processFile(event.dataTransfer.files[0]);
        };
        this.handleFileInputChange = (event) => {
            this.processFile(event.target.files[0]);
        };
        this.strings = undefined;
        this.sizeDescription = undefined;
    }
    async resetFileInput() {
        this.fileInput.value = "";
    }
    processFile(file) {
        if (!file) {
            return;
        }
        if (file) {
            if (!this.isValidFile(file)) {
                this.arcgisImageUploadFileStepInvalidFile.emit();
                return;
            }
            const reader = new FileReader();
            reader.onload = async (event) => {
                this.arcgisImageUploadFileStepFileChange.emit({
                    dataURL: event.target.result,
                    fileName: file.name || ""
                });
            };
            reader.readAsDataURL(file);
        }
    }
    isValidFile(file) {
        return (file === null || file === void 0 ? void 0 : file.name) && /\.(gif|jpg|jpeg|png)$/i.test(file.name);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step", "aria-label": this.strings.dragDrop, onDragOver: this.handleDragOver, onDragEnter: this.handleDragOver, onDrop: this.handleDrop }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step__upload-icon" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "upload" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step__drag-text", "aria-label": this.strings.dragDrop }, this.strings.dragDrop), this.sizeDescription && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": this.sizeDescription }, this.sizeDescription)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "file-step__browse-button", appearance: "transparent", iconStart: "image", scale: "l", onClick: () => {
                this.fileInput.click();
            } }, this.strings.browse), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { ref: (el) => {
                this.fileInput = el;
            }, onChange: this.handleFileInputChange, class: "file-step__file-input", type: "file", accept: ".jpg,.gif,.png,.jpeg" }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisImageUploadFileStep.style = arcgisImageUploadFileStepCss;



//# sourceMappingURL=arcgis-image-upload_3.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWI4ODdlYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3REO0FBQ047QUFDckM7QUFDUTs7QUFFbkMsbURBQW1ELDRCQUE0QixxQkFBcUIsa0JBQWtCLGtCQUFrQix1QkFBdUIsc0JBQXNCLGlEQUFpRCxrQkFBa0IsbUJBQW1CLGlCQUFpQixzQkFBc0IsK0NBQStDLGlDQUFpQyxpQkFBaUIsbUNBQW1DLFlBQVksc0JBQXNCLGtCQUFrQixlQUFlLGNBQWMsY0FBYyxnQkFBZ0IsbUJBQW1CLGtCQUFrQixnQkFBZ0IseUNBQXlDLHFCQUFxQixzQkFBc0IsYUFBYSx1REFBdUQsVUFBVSxXQUFXLFVBQVUsWUFBWSxvQkFBb0IscUJBQXFCLCtCQUErQixtREFBbUQsYUFBYSxrQkFBa0IsbURBQW1ELHFDQUFxQyw0Q0FBNEMsOEJBQThCLHFCQUFxQix3QkFBd0IsYUFBYSxtQkFBbUIsZUFBZSxvQkFBb0IsNkJBQTZCLFdBQVcsbUJBQW1COztBQUVwd0M7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHVDQUF1QyxxREFBVztBQUNsRCxzQ0FBc0MscURBQVc7QUFDakQscUNBQXFDLHFEQUFXO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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ZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1pbWFnZS11cGxvYWRfMy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBGIGFzIEZyYWdtZW50LCBkIGFzIGdldEVsZW1lbnQsIEggYXMgSG9zdCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuXG5jb25zdCBhcmNnaXNJbWFnZVVwbG9hZENzcyA9IFwiLmltYWdlLXVwbG9hZF9fbW9kYWx7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjY1MHB4fS5pbWFnZS11cGxvYWRfX3RpdGxle21hcmdpbi1ib3R0b206MHB4O2ZvbnQtc2l6ZToxLjI1cmVtfS5pbWFnZS11cGxvYWRfX2NvbnRlbnR7Ym94LXNpemluZzpib3JkZXItYm94O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKTtwYWRkaW5nLWxlZnQ6MnJlbTtwYWRkaW5nLXJpZ2h0OjJyZW07cGFkZGluZy10b3A6MXJlbTtwYWRkaW5nLWJvdHRvbToxLjVyZW07Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0zKX0uaW1hZ2UtdXBsb2FkX19jb250ZW50LS13aXRoLW1hcHttaW4taGVpZ2h0OjQwMHB4fS5pbWFnZS11cGxvYWRfX2NvbnRlbnQtLW5vLXBhZGRpbmd7cGFkZGluZzowcHh9LmltYWdlLXVwbG9hZF9fY2FudmFze3Zpc2liaWxpdHk6aGlkZGVuO3Bvc2l0aW9uOmZpeGVkO2xlZnQ6LTEwMDAwcHh9Lm9yLWNvbnRhaW5lcnttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbToxcmVtO3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtd2VpZ2h0OjUwMH0ub3ItY29udGFpbmVyOmJlZm9yZSwub3ItY29udGFpbmVyOmFmdGVye2Rpc3BsYXk6aW5saW5lLWJsb2NrO3ZlcnRpY2FsLWFsaWduOm1pZGRsZTtjb250ZW50OlxcXCJcXFwiO2JvcmRlci10b3A6c29saWQgMXB4IHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLWlucHV0KTt3aWR0aDoxNSU7aGVpZ2h0OjFweDt6LWluZGV4OjF9Lm9yLXdyYXBwZXJ7cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbX0uaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1idXR0b257YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7cGFkZGluZzoxcmVtO3RleHQtYWxpZ246Y2VudGVyO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS5pbWFnZS11cGxvYWRfX2Zyb20tbWFwLWJ1dHRvbjpob3Zlcntib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5pbWFnZS11cGxvYWRfX2Zyb20tbWFwLXRpdGxle2Rpc3BsYXk6aW5saW5lLWJsb2NrfS5mcm9tLW1hcC10aXRsZS13cmFwcGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9LmZyb20tbWFwLWljb257bWFyZ2luLXJpZ2h0OjAuNXJlbX0uaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1kZXNje21hcmdpbjowcHg7Zm9udC1zaXplOjAuODc1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJbWFnZVVwbG9hZCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ltYWdlVXBsb2FkQ2FuY2VsXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ltYWdlVXBsb2FkRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRTYXZlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJbWFnZVVwbG9hZFNhdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuaW1hZ2VGb3JtYXQgPSBcInBuZ1wiO1xuICAgICAgICB0aGlzLmZpbGVOYW1lID0gXCJcIjtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZENhbmNlbC5lbWl0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hvb3NlRGlmZkNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVTdGVwID0gXCJmaWxlXCI7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdTcmMgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5lZGl0RXhpc3RpbmcgPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVTYXZlQ2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTdGVwID09PSBcImZpbGVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNob3dFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zYXZpbmcgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJtYXBcIikge1xuICAgICAgICAgICAgICAgIHRoaXMudGFrZU1hcFNjcmVlbnNob3QoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5nZXRDYW52YXNJbWFnZSgpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZFNhdmUuZW1pdChkYXRhKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50YWtlTWFwU2NyZWVuc2hvdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcFZpZXdbXCJfc3RhZ2VcIl0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXdbXCJfc3RhZ2VcIl1bXCJfc3VwZXJzYW1wbGVTY3JlZW5zaG90c1wiXSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYXBWaWV3LnRha2VTY3JlZW5zaG90KHtcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IFwicG5nXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBibG9iOiB0aGlzLmRhdGFVUklUb0Jsb2IocmVzdWx0LmRhdGFVcmwpLFxuICAgICAgICAgICAgICAgIGJhc2U2NDogcmVzdWx0LmRhdGFVcmwsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBcInBuZ1wiLFxuICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBcIlwiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZFNhdmUuZW1pdChkYXRhKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVGcm9tTWFwQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVN0ZXAgPSBcIm1hcFwiO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZU1hcFZpZXdMb2FkZWQgPSAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLm1hcFZpZXcgPSBldnQuZGV0YWlsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1vZGFsVGl0bGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2l6ZURlc2NyaXB0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnpvb21Ub0ZpdCA9IHRydWU7XG4gICAgICAgIHRoaXMubWF4V2lkdGggPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubWF4SGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpbGxCYWNrZ3JvdW5kID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWN0aXZlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lcldpZHRoIDwgNDEyID8gMjAwIDogMzAwO1xuICAgICAgICB0aGlzLmFzcGVjdFJhdGlvID0gMTtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmpzYXBpVXJsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnByZXZpZXdTcmMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZWRpdEV4aXN0aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFjdGl2ZVN0ZXAgPSBcImZpbGVcIjtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFuZGxlRmlsZUNoYW5nZShldnQpIHtcbiAgICAgICAgY29uc3QgeyBmaWxlTmFtZSwgZGF0YVVSTCB9ID0gZXZ0LmRldGFpbDtcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgICAgICB0aGlzLnByZXZpZXdTcmMgPSBkYXRhVVJMO1xuICAgICAgICB0aGlzLmFjdGl2ZVN0ZXAgPSBcImVkaXRcIjtcbiAgICAgICAgdGhpcy5zaG93RXJyb3IgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFuZGxlSW52YWxpZEZpbGUoKSB7XG4gICAgICAgIHRoaXMuc2hvd0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hcmNnaXNJbWFnZVVwbG9hZEVycm9yLmVtaXQoXCJpbnZhbGlkIGZpbGUgdHlwZS5cIik7XG4gICAgfVxuICAgIGhhbmRsZUltYWdlQ2hhbmdlKCkge1xuICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlO1xuICAgIH1cbiAgICBoYW5kbGVBY3RpdmVDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVTdGVwID0gXCJmaWxlXCI7XG4gICAgICAgICAgICB0aGlzLnNhdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pc01vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdTcmMgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5lZGl0RXhpc3RpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuZmlsZVN0ZXApID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXNldEZpbGVJbnB1dCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVbMF07XG4gICAgfVxuICAgIGRhdGFVUklUb0Jsb2IoZGF0YVVSSSkge1xuICAgICAgICBjb25zdCBieXRlU3RyaW5nID0gYXRvYihkYXRhVVJJLnNwbGl0KFwiLFwiKVsxXSk7XG4gICAgICAgIGNvbnN0IG1pbWVTdHJpbmcgPSBkYXRhVVJJLnNwbGl0KFwiLFwiKVswXS5zcGxpdChcIjpcIilbMV0uc3BsaXQoXCI7XCIpWzBdO1xuICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyaW5nLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IHVpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlU3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB1aW50QXJyYXlbaV0gPSBieXRlU3RyaW5nLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHtcbiAgICAgICAgICAgIHR5cGU6IG1pbWVTdHJpbmdcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBibG9iO1xuICAgIH1cbiAgICBkcmF3SW1hZ2UoeyBzZWxlY3Rpb25YLCBzZWxlY3Rpb25ZLCBzZWxlY3Rpb25XaWR0aCwgc2VsZWN0aW9uSGVpZ2h0LCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0LCBtaW5XaWR0aCwgbWluSGVpZ2h0LCBkcmF3RGltZW5zaW9ucyB9LCBzY2FsZUZhY3RvciwgaW1nLCBjb250ZXh0KSB7XG4gICAgICAgIHRoaXMuY2FudmFzRWwud2lkdGggPSBjYW52YXNXaWR0aCA8IG1pbldpZHRoID8gbWluV2lkdGggOiBjYW52YXNXaWR0aCAqIHNjYWxlRmFjdG9yO1xuICAgICAgICB0aGlzLmNhbnZhc0VsLmhlaWdodCA9IGNhbnZhc0hlaWdodCA8IG1pbkhlaWdodCA/IG1pbkhlaWdodCA6IGNhbnZhc0hlaWdodCAqIHNjYWxlRmFjdG9yO1xuICAgICAgICBpZiAodGhpcy5tYXhXaWR0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FudmFzRWwud2lkdGggPiB0aGlzLm1heFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXNFbC53aWR0aCA9IHRoaXMubWF4V2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jYW52YXNFbC5oZWlnaHQgPiB0aGlzLm1heEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzRWwuaGVpZ2h0ID0gdGhpcy5tYXhIZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVmdCA9IGRyYXdEaW1lbnNpb25zLmxlZnQgKiB0aGlzLmNhbnZhc0VsLndpZHRoO1xuICAgICAgICBjb25zdCB0b3AgPSBkcmF3RGltZW5zaW9ucy50b3AgKiB0aGlzLmNhbnZhc0VsLmhlaWdodDtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBkcmF3RGltZW5zaW9ucy53aWR0aCAqIHRoaXMuY2FudmFzRWwud2lkdGg7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IGRyYXdEaW1lbnNpb25zLmhlaWdodCAqIHRoaXMuY2FudmFzRWwuaGVpZ2h0O1xuICAgICAgICBpZiAodGhpcy5maWxsQmFja2dyb3VuZCkge1xuICAgICAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBcIiNlZmVmZWZcIjtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgdGhpcy5jYW52YXNFbC53aWR0aCwgdGhpcy5jYW52YXNFbC5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltZywgc2VsZWN0aW9uWCwgc2VsZWN0aW9uWSwgc2VsZWN0aW9uV2lkdGgsIHNlbGVjdGlvbkhlaWdodCwgbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgY29uc3QgYmFzZTY0ID0gdGhpcy5jYW52YXNFbC50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XG4gICAgICAgIGNvbnN0IGJsb2IgPSB0aGlzLmRhdGFVUklUb0Jsb2IoYmFzZTY0KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJhc2U2NCxcbiAgICAgICAgICAgIGJsb2JcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0U2NhbGVkSW1hZ2VEYXRhKGltZykge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5jYW52YXNFbC5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNvbnN0IGRyYXdQYXJhbWV0ZXJzID0gYXdhaXQgdGhpcy5lZGl0U3RlcEVsLmdldERyYXdQYXJhbWV0ZXJzKCk7XG4gICAgICAgIGxldCByZXN1bHRzO1xuICAgICAgICBmdW5jdGlvbiByZXRyeSgpIHtcbiAgICAgICAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzRWwud2lkdGgsIHRoaXMuY2FudmFzRWwuaGVpZ2h0KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyYXdJbWFnZShkcmF3UGFyYW1ldGVycywgMTYwMCAvIGltZy53aWR0aCwgaW1nLCBjb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmVzdWx0cyA9IHRoaXMuZHJhd0ltYWdlKGRyYXdQYXJhbWV0ZXJzLCAxLCBpbWcsIGNvbnRleHQpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMuYmxvYi5zaXplID4gMTAwMDAwMDAgfHwgcmVzdWx0cy5ibG9iLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmV0cnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUubmFtZSAhPT0gXCJOU19FUlJPUl9GQUlMVVJFXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRXJyb3IuZW1pdChcInVuYWJsZSB0byBzYXZlIHRoZSBpbWFnZSBwcm92aWRlZC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmV0cnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYmxvYjogcmVzdWx0cyA9PT0gbnVsbCB8fCByZXN1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHRzLmJsb2IsXG4gICAgICAgICAgICBiYXNlNjQ6IHJlc3VsdHMgPT09IG51bGwgfHwgcmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0cy5iYXNlNjQsXG4gICAgICAgICAgICBmb3JtYXQ6IHRoaXMuaW1hZ2VGb3JtYXQsXG4gICAgICAgICAgICBmaWxlTmFtZTogdGhpcy5maWxlTmFtZVxuICAgICAgICB9O1xuICAgIH1cbiAgICBnZXRDYW52YXNJbWFnZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXZpZXdTcmMuaW5kZXhPZihcImFyY2dpcy5jb21cIikgPiAtMSkge1xuICAgICAgICAgICAgICAgIGltZy5jcm9zc09yaWdpbiA9IFwiQW5vbnltb3VzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlckFzcGVjdFJhdGlvID0gTWF0aC5hYnModGhpcy5hc3BlY3RSYXRpbyAtIGltZy53aWR0aCAvIGltZy5oZWlnaHQpIDwgMC4wMTtcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVyQXNwZWN0UmF0aW8gJiYgIXRoaXMuaXNNb2RpZmllZCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IHRoaXMuZGF0YVVSSVRvQmxvYih0aGlzLnByZXZpZXdTcmMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0OiB0aGlzLnByZXZpZXdTcmMsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuaW1hZ2VGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogdGhpcy5maWxlTmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMuZ2V0U2NhbGVkSW1hZ2VEYXRhKGltZykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLnByZXZpZXdTcmM7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGhhc01hcCA9ICEhdGhpcy5wb3J0YWwgJiYgISF0aGlzLml0ZW1JZCAmJiAhIXRoaXMuanNhcGlVcmw7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbW9kYWxcIiwgeyBjbGFzczogXCJpbWFnZS11cGxvYWRfX21vZGFsXCIsIG9wZW46IHRoaXMuYWN0aXZlLCByb2xlOiBcImRpYWxvZ1wiLCBcImFyaWEtbW9kYWxcIjogXCJ0cnVlXCIsIFwiYXJpYS1sYWJlbGxlZGJ5XCI6IFwiaW1hZ2UtdXBsb2FkLW1vZGFsLXRpdGxlXCIsIG91dHNpZGVDbG9zZURpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVNb2RhbENsb3NlOiB0aGlzLmhhbmRsZUNhbmNlbCB9LCBoKFwiaDNcIiwgeyBzbG90OiBcImhlYWRlclwiLCBpZDogXCJpbWFnZS11cGxvYWQtbW9kYWwtdGl0bGVcIiwgY2xhc3M6IFwiaW1hZ2UtdXBsb2FkX190aXRsZVwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5tb2RhbFRpdGxlIH0sIHRoaXMubW9kYWxUaXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImltYWdlLXVwbG9hZF9fY29udGVudFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiaW1hZ2UtdXBsb2FkX19jb250ZW50LS13aXRoLW1hcFwiOiBoYXNNYXAsXG4gICAgICAgICAgICAgICAgXCJpbWFnZS11cGxvYWRfX2NvbnRlbnQtLW5vLXBhZGRpbmdcIjogdGhpcy5hY3RpdmVTdGVwID09PSBcIm1hcFwiXG4gICAgICAgICAgICB9IH0sIHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJmaWxlXCIgJiYgKGgoXCJkaXZcIiwgbnVsbCwgaChcImFyY2dpcy1pbWFnZS11cGxvYWQtZmlsZS1zdGVwXCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVTdGVwID0gZWw7XG4gICAgICAgICAgICB9LCBzdHJpbmdzOiB0aGlzLnN0cmluZ3MsIHNpemVEZXNjcmlwdGlvbjogdGhpcy5zaXplRGVzY3JpcHRpb24gfSksIGhhc01hcCAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcIm9yLWNvbnRhaW5lclwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwib3Itd3JhcHBlclwiIH0sIHRoaXMuc3RyaW5ncy5vcikpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC1idXR0b25cIiwgdGFiSW5kZXg6IDAsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlRnJvbU1hcENsaWNrLCBvbktleURvd246IChldnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmNvZGUgPT09IFwiU3BhY2VcIiB8fCBldnQuY29kZSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRnJvbU1hcENsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW1hZ2UtdXBsb2FkX19mcm9tLW1hcC10aXRsZVwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmcm9tLW1hcC10aXRsZS13cmFwcGVyXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IFwibWFwXCIsIHNjYWxlOiBcIm1cIiwgY2xhc3M6IFwiZnJvbS1tYXAtaWNvblwiIH0pLCB0aGlzLnN0cmluZ3MuZnJvbU1hcCkpLCBoKFwicFwiLCB7IGNsYXNzOiBcImltYWdlLXVwbG9hZF9fZnJvbS1tYXAtZGVzY1wiIH0sIHRoaXMuc3RyaW5ncy5mcm9tTWFwRGVzYykpKSkpKSwgdGhpcy5hY3RpdmVTdGVwID09PSBcIm1hcFwiICYmIChoKFwiYXJjZ2lzLWltYWdlLXVwbG9hZC1mcm9tLW1hcFwiLCB7IHBvcnRhbDogdGhpcy5wb3J0YWwsIGl0ZW1JZDogdGhpcy5pdGVtSWQsIGpzYXBpVXJsOiB0aGlzLmpzYXBpVXJsLCBjaGFuZ2VCYXNlbWFwVGV4dDogdGhpcy5zdHJpbmdzLmNoYW5nZUJhc2VtYXAsIGxvYWRpbmdUZXh0OiB0aGlzLnN0cmluZ3MubG9hZGluZywgb25BcmNnaXNJbWFnZVVwbG9hZEZyb21NYXBSZWFkeTogdGhpcy5oYW5kbGVNYXBWaWV3TG9hZGVkIH0pKSwgdGhpcy5hY3RpdmVTdGVwID09PSBcImVkaXRcIiAmJiAoaChcImFyY2dpcy1pbWFnZS11cGxvYWQtZWRpdC1zdGVwXCIsIHsgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRTdGVwRWwgPSBlbDtcbiAgICAgICAgICAgIH0sIHN0cmluZ3M6IHRoaXMuc3RyaW5ncywgaGVpZ2h0OiB0aGlzLmhlaWdodCwgYXNwZWN0UmF0aW86IHRoaXMuYXNwZWN0UmF0aW8sIHByZXZpZXdTcmM6IHRoaXMucHJldmlld1NyYywgem9vbVRvRml0OiB0aGlzLnpvb21Ub0ZpdCB9KSksIHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJlZGl0XCIgJiYgKGgoXCJjYW52YXNcIiwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzRWwgPSBlbDtcbiAgICAgICAgICAgIH0sIGNsYXNzOiBcImltYWdlLXVwbG9hZF9fY2FudmFzXCIgfSkpLCBoKFwiY2FsY2l0ZS1hbGVydFwiLCB7IGxhYmVsOiB0aGlzLnN0cmluZ3MuaW1hZ2VSZXF1aXJlZCwgb3BlbjogdGhpcy5zaG93RXJyb3IsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydEVsID0gZWw7XG4gICAgICAgICAgICB9LCBpY29uOiBcImV4Y2xhbWF0aW9uLW1hcmstY2lyY2xlXCIsIHBsYWNlbWVudDogXCJib3R0b21cIiwga2luZDogXCJkYW5nZXJcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgdGhpcy5zdHJpbmdzLmltYWdlUmVxdWlyZWQpKSksICh0aGlzLmFjdGl2ZVN0ZXAgPT09IFwiZWRpdFwiIHx8IHRoaXMuYWN0aXZlU3RlcCA9PT0gXCJtYXBcIikgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiYmFja1wiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIFwiaWNvbi1zdGFydFwiOiBcImNoZXZyb24tbGVmdFwiLCB3aWR0aDogXCJmdWxsXCIsIGRpc2FibGVkOiB0aGlzLnNhdmluZywgb25DbGljazogdGhpcy5oYW5kbGVDaG9vc2VEaWZmQ2xpY2ssIGljb25GbGlwUnRsOiBcInN0YXJ0XCIgfSwgdGhpcy5zdHJpbmdzLmNob29zZURpZmYpKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJzZWNvbmRhcnlcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogdGhpcy5zYXZpbmcsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FuY2VsIH0sIHRoaXMuc3RyaW5ncy5jYW5jZWwpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcInByaW1hcnlcIiwgYXBwZWFyYW5jZTogXCJzb2xpZFwiLCB3aWR0aDogXCJmdWxsXCIsIGxvYWRpbmc6IHRoaXMuc2F2aW5nLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVNhdmVDbGljayB9LCB0aGlzLnN0cmluZ3Muc2F2ZSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiYWN0aXZlXCI6IFtcImhhbmRsZUFjdGl2ZUNoYW5nZVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNJbWFnZVVwbG9hZC5zdHlsZSA9IGFyY2dpc0ltYWdlVXBsb2FkQ3NzO1xuXG5jb25zdCBhcmNnaXNJbWFnZVVwbG9hZEVkaXRTdGVwQ3NzID0gXCI6aG9zdHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmJsb2NrO292ZXJmbG93OmhpZGRlbjttaW4taGVpZ2h0OjIwLjYyNXJlbX0uZWRpdC1zdGVwX19sb2FkZXJ7cG9zaXRpb246YWJzb2x1dGU7dG9wOjUwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsIC01MCUpfS5lZGl0LXN0ZXBfX2Nyb3AtdGh1bWItY29udGFpbmVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7b3ZlcmZsb3c6aGlkZGVufS5lZGl0LXN0ZXBfX2Nyb3AtdGh1bWItY29udGFpbmVyLS1oaWRkZW57dmlzaWJpbGl0eTpoaWRkZW59LmVkaXQtc3RlcF9fdHJhbnNsdWNlbnQtY29udGFpbmVye3Bvc2l0aW9uOmFic29sdXRlO3RvcDowcHg7b3ZlcmZsb3c6aGlkZGVuO2xlZnQ6NTAlO2N1cnNvcjphbGwtc2Nyb2xsO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSl9LmVkaXQtc3RlcF9fdHJhbnNsdWNlbnQtY29udGFpbmVyOmFmdGVye3Bvc2l0aW9uOmFic29sdXRlO3RvcDowcHg7cmlnaHQ6MHB4O2JvdHRvbTowcHg7bGVmdDowcHg7Ym94LXNpemluZzpib3JkZXItYm94O2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7Y29udGVudDpcXFwiXFxcIjtvcGFjaXR5OjAuOTtib3JkZXI6MS44NzVyZW0gc29saWQgd2hpdGV9LmVkaXQtc3RlcF9fdHJhbnNwYXJlbnQtY29udGFpbmVye3Bvc2l0aW9uOmFic29sdXRlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtvdmVyZmxvdy14OnZpc2libGU7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSk7bWFyZ2luLXJpZ2h0Oi01MCU7dG9wOjUwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsIC01MCUpfS5lZGl0LXN0ZXBfX3ByZXZpZXctaW1hZ2V7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowcHg7dG9wOjBweDttYXJnaW46MHB4O3RyYW5zZm9ybS1vcmlnaW46NTAlIDUwJX0uZWRpdC1zdGVwX19wcmV2aWV3LWltYWdlLS1sb2FkaW5ne3Zpc2liaWxpdHk6aGlkZGVufS5lZGl0LXN0ZXBfX3RyYW5zcGFyZW50LWNvbnRhaW5lcjpmb2N1cyAuZWRpdC1zdGVwX19wcmV2aWV3LWltYWdle2JveC1zaGFkb3c6MHB4IDBweCA2cHggNHB4IHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5lZGl0LXN0ZXBfX3pvb20tY29udHJvbHstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowfS5lZGl0LXN0ZXBfX3pvb20tY29udHJvbC0taGlkZGVue3Zpc2liaWxpdHk6aGlkZGVufS5lZGl0LXN0ZXBfX3pvb20tY29udHJvbC1sYWJlbHtkaXNwbGF5OmZsZXg7aGVpZ2h0OjJyZW19LmVkaXQtc3RlcF9fem9vbS1jb250cm9sLWxhYmVsLXNwYWNlcntmbGV4OjEgMSAwJX1cIjtcblxuY29uc3QgQXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZFwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVXaGVlbCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGNvbnN0IGltYWdlU2NhbGUgPSBldmVudC5kZWx0YVkgPiAwID8gKHRoaXMuaW1hZ2VQcm9wZXJ0aWVzLnNjYWxlICogMSkgLyAxLjEgOiB0aGlzLmltYWdlUHJvcGVydGllcy5zY2FsZSAqIDEuMTtcbiAgICAgICAgICAgIHRoaXMuem9vbVZhbHVlID0gYCR7NTAgKyBNYXRoLmxvZyhpbWFnZVNjYWxlKSAvIE1hdGgubG9nKDEuMSl9YDtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgc2NhbGU6IGltYWdlU2NhbGUgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRHJhZ1N0YXJ0ID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kcmFnZ2luZyA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRHJhZyA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmRyYWdnaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyB0b3VjaGVzIH0gPSBldmVudDtcbiAgICAgICAgICAgIGxldCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IGV2ZW50O1xuICAgICAgICAgICAgaWYgKGNsaWVudFggPT09IHVuZGVmaW5lZCB8fCBjbGllbnRZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBvbiB0b3VjaCBkZXZpY2VzLCB1c2UgdGhlIGNsaWVudFggYW5kIGNsaWVudFkgcHJvcGVydGllcyBpbnNpZGUgdG91Y2hlcyBhcnJheSBwcm9wZXJ0eVxuICAgICAgICAgICAgICAgIGlmICghdG91Y2hlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbGllbnRYID0gdG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgICAgICAgICAgIGNsaWVudFkgPSB0b3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMucHJldmlvdXNQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBjbGllbnRZLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBjbGllbnRYXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IHRvcCwgbGVmdCB9ID0gdGhpcy5wcmV2aW91c1Bvc2l0aW9uO1xuICAgICAgICAgICAgY29uc3QgeURpZmYgPSBjbGllbnRZIC0gdG9wO1xuICAgICAgICAgICAgY29uc3QgeERpZmYgPSBjbGllbnRYIC0gbGVmdDtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgdG9wOiB0aGlzLmltYWdlUHJvcGVydGllcy50b3AgKyB5RGlmZiwgbGVmdDogdGhpcy5pbWFnZVByb3BlcnRpZXMubGVmdCArIHhEaWZmIH0pO1xuICAgICAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHRvcDogdG9wICsgeURpZmYsXG4gICAgICAgICAgICAgICAgbGVmdDogbGVmdCArIHhEaWZmXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZURyYWdFbmQgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlSW1hZ2VMb2FkZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5lZGl0aW5nRXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdJbWFnZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgc2NhbGU6IHRoaXMuaGVpZ2h0IC8gdGhpcy5pbWFnZUVsLndpZHRoLCB0b3A6IDAsIGxlZnQ6IDAsIG9yaWdpbjogeyB4OiBcIjAlXCIsIHk6IFwiMCVcIiB9IH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW87XG4gICAgICAgICAgICBjb25zdCB7IGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQgfSA9IHRoaXMuaW1hZ2VFbDtcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodFNjYWxlID0gKHRoaXMuaGVpZ2h0ICsgMikgLyBjbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICBjb25zdCB3aWR0aFNjYWxlID0gKHdpZHRoICsgMikgLyBjbGllbnRXaWR0aDtcbiAgICAgICAgICAgIGNvbnN0IGltYWdlU2NhbGUgPSBoZWlnaHRTY2FsZSA+IHdpZHRoU2NhbGUgPyBoZWlnaHRTY2FsZSA6IHdpZHRoU2NhbGU7XG4gICAgICAgICAgICBsZXQgdXBkYXRlcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIHVwZGF0ZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHVwZGF0ZXMpLCB7IHRvcDogTWF0aC5mbG9vcih0aGlzLmhlaWdodCAvIDIgLSBjbGllbnRIZWlnaHQgLyAyKSwgbGVmdDogTWF0aC5mbG9vcigodGhpcy5oZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvKSAvIDIgLSBjbGllbnRXaWR0aCAvIDIpLCBvcmlnaW46IHsgeDogXCI1MCVcIiwgeTogXCI1MCVcIiB9IH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuem9vbVRvRml0KSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdXBkYXRlcyksIHsgdG9wOiB1cGRhdGVzLnRvcCAtIDEsIGxlZnQ6IHVwZGF0ZXMubGVmdCAtIDEsIHNjYWxlOiBpbWFnZVNjYWxlIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhbGx5U2V0dGluZ1pvb20gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuem9vbVZhbHVlID0gYCR7NTAgKyBNYXRoLmxvZyhpbWFnZVNjYWxlKSAvIE1hdGgubG9nKDEuMSl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbih7fSwgdXBkYXRlcyk7XG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVpvb21JbnB1dCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGx5U2V0dGluZ1pvb20pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxseVNldHRpbmdab29tID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnpvb21WYWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgc2NhbGU6IE1hdGgucG93KDEuMSwgZXZlbnQudGFyZ2V0LnZhbHVlIC0gNTApIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUltYWdlS2V5ZG93biA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gZXZlbnQua2V5O1xuICAgICAgICAgICAgbGV0IG1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd1VwXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgdG9wOiB0aGlzLmltYWdlUHJvcGVydGllcy50b3AgLSAxIH0pO1xuICAgICAgICAgICAgICAgICAgICBtb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd0Rvd25cIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZVByb3BlcnRpZXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzKSwgeyB0b3A6IHRoaXMuaW1hZ2VQcm9wZXJ0aWVzLnRvcCArIDEgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIkFycm93TGVmdFwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbWFnZVByb3BlcnRpZXMpLCB7IGxlZnQ6IHRoaXMuaW1hZ2VQcm9wZXJ0aWVzLmxlZnQgLSAxIH0pO1xuICAgICAgICAgICAgICAgICAgICBtb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd1JpZ2h0XCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLmltYWdlUHJvcGVydGllcyksIHsgbGVmdDogdGhpcy5pbWFnZVByb3BlcnRpZXMubGVmdCArIDEgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYXNwZWN0UmF0aW8gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHJldmlld1NyYyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nSW1hZ2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lZGl0aW5nRXhpc3RpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy56b29tVG9GaXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW1hZ2VQcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgb3JpZ2luOiB7XG4gICAgICAgICAgICAgICAgeDogXCI1MCVcIixcbiAgICAgICAgICAgICAgICB5OiBcIjUwJVwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnByZXZpZXdTdHlsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy56b29tVmFsdWUgPSBcIjUwXCI7XG4gICAgICAgIHRoaXMuaW5pdGlhbGx5U2V0dGluZ1pvb20gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5maXJzdEltYWdlUHJvcGVydGllc0NoYW5nZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHBhZGRpbmcgPSA2MDtcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW87XG4gICAgICAgIGNvbnN0IGhlaWdodFdpdGhQYWRkaW5nUHggPSBgJHt0aGlzLmhlaWdodCArIHBhZGRpbmd9cHhgO1xuICAgICAgICB0aGlzLnRodW1iQ29udGFpbmVyU3R5bGUgPSB7XG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFdpdGhQYWRkaW5nUHhcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50cmFuc2x1Y2VudENvbnRhaW5lclN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IGAke3dpZHRoICsgcGFkZGluZ31weGAsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFdpdGhQYWRkaW5nUHhcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50cmFuc3BhcmVudENvbnRhaW5lclN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IGAke3dpZHRofXB4YCxcbiAgICAgICAgICAgIGhlaWdodDogYCR7dGhpcy5oZWlnaHR9cHhgXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJldmlld1N0eWxlID0ge1xuICAgICAgICAgICAgdHJhbnNmb3JtOiBgc2NhbGUoJHt0aGlzLmltYWdlUHJvcGVydGllcy5zY2FsZX0pYCxcbiAgICAgICAgICAgIHRvcDogYCR7dGhpcy5pbWFnZVByb3BlcnRpZXMudG9wfXB4YCxcbiAgICAgICAgICAgIGxlZnQ6IGAke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLmxlZnR9cHhgLFxuICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiBgJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueH0gJHt0aGlzLmltYWdlUHJvcGVydGllcy5vcmlnaW4ueX1gXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuaW1hZ2VDb250YWluZXJFbC5mb2N1cygpO1xuICAgIH1cbiAgICBnZXRJbWFnZUV4dGVudCgpIHtcbiAgICAgICAgY29uc3QgaW1hZ2VSZWN0ID0gdGhpcy5pbWFnZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gdGhpcy5pbWFnZUNvbnRhaW5lckVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVmdDogKGNvbnRhaW5lclJlY3QubGVmdCAtIGltYWdlUmVjdC5sZWZ0KSAvIGltYWdlUmVjdC53aWR0aCxcbiAgICAgICAgICAgIHJpZ2h0OiAoY29udGFpbmVyUmVjdC5yaWdodCAtIGltYWdlUmVjdC5sZWZ0KSAvIGltYWdlUmVjdC53aWR0aCxcbiAgICAgICAgICAgIHRvcDogKGNvbnRhaW5lclJlY3QudG9wIC0gaW1hZ2VSZWN0LnRvcCkgLyBpbWFnZVJlY3QuaGVpZ2h0LFxuICAgICAgICAgICAgYm90dG9tOiAoY29udGFpbmVyUmVjdC5ib3R0b20gLSBpbWFnZVJlY3QudG9wKSAvIGltYWdlUmVjdC5oZWlnaHRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0RHJhd0RpbWVuc2lvbnMoKSB7XG4gICAgICAgIGNvbnN0IGltYWdlUmVjdCA9IHRoaXMuaW1hZ2VFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRSZWN0ID0gdGhpcy5pbWFnZUNvbnRhaW5lckVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCB0b3AgPSBpbWFnZVJlY3QudG9wIC0gc2VsZWN0ZWRSZWN0LnRvcCA+IDAgPyBpbWFnZVJlY3QudG9wIC0gc2VsZWN0ZWRSZWN0LnRvcCA6IDA7XG4gICAgICAgIGNvbnN0IGxlZnQgPSBpbWFnZVJlY3QubGVmdCAtIHNlbGVjdGVkUmVjdC5sZWZ0ID4gMCA/IGltYWdlUmVjdC5sZWZ0IC0gc2VsZWN0ZWRSZWN0LmxlZnQgOiAwO1xuICAgICAgICBjb25zdCBuZXdJbWdMZWZ0ID0gaW1hZ2VSZWN0LmxlZnQgPCBzZWxlY3RlZFJlY3QubGVmdCA/IHNlbGVjdGVkUmVjdC5sZWZ0IDogaW1hZ2VSZWN0LmxlZnQ7XG4gICAgICAgIGNvbnN0IG5ld0ltZ1RvcCA9IGltYWdlUmVjdC50b3AgPCBzZWxlY3RlZFJlY3QudG9wID8gc2VsZWN0ZWRSZWN0LnRvcCA6IGltYWdlUmVjdC50b3A7XG4gICAgICAgIGNvbnN0IG5ld0ltZ1JpZ2h0ID0gaW1hZ2VSZWN0LnJpZ2h0ID4gc2VsZWN0ZWRSZWN0LnJpZ2h0ID8gc2VsZWN0ZWRSZWN0LnJpZ2h0IDogaW1hZ2VSZWN0LnJpZ2h0O1xuICAgICAgICBjb25zdCBuZXdJbWdCb3R0b20gPSBpbWFnZVJlY3QuYm90dG9tID4gc2VsZWN0ZWRSZWN0LmJvdHRvbSA/IHNlbGVjdGVkUmVjdC5ib3R0b20gOiBpbWFnZVJlY3QuYm90dG9tO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVmdDogbGVmdCAvIHNlbGVjdGVkUmVjdC53aWR0aCxcbiAgICAgICAgICAgIHRvcDogdG9wIC8gc2VsZWN0ZWRSZWN0LmhlaWdodCxcbiAgICAgICAgICAgIHdpZHRoOiAobmV3SW1nUmlnaHQgLSBuZXdJbWdMZWZ0KSAvIHNlbGVjdGVkUmVjdC53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogKG5ld0ltZ0JvdHRvbSAtIG5ld0ltZ1RvcCkgLyBzZWxlY3RlZFJlY3QuaGVpZ2h0XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFzeW5jIGdldERyYXdQYXJhbWV0ZXJzKCkge1xuICAgICAgICBjb25zdCBtaW5XaWR0aCA9IHRoaXMuaGVpZ2h0ICogdGhpcy5hc3BlY3RSYXRpbztcbiAgICAgICAgY29uc3QgbWluSGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IHsgbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tIH0gPSB0aGlzLmdldEltYWdlRXh0ZW50KCk7XG4gICAgICAgIGNvbnN0IHNvdXJjZUV4dGVudCA9IHtcbiAgICAgICAgICAgIGxlZnQ6IGxlZnQgPCAwID8gMCA6IGxlZnQsXG4gICAgICAgICAgICB0b3A6IHRvcCA8IDAgPyAwIDogdG9wLFxuICAgICAgICAgICAgcmlnaHQ6IHJpZ2h0ID4gMSA/IDEgOiByaWdodCxcbiAgICAgICAgICAgIGJvdHRvbTogYm90dG9tID4gMSA/IDEgOiBib3R0b21cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZHJhd0RpbWVuc2lvbnMgPSB0aGlzLmdldERyYXdEaW1lbnNpb25zKCk7XG4gICAgICAgIGNvbnN0IGltYWdlV2lkdGggPSB0aGlzLmltYWdlRWwuY2xpZW50V2lkdGg7XG4gICAgICAgIGNvbnN0IGltYWdlSGVpZ2h0ID0gdGhpcy5pbWFnZUVsLmNsaWVudEhlaWdodDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uWCA9IHNvdXJjZUV4dGVudC5sZWZ0ICogaW1hZ2VXaWR0aDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uWSA9IHNvdXJjZUV4dGVudC50b3AgKiBpbWFnZUhlaWdodDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uV2lkdGggPSBzb3VyY2VFeHRlbnQucmlnaHQgKiBpbWFnZVdpZHRoIC0gc291cmNlRXh0ZW50LmxlZnQgKiBpbWFnZVdpZHRoO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25IZWlnaHQgPSBzb3VyY2VFeHRlbnQuYm90dG9tICogaW1hZ2VIZWlnaHQgLSBzb3VyY2VFeHRlbnQudG9wICogaW1hZ2VIZWlnaHQ7XG4gICAgICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gcmlnaHQgKiBpbWFnZVdpZHRoIC0gbGVmdCAqIGltYWdlV2lkdGg7XG4gICAgICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IGJvdHRvbSAqIGltYWdlSGVpZ2h0IC0gdG9wICogaW1hZ2VIZWlnaHQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZWxlY3Rpb25YLFxuICAgICAgICAgICAgc2VsZWN0aW9uWSxcbiAgICAgICAgICAgIHNlbGVjdGlvbldpZHRoLFxuICAgICAgICAgICAgc2VsZWN0aW9uSGVpZ2h0LFxuICAgICAgICAgICAgY2FudmFzV2lkdGgsXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQsXG4gICAgICAgICAgICBtaW5XaWR0aCxcbiAgICAgICAgICAgIG1pbkhlaWdodCxcbiAgICAgICAgICAgIGRyYXdEaW1lbnNpb25zXG4gICAgICAgIH07XG4gICAgfVxuICAgIGhhbmRsZUltYWdlUHJvcGVydGllc0NoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5wcmV2aWV3U3R5bGUgPSB7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IGBzY2FsZSgke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLnNjYWxlfSlgLFxuICAgICAgICAgICAgdG9wOiBgJHt0aGlzLmltYWdlUHJvcGVydGllcy50b3B9cHhgLFxuICAgICAgICAgICAgbGVmdDogYCR7dGhpcy5pbWFnZVByb3BlcnRpZXMubGVmdH1weGAsXG4gICAgICAgICAgICB0cmFuc2Zvcm1PcmlnaW46IGAke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLm9yaWdpbi54fSAke3RoaXMuaW1hZ2VQcm9wZXJ0aWVzLm9yaWdpbi55fWBcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuZmlyc3RJbWFnZVByb3BlcnRpZXNDaGFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RJbWFnZVByb3BlcnRpZXNDaGFuZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnpvb21Ub0ZpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRFZGl0U3RlcEltYWdlQ2hhbmdlZC5lbWl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXBJbWFnZUNoYW5nZWQuZW1pdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgb25XaGVlbDogdGhpcy5oYW5kbGVXaGVlbCB9LCBoKFwiY2FsY2l0ZS1sb2FkZXJcIiwgeyBjbGFzczogXCJlZGl0LXN0ZXBfX2xvYWRlclwiLCBsYWJlbDogXCJcIiwgaGlkZGVuOiAhdGhpcy5pc0xvYWRpbmcgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogYGVkaXQtc3RlcF9fY3JvcC10aHVtYi1jb250YWluZXIgJHt0aGlzLmlzTG9hZGluZyA/IFwiZWRpdC1zdGVwX19jcm9wLXRodW1iLWNvbnRhaW5lci0taGlkZGVuXCIgOiBcIlwifWAsIHN0eWxlOiB0aGlzLnRodW1iQ29udGFpbmVyU3R5bGUgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImVkaXQtc3RlcF9fdHJhbnNsdWNlbnQtY29udGFpbmVyXCIsIHN0eWxlOiB0aGlzLnRyYW5zbHVjZW50Q29udGFpbmVyU3R5bGUsIG9uTW91c2VEb3duOiB0aGlzLmhhbmRsZURyYWdTdGFydCwgb25Ub3VjaFN0YXJ0OiB0aGlzLmhhbmRsZURyYWdTdGFydCwgb25Nb3VzZU1vdmU6IHRoaXMuaGFuZGxlRHJhZywgb25Ub3VjaE1vdmU6IHRoaXMuaGFuZGxlRHJhZywgb25Nb3VzZVVwOiB0aGlzLmhhbmRsZURyYWdFbmQsIG9uVG91Y2hFbmQ6IHRoaXMuaGFuZGxlRHJhZ0VuZCwgb25Nb3VzZU91dDogdGhpcy5oYW5kbGVEcmFnRW5kIH0sIGgoXCJkaXZcIiwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VDb250YWluZXJFbCA9IGVsO1xuICAgICAgICAgICAgfSwgY2xhc3M6IFwiZWRpdC1zdGVwX190cmFuc3BhcmVudC1jb250YWluZXJcIiwgdGFiSW5kZXg6IDAsIHN0eWxlOiB0aGlzLnRyYW5zcGFyZW50Q29udGFpbmVyU3R5bGUsIG9uS2V5RG93bjogdGhpcy5oYW5kbGVJbWFnZUtleWRvd24gfSwgaChcImltZ1wiLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWFnZUVsID0gZWw7XG4gICAgICAgICAgICB9LCBzcmM6IHRoaXMucHJldmlld1NyYywgYWx0OiBcIlwiLCBjbGFzczogYGVkaXQtc3RlcF9fcHJldmlldy1pbWFnZSAke3RoaXMubG9hZGluZ0ltYWdlID8gXCJlZGl0LXN0ZXBfX3ByZXZpZXctaW1hZ2UtLWxvYWRpbmdcIiA6IFwiXCJ9YCwgc3R5bGU6IHRoaXMucHJldmlld1N0eWxlLCBvbkxvYWQ6IHRoaXMuaGFuZGxlSW1hZ2VMb2FkZWQgfSkpKSksIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJlZGl0LXN0ZXBfX3pvb20tY29udHJvbC0taGlkZGVuXCI6IHRoaXMuaXNMb2FkaW5nXG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy56b29tLCBoKFwiY2FsY2l0ZS1zbGlkZXJcIiwgeyBcImFyaWEtbGFiZWxcIjogdGhpcy5zdHJpbmdzLnpvb20sIHNjYWxlOiBcImxcIiwgbWluOiAwLCBtYXg6IDEwMCwgdmFsdWU6ICt0aGlzLnpvb21WYWx1ZSwgb25DYWxjaXRlU2xpZGVySW5wdXQ6IHRoaXMuaGFuZGxlWm9vbUlucHV0LCBtaXJyb3JlZDogZ2V0RWxlbWVudERpcih0aGlzLmVsKSA9PT0gXCJydGxcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sLWxhYmVsXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sLWljb24tc1wiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcImltYWdlXCIsIHNjYWxlOiBcInNcIiB9KSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJlZGl0LXN0ZXBfX3pvb20tY29udHJvbC1sYWJlbC1zcGFjZXJcIiB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImVkaXQtc3RlcF9fem9vbS1jb250cm9sLWljb24tbFwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcImltYWdlXCIsIHNjYWxlOiBcImxcIiB9KSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJpbWFnZVByb3BlcnRpZXNcIjogW1wiaGFuZGxlSW1hZ2VQcm9wZXJ0aWVzQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc0ltYWdlVXBsb2FkRWRpdFN0ZXAuc3R5bGUgPSBhcmNnaXNJbWFnZVVwbG9hZEVkaXRTdGVwQ3NzO1xuXG5jb25zdCBhcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwQ3NzID0gXCIuZmlsZS1zdGVwe3RleHQtYWxpZ246Y2VudGVyfS5maWxlLXN0ZXBfX3VwbG9hZC1pY29ue21hcmdpbi1ib3R0b206MC41cmVtO21hcmdpbi10b3A6MC4yNXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LmZpbGUtc3RlcF9fdXBsb2FkLWljb24gY2FsY2l0ZS1pY29ue3dpZHRoOjRyZW07aGVpZ2h0OjRyZW19LmZpbGUtc3RlcF9fZHJhZy10ZXh0e21hcmdpbi1ib3R0b206MC4yNXJlbTtmb250LXNpemU6MS4yNXJlbX0uZmlsZS1zdGVwX19icm93c2UtYnV0dG9ue21hcmdpbi10b3A6MXJlbX0uZmlsZS1zdGVwX19maWxlLWlucHV0e2Rpc3BsYXk6bm9uZX1cIjtcblxuY29uc3QgQXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcEZpbGVDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBGaWxlQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXBJbnZhbGlkRmlsZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcEludmFsaWRGaWxlXCIsIDcpO1xuICAgICAgICB0aGlzLmhhbmRsZURyYWdPdmVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZURyb3AgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NGaWxlKGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlc1swXSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRmlsZUlucHV0Q2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NGaWxlKGV2ZW50LnRhcmdldC5maWxlc1swXSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaXplRGVzY3JpcHRpb24gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIHJlc2V0RmlsZUlucHV0KCkge1xuICAgICAgICB0aGlzLmZpbGVJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgfVxuICAgIHByb2Nlc3NGaWxlKGZpbGUpIHtcbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1ZhbGlkRmlsZShmaWxlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcEludmFsaWRGaWxlLmVtaXQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSW1hZ2VVcGxvYWRGaWxlU3RlcEZpbGVDaGFuZ2UuZW1pdCh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFVUkw6IGV2ZW50LnRhcmdldC5yZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUgfHwgXCJcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzVmFsaWRGaWxlKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUubmFtZSkgJiYgL1xcLihnaWZ8anBnfGpwZWd8cG5nKSQvaS50ZXN0KGZpbGUubmFtZSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZmlsZS1zdGVwXCIsIFwiYXJpYS1sYWJlbFwiOiB0aGlzLnN0cmluZ3MuZHJhZ0Ryb3AsIG9uRHJhZ092ZXI6IHRoaXMuaGFuZGxlRHJhZ092ZXIsIG9uRHJhZ0VudGVyOiB0aGlzLmhhbmRsZURyYWdPdmVyLCBvbkRyb3A6IHRoaXMuaGFuZGxlRHJvcCB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZmlsZS1zdGVwX191cGxvYWQtaWNvblwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcInVwbG9hZFwiIH0pKSwgaChcImRpdlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZmlsZS1zdGVwX19kcmFnLXRleHRcIiwgXCJhcmlhLWxhYmVsXCI6IHRoaXMuc3RyaW5ncy5kcmFnRHJvcCB9LCB0aGlzLnN0cmluZ3MuZHJhZ0Ryb3ApLCB0aGlzLnNpemVEZXNjcmlwdGlvbiAmJiAoaChcImRpdlwiLCB7IFwiYXJpYS1sYWJlbFwiOiB0aGlzLnNpemVEZXNjcmlwdGlvbiB9LCB0aGlzLnNpemVEZXNjcmlwdGlvbikpLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJmaWxlLXN0ZXBfX2Jyb3dzZS1idXR0b25cIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uU3RhcnQ6IFwiaW1hZ2VcIiwgc2NhbGU6IFwibFwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlSW5wdXQuY2xpY2soKTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5zdHJpbmdzLmJyb3dzZSksIGgoXCJpbnB1dFwiLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlSW5wdXQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUZpbGVJbnB1dENoYW5nZSwgY2xhc3M6IFwiZmlsZS1zdGVwX19maWxlLWlucHV0XCIsIHR5cGU6IFwiZmlsZVwiLCBhY2NlcHQ6IFwiLmpwZywuZ2lmLC5wbmcsLmpwZWdcIiB9KSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0ltYWdlVXBsb2FkRmlsZVN0ZXAuc3R5bGUgPSBhcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNJbWFnZVVwbG9hZCBhcyBhcmNnaXNfaW1hZ2VfdXBsb2FkLCBBcmNnaXNJbWFnZVVwbG9hZEVkaXRTdGVwIGFzIGFyY2dpc19pbWFnZV91cGxvYWRfZWRpdF9zdGVwLCBBcmNnaXNJbWFnZVVwbG9hZEZpbGVTdGVwIGFzIGFyY2dpc19pbWFnZV91cGxvYWRfZmlsZV9zdGVwIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1pbWFnZS11cGxvYWRfMy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9