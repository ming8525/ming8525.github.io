"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-ffbdb6"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-attributes_2.entry.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-attributes_2.entry.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_attributes: () => (/* binding */ ArcgisAttributes),
/* harmony export */   arcgis_attributes_formatting: () => (/* binding */ ArcgisAttributesFormatting)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _previewPopup_2acb9488_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./previewPopup-2acb9488.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/previewPopup-2acb9488.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










const CSS = {
    totalSelectedDiv: "total-selected-div",
    fieldIcons: "field-icons"
};

const FieldIcons = ({ fieldType }) => {
    // key: ids
    if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.oid ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.guid ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.globalId) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "key" });
    }
    // integer
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.integer ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.smallInteger ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.bigInteger) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "integer" });
    }
    // number
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.single ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.double ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.long ||
        fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.number) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "number" });
    }
    // string
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.string) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "string" });
    }
    // date
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.date) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "date-time" });
    }
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "calendar" });
    }
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timestampOffset) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "time-zone" });
    }
    else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "clock" });
    }
    // default string
    else {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "string" });
    }
};

const arcgisAttributesCss = ".total-selected-div{padding:5px}.field-icons{padding:0 var(--arcgis-app-cap-spacing);display:flex;align-items:center}";

const ArcgisAttributes = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.attributesUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "attributesUpdated", 7);
        this.arcgisAttributesDismissedChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAttributesDismissedChange", 7);
        this.internalAttributesUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "internalAttributesUpdated", 7);
        this.closeAttributePopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeAttributePopovers", 7);
        this.listItems = [];
        this.listItemsNodes = [];
        this.layerFieldsMap = new Map();
        this.arcadeExpMap = new Map();
        this.filterLength = 5;
        this.isPopupOpenForCurrentLayer = false;
        this.debouncedAttributeUpdates = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_6__.d)(() => {
            if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.feature) {
                this.layer.popupTemplate = this.popupTemplate.clone();
            }
            else if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.cluster) {
                this.layer.featureReduction.popupTemplate = this.popupTemplate.clone();
            }
            this.attributesUpdated.emit();
        }, 1000);
        // rendor methods
        this.calciteListItem = (field) => (
        // field.fieldName is always unique
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { id: field.fieldName, label: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.b)(field, this.arcadeExpMap), description: `{${field.fieldName}}`, value: field.fieldName, metadata: {
                label: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.b)(field, this.arcadeExpMap),
                fieldName: field.fieldName
            }, onClick: () => this.selectionClick(), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.selectionClick();
                }
            }, ref: (node) => this.listItemsNodes.push(node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "actions-end", class: CSS.fieldIcons }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(FieldIcons, { fieldType: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.a)(field.fieldName, this.layerFieldsMap, this.arcadeExpMap) }))));
        this.mapView = undefined;
        this.layer = undefined;
        this.portal = undefined;
        this.displayPopup = true;
        this.config = undefined;
        this.layerDisplayType = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.feature;
        this.dismissible = false;
        this.hideLayerTitle = false;
        this.calciteFlowProps = false;
        this.reRender = undefined;
        this.totalSelectedFields = undefined;
    }
    // lifecycle methods
    async componentWillLoad() {
        var _a;
        const localeSettings = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = localeSettings[0];
        this.currentLanguage = localeSettings[1];
        this.serviceType = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.c)(this.layer);
        if (this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.feature) {
            const layerType = "type" in this.layer ? this.layer.type : "sublayer";
            const sourceLayer = this.mapView.popup.visible
                ? (_a = this.mapView.popup.selectedFeature) === null || _a === void 0 ? void 0 : _a.sourceLayer
                : undefined;
            this.isPopupOpenForCurrentLayer =
                layerType === "subtype-sublayer"
                    ? (sourceLayer === null || sourceLayer === void 0 ? void 0 : sourceLayer.subtypeCode) === this.layer.subtypeCode &&
                        (sourceLayer === null || sourceLayer === void 0 ? void 0 : sourceLayer.parent.id) === this.layer.parent.id // TODO any + parent
                    : layerType === "sublayer"
                        ? (sourceLayer === null || sourceLayer === void 0 ? void 0 : sourceLayer.id) === this.layer.id &&
                            (sourceLayer === null || sourceLayer === void 0 ? void 0 : sourceLayer.layer.id) === this.layer.layer.id
                        : "id" in this.layer && (sourceLayer === null || sourceLayer === void 0 ? void 0 : sourceLayer.id) === this.layer.id;
            // temp, turn off popupEnabled for MIL
            if (this.serviceType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.s.mapImage && !this.layer.popupTemplate) {
                this.layer.popupEnabled = false;
            }
            // generate default if template is empty
            this.popupTemplate = this.layer.popupTemplate
                ? this.layer.popupTemplate.clone()
                : this.layer.createPopupTemplate();
            // generate master field info
            this.popupTemplate.fieldInfos = [
                ...(await (0,_previewPopup_2acb9488_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.layer, this.popupTemplate))
            ];
        }
        else {
            this.popupTemplate = this.layer.featureReduction.popupTemplate.clone();
        }
    }
    componentDidLoad() {
        this.calciteListNode = this.hostElement.shadowRoot.getElementById("list_Id");
        this.showPreviewPopup(true);
        // MV workflow
        this.setupResizeObserver();
    }
    async componentWillRender() {
        // map for faster access
        this.layerFieldsMap = await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.d)(this.layer);
        this.arcadeExpMap = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.e)(this.popupTemplate);
        this.listItems = [];
        this.popupTemplate.fieldInfos.forEach((field) => {
            var _a;
            // no relationship support for v1
            // imagery layer might have fieldName:undefined ...
            if (((_a = field.fieldName) === null || _a === void 0 ? void 0 : _a.indexOf(_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.f.relationship)) === -1) {
                this.listItems.push(this.calciteListItem(field));
            }
        });
    }
    componentDidUpdate() {
        this.internalAttributesUpdated.emit();
    }
    disconnectedCallback() {
        var _a;
        (_a = this.parentShellObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
    }
    // Public Methods
    async done() {
        this.closeAttributePopovers.emit(true);
        this.showPreviewPopup(false);
    }
    async setFocus() {
        var _a, _b;
        if (this.flowItemNode) {
            (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
        }
        else {
            (_b = this.calciteListNode) === null || _b === void 0 ? void 0 : _b.setFocus();
        }
    }
    // Events
    arcgisAttributesFormattingUpdatedHandler(event) {
        event.stopPropagation();
        this.popupTemplate = event.detail.clone();
        this.reRender = !this.reRender;
    }
    arcgisAttributesFormattingDismissedHandler(event) {
        event.stopPropagation();
        this.closeAttributePopovers.emit(true);
    }
    async closeAttributePopoversHandler(event) {
        if (this.attributeFormatter) {
            document.body.removeChild(this.attributeFormatter);
            this.attributeFormatter = null;
            // clear selected fields boolean
            if (event.detail) {
                const selectedFields = this.calciteListNode.selectedItems;
                for (const fieldItem of selectedFields.values()) {
                    fieldItem.selected = false;
                }
                this.totalSelectedFields = 0;
                // add timeout, otherwise panel takes focus
                // when setting focus on entire list then search box gets focus
                setTimeout(() => this.listItemsNodes[0].setFocus(), 300);
            }
        }
    }
    // update attributes
    internalAttributesUpdatedHandler(event) {
        event.stopPropagation();
        this.debouncedAttributeUpdates();
    }
    calciteChipCloseHandler(event) {
        event.stopPropagation();
        this.closeAttributePopovers.emit(true);
    }
    // private methods and properties
    // open popover
    async selectionClick() {
        // close existing popovers
        this.closeAttributePopovers.emit();
        const selectedFields = [
            ...this.calciteListNode.selectedItems.map((item) => item.value)
        ];
        this.totalSelectedFields = selectedFields.length;
        if (!this.attributeFormatter && selectedFields.length > 0) {
            this.attributeFormatter = document.createElement("arcgis-attributes-formatting");
            this.attributeFormatter.popoverProps = { refElement: this.hostElement, offsetSkidding: 45 };
            this.attributeFormatter.layerDisplayType = this.layerDisplayType;
            this.attributeFormatter.selectedFields = selectedFields;
            this.attributeFormatter.layer = this.layer;
            this.attributeFormatter.popupTemplate = this.popupTemplate.clone();
            document.body.appendChild(this.attributeFormatter);
        }
    }
    showPreviewPopup(show) {
        var _a;
        if (this.displayPopup &&
            this.layerDisplayType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.feature &&
            !this.isPopupOpenForCurrentLayer) {
            if (show && this.layer.popupEnabled && this.layer.popupTemplate) {
                this.previewPopupController = new AbortController();
                (0,_previewPopup_2acb9488_js__WEBPACK_IMPORTED_MODULE_3__.p)(this.mapView, this.layer, this.previewPopupController);
            }
            else {
                (_a = this.previewPopupController) === null || _a === void 0 ? void 0 : _a.abort();
                this.mapView.closePopup();
            }
        }
    }
    // if parent is shell panel. MV workflow.
    setupResizeObserver() {
        var _a;
        const parentShellPanel = (_a = this.hostElement) === null || _a === void 0 ? void 0 : _a.parentElement;
        if ((0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_6__.i)(parentShellPanel.collapsed)) {
            this.parentShellObserver = new ResizeObserver(() => {
                if (parentShellPanel.collapsed) {
                    this.done();
                }
                else {
                    this.showPreviewPopup(true);
                }
            });
            this.parentShellObserver.observe(parentShellPanel);
        }
    }
    displayList() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { id: "list_Id", filterEnabled: this.listItems.length >= this.filterLength ? true : false, filterPlaceholder: this.strings.filterAttributes, selectionMode: "multiple" }, this.totalSelectedFields > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.totalSelectedDiv }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { value: "totalSelectedValue", closable: true }, `${this.totalSelectedFields} ${this.strings.selected}`))) : null, this.listItems));
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { style: this.calciteFlowProps ? {} : { display: "flex", flex: "1 1 auto", overflow: "hidden" } }, this.calciteFlowProps ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.hostElement) }, this.displayList())) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { id: "attributes_flow_Id", dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.hostElement) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: this.strings.attributesHeading, description: !this.hideLayerTitle ? this.layer.title : undefined, closable: this.dismissible, ref: (node) => (this.flowItemNode = node), onCalciteFlowItemClose: (event) => {
                event.stopPropagation();
                this.done();
                this.arcgisAttributesDismissedChange.emit();
            } }, this.displayList())))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisAttributes.style = arcgisAttributesCss;

const dateFormats = [
    "short-date",
    "long-month-day-year",
    "day-short-month-year",
    "long-date",
    "long-month-year",
    "short-month-year",
    "year"
];
const timeFormats = ["short-time", "long-time", "short-time-24", "long-time-24"];
// when time format is "null", showTime not available
const allDatesMap = new Map();
// short-date
allDatesMap.set("short-date", { dateFormat: dateFormats[0], timeFormat: "" });
allDatesMap.set("short-date-short-time", { dateFormat: dateFormats[0], timeFormat: timeFormats[0] });
allDatesMap.set("short-date-long-time", { dateFormat: dateFormats[0], timeFormat: timeFormats[1] });
allDatesMap.set("short-date-short-time-24", { dateFormat: dateFormats[0], timeFormat: timeFormats[2] });
allDatesMap.set("short-date-long-time-24", { dateFormat: dateFormats[0], timeFormat: timeFormats[3] });
// long-month-day-year
allDatesMap.set("long-month-day-year", { dateFormat: dateFormats[1], timeFormat: "" });
allDatesMap.set("long-month-day-year-short-time", { dateFormat: dateFormats[1], timeFormat: timeFormats[0] });
allDatesMap.set("long-month-day-year-long-time", { dateFormat: dateFormats[1], timeFormat: timeFormats[1] });
allDatesMap.set("long-month-day-year-short-time-24", {
    dateFormat: dateFormats[1],
    timeFormat: timeFormats[2]
});
allDatesMap.set("long-month-day-year-long-time-24", { dateFormat: dateFormats[1], timeFormat: timeFormats[3] });
// day-short-month-year
allDatesMap.set("day-short-month-year", { dateFormat: dateFormats[2], timeFormat: "" });
allDatesMap.set("day-short-month-year-short-time", { dateFormat: dateFormats[2], timeFormat: timeFormats[0] });
allDatesMap.set("day-short-month-year-long-time", { dateFormat: dateFormats[2], timeFormat: timeFormats[1] });
allDatesMap.set("day-short-month-year-short-time-24", {
    dateFormat: dateFormats[2],
    timeFormat: timeFormats[2]
});
allDatesMap.set("day-short-month-year-long-time-24", {
    dateFormat: dateFormats[2],
    timeFormat: timeFormats[3]
});
// long-date
allDatesMap.set("long-date", { dateFormat: dateFormats[3], timeFormat: "" });
allDatesMap.set("long-date-short-time", { dateFormat: dateFormats[3], timeFormat: timeFormats[0] });
allDatesMap.set("long-date-long-time", { dateFormat: dateFormats[3], timeFormat: timeFormats[1] });
allDatesMap.set("long-date-short-time-24", { dateFormat: dateFormats[3], timeFormat: timeFormats[2] });
allDatesMap.set("long-date-long-time-24", { dateFormat: dateFormats[3], timeFormat: timeFormats[3] });
// long-month-year
allDatesMap.set("long-month-year", { dateFormat: dateFormats[4], timeFormat: null });
// short-month-year
allDatesMap.set("short-month-year", { dateFormat: dateFormats[5], timeFormat: null });
// year
allDatesMap.set("year", { dateFormat: dateFormats[6], timeFormat: null });
// default
allDatesMap.set("default", { dateFormat: dateFormats[0], timeFormat: timeFormats[2] });

const arcgisAttributesFormattingCss = ".formatting-div{padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing);max-height:60vh}.single-line-label-switch-section{display:flex;margin:0;padding:var(--arcgis-app-cap-spacing-half) 0}.single-line-label-switch-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.single-line-label-switch-switch{flex:0 0 0%;justify-self:flex-end;margin:0}.single-line-label-switch-switch input{display:none}";

const ArcgisAttributesFormatting = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisAttributesFormattingDismissed = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAttributesFormattingDismissed", 7);
        this.arcgisAttributesFormattingUpdated = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisAttributesFormattingUpdated", 7);
        this.displayDate = new Date("December 31, 1969 18:00:00");
        this.layerFieldsMap = new Map();
        this.arcadeExpMap = new Map();
        this.selectedFieldInfoMap = new Map();
        this.hasCommonDataTypes = true;
        this.thousandSeperator = () => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", { class: "single-line-label-switch-section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "single-line-label-switch-label" }, this.strings.show1000Seperator), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { id: "thousandSeperatorSwitch_Id", scale: "s", class: "single-line-label-switch-switch", checked: this.firstSelected.format.digitSeparator ? true : false })));
        this.significantDigits = () => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.significantDigits, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.strings.significantDigits, onCalciteSelectChange: (event) => {
                const select = event.target;
                this.firstSelected.format.places = Number(select.selectedOption.value) || 0;
                this.saveFieldInfo();
            } }, [0, 1, 2, 3, 4, 5, 6, 7, 8].map((x) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: x.toString(), selected: this.firstSelected.format.places === x ? true : false }, `${x} ${this.strings.decimalPlaces}`)))))));
        this.dateFormat = (selectedDateFormat) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.dateFormat, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { id: "dateFormatSelect_Id", label: this.strings.dateFormat, onCalciteSelectChange: () => this.changeDateFormat() }, dateFormats.map((currentDateFormat) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: currentDateFormat, selected: selectedDateFormat === currentDateFormat ? true : false }, this.intl.formatDate(this.displayDate, this.intl.convertDateFormatToIntlOptions(currentDateFormat)))))))));
        this.showTime = (selectedTimeFormat) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", { class: "single-line-label-switch-section", id: "showTime_Id" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "single-line-label-switch-label" }, this.strings.showTime), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { id: "showTimeSwitch_Id", scale: "s", class: "single-line-label-switch-switch", checked: selectedTimeFormat ? true : false })));
        this.timeFormat = (selectedTimeFormat) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", { id: "timeFormat_Id" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.timeFormat, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { id: "timeFormatSelect_Id", label: this.strings.timeFormat, onCalciteSelectChange: () => this.changeDateFormat() }, timeFormats.map((currentTimeFormat) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: currentTimeFormat, selected: selectedTimeFormat === currentTimeFormat ? true : false }, this.getTimeFormatString(currentTimeFormat))))))));
        this.layer = undefined;
        this.layerDisplayType = _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.l.feature;
        this.selectedFields = undefined;
        this.popoverProps = undefined;
        this.popupTemplate = undefined;
        this.isOpen = false;
    }
    // lifecycle methods
    async componentWillLoad() {
        const localeSettings = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = localeSettings[0];
        this.currentLanguage = localeSettings[1];
        const [tempIntl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_7__.l)(["esri/intl"]);
        this.intl = tempIntl;
        // map for faster access
        this.layerFieldsMap = await (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.d)(this.layer);
        this.arcadeExpMap = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.e)(this.popupTemplate);
        // setup selectedFieldInfoMap with all needed info
        this.selectedFields.forEach((fieldName) => {
            this.popupTemplate.fieldInfos.find((templateFieldInfo, idx) => {
                if (templateFieldInfo.fieldName === fieldName) {
                    this.selectedFieldInfoMap.set(fieldName, {
                        index: idx,
                        fieldType: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.a)(fieldName, this.layerFieldsMap, this.arcadeExpMap),
                        fieldInfo: templateFieldInfo
                    });
                }
            });
        });
        // first selected field to drive the options displayed
        this.firstSelected = this.selectedFieldInfoMap.get(this.selectedFields[0]).fieldInfo;
        this.firstSelectedFieldType = this.selectedFieldInfoMap.get(this.selectedFields[0]).fieldType;
        this.hasCommonDataTypes = this.commonDataTypesCheck(this.firstSelectedFieldType);
        // setup default only for 1st. Rest will be copied on save
        if (!this.firstSelected.format && this.hasCommonDataTypes) {
            await this.setupDefaultFormat(this.firstSelected, this.firstSelectedFieldType);
        }
    }
    componentDidLoad() {
        this.hostElement.shadowRoot.getElementById("managePopover_Id")["reposition"]();
        if (this.aliasInput) {
            this.aliasInput.focus();
        }
        this.setupDateTimeDisplay();
        this.isOpen = true;
        // need timeout because of re-render
        setTimeout(() => requestAnimationFrame(() => {
            this.panelElement.setFocus();
        }), 300);
    }
    // Public Methods
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    async setFocus() {
        setTimeout(() => this.panelElement.setFocus(), 100);
    }
    // Events
    calciteSwitchChangeHandler(event) {
        event.stopPropagation();
        if (this.firstSelected.format) {
            if (this.firstSelectedFieldType === "date" ||
                this.firstSelectedFieldType === "timestamp-offset") {
                this.changeDateFormat();
            }
            // numbers
            else {
                this.firstSelected.format.digitSeparator = this.hostElement.shadowRoot.getElementById("thousandSeperatorSwitch_Id").checked
                    ? true
                    : false;
                this.saveFieldInfo();
            }
        }
    }
    // private methods and properties
    commonDataTypesCheck(fieldType) {
        for (let x = 1; x < this.selectedFields.length; x++) {
            const tempFieldType = this.selectedFieldInfoMap.get(this.selectedFields[x]).fieldType;
            if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.integer ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.smallInteger ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.bigInteger) {
                if ([
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.integer,
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.smallInteger,
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.bigInteger
                ].indexOf(tempFieldType) === -1) {
                    return false;
                }
            }
            else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.single ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.double ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.long ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.number) {
                if ([
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.single,
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.double,
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.long,
                    _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.number
                ].indexOf(tempFieldType) === -1) {
                    return false;
                }
            }
            else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.date ||
                fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timestampOffset) {
                if ([_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.date, _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timestampOffset].indexOf(tempFieldType) === -1) {
                    return false;
                }
            }
            else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly) {
                if ([_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly].indexOf(tempFieldType) === -1) {
                    return false;
                }
            }
            else if (fieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly) {
                if ([_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly].indexOf(tempFieldType) === -1) {
                    return false;
                }
            }
        }
        return true;
    }
    async setupDefaultFormat(currentField, currentFieldType) {
        const [FieldInfoFormat] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_7__.l)([
            "esri/popup/support/FieldInfoFormat"
        ]);
        if (currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.integer ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.smallInteger ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.bigInteger) {
            currentField.format = new FieldInfoFormat({ digitSeparator: false });
            this.saveFieldInfo();
        }
        else if (currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.single ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.double ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.long ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.number) {
            currentField.format = new FieldInfoFormat({
                digitSeparator: false,
                places: 2
            });
            this.saveFieldInfo();
        }
        // date
        else if ((currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.date ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly ||
            currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timestampOffset) &&
            this.dateFormattingAvailable()) {
            if (currentFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly) {
                currentField.format = new FieldInfoFormat({
                    dateFormat: "short-date"
                });
            }
            else {
                currentField.format = new FieldInfoFormat({
                    dateFormat: "short-date-short-time" // used to be "default"
                });
            }
            this.saveFieldInfo();
        }
    }
    setupDateTimeDisplay() {
        var _a;
        if ((this.firstSelectedFieldType === "date" ||
            this.firstSelectedFieldType === "time-only" ||
            this.firstSelectedFieldType === "timestamp-offset") &&
            ((_a = this.firstSelected.format) === null || _a === void 0 ? void 0 : _a.dateFormat) &&
            this.hasCommonDataTypes) {
            const showTimeId = this.hostElement.shadowRoot.getElementById("showTime_Id");
            const showTimeSwitchId = this.hostElement.shadowRoot.getElementById("showTimeSwitch_Id");
            const timeFormatId = this.hostElement.shadowRoot.getElementById("timeFormat_Id");
            const tempMap = allDatesMap.get(this.firstSelected.format.dateFormat);
            if (this.firstSelectedFieldType === "date" ||
                this.firstSelectedFieldType === "timestamp-offset") {
                if (tempMap.timeFormat === "") {
                    showTimeId.style.display = "flex";
                    showTimeSwitchId.checked = false;
                    timeFormatId.style.display = "none";
                }
                else if (tempMap.timeFormat === null) {
                    showTimeId.style.display = "none";
                    showTimeSwitchId.checked = false;
                    timeFormatId.style.display = "none";
                }
                else {
                    showTimeId.style.display = "flex";
                    showTimeSwitchId.checked = true;
                    timeFormatId.style.display = "block";
                }
            }
            else if (this.firstSelectedFieldType === "time-only") {
                timeFormatId.style.display = "block";
            }
        }
    }
    getTimeFormatString(currentTimeFormat) {
        if (currentTimeFormat === timeFormats[0]) {
            return this.strings.shortTime;
        }
        else if (currentTimeFormat === timeFormats[1]) {
            return this.strings.longTime;
        }
        else if (currentTimeFormat === timeFormats[2]) {
            return this.strings.shortTime24;
        }
        else if (currentTimeFormat === timeFormats[3]) {
            return this.strings.longTime24;
        }
        else {
            return this.strings.shortTime24;
        }
    }
    changeAlias() {
        // default field name
        if (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.i)(this.aliasInput.value)) {
            this.aliasInput.value = this.firstSelected.fieldName;
        }
        if (this.arcadeExpMap.has(this.firstSelected.fieldName)) {
            this.arcadeExpMap.get(this.firstSelected.fieldName).title = this.aliasInput.value;
        }
        else {
            this.firstSelected.label = this.aliasInput.value;
        }
        this.saveFieldInfo();
    }
    changeDateFormat() {
        const tempSelectDate = this.hostElement.shadowRoot.getElementById("dateFormatSelect_Id");
        const tempSelectTime = this.hostElement.shadowRoot.getElementById("timeFormatSelect_Id");
        const showTimeSwitchId = this.hostElement.shadowRoot.getElementById("showTimeSwitch_Id");
        if (this.firstSelectedFieldType === "date" ||
            this.firstSelectedFieldType === "timestamp-offset") {
            const tempDateMap = allDatesMap.get(tempSelectDate.selectedOption.value);
            if (tempDateMap.timeFormat === "") {
                this.firstSelected.format.dateFormat = showTimeSwitchId.checked
                    ? `${tempSelectDate.selectedOption.value}-${tempSelectTime.selectedOption.value}`
                    : `${tempSelectDate.selectedOption.value}`;
            }
            else if (tempDateMap.timeFormat === null) {
                this.firstSelected.format.dateFormat = `${tempSelectDate.selectedOption.value}`;
            }
        }
        else if (this.firstSelectedFieldType === "date-only") {
            this.firstSelected.format.dateFormat = `${tempSelectDate.selectedOption.value}`;
        }
        else if (this.firstSelectedFieldType === "time-only") {
            this.firstSelected.format.dateFormat = `short-date-${tempSelectTime.selectedOption.value}`;
        }
        this.saveFieldInfo();
        this.setupDateTimeDisplay();
        this.hostElement.shadowRoot.getElementById("managePopover_Id")["reposition"]();
    }
    saveFieldInfo() {
        var _a;
        // hasCommonDataTypes always true when something can be changed
        if (this.hasCommonDataTypes) {
            this.selectedFieldInfoMap.forEach((value) => {
                if (value.fieldInfo.fieldName === this.firstSelected.fieldName) {
                    value.fieldInfo = this.firstSelected.clone();
                }
                else {
                    value.fieldInfo.format = this.firstSelected.format.clone();
                }
            });
            // for arcade, also clone to popupTemplate.expressionInfos(for title)
            // only valid for title update use case
            if (this.selectedFields.length === 1 && this.arcadeExpMap.has(this.firstSelected.fieldName)) {
                if ((_a = this.popupTemplate) === null || _a === void 0 ? void 0 : _a.expressionInfos) {
                    this.popupTemplate.expressionInfos.find((arcadeField, index) => {
                        if (`${_commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.f.expression}${arcadeField.name}` ===
                            this.firstSelected.fieldName) {
                            return (this.popupTemplate.expressionInfos[index] = this.arcadeExpMap
                                .get(this.firstSelected.fieldName)
                                .clone());
                        }
                    });
                }
            }
            // clone/change in fieldinfo
            this.selectedFieldInfoMap.forEach((value) => {
                this.popupTemplate.fieldInfos[value.index] = value.fieldInfo.clone();
            });
            // clone/change in content
            if (Array.isArray(this.popupTemplate.content)) {
                this.popupTemplate.content.forEach((content) => {
                    if (content.type === "fields" && content.fieldInfos) {
                        content.fieldInfos.forEach((contentField, index) => {
                            if (this.selectedFieldInfoMap.has(contentField.fieldName)) {
                                const tempField = this.selectedFieldInfoMap
                                    .get(contentField.fieldName)
                                    .fieldInfo.clone();
                                tempField.visible = true;
                                content.fieldInfos[index] = tempField;
                            }
                        });
                    }
                });
            }
            this.arcgisAttributesFormattingUpdated.emit(this.popupTemplate.clone());
        }
    }
    // rendor methods
    formattingOptions() {
        if (this.firstSelected.format) {
            if (this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.integer ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.smallInteger ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.bigInteger) {
                return this.thousandSeperator();
            }
            // number
            else if (this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.single ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.double ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.long ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.number) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.significantDigits(), this.thousandSeperator()));
            }
            // date
            else if ((this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.date ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly ||
                this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timestampOffset) &&
                this.dateFormattingAvailable()) {
                const tempMap = allDatesMap.has(this.firstSelected.format.dateFormat)
                    ? allDatesMap.get(this.firstSelected.format.dateFormat)
                    : this.firstSelectedFieldType === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly
                        ? allDatesMap.get("short-date")
                        : allDatesMap.get("short-date-short-time"); // used to be "default"
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.firstSelectedFieldType !== _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly &&
                    this.dateFormat(tempMap.dateFormat), this.firstSelectedFieldType !== _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.timeOnly &&
                    this.firstSelectedFieldType !== _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly &&
                    this.showTime(tempMap.timeFormat), this.firstSelectedFieldType !== _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.a.dateOnly &&
                    this.timeFormat(tempMap.timeFormat)));
            }
            // default string
            else {
                return null;
            }
        }
        else {
            return null;
        }
    }
    dateFormattingAvailable() {
        return (!((0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_4__.c)(this.layer) === _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_2__.s.scene) ||
            this.layer.associatedLayer != null);
    }
    render() {
        const doneBtn = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", scale: "m", slot: "footer", width: "full", onClick: () => this.arcgisAttributesFormattingDismissed.emit("done") }, this.strings.done));
        const aliasDiv = ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.displayName, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", ref: (element) => {
                this.aliasInput = element;
            }, value: this.arcadeExpMap.has(this.firstSelected.fieldName)
                ? this.arcadeExpMap.get(this.firstSelected.fieldName).title
                : this.firstSelected.label, onCalciteInputInput: () => this.changeAlias() })));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { dir: (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__.g)(this.hostElement), id: "managePopover_Id", placement: this.popoverProps.placement || "leading-start", open: this.isOpen, pointerDisabled: true, referenceElement: this.popoverProps.refElement, offsetDistance: this.popoverProps.offsetDistance || 0, offsetSkidding: this.popoverProps.offsetSkidding || 0, label: "", style: {
                zIndex: "100"
            }, ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { ref: (el) => (this.panelElement = el), closable: true, style: {
                width: `${this.popoverProps.popoverWidth ||
                    this.popoverProps.refElement.getBoundingClientRect().width}px`
            }, onCalcitePanelClose: () => this.arcgisAttributesFormattingDismissed.emit() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content" }, this.strings.formatting), doneBtn, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "formatting-div" }, this.selectedFields.length === 1 ? (aliasDiv) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", null, `${this.strings.multipleSelection} (${this.selectedFields.length})`)), this.hasCommonDataTypes ? (this.formattingOptions()) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", null, this.strings.selectCommon)))))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisAttributesFormatting.style = arcgisAttributesFormattingCss;



//# sourceMappingURL=arcgis-attributes_2.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWZmYmRiNi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ3FFO0FBQzlDO0FBQ3FHO0FBQ2xJO0FBQ1M7QUFDWjtBQUNsQzs7QUFFM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsc0JBQXNCLFdBQVc7QUFDakM7QUFDQSxzQkFBc0IsdURBQWM7QUFDcEMsc0JBQXNCLHVEQUFjO0FBQ3BDLHNCQUFzQix1REFBYztBQUNwQyxlQUFlLHFEQUFDLG1CQUFtQix5QkFBeUI7QUFDNUQ7QUFDQTtBQUNBLDJCQUEyQix1REFBYztBQUN6QyxzQkFBc0IsdURBQWM7QUFDcEMsc0JBQXNCLHVEQUFjO0FBQ3BDLGVBQWUscURBQUMsbUJBQW1CLDZCQUE2QjtBQUNoRTtBQUNBO0FBQ0EsMkJBQTJCLHVEQUFjO0FBQ3pDLHNCQUFzQix1REFBYztBQUNwQyxzQkFBc0IsdURBQWM7QUFDcEMsc0JBQXNCLHVEQUFjO0FBQ3BDLGVBQWUscURBQUMsbUJBQW1CLDRCQUE0QjtBQUMvRDtBQUNBO0FBQ0EsMkJBQTJCLHVEQUFjO0FBQ3pDLGVBQWUscURBQUMsbUJBQW1CLDRCQUE0QjtBQUMvRDtBQUNBO0FBQ0EsMkJBQTJCLHVEQUFjO0FBQ3pDLGVBQWUscURBQUMsbUJBQW1CLCtCQUErQjtBQUNsRTtBQUNBLDJCQUEyQix1REFBYztBQUN6QyxlQUFlLHFEQUFDLG1CQUFtQiw4QkFBOEI7QUFDakU7QUFDQSwyQkFBMkIsdURBQWM7QUFDekMsZUFBZSxxREFBQyxtQkFBbUIsK0JBQStCO0FBQ2xFO0FBQ0EsMkJBQTJCLHVEQUFjO0FBQ3pDLGVBQWUscURBQUMsbUJBQW1CLDJCQUEyQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQSxlQUFlLHFEQUFDLG1CQUFtQiw0QkFBNEI7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QUFDLFVBQVUseUJBQXlCLG1EQUFtRCxxREFBQyxnQkFBZ0IsZ0NBQWdDLEdBQUcsMkJBQTJCLDhEQUE4RCxxREFBQztBQUMxWTtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRTZHOztBQUU3RyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1hdHRyaWJ1dGVzXzIuZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBoLCByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBhIGFzIGZpZWxkVHlwZXNFbnVtLCBsIGFzIGxheWVyRGlzcGxheVR5cGVFbnVtLCBzIGFzIHNlcnZpY2VUeXBlRW51bSwgZiBhcyBmaWVsZEluZm9QcmVmaXhFbnVtIH0gZnJvbSAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdlbmVyYXRlTWFzdGVyRmllbGRJbmZvLCBwIGFzIHByZXZpZXdQb3B1cCB9IGZyb20gJy4vcHJldmlld1BvcHVwLTJhY2I5NDg4LmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0RmllbGRUeXBlLCBiIGFzIGdldEZpZWxkRGlzcGxheU5hbWUsIGMgYXMgZ2V0U2VydmljZVR5cGUsIGQgYXMgZ2VuZXJhdGVMYXllckZpZWxkc01hcCwgZSBhcyBnZW5lcmF0ZUFyY2FkZUV4cHJlc3Npb25NYXAsIGkgYXMgaXNEZWZpbmVkJDEgfSBmcm9tICcuL2NvbW1vbkZ1bmN0aW9ucy1iMDgzMGU5ZS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEVsZW1lbnREaXIgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlYm91bmNlLCBpIGFzIGlzRGVmaW5lZCB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgQ1NTID0ge1xuICAgIHRvdGFsU2VsZWN0ZWREaXY6IFwidG90YWwtc2VsZWN0ZWQtZGl2XCIsXG4gICAgZmllbGRJY29uczogXCJmaWVsZC1pY29uc1wiXG59O1xuXG5jb25zdCBGaWVsZEljb25zID0gKHsgZmllbGRUeXBlIH0pID0+IHtcbiAgICAvLyBrZXk6IGlkc1xuICAgIGlmIChmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLm9pZCB8fFxuICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmd1aWQgfHxcbiAgICAgICAgZmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5nbG9iYWxJZCkge1xuICAgICAgICByZXR1cm4gaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJrZXlcIiB9KTtcbiAgICB9XG4gICAgLy8gaW50ZWdlclxuICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uaW50ZWdlciB8fFxuICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnNtYWxsSW50ZWdlciB8fFxuICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmJpZ0ludGVnZXIpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwiaW50ZWdlclwiIH0pO1xuICAgIH1cbiAgICAvLyBudW1iZXJcbiAgICBlbHNlIGlmIChmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnNpbmdsZSB8fFxuICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmRvdWJsZSB8fFxuICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmxvbmcgfHxcbiAgICAgICAgZmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5udW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJzXCIsIGljb246IFwibnVtYmVyXCIgfSk7XG4gICAgfVxuICAgIC8vIHN0cmluZ1xuICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcInN0cmluZ1wiIH0pO1xuICAgIH1cbiAgICAvLyBkYXRlXG4gICAgZWxzZSBpZiAoZmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5kYXRlKSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImRhdGUtdGltZVwiIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmRhdGVPbmx5KSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNhbGVuZGFyXCIgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0udGltZXN0YW1wT2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcInRpbWUtem9uZVwiIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnRpbWVPbmx5KSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcImNsb2NrXCIgfSk7XG4gICAgfVxuICAgIC8vIGRlZmF1bHQgc3RyaW5nXG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBpY29uOiBcInN0cmluZ1wiIH0pO1xuICAgIH1cbn07XG5cbmNvbnN0IGFyY2dpc0F0dHJpYnV0ZXNDc3MgPSBcIi50b3RhbC1zZWxlY3RlZC1kaXZ7cGFkZGluZzo1cHh9LmZpZWxkLWljb25ze3BhZGRpbmc6MCB2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nKTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyfVwiO1xuXG5jb25zdCBBcmNnaXNBdHRyaWJ1dGVzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzVXBkYXRlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXR0cmlidXRlc1VwZGF0ZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzQXR0cmlidXRlc0Rpc21pc3NlZENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQXR0cmlidXRlc0Rpc21pc3NlZENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5pbnRlcm5hbEF0dHJpYnV0ZXNVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJpbnRlcm5hbEF0dHJpYnV0ZXNVcGRhdGVkXCIsIDcpO1xuICAgICAgICB0aGlzLmNsb3NlQXR0cmlidXRlUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlQXR0cmlidXRlUG9wb3ZlcnNcIiwgNyk7XG4gICAgICAgIHRoaXMubGlzdEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMubGlzdEl0ZW1zTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sYXllckZpZWxkc01hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5hcmNhZGVFeHBNYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuZmlsdGVyTGVuZ3RoID0gNTtcbiAgICAgICAgdGhpcy5pc1BvcHVwT3BlbkZvckN1cnJlbnRMYXllciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRlYm91bmNlZEF0dHJpYnV0ZVVwZGF0ZXMgPSBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXllci5wb3B1cFRlbXBsYXRlID0gdGhpcy5wb3B1cFRlbXBsYXRlLmNsb25lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmxheWVyRGlzcGxheVR5cGUgPT09IGxheWVyRGlzcGxheVR5cGVFbnVtLmNsdXN0ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ucG9wdXBUZW1wbGF0ZSA9IHRoaXMucG9wdXBUZW1wbGF0ZS5jbG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzVXBkYXRlZC5lbWl0KCk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgICAvLyByZW5kb3IgbWV0aG9kc1xuICAgICAgICB0aGlzLmNhbGNpdGVMaXN0SXRlbSA9IChmaWVsZCkgPT4gKFxuICAgICAgICAvLyBmaWVsZC5maWVsZE5hbWUgaXMgYWx3YXlzIHVuaXF1ZVxuICAgICAgICBoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBpZDogZmllbGQuZmllbGROYW1lLCBsYWJlbDogZ2V0RmllbGREaXNwbGF5TmFtZShmaWVsZCwgdGhpcy5hcmNhZGVFeHBNYXApLCBkZXNjcmlwdGlvbjogYHske2ZpZWxkLmZpZWxkTmFtZX19YCwgdmFsdWU6IGZpZWxkLmZpZWxkTmFtZSwgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogZ2V0RmllbGREaXNwbGF5TmFtZShmaWVsZCwgdGhpcy5hcmNhZGVFeHBNYXApLFxuICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQuZmllbGROYW1lXG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB0aGlzLnNlbGVjdGlvbkNsaWNrKCksIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uQ2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiB0aGlzLmxpc3RJdGVtc05vZGVzLnB1c2gobm9kZSkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiYWN0aW9ucy1lbmRcIiwgY2xhc3M6IENTUy5maWVsZEljb25zIH0sIGgoRmllbGRJY29ucywgeyBmaWVsZFR5cGU6IGdldEZpZWxkVHlwZShmaWVsZC5maWVsZE5hbWUsIHRoaXMubGF5ZXJGaWVsZHNNYXAsIHRoaXMuYXJjYWRlRXhwTWFwKSB9KSkpKTtcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kaXNwbGF5UG9wdXAgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZTtcbiAgICAgICAgdGhpcy5kaXNtaXNzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhpZGVMYXllclRpdGxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FsY2l0ZUZsb3dQcm9wcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRvdGFsU2VsZWN0ZWRGaWVsZHMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vIGxpZmVjeWNsZSBtZXRob2RzXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbG9jYWxlU2V0dGluZ3MgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVTZXR0aW5nc1swXTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2UgPSBsb2NhbGVTZXR0aW5nc1sxXTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZSA9IGdldFNlcnZpY2VUeXBlKHRoaXMubGF5ZXIpO1xuICAgICAgICBpZiAodGhpcy5sYXllckRpc3BsYXlUeXBlID09PSBsYXllckRpc3BsYXlUeXBlRW51bS5mZWF0dXJlKSB7XG4gICAgICAgICAgICBjb25zdCBsYXllclR5cGUgPSBcInR5cGVcIiBpbiB0aGlzLmxheWVyID8gdGhpcy5sYXllci50eXBlIDogXCJzdWJsYXllclwiO1xuICAgICAgICAgICAgY29uc3Qgc291cmNlTGF5ZXIgPSB0aGlzLm1hcFZpZXcucG9wdXAudmlzaWJsZVxuICAgICAgICAgICAgICAgID8gKF9hID0gdGhpcy5tYXBWaWV3LnBvcHVwLnNlbGVjdGVkRmVhdHVyZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNvdXJjZUxheWVyXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmlzUG9wdXBPcGVuRm9yQ3VycmVudExheWVyID1cbiAgICAgICAgICAgICAgICBsYXllclR5cGUgPT09IFwic3VidHlwZS1zdWJsYXllclwiXG4gICAgICAgICAgICAgICAgICAgID8gKHNvdXJjZUxheWVyID09PSBudWxsIHx8IHNvdXJjZUxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzb3VyY2VMYXllci5zdWJ0eXBlQ29kZSkgPT09IHRoaXMubGF5ZXIuc3VidHlwZUNvZGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChzb3VyY2VMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlTGF5ZXIucGFyZW50LmlkKSA9PT0gdGhpcy5sYXllci5wYXJlbnQuaWQgLy8gVE9ETyBhbnkgKyBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgOiBsYXllclR5cGUgPT09IFwic3VibGF5ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyAoc291cmNlTGF5ZXIgPT09IG51bGwgfHwgc291cmNlTGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNvdXJjZUxheWVyLmlkKSA9PT0gdGhpcy5sYXllci5pZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzb3VyY2VMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlTGF5ZXIubGF5ZXIuaWQpID09PSB0aGlzLmxheWVyLmxheWVyLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFwiaWRcIiBpbiB0aGlzLmxheWVyICYmIChzb3VyY2VMYXllciA9PT0gbnVsbCB8fCBzb3VyY2VMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlTGF5ZXIuaWQpID09PSB0aGlzLmxheWVyLmlkO1xuICAgICAgICAgICAgLy8gdGVtcCwgdHVybiBvZmYgcG9wdXBFbmFibGVkIGZvciBNSUxcbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VUeXBlID09PSBzZXJ2aWNlVHlwZUVudW0ubWFwSW1hZ2UgJiYgIXRoaXMubGF5ZXIucG9wdXBUZW1wbGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXIucG9wdXBFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBnZW5lcmF0ZSBkZWZhdWx0IGlmIHRlbXBsYXRlIGlzIGVtcHR5XG4gICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUgPSB0aGlzLmxheWVyLnBvcHVwVGVtcGxhdGVcbiAgICAgICAgICAgICAgICA/IHRoaXMubGF5ZXIucG9wdXBUZW1wbGF0ZS5jbG9uZSgpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmxheWVyLmNyZWF0ZVBvcHVwVGVtcGxhdGUoKTtcbiAgICAgICAgICAgIC8vIGdlbmVyYXRlIG1hc3RlciBmaWVsZCBpbmZvXG4gICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcyA9IFtcbiAgICAgICAgICAgICAgICAuLi4oYXdhaXQgZ2VuZXJhdGVNYXN0ZXJGaWVsZEluZm8odGhpcy5sYXllciwgdGhpcy5wb3B1cFRlbXBsYXRlKSlcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUgPSB0aGlzLmxheWVyLmZlYXR1cmVSZWR1Y3Rpb24ucG9wdXBUZW1wbGF0ZS5jbG9uZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuY2FsY2l0ZUxpc3ROb2RlID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwibGlzdF9JZFwiKTtcbiAgICAgICAgdGhpcy5zaG93UHJldmlld1BvcHVwKHRydWUpO1xuICAgICAgICAvLyBNViB3b3JrZmxvd1xuICAgICAgICB0aGlzLnNldHVwUmVzaXplT2JzZXJ2ZXIoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbFJlbmRlcigpIHtcbiAgICAgICAgLy8gbWFwIGZvciBmYXN0ZXIgYWNjZXNzXG4gICAgICAgIHRoaXMubGF5ZXJGaWVsZHNNYXAgPSBhd2FpdCBnZW5lcmF0ZUxheWVyRmllbGRzTWFwKHRoaXMubGF5ZXIpO1xuICAgICAgICB0aGlzLmFyY2FkZUV4cE1hcCA9IGdlbmVyYXRlQXJjYWRlRXhwcmVzc2lvbk1hcCh0aGlzLnBvcHVwVGVtcGxhdGUpO1xuICAgICAgICB0aGlzLmxpc3RJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgLy8gbm8gcmVsYXRpb25zaGlwIHN1cHBvcnQgZm9yIHYxXG4gICAgICAgICAgICAvLyBpbWFnZXJ5IGxheWVyIG1pZ2h0IGhhdmUgZmllbGROYW1lOnVuZGVmaW5lZCAuLi5cbiAgICAgICAgICAgIGlmICgoKF9hID0gZmllbGQuZmllbGROYW1lKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihmaWVsZEluZm9QcmVmaXhFbnVtLnJlbGF0aW9uc2hpcCkpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdEl0ZW1zLnB1c2godGhpcy5jYWxjaXRlTGlzdEl0ZW0oZmllbGQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbEF0dHJpYnV0ZXNVcGRhdGVkLmVtaXQoKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5wYXJlbnRTaGVsbE9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICAvLyBQdWJsaWMgTWV0aG9kc1xuICAgIGFzeW5jIGRvbmUoKSB7XG4gICAgICAgIHRoaXMuY2xvc2VBdHRyaWJ1dGVQb3BvdmVycy5lbWl0KHRydWUpO1xuICAgICAgICB0aGlzLnNob3dQcmV2aWV3UG9wdXAoZmFsc2UpO1xuICAgIH1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKHRoaXMuZmxvd0l0ZW1Ob2RlKSB7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAoX2IgPSB0aGlzLmNhbGNpdGVMaXN0Tm9kZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRXZlbnRzXG4gICAgYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdVcGRhdGVkSGFuZGxlcihldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5wb3B1cFRlbXBsYXRlID0gZXZlbnQuZGV0YWlsLmNsb25lKCk7XG4gICAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICB9XG4gICAgYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdEaXNtaXNzZWRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmNsb3NlQXR0cmlidXRlUG9wb3ZlcnMuZW1pdCh0cnVlKTtcbiAgICB9XG4gICAgYXN5bmMgY2xvc2VBdHRyaWJ1dGVQb3BvdmVyc0hhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyKTtcbiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyID0gbnVsbDtcbiAgICAgICAgICAgIC8vIGNsZWFyIHNlbGVjdGVkIGZpZWxkcyBib29sZWFuXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZHMgPSB0aGlzLmNhbGNpdGVMaXN0Tm9kZS5zZWxlY3RlZEl0ZW1zO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmllbGRJdGVtIG9mIHNlbGVjdGVkRmllbGRzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsU2VsZWN0ZWRGaWVsZHMgPSAwO1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0aW1lb3V0LCBvdGhlcndpc2UgcGFuZWwgdGFrZXMgZm9jdXNcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHNldHRpbmcgZm9jdXMgb24gZW50aXJlIGxpc3QgdGhlbiBzZWFyY2ggYm94IGdldHMgZm9jdXNcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMubGlzdEl0ZW1zTm9kZXNbMF0uc2V0Rm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyB1cGRhdGUgYXR0cmlidXRlc1xuICAgIGludGVybmFsQXR0cmlidXRlc1VwZGF0ZWRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmRlYm91bmNlZEF0dHJpYnV0ZVVwZGF0ZXMoKTtcbiAgICB9XG4gICAgY2FsY2l0ZUNoaXBDbG9zZUhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuY2xvc2VBdHRyaWJ1dGVQb3BvdmVycy5lbWl0KHRydWUpO1xuICAgIH1cbiAgICAvLyBwcml2YXRlIG1ldGhvZHMgYW5kIHByb3BlcnRpZXNcbiAgICAvLyBvcGVuIHBvcG92ZXJcbiAgICBhc3luYyBzZWxlY3Rpb25DbGljaygpIHtcbiAgICAgICAgLy8gY2xvc2UgZXhpc3RpbmcgcG9wb3ZlcnNcbiAgICAgICAgdGhpcy5jbG9zZUF0dHJpYnV0ZVBvcG92ZXJzLmVtaXQoKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZHMgPSBbXG4gICAgICAgICAgICAuLi50aGlzLmNhbGNpdGVMaXN0Tm9kZS5zZWxlY3RlZEl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSlcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy50b3RhbFNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHMubGVuZ3RoO1xuICAgICAgICBpZiAoIXRoaXMuYXR0cmlidXRlRm9ybWF0dGVyICYmIHNlbGVjdGVkRmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1hdHRyaWJ1dGVzLWZvcm1hdHRpbmdcIik7XG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZUZvcm1hdHRlci5wb3BvdmVyUHJvcHMgPSB7IHJlZkVsZW1lbnQ6IHRoaXMuaG9zdEVsZW1lbnQsIG9mZnNldFNraWRkaW5nOiA0NSB9O1xuICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVGb3JtYXR0ZXIubGF5ZXJEaXNwbGF5VHlwZSA9IHRoaXMubGF5ZXJEaXNwbGF5VHlwZTtcbiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyLnNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHM7XG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZUZvcm1hdHRlci5sYXllciA9IHRoaXMubGF5ZXI7XG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZUZvcm1hdHRlci5wb3B1cFRlbXBsYXRlID0gdGhpcy5wb3B1cFRlbXBsYXRlLmNsb25lKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYXR0cmlidXRlRm9ybWF0dGVyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG93UHJldmlld1BvcHVwKHNob3cpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAodGhpcy5kaXNwbGF5UG9wdXAgJiZcbiAgICAgICAgICAgIHRoaXMubGF5ZXJEaXNwbGF5VHlwZSA9PT0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZSAmJlxuICAgICAgICAgICAgIXRoaXMuaXNQb3B1cE9wZW5Gb3JDdXJyZW50TGF5ZXIpIHtcbiAgICAgICAgICAgIGlmIChzaG93ICYmIHRoaXMubGF5ZXIucG9wdXBFbmFibGVkICYmIHRoaXMubGF5ZXIucG9wdXBUZW1wbGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJldmlld1BvcHVwQ29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgICAgICBwcmV2aWV3UG9wdXAodGhpcy5tYXBWaWV3LCB0aGlzLmxheWVyLCB0aGlzLnByZXZpZXdQb3B1cENvbnRyb2xsZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgKF9hID0gdGhpcy5wcmV2aWV3UG9wdXBDb250cm9sbGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXcuY2xvc2VQb3B1cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGlmIHBhcmVudCBpcyBzaGVsbCBwYW5lbC4gTVYgd29ya2Zsb3cuXG4gICAgc2V0dXBSZXNpemVPYnNlcnZlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBwYXJlbnRTaGVsbFBhbmVsID0gKF9hID0gdGhpcy5ob3N0RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGlmIChpc0RlZmluZWQocGFyZW50U2hlbGxQYW5lbC5jb2xsYXBzZWQpKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNoZWxsT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnRTaGVsbFBhbmVsLmNvbGxhcHNlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1ByZXZpZXdQb3B1cCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2hlbGxPYnNlcnZlci5vYnNlcnZlKHBhcmVudFNoZWxsUGFuZWwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRpc3BsYXlMaXN0KCkge1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBpZDogXCJsaXN0X0lkXCIsIGZpbHRlckVuYWJsZWQ6IHRoaXMubGlzdEl0ZW1zLmxlbmd0aCA+PSB0aGlzLmZpbHRlckxlbmd0aCA/IHRydWUgOiBmYWxzZSwgZmlsdGVyUGxhY2Vob2xkZXI6IHRoaXMuc3RyaW5ncy5maWx0ZXJBdHRyaWJ1dGVzLCBzZWxlY3Rpb25Nb2RlOiBcIm11bHRpcGxlXCIgfSwgdGhpcy50b3RhbFNlbGVjdGVkRmllbGRzID4gMCA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy50b3RhbFNlbGVjdGVkRGl2IH0sIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyB2YWx1ZTogXCJ0b3RhbFNlbGVjdGVkVmFsdWVcIiwgY2xvc2FibGU6IHRydWUgfSwgYCR7dGhpcy50b3RhbFNlbGVjdGVkRmllbGRzfSAke3RoaXMuc3RyaW5ncy5zZWxlY3RlZH1gKSkpIDogbnVsbCwgdGhpcy5saXN0SXRlbXMpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBzdHlsZTogdGhpcy5jYWxjaXRlRmxvd1Byb3BzID8ge30gOiB7IGRpc3BsYXk6IFwiZmxleFwiLCBmbGV4OiBcIjEgMSBhdXRvXCIsIG92ZXJmbG93OiBcImhpZGRlblwiIH0gfSwgdGhpcy5jYWxjaXRlRmxvd1Byb3BzID8gKGgoXCJkaXZcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgfSwgdGhpcy5kaXNwbGF5TGlzdCgpKSkgOiAoaChcImNhbGNpdGUtZmxvd1wiLCB7IGlkOiBcImF0dHJpYnV0ZXNfZmxvd19JZFwiLCBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogdGhpcy5zdHJpbmdzLmF0dHJpYnV0ZXNIZWFkaW5nLCBkZXNjcmlwdGlvbjogIXRoaXMuaGlkZUxheWVyVGl0bGUgPyB0aGlzLmxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbG9zYWJsZTogdGhpcy5kaXNtaXNzaWJsZSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSksIG9uQ2FsY2l0ZUZsb3dJdGVtQ2xvc2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzQXR0cmlidXRlc0Rpc21pc3NlZENoYW5nZS5lbWl0KCk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuZGlzcGxheUxpc3QoKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzQXR0cmlidXRlcy5zdHlsZSA9IGFyY2dpc0F0dHJpYnV0ZXNDc3M7XG5cbmNvbnN0IGRhdGVGb3JtYXRzID0gW1xuICAgIFwic2hvcnQtZGF0ZVwiLFxuICAgIFwibG9uZy1tb250aC1kYXkteWVhclwiLFxuICAgIFwiZGF5LXNob3J0LW1vbnRoLXllYXJcIixcbiAgICBcImxvbmctZGF0ZVwiLFxuICAgIFwibG9uZy1tb250aC15ZWFyXCIsXG4gICAgXCJzaG9ydC1tb250aC15ZWFyXCIsXG4gICAgXCJ5ZWFyXCJcbl07XG5jb25zdCB0aW1lRm9ybWF0cyA9IFtcInNob3J0LXRpbWVcIiwgXCJsb25nLXRpbWVcIiwgXCJzaG9ydC10aW1lLTI0XCIsIFwibG9uZy10aW1lLTI0XCJdO1xuLy8gd2hlbiB0aW1lIGZvcm1hdCBpcyBcIm51bGxcIiwgc2hvd1RpbWUgbm90IGF2YWlsYWJsZVxuY29uc3QgYWxsRGF0ZXNNYXAgPSBuZXcgTWFwKCk7XG4vLyBzaG9ydC1kYXRlXG5hbGxEYXRlc01hcC5zZXQoXCJzaG9ydC1kYXRlXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMF0sIHRpbWVGb3JtYXQ6IFwiXCIgfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1swXSwgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMF0gfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJzaG9ydC1kYXRlLWxvbmctdGltZVwiLCB7IGRhdGVGb3JtYXQ6IGRhdGVGb3JtYXRzWzBdLCB0aW1lRm9ybWF0OiB0aW1lRm9ybWF0c1sxXSB9KTtcbmFsbERhdGVzTWFwLnNldChcInNob3J0LWRhdGUtc2hvcnQtdGltZS0yNFwiLCB7IGRhdGVGb3JtYXQ6IGRhdGVGb3JtYXRzWzBdLCB0aW1lRm9ybWF0OiB0aW1lRm9ybWF0c1syXSB9KTtcbmFsbERhdGVzTWFwLnNldChcInNob3J0LWRhdGUtbG9uZy10aW1lLTI0XCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMF0sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzNdIH0pO1xuLy8gbG9uZy1tb250aC1kYXkteWVhclxuYWxsRGF0ZXNNYXAuc2V0KFwibG9uZy1tb250aC1kYXkteWVhclwiLCB7IGRhdGVGb3JtYXQ6IGRhdGVGb3JtYXRzWzFdLCB0aW1lRm9ybWF0OiBcIlwiIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwibG9uZy1tb250aC1kYXkteWVhci1zaG9ydC10aW1lXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMV0sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzBdIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwibG9uZy1tb250aC1kYXkteWVhci1sb25nLXRpbWVcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1sxXSwgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMV0gfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJsb25nLW1vbnRoLWRheS15ZWFyLXNob3J0LXRpbWUtMjRcIiwge1xuICAgIGRhdGVGb3JtYXQ6IGRhdGVGb3JtYXRzWzFdLFxuICAgIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzJdXG59KTtcbmFsbERhdGVzTWFwLnNldChcImxvbmctbW9udGgtZGF5LXllYXItbG9uZy10aW1lLTI0XCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMV0sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzNdIH0pO1xuLy8gZGF5LXNob3J0LW1vbnRoLXllYXJcbmFsbERhdGVzTWFwLnNldChcImRheS1zaG9ydC1tb250aC15ZWFyXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMl0sIHRpbWVGb3JtYXQ6IFwiXCIgfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJkYXktc2hvcnQtbW9udGgteWVhci1zaG9ydC10aW1lXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMl0sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzBdIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwiZGF5LXNob3J0LW1vbnRoLXllYXItbG9uZy10aW1lXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMl0sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzFdIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwiZGF5LXNob3J0LW1vbnRoLXllYXItc2hvcnQtdGltZS0yNFwiLCB7XG4gICAgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbMl0sXG4gICAgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMl1cbn0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwiZGF5LXNob3J0LW1vbnRoLXllYXItbG9uZy10aW1lLTI0XCIsIHtcbiAgICBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1syXSxcbiAgICB0aW1lRm9ybWF0OiB0aW1lRm9ybWF0c1szXVxufSk7XG4vLyBsb25nLWRhdGVcbmFsbERhdGVzTWFwLnNldChcImxvbmctZGF0ZVwiLCB7IGRhdGVGb3JtYXQ6IGRhdGVGb3JtYXRzWzNdLCB0aW1lRm9ybWF0OiBcIlwiIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwibG9uZy1kYXRlLXNob3J0LXRpbWVcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1szXSwgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMF0gfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJsb25nLWRhdGUtbG9uZy10aW1lXCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbM10sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzFdIH0pO1xuYWxsRGF0ZXNNYXAuc2V0KFwibG9uZy1kYXRlLXNob3J0LXRpbWUtMjRcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1szXSwgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMl0gfSk7XG5hbGxEYXRlc01hcC5zZXQoXCJsb25nLWRhdGUtbG9uZy10aW1lLTI0XCIsIHsgZGF0ZUZvcm1hdDogZGF0ZUZvcm1hdHNbM10sIHRpbWVGb3JtYXQ6IHRpbWVGb3JtYXRzWzNdIH0pO1xuLy8gbG9uZy1tb250aC15ZWFyXG5hbGxEYXRlc01hcC5zZXQoXCJsb25nLW1vbnRoLXllYXJcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1s0XSwgdGltZUZvcm1hdDogbnVsbCB9KTtcbi8vIHNob3J0LW1vbnRoLXllYXJcbmFsbERhdGVzTWFwLnNldChcInNob3J0LW1vbnRoLXllYXJcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1s1XSwgdGltZUZvcm1hdDogbnVsbCB9KTtcbi8vIHllYXJcbmFsbERhdGVzTWFwLnNldChcInllYXJcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1s2XSwgdGltZUZvcm1hdDogbnVsbCB9KTtcbi8vIGRlZmF1bHRcbmFsbERhdGVzTWFwLnNldChcImRlZmF1bHRcIiwgeyBkYXRlRm9ybWF0OiBkYXRlRm9ybWF0c1swXSwgdGltZUZvcm1hdDogdGltZUZvcm1hdHNbMl0gfSk7XG5cbmNvbnN0IGFyY2dpc0F0dHJpYnV0ZXNGb3JtYXR0aW5nQ3NzID0gXCIuZm9ybWF0dGluZy1kaXZ7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nKSB2YXIoLS1hcmNnaXMtYXBwLXNpZGUtc3BhY2luZyk7bWF4LWhlaWdodDo2MHZofS5zaW5nbGUtbGluZS1sYWJlbC1zd2l0Y2gtc2VjdGlvbntkaXNwbGF5OmZsZXg7bWFyZ2luOjA7cGFkZGluZzp2YXIoLS1hcmNnaXMtYXBwLWNhcC1zcGFjaW5nLWhhbGYpIDB9LnNpbmdsZS1saW5lLWxhYmVsLXN3aXRjaC1sYWJlbHtkaXNwbGF5OmZsZXg7ZmxleC1mbG93OmNvbHVtbiBub3dyYXA7ZmxleDoxIDAgMCU7b3ZlcmZsb3c6aGlkZGVufS5zaW5nbGUtbGluZS1sYWJlbC1zd2l0Y2gtc3dpdGNoe2ZsZXg6MCAwIDAlO2p1c3RpZnktc2VsZjpmbGV4LWVuZDttYXJnaW46MH0uc2luZ2xlLWxpbmUtbGFiZWwtc3dpdGNoLXN3aXRjaCBpbnB1dHtkaXNwbGF5Om5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc0F0dHJpYnV0ZXNGb3JtYXR0aW5nID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNBdHRyaWJ1dGVzRm9ybWF0dGluZ0Rpc21pc3NlZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdEaXNtaXNzZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdVcGRhdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNBdHRyaWJ1dGVzRm9ybWF0dGluZ1VwZGF0ZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuZGlzcGxheURhdGUgPSBuZXcgRGF0ZShcIkRlY2VtYmVyIDMxLCAxOTY5IDE4OjAwOjAwXCIpO1xuICAgICAgICB0aGlzLmxheWVyRmllbGRzTWFwID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmFyY2FkZUV4cE1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkSW5mb01hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5oYXNDb21tb25EYXRhVHlwZXMgPSB0cnVlO1xuICAgICAgICB0aGlzLnRob3VzYW5kU2VwZXJhdG9yID0gKCkgPT4gKGgoXCJzZWN0aW9uXCIsIHsgY2xhc3M6IFwic2luZ2xlLWxpbmUtbGFiZWwtc3dpdGNoLXNlY3Rpb25cIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNpbmdsZS1saW5lLWxhYmVsLXN3aXRjaC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5zaG93MTAwMFNlcGVyYXRvciksIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGlkOiBcInRob3VzYW5kU2VwZXJhdG9yU3dpdGNoX0lkXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwic2luZ2xlLWxpbmUtbGFiZWwtc3dpdGNoLXN3aXRjaFwiLCBjaGVja2VkOiB0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LmRpZ2l0U2VwYXJhdG9yID8gdHJ1ZSA6IGZhbHNlIH0pKSk7XG4gICAgICAgIHRoaXMuc2lnbmlmaWNhbnREaWdpdHMgPSAoKSA9PiAoaChcInNlY3Rpb25cIiwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLnNpZ25pZmljYW50RGlnaXRzLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogdGhpcy5zdHJpbmdzLnNpZ25pZmljYW50RGlnaXRzLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LnBsYWNlcyA9IE51bWJlcihzZWxlY3Quc2VsZWN0ZWRPcHRpb24udmFsdWUpIHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlRmllbGRJbmZvKCk7XG4gICAgICAgICAgICB9IH0sIFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4XS5tYXAoKHgpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogeC50b1N0cmluZygpLCBzZWxlY3RlZDogdGhpcy5maXJzdFNlbGVjdGVkLmZvcm1hdC5wbGFjZXMgPT09IHggPyB0cnVlIDogZmFsc2UgfSwgYCR7eH0gJHt0aGlzLnN0cmluZ3MuZGVjaW1hbFBsYWNlc31gKSkpKSkpKTtcbiAgICAgICAgdGhpcy5kYXRlRm9ybWF0ID0gKHNlbGVjdGVkRGF0ZUZvcm1hdCkgPT4gKGgoXCJzZWN0aW9uXCIsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5kYXRlRm9ybWF0LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBpZDogXCJkYXRlRm9ybWF0U2VsZWN0X0lkXCIsIGxhYmVsOiB0aGlzLnN0cmluZ3MuZGF0ZUZvcm1hdCwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoKSA9PiB0aGlzLmNoYW5nZURhdGVGb3JtYXQoKSB9LCBkYXRlRm9ybWF0cy5tYXAoKGN1cnJlbnREYXRlRm9ybWF0KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGN1cnJlbnREYXRlRm9ybWF0LCBzZWxlY3RlZDogc2VsZWN0ZWREYXRlRm9ybWF0ID09PSBjdXJyZW50RGF0ZUZvcm1hdCA/IHRydWUgOiBmYWxzZSB9LCB0aGlzLmludGwuZm9ybWF0RGF0ZSh0aGlzLmRpc3BsYXlEYXRlLCB0aGlzLmludGwuY29udmVydERhdGVGb3JtYXRUb0ludGxPcHRpb25zKGN1cnJlbnREYXRlRm9ybWF0KSkpKSkpKSkpO1xuICAgICAgICB0aGlzLnNob3dUaW1lID0gKHNlbGVjdGVkVGltZUZvcm1hdCkgPT4gKGgoXCJzZWN0aW9uXCIsIHsgY2xhc3M6IFwic2luZ2xlLWxpbmUtbGFiZWwtc3dpdGNoLXNlY3Rpb25cIiwgaWQ6IFwic2hvd1RpbWVfSWRcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNpbmdsZS1saW5lLWxhYmVsLXN3aXRjaC1sYWJlbFwiIH0sIHRoaXMuc3RyaW5ncy5zaG93VGltZSksIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGlkOiBcInNob3dUaW1lU3dpdGNoX0lkXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwic2luZ2xlLWxpbmUtbGFiZWwtc3dpdGNoLXN3aXRjaFwiLCBjaGVja2VkOiBzZWxlY3RlZFRpbWVGb3JtYXQgPyB0cnVlIDogZmFsc2UgfSkpKTtcbiAgICAgICAgdGhpcy50aW1lRm9ybWF0ID0gKHNlbGVjdGVkVGltZUZvcm1hdCkgPT4gKGgoXCJzZWN0aW9uXCIsIHsgaWQ6IFwidGltZUZvcm1hdF9JZFwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy50aW1lRm9ybWF0LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBpZDogXCJ0aW1lRm9ybWF0U2VsZWN0X0lkXCIsIGxhYmVsOiB0aGlzLnN0cmluZ3MudGltZUZvcm1hdCwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoKSA9PiB0aGlzLmNoYW5nZURhdGVGb3JtYXQoKSB9LCB0aW1lRm9ybWF0cy5tYXAoKGN1cnJlbnRUaW1lRm9ybWF0KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGN1cnJlbnRUaW1lRm9ybWF0LCBzZWxlY3RlZDogc2VsZWN0ZWRUaW1lRm9ybWF0ID09PSBjdXJyZW50VGltZUZvcm1hdCA/IHRydWUgOiBmYWxzZSB9LCB0aGlzLmdldFRpbWVGb3JtYXRTdHJpbmcoY3VycmVudFRpbWVGb3JtYXQpKSkpKSkpKTtcbiAgICAgICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllckRpc3BsYXlUeXBlID0gbGF5ZXJEaXNwbGF5VHlwZUVudW0uZmVhdHVyZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3BvdmVyUHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9wdXBUZW1wbGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gbGlmZWN5Y2xlIG1ldGhvZHNcbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgbG9jYWxlU2V0dGluZ3MgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBsb2NhbGVTZXR0aW5nc1swXTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGFuZ3VhZ2UgPSBsb2NhbGVTZXR0aW5nc1sxXTtcbiAgICAgICAgY29uc3QgW3RlbXBJbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIHRoaXMuaW50bCA9IHRlbXBJbnRsO1xuICAgICAgICAvLyBtYXAgZm9yIGZhc3RlciBhY2Nlc3NcbiAgICAgICAgdGhpcy5sYXllckZpZWxkc01hcCA9IGF3YWl0IGdlbmVyYXRlTGF5ZXJGaWVsZHNNYXAodGhpcy5sYXllcik7XG4gICAgICAgIHRoaXMuYXJjYWRlRXhwTWFwID0gZ2VuZXJhdGVBcmNhZGVFeHByZXNzaW9uTWFwKHRoaXMucG9wdXBUZW1wbGF0ZSk7XG4gICAgICAgIC8vIHNldHVwIHNlbGVjdGVkRmllbGRJbmZvTWFwIHdpdGggYWxsIG5lZWRlZCBpbmZvXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZHMuZm9yRWFjaCgoZmllbGROYW1lKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuZmllbGRJbmZvcy5maW5kKCh0ZW1wbGF0ZUZpZWxkSW5mbywgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRlbXBsYXRlRmllbGRJbmZvLmZpZWxkTmFtZSA9PT0gZmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZEluZm9NYXAuc2V0KGZpZWxkTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGlkeCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZTogZ2V0RmllbGRUeXBlKGZpZWxkTmFtZSwgdGhpcy5sYXllckZpZWxkc01hcCwgdGhpcy5hcmNhZGVFeHBNYXApLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvOiB0ZW1wbGF0ZUZpZWxkSW5mb1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGZpcnN0IHNlbGVjdGVkIGZpZWxkIHRvIGRyaXZlIHRoZSBvcHRpb25zIGRpc3BsYXllZFxuICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkRmllbGRJbmZvTWFwLmdldCh0aGlzLnNlbGVjdGVkRmllbGRzWzBdKS5maWVsZEluZm87XG4gICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9IHRoaXMuc2VsZWN0ZWRGaWVsZEluZm9NYXAuZ2V0KHRoaXMuc2VsZWN0ZWRGaWVsZHNbMF0pLmZpZWxkVHlwZTtcbiAgICAgICAgdGhpcy5oYXNDb21tb25EYXRhVHlwZXMgPSB0aGlzLmNvbW1vbkRhdGFUeXBlc0NoZWNrKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSk7XG4gICAgICAgIC8vIHNldHVwIGRlZmF1bHQgb25seSBmb3IgMXN0LiBSZXN0IHdpbGwgYmUgY29waWVkIG9uIHNhdmVcbiAgICAgICAgaWYgKCF0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0ICYmIHRoaXMuaGFzQ29tbW9uRGF0YVR5cGVzKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNldHVwRGVmYXVsdEZvcm1hdCh0aGlzLmZpcnN0U2VsZWN0ZWQsIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwibWFuYWdlUG9wb3Zlcl9JZFwiKVtcInJlcG9zaXRpb25cIl0oKTtcbiAgICAgICAgaWYgKHRoaXMuYWxpYXNJbnB1dCkge1xuICAgICAgICAgICAgdGhpcy5hbGlhc0lucHV0LmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXR1cERhdGVUaW1lRGlzcGxheSgpO1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgICAgIC8vIG5lZWQgdGltZW91dCBiZWNhdXNlIG9mIHJlLXJlbmRlclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBhbmVsRWxlbWVudC5zZXRGb2N1cygpO1xuICAgICAgICB9KSwgMzAwKTtcbiAgICB9XG4gICAgLy8gUHVibGljIE1ldGhvZHNcbiAgICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gICAgfVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGFuZWxFbGVtZW50LnNldEZvY3VzKCksIDEwMCk7XG4gICAgfVxuICAgIC8vIEV2ZW50c1xuICAgIGNhbGNpdGVTd2l0Y2hDaGFuZ2VIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAodGhpcy5maXJzdFNlbGVjdGVkLmZvcm1hdCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gXCJkYXRlXCIgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IFwidGltZXN0YW1wLW9mZnNldFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VEYXRlRm9ybWF0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBudW1iZXJzXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LmRpZ2l0U2VwYXJhdG9yID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwidGhvdXNhbmRTZXBlcmF0b3JTd2l0Y2hfSWRcIikuY2hlY2tlZFxuICAgICAgICAgICAgICAgICAgICA/IHRydWVcbiAgICAgICAgICAgICAgICAgICAgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVGaWVsZEluZm8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBwcml2YXRlIG1ldGhvZHMgYW5kIHByb3BlcnRpZXNcbiAgICBjb21tb25EYXRhVHlwZXNDaGVjayhmaWVsZFR5cGUpIHtcbiAgICAgICAgZm9yIChsZXQgeCA9IDE7IHggPCB0aGlzLnNlbGVjdGVkRmllbGRzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wRmllbGRUeXBlID0gdGhpcy5zZWxlY3RlZEZpZWxkSW5mb01hcC5nZXQodGhpcy5zZWxlY3RlZEZpZWxkc1t4XSkuZmllbGRUeXBlO1xuICAgICAgICAgICAgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uaW50ZWdlciB8fFxuICAgICAgICAgICAgICAgIGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uc21hbGxJbnRlZ2VyIHx8XG4gICAgICAgICAgICAgICAgZmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5iaWdJbnRlZ2VyKSB7XG4gICAgICAgICAgICAgICAgaWYgKFtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlc0VudW0uaW50ZWdlcixcbiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlc0VudW0uc21hbGxJbnRlZ2VyLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZFR5cGVzRW51bS5iaWdJbnRlZ2VyXG4gICAgICAgICAgICAgICAgXS5pbmRleE9mKHRlbXBGaWVsZFR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5zaW5nbGUgfHxcbiAgICAgICAgICAgICAgICBmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmRvdWJsZSB8fFxuICAgICAgICAgICAgICAgIGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0ubG9uZyB8fFxuICAgICAgICAgICAgICAgIGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0ubnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKFtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlc0VudW0uc2luZ2xlLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZFR5cGVzRW51bS5kb3VibGUsXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZXNFbnVtLmxvbmcsXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZXNFbnVtLm51bWJlclxuICAgICAgICAgICAgICAgIF0uaW5kZXhPZih0ZW1wRmllbGRUeXBlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uZGF0ZSB8fFxuICAgICAgICAgICAgICAgIGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0udGltZXN0YW1wT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgaWYgKFtmaWVsZFR5cGVzRW51bS5kYXRlLCBmaWVsZFR5cGVzRW51bS50aW1lc3RhbXBPZmZzZXRdLmluZGV4T2YodGVtcEZpZWxkVHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmRhdGVPbmx5KSB7XG4gICAgICAgICAgICAgICAgaWYgKFtmaWVsZFR5cGVzRW51bS5kYXRlT25seV0uaW5kZXhPZih0ZW1wRmllbGRUeXBlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0udGltZU9ubHkpIHtcbiAgICAgICAgICAgICAgICBpZiAoW2ZpZWxkVHlwZXNFbnVtLnRpbWVPbmx5XS5pbmRleE9mKHRlbXBGaWVsZFR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBhc3luYyBzZXR1cERlZmF1bHRGb3JtYXQoY3VycmVudEZpZWxkLCBjdXJyZW50RmllbGRUeXBlKSB7XG4gICAgICAgIGNvbnN0IFtGaWVsZEluZm9Gb3JtYXRdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1xuICAgICAgICAgICAgXCJlc3JpL3BvcHVwL3N1cHBvcnQvRmllbGRJbmZvRm9ybWF0XCJcbiAgICAgICAgXSk7XG4gICAgICAgIGlmIChjdXJyZW50RmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5pbnRlZ2VyIHx8XG4gICAgICAgICAgICBjdXJyZW50RmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5zbWFsbEludGVnZXIgfHxcbiAgICAgICAgICAgIGN1cnJlbnRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmJpZ0ludGVnZXIpIHtcbiAgICAgICAgICAgIGN1cnJlbnRGaWVsZC5mb3JtYXQgPSBuZXcgRmllbGRJbmZvRm9ybWF0KHsgZGlnaXRTZXBhcmF0b3I6IGZhbHNlIH0pO1xuICAgICAgICAgICAgdGhpcy5zYXZlRmllbGRJbmZvKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uc2luZ2xlIHx8XG4gICAgICAgICAgICBjdXJyZW50RmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5kb3VibGUgfHxcbiAgICAgICAgICAgIGN1cnJlbnRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmxvbmcgfHxcbiAgICAgICAgICAgIGN1cnJlbnRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLm51bWJlcikge1xuICAgICAgICAgICAgY3VycmVudEZpZWxkLmZvcm1hdCA9IG5ldyBGaWVsZEluZm9Gb3JtYXQoe1xuICAgICAgICAgICAgICAgIGRpZ2l0U2VwYXJhdG9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwbGFjZXM6IDJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zYXZlRmllbGRJbmZvKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZGF0ZVxuICAgICAgICBlbHNlIGlmICgoY3VycmVudEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uZGF0ZSB8fFxuICAgICAgICAgICAgY3VycmVudEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uZGF0ZU9ubHkgfHxcbiAgICAgICAgICAgIGN1cnJlbnRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnRpbWVPbmx5IHx8XG4gICAgICAgICAgICBjdXJyZW50RmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS50aW1lc3RhbXBPZmZzZXQpICYmXG4gICAgICAgICAgICB0aGlzLmRhdGVGb3JtYXR0aW5nQXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50RmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5kYXRlT25seSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRGaWVsZC5mb3JtYXQgPSBuZXcgRmllbGRJbmZvRm9ybWF0KHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZUZvcm1hdDogXCJzaG9ydC1kYXRlXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRGaWVsZC5mb3JtYXQgPSBuZXcgRmllbGRJbmZvRm9ybWF0KHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZUZvcm1hdDogXCJzaG9ydC1kYXRlLXNob3J0LXRpbWVcIiAvLyB1c2VkIHRvIGJlIFwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNhdmVGaWVsZEluZm8oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXR1cERhdGVUaW1lRGlzcGxheSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gXCJkYXRlXCIgfHxcbiAgICAgICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gXCJ0aW1lLW9ubHlcIiB8fFxuICAgICAgICAgICAgdGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlID09PSBcInRpbWVzdGFtcC1vZmZzZXRcIikgJiZcbiAgICAgICAgICAgICgoX2EgPSB0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGF0ZUZvcm1hdCkgJiZcbiAgICAgICAgICAgIHRoaXMuaGFzQ29tbW9uRGF0YVR5cGVzKSB7XG4gICAgICAgICAgICBjb25zdCBzaG93VGltZUlkID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwic2hvd1RpbWVfSWRcIik7XG4gICAgICAgICAgICBjb25zdCBzaG93VGltZVN3aXRjaElkID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwic2hvd1RpbWVTd2l0Y2hfSWRcIik7XG4gICAgICAgICAgICBjb25zdCB0aW1lRm9ybWF0SWQgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJ0aW1lRm9ybWF0X0lkXCIpO1xuICAgICAgICAgICAgY29uc3QgdGVtcE1hcCA9IGFsbERhdGVzTWFwLmdldCh0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LmRhdGVGb3JtYXQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gXCJkYXRlXCIgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IFwidGltZXN0YW1wLW9mZnNldFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRlbXBNYXAudGltZUZvcm1hdCA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBzaG93VGltZUlkLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgICAgICAgICAgICAgICAgc2hvd1RpbWVTd2l0Y2hJZC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVGb3JtYXRJZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRlbXBNYXAudGltZUZvcm1hdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzaG93VGltZUlkLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgc2hvd1RpbWVTd2l0Y2hJZC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVGb3JtYXRJZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzaG93VGltZUlkLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICAgICAgICAgICAgICAgICAgc2hvd1RpbWVTd2l0Y2hJZC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGltZUZvcm1hdElkLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlID09PSBcInRpbWUtb25seVwiKSB7XG4gICAgICAgICAgICAgICAgdGltZUZvcm1hdElkLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0VGltZUZvcm1hdFN0cmluZyhjdXJyZW50VGltZUZvcm1hdCkge1xuICAgICAgICBpZiAoY3VycmVudFRpbWVGb3JtYXQgPT09IHRpbWVGb3JtYXRzWzBdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLnNob3J0VGltZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjdXJyZW50VGltZUZvcm1hdCA9PT0gdGltZUZvcm1hdHNbMV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3MubG9uZ1RpbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudFRpbWVGb3JtYXQgPT09IHRpbWVGb3JtYXRzWzJdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLnNob3J0VGltZTI0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRUaW1lRm9ybWF0ID09PSB0aW1lRm9ybWF0c1szXSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5sb25nVGltZTI0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5zaG9ydFRpbWUyNDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjaGFuZ2VBbGlhcygpIHtcbiAgICAgICAgLy8gZGVmYXVsdCBmaWVsZCBuYW1lXG4gICAgICAgIGlmICghaXNEZWZpbmVkJDEodGhpcy5hbGlhc0lucHV0LnZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy5hbGlhc0lucHV0LnZhbHVlID0gdGhpcy5maXJzdFNlbGVjdGVkLmZpZWxkTmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hcmNhZGVFeHBNYXAuaGFzKHRoaXMuZmlyc3RTZWxlY3RlZC5maWVsZE5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmFyY2FkZUV4cE1hcC5nZXQodGhpcy5maXJzdFNlbGVjdGVkLmZpZWxkTmFtZSkudGl0bGUgPSB0aGlzLmFsaWFzSW5wdXQudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQubGFiZWwgPSB0aGlzLmFsaWFzSW5wdXQudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zYXZlRmllbGRJbmZvKCk7XG4gICAgfVxuICAgIGNoYW5nZURhdGVGb3JtYXQoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBTZWxlY3REYXRlID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwiZGF0ZUZvcm1hdFNlbGVjdF9JZFwiKTtcbiAgICAgICAgY29uc3QgdGVtcFNlbGVjdFRpbWUgPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoXCJ0aW1lRm9ybWF0U2VsZWN0X0lkXCIpO1xuICAgICAgICBjb25zdCBzaG93VGltZVN3aXRjaElkID0gdGhpcy5ob3N0RWxlbWVudC5zaGFkb3dSb290LmdldEVsZW1lbnRCeUlkKFwic2hvd1RpbWVTd2l0Y2hfSWRcIik7XG4gICAgICAgIGlmICh0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IFwiZGF0ZVwiIHx8XG4gICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IFwidGltZXN0YW1wLW9mZnNldFwiKSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wRGF0ZU1hcCA9IGFsbERhdGVzTWFwLmdldCh0ZW1wU2VsZWN0RGF0ZS5zZWxlY3RlZE9wdGlvbi52YWx1ZSk7XG4gICAgICAgICAgICBpZiAodGVtcERhdGVNYXAudGltZUZvcm1hdCA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZC5mb3JtYXQuZGF0ZUZvcm1hdCA9IHNob3dUaW1lU3dpdGNoSWQuY2hlY2tlZFxuICAgICAgICAgICAgICAgICAgICA/IGAke3RlbXBTZWxlY3REYXRlLnNlbGVjdGVkT3B0aW9uLnZhbHVlfS0ke3RlbXBTZWxlY3RUaW1lLnNlbGVjdGVkT3B0aW9uLnZhbHVlfWBcbiAgICAgICAgICAgICAgICAgICAgOiBgJHt0ZW1wU2VsZWN0RGF0ZS5zZWxlY3RlZE9wdGlvbi52YWx1ZX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGVtcERhdGVNYXAudGltZUZvcm1hdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZC5mb3JtYXQuZGF0ZUZvcm1hdCA9IGAke3RlbXBTZWxlY3REYXRlLnNlbGVjdGVkT3B0aW9uLnZhbHVlfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlID09PSBcImRhdGUtb25seVwiKSB7XG4gICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LmRhdGVGb3JtYXQgPSBgJHt0ZW1wU2VsZWN0RGF0ZS5zZWxlY3RlZE9wdGlvbi52YWx1ZX1gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gXCJ0aW1lLW9ubHlcIikge1xuICAgICAgICAgICAgdGhpcy5maXJzdFNlbGVjdGVkLmZvcm1hdC5kYXRlRm9ybWF0ID0gYHNob3J0LWRhdGUtJHt0ZW1wU2VsZWN0VGltZS5zZWxlY3RlZE9wdGlvbi52YWx1ZX1gO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2F2ZUZpZWxkSW5mbygpO1xuICAgICAgICB0aGlzLnNldHVwRGF0ZVRpbWVEaXNwbGF5KCk7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5nZXRFbGVtZW50QnlJZChcIm1hbmFnZVBvcG92ZXJfSWRcIilbXCJyZXBvc2l0aW9uXCJdKCk7XG4gICAgfVxuICAgIHNhdmVGaWVsZEluZm8oKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gaGFzQ29tbW9uRGF0YVR5cGVzIGFsd2F5cyB0cnVlIHdoZW4gc29tZXRoaW5nIGNhbiBiZSBjaGFuZ2VkXG4gICAgICAgIGlmICh0aGlzLmhhc0NvbW1vbkRhdGFUeXBlcykge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpZWxkSW5mb01hcC5mb3JFYWNoKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5maWVsZEluZm8uZmllbGROYW1lID09PSB0aGlzLmZpcnN0U2VsZWN0ZWQuZmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmZpZWxkSW5mbyA9IHRoaXMuZmlyc3RTZWxlY3RlZC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuZmllbGRJbmZvLmZvcm1hdCA9IHRoaXMuZmlyc3RTZWxlY3RlZC5mb3JtYXQuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGZvciBhcmNhZGUsIGFsc28gY2xvbmUgdG8gcG9wdXBUZW1wbGF0ZS5leHByZXNzaW9uSW5mb3MoZm9yIHRpdGxlKVxuICAgICAgICAgICAgLy8gb25seSB2YWxpZCBmb3IgdGl0bGUgdXBkYXRlIHVzZSBjYXNlXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEZpZWxkcy5sZW5ndGggPT09IDEgJiYgdGhpcy5hcmNhZGVFeHBNYXAuaGFzKHRoaXMuZmlyc3RTZWxlY3RlZC5maWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMucG9wdXBUZW1wbGF0ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV4cHJlc3Npb25JbmZvcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuZXhwcmVzc2lvbkluZm9zLmZpbmQoKGFyY2FkZUZpZWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGAke2ZpZWxkSW5mb1ByZWZpeEVudW0uZXhwcmVzc2lvbn0ke2FyY2FkZUZpZWxkLm5hbWV9YCA9PT1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWQuZmllbGROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLnBvcHVwVGVtcGxhdGUuZXhwcmVzc2lvbkluZm9zW2luZGV4XSA9IHRoaXMuYXJjYWRlRXhwTWFwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQodGhpcy5maXJzdFNlbGVjdGVkLmZpZWxkTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNsb25lKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjbG9uZS9jaGFuZ2UgaW4gZmllbGRpbmZvXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRJbmZvTWFwLmZvckVhY2goKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3B1cFRlbXBsYXRlLmZpZWxkSW5mb3NbdmFsdWUuaW5kZXhdID0gdmFsdWUuZmllbGRJbmZvLmNsb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGNsb25lL2NoYW5nZSBpbiBjb250ZW50XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnBvcHVwVGVtcGxhdGUuY29udGVudCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcHVwVGVtcGxhdGUuY29udGVudC5mb3JFYWNoKChjb250ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50LnR5cGUgPT09IFwiZmllbGRzXCIgJiYgY29udGVudC5maWVsZEluZm9zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LmZpZWxkSW5mb3MuZm9yRWFjaCgoY29udGVudEZpZWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRmllbGRJbmZvTWFwLmhhcyhjb250ZW50RmllbGQuZmllbGROYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wRmllbGQgPSB0aGlzLnNlbGVjdGVkRmllbGRJbmZvTWFwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0KGNvbnRlbnRGaWVsZC5maWVsZE5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmllbGRJbmZvLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBGaWVsZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5maWVsZEluZm9zW2luZGV4XSA9IHRlbXBGaWVsZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcmNnaXNBdHRyaWJ1dGVzRm9ybWF0dGluZ1VwZGF0ZWQuZW1pdCh0aGlzLnBvcHVwVGVtcGxhdGUuY2xvbmUoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gcmVuZG9yIG1ldGhvZHNcbiAgICBmb3JtYXR0aW5nT3B0aW9ucygpIHtcbiAgICAgICAgaWYgKHRoaXMuZmlyc3RTZWxlY3RlZC5mb3JtYXQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmludGVnZXIgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnNtYWxsSW50ZWdlciB8fFxuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uYmlnSW50ZWdlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRob3VzYW5kU2VwZXJhdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBudW1iZXJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uc2luZ2xlIHx8XG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS5kb3VibGUgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmxvbmcgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLm51bWJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCB0aGlzLnNpZ25pZmljYW50RGlnaXRzKCksIHRoaXMudGhvdXNhbmRTZXBlcmF0b3IoKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGF0ZVxuICAgICAgICAgICAgZWxzZSBpZiAoKHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uZGF0ZSB8fFxuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSA9PT0gZmllbGRUeXBlc0VudW0uZGF0ZU9ubHkgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLnRpbWVPbmx5IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlID09PSBmaWVsZFR5cGVzRW51bS50aW1lc3RhbXBPZmZzZXQpICYmXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRlRm9ybWF0dGluZ0F2YWlsYWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcE1hcCA9IGFsbERhdGVzTWFwLmhhcyh0aGlzLmZpcnN0U2VsZWN0ZWQuZm9ybWF0LmRhdGVGb3JtYXQpXG4gICAgICAgICAgICAgICAgICAgID8gYWxsRGF0ZXNNYXAuZ2V0KHRoaXMuZmlyc3RTZWxlY3RlZC5mb3JtYXQuZGF0ZUZvcm1hdClcbiAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmZpcnN0U2VsZWN0ZWRGaWVsZFR5cGUgPT09IGZpZWxkVHlwZXNFbnVtLmRhdGVPbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICA/IGFsbERhdGVzTWFwLmdldChcInNob3J0LWRhdGVcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYWxsRGF0ZXNNYXAuZ2V0KFwic2hvcnQtZGF0ZS1zaG9ydC10aW1lXCIpOyAvLyB1c2VkIHRvIGJlIFwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSAhPT0gZmllbGRUeXBlc0VudW0udGltZU9ubHkgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlRm9ybWF0KHRlbXBNYXAuZGF0ZUZvcm1hdCksIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSAhPT0gZmllbGRUeXBlc0VudW0udGltZU9ubHkgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJzdFNlbGVjdGVkRmllbGRUeXBlICE9PSBmaWVsZFR5cGVzRW51bS5kYXRlT25seSAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUaW1lKHRlbXBNYXAudGltZUZvcm1hdCksIHRoaXMuZmlyc3RTZWxlY3RlZEZpZWxkVHlwZSAhPT0gZmllbGRUeXBlc0VudW0uZGF0ZU9ubHkgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lRm9ybWF0KHRlbXBNYXAudGltZUZvcm1hdCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRlZmF1bHQgc3RyaW5nXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRhdGVGb3JtYXR0aW5nQXZhaWxhYmxlKCkge1xuICAgICAgICByZXR1cm4gKCEoZ2V0U2VydmljZVR5cGUodGhpcy5sYXllcikgPT09IHNlcnZpY2VUeXBlRW51bS5zY2VuZSkgfHxcbiAgICAgICAgICAgIHRoaXMubGF5ZXIuYXNzb2NpYXRlZExheWVyICE9IG51bGwpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGRvbmVCdG4gPSAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgc2NhbGU6IFwibVwiLCBzbG90OiBcImZvb3RlclwiLCB3aWR0aDogXCJmdWxsXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdEaXNtaXNzZWQuZW1pdChcImRvbmVcIikgfSwgdGhpcy5zdHJpbmdzLmRvbmUpKTtcbiAgICAgICAgY29uc3QgYWxpYXNEaXYgPSAoaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmRpc3BsYXlOYW1lLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHR5cGU6IFwidGV4dFwiLCByZWY6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGlhc0lucHV0ID0gZWxlbWVudDtcbiAgICAgICAgICAgIH0sIHZhbHVlOiB0aGlzLmFyY2FkZUV4cE1hcC5oYXModGhpcy5maXJzdFNlbGVjdGVkLmZpZWxkTmFtZSlcbiAgICAgICAgICAgICAgICA/IHRoaXMuYXJjYWRlRXhwTWFwLmdldCh0aGlzLmZpcnN0U2VsZWN0ZWQuZmllbGROYW1lKS50aXRsZVxuICAgICAgICAgICAgICAgIDogdGhpcy5maXJzdFNlbGVjdGVkLmxhYmVsLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoKSA9PiB0aGlzLmNoYW5nZUFsaWFzKCkgfSkpKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgY2xhc3M6IFwianMtYXBwLWZseW91dFwiIH0sIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBkaXI6IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCksIGlkOiBcIm1hbmFnZVBvcG92ZXJfSWRcIiwgcGxhY2VtZW50OiB0aGlzLnBvcG92ZXJQcm9wcy5wbGFjZW1lbnQgfHwgXCJsZWFkaW5nLXN0YXJ0XCIsIG9wZW46IHRoaXMuaXNPcGVuLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMucG9wb3ZlclByb3BzLnJlZkVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiB0aGlzLnBvcG92ZXJQcm9wcy5vZmZzZXREaXN0YW5jZSB8fCAwLCBvZmZzZXRTa2lkZGluZzogdGhpcy5wb3BvdmVyUHJvcHMub2Zmc2V0U2tpZGRpbmcgfHwgMCwgbGFiZWw6IFwiXCIsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgekluZGV4OiBcIjEwMFwiXG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgcmVmOiAoZWwpID0+ICh0aGlzLnBhbmVsRWxlbWVudCA9IGVsKSwgY2xvc2FibGU6IHRydWUsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGAke3RoaXMucG9wb3ZlclByb3BzLnBvcG92ZXJXaWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJQcm9wcy5yZWZFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRofXB4YFxuICAgICAgICAgICAgfSwgb25DYWxjaXRlUGFuZWxDbG9zZTogKCkgPT4gdGhpcy5hcmNnaXNBdHRyaWJ1dGVzRm9ybWF0dGluZ0Rpc21pc3NlZC5lbWl0KCkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiaGVhZGVyLWNvbnRlbnRcIiB9LCB0aGlzLnN0cmluZ3MuZm9ybWF0dGluZyksIGRvbmVCdG4sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmb3JtYXR0aW5nLWRpdlwiIH0sIHRoaXMuc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID09PSAxID8gKGFsaWFzRGl2KSA6IChoKFwiaDNcIiwgbnVsbCwgYCR7dGhpcy5zdHJpbmdzLm11bHRpcGxlU2VsZWN0aW9ufSAoJHt0aGlzLnNlbGVjdGVkRmllbGRzLmxlbmd0aH0pYCkpLCB0aGlzLmhhc0NvbW1vbkRhdGFUeXBlcyA/ICh0aGlzLmZvcm1hdHRpbmdPcHRpb25zKCkpIDogKGgoXCJoM1wiLCBudWxsLCB0aGlzLnN0cmluZ3Muc2VsZWN0Q29tbW9uKSkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0F0dHJpYnV0ZXNGb3JtYXR0aW5nLnN0eWxlID0gYXJjZ2lzQXR0cmlidXRlc0Zvcm1hdHRpbmdDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0F0dHJpYnV0ZXMgYXMgYXJjZ2lzX2F0dHJpYnV0ZXMsIEFyY2dpc0F0dHJpYnV0ZXNGb3JtYXR0aW5nIGFzIGFyY2dpc19hdHRyaWJ1dGVzX2Zvcm1hdHRpbmcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWF0dHJpYnV0ZXNfMi5lbnRyeS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=