/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f81c2f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f81c2f"],{80387:(e,t,r)=>{r.r(t),r.d(t,{arcgis_dependency_check:()=>m,arcgis_item_share_group:()=>v,arcgis_item_share_group_card:()=>y});var i=r(81149),a=r(20164),s=r(74689),n=r(82218),o=r(62463),l=r(7273),c=r(19719),d=r(88780),u=r(70105),h=r(36238),p=r(12046);r(69283),r(49853),r(70464),r(79210),r(42577),r(51837),r(82102),r(12846),r(20206),r(65804),r(13615),r(30301);const m=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.workflowComplete=(0,i.c)(this,"workflowComplete",7),this.analyzeSharingDetail=async()=>{let e,{preProcessedSharingDetail:t,items:r,portal:i,i18n:s}=this;if(this.loadingText="loadingInfo",!this.preProcessedSharingDetail){const s=await Promise.all(r.map((({item:e,overrideLayers:t})=>(0,l.a)(e,i,t,{clearDataCacheOnDone:!1}))));l.e.forEach((e=>(0,a.c)(e))),t=s.reduce(((t,{error:r,result:i})=>(e=null==r?void 0:r.code,i&&Object.keys(i).forEach((e=>{t[e]=[...t[e],...i[e]]})),t)),{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:[]})}return this.sharingDetail=t,this.sharingDetail&&"dataNotAvailable"!==e?this.filterAndGetSharingDetails():(this.errorMessage=s.unableToGetItem,[])},this.filterAndGetSharingDetails=()=>{const{sharingDetail:e}=this;if(Object.keys(e).every((t=>{var r;return!(null===(r=e[t])||void 0===r?void 0:r.length)})))return;const{needEditableLayers:t,needsShareLevelUpdateLayers:r,needBDFSDatastoreUpdate:i}=e;this.needsShareLevelUpdateLayers=r,this.needEditableLayers=t,this.needBDFSDatastoreUpdate=i,this.shareableItemCount=[...r,...t,...i].length;const a=Object.keys(e).reduce(((t,r)=>{var i;return null===(i=e[r])||void 0===i||i.forEach((e=>{t.push({item:e.sourceItem,state:r})})),t}),[]);return this.displayItems=a,a},this.closeDialog=()=>{this.workflowCancel.emit()},this.updateSharing=async()=>{const{needsShareLevelUpdateLayers:e,needEditableLayers:t,needBDFSDatastoreUpdate:r,portal:i,items:a}=this;this.isLoading=!0,this.loadingText="updatingSharing";const s=[...e,...t],n=s.map((({sourceItem:e})=>e)),o=s.some((({detail:e})=>e.needsShareLevelUpdate)),c=o?a[0].item.access:null,d=r.map((({sourceItem:e})=>e)),u=d.filter((e=>!e.typeKeywords.includes("bigDataFileShare")));u.length>0&&await(0,l.s)(u,[],c,i);const h=s.some((({detail:e})=>e.needsGroupUpdate))&&"public"!==c;o||h?await(0,l.s)(n,a.map((({item:e})=>e)),c,i,h):console.warn("Unexpected state: no need to update share level or group"),this.isLoading=!1,this.workflowComplete.emit({updatedSourceItems:[...n,...d],oldSharingDetail:this.sharingDetail})},this.getStatusInfoForLayerState=e=>{const{helpBase:t,helpMap:r}=this.config;switch(e){case"needEditableLayers":return{i18nKey:"sharingPDCEnabled",kind:"info"};case"needPubliclyEditableLayers":case"needDataCollectionLayers":return{i18nKey:"pdc",kind:"danger",link:`${t}${null==r?void 0:r[120004130]}`};case"premiumLayers":return{i18nKey:"premium",kind:"info",link:"https://doc.arcgis.com/en/arcgis-online/reference/faq.htm#SHARE_SUBSCR_LYR"};case"notEditableLayers":return{i18nKey:"noPermission",kind:"danger"};case"needAuthentication":return{i18nKey:"needsAuthentication",kind:"danger"};default:return null}},this.renderPreviewItemNotice=()=>{const{previewItemState:e,getStatusInfoForLayerState:t,i18n:r}=this,a=e?t(e):null;if(!a)return null;const{i18nKey:s,kind:n,link:o}=a,l=r.needShare;return(0,i.h)("calcite-notice",{open:!0,closable:!1,scale:"m",kind:n,slot:"preview-summary-top",class:"preview-notice"},(0,i.h)("div",{slot:"message"},l[s].panel),o&&"noPermission"!==s&&"sharingPDCEnabled"!==s&&"needsAuthentication"!==s&&(0,i.h)("calcite-link",{slot:"link",href:o,target:"_blank",rel:"noopener"},l[s].learnMore))},this.user=void 0,this.portal=void 0,this.config=void 0,this.api=void 0,this.isActive=!0,this.items=void 0,this.preProcessedSharingDetail=void 0,this.isLoading=void 0,this.sharingDetail=void 0,this.sections=[],this.needsShareLevelUpdateLayers=[],this.needEditableLayers=[],this.needBDFSDatastoreUpdate=[],this.displayItems=[],this.previewItemState=null,this.loadingText="loadingInfo",this.errorMessage=null,this.shareableItemCount=0}async componentWillLoad(){this.items=this.items.map((e=>{var t;return Object.assign(Object.assign({},e),{item:null!==(t=e.item.sourceJSON)&&void 0!==t?t:e.item})}));const{el:e}=this,t=await(0,n.g)(e);this.i18n=t[0]}handleNewPreProcessedSharingDetail(){var e;null===(e=this.itemBrowserRef)||void 0===e||e.refresh()}componentDidLoad(){}render(){const{updateSharing:e,isActive:t,api:r,closeDialog:a,i18n:n,isLoading:l,loadingText:c,shareableItemCount:d,errorMessage:u,portal:h,user:p,config:m,analyzeSharingDetail:g,getStatusInfoForLayerState:v,displayItems:y,renderPreviewItemNotice:f}=this,w=d>0,b=!!u,S=n.needShare;return(0,i.h)("calcite-modal",{onCalciteModalClose:a,open:t,outsideCloseDisabled:!0,escapeDisabled:!0},(0,i.h)("div",{slot:"header",class:"header"},n.updateSharing),(0,i.h)("div",{slot:"content",class:"stage"},(0,i.h)("calcite-alert",{icon:!0,open:b,label:u,kind:"danger",onCalciteAlertClose:()=>this.errorMessage=null},(0,i.h)("div",{slot:"message"},u)),(0,i.h)("arcgis-new-item-loader",{active:l,text:n[c]}),(0,i.h)("arcgis-item-browser",{fetch:async()=>{var e;const t=null!==(e=await g())&&void 0!==e?e:[];return{total:t.length,nextStart:0,num:t.length,start:0,results:t.map((({item:e})=>e))}},onArcgisItemBrowserPreview:({detail:e})=>{var t,r;e||(this.previewItemState=null),this.previewItemState=null!==(r=null===(t=y.find((({item:t})=>t.id===e.id)))||void 0===t?void 0:t.state)&&void 0!==r?r:null},hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,portal:h,user:p,config:m,selection:"none",api:r,num:o.a,ref:e=>this.itemBrowserRef=e},(0,i.h)("arcgis-item-browser-content",{class:"compact-grid-content",slot:"content"},(0,i.h)("div",{class:"top-bar"},(0,i.h)("div",{class:"top-notice",innerHTML:n[h.isPortal?"noticeEnterprise":"notice"]}),(0,i.h)("div",null,n.canBeShared.replace("${count}",d.toString()).replace("${total}",y.length.toString()))),y.map((({item:e,state:t})=>{const r=v(t),a="info"===(null==r?void 0:r.kind);return(0,i.h)("arcgis-item-browser-card",{key:e.id,item:e,portal:h,user:p,baseUrl:m.baseUrl,preview:"top",showOwner:!0,showDateUpdated:!0,showItemType:!0,showSummary:!0,showBadges:!0},r&&(0,i.h)("div",{slot:"content-top",class:{"status-banner":!0,"status-banner--info":a}},(0,i.h)("calcite-icon",{icon:a?"information":"exclamationMarkTriangle",scale:"s"}),(0,i.h)("span",null,S[r.i18nKey].notice)),(0,i.h)("div",{slot:"actions-end",class:"open-item"},(0,i.h)("calcite-button",{scale:"s",appearance:"transparent",kind:"neutral",onClick:()=>window.open((0,s.g)(e.id,m.baseUrl),"_blank","noopener")},n.goToItem)))}))),f())),(0,i.h)("calcite-button",{slot:"primary",appearance:w?"outline":"solid",kind:"brand","data-id":"cancelButton",onClick:()=>this.isActive=!1,width:"full"},n[w?"cancel":"ok"]),w&&(0,i.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:e,width:"full",disabled:l},n.update))}get el(){return(0,i.d)(this)}static get watchers(){return{preProcessedSharingDetail:["handleNewPreProcessedSharingDetail"]}}};m.style=".stage{height:100%;overflow:hidden;transform:translate(0, 0)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}calcite-modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px}.top-bar{font-weight:500;padding-left:1rem;padding-right:1rem;padding-top:1.5rem;padding-bottom:0.5rem;font-size:0.875rem}@media screen and (min-width: 1080px){.top-bar{padding-left:0px;padding-right:0px}}.top-notice{margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:1px solid var(--calcite-color-border-1)}.open-item{margin-inline-start:0.25rem;padding-inline-start:0.25rem;border-inline-start:1px solid var(--calcite-color-border-1)}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}.status-banner--info>calcite-icon{color:var(--calcite-color-status-info)}.compact-grid-content{--arcgis-item-browser-content-spacing:0.5rem}.preview-notice{margin-bottom:1rem}";const g=(e,t)=>(0,d.r)(`${(0,a.s)(e)}/community/groups`,e,{body:t,usePost:!0}),v=class{constructor(e){(0,i.r)(this,e),this.editGroupClick=(0,i.c)(this,"editGroupClick",7),this.dirtyChange=(0,i.c)(this,"dirtyChange",7),this.analyzeUserGroupComplete=(0,i.c)(this,"analyzeUserGroupComplete",7),this.removeClick=(0,i.c)(this,"removeClick",7),this.revertClick=(0,i.c)(this,"revertClick",7),this.hasGroups=!1,this.user=void 0,this.portal=void 0,this.config=void 0,this.items=void 0,this.shareMode=void 0,this.isLoading=void 0,this.i18n=void 0,this.selectedGroupData=[],this.initialSelectedGroups=[],this.canShareItemToGroup=!1,this.isDirty=!1,this.isSharingMixed=!1}handleSelectedGroupsChange(e){const{user:t,initialSelectedGroups:r,items:i}=this;this.canShareItemToGroup=(0,c.k)(e,t),this.isDirty=(0,c.i)(e,r),this.isSharingMixed=(0,c.l)(i,e),this.dirtyChange.emit(this.isDirty)}async componentDidLoad(){const{user:e,portal:t,items:r,shareMode:i}=this;this.isLoading=!0;const{result:n}=await(async({items:e,portal:t,shareMode:r,user:i})=>{try{const a=await(async({user:e,items:t,portal:r})=>{var i;if((0,s.d)(t,e)&&(0,p.p)({items:t,user:e,portal:r})&&(0,p.q)(e)){const e=t[0];return null!==(i=e.itemOwner)&&void 0!==i?i:await(0,u.f)(e.owner,r)}return e})({user:i,items:e,portal:t}),n=i.username===a.username?[i]:[i,a],o=await(async({user:e,portal:t,shareMode:r,itemOwner:i})=>{const a=await Promise.all([(0,u.f)(e.username,t),"admin"===r&&i.username!==e.username?(0,u.f)(i.username,t):null]);return Object.assign({[e.username]:a[0].groups},!!a[1]&&{[i.username]:a[1].groups})})({portal:t,user:i,shareMode:r,itemOwner:a}),l=(await Promise.all(n.map((a=>(async({user:e,portalUser:t,portal:r,shareMode:i,userGroupLookup:a,items:s})=>{var n;const o={q:(0,c.a)({shareMode:i,currentUsername:t.username,user:e,userGroupLookup:a,isPrivate:"private"===(null===(n=s[0])||void 0===n?void 0:n.access)}),num:100,searchUserAccess:"groupMember",searchUserName:e.username};try{const e=await g(r,o);if(-1===e.nextStart)return{result:e.results};const t=Math.ceil(e.total/100)-1,i=[];for(let e=0;e<t;e++)i.push(new Promise((async t=>{const i=100*(e+1)+1;t((await g(r,Object.assign(Object.assign({},o),{start:i}))).results)})));const a=(await Promise.all(i)).flat();return{result:[...e.results,...a]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({user:a,portalUser:i,portal:t,shareMode:r,userGroupLookup:o,items:e}))))).flatMap((e=>e.result)),d=l.map((({id:e})=>e));return{result:{uniqueGroups:l.filter(((e,t)=>d.indexOf(e.id)===t)),userGroupLookup:o,allUsers:n,searchUsername:i.username===a.username?i.username:a.username}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({user:e,portal:t,items:r,shareMode:i}),{uniqueGroups:o,userGroupLookup:l,searchUsername:d,allUsers:m}=n,{result:v}=await(async(e,t,r)=>{try{const i=await Promise.all((0,h.g)(t,100).map((async t=>(0,a.r)(`${(0,a.g)(r)}/content/itemsgroups`,{items:e.join(","),groups:t.join(",")})))),s={};return i.forEach((e=>{Object.keys(e).forEach((t=>{const r=e[t];s[t]?s[t].items=[...s[t].items,...r.items]:s[t]=r}))})),{result:s}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r.map((e=>e.id)),o.map((e=>e.id)),t),y=o.filter((({id:e})=>!!v[e])).map((e=>({group:e,selectedByItemIds:r.filter((({id:t})=>!!v[e.id].items.find((e=>e.itemId===t)))).map((e=>e.id))})));this.hasGroups=o.length>0,this.canShareItemToGroup=(0,c.k)(y,e),this.initialSelectedGroups=y,this.isLoading=!1,this.analyzeUserGroupComplete.emit({allUsers:m,initialSelectedGroups:y,userGroupLookup:l,searchUsername:d})}render(){const{i18n:e,isLoading:t,canShareItemToGroup:r,removeClick:a,revertClick:s,selectedGroupData:n,hasGroups:o,isDirty:l,isSharingMixed:c}=this;return(0,i.h)(i.H,null,(0,i.h)("arcgis-new-item-description",{header:e.title,headerSideContent:l?(0,i.h)("calcite-button",{appearance:"transparent",iconStart:"reset",disabled:t,onClick:()=>s.emit()},e.revert):n.length>0&&(0,i.h)("calcite-button",{appearance:"transparent",iconStart:"x",disabled:t,onClick:()=>a.emit()},e.remove)}),(0,i.h)("div",{class:"content"},(0,i.h)("div",{class:"group-container"},n.length>0?(0,i.h)("arcgis-group-thumbnail-stack",{groups:n.map((({group:e})=>e))}):(0,i.h)("p",{class:"information-text"},e[o?"noneYet":"noGroup"])),o&&r&&(0,i.h)("calcite-button",{iconStart:"group",appearance:"outline-fill",disabled:t,onClick:()=>this.editGroupClick.emit()},e.edit)),!t&&c&&(0,i.h)("p",{class:"information-text text-padding"},e.mixedGroupSharing))}get el(){return(0,i.d)(this)}static get watchers(){return{selectedGroupData:["handleSelectedGroupsChange"]}}};v.style=".content{display:flex;align-items:center;justify-content:space-between;margin-top:1rem}.information-text{font-size:0.875rem;margin-top:0px;margin-bottom:0px}.text-padding{margin-top:0.5rem}";const y=class{constructor(e){(0,i.r)(this,e),this.revertClick=(0,i.c)(this,"revertClick",7),this.user=void 0,this.portal=void 0,this.group=void 0,this.groupCount=void 0,this.initialSelectedGroupDataLookup=void 0,this.selectedGroupDataLookup=void 0,this.totalItemCount=void 0,this.i18n=void 0}render(){const{group:e,groupCount:t,totalItemCount:r,initialSelectedGroupDataLookup:a,selectedGroupDataLookup:s,revertClick:n,portal:o,user:l,i18n:c}=this,d=r.toString(),u=e.id,h=t[e.id];let p="none";switch(!0){case h<r:p="indeterminate";break;case h===r:p="all"}const m=a[u],g=(!!m||"none"!==p)&&m!==p;return(0,i.h)("arcgis-group-card",{group:e,portal:o,user:l,name:e.title,selected:!!s[u],indeterminate:"indeterminate"===p,selection:"multiple",preview:"action",view:"compact",showOwner:!0,showDateUpdated:!0,showSummary:!0,key:u},(0,i.h)("span",{slot:"content-end"},h&&h>0&&(0,i.h)("span",{class:"group-item-counter"},c[g?"willShareCountHint":"sharedCountHint"].replace("${numItem}",h.toLocaleString()).replace("${totalItem}",d)),g&&(0,i.h)("calcite-button",{class:"revert-single-group-cta",appearance:"transparent",onClick:e=>{e.stopPropagation(),n.emit()}},c.revert)))}get el(){return(0,i.d)(this)}};y.style=":host{display:contents}"},62463:(e,t,r)=>{r.d(t,{I:()=>i,a:()=>a});const i=["folder","group","contentType"],a=99999},70105:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>h,c:()=>p,d:()=>o,e:()=>l,f:()=>s,g:()=>d,u:()=>m});var i=r(20164),a=r(49853);async function s(e,t){return(0,i.r)(`${(0,i.g)(t)}/community/users/${e}`)}async function n(){return(0,i.r)(`${(0,i.g)()}/community/self`)}async function o(){var e;const t=null===a.c||void 0===a.c?void 0:a.c.user;if(!t)return[];const r=await(0,i.f)((()=>n()),"communitySelf",t.username);return null!==(e=null==r?void 0:r.groups)&&void 0!==e?e:[]}async function l(){const e=null===a.c||void 0===a.c?void 0:a.c.user;return e?(await(0,i.f)((()=>n()),"communitySelf",e.username)).favGroupId:null}function c(e,t){var r;return null!==(r=null==e?void 0:e.userContentUrl)&&void 0!==r?r:`${null==t?void 0:t.restUrl}/content/users/${e.username}`}async function d(e){var t;const r=null!==(t=null!=e?e:a.c.user)&&void 0!==t?t:a.c.portal.user,{folders:s}=await async function(e){var t;const r=c(null!==(t=null!=e?e:a.c.user)&&void 0!==t?t:a.c.portal.user,a.c.portal),s=await(0,i.r)(r,{num:1});return Promise.resolve(s)}(r),{username:n}=r;return[{username:n,id:n,title:n,created:"now"},...s.sort(((e,t)=>e.title.localeCompare(t.title)))]}async function u(e,t){var r;const i=null!==(r=null!=t?t:a.c.user)&&void 0!==r?r:a.c.portal.user;return(await d(i)).find((t=>t.id===e))}function h(e){return{username:e,id:e,title:e,created:"now"}}async function p(e,t){var r;const s=`${c(null!==(r=null!=t?t:a.c.user)&&void 0!==r?r:a.c.portal.user,a.c.portal)}/createFolder`;return await(0,i.r)(s,{title:e},{},"post")}async function m(e,t,r){var s;const n=`${c(null!==(s=null!=r?r:a.c.user)&&void 0!==s?s:a.c.portal.user,a.c.portal)}/${e}/updateFolder`;try{return{result:await(0,i.r)(n,{newTitle:t},{},"post")}}catch(e){return{error:{code:"unhandledError"}}}}}}]);