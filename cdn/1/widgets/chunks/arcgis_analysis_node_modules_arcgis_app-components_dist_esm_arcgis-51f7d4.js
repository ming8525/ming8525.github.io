"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-51f7d4"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-browser_16.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-group-browser_16.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_group_browser: () => (/* binding */ ArcgisGroupBrowser),
/* harmony export */   arcgis_group_browser_actions: () => (/* binding */ ArcgisGroupBrowserActions),
/* harmony export */   arcgis_group_browser_content: () => (/* binding */ ArcgisGroupBrowserContent),
/* harmony export */   arcgis_group_browser_filter_date: () => (/* binding */ ArcgisGroupBrowserFilterDate),
/* harmony export */   arcgis_group_browser_filter_groups_by_user: () => (/* binding */ ArcgisGroupBrowserFilterGroupsByUser),
/* harmony export */   arcgis_group_browser_filter_member_org: () => (/* binding */ ArcgisGroupBrowserFilterMemberOrg),
/* harmony export */   arcgis_group_browser_filter_membership: () => (/* binding */ ArcgisGroupBrowserFilterMembership),
/* harmony export */   arcgis_group_browser_filter_owner: () => (/* binding */ ArcgisGroupBrowserFilterOwner),
/* harmony export */   arcgis_group_browser_filter_special_groups: () => (/* binding */ ArcgisGroupBrowserFilterSpecialGroups),
/* harmony export */   arcgis_group_browser_filters: () => (/* binding */ ArcgisGroupBrowserFilters),
/* harmony export */   arcgis_group_browser_pagination: () => (/* binding */ ArcgisGroupBrowserPagination),
/* harmony export */   arcgis_group_browser_preview: () => (/* binding */ ArcgisGroupBrowserPreview),
/* harmony export */   arcgis_group_browser_preview_card: () => (/* binding */ ArcgisGroupBrowserPreviewCard),
/* harmony export */   arcgis_group_browser_search: () => (/* binding */ ArcgisGroupBrowserSearch),
/* harmony export */   arcgis_group_browser_sort: () => (/* binding */ ArcgisGroupBrowserSort),
/* harmony export */   arcgis_group_browser_top_bar: () => (/* binding */ ArcgisGroupBrowserTopBar)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./resize-a17b7292.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/resize-a17b7292.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./store-da3fccd5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-da3fccd5.js");
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./items-a4f5e98b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/items-a4f5e98b.js");
/* harmony import */ var _portal_660bb43a_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./portal-660bb43a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-660bb43a.js");
/* harmony import */ var _user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./user-0fa9ff5a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-0fa9ff5a.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./utils-2f459d6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-2f459d6d.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */























async function queryGroups(portal, query) {
    const restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
    const url = `${restBase}community/groups`;
    const { num, start, sortOrder, sortField, filters, baseQuery, searchTerm, searchUser } = query;
    const filterIds = Object.keys(filters || {});
    const term = searchTerm ? `(${(0,_string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_8__.c)(searchTerm)}) ` : "";
    const baseParams = Object.assign(Object.assign({}, (searchUser ? { searchUserAccess: "groupMember", searchUserName: searchUser } : {})), { q: `${baseQuery || ""} ${term}` });
    const queryParams = filterIds.reduce((params, key) => {
        const { param, value } = filters[key];
        return Object.assign(Object.assign({}, params), { [param]: `${params[param] || ""} ${value}` });
    }, baseParams);
    const params = Object.assign(Object.assign({ num,
        start }, (sortField === "relevance"
        ? {}
        : {
            sortField,
            sortOrder
        })), (queryParams || {}));
    const hasActiveQuery = Object.entries(queryParams).some(([_key, value]) => typeof value !== "string" || !!(value === null || value === void 0 ? void 0 : value.trim()));
    if (!hasActiveQuery) {
        // the group search endpoint will throw an error with no search parameters, so treat as an empty result set
        return {
            nextStart: -1,
            num: 0,
            results: [],
            start: 0,
            total: 0
        };
    }
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
    return Object.assign(Object.assign({}, response), { q: queryParams.q, queryParams: params });
}
async function queryGroupContent(portal, groupId, params = {}) {
    const restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
    const url = `${restBase}content/groups/${groupId}/search`;
    const defaultParams = {
        num: 4,
        start: 0,
        sortField: "modified",
        sortOrder: "desc"
    };
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, Object.assign(Object.assign({}, defaultParams), params));
    return response;
}
async function queryFeaturedContent(portal, groupId, featured, limit = 4) {
    const restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
    const url = `${restBase}content/groups/${groupId}/search`;
    const params = {
        num: limit,
        start: 0,
        q: `id:(${featured.slice(0, limit).join(" OR ")})`
    };
    const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
    // results will be returned in a "relevance" order, we want them in the requested order
    // not all featured items will be available to all users so also filter out ones that were not returned
    if (response.total) {
        const newResults = featured
            .map((id) => {
            return response.results.find((item) => item.id === id);
        })
            .filter(Boolean);
        response.results = newResults;
    }
    return response;
}

const arcgisGroupBrowserCss = ":host{position:relative;display:flex;height:100%;flex-direction:column;overflow-y:auto;overflow-x:hidden;background-color:var(--calcite-color-background);--group-browser-max-width:100%;--group-browser-pane-width:18.75rem;--group-browser-pane-z-index:11;--group-browser-top-bar-background:var(--calcite-color-foreground-1)}arcgis-browser{--arcgis-browser-max-width:var(--group-browser-max-width);--arcgis-browser-pane-width:var(--group-browser-pane-width);--arcgis-browser-pane-z-index:var(--group-browser-pane-z-index);--arcgis-browser-top-bar-background:var(--group-browser-top-bar-background)}@media screen and (max-width: 640px){:host{--group-browser-pane-width:100%}}";

const ArcgisGroupBrowser = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserUpdate", 7);
        this.arcgisGroupBrowserLoading = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserLoading", 7);
        this.arcgisGroupBrowserSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSelect", 7);
        this.arcgisGroupBrowserPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreview", 7);
        this.arcgisGroupBrowserSublayerPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSublayerPreview", 7);
        this.arcgisGroupBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
        this.liveRegionUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "liveRegionUpdate", 7);
        this.allowFetch = false;
        this.currentResults = [];
        this.updateFiltersEmpty = () => {
            var _a;
            this.store.state.filtersEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="filters"]`));
        };
        this.updateTopbarEmpty = () => {
            var _a;
            this.store.state.topbarEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="top-bar"]`));
        };
        this.updateSortEmpty = () => {
            var _a;
            this.store.state.sortEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="sort"]`));
        };
        this.filterMutationObserver = new MutationObserver(this.updateFiltersEmpty);
        this.topbarMutationObserver = new MutationObserver(this.updateTopbarEmpty);
        this.sortMutationObserver = new MutationObserver(this.updateSortEmpty);
        this.fetchGroups = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)(async () => {
            this.loading = true;
            this.currentResults = [];
            this.arcgisGroupBrowserLoading.emit();
            this.store.state.preview = null;
            if (!this.portal || !this.allowFetch) {
                return;
            }
            let query = this.getQuery();
            if (this.preflight) {
                query = await this.preflight(query);
            }
            const response = await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.m)(this.queryGroups(query), 500);
            this.arcgisGroupBrowserUpdate.emit(Object.assign(Object.assign(Object.assign({}, response), { selectedGroups: this.selectedGroups, filters: Object.assign({}, this.store.state.filters), searchTerm: this.searchTerm }), this.sort));
            this.currentResponse = response;
            this.currentResults = response.results;
            this.loading = false;
        }, 150);
        this.handleResizeEvent = (e) => {
            this.resize(e);
        };
        this.renderSelectedItem = (selectedGroup) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected-item", { key: selectedGroup.id, heading: selectedGroup.title, onArcgisSelectedItemRemove: () => {
                    this.deselectGroup(selectedGroup);
                    this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
                } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail", { slot: "content-start", group: selectedGroup, portal: this.portal, scale: "s" })));
        };
        this.api = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.searchUser = undefined;
        this.config = undefined;
        this.selection = "none";
        this.view = "list";
        this.num = 20;
        this.q = "";
        this.selectedGroups = [];
        this.preflight = undefined;
        this.fetch = undefined;
        this.hidePreviewFooter = false;
        this.hidePreviewBadges = false;
        this.hasIndoorsSpaces = false;
        this.height = "full";
        this.store = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_1__.c)({ filters: {} });
        this.usePanelLayout = false;
        this.searchTerm = "";
        this.sort = undefined;
        this.page = { num: this.num, start: 1, nextStart: -1 };
        this.loading = true;
        this.formFactor = undefined;
        this.pageRangeText = "";
        this.previewGroup = undefined;
        this.currentResponse = undefined;
    }
    /** Manually trigger a fetch of new results */
    async refresh() {
        this.fetchGroups();
    }
    async componentWillLoad() {
        const { el, hasIndoorsSpaces, selectedGroups, view } = this;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(el);
        this.i18n = locale[0];
        this.store.state.i18n = locale[0];
        this.store.state.lang = locale[1];
        this.store.state.view = view;
        this.store.state.hasIndoorsSpaces = hasIndoorsSpaces;
        this.store.state.selectedGroups = selectedGroups;
        this.initializeConfig();
        (0,_resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.s)(this.store).observe(this.el);
        el.addEventListener("arcgisBrowserResize", this.handleResizeEvent);
        this.filterMutationObserver.observe(el, { childList: true });
        this.topbarMutationObserver.observe(el, { childList: true });
        this.sortMutationObserver.observe(el, { childList: true });
        this.updateFiltersEmpty();
        this.updateTopbarEmpty();
        this.updateSortEmpty();
        if (this.usePanelLayout || (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.c)(this.el, "calcite-shell-panel")) {
            this.store.state.panel = true;
            this.store.state.filtersExpanded = false;
        }
    }
    disconnectedCallback() {
        var _a, _b;
        (_a = this.store.state.resizeObserver) === null || _a === void 0 ? void 0 : _a.unobserve(this.el);
        this.filterMutationObserver.disconnect();
        this.topbarMutationObserver.disconnect();
        this.sortMutationObserver.disconnect();
        this.filterClearHandler(false);
        (_b = this.el) === null || _b === void 0 ? void 0 : _b.removeEventListener("arcgisBrowserResize", this.handleResizeEvent);
    }
    updateUser(newUser) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user = newUser);
    }
    updatePortal(newPortal) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = newPortal);
    }
    updateAPI(newValue) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = newValue);
    }
    updateConfig(newConfig) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config = newConfig);
    }
    updateSelection(newValue) {
        this.store.state.selection = newValue;
    }
    updateSelectedGroups(groups) {
        this.store.state.selectedGroups = groups;
    }
    updateQ() {
        this.resetPagination();
        this.fetchGroups();
    }
    async componentDidLoad() {
        this.initializeConfig();
        // initially, fetch is locked
        // wait for all components to emit events impacting state prior to initial fetch
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
        this.allowFetch = true;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            this.fetchGroups();
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => {
                this.initializeConfig();
                this.fetchGroups();
            });
        }
    }
    filterHandler(e) {
        const filters = Object.assign(Object.assign({}, this.store.state.filters), { [e.detail.id]: e.detail });
        // remove filter from set
        if (!e.detail.value) {
            delete filters[e.detail.id];
        }
        this.store.state.filters = filters;
        this.resetPagination();
        this.fetchGroups();
    }
    filterRemoveHandler(e) {
        if (!e.detail) {
            return;
        }
        const filters = Object.assign({}, this.store.state.filters);
        delete filters[e.detail];
        this.store.state.filters = filters;
        this.resetPagination();
        this.fetchGroups();
    }
    filterClearHandler(doFetchGroups = true) {
        this.store.state.filters = {};
        this.resetPagination();
        doFetchGroups && this.fetchGroups();
    }
    genericFilterClearHandler() {
        this.filterClearHandler();
    }
    filterToggleHandler() {
        this.store.state.preview = null;
        this.store.state.filtersExpanded = !this.store.state.filtersExpanded;
    }
    searchHandler(e) {
        const newTerm = e.detail;
        this.searchTerm = newTerm;
        this.resetPagination();
        if (newTerm) {
            this.fetchGroups();
        }
        else {
            this.fetchGroups.invoke();
        }
    }
    sortHandler(e) {
        this.sort = e.detail;
        this.fetchGroups();
    }
    async pageHandler(e) {
        var _a;
        this.page = e.detail;
        if (this.allowFetch) {
            await this.fetchGroups();
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
            // TODO: figure out why a ref doesn't work for this element
            (_a = this.el.shadowRoot.querySelector(".content__view")) === null || _a === void 0 ? void 0 : _a.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        }
    }
    selectHandler(e) {
        const { selected, group } = e.detail;
        switch (this.selection) {
            case "single":
                this.selectedGroups = [group];
                break;
            case "multiple":
                if (selected) {
                    this.selectGroup(group);
                }
                else {
                    this.deselectGroup(group);
                }
                break;
        }
        this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
    }
    async togglePreview({ detail }) {
        this.store.state.filtersExpanded = false;
        if (!detail || this.store.state.preview === detail.id) {
            this.store.state.preview = null;
            this.previewGroup = null;
            this.arcgisGroupBrowserPreview.emit();
            this.arcgisGroupBrowserSublayerPreview.emit();
        }
        else {
            this.restoreFocusElement = document.activeElement;
            this.store.state.preview = detail.id;
            this.previewGroup = Object.assign({}, detail);
            this.arcgisGroupBrowserPreview.emit(Object.assign({}, detail));
        }
        this.arcgisGroupBrowserInternalUIAction.emit({
            action: this.previewGroup ? "open panel" : "close panel",
            category: "card action"
        });
    }
    async initializeConfig() {
        var _a, _b, _c, _d;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = this.api);
        (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _b !== void 0 ? _b : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user = this.user);
        (_c = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _c !== void 0 ? _c : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = this.portal);
        (_d = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _d !== void 0 ? _d : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config = this.config);
    }
    resetPagination() {
        this.page.start = 1;
        this.page.total = 0;
    }
    getQuery() {
        return Object.assign(Object.assign({ filters: this.store.state.filters, searchUser: this.searchUser, searchTerm: this.searchTerm, baseQuery: this.q }, this.sort), this.page);
    }
    queryGroups(query) {
        if (this.fetch) {
            return this.fetch(query);
        }
        return queryGroups(this.portal, query);
    }
    restoreFocus() {
        if (this.restoreFocusElement) {
            const el = this.restoreFocusElement;
            if (el.restoreFocus) {
                el.restoreFocus();
            }
            else if (el.setFocus) {
                el.setFocus();
            }
            else if (el.focus) {
                el.focus();
            }
        }
    }
    selectGroup(group) {
        if (!this.isSelected(group)) {
            this.selectedGroups = [...this.selectedGroups, group];
        }
    }
    deselectGroup(group) {
        this.selectedGroups = this.selectedGroups.filter(({ id }) => id !== group.id);
    }
    isSelected(group) {
        var _a;
        return (_a = this.selectedGroups) === null || _a === void 0 ? void 0 : _a.some(({ id }) => group.id === id);
    }
    resize({ detail: { width, height } }) {
        this.formFactor = width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
        const oldFormFactor = this.store.state.width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
        /** when going from large to small or small to large, collapse or expand filters, accordingly */
        if (oldFormFactor === "large" && this.formFactor === "small") {
            /** use panel layout if enabled on smaller group browsers */
            this.store.state.panel = this.usePanelLayout;
            this.store.state.filtersExpanded = false;
        }
        if (oldFormFactor === "small" && this.formFactor === "large") {
            /** panel layout won't work on larger group browsers */
            this.store.state.panel = false;
            this.store.state.filtersExpanded = true;
        }
        this.store.state.width = width;
        this.store.state.height = height;
    }
    renderSelected() {
        var _a, _b, _c, _d;
        const wholePageSelected = (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.every((group) => this.isSelected(group));
        const totalSelected = (_b = this.selectedGroups) === null || _b === void 0 ? void 0 : _b.length;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected", { slot: "selection", loading: this.loading, total: (_c = this.currentResults) === null || _c === void 0 ? void 0 : _c.length, totalSelected: totalSelected, emptyText: this.i18n.groupBrowser.noSelectedGroups, heading: this.i18n.groupBrowser.selectedGroups, checked: !this.loading && wholePageSelected, indeterminate: !wholePageSelected && !!totalSelected, onArcgisSelectedDeselectAll: () => {
                this.selectedGroups = [];
                this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
            }, onArcgisSelectedSelectPage: () => {
                var _a;
                (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.forEach((group) => {
                    this.selectGroup(group);
                });
                this.arcgisGroupBrowserSelect.emit(this.selectedGroups);
            } }, (_d = this.selectedGroups) === null || _d === void 0 ? void 0 : _d.map(this.renderSelectedItem)));
    }
    renderSlot(name, defaultContent) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: name }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: name }, defaultContent)));
    }
    render() {
        const { loading, i18n, selectedGroups, selection, currentResponse, store, api, searchTerm, formFactor, height, renderSlot } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser", { preview: !!this.previewGroup, loading: loading, selected: selectedGroups, alwaysShowSelection: selection === "multiple", response: currentResponse, store: store, api: api, formFactor: formFactor, searchTerm: searchTerm, height: height }, renderSlot("top-bar"), renderSlot("sort"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-preview", { slot: "preview", group: this.previewGroup, portal: this.portal, user: this.user, key: this.store.state.preview, onArcgisGroupBrowserPreviewClose: () => {
                this.store.state.preview = null;
                this.previewGroup = null;
                this.arcgisGroupBrowserPreview.emit();
                this.arcgisGroupBrowserSublayerPreview.emit();
                this.restoreFocus();
            }, hidePreviewFooter: this.hidePreviewFooter, showBadges: !this.hidePreviewBadges, currentResponse: this.currentResponse }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer-action" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-footer-action" }))), this.renderSelected(), renderSlot("actions"), renderSlot("content-start"), renderSlot("content"), renderSlot("content-end"), renderSlot("pagination"), renderSlot("filters"), renderSlot("scroll-end"), renderSlot("no-results", i18n.content.noResults), renderSlot("no-content", i18n.content.noContent))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "user": ["updateUser"],
        "portal": ["updatePortal"],
        "api": ["updateAPI"],
        "config": ["updateConfig"],
        "selection": ["updateSelection"],
        "selectedGroups": ["updateSelectedGroups"],
        "q": ["updateQ"]
    }; }
};
ArcgisGroupBrowser.style = arcgisGroupBrowserCss;

const ArcgisGroupBrowserActions = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.actions = [];
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-actions", { actions: this.actions, selection: this.store.state.selectedGroups, store: this.store })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisGroupBrowserContentCss = ":host{--arcgis-group-browser-columns:repeat(1, 1fr);--arcgis-group-browser-gap:0.5rem}.list slot,.compact slot{display:grid;grid-template-columns:var(--arcgis-group-browser-columns)}.compact slot{gap:0px}.list slot{gap:var(--arcgis-group-browser-gap)}";

const ArcgisGroupBrowserContent = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    render() {
        const view = this.store.state.view;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                [view]: true,
                "no-space": this.store.state.width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xs && this.store.state.panel
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserContent.style = arcgisGroupBrowserContentCss;

const ArcgisGroupBrowserFilterDate = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
        this.property = "modified";
        this.range = undefined;
        this.start = undefined;
        this.end = undefined;
        this.expanded = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    getEventDetail(detail) {
        return Object.assign({ param: "q" }, detail);
    }
    render() {
        const { property, range, start, end, store, expanded } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter-date", { serverProperty: property, property: property, store: store, start: start, end: end, range: range, expanded: expanded, onArcgisBrowserFilter: (e) => {
                this.arcgisGroupBrowserFilter.emit(this.getEventDetail(e.detail));
            } }));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterGroupsByUser = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserUsernamesFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserUsernamesFilter", 7);
        this.searchUsernames = undefined;
        this.searchUsername = undefined;
        this.owner = undefined;
        this.expanded = undefined;
        this.allUsernames = [];
        this.selectedUsername = undefined;
    }
    async componentWillLoad() {
        var _a, _b, _c;
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.filterGroupsByUser;
        this.selectedUsername =
            (_b = (_a = this.searchUsername) !== null && _a !== void 0 ? _a : this.searchUsernames[0]) !== null && _b !== void 0 ? _b : (_c = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _c === void 0 ? void 0 : _c.username;
    }
    async searchUsernamesChanged() {
        this.allUsernames = this.searchUsernames;
    }
    async searchUsernameChanged() {
        this.selectedUsername = this.searchUsername;
    }
    render() {
        var _a;
        const { allUsernames, selectedUsername, searchUsername, i18n } = this;
        const currentUsername = (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _a === void 0 ? void 0 : _a.username;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, onArcgisBrowserFilterRemove: () => {
                this.selectedUsername = searchUsername;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const selectedUsername = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.username) || "";
                this.selectedUsername = selectedUsername;
                this.arcgisGroupBrowserUsernamesFilter.emit(selectedUsername);
            } }, allUsernames.map((username) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-username": username, selected: username === selectedUsername }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, username === currentUsername ? i18n.me.replace("${username}", username) : username)))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "searchUsernames": ["searchUsernamesChanged"],
        "searchUsername": ["searchUsernameChanged"]
    }; }
};

const ArcgisGroupBrowserFilterMemberOrg = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
        this.memberOrg = undefined;
        this.orgId = undefined;
        this.expanded = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.filterMemberOrg;
    }
    async componentDidLoad() {
        if (this.memberOrg) {
            this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_10__.a)("memberOrg", this.store, () => (this.memberOrg = null));
    }
    getQueryValue() {
        const { username } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
        const orgid = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.id;
        if (!username || !orgid) {
            return "";
        }
        switch (this.memberOrg) {
            case "myOrg":
                return "memberorgids:NULL";
            case "anotherOrg":
                if (this.orgId) {
                    return `(memberorgids:${this.orgId} OR orgid:${this.orgId})`;
                }
                else {
                    return "-memberorgids:NULL";
                }
            default:
                return "";
        }
    }
    getEventDetail() {
        const { memberOrg, orgId } = this;
        const value = this.getQueryValue();
        const label = this.i18n.label.replace("${label}", this.i18n[memberOrg]);
        return { id: "memberOrg", param: "q", value, label, memberOrg, orgId };
    }
    render() {
        var _a;
        // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44198
        if ((_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.currentMembersAreFrom, expanded: this.expanded, active: !!this.memberOrg, filterID: "memberOrg", onArcgisBrowserFilterRemove: () => {
                this.memberOrg = null;
                this.orgId = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const memberOrg = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.memberOrg) || "";
                if (this.memberOrg === memberOrg) {
                    this.memberOrg = null;
                }
                else {
                    this.memberOrg = memberOrg;
                }
                this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
            } }, ["myOrg", "anotherOrg"].map((memberOrg) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-member-org": memberOrg, selected: memberOrg === this.memberOrg }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[memberOrg])))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterMembership = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
        this.hasIndoorsSpaces = false;
        this.membership = undefined;
        this.expanded = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.filterMembership;
        this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
    }
    async componentDidLoad() {
        if (this.membership) {
            this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_10__.a)("membership", this.store, () => (this.membership = null));
    }
    getQueryValue() {
        // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
        if (this.hasIndoorsSpaces) {
            return "membershipaccess:org";
        }
        switch (this.membership) {
            case "org":
                return "membershipaccess:org";
            case "collaboration":
                return "membershipaccess:collaboration";
            case "anyOrg":
                return "membershipaccess:NULL";
            default:
                return "";
        }
    }
    getEventDetail() {
        const { membership } = this;
        const value = this.getQueryValue();
        const label = this.i18n.label.replace("${label}", this.i18n[membership]);
        return { id: "membership", param: "q", value, label, membership };
    }
    render() {
        var _a;
        if (
        // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
        this.hasIndoorsSpaces ||
            (
            // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44198
            (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal)) {
            // This will relies on the event emitted in `componentDidLoad` to set the proper base q value
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.groupMembershipSetting, expanded: this.expanded, active: !!this.membership, filterID: "membership", onArcgisBrowserFilterRemove: () => {
                this.membership = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const membership = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.membership) || "";
                if (this.membership === membership) {
                    this.membership = null;
                }
                else {
                    this.membership = membership;
                }
                this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
            } }, ["org", "collaboration", "anyOrg"].map((membership) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-membership": membership, selected: membership === this.membership }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[membership])))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilterOwner = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
        this.hasIndoorsSpaces = false;
        this.searchUsername = undefined;
        this.owner = undefined;
        this.expanded = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.filterOwner;
        this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
    }
    async componentDidLoad() {
        var _a, _b;
        if (this.owner) {
            this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_10__.a)("owner", this.store, () => (this.owner = null));
        (_a = this.searchUsername) !== null && _a !== void 0 ? _a : (this.searchUsername = (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _b === void 0 ? void 0 : _b.username);
    }
    getQueryValue() {
        var _a, _b, _c;
        const username = (_a = this.searchUsername) !== null && _a !== void 0 ? _a : (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _b === void 0 ? void 0 : _b.username;
        const orgId = (_c = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _c === void 0 ? void 0 : _c.id;
        // We don't want to return empty string even if orgId is empty
        //  to make sure the query value still has the correct syntax
        // This mimics behavior on prod
        // TODO: find a better way to filter that out in R3
        if (!username) {
            return "";
        }
        switch (this.owner) {
            case "owner":
                return `owner:${username}`;
            case "inOrg":
                return `-owner:${username} orgid:${orgId}`;
            case "outsideOrg":
                // this magic SQL query gets all org ids and then removes the current org
                return `(orgid: [0 TO \{]) -orgid:${orgId}`;
            default:
                return "";
        }
    }
    getEventDetail() {
        const { owner, searchUsername: username } = this;
        const value = this.getQueryValue();
        const label = this.i18n.label.replace("${label}", owner === "owner" ? username : this.i18n[owner]);
        return { id: "owner", param: "q", value, label, owner, username };
    }
    getOwnerText(owner) {
        if (owner === "owner") {
            return this.searchUsername;
        }
        if (owner === "outsideOrg") {
            return this.i18n[(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_11__.a)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) ? "someoneElse" : "outsideOrg"];
        }
        return this.i18n[owner];
    }
    searchUsernameChanged() {
        this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
    }
    render() {
        const user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
        const username = user === null || user === void 0 ? void 0 : user.username;
        if (!username) {
            return null;
        }
        const filters = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_11__.a)(user)
            ? ["owner", "outsideOrg"]
            : ["owner", "inOrg", "outsideOrg"];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.owner, expanded: this.expanded, active: !!this.owner, filterID: "owner", onArcgisBrowserFilterRemove: () => {
                this.owner = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const owner = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.owner) || "";
                if (this.owner === owner) {
                    this.owner = null;
                }
                else {
                    this.owner = owner;
                }
                this.arcgisGroupBrowserFilter.emit(this.getEventDetail());
            } }, filters
            .filter((value) => !(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal || this.hasIndoorsSpaces) || value !== "outsideOrg")
            .map((owner) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-owner": owner, selected: owner === this.owner }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.getOwnerText(owner))))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "searchUsername": ["searchUsernameChanged"]
    }; }
};

async function getOrgSettingsGroupsQuery(portal) {
    var _a, _b, _c, _d, _e, _f;
    let queryStrings = [];
    const orgSettingsQueries = [
        // Org Settings > Gallery
        portal.featuredItemsGroupQuery,
        // Org Settings > Map
        portal.basemapGalleryGroupQuery,
        portal.templatesGroupQuery,
        portal["2DStylesGroupQuery"],
        (_a = portal.stylesGroupQuery) !== null && _a !== void 0 ? _a : (_b = portal.sourceJSON) === null || _b === void 0 ? void 0 : _b.stylesGroupQuery,
        (_c = portal.analysisLayersGroupQuery) !== null && _c !== void 0 ? _c : (_d = portal.sourceJSON) === null || _d === void 0 ? void 0 : _d.analysisLayersGroupQuery,
        // Org Settings > Groups > Configuriable Apps
        portal.galleryTemplatesGroupQuery
    ];
    // Org Settings > Home Page
    if ((0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.j)(portal)) {
        const homePageConfig = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.k)(portal);
        const contentGalleries = ((_e = homePageConfig === null || homePageConfig === void 0 ? void 0 : homePageConfig.content) === null || _e === void 0 ? void 0 : _e.filter((content) => content.type === "gallery" && !!content.groupId)) || [];
        if (contentGalleries.length > 0) {
            contentGalleries.forEach(({ groupId }) => {
                const query = `id:${groupId}`;
                queryStrings = addToQueryString(query, queryStrings);
            });
        }
    }
    else {
        orgSettingsQueries.push(portal.homePageFeaturedContent);
    }
    orgSettingsQueries.forEach((query) => {
        queryStrings = addToQueryString(query, queryStrings);
    });
    // Org Settings > Featured Groups
    portal.featuredGroups.forEach((featuredGroup) => {
        if (featuredGroup.id) {
            const query = `id:${featuredGroup.id}`;
            queryStrings = addToQueryString(query, queryStrings);
        }
        else {
            // in enterprise, some groups don't use ids, so commit the full assembled query
            const queryParts = Object.entries(featuredGroup).map((entry) => `${entry[0]}:"${entry[1]}"`);
            const query = `(${queryParts.join(" ")})`;
            queryStrings = addToQueryString(query, queryStrings, true);
        }
    });
    // Org Settings > Member Defaults
    const memberDefaults = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.l)(portal);
    (_f = memberDefaults === null || memberDefaults === void 0 ? void 0 : memberDefaults.groups) === null || _f === void 0 ? void 0 : _f.forEach((id) => {
        const query = `id:${id}`;
        queryStrings = addToQueryString(query, queryStrings);
    });
    return queryStrings.length > 0 ? `(${queryStrings.join(" OR ")})` : "";
}
function addToQueryString(query, queryStrings, allowNonId) {
    if (((query === null || query === void 0 ? void 0 : query.indexOf("id:")) !== 0 && !allowNonId) || queryStrings.includes(query)) {
        return [...queryStrings];
    }
    return [...queryStrings, query];
}

const ArcgisGroupBrowserFilterSpecialGroups = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserFilter", 7);
        this.hasIndoorsSpaces = false;
        this.specialGroup = undefined;
        this.expanded = undefined;
        this.options = [];
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.filterSpecialGroups;
        this.hasIndoorsSpaces = this.store.state.hasIndoorsSpaces;
        this.validateOptions();
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => this.validateOptions());
    }
    async validateOptions() {
        if (!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            return (this.options = []);
        }
        const settingsQuery = await getOrgSettingsGroupsQuery(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
        this.options = ["openData", "sharedUpdate", "distributed", "admin", "settings"].filter((option) => {
            return !((option === "openData" && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal) ||
                // https://devtopia.esri.com/webgis/arcgis-portal-app/issues/37831
                (option === "distributed" && this.hasIndoorsSpaces) ||
                // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/45449 orgs with no settings groups configured don't need this option
                (option === "settings" && !settingsQuery));
        });
    }
    async componentDidLoad() {
        if (this.specialGroup) {
            this.arcgisGroupBrowserFilter.emit(await this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_10__.a)("specialGroups", this.store, () => (this.specialGroup = null));
    }
    async getQueryValue() {
        switch (this.specialGroup) {
            case "openData":
                return "isopendata:true";
            case "sharedUpdate":
                return "capabilities:updateitemcontrol";
            case "distributed":
                return "capabilities:distributed";
            case "admin":
                return "isleavingdisallowed:true";
            case "settings":
                return await getOrgSettingsGroupsQuery(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
            default:
                return "";
        }
    }
    async getEventDetail() {
        const { specialGroup } = this;
        const value = await this.getQueryValue();
        const label = this.i18n.label.replace("${label}", this.i18n[specialGroup]);
        return { id: "specialGroups", param: "q", value, label, specialGroups: specialGroup };
    }
    render() {
        if (!(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal)) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.specialGroup, filterID: "specialGroups", onArcgisBrowserFilterRemove: async () => {
                this.specialGroup = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: async (event) => {
                var _a, _b;
                const node = event.target;
                const specialGroups = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.specialGroups) || "";
                if (this.specialGroup === specialGroups) {
                    this.specialGroup = null;
                }
                else {
                    this.specialGroup = specialGroups;
                }
                this.arcgisGroupBrowserFilter.emit(await this.getEventDetail());
            } }, this.options.map((specialGroups) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-special-groups": specialGroups, selected: specialGroups === this.specialGroup }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[specialGroups], specialGroups === "settings" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { style: { verticalAlign: "-.25rem", "--arcgis-information-min-width": "0" }, label: this.i18n.tooltipLabel, overlayPositioning: "fixed", placement: "bottom-end", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.i18n.tooltip))))))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserFilters = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filters", { store: this.store }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "top" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "top" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bottom" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bottom" }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisGroupBrowserPaginationCss = ".wrapper{display:flex;justify-content:center;padding-left:0.5rem;padding-right:0.5rem;padding-top:2rem;padding-bottom:2rem}.hide{display:none}";

const ArcgisGroupBrowserPagination = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPage", 7);
        this.total = undefined;
        this.start = undefined;
        this.num = 60;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    render() {
        const { start, total, num, store } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-pagination", { start: start, total: total, num: num, store: store, onArcgisBrowserPage: (e) => this.arcgisGroupBrowserPage.emit(e.detail) }));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserPagination.style = arcgisGroupBrowserPaginationCss;

async function fetchGroupMembers(groupId, portal, params = {}) {
    const restBase = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal);
    const url = `${restBase}community/groups/${groupId}/userlist`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, params);
}

const arcgisGroupBrowserPreviewCss = ":host{display:flex;height:100%;width:100%;flex:1 1 0%;flex-direction:column;background-color:var(--calcite-color-background)}.preview__header{margin-inline-start:0.75rem}.preview__title{margin:0px;overflow-wrap:break-word;padding:0px;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);line-height:1.375}.title{margin-top:0.75rem;margin-bottom:0.75rem;padding:0px;font-size:1.125rem;font-weight:500;color:var(--calcite-color-text-1);word-wrap:break-word;word-break:break-word}.badges{margin-top:1rem}.badges[empty]{display:none}calcite-accordion-item{--calcite-accordion-item-padding:1rem 1rem;--calcite-accordion-item-background:var(--calcite-color-foreground-1);width:100%;box-sizing:border-box;border-bottom:1px solid var(--calcite-color-border-2)}.section{background-color:var(--calcite-color-background);padding:1rem;margin:0rem -1rem calc(-1rem - 1px);line-height:1.35}.section--tight{padding-top:0px;padding-bottom:0px;padding-left:0px;padding-right:0px}.section--centered{display:flex;width:100%;flex-direction:column;align-items:center;row-gap:0.75rem}.full-card-wrapper{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.75rem}.details-title{margin-top:1rem;margin-bottom:0px;padding-bottom:0.25rem;padding-top:0px;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-3);--calcite-label-margin-bottom:0}.details-title:first-of-type{margin-top:0px}.details-title--label{padding-bottom:0px}.details-text{margin:0px;overflow-wrap:break-word;padding:0px;font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-1)}.details-text a{color:var(--calcite-color-text-link)}.details--text-empty{font-weight:400;color:var(--calcite-color-text-3)}.details-link{margin-top:0.75rem}.description{overflow-wrap:break-word;line-height:1.35}.description *{font-size:0.875rem !important}.icon-xl{height:3rem;width:3rem}.content-card{margin-bottom:0.25rem}.content-thumbnail{margin-top:auto;margin-bottom:auto;width:100%;margin-inline-end:1rem}.settings-text{margin-top:-0.25rem;margin-bottom:-0.25rem;font-size:0.875rem;font-weight:400}.footer-actions{display:flex;width:100%;flex-direction:column;row-gap:0.5rem;padding:1rem}.block--padded{padding-bottom:1rem;padding-inline-start:0.25rem}";

const ArcgisGroupBrowserPreview = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserPreviewClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreviewClose", 7);
        this.arcgisGroupBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
        this.group = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.hidePreviewFooter = false;
        this.showBadges = true;
        this.currentResponse = undefined;
        this.fullGroup = undefined;
        this.userInfo = undefined;
        this.content = undefined;
        this.managers = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.lang = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.a)(this.el);
        this.i18n = this.store.state.i18n.preview;
        this.init();
    }
    updatePreview() {
        this.init();
    }
    async init() {
        var _a, _b, _c;
        if (!this.group) {
            return;
        }
        const { group, portal, user } = this;
        this.isGroupOwner = group.owner === (user === null || user === void 0 ? void 0 : user.username);
        this.fullGroup = null;
        this.fullGroup = await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.m)((0,_items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.f)(group.id, this.portal), 600);
        this.userInfo = await (0,_user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_14__.f)(group.owner, portal);
        const contentQuery = this.getTypeQuery(this.fullGroup);
        this.content = await (((_b = (_a = this.fullGroup.properties) === null || _a === void 0 ? void 0 : _a.featuredItemIds) === null || _b === void 0 ? void 0 : _b.length) &&
            this.fullGroup.properties.isFeatured
            ? queryFeaturedContent(portal, group.id, this.fullGroup.properties.featuredItemIds)
            : queryGroupContent(portal, group.id, Object.assign({ sortField: this.fullGroup.sortField || "modified", sortOrder: this.fullGroup.sortOrder || "desc" }, (contentQuery ? { q: contentQuery } : {}))));
        this.managers = await this.fetchGroupAdmins(portal, group);
        (_c = this.flowItem) === null || _c === void 0 ? void 0 : _c.setFocus();
    }
    handleAccordionItemClick(element, details) {
        this.arcgisGroupBrowserInternalUIAction.emit({
            action: element.expanded ? "expand" : "collapse",
            category: "group panel action",
            details
        });
    }
    closePreview() {
        this.fullGroup = null;
        this.arcgisGroupBrowserInternalUIAction.emit({
            action: "close panel",
            category: "group panel action"
        });
        this.arcgisGroupBrowserPreviewClose.emit();
    }
    handleDetailsClick(details) {
        this.arcgisGroupBrowserInternalUIAction.emit({
            action: "click",
            category: "group panel action",
            details
        });
    }
    renderHeader() {
        var _a;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content", class: "preview__header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "preview__title" }, (_a = this.group) === null || _a === void 0 ? void 0 : _a.title)));
    }
    isAccordionItem(element) {
        return element.tagName === "CALCITE-ACCORDION-ITEM";
    }
    getViewByText(group) {
        switch (group.access) {
            case "public":
                return this.i18n.everyone;
            case "private":
                return this.i18n.onlyMembers;
            case "org":
                return this.i18n.onlyOrganization;
            case "shared":
                return this.i18n.onlyOrganizationAndPartners;
        }
    }
    getJoinByText(group) {
        if (group.autoJoin) {
            return this.i18n.byAutojoin;
        }
        if (group.isInvitationOnly) {
            return this.i18n.byInvitation;
        }
        if (group.providerGroupName) {
            return this.i18n.byEnterprise;
        }
        return this.i18n.byRequest;
    }
    async fetchGroupAdmins(portal, group) {
        var _a, _b;
        const admins = (_b = (_a = (await fetchGroupMembers(group.id, portal, { memberType: "admin" }))) === null || _a === void 0 ? void 0 : _a.users) !== null && _b !== void 0 ? _b : [];
        const owner = admins.find((admin) => admin.username === group.owner);
        return [owner, ...admins.filter((admin) => admin.username !== owner.username)];
    }
    getTypeQuery(group) {
        var _a;
        if ((_a = group.displaySettings) === null || _a === void 0 ? void 0 : _a.itemTypes) {
            const itemType = group.displaySettings.itemTypes.split(",")[0].toLowerCase();
            switch (itemType) {
                case "application":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.applications.q;
                case "web map":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.maps.q;
                case "web scene":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.scenes.q;
                case "locator package":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.tools.q;
                case "csv":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.files.q;
                case "layer":
                    return _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_12__.i.layers.q;
                default:
                    return "";
            }
        }
    }
    render() {
        const { group, fullGroup, i18n, managers, portal, content, showBadges, user } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, loading: !fullGroup, onCalciteFlowItemClose: () => this.closePreview(), ref: (el) => (this.flowItem = el) }, this.renderHeader(), fullGroup && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion", { "icon-position": "start", appearance: "transparent", key: group.id, class: "accordion" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.overview, expanded: Boolean(fullGroup.snippet), ref: (el) => {
                this.overviewElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.overviewElement, "overview") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullGroup.snippet ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text" }, fullGroup.snippet)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noSummary)), showBadges && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-badges", { group: fullGroup, portal: portal, showTooltips: false, width: "full", scale: "s", appearance: "outline-fill", class: "badges" })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.description, key: "description", ref: (el) => {
                this.descriptionElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.descriptionElement, "description") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullGroup.description ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description", innerHTML: (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.s)(fullGroup.description) })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.content.replace("${count}", content ? `${content.total}` : "0"), expanded: true, ref: (el) => {
                this.contentElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.contentElement, "content") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { section: true, "section--tight": (content === null || content === void 0 ? void 0 : content.total) > 0 } }, (content === null || content === void 0 ? void 0 : content.total) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "full-card-wrapper" }, content.results.map((item) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-browser-preview-card", { class: "content-card", item: item, portal: portal, user: user, key: item.id }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link block--padded" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_660bb43a_js__WEBPACK_IMPORTED_MODULE_13__.g)(portal)}/home/group.html?id=${group.id}&view=list#content`, onClick: () => {
                this.handleDetailsClick("view all content");
            } }, i18n.viewContent)))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section--centered" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "l", icon: "files", class: "icon-xl details-text--empty" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noContent))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.groupManagers.replace("${count}", managers ? `${managers.length}` : "0"), expanded: true, ref: (el) => {
                this.managersElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.managersElement, "managers") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "full-card-wrapper" }, managers === null || managers === void 0 ? void 0 :
            managers.map((admin) => {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-card", { key: admin.username, class: "content-card" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { heading: admin.username === group.owner
                        ? i18n.groupOwner.replace("${fullName}", (0,_user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_14__.g)(admin, this.lang))
                        : admin.fullName, showName: true, user: admin, description: admin.username, portal: portal })));
            }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link block--padded" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_660bb43a_js__WEBPACK_IMPORTED_MODULE_13__.g)(portal)}/home/group.html?id=${group.id}#members`, onClick: () => {
                this.handleDetailsClick("open members page");
            } }, i18n.openMembers))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.settings, expanded: this.isGroupOwner, ref: (el) => {
                this.settingsElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.settingsElement, "settings") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.viewableBy, ":"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, this.getViewByText(fullGroup)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.contributors, ":"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, fullGroup.isViewOnly ? i18n.onlyOwnerManager : i18n.allMembers), this.isGroupOwner && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.joinMethod, ":"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "settings-text" }, this.getJoinByText(fullGroup)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-link" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${(0,_portal_660bb43a_js__WEBPACK_IMPORTED_MODULE_13__.g)(portal)}/home/group.html?id=${group.id}#settings`, onClick: () => {
                this.handleDetailsClick("open settings");
            } }, i18n.openSettings))))))))), !this.hidePreviewFooter && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, portal && group && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { onClick: () => {
                var _a;
                const { currentResponse, group } = this;
                const index = (_a = currentResponse === null || currentResponse === void 0 ? void 0 : currentResponse.results) === null || _a === void 0 ? void 0 : _a.findIndex((result) => result.id === group.id);
                const position = index + currentResponse.start;
                this.arcgisGroupBrowserInternalUIAction.emit({
                    action: "view group details",
                    category: "group panel action",
                    position
                });
            }, href: `${(0,_portal_660bb43a_js__WEBPACK_IMPORTED_MODULE_13__.g)(portal)}/home/group.html?id=${group.id}`, kind: "neutral", appearance: "solid", width: "full" }, i18n.viewDetails)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "footer-action" })))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "group": ["updatePreview"]
    }; }
};
ArcgisGroupBrowserPreview.style = arcgisGroupBrowserPreviewCss;

const arcgisGroupBrowserPreviewCardCss = ":host{display:block;min-width:0px}.card{position:relative;box-sizing:border-box;display:flex;height:100%;width:100%;flex-direction:column;color:var(--calcite-color-text-1);opacity:0;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-duration:150ms;outline-color:transparent;background-color:var(--calcite-color-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-color-border-3)}.card:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.card--loaded{opacity:1}.card--selected{border-color:var(--calcite-color-brand)}.card--hoverable{cursor:pointer}.card__top{padding:0.75rem}.card__upper{flex:1 1 0%;background-color:var(--calcite-color-foreground-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.card--hoverable .card__upper:hover{background-color:var(--calcite-color-background)}.card__upper--link{color:var(--calcite-color-text-1);text-decoration-line:none;outline-color:transparent}.card__upper--link:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:2px}.card__content{display:flex;min-width:0px;flex:1 1 0%;flex-direction:column}.card__details{margin-top:0.25rem;display:flex;flex-direction:row}.card__detail{font-size:0.75rem;color:var(--calcite-color-text-2)}.card__footer{margin-top:auto;display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;border-top:1px solid var(--calcite-color-border-2)}.card__footer__start{display:flex;min-width:0px;flex:1 1 0%;flex-direction:row;align-items:center;overflow:hidden;margin-inline-end:0.75rem}.card__footer__start--owner{margin-inline-start:-0.25rem}.card__profile-wrap{box-sizing:border-box;max-width:100%;padding:0.25rem}.card__summary{margin:0px;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-2)}.card__divider{display:flex;align-items:center;flex:0 0 auto}.card__divider:not([empty]):before{content:\"\";height:1.25rem;width:1px;background-color:var(--calcite-color-border-1);margin-inline:0.75rem}.card__divider:first-child:before{display:none}.card-flex{display:flex}.card-flex-1{min-width:0px;flex:1 1 0%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.card__title{margin-top:0px;margin-bottom:0px;height:2rem;overflow:hidden;overflow-wrap:break-word;padding-top:0px;padding-bottom:0px;font-size:0.875rem;font-weight:500;line-height:1.15;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.card__title--padded{margin-bottom:0.5rem}.card__snippet{margin:0px;margin-bottom:0.75rem;flex:1 1 0%;padding:0px;font-size:0.875rem}.card__badges--stacked{margin-top:0.5rem}.card__thumbnail{margin:0px;box-sizing:content-box;width:4rem;padding:0px;padding-inline-start:0.5rem}.card__owner{min-width:0px}";

const ArcgisGroupBrowserPreviewCard = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserInternalUIAction", 7);
        this.arcgisGroupBrowserPreviewCardSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserPreviewCardSelect", 7);
        var _a;
        this.handleCardClick = () => {
            // when using the cards as a link, don't do any special handling
            if (this.link) {
                return;
            }
            this.arcgisGroupBrowserPreviewCardSelect.emit(this.item);
        };
        this.item = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.api = 4;
        this.baseUrl = (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
        this.link = undefined;
        this.newTab = undefined;
        this.showThumbnail = true;
        this.showOwner = true;
        this.showItemType = true;
        this.showDateUpdated = false;
        this.showSummary = false;
        this.showBadges = false;
        this.showOwnerPopup = false;
        this.interactive = false;
        this.hover = undefined;
        this.updatedText = "";
        this.loaded = undefined;
    }
    /* Calling this setFocus causes calcite to focus here when the user popup is closed... */
    async restoreFocus() {
        if (this.link && this.linkEl) {
            this.linkEl.focus();
            return;
        }
        if (this.sectionEl) {
            this.sectionEl.focus();
            return;
        }
    }
    async componentWillLoad() {
        var _a, _b, _c;
        //this.store = getGroupBrowserStore(this.el);
        //this.i18n = this.store.state.i18n.previewCard;
        this.updatedText = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_15__.a)(this.item.modified);
        this.portal = (_a = this.portal) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
        this.user = (_b = this.user) !== null && _b !== void 0 ? _b : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
        this.api = (_c = this.api) !== null && _c !== void 0 ? _c : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api;
    }
    async componentDidLoad() {
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
        this.loaded = true;
    }
    render() {
        var _a, _b;
        const { item, user, portal, api, 
        //i18n,
        loaded, showDateUpdated, showItemType, showOwner, showOwnerPopup, showBadges, showSummary, showThumbnail, interactive, link, newTab } = this;
        const baseUrl = (_a = this.baseUrl) !== null && _a !== void 0 ? _a : (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _b === void 0 ? void 0 : _b.baseUrl;
        const CardTag = this.link ? "a" : "div";
        const linkAttributes = Object.assign({ href: link }, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {}));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", Object.assign({ class: {
                "card": true,
                "card--hoverable": interactive,
                "card--loaded": loaded
            } }, (interactive ? { onMouseOver: () => (this.hover = true) } : {}), (interactive ? { onMouseOut: () => (this.hover = false) } : {}), (link ? {} : { onClick: this.handleCardClick }), { ref: (el) => (this.sectionEl = el) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-top" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(CardTag, Object.assign({ class: { "card__upper": true, "card__upper--link": !!link } }, (link ? linkAttributes : {}), { ref: (el) => (this.linkEl = el) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex card__top" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex-1" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card-flex" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: {
                "card__title": true,
                "card__title--padded": showItemType || (showSummary && !!item.snippet)
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "card__title__span" }, item.title)), showSummary && item.snippet && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "card__summary" }, item.snippet.length > 250
            ? `${item.snippet.substring(0, 250)}…`
            : item.snippet)), showItemType && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { scale: "s", item: item, portal: portal }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__details" }, showDateUpdated && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: {
                "card__detail": true,
                "card__divider": true
            } }, this.updatedText)), showBadges && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { item: item, user: user, portal: portal, width: "narrow", showTooltips: true, class: {
                "card__badges": true,
                "card__divider": true
            }, scale: "s" })))), showThumbnail && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "card__thumbnail" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }))))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__footer", onClick: (e) => {
                e.stopPropagation();
            }, onKeyPress: (e) => {
                if (e.key === "Enter" || e.key == " ") {
                    e.stopPropagation();
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "card__footer__start": true,
                "card__footer__start--owner": showOwner
            } }, showOwner && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__profile-wrap", onClick: (e) => {
                e.preventDefault();
                e.stopPropagation();
            } }, showOwnerPopup ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { underline: true, username: item.owner, api: api, portal: portal, baseUrl: baseUrl, showAvatar: false, class: "card__owner", scale: "s", onArcgisUserPopupInternalUIAction: (e) => {
                e.stopPropagation();
                this.arcgisGroupBrowserInternalUIAction.emit(e.detail);
            } })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { slot: "footer-start", scale: "s", showName: true, showAvatar: false, username: item.owner, portal: portal }))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-end" })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserPreviewCard.style = arcgisGroupBrowserPreviewCardCss;

const arcgisGroupBrowserSearchCss = ":host{position:relative;display:block}.search{pointer-events:none;position:absolute;z-index:10;margin-top:1rem;font-size:0.875rem;color:var(--calcite-color-text-1);inset-inline-start:1.5rem}.x{position:absolute;top:0px;z-index:10;margin-top:0.25rem;cursor:pointer;border-style:none;padding:0.5rem;color:var(--calcite-color-text-1);outline:2px solid transparent;outline-offset:2px;inset-inline-end:0.25rem;background:transparent}.input{position:relative;z-index:0;box-sizing:border-box;display:block;height:3rem;width:100%;border-style:none;padding-top:1rem;padding-bottom:1rem;padding-left:3rem;padding-right:3rem;font-size:0.875rem;color:var(--calcite-color-text-1);--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;transition-duration:150ms;background-color:transparent;border-bottom:2px solid transparent;font-family:inherit}.input::-webkit-search-cancel-button{display:none}.input::-ms-clear{display:none}.input:focus{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);outline:2px solid transparent;outline-offset:2px;border-bottom-color:var(--calcite-color-brand)}";

const ArcgisGroupBrowserSearch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserSearch = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSearch", 7);
        this.arcgisGroupBrowserSearchInput = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSearchInput", 7);
        this.term = undefined;
        this.placeholder = undefined;
        this.showClear = false;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.i18n = this.store.state.i18n.search;
    }
    render() {
        const { term, placeholder } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-search", { term: term, placeholder: placeholder || this.i18n.label, onArcgisBrowserSearch: (e) => this.arcgisGroupBrowserSearch.emit(e.detail), onArcgisBrowserSearchInput: (e) => this.arcgisGroupBrowserSearchInput.emit(e.detail) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisGroupBrowserSearch.style = arcgisGroupBrowserSearchCss;

const ArcgisGroupBrowserSort = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisGroupBrowserSort = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisGroupBrowserSort", 7);
        var _a;
        this.options = ["title", "relevance", "modified"];
        this.field = ((_a = this.options) === null || _a === void 0 ? void 0 : _a[0]) || "relevance";
        this.order = undefined;
        this.activeField = undefined;
        this.activeOrder = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
        this.activeField = this.field;
    }
    componentDidLoad() {
        this.arcgisGroupBrowserSort.emit({
            sortField: this.field,
            sortOrder: this.order || (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_16__.a)(this.field)
        });
    }
    updateSortField(field) {
        this.activeField = field;
        this.activeOrder = (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_16__.a)(field);
        this.arcgisGroupBrowserSort.emit({
            sortField: this.activeField,
            sortOrder: this.activeOrder
        });
    }
    updateSortOrder(order) {
        this.activeOrder = order;
        this.arcgisGroupBrowserSort.emit({
            sortField: this.activeField,
            sortOrder: this.activeOrder
        });
    }
    render() {
        const { activeField, activeOrder, field, order, options } = this;
        const selectedField = activeField || (options.includes(field) ? field : options[0]);
        const selectedOrder = activeOrder || order;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-sort", { store: this.store, field: selectedField, order: selectedOrder, options: options, onArcgisBrowserSortFieldChange: (e) => this.updateSortField(e.detail), onArcgisBrowserSortOrderChange: (e) => this.updateSortOrder(e.detail) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisGroupBrowserTopBar = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    }
    async componentWillLoad() {
        this.store = (0,_store_da3fccd5_js__WEBPACK_IMPORTED_MODULE_9__.g)(this.el);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-top-bar", { store: this.store }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-start" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-start" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "search" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "search" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};



//# sourceMappingURL=arcgis-group-browser_16.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-660bb43a.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-660bb43a.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getPortalBaseUrl)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
function getPortalBaseUrl(portal) {
    const { customBaseUrl, portalHostname, urlKey } = portal;
    const { protocol } = window.location;
    const url = urlKey ? `${urlKey}.${customBaseUrl}` : portalHostname;
    return `${protocol}//${url}`;
}



//# sourceMappingURL=portal-660bb43a.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   H: () => (/* binding */ HIDDEN_ITEMS_QUERY)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const HIDDEN_ITEMS_QUERY = `-type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" -type:"Map Area" -typekeywords:"MapAreaPackage" -type:"Indoors Map Configuration" -typekeywords:"SMX"`;



//# sourceMappingURL=query-d62660d4.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-da3fccd5.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-da3fccd5.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ groupBrowserState),
/* harmony export */   g: () => (/* binding */ getGroupBrowserStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function getGroupBrowserStore(el) {
    return (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_1__.g)(el, "arcgis-group-browser");
}
const GroupBrowserStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({ filters: {} });
const groupBrowserState = GroupBrowserStore.state;



//# sourceMappingURL=store-da3fccd5.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ cleanSearchTerm)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function cleanSearchTerm(term = "") {
    // sanitize input if it contains html
    const sanitizedSearchTerm = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.s)(term);
    // escape question marks, angle brackets, square brackets, etc
    const escapedTerm = sanitizedSearchTerm.replace(/[<>\/\\[\]\?]/g, "\\$&");
    return escapedTerm.trim();
}



//# sourceMappingURL=string-58a5fef3.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTUxZjdkNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3JFO0FBQ3NCO0FBQ2lCO0FBQ1I7QUFDa0I7QUFDdEI7QUFDc0U7QUFDNUY7QUFDSTtBQUNDO0FBQ0o7QUFDZTtBQUNmO0FBQ1M7QUFDVDtBQUNFO0FBQzVCO0FBQ1I7QUFDQztBQUNDO0FBQ0E7O0FBRTdCO0FBQ0EscUJBQXFCLHNEQUFjO0FBQ25DLG1CQUFtQixTQUFTO0FBQzVCLFlBQVksK0VBQStFO0FBQzNGLCtDQUErQztBQUMvQyxrQ0FBa0Msc0RBQWUsYUFBYTtBQUM5RCxxREFBcUQsa0JBQWtCLDhEQUE4RCxJQUFJLE1BQU0sTUFBTSxpQkFBaUIsRUFBRSxLQUFLLEdBQUc7QUFDaEw7QUFDQSxnQkFBZ0IsZUFBZTtBQUMvQiw2Q0FBNkMsYUFBYSxZQUFZLHFCQUFxQixFQUFFLE1BQU0sR0FBRztBQUN0RyxLQUFLO0FBQ0wsaURBQWlEO0FBQ2pELGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsc0JBQXNCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0RBQU87QUFDbEMseUNBQXlDLGVBQWUsdUNBQXVDO0FBQy9GO0FBQ0EsNkRBQTZEO0FBQzdELHFCQUFxQixzREFBYztBQUNuQyxtQkFBbUIsU0FBUyxpQkFBaUIsUUFBUTtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0RBQU8sb0NBQW9DO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzREFBYztBQUNuQyxtQkFBbUIsU0FBUyxpQkFBaUIsUUFB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b0RBQWU7QUFDMUM7QUFDQTtBQUNBLDhCQUE4QixvREFBYTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxvREFBb0I7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXliOztBQUV6Yjs7Ozs7Ozs7Ozs7Ozs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFbUM7O0FBRW5DOzs7Ozs7Ozs7Ozs7Ozs7OztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEO0FBQ0g7O0FBRXBEO0FBQ0EsV0FBVyxxREFBUTtBQUNuQjtBQUNBLDBCQUEwQixxREFBVyxHQUFHLGFBQWE7QUFDckQ7O0FBRTZEOztBQUU3RDs7Ozs7Ozs7Ozs7Ozs7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDc0Q7O0FBRXREO0FBQ0E7QUFDQSxnQ0FBZ0MsbURBQVk7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7O0FBRWdDOztBQUVoQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1ncm91cC1icm93c2VyXzE2LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tMzUzNTU1MmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vcG9ydGFsLTY2MGJiNDNhLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3ByaXZpbGVnZXMtNWMzODJmNjEuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vcXVlcnktZDYyNjYwZDQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc3RvcmUtZGEzZmNjZDUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc3RyaW5nLTU4YTVmZWYzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCwgRiBhcyBGcmFnbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSwgbyBhcyBvbkNvbmZpZ0NoYW5nZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5LCBzIGFzIHNhbml0aXplSFRNTCB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGQgYXMgZGVib3VuY2UsIHQgYXMgdGltZW91dCwgbSBhcyBtaW5EZWxheSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MsIGEgYXMgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgcyBhcyBzZXR1cFJlc2l6ZU9ic2VydmVyLCBiIGFzIGJyZWFrcG9pbnRzIH0gZnJvbSAnLi9yZXNpemUtYTE3YjcyOTIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRSZXN0QmFzZVVybCwgciBhcyByZXF1ZXN0LCBqIGFzIGhhc01vZGVybkhvbWVQYWdlRW5hYmxlZCwgayBhcyBnZXRIb21lUGFnZUNvbmZpZywgbCBhcyBnZXRNZW1iZXJEZWZhdWx0cyB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY2xlYW5TZWFyY2hUZXJtIH0gZnJvbSAnLi9zdHJpbmctNThhNWZlZjMuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRHcm91cEJyb3dzZXJTdG9yZSB9IGZyb20gJy4vc3RvcmUtZGEzZmNjZDUuanMnO1xuaW1wb3J0IHsgYSBhcyBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUgfSBmcm9tICcuL3N0b3JlLThiMWIwODQ2LmpzJztcbmltcG9ydCB7IGEgYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hHcm91cCwgaSBhcyBpdGVtVHlwZU9wdGlvbnMgfSBmcm9tICcuL2l0ZW1zLWE0ZjVlOThiLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UG9ydGFsQmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLTY2MGJiNDNhLmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hVc2VyLCBnIGFzIGdldEZ1bGxOYW1lIH0gZnJvbSAnLi91c2VyLTBmYTlmZjVhLmpzJztcbmltcG9ydCB7IGEgYXMgZm9ybWF0RGF0ZSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0RGVmYXVsdFNvcnRPcmRlciB9IGZyb20gJy4vdXRpbHMtMmY0NTlkNmQuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL2dyb3VwLTZhNjMwM2IwLmpzJztcbmltcG9ydCAnLi9xdWVyeS1kNjI2NjBkNC5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIHF1ZXJ5R3JvdXBzKHBvcnRhbCwgcXVlcnkpIHtcbiAgICBjb25zdCByZXN0QmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3QgdXJsID0gYCR7cmVzdEJhc2V9Y29tbXVuaXR5L2dyb3Vwc2A7XG4gICAgY29uc3QgeyBudW0sIHN0YXJ0LCBzb3J0T3JkZXIsIHNvcnRGaWVsZCwgZmlsdGVycywgYmFzZVF1ZXJ5LCBzZWFyY2hUZXJtLCBzZWFyY2hVc2VyIH0gPSBxdWVyeTtcbiAgICBjb25zdCBmaWx0ZXJJZHMgPSBPYmplY3Qua2V5cyhmaWx0ZXJzIHx8IHt9KTtcbiAgICBjb25zdCB0ZXJtID0gc2VhcmNoVGVybSA/IGAoJHtjbGVhblNlYXJjaFRlcm0oc2VhcmNoVGVybSl9KSBgIDogXCJcIjtcbiAgICBjb25zdCBiYXNlUGFyYW1zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAoc2VhcmNoVXNlciA/IHsgc2VhcmNoVXNlckFjY2VzczogXCJncm91cE1lbWJlclwiLCBzZWFyY2hVc2VyTmFtZTogc2VhcmNoVXNlciB9IDoge30pKSwgeyBxOiBgJHtiYXNlUXVlcnkgfHwgXCJcIn0gJHt0ZXJtfWAgfSk7XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBmaWx0ZXJJZHMucmVkdWNlKChwYXJhbXMsIGtleSkgPT4ge1xuICAgICAgICBjb25zdCB7IHBhcmFtLCB2YWx1ZSB9ID0gZmlsdGVyc1trZXldO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMpLCB7IFtwYXJhbV06IGAke3BhcmFtc1twYXJhbV0gfHwgXCJcIn0gJHt2YWx1ZX1gIH0pO1xuICAgIH0sIGJhc2VQYXJhbXMpO1xuICAgIGNvbnN0IHBhcmFtcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IG51bSxcbiAgICAgICAgc3RhcnQgfSwgKHNvcnRGaWVsZCA9PT0gXCJyZWxldmFuY2VcIlxuICAgICAgICA/IHt9XG4gICAgICAgIDoge1xuICAgICAgICAgICAgc29ydEZpZWxkLFxuICAgICAgICAgICAgc29ydE9yZGVyXG4gICAgICAgIH0pKSwgKHF1ZXJ5UGFyYW1zIHx8IHt9KSk7XG4gICAgY29uc3QgaGFzQWN0aXZlUXVlcnkgPSBPYmplY3QuZW50cmllcyhxdWVyeVBhcmFtcykuc29tZSgoW19rZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiIHx8ICEhKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2YWx1ZS50cmltKCkpKTtcbiAgICBpZiAoIWhhc0FjdGl2ZVF1ZXJ5KSB7XG4gICAgICAgIC8vIHRoZSBncm91cCBzZWFyY2ggZW5kcG9pbnQgd2lsbCB0aHJvdyBhbiBlcnJvciB3aXRoIG5vIHNlYXJjaCBwYXJhbWV0ZXJzLCBzbyB0cmVhdCBhcyBhbiBlbXB0eSByZXN1bHQgc2V0XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZXh0U3RhcnQ6IC0xLFxuICAgICAgICAgICAgbnVtOiAwLFxuICAgICAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICAgIHRvdGFsOiAwXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh1cmwsIHBhcmFtcyk7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVzcG9uc2UpLCB7IHE6IHF1ZXJ5UGFyYW1zLnEsIHF1ZXJ5UGFyYW1zOiBwYXJhbXMgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBxdWVyeUdyb3VwQ29udGVudChwb3J0YWwsIGdyb3VwSWQsIHBhcmFtcyA9IHt9KSB7XG4gICAgY29uc3QgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGNvbnN0IHVybCA9IGAke3Jlc3RCYXNlfWNvbnRlbnQvZ3JvdXBzLyR7Z3JvdXBJZH0vc2VhcmNoYDtcbiAgICBjb25zdCBkZWZhdWx0UGFyYW1zID0ge1xuICAgICAgICBudW06IDQsXG4gICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICBzb3J0RmllbGQ6IFwibW9kaWZpZWRcIixcbiAgICAgICAgc29ydE9yZGVyOiBcImRlc2NcIlxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHVybCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0UGFyYW1zKSwgcGFyYW1zKSk7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufVxuYXN5bmMgZnVuY3Rpb24gcXVlcnlGZWF0dXJlZENvbnRlbnQocG9ydGFsLCBncm91cElkLCBmZWF0dXJlZCwgbGltaXQgPSA0KSB7XG4gICAgY29uc3QgcmVzdEJhc2UgPSBnZXRSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGNvbnN0IHVybCA9IGAke3Jlc3RCYXNlfWNvbnRlbnQvZ3JvdXBzLyR7Z3JvdXBJZH0vc2VhcmNoYDtcbiAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIG51bTogbGltaXQsXG4gICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICBxOiBgaWQ6KCR7ZmVhdHVyZWQuc2xpY2UoMCwgbGltaXQpLmpvaW4oXCIgT1IgXCIpfSlgXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QodXJsLCBwYXJhbXMpO1xuICAgIC8vIHJlc3VsdHMgd2lsbCBiZSByZXR1cm5lZCBpbiBhIFwicmVsZXZhbmNlXCIgb3JkZXIsIHdlIHdhbnQgdGhlbSBpbiB0aGUgcmVxdWVzdGVkIG9yZGVyXG4gICAgLy8gbm90IGFsbCBmZWF0dXJlZCBpdGVtcyB3aWxsIGJlIGF2YWlsYWJsZSB0byBhbGwgdXNlcnMgc28gYWxzbyBmaWx0ZXIgb3V0IG9uZXMgdGhhdCB3ZXJlIG5vdCByZXR1cm5lZFxuICAgIGlmIChyZXNwb25zZS50b3RhbCkge1xuICAgICAgICBjb25zdCBuZXdSZXN1bHRzID0gZmVhdHVyZWRcbiAgICAgICAgICAgIC5tYXAoKGlkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVzdWx0cy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSBpZCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICByZXNwb25zZS5yZXN1bHRzID0gbmV3UmVzdWx0cztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG5jb25zdCBhcmNnaXNHcm91cEJyb3dzZXJDc3MgPSBcIjpob3N0e3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6ZmxleDtoZWlnaHQ6MTAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3cteTphdXRvO292ZXJmbG93LXg6aGlkZGVuO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKTstLWdyb3VwLWJyb3dzZXItbWF4LXdpZHRoOjEwMCU7LS1ncm91cC1icm93c2VyLXBhbmUtd2lkdGg6MTguNzVyZW07LS1ncm91cC1icm93c2VyLXBhbmUtei1pbmRleDoxMTstLWdyb3VwLWJyb3dzZXItdG9wLWJhci1iYWNrZ3JvdW5kOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKX1hcmNnaXMtYnJvd3NlcnstLWFyY2dpcy1icm93c2VyLW1heC13aWR0aDp2YXIoLS1ncm91cC1icm93c2VyLW1heC13aWR0aCk7LS1hcmNnaXMtYnJvd3Nlci1wYW5lLXdpZHRoOnZhcigtLWdyb3VwLWJyb3dzZXItcGFuZS13aWR0aCk7LS1hcmNnaXMtYnJvd3Nlci1wYW5lLXotaW5kZXg6dmFyKC0tZ3JvdXAtYnJvd3Nlci1wYW5lLXotaW5kZXgpOy0tYXJjZ2lzLWJyb3dzZXItdG9wLWJhci1iYWNrZ3JvdW5kOnZhcigtLWdyb3VwLWJyb3dzZXItdG9wLWJhci1iYWNrZ3JvdW5kKX1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NDBweCl7Omhvc3R7LS1ncm91cC1icm93c2VyLXBhbmUtd2lkdGg6MTAwJX19XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJVcGRhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyTG9hZGluZ1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclNlbGVjdFwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclN1YmxheWVyUHJldmlldyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyU3VibGF5ZXJQcmV2aWV3XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb25cIiwgNyk7XG4gICAgICAgIHRoaXMubGl2ZVJlZ2lvblVwZGF0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGl2ZVJlZ2lvblVwZGF0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hbGxvd0ZldGNoID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3VycmVudFJlc3VsdHMgPSBbXTtcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkgPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwiZmlsdGVyc1wiXWApKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVUb3BiYXJFbXB0eSA9ICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUudG9wYmFyRW1wdHkgPSAhKChfYSA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBbc2xvdD1cInRvcC1iYXJcIl1gKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlU29ydEVtcHR5ID0gKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5zb3J0RW1wdHkgPSAhKChfYSA9IHRoaXMuZWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKGBbc2xvdD1cInNvcnRcIl1gKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlsdGVyTXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHRoaXMudXBkYXRlRmlsdGVyc0VtcHR5KTtcbiAgICAgICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodGhpcy51cGRhdGVUb3BiYXJFbXB0eSk7XG4gICAgICAgIHRoaXMuc29ydE11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcih0aGlzLnVwZGF0ZVNvcnRFbXB0eSk7XG4gICAgICAgIHRoaXMuZmV0Y2hHcm91cHMgPSBkZWJvdW5jZShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJMb2FkaW5nLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9IG51bGw7XG4gICAgICAgICAgICBpZiAoIXRoaXMucG9ydGFsIHx8ICF0aGlzLmFsbG93RmV0Y2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcXVlcnkgPSB0aGlzLmdldFF1ZXJ5KCk7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmVmbGlnaHQpIHtcbiAgICAgICAgICAgICAgICBxdWVyeSA9IGF3YWl0IHRoaXMucHJlZmxpZ2h0KHF1ZXJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWluRGVsYXkodGhpcy5xdWVyeUdyb3VwcyhxdWVyeSksIDUwMCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclVwZGF0ZS5lbWl0KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSksIHsgc2VsZWN0ZWRHcm91cHM6IHRoaXMuc2VsZWN0ZWRHcm91cHMsIGZpbHRlcnM6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyksIHNlYXJjaFRlcm06IHRoaXMuc2VhcmNoVGVybSB9KSwgdGhpcy5zb3J0KSk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IHJlc3BvbnNlLnJlc3VsdHM7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSwgMTUwKTtcbiAgICAgICAgdGhpcy5oYW5kbGVSZXNpemVFdmVudCA9IChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZShlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW5kZXJTZWxlY3RlZEl0ZW0gPSAoc2VsZWN0ZWRHcm91cCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNlbGVjdGVkLWl0ZW1cIiwgeyBrZXk6IHNlbGVjdGVkR3JvdXAuaWQsIGhlYWRpbmc6IHNlbGVjdGVkR3JvdXAudGl0bGUsIG9uQXJjZ2lzU2VsZWN0ZWRJdGVtUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVzZWxlY3RHcm91cChzZWxlY3RlZEdyb3VwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkR3JvdXBzKTtcbiAgICAgICAgICAgICAgICB9IH0sIGgoXCJhcmNnaXMtZ3JvdXAtdGh1bWJuYWlsXCIsIHsgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGdyb3VwOiBzZWxlY3RlZEdyb3VwLCBwb3J0YWw6IHRoaXMucG9ydGFsLCBzY2FsZTogXCJzXCIgfSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VhcmNoVXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0gXCJub25lXCI7XG4gICAgICAgIHRoaXMudmlldyA9IFwibGlzdFwiO1xuICAgICAgICB0aGlzLm51bSA9IDIwO1xuICAgICAgICB0aGlzLnEgPSBcIlwiO1xuICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBzID0gW107XG4gICAgICAgIHRoaXMucHJlZmxpZ2h0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZldGNoID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVByZXZpZXdCYWRnZXMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gXCJmdWxsXCI7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBjcmVhdGVTdG9yZSh7IGZpbHRlcnM6IHt9IH0pO1xuICAgICAgICB0aGlzLnVzZVBhbmVsTGF5b3V0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IFwiXCI7XG4gICAgICAgIHRoaXMuc29ydCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wYWdlID0geyBudW06IHRoaXMubnVtLCBzdGFydDogMSwgbmV4dFN0YXJ0OiAtMSB9O1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmZvcm1GYWN0b3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGFnZVJhbmdlVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXMucHJldmlld0dyb3VwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqIE1hbnVhbGx5IHRyaWdnZXIgYSBmZXRjaCBvZiBuZXcgcmVzdWx0cyAqL1xuICAgIGFzeW5jIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgZWwsIGhhc0luZG9vcnNTcGFjZXMsIHNlbGVjdGVkR3JvdXBzLCB2aWV3IH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUubGFuZyA9IGxvY2FsZVsxXTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS52aWV3ID0gdmlldztcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5oYXNJbmRvb3JzU3BhY2VzID0gaGFzSW5kb29yc1NwYWNlcztcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3RlZEdyb3VwcyA9IHNlbGVjdGVkR3JvdXBzO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVDb25maWcoKTtcbiAgICAgICAgc2V0dXBSZXNpemVPYnNlcnZlcih0aGlzLnN0b3JlKS5vYnNlcnZlKHRoaXMuZWwpO1xuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgICAgICAgdGhpcy5maWx0ZXJNdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoZWwsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICAgICAgICB0aGlzLnRvcGJhck11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgICAgIHRoaXMuc29ydE11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgICAgIHRoaXMudXBkYXRlRmlsdGVyc0VtcHR5KCk7XG4gICAgICAgIHRoaXMudXBkYXRlVG9wYmFyRW1wdHkoKTtcbiAgICAgICAgdGhpcy51cGRhdGVTb3J0RW1wdHkoKTtcbiAgICAgICAgaWYgKHRoaXMudXNlUGFuZWxMYXlvdXQgfHwgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KHRoaXMuZWwsIFwiY2FsY2l0ZS1zaGVsbC1wYW5lbFwiKSkge1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wYW5lbCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAoX2EgPSB0aGlzLnN0b3JlLnN0YXRlLnJlc2l6ZU9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudW5vYnNlcnZlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLnRvcGJhck11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLnNvcnRNdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhpcy5maWx0ZXJDbGVhckhhbmRsZXIoZmFsc2UpO1xuICAgICAgICAoX2IgPSB0aGlzLmVsKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc0Jyb3dzZXJSZXNpemVcIiwgdGhpcy5oYW5kbGVSZXNpemVFdmVudCk7XG4gICAgfVxuICAgIHVwZGF0ZVVzZXIobmV3VXNlcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLnVzZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS51c2VyID0gbmV3VXNlcik7XG4gICAgfVxuICAgIHVwZGF0ZVBvcnRhbChuZXdQb3J0YWwpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS5wb3J0YWwgPSBuZXdQb3J0YWwpO1xuICAgIH1cbiAgICB1cGRhdGVBUEkobmV3VmFsdWUpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSBjb25maWdTdGF0ZS5hcGkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS5hcGkgPSBuZXdWYWx1ZSk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbmZpZyhuZXdDb25maWcpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSBjb25maWdTdGF0ZS5jb25maWcpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChjb25maWdTdGF0ZS5jb25maWcgPSBuZXdDb25maWcpO1xuICAgIH1cbiAgICB1cGRhdGVTZWxlY3Rpb24obmV3VmFsdWUpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPSBuZXdWYWx1ZTtcbiAgICB9XG4gICAgdXBkYXRlU2VsZWN0ZWRHcm91cHMoZ3JvdXBzKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRHcm91cHMgPSBncm91cHM7XG4gICAgfVxuICAgIHVwZGF0ZVEoKSB7XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplQ29uZmlnKCk7XG4gICAgICAgIC8vIGluaXRpYWxseSwgZmV0Y2ggaXMgbG9ja2VkXG4gICAgICAgIC8vIHdhaXQgZm9yIGFsbCBjb21wb25lbnRzIHRvIGVtaXQgZXZlbnRzIGltcGFjdGluZyBzdGF0ZSBwcmlvciB0byBpbml0aWFsIGZldGNoXG4gICAgICAgIGF3YWl0IHRpbWVvdXQoNDAwKTtcbiAgICAgICAgdGhpcy5hbGxvd0ZldGNoID0gdHJ1ZTtcbiAgICAgICAgaWYgKGNvbmZpZ1N0YXRlLnBvcnRhbCkge1xuICAgICAgICAgICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbmZpZygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZpbHRlckhhbmRsZXIoZSkge1xuICAgICAgICBjb25zdCBmaWx0ZXJzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMpLCB7IFtlLmRldGFpbC5pZF06IGUuZGV0YWlsIH0pO1xuICAgICAgICAvLyByZW1vdmUgZmlsdGVyIGZyb20gc2V0XG4gICAgICAgIGlmICghZS5kZXRhaWwudmFsdWUpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBmaWx0ZXJzW2UuZGV0YWlsLmlkXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMgPSBmaWx0ZXJzO1xuICAgICAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgICAgICB0aGlzLmZldGNoR3JvdXBzKCk7XG4gICAgfVxuICAgIGZpbHRlclJlbW92ZUhhbmRsZXIoZSkge1xuICAgICAgICBpZiAoIWUuZGV0YWlsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsdGVycyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyk7XG4gICAgICAgIGRlbGV0ZSBmaWx0ZXJzW2UuZGV0YWlsXTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzID0gZmlsdGVycztcbiAgICAgICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICAgIH1cbiAgICBmaWx0ZXJDbGVhckhhbmRsZXIoZG9GZXRjaEdyb3VwcyA9IHRydWUpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzID0ge307XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIGRvRmV0Y2hHcm91cHMgJiYgdGhpcy5mZXRjaEdyb3VwcygpO1xuICAgIH1cbiAgICBnZW5lcmljRmlsdGVyQ2xlYXJIYW5kbGVyKCkge1xuICAgICAgICB0aGlzLmZpbHRlckNsZWFySGFuZGxlcigpO1xuICAgIH1cbiAgICBmaWx0ZXJUb2dnbGVIYW5kbGVyKCkge1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZCA9ICF0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnNFeHBhbmRlZDtcbiAgICB9XG4gICAgc2VhcmNoSGFuZGxlcihlKSB7XG4gICAgICAgIGNvbnN0IG5ld1Rlcm0gPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gbmV3VGVybTtcbiAgICAgICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgaWYgKG5ld1Rlcm0pIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hHcm91cHMuaW52b2tlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc29ydEhhbmRsZXIoZSkge1xuICAgICAgICB0aGlzLnNvcnQgPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5mZXRjaEdyb3VwcygpO1xuICAgIH1cbiAgICBhc3luYyBwYWdlSGFuZGxlcihlKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5wYWdlID0gZS5kZXRhaWw7XG4gICAgICAgIGlmICh0aGlzLmFsbG93RmV0Y2gpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZmV0Y2hHcm91cHMoKTtcbiAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoNDAwKTtcbiAgICAgICAgICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgd2h5IGEgcmVmIGRvZXNuJ3Qgd29yayBmb3IgdGhpcyBlbGVtZW50XG4gICAgICAgICAgICAoX2EgPSB0aGlzLmVsLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5jb250ZW50X192aWV3XCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2Nyb2xsVG8oe1xuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBiZWhhdmlvcjogXCJzbW9vdGhcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0SGFuZGxlcihlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWQsIGdyb3VwIH0gPSBlLmRldGFpbDtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNlbGVjdGlvbikge1xuICAgICAgICAgICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cHMgPSBbZ3JvdXBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm11bHRpcGxlXCI6XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0R3JvdXAoZ3JvdXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXNlbGVjdEdyb3VwKGdyb3VwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkR3JvdXBzKTtcbiAgICB9XG4gICAgYXN5bmMgdG9nZ2xlUHJldmlldyh7IGRldGFpbCB9KSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIGlmICghZGV0YWlsIHx8IHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9PT0gZGV0YWlsLmlkKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3R3JvdXAgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZUZvY3VzRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBkZXRhaWwuaWQ7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdHcm91cCA9IE9iamVjdC5hc3NpZ24oe30sIGRldGFpbCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXcuZW1pdChPYmplY3QuYXNzaWduKHt9LCBkZXRhaWwpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICAgICAgICBhY3Rpb246IHRoaXMucHJldmlld0dyb3VwID8gXCJvcGVuIHBhbmVsXCIgOiBcImNsb3NlIHBhbmVsXCIsXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXJkIGFjdGlvblwiXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplQ29uZmlnKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLmFwaSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpKTtcbiAgICAgICAgKF9iID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSB0aGlzLnVzZXIpO1xuICAgICAgICAoX2MgPSBjb25maWdTdGF0ZS5wb3J0YWwpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IChjb25maWdTdGF0ZS5wb3J0YWwgPSB0aGlzLnBvcnRhbCk7XG4gICAgICAgIChfZCA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogKGNvbmZpZ1N0YXRlLmNvbmZpZyA9IHRoaXMuY29uZmlnKTtcbiAgICB9XG4gICAgcmVzZXRQYWdpbmF0aW9uKCkge1xuICAgICAgICB0aGlzLnBhZ2Uuc3RhcnQgPSAxO1xuICAgICAgICB0aGlzLnBhZ2UudG90YWwgPSAwO1xuICAgIH1cbiAgICBnZXRRdWVyeSgpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IGZpbHRlcnM6IHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycywgc2VhcmNoVXNlcjogdGhpcy5zZWFyY2hVc2VyLCBzZWFyY2hUZXJtOiB0aGlzLnNlYXJjaFRlcm0sIGJhc2VRdWVyeTogdGhpcy5xIH0sIHRoaXMuc29ydCksIHRoaXMucGFnZSk7XG4gICAgfVxuICAgIHF1ZXJ5R3JvdXBzKHF1ZXJ5KSB7XG4gICAgICAgIGlmICh0aGlzLmZldGNoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaChxdWVyeSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHF1ZXJ5R3JvdXBzKHRoaXMucG9ydGFsLCBxdWVyeSk7XG4gICAgfVxuICAgIHJlc3RvcmVGb2N1cygpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzdG9yZUZvY3VzRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLnJlc3RvcmVGb2N1c0VsZW1lbnQ7XG4gICAgICAgICAgICBpZiAoZWwucmVzdG9yZUZvY3VzKSB7XG4gICAgICAgICAgICAgICAgZWwucmVzdG9yZUZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlbC5zZXRGb2N1cykge1xuICAgICAgICAgICAgICAgIGVsLnNldEZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlbC5mb2N1cykge1xuICAgICAgICAgICAgICAgIGVsLmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0R3JvdXAoZ3JvdXApIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzU2VsZWN0ZWQoZ3JvdXApKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkR3JvdXBzID0gWy4uLnRoaXMuc2VsZWN0ZWRHcm91cHMsIGdyb3VwXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZXNlbGVjdEdyb3VwKGdyb3VwKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cHMgPSB0aGlzLnNlbGVjdGVkR3JvdXBzLmZpbHRlcigoeyBpZCB9KSA9PiBpZCAhPT0gZ3JvdXAuaWQpO1xuICAgIH1cbiAgICBpc1NlbGVjdGVkKGdyb3VwKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgcmV0dXJuIChfYSA9IHRoaXMuc2VsZWN0ZWRHcm91cHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zb21lKCh7IGlkIH0pID0+IGdyb3VwLmlkID09PSBpZCk7XG4gICAgfVxuICAgIHJlc2l6ZSh7IGRldGFpbDogeyB3aWR0aCwgaGVpZ2h0IH0gfSkge1xuICAgICAgICB0aGlzLmZvcm1GYWN0b3IgPSB3aWR0aCA+IGJyZWFrcG9pbnRzLnNtID8gXCJsYXJnZVwiIDogXCJzbWFsbFwiO1xuICAgICAgICBjb25zdCBvbGRGb3JtRmFjdG9yID0gdGhpcy5zdG9yZS5zdGF0ZS53aWR0aCA+IGJyZWFrcG9pbnRzLnNtID8gXCJsYXJnZVwiIDogXCJzbWFsbFwiO1xuICAgICAgICAvKiogd2hlbiBnb2luZyBmcm9tIGxhcmdlIHRvIHNtYWxsIG9yIHNtYWxsIHRvIGxhcmdlLCBjb2xsYXBzZSBvciBleHBhbmQgZmlsdGVycywgYWNjb3JkaW5nbHkgKi9cbiAgICAgICAgaWYgKG9sZEZvcm1GYWN0b3IgPT09IFwibGFyZ2VcIiAmJiB0aGlzLmZvcm1GYWN0b3IgPT09IFwic21hbGxcIikge1xuICAgICAgICAgICAgLyoqIHVzZSBwYW5lbCBsYXlvdXQgaWYgZW5hYmxlZCBvbiBzbWFsbGVyIGdyb3VwIGJyb3dzZXJzICovXG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdGhpcy51c2VQYW5lbExheW91dDtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9sZEZvcm1GYWN0b3IgPT09IFwic21hbGxcIiAmJiB0aGlzLmZvcm1GYWN0b3IgPT09IFwibGFyZ2VcIikge1xuICAgICAgICAgICAgLyoqIHBhbmVsIGxheW91dCB3b24ndCB3b3JrIG9uIGxhcmdlciBncm91cCBicm93c2VycyAqL1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wYW5lbCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgfVxuICAgIHJlbmRlclNlbGVjdGVkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGNvbnN0IHdob2xlUGFnZVNlbGVjdGVkID0gKF9hID0gdGhpcy5jdXJyZW50UmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV2ZXJ5KChncm91cCkgPT4gdGhpcy5pc1NlbGVjdGVkKGdyb3VwKSk7XG4gICAgICAgIGNvbnN0IHRvdGFsU2VsZWN0ZWQgPSAoX2IgPSB0aGlzLnNlbGVjdGVkR3JvdXBzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc2VsZWN0ZWRcIiwgeyBzbG90OiBcInNlbGVjdGlvblwiLCBsb2FkaW5nOiB0aGlzLmxvYWRpbmcsIHRvdGFsOiAoX2MgPSB0aGlzLmN1cnJlbnRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubGVuZ3RoLCB0b3RhbFNlbGVjdGVkOiB0b3RhbFNlbGVjdGVkLCBlbXB0eVRleHQ6IHRoaXMuaTE4bi5ncm91cEJyb3dzZXIubm9TZWxlY3RlZEdyb3VwcywgaGVhZGluZzogdGhpcy5pMThuLmdyb3VwQnJvd3Nlci5zZWxlY3RlZEdyb3VwcywgY2hlY2tlZDogIXRoaXMubG9hZGluZyAmJiB3aG9sZVBhZ2VTZWxlY3RlZCwgaW5kZXRlcm1pbmF0ZTogIXdob2xlUGFnZVNlbGVjdGVkICYmICEhdG90YWxTZWxlY3RlZCwgb25BcmNnaXNTZWxlY3RlZERlc2VsZWN0QWxsOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU2VsZWN0LmVtaXQodGhpcy5zZWxlY3RlZEdyb3Vwcyk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NlbGVjdGVkU2VsZWN0UGFnZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLmN1cnJlbnRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RHcm91cChncm91cCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTZWxlY3QuZW1pdCh0aGlzLnNlbGVjdGVkR3JvdXBzKTtcbiAgICAgICAgICAgIH0gfSwgKF9kID0gdGhpcy5zZWxlY3RlZEdyb3VwcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLm1hcCh0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSkpKTtcbiAgICB9XG4gICAgcmVuZGVyU2xvdChuYW1lLCBkZWZhdWx0Q29udGVudCkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBuYW1lIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogbmFtZSB9LCBkZWZhdWx0Q29udGVudCkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxvYWRpbmcsIGkxOG4sIHNlbGVjdGVkR3JvdXBzLCBzZWxlY3Rpb24sIGN1cnJlbnRSZXNwb25zZSwgc3RvcmUsIGFwaSwgc2VhcmNoVGVybSwgZm9ybUZhY3RvciwgaGVpZ2h0LCByZW5kZXJTbG90IH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyXCIsIHsgcHJldmlldzogISF0aGlzLnByZXZpZXdHcm91cCwgbG9hZGluZzogbG9hZGluZywgc2VsZWN0ZWQ6IHNlbGVjdGVkR3JvdXBzLCBhbHdheXNTaG93U2VsZWN0aW9uOiBzZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIiwgcmVzcG9uc2U6IGN1cnJlbnRSZXNwb25zZSwgc3RvcmU6IHN0b3JlLCBhcGk6IGFwaSwgZm9ybUZhY3RvcjogZm9ybUZhY3Rvciwgc2VhcmNoVGVybTogc2VhcmNoVGVybSwgaGVpZ2h0OiBoZWlnaHQgfSwgcmVuZGVyU2xvdChcInRvcC1iYXJcIiksIHJlbmRlclNsb3QoXCJzb3J0XCIpLCBoKFwiYXJjZ2lzLWdyb3VwLWJyb3dzZXItcHJldmlld1wiLCB7IHNsb3Q6IFwicHJldmlld1wiLCBncm91cDogdGhpcy5wcmV2aWV3R3JvdXAsIHBvcnRhbDogdGhpcy5wb3J0YWwsIHVzZXI6IHRoaXMudXNlciwga2V5OiB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcsIG9uQXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0Nsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXdHcm91cCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclN1YmxheWVyUHJldmlldy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlRm9jdXMoKTtcbiAgICAgICAgICAgIH0sIGhpZGVQcmV2aWV3Rm9vdGVyOiB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVyLCBzaG93QmFkZ2VzOiAhdGhpcy5oaWRlUHJldmlld0JhZGdlcywgY3VycmVudFJlc3BvbnNlOiB0aGlzLmN1cnJlbnRSZXNwb25zZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJmb290ZXItYWN0aW9uXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcInByZXZpZXctZm9vdGVyLWFjdGlvblwiIH0pKSksIHRoaXMucmVuZGVyU2VsZWN0ZWQoKSwgcmVuZGVyU2xvdChcImFjdGlvbnNcIiksIHJlbmRlclNsb3QoXCJjb250ZW50LXN0YXJ0XCIpLCByZW5kZXJTbG90KFwiY29udGVudFwiKSwgcmVuZGVyU2xvdChcImNvbnRlbnQtZW5kXCIpLCByZW5kZXJTbG90KFwicGFnaW5hdGlvblwiKSwgcmVuZGVyU2xvdChcImZpbHRlcnNcIiksIHJlbmRlclNsb3QoXCJzY3JvbGwtZW5kXCIpLCByZW5kZXJTbG90KFwibm8tcmVzdWx0c1wiLCBpMThuLmNvbnRlbnQubm9SZXN1bHRzKSwgcmVuZGVyU2xvdChcIm5vLWNvbnRlbnRcIiwgaTE4bi5jb250ZW50Lm5vQ29udGVudCkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInVzZXJcIjogW1widXBkYXRlVXNlclwiXSxcbiAgICAgICAgXCJwb3J0YWxcIjogW1widXBkYXRlUG9ydGFsXCJdLFxuICAgICAgICBcImFwaVwiOiBbXCJ1cGRhdGVBUElcIl0sXG4gICAgICAgIFwiY29uZmlnXCI6IFtcInVwZGF0ZUNvbmZpZ1wiXSxcbiAgICAgICAgXCJzZWxlY3Rpb25cIjogW1widXBkYXRlU2VsZWN0aW9uXCJdLFxuICAgICAgICBcInNlbGVjdGVkR3JvdXBzXCI6IFtcInVwZGF0ZVNlbGVjdGVkR3JvdXBzXCJdLFxuICAgICAgICBcInFcIjogW1widXBkYXRlUVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXIuc3R5bGUgPSBhcmNnaXNHcm91cEJyb3dzZXJDc3M7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckFjdGlvbnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyLWFjdGlvbnNcIiwgeyBhY3Rpb25zOiB0aGlzLmFjdGlvbnMsIHNlbGVjdGlvbjogdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3RlZEdyb3Vwcywgc3RvcmU6IHRoaXMuc3RvcmUgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudENzcyA9IFwiOmhvc3R7LS1hcmNnaXMtZ3JvdXAtYnJvd3Nlci1jb2x1bW5zOnJlcGVhdCgxLCAxZnIpOy0tYXJjZ2lzLWdyb3VwLWJyb3dzZXItZ2FwOjAuNXJlbX0ubGlzdCBzbG90LC5jb21wYWN0IHNsb3R7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1hcmNnaXMtZ3JvdXAtYnJvd3Nlci1jb2x1bW5zKX0uY29tcGFjdCBzbG90e2dhcDowcHh9Lmxpc3Qgc2xvdHtnYXA6dmFyKC0tYXJjZ2lzLWdyb3VwLWJyb3dzZXItZ2FwKX1cIjtcblxuY29uc3QgQXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuc3RvcmUuc3RhdGUudmlldztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFt2aWV3XTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcIm5vLXNwYWNlXCI6IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPCBicmVha3BvaW50cy54cyAmJiB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsXG4gICAgICAgICAgICB9IH0sIGgoXCJzbG90XCIsIG51bGwpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzR3JvdXBCcm93c2VyQ29udGVudC5zdHlsZSA9IGFyY2dpc0dyb3VwQnJvd3NlckNvbnRlbnRDc3M7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlckRhdGUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLnByb3BlcnR5ID0gXCJtb2RpZmllZFwiO1xuICAgICAgICB0aGlzLnJhbmdlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXJ0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmVuZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB9XG4gICAgZ2V0RXZlbnREZXRhaWwoZGV0YWlsKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgcGFyYW06IFwicVwiIH0sIGRldGFpbCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wZXJ0eSwgcmFuZ2UsIHN0YXJ0LCBlbmQsIHN0b3JlLCBleHBhbmRlZCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyLWRhdGVcIiwgeyBzZXJ2ZXJQcm9wZXJ0eTogcHJvcGVydHksIHByb3BlcnR5OiBwcm9wZXJ0eSwgc3RvcmU6IHN0b3JlLCBzdGFydDogc3RhcnQsIGVuZDogZW5kLCByYW5nZTogcmFuZ2UsIGV4cGFuZGVkOiBleHBhbmRlZCwgb25BcmNnaXNCcm93c2VyRmlsdGVyOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbChlLmRldGFpbCkpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlckdyb3Vwc0J5VXNlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyVXNlcm5hbWVzRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJVc2VybmFtZXNGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMuc2VhcmNoVXNlcm5hbWVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlYXJjaFVzZXJuYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm93bmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsbFVzZXJuYW1lcyA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdGVkVXNlcm5hbWUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyR3JvdXBzQnlVc2VyO1xuICAgICAgICB0aGlzLnNlbGVjdGVkVXNlcm5hbWUgPVxuICAgICAgICAgICAgKF9iID0gKF9hID0gdGhpcy5zZWFyY2hVc2VybmFtZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdGhpcy5zZWFyY2hVc2VybmFtZXNbMF0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IChfYyA9IGNvbmZpZ1N0YXRlLnVzZXIpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy51c2VybmFtZTtcbiAgICB9XG4gICAgYXN5bmMgc2VhcmNoVXNlcm5hbWVzQ2hhbmdlZCgpIHtcbiAgICAgICAgdGhpcy5hbGxVc2VybmFtZXMgPSB0aGlzLnNlYXJjaFVzZXJuYW1lcztcbiAgICB9XG4gICAgYXN5bmMgc2VhcmNoVXNlcm5hbWVDaGFuZ2VkKCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkVXNlcm5hbWUgPSB0aGlzLnNlYXJjaFVzZXJuYW1lO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBhbGxVc2VybmFtZXMsIHNlbGVjdGVkVXNlcm5hbWUsIHNlYXJjaFVzZXJuYW1lLCBpMThuIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBjdXJyZW50VXNlcm5hbWUgPSAoX2EgPSBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXNlcm5hbWU7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRVc2VybmFtZSA9IHNlYXJjaFVzZXJuYW1lO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRVc2VybmFtZSA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQudXNlcm5hbWUpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFVzZXJuYW1lID0gc2VsZWN0ZWRVc2VybmFtZTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclVzZXJuYW1lc0ZpbHRlci5lbWl0KHNlbGVjdGVkVXNlcm5hbWUpO1xuICAgICAgICAgICAgfSB9LCBhbGxVc2VybmFtZXMubWFwKCh1c2VybmFtZSkgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS11c2VybmFtZVwiOiB1c2VybmFtZSwgc2VsZWN0ZWQ6IHVzZXJuYW1lID09PSBzZWxlY3RlZFVzZXJuYW1lIH0sIGgoXCJhXCIsIG51bGwsIHVzZXJuYW1lID09PSBjdXJyZW50VXNlcm5hbWUgPyBpMThuLm1lLnJlcGxhY2UoXCIke3VzZXJuYW1lfVwiLCB1c2VybmFtZSkgOiB1c2VybmFtZSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInNlYXJjaFVzZXJuYW1lc1wiOiBbXCJzZWFyY2hVc2VybmFtZXNDaGFuZ2VkXCJdLFxuICAgICAgICBcInNlYXJjaFVzZXJuYW1lXCI6IFtcInNlYXJjaFVzZXJuYW1lQ2hhbmdlZFwiXVxuICAgIH07IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlck1lbWJlck9yZyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMubWVtYmVyT3JnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9yZ0lkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyTWVtYmVyT3JnO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5tZW1iZXJPcmcpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJtZW1iZXJPcmdcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMubWVtYmVyT3JnID0gbnVsbCkpO1xuICAgIH1cbiAgICBnZXRRdWVyeVZhbHVlKCkge1xuICAgICAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSBjb25maWdTdGF0ZS51c2VyO1xuICAgICAgICBjb25zdCBvcmdpZCA9IGNvbmZpZ1N0YXRlLnBvcnRhbC5pZDtcbiAgICAgICAgaWYgKCF1c2VybmFtZSB8fCAhb3JnaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAodGhpcy5tZW1iZXJPcmcpIHtcbiAgICAgICAgICAgIGNhc2UgXCJteU9yZ1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm1lbWJlcm9yZ2lkczpOVUxMXCI7XG4gICAgICAgICAgICBjYXNlIFwiYW5vdGhlck9yZ1wiOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9yZ0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgKG1lbWJlcm9yZ2lkczoke3RoaXMub3JnSWR9IE9SIG9yZ2lkOiR7dGhpcy5vcmdJZH0pYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIi1tZW1iZXJvcmdpZHM6TlVMTFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIGNvbnN0IHsgbWVtYmVyT3JnLCBvcmdJZCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFF1ZXJ5VmFsdWUoKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmkxOG4ubGFiZWwucmVwbGFjZShcIiR7bGFiZWx9XCIsIHRoaXMuaTE4blttZW1iZXJPcmddKTtcbiAgICAgICAgcmV0dXJuIHsgaWQ6IFwibWVtYmVyT3JnXCIsIHBhcmFtOiBcInFcIiwgdmFsdWUsIGxhYmVsLCBtZW1iZXJPcmcsIG9yZ0lkIH07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDQxOThcbiAgICAgICAgaWYgKChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLmN1cnJlbnRNZW1iZXJzQXJlRnJvbSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLm1lbWJlck9yZywgZmlsdGVySUQ6IFwibWVtYmVyT3JnXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWVtYmVyT3JnID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLm9yZ0lkID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lbWJlck9yZyA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQubWVtYmVyT3JnKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lbWJlck9yZyA9PT0gbWVtYmVyT3JnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVtYmVyT3JnID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVtYmVyT3JnID0gbWVtYmVyT3JnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgICAgICB9IH0sIFtcIm15T3JnXCIsIFwiYW5vdGhlck9yZ1wiXS5tYXAoKG1lbWJlck9yZykgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1tZW1iZXItb3JnXCI6IG1lbWJlck9yZywgc2VsZWN0ZWQ6IG1lbWJlck9yZyA9PT0gdGhpcy5tZW1iZXJPcmcgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5pMThuW21lbWJlck9yZ10pKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJNZW1iZXJzaGlwID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVtYmVyc2hpcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlck1lbWJlcnNoaXA7XG4gICAgICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyA9IHRoaXMuc3RvcmUuc3RhdGUuaGFzSW5kb29yc1NwYWNlcztcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVtYmVyc2hpcCkge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICB9XG4gICAgICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcIm1lbWJlcnNoaXBcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMubWVtYmVyc2hpcCA9IG51bGwpKTtcbiAgICB9XG4gICAgZ2V0UXVlcnlWYWx1ZSgpIHtcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS93ZWJnaXMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzM3ODMxXG4gICAgICAgIGlmICh0aGlzLmhhc0luZG9vcnNTcGFjZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBcIm1lbWJlcnNoaXBhY2Nlc3M6b3JnXCI7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoICh0aGlzLm1lbWJlcnNoaXApIHtcbiAgICAgICAgICAgIGNhc2UgXCJvcmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJtZW1iZXJzaGlwYWNjZXNzOm9yZ1wiO1xuICAgICAgICAgICAgY2FzZSBcImNvbGxhYm9yYXRpb25cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJtZW1iZXJzaGlwYWNjZXNzOmNvbGxhYm9yYXRpb25cIjtcbiAgICAgICAgICAgIGNhc2UgXCJhbnlPcmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJtZW1iZXJzaGlwYWNjZXNzOk5VTExcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIGNvbnN0IHsgbWVtYmVyc2hpcCB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFF1ZXJ5VmFsdWUoKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmkxOG4ubGFiZWwucmVwbGFjZShcIiR7bGFiZWx9XCIsIHRoaXMuaTE4blttZW1iZXJzaGlwXSk7XG4gICAgICAgIHJldHVybiB7IGlkOiBcIm1lbWJlcnNoaXBcIiwgcGFyYW06IFwicVwiLCB2YWx1ZSwgbGFiZWwsIG1lbWJlcnNoaXAgfTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS93ZWJnaXMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzM3ODMxXG4gICAgICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyB8fFxuICAgICAgICAgICAgKFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ0MTk4XG4gICAgICAgICAgICAoX2EgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQb3J0YWwpKSB7XG4gICAgICAgICAgICAvLyBUaGlzIHdpbGwgcmVsaWVzIG9uIHRoZSBldmVudCBlbWl0dGVkIGluIGBjb21wb25lbnREaWRMb2FkYCB0byBzZXQgdGhlIHByb3BlciBiYXNlIHEgdmFsdWVcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi5ncm91cE1lbWJlcnNoaXBTZXR0aW5nLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMubWVtYmVyc2hpcCwgZmlsdGVySUQ6IFwibWVtYmVyc2hpcFwiLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lbWJlcnNoaXAgPSBudWxsO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVtYmVyc2hpcCA9ICgoX2IgPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQubWVtYmVyc2hpcCkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZW1iZXJzaGlwID09PSBtZW1iZXJzaGlwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVtYmVyc2hpcCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbWJlcnNoaXAgPSBtZW1iZXJzaGlwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgICAgICB9IH0sIFtcIm9yZ1wiLCBcImNvbGxhYm9yYXRpb25cIiwgXCJhbnlPcmdcIl0ubWFwKChtZW1iZXJzaGlwKSA9PiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLW1lbWJlcnNoaXBcIjogbWVtYmVyc2hpcCwgc2VsZWN0ZWQ6IG1lbWJlcnNoaXAgPT09IHRoaXMubWVtYmVyc2hpcCB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5bbWVtYmVyc2hpcF0pKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJPd25lciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlYXJjaFVzZXJuYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm93bmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyT3duZXI7XG4gICAgICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyA9IHRoaXMuc3RvcmUuc3RhdGUuaGFzSW5kb29yc1NwYWNlcztcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKHRoaXMub3duZXIpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJvd25lclwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5vd25lciA9IG51bGwpKTtcbiAgICAgICAgKF9hID0gdGhpcy5zZWFyY2hVc2VybmFtZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHRoaXMuc2VhcmNoVXNlcm5hbWUgPSAoX2IgPSBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudXNlcm5hbWUpO1xuICAgIH1cbiAgICBnZXRRdWVyeVZhbHVlKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSAoX2EgPSB0aGlzLnNlYXJjaFVzZXJuYW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2IgPSBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudXNlcm5hbWU7XG4gICAgICAgIGNvbnN0IG9yZ0lkID0gKF9jID0gY29uZmlnU3RhdGUucG9ydGFsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaWQ7XG4gICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gcmV0dXJuIGVtcHR5IHN0cmluZyBldmVuIGlmIG9yZ0lkIGlzIGVtcHR5XG4gICAgICAgIC8vICB0byBtYWtlIHN1cmUgdGhlIHF1ZXJ5IHZhbHVlIHN0aWxsIGhhcyB0aGUgY29ycmVjdCBzeW50YXhcbiAgICAgICAgLy8gVGhpcyBtaW1pY3MgYmVoYXZpb3Igb24gcHJvZFxuICAgICAgICAvLyBUT0RPOiBmaW5kIGEgYmV0dGVyIHdheSB0byBmaWx0ZXIgdGhhdCBvdXQgaW4gUjNcbiAgICAgICAgaWYgKCF1c2VybmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoICh0aGlzLm93bmVyKSB7XG4gICAgICAgICAgICBjYXNlIFwib3duZXJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gYG93bmVyOiR7dXNlcm5hbWV9YDtcbiAgICAgICAgICAgIGNhc2UgXCJpbk9yZ1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBgLW93bmVyOiR7dXNlcm5hbWV9IG9yZ2lkOiR7b3JnSWR9YDtcbiAgICAgICAgICAgIGNhc2UgXCJvdXRzaWRlT3JnXCI6XG4gICAgICAgICAgICAgICAgLy8gdGhpcyBtYWdpYyBTUUwgcXVlcnkgZ2V0cyBhbGwgb3JnIGlkcyBhbmQgdGhlbiByZW1vdmVzIHRoZSBjdXJyZW50IG9yZ1xuICAgICAgICAgICAgICAgIHJldHVybiBgKG9yZ2lkOiBbMCBUTyBcXHtdKSAtb3JnaWQ6JHtvcmdJZH1gO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRFdmVudERldGFpbCgpIHtcbiAgICAgICAgY29uc3QgeyBvd25lciwgc2VhcmNoVXNlcm5hbWU6IHVzZXJuYW1lIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UXVlcnlWYWx1ZSgpO1xuICAgICAgICBjb25zdCBsYWJlbCA9IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtsYWJlbH1cIiwgb3duZXIgPT09IFwib3duZXJcIiA/IHVzZXJuYW1lIDogdGhpcy5pMThuW293bmVyXSk7XG4gICAgICAgIHJldHVybiB7IGlkOiBcIm93bmVyXCIsIHBhcmFtOiBcInFcIiwgdmFsdWUsIGxhYmVsLCBvd25lciwgdXNlcm5hbWUgfTtcbiAgICB9XG4gICAgZ2V0T3duZXJUZXh0KG93bmVyKSB7XG4gICAgICAgIGlmIChvd25lciA9PT0gXCJvd25lclwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hVc2VybmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3duZXIgPT09IFwib3V0c2lkZU9yZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuW2lzUHVibGljVXNlcihjb25maWdTdGF0ZS51c2VyKSA/IFwic29tZW9uZUVsc2VcIiA6IFwib3V0c2lkZU9yZ1wiXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5pMThuW293bmVyXTtcbiAgICB9XG4gICAgc2VhcmNoVXNlcm5hbWVDaGFuZ2VkKCkge1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnVzZXJuYW1lO1xuICAgICAgICBpZiAoIXVzZXJuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWx0ZXJzID0gaXNQdWJsaWNVc2VyKHVzZXIpXG4gICAgICAgICAgICA/IFtcIm93bmVyXCIsIFwib3V0c2lkZU9yZ1wiXVxuICAgICAgICAgICAgOiBbXCJvd25lclwiLCBcImluT3JnXCIsIFwib3V0c2lkZU9yZ1wiXTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLm93bmVyLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMub3duZXIsIGZpbHRlcklEOiBcIm93bmVyXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub3duZXIgPSBudWxsO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFwibVwiLCBvbkNhbGNpdGVUcmVlU2VsZWN0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3duZXIgPSAoKF9iID0gKF9hID0gbm9kZS5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kYXRhc2V0Lm93bmVyKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm93bmVyID09PSBvd25lcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm93bmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICAgICAgfSB9LCBmaWx0ZXJzXG4gICAgICAgICAgICAuZmlsdGVyKCh2YWx1ZSkgPT4gIShjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgfHwgdGhpcy5oYXNJbmRvb3JzU3BhY2VzKSB8fCB2YWx1ZSAhPT0gXCJvdXRzaWRlT3JnXCIpXG4gICAgICAgICAgICAubWFwKChvd25lcikgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1vd25lclwiOiBvd25lciwgc2VsZWN0ZWQ6IG93bmVyID09PSB0aGlzLm93bmVyIH0sIGgoXCJhXCIsIG51bGwsIHRoaXMuZ2V0T3duZXJUZXh0KG93bmVyKSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInNlYXJjaFVzZXJuYW1lXCI6IFtcInNlYXJjaFVzZXJuYW1lQ2hhbmdlZFwiXVxuICAgIH07IH1cbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE9yZ1NldHRpbmdzR3JvdXBzUXVlcnkocG9ydGFsKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgbGV0IHF1ZXJ5U3RyaW5ncyA9IFtdO1xuICAgIGNvbnN0IG9yZ1NldHRpbmdzUXVlcmllcyA9IFtcbiAgICAgICAgLy8gT3JnIFNldHRpbmdzID4gR2FsbGVyeVxuICAgICAgICBwb3J0YWwuZmVhdHVyZWRJdGVtc0dyb3VwUXVlcnksXG4gICAgICAgIC8vIE9yZyBTZXR0aW5ncyA+IE1hcFxuICAgICAgICBwb3J0YWwuYmFzZW1hcEdhbGxlcnlHcm91cFF1ZXJ5LFxuICAgICAgICBwb3J0YWwudGVtcGxhdGVzR3JvdXBRdWVyeSxcbiAgICAgICAgcG9ydGFsW1wiMkRTdHlsZXNHcm91cFF1ZXJ5XCJdLFxuICAgICAgICAoX2EgPSBwb3J0YWwuc3R5bGVzR3JvdXBRdWVyeSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9iID0gcG9ydGFsLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdHlsZXNHcm91cFF1ZXJ5LFxuICAgICAgICAoX2MgPSBwb3J0YWwuYW5hbHlzaXNMYXllcnNHcm91cFF1ZXJ5KSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAoX2QgPSBwb3J0YWwuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmFuYWx5c2lzTGF5ZXJzR3JvdXBRdWVyeSxcbiAgICAgICAgLy8gT3JnIFNldHRpbmdzID4gR3JvdXBzID4gQ29uZmlndXJpYWJsZSBBcHBzXG4gICAgICAgIHBvcnRhbC5nYWxsZXJ5VGVtcGxhdGVzR3JvdXBRdWVyeVxuICAgIF07XG4gICAgLy8gT3JnIFNldHRpbmdzID4gSG9tZSBQYWdlXG4gICAgaWYgKGhhc01vZGVybkhvbWVQYWdlRW5hYmxlZChwb3J0YWwpKSB7XG4gICAgICAgIGNvbnN0IGhvbWVQYWdlQ29uZmlnID0gYXdhaXQgZ2V0SG9tZVBhZ2VDb25maWcocG9ydGFsKTtcbiAgICAgICAgY29uc3QgY29udGVudEdhbGxlcmllcyA9ICgoX2UgPSBob21lUGFnZUNvbmZpZyA9PT0gbnVsbCB8fCBob21lUGFnZUNvbmZpZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaG9tZVBhZ2VDb25maWcuY29udGVudCkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmZpbHRlcigoY29udGVudCkgPT4gY29udGVudC50eXBlID09PSBcImdhbGxlcnlcIiAmJiAhIWNvbnRlbnQuZ3JvdXBJZCkpIHx8IFtdO1xuICAgICAgICBpZiAoY29udGVudEdhbGxlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb250ZW50R2FsbGVyaWVzLmZvckVhY2goKHsgZ3JvdXBJZCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBgaWQ6JHtncm91cElkfWA7XG4gICAgICAgICAgICAgICAgcXVlcnlTdHJpbmdzID0gYWRkVG9RdWVyeVN0cmluZyhxdWVyeSwgcXVlcnlTdHJpbmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBvcmdTZXR0aW5nc1F1ZXJpZXMucHVzaChwb3J0YWwuaG9tZVBhZ2VGZWF0dXJlZENvbnRlbnQpO1xuICAgIH1cbiAgICBvcmdTZXR0aW5nc1F1ZXJpZXMuZm9yRWFjaCgocXVlcnkpID0+IHtcbiAgICAgICAgcXVlcnlTdHJpbmdzID0gYWRkVG9RdWVyeVN0cmluZyhxdWVyeSwgcXVlcnlTdHJpbmdzKTtcbiAgICB9KTtcbiAgICAvLyBPcmcgU2V0dGluZ3MgPiBGZWF0dXJlZCBHcm91cHNcbiAgICBwb3J0YWwuZmVhdHVyZWRHcm91cHMuZm9yRWFjaCgoZmVhdHVyZWRHcm91cCkgPT4ge1xuICAgICAgICBpZiAoZmVhdHVyZWRHcm91cC5pZCkge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBgaWQ6JHtmZWF0dXJlZEdyb3VwLmlkfWA7XG4gICAgICAgICAgICBxdWVyeVN0cmluZ3MgPSBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gaW4gZW50ZXJwcmlzZSwgc29tZSBncm91cHMgZG9uJ3QgdXNlIGlkcywgc28gY29tbWl0IHRoZSBmdWxsIGFzc2VtYmxlZCBxdWVyeVxuICAgICAgICAgICAgY29uc3QgcXVlcnlQYXJ0cyA9IE9iamVjdC5lbnRyaWVzKGZlYXR1cmVkR3JvdXApLm1hcCgoZW50cnkpID0+IGAke2VudHJ5WzBdfTpcIiR7ZW50cnlbMV19XCJgKTtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gYCgke3F1ZXJ5UGFydHMuam9pbihcIiBcIil9KWA7XG4gICAgICAgICAgICBxdWVyeVN0cmluZ3MgPSBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MsIHRydWUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gT3JnIFNldHRpbmdzID4gTWVtYmVyIERlZmF1bHRzXG4gICAgY29uc3QgbWVtYmVyRGVmYXVsdHMgPSBhd2FpdCBnZXRNZW1iZXJEZWZhdWx0cyhwb3J0YWwpO1xuICAgIChfZiA9IG1lbWJlckRlZmF1bHRzID09PSBudWxsIHx8IG1lbWJlckRlZmF1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtZW1iZXJEZWZhdWx0cy5ncm91cHMpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeSA9IGBpZDoke2lkfWA7XG4gICAgICAgIHF1ZXJ5U3RyaW5ncyA9IGFkZFRvUXVlcnlTdHJpbmcocXVlcnksIHF1ZXJ5U3RyaW5ncyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHF1ZXJ5U3RyaW5ncy5sZW5ndGggPiAwID8gYCgke3F1ZXJ5U3RyaW5ncy5qb2luKFwiIE9SIFwiKX0pYCA6IFwiXCI7XG59XG5mdW5jdGlvbiBhZGRUb1F1ZXJ5U3RyaW5nKHF1ZXJ5LCBxdWVyeVN0cmluZ3MsIGFsbG93Tm9uSWQpIHtcbiAgICBpZiAoKChxdWVyeSA9PT0gbnVsbCB8fCBxdWVyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVlcnkuaW5kZXhPZihcImlkOlwiKSkgIT09IDAgJiYgIWFsbG93Tm9uSWQpIHx8IHF1ZXJ5U3RyaW5ncy5pbmNsdWRlcyhxdWVyeSkpIHtcbiAgICAgICAgcmV0dXJuIFsuLi5xdWVyeVN0cmluZ3NdO1xuICAgIH1cbiAgICByZXR1cm4gWy4uLnF1ZXJ5U3RyaW5ncywgcXVlcnldO1xufVxuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJTcGVjaWFsR3JvdXBzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5oYXNJbmRvb3JzU3BhY2VzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3BlY2lhbEdyb3VwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBbXTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlclNwZWNpYWxHcm91cHM7XG4gICAgICAgIHRoaXMuaGFzSW5kb29yc1NwYWNlcyA9IHRoaXMuc3RvcmUuc3RhdGUuaGFzSW5kb29yc1NwYWNlcztcbiAgICAgICAgdGhpcy52YWxpZGF0ZU9wdGlvbnMoKTtcbiAgICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKCkgPT4gdGhpcy52YWxpZGF0ZU9wdGlvbnMoKSk7XG4gICAgfVxuICAgIGFzeW5jIHZhbGlkYXRlT3B0aW9ucygpIHtcbiAgICAgICAgaWYgKCFjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgICAgICAgIHJldHVybiAodGhpcy5vcHRpb25zID0gW10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNldHRpbmdzUXVlcnkgPSBhd2FpdCBnZXRPcmdTZXR0aW5nc0dyb3Vwc1F1ZXJ5KGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IFtcIm9wZW5EYXRhXCIsIFwic2hhcmVkVXBkYXRlXCIsIFwiZGlzdHJpYnV0ZWRcIiwgXCJhZG1pblwiLCBcInNldHRpbmdzXCJdLmZpbHRlcigob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gISgob3B0aW9uID09PSBcIm9wZW5EYXRhXCIgJiYgY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsKSB8fFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vd2ViZ2lzL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy8zNzgzMVxuICAgICAgICAgICAgICAgIChvcHRpb24gPT09IFwiZGlzdHJpYnV0ZWRcIiAmJiB0aGlzLmhhc0luZG9vcnNTcGFjZXMpIHx8XG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ1NDQ5IG9yZ3Mgd2l0aCBubyBzZXR0aW5ncyBncm91cHMgY29uZmlndXJlZCBkb24ndCBuZWVkIHRoaXMgb3B0aW9uXG4gICAgICAgICAgICAgICAgKG9wdGlvbiA9PT0gXCJzZXR0aW5nc1wiICYmICFzZXR0aW5nc1F1ZXJ5KSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5zcGVjaWFsR3JvdXApIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyLmVtaXQoYXdhaXQgdGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJzcGVjaWFsR3JvdXBzXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLnNwZWNpYWxHcm91cCA9IG51bGwpKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0UXVlcnlWYWx1ZSgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNwZWNpYWxHcm91cCkge1xuICAgICAgICAgICAgY2FzZSBcIm9wZW5EYXRhXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaXNvcGVuZGF0YTp0cnVlXCI7XG4gICAgICAgICAgICBjYXNlIFwic2hhcmVkVXBkYXRlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiY2FwYWJpbGl0aWVzOnVwZGF0ZWl0ZW1jb250cm9sXCI7XG4gICAgICAgICAgICBjYXNlIFwiZGlzdHJpYnV0ZWRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJjYXBhYmlsaXRpZXM6ZGlzdHJpYnV0ZWRcIjtcbiAgICAgICAgICAgIGNhc2UgXCJhZG1pblwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImlzbGVhdmluZ2Rpc2FsbG93ZWQ6dHJ1ZVwiO1xuICAgICAgICAgICAgY2FzZSBcInNldHRpbmdzXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGdldE9yZ1NldHRpbmdzR3JvdXBzUXVlcnkoY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIGNvbnN0IHsgc3BlY2lhbEdyb3VwIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZ2V0UXVlcnlWYWx1ZSgpO1xuICAgICAgICBjb25zdCBsYWJlbCA9IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtsYWJlbH1cIiwgdGhpcy5pMThuW3NwZWNpYWxHcm91cF0pO1xuICAgICAgICByZXR1cm4geyBpZDogXCJzcGVjaWFsR3JvdXBzXCIsIHBhcmFtOiBcInFcIiwgdmFsdWUsIGxhYmVsLCBzcGVjaWFsR3JvdXBzOiBzcGVjaWFsR3JvdXAgfTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBpZiAoIShjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuc3BlY2lhbEdyb3VwLCBmaWx0ZXJJRDogXCJzcGVjaWFsR3JvdXBzXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lhbEdyb3VwID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpYWxHcm91cHMgPSAoKF9iID0gKF9hID0gbm9kZS5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5kYXRhc2V0LnNwZWNpYWxHcm91cHMpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3BlY2lhbEdyb3VwID09PSBzcGVjaWFsR3JvdXBzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lhbEdyb3VwID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlY2lhbEdyb3VwID0gc3BlY2lhbEdyb3VwcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXIuZW1pdChhd2FpdCB0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLm9wdGlvbnMubWFwKChzcGVjaWFsR3JvdXBzKSA9PiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLXNwZWNpYWwtZ3JvdXBzXCI6IHNwZWNpYWxHcm91cHMsIHNlbGVjdGVkOiBzcGVjaWFsR3JvdXBzID09PSB0aGlzLnNwZWNpYWxHcm91cCB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5bc3BlY2lhbEdyb3Vwc10sIHNwZWNpYWxHcm91cHMgPT09IFwic2V0dGluZ3NcIiAmJiAoaChcImFyY2dpcy1pbmZvcm1hdGlvblwiLCB7IHN0eWxlOiB7IHZlcnRpY2FsQWxpZ246IFwiLS4yNXJlbVwiLCBcIi0tYXJjZ2lzLWluZm9ybWF0aW9uLW1pbi13aWR0aFwiOiBcIjBcIiB9LCBsYWJlbDogdGhpcy5pMThuLnRvb2x0aXBMYWJlbCwgb3ZlcmxheVBvc2l0aW9uaW5nOiBcImZpeGVkXCIsIHBsYWNlbWVudDogXCJib3R0b20tZW5kXCIsIHBhZGRlZENvbnRlbnQ6IHRydWUgfSwgaChcImRpdlwiLCBudWxsLCB0aGlzLmkxOG4udG9vbHRpcCkpKSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlcnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlcnNcIiwgeyBzdG9yZTogdGhpcy5zdG9yZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0b3BcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwidG9wXCIgfSkpLCBoKFwic2xvdFwiLCBudWxsKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiYm90dG9tXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImJvdHRvbVwiIH0pKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNHcm91cEJyb3dzZXJQYWdpbmF0aW9uQ3NzID0gXCIud3JhcHBlcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjtwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO3BhZGRpbmctdG9wOjJyZW07cGFkZGluZy1ib3R0b206MnJlbX0uaGlkZXtkaXNwbGF5Om5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclBhZ2luYXRpb24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMudG90YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubnVtID0gNjA7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzdGFydCwgdG90YWwsIG51bSwgc3RvcmUgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLXBhZ2luYXRpb25cIiwgeyBzdGFydDogc3RhcnQsIHRvdGFsOiB0b3RhbCwgbnVtOiBudW0sIHN0b3JlOiBzdG9yZSwgb25BcmNnaXNCcm93c2VyUGFnZTogKGUpID0+IHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyUGFnZS5lbWl0KGUuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJQYWdpbmF0aW9uLnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyUGFnaW5hdGlvbkNzcztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcm91cE1lbWJlcnMoZ3JvdXBJZCwgcG9ydGFsLCBwYXJhbXMgPSB7fSkge1xuICAgIGNvbnN0IHJlc3RCYXNlID0gZ2V0UmVzdEJhc2VVcmwocG9ydGFsKTtcbiAgICBjb25zdCB1cmwgPSBgJHtyZXN0QmFzZX1jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXBJZH0vdXNlcmxpc3RgO1xuICAgIHJldHVybiByZXF1ZXN0KHVybCwgcGFyYW1zKTtcbn1cblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NzcyA9IFwiOmhvc3R7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7ZmxleDoxIDEgMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX0ucHJldmlld19faGVhZGVye21hcmdpbi1pbmxpbmUtc3RhcnQ6MC43NXJlbX0ucHJldmlld19fdGl0bGV7bWFyZ2luOjBweDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7cGFkZGluZzowcHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtsaW5lLWhlaWdodDoxLjM3NX0udGl0bGV7bWFyZ2luLXRvcDowLjc1cmVtO21hcmdpbi1ib3R0b206MC43NXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MS4xMjVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTt3b3JkLXdyYXA6YnJlYWstd29yZDt3b3JkLWJyZWFrOmJyZWFrLXdvcmR9LmJhZGdlc3ttYXJnaW4tdG9wOjFyZW19LmJhZGdlc1tlbXB0eV17ZGlzcGxheTpub25lfWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW17LS1jYWxjaXRlLWFjY29yZGlvbi1pdGVtLXBhZGRpbmc6MXJlbSAxcmVtOy0tY2FsY2l0ZS1hY2NvcmRpb24taXRlbS1iYWNrZ3JvdW5kOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTt3aWR0aDoxMDAlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0yKX0uc2VjdGlvbntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7cGFkZGluZzoxcmVtO21hcmdpbjowcmVtIC0xcmVtIGNhbGMoLTFyZW0gLSAxcHgpO2xpbmUtaGVpZ2h0OjEuMzV9LnNlY3Rpb24tLXRpZ2h0e3BhZGRpbmctdG9wOjBweDtwYWRkaW5nLWJvdHRvbTowcHg7cGFkZGluZy1sZWZ0OjBweDtwYWRkaW5nLXJpZ2h0OjBweH0uc2VjdGlvbi0tY2VudGVyZWR7ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2FsaWduLWl0ZW1zOmNlbnRlcjtyb3ctZ2FwOjAuNzVyZW19LmZ1bGwtY2FyZC13cmFwcGVye3BhZGRpbmctbGVmdDowLjVyZW07cGFkZGluZy1yaWdodDowLjVyZW07cGFkZGluZy10b3A6MC43NXJlbX0uZGV0YWlscy10aXRsZXttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbTowcHg7cGFkZGluZy1ib3R0b206MC4yNXJlbTtwYWRkaW5nLXRvcDowcHg7Zm9udC1zaXplOjAuNzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKTstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowfS5kZXRhaWxzLXRpdGxlOmZpcnN0LW9mLXR5cGV7bWFyZ2luLXRvcDowcHh9LmRldGFpbHMtdGl0bGUtLWxhYmVse3BhZGRpbmctYm90dG9tOjBweH0uZGV0YWlscy10ZXh0e21hcmdpbjowcHg7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO3BhZGRpbmc6MHB4O2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5kZXRhaWxzLXRleHQgYXtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayl9LmRldGFpbHMtLXRleHQtZW1wdHl7Zm9udC13ZWlnaHQ6NDAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKX0uZGV0YWlscy1saW5re21hcmdpbi10b3A6MC43NXJlbX0uZGVzY3JpcHRpb257b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO2xpbmUtaGVpZ2h0OjEuMzV9LmRlc2NyaXB0aW9uICp7Zm9udC1zaXplOjAuODc1cmVtICFpbXBvcnRhbnR9Lmljb24teGx7aGVpZ2h0OjNyZW07d2lkdGg6M3JlbX0uY29udGVudC1jYXJke21hcmdpbi1ib3R0b206MC4yNXJlbX0uY29udGVudC10aHVtYm5haWx7bWFyZ2luLXRvcDphdXRvO21hcmdpbi1ib3R0b206YXV0bzt3aWR0aDoxMDAlO21hcmdpbi1pbmxpbmUtZW5kOjFyZW19LnNldHRpbmdzLXRleHR7bWFyZ2luLXRvcDotMC4yNXJlbTttYXJnaW4tYm90dG9tOi0wLjI1cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo0MDB9LmZvb3Rlci1hY3Rpb25ze2Rpc3BsYXk6ZmxleDt3aWR0aDoxMDAlO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtyb3ctZ2FwOjAuNXJlbTtwYWRkaW5nOjFyZW19LmJsb2NrLS1wYWRkZWR7cGFkZGluZy1ib3R0b206MXJlbTtwYWRkaW5nLWlubGluZS1zdGFydDowLjI1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2xvc2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXdDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgICAgICB0aGlzLmdyb3VwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd0JhZGdlcyA9IHRydWU7XG4gICAgICAgIHRoaXMuY3VycmVudFJlc3BvbnNlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZ1bGxHcm91cCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VySW5mbyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb250ZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1hbmFnZXJzID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmxhbmcgPSBhd2FpdCBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5wcmV2aWV3O1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG4gICAgdXBkYXRlUHJldmlldygpIHtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuICAgIGFzeW5jIGluaXQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBpZiAoIXRoaXMuZ3JvdXApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGdyb3VwLCBwb3J0YWwsIHVzZXIgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMuaXNHcm91cE93bmVyID0gZ3JvdXAub3duZXIgPT09ICh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIudXNlcm5hbWUpO1xuICAgICAgICB0aGlzLmZ1bGxHcm91cCA9IG51bGw7XG4gICAgICAgIHRoaXMuZnVsbEdyb3VwID0gYXdhaXQgbWluRGVsYXkoZmV0Y2hHcm91cChncm91cC5pZCwgdGhpcy5wb3J0YWwpLCA2MDApO1xuICAgICAgICB0aGlzLnVzZXJJbmZvID0gYXdhaXQgZmV0Y2hVc2VyKGdyb3VwLm93bmVyLCBwb3J0YWwpO1xuICAgICAgICBjb25zdCBjb250ZW50UXVlcnkgPSB0aGlzLmdldFR5cGVRdWVyeSh0aGlzLmZ1bGxHcm91cCk7XG4gICAgICAgIHRoaXMuY29udGVudCA9IGF3YWl0ICgoKF9iID0gKF9hID0gdGhpcy5mdWxsR3JvdXAucHJvcGVydGllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZlYXR1cmVkSXRlbUlkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgJiZcbiAgICAgICAgICAgIHRoaXMuZnVsbEdyb3VwLnByb3BlcnRpZXMuaXNGZWF0dXJlZFxuICAgICAgICAgICAgPyBxdWVyeUZlYXR1cmVkQ29udGVudChwb3J0YWwsIGdyb3VwLmlkLCB0aGlzLmZ1bGxHcm91cC5wcm9wZXJ0aWVzLmZlYXR1cmVkSXRlbUlkcylcbiAgICAgICAgICAgIDogcXVlcnlHcm91cENvbnRlbnQocG9ydGFsLCBncm91cC5pZCwgT2JqZWN0LmFzc2lnbih7IHNvcnRGaWVsZDogdGhpcy5mdWxsR3JvdXAuc29ydEZpZWxkIHx8IFwibW9kaWZpZWRcIiwgc29ydE9yZGVyOiB0aGlzLmZ1bGxHcm91cC5zb3J0T3JkZXIgfHwgXCJkZXNjXCIgfSwgKGNvbnRlbnRRdWVyeSA/IHsgcTogY29udGVudFF1ZXJ5IH0gOiB7fSkpKSk7XG4gICAgICAgIHRoaXMubWFuYWdlcnMgPSBhd2FpdCB0aGlzLmZldGNoR3JvdXBBZG1pbnMocG9ydGFsLCBncm91cCk7XG4gICAgICAgIChfYyA9IHRoaXMuZmxvd0l0ZW0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zZXRGb2N1cygpO1xuICAgIH1cbiAgICBoYW5kbGVBY2NvcmRpb25JdGVtQ2xpY2soZWxlbWVudCwgZGV0YWlscykge1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICAgICAgICBhY3Rpb246IGVsZW1lbnQuZXhwYW5kZWQgPyBcImV4cGFuZFwiIDogXCJjb2xsYXBzZVwiLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwiZ3JvdXAgcGFuZWwgYWN0aW9uXCIsXG4gICAgICAgICAgICBkZXRhaWxzXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZVByZXZpZXcoKSB7XG4gICAgICAgIHRoaXMuZnVsbEdyb3VwID0gbnVsbDtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgICAgICAgYWN0aW9uOiBcImNsb3NlIHBhbmVsXCIsXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJncm91cCBwYW5lbCBhY3Rpb25cIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2xvc2UuZW1pdCgpO1xuICAgIH1cbiAgICBoYW5kbGVEZXRhaWxzQ2xpY2soZGV0YWlscykge1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICAgICAgICBhY3Rpb246IFwiY2xpY2tcIixcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcImdyb3VwIHBhbmVsIGFjdGlvblwiLFxuICAgICAgICAgICAgZGV0YWlsc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVySGVhZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiaGVhZGVyLWNvbnRlbnRcIiwgY2xhc3M6IFwicHJldmlld19faGVhZGVyXCIgfSwgaChcImgzXCIsIHsgY2xhc3M6IFwicHJldmlld19fdGl0bGVcIiB9LCAoX2EgPSB0aGlzLmdyb3VwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpKSk7XG4gICAgfVxuICAgIGlzQWNjb3JkaW9uSXRlbShlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LnRhZ05hbWUgPT09IFwiQ0FMQ0lURS1BQ0NPUkRJT04tSVRFTVwiO1xuICAgIH1cbiAgICBnZXRWaWV3QnlUZXh0KGdyb3VwKSB7XG4gICAgICAgIHN3aXRjaCAoZ3JvdXAuYWNjZXNzKSB7XG4gICAgICAgICAgICBjYXNlIFwicHVibGljXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5ldmVyeW9uZTtcbiAgICAgICAgICAgIGNhc2UgXCJwcml2YXRlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5vbmx5TWVtYmVycztcbiAgICAgICAgICAgIGNhc2UgXCJvcmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLm9ubHlPcmdhbml6YXRpb247XG4gICAgICAgICAgICBjYXNlIFwic2hhcmVkXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5vbmx5T3JnYW5pemF0aW9uQW5kUGFydG5lcnM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0Sm9pbkJ5VGV4dChncm91cCkge1xuICAgICAgICBpZiAoZ3JvdXAuYXV0b0pvaW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uYnlBdXRvam9pbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ3JvdXAuaXNJbnZpdGF0aW9uT25seSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5ieUludml0YXRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdyb3VwLnByb3ZpZGVyR3JvdXBOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLmJ5RW50ZXJwcmlzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5pMThuLmJ5UmVxdWVzdDtcbiAgICB9XG4gICAgYXN5bmMgZmV0Y2hHcm91cEFkbWlucyhwb3J0YWwsIGdyb3VwKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGFkbWlucyA9IChfYiA9IChfYSA9IChhd2FpdCBmZXRjaEdyb3VwTWVtYmVycyhncm91cC5pZCwgcG9ydGFsLCB7IG1lbWJlclR5cGU6IFwiYWRtaW5cIiB9KSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51c2VycykgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgIGNvbnN0IG93bmVyID0gYWRtaW5zLmZpbmQoKGFkbWluKSA9PiBhZG1pbi51c2VybmFtZSA9PT0gZ3JvdXAub3duZXIpO1xuICAgICAgICByZXR1cm4gW293bmVyLCAuLi5hZG1pbnMuZmlsdGVyKChhZG1pbikgPT4gYWRtaW4udXNlcm5hbWUgIT09IG93bmVyLnVzZXJuYW1lKV07XG4gICAgfVxuICAgIGdldFR5cGVRdWVyeShncm91cCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICgoX2EgPSBncm91cC5kaXNwbGF5U2V0dGluZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pdGVtVHlwZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ3JvdXAuZGlzcGxheVNldHRpbmdzLml0ZW1UeXBlcy5zcGxpdChcIixcIilbMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHN3aXRjaCAoaXRlbVR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXBwbGljYXRpb25cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1UeXBlT3B0aW9ucy5hcHBsaWNhdGlvbnMucTtcbiAgICAgICAgICAgICAgICBjYXNlIFwid2ViIG1hcFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVR5cGVPcHRpb25zLm1hcHMucTtcbiAgICAgICAgICAgICAgICBjYXNlIFwid2ViIHNjZW5lXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtVHlwZU9wdGlvbnMuc2NlbmVzLnE7XG4gICAgICAgICAgICAgICAgY2FzZSBcImxvY2F0b3IgcGFja2FnZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVR5cGVPcHRpb25zLnRvb2xzLnE7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNzdlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVR5cGVPcHRpb25zLmZpbGVzLnE7XG4gICAgICAgICAgICAgICAgY2FzZSBcImxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtVHlwZU9wdGlvbnMubGF5ZXJzLnE7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGdyb3VwLCBmdWxsR3JvdXAsIGkxOG4sIG1hbmFnZXJzLCBwb3J0YWwsIGNvbnRlbnQsIHNob3dCYWRnZXMsIHVzZXIgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1mbG93XCIsIG51bGwsIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGNsb3NhYmxlOiB0cnVlLCBsb2FkaW5nOiAhZnVsbEdyb3VwLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoKSA9PiB0aGlzLmNsb3NlUHJldmlldygpLCByZWY6IChlbCkgPT4gKHRoaXMuZmxvd0l0ZW0gPSBlbCkgfSwgdGhpcy5yZW5kZXJIZWFkZXIoKSwgZnVsbEdyb3VwICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGVudFwiIH0sIGgoXCJjYWxjaXRlLWFjY29yZGlvblwiLCB7IFwiaWNvbi1wb3NpdGlvblwiOiBcInN0YXJ0XCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwga2V5OiBncm91cC5pZCwgY2xhc3M6IFwiYWNjb3JkaW9uXCIgfSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLm92ZXJ2aWV3LCBleHBhbmRlZDogQm9vbGVhbihmdWxsR3JvdXAuc25pcHBldCksIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVydmlld0VsZW1lbnQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2xpY2s6IChlKSA9PiB0aGlzLmlzQWNjb3JkaW9uSXRlbShlLnRhcmdldCkgJiZcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLm92ZXJ2aWV3RWxlbWVudCwgXCJvdmVydmlld1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGZ1bGxHcm91cC5zbmlwcGV0ID8gKGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0XCIgfSwgZnVsbEdyb3VwLnNuaXBwZXQpKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub1N1bW1hcnkpKSwgc2hvd0JhZGdlcyAmJiAoaChcImFyY2dpcy1ncm91cC1iYWRnZXNcIiwgeyBncm91cDogZnVsbEdyb3VwLCBwb3J0YWw6IHBvcnRhbCwgc2hvd1Rvb2x0aXBzOiBmYWxzZSwgd2lkdGg6IFwiZnVsbFwiLCBzY2FsZTogXCJzXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGNsYXNzOiBcImJhZGdlc1wiIH0pKSkpLCBoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGkxOG4uZGVzY3JpcHRpb24sIGtleTogXCJkZXNjcmlwdGlvblwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50ID0gZWw7XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBY2NvcmRpb25JdGVtQ2xpY2sodGhpcy5kZXNjcmlwdGlvbkVsZW1lbnQsIFwiZGVzY3JpcHRpb25cIikgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb25cIiB9LCBmdWxsR3JvdXAuZGVzY3JpcHRpb24gPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcImRlc2NyaXB0aW9uXCIsIGlubmVySFRNTDogc2FuaXRpemVIVE1MKGZ1bGxHcm91cC5kZXNjcmlwdGlvbikgfSkpIDogKGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0IGRldGFpbHMtdGV4dC0tZW1wdHlcIiB9LCBpMThuLm5vRGVzY3JpcHRpb24pKSkpLCBoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGkxOG4uY29udGVudC5yZXBsYWNlKFwiJHtjb3VudH1cIiwgY29udGVudCA/IGAke2NvbnRlbnQudG90YWx9YCA6IFwiMFwiKSwgZXhwYW5kZWQ6IHRydWUsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50RWxlbWVudCA9IGVsO1xuICAgICAgICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMuY29udGVudEVsZW1lbnQsIFwiY29udGVudFwiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IHsgc2VjdGlvbjogdHJ1ZSwgXCJzZWN0aW9uLS10aWdodFwiOiAoY29udGVudCA9PT0gbnVsbCB8fCBjb250ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb250ZW50LnRvdGFsKSA+IDAgfSB9LCAoY29udGVudCA9PT0gbnVsbCB8fCBjb250ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb250ZW50LnRvdGFsKSA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZnVsbC1jYXJkLXdyYXBwZXJcIiB9LCBjb250ZW50LnJlc3VsdHMubWFwKChpdGVtKSA9PiAoaChcImFyY2dpcy1ncm91cC1icm93c2VyLXByZXZpZXctY2FyZFwiLCB7IGNsYXNzOiBcImNvbnRlbnQtY2FyZFwiLCBpdGVtOiBpdGVtLCBwb3J0YWw6IHBvcnRhbCwgdXNlcjogdXNlciwga2V5OiBpdGVtLmlkIH0pKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZXRhaWxzLWxpbmsgYmxvY2stLXBhZGRlZFwiIH0sIGgoXCJjYWxjaXRlLWxpbmtcIiwgeyBocmVmOiBgJHtnZXRQb3J0YWxCYXNlVXJsKHBvcnRhbCl9L2hvbWUvZ3JvdXAuaHRtbD9pZD0ke2dyb3VwLmlkfSZ2aWV3PWxpc3QjY29udGVudGAsIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURldGFpbHNDbGljayhcInZpZXcgYWxsIGNvbnRlbnRcIik7XG4gICAgICAgICAgICB9IH0sIGkxOG4udmlld0NvbnRlbnQpKSkpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uLS1jZW50ZXJlZFwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBzY2FsZTogXCJsXCIsIGljb246IFwiZmlsZXNcIiwgY2xhc3M6IFwiaWNvbi14bCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSksIGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0IGRldGFpbHMtdGV4dC0tZW1wdHlcIiB9LCBpMThuLm5vQ29udGVudCkpKSkpLCBoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGkxOG4uZ3JvdXBNYW5hZ2Vycy5yZXBsYWNlKFwiJHtjb3VudH1cIiwgbWFuYWdlcnMgPyBgJHttYW5hZ2Vycy5sZW5ndGh9YCA6IFwiMFwiKSwgZXhwYW5kZWQ6IHRydWUsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2Vyc0VsZW1lbnQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2xpY2s6IChlKSA9PiB0aGlzLmlzQWNjb3JkaW9uSXRlbShlLnRhcmdldCkgJiZcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLm1hbmFnZXJzRWxlbWVudCwgXCJtYW5hZ2Vyc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvbiBzZWN0aW9uLS10aWdodFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmdWxsLWNhcmQtd3JhcHBlclwiIH0sIG1hbmFnZXJzID09PSBudWxsIHx8IG1hbmFnZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOlxuICAgICAgICAgICAgbWFuYWdlcnMubWFwKChhZG1pbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY2FyZFwiLCB7IGtleTogYWRtaW4udXNlcm5hbWUsIGNsYXNzOiBcImNvbnRlbnQtY2FyZFwiIH0sIGgoXCJhcmNnaXMtdXNlci1hdmF0YXJcIiwgeyBoZWFkaW5nOiBhZG1pbi51c2VybmFtZSA9PT0gZ3JvdXAub3duZXJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gaTE4bi5ncm91cE93bmVyLnJlcGxhY2UoXCIke2Z1bGxOYW1lfVwiLCBnZXRGdWxsTmFtZShhZG1pbiwgdGhpcy5sYW5nKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYWRtaW4uZnVsbE5hbWUsIHNob3dOYW1lOiB0cnVlLCB1c2VyOiBhZG1pbiwgZGVzY3JpcHRpb246IGFkbWluLnVzZXJuYW1lLCBwb3J0YWw6IHBvcnRhbCB9KSkpO1xuICAgICAgICAgICAgfSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZXRhaWxzLWxpbmsgYmxvY2stLXBhZGRlZFwiIH0sIGgoXCJjYWxjaXRlLWxpbmtcIiwgeyBocmVmOiBgJHtnZXRQb3J0YWxCYXNlVXJsKHBvcnRhbCl9L2hvbWUvZ3JvdXAuaHRtbD9pZD0ke2dyb3VwLmlkfSNtZW1iZXJzYCwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRGV0YWlsc0NsaWNrKFwib3BlbiBtZW1iZXJzIHBhZ2VcIik7XG4gICAgICAgICAgICB9IH0sIGkxOG4ub3Blbk1lbWJlcnMpKSkpKSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLnNldHRpbmdzLCBleHBhbmRlZDogdGhpcy5pc0dyb3VwT3duZXIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nc0VsZW1lbnQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2xpY2s6IChlKSA9PiB0aGlzLmlzQWNjb3JkaW9uSXRlbShlLnRhcmdldCkgJiZcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLnNldHRpbmdzRWxlbWVudCwgXCJzZXR0aW5nc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCBpMThuLnZpZXdhYmxlQnksIFwiOlwiKSwgaChcInBcIiwgeyBjbGFzczogXCJzZXR0aW5ncy10ZXh0XCIgfSwgdGhpcy5nZXRWaWV3QnlUZXh0KGZ1bGxHcm91cCkpLCBoKFwiaDRcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRpdGxlXCIgfSwgaTE4bi5jb250cmlidXRvcnMsIFwiOlwiKSwgaChcInBcIiwgeyBjbGFzczogXCJzZXR0aW5ncy10ZXh0XCIgfSwgZnVsbEdyb3VwLmlzVmlld09ubHkgPyBpMThuLm9ubHlPd25lck1hbmFnZXIgOiBpMThuLmFsbE1lbWJlcnMpLCB0aGlzLmlzR3JvdXBPd25lciAmJiAoaChGcmFnbWVudCwgbnVsbCwgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uam9pbk1ldGhvZCwgXCI6XCIpLCBoKFwicFwiLCB7IGNsYXNzOiBcInNldHRpbmdzLXRleHRcIiB9LCB0aGlzLmdldEpvaW5CeVRleHQoZnVsbEdyb3VwKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZXRhaWxzLWxpbmtcIiB9LCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgaHJlZjogYCR7Z2V0UG9ydGFsQmFzZVVybChwb3J0YWwpfS9ob21lL2dyb3VwLmh0bWw/aWQ9JHtncm91cC5pZH0jc2V0dGluZ3NgLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEZXRhaWxzQ2xpY2soXCJvcGVuIHNldHRpbmdzXCIpO1xuICAgICAgICAgICAgfSB9LCBpMThuLm9wZW5TZXR0aW5ncykpKSkpKSkpKSwgIXRoaXMuaGlkZVByZXZpZXdGb290ZXIgJiYgKGgoXCJkaXZcIiwgeyBzbG90OiBcImZvb3RlclwiLCBjbGFzczogXCJmb290ZXItYWN0aW9uc1wiIH0sIHBvcnRhbCAmJiBncm91cCAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGN1cnJlbnRSZXNwb25zZSwgZ3JvdXAgfSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSAoX2EgPSBjdXJyZW50UmVzcG9uc2UgPT09IG51bGwgfHwgY3VycmVudFJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXJyZW50UmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmRJbmRleCgocmVzdWx0KSA9PiByZXN1bHQuaWQgPT09IGdyb3VwLmlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGluZGV4ICsgY3VycmVudFJlc3BvbnNlLnN0YXJ0O1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInZpZXcgZ3JvdXAgZGV0YWlsc1wiLFxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJncm91cCBwYW5lbCBhY3Rpb25cIixcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIGhyZWY6IGAke2dldFBvcnRhbEJhc2VVcmwocG9ydGFsKX0vaG9tZS9ncm91cC5odG1sP2lkPSR7Z3JvdXAuaWR9YCwga2luZDogXCJuZXV0cmFsXCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiZnVsbFwiIH0sIGkxOG4udmlld0RldGFpbHMpKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImZvb3Rlci1hY3Rpb25cIiB9KSkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiZ3JvdXBcIjogW1widXBkYXRlUHJldmlld1wiXVxuICAgIH07IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3LnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NzcztcblxuY29uc3QgYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmRDc3MgPSBcIjpob3N0e2Rpc3BsYXk6YmxvY2s7bWluLXdpZHRoOjBweH0uY2FyZHtwb3NpdGlvbjpyZWxhdGl2ZTtib3gtc2l6aW5nOmJvcmRlci1ib3g7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtvcGFjaXR5OjA7LS10dy1zaGFkb3c6MCAwICMwMDAwOy0tdHctc2hhZG93LWNvbG9yZWQ6MCAwICMwMDAwO2JveC1zaGFkb3c6dmFyKC0tdHctcmluZy1vZmZzZXQtc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1yaW5nLXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctc2hhZG93KTt0cmFuc2l0aW9uLWR1cmF0aW9uOjE1MG1zO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7dHJhbnNpdGlvbi1wcm9wZXJ0eTpiYWNrZ3JvdW5kLWNvbG9yLCBvdXRsaW5lLCBvdXRsaW5lLW9mZnNldCwgb3BhY2l0eTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTMpfS5jYXJkOmZvY3Vze3otaW5kZXg6MTA7b3V0bGluZToycHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCk7b3V0bGluZS1vZmZzZXQ6LTJweH0uY2FyZC0tbG9hZGVke29wYWNpdHk6MX0uY2FyZC0tc2VsZWN0ZWR7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5jYXJkLS1ob3ZlcmFibGV7Y3Vyc29yOnBvaW50ZXJ9LmNhcmRfX3RvcHtwYWRkaW5nOjAuNzVyZW19LmNhcmRfX3VwcGVye2ZsZXg6MSAxIDAlO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO3RyYW5zaXRpb246YWxsIHZhcigtLWNhbGNpdGUtYW5pbWF0aW9uLXRpbWluZykgZWFzZS1pbi1vdXQgMHMsIG91dGxpbmUgMHMsIG91dGxpbmUtb2Zmc2V0IDBzfS5jYXJkLS1ob3ZlcmFibGUgLmNhcmRfX3VwcGVyOmhvdmVye2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX0uY2FyZF9fdXBwZXItLWxpbmt7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudH0uY2FyZF9fdXBwZXItLWxpbms6Zm9jdXN7ei1pbmRleDoxMDtvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9LmNhcmRfX2NvbnRlbnR7ZGlzcGxheTpmbGV4O21pbi13aWR0aDowcHg7ZmxleDoxIDEgMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5jYXJkX19kZXRhaWxze21hcmdpbi10b3A6MC4yNXJlbTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93fS5jYXJkX19kZXRhaWx7Zm9udC1zaXplOjAuNzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpfS5jYXJkX19mb290ZXJ7bWFyZ2luLXRvcDphdXRvO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMil9LmNhcmRfX2Zvb3Rlcl9fc3RhcnR7ZGlzcGxheTpmbGV4O21pbi13aWR0aDowcHg7ZmxleDoxIDEgMCU7ZmxleC1kaXJlY3Rpb246cm93O2FsaWduLWl0ZW1zOmNlbnRlcjtvdmVyZmxvdzpoaWRkZW47bWFyZ2luLWlubGluZS1lbmQ6MC43NXJlbX0uY2FyZF9fZm9vdGVyX19zdGFydC0tb3duZXJ7bWFyZ2luLWlubGluZS1zdGFydDotMC4yNXJlbX0uY2FyZF9fcHJvZmlsZS13cmFwe2JveC1zaXppbmc6Ym9yZGVyLWJveDttYXgtd2lkdGg6MTAwJTtwYWRkaW5nOjAuMjVyZW19LmNhcmRfX3N1bW1hcnl7bWFyZ2luOjBweDtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpfS5jYXJkX19kaXZpZGVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7ZmxleDowIDAgYXV0b30uY2FyZF9fZGl2aWRlcjpub3QoW2VtcHR5XSk6YmVmb3Jle2NvbnRlbnQ6XFxcIlxcXCI7aGVpZ2h0OjEuMjVyZW07d2lkdGg6MXB4O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSk7bWFyZ2luLWlubGluZTowLjc1cmVtfS5jYXJkX19kaXZpZGVyOmZpcnN0LWNoaWxkOmJlZm9yZXtkaXNwbGF5Om5vbmV9LmNhcmQtZmxleHtkaXNwbGF5OmZsZXh9LmNhcmQtZmxleC0xe21pbi13aWR0aDowcHg7ZmxleDoxIDEgMCV9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5jYXJkX190aXRsZXttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDtoZWlnaHQ6MnJlbTtvdmVyZmxvdzpoaWRkZW47b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO3BhZGRpbmctdG9wOjBweDtwYWRkaW5nLWJvdHRvbTowcHg7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtsaW5lLWhlaWdodDoxLjE1O2Rpc3BsYXk6LXdlYmtpdC1ib3g7LXdlYmtpdC1saW5lLWNsYW1wOjI7LXdlYmtpdC1ib3gtb3JpZW50OnZlcnRpY2FsfS5jYXJkX190aXRsZS0tcGFkZGVke21hcmdpbi1ib3R0b206MC41cmVtfS5jYXJkX19zbmlwcGV0e21hcmdpbjowcHg7bWFyZ2luLWJvdHRvbTowLjc1cmVtO2ZsZXg6MSAxIDAlO3BhZGRpbmc6MHB4O2ZvbnQtc2l6ZTowLjg3NXJlbX0uY2FyZF9fYmFkZ2VzLS1zdGFja2Vke21hcmdpbi10b3A6MC41cmVtfS5jYXJkX190aHVtYm5haWx7bWFyZ2luOjBweDtib3gtc2l6aW5nOmNvbnRlbnQtYm94O3dpZHRoOjRyZW07cGFkZGluZzowcHg7cGFkZGluZy1pbmxpbmUtc3RhcnQ6MC41cmVtfS5jYXJkX19vd25lcnttaW4td2lkdGg6MHB4fVwiO1xuXG5jb25zdCBBcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VySW50ZXJuYWxVSUFjdGlvblwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZFNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmRTZWxlY3RcIiwgNyk7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYXJkQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyB3aGVuIHVzaW5nIHRoZSBjYXJkcyBhcyBhIGxpbmssIGRvbid0IGRvIGFueSBzcGVjaWFsIGhhbmRsaW5nXG4gICAgICAgICAgICBpZiAodGhpcy5saW5rKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZFNlbGVjdC5lbWl0KHRoaXMuaXRlbSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hcGkgPSA0O1xuICAgICAgICB0aGlzLmJhc2VVcmwgPSAoX2EgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUuY29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYmFzZVVybDtcbiAgICAgICAgdGhpcy5saW5rID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5ld1RhYiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93VGh1bWJuYWlsID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93T3duZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLnNob3dJdGVtVHlwZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd0RhdGVVcGRhdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd1N1bW1hcnkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93QmFkZ2VzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd093bmVyUG9wdXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhvdmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVwZGF0ZWRUZXh0ID0gXCJcIjtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qIENhbGxpbmcgdGhpcyBzZXRGb2N1cyBjYXVzZXMgY2FsY2l0ZSB0byBmb2N1cyBoZXJlIHdoZW4gdGhlIHVzZXIgcG9wdXAgaXMgY2xvc2VkLi4uICovXG4gICAgYXN5bmMgcmVzdG9yZUZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy5saW5rICYmIHRoaXMubGlua0VsKSB7XG4gICAgICAgICAgICB0aGlzLmxpbmtFbC5mb2N1cygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlY3Rpb25FbCkge1xuICAgICAgICAgICAgdGhpcy5zZWN0aW9uRWwuZm9jdXMoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIC8vdGhpcy5zdG9yZSA9IGdldEdyb3VwQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICAvL3RoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5wcmV2aWV3Q2FyZDtcbiAgICAgICAgdGhpcy51cGRhdGVkVGV4dCA9IGZvcm1hdERhdGUodGhpcy5pdGVtLm1vZGlmaWVkKTtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSAoX2EgPSB0aGlzLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29uZmlnU3RhdGUucG9ydGFsO1xuICAgICAgICB0aGlzLnVzZXIgPSAoX2IgPSB0aGlzLnVzZXIpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgICAgIHRoaXMuYXBpID0gKF9jID0gdGhpcy5hcGkpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IGNvbmZpZ1N0YXRlLmFwaTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGltZW91dCgxMDApO1xuICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgeyBpdGVtLCB1c2VyLCBwb3J0YWwsIGFwaSwgXG4gICAgICAgIC8vaTE4bixcbiAgICAgICAgbG9hZGVkLCBzaG93RGF0ZVVwZGF0ZWQsIHNob3dJdGVtVHlwZSwgc2hvd093bmVyLCBzaG93T3duZXJQb3B1cCwgc2hvd0JhZGdlcywgc2hvd1N1bW1hcnksIHNob3dUaHVtYm5haWwsIGludGVyYWN0aXZlLCBsaW5rLCBuZXdUYWIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGJhc2VVcmwgPSAoX2EgPSB0aGlzLmJhc2VVcmwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJhc2VVcmw7XG4gICAgICAgIGNvbnN0IENhcmRUYWcgPSB0aGlzLmxpbmsgPyBcImFcIiA6IFwiZGl2XCI7XG4gICAgICAgIGNvbnN0IGxpbmtBdHRyaWJ1dGVzID0gT2JqZWN0LmFzc2lnbih7IGhyZWY6IGxpbmsgfSwgKG5ld1RhYiA/IHsgdGFyZ2V0OiBcIl9ibGFua1wiLCByZWw6IFwibm9vcGVuZXIgbm9yZWZlcnJlclwiIH0gOiB7fSkpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcInNlY3Rpb25cIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJjYXJkXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJjYXJkLS1ob3ZlcmFibGVcIjogaW50ZXJhY3RpdmUsXG4gICAgICAgICAgICAgICAgXCJjYXJkLS1sb2FkZWRcIjogbG9hZGVkXG4gICAgICAgICAgICB9IH0sIChpbnRlcmFjdGl2ZSA/IHsgb25Nb3VzZU92ZXI6ICgpID0+ICh0aGlzLmhvdmVyID0gdHJ1ZSkgfSA6IHt9KSwgKGludGVyYWN0aXZlID8geyBvbk1vdXNlT3V0OiAoKSA9PiAodGhpcy5ob3ZlciA9IGZhbHNlKSB9IDoge30pLCAobGluayA/IHt9IDogeyBvbkNsaWNrOiB0aGlzLmhhbmRsZUNhcmRDbGljayB9KSwgeyByZWY6IChlbCkgPT4gKHRoaXMuc2VjdGlvbkVsID0gZWwpIH0pLCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiY29udGVudC10b3BcIiB9KSwgaChDYXJkVGFnLCBPYmplY3QuYXNzaWduKHsgY2xhc3M6IHsgXCJjYXJkX191cHBlclwiOiB0cnVlLCBcImNhcmRfX3VwcGVyLS1saW5rXCI6ICEhbGluayB9IH0sIChsaW5rID8gbGlua0F0dHJpYnV0ZXMgOiB7fSksIHsgcmVmOiAoZWwpID0+ICh0aGlzLmxpbmtFbCA9IGVsKSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmQtZmxleCBjYXJkX190b3BcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2FyZC1mbGV4LTFcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2FyZC1mbGV4XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmRfX2NvbnRlbnRcIiB9LCBoKFwiaDNcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiY2FyZF9fdGl0bGVcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImNhcmRfX3RpdGxlLS1wYWRkZWRcIjogc2hvd0l0ZW1UeXBlIHx8IChzaG93U3VtbWFyeSAmJiAhIWl0ZW0uc25pcHBldClcbiAgICAgICAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJjYXJkX190aXRsZV9fc3BhblwiIH0sIGl0ZW0udGl0bGUpKSwgc2hvd1N1bW1hcnkgJiYgaXRlbS5zbmlwcGV0ICYmIChoKFwicFwiLCB7IGNsYXNzOiBcImNhcmRfX3N1bW1hcnlcIiB9LCBpdGVtLnNuaXBwZXQubGVuZ3RoID4gMjUwXG4gICAgICAgICAgICA/IGAke2l0ZW0uc25pcHBldC5zdWJzdHJpbmcoMCwgMjUwKX3igKZgXG4gICAgICAgICAgICA6IGl0ZW0uc25pcHBldCkpLCBzaG93SXRlbVR5cGUgJiYgaChcImFyY2dpcy1pdGVtLXR5cGVcIiwgeyBzY2FsZTogXCJzXCIsIGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2FyZF9fZGV0YWlsc1wiIH0sIHNob3dEYXRlVXBkYXRlZCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiY2FyZF9fZGV0YWlsXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJjYXJkX19kaXZpZGVyXCI6IHRydWVcbiAgICAgICAgICAgIH0gfSwgdGhpcy51cGRhdGVkVGV4dCkpLCBzaG93QmFkZ2VzICYmIChoKFwiYXJjZ2lzLWl0ZW0tYmFkZ2VzXCIsIHsgaXRlbTogaXRlbSwgdXNlcjogdXNlciwgcG9ydGFsOiBwb3J0YWwsIHdpZHRoOiBcIm5hcnJvd1wiLCBzaG93VG9vbHRpcHM6IHRydWUsIGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJjYXJkX19iYWRnZXNcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImNhcmRfX2RpdmlkZXJcIjogdHJ1ZVxuICAgICAgICAgICAgfSwgc2NhbGU6IFwic1wiIH0pKSkpLCBzaG93VGh1bWJuYWlsICYmIChoKFwiZmlndXJlXCIsIHsgY2xhc3M6IFwiY2FyZF9fdGh1bWJuYWlsXCIgfSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC10aHVtYm5haWxcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCB9KSkpKSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmRfX2Zvb3RlclwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9LCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiIHx8IGUua2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcImNhcmRfX2Zvb3Rlcl9fc3RhcnRcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImNhcmRfX2Zvb3Rlcl9fc3RhcnQtLW93bmVyXCI6IHNob3dPd25lclxuICAgICAgICAgICAgfSB9LCBzaG93T3duZXIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJjYXJkX19wcm9maWxlLXdyYXBcIiwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0gfSwgc2hvd093bmVyUG9wdXAgPyAoaChcImFyY2dpcy11c2VyLXBvcHVwXCIsIHsgdW5kZXJsaW5lOiB0cnVlLCB1c2VybmFtZTogaXRlbS5vd25lciwgYXBpOiBhcGksIHBvcnRhbDogcG9ydGFsLCBiYXNlVXJsOiBiYXNlVXJsLCBzaG93QXZhdGFyOiBmYWxzZSwgY2xhc3M6IFwiY2FyZF9fb3duZXJcIiwgc2NhbGU6IFwic1wiLCBvbkFyY2dpc1VzZXJQb3B1cEludGVybmFsVUlBY3Rpb246IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9IH0pKSA6IChoKFwiYXJjZ2lzLXVzZXItYXZhdGFyXCIsIHsgc2xvdDogXCJmb290ZXItc3RhcnRcIiwgc2NhbGU6IFwic1wiLCBzaG93TmFtZTogdHJ1ZSwgc2hvd0F2YXRhcjogZmFsc2UsIHVzZXJuYW1lOiBpdGVtLm93bmVyLCBwb3J0YWw6IHBvcnRhbCB9KSkpKSksIGgoXCJzbG90XCIsIHsgbmFtZTogXCJhY3Rpb25zLWVuZFwiIH0pKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0dyb3VwQnJvd3NlclByZXZpZXdDYXJkLnN0eWxlID0gYXJjZ2lzR3JvdXBCcm93c2VyUHJldmlld0NhcmRDc3M7XG5cbmNvbnN0IGFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaENzcyA9IFwiOmhvc3R7cG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTpibG9ja30uc2VhcmNoe3BvaW50ZXItZXZlbnRzOm5vbmU7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDoxMDttYXJnaW4tdG9wOjFyZW07Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtpbnNldC1pbmxpbmUtc3RhcnQ6MS41cmVtfS54e3Bvc2l0aW9uOmFic29sdXRlO3RvcDowcHg7ei1pbmRleDoxMDttYXJnaW4tdG9wOjAuMjVyZW07Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyLXN0eWxlOm5vbmU7cGFkZGluZzowLjVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO291dGxpbmU6MnB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0OjJweDtpbnNldC1pbmxpbmUtZW5kOjAuMjVyZW07YmFja2dyb3VuZDp0cmFuc3BhcmVudH0uaW5wdXR7cG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDowO2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO2hlaWdodDozcmVtO3dpZHRoOjEwMCU7Ym9yZGVyLXN0eWxlOm5vbmU7cGFkZGluZy10b3A6MXJlbTtwYWRkaW5nLWJvdHRvbToxcmVtO3BhZGRpbmctbGVmdDozcmVtO3BhZGRpbmctcmlnaHQ6M3JlbTtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpOy0tdHctc2hhZG93OjAgMCAjMDAwMDstLXR3LXNoYWRvdy1jb2xvcmVkOjAgMCAjMDAwMDtib3gtc2hhZG93OnZhcigtLXR3LXJpbmctb2Zmc2V0LXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctcmluZy1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXNoYWRvdyk7dHJhbnNpdGlvbi1wcm9wZXJ0eTpjb2xvciwgYmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCB0ZXh0LWRlY29yYXRpb24tY29sb3IsIGZpbGwsIHN0cm9rZSwgb3BhY2l0eSwgYm94LXNoYWRvdywgdHJhbnNmb3JtLCBmaWx0ZXIsIC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyO3RyYW5zaXRpb24tcHJvcGVydHk6Y29sb3IsIGJhY2tncm91bmQtY29sb3IsIGJvcmRlci1jb2xvciwgdGV4dC1kZWNvcmF0aW9uLWNvbG9yLCBmaWxsLCBzdHJva2UsIG9wYWNpdHksIGJveC1zaGFkb3csIHRyYW5zZm9ybSwgZmlsdGVyLCBiYWNrZHJvcC1maWx0ZXI7dHJhbnNpdGlvbi1wcm9wZXJ0eTpjb2xvciwgYmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCB0ZXh0LWRlY29yYXRpb24tY29sb3IsIGZpbGwsIHN0cm9rZSwgb3BhY2l0eSwgYm94LXNoYWRvdywgdHJhbnNmb3JtLCBmaWx0ZXIsIGJhY2tkcm9wLWZpbHRlciwgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI7dHJhbnNpdGlvbi1kdXJhdGlvbjoxNTBtcztiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlci1ib3R0b206MnB4IHNvbGlkIHRyYW5zcGFyZW50O2ZvbnQtZmFtaWx5OmluaGVyaXR9LmlucHV0Ojotd2Via2l0LXNlYXJjaC1jYW5jZWwtYnV0dG9ue2Rpc3BsYXk6bm9uZX0uaW5wdXQ6Oi1tcy1jbGVhcntkaXNwbGF5Om5vbmV9LmlucHV0OmZvY3Vzey0tdHctc2hhZG93OjAgMCAjMDAwMDstLXR3LXNoYWRvdy1jb2xvcmVkOjAgMCAjMDAwMDtib3gtc2hhZG93OnZhcigtLXR3LXJpbmctb2Zmc2V0LXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctcmluZy1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXNoYWRvdyk7b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2JvcmRlci1ib3R0b20tY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9XCI7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU2VhcmNoID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNHcm91cEJyb3dzZXJTZWFyY2hcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU2VhcmNoSW5wdXQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaElucHV0XCIsIDcpO1xuICAgICAgICB0aGlzLnRlcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0NsZWFyID0gZmFsc2U7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5zZWFyY2g7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB0ZXJtLCBwbGFjZWhvbGRlciB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci1zZWFyY2hcIiwgeyB0ZXJtOiB0ZXJtLCBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIgfHwgdGhpcy5pMThuLmxhYmVsLCBvbkFyY2dpc0Jyb3dzZXJTZWFyY2g6IChlKSA9PiB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaC5lbWl0KGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU2VhcmNoSW5wdXQ6IChlKSA9PiB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaElucHV0LmVtaXQoZS5kZXRhaWwpIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNHcm91cEJyb3dzZXJTZWFyY2guc3R5bGUgPSBhcmNnaXNHcm91cEJyb3dzZXJTZWFyY2hDc3M7XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclNvcnQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0dyb3VwQnJvd3NlclNvcnQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0dyb3VwQnJvd3NlclNvcnRcIiwgNyk7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gW1widGl0bGVcIiwgXCJyZWxldmFuY2VcIiwgXCJtb2RpZmllZFwiXTtcbiAgICAgICAgdGhpcy5maWVsZCA9ICgoX2EgPSB0aGlzLm9wdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgfHwgXCJyZWxldmFuY2VcIjtcbiAgICAgICAgdGhpcy5vcmRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hY3RpdmVPcmRlciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRHcm91cEJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IHRoaXMuZmllbGQ7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU29ydC5lbWl0KHtcbiAgICAgICAgICAgIHNvcnRGaWVsZDogdGhpcy5maWVsZCxcbiAgICAgICAgICAgIHNvcnRPcmRlcjogdGhpcy5vcmRlciB8fCBnZXREZWZhdWx0U29ydE9yZGVyKHRoaXMuZmllbGQpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVTb3J0RmllbGQoZmllbGQpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IGZpZWxkO1xuICAgICAgICB0aGlzLmFjdGl2ZU9yZGVyID0gZ2V0RGVmYXVsdFNvcnRPcmRlcihmaWVsZCk7XG4gICAgICAgIHRoaXMuYXJjZ2lzR3JvdXBCcm93c2VyU29ydC5lbWl0KHtcbiAgICAgICAgICAgIHNvcnRGaWVsZDogdGhpcy5hY3RpdmVGaWVsZCxcbiAgICAgICAgICAgIHNvcnRPcmRlcjogdGhpcy5hY3RpdmVPcmRlclxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdXBkYXRlU29ydE9yZGVyKG9yZGVyKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBvcmRlcjtcbiAgICAgICAgdGhpcy5hcmNnaXNHcm91cEJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgc29ydEZpZWxkOiB0aGlzLmFjdGl2ZUZpZWxkLFxuICAgICAgICAgICAgc29ydE9yZGVyOiB0aGlzLmFjdGl2ZU9yZGVyXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgYWN0aXZlRmllbGQsIGFjdGl2ZU9yZGVyLCBmaWVsZCwgb3JkZXIsIG9wdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGQgPSBhY3RpdmVGaWVsZCB8fCAob3B0aW9ucy5pbmNsdWRlcyhmaWVsZCkgPyBmaWVsZCA6IG9wdGlvbnNbMF0pO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE9yZGVyID0gYWN0aXZlT3JkZXIgfHwgb3JkZXI7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItc29ydFwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBmaWVsZDogc2VsZWN0ZWRGaWVsZCwgb3JkZXI6IHNlbGVjdGVkT3JkZXIsIG9wdGlvbnM6IG9wdGlvbnMsIG9uQXJjZ2lzQnJvd3NlclNvcnRGaWVsZENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlU29ydEZpZWxkKGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU29ydE9yZGVyQ2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVTb3J0T3JkZXIoZS5kZXRhaWwpIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0dyb3VwQnJvd3NlclRvcEJhciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0R3JvdXBCcm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci10b3AtYmFyXCIsIHsgc3RvcmU6IHRoaXMuc3RvcmUgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC1zdGFydFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJjb250ZW50LXN0YXJ0XCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJzZWFyY2hcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwic2VhcmNoXCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50LWVuZFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJjb250ZW50LWVuZFwiIH0pKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuZXhwb3J0IHsgQXJjZ2lzR3JvdXBCcm93c2VyIGFzIGFyY2dpc19ncm91cF9icm93c2VyLCBBcmNnaXNHcm91cEJyb3dzZXJBY3Rpb25zIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2FjdGlvbnMsIEFyY2dpc0dyb3VwQnJvd3NlckNvbnRlbnQgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfY29udGVudCwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyRGF0ZSBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9maWx0ZXJfZGF0ZSwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyR3JvdXBzQnlVc2VyIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9ncm91cHNfYnlfdXNlciwgQXJjZ2lzR3JvdXBCcm93c2VyRmlsdGVyTWVtYmVyT3JnIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9tZW1iZXJfb3JnLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJNZW1iZXJzaGlwIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcl9tZW1iZXJzaGlwLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJPd25lciBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9maWx0ZXJfb3duZXIsIEFyY2dpc0dyb3VwQnJvd3NlckZpbHRlclNwZWNpYWxHcm91cHMgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfZmlsdGVyX3NwZWNpYWxfZ3JvdXBzLCBBcmNnaXNHcm91cEJyb3dzZXJGaWx0ZXJzIGFzIGFyY2dpc19ncm91cF9icm93c2VyX2ZpbHRlcnMsIEFyY2dpc0dyb3VwQnJvd3NlclBhZ2luYXRpb24gYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfcGFnaW5hdGlvbiwgQXJjZ2lzR3JvdXBCcm93c2VyUHJldmlldyBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9wcmV2aWV3LCBBcmNnaXNHcm91cEJyb3dzZXJQcmV2aWV3Q2FyZCBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9wcmV2aWV3X2NhcmQsIEFyY2dpc0dyb3VwQnJvd3NlclNlYXJjaCBhcyBhcmNnaXNfZ3JvdXBfYnJvd3Nlcl9zZWFyY2gsIEFyY2dpc0dyb3VwQnJvd3NlclNvcnQgYXMgYXJjZ2lzX2dyb3VwX2Jyb3dzZXJfc29ydCwgQXJjZ2lzR3JvdXBCcm93c2VyVG9wQmFyIGFzIGFyY2dpc19ncm91cF9icm93c2VyX3RvcF9iYXIgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWdyb3VwLWJyb3dzZXJfMTYuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmZ1bmN0aW9uIGlzRXNyaShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSBpdGVtLm93bmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImVzcmlcIikpO1xufVxuZnVuY3Rpb24gaXNQcmVtaXVtKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgQ3JlZGl0c1wiKSk7XG59XG5mdW5jdGlvbiBpc1N1YnNjcmliZXIoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gaXNFc3JpKGl0ZW0pICYmICEhKChfYSA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJSZXF1aXJlcyBTdWJzY3JpcHRpb25cIikpO1xufVxuZnVuY3Rpb24gaXNPd25lcihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGl0ZW0ub3duZXIgPT09IHVzZXIudXNlcm5hbWU7XG59XG4vKipcbiAqIENhbiB0aGUgdXNlciB1cGRhdGUgdGhlIGl0ZW1cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlSXRlbShpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB8fCBpdGVtLml0ZW1Db250cm9sID09PSBcInVwZGF0ZVwiO1xufVxuLyoqXG4gKiBJcyB0aGUgdXNlciBlaXRoZXIgYW4gb3duZXIgb3IgYWRtaW4gb2YgdGhlIGl0ZW1cbiAqL1xuZnVuY3Rpb24gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gaXNPd25lcihpdGVtLCB1c2VyKSB8fCBpc0l0ZW1BZG1pbihpdGVtLCB1c2VyKTtcbn1cbi8qKlxuICogRG9lcyB0aGUgdXNlciBoYXZlIGFkbWluIGNhcGFiaWxpdGllcyBvbiB0aGlzIGl0ZW1cbiAqL1xuZnVuY3Rpb24gaXNJdGVtQWRtaW4oaXRlbSwgdXNlcikge1xuICAgIHZhciBfYTtcbiAgICAvLyBpZiB0aGlzIGZsYWcgaXMgYWxyZWFkeSBzZXQgKHByb2JhYmx5IGhvbWUgYXBwKSwgdXNlIGl0XG4gICAgaWYgKGl0ZW0uaXNBZG1pbiAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiAhIWl0ZW0uaXNBZG1pbjtcbiAgICB9XG4gICAgY29uc3QgaXRlbU93bmVyID0gaXRlbS5vd25lcjtcbiAgICBjb25zdCBpdGVtQ29udHJvbEFkbWluID0gaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJhZG1pblwiO1xuICAgIGNvbnN0IGVzcmlVc2VycyA9IFtcImVzcmlfbGl2aW5nYXRsYXNcIiwgXCJlc3JpX2RlbW9ncmFwaGljc1wiLCBcImVzcmlfYm91bmRhcmllc1wiXTtcbiAgICBpZiAoKChfYSA9IGl0ZW0ucG9ydGFsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQb3J0YWwpICYmXG4gICAgICAgICFpc093bmVyKGl0ZW0sIHVzZXIpICYmXG4gICAgICAgIGl0ZW1Db250cm9sQWRtaW4gJiZcbiAgICAgICAgaXRlbU93bmVyLmluY2x1ZGVzKFwiZXNyaV9cIikgJiZcbiAgICAgICAgLy8gcG9ydGFsIGluY29ycmVjdGx5IHJldHVybnMgXCJpdGVtQ29udHJvbD1cImFkbWluXCIgZm9yIGVzcmkgb3duZWQgaXRlbXNcbiAgICAgICAgIWVzcmlVc2Vycy5pbmNsdWRlcyhpdGVtT3duZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1Db250cm9sQWRtaW47XG59XG5jb25zdCBpdGVtc0JlbG9uZ1RvVXNlck9yZyA9IChpdGVtcywgdXNlcikgPT4ge1xuICAgIHJldHVybiAhIXVzZXIub3JnSWQgJiYgaXRlbXMuZXZlcnkoKGl0ZW0pID0+IGl0ZW0uaXNPcmdJdGVtKTtcbn07XG5jb25zdCBnZXRJdGVtSG9tZUFwcFVybCA9IChpdGVtSWQsIGJhc2VVcmwpID0+IGAke2FkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcoYmFzZVVybCl9aXRlbS5odG1sP2lkPSR7aXRlbUlkfWA7XG5cbmV4cG9ydCB7IGlzU3Vic2NyaWJlciBhcyBhLCBpc1ByZW1pdW0gYXMgYiwgY2FuVXBkYXRlSXRlbSBhcyBjLCBpdGVtc0JlbG9uZ1RvVXNlck9yZyBhcyBkLCBnZXRJdGVtSG9tZUFwcFVybCBhcyBnLCBpc093bmVyIGFzIGksIHVzZXJJc0l0ZW1BZG1pbiBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWl0ZW0tMzUzNTU1MmQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5mdW5jdGlvbiBnZXRQb3J0YWxCYXNlVXJsKHBvcnRhbCkge1xuICAgIGNvbnN0IHsgY3VzdG9tQmFzZVVybCwgcG9ydGFsSG9zdG5hbWUsIHVybEtleSB9ID0gcG9ydGFsO1xuICAgIGNvbnN0IHsgcHJvdG9jb2wgfSA9IHdpbmRvdy5sb2NhdGlvbjtcbiAgICBjb25zdCB1cmwgPSB1cmxLZXkgPyBgJHt1cmxLZXl9LiR7Y3VzdG9tQmFzZVVybH1gIDogcG9ydGFsSG9zdG5hbWU7XG4gICAgcmV0dXJuIGAke3Byb3RvY29sfS8vJHt1cmx9YDtcbn1cblxuZXhwb3J0IHsgZ2V0UG9ydGFsQmFzZVVybCBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBvcnRhbC02NjBiYjQzYS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHUgYXMgdXNlcklzSXRlbUFkbWluLCBjIGFzIGNhblVwZGF0ZUl0ZW0sIGQgYXMgaXRlbXNCZWxvbmdUb1VzZXJPcmcgfSBmcm9tICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuXG5jb25zdCBnZXRVc2VyUm9sZSA9ICh1c2VyKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIHR5cGVvZiAodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGUpID09PSBcInN0cmluZ1wiICYmICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlKVxuICAgICAgICA/IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlXG4gICAgICAgIDogKF9iID0gKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnJvbGVJZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLmlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoX2MgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlkO1xufTtcbmZ1bmN0aW9uIGlzUHVibGljVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIHVzZXIgJiYgIXVzZXIub3JnSWQ7XG59XG5mdW5jdGlvbiBpc0hvc3RlZFBvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gIXBvcnRhbC5pc1BvcnRhbCB8fCAhIXBvcnRhbC5pc0JhY2tlZEJ5U0RTO1xufVxuZnVuY3Rpb24gaXNEZXZlbG9wZXIoc3Vic2NyaXB0aW9uSW5mbykge1xuICAgIGNvbnN0IGRldlN1YnNjcmlwdGlvblR5cGVzID0gW1wiVHJpYWwgRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyXCIsIFwiRGV2ZWxvcGVyIFN1YnNjcmlwdGlvblwiXTtcbiAgICByZXR1cm4gZGV2U3Vic2NyaXB0aW9uVHlwZXMuaW5jbHVkZXMoc3Vic2NyaXB0aW9uSW5mbyA9PT0gbnVsbCB8fCBzdWJzY3JpcHRpb25JbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xufVxuZnVuY3Rpb24gaXNPcmdBZG1pbih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ19hZG1pblwiIHx8IGdldFVzZXJSb2xlKHVzZXIpID09PSBcImFjY291bnRfYWRtaW5cIjtcbn1cbmZ1bmN0aW9uIGlzT3JnVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIGdldFVzZXJSb2xlKHVzZXIpID09PSBcIm9yZ191c2VyXCIgfHwgZ2V0VXNlclJvbGUodXNlcikgPT09IFwiYWNjb3VudF91c2VyXCI7XG59XG5mdW5jdGlvbiBpc0N1c3RvbVJvbGUodXNlcikge1xuICAgIC8vIFRoZSBIb21lIEFwcCBjb2xsYXBzZSB0aGUgYHJvbGVJZGAgYW5kIGByb2xlYCBpbnRvIGEgc2luZ2xlIGBpZGAgcHJvcGVydHksIHRoYXQncyB3aHlcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvYmxvYi9tYXN0ZXIvc3JjL2pzL2FyY2dpc29ubGluZS9zaGFyaW5nL2Rpaml0L1JvbGUudHMjTDQ2OSB3b3Jrc1xuICAgIC8vIEluIHByYWN0aWNlLCB3ZSBvbmx5IG5lZWQgdG8gY2hlY2sgaWYgYHJvbGVJZGAgZXhpc3RcbiAgICAvLyAgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQ0NjgyI2lzc3VlY29tbWVudC00MTQ2ODY2XG4gICAgcmV0dXJuICEhKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlSWQpICYmIHVzZXIucm9sZUlkLmxlbmd0aCA+IDA7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBwcml2aWxlZ2UgXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbUNhdGVnb3J5U2NoZW1hXCIgaXMgZ3JhbnRlZC5cbiAqL1xuZnVuY3Rpb24gY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXModXNlcikge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtQ2F0ZWdvcnlTY2hlbWFcIikpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgcHJpdmlsZWdlIFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiIGlzIGdyYW50ZWQuXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0dyb3Vwcyh1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAhISgoX2EgPSB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUdyb3Vwc1wiKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gdXBkYXRlIG90aGVyIHVzZXIncyBpdGVtcyBpbiB0aGVpciBvcmdhbml6YXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3MgdG8gZW5zdXJlIHRoZSBwb3J0YWwgaXMgYW4gb3JnYW5pemF0aW9uIHBvcnRhbFxuICovXG5mdW5jdGlvbiBpc09yZ1BvcnRhbChwb3J0YWwpIHtcbiAgICByZXR1cm4gISEocG9ydGFsLnVybEtleSAmJiBwb3J0YWwuY3VzdG9tQmFzZVVybCkgfHwgISFwb3J0YWwuaXNQb3J0YWw7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGFsbG93ZWQgdG8gc2hhcmUgdGhlaXIgaXRlbSB0byBncm91cHNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9Hcm91cCh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9Hcm91cFwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIGFuIGl0ZW0gb24gYSBnaXZlbiBwb3J0YWxcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmUodXNlciwgcG9ydGFsKSB7XG4gICAgcmV0dXJuICghaXNPcmdQb3J0YWwocG9ydGFsKSB8fFxuICAgICAgICBjYW5TaGFyZUl0ZW1Ub0dyb3VwKHVzZXIpIHx8XG4gICAgICAgIGNhblNoYXJlSXRlbVRvT3JnKHVzZXIpIHx8XG4gICAgICAgICghIXBvcnRhbC5jYW5TaGFyZVB1YmxpYyAmJiBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyh1c2VyKSkpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gb3QgdGhlIG9yZ2FuaXphdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVJdGVtVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvT3JnXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gdG8gcHVibGljXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvUHVibGljKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb09yZ1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb1B1YmxpY1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBhZG1pbkNhblNoYXJlT3RoZXJzSXRlbVRvR3JvdXAodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46c2hhcmVUb0dyb3VwXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBpbiBhbiBhbGxvd2VkIG9yZ2FuaXphdGlvbiBhbmQgaGFzIHRoZSBwb3dlciB0byBtYW5hZ2UgY29sbGFib3JhdGlvbnNcbiAqL1xuZnVuY3Rpb24gY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMoY29uZmlnLCB1c2VyLCBwb3J0YWwsIHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICBjb25zdCBleGNsdWRlZE9yZ1R5cGVzID0gW1wiVHJpYWxcIiwgXCJUcmlhbCBQcmVzc1wiLCBcIlRyaWFsIERldmVsb3BlclwiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIiwgXCJFdmFsdWF0aW9uXCJdO1xuICAgIGNvbnN0IGlzVmFsaWRPcmdUeXBlID0gc3Vic2NyaXB0aW9uSW5mbyAmJiAhZXhjbHVkZWRPcmdUeXBlcy5pbmNsdWRlcyhzdWJzY3JpcHRpb25JbmZvLnR5cGUpO1xuICAgIGNvbnN0IGhhc1ByaXZpbGVnZSA9ICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjptYW5hZ2VDb2xsYWJvcmF0aW9uc1wiKTtcbiAgICByZXR1cm4gISEoKGNvbmZpZyA9PT0gbnVsbCB8fCBjb25maWcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZy5jb2xsYWJvcmF0aW9uc0VuYWJsZWQpICYmXG4gICAgICAgIHVzZXIgJiZcbiAgICAgICAgKGlzT3JnQWRtaW4odXNlcikgfHwgaGFzUHJpdmlsZWdlKSAmJlxuICAgICAgICAoKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgfHwgaXNWYWxpZE9yZ1R5cGUpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHZpZXcgb3RoZXIgb3JnYW5pemF0aW9uIHVzZXJzJyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5WaWV3T3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dmlld0l0ZW1zXCIpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBjYW4gdmlldyBvdGhlciBvcmdhbml6YXRpb24gdXNlcnMnIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGNhblZpZXdPdGhlcnNPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICEhdXNlciAmJiAoIWlzQ3VzdG9tUm9sZSh1c2VyKSB8fCAoaXNDdXN0b21Sb2xlKHVzZXIpICYmIGNhblZpZXdPcmdJdGVtcyh1c2VyKSkpO1xufVxuLy8gVE9ETzogYWRkIHVuaXQgdGVzdHNcbmNvbnN0IGhhc0FkbWluU2hhcmVQcml2aWxlZ2UgPSAoeyBpdGVtcywgdXNlciwgcG9ydGFsIH0pID0+IHtcbiAgICBjb25zdCBpdGVtID0gaXRlbXNbMF07XG4gICAgLy8gZW50ZXJwcmlzZSBpbmNvcnJlY3RseSByZXR1cm5zIGl0ZW1zIG93bmVkIGJ5IFwiZXNyaV9cIiBhcyBpdGVtIGNvbnRyb2wgYWRtaW4gKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzODY5NSlcbiAgICBjb25zdCBvd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3Qgd2hpdGVsaXN0T3duZXIgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCJdO1xuICAgIGlmIChwb3J0YWwuaXNQb3J0YWwgJiYgb3duZXIgIT09IHVzZXIudXNlcm5hbWUgJiYgb3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJiAhd2hpdGVsaXN0T3duZXIuaW5jbHVkZXMob3duZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgaXNPd25lck9yQWRtaW4gPSB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG4gICAgY29uc3QgaXNDdXN0b20gPSBpc0N1c3RvbVJvbGUodXNlcik7XG4gICAgY29uc3QgY2FuU2hhcmVPcmdJdGVtcyA9IGNhblNoYXJlT3RoZXJzSXRlbXModXNlcik7XG4gICAgY29uc3QgY2FuVXBkYXRlQW5kU2hhcmUgPSBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpICYmXG4gICAgICAgIGNhblVwZGF0ZU9yZ0l0ZW1zKHVzZXIpICYmXG4gICAgICAgICFpc0N1c3RvbSAmJlxuICAgICAgICAoY2FuU2hhcmUodXNlciwgcG9ydGFsKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpKTtcbiAgICAvLyBpZiBpdCdzIHRoZSBpdGVtIG93bmVyIG9yIGFkbWluLCBvciBjdXN0b20gYWRtaW4gd2hvIGNhbiBzaGFyZVxuICAgIHJldHVybiBpc093bmVyT3JBZG1pbiB8fCBjYW5VcGRhdGVBbmRTaGFyZSB8fCAoaXRlbXNCZWxvbmdUb1VzZXJPcmcoaXRlbXMsIHVzZXIpICYmIGNhblNoYXJlT3JnSXRlbXMpO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHNoYXJlIG90aGVyIHVzZXIncyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwKHVzZXIpIHx8IGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyh1c2VyKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWModXNlcik7XG59XG5cbmV4cG9ydCB7IGlzUHVibGljVXNlciBhcyBhLCBpc09yZ0FkbWluIGFzIGIsIGlzSG9zdGVkUG9ydGFsIGFzIGMsIGlzQ3VzdG9tUm9sZSBhcyBkLCBjYW5VcGRhdGVPcmdHcm91cHMgYXMgZSwgY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXMgYXMgZiwgY2FuTWFuYWdlQ29sbGFib3JhdGlvbnMgYXMgZywgaXNPcmdVc2VyIGFzIGgsIGlzRGV2ZWxvcGVyIGFzIGksIGNhblNoYXJlSXRlbVRvR3JvdXAgYXMgaiwgY2FuU2hhcmVJdGVtVG9PcmcgYXMgaywgYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwIGFzIGwsIGNhblNoYXJlT3RoZXJzSXRlbXNUb09yZyBhcyBtLCBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyBhcyBuLCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9QdWJsaWMgYXMgbywgaGFzQWRtaW5TaGFyZVByaXZpbGVnZSBhcyBwLCBjYW5WaWV3T3RoZXJzT3JnSXRlbXMgYXMgcSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcml2aWxlZ2VzLTVjMzgyZjYxLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuY29uc3QgSElEREVOX0lURU1TX1FVRVJZID0gYC10eXBlOlwiQ29kZSBBdHRhY2htZW50XCIgLXR5cGU6XCJGZWF0dXJlZCBJdGVtc1wiIC10eXBlOlwiU3ltYm9sIFNldFwiIC10eXBlOlwiQ29sb3IgU2V0XCIgLXR5cGU6XCJXaW5kb3dzIFZpZXdlciBBZGQgSW5cIiAtdHlwZTpcIldpbmRvd3MgVmlld2VyIENvbmZpZ3VyYXRpb25cIiAtdHlwZTpcIk1hcCBBcmVhXCIgLXR5cGVrZXl3b3JkczpcIk1hcEFyZWFQYWNrYWdlXCIgLXR5cGU6XCJJbmRvb3JzIE1hcCBDb25maWd1cmF0aW9uXCIgLXR5cGVrZXl3b3JkczpcIlNNWFwiYDtcblxuZXhwb3J0IHsgSElEREVOX0lURU1TX1FVRVJZIGFzIEggfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cXVlcnktZDYyNjYwZDQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFN0b3JlIH0gZnJvbSAnLi9zdG9yZS04YjFiMDg0Ni5qcyc7XG5cbmZ1bmN0aW9uIGdldEdyb3VwQnJvd3NlclN0b3JlKGVsKSB7XG4gICAgcmV0dXJuIGdldFN0b3JlKGVsLCBcImFyY2dpcy1ncm91cC1icm93c2VyXCIpO1xufVxuY29uc3QgR3JvdXBCcm93c2VyU3RvcmUgPSBjcmVhdGVTdG9yZSh7IGZpbHRlcnM6IHt9IH0pO1xuY29uc3QgZ3JvdXBCcm93c2VyU3RhdGUgPSBHcm91cEJyb3dzZXJTdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgZ3JvdXBCcm93c2VyU3RhdGUgYXMgYSwgZ2V0R3JvdXBCcm93c2VyU3RvcmUgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9yZS1kYTNmY2NkNS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHMgYXMgc2FuaXRpemVIVE1MIH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5mdW5jdGlvbiBjbGVhblNlYXJjaFRlcm0odGVybSA9IFwiXCIpIHtcbiAgICAvLyBzYW5pdGl6ZSBpbnB1dCBpZiBpdCBjb250YWlucyBodG1sXG4gICAgY29uc3Qgc2FuaXRpemVkU2VhcmNoVGVybSA9IHNhbml0aXplSFRNTCh0ZXJtKTtcbiAgICAvLyBlc2NhcGUgcXVlc3Rpb24gbWFya3MsIGFuZ2xlIGJyYWNrZXRzLCBzcXVhcmUgYnJhY2tldHMsIGV0Y1xuICAgIGNvbnN0IGVzY2FwZWRUZXJtID0gc2FuaXRpemVkU2VhcmNoVGVybS5yZXBsYWNlKC9bPD5cXC9cXFxcW1xcXVxcP10vZywgXCJcXFxcJCZcIik7XG4gICAgcmV0dXJuIGVzY2FwZWRUZXJtLnRyaW0oKTtcbn1cblxuZXhwb3J0IHsgY2xlYW5TZWFyY2hUZXJtIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RyaW5nLTU4YTVmZWYzLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==