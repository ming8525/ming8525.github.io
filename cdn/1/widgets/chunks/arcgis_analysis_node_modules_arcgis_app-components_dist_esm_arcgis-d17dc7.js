"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d17dc7"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-47103724.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-47103724.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ initializeDatastoreState),
/* harmony export */   i: () => (/* binding */ initializeWithExistingItem)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _tile_layer_8a7b93de_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./tile-layer-8a7b93de.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-8a7b93de.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */










const initializeWithExistingItem = async (item, options) => {
    var _a;
    const { existingItemType, portal, existingItemPublishType } = options;
    _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder =
        (_a = (await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_1__.a)(item.folderId || item.ownerFolder, item.itemOwner))) !== null && _a !== void 0 ? _a : (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_1__.b)(item.itemOwner);
    let type = item.type;
    // After publish, somehow the new item will have GeoJSON instead of GeoJson
    if (type === "GeoJSON") {
        type = "GeoJson";
    }
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.title = item.title;
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.categories = item.categories;
    const curTag = item.tags;
    if (Array.isArray(curTag)) {
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.tags = curTag || [];
    }
    else {
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_3__.i.tags = (curTag !== null && curTag !== void 0 ? curTag : "").split(",");
    }
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.id = item.id;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.type = type;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.fileName = item.name;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.existingItem = item;
    // TODO: determine if this is true
    // Enable publishing causes this bug https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/40133
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.enablePublishing = existingItemType !== "tileLayer";
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.newItemMode = existingItemType;
    switch (existingItemType) {
        case "file":
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.extension = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_5__.a[type].fileExt[0];
            break;
        case "tileLayer":
            const { id, url, title } = item;
            const [{ layers, tables, serviceInfo }] = await Promise.all([
                (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.q)(url, (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal), true)
            ]);
            const { result: updatedItemData } = await (0,_tile_layer_8a7b93de_js__WEBPACK_IMPORTED_MODULE_8__.f)({
                itemId: id,
                itemUrl: url,
                publishType: existingItemPublishType === "vectorTiles" ? "vector" : "raster",
                portal,
                fullLayers: layers
            });
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceTitle = title;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerPublishType = existingItemPublishType;
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerPublishType === "3dTiles") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tilesLayer3dTilesLayerType = _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_6__.D;
                break;
            }
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerData = updatedItemData;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileAutoCreation = true;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerBasemapType = "standard";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerBasemapUrl = "";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerFromFeatureLayer = true;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerLayers = layers;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerTables = tables;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.tileLayerServiceInfo = serviceInfo;
            break;
    }
};
const initializeDatastoreState = (options) => {
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.newItemMode = "dataStore";
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.type = "Data Store";
    if (!(options === null || options === void 0 ? void 0 : options.portal.isPortal)) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.typeKeywords = ["Data Store connection"];
    }
};



//# sourceMappingURL=arcgis-new-item-47103724.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item_19.entry.js":
/*!*********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item_19.entry.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item: () => (/* binding */ ArcgisNewItem),
/* harmony export */   arcgis_new_item_create_layers_list: () => (/* binding */ ArcgisNewItemCreateLayersList),
/* harmony export */   arcgis_new_item_csv_field: () => (/* binding */ ArcgisNewItemCsvField),
/* harmony export */   arcgis_new_item_custom_parameter: () => (/* binding */ ArcgisNewItemCustomParameter),
/* harmony export */   arcgis_new_item_custom_parameters: () => (/* binding */ ArcgisNewItemCustomParameters),
/* harmony export */   arcgis_new_item_input_readonly: () => (/* binding */ ArcgisNewItemInputReadonly),
/* harmony export */   arcgis_new_item_layer_search: () => (/* binding */ ArcgisNewItemLayerSearch),
/* harmony export */   arcgis_new_item_pages_application: () => (/* binding */ ArcgisNewItemPagesApplication),
/* harmony export */   arcgis_new_item_pages_auth: () => (/* binding */ ArcgisNewItemPagesAuth),
/* harmony export */   arcgis_new_item_pages_bulk_layer_select: () => (/* binding */ ArcgisNewItemPagesBulkLayerSelect),
/* harmony export */   arcgis_new_item_pages_cloud: () => (/* binding */ ArcgisNewItemPagesCloud),
/* harmony export */   arcgis_new_item_pages_file_fields: () => (/* binding */ ArcgisNewItemPagesFileFields),
/* harmony export */   arcgis_new_item_pages_item_properties: () => (/* binding */ ArcgisNewItemPagesItemProperties),
/* harmony export */   arcgis_new_item_pages_publish_select: () => (/* binding */ ArcgisNewItemPagesPublishSelect),
/* harmony export */   arcgis_new_item_pages_single_layer_select: () => (/* binding */ ArcgisNewItemPagesSingleLayerSelect),
/* harmony export */   arcgis_new_item_pages_url_type: () => (/* binding */ ArcgisNewItemPagesUrlType),
/* harmony export */   arcgis_new_item_pages_zip_select: () => (/* binding */ ArcgisNewItemPagesZipSelect),
/* harmony export */   arcgis_new_item_timezone_dropdown: () => (/* binding */ ArcgisNewItemTimezoneDropdown),
/* harmony export */   arcgis_new_item_url: () => (/* binding */ ArcgisNewItemUrl)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./arcgis-new-item-47103724.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-47103724.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _utils_9b3ffcf7_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./utils-9b3ffcf7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./item-types-586f0301.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _tile_layer_f0f9ef4b_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./tile-layer-f0f9ef4b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-f0f9ef4b.js");
/* harmony import */ var _subscription_22caae1a_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./subscription-22caae1a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-22caae1a.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./index-0a84b068.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-0a84b068.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _data_store_e2ae6a67_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./data-store-e2ae6a67.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-e2ae6a67.js");
/* harmony import */ var _image_collection_5b662b80_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./image-collection-5b662b80.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js");
/* harmony import */ var _publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./publish-item-17d2f9a3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/publish-item-17d2f9a3.js");
/* harmony import */ var _tile_layer_8a7b93de_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./tile-layer-8a7b93de.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-8a7b93de.js");
/* harmony import */ var _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./tile-layer-cf04fa97.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-cf04fa97.js");
/* harmony import */ var _i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./i18n-2998ec30.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-2998ec30.js");
/* harmony import */ var _feature_layer_58e18b03_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./feature-layer-58e18b03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-58e18b03.js");
/* harmony import */ var _analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./analyze-69ec08c8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _data_store_8e83fb7a_js__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./data-store-8e83fb7a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/data-store-8e83fb7a.js");
/* harmony import */ var _basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./basic-6db7ebd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */

























































// TODO: remove newItemMode === "url" once the business logic for feature collection is ready
const canSkipPublishSelectToNextPage = ({ directMode, newItemMode, itemType, cloud, isMultipageExcel, fromExistingItem, canPublishItemType }) => {
    if (fromExistingItem && !isMultipageExcel) {
        return true;
    }
    if (directMode) {
        // #2728 for CSV --- #2731 for GeoJSON
        if ((cloud && !isMultipageExcel) ||
            ((!isMultipageExcel || newItemMode === "url") &&
                (!canPublishItemType || (itemType !== "GeoJson" && itemType !== "CSV")))) {
            return true;
        }
    }
    return false;
};

/** mapping of next page detail to element tag name */
const pages = {
    application: "arcgis-new-item-pages-application",
    auth: "arcgis-new-item-pages-auth",
    bulkLayerSelect: "arcgis-new-item-pages-bulk-layer-select",
    cloud: "arcgis-new-item-pages-cloud",
    csvLocationFields: "arcgis-new-item-pages-csv-location-fields",
    dataUpload: "arcgis-new-item-pages-data-upload",
    dataStoreBrowser: "arcgis-new-item-pages-data-store-browser",
    dataStoreList: "arcgis-new-item-pages-data-store-list",
    dataStoreSelect: "arcgis-new-item-pages-data-store-select",
    dataStoreSelectFolder: "arcgis-new-item-pages-data-store-select-folder",
    dataStoreSelectDatabase: "arcgis-new-item-pages-data-store-select-database",
    dataStoreSelectDatabaseType: "arcgis-new-item-pages-data-store-select-database-type",
    dataStoreSelectBdfs: "arcgis-new-item-pages-data-store-select-bdfs",
    dataStoreSelectBdfsCloud: "arcgis-new-item-pages-data-store-select-bdfs-cloud",
    dataStoreSelectBdfsFileshare: "arcgis-new-item-pages-data-store-select-bdfs-fileshare",
    dataStoreSelectBdfsHdfs: "arcgis-new-item-pages-data-store-select-bdfs-hdfs",
    dataStoreSelectBdfsHive: "arcgis-new-item-pages-data-store-select-bdfs-hive",
    dataStoreSelectCloud: "arcgis-new-item-pages-data-store-select-cloud",
    dataStoreSelectCloudCredentials: "arcgis-new-item-pages-data-store-select-cloud-credentials",
    dataStoreDatabaseCredentials: "arcgis-new-item-pages-data-store-database-credentials",
    dataStoreSelectNoSql: "arcgis-new-item-pages-data-store-select-nosql",
    dataStoreSelectNoSqlCredentials: "arcgis-new-item-pages-data-store-select-nosql-credentials",
    dataStoreSelectArangoCredentials: "arcgis-new-item-pages-data-store-select-arango-credentials",
    dataStoreSelectServerList: "arcgis-new-item-pages-data-store-select-server-list",
    developerCredentialsSelect: "arcgis-new-item-pages-developer-credentials-select",
    featureLayerFromExisting: "arcgis-new-item-pages-feature-layer-from-existing",
    featureLayerFromScratch: "arcgis-new-item-pages-feature-layer-from-scratch",
    featureLayerFromTemplate: "arcgis-new-item-pages-feature-layer-from-template",
    featureLayerFromURL: "arcgis-new-item-pages-feature-layer-from-url",
    featureLayerPreference: "arcgis-new-item-pages-feature-layer-preference",
    appendSelect: "arcgis-new-item-pages-append-select",
    appendUpload: "arcgis-new-item-pages-append-upload",
    appendSelectUpdate: "arcgis-new-item-pages-append-select-update",
    appendMatchFields: "arcgis-new-item-pages-append-match-fields",
    appendKeyPairSelect: "arcgis-new-item-pages-append-key-pair-select",
    appendSelectLayer: "arcgis-new-item-pages-append-select-layer",
    appendOverwrite: "arcgis-new-item-pages-append-overwrite",
    appendFinish: "arcgis-new-item-pages-append-job",
    featureLayerSelect: "arcgis-new-item-pages-feature-layer-select",
    featureLayerSummary: "arcgis-new-item-pages-feature-layer-summary",
    fileField: "arcgis-new-item-pages-file-fields",
    hybridImageSelect: "arcgis-new-item-pages-hybrid-image-select",
    itemProperties: "arcgis-new-item-pages-item-properties",
    layerUpload: "arcgis-new-item-pages-layer-upload",
    locatorSelect: "arcgis-new-item-pages-locator-select",
    publishSelect: "arcgis-new-item-pages-publish-select",
    sceneLayerSelect: "arcgis-new-item-pages-scene-layer-select",
    serverList: "arcgis-new-item-pages-server-list",
    serviceScope: "arcgis-new-item-pages-service-scope",
    singleLayerSelect: "arcgis-new-item-pages-single-layer-select",
    tileLayerFromExisting: "arcgis-new-item-pages-tile-layer-from-existing",
    tileLayerFromUrl: "arcgis-new-item-pages-tile-layer-from-url",
    tileLayerSelect: "arcgis-new-item-pages-tile-layer-select",
    tileLayerSettings: "arcgis-new-item-pages-tile-layer-settings",
    urlTypeSelect: "arcgis-new-item-pages-url-type",
    zipSelect: "arcgis-new-item-pages-zip-select",
    default: "arcgis-new-item-pages-home"
};

const handleInitWithFile = (file) => {
    const { title, fileName, extension } = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.s)(file);
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = file;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = extension;
    return extension;
};
const analyzeItemForNextStep = (extension) => {
    const possibleItemTypes = (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.f)(extension);
    const itemType = possibleItemTypes[0];
    const { type, nextStep } = itemType;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = type;
    return { nextStep, type };
};
const handleDeleteItem = async (itemId, fromExistingItem) => {
    try {
        itemId && !fromExistingItem && (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(itemId, { permanentDelete: true }));
    }
    catch (_a) {
        // if no existing item was found, assume it's not there, safe to proceed. (WebGIS/arcgis-portal-app#40040)
        return;
    }
};

const TELEMETRY_ID = "new item";
const TELEMETRY_PAGE_NAME = "my content";
function logAddNewItemStart() {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.startWorkflow("new item upload", {
        eventType: "workflow",
        category: "new item upload",
        details: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type,
        pageName: TELEMETRY_PAGE_NAME
    });
}
function logSuccessfulItemCreation() {
    const { type, applicationType, customParameters, selectedLayerIdTracker } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
    const telemetryDetails = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.telemetryDetails;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow("new item upload", {
        details: type,
        pageName: TELEMETRY_PAGE_NAME
    });
    // Set up telemetry payload based on the path the user took
    const payload = {
        eventType: "other",
        pageName: TELEMETRY_PAGE_NAME,
        category: TELEMETRY_ID,
        label: TELEMETRY_ID,
        details: telemetryDetails
    };
    if (telemetryDetails === "url") {
        payload.attribute = type;
        if ((customParameters === null || customParameters === void 0 ? void 0 : customParameters.length) > 0) {
            payload.action = "customParams";
        }
        if (type === "WMS") {
            payload.count = selectedLayerIdTracker === null || selectedLayerIdTracker === void 0 ? void 0 : selectedLayerIdTracker.count;
        }
    }
    else if (applicationType) {
        payload.attribute = applicationType;
    }
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
}
const logInitWithFile = () => {
    const { telemetry } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const payload = {
        eventType: "other",
        pageName: "my content",
        category: "content page drag drop",
        label: "content"
    };
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.telemetryDetails = "drag drop";
};
function logItemPropertiesChanges() {
    var _a, _b;
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
    const { title, folder, categories, tags, snippet } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i;
    const { initialTitle, initialFolders } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
    const homeFolder = !folder || folder.title === folder.id;
    const existingFolder = !!initialFolders.map((folder) => folder.id).find((id) => id === folder.id);
    // Log changes the user has made to default item properties
    const payload = {
        eventType: "other",
        pageName: TELEMETRY_PAGE_NAME,
        category: "new item item info",
        label: title === initialTitle ? "default title" : "title changed",
        action: (snippet === null || snippet === void 0 ? void 0 : snippet.length) > 0 ? "summary" : "no summary",
        count: (_a = tags === null || tags === void 0 ? void 0 : tags.length) !== null && _a !== void 0 ? _a : 0,
        number: (_b = categories === null || categories === void 0 ? void 0 : categories.length) !== null && _b !== void 0 ? _b : 0
    };
    // Check if the user added to a folder they created within item properties
    if (!existingFolder) {
        payload.details = "new folder";
    }
    else {
        payload.details = homeFolder ? "root folder" : "custom folder";
    }
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
}

const arcgisNewItemCss = ".stage{box-sizing:border-box;display:block;width:100%;padding-left:1px;padding-right:1px;padding-bottom:1.5rem;opacity:1;height:calc(100% - 2rem);transition:all 200ms ease-in-out}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.stage--fullscreen{height:100%;overflow:auto;padding-bottom:0px}.stage--disable-scroll{overflow:hidden;height:33vh}.stage-anim{transform:translate3d(0, 0, 0)}.stage-anim--leaving{position:absolute;width:calc(100% - 4rem)}.stage-anim--left{opacity:0;transform:translate3d(-24px, 0, 0)}.stage-anim--right{opacity:0;transform:translate3d(24px, 0, 0)}.header{display:flex;align-items:center;position:relative}.header>.icon{border-style:none;margin-left:0.5rem;margin-right:0.5rem;padding:0px;display:flex;background-color:transparent}@media screen and (max-width: 480px){.stage{padding-bottom:6rem}}.header__title{font-size:1.125rem;margin:0px;padding:0px;font-weight:500}.content{height:100%}.onboarding{--arcgis-information-min-width:0}.onboarding__scroll{overflow:auto;max-height:min(700px, 60vh)}.onboarding__section{padding-bottom:1rem;padding-top:0.5rem;width:255px}.onboarding__title{margin:0px;padding-top:0px;font-size:0.875rem;color:var(--calcite-color-text-1);font-weight:600}.onboarding__description{margin-top:0.5rem;margin-bottom:0.75rem;font-size:0.75rem;color:var(--calcite-color-text-1)}.modal{--calcite-modal-width:1080px;--calcite-modal-height:min(922px, 75vh)}.modal--grey{--calcite-modal-content-padding:0;--calcite-modal-content-background:var(--calcite-color-background)}";

const ANIMATION_DURATION = 200;
const ArcgisNewItem = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.showBackButton = false;
        this.workflowCompleted = false;
        this.closeDialog = () => {
            const { id, existingItem } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            const fromExistingItem = !!existingItem && _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow !== "append"; //don't want to delete HFL item before new file is uploaded.
            !this.workflowCompleted && this.handleCancel(id, fromExistingItem);
            this.workflowCompleted = false;
            (0,_utils_9b3ffcf7_js__WEBPACK_IMPORTED_MODULE_9__.r)();
            this.pageHistory = ["home"];
            // Reset to make sure if the modal is opened again, it will be in the default state
            //  and any nextText change will trigger the `onChange properly
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "next";
            // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/43280
            // maintain item id on setting page register cancel
            // R2 TODO: improve store cleanup/reinitialization
            if (this.workflow === "register") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = id;
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.existingItem = existingItem;
            }
        };
        this.handleCancel = async (itemId, fromExistingItem) => {
            let cancelPayload;
            const { overwritePayload } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            if (overwritePayload) {
                cancelPayload = overwritePayload;
            }
            else {
                await _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.s.unsubscribeAll();
                await handleDeleteItem(itemId, fromExistingItem);
            }
            this.workflowCancel.emit(cancelPayload);
            const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
            (telemetry === null || telemetry === void 0 ? void 0 : telemetry.getWorkflow("new item upload")) &&
                (telemetry === null || telemetry === void 0 ? void 0 : telemetry.cancelWorkflow("new item upload", {
                    details: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type
                }));
        };
        this.user = undefined;
        this.portal = undefined;
        this.api = undefined;
        this.config = undefined;
        this.telemetry = undefined;
        this.file = undefined;
        this.firstStep = undefined;
        this.initialFolder = undefined;
        this.isActive = true;
        this.layerId = undefined;
        this.layer = undefined;
        this.existingItem = undefined;
        this.existingItemType = undefined;
        this.existingItemPublishType = undefined;
        this.workflow = undefined;
        this.allowedItemTypes = undefined;
        this.allowedModes = [..._item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__.A];
        this.allowPublish = true;
        this.pageHistory = ["home"];
        this.initialPage = "default";
        this.navEnabled = true;
        this.transition = undefined;
        this.targetHeight = undefined;
        this.outerHeight = undefined;
        this.primaryButtonText = undefined;
        this.noPadding = undefined;
        this.isLoading = false;
        this.loadingText = undefined;
        this.disableCloseButton = false;
        this.headerIconRef = undefined;
    }
    disableNavButtons(event) {
        this.navEnabled = event.detail;
    }
    disableCloseButtons(event) {
        //disables "Cancel" and "x" buttons on modal
        if (this.isDisableClosePage(this.pageHistory[this.pageHistory.length - 1])) {
            this.disableCloseButton = event.detail;
        }
    }
    handleRedirect({ detail }) {
        const payload = {
            response: { success: true, id: null, folder: null },
            type: detail.type
        };
        if (detail.url) {
            payload.url = detail.url;
            payload.customParameters = detail.customParameters;
            payload.layers = detail.layers;
        }
        this.workflowComplete.emit(payload);
        this.isActive = false;
    }
    handleWorkflowComplete() {
        this.workflowCompleted = true;
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map") {
            this.isLoading = true;
            this.loadingText = this.i18n.creatingLayer;
        }
        else {
            this.isActive = false;
        }
    }
    async goToNextPage(event) {
        var _a, _b, _c;
        // Reset in case we forget to set it
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "next";
        this.transition = "forward";
        this.pageHistory = [...this.pageHistory, event.detail];
        this.targetHeight = null;
        this.outerHeight = this.contentSlot.offsetHeight;
        this.cleanPageHistory();
        const oldPage = this.currentScreen;
        const newPage = pages[event.detail];
        const oldPageHeight = this.el.querySelector(oldPage).clientHeight;
        const contentContainer = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot.querySelector(".content");
        if (contentContainer) {
            contentContainer.style.overflow = "hidden";
        }
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        const newPageHeight = (_b = this.el.querySelector(newPage)) === null || _b === void 0 ? void 0 : _b.clientHeight;
        if (newPageHeight) {
            this.targetHeight = oldPageHeight;
            this.outerHeight = null;
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
            this.targetHeight = newPageHeight;
        }
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        this.targetHeight = null;
        this.transition = null;
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        if (contentContainer) {
            contentContainer.style.overflowY = "auto";
        }
        const transitionCompleteEvent = new CustomEvent("arcgisTransitionComplete");
        (_c = this.currentPageEl) === null || _c === void 0 ? void 0 : _c.dispatchEvent(transitionCompleteEvent);
        this.focusFirstElement();
    }
    async goToPreviousPage() {
        var _a, _b, _c;
        // Reset in case we forget to
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "next";
        const { pageHistory } = this;
        this.transition = "back";
        this.targetHeight = null;
        this.outerHeight = this.contentSlot.offsetHeight;
        const oldPage = pages[pageHistory[pageHistory.length - 1]] || pages.default;
        const newPage = pages[pageHistory[pageHistory.length - 2]] || pages.default;
        const oldPageHeight = this.el.querySelector(oldPage).clientHeight;
        const contentContainer = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot.querySelector(".content");
        if (contentContainer) {
            contentContainer.style.overflow = "hidden";
        }
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        const newPageHeight = (_b = this.el.querySelector(newPage)) === null || _b === void 0 ? void 0 : _b.clientHeight;
        if (newPageHeight) {
            this.targetHeight = oldPageHeight;
            this.outerHeight = null;
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
            this.targetHeight = newPageHeight;
        }
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        this.targetHeight = null;
        this.transition = null;
        this.pageHistory =
            this.pageHistory.length === 1 ? this.pageHistory.slice(0, 1) : this.pageHistory.slice(0, -1);
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(ANIMATION_DURATION);
        if (contentContainer) {
            contentContainer.style.overflowY = "auto";
        }
        const transitionCompleteEvent = new CustomEvent("arcgisTransitionComplete");
        (_c = this.currentPageEl) === null || _c === void 0 ? void 0 : _c.dispatchEvent(transitionCompleteEvent);
        this.focusFirstElement();
    }
    updateActive(active) {
        if (active && this.firstStep) {
            this.initializeWithFirstStep();
        }
    }
    updateFirstStep() {
        this.initializeWithFirstStep();
    }
    initializeWithFile() {
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const { file } = this;
        if (file) {
            const extension = handleInitWithFile(file);
            if (extension === "zip") {
                this.pageHistory = ["home", "zipSelect"];
                return;
            }
            const { nextStep, type } = analyzeItemForNextStep(extension);
            this.postprocessAddFromFile(type);
            // there is no reason to show publishSelect screen for users that can't publish
            if ((!(0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, type, portal) || this.allowPublish === false) &&
                nextStep === "publishSelect") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing = false;
                this.pageHistory = ["home", "itemProperties"];
            }
            else {
                this.pageHistory = ["home", nextStep];
            }
            logInitWithFile();
        }
    }
    postprocessAddFromFile(type) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileLayerPublishType = type === "3DTiles Package" ? "3dTiles" : undefined;
    }
    updateInitialFolder(folder) {
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder = folder;
    }
    focusFirstElement() {
        var _a;
        const curPage = this.currentPageEl;
        if (curPage && !curPage.managedFocus) {
            (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.setFocus();
        }
    }
    removePageFromHistory(page) {
        const { pageHistory } = this;
        if (pageHistory.length > 1 && pageHistory.includes(page) && pageHistory.at(-1) !== page) {
            pageHistory.splice(pageHistory.indexOf(page), 1);
        }
    }
    cleanPageHistory() {
        const { newItemMode, type, excelLayers, existingItem, cloudProviderResource } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const prevPage = this.pageHistory[this.pageHistory.length - 2];
        const isMultipageExcel = type === "Microsoft Excel" && (excelLayers === null || excelLayers === void 0 ? void 0 : excelLayers.length) > 1;
        const directMode = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        if (canSkipPublishSelectToNextPage({
            directMode,
            isMultipageExcel,
            newItemMode,
            itemType: type,
            cloud: !!cloudProviderResource,
            // #38481: After a CSV/Json has been analyzed for publish, remove publishSelect from history
            // Excel files with multiple sheets should still have access
            fromExistingItem: !!existingItem,
            canPublishItemType: (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user, type, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal)
        }) &&
            prevPage === "publishSelect") {
            this.removePageFromHistory("publishSelect");
        }
    }
    async initializeWithExistingItem() {
        const item = this.existingItem;
        const existingItemType = this.existingItemType;
        this.isLoading = true;
        await (0,_arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__.i)(item, {
            existingItemType,
            portal: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal,
            existingItemPublishType: this.existingItemPublishType
        });
        this.isLoading = false;
        const type = item.type;
        if (this.workflow === "append") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.layerId = this === null || this === void 0 ? void 0 : this.layerId;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.sublayer = this === null || this === void 0 ? void 0 : this.layer;
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow = "append";
            this.initialPage = "appendSelect";
            this.pageHistory = [this.initialPage];
        }
        else if (this.workflow === "update") {
            this.pageHistory = ["dataUpload"];
        }
        else if (["CSV", "Microsoft Excel"].includes(type)) {
            this.pageHistory = ["publishSelect"];
        }
        else if (existingItemType === "tileLayer") {
            this.pageHistory = ["tileLayerSettings"];
        }
        else if (this.workflow === "register") {
            // TODO: rework this once Steven publish his dubstep diagram
            this.pageHistory = ["developerCredentialsSelect"];
        }
        else {
            this.pageHistory = ["itemProperties"];
        }
    }
    async initializeWithFirstStep() {
        const { firstStep } = this;
        if (!firstStep) {
            return;
        }
        switch (firstStep) {
            case "dataStoreSelectCloudCredentialsAmazonS3":
                (0,_arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__.a)({ portal: this.portal });
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addDataStoreType = "cloud";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.provider = "amazon";
                this.pageHistory = ["dataStoreSelectCloudCredentials"];
                break;
            case "dataStoreSelectCloudCredentialsAzureBlob":
                (0,_arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__.a)({ portal: this.portal });
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addDataStoreType = "cloud";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.provider = "azure";
                this.pageHistory = ["dataStoreSelectCloudCredentials"];
                break;
            case "dataStoreDatabaseCredentialsSnowflake":
                (0,_arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__.a)({ portal: this.portal });
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addDataStoreType = "database";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.databaseProvider = "snowflake";
                this.pageHistory = ["dataStoreDatabaseCredentials"];
                break;
            case "dataStoreDatabaseCredentialsBigQuery":
                (0,_arcgis_new_item_47103724_js__WEBPACK_IMPORTED_MODULE_5__.a)({ portal: this.portal });
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addDataStoreType = "database";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.databaseProvider = "bigQuery";
                this.pageHistory = ["dataStoreDatabaseCredentials"];
                break;
            default:
                this.pageHistory = [firstStep];
        }
    }
    triggerPageTransition(eventType) {
        var _a;
        const event = new CustomEvent(eventType, { cancelable: true });
        const eventNotCancelled = (_a = this.currentPageEl) === null || _a === void 0 ? void 0 : _a.dispatchEvent(event);
        if (eventNotCancelled && eventType === "arcgisNewItemPagePrev") {
            this.goToPreviousPage();
        }
    }
    /** Update the component in the modal's slot when a state change is detected */
    displayPage() {
        if (!this.isActive) {
            // No point of rendering elements on the screen if modal is not active
            return;
        }
        const { transition, pageHistory, initialPage } = this;
        const forward = transition === "forward";
        const back = transition === "back";
        const next = back ? pageHistory[pageHistory.length - 2] : pageHistory[pageHistory.length - 1];
        // TODO: strictly type this
        const NextScreen = `${pages[next] || pages[initialPage]}`;
        const CurrentScreen = this.currentScreen;
        if (CurrentScreen && pageHistory.length > 1 && transition) {
            return [
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(CurrentScreen, { class: {
                        stage: true,
                        "stage--fullscreen": this.isFullScreenPage(CurrentScreen),
                        "stage-anim": true,
                        "stage-anim--leaving": true,
                        "stage-anim--left": forward,
                        "stage-anim--right": back
                    } }),
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(NextScreen, { class: {
                        stage: true,
                        "stage--fullscreen": this.isFullScreenPage(NextScreen),
                        "stage-anim": true,
                        "stage-anim--left": back,
                        "stage-anim--right": forward
                    }, style: { height: `${this.targetHeight}px` }, ref: (el) => {
                        var _a;
                        this.currentPageEl = el;
                        (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.updateFocusTrapElements();
                    } })
            ];
        }
        else {
            this.currentScreen = NextScreen;
        }
        const style = this.targetHeight ? { height: `${this.targetHeight}px` } : {};
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(NextScreen, { class: {
                stage: true,
                "stage--fullscreen": this.isFullScreenPage(NextScreen)
            }, style: style, ref: (el) => {
                this.currentPageEl = el;
            } }));
    }
    disconnectedCallback() {
        this.closeDialog();
    }
    /** Initialize the itemPropertiesStore with data from props on load */
    async componentWillLoad() {
        var _a, _b, _c;
        const { file, portal, api, user, config, telemetry, existingItem, firstStep, workflow, initialFolder } = this;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.el);
        this.i18n = locale[0];
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n = locale[0];
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.lang = locale[1];
        this.primaryButtonText = this.i18n.next;
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow = workflow;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = portal;
        if (!!user) {
            const { error, result: _isPortalBackedBySDS } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.m)(portal, user), "isPortalBackedBySDS", portal.id);
            if (!error) {
                // @ts-ignore - we need to figure out a better way to do this so we're not modifying the user's portal
                _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isBackedBySDS = _isPortalBackedBySDS;
            }
        }
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = api;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config = config;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes = this.allowedItemTypes;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes = this.allowedModes;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish = this.allowPublish;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry = telemetry;
        // @ts-ignore - helpBase is definitely on 4.x Portal class.
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config.helpBase = (_a = config === null || config === void 0 ? void 0 : config.helpBase) !== null && _a !== void 0 ? _a : portal.helpBase;
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.initialFolder = initialFolder;
        if (!((_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _b === void 0 ? void 0 : _b.helpMap)) {
            const helpResponse = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.r)(`${config.restBaseUrl}/portals/helpmap?culture=${_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.lang}`);
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config.helpMap = helpResponse === null || helpResponse === void 0 ? void 0 : helpResponse.helpMap.m;
        }
        if (user) {
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user = user;
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.userLicensedItems =
                (_c = user.userLicensedItems) !== null && _c !== void 0 ? _c : (await (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.f)(portal));
        }
        if (file) {
            this.initializeWithFile();
        }
        if (existingItem) {
            this.initializeWithExistingItem();
        }
        if (firstStep) {
            this.initializeWithFirstStep();
        }
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.a.onChange("disableScroll", () => {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.disableScroll
                ? this.contentSlot.classList.add("stage--disable-scroll")
                : this.contentSlot.classList.remove("stage--disable-scroll");
        });
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.a.onChange("nextText", () => {
            const { i18n } = this;
            let nextText = i18n.next;
            switch (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText) {
                case "addToMap":
                    nextText = i18n.common.addToMap;
                    break;
                case "createAndAddToMap":
                    nextText = i18n.common.createAndAddToMap;
                    break;
                case "useAsBaseMap":
                    nextText = i18n.urlType.useAsBaseMap;
                    break;
                case "updateAppend":
                    nextText = i18n.common.updateAndComplete;
                    break;
                case "addAndComplete":
                    nextText = i18n.common.addAndComplete;
                    break;
                case "proceed":
                    nextText = i18n.common.proceed;
                    break;
                case "register":
                    nextText = i18n.common.register;
                    break;
                case "save":
                    nextText = i18n.save;
                    break;
                case "createConnection":
                    nextText = i18n.common.createConnection;
                    break;
                case "signInAndOverwrite":
                    nextText = i18n.common.signInAndOverwrite;
                    break;
                case "overwriteAndComplete":
                    nextText = i18n.common.overwriteAndComplete;
                    break;
            }
            this.primaryButtonText = nextText;
        });
    }
    componentWillRender() {
        this.showBackButton = this.pageHistory.length > 1;
    }
    componentDidLoad() {
        this.modalRef.setFocus();
    }
    componentDidRender() {
        var _a, _b;
        const shadowRoot = (_a = this.modalRef) === null || _a === void 0 ? void 0 : _a.shadowRoot;
        // Help the tooltip to be on top of the footer
        if (shadowRoot) {
            const modalHeader = shadowRoot.querySelector(".header");
            if (modalHeader) {
                modalHeader.style.zIndex = "3";
            }
            const modalFooter = shadowRoot.querySelector(".footer");
            const modalContent = shadowRoot.querySelector(".content");
            const modal = shadowRoot.querySelector(".modal");
            const hideFooter = this.currentScreen === pages.default;
            const isHome = this.currentScreen === pages[this.initialPage];
            if (modalFooter && modalContent) {
                modalFooter.style.position = "absolute";
                modalFooter.style.bottom = "0";
                modalFooter.style.visibility = hideFooter ? "hidden" : "visible";
                modal.style.position = "relative";
                if (isHome) {
                    modalContent.style.paddingBottom = "65px";
                    modal.style.paddingBottom = "0";
                }
                else {
                    modalContent.style.paddingBottom = "0";
                    modal.style.paddingBottom = "65px";
                }
            }
        }
        this.noPadding = this.isFullScreenPage(this.currentScreen);
        (_b = this.modalRef) === null || _b === void 0 ? void 0 : _b.updateFocusTrapElements();
    }
    isFullScreenPage(page) {
        return [
            "arcgis-new-item-pages-feature-layer-from-template",
            "arcgis-new-item-pages-feature-layer-from-existing",
            "arcgis-new-item-pages-tile-layer-from-store",
            "arcgis-new-item-pages-data-store-list",
            "arcgis-new-item-pages-data-store-browser",
            "arcgis-new-item-pages-tile-layer-from-existing",
            "arcgis-new-item-pages-append-select-layer"
        ].includes(page);
    }
    isDisableClosePage(page) {
        const pageToHideCloseButton = [
            "appendSelectUpdate",
            "csvLocationFields",
            "appendMatchFields"
        ];
        return pageToHideCloseButton.includes(page);
    }
    getHeaderTitle() {
        const { i18n, pageHistory } = this;
        const { newItemMode, existingItem } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map") {
            return i18n.addLayer;
        }
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "register" && existingItem) {
            return i18n.common.register;
        }
        if (newItemMode === "rasterFunctionTemplate") {
            return i18n.createRasterFunctionTemplate;
        }
        const curPage = (pageHistory[pageHistory.length - 1] || "").toLowerCase();
        switch (true) {
            case curPage.includes("featurelayer"):
                return i18n.createFeatureLayer;
            case curPage.includes("tilelayer"):
                return i18n.createTileLayer;
            case _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "update" && (existingItem === null || existingItem === void 0 ? void 0 : existingItem.type) === "Vector Tile Service":
                return i18n.update;
            case _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "append" || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "update":
                return i18n.appendSelect.updateData;
            case newItemMode === "sceneLayer":
                return i18n.createSceneLayer;
            case newItemMode === "tileLayer":
                return i18n.createTileLayer;
            case newItemMode === "dataStore":
                return i18n.addDataStore;
            default:
                return i18n.newItem;
        }
    }
    renderOnboardingSection({ title, content, background, path }) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "onboarding__section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "onboarding__title" }, title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "onboarding__description" }, content), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { width: "255", height: "64", viewBox: "0 0 255 64", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { width: "255", height: "64", fill: background, "fill-opacity": "0.1" }), path)));
    }
    renderOnboarding() {
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "append") {
            return null;
        }
        const { i18n } = this;
        const onboardingContent = [
            {
                title: i18n.onboard.addDocumentTitle,
                content: i18n.onboard.addDocumentContent,
                background: "#007ac2",
                show: true,
                path: ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M132.257 45.5566L146.318 31.4926L140 25.1736L141.368 21.5716L126.485 15.9196L122.666 12.0996H109.1V42.8996H113.611L116.756 44.0946L125.246 52.5646L129.054 48.7656L130.787 49.4246L132.043 46.1186H132.044L132.257 45.5566ZM145.187 31.4926L132.95 43.7296L139.686 25.9946L145.187 31.4926ZM122.9 13.4656L130.534 21.0996H122.9V13.4656ZM109.9 12.8996H122.334L122.434 12.9996H122.1V21.8996H131V21.5646L131.1 21.6656V42.0996H109.9V12.8996ZM125.246 51.4336L118.586 44.7896L128.233 48.4546L125.246 51.4336ZM130.324 48.3936L115.864 42.8996H131.9V21.3336L127.865 17.2976L140.335 22.0346L131.643 44.9216L130.324 48.3936Z", fill: "#3985B2" }))
            },
            {
                title: i18n.onboard.publishLayerTitle,
                content: this.portal.isPortal
                    ? i18n.onboard.publishLayerEnterprise
                    : i18n.onboard.publishLayerContent,
                show: (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.b)(this.user, this.portal),
                background: "#35AC46",
                path: ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M141.105 16.2537L140.876 16.1767C140.564 16.0727 133.164 13.6597 126.852 16.1857C120.814 18.5977 113.449 16.2007 113.376 16.1757L112.931 16.0287L107.808 47.2817L108.071 47.4137C110.922 48.6327 114.002 49.2205 117.101 49.1367C120.513 49.1139 123.898 48.5398 127.126 47.4367C138.069 43.7867 145.497 47.3767 145.571 47.4147L146.271 47.7627L141.105 16.2537ZM126.874 46.6767C117.087 49.9387 110.114 47.4137 108.694 46.8167L113.571 17.0727C115.303 17.5747 121.639 19.1327 127.148 16.9277C132.588 14.7537 139.104 16.4837 140.396 16.8657L145.236 46.3987C143.116 45.5657 136.336 43.5227 126.874 46.6767ZM137.68 18.4287C134.067 17.7098 130.328 17.9712 126.85 19.1857C125.996 19.5212 125.112 19.7751 124.21 19.9437L124.198 19.9467C121.662 20.3744 119.07 20.3616 116.538 19.9087L116.141 19.8427L112.111 44.4287L112.478 44.5117C114.342 44.9239 116.247 45.1288 118.156 45.1227C121.549 45.1021 124.915 44.5328 128.126 43.4367C131.17 42.4017 134.358 41.8503 137.573 41.8027H137.583C138.825 41.7881 140.066 41.8603 141.297 42.0187L141.832 42.0887L137.961 18.4767L137.68 18.4287ZM140.363 38.0717L137.891 40.5437C137.8 39.7207 137.658 38.9042 137.467 38.0987L139.959 35.6067L140.363 38.0717ZM139.799 34.6347L137.233 37.2007C137.023 36.4878 136.761 35.7916 136.448 35.1177L139.396 32.1687L139.799 34.6347ZM139.236 31.1977L136.061 34.3727C135.732 33.7679 135.335 33.2031 134.876 32.6897L138.832 28.7337L139.236 31.1977ZM138.672 27.7617L134.302 32.1317C133.848 31.7219 133.356 31.355 132.834 31.0357C132.858 30.9203 132.873 30.8033 132.88 30.6857L138.268 25.2967L138.672 27.7617ZM138.109 24.3247L132.747 29.6867C132.627 29.3574 132.437 29.0584 132.189 28.8106C131.941 28.5629 131.642 28.3724 131.313 28.2527L137.705 21.8607L138.109 24.3247ZM130.5 28.9007C130.817 28.9007 131.126 28.9945 131.389 29.1703C131.652 29.3461 131.857 29.596 131.978 29.8884C132.099 30.1807 132.131 30.5024 132.069 30.8128C132.008 31.1232 131.855 31.4083 131.631 31.632C131.408 31.8558 131.123 32.0082 130.812 32.0699C130.502 32.1317 130.18 32.1 129.888 31.9789C129.595 31.8578 129.346 31.6527 129.17 31.3896C128.994 31.1265 128.9 30.8171 128.9 30.5007C128.901 30.0765 129.069 29.6698 129.369 29.3699C129.669 29.0699 130.076 28.9012 130.5 28.9007ZM137.547 20.8877L130.316 28.1187C129.991 28.1436 129.675 28.2349 129.386 28.3869C129.098 28.539 128.844 28.7485 128.64 29.0027C128.195 28.7707 127.773 28.4971 127.38 28.1857L130.972 24.5947C131.336 24.8317 131.771 24.9365 132.203 24.8913C132.635 24.8461 133.039 24.6538 133.346 24.3465C133.653 24.0393 133.846 23.6357 133.891 23.2036C133.936 22.7714 133.831 22.3368 133.594 21.9727L136.502 19.0647C136.762 19.0987 137.022 19.1317 137.265 19.1707L137.547 20.8877ZM133.1 23.0007C133.1 23.2182 133.036 23.4309 132.915 23.6118C132.794 23.7927 132.622 23.9337 132.421 24.0169C132.22 24.1002 131.999 24.122 131.786 24.0795C131.572 24.0371 131.376 23.9323 131.222 23.7785C131.068 23.6246 130.964 23.4286 130.921 23.2153C130.879 23.0019 130.901 22.7807 130.984 22.5797C131.067 22.3787 131.208 22.2069 131.389 22.0861C131.57 21.9652 131.783 21.9007 132 21.9007C132.292 21.9009 132.571 22.0169 132.778 22.2231C132.984 22.4294 133.1 22.709 133.1 23.0007ZM135.481 18.9527L133.028 21.4067C132.664 21.1696 132.229 21.0649 131.797 21.11C131.365 21.1552 130.962 21.3476 130.654 21.6548C130.347 21.9621 130.155 22.3656 130.109 22.7978C130.064 23.2299 130.169 23.6645 130.406 24.0287L126.785 27.6507C126.533 27.3913 126.302 27.1113 126.096 26.8137C125.913 26.5372 125.757 26.2439 125.629 25.9377L132.706 18.8617C133.632 18.8364 134.559 18.8668 135.481 18.9527ZM127.893 19.6737C129.063 19.2898 130.273 19.0422 131.499 18.9357L125.323 25.1117C125.089 24.3363 124.924 23.5419 124.829 22.7377L127.893 19.6737ZM126.166 20.2687L124.726 21.7087C124.7 21.3618 124.684 21.0144 124.676 20.6667C125.193 20.5567 125.686 20.4207 126.166 20.2687ZM127.874 42.6767C123.113 44.3665 117.987 44.7579 113.024 43.8107L116.802 20.7607C119.145 21.1389 121.532 21.1571 123.88 20.8147C123.919 22.2727 124.157 25.4197 125.439 27.2687C126.163 28.2967 127.127 29.1318 128.248 29.7007C128.153 29.9568 128.103 30.2275 128.1 30.5007C128.099 31.0201 128.267 31.5258 128.579 31.9414C128.89 32.357 129.329 32.6601 129.827 32.8049C130.326 32.9497 130.859 32.9284 131.344 32.7442C131.83 32.56 132.243 32.2229 132.52 31.7837C133.084 32.1296 133.609 32.5368 134.084 32.9977C134.694 33.6027 136.674 35.9357 137.146 41.0097C133.99 41.1015 130.865 41.6633 127.874 42.6767ZM138.549 41.0177L140.523 39.0437L140.87 41.1607C140.099 41.0796 139.325 41.0319 138.55 41.0177H138.549ZM119 25.1007C118.624 25.1007 118.257 25.2121 117.945 25.4209C117.632 25.6297 117.389 25.9264 117.245 26.2736C117.101 26.6207 117.063 27.0028 117.137 27.3713C117.21 27.7399 117.391 28.0785 117.657 28.3442C117.922 28.6099 118.261 28.7908 118.629 28.8642C118.998 28.9375 119.38 28.8998 119.727 28.756C120.074 28.6122 120.371 28.3687 120.58 28.0563C120.789 27.7438 120.9 27.3765 120.9 27.0007C120.9 26.4969 120.699 26.014 120.343 25.6577C119.987 25.3015 119.504 25.1012 119 25.1007ZM119 28.1007C118.783 28.1007 118.57 28.0362 118.389 27.9153C118.208 27.7944 118.067 27.6226 117.984 27.4216C117.901 27.2206 117.879 26.9994 117.921 26.7861C117.964 26.5727 118.068 26.3767 118.222 26.2229C118.376 26.069 118.572 25.9642 118.786 25.9218C118.999 25.8794 119.22 25.9011 119.421 25.9844C119.622 26.0677 119.794 26.2086 119.915 26.3895C120.036 26.5704 120.1 26.7831 120.1 27.0007C120.1 27.2923 119.984 27.572 119.778 27.7782C119.571 27.9844 119.292 28.1004 119 28.1007ZM119.5 33.1007C119.223 33.1007 118.953 33.1828 118.722 33.3366C118.492 33.4904 118.313 33.7091 118.207 33.9649C118.101 34.2207 118.073 34.5022 118.127 34.7738C118.181 35.0454 118.314 35.2948 118.51 35.4906C118.706 35.6864 118.955 35.8197 119.227 35.8738C119.499 35.9278 119.78 35.9001 120.036 35.7941C120.292 35.6881 120.51 35.5087 120.664 35.2785C120.818 35.0482 120.9 34.7776 120.9 34.5007C120.9 34.1295 120.752 33.7737 120.489 33.5113C120.227 33.2489 119.871 33.1012 119.5 33.1007ZM119.5 35.1007C119.381 35.1007 119.265 35.0655 119.167 34.9995C119.068 34.9336 118.991 34.8399 118.946 34.7303C118.9 34.6206 118.888 34.5 118.912 34.3836C118.935 34.2672 118.992 34.1603 119.076 34.0764C119.16 33.9925 119.267 33.9353 119.383 33.9122C119.499 33.889 119.62 33.9009 119.73 33.9463C119.839 33.9918 119.933 34.0687 119.999 34.1673C120.065 34.266 120.1 34.382 120.1 34.5007C120.1 34.6598 120.037 34.8124 119.924 34.9249C119.812 35.0375 119.659 35.1007 119.5 35.1007ZM128 36.1007C127.624 36.1007 127.257 36.2121 126.945 36.4209C126.632 36.6297 126.389 36.9264 126.245 37.2736C126.101 37.6207 126.063 38.0028 126.137 38.3713C126.21 38.7399 126.391 39.0784 126.657 39.3442C126.922 39.6099 127.261 39.7908 127.629 39.8642C127.998 39.9375 128.38 39.8998 128.727 39.756C129.074 39.6122 129.371 39.3687 129.58 39.0563C129.789 38.7438 129.9 38.3765 129.9 38.0007C129.9 37.4969 129.699 37.014 129.343 36.6577C128.987 36.3015 128.504 36.1012 128 36.1007ZM128 39.1007C127.783 39.1007 127.57 39.0362 127.389 38.9153C127.208 38.7944 127.067 38.6226 126.984 38.4216C126.901 38.2206 126.879 37.9994 126.921 37.7861C126.964 37.5727 127.068 37.3767 127.222 37.2229C127.376 37.069 127.572 36.9642 127.786 36.9218C127.999 36.8794 128.22 36.9011 128.421 36.9844C128.622 37.0677 128.794 37.2086 128.915 37.3895C129.036 37.5704 129.1 37.7831 129.1 38.0007C129.1 38.2923 128.984 38.572 128.778 38.7782C128.571 38.9844 128.292 39.1004 128 39.1007Z", fill: "#35AC46" }))
            },
            {
                title: i18n.onboard.linkLayerTitle,
                content: i18n.onboard.linkLayerContent,
                background: "#EDD317",
                show: true,
                path: ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { d: "M145.887 31.4506C145.802 26.7994 143.986 22.347 140.792 18.9642C137.599 15.5814 133.258 13.5116 128.62 13.1596C128.253 13.1256 127.881 13.1016 127.5 13.1016C127.119 13.1016 126.747 13.1256 126.38 13.1596C121.741 13.5116 117.4 15.5816 114.207 18.9646C111.014 22.3475 109.197 26.8002 109.113 31.4516C109.113 31.4866 109.119 31.5186 109.122 31.5536C109.118 31.7036 109.1 31.8496 109.1 32.0006C109.063 36.377 110.556 40.6289 113.32 44.0221C116.084 47.4152 119.946 49.7367 124.24 50.5856C124.405 50.6186 124.577 50.6376 124.745 50.6656C125.079 50.7166 125.411 50.7756 125.752 50.8096C126.914 50.9309 128.086 50.9309 129.248 50.8096C129.588 50.7766 129.921 50.7166 130.255 50.6646C130.423 50.6376 130.595 50.6186 130.76 50.5856C135.053 49.7367 138.916 47.4152 141.68 44.0221C144.444 40.6289 145.937 36.377 145.9 32.0006C145.9 31.8506 145.882 31.7036 145.878 31.5536C145.881 31.5186 145.887 31.4866 145.887 31.4516V31.4506ZM142.534 41.3626L142.278 41.6666C141.704 42.2504 141.008 42.7004 140.24 42.9846C141.445 40.2196 142.049 37.2304 142.013 34.2146C143.102 33.9263 144.133 33.4509 145.06 32.8096C144.935 35.8251 144.067 38.7631 142.534 41.3626ZM112.722 41.6666L112.471 41.3586C110.936 38.7609 110.067 35.8242 109.941 32.8096C110.867 33.4508 111.898 33.9262 112.987 34.2146C112.951 37.2304 113.555 40.2196 114.76 42.9846C113.992 42.7003 113.296 42.2503 112.722 41.6666ZM112.298 22.9226C113.015 23.4313 113.838 23.773 114.705 23.9226C113.624 26.9623 113.044 30.1577 112.989 33.3836C111.124 32.8016 110.014 32.1466 109.923 31.5326C109.993 28.5107 110.809 25.553 112.298 22.9226ZM120.476 16.5126C121.232 16.9679 122.064 17.2811 122.933 17.4366C122.079 19.5294 121.455 21.7089 121.072 23.9366C119.301 23.8294 117.537 23.6203 115.79 23.3106C116.782 20.7007 118.39 18.3687 120.476 16.5126ZM139.216 23.3246C137.466 23.6264 135.701 23.8314 133.929 23.9386C133.546 21.7102 132.921 19.53 132.067 17.4366C132.935 17.2811 133.768 16.9679 134.524 16.5126C136.614 18.3723 138.223 20.7092 139.216 23.3246ZM145.076 31.5326C144.986 32.1466 143.876 32.8026 142.011 33.3836C141.955 30.1581 141.376 26.963 140.295 23.9236C141.162 23.774 141.984 23.4323 142.702 22.9236C144.191 25.5537 145.006 28.5111 145.077 31.5326H145.076ZM141.214 33.6156C139.159 34.1446 137.067 34.52 134.956 34.7386C134.919 31.3844 134.623 28.0381 134.071 24.7296C135.896 24.6268 137.713 24.4145 139.512 24.0936C140.608 27.15 141.183 30.3687 141.214 33.6156ZM127.9 17.8756C129.023 17.8623 130.143 17.7674 131.253 17.5916C132.117 19.6458 132.747 21.7906 133.133 23.9856C131.584 24.0756 129.843 24.1306 127.9 24.1376V17.8756ZM127.9 17.0756V13.9366C129.033 14.1396 130.038 15.1966 130.893 16.8406C129.901 16.9847 128.902 17.0626 127.9 17.0736V17.0756ZM127.1 17.0756C126.098 17.0642 125.098 16.9861 124.107 16.8416C124.962 15.1986 125.967 14.1406 127.1 13.9376V17.0756ZM127.1 17.8756V24.1376C125.354 24.1342 123.609 24.0832 121.867 23.9846C122.252 21.7899 122.883 19.6455 123.747 17.5916C124.856 17.7671 125.977 17.8617 127.1 17.8746V17.8756ZM127.1 24.9396V35.1446C125.011 35.1351 122.923 35.0289 120.844 34.8266C120.863 31.459 121.156 28.0986 121.721 24.7786C123.961 24.9056 126.001 24.9346 127.1 24.9386V24.9396ZM127.1 35.9446V45.0376C125.405 45.0269 123.711 44.9231 122.028 44.7266C121.214 41.7646 120.815 38.7041 120.842 35.6326C122.869 35.8276 124.999 35.9326 127.1 35.9446ZM127.1 45.8376V50.0786C124.722 49.8876 123.235 48.0046 122.313 45.5586C123.903 45.7328 125.5 45.8263 127.1 45.8386V45.8376ZM127.9 45.8376C129.499 45.826 131.097 45.7332 132.687 45.5596C131.765 48.0046 130.277 49.8876 127.9 50.0796V45.8376ZM127.9 45.0376V35.9446C129.989 35.9339 132.077 35.8298 134.158 35.6326C134.184 38.7038 133.785 41.7639 132.972 44.7256C131.288 44.9222 129.595 45.0264 127.9 45.0376ZM127.9 35.1446V24.9406C128.999 24.9356 131.038 24.9066 133.279 24.7796C133.843 28.0996 134.136 31.46 134.156 34.8276C132.076 35.0299 129.989 35.136 127.9 35.1456V35.1446ZM131.723 16.6946C131.288 15.7612 130.693 14.911 129.966 14.1826C131.376 14.5183 132.704 15.1368 133.869 16.0006C133.189 16.3317 132.467 16.5659 131.723 16.6966V16.6946ZM123.277 16.6946C122.532 16.5647 121.81 16.3311 121.13 16.0006C122.294 15.1371 123.622 14.519 125.033 14.1836C124.305 14.9123 123.71 15.7628 123.276 16.6966L123.277 16.6946ZM120.929 24.7296C120.376 28.0384 120.08 31.3851 120.044 34.7396C117.933 34.5206 115.841 34.1449 113.786 33.6156C113.817 30.3687 114.392 27.15 115.488 24.0936C117.287 24.4144 119.103 24.6268 120.928 24.7296H120.929ZM113.794 34.4516C115.847 34.9692 117.936 35.3348 120.044 35.5456C119.99 38.6014 120.352 41.6504 121.121 44.6086C119.354 44.3753 117.613 43.9809 115.918 43.4306C114.523 40.6428 113.796 37.5688 113.794 34.4516ZM121.396 45.4446C121.888 47.1149 122.847 48.6098 124.16 49.7536C122.593 49.435 121.108 48.8006 119.794 47.889C118.48 46.9775 117.366 45.8079 116.52 44.4516C118.118 44.9041 119.748 45.2361 121.396 45.4446ZM133.604 45.4446C135.251 45.2364 136.881 44.9048 138.479 44.4526C137.632 45.8085 136.518 46.9778 135.204 47.889C133.891 48.8002 132.405 49.4343 130.839 49.7526C132.152 48.6096 133.111 47.1153 133.604 45.4456V45.4446ZM133.88 44.6086C134.648 41.6504 135.01 38.6014 134.956 35.5456C137.063 35.3348 139.152 34.9692 141.206 34.4516C141.204 37.5688 140.476 40.6428 139.082 43.4306C137.387 43.9809 135.646 44.3752 133.88 44.6086ZM142.282 22.2126C142.282 22.4826 141.512 22.8366 140.005 23.1666C138.972 20.4017 137.288 17.9262 135.096 15.9496C135.134 15.8849 135.167 15.8165 135.192 15.7456C138.101 17.2143 140.552 19.4506 142.282 22.2126ZM134.462 15.3836C134.46 15.4004 134.456 15.4171 134.452 15.4336C134.386 15.3836 134.317 15.3376 134.25 15.2896C134.321 15.3196 134.392 15.3526 134.463 15.3836H134.462ZM120.548 15.4336C120.543 15.4192 120.54 15.4045 120.538 15.3896C120.608 15.3586 120.678 15.3196 120.75 15.2896C120.683 15.3376 120.614 15.3846 120.548 15.4346V15.4336ZM119.808 15.7456C119.833 15.8165 119.865 15.8849 119.904 15.9496C117.716 17.9213 116.035 20.39 115.002 23.1476C113.568 22.8216 112.815 22.4676 112.742 22.1716C114.47 19.428 116.913 17.2066 119.808 15.7456ZM113.885 43.4536C114.341 43.6791 114.81 43.8784 115.289 44.0506C115.781 44.9374 116.369 45.7674 117.043 46.5256C115.868 45.6351 114.807 44.6033 113.885 43.4536ZM137.957 46.5256C138.63 45.7674 139.219 44.9374 139.711 44.0506C140.19 43.8784 140.659 43.6791 141.115 43.4536C140.192 44.6034 139.132 45.6351 137.957 46.5256Z", fill: "#D9BC00" }))
            }
        ]
            .filter((section) => section.show)
            .map(this.renderOnboardingSection);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: i18n.onboard.tooltipLabel, placement: "bottom-start", heading: i18n.onboard.title, headingLevel: 3, class: "onboarding", overlayPositioning: "fixed", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "onboarding__scroll" }, onboardingContent)));
    }
    render() {
        const { i18n, noPadding, isLoading, loadingText, isActive, disableCloseButton } = this;
        const contentStyle = this.outerHeight ? { height: `${this.outerHeight}px` } : {};
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { ref: (ele) => (this.modalRef = ele), open: isActive, onCalciteModalClose: this.closeDialog, outsideCloseDisabled: true, escapeDisabled: true, class: {
                modal: true,
                "modal--grey": noPadding
            }, closeButtonDisabled: disableCloseButton }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { id: "modal-title", class: "header__title" }, this.getHeaderTitle()), this.pageHistory[this.pageHistory.length - 1] === "home" &&
            isActive &&
            this.renderOnboarding()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", style: contentStyle, ref: (el) => (this.contentSlot = el), class: "content" }, isLoading && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stage" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: loadingText !== null && loadingText !== void 0 ? loadingText : i18n.loadingData }))), !isLoading && this.displayPage()), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "back" }, this.showBackButton && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", "data-id": "backButton", onClick: () => {
                if (this.navEnabled) {
                    this.triggerPageTransition("arcgisNewItemPagePrev");
                }
            }, width: "full", disabled: !this.navEnabled }, i18n.back))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", "data-id": "cancelButton", onClick: () => {
                if (!disableCloseButton) {
                    this.isActive = false;
                }
            }, width: "full", disabled: disableCloseButton }, i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", "data-id": "nextButton", onClick: () => {
                this.triggerPageTransition("arcgisNewItemPageNext");
            }, width: "full", disabled: !this.navEnabled }, this.primaryButtonText)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "isActive": ["updateActive"],
        "firstStep": ["updateFirstStep"],
        "file": ["initializeWithFile"],
        "initialFolder": ["updateInitialFolder"]
    }; }
};
ArcgisNewItem.style = arcgisNewItemCss;

const handleCreateLayerListTelemetry = (label) => {
    const { telemetry } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
    const payload = {
        eventType: "new item click",
        pageName: "my content",
        category: "new item",
        label
    };
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.telemetryDetails = label;
};
const handleApplicationClick = () => {
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "application";
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = null;
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = "Web Mapping Application";
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.typeKeywords = ["JavaScript", "Online Map", "Ready To Use"];
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.thumbnailURL = "https://static.arcgis.com/images/desktopapp.png";
};
const handleFeatureLayerClick = async () => {
    var _a;
    (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry) === null || _a === void 0 ? void 0 : _a.startWorkflow("create feature layer", {
        category: "create feature layer",
        pageName: "my content"
    });
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "create";
};

const arcgisNewItemCreateLayersListCss = ".title{margin:0px;margin-top:2rem;padding:0px;font-size:1rem;font-weight:400;color:var(--calcite-color-text-1)}.list{margin:0px;display:flex;flex-wrap:wrap;padding:0px;padding-bottom:0.75rem}.list-item{margin:0px;display:flex;justify-items:start;padding:0px;list-style-type:none;flex:1 1 380px}.card{margin-top:1.25rem;display:flex;padding:0px;margin-inline-end:2rem;border:1px solid transparent;max-width:440px;align-items:stretch;background-color:white;transition:all 150ms ease-in-out;outline-offset:0px;outline-color:transparent;font-family:inherit;text-align:initial;cursor:pointer}.card:hover{border-color:#aaa}.card:focus{outline:none;border-color:var(--calcite-color-brand)}.card:hover .card__icon,.card:focus .card__icon{background-color:rgb(238, 247, 253)}.card:hover .card__arrow,.card:focus .card__arrow{opacity:1;transform:translate3d(0, 0, 0)}.card__arrow{vertical-align:-6px;opacity:0;transform:translate3d(-20px, 0, 0);transition:all 150ms ease-in-out}.card__icon{flex:0 0 auto;display:flex;justify-content:center;align-items:center;width:87px;min-height:87px;color:#000000;background-color:var(--calcite-color-background);transition:all 150ms ease-in-out}.card__content{padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem}.card__title{margin:0px;padding:0px;font-size:1rem;font-weight:400;line-height:1.25rem;color:#323232}.card__subtitle{margin:0px;margin-top:0.5rem;padding:0px;font-size:0.875rem;font-weight:400;line-height:1.25rem;color:#646464}";

const ArcgisNewItemCreateLayersList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.handleRedirect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "handleRedirect", 7);
        this.i18n = undefined;
        this.options = undefined;
        this.isLoading = false;
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.createLayersList;
        const { user, portal, userLicensedItems } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        this.isLoading = true;
        const { result: subscriptionInfo } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_subscription_22caae1a_js__WEBPACK_IMPORTED_MODULE_17__.g)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal), "subscriptionType", (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.n)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user));
        _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.subscriptionInfo = subscriptionInfo;
        this.isLoading = false;
        // TODO: filter options based on user's permissions
        this.options = [
            {
                heading: this.i18n.featureLayerHeading,
                icon: "featureLayer",
                description: this.i18n.featureLayerDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("featureLayer") && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.b)(user, portal),
                handler: this.onFeatureLayerClick
            },
            {
                heading: this.i18n.urlHeading,
                icon: "web",
                description: this.i18n.urlDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("url"),
                handler: this.onURLClick
            },
            {
                heading: this.i18n.developerCredentialsHeading,
                icon: "key",
                description: this.i18n["developerCredentialsNoAPIDescription"],
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("developerCredentials") &&
                    (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.d)(user),
                handler: this.onDeveloperCredentialsClick
            },
            {
                heading: this.i18n.applicationHeading,
                icon: "apps",
                description: this.i18n.applicationDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("application"),
                handler: this.onApplicationClick
            },
            {
                heading: this.i18n.imageLayerHeading,
                icon: "imageLayer",
                description: this.i18n.imageLayerDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("imageryLayer") &&
                    (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.e)(user, portal, userLicensedItems),
                handler: this.onImageryLayerClick
            },
            {
                heading: this.i18n.tileLayerHeading,
                icon: "tileLayer",
                description: this.i18n.tileLayerDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("tileLayer") && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.g)(user, portal),
                handler: this.onTileLayerClick
            },
            {
                heading: this.i18n.sceneLayerHeading,
                icon: "layerGraphics",
                description: this.i18n.sceneLayerDescription,
                handler: this.onSceneLayerClick,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("sceneLayer") && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.h)(user)
            },
            {
                heading: this.i18n.locatorHeading,
                icon: "locator",
                description: this.i18n[(0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.i)(user, portal) ? "locatorDescription" : "locatorOnlyDescription"],
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("locator") && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.j)(user),
                handler: this.onLocatorClick
            },
            {
                heading: this.i18n.dataStoreHeading,
                icon: "data",
                description: this.i18n.dataStoreDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("dataStore") && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.k)(user, portal),
                handler: this.onDataStoreClick /* For Enterprise */
            },
            {
                heading: this.i18n.dataStoreHeading,
                icon: "data",
                description: this.i18n.dataStoreConnectionDescription,
                show: false,
                handler: this.onDataStoreConnectionClick /* Placeholder for Online implementation */
            },
            {
                heading: this.i18n.rasterFunctionTemplateHeading,
                icon: "new-raster-function-template",
                description: this.i18n.rasterFunctionTemplateDescription,
                show: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedModes.includes("rasterFunctionTemplate") &&
                    (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.l)(user) &&
                    !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(user),
                handler: this.onRasterFunctionTemplateClick
            }
        ];
    }
    onFeatureLayerClick() {
        handleCreateLayerListTelemetry("feature layer");
        handleFeatureLayerClick();
        this.newItemUpdatePage.emit("featureLayerSelect");
    }
    onTileLayerClick() {
        handleCreateLayerListTelemetry("tile layer");
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "tileLayer";
        (0,_tile_layer_f0f9ef4b_js__WEBPACK_IMPORTED_MODULE_16__.l)();
        this.newItemUpdatePage.emit("tileLayerSelect");
    }
    onSceneLayerClick() {
        handleCreateLayerListTelemetry("scene layer");
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "sceneLayer";
        // TODO: add telemetry
        // logTileLayerStart();
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal) {
            this.newItemUpdatePage.emit("sceneLayerSelect");
        }
        else {
            // We only have 1 option in AGOL so just skip the select screen directly
            this.newItemUpdatePage.emit("layerUpload");
        }
    }
    onImageryLayerClick() {
        handleCreateLayerListTelemetry("imagery layer");
        this.handleRedirect.emit({ type: "Imagery Layer" });
    }
    onURLClick() {
        handleCreateLayerListTelemetry("url");
        this.newItemUpdatePage.emit("urlTypeSelect");
    }
    onDataStoreClick() {
        const useNewWorkflow = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config.addDatastoreComponentEnabled;
        handleCreateLayerListTelemetry("data store");
        if (!useNewWorkflow) {
            // Previous handler for redirecting to the dojo-based workflow
            this.handleRedirect.emit({ type: "Data Store" });
        }
        else {
            // Migrated UI for adding data stores https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2429
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "dataStore";
            this.newItemUpdatePage.emit("dataStoreSelect");
        }
    }
    onDataStoreConnectionClick() {
        //keeping this separate from onDataStoreClick when this opens up to new item for Online
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "dataStore";
        this.newItemUpdatePage.emit("dataStoreSelect");
    }
    onApplicationClick() {
        handleCreateLayerListTelemetry("an app");
        handleApplicationClick();
        this.newItemUpdatePage.emit("application");
    }
    async onLocatorClick() {
        handleCreateLayerListTelemetry("locator");
        this.newItemUpdatePage.emit("locatorSelect");
    }
    onDeveloperCredentialsClick() {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "developerCredentials";
        handleCreateLayerListTelemetry("dev cred");
        this.newItemUpdatePage.emit("developerCredentialsSelect");
    }
    onRasterFunctionTemplateClick() {
        handleCreateLayerListTelemetry("raster function template");
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = "Raster function template";
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "rasterFunctionTemplate";
        this.newItemUpdatePage.emit("itemProperties");
    }
    renderOptions() {
        return this.options.map((option) => option.show && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { class: "list-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "card", onClick: option.handler.bind(this) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__icon" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: option.icon, scale: "l" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "card__content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "card__title" }, option.heading, " ", (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "card__arrow", icon: "arrow-right", "flip-rtl": true })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "card__subtitle" }, option.description))))));
    }
    render() {
        const { isLoading, i18n } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("nav", { "aria-labelledby": "layers-list-heading" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: isLoading, text: i18n.getSubscriptionInfo }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "list" }, this.renderOptions())));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCreateLayersList.style = arcgisNewItemCreateLayersListCss;

const arcgisNewItemCsvFieldCss = ".cell{box-sizing:border-box;width:33.333333%}.cell label{margin-top:0.75rem !important}.row{display:flex;align-items:center;justify-content:space-between;gap:0.25rem;padding:0.25rem;border-top:1px solid #eaeaea}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0;position:relative}.field-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}";

const ArcgisNewItemCsvField = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.fieldChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "fieldChange", 7);
        this.handleTypeChange = (ev) => {
            const value = ev.target.selectedOption.value;
            this.fieldChange.emit({
                name: this.field.name,
                key: "type",
                value,
                modified: value !== this.initialField.type
            });
        };
        this.checked = true;
        this.defaultChecked = true;
        this.field = undefined;
        this.fieldTypes = undefined;
        this.detectedType = undefined;
        this.canHideFields = undefined;
        this.displayNameLabel = undefined;
        this.typeLabel = undefined;
    }
    componentWillLoad() {
        this.checked = this.defaultChecked;
        this.allowedFieldTypes = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_19__.g)(this.detectedType);
        // Telemetry: Capture default state of the field
        this.initialField = Object.assign({}, this.field);
    }
    render() {
        const { field, canHideFields } = this;
        const deselected = !field.selected;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "cell", layout: "inline", role: "cell" }, canHideFields && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { onCalciteCheckboxChange: (ev) => this.fieldChange.emit({
                name: field.name,
                key: "selected",
                value: ev.target.checked
            }), checked: field.selected })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { "field-name": true, deselected } }, field.name)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "cell label", role: "cell" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { disabled: deselected, onCalciteInputInput: (event) => {
                const value = event.target.value;
                this.fieldChange.emit({
                    name: field.name,
                    key: "alias",
                    value,
                    modified: value !== this.initialField.alias
                });
            }, value: field.alias || field.name }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, this.displayNameLabel)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.typeLabel, class: "cell", role: "cell", "aria-sort": "none", disabled: deselected, onCalciteSelectChange: this.handleTypeChange }, Object.keys(this.fieldTypes)
            .filter((fieldType) => this.allowedFieldTypes.includes(fieldType))
            .map((type) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: field.type === type, value: type, key: field.name }, this.fieldTypes[type]))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCsvField.style = arcgisNewItemCsvFieldCss;

const arcgisNewItemCustomParameterCss = ".container{margin-bottom:0.5rem;border:1px solid;border-color:var(--calcite-color-border-1);padding:16px;max-width:100%}.content-container{display:flex}.inputs{display:flex;flex-direction:column;width:100%}@media (min-width: 864px){.inputs{flex-direction:row}}.inputs calcite-label{flex:1 1 0%}@media (min-width: 864px){.inputs calcite-label:first-child{margin-inline-end:0.75rem}}.delete-container{display:flex;align-items:center;justify-content:flex-end;position:relative;margin-inline-start:1.5rem;margin-top:10px}.delete-btn{cursor:pointer;border-style:none;background:transparent;height:-moz-fit-content;height:fit-content;padding:6px}.delete-btn:focus{outline:5px auto;outline-color:var(--calcite-color-brand-hover)}.checkbox{display:flex;align-items:center}calcite-checkbox{margin-inline-end:5px}.delete-btn-popover{white-space:nowrap;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem}";

const ArcgisNewItemCustomParameter = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.removeCustomParameter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "removeCustomParameter", 7);
        this.updateCustomParameter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "updateCustomParameter", 7);
        this.itemType = undefined;
        this.index = undefined;
        this.customParameter = undefined;
        this.i18n = undefined;
        this.showAppend = false;
        this.deleteButtonRef = undefined;
        this.deleteTooltipOpen = false;
    }
    async componentDidLoad() {
        this.setFocus();
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(500);
        const openTooltip = () => {
            this.deleteTooltipOpen = true;
        };
        const closeTooltip = () => {
            this.deleteTooltipOpen = false;
        };
        this.deleteButtonRef.onfocus = openTooltip;
        this.deleteButtonRef.onblur = closeTooltip;
        this.deleteButtonRef.onmouseover = openTooltip;
        this.deleteButtonRef.onmouseout = closeTooltip;
    }
    componentWillLoad() {
        this.handleItemTypeChange();
    }
    async setFocus(delay = 0) {
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(delay);
        this.mainInputRef.setFocus();
    }
    handleItemTypeChange() {
        this.showAppend = ["WMS", "WMTS"].some((type) => type === this.itemType);
    }
    handleInputChange(event, type) {
        const node = event.target;
        const updatedParameter = type === "parameter"
            ? Object.assign(Object.assign({}, this.customParameter), { parameter: node.value }) : Object.assign(Object.assign({}, this.customParameter), { value: node.value });
        this.updateCustomParameter.emit({ index: this.index, customParameter: updatedParameter });
    }
    handleCheckboxChange(event) {
        const updatedParameter = Object.assign(Object.assign({}, this.customParameter), { append: event.target.checked ? "layer" : "all" });
        this.updateCustomParameter.emit({ index: this.index, customParameter: updatedParameter });
    }
    render() {
        var _a, _b;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "inputs" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.i18n.parameter, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: this.i18n.addParameter, value: (_a = this.customParameter) === null || _a === void 0 ? void 0 : _a.parameter, onCalciteInputInput: (ev) => this.handleInputChange(ev, "parameter"), ref: (ele) => (this.mainInputRef = ele) })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.i18n.value, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: this.i18n.addValue, value: (_b = this.customParameter) === null || _b === void 0 ? void 0 : _b.value, onCalciteInputInput: (ev) => this.handleInputChange(ev, "value") }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "delete-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "delete-btn", "aria-label": this.i18n.remove, onClick: () => this.removeCustomParameter.emit(this.index), ref: (ele) => (this.deleteButtonRef = ele) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "trash", scale: "s" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.i18n.remove, pointerDisabled: true, referenceElement: this.deleteButtonRef, open: this.deleteTooltipOpen }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "delete-btn-popover" }, this.i18n.remove)))), this.showAppend && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "checkbox" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { checked: this.customParameter.append === "layer", onCalciteCheckboxChange: (ev) => this.handleCheckboxChange(ev), onClick: (ev) => ev.preventDefault() }), this.i18n.append))));
    }
    static get watchers() { return {
        "itemType": ["handleItemTypeChange"]
    }; }
};
ArcgisNewItemCustomParameter.style = arcgisNewItemCustomParameterCss;

const arcgisNewItemCustomParametersCss = ":host{font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;font-size:0.875rem;margin-bottom:14px}.label{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:16px;margin-bottom:8px}.sub-header{font-size:0.875rem;color:var(--calcite-color-text-3);display:flex;margin-top:0px;line-height:18px}.help-text{display:block;max-width:20rem}.add{display:flex;cursor:pointer;align-items:center;justify-content:center;font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;font-size:0.875rem;font-weight:500;margin-bottom:0.5rem;padding-inline-start:0px;transition-duration:200ms;color:var(--calcite-color-text-link);border:none;box-shadow:none;background:transparent;padding:10px;line-height:16px}.add:focus,.add:focus-visible{outline:5px auto;outline-color:#00619b}.add:hover{color:#00619b}.add-icon{color:var(--calcite-color-text-link);margin-inline-end:0.625rem}";

const ArcgisNewItemCustomParameters = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.customParameterRefList = [];
        this.itemType = undefined;
        this.customParameters = undefined;
        this.i18n = undefined;
    }
    removeCustomParameter(event) {
        const itemIndex = event.detail;
        const { url } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (url) {
            const newUrl = (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.r)(url, this.customParameters[itemIndex]);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url = newUrl;
        }
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        this.customParameters = customParameters.filter((_, index) => index !== itemIndex);
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters = [...this.customParameters];
        if (this.customParameters.length <= 0) {
            this.newCustomParameterRef.focus();
        }
        else {
            this.customParameterRefList[Math.max(0, itemIndex - 1)].setFocus();
        }
    }
    updateCustomParameterHandler(event) {
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { index, customParameter } = event.detail;
        this.customParameters = customParameters.map((entry, idx) => {
            if (idx === index) {
                entry = customParameter;
            }
            return entry;
        });
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters = [...this.customParameters];
    }
    async componentWillLoad() {
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.customParameters;
        this.customParameters = customParameters;
    }
    createNewCustomParameter() {
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        this.customParameters = [...customParameters, { parameter: "", value: "", append: "all" }];
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters = this.customParameters;
    }
    render() {
        var _a;
        const { i18n, itemType } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "label" }, i18n.customParameters), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "sub-header" }, i18n.description, " ", (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: i18n.customParameters, placement: "bottom", offsetSkidding: 6, overlayPositioning: "fixed", headingLevel: 3, paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "help-text" }, i18n.helpText))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "add", type: "submit", onClick: () => this.createNewCustomParameter(), ref: (ele) => (this.newCustomParameterRef = ele) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "add-icon", icon: "plus", scale: "s" }), i18n.newCustomParameter), (_a = this.customParameters) === null || _a === void 0 ? void 0 :
            _a.map((customParameter, index) => {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameter", { class: "custom-parameter", itemType: itemType, customParameter: customParameter, index: index, i18n: i18n, ref: (ele) => (this.customParameterRefList[index] = ele) }));
            })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemCustomParameters.style = arcgisNewItemCustomParametersCss;

const arcgisNewItemInputReadonlyCss = ":host{--arcgis-label-font-weight:400}.label{margin-top:0px;margin-bottom:0px;font-weight:var(--arcgis-label-font-weight)}.label--bold{--arcgis-label-font-weight:500}";

const ArcgisNewItemInputReadonly = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.scale = "m";
        this.label = undefined;
        this.path = undefined;
        this.i18n = undefined;
        this.labelType = "bold";
    }
    async componentWillLoad() {
        var _a, _b;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.inputReadonly;
        const { newItemMode: itemType, fileName, originalFileName, url, provider, databaseProvider, addDataStoreType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const strings = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.itemProperties;
        switch (itemType) {
            case "file":
                this.label = (_a = this.label) !== null && _a !== void 0 ? _a : this.i18n.file;
                this.path = originalFileName !== null && originalFileName !== void 0 ? originalFileName : fileName;
                break;
            case "url":
                this.label = this.i18n.url;
                this.path = url;
                break;
            case "dataStore":
                this.label = this.i18n.dataStore;
                this.path =
                    addDataStoreType === "cloud" ? strings[provider] : (_b = strings[databaseProvider]) !== null && _b !== void 0 ? _b : null;
        }
    }
    render() {
        var _a;
        const { labelType, path, label, scale } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.scale) !== null && _a !== void 0 ? _a : scale }, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAppendSelectOption !== "overwrite" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: `label label--${labelType}` }, label)), path && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-field" }, path)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemInputReadonly.style = arcgisNewItemInputReadonlyCss;

const arcgisNewItemLayerSearchCss = ".screen-reader{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.search-container{width:100%}";

const ArcgisNewItemLayerSearch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.searchUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "searchUpdate", 7);
        this.handleSearchInput = (event) => {
            const input = event.target.value || "";
            if (input !== this.searchInput) {
                this.searchInput = input;
                this.searchUpdate.emit(input);
            }
        };
        this.handleKeyup = (event) => {
            if ((event.key === "Escape" || event.key === "Esc") && this.searchInput) {
                event.stopPropagation();
                this.searchInput = "";
            }
        };
        this.searchInput = "";
        this.controls = undefined;
        this.searchLabel = undefined;
        this.i18n = undefined;
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.layerSearch;
    }
    async focusMainInput() {
        this.mainInputRef.setFocus();
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "search-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "screen-reader", htmlFor: "search" }, this.i18n.search), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { placeholder: `${this.i18n.search} ${this.searchLabel}`, icon: "search", type: "search", id: "search", clearable: true, "aria-controls": this.controls, value: this.searchInput, onKeyUp: this.handleKeyup, ref: (el) => (this.mainInputRef = el), onCalciteInputInput: this.handleSearchInput })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemLayerSearch.style = arcgisNewItemLayerSearchCss;

const arcgisNewItemPagesApplicationCss = ".flex-container{display:flex;justify-content:space-between}.leader{margin-top:2rem}.two-up{width:calc(50% - 2rem)}calcite-label{color:var(--calcite-color-text-1)}.label{margin-bottom:0px;margin-top:0px;font-size:0.875rem;font-weight:500;line-height:18px}.file{margin:0px;margin-bottom:2rem;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-1)}";

const ArcgisNewItemPagesApplication = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.submenus = {
            desktop: {
                title: "Platform",
                file: true
            },
            mobile: { title: "SDK" },
            web: { title: "API" }
        };
        this.url = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url;
        this.urlInputMessage = undefined;
        this.fileInputMessage = undefined;
        this.manifestInputMessage = undefined;
        this.manifestUrl = undefined;
        this.i18n = undefined;
        this.i18nURL = undefined;
    }
    validateFile(file) {
        const { title, fileName, extension } = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.s)(file);
        if (extension !== "zip") {
            this.fileInputMessage = this.i18n.selectZip;
            return false;
        }
        else {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = file;
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
            this.fileInputMessage = null;
            return true;
        }
    }
    async navigateToNextPage() {
        const { url, i18n, i18nURL, manifestUrl } = this;
        const { file, applicationType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        let manifest;
        if (url && (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.i)(url, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal)) {
            this.urlInputMessage = i18nURL.httpWarning;
            return;
        }
        if (applicationType === "desktop") {
            if (!file) {
                this.fileInputMessage = i18n.fileRequired;
                return;
            }
            if (!this.validateFile(file)) {
                return;
            }
        }
        if ((applicationType === "mobile" || applicationType === "web") && !url) {
            this.urlInputMessage = i18n.enterUrl;
            return;
        }
        if (applicationType === "appExtension" || applicationType === "experienceBuilderWidget") {
            if (!manifestUrl) {
                this.manifestInputMessage = i18n.enterManifestUrl;
                return;
            }
            const { error, result } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.f)(this.manifestUrl);
            if (error) {
                this.manifestInputMessage = this.i18n[error.code];
                return;
            }
            manifest = result;
        }
        // some apis need to be sent to the server differently than they are shown in the dropdown
        const types = {
            web: {
                type: "Web Mapping Application",
                typeKeywords: ["Web Map", "Map", "Online Map", "Mapping Site"],
                thumbnailUrl: "https://static.arcgis.com/images/webapp.png",
                url
            },
            desktop: {
                type: "Desktop Application",
                typeKeywords: ["Desktop Application"],
                url
            },
            mobile: {
                type: "Mobile Application",
                typeKeywords: ["ArcGIS Mobile Map", "Mobile Application"],
                thumbnailUrl: "https://static.arcgis.com/images/mobileapp.png",
                url
            },
            appExtension: {
                type: "AppBuilder Extension",
                typeKeywords: [
                    "Widget",
                    "App Builder",
                    "widget",
                    (manifest === null || manifest === void 0 ? void 0 : manifest.platform) === "HTML3D" ? "HTML3D" : "HTML"
                ],
                url: manifestUrl,
                accessInformation: (manifest === null || manifest === void 0 ? void 0 : manifest.author) || "",
                text: manifest ? JSON.stringify(manifest) : ""
            },
            experienceBuilderWidget: {
                type: "Experience Builder Widget",
                url: manifestUrl,
                accessInformation: (manifest === null || manifest === void 0 ? void 0 : manifest.author) || "",
                text: manifest ? JSON.stringify(manifest) : ""
            },
            otherApplication: {
                type: "Application",
                typeKeywords: ["Application"]
            }
        };
        let title = "";
        if (url) {
            title = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.u)(url) || "";
        }
        else if (file) {
            title = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.s)(file).title;
        }
        else if (manifest) {
            title = manifest.name || "application extension";
        }
        const typeDetails = types[applicationType];
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "application";
        _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.name = `${title}_${(0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_20__.g)()}`;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = typeDetails.type;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.typeKeywords = typeDetails.typeKeywords;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url = typeDetails.url;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.accessInformation = typeDetails.accessInformation;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.text = typeDetails.text;
        this.newItemUpdatePage.emit("itemProperties");
    }
    async componentWillLoad() {
        const { application, url } = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        this.i18n = application;
        this.i18nURL = url;
        const { file, applicationType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (file) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.applicationType = "desktop";
        }
        else if (!applicationType) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.applicationType = "web";
        }
    }
    render() {
        const { i18n } = this;
        const { applicationType, applicationFile, file } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const menu = this.submenus[applicationType];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, !applicationFile && applicationType === "desktop" && file && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "label" }, i18n.File), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "file" }, file.name))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("form", { novalidate: true, onSubmit: (e) => {
                e.preventDefault();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.applicationType)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, [
            "web",
            "desktop",
            "mobile",
            ...(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.b)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user)
                ? ["appExtension", "experienceBuilderWidget"]
                : []),
            "otherApplication"
        ].map((value) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: applicationType === value, width: "full", "input-enabled": true, "input-alignment": "start", value: value, name: i18n[value], heading: i18n[value], onCalciteTileSelectChange: (e) => {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.applicationType = e.target.value;
                this.urlInputMessage = null;
                this.fileInputMessage = null;
            } })))), menu && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.URL), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", value: this.url, required: applicationType === "web" || applicationType === "mobile", status: this.urlInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
                this.url = e.target.value;
                this.urlInputMessage = null;
            }, onFocusout: (e) => {
                var _a;
                if (e.target.value && ((_a = this.url) === null || _a === void 0 ? void 0 : _a.indexOf("http")) < 0) {
                    // TODO: specify e.target
                    this.url = `https://${this.url}`;
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.urlInputMessage, status: "invalid" }, this.urlInputMessage)), menu.file && (applicationFile || !file) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.File), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "file", required: true, status: this.fileInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
                const file = e.target.shadowRoot.querySelector("input").files[0];
                this.validateFile(file);
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.applicationFile = file;
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.fileInputMessage, status: "invalid" }, this.fileInputMessage)))))), ["appExtension", "experienceBuilderWidget"].includes(applicationType) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "leader" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, i18n.manifestUrl), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "text", required: true, status: this.manifestInputMessage ? "invalid" : "idle", onCalciteInputInput: (e) => {
                this.manifestUrl = e.target.value;
                this.manifestInputMessage = null;
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, hidden: !this.manifestInputMessage, status: "invalid" }, this.manifestInputMessage)))))));
    }
    get element() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesApplication.style = arcgisNewItemPagesApplicationCss;

const ArcgisNewItemPagesAuth = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.handlePasswordChange = (event) => {
            this.updateValidationResponse(true);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.password = event.target.value;
        };
        this.handleUsernameChange = (event) => {
            this.updateValidationResponse(true);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.username = event.target.value;
        };
        this.isLoading = false;
        this.validationResponse = { valid: true };
    }
    async navigateToNextPage() {
        if (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.username || !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.password) {
            this.validationResponse = { valid: false, message: this.i18n.requiresCredentials };
            return;
        }
        this.isLoading = true;
        try {
            // TODO: Get store updates some other way, or add a separate return object to the big add url tunnel
            const response = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.a)(Object.assign({}, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a));
            const { title, description, snippet, tags, serviceUsername, servicePassword, serviceInfo, spatialReference, extent, thumbnailToken } = response;
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title || _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title;
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags = tags;
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet = snippet;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.description = description;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = serviceInfo;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceUsername = serviceUsername;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.servicePassword = servicePassword;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.spatialReference = spatialReference;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.thumbnailToken = thumbnailToken;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extent = extent;
            this.isLoading = false;
            if ((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.i)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url, serviceInfo)) {
                this.newItemUpdatePage.emit("hybridImageSelect");
                return;
            }
            this.newItemUpdatePage.emit("itemProperties");
        }
        catch (error) {
            console.error(error);
            this.validationResponse = { valid: false, message: this.i18n.invalid };
            this.isLoading = false;
        }
    }
    handleLoadChange(_oldValue, newValue) {
        this.newItemToggleNavigationEnabled.emit(newValue);
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.auth;
        this.urlTypei18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.urlType;
        // Clean up old serviceInfo if returning from item properties
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = null;
    }
    updateValidationResponse(valid) {
        if (!this.validationResponse.valid) {
            this.validationResponse = { valid };
        }
    }
    render() {
        const { i18n, urlTypei18n, validationResponse, isLoading } = this;
        const { valid, message } = validationResponse;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: "indeterminate", value: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.uploadProgress, active: isLoading, text: urlTypei18n.getServiceInfo }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { for: "username" }, i18n.enterUsername, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: this.handleUsernameChange, id: "username", placeholder: i18n.enterUsername, value: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.username, status: valid ? "idle" : "invalid" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { for: "password" }, i18n.enterPassword, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "password", onCalciteInputInput: this.handlePasswordChange, id: "password", placeholder: i18n.enterPassword, value: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.password, status: valid ? "idle" : "invalid", required: true }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: !valid, hidden: valid, status: valid ? "idle" : "invalid" }, message))));
    }
    get element() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "isLoading": ["handleLoadChange"]
    }; }
};

var TreeSelectionMode;
(function (TreeSelectionMode) {
    TreeSelectionMode["Single"] = "single";
    TreeSelectionMode["Multi"] = "multi";
    TreeSelectionMode["Children"] = "children";
    TreeSelectionMode["MultiChildren"] = "multi-children";
    TreeSelectionMode["Ancestors"] = "ancestors";
})(TreeSelectionMode || (TreeSelectionMode = {}));

const arcgisNewItemPagesBulkLayerSelectCss = ".outer-container{display:flex;flex-direction:column}.layer-select-tree{width:100%;overflow-y:auto}.layer-notice{margin-bottom:1.5rem}.select-item-message{font-size:0.875rem;font-weight:500;margin-bottom:0.25rem}.layer-not-found-message{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-2);text-align:center;width:100%;margin-top:1.5rem}.select-all{margin-top:5px;margin-left:5px}";

const SOFT_CAP = 1000;
const MAX_LAYER_LIMIT = 10000;
const ArcgisNewItemPagesBulkLayerSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        /** Keep a reference to all the tree-items currently in view, by id */
        this.inView = {};
        this.searchUpdateHandler = (event) => {
            const input = event.detail;
            this.searchInput = input;
            const lowerCaseInput = input.toLowerCase();
            function getFilteredLayers(layers) {
                const matches = [];
                layers.forEach((layer) => {
                    if (layer.title
                        .toLowerCase()
                        // TODO: fix the root cause of this weird character
                        .replace(/[\u202F\u00A0]/g, " ")
                        .includes(lowerCaseInput) ||
                        !input) {
                        matches.push(Object.assign({}, layer));
                    }
                    else {
                        const subLayers = getFilteredLayers(layer.subLayers);
                        if (subLayers.length) {
                            matches.push(Object.assign({}, layer, { subLayers, expanded: true }));
                        }
                    }
                });
                return matches;
            }
            this.filteredLayers = this.getDisplayLayers(getFilteredLayers(this.layers));
        };
        this.handleLayerSelect = (event) => {
            const node = event.target;
            const inViewSelectedList = node.selectedItems.map((treeItem) => treeItem.getAttribute("id"));
            // Filter out any item that's in view, then spread the current selected tree back in
            const outOfViewSelectedList = Object.keys(this.selectedLayerIdTracker.idMap).filter((layerId) => !this.inView[layerId]);
            const newSelectedLayerCount = inViewSelectedList.length + outOfViewSelectedList.length;
            const newSelectedIdMap = {};
            inViewSelectedList.forEach((layerId) => (newSelectedIdMap[layerId] = true));
            outOfViewSelectedList.forEach((layerId) => (newSelectedIdMap[layerId] = true));
            const newTracker = {
                count: newSelectedLayerCount,
                idMap: newSelectedIdMap
            };
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayerIdTracker = newTracker;
            this.selectedLayerIdTracker = newTracker;
            this.noLayersSelected = this.noLayersSelected ? newSelectedLayerCount <= 0 : false;
        };
        this.getDisplayLayers = (layers = this.layers, displayLayers = []) => {
            let acc = 0;
            for (const layer of layers) {
                if (acc >= SOFT_CAP) {
                    this.usePro = true;
                    const selected = this.isLayerSelected(layer);
                    if (selected || this.containsSelected(layer)) {
                        displayLayers.push(layer);
                    }
                }
                else {
                    acc++;
                    if (layer.subLayers.length > 0) {
                        const subLayerCount = this.countSublayers(layer);
                        if (subLayerCount >= MAX_LAYER_LIMIT) {
                            // we should not display any sublayers if there are a total of > 10,000
                            displayLayers.push(Object.assign(Object.assign({}, layer), { subLayers: [] }));
                        }
                        else {
                            acc += subLayerCount;
                            displayLayers.push(layer);
                        }
                    }
                    else {
                        displayLayers.push(layer);
                    }
                }
            }
            displayLayers.sort((layer1, layer2) => (layer1.title > layer2.title ? 1 : -1));
            return displayLayers;
        };
        this.countSublayers = (layer) => {
            // Exit if no sublayers found
            if (layer.subLayers.length <= 0) {
                return 0;
            }
            // Otherwise, accumulate the sublayers, then count its sublayers
            let numSubLayer = layer.subLayers.length;
            layer.subLayers.forEach((sublayer) => {
                numSubLayer += this.countSublayers(sublayer);
            });
            return numSubLayer;
        };
        this.renderTree = (layer) => {
            var _a;
            const id = layer.id;
            const expanded = layer.expanded || false;
            const selected = this.isLayerSelected(layer);
            const containsSelected = this.containsSelected(layer);
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { key: id, id: id, selected: selected || layer.visible, expanded: (containsSelected && !selected) || expanded, ref: () => (this.inView[id] = true) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, layer.title), ((_a = layer.subLayers) === null || _a === void 0 ? void 0 : _a.length) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: TreeSelectionMode.Ancestors, slot: "children" }, layer.subLayers.map(this.renderTree))) : null));
        };
        this.managedFocus = true;
        this.layers = [];
        this.filteredLayers = [];
        this.searchInput = "";
        this.selectedLayerIdTracker = {
            // Transform selectedLayerMap into array to get the length would kill off performance
            count: 0,
            idMap: {}
        };
        this.usePro = undefined;
        this.noLayersSelected = false;
        this.allLayersSelected = undefined;
    }
    async componentWillLoad() {
        var _a, _b;
        const i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        this.i18n = i18n.bulkLayerSelect;
        if (this.isAddToMapTerminalPage()) {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap ? "useAsBaseMap" : "addToMap";
        }
        const { layers, selectedLayerIdTracker } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        this.layers = !!layers && ((_a = layers[0]) === null || _a === void 0 ? void 0 : _a.id) ? layers : this.addIds(layers);
        this.filteredLayers = this.getDisplayLayers();
        this.selectedLayerIdTracker = {
            count: (_b = selectedLayerIdTracker === null || selectedLayerIdTracker === void 0 ? void 0 : selectedLayerIdTracker.count) !== null && _b !== void 0 ? _b : 0,
            idMap: selectedLayerIdTracker ? Object.assign({}, selectedLayerIdTracker.idMap) : {}
        };
    }
    onTransitionComplete() {
        var _a;
        (_a = this.layerSearchRef) === null || _a === void 0 ? void 0 : _a.focusMainInput();
    }
    handleNext() {
        if (this.selectedLayerIdTracker.count === 0) {
            this.noLayersSelected = true;
        }
        else {
            // Set only the selected layers as final output
            const layers = this.setVisibility(this.layers)
                .filter((layer) => layer.visible)
                .map((layer) => {
                const { name, title, queryable, subLayers } = layer;
                return { name, title, queryable, subLayers };
            });
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.layers = layers;
            // Done if direct add
            if (this.isAddToMapTerminalPage()) {
                this.workflowComplete.emit({
                    type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type,
                    url: encodeURI(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url),
                    customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters,
                    layers,
                    addAsBasemap: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap
                });
            }
            else {
                this.newItemUpdatePage.emit("itemProperties");
            }
        }
    }
    isAddToMapTerminalPage() {
        return _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
    }
    isLayerSelected(layer) {
        return !!this.selectedLayerIdTracker.idMap[layer.id];
    }
    /** remove ID and set visibility prior to commiting to store */
    setVisibility(layers) {
        return layers.map((layer) => {
            layer.visible = this.isLayerSelected(layer);
            if (layer.subLayers) {
                layer.subLayers = this.setVisibility(layer.subLayers);
            }
            return layer;
        });
    }
    /** Add unique ids to each layer if not previously set */
    addIds(layers) {
        return layers.map((layer) => {
            if (layer.subLayers) {
                layer.subLayers = this.addIds(layer.subLayers);
            }
            layer.id = (0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_20__.g)();
            // Set visible to false by default
            layer.visible = false;
            return layer;
        });
    }
    containsSelected(layer) {
        var _a;
        return (_a = layer.subLayers) === null || _a === void 0 ? void 0 : _a.some((subLayer) => {
            const selected = this.isLayerSelected(layer);
            if (subLayer.subLayers) {
                const containsDeepSelected = this.containsSelected(subLayer);
                return selected || containsDeepSelected;
            }
            return selected;
        });
    }
    handleSelectAll() {
        const newSelectedLayerIdMap = {};
        let newSelectedLayerCount = 0;
        const selectAll = (layers) => {
            layers.forEach((layer) => {
                if (!newSelectedLayerIdMap[layer.id]) {
                    newSelectedLayerCount += 1;
                }
                newSelectedLayerIdMap[layer.id] = true;
                if (layer.subLayers) {
                    selectAll(layer.subLayers);
                }
            });
        };
        if (!this.allLayersSelected) {
            selectAll(this.layers);
            this.allLayersSelected = true;
        }
        const newTracker = {
            count: newSelectedLayerCount,
            idMap: newSelectedLayerIdMap
        };
        this.selectedLayerIdTracker = newTracker;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayerIdTracker = newTracker;
    }
    checkSelectionStatus(layers) {
        return layers.every((layer) => {
            const selected = this.isLayerSelected(layer);
            if (layer.subLayers) {
                const containsSelected = this.checkSelectionStatus(layer.subLayers);
                return selected && containsSelected;
            }
            else {
                return selected;
            }
        });
    }
    render() {
        this.inView = {};
        const { i18n, usePro, searchUpdateHandler, handleLayerSelect, renderTree, handleSelectAll, filteredLayers, noLayersSelected } = this;
        this.allLayersSelected = this.checkSelectionStatus(this.filteredLayers);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "layer-notice", icon: "information", open: usePro, width: "full" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { slot: "message" }, i18n.usePro)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectLayers), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-layer-search", { onSearchUpdate: searchUpdateHandler, controls: "layer-select-tree", searchLabel: i18n.layers, ref: (ele) => (this.layerSearchRef = ele) }), filteredLayers.length === 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "layer-not-found-message" }, i18n.noLayersFound)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "layer-select-tree" }, this.searchInput.length >= 1 ? null : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "transparent", class: "select-all", onClick: handleSelectAll.bind(this) }, this.allLayersSelected ? this.i18n.deselectAll : i18n.selectAll)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { onCalciteTreeSelect: handleLayerSelect, selectionMode: TreeSelectionMode.Ancestors }, filteredLayers.map(renderTree)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: noLayersSelected, heading: i18n.errorTitle, description: i18n.noLayersSelected })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesBulkLayerSelect.style = arcgisNewItemPagesBulkLayerSelectCss;

const arcgisNewItemPagesCloudCss = ".screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.table{margin:0px;display:flex;flex-direction:column;border-style:none;min-height:35rem}.table__body{margin:0px;flex:1 1 0%;border-style:none;padding:0px;outline:2px solid transparent;outline-offset:2px}.table__body--center{display:flex;align-items:center;justify-items:center}.input{margin-bottom:1rem;display:block;width:100%}.select{margin-inline-start:0.5rem;min-width:10rem}.files{list-style-type:none;padding:0px;margin:0 -0.5rem}.files__item{position:relative;width:100%}.files__item:before{position:absolute;bottom:0px;display:block;content:\"\";right:0.5rem;left:0.5rem;border-top:1px solid var(--calcite-color-border-3);transition:all 150ms ease-in-out;z-index:2}.files__item:hover:before,.files__item:focus-within:before{border-top-color:#009af2}.files__item--active:before{border-top-color:transparent}.file{margin:0px;box-sizing:border-box;display:flex;width:100%;cursor:pointer;align-items:center;border-radius:0;padding-top:0.75rem;padding-bottom:0.75rem;padding-left:0.5rem;padding-right:0.5rem;font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-2);background-color:white;transition:all 150ms ease-in-out;outline:1px solid transparent;outline-offset:-1px;font-family:inherit;border:none;text-align:initial}.files__item--active .file{background-color:rgba(0, 121, 193, 0.04);outline-color:#009af2}.file__icon{color:var(--calcite-color-brand);flex:0}.file__title{flex:1 1 0%;padding-left:0.75rem;padding-right:0.75rem;font-size:0.875rem;font-weight:500}.file__type{width:30%;flex:0 1 auto}.file__size{text-align:inline-end;width:6rem;flex:0 1 auto}.no-results{display:block;width:100%;text-align:center}.next{margin:0px;display:block}.error{position:absolute;bottom:1rem;right:1rem;inset-inline-end:1rem;z-index:2}";

const ArcgisNewItemPagesCloud = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.updateFilter = () => {
            this.searching = true;
            const option = this.select.querySelector("calcite-option[selected]");
            this.filter = option.value;
            this.search();
        };
        this.debouncedInput = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.d)((searchTerm) => {
            this.searching = true;
            this.searchTerm = searchTerm;
            this.search();
        }, 400);
        this.managedFocus = true;
        this.loading = true;
        this.loadingText = "";
        this.searching = undefined;
        this.files = [];
        this.moreResults = undefined;
        this.searchTerm = "";
        this.filter = "csv";
        this.selected = undefined;
        this.error = undefined;
        this.i18n = undefined;
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.cloud;
        const current = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProvider;
        this.loadingText = this.i18n[current];
        this.provider = (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__.g)(current);
    }
    async componentDidLoad() {
        var _a;
        try {
            await this.provider.connect();
            await this.search();
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(200);
            (_a = this.mainInputRef) === null || _a === void 0 ? void 0 : _a.setFocus();
            if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" && !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.existingItem) {
                // Sometimes when we go back, an item has already been created so we need to clean it up
                // For now, it only happens in MV
                // No need to await this, can be done in the background
                this.removeExistingFile();
            }
        }
        catch (error) {
            this.parseError(error);
        }
        this.loading = false;
    }
    async navigateToNextPage() {
        if (this.selected) {
            const { title, fileName, extension } = (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.a)(this.selected.name);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataUrl = this.selected.downloadUrl;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = extension;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProviderResource = {
                cloudProvider: (0,_index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__.a)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProvider),
                id: this.selected.id,
                mimeType: this.selected.mimeType,
                cloudDriveFileName: this.selected.name,
                cloudFileType: this.filter
            };
            // In case the user goes back to the file select page
            //  and select a different file
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields = undefined;
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title;
            const possibleItemTypes = (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.f)(extension);
            if (this.selected.mimeType === "googlesheets") {
                await this.removeExistingFile();
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = "Microsoft Excel";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = "xls";
                const nextStep = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish === false ? "itemProperties" : "publishSelect";
                this.newItemUpdatePage.emit(nextStep);
            }
            else if (possibleItemTypes.length === 1) {
                await this.removeExistingFile();
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = possibleItemTypes[0].type;
                const nextItemStep = possibleItemTypes[0].nextStep;
                const nextStep = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish === false && nextItemStep === "publishSelect"
                    ? "itemProperties"
                    : nextItemStep;
                this.newItemUpdatePage.emit(nextStep);
            }
            else if (extension === "zip") {
                this.newItemUpdatePage.emit("zipSelect");
            }
        }
        else {
            this.error = {
                title: this.i18n.errorTitle,
                message: this.i18n.errorMessage
            };
        }
    }
    async removeExistingFile() {
        const id = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id;
        if (id) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = null;
            await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(id, { permanentDelete: true });
        }
    }
    async search(next) {
        this.moreResults = false;
        this.error = null;
        const result = await this.provider.search({
            searchText: this.searchTerm,
            dropdownFilter: this.filter,
            next
        });
        if (next) {
            this.files = [...this.files, ...result.files];
        }
        else {
            this.files = [...result.files];
        }
        this.moreResults = result.next;
        this.selected = null;
        this.searching = false;
    }
    getFilterOptions() {
        const provider = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProvider;
        const filters = ["csv", "excel", "zip", "geojson"];
        if (provider === "google drive") {
            filters.push("googlesheets");
        }
        return filters;
    }
    renderFiles() {
        const { files, selected, i18n, moreResults } = this;
        if (!(files === null || files === void 0 ? void 0 : files.length)) {
            return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "no-results" }, i18n.noResults);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, !this.error && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("ul", { class: "files" }, files.map((file) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("li", { class: {
                files__item: true,
                "files__item--active": file.id === (selected === null || selected === void 0 ? void 0 : selected.id)
            }, key: file.id }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("label", { class: "file", htmlFor: `input-${file.id}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: _index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__.c[file.mimeType] || "file-text", scale: "s", class: "file__icon" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { type: "radio", id: `input-${file.id}`, name: "file", value: file.id, checked: (selected === null || selected === void 0 ? void 0 : selected.id) === file.id, onChange: () => {
                this.selected = file;
                this.error = null;
            }, class: "screen-readers-only" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__title" }, file.name), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__type", "aria-hidden": "true" }, _index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__.b[file.mimeType] || i18n.file), file.size && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "file__size", "aria-hidden": "true" }, (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_11__.f)(file.size))))))))), moreResults && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "icon-start": "plus", class: "next", appearance: "transparent", onClick: () => this.search(true) }, i18n.viewMore))));
    }
    parseError(e) {
        if (e === "popupBlocked") {
            this.error = this.i18n.error.popup;
        }
        else {
            this.error = this.i18n.error.generic;
        }
    }
    render() {
        const { loading, loadingText, files, i18n, filter, searching, error } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, loading && !files.length ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: true, text: loadingText, type: "indeterminate" })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "table" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { type: "search", icon: "search", class: "input", onCalciteInputInput: (e) => {
                this.debouncedInput(e.target.value);
            }, label: i18n.searchFiles, ref: (ele) => (this.mainInputRef = ele) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: i18n.filterFileType, ref: (el) => (this.select = el), onCalciteSelectChange: this.updateFilter, slot: "action", class: "select" }, this.getFilterOptions().map((value) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: filter === value, value: value, label: (_a = i18n.fileType[value]) !== null && _a !== void 0 ? _a : _index_0a84b068_js__WEBPACK_IMPORTED_MODULE_22__.b[value] }));
        }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("fieldset", { class: {
                table__body: true,
                "table__body--center": searching || !files.length
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("legend", { class: "screen-readers-only" }, i18n.selectAFile), this.searching ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "loader" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: true, text: i18n.loadingFiles }))) : (this.renderFiles())))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.message, active: !!error, onAlertDismiss: () => {
                this.error = null;
            } })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesCloud.style = arcgisNewItemPagesCloudCss;

const arcgisNewItemPagesFileFieldsCss = ".fields-container{display:flex;height:100%;flex-direction:column}.field-table{margin-bottom:1.5rem;display:flex;flex-direction:column;min-height:15rem}.search-container{display:flex;width:100%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.field-search{margin-inline-end:8px;width:75%}.field-select{width:25%}.fields-scroll-container{flex:1 1 auto;overflow-y:auto;transform:translateZ(0)}.header-row{display:flex;align-content:flex-start;justify-content:center;gap:0.25rem;padding:0.25rem;font-size:0.875rem;color:var(--calcite-color-text-1)}.header-cell{width:100%}.hide{display:none}.chip-container{margin-top:1rem;margin-bottom:1rem}.chip{font-weight:700}.clear-selection{margin-left:0.75rem;margin-right:0.75rem;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-width:0px;border-style:none;padding:0px;font-family:Avenir Next, Avenir, Helvetica Neue, sans-serif;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-2);background:transparent}.clear-selection:hover{cursor:pointer;text-decoration-line:underline}.not-visible{visibility:hidden;height:0px}.description{margin-bottom:1rem}";

const ArcgisNewItemPagesFileFields = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        // Telemetry: gather info about which fields have received user input
        this.fieldsSearched = false;
        this.fieldsModified = {};
        this.addDirectToMap = false;
        this.handleTimezoneChange = (event) => {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.timezone = event.detail;
        };
        this.updateModifiedFields = (detail) => {
            const { name, key, modified } = detail;
            // If no existing entry, create one with the corresponding property's modified flag set, update otherwise
            if (!this.fieldsModified[name]) {
                this.fieldsModified[name] = {
                    type: key === "type" && modified ? 1 : 0,
                    alias: key === "alias" && modified ? 1 : 0
                };
            }
            else {
                this.fieldsModified[name][key] = modified ? 1 : 0;
            }
        };
        this.handleFieldTypeFilter = (ev) => {
            this.selectedFieldTypeFilter = ev.target.selectedOption.value;
        };
        this.handleSearchChange = (ev) => {
            // Telemetry: Flag if the user attempted to search
            this.fieldsSearched = true;
            this.searchTerm = ev.target.value;
        };
        this.getFilteredFields = () => {
            this.filteredFields = this.fields.reduce((filteredFields, field) => {
                if ((!this.searchTerm ||
                    field.name.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1 ||
                    field.alias.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1) &&
                    (this.selectedFieldTypeFilter === "default" ||
                        this.selectedFieldTypeFilter === field.type)) {
                    filteredFields[field.name] = field;
                }
                return filteredFields;
            }, {});
        };
        this.handleSelectAllToggle = () => {
            this.fields = this.fields.map((field) => {
                if (!!this.filteredFields[field.name]) {
                    return Object.assign(Object.assign({}, field), { selected: !this.allSelected });
                }
                return field;
            });
        };
        this.clearSelection = () => {
            this.fields = this.fields.map((field) => (Object.assign(Object.assign({}, field), { selected: false })));
        };
        // Telemetry: Log changes user made to fields
        this.logCSVFieldChanges = (fields) => {
            // TODO: Refactor fields count to use mapreduce
            const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
            const modifiedFieldsCount = { type: 0, alias: 0 };
            const totalFieldsCount = this.fields.length;
            const selectedFieldsCount = Object.keys(fields).length;
            for (const field in this.fieldsModified) {
                modifiedFieldsCount.type += this.fieldsModified[field].type;
                modifiedFieldsCount.alias += this.fieldsModified[field].alias;
            }
            const payload = {
                eventType: "other",
                pageName: "my content",
                category: "new item csv time zone and fields",
                details: this.fieldsSearched ? "fields searched" : "no fields searched",
                label: this.initialTimezone === _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.timezone ? "default timezone" : "timezone changed",
                count: totalFieldsCount,
                number: totalFieldsCount - selectedFieldsCount,
                size: modifiedFieldsCount.alias,
                position: modifiedFieldsCount.type
            };
            telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
        };
        this.selectedFieldTypeFilter = "default";
        this.fields = undefined;
        this.filteredFields = undefined;
        this.searchTerm = undefined;
        this.i18n = undefined;
        this.allSelected = undefined;
    }
    handleNext() {
        const fields = this.fields.reduce((fieldMap, field) => {
            var _a, _b;
            if (field.selected) {
                delete field.selected;
                // #4336 - if user changed to string, add a larger length to avoid publish errors
                if (field.type === "esriFieldTypeString" && ((_b = (_a = this.fieldsModified) === null || _a === void 0 ? void 0 : _a[field.name]) === null || _b === void 0 ? void 0 : _b.type)) {
                    field.length = 4000;
                }
                fieldMap[field.name] = field;
            }
            return fieldMap;
        }, {});
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields = fields;
        this.logCSVFieldChanges(fields);
        if (this.isAddToMapTerminalPage()) {
            // TODO: merge this with the same thing in `csv-location-fields`
            this.workflowComplete.emit({
                type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type,
                url: encodeURI(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url),
                customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters,
                results: {
                    analyzeResults: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.analyzeResults,
                    fields: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields
                }
            });
        }
        else if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type === "GeoJson") {
            this.newItemUpdatePage.emit("itemProperties");
        }
        else {
            this.newItemUpdatePage.emit("csvLocationFields");
        }
    }
    fieldsChanged() {
        this.getFilteredFields();
    }
    isAddToMapTerminalPage() {
        const { newItemMode, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        return _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" && newItemMode === "url" && type !== "CSV";
    }
    async componentWillLoad() {
        const i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        this.i18n = i18n.csvFields;
        if (this.isAddToMapTerminalPage()) {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "addToMap";
        }
        const { backupLayerFields } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const fields = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_19__.a)().fields;
        const lookupMap = {};
        fields.forEach((field) => (lookupMap[field.name] = true));
        this.fields = backupLayerFields.map((field) => {
            var _a, _b;
            return (Object.assign(Object.assign({}, ((_b = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields) === null || _a === void 0 ? void 0 : _a[field.name]) !== null && _b !== void 0 ? _b : field)), { selected: !!lookupMap[field.name] }));
        });
        this.getFilteredFields();
        this.initialTimezone = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.timezone;
        this.addDirectToMap = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" && !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing;
    }
    async componentDidLoad() {
        var _a;
        // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/43341
        if (this.scrollContainer && ((_a = navigator === null || navigator === void 0 ? void 0 : navigator.vendor) === null || _a === void 0 ? void 0 : _a.includes("Apple"))) {
            this.scrollContainer.style.overflow = "hidden";
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(100);
            this.scrollContainer.style.overflow = "auto";
        }
    }
    updateField(event) {
        const { name, key, value } = event.detail;
        this.fields = this.fields.map((field) => {
            if (field.name === name) {
                field[key] = value;
                // Telemetry: Track if the incoming key is different than the default value
                this.updateModifiedFields(event.detail);
            }
            return field;
        });
    }
    render() {
        const { i18n, addDirectToMap } = this;
        this.allSelected = Object.keys(this.filteredFields).every((name) => this.filteredFields[name].selected);
        const canHideFields = !addDirectToMap && _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow !== "append";
        const numberSelected = this.fields.filter((field) => field.selected).length;
        const hasDate = this.fields.some((field) => field.type === "esriFieldTypeDate");
        const timezone = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.timezone;
        const rowHeaders = [i18n.fieldName, i18n.displayName, i18n.type];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", { class: "fields-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { class: "description", header: i18n.fieldTitle, content: i18n[!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing ? "fieldNoHostedDescription" : "fieldDescription"] }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "search-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "field-search" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: this.handleSearchChange, type: "search", placeholder: i18n.searchFields }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, i18n.searchFields)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: i18n.fieldType, onCalciteSelectChange: this.handleFieldTypeFilter, class: "field-select", width: "half" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedFieldTypeFilter === "default", value: "default" }, i18n.allTypes), Object.keys(i18n.fieldTypes).map((type) => {
            const fieldType = i18n.fieldTypes[type];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedFieldTypeFilter === type, value: type }, fieldType));
        }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "field-table", role: "table" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `chip-container ${numberSelected === 0 || canHideFields ? "" : "not-visible"}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-chip", { class: "chip", value: numberSelected }, numberSelected, " ", i18n.selected), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { onClick: this.clearSelection, class: "clear-selection" }, i18n.clearSelection)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: `header-row ${Object.keys(this.filteredFields).length === 0 ? "hide" : ""}`, role: "row" }, rowHeaders.map((column, index) => {
            if (index === 0 && canHideFields) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", class: "header-cell", role: "columnheader", "aria-sort": "none" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { checked: this.allSelected, onCalciteCheckboxChange: this.handleSelectAllToggle }), column));
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "header-cell", role: "columnheader", "aria-sort": "none" }, column));
        })), Object.keys(this.filteredFields).length > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "fields-scroll-container", ref: (el) => {
                this.scrollContainer = el;
            } }, Object.keys(this.filteredFields).map((key) => {
            var _a, _b;
            const field = this.filteredFields[key];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-csv-field", { detectedType: (_b = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === null || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a === void 0 ? void 0 : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.backupLayerFields) === null || _a === void 0 ? void 0 : _a.find((backupField) => backupField.name === field.name)) === null || _b === void 0 ? void 0 : _b.type, onFieldChange: this.updateField.bind(this), field: field, fieldTypes: i18n.fieldTypes, defaultChecked: field.selected, canHideFields: canHideFields, displayNameLabel: i18n.displayNameLabel.replace("${name}", field.name), typeLabel: i18n.typeLabel.replace("${name}", field.name) }));
        }))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: true, status: "valid" }, i18n.noFields))), hasDate && !addDirectToMap && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-timezone-dropdown", { onTimezoneChange: this.handleTimezoneChange, defaultTimezone: timezone }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "fields": ["fieldsChanged"],
        "selectedFieldTypeFilter": ["fieldsChanged"],
        "searchTerm": ["fieldsChanged"]
    }; }
};
ArcgisNewItemPagesFileFields.style = arcgisNewItemPagesFileFieldsCss;

const arcgisNewItemPagesItemPropertiesCss = ".layer-description.sc-arcgis-new-item-pages-item-properties{display:block;margin-bottom:0.75rem}.locator__heading.sc-arcgis-new-item-pages-item-properties{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px;margin-bottom:2px}.locator__description.sc-arcgis-new-item-pages-item-properties{margin:0px;margin-bottom:1rem;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-1)}.medium.sc-arcgis-new-item-pages-item-properties{--arcgis-label-font-weight:500}.info-container.sc-arcgis-new-item-pages-item-properties{margin-bottom:1.5rem}";

var __asyncValues = ( false) || function (o) {
    if (!Symbol.asyncIterator)
        throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function (v) { resolve({ value: v, done: d }); }, reject); }
};
const MAX_TITLE_LENGTH = 250;
const ArcgisNewItemPagesItemProperties = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.workflowCancelled = false;
        this.handleRequest = async () => {
            var _a, _b, _c;
            // Don't send request if an error is reported
            if (!(await this.validate())) {
                return;
            }
            const { newItemMode, existingItem, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            const { categories } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i;
            const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
            let addResponse;
            let publishResponse;
            let emptyLayerCreated = newItemMode === "featureLayer";
            const title = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title;
            if ((title === null || title === void 0 ? void 0 : title.length) > MAX_TITLE_LENGTH) {
                _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title.substring(0, MAX_TITLE_LENGTH);
            }
            try {
                // Telemetry: Begin upload tracking workflow
                // TODO: Check if same telemetry events should be used in existing item publish workflows too
                logAddNewItemStart();
                ({ addResponse, publishResponse } =
                    existingItem && newItemMode === "file"
                        ? await this.publishExistingItem()
                        : await this.handleAddItem());
                const responseIds = [addResponse === null || addResponse === void 0 ? void 0 : addResponse.id, publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id].filter((id) => id);
                categories && (await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_23__.u)({ portal, itemIds: responseIds, categories }));
                if (type === "KML") {
                    const { config, portal, api } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
                    await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.p)((_a = addResponse.id) !== null && _a !== void 0 ? _a : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, portal, config.restBaseUrl, config, api);
                }
                if (!this.workflowCancelled) {
                    // Telemetry: Only log telemetry after successful upload
                    logItemPropertiesChanges();
                    logSuccessfulItemCreation();
                    !!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addTileLayerOption && (0,_tile_layer_f0f9ef4b_js__WEBPACK_IMPORTED_MODULE_16__.a)();
                    _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry && (await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.t)(750));
                    let emitPayload;
                    if (this.isAddToMapTerminalPage()) {
                        if (newItemMode === "url") {
                            const payload = Object.assign(Object.assign({ url: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url, customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters, type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, addAsBasemap: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap }, (publishResponse
                                ? { id: publishResponse.id, serviceUrl: publishResponse.serviceUrl }
                                : {})), (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.storeAuth ? { id: addResponse.id } : {}));
                            emitPayload = payload;
                        }
                        else {
                            let payload;
                            if (publishResponse) {
                                payload = {
                                    type: publishResponse.serviceType,
                                    id: publishResponse.id,
                                    jobId: publishResponse.jobId,
                                    serviceUrl: publishResponse.serviceUrl,
                                    results: {
                                        sourceItemInfo: {
                                            id: (_b = addResponse === null || addResponse === void 0 ? void 0 : addResponse.id) !== null && _b !== void 0 ? _b : existingItem === null || existingItem === void 0 ? void 0 : existingItem.id,
                                            type: (_c = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type) !== null && _c !== void 0 ? _c : existingItem === null || existingItem === void 0 ? void 0 : existingItem.type
                                        }
                                    }
                                };
                            }
                            else {
                                payload = Object.assign({ type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, id: addResponse.id }, (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.analyzeResults && _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields
                                    ? {
                                        results: {
                                            analyzeResults: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.analyzeResults,
                                            fields: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields
                                        }
                                    }
                                    : {}));
                            }
                            emitPayload = payload;
                        }
                    }
                    else {
                        emitPayload = Object.assign({
                            // `publishResponse` doesn't for some flows so use this id instead
                            id: addResponse === null || addResponse === void 0 ? void 0 : addResponse.id, item: Object.assign({}, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a), response: addResponse, emptyLayerCreated,
                            newItemMode
                        }, publishResponse);
                    }
                    this.workflowComplete.emit(emitPayload);
                }
                else {
                    (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(publishResponse.id, { permanentDelete: true }));
                    addResponse.id && (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(addResponse.id, { permanentDelete: true }));
                    this.workflowCancel.emit();
                }
                (0,_utils_9b3ffcf7_js__WEBPACK_IMPORTED_MODULE_9__.r)();
            }
            catch (error) {
                if (newItemMode === "featureLayer") {
                    // TODO: refactor this once we refactor the error system in item properties
                    (0,_feature_layer_58e18b03_js__WEBPACK_IMPORTED_MODULE_30__.f)(JSON.stringify(error));
                }
                console.error(error);
                this.error = error;
                this.showLoader(false);
            }
        };
        this.preprocessAddItem = () => {
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileLayerPublishType === "3dTiles") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.typeKeywords = [
                    ..._add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.typeKeywords.filter((typeKeyword) => !_tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_28__.t.includes(typeKeyword)),
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tilesLayer3dTilesLayerType
                ];
            }
        };
        this.itemType = undefined;
        this.error = undefined;
        this.loading = false;
        this.loaderType = "indeterminate";
        this.loaderMessage = undefined;
        this.i18n = undefined;
    }
    async validate() {
        var _a, _b;
        if (!(await this.itemPropertiesFolderRef.saveActiveFolder())) {
            return false;
        }
        const titleError = await ((_a = this.titleRef) === null || _a === void 0 ? void 0 : _a.validateTitle());
        if (titleError) {
            // Title component uses a brief inline error - map the main error handler to the detailed message
            this.error =
                titleError.code === "titleInUseService" ? { code: "serviceNameExists" } : titleError;
            this.titleRef.focusMainInput();
            return false;
        }
        const summaryError = await ((_b = this.summaryRef) === null || _b === void 0 ? void 0 : _b.getErrorMessage());
        if (summaryError) {
            this.error = summaryError;
            return false;
        }
        return true;
    }
    async navigateToNextPage() {
        this.handleRequest();
    }
    async handleError() {
        const { error } = this;
        const errorMessage = typeof error === "string" ? error : error === null || error === void 0 ? void 0 : error.message;
        // 39963: Publishing fails if the service name is taken, but the created item persists
        // Remove the newly created item so the title can be changed without throwing the
        // "file already exists" error on retry
        if ((errorMessage === null || errorMessage === void 0 ? void 0 : errorMessage.includes("Service name")) && !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.existingItem) {
            await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, { permanentDelete: true });
        }
    }
    isAddToMapTerminalPage() {
        return _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
    }
    // Item was already created and only needs an update if it's a large CSV added to MV without publishing
    shouldUpdatePreviouslyCreatedItem() {
        const { type, enablePublishing, file } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        return (mvFlow &&
            type === "CSV" &&
            !enablePublishing &&
            !!file &&
            file.size > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M);
    }
    async componentWillLoad() {
        const addCreateI18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        const i18n = addCreateI18n.itemProperties;
        this.i18n = i18n;
        const { newItemMode } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (this.isAddToMapTerminalPage()) {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "createAndAddToMap";
        }
        else {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = newItemMode === "dataStore" ? "createConnection" : "save";
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.initialFolders = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.folders;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.initialTitle = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title;
        const { enablePublishing, fileName, type, storeAuth } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map") {
            this.descriptionInfo = {
                title: !!fileName
                    ? (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(i18n.howWillAdd, fileName, "fileName")
                    : i18n.howWillAddService,
                content: storeAuth
                    ? i18n.howWillAddSecuredServiceDescription
                    : enablePublishing
                        ? i18n.howWillAddHostedDescription
                        : (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(i18n.howWillAddDescription, type === "GeoJson" ? "GeoJSON" : type, "fileType")
            };
        }
    }
    async handleAddItem() {
        const { file, fileName, newItemMode, type, enablePublishing, serviceInfo, typeKeywords, tags, extent, selectedServiceInfoLayersNames, addFeatureLayerType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        let addResponse;
        let publishResponse;
        this.preprocessAddItem();
        switch (newItemMode) {
            case "file":
                this.showLoader(true, {
                    loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M ? "determinate" : "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["uploading"], fileName, "fileType") // TODO: Type in string should be "fileName", not "fileType"
                });
                if (this.shouldUpdatePreviouslyCreatedItem()) {
                    ({ addResponse } = await this.handleFileUpdate());
                }
                else {
                    ({ addResponse, publishResponse } = await this.handleFileUpload());
                }
                // Workflow was cancelled if no file found in store
                if (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file && !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataUrl) {
                    this.workflowCancelled = true;
                }
                break;
            case "url":
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["adding"], _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url, "fileType")
                });
                if ((type === "CSV" || type === "GeoJson") && enablePublishing) {
                    ({ addResponse, publishResponse } = await this.handleFileUpload());
                }
                else {
                    addResponse = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.h)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api);
                }
                break;
            case "featureLayer":
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["creating"], "feature layer", "fileType")
                });
                addResponse = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.c)({
                    serviceInfo,
                    typeKeywords,
                    tags,
                    extent,
                    selectedServiceInfoLayersNames,
                    addFeatureLayerType
                });
                (0,_feature_layer_58e18b03_js__WEBPACK_IMPORTED_MODULE_30__.a)();
                break;
            case "tileLayer":
            case "sceneLayer":
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["publishing"], newItemMode === "sceneLayer" ? "scene service" : "tile layer", "fileType")
                });
                ({ addResponse, publishResponse } = await this.addTileLayer());
                break;
            case "rasterFunctionTemplate":
                this.showLoader(true, {
                    loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M ? "determinate" : "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["uploading"], fileName, "fileType")
                });
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.file = new File([""], `${_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title}.rft.json`);
                ({ addResponse, publishResponse } = await this.handleFileUpload());
                break;
            case "application":
                this.showLoader(true, {
                    loaderType: (file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M ? "determinate" : "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["adding"], _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, "fileType")
                });
                addResponse = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.b)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config.restBaseUrl, type === "Application"
                    ? { redirect_uris: ["urn:ietf:wg:oauth:2.0:oob"], appType: "multiple" }
                    : undefined);
                break;
            case "dataStore":
                const { addDataStoreType, provider } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["addDataStore"], this.i18n[addDataStoreType === "cloud" ? provider : addDataStoreType], "fileType")
                });
                addResponse = await (0,_data_store_e2ae6a67_js__WEBPACK_IMPORTED_MODULE_24__.a)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.categories, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet);
                break;
            case "developerCredentials":
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["creating"], _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, "fileType")
                });
                addResponse = await this.addDeveloperCredentialApplication();
                break;
            case "create":
            default:
                this.showLoader(true, {
                    loaderType: "indeterminate",
                    loaderMessage: (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n["creating"], _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, "fileType")
                });
                addResponse = await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.b)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a);
                break;
        }
        return { addResponse, publishResponse };
    }
    async publishExistingItem() {
        const { id, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        let addResponse = { success: true, id, folder: null };
        const publishResponse = type === "Image Collection"
            ? await this.publishImageCollection(addResponse)
            : await this.publishService(id);
        await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__.a)(publishResponse);
        // https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/41501
        const typesToUpdateTitle = [
            "Shapefile",
            "File Geodatabase",
            "CSV",
            "Microsoft Excel",
            "GeoJson",
            "GeoPackage",
            "Feature Collection"
        ];
        if (typesToUpdateTitle.includes(type)) {
            ({ addResponse } = await this.handleFileUpdate(publishResponse.id));
        }
        return { addResponse, publishResponse };
    }
    async handleFileUpload() {
        var _a;
        const { type, enablePublishing, cloudProviderResource, geoJSONResource, csvResource } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        let addResponse;
        let publishResponse;
        const isNotCSVOrExcel = type !== "CSV" && type !== "Microsoft Excel";
        if (enablePublishing) {
            if (type === "Image Collection") {
                addResponse = await this.addFile();
                publishResponse = await this.publishImageCollection(addResponse);
            }
            else {
                // For CSV and XLXS from cloud and large csv, we already add item
                if (!isNotCSVOrExcel && (cloudProviderResource || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id)) {
                    // We need to make change to the original item title before publishing
                    //  because publish always use the item title as the service name
                    await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.u)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.f)({
                        title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title,
                        tags: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags,
                        snippet: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet
                    }));
                    ({ addResponse, publishResponse } = await this.publishExistingItem());
                }
                else {
                    addResponse = await this.addFile({ title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title });
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = addResponse.id;
                    publishResponse = await this.publishService(addResponse.id);
                }
                await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__.a)(publishResponse);
            }
            this.updateFolder(publishResponse);
            if (cloudProviderResource || geoJSONResource || csvResource) {
                if ((cloudProviderResource === null || cloudProviderResource === void 0 ? void 0 : cloudProviderResource.mimeType) === "zip") {
                    cloudProviderResource.zipItemType = type;
                }
                try {
                    await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.d)((_a = cloudProviderResource !== null && cloudProviderResource !== void 0 ? cloudProviderResource : geoJSONResource) !== null && _a !== void 0 ? _a : csvResource, publishResponse.id);
                }
                catch (_b) {
                    // no-op
                }
            }
        }
        else {
            if (cloudProviderResource && !isNotCSVOrExcel && _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
                // Already add, just need to update the title
                addResponse = await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.u)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.f)({
                    title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title,
                    tags: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags,
                    snippet: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet
                }));
            }
            else {
                addResponse = await this.addFile({ title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title });
            }
        }
        return { addResponse, publishResponse };
    }
    async handleFileUpdate(id) {
        this.updateLoader("indeterminate", this.i18n.uploading.replace("${type}", _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName));
        const addResponse = await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.u)(id !== null && id !== void 0 ? id : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.f)({
            title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title,
            tags: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags,
            snippet: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet
        }));
        this.updateFolder(addResponse);
        return { addResponse };
    }
    async addDeveloperCredentialApplication() {
        const { developerCredentialsRedirectUrls, applicationEnvironment, developerCredentialsType, apiKeyReferrerUrls, developerPrivileges } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        return (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.b)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a, (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.g)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal), developerCredentialsType === "oauth"
            ? { appType: applicationEnvironment, redirect_uris: developerCredentialsRedirectUrls }
            : {
                appType: "apikey",
                redirect_uris: developerCredentialsRedirectUrls,
                httpReferrers: apiKeyReferrerUrls,
                privileges: developerPrivileges
            });
    }
    async addFile(props) {
        const response = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.e)(props);
        this.updateLoader("indeterminate", this.i18n.checkingStatus);
        await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__.c)(response);
        return response;
    }
    async updateFolder(publishResponse) {
        const { id, file, cloudProviderResource } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const folder = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.folder;
        // Multipart and pre-added items need to be moved after creation
        if ((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M || cloudProviderResource) {
            const moveIds = [];
            id && moveIds.push(id);
            (publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id) && moveIds.push(publishResponse === null || publishResponse === void 0 ? void 0 : publishResponse.id);
            folder.id !== folder.username && (await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.m)(moveIds.join(","), folder.id));
        }
    }
    async publishService(itemId) {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        this.showLoader(true, {
            loaderType: "indeterminate",
            loaderMessage: this.i18n.publishingService
        });
        const { result: publishResponse, error } = await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__.p)({
            itemId,
            user: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user,
            extension: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension,
            type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type,
            title: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title
        });
        if (error) {
            throw error; // Already standardized so we can freely throw
        }
        if (!((_a = publishResponse.services) === null || _a === void 0 ? void 0 : _a.length) || !((_c = (_b = publishResponse.services) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.success) === false) {
            throw this.i18n.errorPublishing;
        }
        else if ((_e = (_d = publishResponse.services[0]) === null || _d === void 0 ? void 0 : _d.error) === null || _e === void 0 ? void 0 : _e.message) {
            throw (_g = (_f = publishResponse.services[0]) === null || _f === void 0 ? void 0 : _f.error) === null || _g === void 0 ? void 0 : _g.message;
        }
        const service = (_h = publishResponse.services) === null || _h === void 0 ? void 0 : _h[0];
        return {
            id: service === null || service === void 0 ? void 0 : service.serviceItemId,
            jobId: service === null || service === void 0 ? void 0 : service.jobId,
            serviceType: service === null || service === void 0 ? void 0 : service.type,
            serviceUrl: service === null || service === void 0 ? void 0 : service.serviceurl
        };
    }
    async publishImageCollection(addItemResponse) {
        var _a, e_1, _b, _c;
        const { config, user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        this.showLoader(true, {
            loaderType: "indeterminate",
            loaderMessage: this.i18n.publishingService
        });
        const imageCollectionGenerator = (0,_image_collection_5b662b80_js__WEBPACK_IMPORTED_MODULE_25__.c)(addItemResponse, _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title, { config, user, portal });
        try {
            for (var _d = true, imageCollectionGenerator_1 = __asyncValues(imageCollectionGenerator), imageCollectionGenerator_1_1; imageCollectionGenerator_1_1 = await imageCollectionGenerator_1.next(), _a = imageCollectionGenerator_1_1.done, !_a; _d = true) {
                _c = imageCollectionGenerator_1_1.value;
                _d = false;
                const status = _c;
                if (typeof status === "string") {
                    this.updateLoader("indeterminate", this.i18n[status]);
                }
                else {
                    return {
                        id: status.serviceItemId,
                        jobId: null,
                        serviceType: status.type,
                        serviceUrl: status.serviceurl
                    };
                }
            }
        }
        catch (e_1_1) {
            e_1 = { error: e_1_1 };
        }
        finally {
            try {
                if (!_d && !_a && (_b = imageCollectionGenerator_1.return))
                    await _b.call(imageCollectionGenerator_1);
            }
            finally {
                if (e_1)
                    throw e_1.error;
            }
        }
    }
    async addTileLayer() {
        const { dataset, dataStoreId, serverId } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { folder, categories } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i;
        let publishResponse;
        if (dataset) {
            const { result, error } = await (0,_data_store_e2ae6a67_js__WEBPACK_IMPORTED_MODULE_24__.p)({
                type: dataset.type,
                serviceName: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title,
                pathInCachedStore: dataset.path,
                cacheStoreId: dataStoreId,
                serverId,
                folder,
                description: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet,
                tags: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags
            }, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
            if (error) {
                throw error;
            }
            if (result) {
                publishResponse = {
                    id: result.serviceItemId,
                    serviceType: result.type,
                    serviceUrl: result.serviceUrl
                };
            }
        }
        else {
            if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileLayerPublishType !== "3dTiles") {
                // TODO: finish the 3D Tiles publish workflow
                const { tileLayerPublishContent, tileLayerPublishType, tileLayerData } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
                const { title, tags, snippet } = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i;
                publishResponse = await (0,_tile_layer_8a7b93de_js__WEBPACK_IMPORTED_MODULE_27__.p)(tileLayerPublishContent, {
                    user: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user,
                    publishType: tileLayerPublishType,
                    folder,
                    title,
                    tags,
                    categories,
                    snippet
                }, tileLayerData);
            }
        }
        const addResponse = { success: true, id: publishResponse.id, folder: null };
        return { addResponse, publishResponse };
    }
    showLoader(show, update) {
        if (update) {
            this.updateLoader(update.loaderType, update.loaderMessage);
        }
        if (show) {
            this.newItemToggleNavigationEnabled.emit(false);
            this.loading = true;
        }
        else {
            this.newItemToggleNavigationEnabled.emit(true);
            this.loading = false;
        }
    }
    updateLoader(loaderType, loaderMessage) {
        this.loaderType = loaderType;
        this.loaderMessage = loaderMessage;
    }
    parseError() {
        var _a, _b, _c, _d, _e, _f;
        const { i18n, error } = this;
        if (typeof error !== "string" && (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.g)(error)) {
            const code = error.code;
            let linkInfo;
            if (code === "itemExists" || code === "fileExists") {
                linkInfo = {
                    link: error.itemUrl,
                    text: i18n.alreadyExists.linkText
                };
            }
            let title = i18n.errorTitle;
            let description = error.translatedMessage;
            if (!description && code === "fileExists") {
                title = i18n.alreadyExists.title;
                description = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(i18n.alreadyExists.description, this.fileName, "fileName");
            }
            if (code === "failToPublishFromDataStore") {
                const { newItemMode } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
                const baseI18n = i18n.failDatastorePublish;
                title = baseI18n.title;
                description = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(baseI18n.description, newItemMode === "sceneLayer" || newItemMode === "tileLayer" ? baseI18n[newItemMode] : "", "fileType");
            }
            if (code === "serviceNameExists") {
                ({ title, description } = i18n.serviceNameExists);
            }
            return { title, description, linkInfo };
        }
        if ((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.j)(error)) {
            const errorDetail = error.details[0];
            if (errorDetail === null || errorDetail === void 0 ? void 0 : errorDetail.includes("must be uploaded directly to an ArcGIS Server site")) {
                const errorInfo = i18n.arcgisServerUpload;
                return { title: errorInfo.title, description: errorInfo.description };
            }
            else if (errorDetail.includes("spatial reference must be either a geographic or projected coordinate system")) {
                const errorInfo = i18n.invalidSpatialRef;
                return { title: errorInfo.title, description: errorInfo.description };
            }
        }
        const errorMessage = (typeof error === "string" ? error : error === null || error === void 0 ? void 0 : error.message) ||
            (error === null || error === void 0 ? void 0 : error.statusMessage) ||
            i18n.errorDescription;
        if (!errorMessage) {
            return { title: i18n.errorTitle, description: i18n.errorDescription };
        }
        const { fileName, file } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const lowercaseErrorMessage = errorMessage.toLowerCase();
        switch (true) {
            case (_a = lowercaseErrorMessage.includes) === null || _a === void 0 ? void 0 : _a.call(lowercaseErrorMessage, "already exists"):
                if (lowercaseErrorMessage.includes("file") || lowercaseErrorMessage.includes("item")) {
                    return {
                        title: i18n.alreadyExists.title,
                        description: i18n.alreadyExists.description.replace("${fileName}", fileName || (file === null || file === void 0 ? void 0 : file.name))
                    };
                }
                if (errorMessage.includes("Service name")) {
                    return i18n.serviceNameExists;
                }
                break;
            case (_b = errorMessage.includes) === null || _b === void 0 ? void 0 : _b.call(errorMessage, "GeoJson doesn't have 'type'"):
                return i18n.invalidGeoJSON;
            case (_c = errorMessage.includes) === null || _c === void 0 ? void 0 : _c.call(errorMessage, "GeoJson file is not a valid json"):
                return i18n.invalidJSON;
            case (_d = errorMessage.includes) === null || _d === void 0 ? void 0 : _d.call(errorMessage, "Invalid Shapefile"):
                return {
                    title: i18n.invalidShapefile.title,
                    description: i18n.invalidShapefile.description
                };
            case (_e = errorMessage.includes) === null || _e === void 0 ? void 0 : _e.call(errorMessage, "Invalid File Geodatabase"):
                return i18n.invalidGeodatabase;
            case (_f = errorMessage.includes) === null || _f === void 0 ? void 0 : _f.call(errorMessage, "error publishing"):
                return { title: i18n.errorTitle, description: i18n.errorPublishing };
        }
        return {
            title: i18n.errorTitle,
            description: i18n.errorDescription
        };
    }
    render() {
        const { descriptionInfo, loading } = this;
        const { title, description, linkInfo } = this.parseError();
        const { newItemMode, type, enablePublishing } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const isPublishedServiceDefinition = type === "Service Definition" && enablePublishing;
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": loading } }, mvFlow && newItemMode === "url" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null))), descriptionInfo && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { class: "layer-description", header: descriptionInfo.title, content: descriptionInfo.content, scale: "s", contentScale: "m" }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, value: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.uploadProgress, active: this.loading, text: this.loaderMessage }), ["file", "url", "dataStore"].includes(newItemMode) && !mvFlow && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "info-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null))), type === "Geocoding Service" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h5", { class: "locator__heading" }, this.i18n.item), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "locator__description" }, _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.createLayersList[newItemMode === "url" ? "locatorHeading" : "locatorViewHeading"]))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-properties", null, !isPublishedServiceDefinition && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-title-input", { class: "medium", currentFolder: _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.folder, type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, enablePublishing: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing, update: this.shouldUpdatePreviouslyCreatedItem(), ref: (ele) => (this.titleRef = ele), onArcgisTitleInputChange: () => {
                this.error = null;
            } })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-folder-picker", { class: "medium", ref: (ele) => (this.itemPropertiesFolderRef = ele), onArcgisFolderPickerLoad: ({ detail }) => {
                var _a;
                (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.initialFolders) !== null && _a !== void 0 ? _a : (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.initialFolders = detail);
            } }), !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(user) && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-categories-picker", { class: "medium" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tags-picker", { class: "medium" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-summary-input", { class: "medium", ref: (ele) => (this.summaryRef = ele) }), type === "Notebook" && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-notebook-runtime-select", { class: "medium" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: title, description: description, active: !!this.error, link: { href: linkInfo === null || linkInfo === void 0 ? void 0 : linkInfo.link, title: linkInfo === null || linkInfo === void 0 ? void 0 : linkInfo.text }, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "error": ["handleError"]
    }; }
};
ArcgisNewItemPagesItemProperties.style = arcgisNewItemPagesItemPropertiesCss;

const arcgisNewItemPagesPublishSelectCss = ".label{margin-bottom:1rem;display:block;padding-top:1rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px}.label--leader{margin-top:0.75rem;margin-bottom:0.5rem;font-weight:400}.fieldset{margin:0px;border-style:none;padding:0px}.constrain{max-width:360px}.notice--tip{margin-top:1.5rem}";

const ArcgisNewItemPagesPublishSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.canSkipPublishSelect = false;
        this.updateSelectedSheet = async ({ currentTarget }) => {
            // TODO: calcite-select currently sets selectedOption to the innerHTML of the first element instead of its value
            const selected = parseInt(currentTarget.selectedOption.value);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedSheet = isNaN(selected) ? 0 : selected;
            this.newItemToggleNavigationEnabled.emit(false);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields = null;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.analyzeResults = null;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.backupLayerFields = null;
            // For cloud, we also upload the file already at the beginning
            const success = await this.analyze(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.existingItem || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProviderResource ? "item" : "file");
            if (!success) {
                // TODO: should we revert the change?
                return;
            }
            this.newItemToggleNavigationEnabled.emit(true);
        };
        this.deleteCurItem = async () => {
            try {
                if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
                    this.isDeletingOldFile = true;
                    await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.d)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id, { permanentDelete: true });
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = null;
                    this.isDeletingOldFile = false;
                }
            }
            catch (error) {
                console.warn("Delete item failed", error);
            }
        };
        this.selected = "hosted";
        this.loading = undefined;
        this.isDeletingOldFile = undefined;
        this.loaderType = "indeterminate";
        this.alertContent = undefined;
        this.tip = undefined;
        this.loaderMessage = undefined;
        this.publishSelectOption = null;
        this.i18n = undefined;
        this.itemInfoI18N = undefined;
        this.duplicateItemUrl = null;
    }
    async handleNext() {
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileLayerPublishType === "3dTiles") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tilesLayer3dTilesLayerType = this.publishSelectOption.tilesLayer3dTilesLayerType;
        }
        const { customParameters, url, type, newItemMode, file } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const isHosted = this.selected === "hosted";
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing = isHosted;
        if (this.isAddToMapTerminalPage()) {
            this.workflowComplete.emit({
                type,
                url: encodeURI(url),
                customParameters
            });
            return;
        }
        if (newItemMode === "url" && type === "CSV" && mvFlow) {
            // Right now we only support this for csv
            const success = await this.analyze("url");
            if (!success) {
                return;
            }
        }
        else {
            if (this.duplicateItemUrl && isHosted) {
                this.handleError({ code: "itemExists", itemUrl: this.duplicateItemUrl });
                return;
            }
            const simpleHostedTypes = [
                "Json",
                "Tile Package",
                "Vector Tile Package",
                "Service Definition",
                "Scene Package",
                "GeoPackage",
                "3DTiles Package",
                // arcgis-portal-app#40929 and arcgis-portal-app#38119
                "GeoJson"
            ];
            const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
            const payload = {
                eventType: "other",
                pageName: "my content",
                category: "new item add csv file"
            };
            if (simpleHostedTypes.indexOf(type) > -1 ||
                // We still want to analyze even if it's add direct
                (!isHosted && !mvFlow)) {
                if (type === "CSV") {
                    // Log telemetry for non-hosted csv
                    payload.details = "csv only";
                    telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
                }
                this.newItemUpdatePage.emit("itemProperties");
                return;
            }
            if (type === "CSV") {
                const success = await this.analyze(!!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProviderResource ? "cloud" : file ? "file" : "url");
                if (!success) {
                    return;
                }
            }
            // On successful upload, log hosted csv telemetry
            payload.details = "csv and hosted feature layer";
            telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
        }
        this.newItemUpdatePage.emit("fileField");
    }
    async handlePrev(event) {
        event.preventDefault();
        await this.deleteCurItem();
        const { type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (type === "CSV" || type === "Microsoft Excel") {
            // In case the user goes back to the file select page
            //  and select a different file
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedFields = undefined;
        }
        this.newItemPrevPage.emit();
    }
    determineHint(file) {
        if (!(0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.i)(file.size)) {
            return;
        }
        const { i18n } = this;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const linkText = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.common.learnMore;
        let title;
        let link; // TODO: set link url once we have the help id
        let color = "brand";
        if (!user || (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(user)) {
            title = i18n.bigGeoJsonHintPublicAccount;
            color = "danger";
        }
        else if (!(0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, "GeoJson", portal)) {
            title = i18n.bigGeoJsonHintNoPrivilege;
        }
        else {
            title = i18n.bigGeoJsonHint;
        }
        this.alertContent = { title, linkText, link, color };
    }
    shouldDisableNonHosted() {
        const { file, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        return (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" && type === "GeoJson" && file && (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.i)(file.size));
    }
    updateLoader(loaderType, loaderMessage) {
        this.loaderType = loaderType;
        this.loaderMessage = loaderMessage;
    }
    async connectedCallback() {
        var _a, _b, _c;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.publishSelect;
        this.itemInfoI18N = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.itemTypeInfo;
        const { type, id, existingItem, newItemMode, cloudProviderResource, file, tileLayerPublishType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { user, portal, config: { helpMap, helpBase } } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        if (user) {
            const { error: backedBySDSError, result: _isPortalBackedBySDS } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.f)(() => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_1__.m)(portal, user), "isPortalBackedBySDS", portal.id);
            if (!backedBySDSError) {
                // @ts-ignore - we need to figure out a better way to do this so we're not modifying the user's portal
                _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isBackedBySDS = _isPortalBackedBySDS;
            }
        }
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        const isExcel = type === "Microsoft Excel";
        if (existingItem) {
            const success = await this.analyze("item");
            if (!success) {
                return;
            }
            if (type === "CSV" ||
                (isExcel && ((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) === 1)) {
                this.newItemUpdatePage.emit("fileField");
                return;
            }
        }
        // Analyze to get Excel sheet info
        if (isExcel && !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(user) && !existingItem) {
            if (!id) {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedSheet = 0;
                await this.analyze(cloudProviderResource ? "cloud" : "file");
            }
            else {
                await this.analyze("item");
            }
        }
        if (mvFlow) {
            this.selected =
                (newItemMode === "url" || !(0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, type, portal)) &&
                    !this.shouldDisableNonHosted()
                    ? "non-hosted"
                    : "hosted";
            if (this.isAddToMapTerminalPage()) {
                _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "addToMap";
            }
        }
        // Add to MV: Manage upload here when adding file directly
        this.canSkipPublishSelect = canSkipPublishSelectToNextPage({
            directMode: mvFlow,
            isMultipageExcel: isExcel && ((_b = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.excelLayers) === null || _b === void 0 ? void 0 : _b.length) > 1,
            newItemMode,
            cloud: !!cloudProviderResource,
            fromExistingItem: !!existingItem,
            itemType: type,
            canPublishItemType: (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, type, portal)
        });
        if (this.canSkipPublishSelect) {
            if (newItemMode === "url") {
                // Only adding from URL can be added directly
                //  since from-file flows relies on the published item id
                this.selected = "non-hosted";
            }
            this.handleNext();
        }
        if (!(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.c)(portal) || !user) {
            this.selected = "non-hosted";
        }
        if (type === "Scene Package" && !(0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.h)(user)) {
            this.selected = "non-hosted";
            this.handleNext();
        }
        if (type === "GeoJson" && _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map") {
            if (!!file) {
                this.determineHint(file);
            }
            else if (!!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url) {
                this.tip = {
                    title: this.i18n.largeGeoJsonConditionDescription,
                    linkText: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.common.learnMore,
                    link: `${helpBase}${helpMap["120003923"]}`
                };
            }
        }
        if (tileLayerPublishType === "3dTiles") {
            this.publishSelectOption = {
                tileLayerPublishType,
                tilesLayer3dTilesLayerType: (_c = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tilesLayer3dTilesLayerType) !== null && _c !== void 0 ? _c : _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_28__.D
            };
        }
    }
    isAddToMapTerminalPage() {
        const { selected } = this;
        const { newItemMode, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        return (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" &&
            newItemMode === "url" &&
            type === "GeoJson" &&
            selected === "non-hosted");
    }
    async analyze(analyzeType, forceCreateItem = false) {
        var _a;
        const { fileName, file, url, dataUrl, id: itemid, extension, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { portal, user, config, lang } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        this.updateLoader("indeterminate", this.i18n.analyze.replace("${fileName}", fileName.length > 0 ? fileName : url));
        this.loading = true;
        const fromCloud = analyzeType === "cloud";
        let error = null;
        if (fromCloud || (type === "CSV" && file && (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.a)(file.size)) || forceCreateItem) {
            const existingItemUrl = await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_13__.c)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName, (_a = (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_14__.f)(extension)[0]) === null || _a === void 0 ? void 0 : _a.type);
            if (existingItemUrl) {
                this.handleError({ code: "itemExists", itemUrl: existingItemUrl });
                this.loading = false;
                return false;
            }
            // ! This is a work around since analyze doesn't work with sourceUrl for cloud items yet
            // Also analyze will timeout for big csv https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875
            if (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id) {
                const newName = (0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_20__.g)();
                if ((file === null || file === void 0 ? void 0 : file.size) > _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.M) {
                    this.updateLoader("determinate", this.i18n.uploading.replace("${item}", fileName));
                }
                const addResponse = await (fromCloud ? _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.k : _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.e)({
                    title: newName,
                    filename: newName
                });
                this.updateLoader("indeterminate", this.i18n.analyze.replace("${fileName}", fileName.length > 0 ? fileName : url));
                try {
                    await (0,_publish_item_17d2f9a3_js__WEBPACK_IMPORTED_MODULE_26__.c)(addResponse);
                }
                catch (e) {
                    this.handleError({ code: "unhandledError" });
                    this.loading = false;
                    return false;
                }
                const itemid = addResponse.id;
                ({ error } = await (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_31__.a)({
                    analyzeArgs: { type: "item", itemid },
                    configArgs: { portal, user, config, lang },
                    itemArgs: { itemType: type },
                    initialize: true
                }));
                // We don't delete in case the user go back and forth
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.id = itemid;
            }
        }
        else {
            ({ error } = await (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_31__.a)({
                analyzeArgs: analyzeType === "url"
                    ? { type: "url", sourceUrl: url !== null && url !== void 0 ? url : dataUrl }
                    : analyzeType === "file"
                        ? { type: "file", file }
                        : { type: "item", itemid },
                configArgs: { portal, user, config, lang },
                itemArgs: { itemType: type },
                initialize: true
            }));
            if ((error === null || error === void 0 ? void 0 : error.code) === "timeout") {
                // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875
                return this.analyze(analyzeType, true);
            }
        }
        this.loading = false;
        if (error) {
            this.handleError(error);
        }
        return !error;
    }
    handleError(error) {
        const { i18n } = this;
        this.duplicateItemUrl = null;
        this.alertContent = null;
        switch (error.code) {
            case "itemExists":
                this.duplicateItemUrl = error.itemUrl;
                const fileName = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName;
                this.alertContent = {
                    title: i18n.error.alreadyExists.title,
                    description: i18n.error.alreadyExists.desciption.replace("${fileName}", fileName),
                    link: error.itemUrl,
                    linkText: i18n.error.alreadyExists.linkText
                };
                break;
            case "emptyFile":
                this.alertContent = { title: i18n.error.title, description: i18n.error.emptyFile };
                break;
            case "duplicateFieldNames":
                this.alertContent = i18n.error.duplicateFields;
                break;
            default:
                this.alertContent = i18n.error;
                break;
        }
    }
    getDisplayType(type, extension) {
        var _a, _b, _c;
        let i18nKey = type;
        if (((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.cloudProviderResource) === null || _a === void 0 ? void 0 : _a.mimeType) === "googlesheets") {
            i18nKey = "Google Sheets";
        }
        else if (extension === "json") {
            i18nKey = "JSON";
        }
        return (_c = (_b = this.itemInfoI18N.lowercaseDisplayName[i18nKey]) !== null && _b !== void 0 ? _b : i18nKey) !== null && _c !== void 0 ? _c : "";
    }
    getOptionText(radio, displayName) {
        const isHosted = radio === "hosted";
        const { i18n, itemInfoI18N } = this;
        const { dataUrl, fileName, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        if (mvFlow) {
            return isHosted
                ? { title: i18n.hostedMVTitle, description: i18n.hostedMVDescription }
                : {
                    title: dataUrl ? i18n.addDirectlyUrlTitle : i18n.addDirectlyTitle,
                    description: dataUrl ? i18n.addDirectlyUrlDescription : i18n.addDirectlyDescription
                };
        }
        if (displayName === "GeoJSON" && !!dataUrl) {
            return i18n.geoJSONFromURL[isHosted ? "hosted" : "nonHosted"];
        }
        const title = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(isHosted
            ? i18n.hostedTitle[mvFlow && type === "CSV" ? "CSVNoTable" : displayName] ||
                i18n.hostedTitle[type]
            : itemInfoI18N.nonHostedTitle, fileName, "fileName");
        const description = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(isHosted
            ? // TODO: fix casing in the "tile package" and "vector tile package" hosted description keys in the i18n file after string freeze is lifted
                // WebGIS/arcgis-portal-app#39867
                i18n.hostedDescription[displayName] ||
                    i18n.hostedDescription[displayName.toLowerCase()] ||
                    i18n.hostedDescription[type] ||
                    i18n.hostedDescription[type.toLowerCase()]
            : itemInfoI18N.nonHostedDescription, displayName, "fileType");
        return { title, description };
    }
    renderOption(radio, displayName) {
        const { title, description } = this.getOptionText(radio, displayName);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: radio === this.selected, onCalciteTileSelectChange: (e) => {
                this.selected = e.target.value;
                _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = this.isAddToMapTerminalPage() ? "addToMap" : "next";
            }, description: description, heading: title, name: description, "input-enabled": true, "input-alignment": "start", type: "radio", value: radio, width: "full", id: `${radio}-input-option`, disabled: radio === "non-hosted" && this.shouldDisableNonHosted() }));
    }
    renderSheetSelect() {
        var _a;
        const { excelLayers } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (!excelLayers || excelLayers.length === 1) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--leader" }, this.i18n.publishThisSheet), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: this.updateSelectedSheet.bind(this), value: (_a = String(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedSheet)) !== null && _a !== void 0 ? _a : "0", class: "constrain" }, excelLayers.map((layer, i) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: i, selected: i === _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedSheet }, layer.name))))));
    }
    render3dTilesSelect() {
        const { i18n, publishSelectOption } = this;
        if ((publishSelectOption === null || publishSelectOption === void 0 ? void 0 : publishSelectOption.tileLayerPublishType) !== "3dTiles") {
            return null;
        }
        const { tilesLayer3dTilesLayerType } = publishSelectOption;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--leader" }, i18n["3dTiles"].layerType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: ({ currentTarget }) => {
                const selected = currentTarget.selectedOption
                    .value;
                publishSelectOption.tilesLayer3dTilesLayerType = selected;
            }, value: publishSelectOption.tilesLayer3dTilesLayerType, class: "constrain" }, _tile_layer_cf04fa97_js__WEBPACK_IMPORTED_MODULE_28__.t.map((layerType) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: layerType, selected: layerType === tilesLayer3dTilesLayerType }, layerType === "3DObject" ? "3D objects" : "Integrated mesh"))))));
    }
    render() {
        const { extension, type, existingItem } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const displayName = this.getDisplayType(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type, extension);
        const { loaderType, itemInfoI18N, loading, loaderMessage, selected, alertContent, isDeletingOldFile, tip, canSkipPublishSelect } = this;
        const mvFlow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        // Add to MV: hide hosted select if item is being added directly
        const canPublishGeoJson = type === "GeoJson" && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, "GeoJson", portal);
        // CSV has X Y
        const canPublishCSV = type === "CSV" && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, "CSV", portal);
        const showPublishOptions = !existingItem && (!mvFlow || (!canSkipPublishSelect && (canPublishGeoJson || canPublishCSV)));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: loaderType, value: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.uploadProgress, active: loading, text: loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: "indeterminate", active: isDeletingOldFile }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-input-readonly", null), showPublishOptions && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("fieldset", { class: "fieldset" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("legend", { class: "label" }, itemInfoI18N.howToAdd), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, ["hosted", "non-hosted"]
            .filter((option) => (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.c)(portal) || option !== "hosted")
            .map((radio) => this.renderOption(radio, displayName))))), type === "Microsoft Excel" &&
            selected === "hosted" &&
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow !== "append" &&
            this.renderSheetSelect(), this.render3dTilesSelect(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { open: !!tip, class: "notice--tip", icon: true, scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, tip === null || tip === void 0 ? void 0 : tip.title), (tip === null || tip === void 0 ? void 0 : tip.description) && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, tip === null || tip === void 0 ? void 0 : tip.description), (tip === null || tip === void 0 ? void 0 : tip.link) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", href: tip === null || tip === void 0 ? void 0 : tip.link, target: "_blank" }, tip === null || tip === void 0 ? void 0 : tip.linkText))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: alertContent === null || alertContent === void 0 ? void 0 : alertContent.title, description: alertContent === null || alertContent === void 0 ? void 0 : alertContent.description, link: { href: alertContent === null || alertContent === void 0 ? void 0 : alertContent.link, title: alertContent === null || alertContent === void 0 ? void 0 : alertContent.linkText }, active: !!alertContent, onAlertDismiss: () => (this.alertContent = null), scale: "s" })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesPublishSelect.style = arcgisNewItemPagesPublishSelectCss;

const arcgisNewItemPagesSingleLayerSelectCss = ".outer-container{display:flex;flex-direction:column}.layer-container{overflow:auto;overflow-x:hidden;box-sizing:border-box;display:flex;max-height:212px;height:30vh;border:1px solid var(--calcite-color-border-1);border-top:0;width:100%}calcite-radio-button-group{width:100%}.layer-item{padding:12px 12px 0}.layer-notice{margin-bottom:1.5rem}.layer-input-message{font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-3)}.layer-not-found-message{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-2);text-align:center;width:100%;margin-top:1.5rem}.selected{background-color:rgba(0, 121, 193, 0.05)}.select-container{margin-top:1.5rem;display:flex;justify-content:space-between}.select-item{width:45%}.select-item-message{font-size:0.875rem;font-weight:500;margin-bottom:0.25rem}";

const ArcgisNewItemPagesSingleLayerSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        // TODO: Keep serviceInfo unmodified - can be hard to follow what came back from the response vs what was added/changed after
        this.selectWMTSLayer = (selectedLayer) => {
            var _a;
            const { serviceInfo } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            serviceInfo.selectedLayer = selectedLayer;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = serviceInfo;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayer = selectedLayer;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileMatrices =
                _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 4
                    ? selectedLayer.tileMatrixSets.toArray()
                    : selectedLayer.tileMatrixSetInfos;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedTileInfo = (_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.tileMatrices) === null || _a === void 0 ? void 0 : _a[0];
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = selectedLayer.title;
        };
        this.selectWFSLayer = async (layer) => {
            const { serviceInfo, maxFeatures } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
            const { name, extent, title } = layer;
            const wfsLayerOptions = {
                layerName: name,
                mode: "snapshot",
                title: title || name,
                fullExtent: extent,
                maxFeatures: maxFeatures || 3000
            };
            if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3) {
                // when calling select layer from `WFSLayer` this will actually update serviceInfo, so we need to setServiceInfo everytime after we call selectLayer here.
                await serviceInfo.selectLayer(wfsLayerOptions, () => {
                    serviceInfo.selectedLayer = wfsLayerOptions;
                    const isComplex = serviceInfo.geometryType === "esriGeometryComplex";
                    serviceInfo.isComplex = isComplex;
                    const url = serviceInfo.url.trim();
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.isComplex = isComplex;
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = serviceInfo;
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayer = wfsLayerOptions;
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url = url;
                    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = wfsLayerOptions.title;
                });
            }
            else {
                serviceInfo.layerName = name;
                serviceInfo.maxFeatures = wfsLayerOptions.maxFeatures;
                // Previously we call `serviceInfo.selectLayer` in v3 and these are the callback
                serviceInfo.selectedLayer = wfsLayerOptions;
                const isComplex = serviceInfo.geometryType === "esriGeometryComplex";
                serviceInfo.isComplex = isComplex;
                const url = serviceInfo.url.trim();
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.isComplex = isComplex;
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = serviceInfo;
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayer = wfsLayerOptions;
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url = url;
                _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = serviceInfo.title;
            }
        };
        this.handleSearchUpdate = (event) => {
            const layers = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers.filter((layer) => !event.detail || layer.title.toLowerCase().indexOf(event.detail) > -1);
            this.filteredLayers = layers;
        };
        this.handleTileChange = () => {
            const name = this.getSelectOption(this.tileSelectRef);
            const selectedTileInfo = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.tileMatrices.find((tileInfo) => tileInfo[_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 4 ? "id" : "tileMatrixSet"] === name);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedTileInfo = selectedTileInfo;
        };
        this.handleMaxFeatureChange = (event) => {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.maxFeatures = parseInt(event.target.value);
        };
        this.handleGeometryChange = () => {
            this.selectedGeometry = this.getSelectOption(this.geometrySelectRef);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.geometryType = this.selectedGeometry;
        };
        this.renderSelectMenus = () => {
            const { type, maxFeatures, tileMatrices, isComplex } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b;
            const { i18n, handleGeometryChange, handleMaxFeatureChange, handleTileChange } = this;
            if (type === "WFS") {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.maxFeature), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: handleMaxFeatureChange, value: `${maxFeatures}`, "number-button-type": "vertical", min: 0,
                    // width="auto" // TODO: No direct conversion - maybe style it from the outside
                    type: "number" })), isComplex && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.featureType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", class: "select-geometry", onCalciteSelectChange: handleGeometryChange, ref: (el) => (this.geometrySelectRef = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: this.selectedGeometry === "default", disabled: true, value: "default", label: i18n.selectGeometry }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPoint", label: i18n.points }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPolyline", label: i18n.lines }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "esriGeometryPolygon", label: i18n.polygons }))))));
            }
            else if ((tileMatrices === null || tileMatrices === void 0 ? void 0 : tileMatrices.length) > 1) {
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "select-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "select-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectTile), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: handleTileChange, ref: (el) => (this.tileSelectRef = el) }, tileMatrices.map((tile) => {
                    const value = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3 ? tile.tileMatrixSet : tile.id;
                    return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, label: value });
                })))));
            }
        };
        this.managedFocus = true;
        this.selectedLayer = undefined;
        this.selectedGeometry = "default";
        this.filteredLayers = undefined;
        this.errorMessage = "";
        this.i18n = undefined;
    }
    onTransitionComplete() {
        var _a;
        (_a = this.layerSearchRef) === null || _a === void 0 ? void 0 : _a.focusMainInput();
    }
    async handleNext() {
        const { isComplex } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b;
        if (isComplex && this.selectedGeometry === "default") {
            this.errorMessage = this.i18n.selectGeometryError;
            this.geometrySelectRef.setFocus();
            return;
        }
        const { type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (type === "WFS") {
            await this.selectWFSLayer(this.selectedLayer);
        }
        if (this.isAddToMapTerminalPage()) {
            this.workflowComplete.emit({
                type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type,
                url: encodeURI(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url),
                customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters,
                layers: [this.selectedLayer],
                addAsBasemap: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap
            });
        }
        else {
            this.newItemUpdatePage.emit("itemProperties");
        }
    }
    async handleLayerChange(name) {
        if (!name) {
            return;
        }
        // TODO: return new layer from select____Layer, write to store here
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WMTS") {
            const selectedLayer = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers.find((layer) => (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3 ? layer.identifier : layer.id) === name);
            this.selectedLayer = selectedLayer;
            this.selectWMTSLayer(selectedLayer);
        }
        else if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WFS") {
            const selectedLayer = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers.find((layer) => layer.name === name);
            await this.selectWFSLayer(selectedLayer);
            this.selectedLayer = selectedLayer;
            this.selectedGeometry = "default";
        }
        else {
            const selectedLayer = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers.find((layer) => layer.title === name);
            this.selectedLayer = selectedLayer;
            // trouble with the typing here
            (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.l)(selectedLayer);
        }
    }
    isAddToMapTerminalPage() {
        return _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
    }
    async componentWillLoad() {
        const i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        this.i18n = i18n.singleLayerSelect;
        if (this.isAddToMapTerminalPage()) {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap ? "useAsBaseMap" : "addToMap";
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WFS") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.maxFeatures = 3000;
            await this.selectWFSLayer(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo.layers[0]);
        }
        if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WMTS") {
            this.selectWMTSLayer(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo.layers[0]);
        }
        this.filteredLayers = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers;
        const isOGCFeature = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "OGCFeatureServer";
        const layerValue = isOGCFeature
            ? "title"
            : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WFS"
                ? "layerName"
                : "identifier";
        this.selectedLayer =
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers.find((layer) => { var _a; return layer[isOGCFeature ? "title" : " name"] === ((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.selectedLayer) === null || _a === void 0 ? void 0 : _a[layerValue]); }) || _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.layers[0];
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.selectedLayer = this.selectedLayer;
    }
    getSelectOption(select) {
        const option = select === null || select === void 0 ? void 0 : select.querySelector("calcite-option[selected]");
        return option === null || option === void 0 ? void 0 : option.value;
    }
    render() {
        var _a;
        const { renderSelectMenus, i18n, selectedLayer } = this;
        const isWMTS = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "WMTS";
        const isOGCFeature = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.b.type === "OGCFeatureServer";
        const layerValue = isOGCFeature
            ? "title"
            : isWMTS
                ? _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3
                    ? "identifier"
                    : "id"
                : "name";
        const LIMIT_AMOUNT = 1000;
        const usePro = this.filteredLayers.length >= LIMIT_AMOUNT;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "layer-notice", icon: "information", open: usePro, width: "full" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { slot: "message" }, i18n.usePro)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "select-item-message" }, i18n.selectLayer), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-layer-search", { searchLabel: "layers", onSearchUpdate: this.handleSearchUpdate, ref: (ele) => (this.layerSearchRef = ele) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "layer-container" }, this.filteredLayers.length === 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("strong", { class: "layer-not-found-message" }, i18n.noLayersFound)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { name: "layer-select", role: "radiogroup", layout: "vertical", onCalciteRadioButtonGroupChange: (event) => this.handleLayerChange(event.target.selectedItem.value) }, (_a = this.filteredLayers) === null || _a === void 0 ? void 0 : _a.slice(0, LIMIT_AMOUNT).map((layer) => {
            const value = layer[layerValue];
            const label = layer.title;
            let isSelected = false;
            // for some OGC Servers, the title may be duplicated in the data set so you have to also check the id as well (for what I was testing - the id couldnt be used as a value because it had special characters and couldnt be used as a selector in `querySelector`)
            if (value === selectedLayer[layerValue]) {
                if (isOGCFeature) {
                    isSelected = layer.id === selectedLayer.id;
                }
                else {
                    isSelected = true;
                }
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", for: value, class: {
                    "layer-item": true,
                    selected: isSelected
                } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { class: "radio", checked: isSelected, id: value, name: value, value: value }), label || value));
        }))))), renderSelectMenus(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: !!this.errorMessage, description: this.errorMessage, onAlertDismiss: () => (this.errorMessage = "") })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesSingleLayerSelect.style = arcgisNewItemPagesSingleLayerSelectCss;

/**
 * Custom Paramters can be used for any OGC or AGS service. For WMS,
 * WFS and WMTS they will be added to the constructor from the JSAPI when
 * creating the layer, for everything else it will be added temporarily
 * to the URL when retreiving service info.
 * For all urls with custom paramters, it will be added to the items
 *  metadata using the text attribute.
 */
async function handleCustomParameterUpdate(serviceInfo, type, _customParameters) {
    const { customParameters, customLayerParameters } = (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.m)(_customParameters);
    switch (type) {
        case "WMS":
        case "WMTS":
            await (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.setCustomParameters(customParameters || {}, customLayerParameters || {}));
            break;
        case "WFS":
            await (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.setCustomParameters(customParameters || {}));
            break;
    }
}

const isKeyAllowedInUrlLocalState = (key) => [
    "url",
    "type",
    "newItemMode",
    "serviceInfo",
    "isSecured",
    "allowStoredAuth",
    "storeAuth",
    "hybridImageServiceSetting",
    "addAsBasemap",
    "dataUrl",
    "fileName",
    "geoJSONResource",
    "title",
    "tags",
    "snippet"
].includes(key);

const arcgisNewItemPagesUrlTypeCss = ".label{margin-bottom:1rem;display:block;padding-top:1rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px}.fieldset{margin:0px;margin-bottom:1.5rem;border-style:none;padding:0px}.info-header{margin:0px;margin-bottom:0.5rem;padding:0px;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.info-header--leader{margin-top:1rem}.info-description{margin:0px;padding:0px;font-size:0.75rem;font-weight:400;color:var(--calcite-color-text-1)}.custom-param-container{margin-bottom:1.5rem}:host{overflow-x:hidden}";

const ArcgisNewItemPagesUrlType = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        var _a;
        this.addDirectToMap = false;
        this.urlOptions = [
            { value: "AGS", icon: "server", show: true },
            { value: "Document Link", icon: "file-code", show: !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) },
            { value: "GeoJson", icon: "brackets-curly", show: true },
            { value: "KML", icon: "layer-kml", show: true },
            { value: "OGCFeatureServer", icon: "feature-layer", show: true },
            { value: "WFS", icon: "feature-layer", show: true },
            { value: "WMS", icon: "layer-map", show: true },
            { value: "WMTS", icon: "tile-layer", show: true },
            { value: "GeoRSS", icon: "file-text", show: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" },
            {
                value: "CSV",
                icon: "file-csv",
                show: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" || !((_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal)
            },
            { value: "Tile Layer", icon: "tile-layer", show: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" }
        ];
        this.setServiceInfoState = (properties) => {
            Object.keys(properties).forEach((key) => {
                const value = properties[key];
                if (isKeyAllowedInUrlLocalState(key)) {
                    // TODO: Remove any cast once incoming properties are trimmed down to urlData
                    this.urlData[key] = value;
                }
                else {
                    // TODO: Decide if all possible service info properties (thumbnail, extent, layers, etc.) should be part of urlData
                    // If not, consider holding this as a temporary local object until the rest of the store assignments
                    // @ts-ignore
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a[key] = value;
                }
            });
        };
        this.isAddToMapTerminalPage = () => {
            var _a;
            const { selectedOption, urlData: { url, serviceInfo }, addDirectToMap } = this;
            return (addDirectToMap &&
                (((0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(this.urlData.type) && !this.urlData.storeAuth && serviceInfo) ||
                    (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.s)(selectedOption)) &&
                !(0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.i)(url, serviceInfo) &&
                (!["WMS", "WFS", "WMTS", "CSV", "GeoJson", "OGCFeatureServer"].includes(selectedOption) ||
                    (0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(this.urlData.type) ||
                    (selectedOption === "GeoJson" && !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) ||
                    (((_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && ["CSV", "GeoJson"].includes(selectedOption))));
        };
        this.determineNextText = () => {
            const { urlData, isAddToMapTerminalPage, showAddToMap } = this;
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "next";
            if (isAddToMapTerminalPage()) {
                _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "addToMap";
                if (showAddToMap() && urlData.addAsBasemap) {
                    _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.nextText = "useAsBaseMap";
                }
            }
        };
        this.showAddToMap = () => {
            const { urlData, addDirectToMap } = this;
            const { url = "", serviceInfo } = urlData;
            const addToMapType = [
                "Tile Layer",
                "WMS",
                "WMTS",
                "Vector Tile Service",
                "Image Service",
                "Map Service"
            ];
            return (addDirectToMap &&
                (addToMapType.includes(urlData.type) || (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.i)(url, serviceInfo)));
        };
        this.handleAuthSwitchChange = (event) => {
            this.urlData.storeAuth = event.detail;
        };
        this.handleLoaderUpdate = (event) => {
            this.loading = event.detail;
        };
        this.resetError = () => {
            this.error = false;
            this.errorMessage = "";
        };
        this.open = false;
        this.selectedOption = null;
        this.previousSelectedOption = null;
        this.i18n = undefined;
        this.error = false;
        this.errorMessage = undefined;
        this.loading = false;
        this.loaderText = undefined;
        this.urlData = {};
    }
    async handleNext() {
        var _a, _b;
        const { urlData, selectedOption, itemUrlRef, i18n, selectRef } = this;
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const urlErrorMessage = await (itemUrlRef === null || itemUrlRef === void 0 ? void 0 : itemUrlRef.validateInput());
        if (urlErrorMessage) {
            // We already show error inline
            itemUrlRef.focusMainInput();
            return;
        }
        // Cancel next if url is not yet analyzed
        if (this.loading) {
            return;
        }
        if (!selectedOption) {
            selectRef.setFocus();
            this.errorMessage = i18n.undetected;
            this.error = true;
            return;
        }
        this.loading = true;
        const success = await this.handlePageTransition();
        this.loading = false;
        if (success) {
            if ((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.i)(urlData.url, (_a = this.urlData) === null || _a === void 0 ? void 0 : _a.serviceInfo)) {
                this.assignStoreState();
                this.newItemUpdatePage.emit(this.urlData.storeAuth ? "auth" : "hybridImageSelect");
                return;
            }
            if (this.isAddToMapTerminalPage()) {
                this.loading = true;
                // Only redirect if no more actions are needed
                this.workflowComplete.emit({
                    type: urlData.type,
                    url: encodeURI(urlData.url),
                    customParameters,
                    addAsBasemap: (_b = this.urlData.addAsBasemap) !== null && _b !== void 0 ? _b : false
                });
                this.loading = false;
            }
            this.setNextPage();
            this.assignStoreState();
            this.newItemUpdatePage.emit(this.nextPage);
        }
        else {
            this.itemUrlRef.focusMainInput();
            this.error = true;
        }
    }
    assignStoreState() {
        const { url, type, allowStoredAuth, storeAuth, title, tags, snippet, serviceInfo, isSecured, addAsBasemap } = this.urlData;
        const selectedOption = this.selectedOption;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.url = url;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.storeAuth = storeAuth;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = type;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.allowStoredAuth = allowStoredAuth;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "url";
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.serviceInfo = serviceInfo;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.isSecured = isSecured;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.addAsBasemap = addAsBasemap !== null && addAsBasemap !== void 0 ? addAsBasemap : false;
        const parts = url.split("/");
        const fileName = parts[parts.length - 1];
        if (selectedOption === "GeoJson" && url) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataUrl = url;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.title = fileName.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_33__.b, "").replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_33__.s, "");
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = fileName;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = "json";
            if (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow !== "map") {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
            }
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.geoJSONResource = {
                fileName,
                url,
                mimeType: "geojson"
            };
        }
        if (selectedOption === "CSV") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = "CSV";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataUrl = url;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.u)(url);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extension = "csv";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.csvResource = {
                fileName,
                url,
                mimeType: "csv"
            };
        }
        title && (_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = title.replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_33__.s, ""));
        tags && (_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.tags = tags);
        snippet && (_item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.snippet = snippet);
    }
    async componentWillLoad() {
        var _a;
        const { type, url, serviceInfo, isSecured, allowStoredAuth, storeAuth, addAsBasemap, title } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        this.urlData = {
            url,
            type,
            allowStoredAuth,
            storeAuth,
            serviceInfo,
            isSecured,
            addAsBasemap,
            title
        };
        this.changeOption((_a = type) !== null && _a !== void 0 ? _a : null);
        this.addDirectToMap = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map";
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.urlType;
        this.loaderText = this.i18n.getServiceInfo;
        if (!!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) {
            this.urlOptions = this.urlOptions.filter((option) => {
                var _a, _b;
                return option.value === "AGS"
                    ? (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) === null || _a === void 0 ? void 0 : _a.some((type) => (0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(type))
                    : (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) === null || _b === void 0 ? void 0 : _b.includes(option.value);
            });
            this.allowedItemTypes = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes.filter((itemType) => !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow === "map" || "CSV" !== itemType);
        }
        this.options = this.urlOptions
            .filter(({ show }) => show)
            .map(({ value, icon }) => {
            const entry = typeof value !== "string" ? "AGS" : value;
            return {
                optionTitle: this.i18n[entry].title,
                value: entry,
                description: this.i18n[entry].description,
                icon
            };
        });
        // Since we re-assign store state on next anyway,
        // these should be safe to be reset to avoid dangling data
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.dataUrl = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.geoJSONResource = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.csvResource = null;
    }
    async getServiceInfo(checkAuth) {
        var _a;
        const { url, type, storeAuth } = this.urlData;
        const { error, result } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.n)({
            url,
            customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.customParameters,
            type,
            checkAuth,
            storeAuth
        });
        if (error || !result) {
            this.error = true;
            if ((error === null || error === void 0 ? void 0 : error.message) === "does not point to a GIS server") {
                this.errorMessage = this.i18n.serviceNotGIS;
            }
            else if ((_a = error === null || error === void 0 ? void 0 : error.message) === null || _a === void 0 ? void 0 : _a.includes("doesn't support GeoJSON output")) {
                this.errorMessage = this.i18n.unsupportedWFSGeoJSONOutputFormat;
            }
            else {
                switch (error === null || error === void 0 ? void 0 : error.code) {
                    case "serviceNotExist":
                        this.errorMessage = this.i18n.serviceNotExist;
                        break;
                    case "unauthorized":
                        this.errorMessage = "Unauthorized"; // TODO: Get proper error messaging, then localize
                        break;
                    case "unsupportedWFSVersion":
                        this.errorMessage = this.i18n.unsupportedWFSVersion;
                        break;
                    case "invalidWMTS":
                        this.errorMessage = this.i18n.invalidWMTS;
                        break;
                    case "invalidSpatialRef":
                        this.errorMessage = this.i18n.invalidSpatialRef;
                        break;
                    case "emptyFeatureLayer":
                        this.errorMessage = this.i18n.emptyFeatureLayer;
                        break;
                    default:
                        this.errorMessage = this.i18n[error === null || error === void 0 ? void 0 : error.code] || this.i18n.serviceNotExist;
                }
            }
            return;
        }
        return result;
    }
    handleLoadChange(_oldValue, newValue) {
        this.newItemToggleNavigationEnabled.emit(newValue);
    }
    changeOption(type) {
        var _a;
        this.previousSelectedOption = this.selectedOption;
        const isAGSType = (0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(type) || type === "AGS";
        this.selectedOption = isAGSType ? "AGS" : type;
        let newType = type;
        if (isAGSType) {
            // Attempt to parse AGS type from url
            const actualUrlType = (_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__.a[(0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_7__.o)(this.urlData.url)]) === null || _a === void 0 ? void 0 : _a.type;
            if (actualUrlType) {
                newType = actualUrlType;
            }
        }
        this.urlData.type = newType;
        // Log telemetry event if option is manually changed to a different type
        if (this.previousSelectedOption !== this.selectedOption) {
            this.logChangeOptionEvent();
        }
        this.determineNextText();
    }
    async detectType(url) {
        if (url) {
            const { isPortal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
            const { result: type } = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.g)(url, isPortal);
            return type;
        }
        return this.urlData.type;
    }
    async handleNewUrl(args) {
        const { url } = args;
        this.loading = true;
        this.resetError();
        if (this.urlData.url !== url) {
            this.resetUrlData();
            this.resetServiceInfo();
            const detectedType = await this.detectType(url);
            this.urlData.url = url;
            this.urlData.type = detectedType;
            if ((0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(detectedType)) {
                const serviceInfo = await this.getServiceInfo(false);
                serviceInfo && this.setServiceInfoState(serviceInfo);
            }
            this.changeOption(detectedType);
        }
        this.loading = false;
    }
    resetUrlData() {
        const { urlData } = this;
        urlData.url = null;
        urlData.type = null;
        urlData.isSecured = null;
        urlData.storeAuth = null;
        urlData.allowStoredAuth = null;
        urlData.serviceInfo = null;
        urlData.title = null;
        urlData.tags = null;
        urlData.snippet = null;
    }
    // Prevent stale service info from persisting on url change
    resetServiceInfo() {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.agsType = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.description = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.extent = null;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.thumbnailToken = null;
    }
    async handlePageTransition() {
        const { urlData } = this;
        // TODO: refactor this once we remove the side-effect from `custom-parameters`
        const { customParameters } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        if (this.selectedOption === "Document Link") {
            return true;
        }
        const checkAuth = !!urlData.isSecured;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.checkAuth = checkAuth;
        // ! For AGS case, `getServiceInfo` is already called once.
        // TODO: So refactor once we can get the sign in popup to show up easier
        const serviceInfo = await this.getServiceInfo(checkAuth);
        serviceInfo && this.setServiceInfoState(serviceInfo);
        if (customParameters.length > 0 && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api === 3) {
            // `serviceInfo.customParameters` is already set after we fetch service info
            //  and setCustomParameters doesn't exist for v4
            await handleCustomParameterUpdate(urlData.serviceInfo, urlData.type, customParameters);
        }
        return !!serviceInfo;
    }
    /**
     * Telemetry handling for when an option is manually changed
     */
    logChangeOptionEvent() {
        const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
        const payload = {
            eventType: "other",
            pageName: "my content",
            category: "new item url type change",
            details: this.urlData.url,
            label: `${this.previousSelectedOption}, ${this.selectedOption}`
        };
        telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
    }
    setNextPage() {
        const { selectedOption, addDirectToMap } = this;
        let nextPage;
        if ((0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(this.urlData.type)) {
            nextPage = this.urlData.storeAuth ? "auth" : "itemProperties";
        }
        else {
            switch (selectedOption) {
                case "WMS":
                    nextPage = "bulkLayerSelect";
                    break;
                case "WFS":
                case "WMTS":
                    nextPage = "singleLayerSelect";
                    break;
                case "CSV":
                case "GeoJson":
                    nextPage = "publishSelect";
                    break;
                case "Tile Layer":
                    nextPage = "tileLayerFromUrl";
                    break;
                // TODO: move this back once we finalize spec https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/45714
                case "OGCFeatureServer":
                    if (addDirectToMap) {
                        nextPage = "singleLayerSelect";
                        break;
                    }
                default:
                    nextPage = "itemProperties";
            }
        }
        this.nextPage = nextPage;
    }
    render() {
        var _a;
        const { i18n, selectedOption, urlData, determineNextText, addDirectToMap } = this;
        const { url = "", isSecured, addAsBasemap, allowStoredAuth } = urlData;
        const { config: { helpMap, helpBase }, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const agsItemTypes = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.b)(Object.values(_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.a));
        const showCustomParametersType = [
            "WMS",
            "WFS",
            "WMTS",
            "OGCFeatureServer",
            ...agsItemTypes
        ];
        const showCustomParameters = showCustomParametersType.includes(urlData.type);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { active: this.loading, text: i18n.getServiceInfo }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { active: this.error, description: this.errorMessage, onAlertDismiss: () => {
                this.error = false;
                this.errorMessage = "";
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-url", { url: url, onNewItemUrlChange: (event) => this.handleNewUrl(event.detail), supportedServices: (_a = this.allowedItemTypes) !== null && _a !== void 0 ? _a : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes, onUrlLoaderUpdate: this.handleLoaderUpdate, ref: (ele) => (this.itemUrlRef = ele) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { ref: (ele) => (this.selectRef = ele), emptyText: i18n.undetected, selectedOption: selectedOption, options: this.options, label: i18n.label, onArcgisOptionChange: (event) => this.changeOption(event.detail) }), showCustomParameters && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "custom-param-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-custom-parameters", { itemType: urlData.type }))), !!user && isSecured && allowStoredAuth && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { onSwitchChange: this.handleAuthSwitchChange, header: i18n[addDirectToMap ? "storeAuthMV" : "storeAuth"], headerLink: { text: i18n.learnMore, href: `${helpBase}${helpMap["120000597"]}` }, defaultChecked: this.urlData.storeAuth })), this.showAddToMap() && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-switch-card", { header: i18n.useAsBaseMap, defaultChecked: addAsBasemap, onSwitchChange: (toggled) => {
                const addAsBasemap = toggled.detail;
                urlData.addAsBasemap = addAsBasemap;
                determineNextText();
            } }))));
    }
    get element() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "loading": ["handleLoadChange"]
    }; }
};
ArcgisNewItemPagesUrlType.style = arcgisNewItemPagesUrlTypeCss;

// Map zip file options to their telemetry detail counterparts
var ZipFileTelemetry;
(function (ZipFileTelemetry) {
    ZipFileTelemetry["Shapefile"] = "shapefile";
    ZipFileTelemetry["File Geodatabase"] = "fgdb";
    ZipFileTelemetry["Photos with Locations"] = "geotagged photos";
    ZipFileTelemetry["Deep Learning Package"] = "deep learning package";
    ZipFileTelemetry["Map Template"] = "map template";
    ZipFileTelemetry["CAD Drawing"] = "cad";
    ZipFileTelemetry["CSV Collection"] = "csv collection";
    ZipFileTelemetry["KML Collection"] = "kml collection";
    ZipFileTelemetry["Desktop Application Template"] = "desktop app template";
    ZipFileTelemetry["Geoprocessing Sample"] = "geoprocessing sample";
    ZipFileTelemetry["Code Sample"] = "code sample";
    ZipFileTelemetry["ArcPad Package"] = "arcpad package";
    ZipFileTelemetry["AppBuilder Widget Package"] = "wab custom widget";
    ZipFileTelemetry["Image Collection"] = "image collection";
    ZipFileTelemetry["iWork Pages"] = "iwork pages";
    ZipFileTelemetry["iWork Numbers"] = "iwork numbers";
    ZipFileTelemetry["iWork Keynote"] = "iwork keynote";
    ZipFileTelemetry["GML"] = "gml";
    ZipFileTelemetry["Application"] = "application";
})(ZipFileTelemetry || (ZipFileTelemetry = {}));

const codeSampleLanguages = [
    "C",
    "C#",
    "C++",
    "Java",
    "Perl",
    "PHP",
    "Python",
    "Ruby",
    "SQL",
    "VB",
    "WPF",
    "Other"
];

const arcgisNewItemPagesZipSelectCss = ":host{padding-bottom:2rem;min-height:460px}.file{margin:0px;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-1)}.label{margin-bottom:0.75rem;margin-top:0px;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px}.label--top{margin-top:1.5rem;display:block}.trailer-0{margin-bottom:0px}";

const ArcgisNewItemPagesZipSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.itemTypes = [];
        this.updateHostedStatus = (e) => {
            this.publish = e.target.value;
        };
        this.handleChange = (event) => {
            this.selected = event.detail;
        };
        this.selected = "Shapefile";
        this.publish = "hosted";
        this.language = "C";
        this.pad = "project";
        this.i18n = undefined;
        this.itemInfoI18N = undefined;
    }
    handleNext() {
        const selected = this.selected === "Photos with Locations" ? "Image Collection" : this.selected;
        if (this.selected === "Application") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "application";
            this.newItemUpdatePage.emit("application");
            return;
        }
        const { type, typeKeywords, thumbnailURL } = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__.a[selected];
        if (this.selected === "ArcPad Package") {
            typeKeywords.push(this.pad === "project" ? "ArcPad Project" : "ArcPad Template");
        }
        if (this.selected === "Code Sample") {
            typeKeywords.push(this.language);
        }
        if (this.selected === "Photos with Locations") {
            typeKeywords.push("Photo locations");
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.newItemMode = "file";
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.type = type;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.typeKeywords = typeKeywords;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.thumbnailURL = thumbnailURL;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.enablePublishing =
            this.publish === "hosted" && this.canPublishZipType() && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish;
        this.newItemUpdatePage.emit("itemProperties");
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.zipSelect;
        this.itemInfoI18N = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.itemTypeInfo;
        const { portal, user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        if (!(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.c)(portal)) {
            this.publish = "not-hosted";
        }
        const _isPublicUser = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.a)(user);
        const isEnterprise = portal.isPortal;
        this.itemTypes = [
            { value: "Shapefile", icon: "file-zip", publishable: true },
            { value: "File Geodatabase", icon: "data", publishable: true },
            { value: "Photos with Locations", icon: "images", publishable: true, hide: isEnterprise },
            { value: "Deep Learning Package", icon: "deep-learning" },
            { value: "Map Template", icon: "file-zip" },
            { value: "CAD Drawing", icon: "file-cad" },
            { value: "CSV Collection", icon: "file-csv" },
            { value: "KML Collection", icon: "layer-kml" },
            { value: "Desktop Application Template", icon: "file-zip" },
            { value: "Geoprocessing Sample", icon: "hammer" },
            { value: "Code Sample", icon: "file-code" },
            { value: "ArcPad Package", icon: "cube" },
            { value: "AppBuilder Widget Package", icon: "app-gear", hide: _isPublicUser },
            { value: "Image Collection", icon: "collection", hide: _isPublicUser },
            { value: "GML", icon: "code", hide: _isPublicUser },
            { value: "Application", icon: "apps", hide: _isPublicUser }
        ];
        // Add to MV: Trim down selectable list to defined allowedItemTypes, otherwise accept all
        if (!!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes) {
            this.itemTypes = this.itemTypes.filter((item) => _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowedItemTypes.includes(item.value));
        }
    }
    replaceTypeAndName(str, fileName) {
        const nameRegEx = new RegExp(/\$\{fileName\}/g);
        const typeRegEx = new RegExp(/\$\{type\}/g);
        return str.replace(typeRegEx, this.selected).replace(nameRegEx, fileName);
    }
    canPublishZipType() {
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const selectedItemType = this.itemTypes.find((itemType) => itemType.value === this.selected);
        return selectedItemType.publishable && (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_15__.a)(user, selectedItemType.value, portal);
    }
    renderPublish() {
        const { i18n, itemInfoI18N } = this;
        const { portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const fileType = itemInfoI18N.lowercaseDisplayName[this.selected];
        let options = ["hosted", "not-hosted"];
        options = options.filter((option) => option !== "hosted" || (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_18__.c)(portal));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "trailer-0" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(itemInfoI18N.howToAdd, fileType, "fileType"))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", { layout: "vertical" }, options.map((value) => {
            const heading = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(value === "hosted" ? i18n[value].heading : itemInfoI18N.nonHostedTitle, _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a.fileName, "fileName");
            const description = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(value === "hosted" ? i18n[value].description : itemInfoI18N.nonHostedDescription, fileType, "fileType");
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { checked: this.publish === value, width: "full", "input-enabled": true, "input-alignment": "start", name: "publish", value: value, onCalciteTileSelectChange: this.updateHostedStatus, heading: heading, description: description }));
        }))));
    }
    renderLanguages() {
        const languages = codeSampleLanguages.map((value) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, selected: this.language === value }, value === "Other" ? this.i18n.other : value)));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { key: "language-label" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, this.i18n.language), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: this.i18n.language, width: "half", ref: (el) => {
                this.languageSelect = el;
            }, onCalciteSelectChange: () => (this.language = this.languageSelect.selectedOption.value) }, languages)));
    }
    renderPad() {
        const padOptions = ["project", "template"].map((value) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: value, selected: this.pad === value }, this.i18n.ArcPad[value])));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { key: "pad-label" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label label--top" }, this.i18n.type), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", width: "half", ref: (el) => {
                this.padSelect = el;
            }, onCalciteSelectChange: () => (this.pad = this.padSelect.selectedOption.value) }, padOptions)));
    }
    render() {
        const { fileName } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_6__.a;
        const options = this.itemTypes
            .filter((item) => !item.hide)
            .map(({ value, icon }) => ({
            optionTitle: this.i18n[value].title,
            value,
            description: this.i18n[value].description,
            icon
        }));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "label" }, this.i18n.file), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "file" }, fileName), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { class: "label--top", selectedOption: this.selected, options: options, label: this.i18n.itemType, onArcgisOptionChange: (e) => {
                // Log which type of zip file was selected
                const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.telemetry;
                const payload = {
                    eventType: "other",
                    pageName: "my content",
                    category: "new item zip item type",
                    label: ZipFileTelemetry[e.detail]
                };
                telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
                this.selected = e.detail;
            } }), this.canPublishZipType() &&
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.workflow !== "map" &&
            _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.allowPublish &&
            this.renderPublish(), this.selected === "Code Sample" && this.renderLanguages(), this.selected === "ArcPad Package" && this.renderPad()));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesZipSelect.style = arcgisNewItemPagesZipSelectCss;

const timeZoneIds = {
    0: "Dateline Standard Time",
    200: "Hawaiian Standard Time",
    300: "Alaskan Standard Time",
    400: "Pacific Standard Time",
    410: "Pacific Standard Time (Mexico)",
    520: "US Mountain Standard Time",
    510: "Mountain Standard Time (Mexico)",
    500: "Mountain Standard Time",
    610: "Central America Standard Time",
    620: "Central Standard Time",
    630: "Central Standard Time (Mexico)",
    600: "Canada Central Standard Time",
    710: "SA Pacific Standard Time",
    700: "Eastern Standard Time",
    720: "US Eastern Standard Time",
    730: "Venezuela Standard Time",
    850: "Paraguay Standard Time",
    800: "Atlantic Standard Time",
    810: "Central Brazilian Standard Time",
    830: "SA Western Standard Time",
    820: "Pacific SA Standard Time",
    900: "Newfoundland Standard Time",
    910: "E. South America Standard Time",
    950: "Argentina Standard Time",
    940: "SA Eastern Standard Time",
    920: "Greenland Standard Time",
    930: "Montevideo Standard Time",
    1010: "UTC-02",
    1000: "Mid-Atlantic Standard Time",
    1100: "Azores Standard Time",
    1110: "Cape Verde Standard Time",
    1220: "Morocco Standard Time",
    1230: "UTC",
    1200: "GMT Standard Time",
    1210: "Greenwich Standard Time",
    1340: "W. Europe Standard Time",
    1300: "Central Europe Standard Time",
    1320: "Romance Standard Time",
    1310: "Central European Standard Time",
    1330: "W. Central Africa Standard Time",
    1350: "Namibia Standard Time",
    1430: "GTB Standard Time",
    1460: "Middle East Standard Time",
    1410: "Egypt Standard Time",
    1480: "Syria Standard Time",
    1400: "E. Europe Standard Time",
    1470: "South Africa Standard Time",
    1420: "FLE Standard Time",
    1490: "Turkey Standard Time",
    1440: "Israel Standard Time",
    1450: "Jordan Standard Time",
    1510: "Arabic Standard Time",
    1530: "Kaliningrad Standard Time",
    1500: "Arab Standard Time",
    1520: "E. Africa Standard Time",
    1535: "Iran Standard Time",
    1600: "Arabian Standard Time",
    1610: "Azerbaijan Standard Time",
    1540: "Russian Standard Time",
    1650: "Mauritius Standard Time",
    1640: "Georgian Standard Time",
    1620: "Caucasus Standard Time",
    1660: "Afghanistan Standard Time",
    1710: "West Asia Standard Time",
    1715: "Pakistan Standard Time",
    1720: "India Standard Time",
    1730: "Sri Lanka Standard Time",
    1740: "Nepal Standard Time",
    1800: "Central Asia Standard Time",
    1810: "Bangladesh Standard Time",
    1755: "Ekaterinburg Standard Time",
    1820: "Myanmar Standard Time",
    1900: "SE Asia Standard Time",
    1830: "N. Central Asia Standard Time",
    2000: "China Standard Time",
    1910: "North Asia Standard Time",
    2020: "Singapore Standard Time",
    2040: "W. Australia Standard Time",
    2030: "Taipei Standard Time",
    2050: "Ulaanbaatar Standard Time",
    2060: "North Asia East Standard Time",
    2110: "Tokyo Standard Time",
    2100: "Korea Standard Time",
    2140: "Cen. Australia Standard Time",
    2130: "AUS Central Standard Time",
    2210: "E. Australia Standard Time",
    2200: "AUS Eastern Standard Time",
    2240: "West Pacific Standard Time",
    2220: "Tasmania Standard Time",
    2150: "Yakutsk Standard Time",
    2300: "Central Pacific Standard Time",
    2250: "Vladivostok Standard Time",
    2410: "New Zealand Standard Time",
    2430: "UTC+12",
    2400: "Fiji Standard Time",
    2310: "Magadan Standard Time",
    2500: "Tonga Standard Time",
    120: "Samoa Standard Time"
};

const arcgisNewItemTimezoneDropdownCss = ".label{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px;margin-bottom:6px}.has-subtitle{margin-bottom:0px;font-size:1rem}.sub-label{font-size:0.75rem}:host{margin-bottom:1.5rem}";

const ArcgisNewItemTimezoneDropdown = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.timezoneChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "timezoneChange", 7);
        this.selected = "1230";
        this.subTitle = undefined;
        this.defaultTimezone = undefined;
        this.i18n = undefined;
    }
    async componentWillLoad() {
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n.timezoneDropdown;
        const { defaultTimezone } = this;
        if (defaultTimezone) {
            for (const id in timeZoneIds) {
                if (defaultTimezone === timeZoneIds[id]) {
                    this.selected = id;
                    break;
                }
            }
        }
    }
    render() {
        const { i18n, selected, timezoneChange, subTitle } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "label" }, !subTitle && i18n.title), !subTitle && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sub-label" }, i18n.subTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { onCalciteSelectChange: (event) => {
                const value = event.target.selectedOption.value;
                const id = timeZoneIds[value] || value;
                timezoneChange.emit(id);
            }, width: "half", label: "timezone-select", selectedOption: selected }, Object.keys(i18n.timezones).map((code) => {
            const timezone = i18n.timezones[code];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { selected: code === selected, value: code }, timezone));
        })), subTitle && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sub-label" }, subTitle)));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemTimezoneDropdown.style = arcgisNewItemTimezoneDropdownCss;

const arcgisNewItemUrlCss = ".url-field{margin-bottom:1rem}.help-text{margin-top:0.25rem;margin-bottom:0.5rem;font-size:0.875rem}";

const ArcgisNewItemUrl = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.urlInputAddAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "urlInputAddAction", 7);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemUrlChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUrlChange", 7);
        this.urlLoaderUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "urlLoaderUpdate", 7);
        this.debouncedInput = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_3__.d)(() => {
            this.urlInputAddHandler();
        }, 2000);
        this.inputTitle = "";
        this.inputMessage = "";
        this.headerScale = "s";
        this.supportedServices = undefined;
        this.url = undefined;
        this.placeholder = "https://";
        this.required = true;
        this.inputMessageActive = false;
        this.inputStatus = undefined;
        this.isLoading = false;
        this.i18n = undefined;
    }
    async componentWillLoad() {
        var _a;
        const i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_8__.u.i18n;
        this.i18n = i18n.url;
        if (((_a = this.supportedServices) === null || _a === void 0 ? void 0 : _a.length) > 0) {
            this.supportedServiceString = this.supportedServices
                .filter((type) => (0,_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_10__.i)(type))
                .map((type) => {
                var _a, _b;
                const option = (0,_ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__.i)(type) ? "AGS" : type;
                return ((_b = (_a = i18n.itemTypeInfo.mvText[option]) !== null && _a !== void 0 ? _a : i18n.itemTypeInfo.lowercaseDisplayName[option]) !== null && _b !== void 0 ? _b : type);
            })
                .join(", ");
            this.helpText = (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(i18n.common.supportLayerTypes, this.supportedServiceString, "typeList");
        }
        // Initialize state
        this.inputStatus = "idle";
        this.inputMessageActive = this.inputMessage.length > 0;
        if (!this.inputTitle) {
            this.inputTitle = this.i18n.url;
        }
    }
    async focusMainInput() {
        this.mainInputRef.setFocus();
    }
    async validateInput() {
        const { url, required } = this;
        this.resetValidation();
        this.debouncedInput.invoke();
        if (!url && !required) {
            this.urlLoaderUpdate.emit(false);
            return;
        }
        if (!url) {
            this.urlLoaderUpdate.emit(false);
            return this.setError("invalidUrl");
        }
        if ((0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.i)(url, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal.isPortal)) {
            this.urlLoaderUpdate.emit(false);
            return this.setError("httpWarning");
        }
    }
    resetValidation() {
        this.inputStatus = "idle";
        this.inputMessageActive = false;
    }
    async urlInputAddHandler() {
        if (!this.url) {
            return;
        }
        this.urlLoaderUpdate.emit(true);
        const { isPortal, allSSL } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
        this.url = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.f)(this.url, allSSL);
        const { result: type, error } = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.g)(this.url, isPortal);
        if (type !== "KML") {
            // KML has a separate name field
            _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_12__.i.title = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_21__.u)(this.url).replace(_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_33__.s, "");
        }
        this.urlLoaderUpdate.emit(false);
        if (error) {
            this.setError(error.code);
        }
        else {
            this.newItemUrlChange.emit({
                type,
                url: this.url
            });
        }
    }
    setError(code) {
        var _a;
        const supportedServiceString = this.supportedServiceString;
        const inputMessage = (code === "invalidUrl" && supportedServiceString
            ? (0,_i18n_2998ec30_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.i18n.invalidUrlWithType, supportedServiceString, "typeList")
            : (_a = this.i18n) === null || _a === void 0 ? void 0 : _a[code]) || this.i18n.errorMessage;
        this.inputStatus = "invalid";
        this.inputMessage = inputMessage;
        this.inputMessageActive = true;
        return inputMessage;
    }
    render() {
        const { url, helpText, placeholder, required, headerScale } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-description", { header: this.inputTitle, headerScale: headerScale }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { id: "item-properties-url", placeholder: placeholder, value: url, required: required, ref: (ele) => (this.mainInputRef = ele), status: this.inputStatus, type: "url", onInput: (e) => {
                this.resetValidation();
                // ignore paste, it's handled separately
                if (e.inputType === "insertFromPaste")
                    return;
                this.url = e.target.value;
                this.debouncedInput();
            }, onKeyDown: (e) => {
                if (e.key === "Enter") {
                    this.url = this.mainInputRef.value;
                    this.debouncedInput.invoke();
                }
            }, onPaste: (e) => {
                this.url = e.clipboardData.getData("text");
                this.debouncedInput.invoke();
            } }), this.inputMessageActive ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { icon: this.inputStatus === "invalid", status: this.inputStatus }, this.inputMessage)) : helpText ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "help-text" }, helpText)) : null));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemUrl.style = arcgisNewItemUrlCss;



//# sourceMappingURL=arcgis-new-item_19.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-58e18b03.js":
/*!*******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-58e18b03.js ***!
  \*******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ featureServiceEndTelemetry),
/* harmony export */   b: () => (/* binding */ filterChangeTelemetry),
/* harmony export */   c: () => (/* binding */ featureLayerTypeTelemetry),
/* harmony export */   e: () => (/* binding */ enableLayerPreferenceTelemetry),
/* harmony export */   f: () => (/* binding */ featureLayerErrorTelemetry),
/* harmony export */   i: () => (/* binding */ itemExpandedTelemetry)
/* harmony export */ });
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const TELEMETRY_ID = "create feature layer";
const TELEMETRY_PAGE_NAME = "my content";
const addFeatureLayerTypeToTelemetry = (type) => {
    switch (type) {
        case "build":
            return "blank";
        case "existing":
            return "fs";
        case "template":
            return "template";
        case "link":
            return "url";
    }
};
const enableLayerPreferenceTelemetry = (type) => {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, `enable ${type === "captureGPS" ? "gps" : type === "enableZDefaults" ? "z" : "m"}`, {
        category: TELEMETRY_ID,
        attribute: addFeatureLayerTypeToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
        pageName: TELEMETRY_PAGE_NAME
    });
};
const itemExpandedTelemetry = (type) => {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, `expand ${type} details`, {
        category: TELEMETRY_ID,
        attribute: addFeatureLayerTypeToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
        pageName: TELEMETRY_PAGE_NAME
    });
};
const filterChangeTelemetry = () => {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "filter", {
        category: TELEMETRY_ID,
        attribute: addFeatureLayerTypeToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addFeatureLayerType),
        pageName: TELEMETRY_PAGE_NAME
    });
};
const featureLayerTypeTelemetry = (type) => {
    const telemetryType = addFeatureLayerTypeToTelemetry(type);
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "from option", {
        category: TELEMETRY_ID,
        attribute: telemetryType,
        pageName: TELEMETRY_PAGE_NAME
    });
};
const featureServiceEndTelemetry = () => {
    const { addFeatureLayerType, serviceInfo } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
    const featureLayerServiceInfo = serviceInfo;
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow(TELEMETRY_ID, {
        category: TELEMETRY_ID,
        attribute: addFeatureLayerTypeToTelemetry(addFeatureLayerType),
        pageName: TELEMETRY_PAGE_NAME,
        count: featureLayerServiceInfo.layers.length,
        number: featureLayerServiceInfo.tables.length
    });
};
const featureLayerErrorTelemetry = (errString) => {
    var _a;
    (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry) === null || _a === void 0 ? void 0 : _a.logError({
        category: TELEMETRY_ID,
        error: errString
    });
};



//# sourceMappingURL=feature-layer-58e18b03.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getGroupRestBaseUrl)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const getGroupRestBaseUrl = (portal, group) => (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.a)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/groups/${group.id}`);



//# sourceMappingURL=group-6a6303b0.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-2998ec30.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/i18n-2998ec30.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ replaceI18NString)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const regexLookupMap = {
    fileName: /\$\{fileName\}/g,
    fileType: /\$\{type\}/g,
    typeList: /\$\{typeList\}/g,
    missingFields: /\$\{\missingFields\}/g
};
const replaceI18NString = (str, replacementString, type) => {
    const typeRegEx = new RegExp(regexLookupMap[type]);
    return str === null || str === void 0 ? void 0 : str.replace(typeRegEx, replacementString);
};



//# sourceMappingURL=i18n-2998ec30.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js":
/*!**********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/image-collection-5b662b80.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createImageCollection)
/* harmony export */ });
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





var __await = ( false) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); };
var __asyncGenerator = ( false) || function (thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
};
/**
 * Given an item, create a new service
 */
function createImageCollection(response, title, configOptions) {
    return __asyncGenerator(this, arguments, function* createImageCollection_1() {
        const { config, portal, user } = configOptions;
        const { item } = yield __await(fetchItem(response, user));
        const template = yield __await((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.v)(portal));
        yield yield __await("publishingService");
        const isNotInRootFolder = item.ownerFolder && item.ownerFolder !== "/" && item.ownerFolder !== "root";
        const tempTitle = `${title}---${(0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_0__.g)()}`;
        const { createServiceResponse, addToDefinitionResponse } = yield __await((0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.w)(Object.assign({ name: isNotInRootFolder ? tempTitle : title, layers: (template === null || template === void 0 ? void 0 : template.layers) || [], tables: (template === null || template === void 0 ? void 0 : template.tables) || [] }, template), { config, user }));
        if (isNotInRootFolder) {
            yield __await((0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__.m)(createServiceResponse.itemId, item.ownerFolder));
            yield __await((0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_1__.u)(createServiceResponse.itemId, { title }));
        }
        yield yield __await("appendingPhotos");
        const { statusUrl } = yield __await(appendPhotos(createServiceResponse, addToDefinitionResponse, item));
        yield __await(addRelationship(createServiceResponse, item, user));
        yield yield __await("checkingStatus");
        yield __await((0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.p)(statusUrl));
        yield yield __await(createServiceResponse);
    });
}
function fetchItem(item, user) {
    const url = `${user.userContentUrl}/items/${item.id}`;
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url);
}
function appendPhotos(createServiceResponse, addToDefinitionResponse, item) {
    var _a;
    const layer = addToDefinitionResponse.layers[0];
    const url = `${createServiceResponse.encodedServiceURL}/${(_a = layer.id) !== null && _a !== void 0 ? _a : 0}/append`;
    const content = {
        appendItemId: item.id,
        appendUploadFormat: "imageCollection",
        appendAttachmentsInfo: JSON.stringify({ ignoreAttachmentsWithoutLocation: true }),
        upsert: false,
        useGlobalIds: false,
        rollbackOnFailure: true
    };
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}
function addRelationship(createServiceResponse, item, user) {
    const url = `${user.userContentUrl}/addRelationship`;
    const content = {
        relationshipType: "Service2Data",
        destinationItemId: item.id,
        originItemId: createServiceResponse.itemId
    };
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_3__.r)(url, content, {}, "post");
}



//# sourceMappingURL=image-collection-5b662b80.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
    // Search item types extensions for the one imported
    let itemTypes;
    if (validationTypes) {
        itemTypes = validationTypes.map((value) => {
            return value.type;
        });
    }
    else {
        itemTypes = Object.keys(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a);
    }
    let possibleItemTypes = [];
    itemTypes.forEach((type) => {
        var _a;
        if (((_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
            possibleItemTypes.push(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
        }
    });
    return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
    if (!types) {
        return null;
    }
    return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
    return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
    return sizeInMB > 20; // 20MB
};



//# sourceMappingURL=item-types-586f0301.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-22caae1a.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/subscription-22caae1a.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getSubscriptionInfo)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getSubscriptionInfo = async (portal) => {
    try {
        const subscriptionInfo = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/self/subscriptionInfo`);
        return { result: subscriptionInfo };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};



//# sourceMappingURL=subscription-22caae1a.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-f0f9ef4b.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/tile-layer-f0f9ef4b.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ logTileLayerFinish),
/* harmony export */   b: () => (/* binding */ logTileLayerFromOption),
/* harmony export */   l: () => (/* binding */ logTileLayerStart)
/* harmony export */ });
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const TELEMETRY_ID = "create tile layer";
const TELEMETRY_PAGE_NAME = "my content";
const mapTileLayerOptionToTelemetry = (type) => {
    switch (type) {
        case "store":
            return "data store";
        case "existing":
            return "fs";
        case "upload":
            return "upload";
    }
};
const mapTileLayerTypeToTelemetry = (type) => {
    switch (type) {
        case "tiles":
            return "raster";
        case "vectorTiles":
            return "vector";
    }
};
const logTileLayerStart = () => {
    var _a;
    (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry) === null || _a === void 0 ? void 0 : _a.startWorkflow(TELEMETRY_ID, {
        category: "create tile layer",
        pageName: "my content"
    });
};
const logTileLayerFromOption = () => {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.stepWorkflow(TELEMETRY_ID, "from option", {
        category: TELEMETRY_ID,
        attribute: mapTileLayerOptionToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addTileLayerOption),
        details: mapTileLayerTypeToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.tileLayerPublishType),
        pageName: TELEMETRY_PAGE_NAME
    });
};
const logTileLayerFinish = () => {
    const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.telemetry;
    telemetry === null || telemetry === void 0 ? void 0 : telemetry.endWorkflow(TELEMETRY_ID, {
        category: TELEMETRY_ID,
        attribute: mapTileLayerOptionToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addTileLayerOption),
        details: mapTileLayerTypeToTelemetry(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.tileLayerPublishType),
        pageName: TELEMETRY_PAGE_NAME
    });
};



//# sourceMappingURL=tile-layer-f0f9ef4b.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-9b3ffcf7.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ resetStoreOnHome),
/* harmony export */   r: () => (/* binding */ resetAddItemStores)
/* harmony export */ });
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function resetAddItemStores() {
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
}
const resetStoreOnHome = () => {
    if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.existingItem || _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_2__.u.workflow === "register") {
        return;
    }
    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.d.reset();
    const folder = _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.i.folder;
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.a.reset();
    _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_0__.i.folder = folder;
};



//# sourceMappingURL=utils-9b3ffcf7.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWQxN2RjNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzJEO0FBQzBCO0FBQzdCO0FBQ2lCO0FBQ2Q7QUFDUTtBQUNvQjtBQUNiO0FBQ0s7O0FBRS9FO0FBQ0E7QUFDQSxZQUFZLG9EQUFvRDtBQUNoRSxJQUFJLGtEQUFXO0FBQ2YscUJBQXFCLG9EQUFlLHVGQUF1RixvREFBb0I7QUFDL0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksMkRBQW1CO0FBQ3ZCLElBQUksMkRBQW1CO0FBQ3ZCO0FBQ0E7QUFDQSxRQUFRLDJEQUFtQjtBQUMzQjtBQUNBO0FBQ0EsUUFBUSwyREFBbUI7QUFDM0I7QUFDQSxJQUFJLG9EQUFZO0FBQ2hCLElBQUksb0RBQVk7QUFDaEIsSUFBSSxvREFBWTtBQUNoQixJQUFJLG9EQUFZO0FBQ2hCO0FBQ0E7QUFDQSxJQUFJLG9EQUFZO0FBQ2hCLElBQUksb0RBQVk7QUFDaEI7QUFDQTtBQUNBLFlBQVksb0RBQVksYUFBYSxzREFBa0I7QUFDdkQ7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckMscUJBQXFCLDZCQUE2QjtBQUNsRCxnQkFBZ0IsNkRBQXNCLE1BQU0sc0RBQWM7QUFDMUQ7QUFDQSxvQkFBb0IsMEJBQTBCLFFBQVEsMERBQThCO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCLGdCQUFnQixvREFBWTtBQUM1QixnQkFBZ0Isb0RBQVksOEJBQThCLHNEQUFzQztBQUNoRztBQUNBO0FBQ0EsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9EQUFZO0FBQ3hCLFlBQVksb0RBQVk7QUFDeEIsWUFBWSxvREFBWTtBQUN4QixZQUFZLG9E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b3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tNDcxMDM3MjQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLW5ldy1pdGVtXzE5LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NhdGVnb3JpZXMtOWYwZjM3ZWUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZmVhdHVyZS1sYXllci01OGUxOGIwMy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9ncm91cC02YTYzMDNiMC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9pMThuLTI5OThlYzMwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2ltYWdlLWNvbGxlY3Rpb24tNWI2NjJiODAuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS10eXBlcy01ODZmMDMwMS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3N1YnNjcmlwdGlvbi0yMmNhYWUxYS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS90aWxlLWxheWVyLWYwZjllZjRiLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3V0aWxzLTliM2ZmY2Y3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0Rm9sZGVyRnJvbUlkLCBiIGFzIGdldEhvbWVGb2xkZXJGb3JVc2VyIH0gZnJvbSAnLi91c2VyLTNlYTY5YzNhLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuaW1wb3J0IHsgRCBhcyBERUZBVUxUX1RJTEVfTEFZRVJfM0RfVElMRVNfTEFZRVJfVFlQRSB9IGZyb20gJy4vdGlsZS1sYXllci1jZjA0ZmE5Ny5qcyc7XG5pbXBvcnQgeyBxIGFzIGdldFNlcnZpY2VBbmRMYXllckluZm8gfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItNTczYmI0NzMuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtVXBkYXRlSXRlbURhdGFGb3JUaWxlTGF5ZXIgfSBmcm9tICcuL3RpbGUtbGF5ZXItOGE3YjkzZGUuanMnO1xuXG5jb25zdCBpbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSA9IGFzeW5jIChpdGVtLCBvcHRpb25zKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgZXhpc3RpbmdJdGVtVHlwZSwgcG9ydGFsLCBleGlzdGluZ0l0ZW1QdWJsaXNoVHlwZSB9ID0gb3B0aW9ucztcbiAgICBjb25maWdTdGF0ZS5pbml0aWFsRm9sZGVyID1cbiAgICAgICAgKF9hID0gKGF3YWl0IGdldEZvbGRlckZyb21JZChpdGVtLmZvbGRlcklkIHx8IGl0ZW0ub3duZXJGb2xkZXIsIGl0ZW0uaXRlbU93bmVyKSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGdldEhvbWVGb2xkZXJGb3JVc2VyKGl0ZW0uaXRlbU93bmVyKTtcbiAgICBsZXQgdHlwZSA9IGl0ZW0udHlwZTtcbiAgICAvLyBBZnRlciBwdWJsaXNoLCBzb21laG93IHRoZSBuZXcgaXRlbSB3aWxsIGhhdmUgR2VvSlNPTiBpbnN0ZWFkIG9mIEdlb0pzb25cbiAgICBpZiAodHlwZSA9PT0gXCJHZW9KU09OXCIpIHtcbiAgICAgICAgdHlwZSA9IFwiR2VvSnNvblwiO1xuICAgIH1cbiAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gaXRlbS50aXRsZTtcbiAgICBpdGVtUHJvcGVydGllc1N0YXRlLmNhdGVnb3JpZXMgPSBpdGVtLmNhdGVnb3JpZXM7XG4gICAgY29uc3QgY3VyVGFnID0gaXRlbS50YWdzO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGN1clRhZykpIHtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzID0gY3VyVGFnIHx8IFtdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzID0gKGN1clRhZyAhPT0gbnVsbCAmJiBjdXJUYWcgIT09IHZvaWQgMCA/IGN1clRhZyA6IFwiXCIpLnNwbGl0KFwiLFwiKTtcbiAgICB9XG4gICAgYWRkSXRlbVN0YXRlLmlkID0gaXRlbS5pZDtcbiAgICBhZGRJdGVtU3RhdGUudHlwZSA9IHR5cGU7XG4gICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gaXRlbS5uYW1lO1xuICAgIGFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0gPSBpdGVtO1xuICAgIC8vIFRPRE86IGRldGVybWluZSBpZiB0aGlzIGlzIHRydWVcbiAgICAvLyBFbmFibGUgcHVibGlzaGluZyBjYXVzZXMgdGhpcyBidWcgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQwMTMzXG4gICAgYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmcgPSBleGlzdGluZ0l0ZW1UeXBlICE9PSBcInRpbGVMYXllclwiO1xuICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IGV4aXN0aW5nSXRlbVR5cGU7XG4gICAgc3dpdGNoIChleGlzdGluZ0l0ZW1UeXBlKSB7XG4gICAgICAgIGNhc2UgXCJmaWxlXCI6XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdLmZpbGVFeHRbMF07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInRpbGVMYXllclwiOlxuICAgICAgICAgICAgY29uc3QgeyBpZCwgdXJsLCB0aXRsZSB9ID0gaXRlbTtcbiAgICAgICAgICAgIGNvbnN0IFt7IGxheWVycywgdGFibGVzLCBzZXJ2aWNlSW5mbyB9XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgICAgICBnZXRTZXJ2aWNlQW5kTGF5ZXJJbmZvKHVybCwgZ2V0UmVzdEJhc2VVcmwocG9ydGFsKSwgdHJ1ZSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgY29uc3QgeyByZXN1bHQ6IHVwZGF0ZWRJdGVtRGF0YSB9ID0gYXdhaXQgZm9ybVVwZGF0ZUl0ZW1EYXRhRm9yVGlsZUxheWVyKHtcbiAgICAgICAgICAgICAgICBpdGVtSWQ6IGlkLFxuICAgICAgICAgICAgICAgIGl0ZW1Vcmw6IHVybCxcbiAgICAgICAgICAgICAgICBwdWJsaXNoVHlwZTogZXhpc3RpbmdJdGVtUHVibGlzaFR5cGUgPT09IFwidmVjdG9yVGlsZXNcIiA/IFwidmVjdG9yXCIgOiBcInJhc3RlclwiLFxuICAgICAgICAgICAgICAgIHBvcnRhbCxcbiAgICAgICAgICAgICAgICBmdWxsTGF5ZXJzOiBsYXllcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNvdXJjZVRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPSBleGlzdGluZ0l0ZW1QdWJsaXNoVHlwZTtcbiAgICAgICAgICAgIGlmIChhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPT09IFwiM2RUaWxlc1wiKSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlID0gREVGQVVMVF9USUxFX0xBWUVSXzNEX1RJTEVTX0xBWUVSX1RZUEU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyRGF0YSA9IHVwZGF0ZWRJdGVtRGF0YTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlQXV0b0NyZWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJCYXNlbWFwVHlwZSA9IFwic3RhbmRhcmRcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJCYXNlbWFwVXJsID0gXCJcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJGcm9tRmVhdHVyZUxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJMYXllcnMgPSBsYXllcnM7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyVGFibGVzID0gdGFibGVzO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRpbGVMYXllclNlcnZpY2VJbmZvID0gc2VydmljZUluZm87XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuY29uc3QgaW5pdGlhbGl6ZURhdGFzdG9yZVN0YXRlID0gKG9wdGlvbnMpID0+IHtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImRhdGFTdG9yZVwiO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJEYXRhIFN0b3JlXCI7XG4gICAgaWYgKCEob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBvcnRhbC5pc1BvcnRhbCkpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGVLZXl3b3JkcyA9IFtcIkRhdGEgU3RvcmUgY29ubmVjdGlvblwiXTtcbiAgICB9XG59O1xuXG5leHBvcnQgeyBpbml0aWFsaXplRGF0YXN0b3JlU3RhdGUgYXMgYSwgaW5pdGlhbGl6ZVdpdGhFeGlzdGluZ0l0ZW0gYXMgaSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbmV3LWl0ZW0tNDcxMDM3MjQuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGQgYXMgZ2V0RWxlbWVudCwgSCBhcyBIb3N0IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBmIGFzIGZyb21DYWNoZSwgciBhcyByZXF1ZXN0LCBtIGFzIGlzUG9ydGFsQmFja2VkQnlTRFMsIG4gYXMgZ2V0VXNlcklkLCBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYyBhcyBjb25maWdTdGF0ZSB9IGZyb20gJy4vY29uZmlnLTc1YWRmOTYyLmpzJztcbmltcG9ydCB7IHQgYXMgdGltZW91dCwgZCBhcyBkZWJvdW5jZSwgYiBhcyB1bmlxdWUgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgaSBhcyBpbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSwgYSBhcyBpbml0aWFsaXplRGF0YXN0b3JlU3RhdGUgfSBmcm9tICcuL2FyY2dpcy1uZXctaXRlbS00NzEwMzcyNC5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSwgYiBhcyBhZGRJdGVtVXJsU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IHMgYXMgc3Vic2NyaXB0aW9uU3RhdGUsIHIgYXMgcmVtb3ZlUGFyYW1ldGVyLCBmIGFzIGZldGNoQXBwbGljYXRpb25NYW5pZmVzdCwgYSBhcyBhZGRTZWN1cmVBR1NVcmwsIGkgYXMgaXNIeWJyaWRJbWFnZVNlcnZpY2UsIHAgYXMgcHJvY2Vzc1Bvc3RBZGRLTUwsIE0gYXMgTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFLCBiIGFzIGFkZEFwcGxpY2F0aW9uLCBjIGFzIGFkZEZlYXR1cmVMYXllciwgaCBhcyBoYW5kbGVBZGRVcmwsIGQgYXMgYWRkQ2xvdWRQcm92aWRlclJlc291cmNlLCBlIGFzIGFkZEZpbGUsIGcgYXMgaXNBcHBDb21wb25lbnRFcnJvciwgaiBhcyBpc0JhY2tlbmRFcnJvciwgayBhcyBhZGRGaWxlRnJvbURhdGFVcmwsIGwgYXMgc2VsZWN0T0dDRmVhdHVyZUxheWVyLCBtIGFzIGZvcm1hdEN1c3RvbVBhcmFtZXRlcnMsIG4gYXMgZ2V0VXJsU2VydmljZUluZm8sIG8gYXMgcGFyc2VBR1NUeXBlIH0gZnJvbSAnLi9mZWF0dXJlLWxheWVyLTU3M2JiNDczLmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlLCBhIGFzIHVpU3RvcmUgfSBmcm9tICcuL3VpLWJjYTdiY2QxLmpzJztcbmltcG9ydCB7IHIgYXMgcmVzZXRBZGRJdGVtU3RvcmVzIH0gZnJvbSAnLi91dGlscy05YjNmZmNmNy5qcyc7XG5pbXBvcnQgeyBBIGFzIEFMTF9ORVdfSVRFTV9NT0RFUywgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMsIGkgYXMgaXNVcmxUeXBlIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcbmltcG9ydCB7IHMgYXMgc2FuaXRpemVGaWxlSW5wdXQsIGEgYXMgc2FuaXRpemVGaWxlTmFtZSwgZiBhcyBmb3JtYXRGaWxlU2l6ZSB9IGZyb20gJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgeyBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlbGV0ZUl0ZW0sIGIgYXMgc2VuZEFkZEl0ZW1SZXF1ZXN0LCB1IGFzIHVwZGF0ZUl0ZW0sIGYgYXMgZm9ybWF0SXRlbVByb3BlcnRpZXMsIG0gYXMgbW92ZUl0ZW0sIGMgYXMgc2VhcmNoRm9yRXhpc3RpbmdJdGVtVXJsQnlOYW1lIH0gZnJvbSAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgeyBmIGFzIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uLCBpIGFzIGlzTGFyZ2VHZW9KU09OLCBhIGFzIGlzTGFyZ2VDU1YgfSBmcm9tICcuL2l0ZW0tdHlwZXMtNTg2ZjAzMDEuanMnO1xuaW1wb3J0IHsgYSBhcyBjYW5QdWJsaXNoVHlwZSwgZiBhcyBmZXRjaFVzZXJMaWNlbnNlZEl0ZW1zLCBiIGFzIGNhblB1Ymxpc2hGZWF0dXJlcywgZCBhcyBjYW5DcmVhdGVEZXZlbG9wZXJDcmVkZW50aWFscywgZSBhcyBjYW5QdWJsaXNoSW1hZ2VDb2xsZWN0aW9uLCBnIGFzIGNhblB1Ymxpc2hUaWxlcywgaCBhcyBjYW5QdWJsaXNoU2NlbmVzLCBpIGFzIGNhbkNyZWF0ZUxvY2F0b3JWaWV3LCBqIGFzIGNhbkNyZWF0ZUxvY2F0b3IsIGsgYXMgY2FuQ3JlYXRlRGF0YVN0b3JlLCBsIGFzIGNhbkNyZWF0ZUl0ZW1zIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTc0NjM5ZGFlLmpzJztcbmltcG9ydCB7IGwgYXMgbG9nVGlsZUxheWVyU3RhcnQsIGEgYXMgbG9nVGlsZUxheWVyRmluaXNoIH0gZnJvbSAnLi90aWxlLWxheWVyLWYwZjllZjRiLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0U3Vic2NyaXB0aW9uSW5mbyB9IGZyb20gJy4vc3Vic2NyaXB0aW9uLTIyY2FhZTFhLmpzJztcbmltcG9ydCB7IGEgYXMgaXNQdWJsaWNVc2VyLCBiIGFzIGlzT3JnQWRtaW4sIGMgYXMgaXNIb3N0ZWRQb3J0YWwgfSBmcm9tICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRBbGxvd2VkRmllbGRUeXBlcywgYSBhcyBnZXRBbmFseXplZExheWVySW5mbyB9IGZyb20gJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0h0dHAsIHUgYXMgdXJsVG9UaXRsZSwgcyBhcyBzdXBwb3J0c0RpcmVjdCwgZyBhcyBnZXRVcmxUeXBlLCBmIGFzIGZvcm1hdFVybCB9IGZyb20gJy4vdXJsLTM1ODc1YTEwLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UHJvdmlkZXIsIGEgYXMgZ2V0UmVzb3VyY2VJZGVudGlmaWVyLCBjIGFzIGNsb3VkRmlsZUljb25zLCBiIGFzIGNsb3VkRmlsZU5hbWVzIH0gZnJvbSAnLi9pbmRleC0wYTg0YjA2OC5qcyc7XG5pbXBvcnQgeyB1IGFzIHVwZGF0ZUNhdGVnb3JpZXMgfSBmcm9tICcuL2NhdGVnb3JpZXMtOWYwZjM3ZWUuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGREYXRhU3RvcmUsIHAgYXMgcHVibGlzaEZyb21EYXRhU3RvcmUgfSBmcm9tICcuL2RhdGEtc3RvcmUtZTJhZTZhNjcuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVJbWFnZUNvbGxlY3Rpb24gfSBmcm9tICcuL2ltYWdlLWNvbGxlY3Rpb24tNWI2NjJiODAuanMnO1xuaW1wb3J0IHsgYSBhcyBhcHBlbmRUeXBlS2V5d29yZHMsIGMgYXMgY2hlY2tKb2JTdGF0dXMsIHAgYXMgcHVibGlzaFNlcnZpY2UgfSBmcm9tICcuL3B1Ymxpc2gtaXRlbS0xN2QyZjlhMy5qcyc7XG5pbXBvcnQgeyBwIGFzIHB1Ymxpc2hUaWxlTGF5ZXIgfSBmcm9tICcuL3RpbGUtbGF5ZXItOGE3YjkzZGUuanMnO1xuaW1wb3J0IHsgdCBhcyB0aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZXMsIEQgYXMgREVGQVVMVF9USUxFX0xBWUVSXzNEX1RJTEVTX0xBWUVSX1RZUEUgfSBmcm9tICcuL3RpbGUtbGF5ZXItY2YwNGZhOTcuanMnO1xuaW1wb3J0IHsgciBhcyByZXBsYWNlSTE4TlN0cmluZyB9IGZyb20gJy4vaTE4bi0yOTk4ZWMzMC5qcyc7XG5pbXBvcnQgeyBmIGFzIGZlYXR1cmVMYXllckVycm9yVGVsZW1ldHJ5LCBhIGFzIGZlYXR1cmVTZXJ2aWNlRW5kVGVsZW1ldHJ5IH0gZnJvbSAnLi9mZWF0dXJlLWxheWVyLTU4ZTE4YjAzLmpzJztcbmltcG9ydCB7IGEgYXMgYW5hbHl6ZSB9IGZyb20gJy4vYW5hbHl6ZS02OWVjMDhjOC5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzQUdTLCBhIGFzIGFnc1NlcnZlck1hcCB9IGZyb20gJy4vYWdzLWViNDU4YTAzLmpzJztcbmltcG9ydCB7IGIgYXMgZ2VvSnNvblJlZ0V4cCwgcyBhcyBzcGVjaWFsQ2hhcmFjdGVyc1JlZ0V4cCB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi91c2VyLTNlYTY5YzNhLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTc5ZmIzMDJjLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtYmNiODllNjkuanMnO1xuaW1wb3J0ICcuL3NlcnZpY2UtOGMyYzQyNDEuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCAnLi9hcGktMmUzYTEzNmYuanMnO1xuaW1wb3J0ICcuL3N0cmluZy01OGE1ZmVmMy5qcyc7XG5pbXBvcnQgJy4vaXRlbS1jNThmZmNlZC5qcyc7XG5pbXBvcnQgJy4vZmVhdHVyZS1sYXllci0xN2I2NDk0Ni5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC04MTM3M2Y2ZC5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtNmE4OGU2YzUuanMnO1xuaW1wb3J0ICcuL2l0ZW0tMzUzNTU1MmQuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0ICcuL2dyb3VwLTZhNjMwM2IwLmpzJztcbmltcG9ydCAnLi9kYXRhLXN0b3JlLThlODNmYjdhLmpzJztcbmltcG9ydCAnLi9iYXNpYy02ZGI3ZWJkNy5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0ICcuL2FwcGVuZC00ZTExMDMyYy5qcyc7XG5cbi8vIFRPRE86IHJlbW92ZSBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiBvbmNlIHRoZSBidXNpbmVzcyBsb2dpYyBmb3IgZmVhdHVyZSBjb2xsZWN0aW9uIGlzIHJlYWR5XG5jb25zdCBjYW5Ta2lwUHVibGlzaFNlbGVjdFRvTmV4dFBhZ2UgPSAoeyBkaXJlY3RNb2RlLCBuZXdJdGVtTW9kZSwgaXRlbVR5cGUsIGNsb3VkLCBpc011bHRpcGFnZUV4Y2VsLCBmcm9tRXhpc3RpbmdJdGVtLCBjYW5QdWJsaXNoSXRlbVR5cGUgfSkgPT4ge1xuICAgIGlmIChmcm9tRXhpc3RpbmdJdGVtICYmICFpc011bHRpcGFnZUV4Y2VsKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoZGlyZWN0TW9kZSkge1xuICAgICAgICAvLyAjMjcyOCBmb3IgQ1NWIC0tLSAjMjczMSBmb3IgR2VvSlNPTlxuICAgICAgICBpZiAoKGNsb3VkICYmICFpc011bHRpcGFnZUV4Y2VsKSB8fFxuICAgICAgICAgICAgKCghaXNNdWx0aXBhZ2VFeGNlbCB8fCBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIikgJiZcbiAgICAgICAgICAgICAgICAoIWNhblB1Ymxpc2hJdGVtVHlwZSB8fCAoaXRlbVR5cGUgIT09IFwiR2VvSnNvblwiICYmIGl0ZW1UeXBlICE9PSBcIkNTVlwiKSkpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiogbWFwcGluZyBvZiBuZXh0IHBhZ2UgZGV0YWlsIHRvIGVsZW1lbnQgdGFnIG5hbWUgKi9cbmNvbnN0IHBhZ2VzID0ge1xuICAgIGFwcGxpY2F0aW9uOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBsaWNhdGlvblwiLFxuICAgIGF1dGg6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWF1dGhcIixcbiAgICBidWxrTGF5ZXJTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWJ1bGstbGF5ZXItc2VsZWN0XCIsXG4gICAgY2xvdWQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWNsb3VkXCIsXG4gICAgY3N2TG9jYXRpb25GaWVsZHM6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWNzdi1sb2NhdGlvbi1maWVsZHNcIixcbiAgICBkYXRhVXBsb2FkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXVwbG9hZFwiLFxuICAgIGRhdGFTdG9yZUJyb3dzZXI6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtYnJvd3NlclwiLFxuICAgIGRhdGFTdG9yZUxpc3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtbGlzdFwiLFxuICAgIGRhdGFTdG9yZVNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3RcIixcbiAgICBkYXRhU3RvcmVTZWxlY3RGb2xkZXI6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWZvbGRlclwiLFxuICAgIGRhdGFTdG9yZVNlbGVjdERhdGFiYXNlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1kYXRhYmFzZVwiLFxuICAgIGRhdGFTdG9yZVNlbGVjdERhdGFiYXNlVHlwZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtZGF0YWJhc2UtdHlwZVwiLFxuICAgIGRhdGFTdG9yZVNlbGVjdEJkZnM6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWJkZnNcIixcbiAgICBkYXRhU3RvcmVTZWxlY3RCZGZzQ2xvdWQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWJkZnMtY2xvdWRcIixcbiAgICBkYXRhU3RvcmVTZWxlY3RCZGZzRmlsZXNoYXJlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1iZGZzLWZpbGVzaGFyZVwiLFxuICAgIGRhdGFTdG9yZVNlbGVjdEJkZnNIZGZzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLXNlbGVjdC1iZGZzLWhkZnNcIixcbiAgICBkYXRhU3RvcmVTZWxlY3RCZGZzSGl2ZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtYmRmcy1oaXZlXCIsXG4gICAgZGF0YVN0b3JlU2VsZWN0Q2xvdWQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LWNsb3VkXCIsXG4gICAgZGF0YVN0b3JlU2VsZWN0Q2xvdWRDcmVkZW50aWFsczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtY2xvdWQtY3JlZGVudGlhbHNcIixcbiAgICBkYXRhU3RvcmVEYXRhYmFzZUNyZWRlbnRpYWxzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLWRhdGFiYXNlLWNyZWRlbnRpYWxzXCIsXG4gICAgZGF0YVN0b3JlU2VsZWN0Tm9TcWw6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWRhdGEtc3RvcmUtc2VsZWN0LW5vc3FsXCIsXG4gICAgZGF0YVN0b3JlU2VsZWN0Tm9TcWxDcmVkZW50aWFsczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3Qtbm9zcWwtY3JlZGVudGlhbHNcIixcbiAgICBkYXRhU3RvcmVTZWxlY3RBcmFuZ29DcmVkZW50aWFsczogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3QtYXJhbmdvLWNyZWRlbnRpYWxzXCIsXG4gICAgZGF0YVN0b3JlU2VsZWN0U2VydmVyTGlzdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1zZWxlY3Qtc2VydmVyLWxpc3RcIixcbiAgICBkZXZlbG9wZXJDcmVkZW50aWFsc1NlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGV2ZWxvcGVyLWNyZWRlbnRpYWxzLXNlbGVjdFwiLFxuICAgIGZlYXR1cmVMYXllckZyb21FeGlzdGluZzogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmVhdHVyZS1sYXllci1mcm9tLWV4aXN0aW5nXCIsXG4gICAgZmVhdHVyZUxheWVyRnJvbVNjcmF0Y2g6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWZlYXR1cmUtbGF5ZXItZnJvbS1zY3JhdGNoXCIsXG4gICAgZmVhdHVyZUxheWVyRnJvbVRlbXBsYXRlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLWZyb20tdGVtcGxhdGVcIixcbiAgICBmZWF0dXJlTGF5ZXJGcm9tVVJMOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLWZyb20tdXJsXCIsXG4gICAgZmVhdHVyZUxheWVyUHJlZmVyZW5jZTogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmVhdHVyZS1sYXllci1wcmVmZXJlbmNlXCIsXG4gICAgYXBwZW5kU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0XCIsXG4gICAgYXBwZW5kVXBsb2FkOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtdXBsb2FkXCIsXG4gICAgYXBwZW5kU2VsZWN0VXBkYXRlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LXVwZGF0ZVwiLFxuICAgIGFwcGVuZE1hdGNoRmllbGRzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtbWF0Y2gtZmllbGRzXCIsXG4gICAgYXBwZW5kS2V5UGFpclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLWtleS1wYWlyLXNlbGVjdFwiLFxuICAgIGFwcGVuZFNlbGVjdExheWVyOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtc2VsZWN0LWxheWVyXCIsXG4gICAgYXBwZW5kT3ZlcndyaXRlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtb3ZlcndyaXRlXCIsXG4gICAgYXBwZW5kRmluaXNoOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1hcHBlbmQtam9iXCIsXG4gICAgZmVhdHVyZUxheWVyU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLXNlbGVjdFwiLFxuICAgIGZlYXR1cmVMYXllclN1bW1hcnk6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWZlYXR1cmUtbGF5ZXItc3VtbWFyeVwiLFxuICAgIGZpbGVGaWVsZDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmlsZS1maWVsZHNcIixcbiAgICBoeWJyaWRJbWFnZVNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaHlicmlkLWltYWdlLXNlbGVjdFwiLFxuICAgIGl0ZW1Qcm9wZXJ0aWVzOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXNcIixcbiAgICBsYXllclVwbG9hZDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtbGF5ZXItdXBsb2FkXCIsXG4gICAgbG9jYXRvclNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtbG9jYXRvci1zZWxlY3RcIixcbiAgICBwdWJsaXNoU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1wdWJsaXNoLXNlbGVjdFwiLFxuICAgIHNjZW5lTGF5ZXJTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXNjZW5lLWxheWVyLXNlbGVjdFwiLFxuICAgIHNlcnZlckxpc3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXNlcnZlci1saXN0XCIsXG4gICAgc2VydmljZVNjb3BlOiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1zZXJ2aWNlLXNjb3BlXCIsXG4gICAgc2luZ2xlTGF5ZXJTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXNpbmdsZS1sYXllci1zZWxlY3RcIixcbiAgICB0aWxlTGF5ZXJGcm9tRXhpc3Rpbmc6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItZnJvbS1leGlzdGluZ1wiLFxuICAgIHRpbGVMYXllckZyb21Vcmw6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItZnJvbS11cmxcIixcbiAgICB0aWxlTGF5ZXJTZWxlY3Q6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItc2VsZWN0XCIsXG4gICAgdGlsZUxheWVyU2V0dGluZ3M6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItc2V0dGluZ3NcIixcbiAgICB1cmxUeXBlU2VsZWN0OiBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy11cmwtdHlwZVwiLFxuICAgIHppcFNlbGVjdDogXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtemlwLXNlbGVjdFwiLFxuICAgIGRlZmF1bHQ6IFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWhvbWVcIlxufTtcblxuY29uc3QgaGFuZGxlSW5pdFdpdGhGaWxlID0gKGZpbGUpID0+IHtcbiAgICBjb25zdCB7IHRpdGxlLCBmaWxlTmFtZSwgZXh0ZW5zaW9uIH0gPSBzYW5pdGl6ZUZpbGVJbnB1dChmaWxlKTtcbiAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gdGl0bGU7XG4gICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBmaWxlO1xuICAgIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZmlsZVwiO1xuICAgIGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24gPSBleHRlbnNpb247XG4gICAgcmV0dXJuIGV4dGVuc2lvbjtcbn07XG5jb25zdCBhbmFseXplSXRlbUZvck5leHRTdGVwID0gKGV4dGVuc2lvbikgPT4ge1xuICAgIGNvbnN0IHBvc3NpYmxlSXRlbVR5cGVzID0gZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uKTtcbiAgICBjb25zdCBpdGVtVHlwZSA9IHBvc3NpYmxlSXRlbVR5cGVzWzBdO1xuICAgIGNvbnN0IHsgdHlwZSwgbmV4dFN0ZXAgfSA9IGl0ZW1UeXBlO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gdHlwZTtcbiAgICByZXR1cm4geyBuZXh0U3RlcCwgdHlwZSB9O1xufTtcbmNvbnN0IGhhbmRsZURlbGV0ZUl0ZW0gPSBhc3luYyAoaXRlbUlkLCBmcm9tRXhpc3RpbmdJdGVtKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaXRlbUlkICYmICFmcm9tRXhpc3RpbmdJdGVtICYmIChhd2FpdCBkZWxldGVJdGVtKGl0ZW1JZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSkpO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgLy8gaWYgbm8gZXhpc3RpbmcgaXRlbSB3YXMgZm91bmQsIGFzc3VtZSBpdCdzIG5vdCB0aGVyZSwgc2FmZSB0byBwcm9jZWVkLiAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzQwMDQwKVxuICAgICAgICByZXR1cm47XG4gICAgfVxufTtcblxuY29uc3QgVEVMRU1FVFJZX0lEID0gXCJuZXcgaXRlbVwiO1xuY29uc3QgVEVMRU1FVFJZX1BBR0VfTkFNRSA9IFwibXkgY29udGVudFwiO1xuZnVuY3Rpb24gbG9nQWRkTmV3SXRlbVN0YXJ0KCkge1xuICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuc3RhcnRXb3JrZmxvdyhcIm5ldyBpdGVtIHVwbG9hZFwiLCB7XG4gICAgICAgIGV2ZW50VHlwZTogXCJ3b3JrZmxvd1wiLFxuICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbSB1cGxvYWRcIixcbiAgICAgICAgZGV0YWlsczogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2dTdWNjZXNzZnVsSXRlbUNyZWF0aW9uKCkge1xuICAgIGNvbnN0IHsgdHlwZSwgYXBwbGljYXRpb25UeXBlLCBjdXN0b21QYXJhbWV0ZXJzLCBzZWxlY3RlZExheWVySWRUcmFja2VyIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgIGNvbnN0IHRlbGVtZXRyeURldGFpbHMgPSB1aVN0b3JlU3RhdGUudGVsZW1ldHJ5RGV0YWlscztcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuZW5kV29ya2Zsb3coXCJuZXcgaXRlbSB1cGxvYWRcIiwge1xuICAgICAgICBkZXRhaWxzOiB0eXBlLFxuICAgICAgICBwYWdlTmFtZTogVEVMRU1FVFJZX1BBR0VfTkFNRVxuICAgIH0pO1xuICAgIC8vIFNldCB1cCB0ZWxlbWV0cnkgcGF5bG9hZCBiYXNlZCBvbiB0aGUgcGF0aCB0aGUgdXNlciB0b29rXG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgZXZlbnRUeXBlOiBcIm90aGVyXCIsXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FLFxuICAgICAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgICAgICBsYWJlbDogVEVMRU1FVFJZX0lELFxuICAgICAgICBkZXRhaWxzOiB0ZWxlbWV0cnlEZXRhaWxzXG4gICAgfTtcbiAgICBpZiAodGVsZW1ldHJ5RGV0YWlscyA9PT0gXCJ1cmxcIikge1xuICAgICAgICBwYXlsb2FkLmF0dHJpYnV0ZSA9IHR5cGU7XG4gICAgICAgIGlmICgoY3VzdG9tUGFyYW1ldGVycyA9PT0gbnVsbCB8fCBjdXN0b21QYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXN0b21QYXJhbWV0ZXJzLmxlbmd0aCkgPiAwKSB7XG4gICAgICAgICAgICBwYXlsb2FkLmFjdGlvbiA9IFwiY3VzdG9tUGFyYW1zXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUgPT09IFwiV01TXCIpIHtcbiAgICAgICAgICAgIHBheWxvYWQuY291bnQgPSBzZWxlY3RlZExheWVySWRUcmFja2VyID09PSBudWxsIHx8IHNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIuY291bnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoYXBwbGljYXRpb25UeXBlKSB7XG4gICAgICAgIHBheWxvYWQuYXR0cmlidXRlID0gYXBwbGljYXRpb25UeXBlO1xuICAgIH1cbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG59XG5jb25zdCBsb2dJbml0V2l0aEZpbGUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyB0ZWxlbWV0cnkgfSA9IGNvbmZpZ1N0YXRlO1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgICAgIGNhdGVnb3J5OiBcImNvbnRlbnQgcGFnZSBkcmFnIGRyb3BcIixcbiAgICAgICAgbGFiZWw6IFwiY29udGVudFwiXG4gICAgfTtcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gICAgdWlTdG9yZVN0YXRlLnRlbGVtZXRyeURldGFpbHMgPSBcImRyYWcgZHJvcFwiO1xufTtcbmZ1bmN0aW9uIGxvZ0l0ZW1Qcm9wZXJ0aWVzQ2hhbmdlcygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICBjb25zdCB7IHRpdGxlLCBmb2xkZXIsIGNhdGVnb3JpZXMsIHRhZ3MsIHNuaXBwZXQgfSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGU7XG4gICAgY29uc3QgeyBpbml0aWFsVGl0bGUsIGluaXRpYWxGb2xkZXJzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgY29uc3QgaG9tZUZvbGRlciA9ICFmb2xkZXIgfHwgZm9sZGVyLnRpdGxlID09PSBmb2xkZXIuaWQ7XG4gICAgY29uc3QgZXhpc3RpbmdGb2xkZXIgPSAhIWluaXRpYWxGb2xkZXJzLm1hcCgoZm9sZGVyKSA9PiBmb2xkZXIuaWQpLmZpbmQoKGlkKSA9PiBpZCA9PT0gZm9sZGVyLmlkKTtcbiAgICAvLyBMb2cgY2hhbmdlcyB0aGUgdXNlciBoYXMgbWFkZSB0byBkZWZhdWx0IGl0ZW0gcHJvcGVydGllc1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICBwYWdlTmFtZTogVEVMRU1FVFJZX1BBR0VfTkFNRSxcbiAgICAgICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gaXRlbSBpbmZvXCIsXG4gICAgICAgIGxhYmVsOiB0aXRsZSA9PT0gaW5pdGlhbFRpdGxlID8gXCJkZWZhdWx0IHRpdGxlXCIgOiBcInRpdGxlIGNoYW5nZWRcIixcbiAgICAgICAgYWN0aW9uOiAoc25pcHBldCA9PT0gbnVsbCB8fCBzbmlwcGV0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmlwcGV0Lmxlbmd0aCkgPiAwID8gXCJzdW1tYXJ5XCIgOiBcIm5vIHN1bW1hcnlcIixcbiAgICAgICAgY291bnQ6IChfYSA9IHRhZ3MgPT09IG51bGwgfHwgdGFncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGFncy5sZW5ndGgpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDAsXG4gICAgICAgIG51bWJlcjogKF9iID0gY2F0ZWdvcmllcyA9PT0gbnVsbCB8fCBjYXRlZ29yaWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjYXRlZ29yaWVzLmxlbmd0aCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMFxuICAgIH07XG4gICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgYWRkZWQgdG8gYSBmb2xkZXIgdGhleSBjcmVhdGVkIHdpdGhpbiBpdGVtIHByb3BlcnRpZXNcbiAgICBpZiAoIWV4aXN0aW5nRm9sZGVyKSB7XG4gICAgICAgIHBheWxvYWQuZGV0YWlscyA9IFwibmV3IGZvbGRlclwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcGF5bG9hZC5kZXRhaWxzID0gaG9tZUZvbGRlciA/IFwicm9vdCBmb2xkZXJcIiA6IFwiY3VzdG9tIGZvbGRlclwiO1xuICAgIH1cbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG59XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1Dc3MgPSBcIi5zdGFnZXtib3gtc2l6aW5nOmJvcmRlci1ib3g7ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlO3BhZGRpbmctbGVmdDoxcHg7cGFkZGluZy1yaWdodDoxcHg7cGFkZGluZy1ib3R0b206MS41cmVtO29wYWNpdHk6MTtoZWlnaHQ6Y2FsYygxMDAlIC0gMnJlbSk7dHJhbnNpdGlvbjphbGwgMjAwbXMgZWFzZS1pbi1vdXR9QG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDogMTA4MHB4KXsuc3RhZ2V7aGVpZ2h0Om1pbig3MDBweCwgNjB2aCl9fS5zdGFnZS0tZnVsbHNjcmVlbntoZWlnaHQ6MTAwJTtvdmVyZmxvdzphdXRvO3BhZGRpbmctYm90dG9tOjBweH0uc3RhZ2UtLWRpc2FibGUtc2Nyb2xse292ZXJmbG93OmhpZGRlbjtoZWlnaHQ6MzN2aH0uc3RhZ2UtYW5pbXt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMCwgMCl9LnN0YWdlLWFuaW0tLWxlYXZpbmd7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6Y2FsYygxMDAlIC0gNHJlbSl9LnN0YWdlLWFuaW0tLWxlZnR7b3BhY2l0eTowO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgtMjRweCwgMCwgMCl9LnN0YWdlLWFuaW0tLXJpZ2h0e29wYWNpdHk6MDt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMjRweCwgMCwgMCl9LmhlYWRlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO3Bvc2l0aW9uOnJlbGF0aXZlfS5oZWFkZXI+Lmljb257Ym9yZGVyLXN0eWxlOm5vbmU7bWFyZ2luLWxlZnQ6MC41cmVtO21hcmdpbi1yaWdodDowLjVyZW07cGFkZGluZzowcHg7ZGlzcGxheTpmbGV4O2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnR9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpey5zdGFnZXtwYWRkaW5nLWJvdHRvbTo2cmVtfX0uaGVhZGVyX190aXRsZXtmb250LXNpemU6MS4xMjVyZW07bWFyZ2luOjBweDtwYWRkaW5nOjBweDtmb250LXdlaWdodDo1MDB9LmNvbnRlbnR7aGVpZ2h0OjEwMCV9Lm9uYm9hcmRpbmd7LS1hcmNnaXMtaW5mb3JtYXRpb24tbWluLXdpZHRoOjB9Lm9uYm9hcmRpbmdfX3Njcm9sbHtvdmVyZmxvdzphdXRvO21heC1oZWlnaHQ6bWluKDcwMHB4LCA2MHZoKX0ub25ib2FyZGluZ19fc2VjdGlvbntwYWRkaW5nLWJvdHRvbToxcmVtO3BhZGRpbmctdG9wOjAuNXJlbTt3aWR0aDoyNTVweH0ub25ib2FyZGluZ19fdGl0bGV7bWFyZ2luOjBweDtwYWRkaW5nLXRvcDowcHg7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtmb250LXdlaWdodDo2MDB9Lm9uYm9hcmRpbmdfX2Rlc2NyaXB0aW9ue21hcmdpbi10b3A6MC41cmVtO21hcmdpbi1ib3R0b206MC43NXJlbTtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9Lm1vZGFsey0tY2FsY2l0ZS1tb2RhbC13aWR0aDoxMDgwcHg7LS1jYWxjaXRlLW1vZGFsLWhlaWdodDptaW4oOTIycHgsIDc1dmgpfS5tb2RhbC0tZ3JleXstLWNhbGNpdGUtbW9kYWwtY29udGVudC1wYWRkaW5nOjA7LS1jYWxjaXRlLW1vZGFsLWNvbnRlbnQtYmFja2dyb3VuZDp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpfVwiO1xuXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT04gPSAyMDA7XG5jb25zdCBBcmNnaXNOZXdJdGVtID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDYW5jZWxcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5zaG93QmFja0J1dHRvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2cgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGlkLCBleGlzdGluZ0l0ZW0gfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGZyb21FeGlzdGluZ0l0ZW0gPSAhIWV4aXN0aW5nSXRlbSAmJiB1aVN0b3JlU3RhdGUud29ya2Zsb3cgIT09IFwiYXBwZW5kXCI7IC8vZG9uJ3Qgd2FudCB0byBkZWxldGUgSEZMIGl0ZW0gYmVmb3JlIG5ldyBmaWxlIGlzIHVwbG9hZGVkLlxuICAgICAgICAgICAgIXRoaXMud29ya2Zsb3dDb21wbGV0ZWQgJiYgdGhpcy5oYW5kbGVDYW5jZWwoaWQsIGZyb21FeGlzdGluZ0l0ZW0pO1xuICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzZXRBZGRJdGVtU3RvcmVzKCk7XG4gICAgICAgICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wiaG9tZVwiXTtcbiAgICAgICAgICAgIC8vIFJlc2V0IHRvIG1ha2Ugc3VyZSBpZiB0aGUgbW9kYWwgaXMgb3BlbmVkIGFnYWluLCBpdCB3aWxsIGJlIGluIHRoZSBkZWZhdWx0IHN0YXRlXG4gICAgICAgICAgICAvLyAgYW5kIGFueSBuZXh0VGV4dCBjaGFuZ2Ugd2lsbCB0cmlnZ2VyIHRoZSBgb25DaGFuZ2UgcHJvcGVybHlcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwibmV4dFwiO1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQzMjgwXG4gICAgICAgICAgICAvLyBtYWludGFpbiBpdGVtIGlkIG9uIHNldHRpbmcgcGFnZSByZWdpc3RlciBjYW5jZWxcbiAgICAgICAgICAgIC8vIFIyIFRPRE86IGltcHJvdmUgc3RvcmUgY2xlYW51cC9yZWluaXRpYWxpemF0aW9uXG4gICAgICAgICAgICBpZiAodGhpcy53b3JrZmxvdyA9PT0gXCJyZWdpc3RlclwiKSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmlkID0gaWQ7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmV4aXN0aW5nSXRlbSA9IGV4aXN0aW5nSXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSBhc3luYyAoaXRlbUlkLCBmcm9tRXhpc3RpbmdJdGVtKSA9PiB7XG4gICAgICAgICAgICBsZXQgY2FuY2VsUGF5bG9hZDtcbiAgICAgICAgICAgIGNvbnN0IHsgb3ZlcndyaXRlUGF5bG9hZCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgaWYgKG92ZXJ3cml0ZVBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICBjYW5jZWxQYXlsb2FkID0gb3ZlcndyaXRlUGF5bG9hZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IHN1YnNjcmlwdGlvblN0YXRlLnVuc3Vic2NyaWJlQWxsKCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgaGFuZGxlRGVsZXRlSXRlbShpdGVtSWQsIGZyb21FeGlzdGluZ0l0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbC5lbWl0KGNhbmNlbFBheWxvYWQpO1xuICAgICAgICAgICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgICAgICAgICAgKHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5nZXRXb3JrZmxvdyhcIm5ldyBpdGVtIHVwbG9hZFwiKSkgJiZcbiAgICAgICAgICAgICAgICAodGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmNhbmNlbFdvcmtmbG93KFwibmV3IGl0ZW0gdXBsb2FkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsczogYWRkSXRlbVN0YXRlLnR5cGVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYXBpID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50ZWxlbWV0cnkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmlsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maXJzdFN0ZXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW5pdGlhbEZvbGRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGF5ZXJJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leGlzdGluZ0l0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhpc3RpbmdJdGVtVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leGlzdGluZ0l0ZW1QdWJsaXNoVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy53b3JrZmxvdyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbGxvd2VkSXRlbVR5cGVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsbG93ZWRNb2RlcyA9IFsuLi5BTExfTkVXX0lURU1fTU9ERVNdO1xuICAgICAgICB0aGlzLmFsbG93UHVibGlzaCA9IHRydWU7XG4gICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCJdO1xuICAgICAgICB0aGlzLmluaXRpYWxQYWdlID0gXCJkZWZhdWx0XCI7XG4gICAgICAgIHRoaXMubmF2RW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50YXJnZXRIZWlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3V0ZXJIZWlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHJpbWFyeUJ1dHRvblRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubm9QYWRkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxvYWRpbmdUZXh0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRpc2FibGVDbG9zZUJ1dHRvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhlYWRlckljb25SZWYgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGRpc2FibGVOYXZCdXR0b25zKGV2ZW50KSB7XG4gICAgICAgIHRoaXMubmF2RW5hYmxlZCA9IGV2ZW50LmRldGFpbDtcbiAgICB9XG4gICAgZGlzYWJsZUNsb3NlQnV0dG9ucyhldmVudCkge1xuICAgICAgICAvL2Rpc2FibGVzIFwiQ2FuY2VsXCIgYW5kIFwieFwiIGJ1dHRvbnMgb24gbW9kYWxcbiAgICAgICAgaWYgKHRoaXMuaXNEaXNhYmxlQ2xvc2VQYWdlKHRoaXMucGFnZUhpc3RvcnlbdGhpcy5wYWdlSGlzdG9yeS5sZW5ndGggLSAxXSkpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZUNsb3NlQnV0dG9uID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVJlZGlyZWN0KHsgZGV0YWlsIH0pIHtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHJlc3BvbnNlOiB7IHN1Y2Nlc3M6IHRydWUsIGlkOiBudWxsLCBmb2xkZXI6IG51bGwgfSxcbiAgICAgICAgICAgIHR5cGU6IGRldGFpbC50eXBlXG4gICAgICAgIH07XG4gICAgICAgIGlmIChkZXRhaWwudXJsKSB7XG4gICAgICAgICAgICBwYXlsb2FkLnVybCA9IGRldGFpbC51cmw7XG4gICAgICAgICAgICBwYXlsb2FkLmN1c3RvbVBhcmFtZXRlcnMgPSBkZXRhaWwuY3VzdG9tUGFyYW1ldGVycztcbiAgICAgICAgICAgIHBheWxvYWQubGF5ZXJzID0gZGV0YWlsLmxheWVycztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChwYXlsb2FkKTtcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBoYW5kbGVXb3JrZmxvd0NvbXBsZXRlKCkge1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgaWYgKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIikge1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nVGV4dCA9IHRoaXMuaTE4bi5jcmVhdGluZ0xheWVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGdvVG9OZXh0UGFnZShldmVudCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgLy8gUmVzZXQgaW4gY2FzZSB3ZSBmb3JnZXQgdG8gc2V0IGl0XG4gICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwibmV4dFwiO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSBcImZvcndhcmRcIjtcbiAgICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFsuLi50aGlzLnBhZ2VIaXN0b3J5LCBldmVudC5kZXRhaWxdO1xuICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IG51bGw7XG4gICAgICAgIHRoaXMub3V0ZXJIZWlnaHQgPSB0aGlzLmNvbnRlbnRTbG90Lm9mZnNldEhlaWdodDtcbiAgICAgICAgdGhpcy5jbGVhblBhZ2VIaXN0b3J5KCk7XG4gICAgICAgIGNvbnN0IG9sZFBhZ2UgPSB0aGlzLmN1cnJlbnRTY3JlZW47XG4gICAgICAgIGNvbnN0IG5ld1BhZ2UgPSBwYWdlc1tldmVudC5kZXRhaWxdO1xuICAgICAgICBjb25zdCBvbGRQYWdlSGVpZ2h0ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKG9sZFBhZ2UpLmNsaWVudEhlaWdodDtcbiAgICAgICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IChfYSA9IHRoaXMubW9kYWxSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGVudFwiKTtcbiAgICAgICAgaWYgKGNvbnRlbnRDb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRlbnRDb250YWluZXIuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICAgICAgY29uc3QgbmV3UGFnZUhlaWdodCA9IChfYiA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcihuZXdQYWdlKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNsaWVudEhlaWdodDtcbiAgICAgICAgaWYgKG5ld1BhZ2VIZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0SGVpZ2h0ID0gb2xkUGFnZUhlaWdodDtcbiAgICAgICAgICAgIHRoaXMub3V0ZXJIZWlnaHQgPSBudWxsO1xuICAgICAgICAgICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgICAgICAgICAgdGhpcy50YXJnZXRIZWlnaHQgPSBuZXdQYWdlSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICAgICAgdGhpcy50YXJnZXRIZWlnaHQgPSBudWxsO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsO1xuICAgICAgICBhd2FpdCB0aW1lb3V0KEFOSU1BVElPTl9EVVJBVElPTik7XG4gICAgICAgIGlmIChjb250ZW50Q29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250ZW50Q29udGFpbmVyLnN0eWxlLm92ZXJmbG93WSA9IFwiYXV0b1wiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRyYW5zaXRpb25Db21wbGV0ZUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KFwiYXJjZ2lzVHJhbnNpdGlvbkNvbXBsZXRlXCIpO1xuICAgICAgICAoX2MgPSB0aGlzLmN1cnJlbnRQYWdlRWwpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kaXNwYXRjaEV2ZW50KHRyYW5zaXRpb25Db21wbGV0ZUV2ZW50KTtcbiAgICAgICAgdGhpcy5mb2N1c0ZpcnN0RWxlbWVudCgpO1xuICAgIH1cbiAgICBhc3luYyBnb1RvUHJldmlvdXNQYWdlKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgLy8gUmVzZXQgaW4gY2FzZSB3ZSBmb3JnZXQgdG9cbiAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJuZXh0XCI7XG4gICAgICAgIGNvbnN0IHsgcGFnZUhpc3RvcnkgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IFwiYmFja1wiO1xuICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IG51bGw7XG4gICAgICAgIHRoaXMub3V0ZXJIZWlnaHQgPSB0aGlzLmNvbnRlbnRTbG90Lm9mZnNldEhlaWdodDtcbiAgICAgICAgY29uc3Qgb2xkUGFnZSA9IHBhZ2VzW3BhZ2VIaXN0b3J5W3BhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdXSB8fCBwYWdlcy5kZWZhdWx0O1xuICAgICAgICBjb25zdCBuZXdQYWdlID0gcGFnZXNbcGFnZUhpc3RvcnlbcGFnZUhpc3RvcnkubGVuZ3RoIC0gMl1dIHx8IHBhZ2VzLmRlZmF1bHQ7XG4gICAgICAgIGNvbnN0IG9sZFBhZ2VIZWlnaHQgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3Iob2xkUGFnZSkuY2xpZW50SGVpZ2h0O1xuICAgICAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gKF9hID0gdGhpcy5tb2RhbFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5jb250ZW50XCIpO1xuICAgICAgICBpZiAoY29udGVudENvbnRhaW5lcikge1xuICAgICAgICAgICAgY29udGVudENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgICAgICBjb25zdCBuZXdQYWdlSGVpZ2h0ID0gKF9iID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKG5ld1BhZ2UpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xpZW50SGVpZ2h0O1xuICAgICAgICBpZiAobmV3UGFnZUhlaWdodCkge1xuICAgICAgICAgICAgdGhpcy50YXJnZXRIZWlnaHQgPSBvbGRQYWdlSGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5vdXRlckhlaWdodCA9IG51bGw7XG4gICAgICAgICAgICBhd2FpdCB0aW1lb3V0KEFOSU1BVElPTl9EVVJBVElPTik7XG4gICAgICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IG5ld1BhZ2VIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgdGltZW91dChBTklNQVRJT05fRFVSQVRJT04pO1xuICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IG51bGw7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPVxuICAgICAgICAgICAgdGhpcy5wYWdlSGlzdG9yeS5sZW5ndGggPT09IDEgPyB0aGlzLnBhZ2VIaXN0b3J5LnNsaWNlKDAsIDEpIDogdGhpcy5wYWdlSGlzdG9yeS5zbGljZSgwLCAtMSk7XG4gICAgICAgIGF3YWl0IHRpbWVvdXQoQU5JTUFUSU9OX0RVUkFUSU9OKTtcbiAgICAgICAgaWYgKGNvbnRlbnRDb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRlbnRDb250YWluZXIuc3R5bGUub3ZlcmZsb3dZID0gXCJhdXRvXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdHJhbnNpdGlvbkNvbXBsZXRlRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoXCJhcmNnaXNUcmFuc2l0aW9uQ29tcGxldGVcIik7XG4gICAgICAgIChfYyA9IHRoaXMuY3VycmVudFBhZ2VFbCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRpc3BhdGNoRXZlbnQodHJhbnNpdGlvbkNvbXBsZXRlRXZlbnQpO1xuICAgICAgICB0aGlzLmZvY3VzRmlyc3RFbGVtZW50KCk7XG4gICAgfVxuICAgIHVwZGF0ZUFjdGl2ZShhY3RpdmUpIHtcbiAgICAgICAgaWYgKGFjdGl2ZSAmJiB0aGlzLmZpcnN0U3RlcCkge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplV2l0aEZpcnN0U3RlcCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUZpcnN0U3RlcCgpIHtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplV2l0aEZpcnN0U3RlcCgpO1xuICAgIH1cbiAgICBpbml0aWFsaXplV2l0aEZpbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgeyBmaWxlIH0gPSB0aGlzO1xuICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gaGFuZGxlSW5pdFdpdGhGaWxlKGZpbGUpO1xuICAgICAgICAgICAgaWYgKGV4dGVuc2lvbiA9PT0gXCJ6aXBcIikge1xuICAgICAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCIsIFwiemlwU2VsZWN0XCJdO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgbmV4dFN0ZXAsIHR5cGUgfSA9IGFuYWx5emVJdGVtRm9yTmV4dFN0ZXAoZXh0ZW5zaW9uKTtcbiAgICAgICAgICAgIHRoaXMucG9zdHByb2Nlc3NBZGRGcm9tRmlsZSh0eXBlKTtcbiAgICAgICAgICAgIC8vIHRoZXJlIGlzIG5vIHJlYXNvbiB0byBzaG93IHB1Ymxpc2hTZWxlY3Qgc2NyZWVuIGZvciB1c2VycyB0aGF0IGNhbid0IHB1Ymxpc2hcbiAgICAgICAgICAgIGlmICgoIWNhblB1Ymxpc2hUeXBlKHVzZXIsIHR5cGUsIHBvcnRhbCkgfHwgdGhpcy5hbGxvd1B1Ymxpc2ggPT09IGZhbHNlKSAmJlxuICAgICAgICAgICAgICAgIG5leHRTdGVwID09PSBcInB1Ymxpc2hTZWxlY3RcIikge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5lbmFibGVQdWJsaXNoaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcImhvbWVcIiwgXCJpdGVtUHJvcGVydGllc1wiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJob21lXCIsIG5leHRTdGVwXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZ0luaXRXaXRoRmlsZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBvc3Rwcm9jZXNzQWRkRnJvbUZpbGUodHlwZSkge1xuICAgICAgICBhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPSB0eXBlID09PSBcIjNEVGlsZXMgUGFja2FnZVwiID8gXCIzZFRpbGVzXCIgOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHVwZGF0ZUluaXRpYWxGb2xkZXIoZm9sZGVyKSB7XG4gICAgICAgIGNvbmZpZ1N0YXRlLmluaXRpYWxGb2xkZXIgPSBmb2xkZXI7XG4gICAgfVxuICAgIGZvY3VzRmlyc3RFbGVtZW50KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGN1clBhZ2UgPSB0aGlzLmN1cnJlbnRQYWdlRWw7XG4gICAgICAgIGlmIChjdXJQYWdlICYmICFjdXJQYWdlLm1hbmFnZWRGb2N1cykge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5tb2RhbFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVtb3ZlUGFnZUZyb21IaXN0b3J5KHBhZ2UpIHtcbiAgICAgICAgY29uc3QgeyBwYWdlSGlzdG9yeSB9ID0gdGhpcztcbiAgICAgICAgaWYgKHBhZ2VIaXN0b3J5Lmxlbmd0aCA+IDEgJiYgcGFnZUhpc3RvcnkuaW5jbHVkZXMocGFnZSkgJiYgcGFnZUhpc3RvcnkuYXQoLTEpICE9PSBwYWdlKSB7XG4gICAgICAgICAgICBwYWdlSGlzdG9yeS5zcGxpY2UocGFnZUhpc3RvcnkuaW5kZXhPZihwYWdlKSwgMSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xlYW5QYWdlSGlzdG9yeSgpIHtcbiAgICAgICAgY29uc3QgeyBuZXdJdGVtTW9kZSwgdHlwZSwgZXhjZWxMYXllcnMsIGV4aXN0aW5nSXRlbSwgY2xvdWRQcm92aWRlclJlc291cmNlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHByZXZQYWdlID0gdGhpcy5wYWdlSGlzdG9yeVt0aGlzLnBhZ2VIaXN0b3J5Lmxlbmd0aCAtIDJdO1xuICAgICAgICBjb25zdCBpc011bHRpcGFnZUV4Y2VsID0gdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIiAmJiAoZXhjZWxMYXllcnMgPT09IG51bGwgfHwgZXhjZWxMYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4Y2VsTGF5ZXJzLmxlbmd0aCkgPiAxO1xuICAgICAgICBjb25zdCBkaXJlY3RNb2RlID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgICAgICBpZiAoY2FuU2tpcFB1Ymxpc2hTZWxlY3RUb05leHRQYWdlKHtcbiAgICAgICAgICAgIGRpcmVjdE1vZGUsXG4gICAgICAgICAgICBpc011bHRpcGFnZUV4Y2VsLFxuICAgICAgICAgICAgbmV3SXRlbU1vZGUsXG4gICAgICAgICAgICBpdGVtVHlwZTogdHlwZSxcbiAgICAgICAgICAgIGNsb3VkOiAhIWNsb3VkUHJvdmlkZXJSZXNvdXJjZSxcbiAgICAgICAgICAgIC8vICMzODQ4MTogQWZ0ZXIgYSBDU1YvSnNvbiBoYXMgYmVlbiBhbmFseXplZCBmb3IgcHVibGlzaCwgcmVtb3ZlIHB1Ymxpc2hTZWxlY3QgZnJvbSBoaXN0b3J5XG4gICAgICAgICAgICAvLyBFeGNlbCBmaWxlcyB3aXRoIG11bHRpcGxlIHNoZWV0cyBzaG91bGQgc3RpbGwgaGF2ZSBhY2Nlc3NcbiAgICAgICAgICAgIGZyb21FeGlzdGluZ0l0ZW06ICEhZXhpc3RpbmdJdGVtLFxuICAgICAgICAgICAgY2FuUHVibGlzaEl0ZW1UeXBlOiBjYW5QdWJsaXNoVHlwZShjb25maWdTdGF0ZS51c2VyLCB0eXBlLCBjb25maWdTdGF0ZS5wb3J0YWwpXG4gICAgICAgIH0pICYmXG4gICAgICAgICAgICBwcmV2UGFnZSA9PT0gXCJwdWJsaXNoU2VsZWN0XCIpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlUGFnZUZyb21IaXN0b3J5KFwicHVibGlzaFNlbGVjdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSgpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZXhpc3RpbmdJdGVtO1xuICAgICAgICBjb25zdCBleGlzdGluZ0l0ZW1UeXBlID0gdGhpcy5leGlzdGluZ0l0ZW1UeXBlO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgIGF3YWl0IGluaXRpYWxpemVXaXRoRXhpc3RpbmdJdGVtKGl0ZW0sIHtcbiAgICAgICAgICAgIGV4aXN0aW5nSXRlbVR5cGUsXG4gICAgICAgICAgICBwb3J0YWw6IGNvbmZpZ1N0YXRlLnBvcnRhbCxcbiAgICAgICAgICAgIGV4aXN0aW5nSXRlbVB1Ymxpc2hUeXBlOiB0aGlzLmV4aXN0aW5nSXRlbVB1Ymxpc2hUeXBlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICBjb25zdCB0eXBlID0gaXRlbS50eXBlO1xuICAgICAgICBpZiAodGhpcy53b3JrZmxvdyA9PT0gXCJhcHBlbmRcIikge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmxheWVySWQgPSB0aGlzID09PSBudWxsIHx8IHRoaXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRoaXMubGF5ZXJJZDtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zdWJsYXllciA9IHRoaXMgPT09IG51bGwgfHwgdGhpcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGhpcy5sYXllcjtcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9IFwiYXBwZW5kXCI7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxQYWdlID0gXCJhcHBlbmRTZWxlY3RcIjtcbiAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbdGhpcy5pbml0aWFsUGFnZV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy53b3JrZmxvdyA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcImRhdGFVcGxvYWRcIl07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoW1wiQ1NWXCIsIFwiTWljcm9zb2Z0IEV4Y2VsXCJdLmluY2x1ZGVzKHR5cGUpKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wicHVibGlzaFNlbGVjdFwiXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChleGlzdGluZ0l0ZW1UeXBlID09PSBcInRpbGVMYXllclwiKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1widGlsZUxheWVyU2V0dGluZ3NcIl07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy53b3JrZmxvdyA9PT0gXCJyZWdpc3RlclwiKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiByZXdvcmsgdGhpcyBvbmNlIFN0ZXZlbiBwdWJsaXNoIGhpcyBkdWJzdGVwIGRpYWdyYW1cbiAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJkZXZlbG9wZXJDcmVkZW50aWFsc1NlbGVjdFwiXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJpdGVtUHJvcGVydGllc1wiXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplV2l0aEZpcnN0U3RlcCgpIHtcbiAgICAgICAgY29uc3QgeyBmaXJzdFN0ZXAgfSA9IHRoaXM7XG4gICAgICAgIGlmICghZmlyc3RTdGVwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChmaXJzdFN0ZXApIHtcbiAgICAgICAgICAgIGNhc2UgXCJkYXRhU3RvcmVTZWxlY3RDbG91ZENyZWRlbnRpYWxzQW1hem9uUzNcIjpcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplRGF0YXN0b3JlU3RhdGUoeyBwb3J0YWw6IHRoaXMucG9ydGFsIH0pO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGREYXRhU3RvcmVUeXBlID0gXCJjbG91ZFwiO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5wcm92aWRlciA9IFwiYW1hem9uXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSGlzdG9yeSA9IFtcImRhdGFTdG9yZVNlbGVjdENsb3VkQ3JlZGVudGlhbHNcIl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZGF0YVN0b3JlU2VsZWN0Q2xvdWRDcmVkZW50aWFsc0F6dXJlQmxvYlwiOlxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVEYXRhc3RvcmVTdGF0ZSh7IHBvcnRhbDogdGhpcy5wb3J0YWwgfSk7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFkZERhdGFTdG9yZVR5cGUgPSBcImNsb3VkXCI7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnByb3ZpZGVyID0gXCJhenVyZVwiO1xuICAgICAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJkYXRhU3RvcmVTZWxlY3RDbG91ZENyZWRlbnRpYWxzXCJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRhdGFTdG9yZURhdGFiYXNlQ3JlZGVudGlhbHNTbm93Zmxha2VcIjpcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplRGF0YXN0b3JlU3RhdGUoeyBwb3J0YWw6IHRoaXMucG9ydGFsIH0pO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGREYXRhU3RvcmVUeXBlID0gXCJkYXRhYmFzZVwiO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhYmFzZVByb3ZpZGVyID0gXCJzbm93Zmxha2VcIjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW1wiZGF0YVN0b3JlRGF0YWJhc2VDcmVkZW50aWFsc1wiXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkYXRhU3RvcmVEYXRhYmFzZUNyZWRlbnRpYWxzQmlnUXVlcnlcIjpcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplRGF0YXN0b3JlU3RhdGUoeyBwb3J0YWw6IHRoaXMucG9ydGFsIH0pO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5hZGREYXRhU3RvcmVUeXBlID0gXCJkYXRhYmFzZVwiO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhYmFzZVByb3ZpZGVyID0gXCJiaWdRdWVyeVwiO1xuICAgICAgICAgICAgICAgIHRoaXMucGFnZUhpc3RvcnkgPSBbXCJkYXRhU3RvcmVEYXRhYmFzZUNyZWRlbnRpYWxzXCJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnBhZ2VIaXN0b3J5ID0gW2ZpcnN0U3RlcF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdHJpZ2dlclBhZ2VUcmFuc2l0aW9uKGV2ZW50VHlwZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGV2ZW50VHlwZSwgeyBjYW5jZWxhYmxlOiB0cnVlIH0pO1xuICAgICAgICBjb25zdCBldmVudE5vdENhbmNlbGxlZCA9IChfYSA9IHRoaXMuY3VycmVudFBhZ2VFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICBpZiAoZXZlbnROb3RDYW5jZWxsZWQgJiYgZXZlbnRUeXBlID09PSBcImFyY2dpc05ld0l0ZW1QYWdlUHJldlwiKSB7XG4gICAgICAgICAgICB0aGlzLmdvVG9QcmV2aW91c1BhZ2UoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogVXBkYXRlIHRoZSBjb21wb25lbnQgaW4gdGhlIG1vZGFsJ3Mgc2xvdCB3aGVuIGEgc3RhdGUgY2hhbmdlIGlzIGRldGVjdGVkICovXG4gICAgZGlzcGxheVBhZ2UoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgLy8gTm8gcG9pbnQgb2YgcmVuZGVyaW5nIGVsZW1lbnRzIG9uIHRoZSBzY3JlZW4gaWYgbW9kYWwgaXMgbm90IGFjdGl2ZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdHJhbnNpdGlvbiwgcGFnZUhpc3RvcnksIGluaXRpYWxQYWdlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBmb3J3YXJkID0gdHJhbnNpdGlvbiA9PT0gXCJmb3J3YXJkXCI7XG4gICAgICAgIGNvbnN0IGJhY2sgPSB0cmFuc2l0aW9uID09PSBcImJhY2tcIjtcbiAgICAgICAgY29uc3QgbmV4dCA9IGJhY2sgPyBwYWdlSGlzdG9yeVtwYWdlSGlzdG9yeS5sZW5ndGggLSAyXSA6IHBhZ2VIaXN0b3J5W3BhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdO1xuICAgICAgICAvLyBUT0RPOiBzdHJpY3RseSB0eXBlIHRoaXNcbiAgICAgICAgY29uc3QgTmV4dFNjcmVlbiA9IGAke3BhZ2VzW25leHRdIHx8IHBhZ2VzW2luaXRpYWxQYWdlXX1gO1xuICAgICAgICBjb25zdCBDdXJyZW50U2NyZWVuID0gdGhpcy5jdXJyZW50U2NyZWVuO1xuICAgICAgICBpZiAoQ3VycmVudFNjcmVlbiAmJiBwYWdlSGlzdG9yeS5sZW5ndGggPiAxICYmIHRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgaChDdXJyZW50U2NyZWVuLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFnZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UtLWZ1bGxzY3JlZW5cIjogdGhpcy5pc0Z1bGxTY3JlZW5QYWdlKEN1cnJlbnRTY3JlZW4pLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZS1hbmltXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlLWFuaW0tLWxlYXZpbmdcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UtYW5pbS0tbGVmdFwiOiBmb3J3YXJkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZS1hbmltLS1yaWdodFwiOiBiYWNrXG4gICAgICAgICAgICAgICAgICAgIH0gfSksXG4gICAgICAgICAgICAgICAgaChOZXh0U2NyZWVuLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFnZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UtLWZ1bGxzY3JlZW5cIjogdGhpcy5pc0Z1bGxTY3JlZW5QYWdlKE5leHRTY3JlZW4pLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZS1hbmltXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlLWFuaW0tLWxlZnRcIjogYmFjayxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UtYW5pbS0tcmlnaHRcIjogZm9yd2FyZFxuICAgICAgICAgICAgICAgICAgICB9LCBzdHlsZTogeyBoZWlnaHQ6IGAke3RoaXMudGFyZ2V0SGVpZ2h0fXB4YCB9LCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZUVsID0gZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLm1vZGFsUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXBkYXRlRm9jdXNUcmFwRWxlbWVudHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSB9KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNjcmVlbiA9IE5leHRTY3JlZW47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3R5bGUgPSB0aGlzLnRhcmdldEhlaWdodCA/IHsgaGVpZ2h0OiBgJHt0aGlzLnRhcmdldEhlaWdodH1weGAgfSA6IHt9O1xuICAgICAgICByZXR1cm4gKGgoTmV4dFNjcmVlbiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIHN0YWdlOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwic3RhZ2UtLWZ1bGxzY3JlZW5cIjogdGhpcy5pc0Z1bGxTY3JlZW5QYWdlKE5leHRTY3JlZW4pXG4gICAgICAgICAgICB9LCBzdHlsZTogc3R5bGUsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZUVsID0gZWw7XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcbiAgICB9XG4gICAgLyoqIEluaXRpYWxpemUgdGhlIGl0ZW1Qcm9wZXJ0aWVzU3RvcmUgd2l0aCBkYXRhIGZyb20gcHJvcHMgb24gbG9hZCAqL1xuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgeyBmaWxlLCBwb3J0YWwsIGFwaSwgdXNlciwgY29uZmlnLCB0ZWxlbWV0cnksIGV4aXN0aW5nSXRlbSwgZmlyc3RTdGVwLCB3b3JrZmxvdywgaW5pdGlhbEZvbGRlciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICB1aVN0b3JlU3RhdGUuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgY29uZmlnU3RhdGUubGFuZyA9IGxvY2FsZVsxXTtcbiAgICAgICAgdGhpcy5wcmltYXJ5QnV0dG9uVGV4dCA9IHRoaXMuaTE4bi5uZXh0O1xuICAgICAgICB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPSB3b3JrZmxvdztcbiAgICAgICAgY29uZmlnU3RhdGUucG9ydGFsID0gcG9ydGFsO1xuICAgICAgICBpZiAoISF1c2VyKSB7XG4gICAgICAgICAgICBjb25zdCB7IGVycm9yLCByZXN1bHQ6IF9pc1BvcnRhbEJhY2tlZEJ5U0RTIH0gPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gaXNQb3J0YWxCYWNrZWRCeVNEUyhwb3J0YWwsIHVzZXIpLCBcImlzUG9ydGFsQmFja2VkQnlTRFNcIiwgcG9ydGFsLmlkKTtcbiAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIC0gd2UgbmVlZCB0byBmaWd1cmUgb3V0IGEgYmV0dGVyIHdheSB0byBkbyB0aGlzIHNvIHdlJ3JlIG5vdCBtb2RpZnlpbmcgdGhlIHVzZXIncyBwb3J0YWxcbiAgICAgICAgICAgICAgICBjb25maWdTdGF0ZS5wb3J0YWwuaXNCYWNrZWRCeVNEUyA9IF9pc1BvcnRhbEJhY2tlZEJ5U0RTO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9IGFwaTtcbiAgICAgICAgY29uZmlnU3RhdGUuY29uZmlnID0gY29uZmlnO1xuICAgICAgICBjb25maWdTdGF0ZS5hbGxvd2VkSXRlbVR5cGVzID0gdGhpcy5hbGxvd2VkSXRlbVR5cGVzO1xuICAgICAgICBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMgPSB0aGlzLmFsbG93ZWRNb2RlcztcbiAgICAgICAgY29uZmlnU3RhdGUuYWxsb3dQdWJsaXNoID0gdGhpcy5hbGxvd1B1Ymxpc2g7XG4gICAgICAgIGNvbmZpZ1N0YXRlLnRlbGVtZXRyeSA9IHRlbGVtZXRyeTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZSAtIGhlbHBCYXNlIGlzIGRlZmluaXRlbHkgb24gNC54IFBvcnRhbCBjbGFzcy5cbiAgICAgICAgY29uZmlnU3RhdGUuY29uZmlnLmhlbHBCYXNlID0gKF9hID0gY29uZmlnID09PSBudWxsIHx8IGNvbmZpZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnLmhlbHBCYXNlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBwb3J0YWwuaGVscEJhc2U7XG4gICAgICAgIGNvbmZpZ1N0YXRlLmluaXRpYWxGb2xkZXIgPSBpbml0aWFsRm9sZGVyO1xuICAgICAgICBpZiAoISgoX2IgPSBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5oZWxwTWFwKSkge1xuICAgICAgICAgICAgY29uc3QgaGVscFJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChgJHtjb25maWcucmVzdEJhc2VVcmx9L3BvcnRhbHMvaGVscG1hcD9jdWx0dXJlPSR7Y29uZmlnU3RhdGUubGFuZ31gKTtcbiAgICAgICAgICAgIGNvbmZpZ1N0YXRlLmNvbmZpZy5oZWxwTWFwID0gaGVscFJlc3BvbnNlID09PSBudWxsIHx8IGhlbHBSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaGVscFJlc3BvbnNlLmhlbHBNYXAubTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgY29uZmlnU3RhdGUudXNlciA9IHVzZXI7XG4gICAgICAgICAgICBjb25maWdTdGF0ZS51c2VyTGljZW5zZWRJdGVtcyA9XG4gICAgICAgICAgICAgICAgKF9jID0gdXNlci51c2VyTGljZW5zZWRJdGVtcykgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKGF3YWl0IGZldGNoVXNlckxpY2Vuc2VkSXRlbXMocG9ydGFsKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZVdpdGhGaWxlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV4aXN0aW5nSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplV2l0aEV4aXN0aW5nSXRlbSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaXJzdFN0ZXApIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZVdpdGhGaXJzdFN0ZXAoKTtcbiAgICAgICAgfVxuICAgICAgICB1aVN0b3JlLm9uQ2hhbmdlKFwiZGlzYWJsZVNjcm9sbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB1aVN0b3JlU3RhdGUuZGlzYWJsZVNjcm9sbFxuICAgICAgICAgICAgICAgID8gdGhpcy5jb250ZW50U2xvdC5jbGFzc0xpc3QuYWRkKFwic3RhZ2UtLWRpc2FibGUtc2Nyb2xsXCIpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbnRlbnRTbG90LmNsYXNzTGlzdC5yZW1vdmUoXCJzdGFnZS0tZGlzYWJsZS1zY3JvbGxcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB1aVN0b3JlLm9uQ2hhbmdlKFwibmV4dFRleHRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICAgICAgbGV0IG5leHRUZXh0ID0gaTE4bi5uZXh0O1xuICAgICAgICAgICAgc3dpdGNoICh1aVN0b3JlU3RhdGUubmV4dFRleHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYWRkVG9NYXBcIjpcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5hZGRUb01hcDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNyZWF0ZUFuZEFkZFRvTWFwXCI6XG4gICAgICAgICAgICAgICAgICAgIG5leHRUZXh0ID0gaTE4bi5jb21tb24uY3JlYXRlQW5kQWRkVG9NYXA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ1c2VBc0Jhc2VNYXBcIjpcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRleHQgPSBpMThuLnVybFR5cGUudXNlQXNCYXNlTWFwO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwidXBkYXRlQXBwZW5kXCI6XG4gICAgICAgICAgICAgICAgICAgIG5leHRUZXh0ID0gaTE4bi5jb21tb24udXBkYXRlQW5kQ29tcGxldGU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhZGRBbmRDb21wbGV0ZVwiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLmFkZEFuZENvbXBsZXRlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicHJvY2VlZFwiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLnByb2NlZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyZWdpc3RlclwiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uY29tbW9uLnJlZ2lzdGVyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwic2F2ZVwiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0VGV4dCA9IGkxOG4uc2F2ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNyZWF0ZUNvbm5lY3Rpb25cIjpcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5jcmVhdGVDb25uZWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwic2lnbkluQW5kT3ZlcndyaXRlXCI6XG4gICAgICAgICAgICAgICAgICAgIG5leHRUZXh0ID0gaTE4bi5jb21tb24uc2lnbkluQW5kT3ZlcndyaXRlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwib3ZlcndyaXRlQW5kQ29tcGxldGVcIjpcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRleHQgPSBpMThuLmNvbW1vbi5vdmVyd3JpdGVBbmRDb21wbGV0ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnByaW1hcnlCdXR0b25UZXh0ID0gbmV4dFRleHQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsUmVuZGVyKCkge1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdGhpcy5wYWdlSGlzdG9yeS5sZW5ndGggPiAxO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLm1vZGFsUmVmLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3Qgc2hhZG93Um9vdCA9IChfYSA9IHRoaXMubW9kYWxSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zaGFkb3dSb290O1xuICAgICAgICAvLyBIZWxwIHRoZSB0b29sdGlwIHRvIGJlIG9uIHRvcCBvZiB0aGUgZm9vdGVyXG4gICAgICAgIGlmIChzaGFkb3dSb290KSB7XG4gICAgICAgICAgICBjb25zdCBtb2RhbEhlYWRlciA9IHNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5oZWFkZXJcIik7XG4gICAgICAgICAgICBpZiAobW9kYWxIZWFkZXIpIHtcbiAgICAgICAgICAgICAgICBtb2RhbEhlYWRlci5zdHlsZS56SW5kZXggPSBcIjNcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG1vZGFsRm9vdGVyID0gc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiLmZvb3RlclwiKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsQ29udGVudCA9IHNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIi5jb250ZW50XCIpO1xuICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBzaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxcIik7XG4gICAgICAgICAgICBjb25zdCBoaWRlRm9vdGVyID0gdGhpcy5jdXJyZW50U2NyZWVuID09PSBwYWdlcy5kZWZhdWx0O1xuICAgICAgICAgICAgY29uc3QgaXNIb21lID0gdGhpcy5jdXJyZW50U2NyZWVuID09PSBwYWdlc1t0aGlzLmluaXRpYWxQYWdlXTtcbiAgICAgICAgICAgIGlmIChtb2RhbEZvb3RlciAmJiBtb2RhbENvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICBtb2RhbEZvb3Rlci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgICAgICAgICBtb2RhbEZvb3Rlci5zdHlsZS5ib3R0b20gPSBcIjBcIjtcbiAgICAgICAgICAgICAgICBtb2RhbEZvb3Rlci5zdHlsZS52aXNpYmlsaXR5ID0gaGlkZUZvb3RlciA/IFwiaGlkZGVuXCIgOiBcInZpc2libGVcIjtcbiAgICAgICAgICAgICAgICBtb2RhbC5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgICAgICAgICAgICAgICBpZiAoaXNIb21lKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsQ29udGVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gXCI2NXB4XCI7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLnN0eWxlLnBhZGRpbmdCb3R0b20gPSBcIjBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsQ29udGVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gXCIwXCI7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLnN0eWxlLnBhZGRpbmdCb3R0b20gPSBcIjY1cHhcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ub1BhZGRpbmcgPSB0aGlzLmlzRnVsbFNjcmVlblBhZ2UodGhpcy5jdXJyZW50U2NyZWVuKTtcbiAgICAgICAgKF9iID0gdGhpcy5tb2RhbFJlZikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnVwZGF0ZUZvY3VzVHJhcEVsZW1lbnRzKCk7XG4gICAgfVxuICAgIGlzRnVsbFNjcmVlblBhZ2UocGFnZSkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZmVhdHVyZS1sYXllci1mcm9tLXRlbXBsYXRlXCIsXG4gICAgICAgICAgICBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1mZWF0dXJlLWxheWVyLWZyb20tZXhpc3RpbmdcIixcbiAgICAgICAgICAgIFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItZnJvbS1zdG9yZVwiLFxuICAgICAgICAgICAgXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtZGF0YS1zdG9yZS1saXN0XCIsXG4gICAgICAgICAgICBcImFyY2dpcy1uZXctaXRlbS1wYWdlcy1kYXRhLXN0b3JlLWJyb3dzZXJcIixcbiAgICAgICAgICAgIFwiYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLXRpbGUtbGF5ZXItZnJvbS1leGlzdGluZ1wiLFxuICAgICAgICAgICAgXCJhcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLXNlbGVjdC1sYXllclwiXG4gICAgICAgIF0uaW5jbHVkZXMocGFnZSk7XG4gICAgfVxuICAgIGlzRGlzYWJsZUNsb3NlUGFnZShwYWdlKSB7XG4gICAgICAgIGNvbnN0IHBhZ2VUb0hpZGVDbG9zZUJ1dHRvbiA9IFtcbiAgICAgICAgICAgIFwiYXBwZW5kU2VsZWN0VXBkYXRlXCIsXG4gICAgICAgICAgICBcImNzdkxvY2F0aW9uRmllbGRzXCIsXG4gICAgICAgICAgICBcImFwcGVuZE1hdGNoRmllbGRzXCJcbiAgICAgICAgXTtcbiAgICAgICAgcmV0dXJuIHBhZ2VUb0hpZGVDbG9zZUJ1dHRvbi5pbmNsdWRlcyhwYWdlKTtcbiAgICB9XG4gICAgZ2V0SGVhZGVyVGl0bGUoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgcGFnZUhpc3RvcnkgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIGV4aXN0aW5nSXRlbSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gaTE4bi5hZGRMYXllcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcInJlZ2lzdGVyXCIgJiYgZXhpc3RpbmdJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gaTE4bi5jb21tb24ucmVnaXN0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0l0ZW1Nb2RlID09PSBcInJhc3RlckZ1bmN0aW9uVGVtcGxhdGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIGkxOG4uY3JlYXRlUmFzdGVyRnVuY3Rpb25UZW1wbGF0ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJQYWdlID0gKHBhZ2VIaXN0b3J5W3BhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgY2FzZSBjdXJQYWdlLmluY2x1ZGVzKFwiZmVhdHVyZWxheWVyXCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiBpMThuLmNyZWF0ZUZlYXR1cmVMYXllcjtcbiAgICAgICAgICAgIGNhc2UgY3VyUGFnZS5pbmNsdWRlcyhcInRpbGVsYXllclwiKTpcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi5jcmVhdGVUaWxlTGF5ZXI7XG4gICAgICAgICAgICBjYXNlIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJ1cGRhdGVcIiAmJiAoZXhpc3RpbmdJdGVtID09PSBudWxsIHx8IGV4aXN0aW5nSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhpc3RpbmdJdGVtLnR5cGUpID09PSBcIlZlY3RvciBUaWxlIFNlcnZpY2VcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi51cGRhdGU7XG4gICAgICAgICAgICBjYXNlIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJhcHBlbmRcIiB8fCB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwidXBkYXRlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4uYXBwZW5kU2VsZWN0LnVwZGF0ZURhdGE7XG4gICAgICAgICAgICBjYXNlIG5ld0l0ZW1Nb2RlID09PSBcInNjZW5lTGF5ZXJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi5jcmVhdGVTY2VuZUxheWVyO1xuICAgICAgICAgICAgY2FzZSBuZXdJdGVtTW9kZSA9PT0gXCJ0aWxlTGF5ZXJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi5jcmVhdGVUaWxlTGF5ZXI7XG4gICAgICAgICAgICBjYXNlIG5ld0l0ZW1Nb2RlID09PSBcImRhdGFTdG9yZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBpMThuLmFkZERhdGFTdG9yZTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4ubmV3SXRlbTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXJPbmJvYXJkaW5nU2VjdGlvbih7IHRpdGxlLCBjb250ZW50LCBiYWNrZ3JvdW5kLCBwYXRoIH0pIHtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwib25ib2FyZGluZ19fc2VjdGlvblwiIH0sIGgoXCJoNFwiLCB7IGNsYXNzOiBcIm9uYm9hcmRpbmdfX3RpdGxlXCIgfSwgdGl0bGUpLCBoKFwicFwiLCB7IGNsYXNzOiBcIm9uYm9hcmRpbmdfX2Rlc2NyaXB0aW9uXCIgfSwgY29udGVudCksIGgoXCJzdmdcIiwgeyB3aWR0aDogXCIyNTVcIiwgaGVpZ2h0OiBcIjY0XCIsIHZpZXdCb3g6IFwiMCAwIDI1NSA2NFwiLCBmaWxsOiBcIm5vbmVcIiwgeG1sbnM6IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB9LCBoKFwicmVjdFwiLCB7IHdpZHRoOiBcIjI1NVwiLCBoZWlnaHQ6IFwiNjRcIiwgZmlsbDogYmFja2dyb3VuZCwgXCJmaWxsLW9wYWNpdHlcIjogXCIwLjFcIiB9KSwgcGF0aCkpKTtcbiAgICB9XG4gICAgcmVuZGVyT25ib2FyZGluZygpIHtcbiAgICAgICAgaWYgKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB8fCB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgaTE4biB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgb25ib2FyZGluZ0NvbnRlbnQgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4ub25ib2FyZC5hZGREb2N1bWVudFRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGkxOG4ub25ib2FyZC5hZGREb2N1bWVudENvbnRlbnQsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogXCIjMDA3YWMyXCIsXG4gICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXRoOiAoaChcInBhdGhcIiwgeyBkOiBcIk0xMzIuMjU3IDQ1LjU1NjZMMTQ2LjMxOCAzMS40OTI2TDE0MCAyNS4xNzM2TDE0MS4zNjggMjEuNTcxNkwxMjYuNDg1IDE1LjkxOTZMMTIyLjY2NiAxMi4wOTk2SDEwOS4xVjQyLjg5OTZIMTEzLjYxMUwxMTYuNzU2IDQ0LjA5NDZMMTI1LjI0NiA1Mi41NjQ2TDEyOS4wNTQgNDguNzY1NkwxMzAuNzg3IDQ5LjQyNDZMMTMyLjA0MyA0Ni4xMTg2SDEzMi4wNDRMMTMyLjI1NyA0NS41NTY2Wk0xNDUuMTg3IDMxLjQ5MjZMMTMyLjk1IDQzLjcyOTZMMTM5LjY4NiAyNS45OTQ2TDE0NS4xODcgMzEuNDkyNlpNMTIyLjkgMTMuNDY1NkwxMzAuNTM0IDIxLjA5OTZIMTIyLjlWMTMuNDY1NlpNMTA5LjkgMTIuODk5NkgxMjIuMzM0TDEyMi40MzQgMTIuOTk5NkgxMjIuMVYyMS44OTk2SDEzMVYyMS41NjQ2TDEzMS4xIDIxLjY2NTZWNDIuMDk5NkgxMDkuOVYxMi44OTk2Wk0xMjUuMjQ2IDUxLjQzMzZMMTE4LjU4NiA0NC43ODk2TDEyOC4yMzMgNDguNDU0NkwxMjUuMjQ2IDUxLjQzMzZaTTEzMC4zMjQgNDguMzkzNkwxMTUuODY0IDQyLjg5OTZIMTMxLjlWMjEuMzMzNkwxMjcuODY1IDE3LjI5NzZMMTQwLjMzNSAyMi4wMzQ2TDEzMS42NDMgNDQuOTIxNkwxMzAuMzI0IDQ4LjM5MzZaXCIsIGZpbGw6IFwiIzM5ODVCMlwiIH0pKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi5vbmJvYXJkLnB1Ymxpc2hMYXllclRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMucG9ydGFsLmlzUG9ydGFsXG4gICAgICAgICAgICAgICAgICAgID8gaTE4bi5vbmJvYXJkLnB1Ymxpc2hMYXllckVudGVycHJpc2VcbiAgICAgICAgICAgICAgICAgICAgOiBpMThuLm9uYm9hcmQucHVibGlzaExheWVyQ29udGVudCxcbiAgICAgICAgICAgICAgICBzaG93OiBjYW5QdWJsaXNoRmVhdHVyZXModGhpcy51c2VyLCB0aGlzLnBvcnRhbCksXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogXCIjMzVBQzQ2XCIsXG4gICAgICAgICAgICAgICAgcGF0aDogKGgoXCJwYXRoXCIsIHsgZDogXCJNMTQxLjEwNSAxNi4yNTM3TDE0MC44NzYgMTYuMTc2N0MxNDAuNTY0IDE2LjA3MjcgMTMzLjE2NCAxMy42NTk3IDEyNi44NTIgMTYuMTg1N0MxMjAuODE0IDE4LjU5NzcgMTEzLjQ0OSAxNi4yMDA3IDExMy4zNzYgMTYuMTc1N0wxMTIuOTMxIDE2LjAyODdMMTA3LjgwOCA0Ny4yODE3TDEwOC4wNzEgNDcuNDEzN0MxMTAuOTIyIDQ4LjYzMjcgMTE0LjAwMiA0OS4yMjA1IDExNy4xMDEgNDkuMTM2N0MxMjAuNTEzIDQ5LjExMzkgMTIzLjg5OCA0OC41Mzk4IDEyNy4xMjYgNDcuNDM2N0MxMzguMDY5IDQzLjc4NjcgMTQ1LjQ5NyA0Ny4zNzY3IDE0NS41NzEgNDcuNDE0N0wxNDYuMjcxIDQ3Ljc2MjdMMTQxLjEwNSAxNi4yNTM3Wk0xMjYuODc0IDQ2LjY3NjdDMTE3LjA4NyA0OS45Mzg3IDExMC4xMTQgNDcuNDEzNyAxMDguNjk0IDQ2LjgxNjdMMTEzLjU3MSAxNy4wNzI3QzExNS4zMDMgMTcuNTc0NyAxMjEuNjM5IDE5LjEzMjcgMTI3LjE0OCAxNi45Mjc3QzEzMi41ODggMTQuNzUzNyAxMzkuMTA0IDE2LjQ4MzcgMTQwLjM5NiAxNi44NjU3TDE0NS4yMzYgNDYuMzk4N0MxNDMuMTE2IDQ1LjU2NTcgMTM2LjMzNiA0My41MjI3IDEyNi44NzQgNDYuNjc2N1pNMTM3LjY4IDE4LjQyODdDMTM0LjA2NyAxNy43MDk4IDEzMC4zMjggMTcuOTcxMiAxMjYuODUgMTkuMTg1N0MxMjUuOTk2IDE5LjUyMTIgMTI1LjExMiAxOS43NzUxIDEyNC4yMSAxOS45NDM3TDEyNC4xOTggMTkuOTQ2N0MxMjEuNjYyIDIwLjM3NDQgMTE5LjA3IDIwLjM2MTYgMTE2LjUzOCAxOS45MDg3TDExNi4xNDEgMTkuODQyN0wxMTIuMTExIDQ0LjQyODdMMTEyLjQ3OCA0NC41MTE3QzExNC4zNDIgNDQuOTIzOSAxMTYuMjQ3IDQ1LjEyODggMTE4LjE1NiA0NS4xMjI3QzEyMS41NDkgNDUuMTAyMSAxMjQuOTE1IDQ0LjUzMjggMTI4LjEyNiA0My40MzY3QzEzMS4xNyA0Mi40MDE3IDEzNC4zNTggNDEuODUwMyAxMzcuNTczIDQxLjgwMjdIMTM3LjU4M0MxMzguODI1IDQxLjc4ODEgMTQwLjA2NiA0MS44NjAzIDE0MS4yOTcgNDIuMDE4N0wxNDEuODMyIDQyLjA4ODdMMTM3Ljk2MSAxOC40NzY3TDEzNy42OCAxOC40Mjg3Wk0xNDAuMzYzIDM4LjA3MTdMMTM3Ljg5MSA0MC41NDM3QzEzNy44IDM5LjcyMDcgMTM3LjY1OCAzOC45MDQyIDEzNy40NjcgMzguMDk4N0wxMzkuOTU5IDM1LjYwNjdMMTQwLjM2MyAzOC4wNzE3Wk0xMzkuNzk5IDM0LjYzNDdMMTM3LjIzMyAzNy4yMDA3QzEzNy4wMjMgMzYuNDg3OCAxMzYuNzYxIDM1Ljc5MTYgMTM2LjQ0OCAzNS4xMTc3TDEzOS4zOTYgMzIuMTY4N0wxMzkuNzk5IDM0LjYzNDdaTTEzOS4yMzYgMzEuMTk3N0wxMzYuMDYxIDM0LjM3MjdDMTM1LjczMiAzMy43Njc5IDEzNS4zMzUgMzMuMjAzMSAxMzQuODc2IDMyLjY4OTdMMTM4LjgzMiAyOC43MzM3TDEzOS4yMzYgMzEuMTk3N1pNMTM4LjY3MiAyNy43NjE3TDEzNC4zMDIgMzIuMTMxN0MxMzMuODQ4IDMxLjcyMTkgMTMzLjM1NiAzMS4zNTUgMTMyLjgzNCAzMS4wMzU3QzEzMi44NTggMzAuOTIwMyAxMzIuODczIDMwLjgwMzMgMTMyLjg4IDMwLjY4NTdMMTM4LjI2OCAyNS4yOTY3TDEzOC42NzIgMjcuNzYxN1pNMTM4LjEwOSAyNC4zMjQ3TDEzMi43NDcgMjkuNjg2N0MxMzIuNjI3IDI5LjM1NzQgMTMyLjQzNyAyOS4wNTg0IDEzMi4xODkgMjguODEwNkMxMzEuOTQxIDI4LjU2MjkgMTMxLjY0MiAyOC4zNzI0IDEzMS4zMTMgMjguMjUyN0wxMzcuNzA1IDIxLjg2MDdMMTM4LjEwOSAyNC4zMjQ3Wk0xMzAuNSAyOC45MDA3QzEzMC44MTcgMjguOTAwNyAxMzEuMTI2IDI4Ljk5NDUgMTMxLjM4OSAyOS4xNzAzQzEzMS42NTIgMjkuMzQ2MSAxMzEuODU3IDI5LjU5NiAxMzEuOTc4IDI5Ljg4ODRDMTMyLjA5OSAzMC4xODA3IDEzMi4xMzEgMzAuNTAyNCAxMzIuMDY5IDMwLjgxMjhDMTMyLjAwOCAzMS4xMjMyIDEzMS44NTUgMzEuNDA4MyAxMzEuNjMxIDMxLjYzMkMxMzEuNDA4IDMxLjg1NTggMTMxLjEyMyAzMi4wMDgyIDEzMC44MTIgMzIuMDY5OUMxMzAuNTAyIDMyLjEzMTcgMTMwLjE4IDMyLjEgMTI5Ljg4OCAzMS45Nzg5QzEyOS41OTUgMzEuODU3OCAxMjkuMzQ2IDMxLjY1MjcgMTI5LjE3IDMxLjM4OTZDMTI4Ljk5NCAzMS4xMjY1IDEyOC45IDMwLjgxNzEgMTI4LjkgMzAuNTAwN0MxMjguOTAxIDMwLjA3NjUgMTI5LjA2OSAyOS42Njk4IDEyOS4zNjkgMjkuMzY5OUMxMjkuNjY5IDI5LjA2OTkgMTMwLjA3NiAyOC45MDEyIDEzMC41IDI4LjkwMDdaTTEzNy41NDcgMjAuODg3N0wxMzAuMzE2IDI4LjExODdDMTI5Ljk5MSAyOC4xNDM2IDEyOS42NzUgMjguMjM0OSAxMjkuMzg2IDI4LjM4NjlDMTI5LjA5OCAyOC41MzkgMTI4Ljg0NCAyOC43NDg1IDEyOC42NCAyOS4wMDI3QzEyOC4xOTUgMjguNzcwNyAxMjcuNzczIDI4LjQ5NzEgMTI3LjM4IDI4LjE4NTdMMTMwLjk3MiAyNC41OTQ3QzEzMS4zMzYgMjQuODMxNyAxMzEuNzcxIDI0LjkzNjUgMTMyLjIwMyAyNC44OTEzQzEzMi42MzUgMjQuODQ2MSAxMzMuMDM5IDI0LjY1MzggMTMzLjM0NiAyNC4zNDY1QzEzMy42NTMgMjQuMDM5MyAxMzMuODQ2IDIzLjYzNTcgMTMzLjg5MSAyMy4yMDM2QzEzMy45MzYgMjIuNzcxNCAxMzMuODMxIDIyLjMzNjggMTMzLjU5NCAyMS45NzI3TDEzNi41MDIgMTkuMDY0N0MxMzYuNzYyIDE5LjA5ODcgMTM3LjAyMiAxOS4xMzE3IDEzNy4yNjUgMTkuMTcwN0wxMzcuNTQ3IDIwLjg4NzdaTTEzMy4xIDIzLjAwMDdDMTMzLjEgMjMuMjE4MiAxMzMuMDM2IDIzLjQzMDkgMTMyLjkxNSAyMy42MTE4QzEzMi43OTQgMjMuNzkyNyAxMzIuNjIyIDIzLjkzMzcgMTMyLjQyMSAyNC4wMTY5QzEzMi4yMiAyNC4xMDAyIDEzMS45OTkgMjQuMTIyIDEzMS43ODYgMjQuMDc5NUMxMzEuNTcyIDI0LjAzNzEgMTMxLjM3NiAyMy45MzIzIDEzMS4yMjIgMjMuNzc4NUMxMzEuMDY4IDIzLjYyNDYgMTMwLjk2NCAyMy40Mjg2IDEzMC45MjEgMjMuMjE1M0MxMzAuODc5IDIzLjAwMTkgMTMwLjkwMSAyMi43ODA3IDEzMC45ODQgMjIuNTc5N0MxMzEuMDY3IDIyLjM3ODcgMTMxLjIwOCAyMi4yMDY5IDEzMS4zODkgMjIuMDg2MUMxMzEuNTcgMjEuOTY1MiAxMzEuNzgzIDIxLjkwMDcgMTMyIDIxLjkwMDdDMTMyLjI5MiAyMS45MDA5IDEzMi41NzEgMjIuMDE2OSAxMzIuNzc4IDIyLjIyMzFDMTMyLjk4NCAyMi40Mjk0IDEzMy4xIDIyLjcwOSAxMzMuMSAyMy4wMDA3Wk0xMzUuNDgxIDE4Ljk1MjdMMTMzLjAyOCAyMS40MDY3QzEzMi42NjQgMjEuMTY5NiAxMzIuMjI5IDIxLjA2NDkgMTMxLjc5NyAyMS4xMUMxMzEuMzY1IDIxLjE1NTIgMTMwLjk2MiAyMS4zNDc2IDEzMC42NTQgMjEuNjU0OEMxMzAuMzQ3IDIxLjk2MjEgMTMwLjE1NSAyMi4zNjU2IDEzMC4xMDkgMjIuNzk3OEMxMzAuMDY0IDIzLjIyOTkgMTMwLjE2OSAyMy42NjQ1IDEzMC40MDYgMjQuMDI4N0wxMjYuNzg1IDI3LjY1MDdDMTI2LjUzMyAyNy4zOTEzIDEyNi4zMDIgMjcuMTExMyAxMjYuMDk2IDI2LjgxMzdDMTI1LjkxMyAyNi41MzcyIDEyNS43NTcgMjYuMjQzOSAxMjUuNjI5IDI1LjkzNzdMMTMyLjcwNiAxOC44NjE3QzEzMy42MzIgMTguODM2NCAxMzQuNTU5IDE4Ljg2NjggMTM1LjQ4MSAxOC45NTI3Wk0xMjcuODkzIDE5LjY3MzdDMTI5LjA2MyAxOS4yODk4IDEzMC4yNzMgMTkuMDQyMiAxMzEuNDk5IDE4LjkzNTdMMTI1LjMyMyAyNS4xMTE3QzEyNS4wODkgMjQuMzM2MyAxMjQuOTI0IDIzLjU0MTkgMTI0LjgyOSAyMi43Mzc3TDEyNy44OTMgMTkuNjczN1pNMTI2LjE2NiAyMC4yNjg3TDEyNC43MjYgMjEuNzA4N0MxMjQuNyAyMS4zNjE4IDEyNC42ODQgMjEuMDE0NCAxMjQuNjc2IDIwLjY2NjdDMTI1LjE5MyAyMC41NTY3IDEyNS42ODYgMjAuNDIwNyAxMjYuMTY2IDIwLjI2ODdaTTEyNy44NzQgNDIuNjc2N0MxMjMuMTEzIDQ0LjM2NjUgMTE3Ljk4NyA0NC43NTc5IDExMy4wMjQgNDMuODEwN0wxMTYuODAyIDIwLjc2MDdDMTE5LjE0NSAyMS4xMzg5IDEyMS41MzIgMjEuMTU3MSAxMjMuODggMjAuODE0N0MxMjMuOTE5IDIyLjI3MjcgMTI0LjE1NyAyNS40MTk3IDEyNS40MzkgMjcuMjY4N0MxMjYuMTYzIDI4LjI5NjcgMTI3LjEyNyAyOS4xMzE4IDEyOC4yNDggMjkuNzAwN0MxMjguMTUzIDI5Ljk1NjggMTI4LjEwMyAzMC4yMjc1IDEyOC4xIDMwLjUwMDdDMTI4LjA5OSAzMS4wMjAxIDEyOC4yNjcgMzEuNTI1OCAxMjguNTc5IDMxLjk0MTRDMTI4Ljg5IDMyLjM1NyAxMjkuMzI5IDMyLjY2MDEgMTI5LjgyNyAzMi44MDQ5QzEzMC4zMjYgMzIuOTQ5NyAxMzAuODU5IDMyLjkyODQgMTMxLjM0NCAzMi43NDQyQzEzMS44MyAzMi41NiAxMzIuMjQzIDMyLjIyMjkgMTMyLjUyIDMxLjc4MzdDMTMzLjA4NCAzMi4xMjk2IDEzMy42MDkgMzIuNTM2OCAxMzQuMDg0IDMyLjk5NzdDMTM0LjY5NCAzMy42MDI3IDEzNi42NzQgMzUuOTM1NyAxMzcuMTQ2IDQxLjAwOTdDMTMzLjk5IDQxLjEwMTUgMTMwLjg2NSA0MS42NjMzIDEyNy44NzQgNDIuNjc2N1pNMTM4LjU0OSA0MS4wMTc3TDE0MC41MjMgMzkuMDQzN0wxNDAuODcgNDEuMTYwN0MxNDAuMDk5IDQxLjA3OTYgMTM5LjMyNSA0MS4wMzE5IDEzOC41NSA0MS4wMTc3SDEzOC41NDlaTTExOSAyNS4xMDA3QzExOC42MjQgMjUuMTAwNyAxMTguMjU3IDI1LjIxMjEgMTE3Ljk0NSAyNS40MjA5QzExNy42MzIgMjUuNjI5NyAxMTcuMzg5IDI1LjkyNjQgMTE3LjI0NSAyNi4yNzM2QzExNy4xMDEgMjYuNjIwNyAxMTcuMDYzIDI3LjAwMjggMTE3LjEzNyAyNy4zNzEzQzExNy4yMSAyNy43Mzk5IDExNy4zOTEgMjguMDc4NSAxMTcuNjU3IDI4LjM0NDJDMTE3LjkyMiAyOC42MDk5IDExOC4yNjEgMjguNzkwOCAxMTguNjI5IDI4Ljg2NDJDMTE4Ljk5OCAyOC45Mzc1IDExOS4zOCAyOC44OTk4IDExOS43MjcgMjguNzU2QzEyMC4wNzQgMjguNjEyMiAxMjAuMzcxIDI4LjM2ODcgMTIwLjU4IDI4LjA1NjNDMTIwLjc4OSAyNy43NDM4IDEyMC45IDI3LjM3NjUgMTIwLjkgMjcuMDAwN0MxMjAuOSAyNi40OTY5IDEyMC42OTkgMjYuMDE0IDEyMC4zNDMgMjUuNjU3N0MxMTkuOTg3IDI1LjMwMTUgMTE5LjUwNCAyNS4xMDEyIDExOSAyNS4xMDA3Wk0xMTkgMjguMTAwN0MxMTguNzgzIDI4LjEwMDcgMTE4LjU3IDI4LjAzNjIgMTE4LjM4OSAyNy45MTUzQzExOC4yMDggMjcuNzk0NCAxMTguMDY3IDI3LjYyMjYgMTE3Ljk4NCAyNy40MjE2QzExNy45MDEgMjcuMjIwNiAxMTcuODc5IDI2Ljk5OTQgMTE3LjkyMSAyNi43ODYxQzExNy45NjQgMjYuNTcyNyAxMTguMDY4IDI2LjM3NjcgMTE4LjIyMiAyNi4yMjI5QzExOC4zNzYgMjYuMDY5IDExOC41NzIgMjUuOTY0MiAxMTguNzg2IDI1LjkyMThDMTE4Ljk5OSAyNS44Nzk0IDExOS4yMiAyNS45MDExIDExOS40MjEgMjUuOTg0NEMxMTkuNjIyIDI2LjA2NzcgMTE5Ljc5NCAyNi4yMDg2IDExOS45MTUgMjYuMzg5NUMxMjAuMDM2IDI2LjU3MDQgMTIwLjEgMjYuNzgzMSAxMjAuMSAyNy4wMDA3QzEyMC4xIDI3LjI5MjMgMTE5Ljk4NCAyNy41NzIgMTE5Ljc3OCAyNy43NzgyQzExOS41NzEgMjcuOTg0NCAxMTkuMjkyIDI4LjEwMDQgMTE5IDI4LjEwMDdaTTExOS41IDMzLjEwMDdDMTE5LjIyMyAzMy4xMDA3IDExOC45NTMgMzMuMTgyOCAxMTguNzIyIDMzLjMzNjZDMTE4LjQ5MiAzMy40OTA0IDExOC4zMTMgMzMuNzA5MSAxMTguMjA3IDMzLjk2NDlDMTE4LjEwMSAzNC4yMjA3IDExOC4wNzMgMzQuNTAyMiAxMTguMTI3IDM0Ljc3MzhDMTE4LjE4MSAzNS4wNDU0IDExOC4zMTQgMzUuMjk0OCAxMTguNTEgMzUuNDkwNkMxMTguNzA2IDM1LjY4NjQgMTE4Ljk1NSAzNS44MTk3IDExOS4yMjcgMzUuODczOEMxMTkuNDk5IDM1LjkyNzggMTE5Ljc4IDM1LjkwMDEgMTIwLjAzNiAzNS43OTQxQzEyMC4yOTIgMzUuNjg4MSAxMjAuNTEgMzUuNTA4NyAxMjAuNjY0IDM1LjI3ODVDMTIwLjgxOCAzNS4wNDgyIDEyMC45IDM0Ljc3NzYgMTIwLjkgMzQuNTAwN0MxMjAuOSAzNC4xMjk1IDEyMC43NTIgMzMuNzczNyAxMjAuNDg5IDMzLjUxMTNDMTIwLjIyNyAzMy4yNDg5IDExOS44NzEgMzMuMTAxMiAxMTkuNSAzMy4xMDA3Wk0xMTkuNSAzNS4xMDA3QzExOS4zODEgMzUuMTAwNyAxMTkuMjY1IDM1LjA2NTUgMTE5LjE2NyAzNC45OTk1QzExOS4wNjggMzQuOTMzNiAxMTguOTkxIDM0LjgzOTkgMTE4Ljk0NiAzNC43MzAzQzExOC45IDM0LjYyMDYgMTE4Ljg4OCAzNC41IDExOC45MTIgMzQuMzgzNkMxMTguOTM1IDM0LjI2NzIgMTE4Ljk5MiAzNC4xNjAzIDExOS4wNzYgMzQuMDc2NEMxMTkuMTYgMzMuOTkyNSAxMTkuMjY3IDMzLjkzNTMgMTE5LjM4MyAzMy45MTIyQzExOS40OTkgMzMuODg5IDExOS42MiAzMy45MDA5IDExOS43MyAzMy45NDYzQzExOS44MzkgMzMuOTkxOCAxMTkuOTMzIDM0LjA2ODcgMTE5Ljk5OSAzNC4xNjczQzEyMC4wNjUgMzQuMjY2IDEyMC4xIDM0LjM4MiAxMjAuMSAzNC41MDA3QzEyMC4xIDM0LjY1OTggMTIwLjAzNyAzNC44MTI0IDExOS45MjQgMzQuOTI0OUMxMTkuODEyIDM1LjAzNzUgMTE5LjY1OSAzNS4xMDA3IDExOS41IDM1LjEwMDdaTTEyOCAzNi4xMDA3QzEyNy42MjQgMzYuMTAwNyAxMjcuMjU3IDM2LjIxMjEgMTI2Ljk0NSAzNi40MjA5QzEyNi42MzIgMzYuNjI5NyAxMjYuMzg5IDM2LjkyNjQgMTI2LjI0NSAzNy4yNzM2QzEyNi4xMDEgMzcuNjIwNyAxMjYuMDYzIDM4LjAwMjggMTI2LjEzNyAzOC4zNzEzQzEyNi4yMSAzOC43Mzk5IDEyNi4zOTEgMzkuMDc4NCAxMjYuNjU3IDM5LjM0NDJDMTI2LjkyMiAzOS42MDk5IDEyNy4yNjEgMzkuNzkwOCAxMjcuNjI5IDM5Ljg2NDJDMTI3Ljk5OCAzOS45Mzc1IDEyOC4zOCAzOS44OTk4IDEyOC43MjcgMzkuNzU2QzEyOS4wNzQgMzkuNjEyMiAxMjkuMzcxIDM5LjM2ODcgMTI5LjU4IDM5LjA1NjNDMTI5Ljc4OSAzOC43NDM4IDEyOS45IDM4LjM3NjUgMTI5LjkgMzguMDAwN0MxMjkuOSAzNy40OTY5IDEyOS42OTkgMzcuMDE0IDEyOS4zNDMgMzYuNjU3N0MxMjguOTg3IDM2LjMwMTUgMTI4LjUwNCAzNi4xMDEyIDEyOCAzNi4xMDA3Wk0xMjggMzkuMTAwN0MxMjcuNzgzIDM5LjEwMDcgMTI3LjU3IDM5LjAzNjIgMTI3LjM4OSAzOC45MTUzQzEyNy4yMDggMzguNzk0NCAxMjcuMDY3IDM4LjYyMjYgMTI2Ljk4NCAzOC40MjE2QzEyNi45MDEgMzguMjIwNiAxMjYuODc5IDM3Ljk5OTQgMTI2LjkyMSAzNy43ODYxQzEyNi45NjQgMzcuNTcyNyAxMjcuMDY4IDM3LjM3NjcgMTI3LjIyMiAzNy4yMjI5QzEyNy4zNzYgMzcuMDY5IDEyNy41NzIgMzYuOTY0MiAxMjcuNzg2IDM2LjkyMThDMTI3Ljk5OSAzNi44Nzk0IDEyOC4yMiAzNi45MDExIDEyOC40MjEgMzYuOTg0NEMxMjguNjIyIDM3LjA2NzcgMTI4Ljc5NCAzNy4yMDg2IDEyOC45MTUgMzcuMzg5NUMxMjkuMDM2IDM3LjU3MDQgMTI5LjEgMzcuNzgzMSAxMjkuMSAzOC4wMDA3QzEyOS4xIDM4LjI5MjMgMTI4Ljk4NCAzOC41NzIgMTI4Ljc3OCAzOC43NzgyQzEyOC41NzEgMzguOTg0NCAxMjguMjkyIDM5LjEwMDQgMTI4IDM5LjEwMDdaXCIsIGZpbGw6IFwiIzM1QUM0NlwiIH0pKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi5vbmJvYXJkLmxpbmtMYXllclRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGkxOG4ub25ib2FyZC5saW5rTGF5ZXJDb250ZW50LFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IFwiI0VERDMxN1wiLFxuICAgICAgICAgICAgICAgIHNob3c6IHRydWUsXG4gICAgICAgICAgICAgICAgcGF0aDogKGgoXCJwYXRoXCIsIHsgZDogXCJNMTQ1Ljg4NyAzMS40NTA2QzE0NS44MDIgMjYuNzk5NCAxNDMuOTg2IDIyLjM0NyAxNDAuNzkyIDE4Ljk2NDJDMTM3LjU5OSAxNS41ODE0IDEzMy4yNTggMTMuNTExNiAxMjguNjIgMTMuMTU5NkMxMjguMjUzIDEzLjEyNTYgMTI3Ljg4MSAxMy4xMDE2IDEyNy41IDEzLjEwMTZDMTI3LjExOSAxMy4xMDE2IDEyNi43NDcgMTMuMTI1NiAxMjYuMzggMTMuMTU5NkMxMjEuNzQxIDEzLjUxMTYgMTE3LjQgMTUuNTgxNiAxMTQuMjA3IDE4Ljk2NDZDMTExLjAxNCAyMi4zNDc1IDEwOS4xOTcgMjYuODAwMiAxMDkuMTEzIDMxLjQ1MTZDMTA5LjExMyAzMS40ODY2IDEwOS4xMTkgMzEuNTE4NiAxMDkuMTIyIDMxLjU1MzZDMTA5LjExOCAzMS43MDM2IDEwOS4xIDMxLjg0OTYgMTA5LjEgMzIuMDAwNkMxMDkuMDYzIDM2LjM3NyAxMTAuNTU2IDQwLjYyODkgMTEzLjMyIDQ0LjAyMjFDMTE2LjA4NCA0Ny40MTUyIDExOS45NDYgNDkuNzM2NyAxMjQuMjQgNTAuNTg1NkMxMjQuNDA1IDUwLjYxODYgMTI0LjU3NyA1MC42Mzc2IDEyNC43NDUgNTAuNjY1NkMxMjUuMDc5IDUwLjcxNjYgMTI1LjQxMSA1MC43NzU2IDEyNS43NTIgNTAuODA5NkMxMjYuOTE0IDUwLjkzMDkgMTI4LjA4NiA1MC45MzA5IDEyOS4yNDggNTAuODA5NkMxMjkuNTg4IDUwLjc3NjYgMTI5LjkyMSA1MC43MTY2IDEzMC4yNTUgNTAuNjY0NkMxMzAuNDIzIDUwLjYzNzYgMTMwLjU5NSA1MC42MTg2IDEzMC43NiA1MC41ODU2QzEzNS4wNTMgNDkuNzM2NyAxMzguOTE2IDQ3LjQxNTIgMTQxLjY4IDQ0LjAyMjFDMTQ0LjQ0NCA0MC42Mjg5IDE0NS45MzcgMzYuMzc3IDE0NS45IDMyLjAwMDZDMTQ1LjkgMzEuODUwNiAxNDUuODgyIDMxLjcwMzYgMTQ1Ljg3OCAzMS41NTM2QzE0NS44ODEgMzEuNTE4NiAxNDUuODg3IDMxLjQ4NjYgMTQ1Ljg4NyAzMS40NTE2VjMxLjQ1MDZaTTE0Mi41MzQgNDEuMzYyNkwxNDIuMjc4IDQxLjY2NjZDMTQxLjcwNCA0Mi4yNTA0IDE0MS4wMDggNDIuNzAwNCAxNDAuMjQgNDIuOTg0NkMxNDEuNDQ1IDQwLjIxOTYgMTQyLjA0OSAzNy4yMzA0IDE0Mi4wMTMgMzQuMjE0NkMxNDMuMTAyIDMzLjkyNjMgMTQ0LjEzMyAzMy40NTA5IDE0NS4wNiAzMi44MDk2QzE0NC45MzUgMzUuODI1MSAxNDQuMDY3IDM4Ljc2MzEgMTQyLjUzNCA0MS4zNjI2Wk0xMTIuNzIyIDQxLjY2NjZMMTEyLjQ3MSA0MS4zNTg2QzExMC45MzYgMzguNzYwOSAxMTAuMDY3IDM1LjgyNDIgMTA5Ljk0MSAzMi44MDk2QzExMC44NjcgMzMuNDUwOCAxMTEuODk4IDMzLjkyNjIgMTEyLjk4NyAzNC4yMTQ2QzExMi45NTEgMzcuMjMwNCAxMTMuNTU1IDQwLjIxOTYgMTE0Ljc2IDQyLjk4NDZDMTEzLjk5MiA0Mi43MDAzIDExMy4yOTYgNDIuMjUwMyAxMTIuNzIyIDQxLjY2NjZaTTExMi4yOTggMjIuOTIyNkMxMTMuMDE1IDIzLjQzMTMgMTEzLjgzOCAyMy43NzMgMTE0LjcwNSAyMy45MjI2QzExMy42MjQgMjYuOTYyMyAxMTMuMDQ0IDMwLjE1NzcgMTEyLjk4OSAzMy4zODM2QzExMS4xMjQgMzIuODAxNiAxMTAuMDE0IDMyLjE0NjYgMTA5LjkyMyAzMS41MzI2QzEwOS45OTMgMjguNTEwNyAxMTAuODA5IDI1LjU1MyAxMTIuMjk4IDIyLjkyMjZaTTEyMC40NzYgMTYuNTEyNkMxMjEuMjMyIDE2Ljk2NzkgMTIyLjA2NCAxNy4yODExIDEyMi45MzMgMTcuNDM2NkMxMjIuMDc5IDE5LjUyOTQgMTIxLjQ1NSAyMS43MDg5IDEyMS4wNzIgMjMuOTM2NkMxMTkuMzAxIDIzLjgyOTQgMTE3LjUzNyAyMy42MjAzIDExNS43OSAyMy4zMTA2QzExNi43ODIgMjAuNzAwNyAxMTguMzkgMTguMzY4NyAxMjAuNDc2IDE2LjUxMjZaTTEzOS4yMTYgMjMuMzI0NkMxMzcuNDY2IDIzLjYyNjQgMTM1LjcwMSAyMy44MzE0IDEzMy45MjkgMjMuOTM4NkMxMzMuNTQ2IDIxLjcxMDIgMTMyLjkyMSAxOS41MyAxMzIuMDY3IDE3LjQzNjZDMTMyLjkzNSAxNy4yODExIDEzMy43NjggMTYuOTY3OSAxMzQuNTI0IDE2LjUxMjZDMTM2LjYxNCAxOC4zNzIzIDEzOC4yMjMgMjAuNzA5MiAxMzkuMjE2IDIzLjMyNDZaTTE0NS4wNzYgMzEuNTMyNkMxNDQuOTg2IDMyLjE0NjYgMTQzLjg3NiAzMi44MDI2IDE0Mi4wMTEgMzMuMzgzNkMxNDEuOTU1IDMwLjE1ODEgMTQxLjM3NiAyNi45NjMgMTQwLjI5NSAyMy45MjM2QzE0MS4xNjIgMjMuNzc0IDE0MS45ODQgMjMuNDMyMyAxNDIuNzAyIDIyLjkyMzZDMTQ0LjE5MSAyNS41NTM3IDE0NS4wMDYgMjguNTExMSAxNDUuMDc3IDMxLjUzMjZIMTQ1LjA3NlpNMTQxLjIxNCAzMy42MTU2QzEzOS4xNTkgMzQuMTQ0NiAxMzcuMDY3IDM0LjUyIDEzNC45NTYgMzQuNzM4NkMxMzQuOTE5IDMxLjM4NDQgMTM0LjYyMyAyOC4wMzgxIDEzNC4wNzEgMjQuNzI5NkMxMzUuODk2IDI0LjYyNjggMTM3LjcxMyAyNC40MTQ1IDEzOS41MTIgMjQuMDkzNkMxNDAuNjA4IDI3LjE1IDE0MS4xODMgMzAuMzY4NyAxNDEuMjE0IDMzLjYxNTZaTTEyNy45IDE3Ljg3NTZDMTI5LjAyMyAxNy44NjIzIDEzMC4xNDMgMTcuNzY3NCAxMzEuMjUzIDE3LjU5MTZDMTMyLjExNyAxOS42NDU4IDEzMi43NDcgMjEuNzkwNiAxMzMuMTMzIDIzLjk4NTZDMTMxLjU4NCAyNC4wNzU2IDEyOS44NDMgMjQuMTMwNiAxMjcuOSAyNC4xMzc2VjE3Ljg3NTZaTTEyNy45IDE3LjA3NTZWMTMuOTM2NkMxMjkuMDMzIDE0LjEzOTYgMTMwLjAzOCAxNS4xOTY2IDEzMC44OTMgMTYuODQwNkMxMjkuOTAxIDE2Ljk4NDcgMTI4LjkwMiAxNy4wNjI2IDEyNy45IDE3LjA3MzZWMTcuMDc1NlpNMTI3LjEgMTcuMDc1NkMxMjYuMDk4IDE3LjA2NDIgMTI1LjA5OCAxNi45ODYxIDEyNC4xMDcgMTYuODQxNkMxMjQuOTYyIDE1LjE5ODYgMTI1Ljk2NyAxNC4xNDA2IDEyNy4xIDEzLjkzNzZWMTcuMDc1NlpNMTI3LjEgMTcuODc1NlYyNC4xMzc2QzEyNS4zNTQgMjQuMTM0MiAxMjMuNjA5IDI0LjA4MzIgMTIxLjg2NyAyMy45ODQ2QzEyMi4yNTIgMjEuNzg5OSAxMjIuODgzIDE5LjY0NTUgMTIzLjc0NyAxNy41OTE2QzEyNC44NTYgMTcuNzY3MSAxMjUuOTc3IDE3Ljg2MTcgMTI3LjEgMTcuODc0NlYxNy44NzU2Wk0xMjcuMSAyNC45Mzk2VjM1LjE0NDZDMTI1LjAxMSAzNS4xMzUxIDEyMi45MjMgMzUuMDI4OSAxMjAuODQ0IDM0LjgyNjZDMTIwLjg2MyAzMS40NTkgMTIxLjE1NiAyOC4wOTg2IDEyMS43MjEgMjQuNzc4NkMxMjMuOTYxIDI0LjkwNTYgMTI2LjAwMSAyNC45MzQ2IDEyNy4xIDI0LjkzODZWMjQuOTM5NlpNMTI3LjEgMzUuOTQ0NlY0NS4wMzc2QzEyNS40MDUgNDUuMDI2OSAxMjMuNzExIDQ0LjkyMzEgMTIyLjAyOCA0NC43MjY2QzEyMS4yMTQgNDEuNzY0NiAxMjAuODE1IDM4LjcwNDEgMTIwLjg0MiAzNS42MzI2QzEyMi44NjkgMzUuODI3NiAxMjQuOTk5IDM1LjkzMjYgMTI3LjEgMzUuOTQ0NlpNMTI3LjEgNDUuODM3NlY1MC4wNzg2QzEyNC43MjIgNDkuODg3NiAxMjMuMjM1IDQ4LjAwNDYgMTIyLjMxMyA0NS41NTg2QzEyMy45MDMgNDUuNzMyOCAxMjUuNSA0NS44MjYzIDEyNy4xIDQ1LjgzODZWNDUuODM3NlpNMTI3LjkgNDUuODM3NkMxMjkuNDk5IDQ1LjgyNiAxMzEuMDk3IDQ1LjczMzIgMTMyLjY4NyA0NS41NTk2QzEzMS43NjUgNDguMDA0NiAxMzAuMjc3IDQ5Ljg4NzYgMTI3LjkgNTAuMDc5NlY0NS44Mzc2Wk0xMjcuOSA0NS4wMzc2VjM1Ljk0NDZDMTI5Ljk4OSAzNS45MzM5IDEzMi4wNzcgMzUuODI5OCAxMzQuMTU4IDM1LjYzMjZDMTM0LjE4NCAzOC43MDM4IDEzMy43ODUgNDEuNzYzOSAxMzIuOTcyIDQ0LjcyNTZDMTMxLjI4OCA0NC45MjIyIDEyOS41OTUgNDUuMDI2NCAxMjcuOSA0NS4wMzc2Wk0xMjcuOSAzNS4xNDQ2VjI0Ljk0MDZDMTI4Ljk5OSAyNC45MzU2IDEzMS4wMzggMjQuOTA2NiAxMzMuMjc5IDI0Ljc3OTZDMTMzLjg0MyAyOC4wOTk2IDEzNC4xMzYgMzEuNDYgMTM0LjE1NiAzNC44Mjc2QzEzMi4wNzYgMzUuMDI5OSAxMjkuOTg5IDM1LjEzNiAxMjcuOSAzNS4xNDU2VjM1LjE0NDZaTTEzMS43MjMgMTYuNjk0NkMxMzEuMjg4IDE1Ljc2MTIgMTMwLjY5MyAxNC45MTEgMTI5Ljk2NiAxNC4xODI2QzEzMS4zNzYgMTQuNTE4MyAxMzIuNzA0IDE1LjEzNjggMTMzLjg2OSAxNi4wMDA2QzEzMy4xODkgMTYuMzMxNyAxMzIuNDY3IDE2LjU2NTkgMTMxLjcyMyAxNi42OTY2VjE2LjY5NDZaTTEyMy4yNzcgMTYuNjk0NkMxMjIuNTMyIDE2LjU2NDcgMTIxLjgxIDE2LjMzMTEgMTIxLjEzIDE2LjAwMDZDMTIyLjI5NCAxNS4xMzcxIDEyMy42MjIgMTQuNTE5IDEyNS4wMzMgMTQuMTgzNkMxMjQuMzA1IDE0LjkxMjMgMTIzLjcxIDE1Ljc2MjggMTIzLjI3NiAxNi42OTY2TDEyMy4yNzcgMTYuNjk0NlpNMTIwLjkyOSAyNC43Mjk2QzEyMC4zNzYgMjguMDM4NCAxMjAuMDggMzEuMzg1MSAxMjAuMDQ0IDM0LjczOTZDMTE3LjkzMyAzNC41MjA2IDExNS44NDEgMzQuMTQ0OSAxMTMuNzg2IDMzLjYxNTZDMTEzLjgxNyAzMC4zNjg3IDExNC4zOTIgMjcuMTUgMTE1LjQ4OCAyNC4wOTM2QzExNy4yODcgMjQuNDE0NCAxMTkuMTAzIDI0LjYyNjggMTIwLjkyOCAyNC43Mjk2SDEyMC45MjlaTTExMy43OTQgMzQuNDUxNkMxMTUuODQ3IDM0Ljk2OTIgMTE3LjkzNiAzNS4zMzQ4IDEyMC4wNDQgMzUuNTQ1NkMxMTkuOTkgMzguNjAxNCAxMjAuMzUyIDQxLjY1MDQgMTIxLjEyMSA0NC42MDg2QzExOS4zNTQgNDQuMzc1MyAxMTcuNjEzIDQzLjk4MDkgMTE1LjkxOCA0My40MzA2QzExNC41MjMgNDAuNjQyOCAxMTMuNzk2IDM3LjU2ODggMTEzLjc5NCAzNC40NTE2Wk0xMjEuMzk2IDQ1LjQ0NDZDMTIxLjg4OCA0Ny4xMTQ5IDEyMi44NDcgNDguNjA5OCAxMjQuMTYgNDkuNzUzNkMxMjIuNTkzIDQ5LjQzNSAxMjEuMTA4IDQ4LjgwMDYgMTE5Ljc5NCA0Ny44ODlDMTE4LjQ4IDQ2Ljk3NzUgMTE3LjM2NiA0NS44MDc5IDExNi41MiA0NC40NTE2QzExOC4xMTggNDQuOTA0MSAxMTkuNzQ4IDQ1LjIzNjEgMTIxLjM5NiA0NS40NDQ2Wk0xMzMuNjA0IDQ1LjQ0NDZDMTM1LjI1MSA0NS4yMzY0IDEzNi44ODEgNDQuOTA0OCAxMzguNDc5IDQ0LjQ1MjZDMTM3LjYzMiA0NS44MDg1IDEzNi41MTggNDYuOTc3OCAxMzUuMjA0IDQ3Ljg4OUMxMzMuODkxIDQ4LjgwMDIgMTMyLjQwNSA0OS40MzQzIDEzMC44MzkgNDkuNzUyNkMxMzIuMTUyIDQ4LjYwOTYgMTMzLjExMSA0Ny4xMTUzIDEzMy42MDQgNDUuNDQ1NlY0NS40NDQ2Wk0xMzMuODggNDQuNjA4NkMxMzQuNjQ4IDQxLjY1MDQgMTM1LjAxIDM4LjYwMTQgMTM0Ljk1NiAzNS41NDU2QzEzNy4wNjMgMzUuMzM0OCAxMzkuMTUyIDM0Ljk2OTIgMTQxLjIwNiAzNC40NTE2QzE0MS4yMDQgMzcuNTY4OCAxNDAuNDc2IDQwLjY0MjggMTM5LjA4MiA0My40MzA2QzEzNy4zODcgNDMuOTgwOSAxMzUuNjQ2IDQ0LjM3NTIgMTMzLjg4IDQ0LjYwODZaTTE0Mi4yODIgMjIuMjEyNkMxNDIuMjgyIDIyLjQ4MjYgMTQxLjUxMiAyMi44MzY2IDE0MC4wMDUgMjMuMTY2NkMxMzguOTcyIDIwLjQwMTcgMTM3LjI4OCAxNy45MjYyIDEzNS4wOTYgMTUuOTQ5NkMxMzUuMTM0IDE1Ljg4NDkgMTM1LjE2NyAxNS44MTY1IDEzNS4xOTIgMTUuNzQ1NkMxMzguMTAxIDE3LjIxNDMgMTQwLjU1MiAxOS40NTA2IDE0Mi4yODIgMjIuMjEyNlpNMTM0LjQ2MiAxNS4zODM2QzEzNC40NiAxNS40MDA0IDEzNC40NTYgMTUuNDE3MSAxMzQuNDUyIDE1LjQzMzZDMTM0LjM4NiAxNS4zODM2IDEzNC4zMTcgMTUuMzM3NiAxMzQuMjUgMTUuMjg5NkMxMzQuMzIxIDE1LjMxOTYgMTM0LjM5MiAxNS4zNTI2IDEzNC40NjMgMTUuMzgzNkgxMzQuNDYyWk0xMjAuNTQ4IDE1LjQzMzZDMTIwLjU0MyAxNS40MTkyIDEyMC41NCAxNS40MDQ1IDEyMC41MzggMTUuMzg5NkMxMjAuNjA4IDE1LjM1ODYgMTIwLjY3OCAxNS4zMTk2IDEyMC43NSAxNS4yODk2QzEyMC42ODMgMTUuMzM3NiAxMjAuNjE0IDE1LjM4NDYgMTIwLjU0OCAxNS40MzQ2VjE1LjQzMzZaTTExOS44MDggMTUuNzQ1NkMxMTkuODMzIDE1LjgxNjUgMTE5Ljg2NSAxNS44ODQ5IDExOS45MDQgMTUuOTQ5NkMxMTcuNzE2IDE3LjkyMTMgMTE2LjAzNSAyMC4zOSAxMTUuMDAyIDIzLjE0NzZDMTEzLjU2OCAyMi44MjE2IDExMi44MTUgMjIuNDY3NiAxMTIuNzQyIDIyLjE3MTZDMTE0LjQ3IDE5LjQyOCAxMTYuOTEzIDE3LjIwNjYgMTE5LjgwOCAxNS43NDU2Wk0xMTMuODg1IDQzLjQ1MzZDMTE0LjM0MSA0My42NzkxIDExNC44MSA0My44Nzg0IDExNS4yODkgNDQuMDUwNkMxMTUuNzgxIDQ0LjkzNzQgMTE2LjM2OSA0NS43Njc0IDExNy4wNDMgNDYuNTI1NkMxMTUuODY4IDQ1LjYzNTEgMTE0LjgwNyA0NC42MDMzIDExMy44ODUgNDMuNDUzNlpNMTM3Ljk1NyA0Ni41MjU2QzEzOC42MyA0NS43Njc0IDEzOS4yMTkgNDQuOTM3NCAxMzkuNzExIDQ0LjA1MDZDMTQwLjE5IDQzLjg3ODQgMTQwLjY1OSA0My42NzkxIDE0MS4xMTUgNDMuNDUzNkMxNDAuMTkyIDQ0LjYwMzQgMTM5LjEzMiA0NS42MzUxIDEzNy45NTcgNDYuNTI1NlpcIiwgZmlsbDogXCIjRDlCQzAwXCIgfSkpXG4gICAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgICAgICAgIC5maWx0ZXIoKHNlY3Rpb24pID0+IHNlY3Rpb24uc2hvdylcbiAgICAgICAgICAgIC5tYXAodGhpcy5yZW5kZXJPbmJvYXJkaW5nU2VjdGlvbik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1pbmZvcm1hdGlvblwiLCB7IGxhYmVsOiBpMThuLm9uYm9hcmQudG9vbHRpcExhYmVsLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIGhlYWRpbmc6IGkxOG4ub25ib2FyZC50aXRsZSwgaGVhZGluZ0xldmVsOiAzLCBjbGFzczogXCJvbmJvYXJkaW5nXCIsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCBwYWRkZWRDb250ZW50OiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJvbmJvYXJkaW5nX19zY3JvbGxcIiB9LCBvbmJvYXJkaW5nQ29udGVudCkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4sIG5vUGFkZGluZywgaXNMb2FkaW5nLCBsb2FkaW5nVGV4dCwgaXNBY3RpdmUsIGRpc2FibGVDbG9zZUJ1dHRvbiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgY29udGVudFN0eWxlID0gdGhpcy5vdXRlckhlaWdodCA/IHsgaGVpZ2h0OiBgJHt0aGlzLm91dGVySGVpZ2h0fXB4YCB9IDoge307XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbW9kYWxcIiwgeyByZWY6IChlbGUpID0+ICh0aGlzLm1vZGFsUmVmID0gZWxlKSwgb3BlbjogaXNBY3RpdmUsIG9uQ2FsY2l0ZU1vZGFsQ2xvc2U6IHRoaXMuY2xvc2VEaWFsb2csIG91dHNpZGVDbG9zZURpc2FibGVkOiB0cnVlLCBlc2NhcGVEaXNhYmxlZDogdHJ1ZSwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcIm1vZGFsLS1ncmV5XCI6IG5vUGFkZGluZ1xuICAgICAgICAgICAgfSwgY2xvc2VCdXR0b25EaXNhYmxlZDogZGlzYWJsZUNsb3NlQnV0dG9uIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBoKFwiaDNcIiwgeyBpZDogXCJtb2RhbC10aXRsZVwiLCBjbGFzczogXCJoZWFkZXJfX3RpdGxlXCIgfSwgdGhpcy5nZXRIZWFkZXJUaXRsZSgpKSwgdGhpcy5wYWdlSGlzdG9yeVt0aGlzLnBhZ2VIaXN0b3J5Lmxlbmd0aCAtIDFdID09PSBcImhvbWVcIiAmJlxuICAgICAgICAgICAgaXNBY3RpdmUgJiZcbiAgICAgICAgICAgIHRoaXMucmVuZGVyT25ib2FyZGluZygpKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBzdHlsZTogY29udGVudFN0eWxlLCByZWY6IChlbCkgPT4gKHRoaXMuY29udGVudFNsb3QgPSBlbCksIGNsYXNzOiBcImNvbnRlbnRcIiB9LCBpc0xvYWRpbmcgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdGFnZVwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiBpc0xvYWRpbmcsIHRleHQ6IGxvYWRpbmdUZXh0ICE9PSBudWxsICYmIGxvYWRpbmdUZXh0ICE9PSB2b2lkIDAgPyBsb2FkaW5nVGV4dCA6IGkxOG4ubG9hZGluZ0RhdGEgfSkpKSwgIWlzTG9hZGluZyAmJiB0aGlzLmRpc3BsYXlQYWdlKCkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJiYWNrXCIgfSwgdGhpcy5zaG93QmFja0J1dHRvbiAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIFwiZGF0YS1pZFwiOiBcImJhY2tCdXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hdkVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyUGFnZVRyYW5zaXRpb24oXCJhcmNnaXNOZXdJdGVtUGFnZVByZXZcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogIXRoaXMubmF2RW5hYmxlZCB9LCBpMThuLmJhY2spKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwic2Vjb25kYXJ5XCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIFwiZGF0YS1pZFwiOiBcImNhbmNlbEJ1dHRvblwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFkaXNhYmxlQ2xvc2VCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6IGRpc2FibGVDbG9zZUJ1dHRvbiB9LCBpMThuLmNhbmNlbCksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwicHJpbWFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlclBhZ2VUcmFuc2l0aW9uKFwiYXJjZ2lzTmV3SXRlbVBhZ2VOZXh0XCIpO1xuICAgICAgICAgICAgfSwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogIXRoaXMubmF2RW5hYmxlZCB9LCB0aGlzLnByaW1hcnlCdXR0b25UZXh0KSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJpc0FjdGl2ZVwiOiBbXCJ1cGRhdGVBY3RpdmVcIl0sXG4gICAgICAgIFwiZmlyc3RTdGVwXCI6IFtcInVwZGF0ZUZpcnN0U3RlcFwiXSxcbiAgICAgICAgXCJmaWxlXCI6IFtcImluaXRpYWxpemVXaXRoRmlsZVwiXSxcbiAgICAgICAgXCJpbml0aWFsRm9sZGVyXCI6IFtcInVwZGF0ZUluaXRpYWxGb2xkZXJcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzTmV3SXRlbS5zdHlsZSA9IGFyY2dpc05ld0l0ZW1Dc3M7XG5cbmNvbnN0IGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeSA9IChsYWJlbCkgPT4ge1xuICAgIGNvbnN0IHsgdGVsZW1ldHJ5IH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICBldmVudFR5cGU6IFwibmV3IGl0ZW0gY2xpY2tcIixcbiAgICAgICAgcGFnZU5hbWU6IFwibXkgY29udGVudFwiLFxuICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbVwiLFxuICAgICAgICBsYWJlbFxuICAgIH07XG4gICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xuICAgIHVpU3RvcmVTdGF0ZS50ZWxlbWV0cnlEZXRhaWxzID0gbGFiZWw7XG59O1xuY29uc3QgaGFuZGxlQXBwbGljYXRpb25DbGljayA9ICgpID0+IHtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImFwcGxpY2F0aW9uXCI7XG4gICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBudWxsO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJXZWIgTWFwcGluZyBBcHBsaWNhdGlvblwiO1xuICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSBbXCJKYXZhU2NyaXB0XCIsIFwiT25saW5lIE1hcFwiLCBcIlJlYWR5IFRvIFVzZVwiXTtcbiAgICBhZGRJdGVtU3RhdGUudGh1bWJuYWlsVVJMID0gXCJodHRwczovL3N0YXRpYy5hcmNnaXMuY29tL2ltYWdlcy9kZXNrdG9wYXBwLnBuZ1wiO1xufTtcbmNvbnN0IGhhbmRsZUZlYXR1cmVMYXllckNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGFydFdvcmtmbG93KFwiY3JlYXRlIGZlYXR1cmUgbGF5ZXJcIiwge1xuICAgICAgICBjYXRlZ29yeTogXCJjcmVhdGUgZmVhdHVyZSBsYXllclwiLFxuICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCJcbiAgICB9KTtcbiAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImNyZWF0ZVwiO1xufTtcblxuY29uc3QgYXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3RDc3MgPSBcIi50aXRsZXttYXJnaW46MHB4O21hcmdpbi10b3A6MnJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5saXN0e21hcmdpbjowcHg7ZGlzcGxheTpmbGV4O2ZsZXgtd3JhcDp3cmFwO3BhZGRpbmc6MHB4O3BhZGRpbmctYm90dG9tOjAuNzVyZW19Lmxpc3QtaXRlbXttYXJnaW46MHB4O2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWl0ZW1zOnN0YXJ0O3BhZGRpbmc6MHB4O2xpc3Qtc3R5bGUtdHlwZTpub25lO2ZsZXg6MSAxIDM4MHB4fS5jYXJke21hcmdpbi10b3A6MS4yNXJlbTtkaXNwbGF5OmZsZXg7cGFkZGluZzowcHg7bWFyZ2luLWlubGluZS1lbmQ6MnJlbTtib3JkZXI6MXB4IHNvbGlkIHRyYW5zcGFyZW50O21heC13aWR0aDo0NDBweDthbGlnbi1pdGVtczpzdHJldGNoO2JhY2tncm91bmQtY29sb3I6d2hpdGU7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXQ7b3V0bGluZS1vZmZzZXQ6MHB4O291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7Zm9udC1mYW1pbHk6aW5oZXJpdDt0ZXh0LWFsaWduOmluaXRpYWw7Y3Vyc29yOnBvaW50ZXJ9LmNhcmQ6aG92ZXJ7Ym9yZGVyLWNvbG9yOiNhYWF9LmNhcmQ6Zm9jdXN7b3V0bGluZTpub25lO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0uY2FyZDpob3ZlciAuY2FyZF9faWNvbiwuY2FyZDpmb2N1cyAuY2FyZF9faWNvbntiYWNrZ3JvdW5kLWNvbG9yOnJnYigyMzgsIDI0NywgMjUzKX0uY2FyZDpob3ZlciAuY2FyZF9fYXJyb3csLmNhcmQ6Zm9jdXMgLmNhcmRfX2Fycm93e29wYWNpdHk6MTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMCwgMCl9LmNhcmRfX2Fycm93e3ZlcnRpY2FsLWFsaWduOi02cHg7b3BhY2l0eTowO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgtMjBweCwgMCwgMCk7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXR9LmNhcmRfX2ljb257ZmxleDowIDAgYXV0bztkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7d2lkdGg6ODdweDttaW4taGVpZ2h0Ojg3cHg7Y29sb3I6IzAwMDAwMDtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCk7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXR9LmNhcmRfX2NvbnRlbnR7cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW19LmNhcmRfX3RpdGxle21hcmdpbjowcHg7cGFkZGluZzowcHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NDAwO2xpbmUtaGVpZ2h0OjEuMjVyZW07Y29sb3I6IzMyMzIzMn0uY2FyZF9fc3VidGl0bGV7bWFyZ2luOjBweDttYXJnaW4tdG9wOjAuNXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NDAwO2xpbmUtaGVpZ2h0OjEuMjVyZW07Y29sb3I6IzY0NjQ2NH1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVSZWRpcmVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiaGFuZGxlUmVkaXJlY3RcIiwgNyk7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uY3JlYXRlTGF5ZXJzTGlzdDtcbiAgICAgICAgY29uc3QgeyB1c2VyLCBwb3J0YWwsIHVzZXJMaWNlbnNlZEl0ZW1zIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICBjb25zdCB7IHJlc3VsdDogc3Vic2NyaXB0aW9uSW5mbyB9ID0gYXdhaXQgZnJvbUNhY2hlKCgpID0+IGdldFN1YnNjcmlwdGlvbkluZm8oY29uZmlnU3RhdGUucG9ydGFsKSwgXCJzdWJzY3JpcHRpb25UeXBlXCIsIGdldFVzZXJJZChjb25maWdTdGF0ZS51c2VyKSk7XG4gICAgICAgIGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm8gPSBzdWJzY3JpcHRpb25JbmZvO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAvLyBUT0RPOiBmaWx0ZXIgb3B0aW9ucyBiYXNlZCBvbiB1c2VyJ3MgcGVybWlzc2lvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5mZWF0dXJlTGF5ZXJIZWFkaW5nLFxuICAgICAgICAgICAgICAgIGljb246IFwiZmVhdHVyZUxheWVyXCIsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi5mZWF0dXJlTGF5ZXJEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJmZWF0dXJlTGF5ZXJcIikgJiYgY2FuUHVibGlzaEZlYXR1cmVzKHVzZXIsIHBvcnRhbCksXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogdGhpcy5vbkZlYXR1cmVMYXllckNsaWNrXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi51cmxIZWFkaW5nLFxuICAgICAgICAgICAgICAgIGljb246IFwid2ViXCIsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi51cmxEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJ1cmxcIiksXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogdGhpcy5vblVSTENsaWNrXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5kZXZlbG9wZXJDcmVkZW50aWFsc0hlYWRpbmcsXG4gICAgICAgICAgICAgICAgaWNvbjogXCJrZXlcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW1wiZGV2ZWxvcGVyQ3JlZGVudGlhbHNOb0FQSURlc2NyaXB0aW9uXCJdLFxuICAgICAgICAgICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImRldmVsb3BlckNyZWRlbnRpYWxzXCIpICYmXG4gICAgICAgICAgICAgICAgICAgIGNhbkNyZWF0ZURldmVsb3BlckNyZWRlbnRpYWxzKHVzZXIpLFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMub25EZXZlbG9wZXJDcmVkZW50aWFsc0NsaWNrXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5hcHBsaWNhdGlvbkhlYWRpbmcsXG4gICAgICAgICAgICAgICAgaWNvbjogXCJhcHBzXCIsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuaTE4bi5hcHBsaWNhdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImFwcGxpY2F0aW9uXCIpLFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMub25BcHBsaWNhdGlvbkNsaWNrXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5pbWFnZUxheWVySGVhZGluZyxcbiAgICAgICAgICAgICAgICBpY29uOiBcImltYWdlTGF5ZXJcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLmltYWdlTGF5ZXJEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzaG93OiBjb25maWdTdGF0ZS5hbGxvd2VkTW9kZXMuaW5jbHVkZXMoXCJpbWFnZXJ5TGF5ZXJcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgY2FuUHVibGlzaEltYWdlQ29sbGVjdGlvbih1c2VyLCBwb3J0YWwsIHVzZXJMaWNlbnNlZEl0ZW1zKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLm9uSW1hZ2VyeUxheWVyQ2xpY2tcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLnRpbGVMYXllckhlYWRpbmcsXG4gICAgICAgICAgICAgICAgaWNvbjogXCJ0aWxlTGF5ZXJcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLnRpbGVMYXllckRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcInRpbGVMYXllclwiKSAmJiBjYW5QdWJsaXNoVGlsZXModXNlciwgcG9ydGFsKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLm9uVGlsZUxheWVyQ2xpY2tcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLnNjZW5lTGF5ZXJIZWFkaW5nLFxuICAgICAgICAgICAgICAgIGljb246IFwibGF5ZXJHcmFwaGljc1wiLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uc2NlbmVMYXllckRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMub25TY2VuZUxheWVyQ2xpY2ssXG4gICAgICAgICAgICAgICAgc2hvdzogY29uZmlnU3RhdGUuYWxsb3dlZE1vZGVzLmluY2x1ZGVzKFwic2NlbmVMYXllclwiKSAmJiBjYW5QdWJsaXNoU2NlbmVzKHVzZXIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5sb2NhdG9ySGVhZGluZyxcbiAgICAgICAgICAgICAgICBpY29uOiBcImxvY2F0b3JcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW2NhbkNyZWF0ZUxvY2F0b3JWaWV3KHVzZXIsIHBvcnRhbCkgPyBcImxvY2F0b3JEZXNjcmlwdGlvblwiIDogXCJsb2NhdG9yT25seURlc2NyaXB0aW9uXCJdLFxuICAgICAgICAgICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcImxvY2F0b3JcIikgJiYgY2FuQ3JlYXRlTG9jYXRvcih1c2VyKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLm9uTG9jYXRvckNsaWNrXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuaTE4bi5kYXRhU3RvcmVIZWFkaW5nLFxuICAgICAgICAgICAgICAgIGljb246IFwiZGF0YVwiLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4uZGF0YVN0b3JlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc2hvdzogY29uZmlnU3RhdGUuYWxsb3dlZE1vZGVzLmluY2x1ZGVzKFwiZGF0YVN0b3JlXCIpICYmIGNhbkNyZWF0ZURhdGFTdG9yZSh1c2VyLCBwb3J0YWwpLFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMub25EYXRhU3RvcmVDbGljayAvKiBGb3IgRW50ZXJwcmlzZSAqL1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBoZWFkaW5nOiB0aGlzLmkxOG4uZGF0YVN0b3JlSGVhZGluZyxcbiAgICAgICAgICAgICAgICBpY29uOiBcImRhdGFcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLmRhdGFTdG9yZUNvbm5lY3Rpb25EZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzaG93OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLm9uRGF0YVN0b3JlQ29ubmVjdGlvbkNsaWNrIC8qIFBsYWNlaG9sZGVyIGZvciBPbmxpbmUgaW1wbGVtZW50YXRpb24gKi9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVhZGluZzogdGhpcy5pMThuLnJhc3RlckZ1bmN0aW9uVGVtcGxhdGVIZWFkaW5nLFxuICAgICAgICAgICAgICAgIGljb246IFwibmV3LXJhc3Rlci1mdW5jdGlvbi10ZW1wbGF0ZVwiLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmkxOG4ucmFzdGVyRnVuY3Rpb25UZW1wbGF0ZURlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHNob3c6IGNvbmZpZ1N0YXRlLmFsbG93ZWRNb2Rlcy5pbmNsdWRlcyhcInJhc3RlckZ1bmN0aW9uVGVtcGxhdGVcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlSXRlbXModXNlcikgJiZcbiAgICAgICAgICAgICAgICAgICAgIWlzUHVibGljVXNlcih1c2VyKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLm9uUmFzdGVyRnVuY3Rpb25UZW1wbGF0ZUNsaWNrXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfVxuICAgIG9uRmVhdHVyZUxheWVyQ2xpY2soKSB7XG4gICAgICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImZlYXR1cmUgbGF5ZXJcIik7XG4gICAgICAgIGhhbmRsZUZlYXR1cmVMYXllckNsaWNrKCk7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImZlYXR1cmVMYXllclNlbGVjdFwiKTtcbiAgICB9XG4gICAgb25UaWxlTGF5ZXJDbGljaygpIHtcbiAgICAgICAgaGFuZGxlQ3JlYXRlTGF5ZXJMaXN0VGVsZW1ldHJ5KFwidGlsZSBsYXllclwiKTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJ0aWxlTGF5ZXJcIjtcbiAgICAgICAgbG9nVGlsZUxheWVyU3RhcnQoKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwidGlsZUxheWVyU2VsZWN0XCIpO1xuICAgIH1cbiAgICBvblNjZW5lTGF5ZXJDbGljaygpIHtcbiAgICAgICAgaGFuZGxlQ3JlYXRlTGF5ZXJMaXN0VGVsZW1ldHJ5KFwic2NlbmUgbGF5ZXJcIik7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwic2NlbmVMYXllclwiO1xuICAgICAgICAvLyBUT0RPOiBhZGQgdGVsZW1ldHJ5XG4gICAgICAgIC8vIGxvZ1RpbGVMYXllclN0YXJ0KCk7XG4gICAgICAgIGlmIChjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInNjZW5lTGF5ZXJTZWxlY3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBXZSBvbmx5IGhhdmUgMSBvcHRpb24gaW4gQUdPTCBzbyBqdXN0IHNraXAgdGhlIHNlbGVjdCBzY3JlZW4gZGlyZWN0bHlcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImxheWVyVXBsb2FkXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uSW1hZ2VyeUxheWVyQ2xpY2soKSB7XG4gICAgICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImltYWdlcnkgbGF5ZXJcIik7XG4gICAgICAgIHRoaXMuaGFuZGxlUmVkaXJlY3QuZW1pdCh7IHR5cGU6IFwiSW1hZ2VyeSBMYXllclwiIH0pO1xuICAgIH1cbiAgICBvblVSTENsaWNrKCkge1xuICAgICAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJ1cmxcIik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInVybFR5cGVTZWxlY3RcIik7XG4gICAgfVxuICAgIG9uRGF0YVN0b3JlQ2xpY2soKSB7XG4gICAgICAgIGNvbnN0IHVzZU5ld1dvcmtmbG93ID0gY29uZmlnU3RhdGUuY29uZmlnLmFkZERhdGFzdG9yZUNvbXBvbmVudEVuYWJsZWQ7XG4gICAgICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImRhdGEgc3RvcmVcIik7XG4gICAgICAgIGlmICghdXNlTmV3V29ya2Zsb3cpIHtcbiAgICAgICAgICAgIC8vIFByZXZpb3VzIGhhbmRsZXIgZm9yIHJlZGlyZWN0aW5nIHRvIHRoZSBkb2pvLWJhc2VkIHdvcmtmbG93XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVJlZGlyZWN0LmVtaXQoeyB0eXBlOiBcIkRhdGEgU3RvcmVcIiB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIE1pZ3JhdGVkIFVJIGZvciBhZGRpbmcgZGF0YSBzdG9yZXMgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNDI5XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImRhdGFTdG9yZVwiO1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZGF0YVN0b3JlU2VsZWN0XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uRGF0YVN0b3JlQ29ubmVjdGlvbkNsaWNrKCkge1xuICAgICAgICAvL2tlZXBpbmcgdGhpcyBzZXBhcmF0ZSBmcm9tIG9uRGF0YVN0b3JlQ2xpY2sgd2hlbiB0aGlzIG9wZW5zIHVwIHRvIG5ldyBpdGVtIGZvciBPbmxpbmVcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJkYXRhU3RvcmVcIjtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZGF0YVN0b3JlU2VsZWN0XCIpO1xuICAgIH1cbiAgICBvbkFwcGxpY2F0aW9uQ2xpY2soKSB7XG4gICAgICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImFuIGFwcFwiKTtcbiAgICAgICAgaGFuZGxlQXBwbGljYXRpb25DbGljaygpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJhcHBsaWNhdGlvblwiKTtcbiAgICB9XG4gICAgYXN5bmMgb25Mb2NhdG9yQ2xpY2soKSB7XG4gICAgICAgIGhhbmRsZUNyZWF0ZUxheWVyTGlzdFRlbGVtZXRyeShcImxvY2F0b3JcIik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImxvY2F0b3JTZWxlY3RcIik7XG4gICAgfVxuICAgIG9uRGV2ZWxvcGVyQ3JlZGVudGlhbHNDbGljaygpIHtcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJkZXZlbG9wZXJDcmVkZW50aWFsc1wiO1xuICAgICAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJkZXYgY3JlZFwiKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZGV2ZWxvcGVyQ3JlZGVudGlhbHNTZWxlY3RcIik7XG4gICAgfVxuICAgIG9uUmFzdGVyRnVuY3Rpb25UZW1wbGF0ZUNsaWNrKCkge1xuICAgICAgICBoYW5kbGVDcmVhdGVMYXllckxpc3RUZWxlbWV0cnkoXCJyYXN0ZXIgZnVuY3Rpb24gdGVtcGxhdGVcIik7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJSYXN0ZXIgZnVuY3Rpb24gdGVtcGxhdGVcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJyYXN0ZXJGdW5jdGlvblRlbXBsYXRlXCI7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcIml0ZW1Qcm9wZXJ0aWVzXCIpO1xuICAgIH1cbiAgICByZW5kZXJPcHRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1hcCgob3B0aW9uKSA9PiBvcHRpb24uc2hvdyAmJiAoaChcImxpXCIsIHsgY2xhc3M6IFwibGlzdC1pdGVtXCIgfSwgaChcImJ1dHRvblwiLCB7IGNsYXNzOiBcImNhcmRcIiwgb25DbGljazogb3B0aW9uLmhhbmRsZXIuYmluZCh0aGlzKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2FyZF9faWNvblwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBvcHRpb24uaWNvbiwgc2NhbGU6IFwibFwiIH0pKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNhcmRfX2NvbnRlbnRcIiB9LCBoKFwiaDRcIiwgeyBjbGFzczogXCJjYXJkX190aXRsZVwiIH0sIG9wdGlvbi5oZWFkaW5nLCBcIiBcIiwgaChcImNhbGNpdGUtaWNvblwiLCB7IGNsYXNzOiBcImNhcmRfX2Fycm93XCIsIGljb246IFwiYXJyb3ctcmlnaHRcIiwgXCJmbGlwLXJ0bFwiOiB0cnVlIH0pKSwgaChcImg0XCIsIHsgY2xhc3M6IFwiY2FyZF9fc3VidGl0bGVcIiB9LCBvcHRpb24uZGVzY3JpcHRpb24pKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpc0xvYWRpbmcsIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcIm5hdlwiLCB7IFwiYXJpYS1sYWJlbGxlZGJ5XCI6IFwibGF5ZXJzLWxpc3QtaGVhZGluZ1wiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiBpc0xvYWRpbmcsIHRleHQ6IGkxOG4uZ2V0U3Vic2NyaXB0aW9uSW5mbyB9KSwgaChcInVsXCIsIHsgY2xhc3M6IFwibGlzdFwiIH0sIHRoaXMucmVuZGVyT3B0aW9ucygpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtQ3JlYXRlTGF5ZXJzTGlzdENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbUNzdkZpZWxkQ3NzID0gXCIuY2VsbHtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6MzMuMzMzMzMzJX0uY2VsbCBsYWJlbHttYXJnaW4tdG9wOjAuNzVyZW0gIWltcG9ydGFudH0ucm93e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Z2FwOjAuMjVyZW07cGFkZGluZzowLjI1cmVtO2JvcmRlci10b3A6MXB4IHNvbGlkICNlYWVhZWF9LmRlc2VsZWN0ZWR7b3BhY2l0eTp2YXIoLS1jYWxjaXRlLXVpLW9wYWNpdHktZGlzYWJsZWQpfS5zY3JlZW4tcmVhZGVycy1vbmx5e3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjFweDtoZWlnaHQ6MXB4O3BhZGRpbmc6MDttYXJnaW46LTFweDtvdmVyZmxvdzpoaWRkZW47Y2xpcDpyZWN0KDAsIDAsIDAsIDApO3doaXRlLXNwYWNlOm5vd3JhcDtib3JkZXItd2lkdGg6MH0ubGFiZWx7LS1jYWxjaXRlLWxhYmVsLW1hcmdpbi1ib3R0b206MDtwb3NpdGlvbjpyZWxhdGl2ZX0uZmllbGQtbmFtZXtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXB9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1Dc3ZGaWVsZCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuZmllbGRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZpZWxkQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmhhbmRsZVR5cGVDaGFuZ2UgPSAoZXYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXYudGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlO1xuICAgICAgICAgICAgdGhpcy5maWVsZENoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLmZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICAga2V5OiBcInR5cGVcIixcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBtb2RpZmllZDogdmFsdWUgIT09IHRoaXMuaW5pdGlhbEZpZWxkLnR5cGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmRlZmF1bHRDaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5maWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWVsZFR5cGVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRldGVjdGVkVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jYW5IaWRlRmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRpc3BsYXlOYW1lTGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudHlwZUxhYmVsID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5jaGVja2VkID0gdGhpcy5kZWZhdWx0Q2hlY2tlZDtcbiAgICAgICAgdGhpcy5hbGxvd2VkRmllbGRUeXBlcyA9IGdldEFsbG93ZWRGaWVsZFR5cGVzKHRoaXMuZGV0ZWN0ZWRUeXBlKTtcbiAgICAgICAgLy8gVGVsZW1ldHJ5OiBDYXB0dXJlIGRlZmF1bHQgc3RhdGUgb2YgdGhlIGZpZWxkXG4gICAgICAgIHRoaXMuaW5pdGlhbEZpZWxkID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5maWVsZCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBmaWVsZCwgY2FuSGlkZUZpZWxkcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZGVzZWxlY3RlZCA9ICFmaWVsZC5zZWxlY3RlZDtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm93XCIsIHJvbGU6IFwicm93XCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjZWxsXCIsIGxheW91dDogXCJpbmxpbmVcIiwgcm9sZTogXCJjZWxsXCIgfSwgY2FuSGlkZUZpZWxkcyAmJiAoaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogKGV2KSA9PiB0aGlzLmZpZWxkQ2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgICAgIG5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICAga2V5OiBcInNlbGVjdGVkXCIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGV2LnRhcmdldC5jaGVja2VkXG4gICAgICAgICAgICB9KSwgY2hlY2tlZDogZmllbGQuc2VsZWN0ZWQgfSkpLCBoKFwic3BhblwiLCB7IGNsYXNzOiB7IFwiZmllbGQtbmFtZVwiOiB0cnVlLCBkZXNlbGVjdGVkIH0gfSwgZmllbGQubmFtZSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImNlbGwgbGFiZWxcIiwgcm9sZTogXCJjZWxsXCIgfSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBkaXNhYmxlZDogZGVzZWxlY3RlZCwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZENoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiBcImFsaWFzXCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllZDogdmFsdWUgIT09IHRoaXMuaW5pdGlhbEZpZWxkLmFsaWFzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCB2YWx1ZTogZmllbGQuYWxpYXMgfHwgZmllbGQubmFtZSB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgdGhpcy5kaXNwbGF5TmFtZUxhYmVsKSksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiB0aGlzLnR5cGVMYWJlbCwgY2xhc3M6IFwiY2VsbFwiLCByb2xlOiBcImNlbGxcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIsIGRpc2FibGVkOiBkZXNlbGVjdGVkLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMuaGFuZGxlVHlwZUNoYW5nZSB9LCBPYmplY3Qua2V5cyh0aGlzLmZpZWxkVHlwZXMpXG4gICAgICAgICAgICAuZmlsdGVyKChmaWVsZFR5cGUpID0+IHRoaXMuYWxsb3dlZEZpZWxkVHlwZXMuaW5jbHVkZXMoZmllbGRUeXBlKSlcbiAgICAgICAgICAgIC5tYXAoKHR5cGUpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogZmllbGQudHlwZSA9PT0gdHlwZSwgdmFsdWU6IHR5cGUsIGtleTogZmllbGQubmFtZSB9LCB0aGlzLmZpZWxkVHlwZXNbdHlwZV0pKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtQ3N2RmllbGQuc3R5bGUgPSBhcmNnaXNOZXdJdGVtQ3N2RmllbGRDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJDc3MgPSBcIi5jb250YWluZXJ7bWFyZ2luLWJvdHRvbTowLjVyZW07Ym9yZGVyOjFweCBzb2xpZDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSk7cGFkZGluZzoxNnB4O21heC13aWR0aDoxMDAlfS5jb250ZW50LWNvbnRhaW5lcntkaXNwbGF5OmZsZXh9LmlucHV0c3tkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO3dpZHRoOjEwMCV9QG1lZGlhIChtaW4td2lkdGg6IDg2NHB4KXsuaW5wdXRze2ZsZXgtZGlyZWN0aW9uOnJvd319LmlucHV0cyBjYWxjaXRlLWxhYmVse2ZsZXg6MSAxIDAlfUBtZWRpYSAobWluLXdpZHRoOiA4NjRweCl7LmlucHV0cyBjYWxjaXRlLWxhYmVsOmZpcnN0LWNoaWxke21hcmdpbi1pbmxpbmUtZW5kOjAuNzVyZW19fS5kZWxldGUtY29udGFpbmVye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmZsZXgtZW5kO3Bvc2l0aW9uOnJlbGF0aXZlO21hcmdpbi1pbmxpbmUtc3RhcnQ6MS41cmVtO21hcmdpbi10b3A6MTBweH0uZGVsZXRlLWJ0bntjdXJzb3I6cG9pbnRlcjtib3JkZXItc3R5bGU6bm9uZTtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2hlaWdodDotbW96LWZpdC1jb250ZW50O2hlaWdodDpmaXQtY29udGVudDtwYWRkaW5nOjZweH0uZGVsZXRlLWJ0bjpmb2N1c3tvdXRsaW5lOjVweCBhdXRvO291dGxpbmUtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZC1ob3Zlcil9LmNoZWNrYm94e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9Y2FsY2l0ZS1jaGVja2JveHttYXJnaW4taW5saW5lLWVuZDo1cHh9LmRlbGV0ZS1idG4tcG9wb3Zlcnt3aGl0ZS1zcGFjZTpub3dyYXA7cGFkZGluZy1sZWZ0OjAuNXJlbTtwYWRkaW5nLXJpZ2h0OjAuNXJlbTtwYWRkaW5nLXRvcDowLjI1cmVtO3BhZGRpbmctYm90dG9tOjAuMjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnJlbW92ZUN1c3RvbVBhcmFtZXRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmVtb3ZlQ3VzdG9tUGFyYW1ldGVyXCIsIDcpO1xuICAgICAgICB0aGlzLnVwZGF0ZUN1c3RvbVBhcmFtZXRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidXBkYXRlQ3VzdG9tUGFyYW1ldGVyXCIsIDcpO1xuICAgICAgICB0aGlzLml0ZW1UeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dBcHBlbmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZWxldGVCdXR0b25SZWYgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZGVsZXRlVG9vbHRpcE9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xuICAgICAgICBhd2FpdCB0aW1lb3V0KDUwMCk7XG4gICAgICAgIGNvbnN0IG9wZW5Ub29sdGlwID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kZWxldGVUb29sdGlwT3BlbiA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGNsb3NlVG9vbHRpcCA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlVG9vbHRpcE9wZW4gPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kZWxldGVCdXR0b25SZWYub25mb2N1cyA9IG9wZW5Ub29sdGlwO1xuICAgICAgICB0aGlzLmRlbGV0ZUJ1dHRvblJlZi5vbmJsdXIgPSBjbG9zZVRvb2x0aXA7XG4gICAgICAgIHRoaXMuZGVsZXRlQnV0dG9uUmVmLm9ubW91c2VvdmVyID0gb3BlblRvb2x0aXA7XG4gICAgICAgIHRoaXMuZGVsZXRlQnV0dG9uUmVmLm9ubW91c2VvdXQgPSBjbG9zZVRvb2x0aXA7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmhhbmRsZUl0ZW1UeXBlQ2hhbmdlKCk7XG4gICAgfVxuICAgIGFzeW5jIHNldEZvY3VzKGRlbGF5ID0gMCkge1xuICAgICAgICBhd2FpdCB0aW1lb3V0KGRlbGF5KTtcbiAgICAgICAgdGhpcy5tYWluSW5wdXRSZWYuc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgaGFuZGxlSXRlbVR5cGVDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuc2hvd0FwcGVuZCA9IFtcIldNU1wiLCBcIldNVFNcIl0uc29tZSgodHlwZSkgPT4gdHlwZSA9PT0gdGhpcy5pdGVtVHlwZSk7XG4gICAgfVxuICAgIGhhbmRsZUlucHV0Q2hhbmdlKGV2ZW50LCB0eXBlKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQYXJhbWV0ZXIgPSB0eXBlID09PSBcInBhcmFtZXRlclwiXG4gICAgICAgICAgICA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXN0b21QYXJhbWV0ZXIpLCB7IHBhcmFtZXRlcjogbm9kZS52YWx1ZSB9KSA6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXN0b21QYXJhbWV0ZXIpLCB7IHZhbHVlOiBub2RlLnZhbHVlIH0pO1xuICAgICAgICB0aGlzLnVwZGF0ZUN1c3RvbVBhcmFtZXRlci5lbWl0KHsgaW5kZXg6IHRoaXMuaW5kZXgsIGN1c3RvbVBhcmFtZXRlcjogdXBkYXRlZFBhcmFtZXRlciB9KTtcbiAgICB9XG4gICAgaGFuZGxlQ2hlY2tib3hDaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgdXBkYXRlZFBhcmFtZXRlciA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXN0b21QYXJhbWV0ZXIpLCB7IGFwcGVuZDogZXZlbnQudGFyZ2V0LmNoZWNrZWQgPyBcImxheWVyXCIgOiBcImFsbFwiIH0pO1xuICAgICAgICB0aGlzLnVwZGF0ZUN1c3RvbVBhcmFtZXRlci5lbWl0KHsgaW5kZXg6IHRoaXMuaW5kZXgsIGN1c3RvbVBhcmFtZXRlcjogdXBkYXRlZFBhcmFtZXRlciB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250YWluZXJcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGVudC1jb250YWluZXJcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW5wdXRzXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5pMThuLnBhcmFtZXRlciwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBwbGFjZWhvbGRlcjogdGhpcy5pMThuLmFkZFBhcmFtZXRlciwgdmFsdWU6IChfYSA9IHRoaXMuY3VzdG9tUGFyYW1ldGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucGFyYW1ldGVyLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZXYpID0+IHRoaXMuaGFuZGxlSW5wdXRDaGFuZ2UoZXYsIFwicGFyYW1ldGVyXCIpLCByZWY6IChlbGUpID0+ICh0aGlzLm1haW5JbnB1dFJlZiA9IGVsZSkgfSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aGlzLmkxOG4udmFsdWUsIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgcGxhY2Vob2xkZXI6IHRoaXMuaTE4bi5hZGRWYWx1ZSwgdmFsdWU6IChfYiA9IHRoaXMuY3VzdG9tUGFyYW1ldGVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudmFsdWUsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChldikgPT4gdGhpcy5oYW5kbGVJbnB1dENoYW5nZShldiwgXCJ2YWx1ZVwiKSB9KSkpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGVsZXRlLWNvbnRhaW5lclwiIH0sIGgoXCJidXR0b25cIiwgeyBjbGFzczogXCJkZWxldGUtYnRuXCIsIFwiYXJpYS1sYWJlbFwiOiB0aGlzLmkxOG4ucmVtb3ZlLCBvbkNsaWNrOiAoKSA9PiB0aGlzLnJlbW92ZUN1c3RvbVBhcmFtZXRlci5lbWl0KHRoaXMuaW5kZXgpLCByZWY6IChlbGUpID0+ICh0aGlzLmRlbGV0ZUJ1dHRvblJlZiA9IGVsZSkgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IFwidHJhc2hcIiwgc2NhbGU6IFwic1wiIH0pKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGxhYmVsOiB0aGlzLmkxOG4ucmVtb3ZlLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMuZGVsZXRlQnV0dG9uUmVmLCBvcGVuOiB0aGlzLmRlbGV0ZVRvb2x0aXBPcGVuIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZWxldGUtYnRuLXBvcG92ZXJcIiB9LCB0aGlzLmkxOG4ucmVtb3ZlKSkpKSwgdGhpcy5zaG93QXBwZW5kICYmIChoKFwibGFiZWxcIiwgeyBjbGFzczogXCJjaGVja2JveFwiIH0sIGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgY2hlY2tlZDogdGhpcy5jdXN0b21QYXJhbWV0ZXIuYXBwZW5kID09PSBcImxheWVyXCIsIG9uQ2FsY2l0ZUNoZWNrYm94Q2hhbmdlOiAoZXYpID0+IHRoaXMuaGFuZGxlQ2hlY2tib3hDaGFuZ2UoZXYpLCBvbkNsaWNrOiAoZXYpID0+IGV2LnByZXZlbnREZWZhdWx0KCkgfSksIHRoaXMuaTE4bi5hcHBlbmQpKSkpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcIml0ZW1UeXBlXCI6IFtcImhhbmRsZUl0ZW1UeXBlQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXIuc3R5bGUgPSBhcmNnaXNOZXdJdGVtQ3VzdG9tUGFyYW1ldGVyQ3NzO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtQ3VzdG9tUGFyYW1ldGVyc0NzcyA9IFwiOmhvc3R7Zm9udC1mYW1pbHk6QXZlbmlyIE5leHQsIEF2ZW5pciwgSGVsdmV0aWNhIE5ldWUsIHNhbnMtc2VyaWY7Zm9udC1zaXplOjAuODc1cmVtO21hcmdpbi1ib3R0b206MTRweH0ubGFiZWx7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7bGluZS1oZWlnaHQ6MTZweDttYXJnaW4tYm90dG9tOjhweH0uc3ViLWhlYWRlcntmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpO2Rpc3BsYXk6ZmxleDttYXJnaW4tdG9wOjBweDtsaW5lLWhlaWdodDoxOHB4fS5oZWxwLXRleHR7ZGlzcGxheTpibG9jazttYXgtd2lkdGg6MjByZW19LmFkZHtkaXNwbGF5OmZsZXg7Y3Vyc29yOnBvaW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7Zm9udC1mYW1pbHk6QXZlbmlyIE5leHQsIEF2ZW5pciwgSGVsdmV0aWNhIE5ldWUsIHNhbnMtc2VyaWY7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDttYXJnaW4tYm90dG9tOjAuNXJlbTtwYWRkaW5nLWlubGluZS1zdGFydDowcHg7dHJhbnNpdGlvbi1kdXJhdGlvbjoyMDBtcztjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayk7Ym9yZGVyOm5vbmU7Ym94LXNoYWRvdzpub25lO2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7cGFkZGluZzoxMHB4O2xpbmUtaGVpZ2h0OjE2cHh9LmFkZDpmb2N1cywuYWRkOmZvY3VzLXZpc2libGV7b3V0bGluZTo1cHggYXV0bztvdXRsaW5lLWNvbG9yOiMwMDYxOWJ9LmFkZDpob3Zlcntjb2xvcjojMDA2MTlifS5hZGQtaWNvbntjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayk7bWFyZ2luLWlubGluZS1lbmQ6MC42MjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJSZWZMaXN0ID0gW107XG4gICAgICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZW1vdmVDdXN0b21QYXJhbWV0ZXIoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgaXRlbUluZGV4ID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICBjb25zdCB7IHVybCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdVcmwgPSByZW1vdmVQYXJhbWV0ZXIodXJsLCB0aGlzLmN1c3RvbVBhcmFtZXRlcnNbaXRlbUluZGV4XSk7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudXJsID0gbmV3VXJsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgY3VzdG9tUGFyYW1ldGVycyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSBjdXN0b21QYXJhbWV0ZXJzLmZpbHRlcigoXywgaW5kZXgpID0+IGluZGV4ICE9PSBpdGVtSW5kZXgpO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyA9IFsuLi50aGlzLmN1c3RvbVBhcmFtZXRlcnNdO1xuICAgICAgICBpZiAodGhpcy5jdXN0b21QYXJhbWV0ZXJzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm5ld0N1c3RvbVBhcmFtZXRlclJlZi5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJSZWZMaXN0W01hdGgubWF4KDAsIGl0ZW1JbmRleCAtIDEpXS5zZXRGb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUN1c3RvbVBhcmFtZXRlckhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgeyBjdXN0b21QYXJhbWV0ZXJzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIGN1c3RvbVBhcmFtZXRlciB9ID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSBjdXN0b21QYXJhbWV0ZXJzLm1hcCgoZW50cnksIGlkeCkgPT4ge1xuICAgICAgICAgICAgaWYgKGlkeCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBlbnRyeSA9IGN1c3RvbVBhcmFtZXRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbnRyeTtcbiAgICAgICAgfSk7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5jdXN0b21QYXJhbWV0ZXJzID0gWy4uLnRoaXMuY3VzdG9tUGFyYW1ldGVyc107XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uY3VzdG9tUGFyYW1ldGVycztcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0gY3VzdG9tUGFyYW1ldGVycztcbiAgICB9XG4gICAgY3JlYXRlTmV3Q3VzdG9tUGFyYW1ldGVyKCkge1xuICAgICAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0gWy4uLmN1c3RvbVBhcmFtZXRlcnMsIHsgcGFyYW1ldGVyOiBcIlwiLCB2YWx1ZTogXCJcIiwgYXBwZW5kOiBcImFsbFwiIH1dO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyA9IHRoaXMuY3VzdG9tUGFyYW1ldGVycztcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgaXRlbVR5cGUgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgaTE4bi5jdXN0b21QYXJhbWV0ZXJzKSwgaChcInBcIiwgeyBjbGFzczogXCJzdWItaGVhZGVyXCIgfSwgaTE4bi5kZXNjcmlwdGlvbiwgXCIgXCIsIGgoXCJhcmNnaXMtaW5mb3JtYXRpb25cIiwgeyBsYWJlbDogaTE4bi5jdXN0b21QYXJhbWV0ZXJzLCBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsIG9mZnNldFNraWRkaW5nOiA2LCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgaGVhZGluZ0xldmVsOiAzLCBwYWRkZWRDb250ZW50OiB0cnVlIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiaGVscC10ZXh0XCIgfSwgaTE4bi5oZWxwVGV4dCkpKSwgaChcImJ1dHRvblwiLCB7IGNsYXNzOiBcImFkZFwiLCB0eXBlOiBcInN1Ym1pdFwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmNyZWF0ZU5ld0N1c3RvbVBhcmFtZXRlcigpLCByZWY6IChlbGUpID0+ICh0aGlzLm5ld0N1c3RvbVBhcmFtZXRlclJlZiA9IGVsZSkgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGNsYXNzOiBcImFkZC1pY29uXCIsIGljb246IFwicGx1c1wiLCBzY2FsZTogXCJzXCIgfSksIGkxOG4ubmV3Q3VzdG9tUGFyYW1ldGVyKSwgKF9hID0gdGhpcy5jdXN0b21QYXJhbWV0ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDpcbiAgICAgICAgICAgIF9hLm1hcCgoY3VzdG9tUGFyYW1ldGVyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1jdXN0b20tcGFyYW1ldGVyXCIsIHsgY2xhc3M6IFwiY3VzdG9tLXBhcmFtZXRlclwiLCBpdGVtVHlwZTogaXRlbVR5cGUsIGN1c3RvbVBhcmFtZXRlcjogY3VzdG9tUGFyYW1ldGVyLCBpbmRleDogaW5kZXgsIGkxOG46IGkxOG4sIHJlZjogKGVsZSkgPT4gKHRoaXMuY3VzdG9tUGFyYW1ldGVyUmVmTGlzdFtpbmRleF0gPSBlbGUpIH0pKTtcbiAgICAgICAgICAgIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtQ3VzdG9tUGFyYW1ldGVycy5zdHlsZSA9IGFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJzQ3NzO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtSW5wdXRSZWFkb25seUNzcyA9IFwiOmhvc3R7LS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQ6NDAwfS5sYWJlbHttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDtmb250LXdlaWdodDp2YXIoLS1hcmNnaXMtbGFiZWwtZm9udC13ZWlnaHQpfS5sYWJlbC0tYm9sZHstLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodDo1MDB9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1JbnB1dFJlYWRvbmx5ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5zY2FsZSA9IFwibVwiO1xuICAgICAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBhdGggPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYWJlbFR5cGUgPSBcImJvbGRcIjtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmlucHV0UmVhZG9ubHk7XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbU1vZGU6IGl0ZW1UeXBlLCBmaWxlTmFtZSwgb3JpZ2luYWxGaWxlTmFtZSwgdXJsLCBwcm92aWRlciwgZGF0YWJhc2VQcm92aWRlciwgYWRkRGF0YVN0b3JlVHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCBzdHJpbmdzID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVByb3BlcnRpZXM7XG4gICAgICAgIHN3aXRjaCAoaXRlbVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmaWxlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbCA9IChfYSA9IHRoaXMubGFiZWwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRoaXMuaTE4bi5maWxlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aCA9IG9yaWdpbmFsRmlsZU5hbWUgIT09IG51bGwgJiYgb3JpZ2luYWxGaWxlTmFtZSAhPT0gdm9pZCAwID8gb3JpZ2luYWxGaWxlTmFtZSA6IGZpbGVOYW1lO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInVybFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwgPSB0aGlzLmkxOG4udXJsO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aCA9IHVybDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkYXRhU3RvcmVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsID0gdGhpcy5pMThuLmRhdGFTdG9yZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGggPVxuICAgICAgICAgICAgICAgICAgICBhZGREYXRhU3RvcmVUeXBlID09PSBcImNsb3VkXCIgPyBzdHJpbmdzW3Byb3ZpZGVyXSA6IChfYiA9IHN0cmluZ3NbZGF0YWJhc2VQcm92aWRlcl0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgbGFiZWxUeXBlLCBwYXRoLCBsYWJlbCwgc2NhbGUgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogKF9hID0gY29uZmlnU3RhdGUuc2NhbGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHNjYWxlIH0sIGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gIT09IFwib3ZlcndyaXRlXCIgJiYgKGgoXCJzcGFuXCIsIHsgY2xhc3M6IGBsYWJlbCBsYWJlbC0tJHtsYWJlbFR5cGV9YCB9LCBsYWJlbCkpLCBwYXRoICYmIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWZpZWxkXCIgfSwgcGF0aCkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1JbnB1dFJlYWRvbmx5LnN0eWxlID0gYXJjZ2lzTmV3SXRlbUlucHV0UmVhZG9ubHlDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1MYXllclNlYXJjaENzcyA9IFwiLnNjcmVlbi1yZWFkZXJ7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5zZWFyY2gtY29udGFpbmVye3dpZHRoOjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1MYXllclNlYXJjaCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuc2VhcmNoVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJzZWFyY2hVcGRhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFuZGxlU2VhcmNoSW5wdXQgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0LnZhbHVlIHx8IFwiXCI7XG4gICAgICAgICAgICBpZiAoaW5wdXQgIT09IHRoaXMuc2VhcmNoSW5wdXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaElucHV0ID0gaW5wdXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hVcGRhdGUuZW1pdChpbnB1dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlS2V5dXAgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmICgoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFc2NcIikgJiYgdGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlYXJjaElucHV0ID0gXCJcIjtcbiAgICAgICAgdGhpcy5jb250cm9scyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWFyY2hMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4ubGF5ZXJTZWFyY2g7XG4gICAgfVxuICAgIGFzeW5jIGZvY3VzTWFpbklucHV0KCkge1xuICAgICAgICB0aGlzLm1haW5JbnB1dFJlZi5zZXRGb2N1cygpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlYXJjaC1jb250YWluZXJcIiB9LCBoKFwibGFiZWxcIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVyXCIsIGh0bWxGb3I6IFwic2VhcmNoXCIgfSwgdGhpcy5pMThuLnNlYXJjaCksIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgcGxhY2Vob2xkZXI6IGAke3RoaXMuaTE4bi5zZWFyY2h9ICR7dGhpcy5zZWFyY2hMYWJlbH1gLCBpY29uOiBcInNlYXJjaFwiLCB0eXBlOiBcInNlYXJjaFwiLCBpZDogXCJzZWFyY2hcIiwgY2xlYXJhYmxlOiB0cnVlLCBcImFyaWEtY29udHJvbHNcIjogdGhpcy5jb250cm9scywgdmFsdWU6IHRoaXMuc2VhcmNoSW5wdXQsIG9uS2V5VXA6IHRoaXMuaGFuZGxlS2V5dXAsIHJlZjogKGVsKSA9PiAodGhpcy5tYWluSW5wdXRSZWYgPSBlbCksIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IHRoaXMuaGFuZGxlU2VhcmNoSW5wdXQgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1MYXllclNlYXJjaC5zdHlsZSA9IGFyY2dpc05ld0l0ZW1MYXllclNlYXJjaENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb25Dc3MgPSBcIi5mbGV4LWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59LmxlYWRlcnttYXJnaW4tdG9wOjJyZW19LnR3by11cHt3aWR0aDpjYWxjKDUwJSAtIDJyZW0pfWNhbGNpdGUtbGFiZWx7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5sYWJlbHttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tdG9wOjBweDtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NTAwO2xpbmUtaGVpZ2h0OjE4cHh9LmZpbGV7bWFyZ2luOjBweDttYXJnaW4tYm90dG9tOjJyZW07cGFkZGluZzowcHg7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX1cIjtcblxuY29uc3QgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5zdWJtZW51cyA9IHtcbiAgICAgICAgICAgIGRlc2t0b3A6IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJQbGF0Zm9ybVwiLFxuICAgICAgICAgICAgICAgIGZpbGU6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb2JpbGU6IHsgdGl0bGU6IFwiU0RLXCIgfSxcbiAgICAgICAgICAgIHdlYjogeyB0aXRsZTogXCJBUElcIiB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXJsID0gYWRkSXRlbVN0YXRlLnVybDtcbiAgICAgICAgdGhpcy51cmxJbnB1dE1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmlsZUlucHV0TWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYW5pZmVzdElucHV0TWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYW5pZmVzdFVybCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmkxOG5VUkwgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHZhbGlkYXRlRmlsZShmaWxlKSB7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfSA9IHNhbml0aXplRmlsZUlucHV0KGZpbGUpO1xuICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBcInppcFwiKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGVJbnB1dE1lc3NhZ2UgPSB0aGlzLmkxOG4uc2VsZWN0WmlwO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGUgPSBmaWxlO1xuICAgICAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICAgICAgICB0aGlzLmZpbGVJbnB1dE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgICAgICBjb25zdCB7IHVybCwgaTE4biwgaTE4blVSTCwgbWFuaWZlc3RVcmwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmlsZSwgYXBwbGljYXRpb25UeXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGxldCBtYW5pZmVzdDtcbiAgICAgICAgaWYgKHVybCAmJiBpc0h0dHAodXJsLCBjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwpKSB7XG4gICAgICAgICAgICB0aGlzLnVybElucHV0TWVzc2FnZSA9IGkxOG5VUkwuaHR0cFdhcm5pbmc7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFwcGxpY2F0aW9uVHlwZSA9PT0gXCJkZXNrdG9wXCIpIHtcbiAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0TWVzc2FnZSA9IGkxOG4uZmlsZVJlcXVpcmVkO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy52YWxpZGF0ZUZpbGUoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChhcHBsaWNhdGlvblR5cGUgPT09IFwibW9iaWxlXCIgfHwgYXBwbGljYXRpb25UeXBlID09PSBcIndlYlwiKSAmJiAhdXJsKSB7XG4gICAgICAgICAgICB0aGlzLnVybElucHV0TWVzc2FnZSA9IGkxOG4uZW50ZXJVcmw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFwcGxpY2F0aW9uVHlwZSA9PT0gXCJhcHBFeHRlbnNpb25cIiB8fCBhcHBsaWNhdGlvblR5cGUgPT09IFwiZXhwZXJpZW5jZUJ1aWxkZXJXaWRnZXRcIikge1xuICAgICAgICAgICAgaWYgKCFtYW5pZmVzdFVybCkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3RJbnB1dE1lc3NhZ2UgPSBpMThuLmVudGVyTWFuaWZlc3RVcmw7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBlcnJvciwgcmVzdWx0IH0gPSBhd2FpdCBmZXRjaEFwcGxpY2F0aW9uTWFuaWZlc3QodGhpcy5tYW5pZmVzdFVybCk7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0SW5wdXRNZXNzYWdlID0gdGhpcy5pMThuW2Vycm9yLmNvZGVdO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1hbmlmZXN0ID0gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIC8vIHNvbWUgYXBpcyBuZWVkIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlciBkaWZmZXJlbnRseSB0aGFuIHRoZXkgYXJlIHNob3duIGluIHRoZSBkcm9wZG93blxuICAgICAgICBjb25zdCB0eXBlcyA9IHtcbiAgICAgICAgICAgIHdlYjoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiV2ViIE1hcHBpbmcgQXBwbGljYXRpb25cIixcbiAgICAgICAgICAgICAgICB0eXBlS2V5d29yZHM6IFtcIldlYiBNYXBcIiwgXCJNYXBcIiwgXCJPbmxpbmUgTWFwXCIsIFwiTWFwcGluZyBTaXRlXCJdLFxuICAgICAgICAgICAgICAgIHRodW1ibmFpbFVybDogXCJodHRwczovL3N0YXRpYy5hcmNnaXMuY29tL2ltYWdlcy93ZWJhcHAucG5nXCIsXG4gICAgICAgICAgICAgICAgdXJsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVza3RvcDoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiRGVza3RvcCBBcHBsaWNhdGlvblwiLFxuICAgICAgICAgICAgICAgIHR5cGVLZXl3b3JkczogW1wiRGVza3RvcCBBcHBsaWNhdGlvblwiXSxcbiAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb2JpbGU6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIk1vYmlsZSBBcHBsaWNhdGlvblwiLFxuICAgICAgICAgICAgICAgIHR5cGVLZXl3b3JkczogW1wiQXJjR0lTIE1vYmlsZSBNYXBcIiwgXCJNb2JpbGUgQXBwbGljYXRpb25cIl0sXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsVXJsOiBcImh0dHBzOi8vc3RhdGljLmFyY2dpcy5jb20vaW1hZ2VzL21vYmlsZWFwcC5wbmdcIixcbiAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcHBFeHRlbnNpb246IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkFwcEJ1aWxkZXIgRXh0ZW5zaW9uXCIsXG4gICAgICAgICAgICAgICAgdHlwZUtleXdvcmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiV2lkZ2V0XCIsXG4gICAgICAgICAgICAgICAgICAgIFwiQXBwIEJ1aWxkZXJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ3aWRnZXRcIixcbiAgICAgICAgICAgICAgICAgICAgKG1hbmlmZXN0ID09PSBudWxsIHx8IG1hbmlmZXN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYW5pZmVzdC5wbGF0Zm9ybSkgPT09IFwiSFRNTDNEXCIgPyBcIkhUTUwzRFwiIDogXCJIVE1MXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHVybDogbWFuaWZlc3RVcmwsXG4gICAgICAgICAgICAgICAgYWNjZXNzSW5mb3JtYXRpb246IChtYW5pZmVzdCA9PT0gbnVsbCB8fCBtYW5pZmVzdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFuaWZlc3QuYXV0aG9yKSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgIHRleHQ6IG1hbmlmZXN0ID8gSlNPTi5zdHJpbmdpZnkobWFuaWZlc3QpIDogXCJcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cGVyaWVuY2VCdWlsZGVyV2lkZ2V0OiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJFeHBlcmllbmNlIEJ1aWxkZXIgV2lkZ2V0XCIsXG4gICAgICAgICAgICAgICAgdXJsOiBtYW5pZmVzdFVybCxcbiAgICAgICAgICAgICAgICBhY2Nlc3NJbmZvcm1hdGlvbjogKG1hbmlmZXN0ID09PSBudWxsIHx8IG1hbmlmZXN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYW5pZmVzdC5hdXRob3IpIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogbWFuaWZlc3QgPyBKU09OLnN0cmluZ2lmeShtYW5pZmVzdCkgOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3RoZXJBcHBsaWNhdGlvbjoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiQXBwbGljYXRpb25cIixcbiAgICAgICAgICAgICAgICB0eXBlS2V5d29yZHM6IFtcIkFwcGxpY2F0aW9uXCJdXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGxldCB0aXRsZSA9IFwiXCI7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgIHRpdGxlID0gdXJsVG9UaXRsZSh1cmwpIHx8IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZmlsZSkge1xuICAgICAgICAgICAgdGl0bGUgPSBzYW5pdGl6ZUZpbGVJbnB1dChmaWxlKS50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtYW5pZmVzdCkge1xuICAgICAgICAgICAgdGl0bGUgPSBtYW5pZmVzdC5uYW1lIHx8IFwiYXBwbGljYXRpb24gZXh0ZW5zaW9uXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdHlwZURldGFpbHMgPSB0eXBlc1thcHBsaWNhdGlvblR5cGVdO1xuICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImFwcGxpY2F0aW9uXCI7XG4gICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLm5hbWUgPSBgJHt0aXRsZX1fJHtndWlkKCl9YDtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlRGV0YWlscy50eXBlO1xuICAgICAgICBhZGRJdGVtU3RhdGUudHlwZUtleXdvcmRzID0gdHlwZURldGFpbHMudHlwZUtleXdvcmRzO1xuICAgICAgICBhZGRJdGVtU3RhdGUudXJsID0gdHlwZURldGFpbHMudXJsO1xuICAgICAgICBhZGRJdGVtU3RhdGUuYWNjZXNzSW5mb3JtYXRpb24gPSB0eXBlRGV0YWlscy5hY2Nlc3NJbmZvcm1hdGlvbjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnRleHQgPSB0eXBlRGV0YWlscy50ZXh0O1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgYXBwbGljYXRpb24sIHVybCB9ID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgICAgIHRoaXMuaTE4biA9IGFwcGxpY2F0aW9uO1xuICAgICAgICB0aGlzLmkxOG5VUkwgPSB1cmw7XG4gICAgICAgIGNvbnN0IHsgZmlsZSwgYXBwbGljYXRpb25UeXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuYXBwbGljYXRpb25UeXBlID0gXCJkZXNrdG9wXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWFwcGxpY2F0aW9uVHlwZSkge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFwcGxpY2F0aW9uVHlwZSA9IFwid2ViXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgYXBwbGljYXRpb25UeXBlLCBhcHBsaWNhdGlvbkZpbGUsIGZpbGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgbWVudSA9IHRoaXMuc3VibWVudXNbYXBwbGljYXRpb25UeXBlXTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICFhcHBsaWNhdGlvbkZpbGUgJiYgYXBwbGljYXRpb25UeXBlID09PSBcImRlc2t0b3BcIiAmJiBmaWxlICYmIChoKFwiZGl2XCIsIG51bGwsIGgoXCJoNFwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgaTE4bi5GaWxlKSwgaChcInBcIiwgeyBjbGFzczogXCJmaWxlXCIgfSwgZmlsZS5uYW1lKSkpLCBoKFwiZm9ybVwiLCB7IG5vdmFsaWRhdGU6IHRydWUsIG9uU3VibWl0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaChcInNwYW5cIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIGkxOG4uYXBwbGljYXRpb25UeXBlKSksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIgfSwgW1xuICAgICAgICAgICAgXCJ3ZWJcIixcbiAgICAgICAgICAgIFwiZGVza3RvcFwiLFxuICAgICAgICAgICAgXCJtb2JpbGVcIixcbiAgICAgICAgICAgIC4uLihjb25maWdTdGF0ZS5wb3J0YWwuaXNQb3J0YWwgJiYgaXNPcmdBZG1pbihjb25maWdTdGF0ZS51c2VyKVxuICAgICAgICAgICAgICAgID8gW1wiYXBwRXh0ZW5zaW9uXCIsIFwiZXhwZXJpZW5jZUJ1aWxkZXJXaWRnZXRcIl1cbiAgICAgICAgICAgICAgICA6IFtdKSxcbiAgICAgICAgICAgIFwib3RoZXJBcHBsaWNhdGlvblwiXG4gICAgICAgIF0ubWFwKCh2YWx1ZSkgPT4gKGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0XCIsIHsgY2hlY2tlZDogYXBwbGljYXRpb25UeXBlID09PSB2YWx1ZSwgd2lkdGg6IFwiZnVsbFwiLCBcImlucHV0LWVuYWJsZWRcIjogdHJ1ZSwgXCJpbnB1dC1hbGlnbm1lbnRcIjogXCJzdGFydFwiLCB2YWx1ZTogdmFsdWUsIG5hbWU6IGkxOG5bdmFsdWVdLCBoZWFkaW5nOiBpMThuW3ZhbHVlXSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuYXBwbGljYXRpb25UeXBlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy51cmxJbnB1dE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICB9IH0pKSkpLCBtZW51ICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibGVhZGVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaChcInNwYW5cIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIGkxOG4uVVJMKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcInRleHRcIiwgdmFsdWU6IHRoaXMudXJsLCByZXF1aXJlZDogYXBwbGljYXRpb25UeXBlID09PSBcIndlYlwiIHx8IGFwcGxpY2F0aW9uVHlwZSA9PT0gXCJtb2JpbGVcIiwgc3RhdHVzOiB0aGlzLnVybElucHV0TWVzc2FnZSA/IFwiaW52YWxpZFwiIDogXCJpZGxlXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cmwgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVybElucHV0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICB9LCBvbkZvY3Vzb3V0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgJiYgKChfYSA9IHRoaXMudXJsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihcImh0dHBcIikpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBzcGVjaWZ5IGUudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXJsID0gYGh0dHBzOi8vJHt0aGlzLnVybH1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSksIGgoXCJjYWxjaXRlLWlucHV0LW1lc3NhZ2VcIiwgeyBpY29uOiB0cnVlLCBoaWRkZW46ICF0aGlzLnVybElucHV0TWVzc2FnZSwgc3RhdHVzOiBcImludmFsaWRcIiB9LCB0aGlzLnVybElucHV0TWVzc2FnZSkpLCBtZW51LmZpbGUgJiYgKGFwcGxpY2F0aW9uRmlsZSB8fCAhZmlsZSkgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJsZWFkZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsXCIgfSwgaTE4bi5GaWxlKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcImZpbGVcIiwgcmVxdWlyZWQ6IHRydWUsIHN0YXR1czogdGhpcy5maWxlSW5wdXRNZXNzYWdlID8gXCJpbnZhbGlkXCIgOiBcImlkbGVcIiwgb25DYWxjaXRlSW5wdXRJbnB1dDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikuZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFwcGxpY2F0aW9uRmlsZSA9IGZpbGU7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgaWNvbjogdHJ1ZSwgaGlkZGVuOiAhdGhpcy5maWxlSW5wdXRNZXNzYWdlLCBzdGF0dXM6IFwiaW52YWxpZFwiIH0sIHRoaXMuZmlsZUlucHV0TWVzc2FnZSkpKSkpKSwgW1wiYXBwRXh0ZW5zaW9uXCIsIFwiZXhwZXJpZW5jZUJ1aWxkZXJXaWRnZXRcIl0uaW5jbHVkZXMoYXBwbGljYXRpb25UeXBlKSAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImxlYWRlclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCBpMThuLm1hbmlmZXN0VXJsKSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcInRleHRcIiwgcmVxdWlyZWQ6IHRydWUsIHN0YXR1czogdGhpcy5tYW5pZmVzdElucHV0TWVzc2FnZSA/IFwiaW52YWxpZFwiIDogXCJpZGxlXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdFVybCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3RJbnB1dE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgfSB9KSwgaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGljb246IHRydWUsIGhpZGRlbjogIXRoaXMubWFuaWZlc3RJbnB1dE1lc3NhZ2UsIHN0YXR1czogXCJpbnZhbGlkXCIgfSwgdGhpcy5tYW5pZmVzdElucHV0TWVzc2FnZSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0FwcGxpY2F0aW9uLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb25Dc3M7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0F1dGggPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZFwiLCA3KTtcbiAgICAgICAgdGhpcy5oYW5kbGVQYXNzd29yZENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVWYWxpZGF0aW9uUmVzcG9uc2UodHJ1ZSk7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUucGFzc3dvcmQgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlVXNlcm5hbWVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmFsaWRhdGlvblJlc3BvbnNlKHRydWUpO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnVzZXJuYW1lID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnZhbGlkYXRpb25SZXNwb25zZSA9IHsgdmFsaWQ6IHRydWUgfTtcbiAgICB9XG4gICAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgICAgICBpZiAoIWFkZEl0ZW1TdGF0ZS51c2VybmFtZSB8fCAhYWRkSXRlbVN0YXRlLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRpb25SZXNwb25zZSA9IHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiB0aGlzLmkxOG4ucmVxdWlyZXNDcmVkZW50aWFscyB9O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFRPRE86IEdldCBzdG9yZSB1cGRhdGVzIHNvbWUgb3RoZXIgd2F5LCBvciBhZGQgYSBzZXBhcmF0ZSByZXR1cm4gb2JqZWN0IHRvIHRoZSBiaWcgYWRkIHVybCB0dW5uZWxcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRkU2VjdXJlQUdTVXJsKE9iamVjdC5hc3NpZ24oe30sIGFkZEl0ZW1TdGF0ZSkpO1xuICAgICAgICAgICAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24sIHNuaXBwZXQsIHRhZ3MsIHNlcnZpY2VVc2VybmFtZSwgc2VydmljZVBhc3N3b3JkLCBzZXJ2aWNlSW5mbywgc3BhdGlhbFJlZmVyZW5jZSwgZXh0ZW50LCB0aHVtYm5haWxUb2tlbiB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gdGl0bGUgfHwgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZTtcbiAgICAgICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyA9IHRhZ3M7XG4gICAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQgPSBzbmlwcGV0O1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlVXNlcm5hbWUgPSBzZXJ2aWNlVXNlcm5hbWU7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VydmljZVBhc3N3b3JkID0gc2VydmljZVBhc3N3b3JkO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNwYXRpYWxSZWZlcmVuY2UgPSBzcGF0aWFsUmVmZXJlbmNlO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRodW1ibmFpbFRva2VuID0gdGh1bWJuYWlsVG9rZW47XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW50ID0gZXh0ZW50O1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChpc0h5YnJpZEltYWdlU2VydmljZShhZGRJdGVtU3RhdGUudXJsLCBzZXJ2aWNlSW5mbykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJoeWJyaWRJbWFnZVNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJpdGVtUHJvcGVydGllc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0aW9uUmVzcG9uc2UgPSB7IHZhbGlkOiBmYWxzZSwgbWVzc2FnZTogdGhpcy5pMThuLmludmFsaWQgfTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlTG9hZENoYW5nZShfb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQobmV3VmFsdWUpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uYXV0aDtcbiAgICAgICAgdGhpcy51cmxUeXBlaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLnVybFR5cGU7XG4gICAgICAgIC8vIENsZWFuIHVwIG9sZCBzZXJ2aWNlSW5mbyBpZiByZXR1cm5pbmcgZnJvbSBpdGVtIHByb3BlcnRpZXNcbiAgICAgICAgYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvID0gbnVsbDtcbiAgICB9XG4gICAgdXBkYXRlVmFsaWRhdGlvblJlc3BvbnNlKHZhbGlkKSB7XG4gICAgICAgIGlmICghdGhpcy52YWxpZGF0aW9uUmVzcG9uc2UudmFsaWQpIHtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGlvblJlc3BvbnNlID0geyB2YWxpZCB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCB1cmxUeXBlaTE4biwgdmFsaWRhdGlvblJlc3BvbnNlLCBpc0xvYWRpbmcgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdmFsaWQsIG1lc3NhZ2UgfSA9IHZhbGlkYXRpb25SZXNwb25zZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogXCJpbmRldGVybWluYXRlXCIsIHZhbHVlOiBhZGRJdGVtU3RhdGUudXBsb2FkUHJvZ3Jlc3MsIGFjdGl2ZTogaXNMb2FkaW5nLCB0ZXh0OiB1cmxUeXBlaTE4bi5nZXRTZXJ2aWNlSW5mbyB9KSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBmb3I6IFwidXNlcm5hbWVcIiB9LCBpMThuLmVudGVyVXNlcm5hbWUsIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgb25DYWxjaXRlSW5wdXRJbnB1dDogdGhpcy5oYW5kbGVVc2VybmFtZUNoYW5nZSwgaWQ6IFwidXNlcm5hbWVcIiwgcGxhY2Vob2xkZXI6IGkxOG4uZW50ZXJVc2VybmFtZSwgdmFsdWU6IGFkZEl0ZW1TdGF0ZS51c2VybmFtZSwgc3RhdHVzOiB2YWxpZCA/IFwiaWRsZVwiIDogXCJpbnZhbGlkXCIgfSkpLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGZvcjogXCJwYXNzd29yZFwiIH0sIGkxOG4uZW50ZXJQYXNzd29yZCwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcInBhc3N3b3JkXCIsIG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IHRoaXMuaGFuZGxlUGFzc3dvcmRDaGFuZ2UsIGlkOiBcInBhc3N3b3JkXCIsIHBsYWNlaG9sZGVyOiBpMThuLmVudGVyUGFzc3dvcmQsIHZhbHVlOiBhZGRJdGVtU3RhdGUucGFzc3dvcmQsIHN0YXR1czogdmFsaWQgPyBcImlkbGVcIiA6IFwiaW52YWxpZFwiLCByZXF1aXJlZDogdHJ1ZSB9KSwgaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGljb246ICF2YWxpZCwgaGlkZGVuOiB2YWxpZCwgc3RhdHVzOiB2YWxpZCA/IFwiaWRsZVwiIDogXCJpbnZhbGlkXCIgfSwgbWVzc2FnZSkpKSk7XG4gICAgfVxuICAgIGdldCBlbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiaXNMb2FkaW5nXCI6IFtcImhhbmRsZUxvYWRDaGFuZ2VcIl1cbiAgICB9OyB9XG59O1xuXG52YXIgVHJlZVNlbGVjdGlvbk1vZGU7XG4oZnVuY3Rpb24gKFRyZWVTZWxlY3Rpb25Nb2RlKSB7XG4gICAgVHJlZVNlbGVjdGlvbk1vZGVbXCJTaW5nbGVcIl0gPSBcInNpbmdsZVwiO1xuICAgIFRyZWVTZWxlY3Rpb25Nb2RlW1wiTXVsdGlcIl0gPSBcIm11bHRpXCI7XG4gICAgVHJlZVNlbGVjdGlvbk1vZGVbXCJDaGlsZHJlblwiXSA9IFwiY2hpbGRyZW5cIjtcbiAgICBUcmVlU2VsZWN0aW9uTW9kZVtcIk11bHRpQ2hpbGRyZW5cIl0gPSBcIm11bHRpLWNoaWxkcmVuXCI7XG4gICAgVHJlZVNlbGVjdGlvbk1vZGVbXCJBbmNlc3RvcnNcIl0gPSBcImFuY2VzdG9yc1wiO1xufSkoVHJlZVNlbGVjdGlvbk1vZGUgfHwgKFRyZWVTZWxlY3Rpb25Nb2RlID0ge30pKTtcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzQnVsa0xheWVyU2VsZWN0Q3NzID0gXCIub3V0ZXItY29udGFpbmVye2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59LmxheWVyLXNlbGVjdC10cmVle3dpZHRoOjEwMCU7b3ZlcmZsb3cteTphdXRvfS5sYXllci1ub3RpY2V7bWFyZ2luLWJvdHRvbToxLjVyZW19LnNlbGVjdC1pdGVtLW1lc3NhZ2V7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDttYXJnaW4tYm90dG9tOjAuMjVyZW19LmxheWVyLW5vdC1mb3VuZC1tZXNzYWdle2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpO3RleHQtYWxpZ246Y2VudGVyO3dpZHRoOjEwMCU7bWFyZ2luLXRvcDoxLjVyZW19LnNlbGVjdC1hbGx7bWFyZ2luLXRvcDo1cHg7bWFyZ2luLWxlZnQ6NXB4fVwiO1xuXG5jb25zdCBTT0ZUX0NBUCA9IDEwMDA7XG5jb25zdCBNQVhfTEFZRVJfTElNSVQgPSAxMDAwMDtcbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0J1bGtMYXllclNlbGVjdCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIC8qKiBLZWVwIGEgcmVmZXJlbmNlIHRvIGFsbCB0aGUgdHJlZS1pdGVtcyBjdXJyZW50bHkgaW4gdmlldywgYnkgaWQgKi9cbiAgICAgICAgdGhpcy5pblZpZXcgPSB7fTtcbiAgICAgICAgdGhpcy5zZWFyY2hVcGRhdGVIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBpbnB1dDtcbiAgICAgICAgICAgIGNvbnN0IGxvd2VyQ2FzZUlucHV0ID0gaW5wdXQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZpbHRlcmVkTGF5ZXJzKGxheWVycykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBsYXllcnMuZm9yRWFjaCgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLnRpdGxlXG4gICAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZml4IHRoZSByb290IGNhdXNlIG9mIHRoaXMgd2VpcmQgY2hhcmFjdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xcdTIwMkZcXHUwMEEwXS9nLCBcIiBcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5pbmNsdWRlcyhsb3dlckNhc2VJbnB1dCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICFpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKE9iamVjdC5hc3NpZ24oe30sIGxheWVyKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJMYXllcnMgPSBnZXRGaWx0ZXJlZExheWVycyhsYXllci5zdWJMYXllcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YkxheWVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goT2JqZWN0LmFzc2lnbih7fSwgbGF5ZXIsIHsgc3ViTGF5ZXJzLCBleHBhbmRlZDogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSB0aGlzLmdldERpc3BsYXlMYXllcnMoZ2V0RmlsdGVyZWRMYXllcnModGhpcy5sYXllcnMpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVMYXllclNlbGVjdCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGNvbnN0IGluVmlld1NlbGVjdGVkTGlzdCA9IG5vZGUuc2VsZWN0ZWRJdGVtcy5tYXAoKHRyZWVJdGVtKSA9PiB0cmVlSXRlbS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSk7XG4gICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IGFueSBpdGVtIHRoYXQncyBpbiB2aWV3LCB0aGVuIHNwcmVhZCB0aGUgY3VycmVudCBzZWxlY3RlZCB0cmVlIGJhY2sgaW5cbiAgICAgICAgICAgIGNvbnN0IG91dE9mVmlld1NlbGVjdGVkTGlzdCA9IE9iamVjdC5rZXlzKHRoaXMuc2VsZWN0ZWRMYXllcklkVHJhY2tlci5pZE1hcCkuZmlsdGVyKChsYXllcklkKSA9PiAhdGhpcy5pblZpZXdbbGF5ZXJJZF0pO1xuICAgICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRMYXllckNvdW50ID0gaW5WaWV3U2VsZWN0ZWRMaXN0Lmxlbmd0aCArIG91dE9mVmlld1NlbGVjdGVkTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBuZXdTZWxlY3RlZElkTWFwID0ge307XG4gICAgICAgICAgICBpblZpZXdTZWxlY3RlZExpc3QuZm9yRWFjaCgobGF5ZXJJZCkgPT4gKG5ld1NlbGVjdGVkSWRNYXBbbGF5ZXJJZF0gPSB0cnVlKSk7XG4gICAgICAgICAgICBvdXRPZlZpZXdTZWxlY3RlZExpc3QuZm9yRWFjaCgobGF5ZXJJZCkgPT4gKG5ld1NlbGVjdGVkSWRNYXBbbGF5ZXJJZF0gPSB0cnVlKSk7XG4gICAgICAgICAgICBjb25zdCBuZXdUcmFja2VyID0ge1xuICAgICAgICAgICAgICAgIGNvdW50OiBuZXdTZWxlY3RlZExheWVyQ291bnQsXG4gICAgICAgICAgICAgICAgaWRNYXA6IG5ld1NlbGVjdGVkSWRNYXBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9IG5ld1RyYWNrZXI7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSBuZXdUcmFja2VyO1xuICAgICAgICAgICAgdGhpcy5ub0xheWVyc1NlbGVjdGVkID0gdGhpcy5ub0xheWVyc1NlbGVjdGVkID8gbmV3U2VsZWN0ZWRMYXllckNvdW50IDw9IDAgOiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXREaXNwbGF5TGF5ZXJzID0gKGxheWVycyA9IHRoaXMubGF5ZXJzLCBkaXNwbGF5TGF5ZXJzID0gW10pID0+IHtcbiAgICAgICAgICAgIGxldCBhY2MgPSAwO1xuICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiBsYXllcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWNjID49IFNPRlRfQ0FQKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlUHJvID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmlzTGF5ZXJTZWxlY3RlZChsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZCB8fCB0aGlzLmNvbnRhaW5zU2VsZWN0ZWQobGF5ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhY2MrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLnN1YkxheWVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJMYXllckNvdW50ID0gdGhpcy5jb3VudFN1YmxheWVycyhsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViTGF5ZXJDb3VudCA+PSBNQVhfTEFZRVJfTElNSVQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG91bGQgbm90IGRpc3BsYXkgYW55IHN1YmxheWVycyBpZiB0aGVyZSBhcmUgYSB0b3RhbCBvZiA+IDEwLDAwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlMYXllcnMucHVzaChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGxheWVyKSwgeyBzdWJMYXllcnM6IFtdIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYyArPSBzdWJMYXllckNvdW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlMYXllcnMucHVzaChsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlzcGxheUxheWVycy5zb3J0KChsYXllcjEsIGxheWVyMikgPT4gKGxheWVyMS50aXRsZSA+IGxheWVyMi50aXRsZSA/IDEgOiAtMSkpO1xuICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXlMYXllcnM7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY291bnRTdWJsYXllcnMgPSAobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIC8vIEV4aXQgaWYgbm8gc3VibGF5ZXJzIGZvdW5kXG4gICAgICAgICAgICBpZiAobGF5ZXIuc3ViTGF5ZXJzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UsIGFjY3VtdWxhdGUgdGhlIHN1YmxheWVycywgdGhlbiBjb3VudCBpdHMgc3VibGF5ZXJzXG4gICAgICAgICAgICBsZXQgbnVtU3ViTGF5ZXIgPSBsYXllci5zdWJMYXllcnMubGVuZ3RoO1xuICAgICAgICAgICAgbGF5ZXIuc3ViTGF5ZXJzLmZvckVhY2goKHN1YmxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgbnVtU3ViTGF5ZXIgKz0gdGhpcy5jb3VudFN1YmxheWVycyhzdWJsYXllcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBudW1TdWJMYXllcjtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW5kZXJUcmVlID0gKGxheWVyKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGxheWVyLmlkO1xuICAgICAgICAgICAgY29uc3QgZXhwYW5kZWQgPSBsYXllci5leHBhbmRlZCB8fCBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5pc0xheWVyU2VsZWN0ZWQobGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgY29udGFpbnNTZWxlY3RlZCA9IHRoaXMuY29udGFpbnNTZWxlY3RlZChsYXllcik7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IGtleTogaWQsIGlkOiBpZCwgc2VsZWN0ZWQ6IHNlbGVjdGVkIHx8IGxheWVyLnZpc2libGUsIGV4cGFuZGVkOiAoY29udGFpbnNTZWxlY3RlZCAmJiAhc2VsZWN0ZWQpIHx8IGV4cGFuZGVkLCByZWY6ICgpID0+ICh0aGlzLmluVmlld1tpZF0gPSB0cnVlKSB9LCBoKFwic3BhblwiLCBudWxsLCBsYXllci50aXRsZSksICgoX2EgPSBsYXllci5zdWJMYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID8gKGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBUcmVlU2VsZWN0aW9uTW9kZS5BbmNlc3RvcnMsIHNsb3Q6IFwiY2hpbGRyZW5cIiB9LCBsYXllci5zdWJMYXllcnMubWFwKHRoaXMucmVuZGVyVHJlZSkpKSA6IG51bGwpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tYW5hZ2VkRm9jdXMgPSB0cnVlO1xuICAgICAgICB0aGlzLmxheWVycyA9IFtdO1xuICAgICAgICB0aGlzLmZpbHRlcmVkTGF5ZXJzID0gW107XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBcIlwiO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSB7XG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gc2VsZWN0ZWRMYXllck1hcCBpbnRvIGFycmF5IHRvIGdldCB0aGUgbGVuZ3RoIHdvdWxkIGtpbGwgb2ZmIHBlcmZvcm1hbmNlXG4gICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgIGlkTWFwOiB7fVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVzZVBybyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ub0xheWVyc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWxsTGF5ZXJzU2VsZWN0ZWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBpMThuID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgICAgIHRoaXMuaTE4biA9IGkxOG4uYnVsa0xheWVyU2VsZWN0O1xuICAgICAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXAgPyBcInVzZUFzQmFzZU1hcFwiIDogXCJhZGRUb01hcFwiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGF5ZXJzLCBzZWxlY3RlZExheWVySWRUcmFja2VyIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHRoaXMubGF5ZXJzID0gISFsYXllcnMgJiYgKChfYSA9IGxheWVyc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkKSA/IGxheWVycyA6IHRoaXMuYWRkSWRzKGxheWVycyk7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRMYXllcnMgPSB0aGlzLmdldERpc3BsYXlMYXllcnMoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExheWVySWRUcmFja2VyID0ge1xuICAgICAgICAgICAgY291bnQ6IChfYiA9IHNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPT09IG51bGwgfHwgc2VsZWN0ZWRMYXllcklkVHJhY2tlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRMYXllcklkVHJhY2tlci5jb3VudCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCxcbiAgICAgICAgICAgIGlkTWFwOiBzZWxlY3RlZExheWVySWRUcmFja2VyID8gT2JqZWN0LmFzc2lnbih7fSwgc2VsZWN0ZWRMYXllcklkVHJhY2tlci5pZE1hcCkgOiB7fVxuICAgICAgICB9O1xuICAgIH1cbiAgICBvblRyYW5zaXRpb25Db21wbGV0ZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmxheWVyU2VhcmNoUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXNNYWluSW5wdXQoKTtcbiAgICB9XG4gICAgaGFuZGxlTmV4dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRMYXllcklkVHJhY2tlci5jb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5ub0xheWVyc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFNldCBvbmx5IHRoZSBzZWxlY3RlZCBsYXllcnMgYXMgZmluYWwgb3V0cHV0XG4gICAgICAgICAgICBjb25zdCBsYXllcnMgPSB0aGlzLnNldFZpc2liaWxpdHkodGhpcy5sYXllcnMpXG4gICAgICAgICAgICAgICAgLmZpbHRlcigobGF5ZXIpID0+IGxheWVyLnZpc2libGUpXG4gICAgICAgICAgICAgICAgLm1hcCgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUsIHRpdGxlLCBxdWVyeWFibGUsIHN1YkxheWVycyB9ID0gbGF5ZXI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgbmFtZSwgdGl0bGUsIHF1ZXJ5YWJsZSwgc3ViTGF5ZXJzIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5sYXllcnMgPSBsYXllcnM7XG4gICAgICAgICAgICAvLyBEb25lIGlmIGRpcmVjdCBhZGRcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogZW5jb2RlVVJJKGFkZEl0ZW1TdGF0ZS51cmwpLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXJzLFxuICAgICAgICAgICAgICAgICAgICBhZGRBc0Jhc2VtYXA6IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcIml0ZW1Qcm9wZXJ0aWVzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSB7XG4gICAgICAgIHJldHVybiB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgfVxuICAgIGlzTGF5ZXJTZWxlY3RlZChsYXllcikge1xuICAgICAgICByZXR1cm4gISF0aGlzLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIuaWRNYXBbbGF5ZXIuaWRdO1xuICAgIH1cbiAgICAvKiogcmVtb3ZlIElEIGFuZCBzZXQgdmlzaWJpbGl0eSBwcmlvciB0byBjb21taXRpbmcgdG8gc3RvcmUgKi9cbiAgICBzZXRWaXNpYmlsaXR5KGxheWVycykge1xuICAgICAgICByZXR1cm4gbGF5ZXJzLm1hcCgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIGxheWVyLnZpc2libGUgPSB0aGlzLmlzTGF5ZXJTZWxlY3RlZChsYXllcik7XG4gICAgICAgICAgICBpZiAobGF5ZXIuc3ViTGF5ZXJzKSB7XG4gICAgICAgICAgICAgICAgbGF5ZXIuc3ViTGF5ZXJzID0gdGhpcy5zZXRWaXNpYmlsaXR5KGxheWVyLnN1YkxheWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbGF5ZXI7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQWRkIHVuaXF1ZSBpZHMgdG8gZWFjaCBsYXllciBpZiBub3QgcHJldmlvdXNseSBzZXQgKi9cbiAgICBhZGRJZHMobGF5ZXJzKSB7XG4gICAgICAgIHJldHVybiBsYXllcnMubWFwKChsYXllcikgPT4ge1xuICAgICAgICAgICAgaWYgKGxheWVyLnN1YkxheWVycykge1xuICAgICAgICAgICAgICAgIGxheWVyLnN1YkxheWVycyA9IHRoaXMuYWRkSWRzKGxheWVyLnN1YkxheWVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXllci5pZCA9IGd1aWQoKTtcbiAgICAgICAgICAgIC8vIFNldCB2aXNpYmxlIHRvIGZhbHNlIGJ5IGRlZmF1bHRcbiAgICAgICAgICAgIGxheWVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiBsYXllcjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnRhaW5zU2VsZWN0ZWQobGF5ZXIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gbGF5ZXIuc3ViTGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc29tZSgoc3ViTGF5ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5pc0xheWVyU2VsZWN0ZWQobGF5ZXIpO1xuICAgICAgICAgICAgaWYgKHN1YkxheWVyLnN1YkxheWVycykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5zRGVlcFNlbGVjdGVkID0gdGhpcy5jb250YWluc1NlbGVjdGVkKHN1YkxheWVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQgfHwgY29udGFpbnNEZWVwU2VsZWN0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVTZWxlY3RBbGwoKSB7XG4gICAgICAgIGNvbnN0IG5ld1NlbGVjdGVkTGF5ZXJJZE1hcCA9IHt9O1xuICAgICAgICBsZXQgbmV3U2VsZWN0ZWRMYXllckNvdW50ID0gMDtcbiAgICAgICAgY29uc3Qgc2VsZWN0QWxsID0gKGxheWVycykgPT4ge1xuICAgICAgICAgICAgbGF5ZXJzLmZvckVhY2goKGxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFuZXdTZWxlY3RlZExheWVySWRNYXBbbGF5ZXIuaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkTGF5ZXJDb3VudCArPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZExheWVySWRNYXBbbGF5ZXIuaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAobGF5ZXIuc3ViTGF5ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEFsbChsYXllci5zdWJMYXllcnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoIXRoaXMuYWxsTGF5ZXJzU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHNlbGVjdEFsbCh0aGlzLmxheWVycyk7XG4gICAgICAgICAgICB0aGlzLmFsbExheWVyc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdUcmFja2VyID0ge1xuICAgICAgICAgICAgY291bnQ6IG5ld1NlbGVjdGVkTGF5ZXJDb3VudCxcbiAgICAgICAgICAgIGlkTWFwOiBuZXdTZWxlY3RlZExheWVySWRNYXBcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExheWVySWRUcmFja2VyID0gbmV3VHJhY2tlcjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkTGF5ZXJJZFRyYWNrZXIgPSBuZXdUcmFja2VyO1xuICAgIH1cbiAgICBjaGVja1NlbGVjdGlvblN0YXR1cyhsYXllcnMpIHtcbiAgICAgICAgcmV0dXJuIGxheWVycy5ldmVyeSgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5pc0xheWVyU2VsZWN0ZWQobGF5ZXIpO1xuICAgICAgICAgICAgaWYgKGxheWVyLnN1YkxheWVycykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5zU2VsZWN0ZWQgPSB0aGlzLmNoZWNrU2VsZWN0aW9uU3RhdHVzKGxheWVyLnN1YkxheWVycyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkICYmIGNvbnRhaW5zU2VsZWN0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuaW5WaWV3ID0ge307XG4gICAgICAgIGNvbnN0IHsgaTE4biwgdXNlUHJvLCBzZWFyY2hVcGRhdGVIYW5kbGVyLCBoYW5kbGVMYXllclNlbGVjdCwgcmVuZGVyVHJlZSwgaGFuZGxlU2VsZWN0QWxsLCBmaWx0ZXJlZExheWVycywgbm9MYXllcnNTZWxlY3RlZCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5hbGxMYXllcnNTZWxlY3RlZCA9IHRoaXMuY2hlY2tTZWxlY3Rpb25TdGF0dXModGhpcy5maWx0ZXJlZExheWVycyk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIm91dGVyLWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGNsYXNzOiBcImxheWVyLW5vdGljZVwiLCBpY29uOiBcImluZm9ybWF0aW9uXCIsIG9wZW46IHVzZVBybywgd2lkdGg6IFwiZnVsbFwiIH0sIGgoXCJwXCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgaTE4bi51c2VQcm8pKSwgaChcInN0cm9uZ1wiLCB7IGNsYXNzOiBcInNlbGVjdC1pdGVtLW1lc3NhZ2VcIiB9LCBpMThuLnNlbGVjdExheWVycyksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbGF5ZXItc2VhcmNoXCIsIHsgb25TZWFyY2hVcGRhdGU6IHNlYXJjaFVwZGF0ZUhhbmRsZXIsIGNvbnRyb2xzOiBcImxheWVyLXNlbGVjdC10cmVlXCIsIHNlYXJjaExhYmVsOiBpMThuLmxheWVycywgcmVmOiAoZWxlKSA9PiAodGhpcy5sYXllclNlYXJjaFJlZiA9IGVsZSkgfSksIGZpbHRlcmVkTGF5ZXJzLmxlbmd0aCA9PT0gMCA/IChoKFwic3Ryb25nXCIsIHsgY2xhc3M6IFwibGF5ZXItbm90LWZvdW5kLW1lc3NhZ2VcIiB9LCBpMThuLm5vTGF5ZXJzRm91bmQpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibGF5ZXItc2VsZWN0LXRyZWVcIiB9LCB0aGlzLnNlYXJjaElucHV0Lmxlbmd0aCA+PSAxID8gbnVsbCA6IChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGNsYXNzOiBcInNlbGVjdC1hbGxcIiwgb25DbGljazogaGFuZGxlU2VsZWN0QWxsLmJpbmQodGhpcykgfSwgdGhpcy5hbGxMYXllcnNTZWxlY3RlZCA/IHRoaXMuaTE4bi5kZXNlbGVjdEFsbCA6IGkxOG4uc2VsZWN0QWxsKSksIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBvbkNhbGNpdGVUcmVlU2VsZWN0OiBoYW5kbGVMYXllclNlbGVjdCwgc2VsZWN0aW9uTW9kZTogVHJlZVNlbGVjdGlvbk1vZGUuQW5jZXN0b3JzIH0sIGZpbHRlcmVkTGF5ZXJzLm1hcChyZW5kZXJUcmVlKSkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGFjdGl2ZTogbm9MYXllcnNTZWxlY3RlZCwgaGVhZGluZzogaTE4bi5lcnJvclRpdGxlLCBkZXNjcmlwdGlvbjogaTE4bi5ub0xheWVyc1NlbGVjdGVkIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3RDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0Nsb3VkQ3NzID0gXCIuc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9LnRhYmxle21hcmdpbjowcHg7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtib3JkZXItc3R5bGU6bm9uZTttaW4taGVpZ2h0OjM1cmVtfS50YWJsZV9fYm9keXttYXJnaW46MHB4O2ZsZXg6MSAxIDAlO2JvcmRlci1zdHlsZTpub25lO3BhZGRpbmc6MHB4O291dGxpbmU6MnB4IHNvbGlkIHRyYW5zcGFyZW50O291dGxpbmUtb2Zmc2V0OjJweH0udGFibGVfX2JvZHktLWNlbnRlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktaXRlbXM6Y2VudGVyfS5pbnB1dHttYXJnaW4tYm90dG9tOjFyZW07ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlfS5zZWxlY3R7bWFyZ2luLWlubGluZS1zdGFydDowLjVyZW07bWluLXdpZHRoOjEwcmVtfS5maWxlc3tsaXN0LXN0eWxlLXR5cGU6bm9uZTtwYWRkaW5nOjBweDttYXJnaW46MCAtMC41cmVtfS5maWxlc19faXRlbXtwb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDoxMDAlfS5maWxlc19faXRlbTpiZWZvcmV7cG9zaXRpb246YWJzb2x1dGU7Ym90dG9tOjBweDtkaXNwbGF5OmJsb2NrO2NvbnRlbnQ6XFxcIlxcXCI7cmlnaHQ6MC41cmVtO2xlZnQ6MC41cmVtO2JvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTMpO3RyYW5zaXRpb246YWxsIDE1MG1zIGVhc2UtaW4tb3V0O3otaW5kZXg6Mn0uZmlsZXNfX2l0ZW06aG92ZXI6YmVmb3JlLC5maWxlc19faXRlbTpmb2N1cy13aXRoaW46YmVmb3Jle2JvcmRlci10b3AtY29sb3I6IzAwOWFmMn0uZmlsZXNfX2l0ZW0tLWFjdGl2ZTpiZWZvcmV7Ym9yZGVyLXRvcC1jb2xvcjp0cmFuc3BhcmVudH0uZmlsZXttYXJnaW46MHB4O2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJTtjdXJzb3I6cG9pbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7Ym9yZGVyLXJhZGl1czowO3BhZGRpbmctdG9wOjAuNzVyZW07cGFkZGluZy1ib3R0b206MC43NXJlbTtwYWRkaW5nLWxlZnQ6MC41cmVtO3BhZGRpbmctcmlnaHQ6MC41cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpO2JhY2tncm91bmQtY29sb3I6d2hpdGU7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXQ7b3V0bGluZToxcHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6LTFweDtmb250LWZhbWlseTppbmhlcml0O2JvcmRlcjpub25lO3RleHQtYWxpZ246aW5pdGlhbH0uZmlsZXNfX2l0ZW0tLWFjdGl2ZSAuZmlsZXtiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMCwgMTIxLCAxOTMsIDAuMDQpO291dGxpbmUtY29sb3I6IzAwOWFmMn0uZmlsZV9faWNvbntjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtmbGV4OjB9LmZpbGVfX3RpdGxle2ZsZXg6MSAxIDAlO3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NTAwfS5maWxlX190eXBle3dpZHRoOjMwJTtmbGV4OjAgMSBhdXRvfS5maWxlX19zaXple3RleHQtYWxpZ246aW5saW5lLWVuZDt3aWR0aDo2cmVtO2ZsZXg6MCAxIGF1dG99Lm5vLXJlc3VsdHN7ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlO3RleHQtYWxpZ246Y2VudGVyfS5uZXh0e21hcmdpbjowcHg7ZGlzcGxheTpibG9ja30uZXJyb3J7cG9zaXRpb246YWJzb2x1dGU7Ym90dG9tOjFyZW07cmlnaHQ6MXJlbTtpbnNldC1pbmxpbmUtZW5kOjFyZW07ei1pbmRleDoyfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNDbG91ZCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLnVwZGF0ZUZpbHRlciA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IHRoaXMuc2VsZWN0LnF1ZXJ5U2VsZWN0b3IoXCJjYWxjaXRlLW9wdGlvbltzZWxlY3RlZF1cIik7XG4gICAgICAgICAgICB0aGlzLmZpbHRlciA9IG9wdGlvbi52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGVib3VuY2VkSW5wdXQgPSBkZWJvdW5jZSgoc2VhcmNoVGVybSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gc2VhcmNoVGVybTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgICAgIH0sIDQwMCk7XG4gICAgICAgIHRoaXMubWFuYWdlZEZvY3VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkaW5nVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXMuc2VhcmNoaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpbGVzID0gW107XG4gICAgICAgIHRoaXMubW9yZVJlc3VsdHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZmlsdGVyID0gXCJjc3ZcIjtcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5pMThuID0gdWlTdG9yZVN0YXRlLmkxOG4uY2xvdWQ7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlcjtcbiAgICAgICAgdGhpcy5sb2FkaW5nVGV4dCA9IHRoaXMuaTE4bltjdXJyZW50XTtcbiAgICAgICAgdGhpcy5wcm92aWRlciA9IGdldFByb3ZpZGVyKGN1cnJlbnQpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnByb3ZpZGVyLmNvbm5lY3QoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VhcmNoKCk7XG4gICAgICAgICAgICBhd2FpdCB0aW1lb3V0KDIwMCk7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLm1haW5JbnB1dFJlZikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmICFhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtKSB7XG4gICAgICAgICAgICAgICAgLy8gU29tZXRpbWVzIHdoZW4gd2UgZ28gYmFjaywgYW4gaXRlbSBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgc28gd2UgbmVlZCB0byBjbGVhbiBpdCB1cFxuICAgICAgICAgICAgICAgIC8vIEZvciBub3csIGl0IG9ubHkgaGFwcGVucyBpbiBNVlxuICAgICAgICAgICAgICAgIC8vIE5vIG5lZWQgdG8gYXdhaXQgdGhpcywgY2FuIGJlIGRvbmUgaW4gdGhlIGJhY2tncm91bmRcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUV4aXN0aW5nRmlsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5wYXJzZUVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgY29uc3QgeyB0aXRsZSwgZmlsZU5hbWUsIGV4dGVuc2lvbiB9ID0gc2FuaXRpemVGaWxlTmFtZSh0aGlzLnNlbGVjdGVkLm5hbWUpO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmRhdGFVcmwgPSB0aGlzLnNlbGVjdGVkLmRvd25sb2FkVXJsO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gZXh0ZW5zaW9uO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLm5ld0l0ZW1Nb2RlID0gXCJmaWxlXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlclJlc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGNsb3VkUHJvdmlkZXI6IGdldFJlc291cmNlSWRlbnRpZmllcihhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlciksXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuc2VsZWN0ZWQuaWQsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IHRoaXMuc2VsZWN0ZWQubWltZVR5cGUsXG4gICAgICAgICAgICAgICAgY2xvdWREcml2ZUZpbGVOYW1lOiB0aGlzLnNlbGVjdGVkLm5hbWUsXG4gICAgICAgICAgICAgICAgY2xvdWRGaWxlVHlwZTogdGhpcy5maWx0ZXJcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBJbiBjYXNlIHRoZSB1c2VyIGdvZXMgYmFjayB0byB0aGUgZmlsZSBzZWxlY3QgcGFnZVxuICAgICAgICAgICAgLy8gIGFuZCBzZWxlY3QgYSBkaWZmZXJlbnQgZmlsZVxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgY29uc3QgcG9zc2libGVJdGVtVHlwZXMgPSBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbihleHRlbnNpb24pO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQubWltZVR5cGUgPT09IFwiZ29vZ2xlc2hlZXRzXCIpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlbW92ZUV4aXN0aW5nRmlsZSgpO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlID0gXCJNaWNyb3NvZnQgRXhjZWxcIjtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gXCJ4bHNcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0U3RlcCA9IGNvbmZpZ1N0YXRlLmFsbG93UHVibGlzaCA9PT0gZmFsc2UgPyBcIml0ZW1Qcm9wZXJ0aWVzXCIgOiBcInB1Ymxpc2hTZWxlY3RcIjtcbiAgICAgICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQobmV4dFN0ZXApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocG9zc2libGVJdGVtVHlwZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVFeGlzdGluZ0ZpbGUoKTtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IHBvc3NpYmxlSXRlbVR5cGVzWzBdLnR5cGU7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dEl0ZW1TdGVwID0gcG9zc2libGVJdGVtVHlwZXNbMF0ubmV4dFN0ZXA7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dFN0ZXAgPSBjb25maWdTdGF0ZS5hbGxvd1B1Ymxpc2ggPT09IGZhbHNlICYmIG5leHRJdGVtU3RlcCA9PT0gXCJwdWJsaXNoU2VsZWN0XCJcbiAgICAgICAgICAgICAgICAgICAgPyBcIml0ZW1Qcm9wZXJ0aWVzXCJcbiAgICAgICAgICAgICAgICAgICAgOiBuZXh0SXRlbVN0ZXA7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KG5leHRTdGVwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV4dGVuc2lvbiA9PT0gXCJ6aXBcIikge1xuICAgICAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcInppcFNlbGVjdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuaTE4bi5lcnJvclRpdGxlLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuaTE4bi5lcnJvck1lc3NhZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgcmVtb3ZlRXhpc3RpbmdGaWxlKCkge1xuICAgICAgICBjb25zdCBpZCA9IGFkZEl0ZW1TdGF0ZS5pZDtcbiAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuaWQgPSBudWxsO1xuICAgICAgICAgICAgYXdhaXQgZGVsZXRlSXRlbShpZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgc2VhcmNoKG5leHQpIHtcbiAgICAgICAgdGhpcy5tb3JlUmVzdWx0cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcm92aWRlci5zZWFyY2goe1xuICAgICAgICAgICAgc2VhcmNoVGV4dDogdGhpcy5zZWFyY2hUZXJtLFxuICAgICAgICAgICAgZHJvcGRvd25GaWx0ZXI6IHRoaXMuZmlsdGVyLFxuICAgICAgICAgICAgbmV4dFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBbLi4udGhpcy5maWxlcywgLi4ucmVzdWx0LmZpbGVzXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBbLi4ucmVzdWx0LmZpbGVzXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vcmVSZXN1bHRzID0gcmVzdWx0Lm5leHQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBnZXRGaWx0ZXJPcHRpb25zKCkge1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IGFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyO1xuICAgICAgICBjb25zdCBmaWx0ZXJzID0gW1wiY3N2XCIsIFwiZXhjZWxcIiwgXCJ6aXBcIiwgXCJnZW9qc29uXCJdO1xuICAgICAgICBpZiAocHJvdmlkZXIgPT09IFwiZ29vZ2xlIGRyaXZlXCIpIHtcbiAgICAgICAgICAgIGZpbHRlcnMucHVzaChcImdvb2dsZXNoZWV0c1wiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsdGVycztcbiAgICB9XG4gICAgcmVuZGVyRmlsZXMoKSB7XG4gICAgICAgIGNvbnN0IHsgZmlsZXMsIHNlbGVjdGVkLCBpMThuLCBtb3JlUmVzdWx0cyB9ID0gdGhpcztcbiAgICAgICAgaWYgKCEoZmlsZXMgPT09IG51bGwgfHwgZmlsZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGVzLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiBoKFwiZGl2XCIsIHsgY2xhc3M6IFwibm8tcmVzdWx0c1wiIH0sIGkxOG4ubm9SZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgIXRoaXMuZXJyb3IgJiYgKGgoXCJ1bFwiLCB7IGNsYXNzOiBcImZpbGVzXCIgfSwgZmlsZXMubWFwKChmaWxlKSA9PiAoaChcImxpXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBmaWxlc19faXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImZpbGVzX19pdGVtLS1hY3RpdmVcIjogZmlsZS5pZCA9PT0gKHNlbGVjdGVkID09PSBudWxsIHx8IHNlbGVjdGVkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZC5pZClcbiAgICAgICAgICAgIH0sIGtleTogZmlsZS5pZCB9LCBoKFwibGFiZWxcIiwgeyBjbGFzczogXCJmaWxlXCIsIGh0bWxGb3I6IGBpbnB1dC0ke2ZpbGUuaWR9YCB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogY2xvdWRGaWxlSWNvbnNbZmlsZS5taW1lVHlwZV0gfHwgXCJmaWxlLXRleHRcIiwgc2NhbGU6IFwic1wiLCBjbGFzczogXCJmaWxlX19pY29uXCIgfSksIGgoXCJpbnB1dFwiLCB7IHR5cGU6IFwicmFkaW9cIiwgaWQ6IGBpbnB1dC0ke2ZpbGUuaWR9YCwgbmFtZTogXCJmaWxlXCIsIHZhbHVlOiBmaWxlLmlkLCBjaGVja2VkOiAoc2VsZWN0ZWQgPT09IG51bGwgfHwgc2VsZWN0ZWQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkLmlkKSA9PT0gZmlsZS5pZCwgb25DaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gZmlsZTtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgIH0sIGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJmaWxlX190aXRsZVwiIH0sIGZpbGUubmFtZSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZmlsZV9fdHlwZVwiLCBcImFyaWEtaGlkZGVuXCI6IFwidHJ1ZVwiIH0sIGNsb3VkRmlsZU5hbWVzW2ZpbGUubWltZVR5cGVdIHx8IGkxOG4uZmlsZSksIGZpbGUuc2l6ZSAmJiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJmaWxlX19zaXplXCIsIFwiYXJpYS1oaWRkZW5cIjogXCJ0cnVlXCIgfSwgZm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKSkpKSkpKSkpLCBtb3JlUmVzdWx0cyAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgXCJpY29uLXN0YXJ0XCI6IFwicGx1c1wiLCBjbGFzczogXCJuZXh0XCIsIGFwcGVhcmFuY2U6IFwidHJhbnNwYXJlbnRcIiwgb25DbGljazogKCkgPT4gdGhpcy5zZWFyY2godHJ1ZSkgfSwgaTE4bi52aWV3TW9yZSkpKSk7XG4gICAgfVxuICAgIHBhcnNlRXJyb3IoZSkge1xuICAgICAgICBpZiAoZSA9PT0gXCJwb3B1cEJsb2NrZWRcIikge1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMuaTE4bi5lcnJvci5wb3B1cDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmkxOG4uZXJyb3IuZ2VuZXJpYztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbG9hZGluZywgbG9hZGluZ1RleHQsIGZpbGVzLCBpMThuLCBmaWx0ZXIsIHNlYXJjaGluZywgZXJyb3IgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBsb2FkaW5nICYmICFmaWxlcy5sZW5ndGggPyAoaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyBhY3RpdmU6IHRydWUsIHRleHQ6IGxvYWRpbmdUZXh0LCB0eXBlOiBcImluZGV0ZXJtaW5hdGVcIiB9KSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInRhYmxlXCIgfSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyB0eXBlOiBcInNlYXJjaFwiLCBpY29uOiBcInNlYXJjaFwiLCBjbGFzczogXCJpbnB1dFwiLCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkSW5wdXQoZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgfSwgbGFiZWw6IGkxOG4uc2VhcmNoRmlsZXMsIHJlZjogKGVsZSkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWxlKSB9LCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogaTE4bi5maWx0ZXJGaWxlVHlwZSwgcmVmOiAoZWwpID0+ICh0aGlzLnNlbGVjdCA9IGVsKSwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiB0aGlzLnVwZGF0ZUZpbHRlciwgc2xvdDogXCJhY3Rpb25cIiwgY2xhc3M6IFwic2VsZWN0XCIgfSwgdGhpcy5nZXRGaWx0ZXJPcHRpb25zKCkubWFwKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogZmlsdGVyID09PSB2YWx1ZSwgdmFsdWU6IHZhbHVlLCBsYWJlbDogKF9hID0gaTE4bi5maWxlVHlwZVt2YWx1ZV0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNsb3VkRmlsZU5hbWVzW3ZhbHVlXSB9KSk7XG4gICAgICAgIH0pKSksIGgoXCJmaWVsZHNldFwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgdGFibGVfX2JvZHk6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJ0YWJsZV9fYm9keS0tY2VudGVyXCI6IHNlYXJjaGluZyB8fCAhZmlsZXMubGVuZ3RoXG4gICAgICAgICAgICB9IH0sIGgoXCJsZWdlbmRcIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgaTE4bi5zZWxlY3RBRmlsZSksIHRoaXMuc2VhcmNoaW5nID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJsb2FkZXJcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IGFjdGl2ZTogdHJ1ZSwgdGV4dDogaTE4bi5sb2FkaW5nRmlsZXMgfSkpKSA6ICh0aGlzLnJlbmRlckZpbGVzKCkpKSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UsIGFjdGl2ZTogISFlcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0Nsb3VkLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQ2xvdWRDc3M7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0ZpbGVGaWVsZHNDc3MgPSBcIi5maWVsZHMtY29udGFpbmVye2Rpc3BsYXk6ZmxleDtoZWlnaHQ6MTAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW59LmZpZWxkLXRhYmxle21hcmdpbi1ib3R0b206MS41cmVtO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47bWluLWhlaWdodDoxNXJlbX0uc2VhcmNoLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJX0uc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9LmZpZWxkLXNlYXJjaHttYXJnaW4taW5saW5lLWVuZDo4cHg7d2lkdGg6NzUlfS5maWVsZC1zZWxlY3R7d2lkdGg6MjUlfS5maWVsZHMtc2Nyb2xsLWNvbnRhaW5lcntmbGV4OjEgMSBhdXRvO292ZXJmbG93LXk6YXV0bzt0cmFuc2Zvcm06dHJhbnNsYXRlWigwKX0uaGVhZGVyLXJvd3tkaXNwbGF5OmZsZXg7YWxpZ24tY29udGVudDpmbGV4LXN0YXJ0O2p1c3RpZnktY29udGVudDpjZW50ZXI7Z2FwOjAuMjVyZW07cGFkZGluZzowLjI1cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmhlYWRlci1jZWxse3dpZHRoOjEwMCV9LmhpZGV7ZGlzcGxheTpub25lfS5jaGlwLWNvbnRhaW5lcnttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbToxcmVtfS5jaGlwe2ZvbnQtd2VpZ2h0OjcwMH0uY2xlYXItc2VsZWN0aW9ue21hcmdpbi1sZWZ0OjAuNzVyZW07bWFyZ2luLXJpZ2h0OjAuNzVyZW07Y3Vyc29yOnBvaW50ZXI7LXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7LW1vei1hcHBlYXJhbmNlOm5vbmU7YXBwZWFyYW5jZTpub25lO2JvcmRlci13aWR0aDowcHg7Ym9yZGVyLXN0eWxlOm5vbmU7cGFkZGluZzowcHg7Zm9udC1mYW1pbHk6QXZlbmlyIE5leHQsIEF2ZW5pciwgSGVsdmV0aWNhIE5ldWUsIHNhbnMtc2VyaWY7Zm9udC1zaXplOjAuNzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0yKTtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50fS5jbGVhci1zZWxlY3Rpb246aG92ZXJ7Y3Vyc29yOnBvaW50ZXI7dGV4dC1kZWNvcmF0aW9uLWxpbmU6dW5kZXJsaW5lfS5ub3QtdmlzaWJsZXt2aXNpYmlsaXR5OmhpZGRlbjtoZWlnaHQ6MHB4fS5kZXNjcmlwdGlvbnttYXJnaW4tYm90dG9tOjFyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc0ZpbGVGaWVsZHMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ3b3JrZmxvd0NvbXBsZXRlXCIsIDcpO1xuICAgICAgICAvLyBUZWxlbWV0cnk6IGdhdGhlciBpbmZvIGFib3V0IHdoaWNoIGZpZWxkcyBoYXZlIHJlY2VpdmVkIHVzZXIgaW5wdXRcbiAgICAgICAgdGhpcy5maWVsZHNTZWFyY2hlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZpZWxkc01vZGlmaWVkID0ge307XG4gICAgICAgIHRoaXMuYWRkRGlyZWN0VG9NYXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oYW5kbGVUaW1lem9uZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRpbWV6b25lID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZU1vZGlmaWVkRmllbGRzID0gKGRldGFpbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBrZXksIG1vZGlmaWVkIH0gPSBkZXRhaWw7XG4gICAgICAgICAgICAvLyBJZiBubyBleGlzdGluZyBlbnRyeSwgY3JlYXRlIG9uZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5J3MgbW9kaWZpZWQgZmxhZyBzZXQsIHVwZGF0ZSBvdGhlcndpc2VcbiAgICAgICAgICAgIGlmICghdGhpcy5maWVsZHNNb2RpZmllZFtuYW1lXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzTW9kaWZpZWRbbmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGtleSA9PT0gXCJ0eXBlXCIgJiYgbW9kaWZpZWQgPyAxIDogMCxcbiAgICAgICAgICAgICAgICAgICAgYWxpYXM6IGtleSA9PT0gXCJhbGlhc1wiICYmIG1vZGlmaWVkID8gMSA6IDBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZHNNb2RpZmllZFtuYW1lXVtrZXldID0gbW9kaWZpZWQgPyAxIDogMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVGaWVsZFR5cGVGaWx0ZXIgPSAoZXYpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZFR5cGVGaWx0ZXIgPSBldi50YXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlU2VhcmNoQ2hhbmdlID0gKGV2KSA9PiB7XG4gICAgICAgICAgICAvLyBUZWxlbWV0cnk6IEZsYWcgaWYgdGhlIHVzZXIgYXR0ZW1wdGVkIHRvIHNlYXJjaFxuICAgICAgICAgICAgdGhpcy5maWVsZHNTZWFyY2hlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSBldi50YXJnZXQudmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0RmlsdGVyZWRGaWVsZHMgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlcmVkRmllbGRzID0gdGhpcy5maWVsZHMucmVkdWNlKChmaWx0ZXJlZEZpZWxkcywgZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoKCF0aGlzLnNlYXJjaFRlcm0gfHxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGhpcy5zZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpID4gLTEgfHxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQuYWxpYXMudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSA+IC0xKSAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9PT0gXCJkZWZhdWx0XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZFR5cGVGaWx0ZXIgPT09IGZpZWxkLnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkRmllbGRzW2ZpZWxkLm5hbWVdID0gZmllbGQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZEZpZWxkcztcbiAgICAgICAgICAgIH0sIHt9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RBbGxUb2dnbGUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMuZmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoISF0aGlzLmZpbHRlcmVkRmllbGRzW2ZpZWxkLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGZpZWxkKSwgeyBzZWxlY3RlZDogIXRoaXMuYWxsU2VsZWN0ZWQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWVsZHMgPSB0aGlzLmZpZWxkcy5tYXAoKGZpZWxkKSA9PiAoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBmaWVsZCksIHsgc2VsZWN0ZWQ6IGZhbHNlIH0pKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRlbGVtZXRyeTogTG9nIGNoYW5nZXMgdXNlciBtYWRlIHRvIGZpZWxkc1xuICAgICAgICB0aGlzLmxvZ0NTVkZpZWxkQ2hhbmdlcyA9IChmaWVsZHMpID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE86IFJlZmFjdG9yIGZpZWxkcyBjb3VudCB0byB1c2UgbWFwcmVkdWNlXG4gICAgICAgICAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgICAgICAgICBjb25zdCBtb2RpZmllZEZpZWxkc0NvdW50ID0geyB0eXBlOiAwLCBhbGlhczogMCB9O1xuICAgICAgICAgICAgY29uc3QgdG90YWxGaWVsZHNDb3VudCA9IHRoaXMuZmllbGRzLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGRzQ291bnQgPSBPYmplY3Qua2V5cyhmaWVsZHMpLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgaW4gdGhpcy5maWVsZHNNb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIG1vZGlmaWVkRmllbGRzQ291bnQudHlwZSArPSB0aGlzLmZpZWxkc01vZGlmaWVkW2ZpZWxkXS50eXBlO1xuICAgICAgICAgICAgICAgIG1vZGlmaWVkRmllbGRzQ291bnQuYWxpYXMgKz0gdGhpcy5maWVsZHNNb2RpZmllZFtmaWVsZF0uYWxpYXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICAgICAgICAgIHBhZ2VOYW1lOiBcIm15IGNvbnRlbnRcIixcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbSBjc3YgdGltZSB6b25lIGFuZCBmaWVsZHNcIixcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB0aGlzLmZpZWxkc1NlYXJjaGVkID8gXCJmaWVsZHMgc2VhcmNoZWRcIiA6IFwibm8gZmllbGRzIHNlYXJjaGVkXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuaW5pdGlhbFRpbWV6b25lID09PSBhZGRJdGVtU3RhdGUudGltZXpvbmUgPyBcImRlZmF1bHQgdGltZXpvbmVcIiA6IFwidGltZXpvbmUgY2hhbmdlZFwiLFxuICAgICAgICAgICAgICAgIGNvdW50OiB0b3RhbEZpZWxkc0NvdW50LFxuICAgICAgICAgICAgICAgIG51bWJlcjogdG90YWxGaWVsZHNDb3VudCAtIHNlbGVjdGVkRmllbGRzQ291bnQsXG4gICAgICAgICAgICAgICAgc2l6ZTogbW9kaWZpZWRGaWVsZHNDb3VudC5hbGlhcyxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbW9kaWZpZWRGaWVsZHNDb3VudC50eXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlbGVjdGVkRmllbGRUeXBlRmlsdGVyID0gXCJkZWZhdWx0XCI7XG4gICAgICAgIHRoaXMuZmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpbHRlcmVkRmllbGRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbGxTZWxlY3RlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaGFuZGxlTmV4dCgpIHtcbiAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5maWVsZHMucmVkdWNlKChmaWVsZE1hcCwgZmllbGQpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBpZiAoZmllbGQuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgZmllbGQuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgLy8gIzQzMzYgLSBpZiB1c2VyIGNoYW5nZWQgdG8gc3RyaW5nLCBhZGQgYSBsYXJnZXIgbGVuZ3RoIHRvIGF2b2lkIHB1Ymxpc2ggZXJyb3JzXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiICYmICgoX2IgPSAoX2EgPSB0aGlzLmZpZWxkc01vZGlmaWVkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbZmllbGQubmFtZV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC5sZW5ndGggPSA0MDAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWVsZE1hcFtmaWVsZC5uYW1lXSA9IGZpZWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpZWxkTWFwO1xuICAgICAgICB9LCB7fSk7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkcyA9IGZpZWxkcztcbiAgICAgICAgdGhpcy5sb2dDU1ZGaWVsZENoYW5nZXMoZmllbGRzKTtcbiAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBtZXJnZSB0aGlzIHdpdGggdGhlIHNhbWUgdGhpbmcgaW4gYGNzdi1sb2NhdGlvbi1maWVsZHNgXG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgICAgICAgICAgdXJsOiBlbmNvZGVVUkkoYWRkSXRlbVN0YXRlLnVybCksXG4gICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1ldGVyczogYWRkSXRlbVN0YXRlLmN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgICAgICAgICAgICBhbmFseXplUmVzdWx0czogYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFkZEl0ZW1TdGF0ZS50eXBlID09PSBcIkdlb0pzb25cIikge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJjc3ZMb2NhdGlvbkZpZWxkc1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmaWVsZHNDaGFuZ2VkKCkge1xuICAgICAgICB0aGlzLmdldEZpbHRlcmVkRmllbGRzKCk7XG4gICAgfVxuICAgIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSB7XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUsIHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgcmV0dXJuIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiAmJiBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiAmJiB0eXBlICE9PSBcIkNTVlwiO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuO1xuICAgICAgICB0aGlzLmkxOG4gPSBpMThuLmNzdkZpZWxkcztcbiAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcImFkZFRvTWFwXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBiYWNrdXBMYXllckZpZWxkcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCBmaWVsZHMgPSBnZXRBbmFseXplZExheWVySW5mbygpLmZpZWxkcztcbiAgICAgICAgY29uc3QgbG9va3VwTWFwID0ge307XG4gICAgICAgIGZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4gKGxvb2t1cE1hcFtmaWVsZC5uYW1lXSA9IHRydWUpKTtcbiAgICAgICAgdGhpcy5maWVsZHMgPSBiYWNrdXBMYXllckZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgcmV0dXJuIChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sICgoX2IgPSAoX2EgPSBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtmaWVsZC5uYW1lXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZmllbGQpKSwgeyBzZWxlY3RlZDogISFsb29rdXBNYXBbZmllbGQubmFtZV0gfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5nZXRGaWx0ZXJlZEZpZWxkcygpO1xuICAgICAgICB0aGlzLmluaXRpYWxUaW1lem9uZSA9IGFkZEl0ZW1TdGF0ZS50aW1lem9uZTtcbiAgICAgICAgdGhpcy5hZGREaXJlY3RUb01hcCA9IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiAmJiAhYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmc7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQzMzQxXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbENvbnRhaW5lciAmJiAoKF9hID0gbmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLnZlbmRvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiQXBwbGVcIikpKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgICAgICAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9IFwiYXV0b1wiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUZpZWxkKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwga2V5LCB2YWx1ZSB9ID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMuZmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWVsZC5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgZmllbGRba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIC8vIFRlbGVtZXRyeTogVHJhY2sgaWYgdGhlIGluY29taW5nIGtleSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgZGVmYXVsdCB2YWx1ZVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTW9kaWZpZWRGaWVsZHMoZXZlbnQuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBhZGREaXJlY3RUb01hcCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5hbGxTZWxlY3RlZCA9IE9iamVjdC5rZXlzKHRoaXMuZmlsdGVyZWRGaWVsZHMpLmV2ZXJ5KChuYW1lKSA9PiB0aGlzLmZpbHRlcmVkRmllbGRzW25hbWVdLnNlbGVjdGVkKTtcbiAgICAgICAgY29uc3QgY2FuSGlkZUZpZWxkcyA9ICFhZGREaXJlY3RUb01hcCAmJiB1aVN0b3JlU3RhdGUud29ya2Zsb3cgIT09IFwiYXBwZW5kXCI7XG4gICAgICAgIGNvbnN0IG51bWJlclNlbGVjdGVkID0gdGhpcy5maWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gZmllbGQuc2VsZWN0ZWQpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgaGFzRGF0ZSA9IHRoaXMuZmllbGRzLnNvbWUoKGZpZWxkKSA9PiBmaWVsZC50eXBlID09PSBcImVzcmlGaWVsZFR5cGVEYXRlXCIpO1xuICAgICAgICBjb25zdCB0aW1lem9uZSA9IGFkZEl0ZW1TdGF0ZS50aW1lem9uZTtcbiAgICAgICAgY29uc3Qgcm93SGVhZGVycyA9IFtpMThuLmZpZWxkTmFtZSwgaTE4bi5kaXNwbGF5TmFtZSwgaTE4bi50eXBlXTtcbiAgICAgICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCB7IGNsYXNzOiBcImZpZWxkcy1jb250YWluZXJcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgY2xhc3M6IFwiZGVzY3JpcHRpb25cIiwgaGVhZGVyOiBpMThuLmZpZWxkVGl0bGUsIGNvbnRlbnQ6IGkxOG5bIWFkZEl0ZW1TdGF0ZS5lbmFibGVQdWJsaXNoaW5nID8gXCJmaWVsZE5vSG9zdGVkRGVzY3JpcHRpb25cIiA6IFwiZmllbGREZXNjcmlwdGlvblwiXSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlYXJjaC1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImZpZWxkLXNlYXJjaFwiIH0sIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgb25DYWxjaXRlSW5wdXRJbnB1dDogdGhpcy5oYW5kbGVTZWFyY2hDaGFuZ2UsIHR5cGU6IFwic2VhcmNoXCIsIHBsYWNlaG9sZGVyOiBpMThuLnNlYXJjaEZpZWxkcyB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgaTE4bi5zZWFyY2hGaWVsZHMpKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IGkxOG4uZmllbGRUeXBlLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMuaGFuZGxlRmllbGRUeXBlRmlsdGVyLCBjbGFzczogXCJmaWVsZC1zZWxlY3RcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkRmllbGRUeXBlRmlsdGVyID09PSBcImRlZmF1bHRcIiwgdmFsdWU6IFwiZGVmYXVsdFwiIH0sIGkxOG4uYWxsVHlwZXMpLCBPYmplY3Qua2V5cyhpMThuLmZpZWxkVHlwZXMpLm1hcCgodHlwZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmllbGRUeXBlID0gaTE4bi5maWVsZFR5cGVzW3R5cGVdO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogdGhpcy5zZWxlY3RlZEZpZWxkVHlwZUZpbHRlciA9PT0gdHlwZSwgdmFsdWU6IHR5cGUgfSwgZmllbGRUeXBlKSk7XG4gICAgICAgIH0pKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmaWVsZC10YWJsZVwiLCByb2xlOiBcInRhYmxlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBgY2hpcC1jb250YWluZXIgJHtudW1iZXJTZWxlY3RlZCA9PT0gMCB8fCBjYW5IaWRlRmllbGRzID8gXCJcIiA6IFwibm90LXZpc2libGVcIn1gIH0sIGgoXCJjYWxjaXRlLWNoaXBcIiwgeyBjbGFzczogXCJjaGlwXCIsIHZhbHVlOiBudW1iZXJTZWxlY3RlZCB9LCBudW1iZXJTZWxlY3RlZCwgXCIgXCIsIGkxOG4uc2VsZWN0ZWQpLCBoKFwiYnV0dG9uXCIsIHsgb25DbGljazogdGhpcy5jbGVhclNlbGVjdGlvbiwgY2xhc3M6IFwiY2xlYXItc2VsZWN0aW9uXCIgfSwgaTE4bi5jbGVhclNlbGVjdGlvbikpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IGBoZWFkZXItcm93ICR7T2JqZWN0LmtleXModGhpcy5maWx0ZXJlZEZpZWxkcykubGVuZ3RoID09PSAwID8gXCJoaWRlXCIgOiBcIlwifWAsIHJvbGU6IFwicm93XCIgfSwgcm93SGVhZGVycy5tYXAoKGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCAmJiBjYW5IaWRlRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwgY2xhc3M6IFwiaGVhZGVyLWNlbGxcIiwgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIgfSwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBjaGVja2VkOiB0aGlzLmFsbFNlbGVjdGVkLCBvbkNhbGNpdGVDaGVja2JveENoYW5nZTogdGhpcy5oYW5kbGVTZWxlY3RBbGxUb2dnbGUgfSksIGNvbHVtbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChoKFwic3BhblwiLCB7IGNsYXNzOiBcImhlYWRlci1jZWxsXCIsIHJvbGU6IFwiY29sdW1uaGVhZGVyXCIsIFwiYXJpYS1zb3J0XCI6IFwibm9uZVwiIH0sIGNvbHVtbikpO1xuICAgICAgICB9KSksIE9iamVjdC5rZXlzKHRoaXMuZmlsdGVyZWRGaWVsZHMpLmxlbmd0aCA+IDAgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZpZWxkcy1zY3JvbGwtY29udGFpbmVyXCIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxDb250YWluZXIgPSBlbDtcbiAgICAgICAgICAgIH0gfSwgT2JqZWN0LmtleXModGhpcy5maWx0ZXJlZEZpZWxkcykubWFwKChrZXkpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBjb25zdCBmaWVsZCA9IHRoaXMuZmlsdGVyZWRGaWVsZHNba2V5XTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImFyY2dpcy1uZXctaXRlbS1jc3YtZmllbGRcIiwgeyBkZXRlY3RlZFR5cGU6IChfYiA9IChfYSA9IGFkZEl0ZW1TdGF0ZSA9PT0gbnVsbCB8fCBhZGRJdGVtU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFkZEl0ZW1TdGF0ZS5iYWNrdXBMYXllckZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQoKGJhY2t1cEZpZWxkKSA9PiBiYWNrdXBGaWVsZC5uYW1lID09PSBmaWVsZC5uYW1lKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnR5cGUsIG9uRmllbGRDaGFuZ2U6IHRoaXMudXBkYXRlRmllbGQuYmluZCh0aGlzKSwgZmllbGQ6IGZpZWxkLCBmaWVsZFR5cGVzOiBpMThuLmZpZWxkVHlwZXMsIGRlZmF1bHRDaGVja2VkOiBmaWVsZC5zZWxlY3RlZCwgY2FuSGlkZUZpZWxkczogY2FuSGlkZUZpZWxkcywgZGlzcGxheU5hbWVMYWJlbDogaTE4bi5kaXNwbGF5TmFtZUxhYmVsLnJlcGxhY2UoXCIke25hbWV9XCIsIGZpZWxkLm5hbWUpLCB0eXBlTGFiZWw6IGkxOG4udHlwZUxhYmVsLnJlcGxhY2UoXCIke25hbWV9XCIsIGZpZWxkLm5hbWUpIH0pKTtcbiAgICAgICAgfSkpKSA6IChoKFwiY2FsY2l0ZS1pbnB1dC1tZXNzYWdlXCIsIHsgaWNvbjogdHJ1ZSwgc3RhdHVzOiBcInZhbGlkXCIgfSwgaTE4bi5ub0ZpZWxkcykpKSwgaGFzRGF0ZSAmJiAhYWRkRGlyZWN0VG9NYXAgJiYgKGgoXCJhcmNnaXMtbmV3LWl0ZW0tdGltZXpvbmUtZHJvcGRvd25cIiwgeyBvblRpbWV6b25lQ2hhbmdlOiB0aGlzLmhhbmRsZVRpbWV6b25lQ2hhbmdlLCBkZWZhdWx0VGltZXpvbmU6IHRpbWV6b25lIH0pKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJmaWVsZHNcIjogW1wiZmllbGRzQ2hhbmdlZFwiXSxcbiAgICAgICAgXCJzZWxlY3RlZEZpZWxkVHlwZUZpbHRlclwiOiBbXCJmaWVsZHNDaGFuZ2VkXCJdLFxuICAgICAgICBcInNlYXJjaFRlcm1cIjogW1wiZmllbGRzQ2hhbmdlZFwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNGaWxlRmllbGRzLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzRmlsZUZpZWxkc0NzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzSXRlbVByb3BlcnRpZXNDc3MgPSBcIi5sYXllci1kZXNjcmlwdGlvbi5zYy1hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtaXRlbS1wcm9wZXJ0aWVze2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTowLjc1cmVtfS5sb2NhdG9yX19oZWFkaW5nLnNjLWFyY2dpcy1uZXctaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXN7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7bGluZS1oZWlnaHQ6MThweDttYXJnaW4tYm90dG9tOjJweH0ubG9jYXRvcl9fZGVzY3JpcHRpb24uc2MtYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3ttYXJnaW46MHB4O21hcmdpbi1ib3R0b206MXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5tZWRpdW0uc2MtYXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWl0ZW0tcHJvcGVydGllc3stLWFyY2dpcy1sYWJlbC1mb250LXdlaWdodDo1MDB9LmluZm8tY29udGFpbmVyLnNjLWFyY2dpcy1uZXctaXRlbS1wYWdlcy1pdGVtLXByb3BlcnRpZXN7bWFyZ2luLWJvdHRvbToxLjVyZW19XCI7XG5cbnZhciBfX2FzeW5jVmFsdWVzID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19hc3luY1ZhbHVlcykgfHwgZnVuY3Rpb24gKG8pIHtcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICAgIHZhciBtID0gb1tTeW1ib2wuYXN5bmNJdGVyYXRvcl0sIGk7XG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cbiAgICBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCBkLCB2KSB7IFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGZ1bmN0aW9uICh2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxufTtcbmNvbnN0IE1BWF9USVRMRV9MRU5HVEggPSAyNTA7XG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNJdGVtUHJvcGVydGllcyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q2FuY2VsXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWxsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oYW5kbGVSZXF1ZXN0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgICAgICAvLyBEb24ndCBzZW5kIHJlcXVlc3QgaWYgYW4gZXJyb3IgaXMgcmVwb3J0ZWRcbiAgICAgICAgICAgIGlmICghKGF3YWl0IHRoaXMudmFsaWRhdGUoKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IG5ld0l0ZW1Nb2RlLCBleGlzdGluZ0l0ZW0sIHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2F0ZWdvcmllcyB9ID0gaXRlbVByb3BlcnRpZXNTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgICAgIGxldCBhZGRSZXNwb25zZTtcbiAgICAgICAgICAgIGxldCBwdWJsaXNoUmVzcG9uc2U7XG4gICAgICAgICAgICBsZXQgZW1wdHlMYXllckNyZWF0ZWQgPSBuZXdJdGVtTW9kZSA9PT0gXCJmZWF0dXJlTGF5ZXJcIjtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZTtcbiAgICAgICAgICAgIGlmICgodGl0bGUgPT09IG51bGwgfHwgdGl0bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpdGxlLmxlbmd0aCkgPiBNQVhfVElUTEVfTEVOR1RIKSB7XG4gICAgICAgICAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHRpdGxlLnN1YnN0cmluZygwLCBNQVhfVElUTEVfTEVOR1RIKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gVGVsZW1ldHJ5OiBCZWdpbiB1cGxvYWQgdHJhY2tpbmcgd29ya2Zsb3dcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBDaGVjayBpZiBzYW1lIHRlbGVtZXRyeSBldmVudHMgc2hvdWxkIGJlIHVzZWQgaW4gZXhpc3RpbmcgaXRlbSBwdWJsaXNoIHdvcmtmbG93cyB0b29cbiAgICAgICAgICAgICAgICBsb2dBZGROZXdJdGVtU3RhcnQoKTtcbiAgICAgICAgICAgICAgICAoeyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH0gPVxuICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0l0ZW0gJiYgbmV3SXRlbU1vZGUgPT09IFwiZmlsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGF3YWl0IHRoaXMucHVibGlzaEV4aXN0aW5nSXRlbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGF3YWl0IHRoaXMuaGFuZGxlQWRkSXRlbSgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZUlkcyA9IFthZGRSZXNwb25zZSA9PT0gbnVsbCB8fCBhZGRSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWRkUmVzcG9uc2UuaWQsIHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZF0uZmlsdGVyKChpZCkgPT4gaWQpO1xuICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMgJiYgKGF3YWl0IHVwZGF0ZUNhdGVnb3JpZXMoeyBwb3J0YWwsIGl0ZW1JZHM6IHJlc3BvbnNlSWRzLCBjYXRlZ29yaWVzIH0pKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJLTUxcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGNvbmZpZywgcG9ydGFsLCBhcGkgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBwcm9jZXNzUG9zdEFkZEtNTCgoX2EgPSBhZGRSZXNwb25zZS5pZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogYWRkSXRlbVN0YXRlLmlkLCBwb3J0YWwsIGNvbmZpZy5yZXN0QmFzZVVybCwgY29uZmlnLCBhcGkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMud29ya2Zsb3dDYW5jZWxsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGVsZW1ldHJ5OiBPbmx5IGxvZyB0ZWxlbWV0cnkgYWZ0ZXIgc3VjY2Vzc2Z1bCB1cGxvYWRcbiAgICAgICAgICAgICAgICAgICAgbG9nSXRlbVByb3BlcnRpZXNDaGFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgICAgIGxvZ1N1Y2Nlc3NmdWxJdGVtQ3JlYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgISFhZGRJdGVtU3RhdGUuYWRkVGlsZUxheWVyT3B0aW9uICYmIGxvZ1RpbGVMYXllckZpbmlzaCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWdTdGF0ZS50ZWxlbWV0cnkgJiYgKGF3YWl0IHRpbWVvdXQoNzUwKSk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBlbWl0UGF5bG9hZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3SXRlbU1vZGUgPT09IFwidXJsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgdXJsOiBhZGRJdGVtU3RhdGUudXJsLCBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycywgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsIGFkZEFzQmFzZW1hcDogYWRkSXRlbVN0YXRlLmFkZEFzQmFzZW1hcCB9LCAocHVibGlzaFJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8geyBpZDogcHVibGlzaFJlc3BvbnNlLmlkLCBzZXJ2aWNlVXJsOiBwdWJsaXNoUmVzcG9uc2Uuc2VydmljZVVybCB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoge30pKSwgKGFkZEl0ZW1TdGF0ZS5zdG9yZUF1dGggPyB7IGlkOiBhZGRSZXNwb25zZS5pZCB9IDoge30pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0UGF5bG9hZCA9IHBheWxvYWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGF5bG9hZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHVibGlzaFJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBwdWJsaXNoUmVzcG9uc2Uuc2VydmljZVR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcHVibGlzaFJlc3BvbnNlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iSWQ6IHB1Ymxpc2hSZXNwb25zZS5qb2JJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VVcmw6IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlVXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUl0ZW1JbmZvOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAoX2IgPSBhZGRSZXNwb25zZSA9PT0gbnVsbCB8fCBhZGRSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWRkUmVzcG9uc2UuaWQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGV4aXN0aW5nSXRlbSA9PT0gbnVsbCB8fCBleGlzdGluZ0l0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4aXN0aW5nSXRlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogKF9jID0gYWRkSXRlbVN0YXRlLnR5cGUpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IGV4aXN0aW5nSXRlbSA9PT0gbnVsbCB8fCBleGlzdGluZ0l0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4aXN0aW5nSXRlbS50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oeyB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSwgaWQ6IGFkZFJlc3BvbnNlLmlkIH0sIChhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMgJiYgYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5emVSZXN1bHRzOiBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB7fSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0UGF5bG9hZCA9IHBheWxvYWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWl0UGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGBwdWJsaXNoUmVzcG9uc2VgIGRvZXNuJ3QgZm9yIHNvbWUgZmxvd3Mgc28gdXNlIHRoaXMgaWQgaW5zdGVhZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhZGRSZXNwb25zZSA9PT0gbnVsbCB8fCBhZGRSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWRkUmVzcG9uc2UuaWQsIGl0ZW06IE9iamVjdC5hc3NpZ24oe30sIGFkZEl0ZW1TdGF0ZSksIHJlc3BvbnNlOiBhZGRSZXNwb25zZSwgZW1wdHlMYXllckNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3SXRlbU1vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHB1Ymxpc2hSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZmxvd0NvbXBsZXRlLmVtaXQoZW1pdFBheWxvYWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCkgJiYgKGF3YWl0IGRlbGV0ZUl0ZW0ocHVibGlzaFJlc3BvbnNlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlLmlkICYmIChhd2FpdCBkZWxldGVJdGVtKGFkZFJlc3BvbnNlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDYW5jZWwuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNldEFkZEl0ZW1TdG9yZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChuZXdJdGVtTW9kZSA9PT0gXCJmZWF0dXJlTGF5ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiByZWZhY3RvciB0aGlzIG9uY2Ugd2UgcmVmYWN0b3IgdGhlIGVycm9yIHN5c3RlbSBpbiBpdGVtIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZUxheWVyRXJyb3JUZWxlbWV0cnkoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJlcHJvY2Vzc0FkZEl0ZW0gPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLnRpbGVMYXllclB1Ymxpc2hUeXBlID09PSBcIjNkVGlsZXNcIikge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMgPSBbXG4gICAgICAgICAgICAgICAgICAgIC4uLmFkZEl0ZW1TdGF0ZS50eXBlS2V5d29yZHMuZmlsdGVyKCh0eXBlS2V5d29yZCkgPT4gIXRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlcy5pbmNsdWRlcyh0eXBlS2V5d29yZCkpLFxuICAgICAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUudGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGVcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLml0ZW1UeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyB2YWxpZGF0ZSgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKCEoYXdhaXQgdGhpcy5pdGVtUHJvcGVydGllc0ZvbGRlclJlZi5zYXZlQWN0aXZlRm9sZGVyKCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGl0bGVFcnJvciA9IGF3YWl0ICgoX2EgPSB0aGlzLnRpdGxlUmVmKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsaWRhdGVUaXRsZSgpKTtcbiAgICAgICAgaWYgKHRpdGxlRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFRpdGxlIGNvbXBvbmVudCB1c2VzIGEgYnJpZWYgaW5saW5lIGVycm9yIC0gbWFwIHRoZSBtYWluIGVycm9yIGhhbmRsZXIgdG8gdGhlIGRldGFpbGVkIG1lc3NhZ2VcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPVxuICAgICAgICAgICAgICAgIHRpdGxlRXJyb3IuY29kZSA9PT0gXCJ0aXRsZUluVXNlU2VydmljZVwiID8geyBjb2RlOiBcInNlcnZpY2VOYW1lRXhpc3RzXCIgfSA6IHRpdGxlRXJyb3I7XG4gICAgICAgICAgICB0aGlzLnRpdGxlUmVmLmZvY3VzTWFpbklucHV0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3VtbWFyeUVycm9yID0gYXdhaXQgKChfYiA9IHRoaXMuc3VtbWFyeVJlZikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldEVycm9yTWVzc2FnZSgpKTtcbiAgICAgICAgaWYgKHN1bW1hcnlFcnJvcikge1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHN1bW1hcnlFcnJvcjtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgbmF2aWdhdGVUb05leHRQYWdlKCkge1xuICAgICAgICB0aGlzLmhhbmRsZVJlcXVlc3QoKTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlRXJyb3IoKSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgIC8vIDM5OTYzOiBQdWJsaXNoaW5nIGZhaWxzIGlmIHRoZSBzZXJ2aWNlIG5hbWUgaXMgdGFrZW4sIGJ1dCB0aGUgY3JlYXRlZCBpdGVtIHBlcnNpc3RzXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgbmV3bHkgY3JlYXRlZCBpdGVtIHNvIHRoZSB0aXRsZSBjYW4gYmUgY2hhbmdlZCB3aXRob3V0IHRocm93aW5nIHRoZVxuICAgICAgICAvLyBcImZpbGUgYWxyZWFkeSBleGlzdHNcIiBlcnJvciBvbiByZXRyeVxuICAgICAgICBpZiAoKGVycm9yTWVzc2FnZSA9PT0gbnVsbCB8fCBlcnJvck1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcIlNlcnZpY2UgbmFtZVwiKSkgJiYgIWFkZEl0ZW1TdGF0ZS5leGlzdGluZ0l0ZW0pIHtcbiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCB7IHBlcm1hbmVudERlbGV0ZTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkge1xuICAgICAgICByZXR1cm4gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgIH1cbiAgICAvLyBJdGVtIHdhcyBhbHJlYWR5IGNyZWF0ZWQgYW5kIG9ubHkgbmVlZHMgYW4gdXBkYXRlIGlmIGl0J3MgYSBsYXJnZSBDU1YgYWRkZWQgdG8gTVYgd2l0aG91dCBwdWJsaXNoaW5nXG4gICAgc2hvdWxkVXBkYXRlUHJldmlvdXNseUNyZWF0ZWRJdGVtKCkge1xuICAgICAgICBjb25zdCB7IHR5cGUsIGVuYWJsZVB1Ymxpc2hpbmcsIGZpbGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgbXZGbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgICAgICByZXR1cm4gKG12RmxvdyAmJlxuICAgICAgICAgICAgdHlwZSA9PT0gXCJDU1ZcIiAmJlxuICAgICAgICAgICAgIWVuYWJsZVB1Ymxpc2hpbmcgJiZcbiAgICAgICAgICAgICEhZmlsZSAmJlxuICAgICAgICAgICAgZmlsZS5zaXplID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IGFkZENyZWF0ZUkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bjtcbiAgICAgICAgY29uc3QgaTE4biA9IGFkZENyZWF0ZUkxOG4uaXRlbVByb3BlcnRpZXM7XG4gICAgICAgIHRoaXMuaTE4biA9IGkxOG47XG4gICAgICAgIGNvbnN0IHsgbmV3SXRlbU1vZGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBcImNyZWF0ZUFuZEFkZFRvTWFwXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB1aVN0b3JlU3RhdGUubmV4dFRleHQgPSBuZXdJdGVtTW9kZSA9PT0gXCJkYXRhU3RvcmVcIiA/IFwiY3JlYXRlQ29ubmVjdGlvblwiIDogXCJzYXZlXCI7XG4gICAgICAgIH1cbiAgICAgICAgYWRkSXRlbVN0YXRlLmluaXRpYWxGb2xkZXJzID0gY29uZmlnU3RhdGUuZm9sZGVycztcbiAgICAgICAgYWRkSXRlbVN0YXRlLmluaXRpYWxUaXRsZSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGU7XG4gICAgICAgIGNvbnN0IHsgZW5hYmxlUHVibGlzaGluZywgZmlsZU5hbWUsIHR5cGUsIHN0b3JlQXV0aCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBpZiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiKSB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5mbyA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogISFmaWxlTmFtZVxuICAgICAgICAgICAgICAgICAgICA/IHJlcGxhY2VJMThOU3RyaW5nKGkxOG4uaG93V2lsbEFkZCwgZmlsZU5hbWUsIFwiZmlsZU5hbWVcIilcbiAgICAgICAgICAgICAgICAgICAgOiBpMThuLmhvd1dpbGxBZGRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHN0b3JlQXV0aFxuICAgICAgICAgICAgICAgICAgICA/IGkxOG4uaG93V2lsbEFkZFNlY3VyZWRTZXJ2aWNlRGVzY3JpcHRpb25cbiAgICAgICAgICAgICAgICAgICAgOiBlbmFibGVQdWJsaXNoaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGkxOG4uaG93V2lsbEFkZEhvc3RlZERlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHJlcGxhY2VJMThOU3RyaW5nKGkxOG4uaG93V2lsbEFkZERlc2NyaXB0aW9uLCB0eXBlID09PSBcIkdlb0pzb25cIiA/IFwiR2VvSlNPTlwiIDogdHlwZSwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBoYW5kbGVBZGRJdGVtKCkge1xuICAgICAgICBjb25zdCB7IGZpbGUsIGZpbGVOYW1lLCBuZXdJdGVtTW9kZSwgdHlwZSwgZW5hYmxlUHVibGlzaGluZywgc2VydmljZUluZm8sIHR5cGVLZXl3b3JkcywgdGFncywgZXh0ZW50LCBzZWxlY3RlZFNlcnZpY2VJbmZvTGF5ZXJzTmFtZXMsIGFkZEZlYXR1cmVMYXllclR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgbGV0IGFkZFJlc3BvbnNlO1xuICAgICAgICBsZXQgcHVibGlzaFJlc3BvbnNlO1xuICAgICAgICB0aGlzLnByZXByb2Nlc3NBZGRJdGVtKCk7XG4gICAgICAgIHN3aXRjaCAobmV3SXRlbU1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmaWxlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5zaXplKSA+IE1VTFRJX1BBUlRfVVBMT0FEX01JTklNVU1fU0laRSA/IFwiZGV0ZXJtaW5hdGVcIiA6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgICAgICAgICAgICBsb2FkZXJNZXNzYWdlOiByZXBsYWNlSTE4TlN0cmluZyh0aGlzLmkxOG5bXCJ1cGxvYWRpbmdcIl0sIGZpbGVOYW1lLCBcImZpbGVUeXBlXCIpIC8vIFRPRE86IFR5cGUgaW4gc3RyaW5nIHNob3VsZCBiZSBcImZpbGVOYW1lXCIsIG5vdCBcImZpbGVUeXBlXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRVcGRhdGVQcmV2aW91c2x5Q3JlYXRlZEl0ZW0oKSkge1xuICAgICAgICAgICAgICAgICAgICAoeyBhZGRSZXNwb25zZSB9ID0gYXdhaXQgdGhpcy5oYW5kbGVGaWxlVXBkYXRlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgKHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9ID0gYXdhaXQgdGhpcy5oYW5kbGVGaWxlVXBsb2FkKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBXb3JrZmxvdyB3YXMgY2FuY2VsbGVkIGlmIG5vIGZpbGUgZm91bmQgaW4gc3RvcmVcbiAgICAgICAgICAgICAgICBpZiAoIWFkZEl0ZW1TdGF0ZS5maWxlICYmICFhZGRJdGVtU3RhdGUuZGF0YVVybCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtmbG93Q2FuY2VsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidXJsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImFkZGluZ1wiXSwgYWRkSXRlbVN0YXRlLnVybCwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICgodHlwZSA9PT0gXCJDU1ZcIiB8fCB0eXBlID09PSBcIkdlb0pzb25cIikgJiYgZW5hYmxlUHVibGlzaGluZykge1xuICAgICAgICAgICAgICAgICAgICAoeyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH0gPSBhd2FpdCB0aGlzLmhhbmRsZUZpbGVVcGxvYWQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IGhhbmRsZUFkZFVybChhZGRJdGVtU3RhdGUsIGNvbmZpZ1N0YXRlLmNvbmZpZywgY29uZmlnU3RhdGUuYXBpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmVhdHVyZUxheWVyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImNyZWF0aW5nXCJdLCBcImZlYXR1cmUgbGF5ZXJcIiwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgYWRkRmVhdHVyZUxheWVyKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmljZUluZm8sXG4gICAgICAgICAgICAgICAgICAgIHR5cGVLZXl3b3JkcyxcbiAgICAgICAgICAgICAgICAgICAgdGFncyxcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW50LFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFNlcnZpY2VJbmZvTGF5ZXJzTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIGFkZEZlYXR1cmVMYXllclR5cGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBmZWF0dXJlU2VydmljZUVuZFRlbGVtZXRyeSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInRpbGVMYXllclwiOlxuICAgICAgICAgICAgY2FzZSBcInNjZW5lTGF5ZXJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyTWVzc2FnZTogcmVwbGFjZUkxOE5TdHJpbmcodGhpcy5pMThuW1wicHVibGlzaGluZ1wiXSwgbmV3SXRlbU1vZGUgPT09IFwic2NlbmVMYXllclwiID8gXCJzY2VuZSBzZXJ2aWNlXCIgOiBcInRpbGUgbGF5ZXJcIiwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICh7IGFkZFJlc3BvbnNlLCBwdWJsaXNoUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMuYWRkVGlsZUxheWVyKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInJhc3RlckZ1bmN0aW9uVGVtcGxhdGVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZXJUeXBlOiAoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLnNpemUpID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFID8gXCJkZXRlcm1pbmF0ZVwiIDogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcInVwbG9hZGluZ1wiXSwgZmlsZU5hbWUsIFwiZmlsZVR5cGVcIilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuZmlsZSA9IG5ldyBGaWxlKFtcIlwiXSwgYCR7aXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZX0ucmZ0Lmpzb25gKTtcbiAgICAgICAgICAgICAgICAoeyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH0gPSBhd2FpdCB0aGlzLmhhbmRsZUZpbGVVcGxvYWQoKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYXBwbGljYXRpb25cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIodHJ1ZSwge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZXJUeXBlOiAoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLnNpemUpID4gTVVMVElfUEFSVF9VUExPQURfTUlOSU1VTV9TSVpFID8gXCJkZXRlcm1pbmF0ZVwiIDogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImFkZGluZ1wiXSwgYWRkSXRlbVN0YXRlLnR5cGUsIFwiZmlsZVR5cGVcIilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IGFkZEFwcGxpY2F0aW9uKGFkZEl0ZW1TdGF0ZSwgY29uZmlnU3RhdGUuY29uZmlnLnJlc3RCYXNlVXJsLCB0eXBlID09PSBcIkFwcGxpY2F0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgPyB7IHJlZGlyZWN0X3VyaXM6IFtcInVybjppZXRmOndnOm9hdXRoOjIuMDpvb2JcIl0sIGFwcFR5cGU6IFwibXVsdGlwbGVcIiB9XG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkYXRhU3RvcmVcIjpcbiAgICAgICAgICAgICAgICBjb25zdCB7IGFkZERhdGFTdG9yZVR5cGUsIHByb3ZpZGVyIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImFkZERhdGFTdG9yZVwiXSwgdGhpcy5pMThuW2FkZERhdGFTdG9yZVR5cGUgPT09IFwiY2xvdWRcIiA/IHByb3ZpZGVyIDogYWRkRGF0YVN0b3JlVHlwZV0sIFwiZmlsZVR5cGVcIilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IGFkZERhdGFTdG9yZShhZGRJdGVtU3RhdGUsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUsIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncywgaXRlbVByb3BlcnRpZXNTdGF0ZS5jYXRlZ29yaWVzLCBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRldmVsb3BlckNyZWRlbnRpYWxzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImNyZWF0aW5nXCJdLCBhZGRJdGVtU3RhdGUudHlwZSwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5hZGREZXZlbG9wZXJDcmVkZW50aWFsQXBwbGljYXRpb24oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJjcmVhdGVcIjpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyVHlwZTogXCJpbmRldGVybWluYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHJlcGxhY2VJMThOU3RyaW5nKHRoaXMuaTE4bltcImNyZWF0aW5nXCJdLCBhZGRJdGVtU3RhdGUudHlwZSwgXCJmaWxlVHlwZVwiKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgc2VuZEFkZEl0ZW1SZXF1ZXN0KGFkZEl0ZW1TdGF0ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICAgIH1cbiAgICBhc3luYyBwdWJsaXNoRXhpc3RpbmdJdGVtKCkge1xuICAgICAgICBjb25zdCB7IGlkLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGxldCBhZGRSZXNwb25zZSA9IHsgc3VjY2VzczogdHJ1ZSwgaWQsIGZvbGRlcjogbnVsbCB9O1xuICAgICAgICBjb25zdCBwdWJsaXNoUmVzcG9uc2UgPSB0eXBlID09PSBcIkltYWdlIENvbGxlY3Rpb25cIlxuICAgICAgICAgICAgPyBhd2FpdCB0aGlzLnB1Ymxpc2hJbWFnZUNvbGxlY3Rpb24oYWRkUmVzcG9uc2UpXG4gICAgICAgICAgICA6IGF3YWl0IHRoaXMucHVibGlzaFNlcnZpY2UoaWQpO1xuICAgICAgICBhd2FpdCBhcHBlbmRUeXBlS2V5d29yZHMocHVibGlzaFJlc3BvbnNlKTtcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAvaXNzdWVzLzQxNTAxXG4gICAgICAgIGNvbnN0IHR5cGVzVG9VcGRhdGVUaXRsZSA9IFtcbiAgICAgICAgICAgIFwiU2hhcGVmaWxlXCIsXG4gICAgICAgICAgICBcIkZpbGUgR2VvZGF0YWJhc2VcIixcbiAgICAgICAgICAgIFwiQ1NWXCIsXG4gICAgICAgICAgICBcIk1pY3Jvc29mdCBFeGNlbFwiLFxuICAgICAgICAgICAgXCJHZW9Kc29uXCIsXG4gICAgICAgICAgICBcIkdlb1BhY2thZ2VcIixcbiAgICAgICAgICAgIFwiRmVhdHVyZSBDb2xsZWN0aW9uXCJcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKHR5cGVzVG9VcGRhdGVUaXRsZS5pbmNsdWRlcyh0eXBlKSkge1xuICAgICAgICAgICAgKHsgYWRkUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMuaGFuZGxlRmlsZVVwZGF0ZShwdWJsaXNoUmVzcG9uc2UuaWQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBhZGRSZXNwb25zZSwgcHVibGlzaFJlc3BvbnNlIH07XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZUZpbGVVcGxvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyB0eXBlLCBlbmFibGVQdWJsaXNoaW5nLCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UsIGdlb0pTT05SZXNvdXJjZSwgY3N2UmVzb3VyY2UgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgbGV0IGFkZFJlc3BvbnNlO1xuICAgICAgICBsZXQgcHVibGlzaFJlc3BvbnNlO1xuICAgICAgICBjb25zdCBpc05vdENTVk9yRXhjZWwgPSB0eXBlICE9PSBcIkNTVlwiICYmIHR5cGUgIT09IFwiTWljcm9zb2Z0IEV4Y2VsXCI7XG4gICAgICAgIGlmIChlbmFibGVQdWJsaXNoaW5nKSB7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJJbWFnZSBDb2xsZWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IHRoaXMuYWRkRmlsZSgpO1xuICAgICAgICAgICAgICAgIHB1Ymxpc2hSZXNwb25zZSA9IGF3YWl0IHRoaXMucHVibGlzaEltYWdlQ29sbGVjdGlvbihhZGRSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgQ1NWIGFuZCBYTFhTIGZyb20gY2xvdWQgYW5kIGxhcmdlIGNzdiwgd2UgYWxyZWFkeSBhZGQgaXRlbVxuICAgICAgICAgICAgICAgIGlmICghaXNOb3RDU1ZPckV4Y2VsICYmIChjbG91ZFByb3ZpZGVyUmVzb3VyY2UgfHwgYWRkSXRlbVN0YXRlLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIG1ha2UgY2hhbmdlIHRvIHRoZSBvcmlnaW5hbCBpdGVtIHRpdGxlIGJlZm9yZSBwdWJsaXNoaW5nXG4gICAgICAgICAgICAgICAgICAgIC8vICBiZWNhdXNlIHB1Ymxpc2ggYWx3YXlzIHVzZSB0aGUgaXRlbSB0aXRsZSBhcyB0aGUgc2VydmljZSBuYW1lXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCBmb3JtYXRJdGVtUHJvcGVydGllcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3M6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNuaXBwZXQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldFxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICh7IGFkZFJlc3BvbnNlLCBwdWJsaXNoUmVzcG9uc2UgfSA9IGF3YWl0IHRoaXMucHVibGlzaEV4aXN0aW5nSXRlbSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5hZGRGaWxlKHsgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgfSk7XG4gICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5pZCA9IGFkZFJlc3BvbnNlLmlkO1xuICAgICAgICAgICAgICAgICAgICBwdWJsaXNoUmVzcG9uc2UgPSBhd2FpdCB0aGlzLnB1Ymxpc2hTZXJ2aWNlKGFkZFJlc3BvbnNlLmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXdhaXQgYXBwZW5kVHlwZUtleXdvcmRzKHB1Ymxpc2hSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUZvbGRlcihwdWJsaXNoUmVzcG9uc2UpO1xuICAgICAgICAgICAgaWYgKGNsb3VkUHJvdmlkZXJSZXNvdXJjZSB8fCBnZW9KU09OUmVzb3VyY2UgfHwgY3N2UmVzb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoKGNsb3VkUHJvdmlkZXJSZXNvdXJjZSA9PT0gbnVsbCB8fCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3VkUHJvdmlkZXJSZXNvdXJjZS5taW1lVHlwZSkgPT09IFwiemlwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xvdWRQcm92aWRlclJlc291cmNlLnppcEl0ZW1UeXBlID0gdHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYWRkQ2xvdWRQcm92aWRlclJlc291cmNlKChfYSA9IGNsb3VkUHJvdmlkZXJSZXNvdXJjZSAhPT0gbnVsbCAmJiBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgIT09IHZvaWQgMCA/IGNsb3VkUHJvdmlkZXJSZXNvdXJjZSA6IGdlb0pTT05SZXNvdXJjZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY3N2UmVzb3VyY2UsIHB1Ymxpc2hSZXNwb25zZS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChfYikge1xuICAgICAgICAgICAgICAgICAgICAvLyBuby1vcFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjbG91ZFByb3ZpZGVyUmVzb3VyY2UgJiYgIWlzTm90Q1NWT3JFeGNlbCAmJiBhZGRJdGVtU3RhdGUuaWQpIHtcbiAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IGFkZCwganVzdCBuZWVkIHRvIHVwZGF0ZSB0aGUgdGl0bGVcbiAgICAgICAgICAgICAgICBhZGRSZXNwb25zZSA9IGF3YWl0IHVwZGF0ZUl0ZW0oYWRkSXRlbVN0YXRlLmlkLCBmb3JtYXRJdGVtUHJvcGVydGllcyh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB0YWdzOiBpdGVtUHJvcGVydGllc1N0YXRlLnRhZ3MsXG4gICAgICAgICAgICAgICAgICAgIHNuaXBwZXQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFkZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5hZGRGaWxlKHsgdGl0bGU6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UsIHB1Ymxpc2hSZXNwb25zZSB9O1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVGaWxlVXBkYXRlKGlkKSB7XG4gICAgICAgIHRoaXMudXBkYXRlTG9hZGVyKFwiaW5kZXRlcm1pbmF0ZVwiLCB0aGlzLmkxOG4udXBsb2FkaW5nLnJlcGxhY2UoXCIke3R5cGV9XCIsIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSkpO1xuICAgICAgICBjb25zdCBhZGRSZXNwb25zZSA9IGF3YWl0IHVwZGF0ZUl0ZW0oaWQgIT09IG51bGwgJiYgaWQgIT09IHZvaWQgMCA/IGlkIDogYWRkSXRlbVN0YXRlLmlkLCBmb3JtYXRJdGVtUHJvcGVydGllcyh7XG4gICAgICAgICAgICB0aXRsZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSxcbiAgICAgICAgICAgIHRhZ3M6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyxcbiAgICAgICAgICAgIHNuaXBwZXQ6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuc25pcHBldFxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMudXBkYXRlRm9sZGVyKGFkZFJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIHsgYWRkUmVzcG9uc2UgfTtcbiAgICB9XG4gICAgYXN5bmMgYWRkRGV2ZWxvcGVyQ3JlZGVudGlhbEFwcGxpY2F0aW9uKCkge1xuICAgICAgICBjb25zdCB7IGRldmVsb3BlckNyZWRlbnRpYWxzUmVkaXJlY3RVcmxzLCBhcHBsaWNhdGlvbkVudmlyb25tZW50LCBkZXZlbG9wZXJDcmVkZW50aWFsc1R5cGUsIGFwaUtleVJlZmVycmVyVXJscywgZGV2ZWxvcGVyUHJpdmlsZWdlcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICByZXR1cm4gYWRkQXBwbGljYXRpb24oYWRkSXRlbVN0YXRlLCBnZXRSZXN0QmFzZVVybChjb25maWdTdGF0ZS5wb3J0YWwpLCBkZXZlbG9wZXJDcmVkZW50aWFsc1R5cGUgPT09IFwib2F1dGhcIlxuICAgICAgICAgICAgPyB7IGFwcFR5cGU6IGFwcGxpY2F0aW9uRW52aXJvbm1lbnQsIHJlZGlyZWN0X3VyaXM6IGRldmVsb3BlckNyZWRlbnRpYWxzUmVkaXJlY3RVcmxzIH1cbiAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgIGFwcFR5cGU6IFwiYXBpa2V5XCIsXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RfdXJpczogZGV2ZWxvcGVyQ3JlZGVudGlhbHNSZWRpcmVjdFVybHMsXG4gICAgICAgICAgICAgICAgaHR0cFJlZmVycmVyczogYXBpS2V5UmVmZXJyZXJVcmxzLFxuICAgICAgICAgICAgICAgIHByaXZpbGVnZXM6IGRldmVsb3BlclByaXZpbGVnZXNcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBhZGRGaWxlKHByb3BzKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRkRmlsZShwcm9wcyk7XG4gICAgICAgIHRoaXMudXBkYXRlTG9hZGVyKFwiaW5kZXRlcm1pbmF0ZVwiLCB0aGlzLmkxOG4uY2hlY2tpbmdTdGF0dXMpO1xuICAgICAgICBhd2FpdCBjaGVja0pvYlN0YXR1cyhyZXNwb25zZSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgYXN5bmMgdXBkYXRlRm9sZGVyKHB1Ymxpc2hSZXNwb25zZSkge1xuICAgICAgICBjb25zdCB7IGlkLCBmaWxlLCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgZm9sZGVyID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXI7XG4gICAgICAgIC8vIE11bHRpcGFydCBhbmQgcHJlLWFkZGVkIGl0ZW1zIG5lZWQgdG8gYmUgbW92ZWQgYWZ0ZXIgY3JlYXRpb25cbiAgICAgICAgaWYgKChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUuc2l6ZSkgPiBNVUxUSV9QQVJUX1VQTE9BRF9NSU5JTVVNX1NJWkUgfHwgY2xvdWRQcm92aWRlclJlc291cmNlKSB7XG4gICAgICAgICAgICBjb25zdCBtb3ZlSWRzID0gW107XG4gICAgICAgICAgICBpZCAmJiBtb3ZlSWRzLnB1c2goaWQpO1xuICAgICAgICAgICAgKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCkgJiYgbW92ZUlkcy5wdXNoKHB1Ymxpc2hSZXNwb25zZSA9PT0gbnVsbCB8fCBwdWJsaXNoUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hSZXNwb25zZS5pZCk7XG4gICAgICAgICAgICBmb2xkZXIuaWQgIT09IGZvbGRlci51c2VybmFtZSAmJiAoYXdhaXQgbW92ZUl0ZW0obW92ZUlkcy5qb2luKFwiLFwiKSwgZm9sZGVyLmlkKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgcHVibGlzaFNlcnZpY2UoaXRlbUlkKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2g7XG4gICAgICAgIHRoaXMuc2hvd0xvYWRlcih0cnVlLCB7XG4gICAgICAgICAgICBsb2FkZXJUeXBlOiBcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgICAgICAgIGxvYWRlck1lc3NhZ2U6IHRoaXMuaTE4bi5wdWJsaXNoaW5nU2VydmljZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyByZXN1bHQ6IHB1Ymxpc2hSZXNwb25zZSwgZXJyb3IgfSA9IGF3YWl0IHB1Ymxpc2hTZXJ2aWNlKHtcbiAgICAgICAgICAgIGl0ZW1JZCxcbiAgICAgICAgICAgIHVzZXI6IGNvbmZpZ1N0YXRlLnVzZXIsXG4gICAgICAgICAgICBleHRlbnNpb246IGFkZEl0ZW1TdGF0ZS5leHRlbnNpb24sXG4gICAgICAgICAgICB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSxcbiAgICAgICAgICAgIHRpdGxlOiBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yOyAvLyBBbHJlYWR5IHN0YW5kYXJkaXplZCBzbyB3ZSBjYW4gZnJlZWx5IHRocm93XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoKF9hID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB8fCAhKChfYyA9IChfYiA9IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iWzBdKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3VjY2VzcykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aHJvdyB0aGlzLmkxOG4uZXJyb3JQdWJsaXNoaW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChfZSA9IChfZCA9IHB1Ymxpc2hSZXNwb25zZS5zZXJ2aWNlc1swXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmVycm9yKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubWVzc2FnZSkge1xuICAgICAgICAgICAgdGhyb3cgKF9nID0gKF9mID0gcHVibGlzaFJlc3BvbnNlLnNlcnZpY2VzWzBdKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YuZXJyb3IpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlcnZpY2UgPSAoX2ggPSBwdWJsaXNoUmVzcG9uc2Uuc2VydmljZXMpID09PSBudWxsIHx8IF9oID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaFswXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuc2VydmljZUl0ZW1JZCxcbiAgICAgICAgICAgIGpvYklkOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuam9iSWQsXG4gICAgICAgICAgICBzZXJ2aWNlVHlwZTogc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnR5cGUsXG4gICAgICAgICAgICBzZXJ2aWNlVXJsOiBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2Uuc2VydmljZXVybFxuICAgICAgICB9O1xuICAgIH1cbiAgICBhc3luYyBwdWJsaXNoSW1hZ2VDb2xsZWN0aW9uKGFkZEl0ZW1SZXNwb25zZSkge1xuICAgICAgICB2YXIgX2EsIGVfMSwgX2IsIF9jO1xuICAgICAgICBjb25zdCB7IGNvbmZpZywgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgdGhpcy5zaG93TG9hZGVyKHRydWUsIHtcbiAgICAgICAgICAgIGxvYWRlclR5cGU6IFwiaW5kZXRlcm1pbmF0ZVwiLFxuICAgICAgICAgICAgbG9hZGVyTWVzc2FnZTogdGhpcy5pMThuLnB1Ymxpc2hpbmdTZXJ2aWNlXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3IgPSBjcmVhdGVJbWFnZUNvbGxlY3Rpb24oYWRkSXRlbVJlc3BvbnNlLCBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlLCB7IGNvbmZpZywgdXNlciwgcG9ydGFsIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yICh2YXIgX2QgPSB0cnVlLCBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMSA9IF9fYXN5bmNWYWx1ZXMoaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yKSwgaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzFfMTsgaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzFfMSA9IGF3YWl0IGltYWdlQ29sbGVjdGlvbkdlbmVyYXRvcl8xLm5leHQoKSwgX2EgPSBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xLmRvbmUsICFfYTsgX2QgPSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgX2MgPSBpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMV8xLnZhbHVlO1xuICAgICAgICAgICAgICAgIF9kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gX2M7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdGF0dXMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoXCJpbmRldGVybWluYXRlXCIsIHRoaXMuaTE4bltzdGF0dXNdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogc3RhdHVzLnNlcnZpY2VJdGVtSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JJZDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VUeXBlOiBzdGF0dXMudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VVcmw6IHN0YXR1cy5zZXJ2aWNldXJsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlXzFfMSkge1xuICAgICAgICAgICAgZV8xID0geyBlcnJvcjogZV8xXzEgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfZCAmJiAhX2EgJiYgKF9iID0gaW1hZ2VDb2xsZWN0aW9uR2VuZXJhdG9yXzEucmV0dXJuKSlcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgX2IuY2FsbChpbWFnZUNvbGxlY3Rpb25HZW5lcmF0b3JfMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBpZiAoZV8xKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlXzEuZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgYWRkVGlsZUxheWVyKCkge1xuICAgICAgICBjb25zdCB7IGRhdGFzZXQsIGRhdGFTdG9yZUlkLCBzZXJ2ZXJJZCB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCB7IGZvbGRlciwgY2F0ZWdvcmllcyB9ID0gaXRlbVByb3BlcnRpZXNTdGF0ZTtcbiAgICAgICAgbGV0IHB1Ymxpc2hSZXNwb25zZTtcbiAgICAgICAgaWYgKGRhdGFzZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgcHVibGlzaEZyb21EYXRhU3RvcmUoe1xuICAgICAgICAgICAgICAgIHR5cGU6IGRhdGFzZXQudHlwZSxcbiAgICAgICAgICAgICAgICBzZXJ2aWNlTmFtZTogaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSxcbiAgICAgICAgICAgICAgICBwYXRoSW5DYWNoZWRTdG9yZTogZGF0YXNldC5wYXRoLFxuICAgICAgICAgICAgICAgIGNhY2hlU3RvcmVJZDogZGF0YVN0b3JlSWQsXG4gICAgICAgICAgICAgICAgc2VydmVySWQsXG4gICAgICAgICAgICAgICAgZm9sZGVyLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQsXG4gICAgICAgICAgICAgICAgdGFnczogaXRlbVByb3BlcnRpZXNTdGF0ZS50YWdzXG4gICAgICAgICAgICB9LCBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcHVibGlzaFJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogcmVzdWx0LnNlcnZpY2VJdGVtSWQsXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VUeXBlOiByZXN1bHQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgc2VydmljZVVybDogcmVzdWx0LnNlcnZpY2VVcmxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSAhPT0gXCIzZFRpbGVzXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBmaW5pc2ggdGhlIDNEIFRpbGVzIHB1Ymxpc2ggd29ya2Zsb3dcbiAgICAgICAgICAgICAgICBjb25zdCB7IHRpbGVMYXllclB1Ymxpc2hDb250ZW50LCB0aWxlTGF5ZXJQdWJsaXNoVHlwZSwgdGlsZUxheWVyRGF0YSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdGl0bGUsIHRhZ3MsIHNuaXBwZXQgfSA9IGl0ZW1Qcm9wZXJ0aWVzU3RhdGU7XG4gICAgICAgICAgICAgICAgcHVibGlzaFJlc3BvbnNlID0gYXdhaXQgcHVibGlzaFRpbGVMYXllcih0aWxlTGF5ZXJQdWJsaXNoQ29udGVudCwge1xuICAgICAgICAgICAgICAgICAgICB1c2VyOiBjb25maWdTdGF0ZS51c2VyLFxuICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVHlwZTogdGlsZUxheWVyUHVibGlzaFR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcixcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHRhZ3MsXG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMsXG4gICAgICAgICAgICAgICAgICAgIHNuaXBwZXRcbiAgICAgICAgICAgICAgICB9LCB0aWxlTGF5ZXJEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhZGRSZXNwb25zZSA9IHsgc3VjY2VzczogdHJ1ZSwgaWQ6IHB1Ymxpc2hSZXNwb25zZS5pZCwgZm9sZGVyOiBudWxsIH07XG4gICAgICAgIHJldHVybiB7IGFkZFJlc3BvbnNlLCBwdWJsaXNoUmVzcG9uc2UgfTtcbiAgICB9XG4gICAgc2hvd0xvYWRlcihzaG93LCB1cGRhdGUpIHtcbiAgICAgICAgaWYgKHVwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIodXBkYXRlLmxvYWRlclR5cGUsIHVwZGF0ZS5sb2FkZXJNZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdChmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUxvYWRlcihsb2FkZXJUeXBlLCBsb2FkZXJNZXNzYWdlKSB7XG4gICAgICAgIHRoaXMubG9hZGVyVHlwZSA9IGxvYWRlclR5cGU7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IGxvYWRlck1lc3NhZ2U7XG4gICAgfVxuICAgIHBhcnNlRXJyb3IoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xuICAgICAgICBjb25zdCB7IGkxOG4sIGVycm9yIH0gPSB0aGlzO1xuICAgICAgICBpZiAodHlwZW9mIGVycm9yICE9PSBcInN0cmluZ1wiICYmIGlzQXBwQ29tcG9uZW50RXJyb3IoZXJyb3IpKSB7XG4gICAgICAgICAgICBjb25zdCBjb2RlID0gZXJyb3IuY29kZTtcbiAgICAgICAgICAgIGxldCBsaW5rSW5mbztcbiAgICAgICAgICAgIGlmIChjb2RlID09PSBcIml0ZW1FeGlzdHNcIiB8fCBjb2RlID09PSBcImZpbGVFeGlzdHNcIikge1xuICAgICAgICAgICAgICAgIGxpbmtJbmZvID0ge1xuICAgICAgICAgICAgICAgICAgICBsaW5rOiBlcnJvci5pdGVtVXJsLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpMThuLmFscmVhZHlFeGlzdHMubGlua1RleHRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHRpdGxlID0gaTE4bi5lcnJvclRpdGxlO1xuICAgICAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gZXJyb3IudHJhbnNsYXRlZE1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAoIWRlc2NyaXB0aW9uICYmIGNvZGUgPT09IFwiZmlsZUV4aXN0c1wiKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSBpMThuLmFscmVhZHlFeGlzdHMudGl0bGU7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSByZXBsYWNlSTE4TlN0cmluZyhpMThuLmFscmVhZHlFeGlzdHMuZGVzY3JpcHRpb24sIHRoaXMuZmlsZU5hbWUsIFwiZmlsZU5hbWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29kZSA9PT0gXCJmYWlsVG9QdWJsaXNoRnJvbURhdGFTdG9yZVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBuZXdJdGVtTW9kZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VJMThuID0gaTE4bi5mYWlsRGF0YXN0b3JlUHVibGlzaDtcbiAgICAgICAgICAgICAgICB0aXRsZSA9IGJhc2VJMThuLnRpdGxlO1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gcmVwbGFjZUkxOE5TdHJpbmcoYmFzZUkxOG4uZGVzY3JpcHRpb24sIG5ld0l0ZW1Nb2RlID09PSBcInNjZW5lTGF5ZXJcIiB8fCBuZXdJdGVtTW9kZSA9PT0gXCJ0aWxlTGF5ZXJcIiA/IGJhc2VJMThuW25ld0l0ZW1Nb2RlXSA6IFwiXCIsIFwiZmlsZVR5cGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29kZSA9PT0gXCJzZXJ2aWNlTmFtZUV4aXN0c1wiKSB7XG4gICAgICAgICAgICAgICAgKHsgdGl0bGUsIGRlc2NyaXB0aW9uIH0gPSBpMThuLnNlcnZpY2VOYW1lRXhpc3RzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlLCBkZXNjcmlwdGlvbiwgbGlua0luZm8gfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNCYWNrZW5kRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvckRldGFpbCA9IGVycm9yLmRldGFpbHNbMF07XG4gICAgICAgICAgICBpZiAoZXJyb3JEZXRhaWwgPT09IG51bGwgfHwgZXJyb3JEZXRhaWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yRGV0YWlsLmluY2x1ZGVzKFwibXVzdCBiZSB1cGxvYWRlZCBkaXJlY3RseSB0byBhbiBBcmNHSVMgU2VydmVyIHNpdGVcIikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckluZm8gPSBpMThuLmFyY2dpc1NlcnZlclVwbG9hZDtcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0aXRsZTogZXJyb3JJbmZvLnRpdGxlLCBkZXNjcmlwdGlvbjogZXJyb3JJbmZvLmRlc2NyaXB0aW9uIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlcnJvckRldGFpbC5pbmNsdWRlcyhcInNwYXRpYWwgcmVmZXJlbmNlIG11c3QgYmUgZWl0aGVyIGEgZ2VvZ3JhcGhpYyBvciBwcm9qZWN0ZWQgY29vcmRpbmF0ZSBzeXN0ZW1cIikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckluZm8gPSBpMThuLmludmFsaWRTcGF0aWFsUmVmO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiBlcnJvckluZm8udGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvckluZm8uZGVzY3JpcHRpb24gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAodHlwZW9mIGVycm9yID09PSBcInN0cmluZ1wiID8gZXJyb3IgOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgfHxcbiAgICAgICAgICAgIChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3Iuc3RhdHVzTWVzc2FnZSkgfHxcbiAgICAgICAgICAgIGkxOG4uZXJyb3JEZXNjcmlwdGlvbjtcbiAgICAgICAgaWYgKCFlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiBpMThuLmVycm9yVGl0bGUsIGRlc2NyaXB0aW9uOiBpMThuLmVycm9yRGVzY3JpcHRpb24gfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGZpbGVOYW1lLCBmaWxlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IGxvd2VyY2FzZUVycm9yTWVzc2FnZSA9IGVycm9yTWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgKF9hID0gbG93ZXJjYXNlRXJyb3JNZXNzYWdlLmluY2x1ZGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsbChsb3dlcmNhc2VFcnJvck1lc3NhZ2UsIFwiYWxyZWFkeSBleGlzdHNcIik6XG4gICAgICAgICAgICAgICAgaWYgKGxvd2VyY2FzZUVycm9yTWVzc2FnZS5pbmNsdWRlcyhcImZpbGVcIikgfHwgbG93ZXJjYXNlRXJyb3JNZXNzYWdlLmluY2x1ZGVzKFwiaXRlbVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGkxOG4uYWxyZWFkeUV4aXN0cy50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpMThuLmFscmVhZHlFeGlzdHMuZGVzY3JpcHRpb24ucmVwbGFjZShcIiR7ZmlsZU5hbWV9XCIsIGZpbGVOYW1lIHx8IChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUubmFtZSkpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJTZXJ2aWNlIG5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4uc2VydmljZU5hbWVFeGlzdHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAoX2IgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jYWxsKGVycm9yTWVzc2FnZSwgXCJHZW9Kc29uIGRvZXNuJ3QgaGF2ZSAndHlwZSdcIik6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4uaW52YWxpZEdlb0pTT047XG4gICAgICAgICAgICBjYXNlIChfYyA9IGVycm9yTWVzc2FnZS5pbmNsdWRlcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNhbGwoZXJyb3JNZXNzYWdlLCBcIkdlb0pzb24gZmlsZSBpcyBub3QgYSB2YWxpZCBqc29uXCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiBpMThuLmludmFsaWRKU09OO1xuICAgICAgICAgICAgY2FzZSAoX2QgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5jYWxsKGVycm9yTWVzc2FnZSwgXCJJbnZhbGlkIFNoYXBlZmlsZVwiKTpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi5pbnZhbGlkU2hhcGVmaWxlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaTE4bi5pbnZhbGlkU2hhcGVmaWxlLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgKF9lID0gZXJyb3JNZXNzYWdlLmluY2x1ZGVzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuY2FsbChlcnJvck1lc3NhZ2UsIFwiSW52YWxpZCBGaWxlIEdlb2RhdGFiYXNlXCIpOlxuICAgICAgICAgICAgICAgIHJldHVybiBpMThuLmludmFsaWRHZW9kYXRhYmFzZTtcbiAgICAgICAgICAgIGNhc2UgKF9mID0gZXJyb3JNZXNzYWdlLmluY2x1ZGVzKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YuY2FsbChlcnJvck1lc3NhZ2UsIFwiZXJyb3IgcHVibGlzaGluZ1wiKTpcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0aXRsZTogaTE4bi5lcnJvclRpdGxlLCBkZXNjcmlwdGlvbjogaTE4bi5lcnJvclB1Ymxpc2hpbmcgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IGkxOG4uZXJyb3JUaXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpMThuLmVycm9yRGVzY3JpcHRpb25cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRlc2NyaXB0aW9uSW5mbywgbG9hZGluZyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24sIGxpbmtJbmZvIH0gPSB0aGlzLnBhcnNlRXJyb3IoKTtcbiAgICAgICAgY29uc3QgeyBuZXdJdGVtTW9kZSwgdHlwZSwgZW5hYmxlUHVibGlzaGluZyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCB7IHVzZXIgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBjb25zdCBpc1B1Ymxpc2hlZFNlcnZpY2VEZWZpbml0aW9uID0gdHlwZSA9PT0gXCJTZXJ2aWNlIERlZmluaXRpb25cIiAmJiBlbmFibGVQdWJsaXNoaW5nO1xuICAgICAgICBjb25zdCBtdkZsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiB7IFwib3ZlcmZsb3ctaGlkZGVuXCI6IGxvYWRpbmcgfSB9LCBtdkZsb3cgJiYgbmV3SXRlbU1vZGUgPT09IFwidXJsXCIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmZvLWNvbnRhaW5lclwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0taW5wdXQtcmVhZG9ubHlcIiwgbnVsbCkpKSwgZGVzY3JpcHRpb25JbmZvICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaW5mby1jb250YWluZXJcIiB9LCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWRlc2NyaXB0aW9uXCIsIHsgY2xhc3M6IFwibGF5ZXItZGVzY3JpcHRpb25cIiwgaGVhZGVyOiBkZXNjcmlwdGlvbkluZm8udGl0bGUsIGNvbnRlbnQ6IGRlc2NyaXB0aW9uSW5mby5jb250ZW50LCBzY2FsZTogXCJzXCIsIGNvbnRlbnRTY2FsZTogXCJtXCIgfSkpKSwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiB0aGlzLmxvYWRlclR5cGUsIHZhbHVlOiBhZGRJdGVtU3RhdGUudXBsb2FkUHJvZ3Jlc3MsIGFjdGl2ZTogdGhpcy5sb2FkaW5nLCB0ZXh0OiB0aGlzLmxvYWRlck1lc3NhZ2UgfSksIFtcImZpbGVcIiwgXCJ1cmxcIiwgXCJkYXRhU3RvcmVcIl0uaW5jbHVkZXMobmV3SXRlbU1vZGUpICYmICFtdkZsb3cgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJpbmZvLWNvbnRhaW5lclwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0taW5wdXQtcmVhZG9ubHlcIiwgbnVsbCkpKSwgdHlwZSA9PT0gXCJHZW9jb2RpbmcgU2VydmljZVwiICYmIChoKFwiZGl2XCIsIG51bGwsIGgoXCJoNVwiLCB7IGNsYXNzOiBcImxvY2F0b3JfX2hlYWRpbmdcIiB9LCB0aGlzLmkxOG4uaXRlbSksIGgoXCJwXCIsIHsgY2xhc3M6IFwibG9jYXRvcl9fZGVzY3JpcHRpb25cIiB9LCB1aVN0b3JlU3RhdGUuaTE4bi5jcmVhdGVMYXllcnNMaXN0W25ld0l0ZW1Nb2RlID09PSBcInVybFwiID8gXCJsb2NhdG9ySGVhZGluZ1wiIDogXCJsb2NhdG9yVmlld0hlYWRpbmdcIl0pKSksIGgoXCJhcmNnaXMtaXRlbS1wcm9wZXJ0aWVzXCIsIG51bGwsICFpc1B1Ymxpc2hlZFNlcnZpY2VEZWZpbml0aW9uICYmIChoKFwiYXJjZ2lzLXRpdGxlLWlucHV0XCIsIHsgY2xhc3M6IFwibWVkaXVtXCIsIGN1cnJlbnRGb2xkZXI6IGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyLCB0eXBlOiBhZGRJdGVtU3RhdGUudHlwZSwgZW5hYmxlUHVibGlzaGluZzogYWRkSXRlbVN0YXRlLmVuYWJsZVB1Ymxpc2hpbmcsIHVwZGF0ZTogdGhpcy5zaG91bGRVcGRhdGVQcmV2aW91c2x5Q3JlYXRlZEl0ZW0oKSwgcmVmOiAoZWxlKSA9PiAodGhpcy50aXRsZVJlZiA9IGVsZSksIG9uQXJjZ2lzVGl0bGVJbnB1dENoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgfSB9KSksIGgoXCJhcmNnaXMtZm9sZGVyLXBpY2tlclwiLCB7IGNsYXNzOiBcIm1lZGl1bVwiLCByZWY6IChlbGUpID0+ICh0aGlzLml0ZW1Qcm9wZXJ0aWVzRm9sZGVyUmVmID0gZWxlKSwgb25BcmNnaXNGb2xkZXJQaWNrZXJMb2FkOiAoeyBkZXRhaWwgfSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAoX2EgPSBhZGRJdGVtU3RhdGUuaW5pdGlhbEZvbGRlcnMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChhZGRJdGVtU3RhdGUuaW5pdGlhbEZvbGRlcnMgPSBkZXRhaWwpO1xuICAgICAgICAgICAgfSB9KSwgIWlzUHVibGljVXNlcih1c2VyKSAmJiBoKFwiYXJjZ2lzLWNhdGVnb3JpZXMtcGlja2VyXCIsIHsgY2xhc3M6IFwibWVkaXVtXCIgfSksIGgoXCJhcmNnaXMtdGFncy1waWNrZXJcIiwgeyBjbGFzczogXCJtZWRpdW1cIiB9KSwgaChcImFyY2dpcy1zdW1tYXJ5LWlucHV0XCIsIHsgY2xhc3M6IFwibWVkaXVtXCIsIHJlZjogKGVsZSkgPT4gKHRoaXMuc3VtbWFyeVJlZiA9IGVsZSkgfSksIHR5cGUgPT09IFwiTm90ZWJvb2tcIiAmJiBoKFwiYXJjZ2lzLW5vdGVib29rLXJ1bnRpbWUtc2VsZWN0XCIsIHsgY2xhc3M6IFwibWVkaXVtXCIgfSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogdGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwgYWN0aXZlOiAhIXRoaXMuZXJyb3IsIGxpbms6IHsgaHJlZjogbGlua0luZm8gPT09IG51bGwgfHwgbGlua0luZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxpbmtJbmZvLmxpbmssIHRpdGxlOiBsaW5rSW5mbyA9PT0gbnVsbCB8fCBsaW5rSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGlua0luZm8udGV4dCB9LCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9KSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJlcnJvclwiOiBbXCJoYW5kbGVFcnJvclwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNJdGVtUHJvcGVydGllcy5zdHlsZSA9IGFyY2dpc05ld0l0ZW1QYWdlc0l0ZW1Qcm9wZXJ0aWVzQ3NzO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0Q3NzID0gXCIubGFiZWx7bWFyZ2luLWJvdHRvbToxcmVtO2Rpc3BsYXk6YmxvY2s7cGFkZGluZy10b3A6MXJlbTtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtsaW5lLWhlaWdodDoxOHB4fS5sYWJlbC0tbGVhZGVye21hcmdpbi10b3A6MC43NXJlbTttYXJnaW4tYm90dG9tOjAuNXJlbTtmb250LXdlaWdodDo0MDB9LmZpZWxkc2V0e21hcmdpbjowcHg7Ym9yZGVyLXN0eWxlOm5vbmU7cGFkZGluZzowcHh9LmNvbnN0cmFpbnttYXgtd2lkdGg6MzYwcHh9Lm5vdGljZS0tdGlwe21hcmdpbi10b3A6MS41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVByZXZQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtUHJldlBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5jYW5Ta2lwUHVibGlzaFNlbGVjdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkU2hlZXQgPSBhc3luYyAoeyBjdXJyZW50VGFyZ2V0IH0pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE86IGNhbGNpdGUtc2VsZWN0IGN1cnJlbnRseSBzZXRzIHNlbGVjdGVkT3B0aW9uIHRvIHRoZSBpbm5lckhUTUwgb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW5zdGVhZCBvZiBpdHMgdmFsdWVcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gcGFyc2VJbnQoY3VycmVudFRhcmdldC5zZWxlY3RlZE9wdGlvbi52YWx1ZSk7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRTaGVldCA9IGlzTmFOKHNlbGVjdGVkKSA/IDAgOiBzZWxlY3RlZDtcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQoZmFsc2UpO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzID0gbnVsbDtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cyA9IG51bGw7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuYmFja3VwTGF5ZXJGaWVsZHMgPSBudWxsO1xuICAgICAgICAgICAgLy8gRm9yIGNsb3VkLCB3ZSBhbHNvIHVwbG9hZCB0aGUgZmlsZSBhbHJlYWR5IGF0IHRoZSBiZWdpbm5pbmdcbiAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLmFuYWx5emUoYWRkSXRlbVN0YXRlLmV4aXN0aW5nSXRlbSB8fCBhZGRJdGVtU3RhdGUuY2xvdWRQcm92aWRlclJlc291cmNlID8gXCJpdGVtXCIgOiBcImZpbGVcIik7XG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBzaG91bGQgd2UgcmV2ZXJ0IHRoZSBjaGFuZ2U/XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWQuZW1pdCh0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kZWxldGVDdXJJdGVtID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoYWRkSXRlbVN0YXRlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNEZWxldGluZ09sZEZpbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxldGVJdGVtKGFkZEl0ZW1TdGF0ZS5pZCwgeyBwZXJtYW5lbnREZWxldGU6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5pZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNEZWxldGluZ09sZEZpbGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJEZWxldGUgaXRlbSBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gXCJob3N0ZWRcIjtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzRGVsZXRpbmdPbGRGaWxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRlclR5cGUgPSBcImluZGV0ZXJtaW5hdGVcIjtcbiAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudGlwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHVibGlzaFNlbGVjdE9wdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pdGVtSW5mb0kxOE4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZHVwbGljYXRlSXRlbVVybCA9IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgICAgIGlmIChhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUgPT09IFwiM2RUaWxlc1wiKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUudGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGUgPSB0aGlzLnB1Ymxpc2hTZWxlY3RPcHRpb24udGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBjdXN0b21QYXJhbWV0ZXJzLCB1cmwsIHR5cGUsIG5ld0l0ZW1Nb2RlLCBmaWxlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IGlzSG9zdGVkID0gdGhpcy5zZWxlY3RlZCA9PT0gXCJob3N0ZWRcIjtcbiAgICAgICAgY29uc3QgbXZGbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZW5hYmxlUHVibGlzaGluZyA9IGlzSG9zdGVkO1xuICAgICAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgIHVybDogZW5jb2RlVVJJKHVybCksXG4gICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1ldGVyc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0l0ZW1Nb2RlID09PSBcInVybFwiICYmIHR5cGUgPT09IFwiQ1NWXCIgJiYgbXZGbG93KSB7XG4gICAgICAgICAgICAvLyBSaWdodCBub3cgd2Ugb25seSBzdXBwb3J0IHRoaXMgZm9yIGNzdlxuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZShcInVybFwiKTtcbiAgICAgICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmR1cGxpY2F0ZUl0ZW1VcmwgJiYgaXNIb3N0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHsgY29kZTogXCJpdGVtRXhpc3RzXCIsIGl0ZW1Vcmw6IHRoaXMuZHVwbGljYXRlSXRlbVVybCB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzaW1wbGVIb3N0ZWRUeXBlcyA9IFtcbiAgICAgICAgICAgICAgICBcIkpzb25cIixcbiAgICAgICAgICAgICAgICBcIlRpbGUgUGFja2FnZVwiLFxuICAgICAgICAgICAgICAgIFwiVmVjdG9yIFRpbGUgUGFja2FnZVwiLFxuICAgICAgICAgICAgICAgIFwiU2VydmljZSBEZWZpbml0aW9uXCIsXG4gICAgICAgICAgICAgICAgXCJTY2VuZSBQYWNrYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJHZW9QYWNrYWdlXCIsXG4gICAgICAgICAgICAgICAgXCIzRFRpbGVzIFBhY2thZ2VcIixcbiAgICAgICAgICAgICAgICAvLyBhcmNnaXMtcG9ydGFsLWFwcCM0MDkyOSBhbmQgYXJjZ2lzLXBvcnRhbC1hcHAjMzgxMTlcbiAgICAgICAgICAgICAgICBcIkdlb0pzb25cIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZXZlbnRUeXBlOiBcIm90aGVyXCIsXG4gICAgICAgICAgICAgICAgcGFnZU5hbWU6IFwibXkgY29udGVudFwiLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcIm5ldyBpdGVtIGFkZCBjc3YgZmlsZVwiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHNpbXBsZUhvc3RlZFR5cGVzLmluZGV4T2YodHlwZSkgPiAtMSB8fFxuICAgICAgICAgICAgICAgIC8vIFdlIHN0aWxsIHdhbnQgdG8gYW5hbHl6ZSBldmVuIGlmIGl0J3MgYWRkIGRpcmVjdFxuICAgICAgICAgICAgICAgICghaXNIb3N0ZWQgJiYgIW12RmxvdykpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBMb2cgdGVsZW1ldHJ5IGZvciBub24taG9zdGVkIGNzdlxuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkLmRldGFpbHMgPSBcImNzdiBvbmx5XCI7XG4gICAgICAgICAgICAgICAgICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5sb2dFdmVudChwYXlsb2FkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiQ1NWXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5hbmFseXplKCEhYWRkSXRlbVN0YXRlLmNsb3VkUHJvdmlkZXJSZXNvdXJjZSA/IFwiY2xvdWRcIiA6IGZpbGUgPyBcImZpbGVcIiA6IFwidXJsXCIpO1xuICAgICAgICAgICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gT24gc3VjY2Vzc2Z1bCB1cGxvYWQsIGxvZyBob3N0ZWQgY3N2IHRlbGVtZXRyeVxuICAgICAgICAgICAgcGF5bG9hZC5kZXRhaWxzID0gXCJjc3YgYW5kIGhvc3RlZCBmZWF0dXJlIGxheWVyXCI7XG4gICAgICAgICAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkubG9nRXZlbnQocGF5bG9hZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiZmlsZUZpZWxkXCIpO1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVQcmV2KGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlQ3VySXRlbSgpO1xuICAgICAgICBjb25zdCB7IHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiQ1NWXCIgfHwgdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIikge1xuICAgICAgICAgICAgLy8gSW4gY2FzZSB0aGUgdXNlciBnb2VzIGJhY2sgdG8gdGhlIGZpbGUgc2VsZWN0IHBhZ2VcbiAgICAgICAgICAgIC8vICBhbmQgc2VsZWN0IGEgZGlmZmVyZW50IGZpbGVcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZEZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgfVxuICAgIGRldGVybWluZUhpbnQoZmlsZSkge1xuICAgICAgICBpZiAoIWlzTGFyZ2VHZW9KU09OKGZpbGUuc2l6ZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgbGlua1RleHQgPSB1aVN0b3JlU3RhdGUuaTE4bi5jb21tb24ubGVhcm5Nb3JlO1xuICAgICAgICBsZXQgdGl0bGU7XG4gICAgICAgIGxldCBsaW5rOyAvLyBUT0RPOiBzZXQgbGluayB1cmwgb25jZSB3ZSBoYXZlIHRoZSBoZWxwIGlkXG4gICAgICAgIGxldCBjb2xvciA9IFwiYnJhbmRcIjtcbiAgICAgICAgaWYgKCF1c2VyIHx8IGlzUHVibGljVXNlcih1c2VyKSkge1xuICAgICAgICAgICAgdGl0bGUgPSBpMThuLmJpZ0dlb0pzb25IaW50UHVibGljQWNjb3VudDtcbiAgICAgICAgICAgIGNvbG9yID0gXCJkYW5nZXJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghY2FuUHVibGlzaFR5cGUodXNlciwgXCJHZW9Kc29uXCIsIHBvcnRhbCkpIHtcbiAgICAgICAgICAgIHRpdGxlID0gaTE4bi5iaWdHZW9Kc29uSGludE5vUHJpdmlsZWdlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGl0bGUgPSBpMThuLmJpZ0dlb0pzb25IaW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWxlcnRDb250ZW50ID0geyB0aXRsZSwgbGlua1RleHQsIGxpbmssIGNvbG9yIH07XG4gICAgfVxuICAgIHNob3VsZERpc2FibGVOb25Ib3N0ZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgZmlsZSwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICByZXR1cm4gKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiAmJiB0eXBlID09PSBcIkdlb0pzb25cIiAmJiBmaWxlICYmIGlzTGFyZ2VHZW9KU09OKGZpbGUuc2l6ZSkpO1xuICAgIH1cbiAgICB1cGRhdGVMb2FkZXIobG9hZGVyVHlwZSwgbG9hZGVyTWVzc2FnZSkge1xuICAgICAgICB0aGlzLmxvYWRlclR5cGUgPSBsb2FkZXJUeXBlO1xuICAgICAgICB0aGlzLmxvYWRlck1lc3NhZ2UgPSBsb2FkZXJNZXNzYWdlO1xuICAgIH1cbiAgICBhc3luYyBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLnB1Ymxpc2hTZWxlY3Q7XG4gICAgICAgIHRoaXMuaXRlbUluZm9JMThOID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVR5cGVJbmZvO1xuICAgICAgICBjb25zdCB7IHR5cGUsIGlkLCBleGlzdGluZ0l0ZW0sIG5ld0l0ZW1Nb2RlLCBjbG91ZFByb3ZpZGVyUmVzb3VyY2UsIGZpbGUsIHRpbGVMYXllclB1Ymxpc2hUeXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsLCBjb25maWc6IHsgaGVscE1hcCwgaGVscEJhc2UgfSB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBjb25zdCB7IGVycm9yOiBiYWNrZWRCeVNEU0Vycm9yLCByZXN1bHQ6IF9pc1BvcnRhbEJhY2tlZEJ5U0RTIH0gPSBhd2FpdCBmcm9tQ2FjaGUoKCkgPT4gaXNQb3J0YWxCYWNrZWRCeVNEUyhwb3J0YWwsIHVzZXIpLCBcImlzUG9ydGFsQmFja2VkQnlTRFNcIiwgcG9ydGFsLmlkKTtcbiAgICAgICAgICAgIGlmICghYmFja2VkQnlTRFNFcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgLSB3ZSBuZWVkIHRvIGZpZ3VyZSBvdXQgYSBiZXR0ZXIgd2F5IHRvIGRvIHRoaXMgc28gd2UncmUgbm90IG1vZGlmeWluZyB0aGUgdXNlcidzIHBvcnRhbFxuICAgICAgICAgICAgICAgIGNvbmZpZ1N0YXRlLnBvcnRhbC5pc0JhY2tlZEJ5U0RTID0gX2lzUG9ydGFsQmFja2VkQnlTRFM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbXZGbG93ID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgICAgICBjb25zdCBpc0V4Y2VsID0gdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIjtcbiAgICAgICAgaWYgKGV4aXN0aW5nSXRlbSkge1xuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZShcIml0ZW1cIik7XG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJDU1ZcIiB8fFxuICAgICAgICAgICAgICAgIChpc0V4Y2VsICYmICgoX2EgPSBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHMucHVibGlzaFBhcmFtZXRlcnMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA9PT0gMSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJmaWxlRmllbGRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEFuYWx5emUgdG8gZ2V0IEV4Y2VsIHNoZWV0IGluZm9cbiAgICAgICAgaWYgKGlzRXhjZWwgJiYgIWlzUHVibGljVXNlcih1c2VyKSAmJiAhZXhpc3RpbmdJdGVtKSB7XG4gICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNlbGVjdGVkU2hlZXQgPSAwO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYW5hbHl6ZShjbG91ZFByb3ZpZGVyUmVzb3VyY2UgPyBcImNsb3VkXCIgOiBcImZpbGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFuYWx5emUoXCJpdGVtXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChtdkZsb3cpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPVxuICAgICAgICAgICAgICAgIChuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiB8fCAhY2FuUHVibGlzaFR5cGUodXNlciwgdHlwZSwgcG9ydGFsKSkgJiZcbiAgICAgICAgICAgICAgICAgICAgIXRoaXMuc2hvdWxkRGlzYWJsZU5vbkhvc3RlZCgpXG4gICAgICAgICAgICAgICAgICAgID8gXCJub24taG9zdGVkXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcImhvc3RlZFwiO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJhZGRUb01hcFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEFkZCB0byBNVjogTWFuYWdlIHVwbG9hZCBoZXJlIHdoZW4gYWRkaW5nIGZpbGUgZGlyZWN0bHlcbiAgICAgICAgdGhpcy5jYW5Ta2lwUHVibGlzaFNlbGVjdCA9IGNhblNraXBQdWJsaXNoU2VsZWN0VG9OZXh0UGFnZSh7XG4gICAgICAgICAgICBkaXJlY3RNb2RlOiBtdkZsb3csXG4gICAgICAgICAgICBpc011bHRpcGFnZUV4Y2VsOiBpc0V4Y2VsICYmICgoX2IgPSBhZGRJdGVtU3RhdGUuZXhjZWxMYXllcnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpID4gMSxcbiAgICAgICAgICAgIG5ld0l0ZW1Nb2RlLFxuICAgICAgICAgICAgY2xvdWQ6ICEhY2xvdWRQcm92aWRlclJlc291cmNlLFxuICAgICAgICAgICAgZnJvbUV4aXN0aW5nSXRlbTogISFleGlzdGluZ0l0ZW0sXG4gICAgICAgICAgICBpdGVtVHlwZTogdHlwZSxcbiAgICAgICAgICAgIGNhblB1Ymxpc2hJdGVtVHlwZTogY2FuUHVibGlzaFR5cGUodXNlciwgdHlwZSwgcG9ydGFsKVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuY2FuU2tpcFB1Ymxpc2hTZWxlY3QpIHtcbiAgICAgICAgICAgIGlmIChuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIikge1xuICAgICAgICAgICAgICAgIC8vIE9ubHkgYWRkaW5nIGZyb20gVVJMIGNhbiBiZSBhZGRlZCBkaXJlY3RseVxuICAgICAgICAgICAgICAgIC8vICBzaW5jZSBmcm9tLWZpbGUgZmxvd3MgcmVsaWVzIG9uIHRoZSBwdWJsaXNoZWQgaXRlbSBpZFxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBcIm5vbi1ob3N0ZWRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSB8fCAhdXNlcikge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IFwibm9uLWhvc3RlZFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSBcIlNjZW5lIFBhY2thZ2VcIiAmJiAhY2FuUHVibGlzaFNjZW5lcyh1c2VyKSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IFwibm9uLWhvc3RlZFwiO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVOZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUgPT09IFwiR2VvSnNvblwiICYmIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIikge1xuICAgICAgICAgICAgaWYgKCEhZmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGV0ZXJtaW5lSGludChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCEhYWRkSXRlbVN0YXRlLnVybCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGlwID0ge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5pMThuLmxhcmdlR2VvSnNvbkNvbmRpdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBsaW5rVGV4dDogdWlTdG9yZVN0YXRlLmkxOG4uY29tbW9uLmxlYXJuTW9yZSxcbiAgICAgICAgICAgICAgICAgICAgbGluazogYCR7aGVscEJhc2V9JHtoZWxwTWFwW1wiMTIwMDAzOTIzXCJdfWBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aWxlTGF5ZXJQdWJsaXNoVHlwZSA9PT0gXCIzZFRpbGVzXCIpIHtcbiAgICAgICAgICAgIHRoaXMucHVibGlzaFNlbGVjdE9wdGlvbiA9IHtcbiAgICAgICAgICAgICAgICB0aWxlTGF5ZXJQdWJsaXNoVHlwZSxcbiAgICAgICAgICAgICAgICB0aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZTogKF9jID0gYWRkSXRlbVN0YXRlLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBERUZBVUxUX1RJTEVfTEFZRVJfM0RfVElMRVNfTEFZRVJfVFlQRVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG5ld0l0ZW1Nb2RlLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHJldHVybiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmXG4gICAgICAgICAgICBuZXdJdGVtTW9kZSA9PT0gXCJ1cmxcIiAmJlxuICAgICAgICAgICAgdHlwZSA9PT0gXCJHZW9Kc29uXCIgJiZcbiAgICAgICAgICAgIHNlbGVjdGVkID09PSBcIm5vbi1ob3N0ZWRcIik7XG4gICAgfVxuICAgIGFzeW5jIGFuYWx5emUoYW5hbHl6ZVR5cGUsIGZvcmNlQ3JlYXRlSXRlbSA9IGZhbHNlKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBmaWxlTmFtZSwgZmlsZSwgdXJsLCBkYXRhVXJsLCBpZDogaXRlbWlkLCBleHRlbnNpb24sIHR5cGUgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIHRoaXMudXBkYXRlTG9hZGVyKFwiaW5kZXRlcm1pbmF0ZVwiLCB0aGlzLmkxOG4uYW5hbHl6ZS5yZXBsYWNlKFwiJHtmaWxlTmFtZX1cIiwgZmlsZU5hbWUubGVuZ3RoID4gMCA/IGZpbGVOYW1lIDogdXJsKSk7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIGNvbnN0IGZyb21DbG91ZCA9IGFuYWx5emVUeXBlID09PSBcImNsb3VkXCI7XG4gICAgICAgIGxldCBlcnJvciA9IG51bGw7XG4gICAgICAgIGlmIChmcm9tQ2xvdWQgfHwgKHR5cGUgPT09IFwiQ1NWXCIgJiYgZmlsZSAmJiBpc0xhcmdlQ1NWKGZpbGUuc2l6ZSkpIHx8IGZvcmNlQ3JlYXRlSXRlbSkge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdJdGVtVXJsID0gYXdhaXQgc2VhcmNoRm9yRXhpc3RpbmdJdGVtVXJsQnlOYW1lKGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSwgKF9hID0gZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24oZXh0ZW5zaW9uKVswXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnR5cGUpO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nSXRlbVVybCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcIml0ZW1FeGlzdHNcIiwgaXRlbVVybDogZXhpc3RpbmdJdGVtVXJsIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICEgVGhpcyBpcyBhIHdvcmsgYXJvdW5kIHNpbmNlIGFuYWx5emUgZG9lc24ndCB3b3JrIHdpdGggc291cmNlVXJsIGZvciBjbG91ZCBpdGVtcyB5ZXRcbiAgICAgICAgICAgIC8vIEFsc28gYW5hbHl6ZSB3aWxsIHRpbWVvdXQgZm9yIGJpZyBjc3YgaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yODc1XG4gICAgICAgICAgICBpZiAoIWFkZEl0ZW1TdGF0ZS5pZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld05hbWUgPSBndWlkKCk7XG4gICAgICAgICAgICAgICAgaWYgKChmaWxlID09PSBudWxsIHx8IGZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbGUuc2l6ZSkgPiBNVUxUSV9QQVJUX1VQTE9BRF9NSU5JTVVNX1NJWkUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoXCJkZXRlcm1pbmF0ZVwiLCB0aGlzLmkxOG4udXBsb2FkaW5nLnJlcGxhY2UoXCIke2l0ZW19XCIsIGZpbGVOYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGFkZFJlc3BvbnNlID0gYXdhaXQgKGZyb21DbG91ZCA/IGFkZEZpbGVGcm9tRGF0YVVybCA6IGFkZEZpbGUpKHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG5ld05hbWUsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBuZXdOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMb2FkZXIoXCJpbmRldGVybWluYXRlXCIsIHRoaXMuaTE4bi5hbmFseXplLnJlcGxhY2UoXCIke2ZpbGVOYW1lfVwiLCBmaWxlTmFtZS5sZW5ndGggPiAwID8gZmlsZU5hbWUgOiB1cmwpKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBjaGVja0pvYlN0YXR1cyhhZGRSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1pZCA9IGFkZFJlc3BvbnNlLmlkO1xuICAgICAgICAgICAgICAgICh7IGVycm9yIH0gPSBhd2FpdCBhbmFseXplKHtcbiAgICAgICAgICAgICAgICAgICAgYW5hbHl6ZUFyZ3M6IHsgdHlwZTogXCJpdGVtXCIsIGl0ZW1pZCB9LFxuICAgICAgICAgICAgICAgICAgICBjb25maWdBcmdzOiB7IHBvcnRhbCwgdXNlciwgY29uZmlnLCBsYW5nIH0sXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemU6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgZGVsZXRlIGluIGNhc2UgdGhlIHVzZXIgZ28gYmFjayBhbmQgZm9ydGhcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuaWQgPSBpdGVtaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAoeyBlcnJvciB9ID0gYXdhaXQgYW5hbHl6ZSh7XG4gICAgICAgICAgICAgICAgYW5hbHl6ZUFyZ3M6IGFuYWx5emVUeXBlID09PSBcInVybFwiXG4gICAgICAgICAgICAgICAgICAgID8geyB0eXBlOiBcInVybFwiLCBzb3VyY2VVcmw6IHVybCAhPT0gbnVsbCAmJiB1cmwgIT09IHZvaWQgMCA/IHVybCA6IGRhdGFVcmwgfVxuICAgICAgICAgICAgICAgICAgICA6IGFuYWx5emVUeXBlID09PSBcImZpbGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB7IHR5cGU6IFwiZmlsZVwiLCBmaWxlIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogeyB0eXBlOiBcIml0ZW1cIiwgaXRlbWlkIH0sXG4gICAgICAgICAgICAgICAgY29uZmlnQXJnczogeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9LFxuICAgICAgICAgICAgICAgIGl0ZW1BcmdzOiB7IGl0ZW1UeXBlOiB0eXBlIH0sXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogdHJ1ZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IFwidGltZW91dFwiKSB7XG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yODc1XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZShhbmFseXplVHlwZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICFlcnJvcjtcbiAgICB9XG4gICAgaGFuZGxlRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmR1cGxpY2F0ZUl0ZW1VcmwgPSBudWxsO1xuICAgICAgICB0aGlzLmFsZXJ0Q29udGVudCA9IG51bGw7XG4gICAgICAgIHN3aXRjaCAoZXJyb3IuY29kZSkge1xuICAgICAgICAgICAgY2FzZSBcIml0ZW1FeGlzdHNcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmR1cGxpY2F0ZUl0ZW1VcmwgPSBlcnJvci5pdGVtVXJsO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYWRkSXRlbVN0YXRlLmZpbGVOYW1lO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRDb250ZW50ID0ge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi5lcnJvci5hbHJlYWR5RXhpc3RzLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaTE4bi5lcnJvci5hbHJlYWR5RXhpc3RzLmRlc2NpcHRpb24ucmVwbGFjZShcIiR7ZmlsZU5hbWV9XCIsIGZpbGVOYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgbGluazogZXJyb3IuaXRlbVVybCxcbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQ6IGkxOG4uZXJyb3IuYWxyZWFkeUV4aXN0cy5saW5rVGV4dFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZW1wdHlGaWxlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSB7IHRpdGxlOiBpMThuLmVycm9yLnRpdGxlLCBkZXNjcmlwdGlvbjogaTE4bi5lcnJvci5lbXB0eUZpbGUgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkdXBsaWNhdGVGaWVsZE5hbWVzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSBpMThuLmVycm9yLmR1cGxpY2F0ZUZpZWxkcztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydENvbnRlbnQgPSBpMThuLmVycm9yO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldERpc3BsYXlUeXBlKHR5cGUsIGV4dGVuc2lvbikge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgbGV0IGkxOG5LZXkgPSB0eXBlO1xuICAgICAgICBpZiAoKChfYSA9IGFkZEl0ZW1TdGF0ZS5jbG91ZFByb3ZpZGVyUmVzb3VyY2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5taW1lVHlwZSkgPT09IFwiZ29vZ2xlc2hlZXRzXCIpIHtcbiAgICAgICAgICAgIGkxOG5LZXkgPSBcIkdvb2dsZSBTaGVldHNcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChleHRlbnNpb24gPT09IFwianNvblwiKSB7XG4gICAgICAgICAgICBpMThuS2V5ID0gXCJKU09OXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChfYyA9IChfYiA9IHRoaXMuaXRlbUluZm9JMThOLmxvd2VyY2FzZURpc3BsYXlOYW1lW2kxOG5LZXldKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBpMThuS2V5KSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBcIlwiO1xuICAgIH1cbiAgICBnZXRPcHRpb25UZXh0KHJhZGlvLCBkaXNwbGF5TmFtZSkge1xuICAgICAgICBjb25zdCBpc0hvc3RlZCA9IHJhZGlvID09PSBcImhvc3RlZFwiO1xuICAgICAgICBjb25zdCB7IGkxOG4sIGl0ZW1JbmZvSTE4TiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBkYXRhVXJsLCBmaWxlTmFtZSwgdHlwZSB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCBtdkZsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCI7XG4gICAgICAgIGlmIChtdkZsb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBpc0hvc3RlZFxuICAgICAgICAgICAgICAgID8geyB0aXRsZTogaTE4bi5ob3N0ZWRNVlRpdGxlLCBkZXNjcmlwdGlvbjogaTE4bi5ob3N0ZWRNVkRlc2NyaXB0aW9uIH1cbiAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhdGFVcmwgPyBpMThuLmFkZERpcmVjdGx5VXJsVGl0bGUgOiBpMThuLmFkZERpcmVjdGx5VGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhVXJsID8gaTE4bi5hZGREaXJlY3RseVVybERlc2NyaXB0aW9uIDogaTE4bi5hZGREaXJlY3RseURlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlzcGxheU5hbWUgPT09IFwiR2VvSlNPTlwiICYmICEhZGF0YVVybCkge1xuICAgICAgICAgICAgcmV0dXJuIGkxOG4uZ2VvSlNPTkZyb21VUkxbaXNIb3N0ZWQgPyBcImhvc3RlZFwiIDogXCJub25Ib3N0ZWRcIl07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGl0bGUgPSByZXBsYWNlSTE4TlN0cmluZyhpc0hvc3RlZFxuICAgICAgICAgICAgPyBpMThuLmhvc3RlZFRpdGxlW212RmxvdyAmJiB0eXBlID09PSBcIkNTVlwiID8gXCJDU1ZOb1RhYmxlXCIgOiBkaXNwbGF5TmFtZV0gfHxcbiAgICAgICAgICAgICAgICBpMThuLmhvc3RlZFRpdGxlW3R5cGVdXG4gICAgICAgICAgICA6IGl0ZW1JbmZvSTE4Ti5ub25Ib3N0ZWRUaXRsZSwgZmlsZU5hbWUsIFwiZmlsZU5hbWVcIik7XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gcmVwbGFjZUkxOE5TdHJpbmcoaXNIb3N0ZWRcbiAgICAgICAgICAgID8gLy8gVE9ETzogZml4IGNhc2luZyBpbiB0aGUgXCJ0aWxlIHBhY2thZ2VcIiBhbmQgXCJ2ZWN0b3IgdGlsZSBwYWNrYWdlXCIgaG9zdGVkIGRlc2NyaXB0aW9uIGtleXMgaW4gdGhlIGkxOG4gZmlsZSBhZnRlciBzdHJpbmcgZnJlZXplIGlzIGxpZnRlZFxuICAgICAgICAgICAgICAgIC8vIFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzOTg2N1xuICAgICAgICAgICAgICAgIGkxOG4uaG9zdGVkRGVzY3JpcHRpb25bZGlzcGxheU5hbWVdIHx8XG4gICAgICAgICAgICAgICAgICAgIGkxOG4uaG9zdGVkRGVzY3JpcHRpb25bZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKV0gfHxcbiAgICAgICAgICAgICAgICAgICAgaTE4bi5ob3N0ZWREZXNjcmlwdGlvblt0eXBlXSB8fFxuICAgICAgICAgICAgICAgICAgICBpMThuLmhvc3RlZERlc2NyaXB0aW9uW3R5cGUudG9Mb3dlckNhc2UoKV1cbiAgICAgICAgICAgIDogaXRlbUluZm9JMThOLm5vbkhvc3RlZERlc2NyaXB0aW9uLCBkaXNwbGF5TmFtZSwgXCJmaWxlVHlwZVwiKTtcbiAgICAgICAgcmV0dXJuIHsgdGl0bGUsIGRlc2NyaXB0aW9uIH07XG4gICAgfVxuICAgIHJlbmRlck9wdGlvbihyYWRpbywgZGlzcGxheU5hbWUpIHtcbiAgICAgICAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24gfSA9IHRoaXMuZ2V0T3B0aW9uVGV4dChyYWRpbywgZGlzcGxheU5hbWUpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0XCIsIHsgY2hlY2tlZDogcmFkaW8gPT09IHRoaXMuc2VsZWN0ZWQsIG9uQ2FsY2l0ZVRpbGVTZWxlY3RDaGFuZ2U6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpID8gXCJhZGRUb01hcFwiIDogXCJuZXh0XCI7XG4gICAgICAgICAgICB9LCBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sIGhlYWRpbmc6IHRpdGxlLCBuYW1lOiBkZXNjcmlwdGlvbiwgXCJpbnB1dC1lbmFibGVkXCI6IHRydWUsIFwiaW5wdXQtYWxpZ25tZW50XCI6IFwic3RhcnRcIiwgdHlwZTogXCJyYWRpb1wiLCB2YWx1ZTogcmFkaW8sIHdpZHRoOiBcImZ1bGxcIiwgaWQ6IGAke3JhZGlvfS1pbnB1dC1vcHRpb25gLCBkaXNhYmxlZDogcmFkaW8gPT09IFwibm9uLWhvc3RlZFwiICYmIHRoaXMuc2hvdWxkRGlzYWJsZU5vbkhvc3RlZCgpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyU2hlZXRTZWxlY3QoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBleGNlbExheWVycyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBpZiAoIWV4Y2VsTGF5ZXJzIHx8IGV4Y2VsTGF5ZXJzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS1sZWFkZXJcIiB9LCB0aGlzLmkxOG4ucHVibGlzaFRoaXNTaGVldCksIGgoXCJjYWxjaXRlLXNlbGVjdFwiLCB7IGxhYmVsOiBcIlwiLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IHRoaXMudXBkYXRlU2VsZWN0ZWRTaGVldC5iaW5kKHRoaXMpLCB2YWx1ZTogKF9hID0gU3RyaW5nKGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFNoZWV0KSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCIwXCIsIGNsYXNzOiBcImNvbnN0cmFpblwiIH0sIGV4Y2VsTGF5ZXJzLm1hcCgobGF5ZXIsIGkpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogaSwgc2VsZWN0ZWQ6IGkgPT09IGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFNoZWV0IH0sIGxheWVyLm5hbWUpKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlcjNkVGlsZXNTZWxlY3QoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgcHVibGlzaFNlbGVjdE9wdGlvbiB9ID0gdGhpcztcbiAgICAgICAgaWYgKChwdWJsaXNoU2VsZWN0T3B0aW9uID09PSBudWxsIHx8IHB1Ymxpc2hTZWxlY3RPcHRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hTZWxlY3RPcHRpb24udGlsZUxheWVyUHVibGlzaFR5cGUpICE9PSBcIjNkVGlsZXNcIikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB0aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZSB9ID0gcHVibGlzaFNlbGVjdE9wdGlvbjtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImxhYmVsIGxhYmVsLS1sZWFkZXJcIiB9LCBpMThuW1wiM2RUaWxlc1wiXS5sYXllclR5cGUpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogXCJcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoeyBjdXJyZW50VGFyZ2V0IH0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGN1cnJlbnRUYXJnZXQuc2VsZWN0ZWRPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgLnZhbHVlO1xuICAgICAgICAgICAgICAgIHB1Ymxpc2hTZWxlY3RPcHRpb24udGlsZXNMYXllcjNkVGlsZXNMYXllclR5cGUgPSBzZWxlY3RlZDtcbiAgICAgICAgICAgIH0sIHZhbHVlOiBwdWJsaXNoU2VsZWN0T3B0aW9uLnRpbGVzTGF5ZXIzZFRpbGVzTGF5ZXJUeXBlLCBjbGFzczogXCJjb25zdHJhaW5cIiB9LCB0aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZXMubWFwKChsYXllclR5cGUpID0+IChoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogbGF5ZXJUeXBlLCBzZWxlY3RlZDogbGF5ZXJUeXBlID09PSB0aWxlc0xheWVyM2RUaWxlc0xheWVyVHlwZSB9LCBsYXllclR5cGUgPT09IFwiM0RPYmplY3RcIiA/IFwiM0Qgb2JqZWN0c1wiIDogXCJJbnRlZ3JhdGVkIG1lc2hcIikpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGV4dGVuc2lvbiwgdHlwZSwgZXhpc3RpbmdJdGVtIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSB0aGlzLmdldERpc3BsYXlUeXBlKGFkZEl0ZW1TdGF0ZS50eXBlLCBleHRlbnNpb24pO1xuICAgICAgICBjb25zdCB7IGxvYWRlclR5cGUsIGl0ZW1JbmZvSTE4TiwgbG9hZGluZywgbG9hZGVyTWVzc2FnZSwgc2VsZWN0ZWQsIGFsZXJ0Q29udGVudCwgaXNEZWxldGluZ09sZEZpbGUsIHRpcCwgY2FuU2tpcFB1Ymxpc2hTZWxlY3QgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IG12RmxvdyA9IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIjtcbiAgICAgICAgLy8gQWRkIHRvIE1WOiBoaWRlIGhvc3RlZCBzZWxlY3QgaWYgaXRlbSBpcyBiZWluZyBhZGRlZCBkaXJlY3RseVxuICAgICAgICBjb25zdCBjYW5QdWJsaXNoR2VvSnNvbiA9IHR5cGUgPT09IFwiR2VvSnNvblwiICYmIGNhblB1Ymxpc2hUeXBlKHVzZXIsIFwiR2VvSnNvblwiLCBwb3J0YWwpO1xuICAgICAgICAvLyBDU1YgaGFzIFggWVxuICAgICAgICBjb25zdCBjYW5QdWJsaXNoQ1NWID0gdHlwZSA9PT0gXCJDU1ZcIiAmJiBjYW5QdWJsaXNoVHlwZSh1c2VyLCBcIkNTVlwiLCBwb3J0YWwpO1xuICAgICAgICBjb25zdCBzaG93UHVibGlzaE9wdGlvbnMgPSAhZXhpc3RpbmdJdGVtICYmICghbXZGbG93IHx8ICghY2FuU2tpcFB1Ymxpc2hTZWxlY3QgJiYgKGNhblB1Ymxpc2hHZW9Kc29uIHx8IGNhblB1Ymxpc2hDU1YpKSk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxvYWRlclwiLCB7IHR5cGU6IGxvYWRlclR5cGUsIHZhbHVlOiBhZGRJdGVtU3RhdGUudXBsb2FkUHJvZ3Jlc3MsIGFjdGl2ZTogbG9hZGluZywgdGV4dDogbG9hZGVyTWVzc2FnZSB9KSwgaChcImFyY2dpcy1uZXctaXRlbS1sb2FkZXJcIiwgeyB0eXBlOiBcImluZGV0ZXJtaW5hdGVcIiwgYWN0aXZlOiBpc0RlbGV0aW5nT2xkRmlsZSB9KSwgaChcImFyY2dpcy1uZXctaXRlbS1pbnB1dC1yZWFkb25seVwiLCBudWxsKSwgc2hvd1B1Ymxpc2hPcHRpb25zICYmIChoKFwiZmllbGRzZXRcIiwgeyBjbGFzczogXCJmaWVsZHNldFwiIH0sIGgoXCJsZWdlbmRcIiwgeyBjbGFzczogXCJsYWJlbFwiIH0sIGl0ZW1JbmZvSTE4Ti5ob3dUb0FkZCksIGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0LWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIgfSwgW1wiaG9zdGVkXCIsIFwibm9uLWhvc3RlZFwiXVxuICAgICAgICAgICAgLmZpbHRlcigob3B0aW9uKSA9PiBpc0hvc3RlZFBvcnRhbChwb3J0YWwpIHx8IG9wdGlvbiAhPT0gXCJob3N0ZWRcIilcbiAgICAgICAgICAgIC5tYXAoKHJhZGlvKSA9PiB0aGlzLnJlbmRlck9wdGlvbihyYWRpbywgZGlzcGxheU5hbWUpKSkpKSwgdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIiAmJlxuICAgICAgICAgICAgc2VsZWN0ZWQgPT09IFwiaG9zdGVkXCIgJiZcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJhcHBlbmRcIiAmJlxuICAgICAgICAgICAgdGhpcy5yZW5kZXJTaGVldFNlbGVjdCgpLCB0aGlzLnJlbmRlcjNkVGlsZXNTZWxlY3QoKSwgaChcImNhbGNpdGUtbm90aWNlXCIsIHsgb3BlbjogISF0aXAsIGNsYXNzOiBcIm5vdGljZS0tdGlwXCIsIGljb246IHRydWUsIHNjYWxlOiBcInNcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIHRpcCA9PT0gbnVsbCB8fCB0aXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpcC50aXRsZSksICh0aXAgPT09IG51bGwgfHwgdGlwID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXAuZGVzY3JpcHRpb24pICYmIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aXAgPT09IG51bGwgfHwgdGlwID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aXAuZGVzY3JpcHRpb24pLCAodGlwID09PSBudWxsIHx8IHRpcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGlwLmxpbmspICYmIChoKFwiY2FsY2l0ZS1saW5rXCIsIHsgc2xvdDogXCJsaW5rXCIsIGhyZWY6IHRpcCA9PT0gbnVsbCB8fCB0aXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRpcC5saW5rLCB0YXJnZXQ6IFwiX2JsYW5rXCIgfSwgdGlwID09PSBudWxsIHx8IHRpcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGlwLmxpbmtUZXh0KSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogYWxlcnRDb250ZW50ID09PSBudWxsIHx8IGFsZXJ0Q29udGVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWxlcnRDb250ZW50LnRpdGxlLCBkZXNjcmlwdGlvbjogYWxlcnRDb250ZW50ID09PSBudWxsIHx8IGFsZXJ0Q29udGVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWxlcnRDb250ZW50LmRlc2NyaXB0aW9uLCBsaW5rOiB7IGhyZWY6IGFsZXJ0Q29udGVudCA9PT0gbnVsbCB8fCBhbGVydENvbnRlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFsZXJ0Q29udGVudC5saW5rLCB0aXRsZTogYWxlcnRDb250ZW50ID09PSBudWxsIHx8IGFsZXJ0Q29udGVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWxlcnRDb250ZW50LmxpbmtUZXh0IH0sIGFjdGl2ZTogISFhbGVydENvbnRlbnQsIG9uQWxlcnREaXNtaXNzOiAoKSA9PiAodGhpcy5hbGVydENvbnRlbnQgPSBudWxsKSwgc2NhbGU6IFwic1wiIH0pKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0LnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzUHVibGlzaFNlbGVjdENzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3RDc3MgPSBcIi5vdXRlci1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0ubGF5ZXItY29udGFpbmVye292ZXJmbG93OmF1dG87b3ZlcmZsb3cteDpoaWRkZW47Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6ZmxleDttYXgtaGVpZ2h0OjIxMnB4O2hlaWdodDozMHZoO2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMSk7Ym9yZGVyLXRvcDowO3dpZHRoOjEwMCV9Y2FsY2l0ZS1yYWRpby1idXR0b24tZ3JvdXB7d2lkdGg6MTAwJX0ubGF5ZXItaXRlbXtwYWRkaW5nOjEycHggMTJweCAwfS5sYXllci1ub3RpY2V7bWFyZ2luLWJvdHRvbToxLjVyZW19LmxheWVyLWlucHV0LW1lc3NhZ2V7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjQwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LmxheWVyLW5vdC1mb3VuZC1tZXNzYWdle2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpO3RleHQtYWxpZ246Y2VudGVyO3dpZHRoOjEwMCU7bWFyZ2luLXRvcDoxLjVyZW19LnNlbGVjdGVke2JhY2tncm91bmQtY29sb3I6cmdiYSgwLCAxMjEsIDE5MywgMC4wNSl9LnNlbGVjdC1jb250YWluZXJ7bWFyZ2luLXRvcDoxLjVyZW07ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5zZWxlY3QtaXRlbXt3aWR0aDo0NSV9LnNlbGVjdC1pdGVtLW1lc3NhZ2V7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDttYXJnaW4tYm90dG9tOjAuMjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1QYWdlc1NpbmdsZUxheWVyU2VsZWN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgLy8gVE9ETzogS2VlcCBzZXJ2aWNlSW5mbyB1bm1vZGlmaWVkIC0gY2FuIGJlIGhhcmQgdG8gZm9sbG93IHdoYXQgY2FtZSBiYWNrIGZyb20gdGhlIHJlc3BvbnNlIHZzIHdoYXQgd2FzIGFkZGVkL2NoYW5nZWQgYWZ0ZXJcbiAgICAgICAgdGhpcy5zZWxlY3RXTVRTTGF5ZXIgPSAoc2VsZWN0ZWRMYXllcikgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgeyBzZXJ2aWNlSW5mbyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgc2VydmljZUluZm8uc2VsZWN0ZWRMYXllciA9IHNlbGVjdGVkTGF5ZXI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VydmljZUluZm8gPSBzZXJ2aWNlSW5mbztcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZExheWVyID0gc2VsZWN0ZWRMYXllcjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS50aWxlTWF0cmljZXMgPVxuICAgICAgICAgICAgICAgIGNvbmZpZ1N0YXRlLmFwaSA9PT0gNFxuICAgICAgICAgICAgICAgICAgICA/IHNlbGVjdGVkTGF5ZXIudGlsZU1hdHJpeFNldHMudG9BcnJheSgpXG4gICAgICAgICAgICAgICAgICAgIDogc2VsZWN0ZWRMYXllci50aWxlTWF0cml4U2V0SW5mb3M7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRUaWxlSW5mbyA9IChfYSA9IGFkZEl0ZW1TdGF0ZS50aWxlTWF0cmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXTtcbiAgICAgICAgICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSBzZWxlY3RlZExheWVyLnRpdGxlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlbGVjdFdGU0xheWVyID0gYXN5bmMgKGxheWVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHNlcnZpY2VJbmZvLCBtYXhGZWF0dXJlcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBleHRlbnQsIHRpdGxlIH0gPSBsYXllcjtcbiAgICAgICAgICAgIGNvbnN0IHdmc0xheWVyT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBsYXllck5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgbW9kZTogXCJzbmFwc2hvdFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCBuYW1lLFxuICAgICAgICAgICAgICAgIGZ1bGxFeHRlbnQ6IGV4dGVudCxcbiAgICAgICAgICAgICAgICBtYXhGZWF0dXJlczogbWF4RmVhdHVyZXMgfHwgMzAwMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChjb25maWdTdGF0ZS5hcGkgPT09IDMpIHtcbiAgICAgICAgICAgICAgICAvLyB3aGVuIGNhbGxpbmcgc2VsZWN0IGxheWVyIGZyb20gYFdGU0xheWVyYCB0aGlzIHdpbGwgYWN0dWFsbHkgdXBkYXRlIHNlcnZpY2VJbmZvLCBzbyB3ZSBuZWVkIHRvIHNldFNlcnZpY2VJbmZvIGV2ZXJ5dGltZSBhZnRlciB3ZSBjYWxsIHNlbGVjdExheWVyIGhlcmUuXG4gICAgICAgICAgICAgICAgYXdhaXQgc2VydmljZUluZm8uc2VsZWN0TGF5ZXIod2ZzTGF5ZXJPcHRpb25zLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VJbmZvLnNlbGVjdGVkTGF5ZXIgPSB3ZnNMYXllck9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29tcGxleCA9IHNlcnZpY2VJbmZvLmdlb21ldHJ5VHlwZSA9PT0gXCJlc3JpR2VvbWV0cnlDb21wbGV4XCI7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VJbmZvLmlzQ29tcGxleCA9IGlzQ29tcGxleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJsID0gc2VydmljZUluZm8udXJsLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmlzQ29tcGxleCA9IGlzQ29tcGxleDtcbiAgICAgICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvID0gc2VydmljZUluZm87XG4gICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZExheWVyID0gd2ZzTGF5ZXJPcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUudXJsID0gdXJsO1xuICAgICAgICAgICAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gd2ZzTGF5ZXJPcHRpb25zLnRpdGxlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VydmljZUluZm8ubGF5ZXJOYW1lID0gbmFtZTtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlSW5mby5tYXhGZWF0dXJlcyA9IHdmc0xheWVyT3B0aW9ucy5tYXhGZWF0dXJlcztcbiAgICAgICAgICAgICAgICAvLyBQcmV2aW91c2x5IHdlIGNhbGwgYHNlcnZpY2VJbmZvLnNlbGVjdExheWVyYCBpbiB2MyBhbmQgdGhlc2UgYXJlIHRoZSBjYWxsYmFja1xuICAgICAgICAgICAgICAgIHNlcnZpY2VJbmZvLnNlbGVjdGVkTGF5ZXIgPSB3ZnNMYXllck9wdGlvbnM7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNDb21wbGV4ID0gc2VydmljZUluZm8uZ2VvbWV0cnlUeXBlID09PSBcImVzcmlHZW9tZXRyeUNvbXBsZXhcIjtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlSW5mby5pc0NvbXBsZXggPSBpc0NvbXBsZXg7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gc2VydmljZUluZm8udXJsLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuaXNDb21wbGV4ID0gaXNDb21wbGV4O1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlSW5mbyA9IHNlcnZpY2VJbmZvO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZExheWVyID0gd2ZzTGF5ZXJPcHRpb25zO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS51cmwgPSB1cmw7XG4gICAgICAgICAgICAgICAgaXRlbVByb3BlcnRpZXNTdGF0ZS50aXRsZSA9IHNlcnZpY2VJbmZvLnRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVNlYXJjaFVwZGF0ZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGF5ZXJzID0gYWRkSXRlbVVybFN0YXRlLmxheWVycy5maWx0ZXIoKGxheWVyKSA9PiAhZXZlbnQuZGV0YWlsIHx8IGxheWVyLnRpdGxlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihldmVudC5kZXRhaWwpID4gLTEpO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJlZExheWVycyA9IGxheWVycztcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVUaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0U2VsZWN0T3B0aW9uKHRoaXMudGlsZVNlbGVjdFJlZik7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZFRpbGVJbmZvID0gYWRkSXRlbVVybFN0YXRlLnRpbGVNYXRyaWNlcy5maW5kKCh0aWxlSW5mbykgPT4gdGlsZUluZm9bY29uZmlnU3RhdGUuYXBpID09PSA0ID8gXCJpZFwiIDogXCJ0aWxlTWF0cml4U2V0XCJdID09PSBuYW1lKTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZFRpbGVJbmZvID0gc2VsZWN0ZWRUaWxlSW5mbztcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVNYXhGZWF0dXJlQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubWF4RmVhdHVyZXMgPSBwYXJzZUludChldmVudC50YXJnZXQudmFsdWUpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUdlb21ldHJ5Q2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdlb21ldHJ5ID0gdGhpcy5nZXRTZWxlY3RPcHRpb24odGhpcy5nZW9tZXRyeVNlbGVjdFJlZik7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZ2VvbWV0cnlUeXBlID0gdGhpcy5zZWxlY3RlZEdlb21ldHJ5O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlclNlbGVjdE1lbnVzID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB0eXBlLCBtYXhGZWF0dXJlcywgdGlsZU1hdHJpY2VzLCBpc0NvbXBsZXggfSA9IGFkZEl0ZW1VcmxTdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgaTE4biwgaGFuZGxlR2VvbWV0cnlDaGFuZ2UsIGhhbmRsZU1heEZlYXR1cmVDaGFuZ2UsIGhhbmRsZVRpbGVDaGFuZ2UgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJXRlNcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlbGVjdC1jb250YWluZXJcIiB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInNlbGVjdC1pdGVtXCIgfSwgaChcInN0cm9uZ1wiLCB7IGNsYXNzOiBcInNlbGVjdC1pdGVtLW1lc3NhZ2VcIiB9LCBpMThuLm1heEZlYXR1cmUpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IGhhbmRsZU1heEZlYXR1cmVDaGFuZ2UsIHZhbHVlOiBgJHttYXhGZWF0dXJlc31gLCBcIm51bWJlci1idXR0b24tdHlwZVwiOiBcInZlcnRpY2FsXCIsIG1pbjogMCxcbiAgICAgICAgICAgICAgICAgICAgLy8gd2lkdGg9XCJhdXRvXCIgLy8gVE9ETzogTm8gZGlyZWN0IGNvbnZlcnNpb24gLSBtYXliZSBzdHlsZSBpdCBmcm9tIHRoZSBvdXRzaWRlXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibnVtYmVyXCIgfSkpLCBpc0NvbXBsZXggJiYgKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgY2xhc3M6IFwic2VsZWN0LWl0ZW1cIiB9LCBoKFwic3Ryb25nXCIsIHsgY2xhc3M6IFwic2VsZWN0LWl0ZW0tbWVzc2FnZVwiIH0sIGkxOG4uZmVhdHVyZVR5cGUpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogXCJcIiwgY2xhc3M6IFwic2VsZWN0LWdlb21ldHJ5XCIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogaGFuZGxlR2VvbWV0cnlDaGFuZ2UsIHJlZjogKGVsKSA9PiAodGhpcy5nZW9tZXRyeVNlbGVjdFJlZiA9IGVsKSB9LCBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyBzZWxlY3RlZDogdGhpcy5zZWxlY3RlZEdlb21ldHJ5ID09PSBcImRlZmF1bHRcIiwgZGlzYWJsZWQ6IHRydWUsIHZhbHVlOiBcImRlZmF1bHRcIiwgbGFiZWw6IGkxOG4uc2VsZWN0R2VvbWV0cnkgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcImVzcmlHZW9tZXRyeVBvaW50XCIsIGxhYmVsOiBpMThuLnBvaW50cyB9KSwgaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IFwiZXNyaUdlb21ldHJ5UG9seWxpbmVcIiwgbGFiZWw6IGkxOG4ubGluZXMgfSksIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcImVzcmlHZW9tZXRyeVBvbHlnb25cIiwgbGFiZWw6IGkxOG4ucG9seWdvbnMgfSkpKSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCh0aWxlTWF0cmljZXMgPT09IG51bGwgfHwgdGlsZU1hdHJpY2VzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aWxlTWF0cmljZXMubGVuZ3RoKSA+IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWxlY3QtY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbVwiIH0sIGgoXCJzdHJvbmdcIiwgeyBjbGFzczogXCJzZWxlY3QtaXRlbS1tZXNzYWdlXCIgfSwgaTE4bi5zZWxlY3RUaWxlKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwiXCIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogaGFuZGxlVGlsZUNoYW5nZSwgcmVmOiAoZWwpID0+ICh0aGlzLnRpbGVTZWxlY3RSZWYgPSBlbCkgfSwgdGlsZU1hdHJpY2VzLm1hcCgodGlsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbmZpZ1N0YXRlLmFwaSA9PT0gMyA/IHRpbGUudGlsZU1hdHJpeFNldCA6IHRpbGUuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoKFwiY2FsY2l0ZS1vcHRpb25cIiwgeyB2YWx1ZTogdmFsdWUsIGxhYmVsOiB2YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9KSkpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWFuYWdlZEZvY3VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkR2VvbWV0cnkgPSBcImRlZmF1bHRcIjtcbiAgICAgICAgdGhpcy5maWx0ZXJlZExheWVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIG9uVHJhbnNpdGlvbkNvbXBsZXRlKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMubGF5ZXJTZWFyY2hSZWYpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb2N1c01haW5JbnB1dCgpO1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVOZXh0KCkge1xuICAgICAgICBjb25zdCB7IGlzQ29tcGxleCB9ID0gYWRkSXRlbVVybFN0YXRlO1xuICAgICAgICBpZiAoaXNDb21wbGV4ICYmIHRoaXMuc2VsZWN0ZWRHZW9tZXRyeSA9PT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLnNlbGVjdEdlb21ldHJ5RXJyb3I7XG4gICAgICAgICAgICB0aGlzLmdlb21ldHJ5U2VsZWN0UmVmLnNldEZvY3VzKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGlmICh0eXBlID09PSBcIldGU1wiKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNlbGVjdFdGU0xheWVyKHRoaXMuc2VsZWN0ZWRMYXllcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSgpKSB7XG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgICAgICAgICAgdXJsOiBlbmNvZGVVUkkoYWRkSXRlbVN0YXRlLnVybCksXG4gICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1ldGVyczogYWRkSXRlbVN0YXRlLmN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgbGF5ZXJzOiBbdGhpcy5zZWxlY3RlZExheWVyXSxcbiAgICAgICAgICAgICAgICBhZGRBc0Jhc2VtYXA6IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlTGF5ZXJDaGFuZ2UobmFtZSkge1xuICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPOiByZXR1cm4gbmV3IGxheWVyIGZyb20gc2VsZWN0X19fX0xheWVyLCB3cml0ZSB0byBzdG9yZSBoZXJlXG4gICAgICAgIGlmIChhZGRJdGVtVXJsU3RhdGUudHlwZSA9PT0gXCJXTVRTXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSBhZGRJdGVtVXJsU3RhdGUubGF5ZXJzLmZpbmQoKGxheWVyKSA9PiAoY29uZmlnU3RhdGUuYXBpID09PSAzID8gbGF5ZXIuaWRlbnRpZmllciA6IGxheWVyLmlkKSA9PT0gbmFtZSk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGF5ZXIgPSBzZWxlY3RlZExheWVyO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RXTVRTTGF5ZXIoc2VsZWN0ZWRMYXllcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV0ZTXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSBhZGRJdGVtVXJsU3RhdGUubGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5uYW1lID09PSBuYW1lKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VsZWN0V0ZTTGF5ZXIoc2VsZWN0ZWRMYXllcik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGF5ZXIgPSBzZWxlY3RlZExheWVyO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdlb21ldHJ5ID0gXCJkZWZhdWx0XCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZExheWVyID0gYWRkSXRlbVVybFN0YXRlLmxheWVycy5maW5kKChsYXllcikgPT4gbGF5ZXIudGl0bGUgPT09IG5hbWUpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExheWVyID0gc2VsZWN0ZWRMYXllcjtcbiAgICAgICAgICAgIC8vIHRyb3VibGUgd2l0aCB0aGUgdHlwaW5nIGhlcmVcbiAgICAgICAgICAgIHNlbGVjdE9HQ0ZlYXR1cmVMYXllcihzZWxlY3RlZExheWVyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0FkZFRvTWFwVGVybWluYWxQYWdlKCkge1xuICAgICAgICByZXR1cm4gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuO1xuICAgICAgICB0aGlzLmkxOG4gPSBpMThuLnNpbmdsZUxheWVyU2VsZWN0O1xuICAgICAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IGFkZEl0ZW1TdGF0ZS5hZGRBc0Jhc2VtYXAgPyBcInVzZUFzQmFzZU1hcFwiIDogXCJhZGRUb01hcFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhZGRJdGVtVXJsU3RhdGUudHlwZSA9PT0gXCJXRlNcIikge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLm1heEZlYXR1cmVzID0gMzAwMDtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VsZWN0V0ZTTGF5ZXIoYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvLmxheWVyc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFkZEl0ZW1VcmxTdGF0ZS50eXBlID09PSBcIldNVFNcIikge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RXTVRTTGF5ZXIoYWRkSXRlbVN0YXRlLnNlcnZpY2VJbmZvLmxheWVyc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maWx0ZXJlZExheWVycyA9IGFkZEl0ZW1VcmxTdGF0ZS5sYXllcnM7XG4gICAgICAgIGNvbnN0IGlzT0dDRmVhdHVyZSA9IGFkZEl0ZW1VcmxTdGF0ZS50eXBlID09PSBcIk9HQ0ZlYXR1cmVTZXJ2ZXJcIjtcbiAgICAgICAgY29uc3QgbGF5ZXJWYWx1ZSA9IGlzT0dDRmVhdHVyZVxuICAgICAgICAgICAgPyBcInRpdGxlXCJcbiAgICAgICAgICAgIDogYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV0ZTXCJcbiAgICAgICAgICAgICAgICA/IFwibGF5ZXJOYW1lXCJcbiAgICAgICAgICAgICAgICA6IFwiaWRlbnRpZmllclwiO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTGF5ZXIgPVxuICAgICAgICAgICAgYWRkSXRlbVVybFN0YXRlLmxheWVycy5maW5kKChsYXllcikgPT4geyB2YXIgX2E7IHJldHVybiBsYXllcltpc09HQ0ZlYXR1cmUgPyBcInRpdGxlXCIgOiBcIiBuYW1lXCJdID09PSAoKF9hID0gYWRkSXRlbVVybFN0YXRlLnNlbGVjdGVkTGF5ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtsYXllclZhbHVlXSk7IH0pIHx8IGFkZEl0ZW1VcmxTdGF0ZS5sYXllcnNbMF07XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zZWxlY3RlZExheWVyID0gdGhpcy5zZWxlY3RlZExheWVyO1xuICAgIH1cbiAgICBnZXRTZWxlY3RPcHRpb24oc2VsZWN0KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IHNlbGVjdCA9PT0gbnVsbCB8fCBzZWxlY3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdC5xdWVyeVNlbGVjdG9yKFwiY2FsY2l0ZS1vcHRpb25bc2VsZWN0ZWRdXCIpO1xuICAgICAgICByZXR1cm4gb3B0aW9uID09PSBudWxsIHx8IG9wdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9uLnZhbHVlO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyByZW5kZXJTZWxlY3RNZW51cywgaTE4biwgc2VsZWN0ZWRMYXllciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaXNXTVRTID0gYWRkSXRlbVVybFN0YXRlLnR5cGUgPT09IFwiV01UU1wiO1xuICAgICAgICBjb25zdCBpc09HQ0ZlYXR1cmUgPSBhZGRJdGVtVXJsU3RhdGUudHlwZSA9PT0gXCJPR0NGZWF0dXJlU2VydmVyXCI7XG4gICAgICAgIGNvbnN0IGxheWVyVmFsdWUgPSBpc09HQ0ZlYXR1cmVcbiAgICAgICAgICAgID8gXCJ0aXRsZVwiXG4gICAgICAgICAgICA6IGlzV01UU1xuICAgICAgICAgICAgICAgID8gY29uZmlnU3RhdGUuYXBpID09PSAzXG4gICAgICAgICAgICAgICAgICAgID8gXCJpZGVudGlmaWVyXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcImlkXCJcbiAgICAgICAgICAgICAgICA6IFwibmFtZVwiO1xuICAgICAgICBjb25zdCBMSU1JVF9BTU9VTlQgPSAxMDAwO1xuICAgICAgICBjb25zdCB1c2VQcm8gPSB0aGlzLmZpbHRlcmVkTGF5ZXJzLmxlbmd0aCA+PSBMSU1JVF9BTU9VTlQ7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIm91dGVyLWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGNsYXNzOiBcImxheWVyLW5vdGljZVwiLCBpY29uOiBcImluZm9ybWF0aW9uXCIsIG9wZW46IHVzZVBybywgd2lkdGg6IFwiZnVsbFwiIH0sIGgoXCJwXCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgaTE4bi51c2VQcm8pKSwgaChcInN0cm9uZ1wiLCB7IGNsYXNzOiBcInNlbGVjdC1pdGVtLW1lc3NhZ2VcIiB9LCBpMThuLnNlbGVjdExheWVyKSwgaChcImRpdlwiLCBudWxsLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWxheWVyLXNlYXJjaFwiLCB7IHNlYXJjaExhYmVsOiBcImxheWVyc1wiLCBvblNlYXJjaFVwZGF0ZTogdGhpcy5oYW5kbGVTZWFyY2hVcGRhdGUsIHJlZjogKGVsZSkgPT4gKHRoaXMubGF5ZXJTZWFyY2hSZWYgPSBlbGUpIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwibGF5ZXItY29udGFpbmVyXCIgfSwgdGhpcy5maWx0ZXJlZExheWVycy5sZW5ndGggPT09IDAgPyAoaChcInN0cm9uZ1wiLCB7IGNsYXNzOiBcImxheWVyLW5vdC1mb3VuZC1tZXNzYWdlXCIgfSwgaTE4bi5ub0xheWVyc0ZvdW5kKSkgOiAoaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uLWdyb3VwXCIsIHsgbmFtZTogXCJsYXllci1zZWxlY3RcIiwgcm9sZTogXCJyYWRpb2dyb3VwXCIsIGxheW91dDogXCJ2ZXJ0aWNhbFwiLCBvbkNhbGNpdGVSYWRpb0J1dHRvbkdyb3VwQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlTGF5ZXJDaGFuZ2UoZXZlbnQudGFyZ2V0LnNlbGVjdGVkSXRlbS52YWx1ZSkgfSwgKF9hID0gdGhpcy5maWx0ZXJlZExheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNsaWNlKDAsIExJTUlUX0FNT1VOVCkubWFwKChsYXllcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBsYXllcltsYXllclZhbHVlXTtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gbGF5ZXIudGl0bGU7XG4gICAgICAgICAgICBsZXQgaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gZm9yIHNvbWUgT0dDIFNlcnZlcnMsIHRoZSB0aXRsZSBtYXkgYmUgZHVwbGljYXRlZCBpbiB0aGUgZGF0YSBzZXQgc28geW91IGhhdmUgdG8gYWxzbyBjaGVjayB0aGUgaWQgYXMgd2VsbCAoZm9yIHdoYXQgSSB3YXMgdGVzdGluZyAtIHRoZSBpZCBjb3VsZG50IGJlIHVzZWQgYXMgYSB2YWx1ZSBiZWNhdXNlIGl0IGhhZCBzcGVjaWFsIGNoYXJhY3RlcnMgYW5kIGNvdWxkbnQgYmUgdXNlZCBhcyBhIHNlbGVjdG9yIGluIGBxdWVyeVNlbGVjdG9yYClcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gc2VsZWN0ZWRMYXllcltsYXllclZhbHVlXSkge1xuICAgICAgICAgICAgICAgIGlmIChpc09HQ0ZlYXR1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZCA9IGxheWVyLmlkID09PSBzZWxlY3RlZExheWVyLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwgZm9yOiB2YWx1ZSwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJsYXllci1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBpc1NlbGVjdGVkXG4gICAgICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1yYWRpby1idXR0b25cIiwgeyBjbGFzczogXCJyYWRpb1wiLCBjaGVja2VkOiBpc1NlbGVjdGVkLCBpZDogdmFsdWUsIG5hbWU6IHZhbHVlLCB2YWx1ZTogdmFsdWUgfSksIGxhYmVsIHx8IHZhbHVlKSk7XG4gICAgICAgIH0pKSkpKSwgcmVuZGVyU2VsZWN0TWVudXMoKSwgaChcImFyY2dpcy1uZXctaXRlbS1hbGVydFwiLCB7IGFjdGl2ZTogISF0aGlzLmVycm9yTWVzc2FnZSwgZGVzY3JpcHRpb246IHRoaXMuZXJyb3JNZXNzYWdlLCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3JNZXNzYWdlID0gXCJcIikgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc1NpbmdsZUxheWVyU2VsZWN0LnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3RDc3M7XG5cbi8qKlxuICogQ3VzdG9tIFBhcmFtdGVycyBjYW4gYmUgdXNlZCBmb3IgYW55IE9HQyBvciBBR1Mgc2VydmljZS4gRm9yIFdNUyxcbiAqIFdGUyBhbmQgV01UUyB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGNvbnN0cnVjdG9yIGZyb20gdGhlIEpTQVBJIHdoZW5cbiAqIGNyZWF0aW5nIHRoZSBsYXllciwgZm9yIGV2ZXJ5dGhpbmcgZWxzZSBpdCB3aWxsIGJlIGFkZGVkIHRlbXBvcmFyaWx5XG4gKiB0byB0aGUgVVJMIHdoZW4gcmV0cmVpdmluZyBzZXJ2aWNlIGluZm8uXG4gKiBGb3IgYWxsIHVybHMgd2l0aCBjdXN0b20gcGFyYW10ZXJzLCBpdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBpdGVtc1xuICogIG1ldGFkYXRhIHVzaW5nIHRoZSB0ZXh0IGF0dHJpYnV0ZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ3VzdG9tUGFyYW1ldGVyVXBkYXRlKHNlcnZpY2VJbmZvLCB0eXBlLCBfY3VzdG9tUGFyYW1ldGVycykge1xuICAgIGNvbnN0IHsgY3VzdG9tUGFyYW1ldGVycywgY3VzdG9tTGF5ZXJQYXJhbWV0ZXJzIH0gPSBmb3JtYXRDdXN0b21QYXJhbWV0ZXJzKF9jdXN0b21QYXJhbWV0ZXJzKTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcIldNU1wiOlxuICAgICAgICBjYXNlIFwiV01UU1wiOlxuICAgICAgICAgICAgYXdhaXQgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5zZXRDdXN0b21QYXJhbWV0ZXJzKGN1c3RvbVBhcmFtZXRlcnMgfHwge30sIGN1c3RvbUxheWVyUGFyYW1ldGVycyB8fCB7fSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJXRlNcIjpcbiAgICAgICAgICAgIGF3YWl0IChzZXJ2aWNlSW5mbyA9PT0gbnVsbCB8fCBzZXJ2aWNlSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VydmljZUluZm8uc2V0Q3VzdG9tUGFyYW1ldGVycyhjdXN0b21QYXJhbWV0ZXJzIHx8IHt9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5cbmNvbnN0IGlzS2V5QWxsb3dlZEluVXJsTG9jYWxTdGF0ZSA9IChrZXkpID0+IFtcbiAgICBcInVybFwiLFxuICAgIFwidHlwZVwiLFxuICAgIFwibmV3SXRlbU1vZGVcIixcbiAgICBcInNlcnZpY2VJbmZvXCIsXG4gICAgXCJpc1NlY3VyZWRcIixcbiAgICBcImFsbG93U3RvcmVkQXV0aFwiLFxuICAgIFwic3RvcmVBdXRoXCIsXG4gICAgXCJoeWJyaWRJbWFnZVNlcnZpY2VTZXR0aW5nXCIsXG4gICAgXCJhZGRBc0Jhc2VtYXBcIixcbiAgICBcImRhdGFVcmxcIixcbiAgICBcImZpbGVOYW1lXCIsXG4gICAgXCJnZW9KU09OUmVzb3VyY2VcIixcbiAgICBcInRpdGxlXCIsXG4gICAgXCJ0YWdzXCIsXG4gICAgXCJzbmlwcGV0XCJcbl0uaW5jbHVkZXMoa2V5KTtcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVBhZ2VzVXJsVHlwZUNzcyA9IFwiLmxhYmVse21hcmdpbi1ib3R0b206MXJlbTtkaXNwbGF5OmJsb2NrO3BhZGRpbmctdG9wOjFyZW07Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7bGluZS1oZWlnaHQ6MThweH0uZmllbGRzZXR7bWFyZ2luOjBweDttYXJnaW4tYm90dG9tOjEuNXJlbTtib3JkZXItc3R5bGU6bm9uZTtwYWRkaW5nOjBweH0uaW5mby1oZWFkZXJ7bWFyZ2luOjBweDttYXJnaW4tYm90dG9tOjAuNXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0uaW5mby1oZWFkZXItLWxlYWRlcnttYXJnaW4tdG9wOjFyZW19LmluZm8tZGVzY3JpcHRpb257bWFyZ2luOjBweDtwYWRkaW5nOjBweDtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5jdXN0b20tcGFyYW0tY29udGFpbmVye21hcmdpbi1ib3R0b206MS41cmVtfTpob3N0e292ZXJmbG93LXg6aGlkZGVufVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNVcmxUeXBlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVVwZGF0ZVBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLmFkZERpcmVjdFRvTWFwID0gZmFsc2U7XG4gICAgICAgIHRoaXMudXJsT3B0aW9ucyA9IFtcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiQUdTXCIsIGljb246IFwic2VydmVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiRG9jdW1lbnQgTGlua1wiLCBpY29uOiBcImZpbGUtY29kZVwiLCBzaG93OiAhaXNQdWJsaWNVc2VyKGNvbmZpZ1N0YXRlLnVzZXIpIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIkdlb0pzb25cIiwgaWNvbjogXCJicmFja2V0cy1jdXJseVwiLCBzaG93OiB0cnVlIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIktNTFwiLCBpY29uOiBcImxheWVyLWttbFwiLCBzaG93OiB0cnVlIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIk9HQ0ZlYXR1cmVTZXJ2ZXJcIiwgaWNvbjogXCJmZWF0dXJlLWxheWVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiV0ZTXCIsIGljb246IFwiZmVhdHVyZS1sYXllclwiLCBzaG93OiB0cnVlIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIldNU1wiLCBpY29uOiBcImxheWVyLW1hcFwiLCBzaG93OiB0cnVlIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIldNVFNcIiwgaWNvbjogXCJ0aWxlLWxheWVyXCIsIHNob3c6IHRydWUgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiR2VvUlNTXCIsIGljb246IFwiZmlsZS10ZXh0XCIsIHNob3c6IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBcIkNTVlwiLFxuICAgICAgICAgICAgICAgIGljb246IFwiZmlsZS1jc3ZcIixcbiAgICAgICAgICAgICAgICBzaG93OiB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIgfHwgISgoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIlRpbGUgTGF5ZXJcIiwgaWNvbjogXCJ0aWxlLWxheWVyXCIsIHNob3c6IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB9XG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuc2V0U2VydmljZUluZm9TdGF0ZSA9IChwcm9wZXJ0aWVzKSA9PiB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BlcnRpZXNba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoaXNLZXlBbGxvd2VkSW5VcmxMb2NhbFN0YXRlKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogUmVtb3ZlIGFueSBjYXN0IG9uY2UgaW5jb21pbmcgcHJvcGVydGllcyBhcmUgdHJpbW1lZCBkb3duIHRvIHVybERhdGFcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cmxEYXRhW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IERlY2lkZSBpZiBhbGwgcG9zc2libGUgc2VydmljZSBpbmZvIHByb3BlcnRpZXMgKHRodW1ibmFpbCwgZXh0ZW50LCBsYXllcnMsIGV0Yy4pIHNob3VsZCBiZSBwYXJ0IG9mIHVybERhdGFcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm90LCBjb25zaWRlciBob2xkaW5nIHRoaXMgYXMgYSB0ZW1wb3JhcnkgbG9jYWwgb2JqZWN0IHVudGlsIHRoZSByZXN0IG9mIHRoZSBzdG9yZSBhc3NpZ25tZW50c1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXNBZGRUb01hcFRlcm1pbmFsUGFnZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRPcHRpb24sIHVybERhdGE6IHsgdXJsLCBzZXJ2aWNlSW5mbyB9LCBhZGREaXJlY3RUb01hcCB9ID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiAoYWRkRGlyZWN0VG9NYXAgJiZcbiAgICAgICAgICAgICAgICAoKGlzQUdTKHRoaXMudXJsRGF0YS50eXBlKSAmJiAhdGhpcy51cmxEYXRhLnN0b3JlQXV0aCAmJiBzZXJ2aWNlSW5mbykgfHxcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHNEaXJlY3Qoc2VsZWN0ZWRPcHRpb24pKSAmJlxuICAgICAgICAgICAgICAgICFpc0h5YnJpZEltYWdlU2VydmljZSh1cmwsIHNlcnZpY2VJbmZvKSAmJlxuICAgICAgICAgICAgICAgICghW1wiV01TXCIsIFwiV0ZTXCIsIFwiV01UU1wiLCBcIkNTVlwiLCBcIkdlb0pzb25cIiwgXCJPR0NGZWF0dXJlU2VydmVyXCJdLmluY2x1ZGVzKHNlbGVjdGVkT3B0aW9uKSB8fFxuICAgICAgICAgICAgICAgICAgICBpc0FHUyh0aGlzLnVybERhdGEudHlwZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKHNlbGVjdGVkT3B0aW9uID09PSBcIkdlb0pzb25cIiAmJiAhY29uZmlnU3RhdGUudXNlcikgfHxcbiAgICAgICAgICAgICAgICAgICAgKCgoX2EgPSBjb25maWdTdGF0ZS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiYgW1wiQ1NWXCIsIFwiR2VvSnNvblwiXS5pbmNsdWRlcyhzZWxlY3RlZE9wdGlvbikpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGV0ZXJtaW5lTmV4dFRleHQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHVybERhdGEsIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UsIHNob3dBZGRUb01hcCB9ID0gdGhpcztcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwibmV4dFwiO1xuICAgICAgICAgICAgaWYgKGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwiYWRkVG9NYXBcIjtcbiAgICAgICAgICAgICAgICBpZiAoc2hvd0FkZFRvTWFwKCkgJiYgdXJsRGF0YS5hZGRBc0Jhc2VtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID0gXCJ1c2VBc0Jhc2VNYXBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2hvd0FkZFRvTWFwID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB1cmxEYXRhLCBhZGREaXJlY3RUb01hcCB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgdXJsID0gXCJcIiwgc2VydmljZUluZm8gfSA9IHVybERhdGE7XG4gICAgICAgICAgICBjb25zdCBhZGRUb01hcFR5cGUgPSBbXG4gICAgICAgICAgICAgICAgXCJUaWxlIExheWVyXCIsXG4gICAgICAgICAgICAgICAgXCJXTVNcIixcbiAgICAgICAgICAgICAgICBcIldNVFNcIixcbiAgICAgICAgICAgICAgICBcIlZlY3RvciBUaWxlIFNlcnZpY2VcIixcbiAgICAgICAgICAgICAgICBcIkltYWdlIFNlcnZpY2VcIixcbiAgICAgICAgICAgICAgICBcIk1hcCBTZXJ2aWNlXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICByZXR1cm4gKGFkZERpcmVjdFRvTWFwICYmXG4gICAgICAgICAgICAgICAgKGFkZFRvTWFwVHlwZS5pbmNsdWRlcyh1cmxEYXRhLnR5cGUpIHx8IGlzSHlicmlkSW1hZ2VTZXJ2aWNlKHVybCwgc2VydmljZUluZm8pKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQXV0aFN3aXRjaENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cmxEYXRhLnN0b3JlQXV0aCA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkZXJVcGRhdGUgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGV2ZW50LmRldGFpbDtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZXNldEVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMucHJldmlvdXNTZWxlY3RlZE9wdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lcnJvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51cmxEYXRhID0ge307XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZU5leHQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgdXJsRGF0YSwgc2VsZWN0ZWRPcHRpb24sIGl0ZW1VcmxSZWYsIGkxOG4sIHNlbGVjdFJlZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjdXN0b21QYXJhbWV0ZXJzIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHVybEVycm9yTWVzc2FnZSA9IGF3YWl0IChpdGVtVXJsUmVmID09PSBudWxsIHx8IGl0ZW1VcmxSZWYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW1VcmxSZWYudmFsaWRhdGVJbnB1dCgpKTtcbiAgICAgICAgaWYgKHVybEVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgLy8gV2UgYWxyZWFkeSBzaG93IGVycm9yIGlubGluZVxuICAgICAgICAgICAgaXRlbVVybFJlZi5mb2N1c01haW5JbnB1dCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhbmNlbCBuZXh0IGlmIHVybCBpcyBub3QgeWV0IGFuYWx5emVkXG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNlbGVjdGVkT3B0aW9uKSB7XG4gICAgICAgICAgICBzZWxlY3RSZWYuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gaTE4bi51bmRldGVjdGVkO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuaGFuZGxlUGFnZVRyYW5zaXRpb24oKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICBpZiAoaXNIeWJyaWRJbWFnZVNlcnZpY2UodXJsRGF0YS51cmwsIChfYSA9IHRoaXMudXJsRGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlcnZpY2VJbmZvKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduU3RvcmVTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdCh0aGlzLnVybERhdGEuc3RvcmVBdXRoID8gXCJhdXRoXCIgOiBcImh5YnJpZEltYWdlU2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gT25seSByZWRpcmVjdCBpZiBubyBtb3JlIGFjdGlvbnMgYXJlIG5lZWRlZFxuICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdXJsRGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IGVuY29kZVVSSSh1cmxEYXRhLnVybCksXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgICAgIGFkZEFzQmFzZW1hcDogKF9iID0gdGhpcy51cmxEYXRhLmFkZEFzQmFzZW1hcCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0TmV4dFBhZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuYXNzaWduU3RvcmVTdGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KHRoaXMubmV4dFBhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pdGVtVXJsUmVmLmZvY3VzTWFpbklucHV0KCk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3NpZ25TdG9yZVN0YXRlKCkge1xuICAgICAgICBjb25zdCB7IHVybCwgdHlwZSwgYWxsb3dTdG9yZWRBdXRoLCBzdG9yZUF1dGgsIHRpdGxlLCB0YWdzLCBzbmlwcGV0LCBzZXJ2aWNlSW5mbywgaXNTZWN1cmVkLCBhZGRBc0Jhc2VtYXAgfSA9IHRoaXMudXJsRGF0YTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSB0aGlzLnNlbGVjdGVkT3B0aW9uO1xuICAgICAgICBhZGRJdGVtU3RhdGUudXJsID0gdXJsO1xuICAgICAgICBhZGRJdGVtU3RhdGUuc3RvcmVBdXRoID0gc3RvcmVBdXRoO1xuICAgICAgICBhZGRJdGVtU3RhdGUudHlwZSA9IHR5cGU7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5hbGxvd1N0b3JlZEF1dGggPSBhbGxvd1N0b3JlZEF1dGg7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwidXJsXCI7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5zZXJ2aWNlSW5mbyA9IHNlcnZpY2VJbmZvO1xuICAgICAgICBhZGRJdGVtU3RhdGUuaXNTZWN1cmVkID0gaXNTZWN1cmVkO1xuICAgICAgICBhZGRJdGVtU3RhdGUuYWRkQXNCYXNlbWFwID0gYWRkQXNCYXNlbWFwICE9PSBudWxsICYmIGFkZEFzQmFzZW1hcCAhPT0gdm9pZCAwID8gYWRkQXNCYXNlbWFwIDogZmFsc2U7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gdXJsLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uID09PSBcIkdlb0pzb25cIiAmJiB1cmwpIHtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhVXJsID0gdXJsO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnRpdGxlID0gZmlsZU5hbWUucmVwbGFjZShnZW9Kc29uUmVnRXhwLCBcIlwiKS5yZXBsYWNlKHNwZWNpYWxDaGFyYWN0ZXJzUmVnRXhwLCBcIlwiKTtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmV4dGVuc2lvbiA9IFwianNvblwiO1xuICAgICAgICAgICAgaWYgKHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJtYXBcIikge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiZmlsZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmdlb0pTT05SZXNvdXJjZSA9IHtcbiAgICAgICAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IFwiZ2VvanNvblwiXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiA9PT0gXCJDU1ZcIikge1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSBcIkNTVlwiO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmRhdGFVcmwgPSB1cmw7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZmlsZU5hbWUgPSB1cmxUb1RpdGxlKHVybCk7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZXh0ZW5zaW9uID0gXCJjc3ZcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jc3ZSZXNvdXJjZSA9IHtcbiAgICAgICAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IFwiY3N2XCJcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdGl0bGUgJiYgKGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGl0bGUgPSB0aXRsZS5yZXBsYWNlKHNwZWNpYWxDaGFyYWN0ZXJzUmVnRXhwLCBcIlwiKSk7XG4gICAgICAgIHRhZ3MgJiYgKGl0ZW1Qcm9wZXJ0aWVzU3RhdGUudGFncyA9IHRhZ3MpO1xuICAgICAgICBzbmlwcGV0ICYmIChpdGVtUHJvcGVydGllc1N0YXRlLnNuaXBwZXQgPSBzbmlwcGV0KTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyB0eXBlLCB1cmwsIHNlcnZpY2VJbmZvLCBpc1NlY3VyZWQsIGFsbG93U3RvcmVkQXV0aCwgc3RvcmVBdXRoLCBhZGRBc0Jhc2VtYXAsIHRpdGxlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHRoaXMudXJsRGF0YSA9IHtcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBhbGxvd1N0b3JlZEF1dGgsXG4gICAgICAgICAgICBzdG9yZUF1dGgsXG4gICAgICAgICAgICBzZXJ2aWNlSW5mbyxcbiAgICAgICAgICAgIGlzU2VjdXJlZCxcbiAgICAgICAgICAgIGFkZEFzQmFzZW1hcCxcbiAgICAgICAgICAgIHRpdGxlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2hhbmdlT3B0aW9uKChfYSA9IHR5cGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwpO1xuICAgICAgICB0aGlzLmFkZERpcmVjdFRvTWFwID0gdWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiO1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi51cmxUeXBlO1xuICAgICAgICB0aGlzLmxvYWRlclRleHQgPSB0aGlzLmkxOG4uZ2V0U2VydmljZUluZm87XG4gICAgICAgIGlmICghIWNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMpIHtcbiAgICAgICAgICAgIHRoaXMudXJsT3B0aW9ucyA9IHRoaXMudXJsT3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbi52YWx1ZSA9PT0gXCJBR1NcIlxuICAgICAgICAgICAgICAgICAgICA/IChfYSA9IGNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zb21lKCh0eXBlKSA9PiBpc0FHUyh0eXBlKSlcbiAgICAgICAgICAgICAgICAgICAgOiAoX2IgPSBjb25maWdTdGF0ZS5hbGxvd2VkSXRlbVR5cGVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaW5jbHVkZXMob3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5hbGxvd2VkSXRlbVR5cGVzID0gY29uZmlnU3RhdGUuYWxsb3dlZEl0ZW1UeXBlcy5maWx0ZXIoKGl0ZW1UeXBlKSA9PiAhY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsIHx8IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJtYXBcIiB8fCBcIkNTVlwiICE9PSBpdGVtVHlwZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy51cmxPcHRpb25zXG4gICAgICAgICAgICAuZmlsdGVyKCh7IHNob3cgfSkgPT4gc2hvdylcbiAgICAgICAgICAgIC5tYXAoKHsgdmFsdWUsIGljb24gfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSB0eXBlb2YgdmFsdWUgIT09IFwic3RyaW5nXCIgPyBcIkFHU1wiIDogdmFsdWU7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG9wdGlvblRpdGxlOiB0aGlzLmkxOG5bZW50cnldLnRpdGxlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBlbnRyeSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW2VudHJ5XS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBpY29uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gU2luY2Ugd2UgcmUtYXNzaWduIHN0b3JlIHN0YXRlIG9uIG5leHQgYW55d2F5LFxuICAgICAgICAvLyB0aGVzZSBzaG91bGQgYmUgc2FmZSB0byBiZSByZXNldCB0byBhdm9pZCBkYW5nbGluZyBkYXRhXG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhVXJsID0gbnVsbDtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmZpbGVOYW1lID0gbnVsbDtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmdlb0pTT05SZXNvdXJjZSA9IG51bGw7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5jc3ZSZXNvdXJjZSA9IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIGdldFNlcnZpY2VJbmZvKGNoZWNrQXV0aCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgdXJsLCB0eXBlLCBzdG9yZUF1dGggfSA9IHRoaXMudXJsRGF0YTtcbiAgICAgICAgY29uc3QgeyBlcnJvciwgcmVzdWx0IH0gPSBhd2FpdCBnZXRVcmxTZXJ2aWNlSW5mbyh7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBjaGVja0F1dGgsXG4gICAgICAgICAgICBzdG9yZUF1dGhcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvciB8fCAhcmVzdWx0KSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICgoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcImRvZXMgbm90IHBvaW50IHRvIGEgR0lTIHNlcnZlclwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uc2VydmljZU5vdEdJUztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKChfYSA9IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJkb2Vzbid0IHN1cHBvcnQgR2VvSlNPTiBvdXRwdXRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi51bnN1cHBvcnRlZFdGU0dlb0pTT05PdXRwdXRGb3JtYXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzZXJ2aWNlTm90RXhpc3RcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLnNlcnZpY2VOb3RFeGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwidW5hdXRob3JpemVkXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IFwiVW5hdXRob3JpemVkXCI7IC8vIFRPRE86IEdldCBwcm9wZXIgZXJyb3IgbWVzc2FnaW5nLCB0aGVuIGxvY2FsaXplXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInVuc3VwcG9ydGVkV0ZTVmVyc2lvblwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4udW5zdXBwb3J0ZWRXRlNWZXJzaW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpbnZhbGlkV01UU1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSB0aGlzLmkxOG4uaW52YWxpZFdNVFM7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImludmFsaWRTcGF0aWFsUmVmXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bi5pbnZhbGlkU3BhdGlhbFJlZjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZW1wdHlGZWF0dXJlTGF5ZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gdGhpcy5pMThuLmVtcHR5RmVhdHVyZUxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuaTE4bltlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuY29kZV0gfHwgdGhpcy5pMThuLnNlcnZpY2VOb3RFeGlzdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgaGFuZGxlTG9hZENoYW5nZShfb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkLmVtaXQobmV3VmFsdWUpO1xuICAgIH1cbiAgICBjaGFuZ2VPcHRpb24odHlwZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMucHJldmlvdXNTZWxlY3RlZE9wdGlvbiA9IHRoaXMuc2VsZWN0ZWRPcHRpb247XG4gICAgICAgIGNvbnN0IGlzQUdTVHlwZSA9IGlzQUdTKHR5cGUpIHx8IHR5cGUgPT09IFwiQUdTXCI7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSBpc0FHU1R5cGUgPyBcIkFHU1wiIDogdHlwZTtcbiAgICAgICAgbGV0IG5ld1R5cGUgPSB0eXBlO1xuICAgICAgICBpZiAoaXNBR1NUeXBlKSB7XG4gICAgICAgICAgICAvLyBBdHRlbXB0IHRvIHBhcnNlIEFHUyB0eXBlIGZyb20gdXJsXG4gICAgICAgICAgICBjb25zdCBhY3R1YWxVcmxUeXBlID0gKF9hID0gYWRkQ3JlYXRlSXRlbVR5cGVzW3BhcnNlQUdTVHlwZSh0aGlzLnVybERhdGEudXJsKV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlO1xuICAgICAgICAgICAgaWYgKGFjdHVhbFVybFR5cGUpIHtcbiAgICAgICAgICAgICAgICBuZXdUeXBlID0gYWN0dWFsVXJsVHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVybERhdGEudHlwZSA9IG5ld1R5cGU7XG4gICAgICAgIC8vIExvZyB0ZWxlbWV0cnkgZXZlbnQgaWYgb3B0aW9uIGlzIG1hbnVhbGx5IGNoYW5nZWQgdG8gYSBkaWZmZXJlbnQgdHlwZVxuICAgICAgICBpZiAodGhpcy5wcmV2aW91c1NlbGVjdGVkT3B0aW9uICE9PSB0aGlzLnNlbGVjdGVkT3B0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ0NoYW5nZU9wdGlvbkV2ZW50KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kZXRlcm1pbmVOZXh0VGV4dCgpO1xuICAgIH1cbiAgICBhc3luYyBkZXRlY3RUeXBlKHVybCkge1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBjb25zdCB7IGlzUG9ydGFsIH0gPSBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdDogdHlwZSB9ID0gZ2V0VXJsVHlwZSh1cmwsIGlzUG9ydGFsKTtcbiAgICAgICAgICAgIHJldHVybiB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnVybERhdGEudHlwZTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlTmV3VXJsKGFyZ3MpIHtcbiAgICAgICAgY29uc3QgeyB1cmwgfSA9IGFyZ3M7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMucmVzZXRFcnJvcigpO1xuICAgICAgICBpZiAodGhpcy51cmxEYXRhLnVybCAhPT0gdXJsKSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0VXJsRGF0YSgpO1xuICAgICAgICAgICAgdGhpcy5yZXNldFNlcnZpY2VJbmZvKCk7XG4gICAgICAgICAgICBjb25zdCBkZXRlY3RlZFR5cGUgPSBhd2FpdCB0aGlzLmRldGVjdFR5cGUodXJsKTtcbiAgICAgICAgICAgIHRoaXMudXJsRGF0YS51cmwgPSB1cmw7XG4gICAgICAgICAgICB0aGlzLnVybERhdGEudHlwZSA9IGRldGVjdGVkVHlwZTtcbiAgICAgICAgICAgIGlmIChpc0FHUyhkZXRlY3RlZFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VydmljZUluZm8gPSBhd2FpdCB0aGlzLmdldFNlcnZpY2VJbmZvKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlSW5mbyAmJiB0aGlzLnNldFNlcnZpY2VJbmZvU3RhdGUoc2VydmljZUluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VPcHRpb24oZGV0ZWN0ZWRUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgcmVzZXRVcmxEYXRhKCkge1xuICAgICAgICBjb25zdCB7IHVybERhdGEgfSA9IHRoaXM7XG4gICAgICAgIHVybERhdGEudXJsID0gbnVsbDtcbiAgICAgICAgdXJsRGF0YS50eXBlID0gbnVsbDtcbiAgICAgICAgdXJsRGF0YS5pc1NlY3VyZWQgPSBudWxsO1xuICAgICAgICB1cmxEYXRhLnN0b3JlQXV0aCA9IG51bGw7XG4gICAgICAgIHVybERhdGEuYWxsb3dTdG9yZWRBdXRoID0gbnVsbDtcbiAgICAgICAgdXJsRGF0YS5zZXJ2aWNlSW5mbyA9IG51bGw7XG4gICAgICAgIHVybERhdGEudGl0bGUgPSBudWxsO1xuICAgICAgICB1cmxEYXRhLnRhZ3MgPSBudWxsO1xuICAgICAgICB1cmxEYXRhLnNuaXBwZXQgPSBudWxsO1xuICAgIH1cbiAgICAvLyBQcmV2ZW50IHN0YWxlIHNlcnZpY2UgaW5mbyBmcm9tIHBlcnNpc3Rpbmcgb24gdXJsIGNoYW5nZVxuICAgIHJlc2V0U2VydmljZUluZm8oKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5hZ3NUeXBlID0gbnVsbDtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmRlc2NyaXB0aW9uID0gbnVsbDtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmV4dGVudCA9IG51bGw7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS50aHVtYm5haWxUb2tlbiA9IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZVBhZ2VUcmFuc2l0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHVybERhdGEgfSA9IHRoaXM7XG4gICAgICAgIC8vIFRPRE86IHJlZmFjdG9yIHRoaXMgb25jZSB3ZSByZW1vdmUgdGhlIHNpZGUtZWZmZWN0IGZyb20gYGN1c3RvbS1wYXJhbWV0ZXJzYFxuICAgICAgICBjb25zdCB7IGN1c3RvbVBhcmFtZXRlcnMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRPcHRpb24gPT09IFwiRG9jdW1lbnQgTGlua1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGVja0F1dGggPSAhIXVybERhdGEuaXNTZWN1cmVkO1xuICAgICAgICBhZGRJdGVtU3RhdGUuY2hlY2tBdXRoID0gY2hlY2tBdXRoO1xuICAgICAgICAvLyAhIEZvciBBR1MgY2FzZSwgYGdldFNlcnZpY2VJbmZvYCBpcyBhbHJlYWR5IGNhbGxlZCBvbmNlLlxuICAgICAgICAvLyBUT0RPOiBTbyByZWZhY3RvciBvbmNlIHdlIGNhbiBnZXQgdGhlIHNpZ24gaW4gcG9wdXAgdG8gc2hvdyB1cCBlYXNpZXJcbiAgICAgICAgY29uc3Qgc2VydmljZUluZm8gPSBhd2FpdCB0aGlzLmdldFNlcnZpY2VJbmZvKGNoZWNrQXV0aCk7XG4gICAgICAgIHNlcnZpY2VJbmZvICYmIHRoaXMuc2V0U2VydmljZUluZm9TdGF0ZShzZXJ2aWNlSW5mbyk7XG4gICAgICAgIGlmIChjdXN0b21QYXJhbWV0ZXJzLmxlbmd0aCA+IDAgJiYgY29uZmlnU3RhdGUuYXBpID09PSAzKSB7XG4gICAgICAgICAgICAvLyBgc2VydmljZUluZm8uY3VzdG9tUGFyYW1ldGVyc2AgaXMgYWxyZWFkeSBzZXQgYWZ0ZXIgd2UgZmV0Y2ggc2VydmljZSBpbmZvXG4gICAgICAgICAgICAvLyAgYW5kIHNldEN1c3RvbVBhcmFtZXRlcnMgZG9lc24ndCBleGlzdCBmb3IgdjRcbiAgICAgICAgICAgIGF3YWl0IGhhbmRsZUN1c3RvbVBhcmFtZXRlclVwZGF0ZSh1cmxEYXRhLnNlcnZpY2VJbmZvLCB1cmxEYXRhLnR5cGUsIGN1c3RvbVBhcmFtZXRlcnMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhIXNlcnZpY2VJbmZvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUZWxlbWV0cnkgaGFuZGxpbmcgZm9yIHdoZW4gYW4gb3B0aW9uIGlzIG1hbnVhbGx5IGNoYW5nZWRcbiAgICAgKi9cbiAgICBsb2dDaGFuZ2VPcHRpb25FdmVudCgpIHtcbiAgICAgICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgZXZlbnRUeXBlOiBcIm90aGVyXCIsXG4gICAgICAgICAgICBwYWdlTmFtZTogXCJteSBjb250ZW50XCIsXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbSB1cmwgdHlwZSBjaGFuZ2VcIixcbiAgICAgICAgICAgIGRldGFpbHM6IHRoaXMudXJsRGF0YS51cmwsXG4gICAgICAgICAgICBsYWJlbDogYCR7dGhpcy5wcmV2aW91c1NlbGVjdGVkT3B0aW9ufSwgJHt0aGlzLnNlbGVjdGVkT3B0aW9ufWBcbiAgICAgICAgfTtcbiAgICAgICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LmxvZ0V2ZW50KHBheWxvYWQpO1xuICAgIH1cbiAgICBzZXROZXh0UGFnZSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZE9wdGlvbiwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgICAgIGxldCBuZXh0UGFnZTtcbiAgICAgICAgaWYgKGlzQUdTKHRoaXMudXJsRGF0YS50eXBlKSkge1xuICAgICAgICAgICAgbmV4dFBhZ2UgPSB0aGlzLnVybERhdGEuc3RvcmVBdXRoID8gXCJhdXRoXCIgOiBcIml0ZW1Qcm9wZXJ0aWVzXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHNlbGVjdGVkT3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIldNU1wiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0UGFnZSA9IFwiYnVsa0xheWVyU2VsZWN0XCI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJXRlNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiV01UU1wiOlxuICAgICAgICAgICAgICAgICAgICBuZXh0UGFnZSA9IFwic2luZ2xlTGF5ZXJTZWxlY3RcIjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIkNTVlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJHZW9Kc29uXCI6XG4gICAgICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJwdWJsaXNoU2VsZWN0XCI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJUaWxlIExheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJ0aWxlTGF5ZXJGcm9tVXJsXCI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IG1vdmUgdGhpcyBiYWNrIG9uY2Ugd2UgZmluYWxpemUgc3BlYyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcC9pc3N1ZXMvNDU3MTRcbiAgICAgICAgICAgICAgICBjYXNlIFwiT0dDRmVhdHVyZVNlcnZlclwiOlxuICAgICAgICAgICAgICAgICAgICBpZiAoYWRkRGlyZWN0VG9NYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJzaW5nbGVMYXllclNlbGVjdFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBuZXh0UGFnZSA9IFwiaXRlbVByb3BlcnRpZXNcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5leHRQYWdlID0gbmV4dFBhZ2U7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGkxOG4sIHNlbGVjdGVkT3B0aW9uLCB1cmxEYXRhLCBkZXRlcm1pbmVOZXh0VGV4dCwgYWRkRGlyZWN0VG9NYXAgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgdXJsID0gXCJcIiwgaXNTZWN1cmVkLCBhZGRBc0Jhc2VtYXAsIGFsbG93U3RvcmVkQXV0aCB9ID0gdXJsRGF0YTtcbiAgICAgICAgY29uc3QgeyBjb25maWc6IHsgaGVscE1hcCwgaGVscEJhc2UgfSwgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IGFnc0l0ZW1UeXBlcyA9IHVuaXF1ZShPYmplY3QudmFsdWVzKGFnc1NlcnZlck1hcCkpO1xuICAgICAgICBjb25zdCBzaG93Q3VzdG9tUGFyYW1ldGVyc1R5cGUgPSBbXG4gICAgICAgICAgICBcIldNU1wiLFxuICAgICAgICAgICAgXCJXRlNcIixcbiAgICAgICAgICAgIFwiV01UU1wiLFxuICAgICAgICAgICAgXCJPR0NGZWF0dXJlU2VydmVyXCIsXG4gICAgICAgICAgICAuLi5hZ3NJdGVtVHlwZXNcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgc2hvd0N1c3RvbVBhcmFtZXRlcnMgPSBzaG93Q3VzdG9tUGFyYW1ldGVyc1R5cGUuaW5jbHVkZXModXJsRGF0YS50eXBlKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgYWN0aXZlOiB0aGlzLmxvYWRpbmcsIHRleHQ6IGkxOG4uZ2V0U2VydmljZUluZm8gfSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBhY3RpdmU6IHRoaXMuZXJyb3IsIGRlc2NyaXB0aW9uOiB0aGlzLmVycm9yTWVzc2FnZSwgb25BbGVydERpc21pc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgfSB9KSwgaChcImFyY2dpcy1uZXctaXRlbS11cmxcIiwgeyB1cmw6IHVybCwgb25OZXdJdGVtVXJsQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuaGFuZGxlTmV3VXJsKGV2ZW50LmRldGFpbCksIHN1cHBvcnRlZFNlcnZpY2VzOiAoX2EgPSB0aGlzLmFsbG93ZWRJdGVtVHlwZXMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMsIG9uVXJsTG9hZGVyVXBkYXRlOiB0aGlzLmhhbmRsZUxvYWRlclVwZGF0ZSwgcmVmOiAoZWxlKSA9PiAodGhpcy5pdGVtVXJsUmVmID0gZWxlKSB9KSwgaChcImFyY2dpcy1zZWxlY3RcIiwgeyByZWY6IChlbGUpID0+ICh0aGlzLnNlbGVjdFJlZiA9IGVsZSksIGVtcHR5VGV4dDogaTE4bi51bmRldGVjdGVkLCBzZWxlY3RlZE9wdGlvbjogc2VsZWN0ZWRPcHRpb24sIG9wdGlvbnM6IHRoaXMub3B0aW9ucywgbGFiZWw6IGkxOG4ubGFiZWwsIG9uQXJjZ2lzT3B0aW9uQ2hhbmdlOiAoZXZlbnQpID0+IHRoaXMuY2hhbmdlT3B0aW9uKGV2ZW50LmRldGFpbCkgfSksIHNob3dDdXN0b21QYXJhbWV0ZXJzICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY3VzdG9tLXBhcmFtLWNvbnRhaW5lclwiIH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tY3VzdG9tLXBhcmFtZXRlcnNcIiwgeyBpdGVtVHlwZTogdXJsRGF0YS50eXBlIH0pKSksICEhdXNlciAmJiBpc1NlY3VyZWQgJiYgYWxsb3dTdG9yZWRBdXRoICYmIChoKFwiYXJjZ2lzLW5ldy1pdGVtLXN3aXRjaC1jYXJkXCIsIHsgb25Td2l0Y2hDaGFuZ2U6IHRoaXMuaGFuZGxlQXV0aFN3aXRjaENoYW5nZSwgaGVhZGVyOiBpMThuW2FkZERpcmVjdFRvTWFwID8gXCJzdG9yZUF1dGhNVlwiIDogXCJzdG9yZUF1dGhcIl0sIGhlYWRlckxpbms6IHsgdGV4dDogaTE4bi5sZWFybk1vcmUsIGhyZWY6IGAke2hlbHBCYXNlfSR7aGVscE1hcFtcIjEyMDAwMDU5N1wiXX1gIH0sIGRlZmF1bHRDaGVja2VkOiB0aGlzLnVybERhdGEuc3RvcmVBdXRoIH0pKSwgdGhpcy5zaG93QWRkVG9NYXAoKSAmJiAoaChcImFyY2dpcy1uZXctaXRlbS1zd2l0Y2gtY2FyZFwiLCB7IGhlYWRlcjogaTE4bi51c2VBc0Jhc2VNYXAsIGRlZmF1bHRDaGVja2VkOiBhZGRBc0Jhc2VtYXAsIG9uU3dpdGNoQ2hhbmdlOiAodG9nZ2xlZCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFkZEFzQmFzZW1hcCA9IHRvZ2dsZWQuZGV0YWlsO1xuICAgICAgICAgICAgICAgIHVybERhdGEuYWRkQXNCYXNlbWFwID0gYWRkQXNCYXNlbWFwO1xuICAgICAgICAgICAgICAgIGRldGVybWluZU5leHRUZXh0KCk7XG4gICAgICAgICAgICB9IH0pKSkpO1xuICAgIH1cbiAgICBnZXQgZWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcImxvYWRpbmdcIjogW1wiaGFuZGxlTG9hZENoYW5nZVwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNVcmxUeXBlLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzVXJsVHlwZUNzcztcblxuLy8gTWFwIHppcCBmaWxlIG9wdGlvbnMgdG8gdGhlaXIgdGVsZW1ldHJ5IGRldGFpbCBjb3VudGVycGFydHNcbnZhciBaaXBGaWxlVGVsZW1ldHJ5O1xuKGZ1bmN0aW9uIChaaXBGaWxlVGVsZW1ldHJ5KSB7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIlNoYXBlZmlsZVwiXSA9IFwic2hhcGVmaWxlXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIkZpbGUgR2VvZGF0YWJhc2VcIl0gPSBcImZnZGJcIjtcbiAgICBaaXBGaWxlVGVsZW1ldHJ5W1wiUGhvdG9zIHdpdGggTG9jYXRpb25zXCJdID0gXCJnZW90YWdnZWQgcGhvdG9zXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIkRlZXAgTGVhcm5pbmcgUGFja2FnZVwiXSA9IFwiZGVlcCBsZWFybmluZyBwYWNrYWdlXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIk1hcCBUZW1wbGF0ZVwiXSA9IFwibWFwIHRlbXBsYXRlXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIkNBRCBEcmF3aW5nXCJdID0gXCJjYWRcIjtcbiAgICBaaXBGaWxlVGVsZW1ldHJ5W1wiQ1NWIENvbGxlY3Rpb25cIl0gPSBcImNzdiBjb2xsZWN0aW9uXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIktNTCBDb2xsZWN0aW9uXCJdID0gXCJrbWwgY29sbGVjdGlvblwiO1xuICAgIFppcEZpbGVUZWxlbWV0cnlbXCJEZXNrdG9wIEFwcGxpY2F0aW9uIFRlbXBsYXRlXCJdID0gXCJkZXNrdG9wIGFwcCB0ZW1wbGF0ZVwiO1xuICAgIFppcEZpbGVUZWxlbWV0cnlbXCJHZW9wcm9jZXNzaW5nIFNhbXBsZVwiXSA9IFwiZ2VvcHJvY2Vzc2luZyBzYW1wbGVcIjtcbiAgICBaaXBGaWxlVGVsZW1ldHJ5W1wiQ29kZSBTYW1wbGVcIl0gPSBcImNvZGUgc2FtcGxlXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcIkFyY1BhZCBQYWNrYWdlXCJdID0gXCJhcmNwYWQgcGFja2FnZVwiO1xuICAgIFppcEZpbGVUZWxlbWV0cnlbXCJBcHBCdWlsZGVyIFdpZGdldCBQYWNrYWdlXCJdID0gXCJ3YWIgY3VzdG9tIHdpZGdldFwiO1xuICAgIFppcEZpbGVUZWxlbWV0cnlbXCJJbWFnZSBDb2xsZWN0aW9uXCJdID0gXCJpbWFnZSBjb2xsZWN0aW9uXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcImlXb3JrIFBhZ2VzXCJdID0gXCJpd29yayBwYWdlc1wiO1xuICAgIFppcEZpbGVUZWxlbWV0cnlbXCJpV29yayBOdW1iZXJzXCJdID0gXCJpd29yayBudW1iZXJzXCI7XG4gICAgWmlwRmlsZVRlbGVtZXRyeVtcImlXb3JrIEtleW5vdGVcIl0gPSBcIml3b3JrIGtleW5vdGVcIjtcbiAgICBaaXBGaWxlVGVsZW1ldHJ5W1wiR01MXCJdID0gXCJnbWxcIjtcbiAgICBaaXBGaWxlVGVsZW1ldHJ5W1wiQXBwbGljYXRpb25cIl0gPSBcImFwcGxpY2F0aW9uXCI7XG59KShaaXBGaWxlVGVsZW1ldHJ5IHx8IChaaXBGaWxlVGVsZW1ldHJ5ID0ge30pKTtcblxuY29uc3QgY29kZVNhbXBsZUxhbmd1YWdlcyA9IFtcbiAgICBcIkNcIixcbiAgICBcIkMjXCIsXG4gICAgXCJDKytcIixcbiAgICBcIkphdmFcIixcbiAgICBcIlBlcmxcIixcbiAgICBcIlBIUFwiLFxuICAgIFwiUHl0aG9uXCIsXG4gICAgXCJSdWJ5XCIsXG4gICAgXCJTUUxcIixcbiAgICBcIlZCXCIsXG4gICAgXCJXUEZcIixcbiAgICBcIk90aGVyXCJcbl07XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc1ppcFNlbGVjdENzcyA9IFwiOmhvc3R7cGFkZGluZy1ib3R0b206MnJlbTttaW4taGVpZ2h0OjQ2MHB4fS5maWxle21hcmdpbjowcHg7cGFkZGluZzowcHg7Zm9udC1zaXplOjAuODc1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0ubGFiZWx7bWFyZ2luLWJvdHRvbTowLjc1cmVtO21hcmdpbi10b3A6MHB4O2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO2xpbmUtaGVpZ2h0OjE4cHh9LmxhYmVsLS10b3B7bWFyZ2luLXRvcDoxLjVyZW07ZGlzcGxheTpibG9ja30udHJhaWxlci0we21hcmdpbi1ib3R0b206MHB4fVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNaaXBTZWxlY3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVXBkYXRlUGFnZVwiLCA3KTtcbiAgICAgICAgdGhpcy5pdGVtVHlwZXMgPSBbXTtcbiAgICAgICAgdGhpcy51cGRhdGVIb3N0ZWRTdGF0dXMgPSAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wdWJsaXNoID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gZXZlbnQuZGV0YWlsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gXCJTaGFwZWZpbGVcIjtcbiAgICAgICAgdGhpcy5wdWJsaXNoID0gXCJob3N0ZWRcIjtcbiAgICAgICAgdGhpcy5sYW5ndWFnZSA9IFwiQ1wiO1xuICAgICAgICB0aGlzLnBhZCA9IFwicHJvamVjdFwiO1xuICAgICAgICB0aGlzLmkxOG4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXRlbUluZm9JMThOID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBoYW5kbGVOZXh0KCkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuc2VsZWN0ZWQgPT09IFwiUGhvdG9zIHdpdGggTG9jYXRpb25zXCIgPyBcIkltYWdlIENvbGxlY3Rpb25cIiA6IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcIkFwcGxpY2F0aW9uXCIpIHtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5uZXdJdGVtTW9kZSA9IFwiYXBwbGljYXRpb25cIjtcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UuZW1pdChcImFwcGxpY2F0aW9uXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdHlwZSwgdHlwZUtleXdvcmRzLCB0aHVtYm5haWxVUkwgfSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1tzZWxlY3RlZF07XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcIkFyY1BhZCBQYWNrYWdlXCIpIHtcbiAgICAgICAgICAgIHR5cGVLZXl3b3Jkcy5wdXNoKHRoaXMucGFkID09PSBcInByb2plY3RcIiA/IFwiQXJjUGFkIFByb2plY3RcIiA6IFwiQXJjUGFkIFRlbXBsYXRlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcIkNvZGUgU2FtcGxlXCIpIHtcbiAgICAgICAgICAgIHR5cGVLZXl3b3Jkcy5wdXNoKHRoaXMubGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkID09PSBcIlBob3RvcyB3aXRoIExvY2F0aW9uc1wiKSB7XG4gICAgICAgICAgICB0eXBlS2V5d29yZHMucHVzaChcIlBob3RvIGxvY2F0aW9uc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPSBcImZpbGVcIjtcbiAgICAgICAgYWRkSXRlbVN0YXRlLnR5cGUgPSB0eXBlO1xuICAgICAgICBhZGRJdGVtU3RhdGUudHlwZUtleXdvcmRzID0gdHlwZUtleXdvcmRzO1xuICAgICAgICBhZGRJdGVtU3RhdGUudGh1bWJuYWlsVVJMID0gdGh1bWJuYWlsVVJMO1xuICAgICAgICBhZGRJdGVtU3RhdGUuZW5hYmxlUHVibGlzaGluZyA9XG4gICAgICAgICAgICB0aGlzLnB1Ymxpc2ggPT09IFwiaG9zdGVkXCIgJiYgdGhpcy5jYW5QdWJsaXNoWmlwVHlwZSgpICYmIGNvbmZpZ1N0YXRlLmFsbG93UHVibGlzaDtcbiAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KFwiaXRlbVByb3BlcnRpZXNcIik7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi56aXBTZWxlY3Q7XG4gICAgICAgIHRoaXMuaXRlbUluZm9JMThOID0gdWlTdG9yZVN0YXRlLmkxOG4uaXRlbVR5cGVJbmZvO1xuICAgICAgICBjb25zdCB7IHBvcnRhbCwgdXNlciB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGlmICghaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSkge1xuICAgICAgICAgICAgdGhpcy5wdWJsaXNoID0gXCJub3QtaG9zdGVkXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2lzUHVibGljVXNlciA9IGlzUHVibGljVXNlcih1c2VyKTtcbiAgICAgICAgY29uc3QgaXNFbnRlcnByaXNlID0gcG9ydGFsLmlzUG9ydGFsO1xuICAgICAgICB0aGlzLml0ZW1UeXBlcyA9IFtcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiU2hhcGVmaWxlXCIsIGljb246IFwiZmlsZS16aXBcIiwgcHVibGlzaGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiRmlsZSBHZW9kYXRhYmFzZVwiLCBpY29uOiBcImRhdGFcIiwgcHVibGlzaGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiUGhvdG9zIHdpdGggTG9jYXRpb25zXCIsIGljb246IFwiaW1hZ2VzXCIsIHB1Ymxpc2hhYmxlOiB0cnVlLCBoaWRlOiBpc0VudGVycHJpc2UgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiRGVlcCBMZWFybmluZyBQYWNrYWdlXCIsIGljb246IFwiZGVlcC1sZWFybmluZ1wiIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIk1hcCBUZW1wbGF0ZVwiLCBpY29uOiBcImZpbGUtemlwXCIgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiQ0FEIERyYXdpbmdcIiwgaWNvbjogXCJmaWxlLWNhZFwiIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIkNTViBDb2xsZWN0aW9uXCIsIGljb246IFwiZmlsZS1jc3ZcIiB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJLTUwgQ29sbGVjdGlvblwiLCBpY29uOiBcImxheWVyLWttbFwiIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIkRlc2t0b3AgQXBwbGljYXRpb24gVGVtcGxhdGVcIiwgaWNvbjogXCJmaWxlLXppcFwiIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIkdlb3Byb2Nlc3NpbmcgU2FtcGxlXCIsIGljb246IFwiaGFtbWVyXCIgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6IFwiQ29kZSBTYW1wbGVcIiwgaWNvbjogXCJmaWxlLWNvZGVcIiB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJBcmNQYWQgUGFja2FnZVwiLCBpY29uOiBcImN1YmVcIiB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJBcHBCdWlsZGVyIFdpZGdldCBQYWNrYWdlXCIsIGljb246IFwiYXBwLWdlYXJcIiwgaGlkZTogX2lzUHVibGljVXNlciB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJJbWFnZSBDb2xsZWN0aW9uXCIsIGljb246IFwiY29sbGVjdGlvblwiLCBoaWRlOiBfaXNQdWJsaWNVc2VyIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiBcIkdNTFwiLCBpY29uOiBcImNvZGVcIiwgaGlkZTogX2lzUHVibGljVXNlciB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogXCJBcHBsaWNhdGlvblwiLCBpY29uOiBcImFwcHNcIiwgaGlkZTogX2lzUHVibGljVXNlciB9XG4gICAgICAgIF07XG4gICAgICAgIC8vIEFkZCB0byBNVjogVHJpbSBkb3duIHNlbGVjdGFibGUgbGlzdCB0byBkZWZpbmVkIGFsbG93ZWRJdGVtVHlwZXMsIG90aGVyd2lzZSBhY2NlcHQgYWxsXG4gICAgICAgIGlmICghIWNvbmZpZ1N0YXRlLmFsbG93ZWRJdGVtVHlwZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbVR5cGVzID0gdGhpcy5pdGVtVHlwZXMuZmlsdGVyKChpdGVtKSA9PiBjb25maWdTdGF0ZS5hbGxvd2VkSXRlbVR5cGVzLmluY2x1ZGVzKGl0ZW0udmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXBsYWNlVHlwZUFuZE5hbWUoc3RyLCBmaWxlTmFtZSkge1xuICAgICAgICBjb25zdCBuYW1lUmVnRXggPSBuZXcgUmVnRXhwKC9cXCRcXHtmaWxlTmFtZVxcfS9nKTtcbiAgICAgICAgY29uc3QgdHlwZVJlZ0V4ID0gbmV3IFJlZ0V4cCgvXFwkXFx7dHlwZVxcfS9nKTtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKHR5cGVSZWdFeCwgdGhpcy5zZWxlY3RlZCkucmVwbGFjZShuYW1lUmVnRXgsIGZpbGVOYW1lKTtcbiAgICB9XG4gICAgY2FuUHVibGlzaFppcFR5cGUoKSB7XG4gICAgICAgIGNvbnN0IHsgdXNlciwgcG9ydGFsIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtVHlwZSA9IHRoaXMuaXRlbVR5cGVzLmZpbmQoKGl0ZW1UeXBlKSA9PiBpdGVtVHlwZS52YWx1ZSA9PT0gdGhpcy5zZWxlY3RlZCk7XG4gICAgICAgIHJldHVybiBzZWxlY3RlZEl0ZW1UeXBlLnB1Ymxpc2hhYmxlICYmIGNhblB1Ymxpc2hUeXBlKHVzZXIsIHNlbGVjdGVkSXRlbVR5cGUudmFsdWUsIHBvcnRhbCk7XG4gICAgfVxuICAgIHJlbmRlclB1Ymxpc2goKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgaXRlbUluZm9JMThOIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IGZpbGVUeXBlID0gaXRlbUluZm9JMThOLmxvd2VyY2FzZURpc3BsYXlOYW1lW3RoaXMuc2VsZWN0ZWRdO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IFtcImhvc3RlZFwiLCBcIm5vdC1ob3N0ZWRcIl07XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLmZpbHRlcigob3B0aW9uKSA9PiBvcHRpb24gIT09IFwiaG9zdGVkXCIgfHwgaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcInRyYWlsZXItMFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWwgbGFiZWwtLXRvcFwiIH0sIHJlcGxhY2VJMThOU3RyaW5nKGl0ZW1JbmZvSTE4Ti5ob3dUb0FkZCwgZmlsZVR5cGUsIFwiZmlsZVR5cGVcIikpKSwgaChcImNhbGNpdGUtdGlsZS1zZWxlY3QtZ3JvdXBcIiwgeyBsYXlvdXQ6IFwidmVydGljYWxcIiB9LCBvcHRpb25zLm1hcCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRpbmcgPSByZXBsYWNlSTE4TlN0cmluZyh2YWx1ZSA9PT0gXCJob3N0ZWRcIiA/IGkxOG5bdmFsdWVdLmhlYWRpbmcgOiBpdGVtSW5mb0kxOE4ubm9uSG9zdGVkVGl0bGUsIGFkZEl0ZW1TdGF0ZS5maWxlTmFtZSwgXCJmaWxlTmFtZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gcmVwbGFjZUkxOE5TdHJpbmcodmFsdWUgPT09IFwiaG9zdGVkXCIgPyBpMThuW3ZhbHVlXS5kZXNjcmlwdGlvbiA6IGl0ZW1JbmZvSTE4Ti5ub25Ib3N0ZWREZXNjcmlwdGlvbiwgZmlsZVR5cGUsIFwiZmlsZVR5cGVcIik7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRpbGUtc2VsZWN0XCIsIHsgY2hlY2tlZDogdGhpcy5wdWJsaXNoID09PSB2YWx1ZSwgd2lkdGg6IFwiZnVsbFwiLCBcImlucHV0LWVuYWJsZWRcIjogdHJ1ZSwgXCJpbnB1dC1hbGlnbm1lbnRcIjogXCJzdGFydFwiLCBuYW1lOiBcInB1Ymxpc2hcIiwgdmFsdWU6IHZhbHVlLCBvbkNhbGNpdGVUaWxlU2VsZWN0Q2hhbmdlOiB0aGlzLnVwZGF0ZUhvc3RlZFN0YXR1cywgaGVhZGluZzogaGVhZGluZywgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIH0pKTtcbiAgICAgICAgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckxhbmd1YWdlcygpIHtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VzID0gY29kZVNhbXBsZUxhbmd1YWdlcy5tYXAoKHZhbHVlKSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IHZhbHVlLCBzZWxlY3RlZDogdGhpcy5sYW5ndWFnZSA9PT0gdmFsdWUgfSwgdmFsdWUgPT09IFwiT3RoZXJcIiA/IHRoaXMuaTE4bi5vdGhlciA6IHZhbHVlKSkpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsga2V5OiBcImxhbmd1YWdlLWxhYmVsXCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJsYWJlbCBsYWJlbC0tdG9wXCIgfSwgdGhpcy5pMThuLmxhbmd1YWdlKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IHRoaXMuaTE4bi5sYW5ndWFnZSwgd2lkdGg6IFwiaGFsZlwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2VTZWxlY3QgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKCkgPT4gKHRoaXMubGFuZ3VhZ2UgPSB0aGlzLmxhbmd1YWdlU2VsZWN0LnNlbGVjdGVkT3B0aW9uLnZhbHVlKSB9LCBsYW5ndWFnZXMpKSk7XG4gICAgfVxuICAgIHJlbmRlclBhZCgpIHtcbiAgICAgICAgY29uc3QgcGFkT3B0aW9ucyA9IFtcInByb2plY3RcIiwgXCJ0ZW1wbGF0ZVwiXS5tYXAoKHZhbHVlKSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IHZhbHVlLCBzZWxlY3RlZDogdGhpcy5wYWQgPT09IHZhbHVlIH0sIHRoaXMuaTE4bi5BcmNQYWRbdmFsdWVdKSkpO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsga2V5OiBcInBhZC1sYWJlbFwiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWwgbGFiZWwtLXRvcFwiIH0sIHRoaXMuaTE4bi50eXBlKSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwiXCIsIHdpZHRoOiBcImhhbGZcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhZFNlbGVjdCA9IGVsO1xuICAgICAgICAgICAgfSwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoKSA9PiAodGhpcy5wYWQgPSB0aGlzLnBhZFNlbGVjdC5zZWxlY3RlZE9wdGlvbi52YWx1ZSkgfSwgcGFkT3B0aW9ucykpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGZpbGVOYW1lIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLml0ZW1UeXBlc1xuICAgICAgICAgICAgLmZpbHRlcigoaXRlbSkgPT4gIWl0ZW0uaGlkZSlcbiAgICAgICAgICAgIC5tYXAoKHsgdmFsdWUsIGljb24gfSkgPT4gKHtcbiAgICAgICAgICAgIG9wdGlvblRpdGxlOiB0aGlzLmkxOG5bdmFsdWVdLnRpdGxlLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuW3ZhbHVlXS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGljb25cbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgbnVsbCwgaChcImg0XCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCB0aGlzLmkxOG4uZmlsZSksIGgoXCJwXCIsIHsgY2xhc3M6IFwiZmlsZVwiIH0sIGZpbGVOYW1lKSwgaChcImFyY2dpcy1zZWxlY3RcIiwgeyBjbGFzczogXCJsYWJlbC0tdG9wXCIsIHNlbGVjdGVkT3B0aW9uOiB0aGlzLnNlbGVjdGVkLCBvcHRpb25zOiBvcHRpb25zLCBsYWJlbDogdGhpcy5pMThuLml0ZW1UeXBlLCBvbkFyY2dpc09wdGlvbkNoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBMb2cgd2hpY2ggdHlwZSBvZiB6aXAgZmlsZSB3YXMgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRUeXBlOiBcIm90aGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOYW1lOiBcIm15IGNvbnRlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IFwibmV3IGl0ZW0gemlwIGl0ZW0gdHlwZVwiLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogWmlwRmlsZVRlbGVtZXRyeVtlLmRldGFpbF1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5sb2dFdmVudChwYXlsb2FkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gZS5kZXRhaWw7XG4gICAgICAgICAgICB9IH0pLCB0aGlzLmNhblB1Ymxpc2haaXBUeXBlKCkgJiZcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS53b3JrZmxvdyAhPT0gXCJtYXBcIiAmJlxuICAgICAgICAgICAgY29uZmlnU3RhdGUuYWxsb3dQdWJsaXNoICYmXG4gICAgICAgICAgICB0aGlzLnJlbmRlclB1Ymxpc2goKSwgdGhpcy5zZWxlY3RlZCA9PT0gXCJDb2RlIFNhbXBsZVwiICYmIHRoaXMucmVuZGVyTGFuZ3VhZ2VzKCksIHRoaXMuc2VsZWN0ZWQgPT09IFwiQXJjUGFkIFBhY2thZ2VcIiAmJiB0aGlzLnJlbmRlclBhZCgpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNOZXdJdGVtUGFnZXNaaXBTZWxlY3Quc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNaaXBTZWxlY3RDc3M7XG5cbmNvbnN0IHRpbWVab25lSWRzID0ge1xuICAgIDA6IFwiRGF0ZWxpbmUgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIwMDogXCJIYXdhaWlhbiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMzAwOiBcIkFsYXNrYW4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDQwMDogXCJQYWNpZmljIFN0YW5kYXJkIFRpbWVcIixcbiAgICA0MTA6IFwiUGFjaWZpYyBTdGFuZGFyZCBUaW1lIChNZXhpY28pXCIsXG4gICAgNTIwOiBcIlVTIE1vdW50YWluIFN0YW5kYXJkIFRpbWVcIixcbiAgICA1MTA6IFwiTW91bnRhaW4gU3RhbmRhcmQgVGltZSAoTWV4aWNvKVwiLFxuICAgIDUwMDogXCJNb3VudGFpbiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgNjEwOiBcIkNlbnRyYWwgQW1lcmljYSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgNjIwOiBcIkNlbnRyYWwgU3RhbmRhcmQgVGltZVwiLFxuICAgIDYzMDogXCJDZW50cmFsIFN0YW5kYXJkIFRpbWUgKE1leGljbylcIixcbiAgICA2MDA6IFwiQ2FuYWRhIENlbnRyYWwgU3RhbmRhcmQgVGltZVwiLFxuICAgIDcxMDogXCJTQSBQYWNpZmljIFN0YW5kYXJkIFRpbWVcIixcbiAgICA3MDA6IFwiRWFzdGVybiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgNzIwOiBcIlVTIEVhc3Rlcm4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDczMDogXCJWZW5lenVlbGEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDg1MDogXCJQYXJhZ3VheSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgODAwOiBcIkF0bGFudGljIFN0YW5kYXJkIFRpbWVcIixcbiAgICA4MTA6IFwiQ2VudHJhbCBCcmF6aWxpYW4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDgzMDogXCJTQSBXZXN0ZXJuIFN0YW5kYXJkIFRpbWVcIixcbiAgICA4MjA6IFwiUGFjaWZpYyBTQSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgOTAwOiBcIk5ld2ZvdW5kbGFuZCBTdGFuZGFyZCBUaW1lXCIsXG4gICAgOTEwOiBcIkUuIFNvdXRoIEFtZXJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICAgIDk1MDogXCJBcmdlbnRpbmEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDk0MDogXCJTQSBFYXN0ZXJuIFN0YW5kYXJkIFRpbWVcIixcbiAgICA5MjA6IFwiR3JlZW5sYW5kIFN0YW5kYXJkIFRpbWVcIixcbiAgICA5MzA6IFwiTW9udGV2aWRlbyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTAxMDogXCJVVEMtMDJcIixcbiAgICAxMDAwOiBcIk1pZC1BdGxhbnRpYyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTEwMDogXCJBem9yZXMgU3RhbmRhcmQgVGltZVwiLFxuICAgIDExMTA6IFwiQ2FwZSBWZXJkZSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTIyMDogXCJNb3JvY2NvIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxMjMwOiBcIlVUQ1wiLFxuICAgIDEyMDA6IFwiR01UIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxMjEwOiBcIkdyZWVud2ljaCBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTM0MDogXCJXLiBFdXJvcGUgU3RhbmRhcmQgVGltZVwiLFxuICAgIDEzMDA6IFwiQ2VudHJhbCBFdXJvcGUgU3RhbmRhcmQgVGltZVwiLFxuICAgIDEzMjA6IFwiUm9tYW5jZSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTMxMDogXCJDZW50cmFsIEV1cm9wZWFuIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxMzMwOiBcIlcuIENlbnRyYWwgQWZyaWNhIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxMzUwOiBcIk5hbWliaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE0MzA6IFwiR1RCIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNDYwOiBcIk1pZGRsZSBFYXN0IFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNDEwOiBcIkVneXB0IFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNDgwOiBcIlN5cmlhIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNDAwOiBcIkUuIEV1cm9wZSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTQ3MDogXCJTb3V0aCBBZnJpY2EgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE0MjA6IFwiRkxFIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNDkwOiBcIlR1cmtleSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTQ0MDogXCJJc3JhZWwgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE0NTA6IFwiSm9yZGFuIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNTEwOiBcIkFyYWJpYyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTUzMDogXCJLYWxpbmluZ3JhZCBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTUwMDogXCJBcmFiIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNTIwOiBcIkUuIEFmcmljYSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTUzNTogXCJJcmFuIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNjAwOiBcIkFyYWJpYW4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDE2MTA6IFwiQXplcmJhaWphbiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTU0MDogXCJSdXNzaWFuIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNjUwOiBcIk1hdXJpdGl1cyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTY0MDogXCJHZW9yZ2lhbiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTYyMDogXCJDYXVjYXN1cyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTY2MDogXCJBZmdoYW5pc3RhbiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTcxMDogXCJXZXN0IEFzaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE3MTU6IFwiUGFraXN0YW4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDE3MjA6IFwiSW5kaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE3MzA6IFwiU3JpIExhbmthIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNzQwOiBcIk5lcGFsIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxODAwOiBcIkNlbnRyYWwgQXNpYSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTgxMDogXCJCYW5nbGFkZXNoIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxNzU1OiBcIkVrYXRlcmluYnVyZyBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMTgyMDogXCJNeWFubWFyIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxOTAwOiBcIlNFIEFzaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDE4MzA6IFwiTi4gQ2VudHJhbCBBc2lhIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMDAwOiBcIkNoaW5hIFN0YW5kYXJkIFRpbWVcIixcbiAgICAxOTEwOiBcIk5vcnRoIEFzaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIwMjA6IFwiU2luZ2Fwb3JlIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMDQwOiBcIlcuIEF1c3RyYWxpYSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMjAzMDogXCJUYWlwZWkgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIwNTA6IFwiVWxhYW5iYWF0YXIgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIwNjA6IFwiTm9ydGggQXNpYSBFYXN0IFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMTEwOiBcIlRva3lvIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMTAwOiBcIktvcmVhIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMTQwOiBcIkNlbi4gQXVzdHJhbGlhIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMTMwOiBcIkFVUyBDZW50cmFsIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMjEwOiBcIkUuIEF1c3RyYWxpYSBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMjIwMDogXCJBVVMgRWFzdGVybiBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMjI0MDogXCJXZXN0IFBhY2lmaWMgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIyMjA6IFwiVGFzbWFuaWEgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIxNTA6IFwiWWFrdXRzayBTdGFuZGFyZCBUaW1lXCIsXG4gICAgMjMwMDogXCJDZW50cmFsIFBhY2lmaWMgU3RhbmRhcmQgVGltZVwiLFxuICAgIDIyNTA6IFwiVmxhZGl2b3N0b2sgU3RhbmRhcmQgVGltZVwiLFxuICAgIDI0MTA6IFwiTmV3IFplYWxhbmQgU3RhbmRhcmQgVGltZVwiLFxuICAgIDI0MzA6IFwiVVRDKzEyXCIsXG4gICAgMjQwMDogXCJGaWppIFN0YW5kYXJkIFRpbWVcIixcbiAgICAyMzEwOiBcIk1hZ2FkYW4gU3RhbmRhcmQgVGltZVwiLFxuICAgIDI1MDA6IFwiVG9uZ2EgU3RhbmRhcmQgVGltZVwiLFxuICAgIDEyMDogXCJTYW1vYSBTdGFuZGFyZCBUaW1lXCJcbn07XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duQ3NzID0gXCIubGFiZWx7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7bGluZS1oZWlnaHQ6MThweDttYXJnaW4tYm90dG9tOjZweH0uaGFzLXN1YnRpdGxle21hcmdpbi1ib3R0b206MHB4O2ZvbnQtc2l6ZToxcmVtfS5zdWItbGFiZWx7Zm9udC1zaXplOjAuNzVyZW19Omhvc3R7bWFyZ2luLWJvdHRvbToxLjVyZW19XCI7XG5cbmNvbnN0IEFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy50aW1lem9uZUNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidGltZXpvbmVDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBcIjEyMzBcIjtcbiAgICAgICAgdGhpcy5zdWJUaXRsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kZWZhdWx0VGltZXpvbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLnRpbWV6b25lRHJvcGRvd247XG4gICAgICAgIGNvbnN0IHsgZGVmYXVsdFRpbWV6b25lIH0gPSB0aGlzO1xuICAgICAgICBpZiAoZGVmYXVsdFRpbWV6b25lKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlkIGluIHRpbWVab25lSWRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRUaW1lem9uZSA9PT0gdGltZVpvbmVJZHNbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBpMThuLCBzZWxlY3RlZCwgdGltZXpvbmVDaGFuZ2UsIHN1YlRpdGxlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwibGFiZWxcIiB9LCAhc3ViVGl0bGUgJiYgaTE4bi50aXRsZSksICFzdWJUaXRsZSAmJiBoKFwic3BhblwiLCB7IGNsYXNzOiBcInN1Yi1sYWJlbFwiIH0sIGkxOG4uc3ViVGl0bGUpLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGltZVpvbmVJZHNbdmFsdWVdIHx8IHZhbHVlO1xuICAgICAgICAgICAgICAgIHRpbWV6b25lQ2hhbmdlLmVtaXQoaWQpO1xuICAgICAgICAgICAgfSwgd2lkdGg6IFwiaGFsZlwiLCBsYWJlbDogXCJ0aW1lem9uZS1zZWxlY3RcIiwgc2VsZWN0ZWRPcHRpb246IHNlbGVjdGVkIH0sIE9iamVjdC5rZXlzKGkxOG4udGltZXpvbmVzKS5tYXAoKGNvZGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWV6b25lID0gaTE4bi50aW1lem9uZXNbY29kZV07XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHNlbGVjdGVkOiBjb2RlID09PSBzZWxlY3RlZCwgdmFsdWU6IGNvZGUgfSwgdGltZXpvbmUpKTtcbiAgICAgICAgfSkpLCBzdWJUaXRsZSAmJiBoKFwic3BhblwiLCB7IGNsYXNzOiBcInN1Yi1sYWJlbFwiIH0sIHN1YlRpdGxlKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVRpbWV6b25lRHJvcGRvd24uc3R5bGUgPSBhcmNnaXNOZXdJdGVtVGltZXpvbmVEcm9wZG93bkNzcztcblxuY29uc3QgYXJjZ2lzTmV3SXRlbVVybENzcyA9IFwiLnVybC1maWVsZHttYXJnaW4tYm90dG9tOjFyZW19LmhlbHAtdGV4dHttYXJnaW4tdG9wOjAuMjVyZW07bWFyZ2luLWJvdHRvbTowLjVyZW07Zm9udC1zaXplOjAuODc1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtVXJsID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy51cmxJbnB1dEFkZEFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwidXJsSW5wdXRBZGRBY3Rpb25cIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1VcmxDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcmxDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMudXJsTG9hZGVyVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJ1cmxMb2FkZXJVcGRhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMuZGVib3VuY2VkSW5wdXQgPSBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVybElucHV0QWRkSGFuZGxlcigpO1xuICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgdGhpcy5pbnB1dFRpdGxlID0gXCJcIjtcbiAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0aGlzLmhlYWRlclNjYWxlID0gXCJzXCI7XG4gICAgICAgIHRoaXMuc3VwcG9ydGVkU2VydmljZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXJsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gXCJodHRwczovL1wiO1xuICAgICAgICB0aGlzLnJlcXVpcmVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2VBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnB1dFN0YXR1cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBpMThuID0gdWlTdG9yZVN0YXRlLmkxOG47XG4gICAgICAgIHRoaXMuaTE4biA9IGkxOG4udXJsO1xuICAgICAgICBpZiAoKChfYSA9IHRoaXMuc3VwcG9ydGVkU2VydmljZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nID0gdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHR5cGUpID0+IGlzVXJsVHlwZSh0eXBlKSlcbiAgICAgICAgICAgICAgICAubWFwKCh0eXBlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSBpc0FHUyh0eXBlKSA/IFwiQUdTXCIgOiB0eXBlO1xuICAgICAgICAgICAgICAgIHJldHVybiAoKF9iID0gKF9hID0gaTE4bi5pdGVtVHlwZUluZm8ubXZUZXh0W29wdGlvbl0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGkxOG4uaXRlbVR5cGVJbmZvLmxvd2VyY2FzZURpc3BsYXlOYW1lW29wdGlvbl0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHR5cGUpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuam9pbihcIiwgXCIpO1xuICAgICAgICAgICAgdGhpcy5oZWxwVGV4dCA9IHJlcGxhY2VJMThOU3RyaW5nKGkxOG4uY29tbW9uLnN1cHBvcnRMYXllclR5cGVzLCB0aGlzLnN1cHBvcnRlZFNlcnZpY2VTdHJpbmcsIFwidHlwZUxpc3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBzdGF0ZVxuICAgICAgICB0aGlzLmlucHV0U3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgIHRoaXMuaW5wdXRNZXNzYWdlQWN0aXZlID0gdGhpcy5pbnB1dE1lc3NhZ2UubGVuZ3RoID4gMDtcbiAgICAgICAgaWYgKCF0aGlzLmlucHV0VGl0bGUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRUaXRsZSA9IHRoaXMuaTE4bi51cmw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgZm9jdXNNYWluSW5wdXQoKSB7XG4gICAgICAgIHRoaXMubWFpbklucHV0UmVmLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGFzeW5jIHZhbGlkYXRlSW5wdXQoKSB7XG4gICAgICAgIGNvbnN0IHsgdXJsLCByZXF1aXJlZCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5yZXNldFZhbGlkYXRpb24oKTtcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRJbnB1dC5pbnZva2UoKTtcbiAgICAgICAgaWYgKCF1cmwgJiYgIXJlcXVpcmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVybExvYWRlclVwZGF0ZS5lbWl0KGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXVybCkge1xuICAgICAgICAgICAgdGhpcy51cmxMb2FkZXJVcGRhdGUuZW1pdChmYWxzZSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRFcnJvcihcImludmFsaWRVcmxcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzSHR0cCh1cmwsIGNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCkpIHtcbiAgICAgICAgICAgIHRoaXMudXJsTG9hZGVyVXBkYXRlLmVtaXQoZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0RXJyb3IoXCJodHRwV2FybmluZ1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgICAgIHRoaXMuaW5wdXRTdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2VBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgdXJsSW5wdXRBZGRIYW5kbGVyKCkge1xuICAgICAgICBpZiAoIXRoaXMudXJsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cmxMb2FkZXJVcGRhdGUuZW1pdCh0cnVlKTtcbiAgICAgICAgY29uc3QgeyBpc1BvcnRhbCwgYWxsU1NMIH0gPSBjb25maWdTdGF0ZS5wb3J0YWw7XG4gICAgICAgIHRoaXMudXJsID0gZm9ybWF0VXJsKHRoaXMudXJsLCBhbGxTU0wpO1xuICAgICAgICBjb25zdCB7IHJlc3VsdDogdHlwZSwgZXJyb3IgfSA9IGdldFVybFR5cGUodGhpcy51cmwsIGlzUG9ydGFsKTtcbiAgICAgICAgaWYgKHR5cGUgIT09IFwiS01MXCIpIHtcbiAgICAgICAgICAgIC8vIEtNTCBoYXMgYSBzZXBhcmF0ZSBuYW1lIGZpZWxkXG4gICAgICAgICAgICBpdGVtUHJvcGVydGllc1N0YXRlLnRpdGxlID0gdXJsVG9UaXRsZSh0aGlzLnVybCkucmVwbGFjZShzcGVjaWFsQ2hhcmFjdGVyc1JlZ0V4cCwgXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cmxMb2FkZXJVcGRhdGUuZW1pdChmYWxzZSk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5zZXRFcnJvcihlcnJvci5jb2RlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmV3SXRlbVVybENoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEVycm9yKGNvZGUpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBzdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nID0gdGhpcy5zdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nO1xuICAgICAgICBjb25zdCBpbnB1dE1lc3NhZ2UgPSAoY29kZSA9PT0gXCJpbnZhbGlkVXJsXCIgJiYgc3VwcG9ydGVkU2VydmljZVN0cmluZ1xuICAgICAgICAgICAgPyByZXBsYWNlSTE4TlN0cmluZyh0aGlzLmkxOG4uaW52YWxpZFVybFdpdGhUeXBlLCBzdXBwb3J0ZWRTZXJ2aWNlU3RyaW5nLCBcInR5cGVMaXN0XCIpXG4gICAgICAgICAgICA6IChfYSA9IHRoaXMuaTE4bikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2NvZGVdKSB8fCB0aGlzLmkxOG4uZXJyb3JNZXNzYWdlO1xuICAgICAgICB0aGlzLmlucHV0U3RhdHVzID0gXCJpbnZhbGlkXCI7XG4gICAgICAgIHRoaXMuaW5wdXRNZXNzYWdlID0gaW5wdXRNZXNzYWdlO1xuICAgICAgICB0aGlzLmlucHV0TWVzc2FnZUFjdGl2ZSA9IHRydWU7XG4gICAgICAgIHJldHVybiBpbnB1dE1lc3NhZ2U7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB1cmwsIGhlbHBUZXh0LCBwbGFjZWhvbGRlciwgcmVxdWlyZWQsIGhlYWRlclNjYWxlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIGgoXCJhcmNnaXMtbmV3LWl0ZW0tZGVzY3JpcHRpb25cIiwgeyBoZWFkZXI6IHRoaXMuaW5wdXRUaXRsZSwgaGVhZGVyU2NhbGU6IGhlYWRlclNjYWxlIH0pLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IGlkOiBcIml0ZW0tcHJvcGVydGllcy11cmxcIiwgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLCB2YWx1ZTogdXJsLCByZXF1aXJlZDogcmVxdWlyZWQsIHJlZjogKGVsZSkgPT4gKHRoaXMubWFpbklucHV0UmVmID0gZWxlKSwgc3RhdHVzOiB0aGlzLmlucHV0U3RhdHVzLCB0eXBlOiBcInVybFwiLCBvbklucHV0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy8gaWdub3JlIHBhc3RlLCBpdCdzIGhhbmRsZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgIGlmIChlLmlucHV0VHlwZSA9PT0gXCJpbnNlcnRGcm9tUGFzdGVcIilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoaXMudXJsID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWJvdW5jZWRJbnB1dCgpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXJsID0gdGhpcy5tYWluSW5wdXRSZWYudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkSW5wdXQuaW52b2tlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25QYXN0ZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVybCA9IGUuY2xpcGJvYXJkRGF0YS5nZXREYXRhKFwidGV4dFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRlYm91bmNlZElucHV0Lmludm9rZSgpO1xuICAgICAgICAgICAgfSB9KSwgdGhpcy5pbnB1dE1lc3NhZ2VBY3RpdmUgPyAoaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGljb246IHRoaXMuaW5wdXRTdGF0dXMgPT09IFwiaW52YWxpZFwiLCBzdGF0dXM6IHRoaXMuaW5wdXRTdGF0dXMgfSwgdGhpcy5pbnB1dE1lc3NhZ2UpKSA6IGhlbHBUZXh0ID8gKGgoXCJwXCIsIHsgY2xhc3M6IFwiaGVscC10ZXh0XCIgfSwgaGVscFRleHQpKSA6IG51bGwpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1Vcmwuc3R5bGUgPSBhcmNnaXNOZXdJdGVtVXJsQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNOZXdJdGVtIGFzIGFyY2dpc19uZXdfaXRlbSwgQXJjZ2lzTmV3SXRlbUNyZWF0ZUxheWVyc0xpc3QgYXMgYXJjZ2lzX25ld19pdGVtX2NyZWF0ZV9sYXllcnNfbGlzdCwgQXJjZ2lzTmV3SXRlbUNzdkZpZWxkIGFzIGFyY2dpc19uZXdfaXRlbV9jc3ZfZmllbGQsIEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXIgYXMgYXJjZ2lzX25ld19pdGVtX2N1c3RvbV9wYXJhbWV0ZXIsIEFyY2dpc05ld0l0ZW1DdXN0b21QYXJhbWV0ZXJzIGFzIGFyY2dpc19uZXdfaXRlbV9jdXN0b21fcGFyYW1ldGVycywgQXJjZ2lzTmV3SXRlbUlucHV0UmVhZG9ubHkgYXMgYXJjZ2lzX25ld19pdGVtX2lucHV0X3JlYWRvbmx5LCBBcmNnaXNOZXdJdGVtTGF5ZXJTZWFyY2ggYXMgYXJjZ2lzX25ld19pdGVtX2xheWVyX3NlYXJjaCwgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwbGljYXRpb24gYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGxpY2F0aW9uLCBBcmNnaXNOZXdJdGVtUGFnZXNBdXRoIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19hdXRoLCBBcmNnaXNOZXdJdGVtUGFnZXNCdWxrTGF5ZXJTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2J1bGtfbGF5ZXJfc2VsZWN0LCBBcmNnaXNOZXdJdGVtUGFnZXNDbG91ZCBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfY2xvdWQsIEFyY2dpc05ld0l0ZW1QYWdlc0ZpbGVGaWVsZHMgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2ZpbGVfZmllbGRzLCBBcmNnaXNOZXdJdGVtUGFnZXNJdGVtUHJvcGVydGllcyBhcyBhcmNnaXNfbmV3X2l0ZW1fcGFnZXNfaXRlbV9wcm9wZXJ0aWVzLCBBcmNnaXNOZXdJdGVtUGFnZXNQdWJsaXNoU2VsZWN0IGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19wdWJsaXNoX3NlbGVjdCwgQXJjZ2lzTmV3SXRlbVBhZ2VzU2luZ2xlTGF5ZXJTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3NpbmdsZV9sYXllcl9zZWxlY3QsIEFyY2dpc05ld0l0ZW1QYWdlc1VybFR5cGUgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3VybF90eXBlLCBBcmNnaXNOZXdJdGVtUGFnZXNaaXBTZWxlY3QgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX3ppcF9zZWxlY3QsIEFyY2dpc05ld0l0ZW1UaW1lem9uZURyb3Bkb3duIGFzIGFyY2dpc19uZXdfaXRlbV90aW1lem9uZV9kcm9wZG93biwgQXJjZ2lzTmV3SXRlbVVybCBhcyBhcmNnaXNfbmV3X2l0ZW1fdXJsIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1uZXctaXRlbV8xOS5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRHcm91cFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5cbmNvbnN0IGdldEl0ZW1DYXRlZ29yeVNjaGVtYSA9IGFzeW5jICh7IHBvcnRhbCwgdXNlciwgZ3JvdXAsIHVzZUNhY2hlID0gZmFsc2UgfSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBmZXRjaFJlc3VsdCA9IGF3YWl0IChncm91cFxuICAgICAgICAgICAgPyBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cC5pZCwgcG9ydGFsLCB1c2VDYWNoZSlcbiAgICAgICAgICAgIDogZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlciwgdXNlQ2FjaGUpKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiAoX2EgPSBmZXRjaFJlc3VsdCA9PT0gbnVsbCB8fCBmZXRjaFJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmV0Y2hSZXN1bHQuY2F0ZWdvcnlTY2hlbWEpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5hc3luYyBmdW5jdGlvbiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICB1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHZvaWQgMCA/IHVzZXIgOiAodXNlciA9IGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgIGlmICghKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pZCkgfHwgKHVzZXIgJiYgaXNQdWJsaWNVc2VyKHVzZXIpKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfXBvcnRhbHMvJHtwb3J0YWwuaWR9L2NhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpIDogZ2V0U2NoZW1hKCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICBpZiAoIWdyb3VwSWQgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRHcm91cFJlc3RCYXNlVXJsKHBvcnRhbCwgeyBpZDogZ3JvdXBJZCB9KX1jYXRlZ29yeVNjaGVtYWApO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgZ3JvdXBJZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1wb3J0YWxzL3NlbGZgKTtcbiAgICBjb25zdCBncm91cFNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb21tdW5pdHkvZ3JvdXBzP3E9JHtzZWxmLmNvbnRlbnRDYXRlZ29yeVNldHNHcm91cFF1ZXJ5fWApO1xuICAgIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW1TZWFyY2ggPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9ncm91cHMvJHtjYXRlZ29yeUdyb3VwLmlkfS9zZWFyY2hgLCB7XG4gICAgICAgIHE6IGB0eXBla2V5d29yZHM6ICR7Y2F0ZWdvcnlOYW1lfWBcbiAgICB9KTtcbiAgICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICAgIHJldHVybiByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9pdGVtcy8ke3NjaGVtYUl0ZW0uaWR9L2RhdGFgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgY2F0ZWdvcnlOYW1lLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCwgY2F0ZWdvcnlOYW1lKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIGNhdGVnb3J5TmFtZSkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNhdGVnb3JpZXMoeyBjYXRlZ29yaWVzLCBpdGVtSWRzLCBwb3J0YWwgfSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L2NvbnRlbnQvdXBkYXRlSXRlbXNgO1xuICAgICAgICBjb25zdCBpdGVtcyA9IEpTT04uc3RyaW5naWZ5KGl0ZW1JZHMubWFwKChpZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBbaWRdOiB7IGNhdGVnb3JpZXM6IEFycmF5LmlzQXJyYXkoY2F0ZWdvcmllcykgPyBjYXRlZ29yaWVzIDogY2F0ZWdvcmllc1tpZF0gfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3QodXJsLCB7IGl0ZW1zIH0sIHt9LCBcInBvc3RcIikgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMgYXMgYSwgZmV0Y2hHcm91cENhdGVnb3JpZXMgYXMgYiwgZmV0Y2hDYXRlZ29yaWVzIGFzIGYsIGdldEl0ZW1DYXRlZ29yeVNjaGVtYSBhcyBnLCB1cGRhdGVDYXRlZ29yaWVzIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy05ZjBmMzdlZS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEl0ZW1TdGF0ZSB9IGZyb20gJy4vYWRkLWl0ZW0tZGJiZTJmNTcuanMnO1xuXG5jb25zdCBURUxFTUVUUllfSUQgPSBcImNyZWF0ZSBmZWF0dXJlIGxheWVyXCI7XG5jb25zdCBURUxFTUVUUllfUEFHRV9OQU1FID0gXCJteSBjb250ZW50XCI7XG5jb25zdCBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkgPSAodHlwZSkgPT4ge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwiYnVpbGRcIjpcbiAgICAgICAgICAgIHJldHVybiBcImJsYW5rXCI7XG4gICAgICAgIGNhc2UgXCJleGlzdGluZ1wiOlxuICAgICAgICAgICAgcmV0dXJuIFwiZnNcIjtcbiAgICAgICAgY2FzZSBcInRlbXBsYXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJ0ZW1wbGF0ZVwiO1xuICAgICAgICBjYXNlIFwibGlua1wiOlxuICAgICAgICAgICAgcmV0dXJuIFwidXJsXCI7XG4gICAgfVxufTtcbmNvbnN0IGVuYWJsZUxheWVyUHJlZmVyZW5jZVRlbGVtZXRyeSA9ICh0eXBlKSA9PiB7XG4gICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5zdGVwV29ya2Zsb3coVEVMRU1FVFJZX0lELCBgZW5hYmxlICR7dHlwZSA9PT0gXCJjYXB0dXJlR1BTXCIgPyBcImdwc1wiIDogdHlwZSA9PT0gXCJlbmFibGVaRGVmYXVsdHNcIiA/IFwielwiIDogXCJtXCJ9YCwge1xuICAgICAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgICAgICBhdHRyaWJ1dGU6IGFkZEZlYXR1cmVMYXllclR5cGVUb1RlbGVtZXRyeShhZGRJdGVtU3RhdGUuYWRkRmVhdHVyZUxheWVyVHlwZSksXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59O1xuY29uc3QgaXRlbUV4cGFuZGVkVGVsZW1ldHJ5ID0gKHR5cGUpID0+IHtcbiAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LnN0ZXBXb3JrZmxvdyhURUxFTUVUUllfSUQsIGBleHBhbmQgJHt0eXBlfSBkZXRhaWxzYCwge1xuICAgICAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgICAgICBhdHRyaWJ1dGU6IGFkZEZlYXR1cmVMYXllclR5cGVUb1RlbGVtZXRyeShhZGRJdGVtU3RhdGUuYWRkRmVhdHVyZUxheWVyVHlwZSksXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59O1xuY29uc3QgZmlsdGVyQ2hhbmdlVGVsZW1ldHJ5ID0gKCkgPT4ge1xuICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuc3RlcFdvcmtmbG93KFRFTEVNRVRSWV9JRCwgXCJmaWx0ZXJcIiwge1xuICAgICAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgICAgICBhdHRyaWJ1dGU6IGFkZEZlYXR1cmVMYXllclR5cGVUb1RlbGVtZXRyeShhZGRJdGVtU3RhdGUuYWRkRmVhdHVyZUxheWVyVHlwZSksXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59O1xuY29uc3QgZmVhdHVyZUxheWVyVHlwZVRlbGVtZXRyeSA9ICh0eXBlKSA9PiB7XG4gICAgY29uc3QgdGVsZW1ldHJ5VHlwZSA9IGFkZEZlYXR1cmVMYXllclR5cGVUb1RlbGVtZXRyeSh0eXBlKTtcbiAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgdGVsZW1ldHJ5ID09PSBudWxsIHx8IHRlbGVtZXRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVsZW1ldHJ5LnN0ZXBXb3JrZmxvdyhURUxFTUVUUllfSUQsIFwiZnJvbSBvcHRpb25cIiwge1xuICAgICAgICBjYXRlZ29yeTogVEVMRU1FVFJZX0lELFxuICAgICAgICBhdHRyaWJ1dGU6IHRlbGVtZXRyeVR5cGUsXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59O1xuY29uc3QgZmVhdHVyZVNlcnZpY2VFbmRUZWxlbWV0cnkgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBhZGRGZWF0dXJlTGF5ZXJUeXBlLCBzZXJ2aWNlSW5mbyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgIGNvbnN0IGZlYXR1cmVMYXllclNlcnZpY2VJbmZvID0gc2VydmljZUluZm87XG4gICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5lbmRXb3JrZmxvdyhURUxFTUVUUllfSUQsIHtcbiAgICAgICAgY2F0ZWdvcnk6IFRFTEVNRVRSWV9JRCxcbiAgICAgICAgYXR0cmlidXRlOiBhZGRGZWF0dXJlTGF5ZXJUeXBlVG9UZWxlbWV0cnkoYWRkRmVhdHVyZUxheWVyVHlwZSksXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FLFxuICAgICAgICBjb3VudDogZmVhdHVyZUxheWVyU2VydmljZUluZm8ubGF5ZXJzLmxlbmd0aCxcbiAgICAgICAgbnVtYmVyOiBmZWF0dXJlTGF5ZXJTZXJ2aWNlSW5mby50YWJsZXMubGVuZ3RoXG4gICAgfSk7XG59O1xuY29uc3QgZmVhdHVyZUxheWVyRXJyb3JUZWxlbWV0cnkgPSAoZXJyU3RyaW5nKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvZ0Vycm9yKHtcbiAgICAgICAgY2F0ZWdvcnk6IFRFTEVNRVRSWV9JRCxcbiAgICAgICAgZXJyb3I6IGVyclN0cmluZ1xuICAgIH0pO1xufTtcblxuZXhwb3J0IHsgZmVhdHVyZVNlcnZpY2VFbmRUZWxlbWV0cnkgYXMgYSwgZmlsdGVyQ2hhbmdlVGVsZW1ldHJ5IGFzIGIsIGZlYXR1cmVMYXllclR5cGVUZWxlbWV0cnkgYXMgYywgZW5hYmxlTGF5ZXJQcmVmZXJlbmNlVGVsZW1ldHJ5IGFzIGUsIGZlYXR1cmVMYXllckVycm9yVGVsZW1ldHJ5IGFzIGYsIGl0ZW1FeHBhbmRlZFRlbGVtZXRyeSBhcyBpIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZlYXR1cmUtbGF5ZXItNThlMThiMDMuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nIH0gZnJvbSAnLi91cmwtNGMzYWU1NGMuanMnO1xuXG5jb25zdCBnZXRHcm91cFJlc3RCYXNlVXJsID0gKHBvcnRhbCwgZ3JvdXApID0+IGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29tbXVuaXR5L2dyb3Vwcy8ke2dyb3VwLmlkfWApO1xuXG5leHBvcnQgeyBnZXRHcm91cFJlc3RCYXNlVXJsIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z3JvdXAtNmE2MzAzYjAuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5jb25zdCByZWdleExvb2t1cE1hcCA9IHtcbiAgICBmaWxlTmFtZTogL1xcJFxce2ZpbGVOYW1lXFx9L2csXG4gICAgZmlsZVR5cGU6IC9cXCRcXHt0eXBlXFx9L2csXG4gICAgdHlwZUxpc3Q6IC9cXCRcXHt0eXBlTGlzdFxcfS9nLFxuICAgIG1pc3NpbmdGaWVsZHM6IC9cXCRcXHtcXG1pc3NpbmdGaWVsZHNcXH0vZ1xufTtcbmNvbnN0IHJlcGxhY2VJMThOU3RyaW5nID0gKHN0ciwgcmVwbGFjZW1lbnRTdHJpbmcsIHR5cGUpID0+IHtcbiAgICBjb25zdCB0eXBlUmVnRXggPSBuZXcgUmVnRXhwKHJlZ2V4TG9va3VwTWFwW3R5cGVdKTtcbiAgICByZXR1cm4gc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RyLnJlcGxhY2UodHlwZVJlZ0V4LCByZXBsYWNlbWVudFN0cmluZyk7XG59O1xuXG5leHBvcnQgeyByZXBsYWNlSTE4TlN0cmluZyBhcyByIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWkxOG4tMjk5OGVjMzAuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0IHsgbSBhcyBtb3ZlSXRlbSwgdSBhcyB1cGRhdGVJdGVtIH0gZnJvbSAnLi9zZXJ2ZXItaXRlbS04ZDM4NDc5Ni5qcyc7XG5pbXBvcnQgeyB2IGFzIGZpbmRUZW1wbGF0ZVNlcnZpY2VJbmZvLCB3IGFzIGNyZWF0ZVNlcnZpY2UgfSBmcm9tICcuL2ZlYXR1cmUtbGF5ZXItNTczYmI0NzMuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0LCBwIGFzIHBvbGxGb3JTdGF0dXMgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5cbnZhciBfX2F3YWl0ID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19hd2FpdCkgfHwgZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7IH07XG52YXIgX19hc3luY0dlbmVyYXRvciA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fYXN5bmNHZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgfVxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cbn07XG4vKipcbiAqIEdpdmVuIGFuIGl0ZW0sIGNyZWF0ZSBhIG5ldyBzZXJ2aWNlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUltYWdlQ29sbGVjdGlvbihyZXNwb25zZSwgdGl0bGUsIGNvbmZpZ09wdGlvbnMpIHtcbiAgICByZXR1cm4gX19hc3luY0dlbmVyYXRvcih0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uKiBjcmVhdGVJbWFnZUNvbGxlY3Rpb25fMSgpIHtcbiAgICAgICAgY29uc3QgeyBjb25maWcsIHBvcnRhbCwgdXNlciB9ID0gY29uZmlnT3B0aW9ucztcbiAgICAgICAgY29uc3QgeyBpdGVtIH0gPSB5aWVsZCBfX2F3YWl0KGZldGNoSXRlbShyZXNwb25zZSwgdXNlcikpO1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHlpZWxkIF9fYXdhaXQoZmluZFRlbXBsYXRlU2VydmljZUluZm8ocG9ydGFsKSk7XG4gICAgICAgIHlpZWxkIHlpZWxkIF9fYXdhaXQoXCJwdWJsaXNoaW5nU2VydmljZVwiKTtcbiAgICAgICAgY29uc3QgaXNOb3RJblJvb3RGb2xkZXIgPSBpdGVtLm93bmVyRm9sZGVyICYmIGl0ZW0ub3duZXJGb2xkZXIgIT09IFwiL1wiICYmIGl0ZW0ub3duZXJGb2xkZXIgIT09IFwicm9vdFwiO1xuICAgICAgICBjb25zdCB0ZW1wVGl0bGUgPSBgJHt0aXRsZX0tLS0ke2d1aWQoKX1gO1xuICAgICAgICBjb25zdCB7IGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgYWRkVG9EZWZpbml0aW9uUmVzcG9uc2UgfSA9IHlpZWxkIF9fYXdhaXQoY3JlYXRlU2VydmljZShPYmplY3QuYXNzaWduKHsgbmFtZTogaXNOb3RJblJvb3RGb2xkZXIgPyB0ZW1wVGl0bGUgOiB0aXRsZSwgbGF5ZXJzOiAodGVtcGxhdGUgPT09IG51bGwgfHwgdGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBsYXRlLmxheWVycykgfHwgW10sIHRhYmxlczogKHRlbXBsYXRlID09PSBudWxsIHx8IHRlbXBsYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wbGF0ZS50YWJsZXMpIHx8IFtdIH0sIHRlbXBsYXRlKSwgeyBjb25maWcsIHVzZXIgfSkpO1xuICAgICAgICBpZiAoaXNOb3RJblJvb3RGb2xkZXIpIHtcbiAgICAgICAgICAgIHlpZWxkIF9fYXdhaXQobW92ZUl0ZW0oY3JlYXRlU2VydmljZVJlc3BvbnNlLml0ZW1JZCwgaXRlbS5vd25lckZvbGRlcikpO1xuICAgICAgICAgICAgeWllbGQgX19hd2FpdCh1cGRhdGVJdGVtKGNyZWF0ZVNlcnZpY2VSZXNwb25zZS5pdGVtSWQsIHsgdGl0bGUgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkIHlpZWxkIF9fYXdhaXQoXCJhcHBlbmRpbmdQaG90b3NcIik7XG4gICAgICAgIGNvbnN0IHsgc3RhdHVzVXJsIH0gPSB5aWVsZCBfX2F3YWl0KGFwcGVuZFBob3RvcyhjcmVhdGVTZXJ2aWNlUmVzcG9uc2UsIGFkZFRvRGVmaW5pdGlvblJlc3BvbnNlLCBpdGVtKSk7XG4gICAgICAgIHlpZWxkIF9fYXdhaXQoYWRkUmVsYXRpb25zaGlwKGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgaXRlbSwgdXNlcikpO1xuICAgICAgICB5aWVsZCB5aWVsZCBfX2F3YWl0KFwiY2hlY2tpbmdTdGF0dXNcIik7XG4gICAgICAgIHlpZWxkIF9fYXdhaXQocG9sbEZvclN0YXR1cyhzdGF0dXNVcmwpKTtcbiAgICAgICAgeWllbGQgeWllbGQgX19hd2FpdChjcmVhdGVTZXJ2aWNlUmVzcG9uc2UpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gZmV0Y2hJdGVtKGl0ZW0sIHVzZXIpIHtcbiAgICBjb25zdCB1cmwgPSBgJHt1c2VyLnVzZXJDb250ZW50VXJsfS9pdGVtcy8ke2l0ZW0uaWR9YDtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuZnVuY3Rpb24gYXBwZW5kUGhvdG9zKGNyZWF0ZVNlcnZpY2VSZXNwb25zZSwgYWRkVG9EZWZpbml0aW9uUmVzcG9uc2UsIGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgbGF5ZXIgPSBhZGRUb0RlZmluaXRpb25SZXNwb25zZS5sYXllcnNbMF07XG4gICAgY29uc3QgdXJsID0gYCR7Y3JlYXRlU2VydmljZVJlc3BvbnNlLmVuY29kZWRTZXJ2aWNlVVJMfS8keyhfYSA9IGxheWVyLmlkKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwfS9hcHBlbmRgO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgICAgIGFwcGVuZEl0ZW1JZDogaXRlbS5pZCxcbiAgICAgICAgYXBwZW5kVXBsb2FkRm9ybWF0OiBcImltYWdlQ29sbGVjdGlvblwiLFxuICAgICAgICBhcHBlbmRBdHRhY2htZW50c0luZm86IEpTT04uc3RyaW5naWZ5KHsgaWdub3JlQXR0YWNobWVudHNXaXRob3V0TG9jYXRpb246IHRydWUgfSksXG4gICAgICAgIHVwc2VydDogZmFsc2UsXG4gICAgICAgIHVzZUdsb2JhbElkczogZmFsc2UsXG4gICAgICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIGNvbnRlbnQsIHt9LCBcInBvc3RcIik7XG59XG5mdW5jdGlvbiBhZGRSZWxhdGlvbnNoaXAoY3JlYXRlU2VydmljZVJlc3BvbnNlLCBpdGVtLCB1c2VyKSB7XG4gICAgY29uc3QgdXJsID0gYCR7dXNlci51c2VyQ29udGVudFVybH0vYWRkUmVsYXRpb25zaGlwYDtcbiAgICBjb25zdCBjb250ZW50ID0ge1xuICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiBcIlNlcnZpY2UyRGF0YVwiLFxuICAgICAgICBkZXN0aW5hdGlvbkl0ZW1JZDogaXRlbS5pZCxcbiAgICAgICAgb3JpZ2luSXRlbUlkOiBjcmVhdGVTZXJ2aWNlUmVzcG9uc2UuaXRlbUlkXG4gICAgfTtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIGNvbnRlbnQsIHt9LCBcInBvc3RcIik7XG59XG5cbmV4cG9ydCB7IGNyZWF0ZUltYWdlQ29sbGVjdGlvbiBhcyBjIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWltYWdlLWNvbGxlY3Rpb24tNWI2NjJiODAuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBiIGFzIHVuaXF1ZSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5cbmZ1bmN0aW9uIGZpbmRQb3NzaWJsZUl0ZW1UeXBlc0J5RXh0ZW5zaW9uKGV4dGVuc2lvbiwgdmFsaWRhdGlvblR5cGVzKSB7XG4gICAgLy8gU2VhcmNoIGl0ZW0gdHlwZXMgZXh0ZW5zaW9ucyBmb3IgdGhlIG9uZSBpbXBvcnRlZFxuICAgIGxldCBpdGVtVHlwZXM7XG4gICAgaWYgKHZhbGlkYXRpb25UeXBlcykge1xuICAgICAgICBpdGVtVHlwZXMgPSB2YWxpZGF0aW9uVHlwZXMubWFwKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnR5cGU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaXRlbVR5cGVzID0gT2JqZWN0LmtleXMoYWRkQ3JlYXRlSXRlbVR5cGVzKTtcbiAgICB9XG4gICAgbGV0IHBvc3NpYmxlSXRlbVR5cGVzID0gW107XG4gICAgaXRlbVR5cGVzLmZvckVhY2goKHR5cGUpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoKChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXS5maWxlRXh0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5kZXhPZihleHRlbnNpb24pKSA+PSAwKSB7XG4gICAgICAgICAgICBwb3NzaWJsZUl0ZW1UeXBlcy5wdXNoKGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcG9zc2libGVJdGVtVHlwZXM7XG59XG5mdW5jdGlvbiBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zKHR5cGVzKSB7XG4gICAgaWYgKCF0eXBlcykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHVuaXF1ZSh0eXBlcy5mbGF0TWFwKCh0eXBlKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbGVFeHQ7IH0pLmZpbHRlcigodmFsaWQpID0+ICEhdmFsaWQpKTtcbn1cbmNvbnN0IGlzTGFyZ2VHZW9KU09OID0gKHNpemVJbkJ5dGVzKSA9PiB7XG4gICAgY29uc3Qgc2l6ZUluTUIgPSBzaXplSW5CeXRlcyAvIDEwMjQgLyAxMDI0O1xuICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9pc3N1ZXMvMjU1MyNpc3N1ZWNvbW1lbnQtMzY0NTQwNFxuICAgIHJldHVybiBzaXplSW5NQiA+IDUwOyAvLyA1ME1CXG59O1xuY29uc3QgaXNMYXJnZUNTViA9IChzaXplSW5CeXRlcykgPT4ge1xuICAgIGNvbnN0IHNpemVJbk1CID0gc2l6ZUluQnl0ZXMgLyAxMDI0IC8gMTAyNDtcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvaXNzdWVzLzI4NzUjaXNzdWVjb21tZW50LTM3NDg5MTNcbiAgICByZXR1cm4gc2l6ZUluTUIgPiAyMDsgLy8gMjBNQlxufTtcblxuZXhwb3J0IHsgaXNMYXJnZUNTViBhcyBhLCBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbiBhcyBmLCBpc0xhcmdlR2VvSlNPTiBhcyBpLCBtYXBJdGVtVHlwZXNUb0ZpbGVFeHRlbnNpb25zIGFzIG0gfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS10eXBlcy01ODZmMDMwMS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5cbmNvbnN0IGdldFN1YnNjcmlwdGlvbkluZm8gPSBhc3luYyAocG9ydGFsKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uSW5mbyA9IGF3YWl0IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX1wb3J0YWxzL3NlbGYvc3Vic2NyaXB0aW9uSW5mb2ApO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IHN1YnNjcmlwdGlvbkluZm8gfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5cbmV4cG9ydCB7IGdldFN1YnNjcmlwdGlvbkluZm8gYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdWJzY3JpcHRpb24tMjJjYWFlMWEuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcblxuY29uc3QgVEVMRU1FVFJZX0lEID0gXCJjcmVhdGUgdGlsZSBsYXllclwiO1xuY29uc3QgVEVMRU1FVFJZX1BBR0VfTkFNRSA9IFwibXkgY29udGVudFwiO1xuY29uc3QgbWFwVGlsZUxheWVyT3B0aW9uVG9UZWxlbWV0cnkgPSAodHlwZSkgPT4ge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwic3RvcmVcIjpcbiAgICAgICAgICAgIHJldHVybiBcImRhdGEgc3RvcmVcIjtcbiAgICAgICAgY2FzZSBcImV4aXN0aW5nXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJmc1wiO1xuICAgICAgICBjYXNlIFwidXBsb2FkXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJ1cGxvYWRcIjtcbiAgICB9XG59O1xuY29uc3QgbWFwVGlsZUxheWVyVHlwZVRvVGVsZW1ldHJ5ID0gKHR5cGUpID0+IHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcInRpbGVzXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJyYXN0ZXJcIjtcbiAgICAgICAgY2FzZSBcInZlY3RvclRpbGVzXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJ2ZWN0b3JcIjtcbiAgICB9XG59O1xuY29uc3QgbG9nVGlsZUxheWVyU3RhcnQgPSAoKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXJ0V29ya2Zsb3coVEVMRU1FVFJZX0lELCB7XG4gICAgICAgIGNhdGVnb3J5OiBcImNyZWF0ZSB0aWxlIGxheWVyXCIsXG4gICAgICAgIHBhZ2VOYW1lOiBcIm15IGNvbnRlbnRcIlxuICAgIH0pO1xufTtcbmNvbnN0IGxvZ1RpbGVMYXllckZyb21PcHRpb24gPSAoKSA9PiB7XG4gICAgY29uc3QgdGVsZW1ldHJ5ID0gY29uZmlnU3RhdGUudGVsZW1ldHJ5O1xuICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5zdGVwV29ya2Zsb3coVEVMRU1FVFJZX0lELCBcImZyb20gb3B0aW9uXCIsIHtcbiAgICAgICAgY2F0ZWdvcnk6IFRFTEVNRVRSWV9JRCxcbiAgICAgICAgYXR0cmlidXRlOiBtYXBUaWxlTGF5ZXJPcHRpb25Ub1RlbGVtZXRyeShhZGRJdGVtU3RhdGUuYWRkVGlsZUxheWVyT3B0aW9uKSxcbiAgICAgICAgZGV0YWlsczogbWFwVGlsZUxheWVyVHlwZVRvVGVsZW1ldHJ5KGFkZEl0ZW1TdGF0ZS50aWxlTGF5ZXJQdWJsaXNoVHlwZSksXG4gICAgICAgIHBhZ2VOYW1lOiBURUxFTUVUUllfUEFHRV9OQU1FXG4gICAgfSk7XG59O1xuY29uc3QgbG9nVGlsZUxheWVyRmluaXNoID0gKCkgPT4ge1xuICAgIGNvbnN0IHRlbGVtZXRyeSA9IGNvbmZpZ1N0YXRlLnRlbGVtZXRyeTtcbiAgICB0ZWxlbWV0cnkgPT09IG51bGwgfHwgdGVsZW1ldHJ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlbWV0cnkuZW5kV29ya2Zsb3coVEVMRU1FVFJZX0lELCB7XG4gICAgICAgIGNhdGVnb3J5OiBURUxFTUVUUllfSUQsXG4gICAgICAgIGF0dHJpYnV0ZTogbWFwVGlsZUxheWVyT3B0aW9uVG9UZWxlbWV0cnkoYWRkSXRlbVN0YXRlLmFkZFRpbGVMYXllck9wdGlvbiksXG4gICAgICAgIGRldGFpbHM6IG1hcFRpbGVMYXllclR5cGVUb1RlbGVtZXRyeShhZGRJdGVtU3RhdGUudGlsZUxheWVyUHVibGlzaFR5cGUpLFxuICAgICAgICBwYWdlTmFtZTogVEVMRU1FVFJZX1BBR0VfTkFNRVxuICAgIH0pO1xufTtcblxuZXhwb3J0IHsgbG9nVGlsZUxheWVyRmluaXNoIGFzIGEsIGxvZ1RpbGVMYXllckZyb21PcHRpb24gYXMgYiwgbG9nVGlsZUxheWVyU3RhcnQgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD10aWxlLWxheWVyLWYwZjllZjRiLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBpdGVtUHJvcGVydGllc1N0b3JlLCBpIGFzIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUgfSBmcm9tICcuL2l0ZW0tcHJvcGVydGllcy0xMDQ5MWIyZS5qcyc7XG5pbXBvcnQgeyBkIGFzIGFkZEl0ZW1TdG9yZSwgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1iY2E3YmNkMS5qcyc7XG5cbmZ1bmN0aW9uIHJlc2V0QWRkSXRlbVN0b3JlcygpIHtcbiAgICBhZGRJdGVtU3RvcmUucmVzZXQoKTtcbiAgICBpdGVtUHJvcGVydGllc1N0b3JlLnJlc2V0KCk7XG59XG5jb25zdCByZXNldFN0b3JlT25Ib21lID0gKCkgPT4ge1xuICAgIGlmIChhZGRJdGVtU3RhdGUuZXhpc3RpbmdJdGVtIHx8IHVpU3RvcmVTdGF0ZS53b3JrZmxvdyA9PT0gXCJyZWdpc3RlclwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYWRkSXRlbVN0b3JlLnJlc2V0KCk7XG4gICAgY29uc3QgZm9sZGVyID0gaXRlbVByb3BlcnRpZXNTdGF0ZS5mb2xkZXI7XG4gICAgaXRlbVByb3BlcnRpZXNTdG9yZS5yZXNldCgpO1xuICAgIGl0ZW1Qcm9wZXJ0aWVzU3RhdGUuZm9sZGVyID0gZm9sZGVyO1xufTtcblxuZXhwb3J0IHsgcmVzZXRTdG9yZU9uSG9tZSBhcyBhLCByZXNldEFkZEl0ZW1TdG9yZXMgYXMgciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD11dGlscy05YjNmZmNmNy5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=