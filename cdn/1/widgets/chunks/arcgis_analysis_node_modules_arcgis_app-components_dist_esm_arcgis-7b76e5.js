"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7b76e5"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-gamma-slider_2.entry.js":
/*!**************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-gamma-slider_2.entry.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_gamma_slider: () => (/* binding */ ArcgisSmartMappingGammaSlider),
/* harmony export */   arcgis_smart_mapping_stretch_type_button: () => (/* binding */ ArcgisSmartMappingStretchTypeButton)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */











const arcgisSmartMappingGammaSliderCss = ".slider{height:60px;background-color:transparent;position:relative;width:90%;margin:0 auto 0 auto}.esri-slider__content{margin-bottom:30px}.slider-bottom-label .esri-slider__max,.slider-bottom-label .esri-slider__min{width:-moz-fit-content;width:fit-content;position:absolute;bottom:0}.slider-bottom-label .esri-slider__max{right:-9px;text-align:right}.slider-bottom-label .esri-slider__min{left:-9px;text-align:left}";

const ArcgisSmartMappingGammaSlider = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.watchHandles = [];
        this.gamma = undefined;
        this.rendererType = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentDidLoad() {
        const { config } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin", `<link rel="stylesheet" href="${config.jsapiUrl}/themes/light/main.css" />`);
    }
    //--------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a;
        const { modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!this.slider) {
            const config = {
                min: -1000,
                max: 1000,
                values: [this.parseGammaValue(this.gamma.toString())],
                visibleElements: {
                    labels: true,
                    rangeLabels: true
                },
                rangeLabelInputsEnabled: false,
                precision: 3,
                labelInputsEnabled: true
            };
            config.labelFormatFunction = (value) => {
                return this.formatGammaValue(value);
            };
            config.inputFormatFunction = (value) => {
                return this.formatGammaValue(value);
            };
            config.inputParseFunction = (value) => {
                return this.parseGammaValue(value);
            };
            (_a = this.watchHandles[0]) === null || _a === void 0 ? void 0 : _a.remove();
            this.watchHandles[0] = undefined;
            this.slider = new modules.Slider(config);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "slider slider-bottom-label", ref: (node) => {
                if (node) {
                    this.afterGammaSliderCreate(node);
                }
            } }));
    }
    // -------------------------------------------------------------------
    //
    //  Private methods
    //
    // -------------------------------------------------------------------
    afterGammaSliderCreate(node) {
        if (!this.slider.container) {
            const divNode = document.createElement("div");
            node.append(divNode);
            this.slider.container = divNode;
            this.createGammaSliderChangeEvents();
        }
    }
    createGammaSliderChangeEvents() {
        this.watchHandles.push(this.slider.watch("values", (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)(() => this.handleGammaSliderValueChange(), 300)));
    }
    handleGammaSliderValueChange() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const newGamma = this.formatGammaValue(this.slider.values[0]);
        renderer.gamma =
            this.rendererType === "raster-stretch" ? [newGamma] : new Array(3).fill(newGamma);
        renderer.useGamma = true;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    /**
     * Takes in a number ranging from -1000 to 1000, reduces it to a
     * range of [-1, 1], and performs mathematical operations to obtain
     * a number in the range [0.1, 10]
     */
    formatGammaValue(value) {
        return parseFloat(Math.exp((value / 1000) * Math.log(10)).toFixed(2));
    }
    /**
     * Takes in a gamma value ranging from 0.1 to 10 and converts it to
     * a value to be represented on the slider in the range [-1000, 1000]
     */
    parseGammaValue(value) {
        const gammaValue = parseFloat(value);
        const sliderValue = (Math.log(gammaValue) / Math.log(10)) * 1000;
        return sliderValue;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingGammaSlider.style = arcgisSmartMappingGammaSliderCss;

const arcgisSmartMappingStretchTypeButtonCss = ".stretch-type-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:1px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.stretch-type-button:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.stretch-type-button:active{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}.stretch-type-button:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.stretch-type-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.stretch-type-content{display:flex;align-items:center;justify-content:space-between;width:100%}.stretch-type-button-text{display:inline-block;padding:0 10px}.stretch-type-button-title{font-weight:bold}.stretch-type-button-msg{font-size:80%;line-height:16px}";

const ArcgisSmartMappingStretchTypeButton = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingStretchTypeButtonChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingStretchTypeButtonChange", 7);
        this.arcgisSmartMappingStretchTypeButtonBeforeOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingStretchTypeButtonBeforeOpen", 7);
        this.stretchTypeInfos = [];
        this.open = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        this.buttonNode.focus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.populateStretchTypeInfo();
        this.setSelection();
    }
    componentWillUpdate() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType } = renderer;
        if (this.selectedStretchTypeInfo.value !== stretchType) {
            this.setSelection();
        }
    }
    // --------------------------------------------------------------------------
    //
    // Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.stretchTypeButton.stretchType, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stretch-type-button", role: "button", tabindex: "0", "aria-haspopup": "true", "aria-label": strings.stretchTypeButton.stretchType, ref: (node) => (this.buttonNode = node), onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.openStretchTypeDropdown();
                }
            }, onClick: () => this.openStretchTypeDropdown() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stretch-type-content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stretch-type-button-text" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stretch-type-button-title" }, this.selectedStretchTypeInfo.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "stretch-type-button-msg" }, this.selectedStretchTypeInfo.msg)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", icon: "chevron-down" })))))));
    }
    // --------------------------------------------------------------------------
    //
    // Private methods
    //
    // --------------------------------------------------------------------------
    populateStretchTypeInfo() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const stretchTypeOptions = strings.stretchTypeButton.stretchTypeOptions;
        const stretchTypeOptionDescriptions = strings.stretchTypeButton.stretchTypeOptionDescriptions;
        this.stretchTypeInfos.push({
            value: "none",
            title: stretchTypeOptions.none,
            msg: stretchTypeOptionDescriptions.none,
            iconPath: null,
            selected: false
        });
        this.stretchTypeInfos.push({
            value: "min-max",
            title: stretchTypeOptions.minimumMaximum,
            msg: stretchTypeOptionDescriptions.minimumMaximum,
            iconPath: null,
            selected: false
        });
        this.stretchTypeInfos.push({
            value: "percent-clip",
            title: stretchTypeOptions.percentClip,
            msg: stretchTypeOptionDescriptions.percentClip,
            iconPath: null,
            selected: false
        });
        this.stretchTypeInfos.push({
            value: "standard-deviation",
            title: stretchTypeOptions.standardDeviation,
            msg: stretchTypeOptionDescriptions.standardDeviation,
            iconPath: null,
            selected: false
        });
        // NOTE: not yet supported
        // this.stretchTypeInfos.push({
        //   key: "histogram-equalization",
        //   title: stretchTypeOptions.histogramEqualize,
        //   msg: i18n.ui.stretchTypeOptionDescriptions.histogramEqualize,
        //   selected: false
        // });
        // this.stretchTypeInfos.push({
        //   key: "custom",
        //   title: stretchTypeOptions.custom,
        //   msg: stretchTypeOptionDescriptions.custom,
        //   selected: false
        // });
    }
    setSelection() {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        this.selectedStretchTypeInfo = this.stretchTypeInfos.find((info) => info.value === renderer.stretchType);
        this.stretchTypeInfos.forEach((stretchTypeInfo) => {
            stretchTypeInfo.selected = stretchTypeInfo.value === this.selectedStretchTypeInfo.value;
        });
    }
    closePopover() {
        var _a;
        this.open = false;
        if (this.dropdownNode) {
            (_a = this.dropdownNode.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.dropdownNode);
            this.dropdownNode = null;
            this.buttonNode.classList.remove("active");
        }
    }
    openStretchTypeDropdown() {
        if (!this.open) {
            this.arcgisSmartMappingStretchTypeButtonBeforeOpen.emit();
            const dropdown = document.createElement("arcgis-smart-mapping-dropdown");
            dropdown.buttonNode = this.buttonNode;
            dropdown.infos = this.stretchTypeInfos;
            this.dropdownNode = dropdown;
            dropdown.addEventListener("arcgisSmartMappingDropdownClose", (event) => {
                this.closePopover();
                event.detail === "Escape" && this.setFocus();
            });
            dropdown.addEventListener("arcgisSmartMappingDropdownChange", (event) => this.setStretchType(event.detail));
            this.buttonNode.classList.add("active");
            document.body.appendChild(dropdown);
            this.open = true;
        }
        else {
            this.open = false;
        }
    }
    setStretchType(newStretchTypeInfo) {
        const { layer: smLayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = smLayer;
        const renderer = layer.renderer;
        const { stretchType: currentStretchType } = renderer;
        const newStretchType = newStretchTypeInfo.value;
        if (newStretchType === currentStretchType) {
            this.closePopover();
            setTimeout(() => this.setFocus(), 300);
            return;
        }
        this.stretchTypeInfos.forEach((stretchTypeInfo) => {
            stretchTypeInfo.selected = stretchTypeInfo.value === newStretchType;
        });
        this.selectedStretchTypeInfo = newStretchTypeInfo;
        this.arcgisSmartMappingStretchTypeButtonChange.emit(this.selectedStretchTypeInfo.value);
        this.closePopover();
        setTimeout(() => this.setFocus(), 300);
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingStretchTypeButton.style = arcgisSmartMappingStretchTypeButtonCss;



//# sourceMappingURL=arcgis-smart-mapping-gamma-slider_2.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arrayToLookupMap),
/* harmony export */   b: () => (/* binding */ unique),
/* harmony export */   c: () => (/* binding */ throttle),
/* harmony export */   d: () => (/* binding */ debounce),
/* harmony export */   e: () => (/* binding */ escapeRegExp),
/* harmony export */   f: () => (/* binding */ arraysAreEquivalent),
/* harmony export */   g: () => (/* binding */ chunk),
/* harmony export */   i: () => (/* binding */ isDefined),
/* harmony export */   m: () => (/* binding */ minDelay),
/* harmony export */   t: () => (/* binding */ timeout),
/* harmony export */   u: () => (/* binding */ uniqueBy)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/**
 * Call a function only after it has not been called for n milliseconds
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const debounce = (fn, delay) => {
    let timeout;
    let status = "idle";
    function flush(...args) {
        status = "flushed";
        return debounced(...args);
    }
    function invoke(...args) {
        status = "invoked";
        return debounced(...args);
    }
    function cancel(...args) {
        status = "cancelled";
        return debounced(...args);
    }
    function getStatus() {
        return status;
    }
    const debounced = (...args) => new Promise((resolve) => {
        switch (status) {
            case "flushed":
                status = "idle";
                if (timeout) {
                    clearTimeout(timeout);
                    resolve(fn(...args));
                }
                else {
                    resolve(null);
                }
                break;
            case "invoked":
                clearTimeout(timeout);
                status = "idle";
                resolve(fn(...args));
                break;
            case "cancelled":
                clearTimeout(timeout);
                status = "idle";
                resolve(null);
                break;
            default:
                if (timeout) {
                    clearTimeout(timeout);
                }
                status = "pending";
                timeout = setTimeout(() => {
                    status = "idle";
                    return resolve(fn(...args));
                }, delay);
                break;
        }
    });
    debounced.flush = flush;
    debounced.invoke = invoke;
    debounced.cancel = cancel;
    debounced.getStatus = getStatus;
    return debounced;
};
/**
 * Call a function only after n milliseconds have elapsed
 * @param fn    - function to call
 * @param delay - delay in milliseconds
 */
const throttle = (fn, delay) => {
    let timeout;
    return (...args) => new Promise((resolve) => {
        if (timeout) {
            return;
        }
        timeout = setTimeout(() => {
            clearTimeout(timeout);
            timeout = undefined;
            resolve(fn(...args));
        }, delay);
    });
};
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // $& means the whole matched string
}
function isDefined(value) {
    return value !== undefined && value !== null;
}
/**
 * Set a minimum time for a promise to resolve (useful for preventing flash of loaders)
 */
async function minDelay(promise, minDelay) {
    await Promise.all([promise, timeout(minDelay)]);
    return promise;
}
/**
 * Helper method to inline setTimeout as an await in async functions
 */
function timeout(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
const arrayToLookupMap = (dataArr, getKeyAndItem) => Object.fromEntries((dataArr || []).map((item) => {
    const { key, data } = getKeyAndItem(item);
    return [key, data];
}));
/**
 * Check whether two arrays have the same number of elements
 * and whether they contain the same elements
 * regardless of order
 */
const arraysAreEquivalent = (arr1, arr2) => arr1.length === arr2.length && arr1.reduce((memo, str) => memo && arr2.indexOf(str) > -1, true);
function uniqueBy(myArr, getItemId) {
    const resultArr = [];
    const lookupMap = {};
    myArr.forEach((item) => {
        const id = getItemId(item);
        if (lookupMap[id] == null) {
            lookupMap[id] = item;
            resultArr.push(item);
        }
    });
    return resultArr;
}
function unique(myArr) {
    const primitives = { boolean: {}, number: {}, string: {} };
    const objs = [];
    return myArr.filter((item) => {
        let type = typeof item;
        if (type in primitives) {
            return primitives[type].hasOwnProperty(item) ? false : (primitives[type][item] = true);
        }
        else {
            return objs.indexOf(item) >= 0 ? false : objs.push(item);
        }
    });
}
const chunk = (arr, size) => [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));



//# sourceMappingURL=functional-44de8fcf.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTdiNzZlNS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUM2RztBQUNaO0FBQzlEO0FBQ0E7QUFDc0I7QUFDckI7QUFDVDtBQUNHO0FBQ0Q7QUFDVTs7QUFFdkMsa0RBQWtELFlBQVksNkJBQTZCLGtCQUFrQixVQUFVLHFCQUFxQixzQkFBc0IsbUJBQW1CLDhFQUE4RSx1QkFBdUIsa0JBQWtCLGtCQUFrQixTQUFTLHVDQUF1QyxXQUFXLGlCQUFpQix1Q0FBdUMsVUFBVSxnQkFBZ0I7O0FBRTNjO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixTQUFTLEVBQUUsK0RBQWlCO0FBQzVDLHdIQUF3SCxnQkFBZ0I7QUFDeEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixVQUFVLEVBQUUsK0RBQWlCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixxREFBQyxVQUFVO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsMERBQVE7QUFDbkU7QUFDQTtBQUNBLGdCQUFnQixpQkFBaUIsRUFBRSwrREFBaUI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0EsaUNBQWlDLHNCQUFzQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEI7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixXQUFXLFlBQVk7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRWlNOztBQUVqTSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1zbWFydC1tYXBwaW5nLWdhbW1hLXNsaWRlcl8yLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIGQgYXMgZ2V0RWxlbWVudCwgYyBhcyBjcmVhdGVFdmVudCwgSCBhcyBIb3N0IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBhYiBhcyB1cGRhdGVSZW5kZXJlciwgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSB9IGZyb20gJy4vcmFzdGVyLXVuaXF1ZS12YWx1ZS0wOTc2ZWM3Zi5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGQgYXMgZGVib3VuY2UgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0ICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdHYW1tYVNsaWRlckNzcyA9IFwiLnNsaWRlcntoZWlnaHQ6NjBweDtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjkwJTttYXJnaW46MCBhdXRvIDAgYXV0b30uZXNyaS1zbGlkZXJfX2NvbnRlbnR7bWFyZ2luLWJvdHRvbTozMHB4fS5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWF4LC5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWlue3dpZHRoOi1tb3otZml0LWNvbnRlbnQ7d2lkdGg6Zml0LWNvbnRlbnQ7cG9zaXRpb246YWJzb2x1dGU7Ym90dG9tOjB9LnNsaWRlci1ib3R0b20tbGFiZWwgLmVzcmktc2xpZGVyX19tYXh7cmlnaHQ6LTlweDt0ZXh0LWFsaWduOnJpZ2h0fS5zbGlkZXItYm90dG9tLWxhYmVsIC5lc3JpLXNsaWRlcl9fbWlue2xlZnQ6LTlweDt0ZXh0LWFsaWduOmxlZnR9XCI7XG5cbmNvbnN0IEFyY2dpc1NtYXJ0TWFwcGluZ0dhbW1hU2xpZGVyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy53YXRjaEhhbmRsZXMgPSBbXTtcbiAgICAgICAgdGhpcy5nYW1tYSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZW5kZXJlclR5cGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGNvbmZpZyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuc2hhZG93Um9vdC5maXJzdEVsZW1lbnRDaGlsZC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmViZWdpblwiLCBgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIke2NvbmZpZy5qc2FwaVVybH0vdGhlbWVzL2xpZ2h0L21haW4uY3NzXCIgLz5gKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKCF0aGlzLnNsaWRlcikge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIG1pbjogLTEwMDAsXG4gICAgICAgICAgICAgICAgbWF4OiAxMDAwLFxuICAgICAgICAgICAgICAgIHZhbHVlczogW3RoaXMucGFyc2VHYW1tYVZhbHVlKHRoaXMuZ2FtbWEudG9TdHJpbmcoKSldLFxuICAgICAgICAgICAgICAgIHZpc2libGVFbGVtZW50czoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlTGFiZWxzOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByYW5nZUxhYmVsSW5wdXRzRW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAzLFxuICAgICAgICAgICAgICAgIGxhYmVsSW5wdXRzRW5hYmxlZDogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbmZpZy5sYWJlbEZvcm1hdEZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0R2FtbWFWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uZmlnLmlucHV0Rm9ybWF0RnVuY3Rpb24gPSAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRHYW1tYVZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25maWcuaW5wdXRQYXJzZUZ1bmN0aW9uID0gKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VHYW1tYVZhbHVlKHZhbHVlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAoX2EgPSB0aGlzLndhdGNoSGFuZGxlc1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy53YXRjaEhhbmRsZXNbMF0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLnNsaWRlciA9IG5ldyBtb2R1bGVzLlNsaWRlcihjb25maWcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNsaWRlciBzbGlkZXItYm90dG9tLWxhYmVsXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyR2FtbWFTbGlkZXJDcmVhdGUobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhZnRlckdhbW1hU2xpZGVyQ3JlYXRlKG5vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNsaWRlci5jb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbm9kZS5hcHBlbmQoZGl2Tm9kZSk7XG4gICAgICAgICAgICB0aGlzLnNsaWRlci5jb250YWluZXIgPSBkaXZOb2RlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVHYW1tYVNsaWRlckNoYW5nZUV2ZW50cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZUdhbW1hU2xpZGVyQ2hhbmdlRXZlbnRzKCkge1xuICAgICAgICB0aGlzLndhdGNoSGFuZGxlcy5wdXNoKHRoaXMuc2xpZGVyLndhdGNoKFwidmFsdWVzXCIsIGRlYm91bmNlKCgpID0+IHRoaXMuaGFuZGxlR2FtbWFTbGlkZXJWYWx1ZUNoYW5nZSgpLCAzMDApKSk7XG4gICAgfVxuICAgIGhhbmRsZUdhbW1hU2xpZGVyVmFsdWVDaGFuZ2UoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IG5ld0dhbW1hID0gdGhpcy5mb3JtYXRHYW1tYVZhbHVlKHRoaXMuc2xpZGVyLnZhbHVlc1swXSk7XG4gICAgICAgIHJlbmRlcmVyLmdhbW1hID1cbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXJUeXBlID09PSBcInJhc3Rlci1zdHJldGNoXCIgPyBbbmV3R2FtbWFdIDogbmV3IEFycmF5KDMpLmZpbGwobmV3R2FtbWEpO1xuICAgICAgICByZW5kZXJlci51c2VHYW1tYSA9IHRydWU7XG4gICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRha2VzIGluIGEgbnVtYmVyIHJhbmdpbmcgZnJvbSAtMTAwMCB0byAxMDAwLCByZWR1Y2VzIGl0IHRvIGFcbiAgICAgKiByYW5nZSBvZiBbLTEsIDFdLCBhbmQgcGVyZm9ybXMgbWF0aGVtYXRpY2FsIG9wZXJhdGlvbnMgdG8gb2J0YWluXG4gICAgICogYSBudW1iZXIgaW4gdGhlIHJhbmdlIFswLjEsIDEwXVxuICAgICAqL1xuICAgIGZvcm1hdEdhbW1hVmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoTWF0aC5leHAoKHZhbHVlIC8gMTAwMCkgKiBNYXRoLmxvZygxMCkpLnRvRml4ZWQoMikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUYWtlcyBpbiBhIGdhbW1hIHZhbHVlIHJhbmdpbmcgZnJvbSAwLjEgdG8gMTAgYW5kIGNvbnZlcnRzIGl0IHRvXG4gICAgICogYSB2YWx1ZSB0byBiZSByZXByZXNlbnRlZCBvbiB0aGUgc2xpZGVyIGluIHRoZSByYW5nZSBbLTEwMDAsIDEwMDBdXG4gICAgICovXG4gICAgcGFyc2VHYW1tYVZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGdhbW1hVmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTtcbiAgICAgICAgY29uc3Qgc2xpZGVyVmFsdWUgPSAoTWF0aC5sb2coZ2FtbWFWYWx1ZSkgLyBNYXRoLmxvZygxMCkpICogMTAwMDtcbiAgICAgICAgcmV0dXJuIHNsaWRlclZhbHVlO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nR2FtbWFTbGlkZXIuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdHYW1tYVNsaWRlckNzcztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25Dc3MgPSBcIi5zdHJldGNoLXR5cGUtYnV0dG9ue2Rpc3BsYXk6ZmxleDtwYWRkaW5nOjZweDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7Ym9yZGVyLXJhZGl1czowO2N1cnNvcjpwb2ludGVyO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpO2JvcmRlci13aWR0aDoxcHg7Ym9yZGVyLXN0eWxlOnNvbGlkO2JveC1zaGFkb3c6dHJhbnNwYXJlbnQgMHB4IDBweCAwcHggMXB4IGluc2V0fS5zdHJldGNoLXR5cGUtYnV0dG9uOmhvdmVye2JveC1zaGFkb3c6aW5zZXQgMCAwIDAgMXB4IHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKX0uc3RyZXRjaC10eXBlLWJ1dHRvbjphY3RpdmV7Ym94LXNoYWRvdzppbnNldCAwIDAgMCAycHggdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS5zdHJldGNoLXR5cGUtYnV0dG9uOmZvY3Vze2JveC1zaGFkb3c6aW5zZXQgMCAwIDAgMnB4IHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKTtvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9LnN0cmV0Y2gtdHlwZS1idXR0b24uYWN0aXZle291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtdWktZm9jdXMtY29sb3IsIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpKX0uc3RyZXRjaC10eXBlLWNvbnRlbnR7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbjt3aWR0aDoxMDAlfS5zdHJldGNoLXR5cGUtYnV0dG9uLXRleHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzowIDEwcHh9LnN0cmV0Y2gtdHlwZS1idXR0b24tdGl0bGV7Zm9udC13ZWlnaHQ6Ym9sZH0uc3RyZXRjaC10eXBlLWJ1dHRvbi1tc2d7Zm9udC1zaXplOjgwJTtsaW5lLWhlaWdodDoxNnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdTdHJldGNoVHlwZUJ1dHRvbiA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25DaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uQmVmb3JlT3BlbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25CZWZvcmVPcGVuXCIsIDcpO1xuICAgICAgICB0aGlzLnN0cmV0Y2hUeXBlSW5mb3MgPSBbXTtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB0aGlzLmJ1dHRvbk5vZGUuZm9jdXMoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnBvcHVsYXRlU3RyZXRjaFR5cGVJbmZvKCk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVcGRhdGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIGNvbnN0IHsgc3RyZXRjaFR5cGUgfSA9IHJlbmRlcmVyO1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFN0cmV0Y2hUeXBlSW5mby52YWx1ZSAhPT0gc3RyZXRjaFR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgc3RyaW5ncy5zdHJldGNoVHlwZUJ1dHRvbi5zdHJldGNoVHlwZSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN0cmV0Y2gtdHlwZS1idXR0b25cIiwgcm9sZTogXCJidXR0b25cIiwgdGFiaW5kZXg6IFwiMFwiLCBcImFyaWEtaGFzcG9wdXBcIjogXCJ0cnVlXCIsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnN0cmV0Y2hUeXBlQnV0dG9uLnN0cmV0Y2hUeXBlLCByZWY6IChub2RlKSA9PiAodGhpcy5idXR0b25Ob2RlID0gbm9kZSksIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlblN0cmV0Y2hUeXBlRHJvcGRvd24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB0aGlzLm9wZW5TdHJldGNoVHlwZURyb3Bkb3duKCkgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN0cmV0Y2gtdHlwZS1jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN0cmV0Y2gtdHlwZS1idXR0b24tdGV4dFwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdHJldGNoLXR5cGUtYnV0dG9uLXRpdGxlXCIgfSwgdGhpcy5zZWxlY3RlZFN0cmV0Y2hUeXBlSW5mby50aXRsZSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdHJldGNoLXR5cGUtYnV0dG9uLW1zZ1wiIH0sIHRoaXMuc2VsZWN0ZWRTdHJldGNoVHlwZUluZm8ubXNnKSksIGgoXCJkaXZcIiwgbnVsbCwgaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgaWNvbjogXCJjaGV2cm9uLWRvd25cIiB9KSkpKSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBwb3B1bGF0ZVN0cmV0Y2hUeXBlSW5mbygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgc3RyZXRjaFR5cGVPcHRpb25zID0gc3RyaW5ncy5zdHJldGNoVHlwZUJ1dHRvbi5zdHJldGNoVHlwZU9wdGlvbnM7XG4gICAgICAgIGNvbnN0IHN0cmV0Y2hUeXBlT3B0aW9uRGVzY3JpcHRpb25zID0gc3RyaW5ncy5zdHJldGNoVHlwZUJ1dHRvbi5zdHJldGNoVHlwZU9wdGlvbkRlc2NyaXB0aW9ucztcbiAgICAgICAgdGhpcy5zdHJldGNoVHlwZUluZm9zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IFwibm9uZVwiLFxuICAgICAgICAgICAgdGl0bGU6IHN0cmV0Y2hUeXBlT3B0aW9ucy5ub25lLFxuICAgICAgICAgICAgbXNnOiBzdHJldGNoVHlwZU9wdGlvbkRlc2NyaXB0aW9ucy5ub25lLFxuICAgICAgICAgICAgaWNvblBhdGg6IG51bGwsXG4gICAgICAgICAgICBzZWxlY3RlZDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RyZXRjaFR5cGVJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgIHZhbHVlOiBcIm1pbi1tYXhcIixcbiAgICAgICAgICAgIHRpdGxlOiBzdHJldGNoVHlwZU9wdGlvbnMubWluaW11bU1heGltdW0sXG4gICAgICAgICAgICBtc2c6IHN0cmV0Y2hUeXBlT3B0aW9uRGVzY3JpcHRpb25zLm1pbmltdW1NYXhpbXVtLFxuICAgICAgICAgICAgaWNvblBhdGg6IG51bGwsXG4gICAgICAgICAgICBzZWxlY3RlZDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RyZXRjaFR5cGVJbmZvcy5wdXNoKHtcbiAgICAgICAgICAgIHZhbHVlOiBcInBlcmNlbnQtY2xpcFwiLFxuICAgICAgICAgICAgdGl0bGU6IHN0cmV0Y2hUeXBlT3B0aW9ucy5wZXJjZW50Q2xpcCxcbiAgICAgICAgICAgIG1zZzogc3RyZXRjaFR5cGVPcHRpb25EZXNjcmlwdGlvbnMucGVyY2VudENsaXAsXG4gICAgICAgICAgICBpY29uUGF0aDogbnVsbCxcbiAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdHJldGNoVHlwZUluZm9zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IFwic3RhbmRhcmQtZGV2aWF0aW9uXCIsXG4gICAgICAgICAgICB0aXRsZTogc3RyZXRjaFR5cGVPcHRpb25zLnN0YW5kYXJkRGV2aWF0aW9uLFxuICAgICAgICAgICAgbXNnOiBzdHJldGNoVHlwZU9wdGlvbkRlc2NyaXB0aW9ucy5zdGFuZGFyZERldmlhdGlvbixcbiAgICAgICAgICAgIGljb25QYXRoOiBudWxsLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBOT1RFOiBub3QgeWV0IHN1cHBvcnRlZFxuICAgICAgICAvLyB0aGlzLnN0cmV0Y2hUeXBlSW5mb3MucHVzaCh7XG4gICAgICAgIC8vICAga2V5OiBcImhpc3RvZ3JhbS1lcXVhbGl6YXRpb25cIixcbiAgICAgICAgLy8gICB0aXRsZTogc3RyZXRjaFR5cGVPcHRpb25zLmhpc3RvZ3JhbUVxdWFsaXplLFxuICAgICAgICAvLyAgIG1zZzogaTE4bi51aS5zdHJldGNoVHlwZU9wdGlvbkRlc2NyaXB0aW9ucy5oaXN0b2dyYW1FcXVhbGl6ZSxcbiAgICAgICAgLy8gICBzZWxlY3RlZDogZmFsc2VcbiAgICAgICAgLy8gfSk7XG4gICAgICAgIC8vIHRoaXMuc3RyZXRjaFR5cGVJbmZvcy5wdXNoKHtcbiAgICAgICAgLy8gICBrZXk6IFwiY3VzdG9tXCIsXG4gICAgICAgIC8vICAgdGl0bGU6IHN0cmV0Y2hUeXBlT3B0aW9ucy5jdXN0b20sXG4gICAgICAgIC8vICAgbXNnOiBzdHJldGNoVHlwZU9wdGlvbkRlc2NyaXB0aW9ucy5jdXN0b20sXG4gICAgICAgIC8vICAgc2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgIC8vIH0pO1xuICAgIH1cbiAgICBzZXRTZWxlY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbGF5ZXIucmVuZGVyZXI7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTdHJldGNoVHlwZUluZm8gPSB0aGlzLnN0cmV0Y2hUeXBlSW5mb3MuZmluZCgoaW5mbykgPT4gaW5mby52YWx1ZSA9PT0gcmVuZGVyZXIuc3RyZXRjaFR5cGUpO1xuICAgICAgICB0aGlzLnN0cmV0Y2hUeXBlSW5mb3MuZm9yRWFjaCgoc3RyZXRjaFR5cGVJbmZvKSA9PiB7XG4gICAgICAgICAgICBzdHJldGNoVHlwZUluZm8uc2VsZWN0ZWQgPSBzdHJldGNoVHlwZUluZm8udmFsdWUgPT09IHRoaXMuc2VsZWN0ZWRTdHJldGNoVHlwZUluZm8udmFsdWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZVBvcG92ZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duTm9kZSkge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5kcm9wZG93bk5vZGUucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHRoaXMuZHJvcGRvd25Ob2RlKTtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd25Ob2RlID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9wZW5TdHJldGNoVHlwZURyb3Bkb3duKCkge1xuICAgICAgICBpZiAoIXRoaXMub3Blbikge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdTdHJldGNoVHlwZUJ1dHRvbkJlZm9yZU9wZW4uZW1pdCgpO1xuICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZHJvcGRvd25cIik7XG4gICAgICAgICAgICBkcm9wZG93bi5idXR0b25Ob2RlID0gdGhpcy5idXR0b25Ob2RlO1xuICAgICAgICAgICAgZHJvcGRvd24uaW5mb3MgPSB0aGlzLnN0cmV0Y2hUeXBlSW5mb3M7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duTm9kZSA9IGRyb3Bkb3duO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1NtYXJ0TWFwcGluZ0Ryb3Bkb3duQ2xvc2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICBldmVudC5kZXRhaWwgPT09IFwiRXNjYXBlXCIgJiYgdGhpcy5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nRHJvcGRvd25DaGFuZ2VcIiwgKGV2ZW50KSA9PiB0aGlzLnNldFN0cmV0Y2hUeXBlKGV2ZW50LmRldGFpbCkpO1xuICAgICAgICAgICAgdGhpcy5idXR0b25Ob2RlLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRyb3Bkb3duKTtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRTdHJldGNoVHlwZShuZXdTdHJldGNoVHlwZUluZm8pIHtcbiAgICAgICAgY29uc3QgeyBsYXllcjogc21MYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21MYXllcjtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBsYXllci5yZW5kZXJlcjtcbiAgICAgICAgY29uc3QgeyBzdHJldGNoVHlwZTogY3VycmVudFN0cmV0Y2hUeXBlIH0gPSByZW5kZXJlcjtcbiAgICAgICAgY29uc3QgbmV3U3RyZXRjaFR5cGUgPSBuZXdTdHJldGNoVHlwZUluZm8udmFsdWU7XG4gICAgICAgIGlmIChuZXdTdHJldGNoVHlwZSA9PT0gY3VycmVudFN0cmV0Y2hUeXBlKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlUG9wb3ZlcigpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldEZvY3VzKCksIDMwMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdHJldGNoVHlwZUluZm9zLmZvckVhY2goKHN0cmV0Y2hUeXBlSW5mbykgPT4ge1xuICAgICAgICAgICAgc3RyZXRjaFR5cGVJbmZvLnNlbGVjdGVkID0gc3RyZXRjaFR5cGVJbmZvLnZhbHVlID09PSBuZXdTdHJldGNoVHlwZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTdHJldGNoVHlwZUluZm8gPSBuZXdTdHJldGNoVHlwZUluZm87XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nU3RyZXRjaFR5cGVCdXR0b25DaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkU3RyZXRjaFR5cGVJbmZvLnZhbHVlKTtcbiAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldEZvY3VzKCksIDMwMCk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdTdHJldGNoVHlwZUJ1dHRvbi5zdHlsZSA9IGFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNTbWFydE1hcHBpbmdHYW1tYVNsaWRlciBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19nYW1tYV9zbGlkZXIsIEFyY2dpc1NtYXJ0TWFwcGluZ1N0cmV0Y2hUeXBlQnV0dG9uIGFzIGFyY2dpc19zbWFydF9tYXBwaW5nX3N0cmV0Y2hfdHlwZV9idXR0b24gfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLXNtYXJ0LW1hcHBpbmctZ2FtbWEtc2xpZGVyXzIuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG4vKipcbiAqIENhbGwgYSBmdW5jdGlvbiBvbmx5IGFmdGVyIGl0IGhhcyBub3QgYmVlbiBjYWxsZWQgZm9yIG4gbWlsbGlzZWNvbmRzXG4gKiBAcGFyYW0gZm4gICAgLSBmdW5jdGlvbiB0byBjYWxsXG4gKiBAcGFyYW0gZGVsYXkgLSBkZWxheSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIGRlbGF5KSA9PiB7XG4gICAgbGV0IHRpbWVvdXQ7XG4gICAgbGV0IHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgIGZ1bmN0aW9uIGZsdXNoKC4uLmFyZ3MpIHtcbiAgICAgICAgc3RhdHVzID0gXCJmbHVzaGVkXCI7XG4gICAgICAgIHJldHVybiBkZWJvdW5jZWQoLi4uYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGludm9rZSguLi5hcmdzKSB7XG4gICAgICAgIHN0YXR1cyA9IFwiaW52b2tlZFwiO1xuICAgICAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjYW5jZWwoLi4uYXJncykge1xuICAgICAgICBzdGF0dXMgPSBcImNhbmNlbGxlZFwiO1xuICAgICAgICByZXR1cm4gZGVib3VuY2VkKC4uLmFyZ3MpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRTdGF0dXMoKSB7XG4gICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgfVxuICAgIGNvbnN0IGRlYm91bmNlZCA9ICguLi5hcmdzKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBcImZsdXNoZWRcIjpcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaW52b2tlZFwiOlxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcImlkbGVcIjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxsZWRcIjpcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gXCJpZGxlXCI7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0dXMgPSBcInBlbmRpbmdcIjtcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IFwiaWRsZVwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgICAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZGVib3VuY2VkLmZsdXNoID0gZmx1c2g7XG4gICAgZGVib3VuY2VkLmludm9rZSA9IGludm9rZTtcbiAgICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsO1xuICAgIGRlYm91bmNlZC5nZXRTdGF0dXMgPSBnZXRTdGF0dXM7XG4gICAgcmV0dXJuIGRlYm91bmNlZDtcbn07XG4vKipcbiAqIENhbGwgYSBmdW5jdGlvbiBvbmx5IGFmdGVyIG4gbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZFxuICogQHBhcmFtIGZuICAgIC0gZnVuY3Rpb24gdG8gY2FsbFxuICogQHBhcmFtIGRlbGF5IC0gZGVsYXkgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmNvbnN0IHRocm90dGxlID0gKGZuLCBkZWxheSkgPT4ge1xuICAgIGxldCB0aW1lb3V0O1xuICAgIHJldHVybiAoLi4uYXJncykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICB0aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmVzb2x2ZShmbiguLi5hcmdzKSk7XG4gICAgICAgIH0sIGRlbGF5KTtcbiAgICB9KTtcbn07XG5mdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7IC8vICQmIG1lYW5zIHRoZSB3aG9sZSBtYXRjaGVkIHN0cmluZ1xufVxuZnVuY3Rpb24gaXNEZWZpbmVkKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGw7XG59XG4vKipcbiAqIFNldCBhIG1pbmltdW0gdGltZSBmb3IgYSBwcm9taXNlIHRvIHJlc29sdmUgKHVzZWZ1bCBmb3IgcHJldmVudGluZyBmbGFzaCBvZiBsb2FkZXJzKVxuICovXG5hc3luYyBmdW5jdGlvbiBtaW5EZWxheShwcm9taXNlLCBtaW5EZWxheSkge1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFtwcm9taXNlLCB0aW1lb3V0KG1pbkRlbGF5KV0pO1xuICAgIHJldHVybiBwcm9taXNlO1xufVxuLyoqXG4gKiBIZWxwZXIgbWV0aG9kIHRvIGlubGluZSBzZXRUaW1lb3V0IGFzIGFuIGF3YWl0IGluIGFzeW5jIGZ1bmN0aW9uc1xuICovXG5mdW5jdGlvbiB0aW1lb3V0KG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5jb25zdCBhcnJheVRvTG9va3VwTWFwID0gKGRhdGFBcnIsIGdldEtleUFuZEl0ZW0pID0+IE9iamVjdC5mcm9tRW50cmllcygoZGF0YUFyciB8fCBbXSkubWFwKChpdGVtKSA9PiB7XG4gICAgY29uc3QgeyBrZXksIGRhdGEgfSA9IGdldEtleUFuZEl0ZW0oaXRlbSk7XG4gICAgcmV0dXJuIFtrZXksIGRhdGFdO1xufSkpO1xuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHR3byBhcnJheXMgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2YgZWxlbWVudHNcbiAqIGFuZCB3aGV0aGVyIHRoZXkgY29udGFpbiB0aGUgc2FtZSBlbGVtZW50c1xuICogcmVnYXJkbGVzcyBvZiBvcmRlclxuICovXG5jb25zdCBhcnJheXNBcmVFcXVpdmFsZW50ID0gKGFycjEsIGFycjIpID0+IGFycjEubGVuZ3RoID09PSBhcnIyLmxlbmd0aCAmJiBhcnIxLnJlZHVjZSgobWVtbywgc3RyKSA9PiBtZW1vICYmIGFycjIuaW5kZXhPZihzdHIpID4gLTEsIHRydWUpO1xuZnVuY3Rpb24gdW5pcXVlQnkobXlBcnIsIGdldEl0ZW1JZCkge1xuICAgIGNvbnN0IHJlc3VsdEFyciA9IFtdO1xuICAgIGNvbnN0IGxvb2t1cE1hcCA9IHt9O1xuICAgIG15QXJyLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgaWQgPSBnZXRJdGVtSWQoaXRlbSk7XG4gICAgICAgIGlmIChsb29rdXBNYXBbaWRdID09IG51bGwpIHtcbiAgICAgICAgICAgIGxvb2t1cE1hcFtpZF0gPSBpdGVtO1xuICAgICAgICAgICAgcmVzdWx0QXJyLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0QXJyO1xufVxuZnVuY3Rpb24gdW5pcXVlKG15QXJyKSB7XG4gICAgY29uc3QgcHJpbWl0aXZlcyA9IHsgYm9vbGVhbjoge30sIG51bWJlcjoge30sIHN0cmluZzoge30gfTtcbiAgICBjb25zdCBvYmpzID0gW107XG4gICAgcmV0dXJuIG15QXJyLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgICAgICBsZXQgdHlwZSA9IHR5cGVvZiBpdGVtO1xuICAgICAgICBpZiAodHlwZSBpbiBwcmltaXRpdmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJpbWl0aXZlc1t0eXBlXS5oYXNPd25Qcm9wZXJ0eShpdGVtKSA/IGZhbHNlIDogKHByaW1pdGl2ZXNbdHlwZV1baXRlbV0gPSB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvYmpzLmluZGV4T2YoaXRlbSkgPj0gMCA/IGZhbHNlIDogb2Jqcy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5jb25zdCBjaHVuayA9IChhcnIsIHNpemUpID0+IFsuLi5BcnJheShNYXRoLmNlaWwoYXJyLmxlbmd0aCAvIHNpemUpKV0ubWFwKChfLCBpKSA9PiBhcnIuc2xpY2Uoc2l6ZSAqIGksIHNpemUgKyBzaXplICogaSkpO1xuXG5leHBvcnQgeyBhcnJheVRvTG9va3VwTWFwIGFzIGEsIHVuaXF1ZSBhcyBiLCB0aHJvdHRsZSBhcyBjLCBkZWJvdW5jZSBhcyBkLCBlc2NhcGVSZWdFeHAgYXMgZSwgYXJyYXlzQXJlRXF1aXZhbGVudCBhcyBmLCBjaHVuayBhcyBnLCBpc0RlZmluZWQgYXMgaSwgbWluRGVsYXkgYXMgbSwgdGltZW91dCBhcyB0LCB1bmlxdWVCeSBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1bmN0aW9uYWwtNDRkZThmY2YuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9