"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-01fbb1"],{53248:(e,t,i)=>{i.d(t,{A:()=>o,G:()=>c,J:()=>a,M:()=>s,P:()=>u,U:()=>r,a:()=>l,d:()=>n});const r={IDLE:"idle",VALID:"valid",INVALID:"invalid"},a={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},s={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},n={name:"Raster",isDataset:!0,isPublic:!1,type:a.RASTER_FUNCTION_VARIABLE},o={RFX_DTEX_COMMON_SELECT:"RFX-DTEX-COMMON-SELECT",RFX_DTE_COMMON_CHECKBOX:"CALCITE-CHECKBOX",RFX_DTE_COMMON_TEXTINPUT:"CALCITE-INPUT-TEXT",RFX_DTE_COMMON_NUMBERINPUT:"CALCITE-INPUT-NUMBER",RFX_DTE_RASTER_INPUT:"RFX-DTE-RASTER-INPUT",RFX_DTE_FEATURE_SELECT:"RFX-DTE-FEATURE-SELECT",RFX_DTEX_RASTER_VARIABLES_LIST:"RFX-DTEX-RASTER-VARIABLES-LIST",RFX_CTE_RANGED_VALUE_EDITOR:"RFX-CTE-RANGED-VALUE-EDITOR",RFX_CTE_GAMMA_EDITOR:"RFX-CTE-GAMMA-EDITOR",RFX_DTE_COLOR_RAMP_SELECTOR:"RFX-DTE-COLOR-RAMP-SELECTOR",RFX_DTE_EXTENT:"RFX-DTE-EXTENT",RFX_DTE_JSON_FILE_UPLOADER:"RFX-DTE-JSON-FILE-UPLOADER",RFX_CTE_FACTOR_FUNCTION_EDITOR:"RFX-CTE-FACTOR-FUNCTION-EDITOR",RFX_CTE_NEIGHBORHOOD_VALUES:"RFX-CTE-NEIGHBORHOOD-VALUES"},l={ANALYSIS:"analysis",EDITOR:"editor"},c={textInput:"text-input",text:"text",raster:"raster-input",number:"number-input",boolean:"check-box",switch:"switch",field:"field-select",color:"color-input",select:"select",icon:"icon"},u={loading:"loading",success:"success",error:"error"}},5660:(e,t,i)=>{i.d(t,{a:()=>A,b:()=>L,c:()=>T,d:()=>k,e:()=>I,f:()=>S,g:()=>_,h:()=>F,i:()=>N,j:()=>V,k:()=>D,l:()=>$,n:()=>U,o:()=>P});var r=i(46574),a=i(34319),s=i(46717),n=i(55139),o=i(57098),l=(i(78979),i(95876)),c=i(77162),u=i(53248),h=i(32804),d=i(48363),f=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/;function g(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var r=arguments,a=t?t.apply(this,r):r[0],s=i.cache;if(s.has(a))return s.get(a);var n=e.apply(this,r);return i.cache=s.set(a,n)||s,n};return i.cache=new(g.Cache||h.M),i}g.Cache=h.M;var m,y,v,x=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,b=/\\(\\)?/g,C=(m=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(x,(function(e,i,r,a){t.push(r?a.replace(b,"$1"):i||e)})),t},y=g(m,(function(e){return 500===v.size&&v.clear(),e})),v=y.cache,y);var R=1/0;function O(e){if("string"==typeof e||(0,l.c)(e))return e;var t=e+"";return"0"==t&&1/e==-R?"-0":t}function E(e,t,i){return null==e?e:function(e,t,i,r){if(!(0,d.j)(e))return e;for(var a=-1,s=(t=function(e,t){return(0,d.a)(e)?e:function(e,t){if((0,d.a)(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!(0,l.c)(e))||p.test(e)||!f.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:C((0,l.d)(e))}(t,e)).length,n=s-1,o=e;null!=o&&++a<s;){var c=O(t[a]),u=i;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(a!=n){var g=o[c];void 0===(u=void 0)&&(u=(0,d.j)(g)?g:(0,h.i)(t[a+1])?[]:{})}(0,h.a)(o,c,u),o=o[c]}return e}(e,t,i)}function T(e){return a.clone(e)}function A(){return a.clone(u.d)}function w(e){return s.urlToObject(e).path}function _(e){return e?.indexOf("?token=")>0&&(e=e.slice(0,e.indexOf("?token="))),e}function L(e){let t=_(e?.url);"feature"===e.type&&(t=`${t}/${e.layerId??0}`);const i=r.default.findCredential(e.url);return void 0!==i&&(t=`${t}?token=${i.token}`),t}function k(e){const t={url:L(e),name:e.title};if((0,c.i)(e.renderingRule)||(t.renderingRule=e.renderingRule.toJSON()),(0,c.i)(e.definitionExpression))(0,c.i)(e.mosaicRule)||(t.mosaicRule=e.mosaicRule.toJSON?.());else{let i=e.mosaicRule;(0,c.i)(i)||(i=i.clone(),i.where=e.definitionExpression,t.mosaicRule=i.toJSON())}return t}function I(e,t){if((0,c.i)(e?.url)||(0,c.i)(t))return;const i=w(e.url),r=t.find((e=>e.url===i))?.id;return r}async function S(e){if((0,c.i)(e?.url))return;const t=a.clone(e);let i;t.name||(t.name=function(e){const t=e.split("/");return t[t.length-2]}(t.url));try{i=await n.default.fromArcGISServerUrl({url:w(e.url),properties:{renderingRule:e.renderingRule,mosaicRule:e.mosaicRule}}),i.name=e.name}catch(e){}return i}async function F(e){const t=e?.url,i=e?.name;if((0,c.i)(t))return;let r;try{r=await n.default.fromArcGISServerUrl({url:w(t)}),r.name=i}catch(e){console.error("Failed to load feature layer from RFT JSON.")}return r}function N(e){return e?.toLocaleLowerCase().indexOf("f")>=0}function V(e){const t=e&&(e.extent||e.fullExtent);if((0,c.i)(t))return;const{xmin:i,ymin:r,xmax:a,ymax:s,spatialReference:n}=t,{wkid:o,latestWkid:l,wkt:u}=n,h={xmin:i,ymin:r,xmax:a,ymax:s};return(0,c.i)(o)||E(h,"spatialReference.wkid",o),(0,c.i)(l)||E(h,"spatialReference.latestWkid",l),(0,c.i)(u)||E(h,"spatialReference.wkt",u),h}async function D(e){if((0,c.i)(e))return Promise.resolve(void 0);const t=await e.queryFeatures({returnGeometry:!0,where:"1 = 1"});if((0,c.i)(t))return Promise.resolve(void 0);const i=t.features?.map((e=>e?.geometry));return i}function $(e){const t=e?.rasterInfo?.keyProperties?.ChangeAnalysisParameters,i=t?.AnalysisType;return"CCDC"===i}function U(e){return e.filter((e=>function(e){let t=!0;return!1===e.sourceJSON?.allowAnalysis&&(t=!1),(e.portalItem?.typeKeywords?.includes("Hosted Service")??!1)&&(t=!!e.portalItem.isOrgItem||t),t}(e)))}function P(e,t){const i=JSON.stringify(t);return new o.default({url:e,raster:btoa((0,l.t)(i))})}},89920:(e,t,i)=>{i.d(t,{S:()=>l,a:()=>f,b:()=>p,d:()=>h,e:()=>x,f:()=>C,g:()=>g,h:()=>m,i:()=>c,j:()=>u,k:()=>d,l:()=>b,m:()=>O,n:()=>E,p:()=>R,q:()=>T,r:()=>A,s:()=>y,u:()=>v});var r=i(34319),a=i(36676),s=i(77162),n=i(81279),o=i(53248);const l={List:"list",Unit:"linearUnit",Number:"number",Field:"field"};function c(e){const t=!(0,s.i)(e?.isDataset),i=e?.type===s.R;return t&&i}function u(e,t){if((0,s.i)(t))return r.clone(e);const i={};if("object"==typeof e&&null!==e&&!Array.isArray(e)){for(const r in e)e.hasOwnProperty(r)&&t.indexOf(r)<0&&(i[r]=u(e[r],t));return i}return Array.isArray(e)?e.map((e=>u(e,t))):r.clone(e)}function h(e,t){if((0,s.i)(e)||(0,s.i)(t))return;const i=Object.keys(t).find((t=>t.toLowerCase()===e.toLowerCase()));return i?t[i]:void 0}function d(e,t){if(!e)return"";const i=Object.keys(e);return void 0===t&&1===i.length?i[0]:i.find((e=>e.toLowerCase()===t?.toLowerCase()))??""}async function f(e){const t=e?.function?.type?.toLowerCase()?.replace("function",""),i=e?.arguments,r=a.h.rfxNameSpecialCases,n=a.h.localFunctionOperations,o=await(0,a.g)();switch(t){case"local":const e=i?.Operation?.value,a=n.find((t=>t.key===e));if(!(0,s.i)(a))return a.label;if(o.cellStatisticsTypes.some((t=>t.key===e)))return"CellStatistics";break;case"pythonadapter":{const e=i?.ClassName?.value;return e||null}case"gpadapter":{const e=i?.ToolName?.value?.toLowerCase()?.replace("_sa",""),t=r.find((t=>t.key===e));return t?.value||e||null}default:{const e=r.find((e=>e.key===t));return e?.value||t||null}}return null}function p(e){if(e)return e.type===s.b?e:e.value&&e.value.type===s.b?e.value:void 0}function g({schema:e,rfxTemplate:t}){if((0,s.i)(t?.function?.type))return;const i=t.function.type,r=t?.arguments;let a=(0,n.e)(r);return(!a||!e.hasOwnProperty(a)&&e.hasOwnProperty(i))&&(a=i),e[a]}function m(e){if(!e||!e.value)return!1;const t=(e.value.elements?e.value.elements:e.value)[0];return t&&(t.isDataset||t.type===s.b)}function y(e){if(!e||!e[s.A])return!1;if(e.aliases)return!0;const t=e=>{if(!e)return!1;if(e.isPublic)return!0;if(m(e)){const i=e.value&&e.value.elements?e.value.elements:e.value;if(i&&Array.isArray(i))return i.some((e=>t(e)))}const i=p(e);return!!i&&y(i)},i=e[s.A];return(0,s.a)(i)?t(i):Object.keys(i).some((e=>{const r=i[e];if((0,s.a)(r))return t(r)}))}function v(e){if(!e)return!1;const t=e.dataType===a.d.rasterArray,i=Boolean(e.elementInfos),r=e.dataType===a.d.table;return t&&i||r}function x(e,t){return Array.isArray(e)&&e.some((e=>e.toLowerCase()===t.toLowerCase()))}function b(e){if(!e||!e.value)return!1;const t=e.value.elements?e.value.elements:e.value;return!!Array.isArray(t)&&t.some((function(e){return e&&e.type===s.b}))}function C(e){return e?.forEach((e=>{e.key=e.key.toString()})),e}function R(e,t){return e.forEach((e=>{if("field"===e.type){const i=h(e.argumentName,t);e.argumentName=i.name,e.layerArgument=i}else e.type!==a.a.list&&e.type!==a.a.linearUnit||(e.enumStore=C[e.enum])})),e}function O(e,t){let i;const r=h(e.nElementsArgument,t),a=r?.value,s=e.elementInfos;return void 0!==r&&void 0!==a||1!==s.length?(Array.isArray(s)&&s.some((e=>{const t=e.values;if(Array.isArray(t)&&t.indexOf(a)>-1)return i=e.inputArgs,!0})),i):s[0].inputArgs}function E(e){let t=!1;const i=e[s.A];if((0,s.a)(i))return!0;for(const e in i)if(e!==s.T&&(r=i[e])&&(p(r)||b(r)))return t=!0,t;var r;return t}function T({functionSchema:e,rfxTemplate:t}){if(!t)return;const i=[],a=t.arguments,n=a&&a.type;if(function({functionSchema:e,rfxTemplate:t}){const i=e;let r;if(i&&(r=i.rasterFunctionArguments,1===Object.keys(r).length&&!i.hasArgumentsObject))return!0;const a=t.arguments,s=a&&a.type;return!(!s||s!==o.J.RASTER_FUNCTION_TEMPLATE&&s!==o.J.RASTER_FUNCTION_VARIABLE)||void 0}({functionSchema:e,rfxTemplate:t})){const e=r.clone(a);let t;return t=n===o.J.RASTER_FUNCTION_TEMPLATE||e.isDataset?"Raster":"Rasters",i.push({...e,key:t}),i}return Object.keys(a).forEach((e=>{if(e===o.M.MATCH_VARIABLE||e===o.M.UNION_DIMENSION)return;const t=r.clone(a[e]);(0,s.a)(t)&&i.push({...t,key:e})})),i}function A(e,t){const i=t&&t.value;if(null==i)return;let r;return e.some((e=>{if(e.values&&e.values.indexOf(i)>-1)return r=e.inputArgs,!0})),r}},71700:(e,t,i)=>{i.r(t),i.d(t,{rfx_color_picker:()=>d,rfx_dte_raster_input:()=>f,rfx_dtex_common_select:()=>p,rfx_dtex_field_select:()=>g,rfx_grid:()=>m});var r=i(19451),a=i(95323),s=(i(34319),i(64729)),n=(i(46574),i(46717),i(55139),i(57098),i(78979),i(83345),i(99248),i(16888),i(43278),i(86944),i(74656),i(48302)),o=i(77162),l=i(89920),c=i(53248),u=i(5660),h=i(95876);i(48363),i(36676),i(81279),i(32804);const d=class{constructor(e){(0,r.r)(this,e),this.rfxColorPickerValueChange=(0,r.c)(this,"rfxColorPickerValueChange",7),this.onColorSwatchClick=e=>{const t=e.target.value;this.popoverElememt.open=!1,this.value=new a.default(t).toRgba(),this.rfxColorPickerValueChange.emit({value:this.value})},this.value=[0,0,0,255]}render(){const e=new a.default(this.value).toHex();return(0,r.h)("div",null,(0,r.h)("calcite-color-picker-swatch",{active:!1,color:e,id:"color-picker-swatch",scale:s.U.Scale,ref:e=>{}}),(0,r.h)("calcite-popover",{autoClose:!0,pointerDisabled:!0,referenceElement:"color-picker-swatch",placement:"auto",scale:s.U.Scale,label:"color-picker-popover",ref:e=>{this.popoverElememt=e}},(0,r.h)("calcite-color-picker",{scale:s.U.Scale,value:e,format:"auto",onCalciteColorPickerInput:this.onColorSwatchClick})))}get hostElement(){return(0,r.a)(this)}},f=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange",7),this.scalarValues=[],this.loaded=!1,this.inputLayers=void 0,this.value=void 0,this.allowScalar=!1,this.overlayPositioning=s.a.absolute,this.rfxVariable=void 0,this.mode=void 0,this.rfxBrowseLayerClick=void 0}onRFxVariableChange(e){e.value?this.value=e.value:this.argRFT=(0,l.b)(e)}async connectedCallback(){return await this.load(),this.loaded=!0,Promise.resolve()}async componentWillLoad(){({strings:this.strings}=await(0,n.b)(this.hostElement,(0,r.g)(".")))}async getSelectedLayer(){return!1===this.loaded&&await this.load(),void 0!==this.value&&"object"==typeof this.value?this._getSelectedLayer(this.value.url):Promise.resolve(void 0)}async updateBrowsedLayer(e){return e.forEach((e=>{0===this.inputLayers.filter((t=>e.url===t.url)).length&&this.inputLayers.push(e),this.value=(0,u.d)(e),this.rfxArgumentChange.emit({value:this.value})})),Promise.resolve(void 0)}async load(){(0,o.i)(this.rfxVariable)||this.onRFxVariableChange(this.rfxVariable),(0,o.i)(this.value)||await this.processValueLayer()}async processValueLayer(){if("scalar"===this.value.type?.toLowerCase())return void this.scalarValues.push(this.value);const e=this.value?.url;if((0,o.i)(e))return;const t=(0,u.e)(this.value,this.inputLayers);if((0,o.i)(t)){const e=await(0,u.f)(this.value);void 0!==e&&(this.inputLayers=[...this.inputLayers,e])}const i=await this._getSelectedLayer((0,u.g)(e));void 0!==i&&(this.value=(0,u.d)(i)),this.inputLayers=(0,h.a)(this.inputLayers,"url")}async _handleComboBoxChange(e){const t=e.target.value;if((0,o.i)(t))this.value=void 0;else{if("browse"===t)return this.value=void 0,void this.rfxBrowseLayerClick({referenceElement:this.hostElement});{const e=await this._getSelectedLayer(t);void 0!==e?this.value=(0,u.d)(e):1==this.allowScalar&&(this.value={type:"Scalar",value:t})}}this.rfxArgumentChange.emit({value:this.value})}async _getSelectedLayer(e){e=(0,u.g)(e);const t=this.inputLayers.find((t=>t.url===e));if(t&&(await t.load(),(0,o.l)(t)))try{t.rasterInfo=await t.generateRasterInfo(t.rasterFunction)}catch(e){console.error(e)}return t}getFormattedValueFromVariable(){if(!(0,o.i)(this.argRFT)){const e=this.argRFT.function?.name;return`<${e}.${this.strings.outputRaster}>`}return this.mode===c.a.ANALYSIS?this.getDefaultPlaceHolder():`<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`}getDefaultPlaceHolder(){return this.allowScalar?this.strings.allowScalar:this.strings.selectLayer}getPlaceHolderText(){return(0,o.i)(this.rfxVariable)?this.getDefaultPlaceHolder():this.getFormattedValueFromVariable()}renderInputOptions(e){let t=[];return this.inputLayers&&Array.isArray(this.inputLayers)&&(t=this.inputLayers.map(((t,i)=>{if(void 0!==t?.url)return(0,r.h)("calcite-combobox-item",{key:`layer-item-${i}`,value:t.url,selected:t.url===e,textLabel:t.title,icon:"imagery"===t.type?"image-layer":"tiled-imagery-layer",scale:s.U.Scale})}))),0!==this.scalarValues?.length&&this.scalarValues.forEach((e=>{t.push((0,r.h)("calcite-combobox-item",{key:`layer-item-${this.inputLayers.length+1}`,value:e.value,textLabel:e.value,selected:!0,scale:s.U.Scale}))})),t}render(){const e=(0,u.g)(this.value?.url),t=(0,o.i)(this.value)?this.value:"Scalar"===this.value?.type?this.value.value:e;return(0,r.h)("div",{class:"esriRFxRasterInput"},(0,r.h)("calcite-combobox",{label:"rfx-dte-raster-input-combobox",placeholder:this.getPlaceHolderText(),selectionMode:"single",scale:s.U.Scale,maxItems:0,disabled:void 0!==this.argRFT,allowCustomValues:this.allowScalar,value:t,onCalciteComboboxChange:e=>this._handleComboBoxChange(e),overlayPositioning:this.overlayPositioning,clearDisabled:!0},(0,r.h)(r.F,null,(0,r.h)("calcite-combobox-item",{class:"browse-layer",key:"layer-item-browse",value:"browse",textLabel:this.strings.browseLayer,scale:s.U.Scale,icon:"search",filterDisabled:!0}),...this.renderInputOptions(t))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}static get watchers(){return{rfxVariable:["onRFxVariableChange"]}}};f.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.browse-layer{--calcite-ui-text-1:var(--calcite-color-text-link);--calcite-ui-text-3:var(--calcite-color-text-link)}";const p=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange",7),this.handleComboBoxChange=e=>{const t=e.target.value;(0,o.i)(t)||(this.value=t,this.rfxArgumentChange.emit({value:this.value}))},this.options=[],this.value="",this.allowCustomValues=!1,this.placeHolderText=void 0,this.isInGrid=!1,this.isNullable=!1}componentDidRender(){if(!0!==this.isNullable){const e=this.hostElement.shadowRoot.querySelector("calcite-combobox");e.addEventListener("click",(t=>{const i=t.target;"CALCITE-COMBOBOX-ITEM"===i.tagName&&e.value===i.value&&t.stopPropagation()}),{capture:!0})}}render(){let e=[];return this.options&&Array.isArray(this.options)&&(e=this.options.map(((e,t)=>(0,r.h)("calcite-combobox-item",{key:`common-select-item-${t}-${e.key}`,value:e.key,textLabel:e.label,selected:e.key===this.value,scale:s.U.Scale})))),(0,r.h)("div",null,(0,r.h)("calcite-combobox",{selectionMode:"single",scale:s.U.Scale,maxItems:0,label:"rfx-dtex-common-select-combobox",placeholder:this.placeHolderText,allowCustomValues:this.allowCustomValues,clearDisabled:!this.isNullable,overlayPositioning:this.isInGrid?"fixed":"absolute",onCalciteComboboxChange:e=>this.handleComboBoxChange(e)},...e))}get hostElement(){return(0,r.a)(this)}},g=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange",7),this.rfxFieldOptionsLoaded=(0,r.c)(this,"rfxFieldOptionsLoaded",7),this.handleFieldSelectChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})},this.layerArg=void 0,this.rasterInputVariable=void 0,this.otherOptions=void 0,this.value=void 0,this.options=void 0,this.fieldType=void 0,this.isInGrid=!1,this.inputLayers=void 0,this.showDefaultFields=!0}onrasterInputVariableChange(){this.processLayerArg()}async componentWillLoad(){({strings:this.strings}=await(0,n.b)(this.hostElement,(0,r.g)("."))),await this.processLayerArg(),this.processDefaultValue()}render(){return(0,r.h)("div",null,(0,r.h)("rfx-dtex-common-select",{isInGrid:this.isInGrid,options:this.options,value:this.value,placeHolderText:this.strings.selectField,onRfxArgumentChange:this.handleFieldSelectChange}))}async getSelectedRasterLayer(e){e=(0,u.g)(e);const t=this.inputLayers.find((t=>t.url===e));if(t&&(await t.load(),(0,o.l)(t)))try{t.rasterInfo=await t.generateRasterInfo(t.rasterFunction)}catch(e){console.error(e)}return t}async processLayerArg(){if((0,o.i)(this.rasterInputVariable))if((0,o.i)(this.layerArg))this.setDefaultFieldOptions();else{const e=this.layerArg.input;e?(await this.updateFields(),e.addEventListener("rfxArgumentChange",(async()=>{await this.updateFields()}))):this.setDefaultFieldOptions()}else await this.updateFields();this.rfxFieldOptionsLoaded.emit()}async updateFields(){let e;if((0,o.i)(this.rasterInputVariable?.value)){if(!(0,o.i)(this.layerArg)){const t=this.layerArg.input;e="function"==typeof t.getSelectedLayer?await t.getSelectedLayer():void 0}}else e=await this.getSelectedRasterLayer(this.rasterInputVariable?.value?.url);if(e){if((0,o.h)(e))this.options=this.convertFieldsToOptions(e.fields),this.otherOptions&&this.addOtherOptions();else if((0,o.l)(e)||(0,o.m)(e))if(e.sourceJSON?.hasRasterAttributeTable){const t=(0,o.l)(e)?e.serviceRasterInfo.attributeTable:e.rasterInfo.attributeTable;(0,o.i)(t?.fields)?this.setDefaultFieldOptions():this.setFieldOptions(t.fields)}else this.setDefaultFieldOptions()}else this.setDefaultFieldOptions();this.processDefaultValue()}addOtherOptions(){const e=[],t=this.options,i=this.otherOptions;Object.keys(i).forEach((function(t){const r={key:t,label:i[t]};e.push(r)})),t&&t.length>0?(e.forEach((function(e){t.some((function(t){if(t.key===e.key)return!0}))||t.push(e)})),this.options=t):this.options=e}setFieldOptions(e){const t=["esriFieldTypeString"],i=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].concat(t),r=this.fieldType;if(e?.length>0){const a=(e=JSON.parse(JSON.stringify(e))).filter((e=>"list"===r?t.indexOf(e.type)>-1:i.indexOf(e.type)>-1));this.options=this.convertFieldsToOptions(a)}else this.setDefaultFieldOptions()}setDefaultFieldOptions(){!0===this.showDefaultFields&&(this.options=this.isInGrid?[{key:"VALUE",label:this.strings.value}]:[{key:"VALUE",label:this.strings.value},{key:"COUNT",label:this.strings.count}])}convertFieldsToOptions(e){const t=[];return e.map((e=>{t.push({key:e.name,label:e.alias})})),t}processDefaultValue(){(0,o.i)(this.options)||this.options?.length<1||(void 0!==this.value&&null!==this.value&&this.options.some((e=>e.key===this.value))||(this.value=this.options[0].key),(0,o.i)(this.rasterInputVariable)&&(0,o.i)(this.layerArg)||this.rfxArgumentChange.emit({value:this.value}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}static get watchers(){return{rasterInputVariable:["onrasterInputVariableChange"]}}},m=class{constructor(e){(0,r.r)(this,e),this.rfxGridOptionChange=(0,r.c)(this,"rfxGridOptionChange",7),this.rfxGridRowClick=(0,r.c)(this,"rfxGridRowClick",7),this.gridValueChange=e=>{e.stopImmediatePropagation();const t=e.type,i=e.target;let r,a;switch(t){case"calciteCheckboxChange":case"calciteSwitchChange":r=i.checked;break;default:r=i.value}if(i?.tagName===c.A.RFX_DTE_RASTER_INPUT&&r?.hasOwnProperty("url")){const e=(0,u.a)();e.value=(0,u.c)(r),a=e}const[s,n]=i.id.split("-");let o;this.gridOptions=this.gridOptions.map(((e,t)=>(e.id===Number.parseInt(n,10)&&(i.id.indexOf(s)>-1&&(this.gridLayout[s].uiType===c.G.select?e[s].value=a??r:e[s]=a??r),o=t),e))),this.canAdd&&this.addRow(),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:o})},this.onRemoveClick=e=>{const t=e.target.id.split("-")[1],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.gridOptions=this.gridOptions.filter((e=>e.id!==Number.parseInt(t,10))),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:i}),0===this.gridOptions.length&&(this.gridOptions=[{id:this.gridOptions.length}])},this.onGridRowClick=e=>{e.stopPropagation();const t=e.currentTarget.id.split("_")[2],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.rfxGridRowClick.emit({gridOptions:this.gridOptions,rowIndex:i})},this.gridOptions=[],this.inputLayers=void 0,this.canAdd=!0,this.canRemove=!0,this.hasHeader=!0,this.isStacked=!1,this.gridLayout=void 0,this.hasIdColumn=!0,this.hasBorder=!1,this.rfxBrowseLayerClick=void 0}async componentWillLoad(){({strings:this.strings}=await(0,n.b)(this.hostElement,(0,r.g)(".")))}adjustValueListItemIds(){this.gridOptions.forEach(((e,t)=>{e.id=t}))}isLastRowEmpty(e){return!Object.keys(this.gridLayout).some((t=>{const i=this.gridLayout[t].uiType===c.G.select?e[t].value:e[t];return!(0,o.i)(i)}))}addRow(){const e=this.gridOptions[this.gridOptions.length-1];if(this.isLastRowEmpty(e))return;this.adjustValueListItemIds();const t={id:this.gridOptions.length};for(const e in this.gridLayout)if(this.gridLayout.hasOwnProperty(e)){const i=this.gridLayout[e].uiType===c.G.select,r=this.gridOptions[0][e];i&&(t[e]={...r,value:void 0})}this.gridOptions.push(t)}renderGridRow(e,t){const i=Number.parseInt(t,10)+1,a=Object.keys(this.gridLayout).map((t=>{const i=this.gridLayout[t];switch(i.uiType){case c.G.textInput:return(0,r.h)("td",null,(0,r.h)("calcite-input-text",{class:i.style,scale:s.U.Scale,key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onCalciteInputTextChange:this.gridValueChange,title:e[t]}));case c.G.text:return(0,r.h)("td",{key:`${t}_${e.id}`},i.constValue||e[t]);case c.G.raster:return(0,r.h)("td",null,(0,r.h)("rfx-dte-raster-input",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,allowScalar:i.allowScalar,rfxVariable:e.rasterElement,value:e[t]?.value,overlayPositioning:s.a.fixed,onRfxArgumentChange:this.gridValueChange,rfxBrowseLayerClick:this.rfxBrowseLayerClick}));case c.G.number:return(0,r.h)("td",null,(0,r.h)("calcite-input-number",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onCalciteInputNumberChange:this.gridValueChange,scale:s.U.Scale,numberButtonType:"none",title:e[t]}));case c.G.boolean:return(0,r.h)("td",null,(0,r.h)("calcite-checkbox",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteCheckboxChange:this.gridValueChange}));case c.G.switch:return(0,r.h)("td",null,(0,r.h)("calcite-switch",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteSwitchChange:this.gridValueChange}));case c.G.field:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-field-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,isInGrid:!0,rasterInputVariable:e.layer,value:e[t],onRfxArgumentChange:this.gridValueChange}));case c.G.color:return(0,r.h)("td",null,(0,r.h)("rfx-color-picker",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onRfxColorPickerValueChange:this.gridValueChange}));case c.G.select:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-common-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,options:e[t].options,value:e[t].value,allowCustomValues:i.allowCustomValues,isInGrid:!0,onRfxArgumentChange:this.gridValueChange}));case c.G.icon:return(0,r.h)("td",null,e[t]?(0,r.h)("calcite-icon",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,icon:i.icon,scale:s.C.s,textLabel:i.label}):null)}}));return!0===this.hasIdColumn&&a.unshift((0,r.h)("td",null,(0,r.h)("div",{key:`idColumn_${e.id}`},i))),!0===this.canRemove&&a.push((0,r.h)("td",null,(0,r.h)("calcite-icon",{id:`remove-${e.id}`,key:`remove-${e.id}`,scale:s.U.Scale,icon:"x",onClick:i===this.gridOptions.length?void 0:this.onRemoveClick}))),a}renderHeader(){return(0,r.h)("thead",null,(0,r.h)("tr",null,!0===this.hasIdColumn&&(0,r.h)("th",null,this.strings.id),Object.keys(this.gridLayout).map((e=>{const t=this.gridLayout[e];return(0,r.h)("th",{class:`${t.style}`},t.label)})),!0===this.canRemove&&(0,r.h)("th",null," ")))}renderGridOptions(){return this.gridOptions.map(((e,t)=>(0,r.h)("tr",{id:`grid_row_${e.id}`,key:`grid_row_${e.id}`,onClick:t===this.gridOptions.length-1?void 0:this.onGridRowClick},this.renderGridRow(e,t))))}render(){return(0,r.h)(r.H,null,(0,r.h)("table",{class:`rfx-grid__grid-container ${this.hasBorder?"border":""} ${this.isStacked?"stacked":""}`},this.hasHeader&&this.renderHeader(),(0,r.h)("tbody",null,...this.renderGridOptions())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}};m.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.rfx-grid__grid-container{width:100%;border-collapse:collapse}.rfx-grid__grid-container div{box-sizing:border-box}.rfx-grid__grid-container body{width:100%;height:100%;margin:0;padding:0}.rfx-grid__grid-container td{padding:0.5em;text-align:center}.rfx-grid__grid-container th{background:var(--calcite-color-foreground-2);padding:0.5em;border:1px solid var(--calcite-color-foreground-3);text-align:center;font-weight:normal}.rfx-grid__grid-container.border td{border:1px solid var(--calcite-color-foreground-3)}.rfx-grid__grid-container.stacked td,.rfx-grid__grid-container.stacked th{text-align:inherit;display:block;width:auto}"},64729:(e,t,i)=>{i.d(t,{C:()=>a,U:()=>r,a:()=>s});const r={Scale:"s",PopoverTimer:60},a={s:"s",m:"m"},s={absolute:"absolute",fixed:"fixed"}}}]);