"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-01fbb1"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-color-picker_5.entry.js":
/*!************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-color-picker_5.entry.js ***!
  \************************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   rfx_color_picker: () => (/* binding */ RFxColorPicker),
/* harmony export */   rfx_dte_raster_input: () => (/* binding */ RFxRasterInput),
/* harmony export */   rfx_dtex_common_select: () => (/* binding */ RFxCommonSelect),
/* harmony export */   rfx_dtex_field_select: () => (/* binding */ RFxFieldSelect),
/* harmony export */   rfx_grid: () => (/* binding */ RFxGrid)
/* harmony export */ });
/* harmony import */ var _index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-da1b7138.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/index-da1b7138.js");
/* harmony import */ var _arcgis_core_Color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @arcgis/core/Color.js */ "@arcgis/core/Color.js");
/* harmony import */ var _arcgis_core_core_lang_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @arcgis/core/core/lang.js */ "@arcgis/core/core/lang.js");
/* harmony import */ var _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-utils-928a4096.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js");
/* harmony import */ var _arcgis_core_identity_IdentityManager_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @arcgis/core/identity/IdentityManager.js */ "@arcgis/core/identity/IdentityManager.js");
/* harmony import */ var _arcgis_core_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @arcgis/core/core/urlUtils.js */ "@arcgis/core/core/urlUtils.js");
/* harmony import */ var _arcgis_core_layers_Layer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @arcgis/core/layers/Layer.js */ "@arcgis/core/layers/Layer.js");
/* harmony import */ var _arcgis_core_layers_ImageryLayer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @arcgis/core/layers/ImageryLayer.js */ "@arcgis/core/layers/ImageryLayer.js");
/* harmony import */ var _arcgis_core_smartMapping_raster_renderers_stretch_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @arcgis/core/smartMapping/raster/renderers/stretch.js */ "@arcgis/core/smartMapping/raster/renderers/stretch.js");
/* harmony import */ var _arcgis_core_request_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @arcgis/core/request.js */ "@arcgis/core/request.js");
/* harmony import */ var _arcgis_core_rest_support_AlgorithmicColorRamp_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @arcgis/core/rest/support/AlgorithmicColorRamp.js */ "@arcgis/core/rest/support/AlgorithmicColorRamp.js");
/* harmony import */ var _arcgis_core_rest_support_MultipartColorRamp_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @arcgis/core/rest/support/MultipartColorRamp.js */ "@arcgis/core/rest/support/MultipartColorRamp.js");
/* harmony import */ var _colorRampUtils_8bdd46c5_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./colorRampUtils-8bdd46c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/colorRampUtils-8bdd46c5.js");
/* harmony import */ var _arcgis_core_rest_geoprocessor_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @arcgis/core/rest/geoprocessor.js */ "@arcgis/core/rest/geoprocessor.js");
/* harmony import */ var _arcgis_core_portal_PortalItem_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @arcgis/core/portal/PortalItem.js */ "@arcgis/core/portal/PortalItem.js");
/* harmony import */ var _localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./localization-helper-4819b67d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/localization-helper-4819b67d.js");
/* harmony import */ var _type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./type-gaurds-1840747f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/type-gaurds-1840747f.js");
/* harmony import */ var _rfx_args_helper_ab401543_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./rfx-args-helper-ab401543.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-args-helper-ab401543.js");
/* harmony import */ var _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./interfaces-d0c68944.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/interfaces-d0c68944.js");
/* harmony import */ var _layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./layer-helper-3867eef7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/layer-helper-3867eef7.js");
/* harmony import */ var _common_fda1462e_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./common-fda1462e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/common-fda1462e.js");
/* harmony import */ var _getTag_96af029d_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./_getTag-96af029d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/_getTag-96af029d.js");
/* harmony import */ var _resources_27c66f5c_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./resources-27c66f5c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/resources-27c66f5c.js");
/* harmony import */ var _functions_f1f2dffd_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./functions-f1f2dffd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/functions-f1f2dffd.js");
/* harmony import */ var _Uint8Array_68e1e3f9_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./_Uint8Array-68e1e3f9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/_Uint8Array-68e1e3f9.js");


























const RFxColorPicker = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxColorPickerValueChange = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxColorPickerValueChange", 7);
        /**
         * called on color swatch click.
         * creates a popover element with color picker
         * @param e
         */
        this.onColorSwatchClick = (e) => {
            const color = e.target.value;
            this.popoverElememt.open = false;
            this.value = new _arcgis_core_Color_js__WEBPACK_IMPORTED_MODULE_1__["default"](color).toRgba();
            this.rfxColorPickerValueChange.emit({ value: this.value });
        };
        this.value = [0, 0, 0, 255];
    }
    /**
     * Public method
     * @returns HTMLRfxColorPickerElement
     */
    render() {
        const color = new _arcgis_core_Color_js__WEBPACK_IMPORTED_MODULE_1__["default"](this.value).toHex();
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker-swatch", { active: false, color: color, id: "color-picker-swatch", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale,
            // onClick={this.onColorSwatchClick}
            ref: (e) => {
            } }), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { autoClose: true, pointerDisabled: true, referenceElement: "color-picker-swatch", placement: "auto", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, label: "color-picker-popover", ref: (e) => {
                this.popoverElememt = e;
            } }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker", { scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, value: color, format: "auto", onCalciteColorPickerInput: this.onColorSwatchClick }))));
    }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
};

const rfxDteRasterInputCss = ":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.browse-layer{--calcite-ui-text-1:var(--calcite-color-text-link);--calcite-ui-text-3:var(--calcite-color-text-link)}";

const RFxRasterInput = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxArgumentChange = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxArgumentChange", 7);
        /**
         * save the processed scalar value
         */
        this.scalarValues = [];
        /**
         * flag indicating whether the widget is loaded.
         * flag is set to true once processValueLayer is completed
         */
        this.loaded = false;
        this.inputLayers = undefined;
        this.value = undefined;
        this.allowScalar = false;
        this.overlayPositioning = _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.a.absolute;
        this.rfxVariable = undefined;
        this.mode = undefined;
        this.rfxBrowseLayerClick = undefined;
    }
    onRFxVariableChange(variableData) {
        if (variableData.value) {
            this.value = variableData.value;
            return;
        }
        this.argRFT = (0,_rfx_args_helper_ab401543_js__WEBPACK_IMPORTED_MODULE_17__.b)(variableData);
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async connectedCallback() {
        // load function is moved to connectedCallback as the function only deals with processing props;
        // Props should be processed in connectedCallback, to load data asynchronously and to setup the state componentWillLoad
        await this.load();
        this.loaded = true;
        return Promise.resolve();
    }
    async componentWillLoad() {
        ({ strings: this.strings } = await (0,_localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_15__.b)(this.hostElement, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.g)(`.`)));
    }
    /**
     * @categeory Public
     * @returns Promise<SupportedImageryLayerTypes>
     * returns the selected layer object
     */
    async getSelectedLayer() {
        // getSelectedLayer exposed method would be called before the connected callback is completed
        // hence a flag is used to make sure widget is initialized properly.
        if (this.loaded === false) {
            await this.load();
        }
        if (this.value !== undefined) {
            if (typeof this.value == "object") {
                return this._getSelectedLayer(this.value.url);
            }
        }
        return Promise.resolve(undefined);
    }
    /**
     * used to process the browsed layer
     * @param layers
     * @returns
     */
    async updateBrowsedLayer(layers) {
        layers.forEach((layer) => {
            //push to inputput layers if it does not exist
            const browsedLayer = this.inputLayers.filter((inputLayer) => layer.url === inputLayer.url);
            if (browsedLayer.length === 0) {
                this.inputLayers.push(layer);
            }
            this.value = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.d)(layer);
            this.rfxArgumentChange.emit({ value: this.value });
        });
        return Promise.resolve(undefined);
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    async load() {
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.rfxVariable)) {
            this.onRFxVariableChange(this.rfxVariable);
        }
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.value)) {
            await this.processValueLayer();
        }
    }
    async processValueLayer() {
        if (this.value.type?.toLowerCase() === "scalar") {
            //if its scalar add to scalar values
            this.scalarValues.push(this.value);
            return;
        }
        const valueLayerUrl = this.value?.url;
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(valueLayerUrl)) {
            return;
        }
        const selectedLayerId = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.e)(this.value, this.inputLayers);
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(selectedLayerId)) {
            // if the value is not present in the input layers we need to add it
            const arcGISImageServiceLayerObject = await (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.f)(this.value);
            if (arcGISImageServiceLayerObject !== undefined) {
                this.inputLayers = [...this.inputLayers, arcGISImageServiceLayerObject];
            }
        }
        // regenerate token for layer url
        const selectedLayer = await this._getSelectedLayer((0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.g)(valueLayerUrl));
        if (selectedLayer !== undefined) {
            this.value = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.d)(selectedLayer);
        }
        // FIXME : temp solution to layer duplication, ideally expose "startup" method (similar to dojo)
        // for components that expose public methods, and call startup immediately after widget creation.
        this.inputLayers = (0,_common_fda1462e_js__WEBPACK_IMPORTED_MODULE_20__.a)(this.inputLayers, "url");
    }
    async _handleComboBoxChange(e) {
        const selectedItem = e.target.value;
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(selectedItem)) {
            this.value = undefined;
        }
        else if (selectedItem === "browse") {
            this.value = undefined;
            this.rfxBrowseLayerClick({ referenceElement: this.hostElement });
            return;
        }
        else {
            const selectedLayer = await this._getSelectedLayer(selectedItem);
            if (selectedLayer !== undefined) {
                this.value = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.d)(selectedLayer);
            }
            else if (this.allowScalar == true) {
                this.value = {
                    type: "Scalar",
                    value: selectedItem
                };
            }
        }
        this.rfxArgumentChange.emit({ value: this.value });
    }
    async _getSelectedLayer(url) {
        url = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.g)(url);
        const selectedLayer = this.inputLayers.find((layer) => layer.url === url);
        if (selectedLayer) {
            await selectedLayer.load();
            if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.l)(selectedLayer)) {
                // calculate necessary info and add to the ImageryLayerArg for other widgets to use
                try {
                    // use ImageryLayer.rasterFunction instead of renderingRule as it is deprecated since 4.27
                    selectedLayer.rasterInfo = await selectedLayer.generateRasterInfo(selectedLayer.rasterFunction);
                }
                catch (error) {
                    console.error(error);
                }
            }
        }
        return selectedLayer;
    }
    getFormattedValueFromVariable() {
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.argRFT)) {
            const functionName = this.argRFT.function?.name;
            return `<${functionName}.${this.strings.outputRaster}>`;
        }
        return this.mode === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.a.ANALYSIS
            ? this.getDefaultPlaceHolder()
            : `<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`;
    }
    getDefaultPlaceHolder() {
        if (this.allowScalar) {
            return this.strings.allowScalar;
        }
        else {
            return this.strings.selectLayer;
        }
    }
    getPlaceHolderText() {
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.rfxVariable)) {
            return this.getFormattedValueFromVariable();
        }
        else {
            return this.getDefaultPlaceHolder();
        }
    }
    renderInputOptions(value) {
        let options = [];
        if (this.inputLayers && Array.isArray(this.inputLayers)) {
            options = this.inputLayers.map((layer, index) => {
                if (layer?.url !== undefined) {
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: `layer-item-${index}`, value: layer.url, selected: layer.url === value, textLabel: layer.title, icon: layer.type === "imagery" ? "image-layer" : "tiled-imagery-layer", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale }));
                }
            });
        }
        if (this.scalarValues?.length !== 0) {
            // if the value is scalar show it as selected
            this.scalarValues.forEach((scalarValue) => {
                options.push((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: `layer-item-${this.inputLayers.length + 1}`, value: scalarValue.value, textLabel: scalarValue.value, selected: true, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale }));
            });
        }
        return options;
    }
    render() {
        const layerUrl = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.g)(this.value?.url);
        const value = (0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.value)
            ? this.value
            : this.value?.type === "Scalar"
                ? this.value.value
                : layerUrl;
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "esriRFxRasterInput" }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: "rfx-dte-raster-input-combobox", placeholder: this.getPlaceHolderText(), selectionMode: "single", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, maxItems: 0, disabled: this.argRFT !== undefined, allowCustomValues: this.allowScalar, value: value, onCalciteComboboxChange: (e) => this._handleComboBoxChange(e), overlayPositioning: this.overlayPositioning, clearDisabled: true }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { class: "browse-layer", key: "layer-item-browse", value: "browse", textLabel: this.strings.browseLayer, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, icon: "search", filterDisabled: true }), ...this.renderInputOptions(value)))));
    }
    static get assetsDirs() { return ["t9n"]; }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
    static get watchers() { return {
        "rfxVariable": ["onRFxVariableChange"]
    }; }
};
RFxRasterInput.style = rfxDteRasterInputCss;

const RFxCommonSelect = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxArgumentChange = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxArgumentChange", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Methods
        //
        //--------------------------------------------------------------------------
        this.handleComboBoxChange = (e) => {
            const value = e.target.value;
            if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(value)) {
                this.value = value;
                this.rfxArgumentChange.emit({ value: this.value });
            }
        };
        this.options = [];
        this.value = "";
        this.allowCustomValues = false;
        this.placeHolderText = undefined;
        this.isInGrid = false;
        this.isNullable = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentDidRender() {
        if (this.isNullable !== true) {
            // workaround suggested by calcite team https://github.com/Esri/calcite-components/issues/4738#issuecomment-1564799076
            const combobox = this.hostElement.shadowRoot.querySelector("calcite-combobox");
            combobox.addEventListener("click", (event) => {
                const target = event.target;
                if (target.tagName === "CALCITE-COMBOBOX-ITEM" && combobox.value === target.value) {
                    event.stopPropagation();
                }
            }, { capture: true });
        }
    }
    render() {
        let selectOptions = [];
        if (this.options && Array.isArray(this.options)) {
            selectOptions = this.options.map((option, index) => {
                return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: `common-select-item-${index}-${option.key}`, value: option.key, textLabel: option.label, selected: option.key === this.value, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale }));
            });
        }
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { selectionMode: "single", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, maxItems: 0, label: "rfx-dtex-common-select-combobox", placeholder: this.placeHolderText, allowCustomValues: this.allowCustomValues, clearDisabled: !this.isNullable, overlayPositioning: this.isInGrid ? "fixed" : "absolute", onCalciteComboboxChange: (e) => this.handleComboBoxChange(e) }, ...selectOptions)));
    }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
};

const RFxFieldSelect = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxArgumentChange = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxArgumentChange", 7);
        this.rfxFieldOptionsLoaded = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxFieldOptionsLoaded", 7);
        this.handleFieldSelectChange = (e) => {
            const element = e.target;
            this.value = element.value;
            this.rfxArgumentChange.emit({ value: this.value });
        };
        this.layerArg = undefined;
        this.rasterInputVariable = undefined;
        this.otherOptions = undefined;
        this.value = undefined;
        this.options = undefined;
        this.fieldType = undefined;
        this.isInGrid = false;
        this.inputLayers = undefined;
        this.showDefaultFields = true;
    }
    onrasterInputVariableChange() {
        this.processLayerArg();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        ({ strings: this.strings } = await (0,_localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_15__.b)(this.hostElement, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.g)(`.`)));
        await this.processLayerArg();
        this.processDefaultValue();
    }
    render() {
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("rfx-dtex-common-select", { isInGrid: this.isInGrid, options: this.options, value: this.value, placeHolderText: this.strings.selectField, onRfxArgumentChange: this.handleFieldSelectChange })));
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    async getSelectedRasterLayer(url) {
        url = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.g)(url);
        const selectedLayer = this.inputLayers.find((layer) => layer.url === url);
        if (selectedLayer) {
            await selectedLayer.load();
            if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.l)(selectedLayer)) {
                try {
                    // use ImageryLayer.rasterFunction instead of renderingRule as it is deprecated since 4.27
                    selectedLayer.rasterInfo = await selectedLayer.generateRasterInfo(selectedLayer.rasterFunction);
                }
                catch (error) {
                    console.error(error);
                }
            }
        }
        return selectedLayer;
    }
    async processLayerArg() {
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.rasterInputVariable)) {
            // for case where field-select is in rfx-grid row
            await this.updateFields();
        }
        else if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.layerArg)) {
            const input = this.layerArg.input;
            if (input) {
                await this.updateFields();
                // listen to layer input change and update fields upon change event
                input.addEventListener("rfxArgumentChange", async () => {
                    await this.updateFields();
                });
            }
            else {
                // set default field options if no layer input
                this.setDefaultFieldOptions();
            }
        }
        else {
            // set default field options if no selected layer obj and no input layer arg
            this.setDefaultFieldOptions();
        }
        this.rfxFieldOptionsLoaded.emit();
    }
    async updateFields() {
        let layer;
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.rasterInputVariable?.value)) {
            layer = await this.getSelectedRasterLayer(this.rasterInputVariable?.value?.url);
        }
        else if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.layerArg)) {
            const layerInput = this.layerArg.input;
            layer =
                typeof layerInput.getSelectedLayer === "function"
                    ? await layerInput.getSelectedLayer()
                    : undefined;
        }
        if (!layer) {
            this.setDefaultFieldOptions();
        }
        else if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.h)(layer)) {
            this.options = this.convertFieldsToOptions(layer.fields);
            if (this.otherOptions) {
                this.addOtherOptions();
            }
        }
        else if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.l)(layer) || (0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.m)(layer)) {
            if (layer.sourceJSON?.hasRasterAttributeTable) {
                // Since 4.14
                // hasRasterAttributeTable moved under layer.sourceJSON
                const rat = (0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.l)(layer)
                    ? layer.serviceRasterInfo.attributeTable
                    : layer.rasterInfo.attributeTable;
                if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(rat?.fields)) {
                    // set field options according to fields from raster attribute table
                    this.setFieldOptions(rat.fields);
                }
                else {
                    // set default fields if no fields data on RAT
                    this.setDefaultFieldOptions();
                }
            }
            else {
                // set default fields if raster layer has no RAT
                this.setDefaultFieldOptions();
            }
        }
        this.processDefaultValue();
    }
    addOtherOptions() {
        const extraOptions = [], currentOptions = this.options;
        const otherOptions = this.otherOptions;
        Object.keys(otherOptions).forEach(function (key) {
            const option = {
                key: key,
                label: otherOptions[key]
            };
            extraOptions.push(option);
        });
        if (currentOptions && currentOptions.length > 0) {
            extraOptions.forEach(function (extraOption) {
                if (!currentOptions.some(function (currentOption) {
                    if (currentOption.key === extraOption.key) {
                        return true;
                    }
                })) {
                    currentOptions.push(extraOption);
                }
            });
            this.options = currentOptions;
        }
        else {
            this.options = extraOptions;
        }
    }
    setFieldOptions(fields) {
        const numFieldTypes = [
            "esriFieldTypeSmallInteger",
            "esriFieldTypeInteger",
            "esriFieldTypeSingle",
            "esriFieldTypeDouble"
        ];
        const stringFieldTypes = ["esriFieldTypeString"];
        const validFieldTypes = numFieldTypes.concat(stringFieldTypes);
        const fieldType = this.fieldType;
        if (fields?.length > 0) {
            // Since js-api 4.12, fields on RAT no longer in JSON format
            fields = JSON.parse(JSON.stringify(fields));
            const filteredFields = fields.filter((field) => {
                if (fieldType === "list") {
                    return stringFieldTypes.indexOf(field.type) > -1;
                }
                else {
                    return validFieldTypes.indexOf(field.type) > -1;
                }
            });
            this.options = this.convertFieldsToOptions(filteredFields);
        }
        else {
            this.setDefaultFieldOptions();
        }
    }
    setDefaultFieldOptions() {
        if (this.showDefaultFields === true) {
            // if widget is in grid, only show 'VALUE' as default
            // otherwise show "VALUE" and "COUNT" as default
            this.options = this.isInGrid
                ? [
                    {
                        key: "VALUE",
                        label: this.strings.value
                    }
                ]
                : [
                    {
                        key: "VALUE",
                        label: this.strings.value
                    },
                    {
                        key: "COUNT",
                        label: this.strings.count
                    }
                ];
        }
    }
    convertFieldsToOptions(fields) {
        const options = [];
        fields.map((field) => {
            options.push({ key: field.name, label: field.alias });
        });
        return options;
    }
    processDefaultValue() {
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.options) || this.options?.length < 1) {
            return;
        }
        if (this.value === undefined ||
            this.value === null ||
            !this.options.some((option) => option.key === this.value)) {
            this.value = this.options[0].key;
        }
        if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.rasterInputVariable) || !(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(this.layerArg)) {
            this.rfxArgumentChange.emit({ value: this.value });
        }
    }
    static get assetsDirs() { return ["t9n"]; }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
    static get watchers() { return {
        "rasterInputVariable": ["onrasterInputVariableChange"]
    }; }
};

const component = "rfx-grid";
const HTMLClasses = {
    gridContainer: `${component}__grid-container`,
    border: "border",
    stacked: "stacked"
};

const rfxGridCss = ":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.rfx-grid__grid-container{width:100%;border-collapse:collapse}.rfx-grid__grid-container div{box-sizing:border-box}.rfx-grid__grid-container body{width:100%;height:100%;margin:0;padding:0}.rfx-grid__grid-container td{padding:0.5em;text-align:center}.rfx-grid__grid-container th{background:var(--calcite-color-foreground-2);padding:0.5em;border:1px solid var(--calcite-color-foreground-3);text-align:center;font-weight:normal}.rfx-grid__grid-container.border td{border:1px solid var(--calcite-color-foreground-3)}.rfx-grid__grid-container.stacked td,.rfx-grid__grid-container.stacked th{text-align:inherit;display:block;width:auto}";

const RFxGrid = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxGridOptionChange = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxGridOptionChange", 7);
        this.rfxGridRowClick = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxGridRowClick", 7);
        /**
         * called when change happens in the editable colum inside grid
         * @param event
         */
        this.gridValueChange = (event) => {
            event.stopImmediatePropagation();
            const eventType = event.type;
            const element = event.target;
            let value, updatedValue;
            switch (eventType) {
                case "calciteCheckboxChange":
                case "calciteSwitchChange":
                    value = element.checked;
                    break;
                default:
                    value = element.value;
                    break;
            }
            if (element?.tagName === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.A.RFX_DTE_RASTER_INPUT &&
                value?.hasOwnProperty("url")) {
                // if value is in the format of RasterJSON, convert it to RFxVariable
                const rasterRFxVariable = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.a)();
                rasterRFxVariable.value = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_19__.c)(value);
                updatedValue = rasterRFxVariable;
            }
            const [columnName, id] = element.id.split("-");
            let rowIndex;
            this.gridOptions = this.gridOptions.map((gridOption, index) => {
                if (gridOption.id === Number.parseInt(id, 10)) {
                    if (element.id.indexOf(columnName) > -1) {
                        const columnLayout = this.gridLayout[columnName];
                        const uiType = columnLayout.uiType;
                        if (uiType === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.select) {
                            gridOption[columnName].value = updatedValue ?? value;
                        }
                        else {
                            gridOption[columnName] = updatedValue ?? value;
                        }
                    }
                    rowIndex = index;
                }
                return gridOption;
            });
            if (this.canAdd) {
                this.addRow();
            }
            this.rfxGridOptionChange.emit({ gridOptions: this.gridOptions, rowIndex: rowIndex });
        };
        /**
         * called when remove button is clicked
         * @param event
         */
        this.onRemoveClick = (event) => {
            const key = event.target.id.split("-")[1];
            const rowIndex = this.gridOptions.findIndex((gridOption) => gridOption.id === Number.parseInt(key, 10));
            this.gridOptions = this.gridOptions.filter((gridOption) => gridOption.id !== Number.parseInt(key, 10));
            this.rfxGridOptionChange.emit({ gridOptions: this.gridOptions, rowIndex: rowIndex });
            if (this.gridOptions.length === 0) {
                this.gridOptions = [
                    {
                        id: this.gridOptions.length
                    }
                ];
            }
        };
        /**
         * called when a grid row is clicked
         * @param event
         */
        this.onGridRowClick = (event) => {
            event.stopPropagation();
            const key = event.currentTarget.id.split("_")[2];
            const rowIndex = this.gridOptions.findIndex((gridOption) => gridOption.id === Number.parseInt(key, 10));
            this.rfxGridRowClick.emit({ gridOptions: this.gridOptions, rowIndex: rowIndex });
        };
        this.gridOptions = [];
        this.inputLayers = undefined;
        this.canAdd = true;
        this.canRemove = true;
        this.hasHeader = true;
        this.isStacked = false;
        this.gridLayout = undefined;
        this.hasIdColumn = true;
        this.hasBorder = false;
        this.rfxBrowseLayerClick = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        ({ strings: this.strings } = await (0,_localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_15__.b)(this.hostElement, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.g)(`.`)));
    }
    /**
     * function to correct the ids in the options, before adding a new one.
     *  We need the becuse in between ids can be removed and adding one id equal to array length doesnt work
     */
    adjustValueListItemIds() {
        this.gridOptions.forEach((option, idx) => {
            option.id = idx;
        });
    }
    /**
     * To check all the columns in a row is empty
     * @param lastOption
     * @returns
     */
    isLastRowEmpty(lastOption) {
        return !Object.keys(this.gridLayout).some((key) => {
            const fieldLayout = this.gridLayout[key];
            const isSelectLayout = fieldLayout.uiType === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.select;
            const lastOptionValue = isSelectLayout ? lastOption[key].value : lastOption[key];
            return !(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_16__.i)(lastOptionValue);
        });
    }
    /**
     * called to add a new row to the grid.
     * adding a row is automated and will add when last row change occurs
     */
    addRow() {
        const lastOption = this.gridOptions[this.gridOptions.length - 1];
        const shouldAddNewRow = !this.isLastRowEmpty(lastOption);
        if (!shouldAddNewRow) {
            return;
        }
        this.adjustValueListItemIds();
        const newGridItem = {
            id: this.gridOptions.length
        };
        // In case the layout has any field of type "select"
        // We need to provide options for the new row
        for (const fieldName in this.gridLayout) {
            if (this.gridLayout.hasOwnProperty(fieldName)) {
                const fieldLayout = this.gridLayout[fieldName];
                const isSelectLayout = fieldLayout.uiType === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.select;
                const defaultOptions = this.gridOptions[0][fieldName];
                if (isSelectLayout) {
                    newGridItem[fieldName] = {
                        ...defaultOptions,
                        value: undefined
                    };
                }
            }
        }
        this.gridOptions.push(newGridItem);
    }
    /**
     * render columns in row based on the schema type
     * @param gridOption
     * @param index
     * @returns
     */
    renderGridRow(gridOption, index) {
        const id = Number.parseInt(index, 10) + 1;
        const rowElements = Object.keys(this.gridLayout).map((columnName) => {
            const columnLayout = this.gridLayout[columnName];
            const uiType = columnLayout.uiType;
            switch (uiType) {
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.textInput:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-text", { class: columnLayout.style, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, value: gridOption[columnName], onCalciteInputTextChange: this.gridValueChange, title: gridOption[columnName] })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.text:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", { key: `${columnName}_${gridOption.id}` }, columnLayout.constValue || gridOption[columnName]));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.raster:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("rfx-dte-raster-input", { class: columnLayout.style, key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, inputLayers: this.inputLayers, allowScalar: columnLayout.allowScalar, rfxVariable: gridOption.rasterElement, value: gridOption[columnName]?.value, overlayPositioning: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.a.fixed, onRfxArgumentChange: this.gridValueChange, rfxBrowseLayerClick: this.rfxBrowseLayerClick })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.number:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-number", { key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, value: gridOption[columnName], onCalciteInputNumberChange: this.gridValueChange, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, numberButtonType: "none", title: gridOption[columnName] })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.boolean:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, checked: gridOption[columnName], onCalciteCheckboxChange: this.gridValueChange })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.switch:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, checked: gridOption[columnName], onCalciteSwitchChange: this.gridValueChange })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.field:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("rfx-dtex-field-select", { class: columnLayout.style, key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, inputLayers: this.inputLayers, isInGrid: true, rasterInputVariable: gridOption.layer, value: gridOption[columnName], onRfxArgumentChange: this.gridValueChange })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.color:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("rfx-color-picker", { key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, value: gridOption[columnName], onRfxColorPickerValueChange: this.gridValueChange })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.select:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("rfx-dtex-common-select", { class: columnLayout.style, key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, options: gridOption[columnName].options, value: gridOption[columnName].value, allowCustomValues: columnLayout.allowCustomValues, isInGrid: true, onRfxArgumentChange: this.gridValueChange })));
                case _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_18__.G.icon:
                    return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, gridOption[columnName] ? ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { key: `${columnName}-${gridOption.id}`, id: `${columnName}-${gridOption.id}`, icon: columnLayout.icon, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.C.s, textLabel: columnLayout.label })) : null));
            }
        });
        //if hasId column is true creates a number column at the begining
        if (this.hasIdColumn === true) {
            rowElements.unshift((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { key: `idColumn_${gridOption.id}` }, id)));
        }
        // if canRemove is true adds a remove button at the end. Also for the last row, this button action is disabled
        if (this.canRemove === true) {
            rowElements.push((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("td", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { id: `remove-${gridOption.id}`, key: `remove-${gridOption.id}`, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_3__.U.Scale, icon: "x", onClick: id === this.gridOptions.length ? undefined : this.onRemoveClick })));
        }
        return rowElements;
    }
    /**
     * to render the header
     * @returns
     */
    renderHeader() {
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("thead", null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", null, this.hasIdColumn === true && (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", null, this.strings.id), Object.keys(this.gridLayout).map((layout) => {
            const columnLayout = this.gridLayout[layout];
            return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", { class: `${columnLayout.style}` }, columnLayout.label);
        }), this.canRemove === true && (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("th", null, " "))));
    }
    /**
     * to render each row in the grid
     * @returns Vnode[]
     */
    renderGridOptions() {
        return this.gridOptions.map((gridOption, index) => {
            return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("tr", { id: `grid_row_${gridOption.id}`, key: `grid_row_${gridOption.id}`, onClick: index === this.gridOptions.length - 1 ? undefined : this.onGridRowClick }, this.renderGridRow(gridOption, index)));
        });
    }
    render() {
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("table", { class: `${HTMLClasses.gridContainer} ${this.hasBorder ? HTMLClasses.border : ""} ${this.isStacked ? HTMLClasses.stacked : ""}` }, this.hasHeader && this.renderHeader(), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("tbody", null, ...this.renderGridOptions()))));
    }
    static get assetsDirs() { return ["t9n"]; }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
};
RFxGrid.style = rfxGridCss;



//# sourceMappingURL=rfx-color-picker_5.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CalciteScale),
/* harmony export */   U: () => (/* binding */ UIDefaults),
/* harmony export */   a: () => (/* binding */ CalciteOverlayPositioning)
/* harmony export */ });
const UIDefaults = {
    Scale: "s",
    PopoverTimer: 60
};
const CalciteScale = {
    s: "s",
    m: "m"
};
const CalciteOverlayPositioning = {
    absolute: "absolute",
    fixed: "fixed"
};



//# sourceMappingURL=ui-utils-928a4096.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXJjZ2lzLXJhc3Rlci1mdW5jdGlvbi1lZGl0b3JfLTAxZmJiMS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBK0k7QUFDakc7QUFDWDtBQUN5RTtBQUMxRDtBQUNYO0FBQ0Q7QUFDTztBQUNrQjtBQUM5QjtBQUMwQjtBQUNGO0FBQ25CO0FBQ0s7QUFDQTtBQUMwQztBQUMrQztBQUNyRTtBQUM4QjtBQUNvSTtBQUNqSztBQUNqQztBQUNFO0FBQ0E7QUFDRTs7QUFFbkM7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHlDQUF5QyxxREFBVztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDZEQUFTO0FBQ3RDLGtEQUFrRCxtQkFBbUI7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiw2REFBUztBQUNuQyxnQkFBZ0IscURBQUMsY0FBYyxxREFBQyxrQ0FBa0MsK0RBQStELG9EQUFVO0FBQzNJLHdCQUF3QjtBQUN4QjtBQUNBLGVBQWUsR0FBRyxxREFBQyxzQkFBc0IsMkdBQTJHLG9EQUFVO0FBQzlKO0FBQ0EsZUFBZSxFQUFFLHFEQUFDLDJCQUEyQixPQUFPLG9EQUFVLDBGQUEwRjtBQUN4SjtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDOztBQUVBLG9DQUFvQyw4QkFBOEIsb0NBQW9DLG9DQUFvQyxvQ0FBb0MsdUNBQXVDLHVDQUF1QyxzQ0FBc0MsNENBQTRDLDRDQUE0QyxtQ0FBbUMscUNBQXFDLHFDQUFxQyxxQ0FBcUMsK0JBQStCLCtCQUErQiwrQkFBK0IscUNBQXFDLGtDQUFrQyxpQ0FBaUMsaUNBQWlDLGlDQUFpQyxxQ0FBcUMsOEJBQThCLDBCQUEwQixvQ0FBb0Msd0JBQXdCLG1DQUFtQyxvREFBb0Qs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cy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcmNnaXMtcmFzdGVyLWZ1bmN0aW9uLWVkaXRvci9kaXN0L2VzbS9yZngtY29sb3ItcGlja2VyXzUuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXJjZ2lzLXJhc3Rlci1mdW5jdGlvbi1lZGl0b3IvZGlzdC9lc20vdWktdXRpbHMtOTI4YTQwOTYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBhIGFzIGdldEVsZW1lbnQsIGcgYXMgZ2V0QXNzZXRQYXRoLCBGIGFzIEZyYWdtZW50LCBIIGFzIEhvc3QgfSBmcm9tICcuL2luZGV4LWRhMWI3MTM4LmpzJztcbmltcG9ydCBlc3JpQ29sb3IgZnJvbSAnQGFyY2dpcy9jb3JlL0NvbG9yLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL2NvcmUvbGFuZy5qcyc7XG5pbXBvcnQgeyBVIGFzIFVJRGVmYXVsdHMsIGEgYXMgQ2FsY2l0ZU92ZXJsYXlQb3NpdGlvbmluZywgQyBhcyBDYWxjaXRlU2NhbGUgfSBmcm9tICcuL3VpLXV0aWxzLTkyOGE0MDk2LmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL2lkZW50aXR5L0lkZW50aXR5TWFuYWdlci5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9jb3JlL3VybFV0aWxzLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL2xheWVycy9MYXllci5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9sYXllcnMvSW1hZ2VyeUxheWVyLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL3NtYXJ0TWFwcGluZy9yYXN0ZXIvcmVuZGVyZXJzL3N0cmV0Y2guanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvcmVxdWVzdC5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9yZXN0L3N1cHBvcnQvQWxnb3JpdGhtaWNDb2xvclJhbXAuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvcmVzdC9zdXBwb3J0L011bHRpcGFydENvbG9yUmFtcC5qcyc7XG5pbXBvcnQgJy4vY29sb3JSYW1wVXRpbHMtOGJkZDQ2YzUuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvcmVzdC9nZW9wcm9jZXNzb3IuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvcG9ydGFsL1BvcnRhbEl0ZW0uanMnO1xuaW1wb3J0IHsgYiBhcyBmZXRjaENvbXBvbmVudExvY2FsZVN0cmluZ3MgfSBmcm9tICcuL2xvY2FsaXphdGlvbi1oZWxwZXItNDgxOWI2N2QuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0VtcHR5RGF0YUl0ZW0sIGwgYXMgaXNJbWFnZXJ5TGF5ZXIsIGggYXMgaXNGZWF0dXJlTGF5ZXIsIG0gYXMgaXNJbWFnZXJ5VGlsZUxheWVyIH0gZnJvbSAnLi90eXBlLWdhdXJkcy0xODQwNzQ3Zi5qcyc7XG5pbXBvcnQgeyBiIGFzIGdldEFyZ1JGVCB9IGZyb20gJy4vcmZ4LWFyZ3MtaGVscGVyLWFiNDAxNTQzLmpzJztcbmltcG9ydCB7IGEgYXMgTW9kZSwgQSBhcyBBUkdVTUVOVF9XSURHRVRTLCBHIGFzIEdyaWRDb2x1bW4gfSBmcm9tICcuL2ludGVyZmFjZXMtZDBjNjg5NDQuanMnO1xuaW1wb3J0IHsgZCBhcyBnZXRSYXN0ZXJKc29uRnJvbUxheWVyLCBlIGFzIGdldExheWVySWRmcm9tUmFzdGVyVmFsdWUsIGYgYXMgZ2V0SW1hZ2VTZXJ2aWNlTGF5ZXJJdGVtLCBnIGFzIGdldExheWVyVXJsV2l0aG91dFRva2VuLCBhIGFzIGNyZWF0ZURlZmF1bHRSYXN0ZXJSRnhWYXJpYWJsZSwgYyBhcyBjbG9uZVJhc3RlckpTT04gfSBmcm9tICcuL2xheWVyLWhlbHBlci0zODY3ZWVmNy5qcyc7XG5pbXBvcnQgeyBhIGFzIGZpbHRlclVuaXF1ZU9iamVjdHMgfSBmcm9tICcuL2NvbW1vbi1mZGExNDYyZS5qcyc7XG5pbXBvcnQgJy4vX2dldFRhZy05NmFmMDI5ZC5qcyc7XG5pbXBvcnQgJy4vcmVzb3VyY2VzLTI3YzY2ZjVjLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbnMtZjFmMmRmZmQuanMnO1xuaW1wb3J0ICcuL19VaW50OEFycmF5LTY4ZTFlM2Y5LmpzJztcblxuY29uc3QgUkZ4Q29sb3JQaWNrZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnJmeENvbG9yUGlja2VyVmFsdWVDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJmeENvbG9yUGlja2VyVmFsdWVDaGFuZ2VcIiwgNyk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBjYWxsZWQgb24gY29sb3Igc3dhdGNoIGNsaWNrLlxuICAgICAgICAgKiBjcmVhdGVzIGEgcG9wb3ZlciBlbGVtZW50IHdpdGggY29sb3IgcGlja2VyXG4gICAgICAgICAqIEBwYXJhbSBlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9uQ29sb3JTd2F0Y2hDbGljayA9IChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb2xvciA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyRWxlbWVtdC5vcGVuID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gbmV3IGVzcmlDb2xvcihjb2xvcikudG9SZ2JhKCk7XG4gICAgICAgICAgICB0aGlzLnJmeENvbG9yUGlja2VyVmFsdWVDaGFuZ2UuZW1pdCh7IHZhbHVlOiB0aGlzLnZhbHVlIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnZhbHVlID0gWzAsIDAsIDAsIDI1NV07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFB1YmxpYyBtZXRob2RcbiAgICAgKiBAcmV0dXJucyBIVE1MUmZ4Q29sb3JQaWNrZXJFbGVtZW50XG4gICAgICovXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBjb2xvciA9IG5ldyBlc3JpQ29sb3IodGhpcy52YWx1ZSkudG9IZXgoKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlci1zd2F0Y2hcIiwgeyBhY3RpdmU6IGZhbHNlLCBjb2xvcjogY29sb3IsIGlkOiBcImNvbG9yLXBpY2tlci1zd2F0Y2hcIiwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUsXG4gICAgICAgICAgICAvLyBvbkNsaWNrPXt0aGlzLm9uQ29sb3JTd2F0Y2hDbGlja31cbiAgICAgICAgICAgIHJlZjogKGUpID0+IHtcbiAgICAgICAgICAgIH0gfSksIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyBhdXRvQ2xvc2U6IHRydWUsIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogXCJjb2xvci1waWNrZXItc3dhdGNoXCIsIHBsYWNlbWVudDogXCJhdXRvXCIsIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlLCBsYWJlbDogXCJjb2xvci1waWNrZXItcG9wb3ZlclwiLCByZWY6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyRWxlbWVtdCA9IGU7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlclwiLCB7IHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlLCB2YWx1ZTogY29sb3IsIGZvcm1hdDogXCJhdXRvXCIsIG9uQ2FsY2l0ZUNvbG9yUGlja2VySW5wdXQ6IHRoaXMub25Db2xvclN3YXRjaENsaWNrIH0pKSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCByZnhEdGVSYXN0ZXJJbnB1dENzcyA9IFwiOnJvb3R7LS1jYWxjaXRlLWNvbG9yLWJyYW5kOiMwMDdhYzI7LS1jYWxjaXRlLWNvbG9yLWJyYW5kLWhvdmVyOiMwMDYxOWI7LS1jYWxjaXRlLWNvbG9yLWJyYW5kLXByZXNzOiMwMDQ4NzQ7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1pbmZvOiMwMDYxOWI7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1zdWNjZXNzOiMzNWFjNDY7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy13YXJuaW5nOiNlZGQzMTc7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1kYW5nZXI6I2Q4MzAyMDstLWNhbGNpdGUtY29sb3Itc3RhdHVzLWRhbmdlci1ob3ZlcjojYTgyYjFlOy0tY2FsY2l0ZS1jb2xvci1zdGF0dXMtZGFuZ2VyLXByZXNzOiM3YzFkMTM7LS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQ6I2Y4ZjhmODstLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xOiNmZmZmZmY7LS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMjojZjNmM2YzOy0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTM6I2VhZWFlYTstLWNhbGNpdGUtY29sb3ItdGV4dC0xOiMxNTE1MTU7LS1jYWxjaXRlLWNvbG9yLXRleHQtMjojNGE0YTRhOy0tY2FsY2l0ZS1jb2xvci10ZXh0LTM6IzZhNmE2YTstLWNhbGNpdGUtY29sb3ItdGV4dC1pbnZlcnNlOiNmZmZmZmY7LS1jYWxjaXRlLWNvbG9yLXRleHQtbGluazojMDA2MTliOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMTojY2FjYWNhOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMjojZDRkNGQ0Oy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMzojZGZkZmRmOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItaW5wdXQ6Izk0OTQ5NDstLXJmeC1xdWFydGVyLXNwYWNpbmc6MC4yNXJlbTstLXJmeC1oYWxmLXNwYWNpbmc6MC41cmVtOy0tcmZ4LXRocmVlLXF1YXJ0ZXItc3BhY2luZzowLjc1cmVtOy0tcmZ4LWZ1bGwtc3BhY2luZzoxcmVtOy0tcmZ4LWNvbXBvbmVudC1kZWZhdWx0LXdpZHRoOjEwMCU7LS1yZngtdWktYm9yZGVyLWlucHV0OnZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTIpOy0tcmZ4LXBvcG92ZXItY29udGVudC1taW4taGVpZ2h0OjMwdmg7LS1yZngtcG9wb3Zlci1jb250ZW50LW1heC1oZWlnaHQ6NjB2aDstLXJmeC1wb3BvdmVyLWNvbnRlbnQtaGVpZ2h0OjQ1dmg7LS1yZngtd2lkZ2V0LWNvbnRlbnQtaGVpZ2h0OjMwdmh9LmJyb3dzZS1sYXllcnstLWNhbGNpdGUtdWktdGV4dC0xOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC1saW5rKTstLWNhbGNpdGUtdWktdGV4dC0zOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC1saW5rKX1cIjtcblxuY29uc3QgUkZ4UmFzdGVySW5wdXQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnJmeEFyZ3VtZW50Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJyZnhBcmd1bWVudENoYW5nZVwiLCA3KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHNhdmUgdGhlIHByb2Nlc3NlZCBzY2FsYXIgdmFsdWVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2NhbGFyVmFsdWVzID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0aGUgd2lkZ2V0IGlzIGxvYWRlZC5cbiAgICAgICAgICogZmxhZyBpcyBzZXQgdG8gdHJ1ZSBvbmNlIHByb2Nlc3NWYWx1ZUxheWVyIGlzIGNvbXBsZXRlZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnB1dExheWVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbGxvd1NjYWxhciA9IGZhbHNlO1xuICAgICAgICB0aGlzLm92ZXJsYXlQb3NpdGlvbmluZyA9IENhbGNpdGVPdmVybGF5UG9zaXRpb25pbmcuYWJzb2x1dGU7XG4gICAgICAgIHRoaXMucmZ4VmFyaWFibGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubW9kZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZnhCcm93c2VMYXllckNsaWNrID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBvblJGeFZhcmlhYmxlQ2hhbmdlKHZhcmlhYmxlRGF0YSkge1xuICAgICAgICBpZiAodmFyaWFibGVEYXRhLnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFyaWFibGVEYXRhLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXJnUkZUID0gZ2V0QXJnUkZUKHZhcmlhYmxlRGF0YSk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgLy8gbG9hZCBmdW5jdGlvbiBpcyBtb3ZlZCB0byBjb25uZWN0ZWRDYWxsYmFjayBhcyB0aGUgZnVuY3Rpb24gb25seSBkZWFscyB3aXRoIHByb2Nlc3NpbmcgcHJvcHM7XG4gICAgICAgIC8vIFByb3BzIHNob3VsZCBiZSBwcm9jZXNzZWQgaW4gY29ubmVjdGVkQ2FsbGJhY2ssIHRvIGxvYWQgZGF0YSBhc3luY2hyb25vdXNseSBhbmQgdG8gc2V0dXAgdGhlIHN0YXRlIGNvbXBvbmVudFdpbGxMb2FkXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZCgpO1xuICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgICh7IHN0cmluZ3M6IHRoaXMuc3RyaW5ncyB9ID0gYXdhaXQgZmV0Y2hDb21wb25lbnRMb2NhbGVTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQsIGdldEFzc2V0UGF0aChgLmApKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBjYXRlZ2VvcnkgUHVibGljXG4gICAgICogQHJldHVybnMgUHJvbWlzZTxTdXBwb3J0ZWRJbWFnZXJ5TGF5ZXJUeXBlcz5cbiAgICAgKiByZXR1cm5zIHRoZSBzZWxlY3RlZCBsYXllciBvYmplY3RcbiAgICAgKi9cbiAgICBhc3luYyBnZXRTZWxlY3RlZExheWVyKCkge1xuICAgICAgICAvLyBnZXRTZWxlY3RlZExheWVyIGV4cG9zZWQgbWV0aG9kIHdvdWxkIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGNvbm5lY3RlZCBjYWxsYmFjayBpcyBjb21wbGV0ZWRcbiAgICAgICAgLy8gaGVuY2UgYSBmbGFnIGlzIHVzZWQgdG8gbWFrZSBzdXJlIHdpZGdldCBpcyBpbml0aWFsaXplZCBwcm9wZXJseS5cbiAgICAgICAgaWYgKHRoaXMubG9hZGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2FkKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhbHVlID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0U2VsZWN0ZWRMYXllcih0aGlzLnZhbHVlLnVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB1c2VkIHRvIHByb2Nlc3MgdGhlIGJyb3dzZWQgbGF5ZXJcbiAgICAgKiBAcGFyYW0gbGF5ZXJzXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVCcm93c2VkTGF5ZXIobGF5ZXJzKSB7XG4gICAgICAgIGxheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICAgICAgLy9wdXNoIHRvIGlucHV0cHV0IGxheWVycyBpZiBpdCBkb2VzIG5vdCBleGlzdFxuICAgICAgICAgICAgY29uc3QgYnJvd3NlZExheWVyID0gdGhpcy5pbnB1dExheWVycy5maWx0ZXIoKGlucHV0TGF5ZXIpID0+IGxheWVyLnVybCA9PT0gaW5wdXRMYXllci51cmwpO1xuICAgICAgICAgICAgaWYgKGJyb3dzZWRMYXllci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0TGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGdldFJhc3Rlckpzb25Gcm9tTGF5ZXIobGF5ZXIpO1xuICAgICAgICAgICAgdGhpcy5yZnhBcmd1bWVudENoYW5nZS5lbWl0KHsgdmFsdWU6IHRoaXMudmFsdWUgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBsb2FkKCkge1xuICAgICAgICBpZiAoIWlzRW1wdHlEYXRhSXRlbSh0aGlzLnJmeFZhcmlhYmxlKSkge1xuICAgICAgICAgICAgdGhpcy5vblJGeFZhcmlhYmxlQ2hhbmdlKHRoaXMucmZ4VmFyaWFibGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNFbXB0eURhdGFJdGVtKHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NWYWx1ZUxheWVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgcHJvY2Vzc1ZhbHVlTGF5ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnZhbHVlLnR5cGU/LnRvTG93ZXJDYXNlKCkgPT09IFwic2NhbGFyXCIpIHtcbiAgICAgICAgICAgIC8vaWYgaXRzIHNjYWxhciBhZGQgdG8gc2NhbGFyIHZhbHVlc1xuICAgICAgICAgICAgdGhpcy5zY2FsYXJWYWx1ZXMucHVzaCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZUxheWVyVXJsID0gdGhpcy52YWx1ZT8udXJsO1xuICAgICAgICBpZiAoaXNFbXB0eURhdGFJdGVtKHZhbHVlTGF5ZXJVcmwpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRMYXllcklkID0gZ2V0TGF5ZXJJZGZyb21SYXN0ZXJWYWx1ZSh0aGlzLnZhbHVlLCB0aGlzLmlucHV0TGF5ZXJzKTtcbiAgICAgICAgaWYgKGlzRW1wdHlEYXRhSXRlbShzZWxlY3RlZExheWVySWQpKSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgdmFsdWUgaXMgbm90IHByZXNlbnQgaW4gdGhlIGlucHV0IGxheWVycyB3ZSBuZWVkIHRvIGFkZCBpdFxuICAgICAgICAgICAgY29uc3QgYXJjR0lTSW1hZ2VTZXJ2aWNlTGF5ZXJPYmplY3QgPSBhd2FpdCBnZXRJbWFnZVNlcnZpY2VMYXllckl0ZW0odGhpcy52YWx1ZSk7XG4gICAgICAgICAgICBpZiAoYXJjR0lTSW1hZ2VTZXJ2aWNlTGF5ZXJPYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRMYXllcnMgPSBbLi4udGhpcy5pbnB1dExheWVycywgYXJjR0lTSW1hZ2VTZXJ2aWNlTGF5ZXJPYmplY3RdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJlZ2VuZXJhdGUgdG9rZW4gZm9yIGxheWVyIHVybFxuICAgICAgICBjb25zdCBzZWxlY3RlZExheWVyID0gYXdhaXQgdGhpcy5fZ2V0U2VsZWN0ZWRMYXllcihnZXRMYXllclVybFdpdGhvdXRUb2tlbih2YWx1ZUxheWVyVXJsKSk7XG4gICAgICAgIGlmIChzZWxlY3RlZExheWVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBnZXRSYXN0ZXJKc29uRnJvbUxheWVyKHNlbGVjdGVkTGF5ZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZJWE1FIDogdGVtcCBzb2x1dGlvbiB0byBsYXllciBkdXBsaWNhdGlvbiwgaWRlYWxseSBleHBvc2UgXCJzdGFydHVwXCIgbWV0aG9kIChzaW1pbGFyIHRvIGRvam8pXG4gICAgICAgIC8vIGZvciBjb21wb25lbnRzIHRoYXQgZXhwb3NlIHB1YmxpYyBtZXRob2RzLCBhbmQgY2FsbCBzdGFydHVwIGltbWVkaWF0ZWx5IGFmdGVyIHdpZGdldCBjcmVhdGlvbi5cbiAgICAgICAgdGhpcy5pbnB1dExheWVycyA9IGZpbHRlclVuaXF1ZU9iamVjdHModGhpcy5pbnB1dExheWVycywgXCJ1cmxcIik7XG4gICAgfVxuICAgIGFzeW5jIF9oYW5kbGVDb21ib0JveENoYW5nZShlKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSXRlbSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICBpZiAoaXNFbXB0eURhdGFJdGVtKHNlbGVjdGVkSXRlbSkpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2VsZWN0ZWRJdGVtID09PSBcImJyb3dzZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5yZnhCcm93c2VMYXllckNsaWNrKHsgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5ob3N0RWxlbWVudCB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSBhd2FpdCB0aGlzLl9nZXRTZWxlY3RlZExheWVyKHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRMYXllciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGdldFJhc3Rlckpzb25Gcm9tTGF5ZXIoc2VsZWN0ZWRMYXllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmFsbG93U2NhbGFyID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlNjYWxhclwiLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJmeEFyZ3VtZW50Q2hhbmdlLmVtaXQoeyB2YWx1ZTogdGhpcy52YWx1ZSB9KTtcbiAgICB9XG4gICAgYXN5bmMgX2dldFNlbGVjdGVkTGF5ZXIodXJsKSB7XG4gICAgICAgIHVybCA9IGdldExheWVyVXJsV2l0aG91dFRva2VuKHVybCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXIgPSB0aGlzLmlucHV0TGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci51cmwgPT09IHVybCk7XG4gICAgICAgIGlmIChzZWxlY3RlZExheWVyKSB7XG4gICAgICAgICAgICBhd2FpdCBzZWxlY3RlZExheWVyLmxvYWQoKTtcbiAgICAgICAgICAgIGlmIChpc0ltYWdlcnlMYXllcihzZWxlY3RlZExheWVyKSkge1xuICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBuZWNlc3NhcnkgaW5mbyBhbmQgYWRkIHRvIHRoZSBJbWFnZXJ5TGF5ZXJBcmcgZm9yIG90aGVyIHdpZGdldHMgdG8gdXNlXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIEltYWdlcnlMYXllci5yYXN0ZXJGdW5jdGlvbiBpbnN0ZWFkIG9mIHJlbmRlcmluZ1J1bGUgYXMgaXQgaXMgZGVwcmVjYXRlZCBzaW5jZSA0LjI3XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkTGF5ZXIucmFzdGVySW5mbyA9IGF3YWl0IHNlbGVjdGVkTGF5ZXIuZ2VuZXJhdGVSYXN0ZXJJbmZvKHNlbGVjdGVkTGF5ZXIucmFzdGVyRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RlZExheWVyO1xuICAgIH1cbiAgICBnZXRGb3JtYXR0ZWRWYWx1ZUZyb21WYXJpYWJsZSgpIHtcbiAgICAgICAgaWYgKCFpc0VtcHR5RGF0YUl0ZW0odGhpcy5hcmdSRlQpKSB7XG4gICAgICAgICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSB0aGlzLmFyZ1JGVC5mdW5jdGlvbj8ubmFtZTtcbiAgICAgICAgICAgIHJldHVybiBgPCR7ZnVuY3Rpb25OYW1lfS4ke3RoaXMuc3RyaW5ncy5vdXRwdXRSYXN0ZXJ9PmA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gTW9kZS5BTkFMWVNJU1xuICAgICAgICAgICAgPyB0aGlzLmdldERlZmF1bHRQbGFjZUhvbGRlcigpXG4gICAgICAgICAgICA6IGA8JHt0aGlzLnN0cmluZ3MucmZ4VmFyaWFibGV9OiAke3RoaXMucmZ4VmFyaWFibGUubmFtZX0+YDtcbiAgICB9XG4gICAgZ2V0RGVmYXVsdFBsYWNlSG9sZGVyKCkge1xuICAgICAgICBpZiAodGhpcy5hbGxvd1NjYWxhcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5hbGxvd1NjYWxhcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ3Muc2VsZWN0TGF5ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0UGxhY2VIb2xkZXJUZXh0KCkge1xuICAgICAgICBpZiAoIWlzRW1wdHlEYXRhSXRlbSh0aGlzLnJmeFZhcmlhYmxlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Rm9ybWF0dGVkVmFsdWVGcm9tVmFyaWFibGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERlZmF1bHRQbGFjZUhvbGRlcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcklucHV0T3B0aW9ucyh2YWx1ZSkge1xuICAgICAgICBsZXQgb3B0aW9ucyA9IFtdO1xuICAgICAgICBpZiAodGhpcy5pbnB1dExheWVycyAmJiBBcnJheS5pc0FycmF5KHRoaXMuaW5wdXRMYXllcnMpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gdGhpcy5pbnB1dExheWVycy5tYXAoKGxheWVyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChsYXllcj8udXJsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1jb21ib2JveC1pdGVtXCIsIHsga2V5OiBgbGF5ZXItaXRlbS0ke2luZGV4fWAsIHZhbHVlOiBsYXllci51cmwsIHNlbGVjdGVkOiBsYXllci51cmwgPT09IHZhbHVlLCB0ZXh0TGFiZWw6IGxheWVyLnRpdGxlLCBpY29uOiBsYXllci50eXBlID09PSBcImltYWdlcnlcIiA/IFwiaW1hZ2UtbGF5ZXJcIiA6IFwidGlsZWQtaW1hZ2VyeS1sYXllclwiLCBzY2FsZTogVUlEZWZhdWx0cy5TY2FsZSB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2NhbGFyVmFsdWVzPy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBzY2FsYXIgc2hvdyBpdCBhcyBzZWxlY3RlZFxuICAgICAgICAgICAgdGhpcy5zY2FsYXJWYWx1ZXMuZm9yRWFjaCgoc2NhbGFyVmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGtleTogYGxheWVyLWl0ZW0tJHt0aGlzLmlucHV0TGF5ZXJzLmxlbmd0aCArIDF9YCwgdmFsdWU6IHNjYWxhclZhbHVlLnZhbHVlLCB0ZXh0TGFiZWw6IHNjYWxhclZhbHVlLnZhbHVlLCBzZWxlY3RlZDogdHJ1ZSwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgbGF5ZXJVcmwgPSBnZXRMYXllclVybFdpdGhvdXRUb2tlbih0aGlzLnZhbHVlPy51cmwpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGlzRW1wdHlEYXRhSXRlbSh0aGlzLnZhbHVlKVxuICAgICAgICAgICAgPyB0aGlzLnZhbHVlXG4gICAgICAgICAgICA6IHRoaXMudmFsdWU/LnR5cGUgPT09IFwiU2NhbGFyXCJcbiAgICAgICAgICAgICAgICA/IHRoaXMudmFsdWUudmFsdWVcbiAgICAgICAgICAgICAgICA6IGxheWVyVXJsO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJlc3JpUkZ4UmFzdGVySW5wdXRcIiB9LCBoKFwiY2FsY2l0ZS1jb21ib2JveFwiLCB7IGxhYmVsOiBcInJmeC1kdGUtcmFzdGVyLWlucHV0LWNvbWJvYm94XCIsIHBsYWNlaG9sZGVyOiB0aGlzLmdldFBsYWNlSG9sZGVyVGV4dCgpLCBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBzY2FsZTogVUlEZWZhdWx0cy5TY2FsZSwgbWF4SXRlbXM6IDAsIGRpc2FibGVkOiB0aGlzLmFyZ1JGVCAhPT0gdW5kZWZpbmVkLCBhbGxvd0N1c3RvbVZhbHVlczogdGhpcy5hbGxvd1NjYWxhciwgdmFsdWU6IHZhbHVlLCBvbkNhbGNpdGVDb21ib2JveENoYW5nZTogKGUpID0+IHRoaXMuX2hhbmRsZUNvbWJvQm94Q2hhbmdlKGUpLCBvdmVybGF5UG9zaXRpb25pbmc6IHRoaXMub3ZlcmxheVBvc2l0aW9uaW5nLCBjbGVhckRpc2FibGVkOiB0cnVlIH0sIGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWNvbWJvYm94LWl0ZW1cIiwgeyBjbGFzczogXCJicm93c2UtbGF5ZXJcIiwga2V5OiBcImxheWVyLWl0ZW0tYnJvd3NlXCIsIHZhbHVlOiBcImJyb3dzZVwiLCB0ZXh0TGFiZWw6IHRoaXMuc3RyaW5ncy5icm93c2VMYXllciwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUsIGljb246IFwic2VhcmNoXCIsIGZpbHRlckRpc2FibGVkOiB0cnVlIH0pLCAuLi50aGlzLnJlbmRlcklucHV0T3B0aW9ucyh2YWx1ZSkpKSkpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJ0OW5cIl07IH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJyZnhWYXJpYWJsZVwiOiBbXCJvblJGeFZhcmlhYmxlQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcblJGeFJhc3RlcklucHV0LnN0eWxlID0gcmZ4RHRlUmFzdGVySW5wdXRDc3M7XG5cbmNvbnN0IFJGeENvbW1vblNlbGVjdCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMucmZ4QXJndW1lbnRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJmeEFyZ3VtZW50Q2hhbmdlXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIE1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmhhbmRsZUNvbWJvQm94Q2hhbmdlID0gKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICBpZiAoIWlzRW1wdHlEYXRhSXRlbSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5yZnhBcmd1bWVudENoYW5nZS5lbWl0KHsgdmFsdWU6IHRoaXMudmFsdWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnZhbHVlID0gXCJcIjtcbiAgICAgICAgdGhpcy5hbGxvd0N1c3RvbVZhbHVlcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsYWNlSG9sZGVyVGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0luR3JpZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzTnVsbGFibGUgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudERpZFJlbmRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNOdWxsYWJsZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gd29ya2Fyb3VuZCBzdWdnZXN0ZWQgYnkgY2FsY2l0ZSB0ZWFtIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtY29tcG9uZW50cy9pc3N1ZXMvNDczOCNpc3N1ZWNvbW1lbnQtMTU2NDc5OTA3NlxuICAgICAgICAgICAgY29uc3QgY29tYm9ib3ggPSB0aGlzLmhvc3RFbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtY29tYm9ib3hcIik7XG4gICAgICAgICAgICBjb21ib2JveC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQudGFnTmFtZSA9PT0gXCJDQUxDSVRFLUNPTUJPQk9YLUlURU1cIiAmJiBjb21ib2JveC52YWx1ZSA9PT0gdGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHsgY2FwdHVyZTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGxldCBzZWxlY3RPcHRpb25zID0gW107XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgQXJyYXkuaXNBcnJheSh0aGlzLm9wdGlvbnMpKSB7XG4gICAgICAgICAgICBzZWxlY3RPcHRpb25zID0gdGhpcy5vcHRpb25zLm1hcCgob3B0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGtleTogYGNvbW1vbi1zZWxlY3QtaXRlbS0ke2luZGV4fS0ke29wdGlvbi5rZXl9YCwgdmFsdWU6IG9wdGlvbi5rZXksIHRleHRMYWJlbDogb3B0aW9uLmxhYmVsLCBzZWxlY3RlZDogb3B0aW9uLmtleSA9PT0gdGhpcy52YWx1ZSwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJjYWxjaXRlLWNvbWJvYm94XCIsIHsgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUsIG1heEl0ZW1zOiAwLCBsYWJlbDogXCJyZngtZHRleC1jb21tb24tc2VsZWN0LWNvbWJvYm94XCIsIHBsYWNlaG9sZGVyOiB0aGlzLnBsYWNlSG9sZGVyVGV4dCwgYWxsb3dDdXN0b21WYWx1ZXM6IHRoaXMuYWxsb3dDdXN0b21WYWx1ZXMsIGNsZWFyRGlzYWJsZWQ6ICF0aGlzLmlzTnVsbGFibGUsIG92ZXJsYXlQb3NpdGlvbmluZzogdGhpcy5pc0luR3JpZCA/IFwiZml4ZWRcIiA6IFwiYWJzb2x1dGVcIiwgb25DYWxjaXRlQ29tYm9ib3hDaGFuZ2U6IChlKSA9PiB0aGlzLmhhbmRsZUNvbWJvQm94Q2hhbmdlKGUpIH0sIC4uLnNlbGVjdE9wdGlvbnMpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IFJGeEZpZWxkU2VsZWN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5yZnhBcmd1bWVudENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmZ4QXJndW1lbnRDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMucmZ4RmllbGRPcHRpb25zTG9hZGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJyZnhGaWVsZE9wdGlvbnNMb2FkZWRcIiwgNyk7XG4gICAgICAgIHRoaXMuaGFuZGxlRmllbGRTZWxlY3RDaGFuZ2UgPSAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGVsZW1lbnQudmFsdWU7XG4gICAgICAgICAgICB0aGlzLnJmeEFyZ3VtZW50Q2hhbmdlLmVtaXQoeyB2YWx1ZTogdGhpcy52YWx1ZSB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5sYXllckFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yYXN0ZXJJbnB1dFZhcmlhYmxlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm90aGVyT3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpZWxkVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pc0luR3JpZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlucHV0TGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dEZWZhdWx0RmllbGRzID0gdHJ1ZTtcbiAgICB9XG4gICAgb25yYXN0ZXJJbnB1dFZhcmlhYmxlQ2hhbmdlKCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NMYXllckFyZygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgICh7IHN0cmluZ3M6IHRoaXMuc3RyaW5ncyB9ID0gYXdhaXQgZmV0Y2hDb21wb25lbnRMb2NhbGVTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQsIGdldEFzc2V0UGF0aChgLmApKSk7XG4gICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0xheWVyQXJnKCk7XG4gICAgICAgIHRoaXMucHJvY2Vzc0RlZmF1bHRWYWx1ZSgpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBoKFwicmZ4LWR0ZXgtY29tbW9uLXNlbGVjdFwiLCB7IGlzSW5HcmlkOiB0aGlzLmlzSW5HcmlkLCBvcHRpb25zOiB0aGlzLm9wdGlvbnMsIHZhbHVlOiB0aGlzLnZhbHVlLCBwbGFjZUhvbGRlclRleHQ6IHRoaXMuc3RyaW5ncy5zZWxlY3RGaWVsZCwgb25SZnhBcmd1bWVudENoYW5nZTogdGhpcy5oYW5kbGVGaWVsZFNlbGVjdENoYW5nZSB9KSkpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgZ2V0U2VsZWN0ZWRSYXN0ZXJMYXllcih1cmwpIHtcbiAgICAgICAgdXJsID0gZ2V0TGF5ZXJVcmxXaXRob3V0VG9rZW4odXJsKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRMYXllciA9IHRoaXMuaW5wdXRMYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLnVybCA9PT0gdXJsKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkTGF5ZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IHNlbGVjdGVkTGF5ZXIubG9hZCgpO1xuICAgICAgICAgICAgaWYgKGlzSW1hZ2VyeUxheWVyKHNlbGVjdGVkTGF5ZXIpKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIEltYWdlcnlMYXllci5yYXN0ZXJGdW5jdGlvbiBpbnN0ZWFkIG9mIHJlbmRlcmluZ1J1bGUgYXMgaXQgaXMgZGVwcmVjYXRlZCBzaW5jZSA0LjI3XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkTGF5ZXIucmFzdGVySW5mbyA9IGF3YWl0IHNlbGVjdGVkTGF5ZXIuZ2VuZXJhdGVSYXN0ZXJJbmZvKHNlbGVjdGVkTGF5ZXIucmFzdGVyRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxlY3RlZExheWVyO1xuICAgIH1cbiAgICBhc3luYyBwcm9jZXNzTGF5ZXJBcmcoKSB7XG4gICAgICAgIGlmICghaXNFbXB0eURhdGFJdGVtKHRoaXMucmFzdGVySW5wdXRWYXJpYWJsZSkpIHtcbiAgICAgICAgICAgIC8vIGZvciBjYXNlIHdoZXJlIGZpZWxkLXNlbGVjdCBpcyBpbiByZngtZ3JpZCByb3dcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRmllbGRzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWlzRW1wdHlEYXRhSXRlbSh0aGlzLmxheWVyQXJnKSkge1xuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmxheWVyQXJnLmlucHV0O1xuICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVGaWVsZHMoKTtcbiAgICAgICAgICAgICAgICAvLyBsaXN0ZW4gdG8gbGF5ZXIgaW5wdXQgY2hhbmdlIGFuZCB1cGRhdGUgZmllbGRzIHVwb24gY2hhbmdlIGV2ZW50XG4gICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcInJmeEFyZ3VtZW50Q2hhbmdlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVGaWVsZHMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHNldCBkZWZhdWx0IGZpZWxkIG9wdGlvbnMgaWYgbm8gbGF5ZXIgaW5wdXRcbiAgICAgICAgICAgICAgICB0aGlzLnNldERlZmF1bHRGaWVsZE9wdGlvbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHNldCBkZWZhdWx0IGZpZWxkIG9wdGlvbnMgaWYgbm8gc2VsZWN0ZWQgbGF5ZXIgb2JqIGFuZCBubyBpbnB1dCBsYXllciBhcmdcbiAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdEZpZWxkT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmZ4RmllbGRPcHRpb25zTG9hZGVkLmVtaXQoKTtcbiAgICB9XG4gICAgYXN5bmMgdXBkYXRlRmllbGRzKCkge1xuICAgICAgICBsZXQgbGF5ZXI7XG4gICAgICAgIGlmICghaXNFbXB0eURhdGFJdGVtKHRoaXMucmFzdGVySW5wdXRWYXJpYWJsZT8udmFsdWUpKSB7XG4gICAgICAgICAgICBsYXllciA9IGF3YWl0IHRoaXMuZ2V0U2VsZWN0ZWRSYXN0ZXJMYXllcih0aGlzLnJhc3RlcklucHV0VmFyaWFibGU/LnZhbHVlPy51cmwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFpc0VtcHR5RGF0YUl0ZW0odGhpcy5sYXllckFyZykpIHtcbiAgICAgICAgICAgIGNvbnN0IGxheWVySW5wdXQgPSB0aGlzLmxheWVyQXJnLmlucHV0O1xuICAgICAgICAgICAgbGF5ZXIgPVxuICAgICAgICAgICAgICAgIHR5cGVvZiBsYXllcklucHV0LmdldFNlbGVjdGVkTGF5ZXIgPT09IFwiZnVuY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICA/IGF3YWl0IGxheWVySW5wdXQuZ2V0U2VsZWN0ZWRMYXllcigpXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGF5ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdEZpZWxkT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzRmVhdHVyZUxheWVyKGxheWVyKSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5jb252ZXJ0RmllbGRzVG9PcHRpb25zKGxheWVyLmZpZWxkcyk7XG4gICAgICAgICAgICBpZiAodGhpcy5vdGhlck9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZE90aGVyT3B0aW9ucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzSW1hZ2VyeUxheWVyKGxheWVyKSB8fCBpc0ltYWdlcnlUaWxlTGF5ZXIobGF5ZXIpKSB7XG4gICAgICAgICAgICBpZiAobGF5ZXIuc291cmNlSlNPTj8uaGFzUmFzdGVyQXR0cmlidXRlVGFibGUpIHtcbiAgICAgICAgICAgICAgICAvLyBTaW5jZSA0LjE0XG4gICAgICAgICAgICAgICAgLy8gaGFzUmFzdGVyQXR0cmlidXRlVGFibGUgbW92ZWQgdW5kZXIgbGF5ZXIuc291cmNlSlNPTlxuICAgICAgICAgICAgICAgIGNvbnN0IHJhdCA9IGlzSW1hZ2VyeUxheWVyKGxheWVyKVxuICAgICAgICAgICAgICAgICAgICA/IGxheWVyLnNlcnZpY2VSYXN0ZXJJbmZvLmF0dHJpYnV0ZVRhYmxlXG4gICAgICAgICAgICAgICAgICAgIDogbGF5ZXIucmFzdGVySW5mby5hdHRyaWJ1dGVUYWJsZTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzRW1wdHlEYXRhSXRlbShyYXQ/LmZpZWxkcykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGZpZWxkIG9wdGlvbnMgYWNjb3JkaW5nIHRvIGZpZWxkcyBmcm9tIHJhc3RlciBhdHRyaWJ1dGUgdGFibGVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGaWVsZE9wdGlvbnMocmF0LmZpZWxkcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBmaWVsZHMgaWYgbm8gZmllbGRzIGRhdGEgb24gUkFUXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdEZpZWxkT3B0aW9ucygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHNldCBkZWZhdWx0IGZpZWxkcyBpZiByYXN0ZXIgbGF5ZXIgaGFzIG5vIFJBVFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdEZpZWxkT3B0aW9ucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvY2Vzc0RlZmF1bHRWYWx1ZSgpO1xuICAgIH1cbiAgICBhZGRPdGhlck9wdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IGV4dHJhT3B0aW9ucyA9IFtdLCBjdXJyZW50T3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3Qgb3RoZXJPcHRpb25zID0gdGhpcy5vdGhlck9wdGlvbnM7XG4gICAgICAgIE9iamVjdC5rZXlzKG90aGVyT3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb24gPSB7XG4gICAgICAgICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgICAgICAgbGFiZWw6IG90aGVyT3B0aW9uc1trZXldXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXh0cmFPcHRpb25zLnB1c2gob3B0aW9uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjdXJyZW50T3B0aW9ucyAmJiBjdXJyZW50T3B0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBleHRyYU9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoZXh0cmFPcHRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRPcHRpb25zLnNvbWUoZnVuY3Rpb24gKGN1cnJlbnRPcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRPcHRpb24ua2V5ID09PSBleHRyYU9wdGlvbi5rZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudE9wdGlvbnMucHVzaChleHRyYU9wdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBjdXJyZW50T3B0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGV4dHJhT3B0aW9ucztcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRGaWVsZE9wdGlvbnMoZmllbGRzKSB7XG4gICAgICAgIGNvbnN0IG51bUZpZWxkVHlwZXMgPSBbXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZUludGVnZXJcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVNpbmdsZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlRG91YmxlXCJcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgc3RyaW5nRmllbGRUeXBlcyA9IFtcImVzcmlGaWVsZFR5cGVTdHJpbmdcIl07XG4gICAgICAgIGNvbnN0IHZhbGlkRmllbGRUeXBlcyA9IG51bUZpZWxkVHlwZXMuY29uY2F0KHN0cmluZ0ZpZWxkVHlwZXMpO1xuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSB0aGlzLmZpZWxkVHlwZTtcbiAgICAgICAgaWYgKGZpZWxkcz8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gU2luY2UganMtYXBpIDQuMTIsIGZpZWxkcyBvbiBSQVQgbm8gbG9uZ2VyIGluIEpTT04gZm9ybWF0XG4gICAgICAgICAgICBmaWVsZHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZpZWxkcykpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRGaWVsZHMgPSBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IFwibGlzdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdGaWVsZFR5cGVzLmluZGV4T2YoZmllbGQudHlwZSkgPiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZEZpZWxkVHlwZXMuaW5kZXhPZihmaWVsZC50eXBlKSA+IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5jb252ZXJ0RmllbGRzVG9PcHRpb25zKGZpbHRlcmVkRmllbGRzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdEZpZWxkT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldERlZmF1bHRGaWVsZE9wdGlvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3dEZWZhdWx0RmllbGRzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyBpZiB3aWRnZXQgaXMgaW4gZ3JpZCwgb25seSBzaG93ICdWQUxVRScgYXMgZGVmYXVsdFxuICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHNob3cgXCJWQUxVRVwiIGFuZCBcIkNPVU5UXCIgYXMgZGVmYXVsdFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5pc0luR3JpZFxuICAgICAgICAgICAgICAgID8gW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFwiVkFMVUVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICA6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBcIlZBTFVFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5zdHJpbmdzLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogXCJDT1VOVFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuc3RyaW5ncy5jb3VudFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb252ZXJ0RmllbGRzVG9PcHRpb25zKGZpZWxkcykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gW107XG4gICAgICAgIGZpZWxkcy5tYXAoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICBvcHRpb25zLnB1c2goeyBrZXk6IGZpZWxkLm5hbWUsIGxhYmVsOiBmaWVsZC5hbGlhcyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH1cbiAgICBwcm9jZXNzRGVmYXVsdFZhbHVlKCkge1xuICAgICAgICBpZiAoaXNFbXB0eURhdGFJdGVtKHRoaXMub3B0aW9ucykgfHwgdGhpcy5vcHRpb25zPy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9PT0gbnVsbCB8fFxuICAgICAgICAgICAgIXRoaXMub3B0aW9ucy5zb21lKChvcHRpb24pID0+IG9wdGlvbi5rZXkgPT09IHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vcHRpb25zWzBdLmtleTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzRW1wdHlEYXRhSXRlbSh0aGlzLnJhc3RlcklucHV0VmFyaWFibGUpIHx8ICFpc0VtcHR5RGF0YUl0ZW0odGhpcy5sYXllckFyZykpIHtcbiAgICAgICAgICAgIHRoaXMucmZ4QXJndW1lbnRDaGFuZ2UuZW1pdCh7IHZhbHVlOiB0aGlzLnZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgYXNzZXRzRGlycygpIHsgcmV0dXJuIFtcInQ5blwiXTsgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInJhc3RlcklucHV0VmFyaWFibGVcIjogW1wib25yYXN0ZXJJbnB1dFZhcmlhYmxlQ2hhbmdlXCJdXG4gICAgfTsgfVxufTtcblxuY29uc3QgY29tcG9uZW50ID0gXCJyZngtZ3JpZFwiO1xuY29uc3QgSFRNTENsYXNzZXMgPSB7XG4gICAgZ3JpZENvbnRhaW5lcjogYCR7Y29tcG9uZW50fV9fZ3JpZC1jb250YWluZXJgLFxuICAgIGJvcmRlcjogXCJib3JkZXJcIixcbiAgICBzdGFja2VkOiBcInN0YWNrZWRcIlxufTtcblxuY29uc3QgcmZ4R3JpZENzcyA9IFwiOnJvb3R7LS1jYWxjaXRlLWNvbG9yLWJyYW5kOiMwMDdhYzI7LS1jYWxjaXRlLWNvbG9yLWJyYW5kLWhvdmVyOiMwMDYxOWI7LS1jYWxjaXRlLWNvbG9yLWJyYW5kLXByZXNzOiMwMDQ4NzQ7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1pbmZvOiMwMDYxOWI7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1zdWNjZXNzOiMzNWFjNDY7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy13YXJuaW5nOiNlZGQzMTc7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1kYW5nZXI6I2Q4MzAyMDstLWNhbGNpdGUtY29sb3Itc3RhdHVzLWRhbmdlci1ob3ZlcjojYTgyYjFlOy0tY2FsY2l0ZS1jb2xvci1zdGF0dXMtZGFuZ2VyLXByZXNzOiM3YzFkMTM7LS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQ6I2Y4ZjhmODstLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xOiNmZmZmZmY7LS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMjojZjNmM2YzOy0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTM6I2VhZWFlYTstLWNhbGNpdGUtY29sb3ItdGV4dC0xOiMxNTE1MTU7LS1jYWxjaXRlLWNvbG9yLXRleHQtMjojNGE0YTRhOy0tY2FsY2l0ZS1jb2xvci10ZXh0LTM6IzZhNmE2YTstLWNhbGNpdGUtY29sb3ItdGV4dC1pbnZlcnNlOiNmZmZmZmY7LS1jYWxjaXRlLWNvbG9yLXRleHQtbGluazojMDA2MTliOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMTojY2FjYWNhOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMjojZDRkNGQ0Oy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMzojZGZkZmRmOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItaW5wdXQ6Izk0OTQ5NDstLXJmeC1xdWFydGVyLXNwYWNpbmc6MC4yNXJlbTstLXJmeC1oYWxmLXNwYWNpbmc6MC41cmVtOy0tcmZ4LXRocmVlLXF1YXJ0ZXItc3BhY2luZzowLjc1cmVtOy0tcmZ4LWZ1bGwtc3BhY2luZzoxcmVtOy0tcmZ4LWNvbXBvbmVudC1kZWZhdWx0LXdpZHRoOjEwMCU7LS1yZngtdWktYm9yZGVyLWlucHV0OnZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTIpOy0tcmZ4LXBvcG92ZXItY29udGVudC1taW4taGVpZ2h0OjMwdmg7LS1yZngtcG9wb3Zlci1jb250ZW50LW1heC1oZWlnaHQ6NjB2aDstLXJmeC1wb3BvdmVyLWNvbnRlbnQtaGVpZ2h0OjQ1dmg7LS1yZngtd2lkZ2V0LWNvbnRlbnQtaGVpZ2h0OjMwdmh9LnJmeC1ncmlkX19ncmlkLWNvbnRhaW5lcnt3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZX0ucmZ4LWdyaWRfX2dyaWQtY29udGFpbmVyIGRpdntib3gtc2l6aW5nOmJvcmRlci1ib3h9LnJmeC1ncmlkX19ncmlkLWNvbnRhaW5lciBib2R5e3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7bWFyZ2luOjA7cGFkZGluZzowfS5yZngtZ3JpZF9fZ3JpZC1jb250YWluZXIgdGR7cGFkZGluZzowLjVlbTt0ZXh0LWFsaWduOmNlbnRlcn0ucmZ4LWdyaWRfX2dyaWQtY29udGFpbmVyIHRoe2JhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTIpO3BhZGRpbmc6MC41ZW07Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC13ZWlnaHQ6bm9ybWFsfS5yZngtZ3JpZF9fZ3JpZC1jb250YWluZXIuYm9yZGVyIHRke2JvcmRlcjoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS5yZngtZ3JpZF9fZ3JpZC1jb250YWluZXIuc3RhY2tlZCB0ZCwucmZ4LWdyaWRfX2dyaWQtY29udGFpbmVyLnN0YWNrZWQgdGh7dGV4dC1hbGlnbjppbmhlcml0O2Rpc3BsYXk6YmxvY2s7d2lkdGg6YXV0b31cIjtcblxuY29uc3QgUkZ4R3JpZCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMucmZ4R3JpZE9wdGlvbkNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmZ4R3JpZE9wdGlvbkNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5yZnhHcmlkUm93Q2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJmeEdyaWRSb3dDbGlja1wiLCA3KTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNhbGxlZCB3aGVuIGNoYW5nZSBoYXBwZW5zIGluIHRoZSBlZGl0YWJsZSBjb2x1bSBpbnNpZGUgZ3JpZFxuICAgICAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JpZFZhbHVlQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50VHlwZSA9IGV2ZW50LnR5cGU7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgbGV0IHZhbHVlLCB1cGRhdGVkVmFsdWU7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50VHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjYWxjaXRlQ2hlY2tib3hDaGFuZ2VcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2FsY2l0ZVN3aXRjaENoYW5nZVwiOlxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGVsZW1lbnQuY2hlY2tlZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBlbGVtZW50LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50Py50YWdOYW1lID09PSBBUkdVTUVOVF9XSURHRVRTLlJGWF9EVEVfUkFTVEVSX0lOUFVUICYmXG4gICAgICAgICAgICAgICAgdmFsdWU/Lmhhc093blByb3BlcnR5KFwidXJsXCIpKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgdmFsdWUgaXMgaW4gdGhlIGZvcm1hdCBvZiBSYXN0ZXJKU09OLCBjb252ZXJ0IGl0IHRvIFJGeFZhcmlhYmxlXG4gICAgICAgICAgICAgICAgY29uc3QgcmFzdGVyUkZ4VmFyaWFibGUgPSBjcmVhdGVEZWZhdWx0UmFzdGVyUkZ4VmFyaWFibGUoKTtcbiAgICAgICAgICAgICAgICByYXN0ZXJSRnhWYXJpYWJsZS52YWx1ZSA9IGNsb25lUmFzdGVySlNPTih2YWx1ZSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlZFZhbHVlID0gcmFzdGVyUkZ4VmFyaWFibGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBbY29sdW1uTmFtZSwgaWRdID0gZWxlbWVudC5pZC5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICBsZXQgcm93SW5kZXg7XG4gICAgICAgICAgICB0aGlzLmdyaWRPcHRpb25zID0gdGhpcy5ncmlkT3B0aW9ucy5tYXAoKGdyaWRPcHRpb24sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGdyaWRPcHRpb24uaWQgPT09IE51bWJlci5wYXJzZUludChpZCwgMTApKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmlkLmluZGV4T2YoY29sdW1uTmFtZSkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uTGF5b3V0ID0gdGhpcy5ncmlkTGF5b3V0W2NvbHVtbk5hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdWlUeXBlID0gY29sdW1uTGF5b3V0LnVpVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1aVR5cGUgPT09IEdyaWRDb2x1bW4uc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZE9wdGlvbltjb2x1bW5OYW1lXS52YWx1ZSA9IHVwZGF0ZWRWYWx1ZSA/PyB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRPcHRpb25bY29sdW1uTmFtZV0gPSB1cGRhdGVkVmFsdWUgPz8gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdyaWRPcHRpb247XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNhbkFkZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkUm93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJmeEdyaWRPcHRpb25DaGFuZ2UuZW1pdCh7IGdyaWRPcHRpb25zOiB0aGlzLmdyaWRPcHRpb25zLCByb3dJbmRleDogcm93SW5kZXggfSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBjYWxsZWQgd2hlbiByZW1vdmUgYnV0dG9uIGlzIGNsaWNrZWRcbiAgICAgICAgICogQHBhcmFtIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9uUmVtb3ZlQ2xpY2sgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LnRhcmdldC5pZC5zcGxpdChcIi1cIilbMV07XG4gICAgICAgICAgICBjb25zdCByb3dJbmRleCA9IHRoaXMuZ3JpZE9wdGlvbnMuZmluZEluZGV4KChncmlkT3B0aW9uKSA9PiBncmlkT3B0aW9uLmlkID09PSBOdW1iZXIucGFyc2VJbnQoa2V5LCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5ncmlkT3B0aW9ucyA9IHRoaXMuZ3JpZE9wdGlvbnMuZmlsdGVyKChncmlkT3B0aW9uKSA9PiBncmlkT3B0aW9uLmlkICE9PSBOdW1iZXIucGFyc2VJbnQoa2V5LCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5yZnhHcmlkT3B0aW9uQ2hhbmdlLmVtaXQoeyBncmlkT3B0aW9uczogdGhpcy5ncmlkT3B0aW9ucywgcm93SW5kZXg6IHJvd0luZGV4IH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZE9wdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkT3B0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuZ3JpZE9wdGlvbnMubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogY2FsbGVkIHdoZW4gYSBncmlkIHJvdyBpcyBjbGlja2VkXG4gICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkdyaWRSb3dDbGljayA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBldmVudC5jdXJyZW50VGFyZ2V0LmlkLnNwbGl0KFwiX1wiKVsyXTtcbiAgICAgICAgICAgIGNvbnN0IHJvd0luZGV4ID0gdGhpcy5ncmlkT3B0aW9ucy5maW5kSW5kZXgoKGdyaWRPcHRpb24pID0+IGdyaWRPcHRpb24uaWQgPT09IE51bWJlci5wYXJzZUludChrZXksIDEwKSk7XG4gICAgICAgICAgICB0aGlzLnJmeEdyaWRSb3dDbGljay5lbWl0KHsgZ3JpZE9wdGlvbnM6IHRoaXMuZ3JpZE9wdGlvbnMsIHJvd0luZGV4OiByb3dJbmRleCB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLmlucHV0TGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNhbkFkZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2FuUmVtb3ZlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5oYXNIZWFkZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzU3RhY2tlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdyaWRMYXlvdXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGFzSWRDb2x1bW4gPSB0cnVlO1xuICAgICAgICB0aGlzLmhhc0JvcmRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJmeEJyb3dzZUxheWVyQ2xpY2sgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgKHsgc3RyaW5nczogdGhpcy5zdHJpbmdzIH0gPSBhd2FpdCBmZXRjaENvbXBvbmVudExvY2FsZVN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCwgZ2V0QXNzZXRQYXRoKGAuYCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gY29ycmVjdCB0aGUgaWRzIGluIHRoZSBvcHRpb25zLCBiZWZvcmUgYWRkaW5nIGEgbmV3IG9uZS5cbiAgICAgKiAgV2UgbmVlZCB0aGUgYmVjdXNlIGluIGJldHdlZW4gaWRzIGNhbiBiZSByZW1vdmVkIGFuZCBhZGRpbmcgb25lIGlkIGVxdWFsIHRvIGFycmF5IGxlbmd0aCBkb2VzbnQgd29ya1xuICAgICAqL1xuICAgIGFkanVzdFZhbHVlTGlzdEl0ZW1JZHMoKSB7XG4gICAgICAgIHRoaXMuZ3JpZE9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpZHgpID0+IHtcbiAgICAgICAgICAgIG9wdGlvbi5pZCA9IGlkeDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvIGNoZWNrIGFsbCB0aGUgY29sdW1ucyBpbiBhIHJvdyBpcyBlbXB0eVxuICAgICAqIEBwYXJhbSBsYXN0T3B0aW9uXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBpc0xhc3RSb3dFbXB0eShsYXN0T3B0aW9uKSB7XG4gICAgICAgIHJldHVybiAhT2JqZWN0LmtleXModGhpcy5ncmlkTGF5b3V0KS5zb21lKChrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkTGF5b3V0ID0gdGhpcy5ncmlkTGF5b3V0W2tleV07XG4gICAgICAgICAgICBjb25zdCBpc1NlbGVjdExheW91dCA9IGZpZWxkTGF5b3V0LnVpVHlwZSA9PT0gR3JpZENvbHVtbi5zZWxlY3Q7XG4gICAgICAgICAgICBjb25zdCBsYXN0T3B0aW9uVmFsdWUgPSBpc1NlbGVjdExheW91dCA/IGxhc3RPcHRpb25ba2V5XS52YWx1ZSA6IGxhc3RPcHRpb25ba2V5XTtcbiAgICAgICAgICAgIHJldHVybiAhaXNFbXB0eURhdGFJdGVtKGxhc3RPcHRpb25WYWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBjYWxsZWQgdG8gYWRkIGEgbmV3IHJvdyB0byB0aGUgZ3JpZC5cbiAgICAgKiBhZGRpbmcgYSByb3cgaXMgYXV0b21hdGVkIGFuZCB3aWxsIGFkZCB3aGVuIGxhc3Qgcm93IGNoYW5nZSBvY2N1cnNcbiAgICAgKi9cbiAgICBhZGRSb3coKSB7XG4gICAgICAgIGNvbnN0IGxhc3RPcHRpb24gPSB0aGlzLmdyaWRPcHRpb25zW3RoaXMuZ3JpZE9wdGlvbnMubGVuZ3RoIC0gMV07XG4gICAgICAgIGNvbnN0IHNob3VsZEFkZE5ld1JvdyA9ICF0aGlzLmlzTGFzdFJvd0VtcHR5KGxhc3RPcHRpb24pO1xuICAgICAgICBpZiAoIXNob3VsZEFkZE5ld1Jvdykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWRqdXN0VmFsdWVMaXN0SXRlbUlkcygpO1xuICAgICAgICBjb25zdCBuZXdHcmlkSXRlbSA9IHtcbiAgICAgICAgICAgIGlkOiB0aGlzLmdyaWRPcHRpb25zLmxlbmd0aFxuICAgICAgICB9O1xuICAgICAgICAvLyBJbiBjYXNlIHRoZSBsYXlvdXQgaGFzIGFueSBmaWVsZCBvZiB0eXBlIFwic2VsZWN0XCJcbiAgICAgICAgLy8gV2UgbmVlZCB0byBwcm92aWRlIG9wdGlvbnMgZm9yIHRoZSBuZXcgcm93XG4gICAgICAgIGZvciAoY29uc3QgZmllbGROYW1lIGluIHRoaXMuZ3JpZExheW91dCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZExheW91dC5oYXNPd25Qcm9wZXJ0eShmaWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRMYXlvdXQgPSB0aGlzLmdyaWRMYXlvdXRbZmllbGROYW1lXTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1NlbGVjdExheW91dCA9IGZpZWxkTGF5b3V0LnVpVHlwZSA9PT0gR3JpZENvbHVtbi5zZWxlY3Q7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB0aGlzLmdyaWRPcHRpb25zWzBdW2ZpZWxkTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0TGF5b3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0dyaWRJdGVtW2ZpZWxkTmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kZWZhdWx0T3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ncmlkT3B0aW9ucy5wdXNoKG5ld0dyaWRJdGVtKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmVuZGVyIGNvbHVtbnMgaW4gcm93IGJhc2VkIG9uIHRoZSBzY2hlbWEgdHlwZVxuICAgICAqIEBwYXJhbSBncmlkT3B0aW9uXG4gICAgICogQHBhcmFtIGluZGV4XG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICByZW5kZXJHcmlkUm93KGdyaWRPcHRpb24sIGluZGV4KSB7XG4gICAgICAgIGNvbnN0IGlkID0gTnVtYmVyLnBhcnNlSW50KGluZGV4LCAxMCkgKyAxO1xuICAgICAgICBjb25zdCByb3dFbGVtZW50cyA9IE9iamVjdC5rZXlzKHRoaXMuZ3JpZExheW91dCkubWFwKChjb2x1bW5OYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW5MYXlvdXQgPSB0aGlzLmdyaWRMYXlvdXRbY29sdW1uTmFtZV07XG4gICAgICAgICAgICBjb25zdCB1aVR5cGUgPSBjb2x1bW5MYXlvdXQudWlUeXBlO1xuICAgICAgICAgICAgc3dpdGNoICh1aVR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW4udGV4dElucHV0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGgoXCJ0ZFwiLCBudWxsLCBoKFwiY2FsY2l0ZS1pbnB1dC10ZXh0XCIsIHsgY2xhc3M6IGNvbHVtbkxheW91dC5zdHlsZSwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUsIGtleTogYCR7Y29sdW1uTmFtZX0tJHtncmlkT3B0aW9uLmlkfWAsIGlkOiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgdmFsdWU6IGdyaWRPcHRpb25bY29sdW1uTmFtZV0sIG9uQ2FsY2l0ZUlucHV0VGV4dENoYW5nZTogdGhpcy5ncmlkVmFsdWVDaGFuZ2UsIHRpdGxlOiBncmlkT3B0aW9uW2NvbHVtbk5hbWVdIH0pKSk7XG4gICAgICAgICAgICAgICAgY2FzZSBHcmlkQ29sdW1uLnRleHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaChcInRkXCIsIHsga2V5OiBgJHtjb2x1bW5OYW1lfV8ke2dyaWRPcHRpb24uaWR9YCB9LCBjb2x1bW5MYXlvdXQuY29uc3RWYWx1ZSB8fCBncmlkT3B0aW9uW2NvbHVtbk5hbWVdKSk7XG4gICAgICAgICAgICAgICAgY2FzZSBHcmlkQ29sdW1uLnJhc3RlcjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwidGRcIiwgbnVsbCwgaChcInJmeC1kdGUtcmFzdGVyLWlucHV0XCIsIHsgY2xhc3M6IGNvbHVtbkxheW91dC5zdHlsZSwga2V5OiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgaWQ6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCBpbnB1dExheWVyczogdGhpcy5pbnB1dExheWVycywgYWxsb3dTY2FsYXI6IGNvbHVtbkxheW91dC5hbGxvd1NjYWxhciwgcmZ4VmFyaWFibGU6IGdyaWRPcHRpb24ucmFzdGVyRWxlbWVudCwgdmFsdWU6IGdyaWRPcHRpb25bY29sdW1uTmFtZV0/LnZhbHVlLCBvdmVybGF5UG9zaXRpb25pbmc6IENhbGNpdGVPdmVybGF5UG9zaXRpb25pbmcuZml4ZWQsIG9uUmZ4QXJndW1lbnRDaGFuZ2U6IHRoaXMuZ3JpZFZhbHVlQ2hhbmdlLCByZnhCcm93c2VMYXllckNsaWNrOiB0aGlzLnJmeEJyb3dzZUxheWVyQ2xpY2sgfSkpKTtcbiAgICAgICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW4ubnVtYmVyOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGgoXCJ0ZFwiLCBudWxsLCBoKFwiY2FsY2l0ZS1pbnB1dC1udW1iZXJcIiwgeyBrZXk6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCBpZDogYCR7Y29sdW1uTmFtZX0tJHtncmlkT3B0aW9uLmlkfWAsIHZhbHVlOiBncmlkT3B0aW9uW2NvbHVtbk5hbWVdLCBvbkNhbGNpdGVJbnB1dE51bWJlckNoYW5nZTogdGhpcy5ncmlkVmFsdWVDaGFuZ2UsIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlLCBudW1iZXJCdXR0b25UeXBlOiBcIm5vbmVcIiwgdGl0bGU6IGdyaWRPcHRpb25bY29sdW1uTmFtZV0gfSkpKTtcbiAgICAgICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW4uYm9vbGVhbjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwidGRcIiwgbnVsbCwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBrZXk6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCBpZDogYCR7Y29sdW1uTmFtZX0tJHtncmlkT3B0aW9uLmlkfWAsIGNoZWNrZWQ6IGdyaWRPcHRpb25bY29sdW1uTmFtZV0sIG9uQ2FsY2l0ZUNoZWNrYm94Q2hhbmdlOiB0aGlzLmdyaWRWYWx1ZUNoYW5nZSB9KSkpO1xuICAgICAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbi5zd2l0Y2g6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaChcInRkXCIsIG51bGwsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGtleTogYCR7Y29sdW1uTmFtZX0tJHtncmlkT3B0aW9uLmlkfWAsIGlkOiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgY2hlY2tlZDogZ3JpZE9wdGlvbltjb2x1bW5OYW1lXSwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiB0aGlzLmdyaWRWYWx1ZUNoYW5nZSB9KSkpO1xuICAgICAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbi5maWVsZDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwidGRcIiwgbnVsbCwgaChcInJmeC1kdGV4LWZpZWxkLXNlbGVjdFwiLCB7IGNsYXNzOiBjb2x1bW5MYXlvdXQuc3R5bGUsIGtleTogYCR7Y29sdW1uTmFtZX0tJHtncmlkT3B0aW9uLmlkfWAsIGlkOiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgaW5wdXRMYXllcnM6IHRoaXMuaW5wdXRMYXllcnMsIGlzSW5HcmlkOiB0cnVlLCByYXN0ZXJJbnB1dFZhcmlhYmxlOiBncmlkT3B0aW9uLmxheWVyLCB2YWx1ZTogZ3JpZE9wdGlvbltjb2x1bW5OYW1lXSwgb25SZnhBcmd1bWVudENoYW5nZTogdGhpcy5ncmlkVmFsdWVDaGFuZ2UgfSkpKTtcbiAgICAgICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW4uY29sb3I6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaChcInRkXCIsIG51bGwsIGgoXCJyZngtY29sb3ItcGlja2VyXCIsIHsga2V5OiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgaWQ6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCB2YWx1ZTogZ3JpZE9wdGlvbltjb2x1bW5OYW1lXSwgb25SZnhDb2xvclBpY2tlclZhbHVlQ2hhbmdlOiB0aGlzLmdyaWRWYWx1ZUNoYW5nZSB9KSkpO1xuICAgICAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbi5zZWxlY3Q6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaChcInRkXCIsIG51bGwsIGgoXCJyZngtZHRleC1jb21tb24tc2VsZWN0XCIsIHsgY2xhc3M6IGNvbHVtbkxheW91dC5zdHlsZSwga2V5OiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgaWQ6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCBvcHRpb25zOiBncmlkT3B0aW9uW2NvbHVtbk5hbWVdLm9wdGlvbnMsIHZhbHVlOiBncmlkT3B0aW9uW2NvbHVtbk5hbWVdLnZhbHVlLCBhbGxvd0N1c3RvbVZhbHVlczogY29sdW1uTGF5b3V0LmFsbG93Q3VzdG9tVmFsdWVzLCBpc0luR3JpZDogdHJ1ZSwgb25SZnhBcmd1bWVudENoYW5nZTogdGhpcy5ncmlkVmFsdWVDaGFuZ2UgfSkpKTtcbiAgICAgICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW4uaWNvbjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChoKFwidGRcIiwgbnVsbCwgZ3JpZE9wdGlvbltjb2x1bW5OYW1lXSA/IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsga2V5OiBgJHtjb2x1bW5OYW1lfS0ke2dyaWRPcHRpb24uaWR9YCwgaWQ6IGAke2NvbHVtbk5hbWV9LSR7Z3JpZE9wdGlvbi5pZH1gLCBpY29uOiBjb2x1bW5MYXlvdXQuaWNvbiwgc2NhbGU6IENhbGNpdGVTY2FsZS5zLCB0ZXh0TGFiZWw6IGNvbHVtbkxheW91dC5sYWJlbCB9KSkgOiBudWxsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvL2lmIGhhc0lkIGNvbHVtbiBpcyB0cnVlIGNyZWF0ZXMgYSBudW1iZXIgY29sdW1uIGF0IHRoZSBiZWdpbmluZ1xuICAgICAgICBpZiAodGhpcy5oYXNJZENvbHVtbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcm93RWxlbWVudHMudW5zaGlmdChoKFwidGRcIiwgbnVsbCwgaChcImRpdlwiLCB7IGtleTogYGlkQ29sdW1uXyR7Z3JpZE9wdGlvbi5pZH1gIH0sIGlkKSkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIGNhblJlbW92ZSBpcyB0cnVlIGFkZHMgYSByZW1vdmUgYnV0dG9uIGF0IHRoZSBlbmQuIEFsc28gZm9yIHRoZSBsYXN0IHJvdywgdGhpcyBidXR0b24gYWN0aW9uIGlzIGRpc2FibGVkXG4gICAgICAgIGlmICh0aGlzLmNhblJlbW92ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcm93RWxlbWVudHMucHVzaChoKFwidGRcIiwgbnVsbCwgaChcImNhbGNpdGUtaWNvblwiLCB7IGlkOiBgcmVtb3ZlLSR7Z3JpZE9wdGlvbi5pZH1gLCBrZXk6IGByZW1vdmUtJHtncmlkT3B0aW9uLmlkfWAsIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlLCBpY29uOiBcInhcIiwgb25DbGljazogaWQgPT09IHRoaXMuZ3JpZE9wdGlvbnMubGVuZ3RoID8gdW5kZWZpbmVkIDogdGhpcy5vblJlbW92ZUNsaWNrIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJvd0VsZW1lbnRzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0byByZW5kZXIgdGhlIGhlYWRlclxuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgcmVuZGVySGVhZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoXCJ0aGVhZFwiLCBudWxsLCBoKFwidHJcIiwgbnVsbCwgdGhpcy5oYXNJZENvbHVtbiA9PT0gdHJ1ZSAmJiBoKFwidGhcIiwgbnVsbCwgdGhpcy5zdHJpbmdzLmlkKSwgT2JqZWN0LmtleXModGhpcy5ncmlkTGF5b3V0KS5tYXAoKGxheW91dCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29sdW1uTGF5b3V0ID0gdGhpcy5ncmlkTGF5b3V0W2xheW91dF07XG4gICAgICAgICAgICByZXR1cm4gaChcInRoXCIsIHsgY2xhc3M6IGAke2NvbHVtbkxheW91dC5zdHlsZX1gIH0sIGNvbHVtbkxheW91dC5sYWJlbCk7XG4gICAgICAgIH0pLCB0aGlzLmNhblJlbW92ZSA9PT0gdHJ1ZSAmJiBoKFwidGhcIiwgbnVsbCwgXCIgXCIpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0byByZW5kZXIgZWFjaCByb3cgaW4gdGhlIGdyaWRcbiAgICAgKiBAcmV0dXJucyBWbm9kZVtdXG4gICAgICovXG4gICAgcmVuZGVyR3JpZE9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRPcHRpb25zLm1hcCgoZ3JpZE9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoaChcInRyXCIsIHsgaWQ6IGBncmlkX3Jvd18ke2dyaWRPcHRpb24uaWR9YCwga2V5OiBgZ3JpZF9yb3dfJHtncmlkT3B0aW9uLmlkfWAsIG9uQ2xpY2s6IGluZGV4ID09PSB0aGlzLmdyaWRPcHRpb25zLmxlbmd0aCAtIDEgPyB1bmRlZmluZWQgOiB0aGlzLm9uR3JpZFJvd0NsaWNrIH0sIHRoaXMucmVuZGVyR3JpZFJvdyhncmlkT3B0aW9uLCBpbmRleCkpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJ0YWJsZVwiLCB7IGNsYXNzOiBgJHtIVE1MQ2xhc3Nlcy5ncmlkQ29udGFpbmVyfSAke3RoaXMuaGFzQm9yZGVyID8gSFRNTENsYXNzZXMuYm9yZGVyIDogXCJcIn0gJHt0aGlzLmlzU3RhY2tlZCA/IEhUTUxDbGFzc2VzLnN0YWNrZWQgOiBcIlwifWAgfSwgdGhpcy5oYXNIZWFkZXIgJiYgdGhpcy5yZW5kZXJIZWFkZXIoKSwgaChcInRib2R5XCIsIG51bGwsIC4uLnRoaXMucmVuZGVyR3JpZE9wdGlvbnMoKSkpKSk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgYXNzZXRzRGlycygpIHsgcmV0dXJuIFtcInQ5blwiXTsgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5SRnhHcmlkLnN0eWxlID0gcmZ4R3JpZENzcztcblxuZXhwb3J0IHsgUkZ4Q29sb3JQaWNrZXIgYXMgcmZ4X2NvbG9yX3BpY2tlciwgUkZ4UmFzdGVySW5wdXQgYXMgcmZ4X2R0ZV9yYXN0ZXJfaW5wdXQsIFJGeENvbW1vblNlbGVjdCBhcyByZnhfZHRleF9jb21tb25fc2VsZWN0LCBSRnhGaWVsZFNlbGVjdCBhcyByZnhfZHRleF9maWVsZF9zZWxlY3QsIFJGeEdyaWQgYXMgcmZ4X2dyaWQgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmZ4LWNvbG9yLXBpY2tlcl81LmVudHJ5LmpzLm1hcCIsImNvbnN0IFVJRGVmYXVsdHMgPSB7XG4gICAgU2NhbGU6IFwic1wiLFxuICAgIFBvcG92ZXJUaW1lcjogNjBcbn07XG5jb25zdCBDYWxjaXRlU2NhbGUgPSB7XG4gICAgczogXCJzXCIsXG4gICAgbTogXCJtXCJcbn07XG5jb25zdCBDYWxjaXRlT3ZlcmxheVBvc2l0aW9uaW5nID0ge1xuICAgIGFic29sdXRlOiBcImFic29sdXRlXCIsXG4gICAgZml4ZWQ6IFwiZml4ZWRcIlxufTtcblxuZXhwb3J0IHsgQ2FsY2l0ZVNjYWxlIGFzIEMsIFVJRGVmYXVsdHMgYXMgVSwgQ2FsY2l0ZU92ZXJsYXlQb3NpdGlvbmluZyBhcyBhIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVpLXV0aWxzLTkyOGE0MDk2LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==