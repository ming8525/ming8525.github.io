"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_predom-991fb1"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ createPredominanceRendererFromExisting),
/* harmony export */   c: () => (/* binding */ createPredominanceRenderer),
/* harmony export */   g: () => (/* binding */ getPredominantCategories)
/* harmony export */ });
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




/**
 * Updates the layer with a Predominance renderer with default settings
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function createPredominanceRenderer(options) {
    var _a;
    const { layer: smLayer, mapView, selectedFields, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const extras = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.m)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer));
    return modules.PredominanceCreator.createRenderer({
        layer,
        view: mapView,
        fields: getPredominanceFields(options.fieldInfos),
        predominanceScheme: options.predominanceScheme || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.W)(),
        includeOpacityVariable: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeOpacityVariable)
            ? (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeOpacityVariable)
            : true,
        includeSizeVariable: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeSizeVariable) ? options.includeSizeVariable : false,
        outlineOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.outlineOptimizationEnabled)
            ? options.outlineOptimizationEnabled
            : (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.q)(layer)
                ? true
                : false,
        sizeOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.sizeOptimizationEnabled) ? options.sizeOptimizationEnabled : true,
        legendOptions: options.legendOptions,
        defaultSymbolEnabled: false,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        //console.log("createPredominanceRenderer result", result.renderer.toJSON());
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.l)(extras, result.renderer, { notOpacity: true });
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.g)();
        if (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeOpacityVariable) &&
            ["predominance", "predominance-size"].indexOf(rendererType) > -1) {
            // current renderer was predominance too
            const rendererFields = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.f)(layer);
            const selNames = selectedFields.map((selField) => selField.field).sort();
            // renderer re-orders fields
            const renNames = rendererFields.map((renField) => renField.field).sort();
            const sameFields = selNames.toString() === renNames.toString();
            if (sameFields) {
                // keep transparency
                const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer), "opacity");
                const opacityAuthVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer), "opacity");
                result.renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.n)(result.renderer, "opacity") || [];
                if (opacityVisVar) {
                    result.renderer.visualVariables.push(opacityVisVar);
                }
                result.renderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.o)(result.renderer, "opacity") || [];
                if (opacityAuthVisVar) {
                    result.renderer.authoringInfo.visualVariables.push(opacityAuthVisVar);
                }
                // keep colors and symbols
                const symbol = result.renderer.uniqueValueInfos[0].symbol.clone();
                result.renderer.uniqueValueInfos = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer).uniqueValueInfos;
                if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.q)(layer)) {
                    if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.g)() === "predominance-size" && options.includeSizeVariable !== true) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.X)(result.renderer, symbol);
                    }
                    else if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.g)() === "predominance" && options.includeSizeVariable === true) {
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.Y)(result.renderer, symbol);
                    }
                }
            }
        }
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
/**
 * Creates a Predominance renderer with settings from current renderer
 * @param props: must contain layer, mapView
 * @param options: only contains properties that need to be overwritten
 */
function createPredominanceRendererFromExisting(options) {
    var _a;
    const { layer: smLayer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(renderer, "size");
    const authSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(renderer, "size");
    const extras = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.m)(renderer);
    let fieldInfos = options.fieldInfos
        ? options.fieldInfos
        : renderer.uniqueValueGroups[0].classes.map((info) => {
            return {
                field: info.values[0].value,
                simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.w.NUMBER
            };
        });
    let isSameFields = true;
    let lastFieldsOrder;
    if (options.fieldInfos) {
        // compare
        renderer.uniqueValueGroups[0].classes.forEach((info, idx) => {
            if (info.values[0].value !== options.fieldInfos[idx].field) {
                isSameFields = false;
            }
        });
        if (isSameFields) {
            // no changes to fields
            delete options.fieldInfos;
            if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.R)(options)) {
                // nothing really changes
                const newRender = renderer.clone();
                return Promise.resolve({ renderer: newRender });
            }
        }
    }
    if (isSameFields) {
        // keep the order of fields
        lastFieldsOrder = renderer.uniqueValueInfos.map((info) => info.value);
    }
    let symbol;
    const uvRenderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.h)(layer);
    symbol =
        uvRenderer.uniqueValueInfos && uvRenderer.uniqueValueInfos.length ? uvRenderer.uniqueValueInfos[0].symbol : null;
    const defaultSymbol = renderer.defaultSymbol;
    const defaultLabel = renderer.defaultLabel;
    const backgroundFillSymbol = renderer.backgroundFillSymbol;
    let isInverted = false;
    if (sizeVisVar) {
        if (sizeVisVar.minSize.stops) {
            isInverted = sizeVisVar.minSize.stops[0].size > sizeVisVar.maxSize.stops[0].size;
        }
        else {
            isInverted = sizeVisVar.minSize > sizeVisVar.maxSize;
        }
    }
    const temp = fieldInfos[0];
    fieldInfos[0] = fieldInfos[1];
    fieldInfos[1] = temp;
    return modules.PredominanceCreator.createRenderer({
        layer,
        view: mapView,
        fields: getPredominanceFields(fieldInfos),
        predominanceScheme: options.predominanceScheme || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.W)(),
        includeOpacityVariable: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeOpacityVariable)
            ? options.includeOpacityVariable
            : !!extras.opacityVisVar,
        includeSizeVariable: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeSizeVariable) ? options.includeSizeVariable : !!sizeVisVar,
        outlineOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.outlineOptimizationEnabled)
            ? options.outlineOptimizationEnabled
            : !!extras.sizeOutlineVisVar,
        sizeOptimizationEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.sizeOptimizationEnabled)
            ? options.sizeOptimizationEnabled
            : !!extras.sizeAutoVisVar,
        legendOptions: undefined,
        defaultSymbolEnabled: (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.defaultSymbolEnabled) ? options.defaultSymbolEnabled : !!defaultSymbol,
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    }).then((result) => {
        //console.log("createRenderer", result);
        // keep slider values
        if (!options.fieldInfos && sizeVisVar) {
            const newSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "size");
            newSizeVisVar.minDataValue = sizeVisVar.minDataValue;
            newSizeVisVar.maxDataValue = sizeVisVar.maxDataValue;
            if (authSizeVisVar) {
                const newAuthSizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.p)(result.renderer, "size");
                newAuthSizeVisVar.minSliderValue = authSizeVisVar.minSliderValue;
                newAuthSizeVisVar.maxSliderValue = authSizeVisVar.maxSliderValue;
            }
        }
        if (!(0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.i)(options.includeOpacityVariable) &&
            isSameFields &&
            extras.opacityVisVar &&
            extras.authOpacityVisVar) {
            // keep the one we had
            result.renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.n)(result.renderer, "opacity");
            result.renderer.authoringInfo.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.o)(result.renderer, "opacity");
            result.renderer.visualVariables.push(extras.opacityVisVar);
            result.renderer.authoringInfo.visualVariables = result.renderer.authoringInfo.visualVariables || [];
            result.renderer.authoringInfo.visualVariables.push(extras.authOpacityVisVar);
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.l)(extras, result.renderer, { notOpacity: true });
        if (lastFieldsOrder) {
            // keep order of fields
            result.renderer.uniqueValueInfos.sort((infoA, infoB) => {
                const indexA = lastFieldsOrder.indexOf(infoA.value);
                const indexB = lastFieldsOrder.indexOf(infoB.value);
                return indexA > -1 && indexB > -1 && indexA < indexB
                    ? -1
                    : indexA > -1 && indexB > -1 && indexA > indexB
                        ? 1
                        : indexA > -1
                            ? -1
                            : indexB > -1
                                ? 1
                                : 0;
            });
        }
        if (isSameFields) {
            // keep labels
            result.renderer.uniqueValueInfos.forEach((info, idx) => {
                info.label = renderer.uniqueValueInfos[idx].label;
            });
        }
        if (symbol && result.renderer.uniqueValueInfos && result.renderer.uniqueValueInfos.length) {
            const infos = result.renderer.uniqueValueInfos.slice();
            infos.map((info, idx) => {
                let sym;
                if (isSameFields) {
                    // keep the exact symbol from previous renderer
                    sym = renderer.uniqueValueInfos[idx].symbol;
                }
                else {
                    // keep the same symbol style, not the color
                    sym = symbol.clone();
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.r)(sym, (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.t)(info.symbol));
                }
                info.symbol = sym;
            });
            result.renderer.uniqueValueInfos = infos;
        }
        if (defaultSymbol) {
            result.renderer.defaultSymbol = defaultSymbol;
            result.renderer.defaultLabel = defaultLabel;
        }
        if (backgroundFillSymbol) {
            result.renderer.backgroundFillSymbol = backgroundFillSymbol;
        }
        if (isInverted) {
            const sizeVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.a)(result.renderer, "size");
            const tmp = sizeVisVar.minSize;
            sizeVisVar.minSize = sizeVisVar.maxSize;
            sizeVisVar.maxSize = tmp;
        }
        return Promise.resolve(result);
    }, (error) => Promise.reject(error));
}
/**
 * gets predominant categories with the count
 * @param props: must contain layer, mapView, GalleryFields[]
 * @param options: options
 */
function getPredominantCategories(options) {
    var _a;
    const { layer: smLayer, mapView: view, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s;
    const layer = smLayer;
    options = options || {};
    return modules.predominantCategories({
        layer,
        view,
        fields: options.fieldInfos.map((fieldInfo) => fieldInfo.field),
        forBinning: ((_a = layer.featureReduction) === null || _a === void 0 ? void 0 : _a.type) === "binning"
    });
}
function getPredominanceFields(fieldInfos) {
    return fieldInfos.map((fieldInfo) => {
        return {
            //valueExpression: `$feature.${option.value}`,
            name: fieldInfo.field,
            label: getFieldLabel(fieldInfo.field)
        };
    });
}
function getFieldLabel(fieldName) {
    const galleryFields = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_0__.s.fields.filter((field) => field.layerField.name === fieldName);
    if (galleryFields.length) {
        return galleryFields[0].label;
    }
    return "";
}



//# sourceMappingURL=predominance-a1a2d74d.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fcHJlZG9tLTk5MWZiMS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNrZDtBQUMvYTtBQUM0Qjs7QUFFL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1EQUFtRCxFQUFFLCtEQUFpQjtBQUNsRjtBQUNBO0FBQ0EsbUJBQW1CLG1FQUFnQixDQUFDLG1FQUFXO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELG1FQUFzQjtBQUNoRixnQ0FBZ0MsK0RBQVM7QUFDekMsY0FBYywrREFBUztBQUN2QjtBQUNBLDZCQUE2QiwrREFBUztBQUN0QyxvQ0FBb0MsK0RBQVM7QUFDN0M7QUFDQSxjQUFjLG1FQUFhO0FBQzNCO0FBQ0E7QUFDQSxpQ0FBaUMsK0RBQVM7QUFDMUM7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsUUFBUSxtRUFBaUIsNEJBQTRCLGtCQUFrQjtBQUN2RSw2QkFBNkIsbUVBQWU7QUFDNUMsYUFBYSwrREFBUztBQUN0QjtBQUNBO0FBQ0EsbUNBQW1DLG1FQUFxQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsbUVBQVMsQ0FBQyxtRUFBVztBQUMzRCwwQ0FBMEMsbUVBQWEsQ0FBQyxtRUFBVztBQUNuRSxrREFBa0QsbUVBQWdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRSxtRUFBb0I7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxtRUFBVztBQUM5RCxvQkFBb0IsbUVBQWE7QUFDakMsd0JBQXdCLG1FQUFlO0FBQ3ZDLHdCQUF3QixtRUFBdUI7QUFDL0M7QUFDQSw2QkFBNkIsbUVBQWU7QUFDNUMsd0JBQXdCLG1FQUF1QjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1DQUFtQyxFQUFFLCtEQUFpQjtBQUNsRTtBQUNBO0FBQ0EscUJBQXFCLG1FQUFXO0FBQ2hDLHVCQUF1QixtRUFBUztBQUNoQywyQkFBMkIsbUVBQWE7QUFDeEMsbUJBQW1CLG1FQUFnQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLCtEQUFnQjtBQUNqRDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixtRUFBTztBQUN2QjtBQUNBO0FBQ0EseUNBQXlDLHFCQUFxQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG1FQUFXO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRCxtRUFBc0I7QUFDaEYsZ0NBQWdDLCtEQUFTO0FBQ3pDO0FBQ0E7QUFDQSw2QkFBNkIsK0RBQVM7QUFDdEMsb0NBQW9DLCtEQUFTO0FBQzdDO0FBQ0E7QUFDQSxpQ0FBaUMsK0RBQVM7QUFDMUM7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLCtEQUFTO0FBQ3ZDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxtRUFBUztBQUMzQztBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsbUVBQWE7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLCtEQUFTO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLG1FQUFnQjtBQUM5RCw0REFBNEQsbUVBQW9CO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxtRUFBaUIsNEJBQTRCLGtCQUFrQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG1FQUFnQixNQUFNLG1FQUFjO0FBQ3hEO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUVBQVM7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx5Q0FBeUMsRUFBRSwrREFBaUI7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsYUFBYTtBQUN4RDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDBCQUEwQiwrREFBaUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vcHJlZG9taW5hbmNlLWExYTJkNzRkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgaCBhcyBnZXRSZW5kZXJlciwgYSBhcyBnZXRWaXNWYXIsIHAgYXMgZ2V0QXV0aFZpc1ZhciwgbSBhcyBzYXZlRXh0cmFWaXNWYXJzLCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIFIgYXMgaXNFbXB0eSwgVyBhcyBmaW5kUHJlZG9taW5hbmNlU2NoZW1lLCBuIGFzIGdldFZpc1ZhcnNFeGNlcHQsIG8gYXMgZ2V0QXV0aFZpc1ZhcnNFeGNlcHQsIGwgYXMgYXBwbHlFeHRyYVZpc1ZhcnMsIHIgYXMgYXBwbHlTeW1ib2xDb2xvciwgdCBhcyBnZXRTeW1ib2xDb2xvciwgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSwgcSBhcyBpc1BvbHlnb25UeXBlLCBnIGFzIGdldFJlbmRlcmVyVHlwZSwgZiBhcyBnZXRSZW5kZXJlckZpZWxkSW5mb3MsIFggYXMgc3dpdGNoTWFya2Vyc1RvUG9seWdvbnMsIFkgYXMgc3dpdGNoUG9seWdvbnNUb01hcmtlcnMgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGkgYXMgaXNEZWZpbmVkIH0gZnJvbSAnLi9jb21tb25GdW5jdGlvbnMtYjA4MzBlOWUuanMnO1xuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIGxheWVyIHdpdGggYSBQcmVkb21pbmFuY2UgcmVuZGVyZXIgd2l0aCBkZWZhdWx0IHNldHRpbmdzXG4gKiBAcGFyYW0gcHJvcHM6IG11c3QgY29udGFpbiBsYXllciwgbWFwVmlldywgR2FsbGVyeUZpZWxkc1tdXG4gKiBAcGFyYW0gb3B0aW9uczogb3B0aW9uc1xuICovXG5mdW5jdGlvbiBjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlcihvcHRpb25zKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHsgbGF5ZXI6IHNtTGF5ZXIsIG1hcFZpZXcsIHNlbGVjdGVkRmllbGRzLCBtb2R1bGVzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICBjb25zdCBsYXllciA9IHNtTGF5ZXI7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgY29uc3QgZXh0cmFzID0gc2F2ZUV4dHJhVmlzVmFycyhnZXRSZW5kZXJlcihsYXllcikpO1xuICAgIHJldHVybiBtb2R1bGVzLlByZWRvbWluYW5jZUNyZWF0b3IuY3JlYXRlUmVuZGVyZXIoe1xuICAgICAgICBsYXllcixcbiAgICAgICAgdmlldzogbWFwVmlldyxcbiAgICAgICAgZmllbGRzOiBnZXRQcmVkb21pbmFuY2VGaWVsZHMob3B0aW9ucy5maWVsZEluZm9zKSxcbiAgICAgICAgcHJlZG9taW5hbmNlU2NoZW1lOiBvcHRpb25zLnByZWRvbWluYW5jZVNjaGVtZSB8fCBmaW5kUHJlZG9taW5hbmNlU2NoZW1lKCksXG4gICAgICAgIGluY2x1ZGVPcGFjaXR5VmFyaWFibGU6IGlzRGVmaW5lZChvcHRpb25zLmluY2x1ZGVPcGFjaXR5VmFyaWFibGUpXG4gICAgICAgICAgICA/IGlzRGVmaW5lZChvcHRpb25zLmluY2x1ZGVPcGFjaXR5VmFyaWFibGUpXG4gICAgICAgICAgICA6IHRydWUsXG4gICAgICAgIGluY2x1ZGVTaXplVmFyaWFibGU6IGlzRGVmaW5lZChvcHRpb25zLmluY2x1ZGVTaXplVmFyaWFibGUpID8gb3B0aW9ucy5pbmNsdWRlU2l6ZVZhcmlhYmxlIDogZmFsc2UsXG4gICAgICAgIG91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkOiBpc0RlZmluZWQob3B0aW9ucy5vdXRsaW5lT3B0aW1pemF0aW9uRW5hYmxlZClcbiAgICAgICAgICAgID8gb3B0aW9ucy5vdXRsaW5lT3B0aW1pemF0aW9uRW5hYmxlZFxuICAgICAgICAgICAgOiBpc1BvbHlnb25UeXBlKGxheWVyKVxuICAgICAgICAgICAgICAgID8gdHJ1ZVxuICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgIHNpemVPcHRpbWl6YXRpb25FbmFibGVkOiBpc0RlZmluZWQob3B0aW9ucy5zaXplT3B0aW1pemF0aW9uRW5hYmxlZCkgPyBvcHRpb25zLnNpemVPcHRpbWl6YXRpb25FbmFibGVkIDogdHJ1ZSxcbiAgICAgICAgbGVnZW5kT3B0aW9uczogb3B0aW9ucy5sZWdlbmRPcHRpb25zLFxuICAgICAgICBkZWZhdWx0U3ltYm9sRW5hYmxlZDogZmFsc2UsXG4gICAgICAgIGZvckJpbm5pbmc6ICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJjcmVhdGVQcmVkb21pbmFuY2VSZW5kZXJlciByZXN1bHRcIiwgcmVzdWx0LnJlbmRlcmVyLnRvSlNPTigpKTtcbiAgICAgICAgYXBwbHlFeHRyYVZpc1ZhcnMoZXh0cmFzLCByZXN1bHQucmVuZGVyZXIsIHsgbm90T3BhY2l0eTogdHJ1ZSB9KTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGlmICghaXNEZWZpbmVkKG9wdGlvbnMuaW5jbHVkZU9wYWNpdHlWYXJpYWJsZSkgJiZcbiAgICAgICAgICAgIFtcInByZWRvbWluYW5jZVwiLCBcInByZWRvbWluYW5jZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAvLyBjdXJyZW50IHJlbmRlcmVyIHdhcyBwcmVkb21pbmFuY2UgdG9vXG4gICAgICAgICAgICBjb25zdCByZW5kZXJlckZpZWxkcyA9IGdldFJlbmRlcmVyRmllbGRJbmZvcyhsYXllcik7XG4gICAgICAgICAgICBjb25zdCBzZWxOYW1lcyA9IHNlbGVjdGVkRmllbGRzLm1hcCgoc2VsRmllbGQpID0+IHNlbEZpZWxkLmZpZWxkKS5zb3J0KCk7XG4gICAgICAgICAgICAvLyByZW5kZXJlciByZS1vcmRlcnMgZmllbGRzXG4gICAgICAgICAgICBjb25zdCByZW5OYW1lcyA9IHJlbmRlcmVyRmllbGRzLm1hcCgocmVuRmllbGQpID0+IHJlbkZpZWxkLmZpZWxkKS5zb3J0KCk7XG4gICAgICAgICAgICBjb25zdCBzYW1lRmllbGRzID0gc2VsTmFtZXMudG9TdHJpbmcoKSA9PT0gcmVuTmFtZXMudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGlmIChzYW1lRmllbGRzKSB7XG4gICAgICAgICAgICAgICAgLy8ga2VlcCB0cmFuc3BhcmVuY3lcbiAgICAgICAgICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJvcGFjaXR5XCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wYWNpdHlBdXRoVmlzVmFyID0gZ2V0QXV0aFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwib3BhY2l0eVwiKTtcbiAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZXIudmlzdWFsVmFyaWFibGVzID0gZ2V0VmlzVmFyc0V4Y2VwdChyZXN1bHQucmVuZGVyZXIsIFwib3BhY2l0eVwiKSB8fCBbXTtcbiAgICAgICAgICAgICAgICBpZiAob3BhY2l0eVZpc1Zhcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2gob3BhY2l0eVZpc1Zhcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcyA9IGdldEF1dGhWaXNWYXJzRXhjZXB0KHJlc3VsdC5yZW5kZXJlciwgXCJvcGFjaXR5XCIpIHx8IFtdO1xuICAgICAgICAgICAgICAgIGlmIChvcGFjaXR5QXV0aFZpc1Zhcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMucHVzaChvcGFjaXR5QXV0aFZpc1Zhcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGtlZXAgY29sb3JzIGFuZCBzeW1ib2xzXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ltYm9sID0gcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3NbMF0uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MgPSBnZXRSZW5kZXJlcihsYXllcikudW5pcXVlVmFsdWVJbmZvcztcbiAgICAgICAgICAgICAgICBpZiAoaXNQb2x5Z29uVHlwZShsYXllcikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdldFJlbmRlcmVyVHlwZSgpID09PSBcInByZWRvbWluYW5jZS1zaXplXCIgJiYgb3B0aW9ucy5pbmNsdWRlU2l6ZVZhcmlhYmxlICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hNYXJrZXJzVG9Qb2x5Z29ucyhyZXN1bHQucmVuZGVyZXIsIHN5bWJvbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZ2V0UmVuZGVyZXJUeXBlKCkgPT09IFwicHJlZG9taW5hbmNlXCIgJiYgb3B0aW9ucy5pbmNsdWRlU2l6ZVZhcmlhYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hQb2x5Z29uc1RvTWFya2VycyhyZXN1bHQucmVuZGVyZXIsIHN5bWJvbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgIH0sIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIFByZWRvbWluYW5jZSByZW5kZXJlciB3aXRoIHNldHRpbmdzIGZyb20gY3VycmVudCByZW5kZXJlclxuICogQHBhcmFtIHByb3BzOiBtdXN0IGNvbnRhaW4gbGF5ZXIsIG1hcFZpZXdcbiAqIEBwYXJhbSBvcHRpb25zOiBvbmx5IGNvbnRhaW5zIHByb3BlcnRpZXMgdGhhdCBuZWVkIHRvIGJlIG92ZXJ3cml0dGVuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVByZWRvbWluYW5jZVJlbmRlcmVyRnJvbUV4aXN0aW5nKG9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgIGNvbnN0IHNpemVWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICBjb25zdCBhdXRoU2l6ZVZpc1ZhciA9IGdldEF1dGhWaXNWYXIocmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICBjb25zdCBleHRyYXMgPSBzYXZlRXh0cmFWaXNWYXJzKHJlbmRlcmVyKTtcbiAgICBsZXQgZmllbGRJbmZvcyA9IG9wdGlvbnMuZmllbGRJbmZvc1xuICAgICAgICA/IG9wdGlvbnMuZmllbGRJbmZvc1xuICAgICAgICA6IHJlbmRlcmVyLnVuaXF1ZVZhbHVlR3JvdXBzWzBdLmNsYXNzZXMubWFwKChpbmZvKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBpbmZvLnZhbHVlc1swXS52YWx1ZSxcbiAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICBsZXQgaXNTYW1lRmllbGRzID0gdHJ1ZTtcbiAgICBsZXQgbGFzdEZpZWxkc09yZGVyO1xuICAgIGlmIChvcHRpb25zLmZpZWxkSW5mb3MpIHtcbiAgICAgICAgLy8gY29tcGFyZVxuICAgICAgICByZW5kZXJlci51bmlxdWVWYWx1ZUdyb3Vwc1swXS5jbGFzc2VzLmZvckVhY2goKGluZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgaWYgKGluZm8udmFsdWVzWzBdLnZhbHVlICE9PSBvcHRpb25zLmZpZWxkSW5mb3NbaWR4XS5maWVsZCkge1xuICAgICAgICAgICAgICAgIGlzU2FtZUZpZWxkcyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzU2FtZUZpZWxkcykge1xuICAgICAgICAgICAgLy8gbm8gY2hhbmdlcyB0byBmaWVsZHNcbiAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmZpZWxkSW5mb3M7XG4gICAgICAgICAgICBpZiAoaXNFbXB0eShvcHRpb25zKSkge1xuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgcmVhbGx5IGNoYW5nZXNcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdSZW5kZXIgPSByZW5kZXJlci5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyByZW5kZXJlcjogbmV3UmVuZGVyIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChpc1NhbWVGaWVsZHMpIHtcbiAgICAgICAgLy8ga2VlcCB0aGUgb3JkZXIgb2YgZmllbGRzXG4gICAgICAgIGxhc3RGaWVsZHNPcmRlciA9IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MubWFwKChpbmZvKSA9PiBpbmZvLnZhbHVlKTtcbiAgICB9XG4gICAgbGV0IHN5bWJvbDtcbiAgICBjb25zdCB1dlJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgIHN5bWJvbCA9XG4gICAgICAgIHV2UmVuZGVyZXIudW5pcXVlVmFsdWVJbmZvcyAmJiB1dlJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MubGVuZ3RoID8gdXZSZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zWzBdLnN5bWJvbCA6IG51bGw7XG4gICAgY29uc3QgZGVmYXVsdFN5bWJvbCA9IHJlbmRlcmVyLmRlZmF1bHRTeW1ib2w7XG4gICAgY29uc3QgZGVmYXVsdExhYmVsID0gcmVuZGVyZXIuZGVmYXVsdExhYmVsO1xuICAgIGNvbnN0IGJhY2tncm91bmRGaWxsU3ltYm9sID0gcmVuZGVyZXIuYmFja2dyb3VuZEZpbGxTeW1ib2w7XG4gICAgbGV0IGlzSW52ZXJ0ZWQgPSBmYWxzZTtcbiAgICBpZiAoc2l6ZVZpc1Zhcikge1xuICAgICAgICBpZiAoc2l6ZVZpc1Zhci5taW5TaXplLnN0b3BzKSB7XG4gICAgICAgICAgICBpc0ludmVydGVkID0gc2l6ZVZpc1Zhci5taW5TaXplLnN0b3BzWzBdLnNpemUgPiBzaXplVmlzVmFyLm1heFNpemUuc3RvcHNbMF0uc2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlzSW52ZXJ0ZWQgPSBzaXplVmlzVmFyLm1pblNpemUgPiBzaXplVmlzVmFyLm1heFNpemU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdGVtcCA9IGZpZWxkSW5mb3NbMF07XG4gICAgZmllbGRJbmZvc1swXSA9IGZpZWxkSW5mb3NbMV07XG4gICAgZmllbGRJbmZvc1sxXSA9IHRlbXA7XG4gICAgcmV0dXJuIG1vZHVsZXMuUHJlZG9taW5hbmNlQ3JlYXRvci5jcmVhdGVSZW5kZXJlcih7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3OiBtYXBWaWV3LFxuICAgICAgICBmaWVsZHM6IGdldFByZWRvbWluYW5jZUZpZWxkcyhmaWVsZEluZm9zKSxcbiAgICAgICAgcHJlZG9taW5hbmNlU2NoZW1lOiBvcHRpb25zLnByZWRvbWluYW5jZVNjaGVtZSB8fCBmaW5kUHJlZG9taW5hbmNlU2NoZW1lKCksXG4gICAgICAgIGluY2x1ZGVPcGFjaXR5VmFyaWFibGU6IGlzRGVmaW5lZChvcHRpb25zLmluY2x1ZGVPcGFjaXR5VmFyaWFibGUpXG4gICAgICAgICAgICA/IG9wdGlvbnMuaW5jbHVkZU9wYWNpdHlWYXJpYWJsZVxuICAgICAgICAgICAgOiAhIWV4dHJhcy5vcGFjaXR5VmlzVmFyLFxuICAgICAgICBpbmNsdWRlU2l6ZVZhcmlhYmxlOiBpc0RlZmluZWQob3B0aW9ucy5pbmNsdWRlU2l6ZVZhcmlhYmxlKSA/IG9wdGlvbnMuaW5jbHVkZVNpemVWYXJpYWJsZSA6ICEhc2l6ZVZpc1ZhcixcbiAgICAgICAgb3V0bGluZU9wdGltaXphdGlvbkVuYWJsZWQ6IGlzRGVmaW5lZChvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkKVxuICAgICAgICAgICAgPyBvcHRpb25zLm91dGxpbmVPcHRpbWl6YXRpb25FbmFibGVkXG4gICAgICAgICAgICA6ICEhZXh0cmFzLnNpemVPdXRsaW5lVmlzVmFyLFxuICAgICAgICBzaXplT3B0aW1pemF0aW9uRW5hYmxlZDogaXNEZWZpbmVkKG9wdGlvbnMuc2l6ZU9wdGltaXphdGlvbkVuYWJsZWQpXG4gICAgICAgICAgICA/IG9wdGlvbnMuc2l6ZU9wdGltaXphdGlvbkVuYWJsZWRcbiAgICAgICAgICAgIDogISFleHRyYXMuc2l6ZUF1dG9WaXNWYXIsXG4gICAgICAgIGxlZ2VuZE9wdGlvbnM6IHVuZGVmaW5lZCxcbiAgICAgICAgZGVmYXVsdFN5bWJvbEVuYWJsZWQ6IGlzRGVmaW5lZChvcHRpb25zLmRlZmF1bHRTeW1ib2xFbmFibGVkKSA/IG9wdGlvbnMuZGVmYXVsdFN5bWJvbEVuYWJsZWQgOiAhIWRlZmF1bHRTeW1ib2wsXG4gICAgICAgIGZvckJpbm5pbmc6ICgoX2EgPSBsYXllci5mZWF0dXJlUmVkdWN0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudHlwZSkgPT09IFwiYmlubmluZ1wiXG4gICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJjcmVhdGVSZW5kZXJlclwiLCByZXN1bHQpO1xuICAgICAgICAvLyBrZWVwIHNsaWRlciB2YWx1ZXNcbiAgICAgICAgaWYgKCFvcHRpb25zLmZpZWxkSW5mb3MgJiYgc2l6ZVZpc1Zhcikge1xuICAgICAgICAgICAgY29uc3QgbmV3U2l6ZVZpc1ZhciA9IGdldFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIFwic2l6ZVwiKTtcbiAgICAgICAgICAgIG5ld1NpemVWaXNWYXIubWluRGF0YVZhbHVlID0gc2l6ZVZpc1Zhci5taW5EYXRhVmFsdWU7XG4gICAgICAgICAgICBuZXdTaXplVmlzVmFyLm1heERhdGFWYWx1ZSA9IHNpemVWaXNWYXIubWF4RGF0YVZhbHVlO1xuICAgICAgICAgICAgaWYgKGF1dGhTaXplVmlzVmFyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3QXV0aFNpemVWaXNWYXIgPSBnZXRBdXRoVmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICAgICAgICAgIG5ld0F1dGhTaXplVmlzVmFyLm1pblNsaWRlclZhbHVlID0gYXV0aFNpemVWaXNWYXIubWluU2xpZGVyVmFsdWU7XG4gICAgICAgICAgICAgICAgbmV3QXV0aFNpemVWaXNWYXIubWF4U2xpZGVyVmFsdWUgPSBhdXRoU2l6ZVZpc1Zhci5tYXhTbGlkZXJWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzRGVmaW5lZChvcHRpb25zLmluY2x1ZGVPcGFjaXR5VmFyaWFibGUpICYmXG4gICAgICAgICAgICBpc1NhbWVGaWVsZHMgJiZcbiAgICAgICAgICAgIGV4dHJhcy5vcGFjaXR5VmlzVmFyICYmXG4gICAgICAgICAgICBleHRyYXMuYXV0aE9wYWNpdHlWaXNWYXIpIHtcbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIG9uZSB3ZSBoYWRcbiAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci52aXN1YWxWYXJpYWJsZXMgPSBnZXRWaXNWYXJzRXhjZXB0KHJlc3VsdC5yZW5kZXJlciwgXCJvcGFjaXR5XCIpO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID0gZ2V0QXV0aFZpc1ZhcnNFeGNlcHQocmVzdWx0LnJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgICAgICByZXN1bHQucmVuZGVyZXIudmlzdWFsVmFyaWFibGVzLnB1c2goZXh0cmFzLm9wYWNpdHlWaXNWYXIpO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzID0gcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzIHx8IFtdO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmF1dGhvcmluZ0luZm8udmlzdWFsVmFyaWFibGVzLnB1c2goZXh0cmFzLmF1dGhPcGFjaXR5VmlzVmFyKTtcbiAgICAgICAgfVxuICAgICAgICBhcHBseUV4dHJhVmlzVmFycyhleHRyYXMsIHJlc3VsdC5yZW5kZXJlciwgeyBub3RPcGFjaXR5OiB0cnVlIH0pO1xuICAgICAgICBpZiAobGFzdEZpZWxkc09yZGVyKSB7XG4gICAgICAgICAgICAvLyBrZWVwIG9yZGVyIG9mIGZpZWxkc1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3Muc29ydCgoaW5mb0EsIGluZm9CKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXhBID0gbGFzdEZpZWxkc09yZGVyLmluZGV4T2YoaW5mb0EudmFsdWUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4QiA9IGxhc3RGaWVsZHNPcmRlci5pbmRleE9mKGluZm9CLnZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXhBID4gLTEgJiYgaW5kZXhCID4gLTEgJiYgaW5kZXhBIDwgaW5kZXhCXG4gICAgICAgICAgICAgICAgICAgID8gLTFcbiAgICAgICAgICAgICAgICAgICAgOiBpbmRleEEgPiAtMSAmJiBpbmRleEIgPiAtMSAmJiBpbmRleEEgPiBpbmRleEJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gMVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBpbmRleEEgPiAtMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gLTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGluZGV4QiA+IC0xXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTYW1lRmllbGRzKSB7XG4gICAgICAgICAgICAvLyBrZWVwIGxhYmVsc1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MuZm9yRWFjaCgoaW5mbywgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5sYWJlbCA9IHJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3NbaWR4XS5sYWJlbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzeW1ib2wgJiYgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MgJiYgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBpbmZvcyA9IHJlc3VsdC5yZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zLnNsaWNlKCk7XG4gICAgICAgICAgICBpbmZvcy5tYXAoKGluZm8sIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzeW07XG4gICAgICAgICAgICAgICAgaWYgKGlzU2FtZUZpZWxkcykge1xuICAgICAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZSBleGFjdCBzeW1ib2wgZnJvbSBwcmV2aW91cyByZW5kZXJlclxuICAgICAgICAgICAgICAgICAgICBzeW0gPSByZW5kZXJlci51bmlxdWVWYWx1ZUluZm9zW2lkeF0uc3ltYm9sO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8ga2VlcCB0aGUgc2FtZSBzeW1ib2wgc3R5bGUsIG5vdCB0aGUgY29sb3JcbiAgICAgICAgICAgICAgICAgICAgc3ltID0gc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5U3ltYm9sQ29sb3Ioc3ltLCBnZXRTeW1ib2xDb2xvcihpbmZvLnN5bWJvbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbmZvLnN5bWJvbCA9IHN5bTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLnVuaXF1ZVZhbHVlSW5mb3MgPSBpbmZvcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVmYXVsdFN5bWJvbCkge1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmRlZmF1bHRTeW1ib2wgPSBkZWZhdWx0U3ltYm9sO1xuICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IGRlZmF1bHRMYWJlbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYmFja2dyb3VuZEZpbGxTeW1ib2wpIHtcbiAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlci5iYWNrZ3JvdW5kRmlsbFN5bWJvbCA9IGJhY2tncm91bmRGaWxsU3ltYm9sO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0ludmVydGVkKSB7XG4gICAgICAgICAgICBjb25zdCBzaXplVmlzVmFyID0gZ2V0VmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJzaXplXCIpO1xuICAgICAgICAgICAgY29uc3QgdG1wID0gc2l6ZVZpc1Zhci5taW5TaXplO1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5taW5TaXplID0gc2l6ZVZpc1Zhci5tYXhTaXplO1xuICAgICAgICAgICAgc2l6ZVZpc1Zhci5tYXhTaXplID0gdG1wO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICB9LCAoZXJyb3IpID0+IFByb21pc2UucmVqZWN0KGVycm9yKSk7XG59XG4vKipcbiAqIGdldHMgcHJlZG9taW5hbnQgY2F0ZWdvcmllcyB3aXRoIHRoZSBjb3VudFxuICogQHBhcmFtIHByb3BzOiBtdXN0IGNvbnRhaW4gbGF5ZXIsIG1hcFZpZXcsIEdhbGxlcnlGaWVsZHNbXVxuICogQHBhcmFtIG9wdGlvbnM6IG9wdGlvbnNcbiAqL1xuZnVuY3Rpb24gZ2V0UHJlZG9taW5hbnRDYXRlZ29yaWVzKG9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgeyBsYXllcjogc21MYXllciwgbWFwVmlldzogdmlldywgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgY29uc3QgbGF5ZXIgPSBzbUxheWVyO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHJldHVybiBtb2R1bGVzLnByZWRvbWluYW50Q2F0ZWdvcmllcyh7XG4gICAgICAgIGxheWVyLFxuICAgICAgICB2aWV3LFxuICAgICAgICBmaWVsZHM6IG9wdGlvbnMuZmllbGRJbmZvcy5tYXAoKGZpZWxkSW5mbykgPT4gZmllbGRJbmZvLmZpZWxkKSxcbiAgICAgICAgZm9yQmlubmluZzogKChfYSA9IGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSA9PT0gXCJiaW5uaW5nXCJcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldFByZWRvbWluYW5jZUZpZWxkcyhmaWVsZEluZm9zKSB7XG4gICAgcmV0dXJuIGZpZWxkSW5mb3MubWFwKChmaWVsZEluZm8pID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC8vdmFsdWVFeHByZXNzaW9uOiBgJGZlYXR1cmUuJHtvcHRpb24udmFsdWV9YCxcbiAgICAgICAgICAgIG5hbWU6IGZpZWxkSW5mby5maWVsZCxcbiAgICAgICAgICAgIGxhYmVsOiBnZXRGaWVsZExhYmVsKGZpZWxkSW5mby5maWVsZClcbiAgICAgICAgfTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldEZpZWxkTGFiZWwoZmllbGROYW1lKSB7XG4gICAgY29uc3QgZ2FsbGVyeUZpZWxkcyA9IHNtYXJ0TWFwcGluZ1N0YXRlLmZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiBmaWVsZC5sYXllckZpZWxkLm5hbWUgPT09IGZpZWxkTmFtZSk7XG4gICAgaWYgKGdhbGxlcnlGaWVsZHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBnYWxsZXJ5RmllbGRzWzBdLmxhYmVsO1xuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbn1cblxuZXhwb3J0IHsgY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXJGcm9tRXhpc3RpbmcgYXMgYSwgY3JlYXRlUHJlZG9taW5hbmNlUmVuZGVyZXIgYXMgYywgZ2V0UHJlZG9taW5hbnRDYXRlZ29yaWVzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJlZG9taW5hbmNlLWExYTJkNzRkLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==