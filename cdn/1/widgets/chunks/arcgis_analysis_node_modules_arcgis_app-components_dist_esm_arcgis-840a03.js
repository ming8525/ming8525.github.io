/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-840a03.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-840a03"],{96794:(e,t,s)=>{s.r(t),s.d(t,{arcgis_delete_items:()=>l});var i=s(81149),r=s(70464),n=s(82218),a=s(91942);s(42577),s(51837),s(69283),s(88780),s(20164),s(49853),s(79210);const l=class{constructor(e){(0,i.r)(this,e),this.arcgisDeleteItemsDelete=(0,i.c)(this,"arcgisDeleteItemsDelete",7),this.arcgisDeleteItemsClose=(0,i.c)(this,"arcgisDeleteItemsClose",7),this.arcgisDeleteItemsModeChange=(0,i.c)(this,"arcgisDeleteItemsModeChange",7),this.deletePrimaryAction="RECYCLE",this.headerTitle="",this.configurePermanentlyDeleteOverrideUI=()=>{const{i18n:e}=this;this.headerTitle=e.permanentlyDelete,this.primaryButtonText=e.permanentlyDelete,this.deleteMode="UNRECYCLABLE",this.permanentDeleteOverrideEnabled=!0},this.renderContent=()=>{const{portal:e,items:t,deleteItemsBuckets:s,deleteMode:r,permanentDeleteOverrideEnabled:n,configurePermanentlyDeleteOverrideUI:a}=this;return(0,i.h)(i.F,null,(0,i.h)("slot",{name:"message"}),e.sourceJSON.recycleBinEnabled?(0,i.h)("arcgis-delete-items-recycle-enabled",{items:t,buckets:s,mode:r,permanentlyDeleteOverridden:n,onArcgisDeleteItemsPermanentlyDeleteOverride:()=>{a()},showSelectedItemsCount:this.showSelectedItemsCount}):(0,i.h)("arcgis-delete-items-recycle-disabled",{buckets:s,mode:r}))},this.handleDelete=async()=>{var e,t;this.isLoading=!0;const{unprotectedItems:s,unrecyclableItems:i}=this.deleteItemsBuckets;let r=null,n=null;this.permanentDeleteOverrideEnabled?r=await this.deleteItems(this.items,!0):(n=null!==(e=s.length>0&&await this.deleteItems(s.map((e=>e.item))))&&void 0!==e?e:null,r=null!==(t=i.length>0&&await this.deleteItems(i.map((e=>e.item)),!0))&&void 0!==t?t:null),this.arcgisDeleteItemsDelete.emit({deletedItems:n,permanentlyDeletedItems:r}),this.closeOnConfirm&&(this.active=!1),this.isLoading=!1},this.deleteItems=async(e,t=!1)=>1===e.length?[await(0,a.d)(e[0],this.user,t)]:(await(0,a.a)(e,this.user,t)).results,this.user=void 0,this.portal=void 0,this.items=[],this.active=!1,this.deleteItemsBuckets={protectedItems:[],unprotectedItems:[],unrecyclableItems:[]},this.showSelectedItemsCount=!0,this.closeOnConfirm=!0,this.permanentDeleteOverrideEnabled=!1,this.isLoading=!1,this.store=(0,r.c)({})}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.store.state.i18n=this.i18n,this.determineDeleteState()}async determineDeleteState(e={fetch:!0}){const{fetch:t}=e;t&&(this.isLoading=!0,this.deleteItemsBuckets=Object.assign({},await(0,a.b)(this.items,this.user,this.portal)),this.isLoading=!1),this.deleteMode=(0,a.c)(this.deleteItemsBuckets),this.arcgisDeleteItemsModeChange.emit(this.deleteMode),this.deletePrimaryAction=(0,a.e)(this.deleteMode),this.primaryButtonText=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"delete"],this.headerTitle=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"deleteItems"]}render(){const{i18n:e,active:t,isLoading:s,headerTitle:r,primaryButtonText:n,deletePrimaryAction:a,permanentDeleteOverrideEnabled:l,renderContent:c}=this;return(0,i.h)("calcite-modal",{open:t,widthScale:"s",kind:"danger",outsideCloseDisabled:!0,onCalciteModalBeforeClose:()=>{this.arcgisDeleteItemsClose.emit()},onCalciteModalClose:()=>{this.active=!1}},(0,i.h)("span",{slot:"header",class:"header"},(0,i.h)("slot",{name:"header"},r)),(0,i.h)("div",{slot:"content",class:"content"},s?(0,i.h)("calcite-scrim",{loading:!0}):c()),!s&&(0,i.h)(i.F,null,(0,i.h)("div",{slot:"back"},l&&(0,i.h)("calcite-button",{appearance:"outline-fill",kind:"neutral","data-id":"backButton",onClick:()=>{this.permanentDeleteOverrideEnabled=!1,this.determineDeleteState({fetch:!1})},width:"full",disabled:s},e.back)),(0,i.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisDeleteItemsClose.emit(),this.active=!1},width:"full"},e.cancel),"NONE"!==a&&(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>this.handleDelete(),width:"full",disabled:s},null!=n?n:e.delete)))}get el(){return(0,i.d)(this)}static get watchers(){return{items:["determineDeleteState"]}}};l.style=".content{display:flex;min-height:72px;flex-direction:column}::slotted([slot=message]){margin-bottom:1rem}"},91942:(e,t,s)=>{s.d(t,{D:()=>l,a:()=>a,b:()=>c,c:()=>o,d:()=>n,e:()=>d});var i=s(88780),r=(s(69283),s(49853),s(20164));const n=async(e,t,s=!1)=>{const i=`${t.userContentUrl}/items/${e.id}/delete`;return(0,r.r)(i,{permanentDelete:s},{},"post")},a=async(e,t,s=!1)=>{const i={items:e.map((e=>e.id)).join(","),permanentDelete:s},n=`${t.userContentUrl}/deleteItems`;return(0,r.r)(n,i,{},"post")},l=14,c=async(e,t,s,n=!1)=>{const a=[],l=[],c=[];return await Promise.all(e.map((async o=>{var d;try{const p=await(async(e,t,s)=>{const i=s.sourceJSON.recycleBinEnabled?"/canRecycle":"/canDelete",n=`${t.userContentUrl}/items/${e.id}${i}`;return await(0,r.r)(n)})(o,t,s);if(p.success){const t=await(async(e,t)=>{const{type:s,typeKeywords:r}=e,n=["Scene Service","Map Service","WFS","OGCFeatureServer","Vector Tile Service","3DTiles Service"].includes(s),a=["Map Service","Vector Tile Service"].includes(s);let l,c=n?"Service2Service":e.typeKeywords.includes("Route Layer")?"Service2Route":"Service2Data",o="Service2Service"===c||"Service2Route"===c?"reverse":"forward";r.indexOf("Bulk Published Service")>-1&&(c="DataStore2BPService",o="reverse");try{const s=await(0,i.g)(e.id,t,{relationshipType:c,direction:o});if(l=(null==s?void 0:s.total)?s.relatedItems.shift():null,n){if(a&&!(e=>e&&e.typeKeywords.includes("View Service")||!1)(l)||!l){const s=await(0,i.g)(e.id,t,{relationshipType:"Service2Data",direction:"forward"});return(null==s?void 0:s.total)?s.relatedItems.shift():l}return l}return l}catch(e){console.error(e)}})(o,s),r=await(async(e,t)=>{const{type:s}=e,r=i.i?"Service2Service":"Service2Data",n="Service2Service"===r&&"Feed"!==s?"forward":"reverse",a=await(0,i.g)(e.id,t,{relationshipType:r,direction:n});return a.total>0&&a.relatedItems})(o,s),c=await(async(e,t,s)=>{const{typeKeywords:r,type:n}=e;return!t&&(null==s?void 0:s.length)&&!(0,i.i)(r,n)})(o,t,r),p=!(c||!r||u(o,r)||m(o,r)),y=null!==(d=n&&1===e.length&&c&&{item:o,error:{message:"Delete discouraged"}})&&void 0!==d?d:null;y?l.push(y):c&&!h(e,r)?a.push({item:o,error:{message:"Delete discouraged"}}):p&&!h(e,r)?a.push({item:o,error:{messageCode:"CONT_00481",offendingItems:r}}):l.push({item:o})}else o.protected?a.push({item:o,error:{messageCode:"CONT_0048"}}):c.push({item:o})}catch(t){const s=Object.assign({},t);switch(t.messageCode){case"CONT_00481":{const{offendingItems:i}=t;h(e,i)?l.push({item:o}):a.push({item:o,error:s});break}case"CONT_0048":default:a.push({item:o,error:s});break;case"CONT_0298":c.push({item:o})}}}))),Promise.resolve({protectedItems:a,unprotectedItems:l,unrecyclableItems:c})},o=e=>{const{protectedItems:t,unrecyclableItems:s,unprotectedItems:i}=e,r=[];return t.length>0&&r.push("PROTECTED"),s.length>0&&r.push("UNRECYCLABLE"),i.length>0&&r.push("UNPROTECTED"),r.join("_")},d=e=>{let t="DELETE";switch(e){case"PROTECTED":t="NONE";break;case"UNRECYCLABLE":case"PROTECTED_UNRECYCLABLE":t="PERMANENTLY_DELETE"}return t},h=(e,t)=>{var s;const i=null!==(s=null==t?void 0:t.map((e=>{var t;return null!==(t=e.itemId)&&void 0!==t?t:e.id})))&&void 0!==s?s:[],r=e.filter((e=>i.includes(e.id))),n=i.every((t=>e.some((e=>e.id===t)))),a=r.every((e=>!e.protected));return n&&a},u=(e,t)=>{const{typeKeywords:s,type:r}=e;return"Feed"===e.type&&(0,i.i)(s,r)&&1===(null==t?void 0:t.length)&&"Feature Service"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},m=(e,t)=>{const{typeKeywords:s,type:r}=e;return"Feature Service"===e.type&&(0,i.i)(s,r)&&1===(null==t?void 0:t.length)&&"Feed"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")}},88780:(e,t,s)=>{s.d(t,{a:()=>a,g:()=>l,i:()=>c,r:()=>n});var i=s(20164),r=s(49853);const n=async(e,t,s={})=>{const{body:n,usePost:a,addTokenManually:l,api:c=(null===r.c||void 0===r.c?void 0:r.c.api),customToken:o}=s,d=new URLSearchParams;n&&Object.entries(n).forEach((([e,t])=>{void 0!==t&&d.append(e,t)}));const h=new URL(e);if(h.searchParams.append("f","json"),o)h.searchParams.append("token",o);else{const e=!1===l?null:await(0,i.h)(t,c);e&&h.searchParams.append("token",e)}const u=await fetch(h.toString(),{body:a?d:void 0,method:a?"POST":"GET"}),m=await u.json(),p=m.error;if(p)throw"string"==typeof p?new Error(p):p;return m},a=async(e,t)=>{var s;try{return{result:await n(e,t,{addTokenManually:!1})}}catch(e){const t="token required";return(null===(s=null==e?void 0:e.message)||void 0===s?void 0:s.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function l(e,t,{relationshipType:s,direction:r}){const n=`${(0,i.g)(t)}content/items/${e}/relatedItems`;return await(0,i.r)(n,{relationshipType:s,direction:r})}const c=(e,t)=>"Feature Service"===t&&e.includes("Hosted Service")}}]);