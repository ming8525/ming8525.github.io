"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-adedff"],{53248:(e,t,r)=>{r.d(t,{A:()=>o,G:()=>u,J:()=>i,M:()=>s,P:()=>c,U:()=>n,a:()=>l,d:()=>a});const n={IDLE:"idle",VALID:"valid",INVALID:"invalid"},i={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},s={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},a={name:"Raster",isDataset:!0,isPublic:!1,type:i.RASTER_FUNCTION_VARIABLE},o={RFX_DTEX_COMMON_SELECT:"RFX-DTEX-COMMON-SELECT",RFX_DTE_COMMON_CHECKBOX:"CALCITE-CHECKBOX",RFX_DTE_COMMON_TEXTINPUT:"CALCITE-INPUT-TEXT",RFX_DTE_COMMON_NUMBERINPUT:"CALCITE-INPUT-NUMBER",RFX_DTE_RASTER_INPUT:"RFX-DTE-RASTER-INPUT",RFX_DTE_FEATURE_SELECT:"RFX-DTE-FEATURE-SELECT",RFX_DTEX_RASTER_VARIABLES_LIST:"RFX-DTEX-RASTER-VARIABLES-LIST",RFX_CTE_RANGED_VALUE_EDITOR:"RFX-CTE-RANGED-VALUE-EDITOR",RFX_CTE_GAMMA_EDITOR:"RFX-CTE-GAMMA-EDITOR",RFX_DTE_COLOR_RAMP_SELECTOR:"RFX-DTE-COLOR-RAMP-SELECTOR",RFX_DTE_EXTENT:"RFX-DTE-EXTENT",RFX_DTE_JSON_FILE_UPLOADER:"RFX-DTE-JSON-FILE-UPLOADER",RFX_CTE_FACTOR_FUNCTION_EDITOR:"RFX-CTE-FACTOR-FUNCTION-EDITOR",RFX_CTE_NEIGHBORHOOD_VALUES:"RFX-CTE-NEIGHBORHOOD-VALUES"},l={ANALYSIS:"analysis",EDITOR:"editor"},u={textInput:"text-input",text:"text",raster:"raster-input",number:"number-input",boolean:"check-box",switch:"switch",field:"field-select",color:"color-input",select:"select",icon:"icon"},c={loading:"loading",success:"success",error:"error"}},5660:(e,t,r)=>{r.d(t,{a:()=>F,b:()=>I,c:()=>O,d:()=>b,e:()=>x,f:()=>k,g:()=>S,h:()=>L,i:()=>w,j:()=>D,k:()=>U,l:()=>X,n:()=>M,o:()=>P});var n=r(46574),i=r(34319),s=r(46717),a=r(55139),o=r(57098),l=(r(78979),r(95876)),u=r(77162),c=r(53248),p=r(32804),f=r(48363),d=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h=/^\w*$/;function g(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var a=e.apply(this,n);return r.cache=s.set(i,a)||s,a};return r.cache=new(g.Cache||p.M),r}g.Cache=p.M;var A,m,y,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,E=/\\(\\)?/g,R=(A=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(T,(function(e,r,n,i){t.push(n?i.replace(E,"$1"):r||e)})),t},m=g(A,(function(e){return 500===y.size&&y.clear(),e})),y=m.cache,m);var v=1/0;function C(e){if("string"==typeof e||(0,l.c)(e))return e;var t=e+"";return"0"==t&&1/e==-v?"-0":t}function _(e,t,r){return null==e?e:function(e,t,r,n){if(!(0,f.j)(e))return e;for(var i=-1,s=(t=function(e,t){return(0,f.a)(e)?e:function(e,t){if((0,f.a)(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!(0,l.c)(e))||h.test(e)||!d.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:R((0,l.d)(e))}(t,e)).length,a=s-1,o=e;null!=o&&++i<s;){var u=C(t[i]),c=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(i!=a){var g=o[u];void 0===(c=void 0)&&(c=(0,f.j)(g)?g:(0,p.i)(t[i+1])?[]:{})}(0,p.a)(o,u,c),o=o[u]}return e}(e,t,r)}function O(e){return i.clone(e)}function F(){return i.clone(c.d)}function N(e){return s.urlToObject(e).path}function S(e){return e?.indexOf("?token=")>0&&(e=e.slice(0,e.indexOf("?token="))),e}function I(e){let t=S(e?.url);"feature"===e.type&&(t=`${t}/${e.layerId??0}`);const r=n.default.findCredential(e.url);return void 0!==r&&(t=`${t}?token=${r.token}`),t}function b(e){const t={url:I(e),name:e.title};if((0,u.i)(e.renderingRule)||(t.renderingRule=e.renderingRule.toJSON()),(0,u.i)(e.definitionExpression))(0,u.i)(e.mosaicRule)||(t.mosaicRule=e.mosaicRule.toJSON?.());else{let r=e.mosaicRule;(0,u.i)(r)||(r=r.clone(),r.where=e.definitionExpression,t.mosaicRule=r.toJSON())}return t}function x(e,t){if((0,u.i)(e?.url)||(0,u.i)(t))return;const r=N(e.url),n=t.find((e=>e.url===r))?.id;return n}async function k(e){if((0,u.i)(e?.url))return;const t=i.clone(e);let r;t.name||(t.name=function(e){const t=e.split("/");return t[t.length-2]}(t.url));try{r=await a.default.fromArcGISServerUrl({url:N(e.url),properties:{renderingRule:e.renderingRule,mosaicRule:e.mosaicRule}}),r.name=e.name}catch(e){}return r}async function L(e){const t=e?.url,r=e?.name;if((0,u.i)(t))return;let n;try{n=await a.default.fromArcGISServerUrl({url:N(t)}),n.name=r}catch(e){console.error("Failed to load feature layer from RFT JSON.")}return n}function w(e){return e?.toLocaleLowerCase().indexOf("f")>=0}function D(e){const t=e&&(e.extent||e.fullExtent);if((0,u.i)(t))return;const{xmin:r,ymin:n,xmax:i,ymax:s,spatialReference:a}=t,{wkid:o,latestWkid:l,wkt:c}=a,p={xmin:r,ymin:n,xmax:i,ymax:s};return(0,u.i)(o)||_(p,"spatialReference.wkid",o),(0,u.i)(l)||_(p,"spatialReference.latestWkid",l),(0,u.i)(c)||_(p,"spatialReference.wkt",c),p}async function U(e){if((0,u.i)(e))return Promise.resolve(void 0);const t=await e.queryFeatures({returnGeometry:!0,where:"1 = 1"});if((0,u.i)(t))return Promise.resolve(void 0);const r=t.features?.map((e=>e?.geometry));return r}function X(e){const t=e?.rasterInfo?.keyProperties?.ChangeAnalysisParameters,r=t?.AnalysisType;return"CCDC"===r}function M(e){return e.filter((e=>function(e){let t=!0;return!1===e.sourceJSON?.allowAnalysis&&(t=!1),(e.portalItem?.typeKeywords?.includes("Hosted Service")??!1)&&(t=!!e.portalItem.isOrgItem||t),t}(e)))}function P(e,t){const r=JSON.stringify(t);return new o.default({url:e,raster:btoa((0,l.t)(r))})}},89920:(e,t,r)=>{r.d(t,{S:()=>l,a:()=>d,b:()=>h,d:()=>p,e:()=>T,f:()=>R,g:()=>g,h:()=>A,i:()=>u,j:()=>c,k:()=>f,l:()=>E,m:()=>C,n:()=>_,p:()=>v,q:()=>O,r:()=>F,s:()=>m,u:()=>y});var n=r(34319),i=r(36676),s=r(77162),a=r(81279),o=r(53248);const l={List:"list",Unit:"linearUnit",Number:"number",Field:"field"};function u(e){const t=!(0,s.i)(e?.isDataset),r=e?.type===s.R;return t&&r}function c(e,t){if((0,s.i)(t))return n.clone(e);const r={};if("object"==typeof e&&null!==e&&!Array.isArray(e)){for(const n in e)e.hasOwnProperty(n)&&t.indexOf(n)<0&&(r[n]=c(e[n],t));return r}return Array.isArray(e)?e.map((e=>c(e,t))):n.clone(e)}function p(e,t){if((0,s.i)(e)||(0,s.i)(t))return;const r=Object.keys(t).find((t=>t.toLowerCase()===e.toLowerCase()));return r?t[r]:void 0}function f(e,t){if(!e)return"";const r=Object.keys(e);return void 0===t&&1===r.length?r[0]:r.find((e=>e.toLowerCase()===t?.toLowerCase()))??""}async function d(e){const t=e?.function?.type?.toLowerCase()?.replace("function",""),r=e?.arguments,n=i.h.rfxNameSpecialCases,a=i.h.localFunctionOperations,o=await(0,i.g)();switch(t){case"local":const e=r?.Operation?.value,i=a.find((t=>t.key===e));if(!(0,s.i)(i))return i.label;if(o.cellStatisticsTypes.some((t=>t.key===e)))return"CellStatistics";break;case"pythonadapter":{const e=r?.ClassName?.value;return e||null}case"gpadapter":{const e=r?.ToolName?.value?.toLowerCase()?.replace("_sa",""),t=n.find((t=>t.key===e));return t?.value||e||null}default:{const e=n.find((e=>e.key===t));return e?.value||t||null}}return null}function h(e){if(e)return e.type===s.b?e:e.value&&e.value.type===s.b?e.value:void 0}function g({schema:e,rfxTemplate:t}){if((0,s.i)(t?.function?.type))return;const r=t.function.type,n=t?.arguments;let i=(0,a.e)(n);return(!i||!e.hasOwnProperty(i)&&e.hasOwnProperty(r))&&(i=r),e[i]}function A(e){if(!e||!e.value)return!1;const t=(e.value.elements?e.value.elements:e.value)[0];return t&&(t.isDataset||t.type===s.b)}function m(e){if(!e||!e[s.A])return!1;if(e.aliases)return!0;const t=e=>{if(!e)return!1;if(e.isPublic)return!0;if(A(e)){const r=e.value&&e.value.elements?e.value.elements:e.value;if(r&&Array.isArray(r))return r.some((e=>t(e)))}const r=h(e);return!!r&&m(r)},r=e[s.A];return(0,s.a)(r)?t(r):Object.keys(r).some((e=>{const n=r[e];if((0,s.a)(n))return t(n)}))}function y(e){if(!e)return!1;const t=e.dataType===i.d.rasterArray,r=Boolean(e.elementInfos),n=e.dataType===i.d.table;return t&&r||n}function T(e,t){return Array.isArray(e)&&e.some((e=>e.toLowerCase()===t.toLowerCase()))}function E(e){if(!e||!e.value)return!1;const t=e.value.elements?e.value.elements:e.value;return!!Array.isArray(t)&&t.some((function(e){return e&&e.type===s.b}))}function R(e){return e?.forEach((e=>{e.key=e.key.toString()})),e}function v(e,t){return e.forEach((e=>{if("field"===e.type){const r=p(e.argumentName,t);e.argumentName=r.name,e.layerArgument=r}else e.type!==i.a.list&&e.type!==i.a.linearUnit||(e.enumStore=R[e.enum])})),e}function C(e,t){let r;const n=p(e.nElementsArgument,t),i=n?.value,s=e.elementInfos;return void 0!==n&&void 0!==i||1!==s.length?(Array.isArray(s)&&s.some((e=>{const t=e.values;if(Array.isArray(t)&&t.indexOf(i)>-1)return r=e.inputArgs,!0})),r):s[0].inputArgs}function _(e){let t=!1;const r=e[s.A];if((0,s.a)(r))return!0;for(const e in r)if(e!==s.T&&(n=r[e])&&(h(n)||E(n)))return t=!0,t;var n;return t}function O({functionSchema:e,rfxTemplate:t}){if(!t)return;const r=[],i=t.arguments,a=i&&i.type;if(function({functionSchema:e,rfxTemplate:t}){const r=e;let n;if(r&&(n=r.rasterFunctionArguments,1===Object.keys(n).length&&!r.hasArgumentsObject))return!0;const i=t.arguments,s=i&&i.type;return!(!s||s!==o.J.RASTER_FUNCTION_TEMPLATE&&s!==o.J.RASTER_FUNCTION_VARIABLE)||void 0}({functionSchema:e,rfxTemplate:t})){const e=n.clone(i);let t;return t=a===o.J.RASTER_FUNCTION_TEMPLATE||e.isDataset?"Raster":"Rasters",r.push({...e,key:t}),r}return Object.keys(i).forEach((e=>{if(e===o.M.MATCH_VARIABLE||e===o.M.UNION_DIMENSION)return;const t=n.clone(i[e]);(0,s.a)(t)&&r.push({...t,key:e})})),r}function F(e,t){const r=t&&t.value;if(null==r)return;let n;return e.some((e=>{if(e.values&&e.values.indexOf(r)>-1)return n=e.inputArgs,!0})),n}},48945:(e,t,r)=>{r.r(t),r.d(t,{rfx_cte_filtered_argument_editor:()=>f});var n=r(19451),i=r(81279),s=r(64729),a=r(77162),o=r(89920),l=r(5660);r(99248),r(16888),r(95323),r(43278),r(86944),r(83345),r(74656);const u="inputArgHelpClickHandler",c="pixelType",p="value",f=class{constructor(e){(0,n.r)(this,e),this.rfxArgumentChange=(0,n.c)(this,"rfxArgumentChange",7),this.pixelTypeFilters={},this.valueFilters={},this.helpActionClickEventHandlers=new Map,this.handleInputChange=e=>{e.stopPropagation();const t=e.target,r="number"===this.storeType?Number(t.value):t.value;this.inputArg.value=r,this.value=r,this.rfxArgumentChange.emit({value:r})},this.value=void 0,this.widgetArgs=void 0,this.store=[]}connectedCallback(){this.processWidgetArgs(this.widgetArgs),this.initializeTriggerAttributes(this.widgetArgs)}componentWillLoad(){this.setInitialState()}async componentDidLoad(){await this.applyTriggerAttributeFilters(this.widgetArgs),this.attachTriggerArgsChangeListener(this.widgetArgs),this.attachHelpClickEventHandlers()}processWidgetArgs({inputArgs:e}){Object.keys(e).forEach((t=>{const r=e[t];this.inputArg=r,r.input=this.hostElement}))}attachTriggerArgsChangeListener({triggerArgs:e}){Object.keys(e).forEach((t=>{const r=e[t].input;r?r.addEventListener("rfxArgumentChange",(()=>{this.applyTriggerAttributeFilters({triggerArgs:e})})):console.error(`input not set on ${e[t].displayName}`)}))}attachHelpClickEventHandlers(){const e=this.widgetArgs.onHelpActionClick({heading:this.inputArg.displayName,referenceElement:this.widgetContainer,helpTextID:this.inputArg?.helpTextID});this.helpActionClickEventHandlers.set(u,e)}initializeTriggerAttributes({triggerAttributes:e}){const t=e.trim().split(";");for(const e of t){const[t,r]=e.trim().split(":"),n=r.trim().split(","),i={dependFieldName:n[0],dependFieldValue:n[1].trim().split("|"),filteredValue:n[2].trim().split("|"),isApplied:!1};({[c]:()=>this.pixelTypeFilters[i.dependFieldName]=i,[p]:()=>this.valueFilters[i.dependFieldName]=i})[t]()}}async applyPixelTypeFilters({triggerArg:e,inputWidget:t,triggerArgValue:r}){const n=this.pixelTypeFilters[e];if(n.isApplied=!1,!r)return n.isApplied;const i=await(t?.getSelectedLayer?.());await i.load();const s=i.pixelType??i.rasterInfo?.pixelType;return(0,l.i)(s)?(n.isApplied=!0,n.isApplied):n.isApplied}async applyValueTypeFilter({triggerArg:e,triggerArgValue:t}){const r=this.valueFilters[e];return r.isApplied=!1,r.dependFieldValue.includes(t.toString())?(r.isApplied=!0,Promise.resolve(r.isApplied)):Promise.resolve(r.isApplied)}async applyTriggerAttributeFilters({triggerArgs:e}){let t,r=!1;const n={[c]:this.applyPixelTypeFilters.bind(this),[p]:this.applyValueTypeFilter.bind(this)};for(const i of Object.keys(e)){const s=e[i].input,o=e[i].value??s?s.value:void 0;if(!0===(0,a.i)(o))continue;let l,u;if(this.pixelTypeFilters.hasOwnProperty(i))u=this.pixelTypeFilters[i],l=c;else{if(!this.valueFilters.hasOwnProperty(i))return void console.error("Trigger Arg is not part of triggerAttributes! check schema.");u=this.valueFilters[i],l=p}l in n?!0===await n[l]({inputWidget:s,triggerArg:i,triggerArgValue:o})&&(r=!0,t=u.filteredValue):console.error("invalid triggerAttributes! check schema.")}!0===r?this.applyFilterToStore(t):this.resetStore();const i=String(this.value);if(!0!==this.store.some((e=>e.key===i))){const e="number"===this.storeType?Number(this.store[0]?.key):this.store[0]?.key;this.value=e}}applyFilterToStore(e){const t=((e,t)=>e.filter((e=>t.some((t=>e.key===t)))))(this.initialStore,e);this.store=t}resetStore(){this.store=this.initialStore}setInitialState(){const{rfxArgs:e,rasterFunctions:t}=this.widgetArgs,r=t[(0,i.e)(e)],n=r?.rasterFunctionArguments,s=this.inputArg.name;this.value=this.inputArg.value;const l=n?.[s]?.domain;if("list"===l?.type){const e=l.enum;this.store=(0,o.j)(e)}else console.error("Invalid inputArg! Check Schema");this.storeType=typeof this.store?.[0]?.key,this.store?.forEach((e=>{e.key=e.key.toString()})),this.initialStore=(0,o.j)(this.store),(0,a.i)(this.store)&&console.error("Domain list Enum not set! Check Schema")}render(){return(0,n.h)("div",null,(0,n.h)("calcite-label",{alignment:"start",scale:s.U.Scale,layout:"default",ref:e=>{this.widgetContainer=e}},(0,n.h)("rfx-label",{label:this.inputArg.displayName,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(u)()}),(0,n.h)("rfx-dtex-common-select",{options:this.store,value:String(this.value),onRfxArgumentChange:this.handleInputChange})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,n.a)(this)}};r(34319),r(36676),r(48302),r(48363),r(53248),r(46574),r(46717),r(55139),r(57098),r(78979),r(95876),r(32804)},64729:(e,t,r)=>{r.d(t,{C:()=>i,U:()=>n,a:()=>s});const n={Scale:"s",PopoverTimer:60},i={s:"s",m:"m"},s={absolute:"absolute",fixed:"fixed"}}}]);