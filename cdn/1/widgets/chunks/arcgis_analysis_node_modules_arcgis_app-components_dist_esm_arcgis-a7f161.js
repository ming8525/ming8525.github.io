"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a7f161"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addItemState),
/* harmony export */   b: () => (/* binding */ addItemUrlState),
/* harmony export */   c: () => (/* binding */ addItemRequestState),
/* harmony export */   d: () => (/* binding */ addItemStore)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const addItemStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    typeKeywords: [],
    customParameters: [],
    analyzedLocationTypes: [],
    allowStoredAuth: true,
    isSecured: null,
    checkAuth: false
});
// Entire add item state object
const addItemState = addItemStore.state;
// Subsets of add item state
const addItemRequestState = addItemStore.state;
const addItemUrlState = addItemStore.state;



//# sourceMappingURL=add-item-dbbe2f57.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-csv-location-fields.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-csv-location-fields.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_csv_location_fields: () => (/* binding */ ArcgisNewItemPagesCsvLocationFields)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./analyze-69ec08c8.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/analyze-69ec08c8.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./item-types-586f0301.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _basic_6db7ebd7_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./basic-6db7ebd7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/basic-6db7ebd7.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






















const arcgisNewItemPagesCsvLocationFieldsCss = ".wrapper{padding-bottom:2rem}.table{margin-bottom:1.5rem}.row{display:flex;align-items:center;padding-left:0px;padding-right:0px;padding-top:0.5rem;padding-bottom:0.5rem;box-shadow:0px -1px 0px #eaeaea}.row--header{box-shadow:none}.cell{box-sizing:border-box;width:50%;padding:0.5rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.cell--header{font-weight:400}.advanced{margin-top:1rem;margin-bottom:2rem;background-color:var(--calcite-color-foreground-2)}.advanced__toggle{margin:0px;box-sizing:border-box;display:flex;width:100%;cursor:pointer;align-items:center;border-radius:0;border-style:none;padding:1.25rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-2);background-color:transparent;transition:all 150ms ease-in-out;outline-offset:0px;outline-color:transparent;font-family:inherit}.advanced__toggle:focus{outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.advanced__icon{margin-inline-end:1rem;transform:rotate(90deg);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.arcgis--rtl{transform:rotate(-90deg)}.advanced__icon--open{transform:rotate(180deg)}.advanced__content{padding-left:1.25rem;padding-right:1.25rem;padding-top:0.5rem;padding-bottom:0.5rem}.two-up{margin-bottom:0.75rem;display:flex;justify-content:space-between}.column{width:calc(50% - 6px)}.header{margin:0px;margin-bottom:0.5rem;padding:0px;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.description{margin:0px;margin-bottom:1.5rem;padding:0px;font-size:1rem;color:var(--calcite-color-text-3)}.enrich-layer-container{background-color:var(--calcite-color-foreground-1);border:1px solid var(--calcite-color-border-input);padding:15px 15px 0px 15px}.enrich-switch{display:flex;justify-content:space-between}.enrich-title{display:flex;color:var(--calcite-color-text-1)}.enrich-radio-text{color:var(--calcite-color-text-3)}.radio{margin-bottom:0.75rem}.asterisk{color:var(--calcite-color-status-danger)}.notice{margin-top:0.5rem}.loader-overlay{overflow:hidden}.enrich-description{margin-bottom:0.75rem;margin-top:0px}";

const ArcgisNewItemPagesCsvLocationFields = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.newItemDisableCloseButtons = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
        this.userHasAssignedCredits = false;
        this.orgIsRestricted = false;
        this.showTotalCredits = false;
        this.isAppendWorkflow = false;
        // Telemetry: Log changes user made to fields
        this.logCSVLocationFieldsChanges = () => {
            const telemetry = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.telemetry;
            const payload = {
                eventType: "other",
                pageName: "my content",
                category: "new item csv location settings",
                label: this.currentLocationType
            };
            // Handle properties unique to address location type
            if (this.currentLocationType === "address place names") {
                if (this.displayEnrichLayerSettings) {
                    payload.action =
                        this.selectedCandidateFieldsType === "GeometryOnly"
                            ? "enrich with some fields"
                            : "enrich with all fields";
                }
                else {
                    payload.action = "enrich with no fields";
                }
                payload.facetValue =
                    this.selectedLocationFieldSelectionType === "Multiple" ? "multi" : "single line address";
                payload.details =
                    this.initialLocator === _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl
                        ? "default locator"
                        : "locator changed";
                payload.attribute =
                    this.initialRegion === _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry ? "default region" : "region changed";
            }
            telemetry === null || telemetry === void 0 ? void 0 : telemetry.logEvent(payload);
        };
        this.selectedLocationType = "none";
        this.advancedExpanded = false;
        this.selectedCandidateFieldsType = "GeometryOnly";
        this.displayEnrichLayerSettings = false;
        this.selectedLocationFieldSelectionType = "Single";
        this.error = undefined;
        this.i18n = undefined;
    }
    async handleNext() {
        var _a;
        if ((this.orgIsRestricted || this.userHasAssignedCredits) && this.hasInsufficientCredits()) {
            this.error = this.i18n.errors.insufficientCredits;
            (_a = this.estimate) === null || _a === void 0 ? void 0 : _a.scrollIntoView();
            return;
        }
        const error = this.validateFields();
        if (error) {
            this.error = error;
        }
        else {
            this.error = null;
            if (this.isAppendWorkflow &&
                (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "add" ||
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "upsert")) {
                if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType === "none" &&
                    _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceDataLayer.geometryType === "esriGeometryPoint") {
                    this.error = this.i18n.errors.noLocationTypeForAppend;
                    return;
                }
            }
            const analyzeResults = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults;
            const publishParameters = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__.e)(this.selectedLocationFieldSelectionType, this.isAppendWorkflow);
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults = Object.assign(Object.assign({}, analyzeResults), { publishParameters });
            if (this.isAppendWorkflow) {
                const { name } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer;
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer = publishParameters; //update dataLayer for append
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.dataLayer.name = name;
            }
            this.logCSVLocationFieldsChanges();
            let nextPage = "itemProperties";
            if (this.isAddToMapTerminalPage()) {
                this.workflowComplete.emit({
                    type: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.type,
                    url: encodeURI(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.url),
                    customParameters: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.customParameters,
                    results: {
                        analyzeResults: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.analyzeResults,
                        fields: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields
                    }
                });
            }
            else {
                if (this.isAppendWorkflow) {
                    if (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.addAppendSelectOption === "add" &&
                        (!_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields.some((field) => field.type === "esriFieldTypeDate") ||
                            this.isEnterprise)) {
                        nextPage = "appendMatchFields";
                    }
                    else {
                        nextPage = "appendKeyPairSelect";
                    }
                }
                this.newItemUpdatePage.emit(nextPage);
            }
        }
    }
    hasInsufficientCredits() {
        return (this.selectedLocationType === "address" &&
            (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__.i)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl) &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost.transactionCreditCost > _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeCost.availableCredits);
    }
    showUnrestrictedOrgCreditsNotice() {
        return !(this.orgIsRestricted || this.userHasAssignedCredits) && this.hasInsufficientCredits();
    }
    isAddToMapTerminalPage() {
        return (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "map" &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.newItemMode === "url" &&
            !_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.enablePublishing);
    }
    async analyze() {
        var _a;
        const { file, url, existingItem, id: itemid, cloudProviderResource, type } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const { portal, user, config, lang } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        return (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_3__.a)({
            analyzeArgs: (!!existingItem || !!cloudProviderResource || (0,_item_types_586f0301_js__WEBPACK_IMPORTED_MODULE_7__.a)((_a = file === null || file === void 0 ? void 0 : file.size) !== null && _a !== void 0 ? _a : 0)) && !!itemid
                ? { type: "item", itemid }
                : file
                    ? { type: "file", file }
                    : { type: "url", sourceUrl: url },
            itemArgs: { itemType: type },
            configArgs: { portal, user, config, lang }
        });
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e, _f;
        const { analyzeResults, type, selectedSheet, standardizedFieldNames, enablePublishing, cloudProviderResource, geocodeServiceUrl } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const { portal, user, config, lang } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        const info = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__.a)();
        this.isAppendWorkflow = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "append";
        this.subscriptionInfo = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo;
        this.isEnterprise = portal.isPortal;
        const appendInEnterprise = this.isAppendWorkflow && config.self.isPortal;
        const userAssignedCredits = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.api === 4 ? (_a = user.sourceJSON) === null || _a === void 0 ? void 0 : _a.assignedCredits : user.assignedCredits;
        this.userHasAssignedCredits = userAssignedCredits > 0;
        this.orgIsRestricted = ((_b = this.subscriptionInfo) === null || _b === void 0 ? void 0 : _b.state) === "restricted";
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n.csvLocationFields;
        if (this.isAddToMapTerminalPage()) {
            _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.nextText = "addToMap";
        }
        let types = appendInEnterprise
            ? ["coordinates", "none"]
            : ["coordinates", "address", "none", "mgrs", "usng"];
        const showAddress = (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_8__.m)(user) &&
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServers &&
            (_ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow !== "map" || enablePublishing);
        const isDev = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.i)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo);
        this.showTotalCredits = (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_8__.o)(user, portal);
        const { selectedLocationFieldSelectionType } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        this.selectedLocationFieldSelectionType = selectedLocationFieldSelectionType !== null && selectedLocationFieldSelectionType !== void 0 ? selectedLocationFieldSelectionType : "Single";
        const isAddDirectToMap = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.workflow === "map" && !enablePublishing;
        this.locationTypes = types
            .map((key) => ({
            optionTitle: this.i18n.locationTypes[key].title,
            description: isDev && key === "address"
                ? this.i18n.locationTypes.address.descriptionDeveloper
                : this.i18n.locationTypes[key].description.replace("${type}", (cloudProviderResource === null || cloudProviderResource === void 0 ? void 0 : cloudProviderResource.cloudFileType) === "googlesheets" ? "Google Sheet" : type),
            value: key,
            badge: key === "address" && !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal && !isDev
                ? { label: this.i18n.consumesCredits, icon: "credits" }
                : null,
            icon: key === "none" ? "table" : "layer-points"
        }))
            .filter(({ value }) => 
        // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2605
        (value !== "address" || showAddress) &&
            // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2766
            (value === "coordinates" || !isAddDirectToMap));
        // on first load, if coordinates are detected, use those instead of addresses
        const publishParameters = analyzeResults === null || analyzeResults === void 0 ? void 0 : analyzeResults.publishParameters;
        if (publishParameters) {
            const isExcel = type === "Microsoft Excel";
            const params = isExcel
                ? (_d = (_c = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _c === void 0 ? void 0 : _c[selectedSheet]) !== null && _d !== void 0 ? _d : (_e = publishParameters === null || publishParameters === void 0 ? void 0 : publishParameters.layers) === null || _e === void 0 ? void 0 : _e[0]
                : analyzeResults === null || analyzeResults === void 0 ? void 0 : analyzeResults.publishParameters;
            if (params.latitudeFieldName || params.longitudeFieldName) {
                this.selectedLocationType = "coordinates";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
            }
            if (publishParameters.locationType === "coordinates" &&
                publishParameters.coordinateFieldType) {
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
                switch (publishParameters.coordinateFieldType) {
                    case "MGRS":
                        this.selectedLocationType = "mgrs";
                        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "MGRS";
                        break;
                    case "USNG":
                        this.selectedLocationType = "usng";
                        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "USNG";
                        break;
                    default:
                        this.selectedLocationType = "coordinates";
                        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
                        break;
                }
            }
            else if (params.locationType === "address" && showAddress) {
                this.selectedLocationType = "address";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
            }
            (_f = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType) !== null && _f !== void 0 ? _f : (_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "none");
        }
        if (this.locationTypes.length === 1) {
            const locationType = this.locationTypes[0].value;
            this.selectedLocationType = locationType;
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType =
                locationType === "mgrs" || locationType === "usng" ? "coordinates" : locationType;
        }
        // if user can't geocode, and we're on address, swap to coordinates
        if (!showAddress && this.selectedLocationType === "address") {
            this.selectedLocationType = "coordinates";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        }
        // update analyze to use address if we have no address fields on first load
        if (this.selectedLocationType === "address" && !info.addressFields) {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
        }
        // if on first load the field names have not been set
        if (!standardizedFieldNames) {
            await (0,_analyze_69ec08c8_js__WEBPACK_IMPORTED_MODULE_3__.s)({
                geocodeServiceUrl,
                // ! We set the location type above so we can't just use the destructed value
                // TODO: refactor that into a local variable
                locationType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType,
                lang
            });
        }
        if (appendInEnterprise) {
            this.selectedLocationType = "coordinates";
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
        }
        // Telemetry: Capture initial values to compare against
        this.initialLocator = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl;
        this.initialRegion = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry;
        this.setLocationTypeTelemetry(this.selectedLocationType);
    }
    validateFields() {
        const { standardizedFieldNames, selectedFields, backupLayerFields } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const fields = !this.isAppendWorkflow ? Object.values(selectedFields) : backupLayerFields;
        const noFieldSelected = !fields.find(({ locationType }) => {
            const matchesLocationType = (locationType === null || locationType === void 0 ? void 0 : locationType.toLowerCase()) === this.selectedLocationType.toLowerCase();
            const matchesStandardizedField = !!(standardizedFieldNames === null || standardizedFieldNames === void 0 ? void 0 : standardizedFieldNames[locationType]);
            return matchesLocationType || matchesStandardizedField;
        });
        switch (this.selectedLocationType) {
            case "usng":
            case "mgrs":
                // check if at least one field has location type usng
                if (noFieldSelected) {
                    return this.i18n.errors.noFieldSelected;
                }
                break;
            case "address":
                if (this.selectedLocationFieldSelectionType === "Single" && noFieldSelected) {
                    return this.i18n.errors.noFieldSelected;
                }
                else if (this.selectedLocationFieldSelectionType === "Multiple") {
                    const hasLocationField = fields.find((field) => field.locationType && field.locationType !== "unknown");
                    if (!hasLocationField) {
                        return this.i18n.errors.noFieldSelected;
                    }
                }
                break;
            case "coordinates":
                // check if latitude _and_ longitude are selected;
                const matching = fields.filter(({ locationType }) => locationType === "latitude" || locationType === "longitude");
                if (matching.length < 2) {
                    return this.i18n.errors.coordinate;
                }
                break;
        }
        return;
    }
    async updateLocationType(type, reanalyze) {
        this.selectedLocationType = type;
        if (type === "none") {
            _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "none";
            this.currentLocationType = "none";
            return;
        }
        switch (type) {
            case "mgrs":
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "MGRS";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
                break;
            case "coordinates":
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "LatitudeAndLongitude";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
                break;
            case "usng":
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.coordinateFieldType = "USNG";
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "coordinates";
                break;
            case "address":
                _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.locationType = "address";
                break;
        }
        if (reanalyze) {
            await this.analyze();
        }
        this.setLocationTypeTelemetry(type);
    }
    // Telemetry: Map location type to teletry label
    setLocationTypeTelemetry(type) {
        switch (type) {
            case "mgrs":
                this.currentLocationType = "mgrs coordinates";
                break;
            case "coordinates":
                this.currentLocationType = "lat lon";
                break;
            case "usng":
                this.currentLocationType = "usng coordinates";
                break;
            case "address":
                this.currentLocationType = "address place names";
                break;
            case "none":
                this.currentLocationType = "none";
                break;
        }
    }
    async updateGeocodeServer(url) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.geocodeServiceUrl = url;
        // TODO: update addItemState.isAgoWorldGeocodeServer here (https://devtopia.esri.com/WebGIS/arcgis-app-components/pull/1657)
        await this.analyze();
    }
    async updateRegion(region) {
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.sourceCountry = region;
        await this.analyze();
    }
    handleEnrichLayerSwitchChange(event) {
        const checked = event.target.checked;
        this.displayEnrichLayerSettings = checked;
        this.updateCandidateFields(checked ? "Minimal" : "GeometryOnly");
    }
    updateCandidateFields(value) {
        this.selectedCandidateFieldsType = value;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.candidateFieldsType = value;
    }
    renderLocationFields() {
        const { standardizedFieldNames } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const locationRows = {
            address: standardizedFieldNames,
            coordinates: { latitude: this.i18n.latitude, longitude: this.i18n.longitude },
            mgrs: { mgrs: "MGRS" },
            usng: { usng: "USNG" }
        };
        const rows = locationRows[this.selectedLocationType];
        if (this.selectedLocationFieldSelectionType === "Single" &&
            this.selectedLocationType === "address" &&
            rows) {
            const key = Object.keys(rows)[0];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, rows[key]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, this.renderFieldSelect(key, rows[key]))));
        }
        else {
            return (rows &&
                Object.keys(rows).map((key) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, rows[key]), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "cell", role: "cell" }, this.renderFieldSelect(key, rows[key]))))));
        }
    }
    updateFieldLocationType(fieldName, addressKey) {
        const fields = !this.isAppendWorkflow
            ? Object.values(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields)
            : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields;
        fields.forEach((field) => {
            if (field.name === fieldName) {
                field.locationType = addressKey;
            }
            else if (field.locationType === addressKey) {
                field.locationType = "unknown";
            }
        });
    }
    handleLocationFieldSelectionChange(newType) {
        this.selectedLocationFieldSelectionType = newType;
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedLocationFieldSelectionType = newType;
    }
    renderFieldSelect(addressKey, label) {
        const selectedFields = !this.isAppendWorkflow
            ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.selectedFields
            : _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a.backupLayerFields;
        const fields = Object.keys(selectedFields).map((key) => selectedFields[key]);
        const useDefault = !fields.some((field) => {
            return field.locationType === addressKey;
        });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: label, role: "cell", onCalciteSelectChange: (e) => this.updateFieldLocationType(e.currentTarget.selectedOption.value, addressKey) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: "unknown", selected: useDefault }, this.i18n.unknown), fields.map((field) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: field.name, selected: field.locationType === addressKey }, field.alias || field.name)))));
    }
    render() {
        var _a, _b, _c, _d, _e;
        const { geocodeServiceUrl, geocodeServers, geocodeCost, sourceCountry, countryCodes } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_4__.a;
        const { config } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
        const recordCount = (_b = (_a = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__.a)()) === null || _a === void 0 ? void 0 : _a.estimatedRecordCount) !== null && _b !== void 0 ? _b : 0;
        const { helpMap, helpBase } = config;
        const dir = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "wrapper" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-select", { class: "label--top", selectedOption: this.selectedLocationType, options: this.locationTypes, label: this.i18n.locationSettings, labelDescription: this.i18n.locationSettingsDescription, onArcgisOptionChange: (e) => this.updateLocationType(e.detail, true) }), this.selectedLocationType !== "none" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, this.selectedLocationType === "address" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "advanced" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { class: "advanced__toggle", "aria-expanded": this.advancedExpanded.toString(), "aria-controls": "advanced__content", onClick: () => (this.advancedExpanded = !this.advancedExpanded) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "chevron-up", scale: "s", class: {
                advanced__icon: true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_2__.C.rtl]: dir === "rtl",
                "advanced__icon--open": this.advancedExpanded
            } }), this.i18n.advancedSettings), this.advancedExpanded && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "advanced__content", id: "advanced__content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "two-up" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "column" }, this.i18n.locator, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: (e) => this.updateGeocodeServer(e.currentTarget.selectedOption.value) }, geocodeServers === null || geocodeServers === void 0 ? void 0 : geocodeServers.map((server) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: server.url, selected: server.url === geocodeServiceUrl }, server.name))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "column" }, this.i18n.region, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "", onCalciteSelectChange: (e) => this.updateRegion(e.currentTarget.selectedOption.value) }, countryCodes === null || countryCodes === void 0 ? void 0 : countryCodes.map((country) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: country.value, selected: country.value.toLowerCase() === sourceCountry.toLowerCase() }, this.i18n.countryCodes[country.value.toUpperCase()] || country.label)))))), !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal && !this.isAppendWorkflow && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "enrich-layer-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "enrich-title" }, this.i18n.enrich, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { label: (_c = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_5__.u.i18n) === null || _c === void 0 ? void 0 : _c.moreInfo, placement: "top-start", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "enrich-description" }, this.i18n.enrichLayerDescription), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", {
            /*@ts-ignore*/
            target: "_blank", href: `${helpBase}${helpMap["120002541"]}`
        }, this.i18n.enrichLayerLink))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { checked: this.displayEnrichLayerSettings, onCalciteSwitchChange: this.handleEnrichLayerSwitchChange.bind(this) })), this.displayEnrichLayerSettings ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { layout: "vertical", name: "enrich-group", onCalciteRadioButtonGroupChange: (event) => this.updateCandidateFields(event.target.selectedItem.value) }, ["Minimal", "AllFields"].map((type) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", key: type }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.selectedCandidateFieldsType === type, value: type }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "enrich-radio-text" }, this.i18n.candidateFieldsTypes[type].description)))))) : null)))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "header" }, this.i18n.locationFields, " ", (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "asterisk" }, "*")), this.selectedLocationType === "address" ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button-group", { name: "location-field-selection-group", layout: "vertical", onCalciteRadioButtonGroupChange: (event) => this.handleLocationFieldSelectionChange(event.target.selectedItem.value) }, ["Single", "Multiple"].map((type) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline", key: type }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { checked: this.selectedLocationFieldSelectionType === type, value: type }), this.i18n[type === "Single" ? "locationFieldSingle" : "locationFieldMultiple"]))))) : null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "table", class: "table" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row row--header", role: "row" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "cell cell--header", role: "columnheader", "aria-sort": "none" }, this.i18n.locationType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "cell cell--header", role: "columnheader", "aria-sort": "none" }, this.i18n.field)), this.renderLocationFields()))), this.selectedLocationType === "address" &&
            geocodeCost &&
            !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal.isPortal &&
            (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_6__.i)(geocodeServiceUrl) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.i)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.subscriptionInfo) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { scale: "m", width: "full", open: true, icon: "information" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.i18n.recordCount.replace("${num}", `${recordCount}`))))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-credit-estimate", { transactionCreditCost: geocodeCost.transactionCreditCost, availableCredits: geocodeCost.availableCredits, showTotal: this.showTotalCredits, class: "credit-estimate", api: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.api, ref: (el) => (this.estimate = el) })), this.showUnrestrictedOrgCreditsNotice() && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "notice", kind: "brand", icon: "information", open: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.i18n.unrestrictedOrgCredits.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.i18n.unrestrictedOrgCredits.description))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: (_d = this.error) === null || _d === void 0 ? void 0 : _d.title, description: (_e = this.error) === null || _e === void 0 ? void 0 : _e.description, active: !!this.error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesCsvLocationFields.style = arcgisNewItemPagesCsvLocationFieldsCss;



//# sourceMappingURL=arcgis-new-item-pages-csv-location-fields.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-586f0301.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isLargeCSV),
/* harmony export */   f: () => (/* binding */ findPossibleItemTypesByExtension),
/* harmony export */   i: () => (/* binding */ isLargeGeoJSON),
/* harmony export */   m: () => (/* binding */ mapItemTypesToFileExtensions)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function findPossibleItemTypesByExtension(extension, validationTypes) {
    // Search item types extensions for the one imported
    let itemTypes;
    if (validationTypes) {
        itemTypes = validationTypes.map((value) => {
            return value.type;
        });
    }
    else {
        itemTypes = Object.keys(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a);
    }
    let possibleItemTypes = [];
    itemTypes.forEach((type) => {
        var _a;
        if (((_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type].fileExt) === null || _a === void 0 ? void 0 : _a.indexOf(extension)) >= 0) {
            possibleItemTypes.push(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]);
        }
    });
    return possibleItemTypes;
}
function mapItemTypesToFileExtensions(types) {
    if (!types) {
        return null;
    }
    return (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.b)(types.flatMap((type) => { var _a; return (_a = _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_1__.a[type]) === null || _a === void 0 ? void 0 : _a.fileExt; }).filter((valid) => !!valid));
}
const isLargeGeoJSON = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2553#issuecomment-3645404
    return sizeInMB > 50; // 50MB
};
const isLargeCSV = (sizeInBytes) => {
    const sizeInMB = sizeInBytes / 1024 / 1024;
    // https://devtopia.esri.com/WebGIS/arcgis-app-components/issues/2875#issuecomment-3748913
    return sizeInMB > 20; // 20MB
};



//# sourceMappingURL=item-types-586f0301.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js":
/*!********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ uiStore),
/* harmony export */   u: () => (/* binding */ uiStoreState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const uiStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    nextText: "next",
    workflow: "content",
    scale: "m",
    disableScroll: false,
    featureFlags: {}
});
const uiStoreState = uiStore.state;



//# sourceMappingURL=ui-bca7bcd1.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWE3ZjE2MS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VEOztBQUV2RCxxQkFBcUIscURBQVc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdHOztBQUVoRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDaUg7QUFDekQ7QUFDMEI7QUFDRztBQUMxQjtBQUNOO0FBQzBFO0FBQ3BFO0FBQzBCO0FBQ3pCO0FBQy9CO0FBQ007QUFDUjtBQUNFO0FBQ007QUFDTDtBQUNBO0FBQ0g7QUFDTztBQUNBO0FBQ047O0FBRTVCLHlEQUF5RCxvQkFBb0IsT0FBTyxxQkFBcUIsS0FBSyxhQUFhLG1CQUFtQixpQkFBaUIsa0JBQWtCLG1CQUFtQixzQkFBc0IsZ0NBQWdDLGFBQWEsZ0JBQWdCLE1BQU0sc0JBQXNCLFVBQVUsZUFBZSxtQkFBbUIsZ0JBQWdCLGtDQUFrQyxjQUFjLGdCQUFnQixVQUFVLGdCQUFnQixtQkFBbUIsbURBQW1ELGtCQUFrQixXQUFXLHNCQUFzQixhQUFhLFdBQVcsZUFBZSxtQkFBbUIsZ0JBQWdCLGtCQUFrQixnQkFBZ0IsbUJBQW1CLGdCQUFnQixrQ0FBa0MsNkJBQTZCLGlDQUFpQyxtQkFBbUIsMEJBQTBCLG9CQUFvQix3QkFBd0IsNkNBQTZDLG9CQUFvQixnQkFBZ0IsdUJBQXVCLHdCQUF3QiwwQkFBMEIsd0RBQXdELGFBQWEseUJBQXlCLHNCQUFzQix5QkFBeUIsbUJBQW1CLHFCQUFxQixzQkFBc0IsbUJBQW1CLHNCQUFzQixRQUFRLHNCQUFzQixhQUFhLDhCQUE4QixRQUFRLHNCQUFzQixRQUFRLFdBQVcscUJB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsbURBQWlDLFNBQVMsS0FBSztBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0EsNkJBQTZCLDJEQUFXO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULHVFQUF1RSw4QkFBOEIsYUFBYTtBQUNsSDtBQUNBLCtCQUErQiwyREFBVztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxPQUFPO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE9BQU8sTUFBTSxPQUFPO0FBQ2pFO0FBQ0E7QUFDQSx3Q0FBd0MsT0FBTyxNQUFNLE9BQU87QUFDNUQ7O0FBRXlIOztBQUV6SDs7Ozs7Ozs7Ozs7Ozs7OztBQ2hJQTtBQUNBO0FBQ0E7QUFDQTtBQUN1RDs7QUFFdkQsZ0JBQWdCLHFEQUFXO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRTJDOztBQUUzQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FkZC1pdGVtLWRiYmUyZjU3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1uZXctaXRlbS1wYWdlcy1jc3YtbG9jYXRpb24tZmllbGRzLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tMzUzNTU1MmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vaXRlbS10eXBlcy01ODZmMDMwMS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdWktYmNhN2JjZDEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IGFkZEl0ZW1TdG9yZSA9IGNyZWF0ZVN0b3JlKHtcbiAgICB0eXBlS2V5d29yZHM6IFtdLFxuICAgIGN1c3RvbVBhcmFtZXRlcnM6IFtdLFxuICAgIGFuYWx5emVkTG9jYXRpb25UeXBlczogW10sXG4gICAgYWxsb3dTdG9yZWRBdXRoOiB0cnVlLFxuICAgIGlzU2VjdXJlZDogbnVsbCxcbiAgICBjaGVja0F1dGg6IGZhbHNlXG59KTtcbi8vIEVudGlyZSBhZGQgaXRlbSBzdGF0ZSBvYmplY3RcbmNvbnN0IGFkZEl0ZW1TdGF0ZSA9IGFkZEl0ZW1TdG9yZS5zdGF0ZTtcbi8vIFN1YnNldHMgb2YgYWRkIGl0ZW0gc3RhdGVcbmNvbnN0IGFkZEl0ZW1SZXF1ZXN0U3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5jb25zdCBhZGRJdGVtVXJsU3RhdGUgPSBhZGRJdGVtU3RvcmUuc3RhdGU7XG5cbmV4cG9ydCB7IGFkZEl0ZW1TdGF0ZSBhcyBhLCBhZGRJdGVtVXJsU3RhdGUgYXMgYiwgYWRkSXRlbVJlcXVlc3RTdGF0ZSBhcyBjLCBhZGRJdGVtU3RvcmUgYXMgZCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZGQtaXRlbS1kYmJlMmY1Ny5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRFbGVtZW50RGlyLCBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBhbmFseXplLCBzIGFzIHNldFN0YW5kYXJkaXplZEZpZWxkTmFtZXMgfSBmcm9tICcuL2FuYWx5emUtNjllYzA4YzguanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1iY2E3YmNkMS5qcyc7XG5pbXBvcnQgeyBlIGFzIGdldExvY2F0aW9uUHVibGlzaFBhcmFtZXRlcnMsIGkgYXMgaXNFc3JpV29ybGRHZW9jb2RlciwgYSBhcyBnZXRBbmFseXplZExheWVySW5mbyB9IGZyb20gJy4vZ2VvY29kZS02NGUwYjBkMy5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzTGFyZ2VDU1YgfSBmcm9tICcuL2l0ZW0tdHlwZXMtNTg2ZjAzMDEuanMnO1xuaW1wb3J0IHsgbSBhcyBjYW5HZW9jb2RlLCBvIGFzIGNhblNob3dUb3RhbENyZWRpdHMgfSBmcm9tICcuL3ByaXZpbGVnZXMtNzQ2MzlkYWUuanMnO1xuaW1wb3J0IHsgaSBhcyBpc0RldmVsb3BlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2Jhc2ljLTZkYjdlYmQ3LmpzJztcbmltcG9ydCAnLi9jb21tb25FbnVtcy1mY2YxMzY2MS5qcyc7XG5pbXBvcnQgJy4vYXBwZW5kLTRlMTEwMzJjLmpzJztcbmltcG9ydCAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0ICcuL3VybC00YzNhZTU0Yy5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5cbmNvbnN0IGFyY2dpc05ld0l0ZW1QYWdlc0NzdkxvY2F0aW9uRmllbGRzQ3NzID0gXCIud3JhcHBlcntwYWRkaW5nLWJvdHRvbToycmVtfS50YWJsZXttYXJnaW4tYm90dG9tOjEuNXJlbX0ucm93e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZy1sZWZ0OjBweDtwYWRkaW5nLXJpZ2h0OjBweDtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO2JveC1zaGFkb3c6MHB4IC0xcHggMHB4ICNlYWVhZWF9LnJvdy0taGVhZGVye2JveC1zaGFkb3c6bm9uZX0uY2VsbHtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6NTAlO3BhZGRpbmc6MC41cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5jZWxsLS1oZWFkZXJ7Zm9udC13ZWlnaHQ6NDAwfS5hZHZhbmNlZHttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbToycmVtO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTIpfS5hZHZhbmNlZF9fdG9nZ2xle21hcmdpbjowcHg7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6ZmxleDt3aWR0aDoxMDAlO2N1cnNvcjpwb2ludGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtib3JkZXItcmFkaXVzOjA7Ym9yZGVyLXN0eWxlOm5vbmU7cGFkZGluZzoxLjI1cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7dHJhbnNpdGlvbjphbGwgMTUwbXMgZWFzZS1pbi1vdXQ7b3V0bGluZS1vZmZzZXQ6MHB4O291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7Zm9udC1mYW1pbHk6aW5oZXJpdH0uYWR2YW5jZWRfX3RvZ2dsZTpmb2N1c3tvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDotMnB4fS5hZHZhbmNlZF9faWNvbnttYXJnaW4taW5saW5lLWVuZDoxcmVtO3RyYW5zZm9ybTpyb3RhdGUoOTBkZWcpO3RyYW5zaXRpb24tZHVyYXRpb246MTUwbXM7dHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246Y3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKX0uYXJjZ2lzLS1ydGx7dHJhbnNmb3JtOnJvdGF0ZSgtOTBkZWcpfS5hZHZhbmNlZF9faWNvbi0tb3Blbnt0cmFuc2Zvcm06cm90YXRlKDE4MGRlZyl9LmFkdmFuY2VkX19jb250ZW50e3BhZGRpbmctbGVmdDoxLjI1cmVtO3BhZGRpbmctcmlnaHQ6MS4yNXJlbTtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtfS50d28tdXB7bWFyZ2luLWJvdHRvbTowLjc1cmVtO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0uY29sdW1ue3dpZHRoOmNhbGMoNTAlIC0gNnB4KX0uaGVhZGVye21hcmdpbjowcHg7bWFyZ2luLWJvdHRvbTowLjVyZW07cGFkZGluZzowcHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0uZGVzY3JpcHRpb257bWFyZ2luOjBweDttYXJnaW4tYm90dG9tOjEuNXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LmVucmljaC1sYXllci1jb250YWluZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci1pbnB1dCk7cGFkZGluZzoxNXB4IDE1cHggMHB4IDE1cHh9LmVucmljaC1zd2l0Y2h7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5lbnJpY2gtdGl0bGV7ZGlzcGxheTpmbGV4O2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0uZW5yaWNoLXJhZGlvLXRleHR7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpfS5yYWRpb3ttYXJnaW4tYm90dG9tOjAuNzVyZW19LmFzdGVyaXNre2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3Itc3RhdHVzLWRhbmdlcil9Lm5vdGljZXttYXJnaW4tdG9wOjAuNXJlbX0ubG9hZGVyLW92ZXJsYXl7b3ZlcmZsb3c6aGlkZGVufS5lbnJpY2gtZGVzY3JpcHRpb257bWFyZ2luLWJvdHRvbTowLjc1cmVtO21hcmdpbi10b3A6MHB4fVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNDc3ZMb2NhdGlvbkZpZWxkcyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1EaXNhYmxlQ2xvc2VCdXR0b25zXCIsIDcpO1xuICAgICAgICB0aGlzLnVzZXJIYXNBc3NpZ25lZENyZWRpdHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcmdJc1Jlc3RyaWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93VG90YWxDcmVkaXRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBcHBlbmRXb3JrZmxvdyA9IGZhbHNlO1xuICAgICAgICAvLyBUZWxlbWV0cnk6IExvZyBjaGFuZ2VzIHVzZXIgbWFkZSB0byBmaWVsZHNcbiAgICAgICAgdGhpcy5sb2dDU1ZMb2NhdGlvbkZpZWxkc0NoYW5nZXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ZWxlbWV0cnkgPSBjb25maWdTdGF0ZS50ZWxlbWV0cnk7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIGV2ZW50VHlwZTogXCJvdGhlclwiLFxuICAgICAgICAgICAgICAgIHBhZ2VOYW1lOiBcIm15IGNvbnRlbnRcIixcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJuZXcgaXRlbSBjc3YgbG9jYXRpb24gc2V0dGluZ3NcIixcbiAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gSGFuZGxlIHByb3BlcnRpZXMgdW5pcXVlIHRvIGFkZHJlc3MgbG9jYXRpb24gdHlwZVxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzIHBsYWNlIG5hbWVzXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5RW5yaWNoTGF5ZXJTZXR0aW5ncykge1xuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkLmFjdGlvbiA9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2FuZGlkYXRlRmllbGRzVHlwZSA9PT0gXCJHZW9tZXRyeU9ubHlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gXCJlbnJpY2ggd2l0aCBzb21lIGZpZWxkc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBcImVucmljaCB3aXRoIGFsbCBmaWVsZHNcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQuYWN0aW9uID0gXCJlbnJpY2ggd2l0aCBubyBmaWVsZHNcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGF5bG9hZC5mYWNldFZhbHVlID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlID09PSBcIk11bHRpcGxlXCIgPyBcIm11bHRpXCIgOiBcInNpbmdsZSBsaW5lIGFkZHJlc3NcIjtcbiAgICAgICAgICAgICAgICBwYXlsb2FkLmRldGFpbHMgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxMb2NhdG9yID09PSBhZGRJdGVtU3RhdGUuZ2VvY29kZVNlcnZpY2VVcmxcbiAgICAgICAgICAgICAgICAgICAgICAgID8gXCJkZWZhdWx0IGxvY2F0b3JcIlxuICAgICAgICAgICAgICAgICAgICAgICAgOiBcImxvY2F0b3IgY2hhbmdlZFwiO1xuICAgICAgICAgICAgICAgIHBheWxvYWQuYXR0cmlidXRlID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsUmVnaW9uID09PSBhZGRJdGVtU3RhdGUuc291cmNlQ291bnRyeSA/IFwiZGVmYXVsdCByZWdpb25cIiA6IFwicmVnaW9uIGNoYW5nZWRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlbGVtZXRyeSA9PT0gbnVsbCB8fCB0ZWxlbWV0cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbGVtZXRyeS5sb2dFdmVudChwYXlsb2FkKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmFkdmFuY2VkRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENhbmRpZGF0ZUZpZWxkc1R5cGUgPSBcIkdlb21ldHJ5T25seVwiO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbnJpY2hMYXllclNldHRpbmdzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9IFwiU2luZ2xlXCI7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaTE4biA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlTmV4dCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoKHRoaXMub3JnSXNSZXN0cmljdGVkIHx8IHRoaXMudXNlckhhc0Fzc2lnbmVkQ3JlZGl0cykgJiYgdGhpcy5oYXNJbnN1ZmZpY2llbnRDcmVkaXRzKCkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmkxOG4uZXJyb3JzLmluc3VmZmljaWVudENyZWRpdHM7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLmVzdGltYXRlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2Nyb2xsSW50b1ZpZXcoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlcnJvciA9IHRoaXMudmFsaWRhdGVGaWVsZHMoKTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQXBwZW5kV29ya2Zsb3cgJiZcbiAgICAgICAgICAgICAgICAoYWRkSXRlbVN0YXRlLmFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJhZGRcIiB8fFxuICAgICAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwc2VydFwiKSkge1xuICAgICAgICAgICAgICAgIGlmIChhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID09PSBcIm5vbmVcIiAmJlxuICAgICAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlRGF0YUxheWVyLmdlb21ldHJ5VHlwZSA9PT0gXCJlc3JpR2VvbWV0cnlQb2ludFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLmkxOG4uZXJyb3JzLm5vTG9jYXRpb25UeXBlRm9yQXBwZW5kO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYW5hbHl6ZVJlc3VsdHMgPSBhZGRJdGVtU3RhdGUuYW5hbHl6ZVJlc3VsdHM7XG4gICAgICAgICAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9IGdldExvY2F0aW9uUHVibGlzaFBhcmFtZXRlcnModGhpcy5zZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlLCB0aGlzLmlzQXBwZW5kV29ya2Zsb3cpO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmFuYWx5emVSZXN1bHRzID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBhbmFseXplUmVzdWx0cyksIHsgcHVibGlzaFBhcmFtZXRlcnMgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0FwcGVuZFdvcmtmbG93KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBhZGRJdGVtU3RhdGUuZGF0YUxheWVyO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIgPSBwdWJsaXNoUGFyYW1ldGVyczsgLy91cGRhdGUgZGF0YUxheWVyIGZvciBhcHBlbmRcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuZGF0YUxheWVyLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sb2dDU1ZMb2NhdGlvbkZpZWxkc0NoYW5nZXMoKTtcbiAgICAgICAgICAgIGxldCBuZXh0UGFnZSA9IFwiaXRlbVByb3BlcnRpZXNcIjtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dDb21wbGV0ZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogYWRkSXRlbVN0YXRlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogZW5jb2RlVVJJKGFkZEl0ZW1TdGF0ZS51cmwpLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21QYXJhbWV0ZXJzOiBhZGRJdGVtU3RhdGUuY3VzdG9tUGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHl6ZVJlc3VsdHM6IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXBwZW5kV29ya2Zsb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZEl0ZW1TdGF0ZS5hZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwiYWRkXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICghYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzLnNvbWUoKGZpZWxkKSA9PiBmaWVsZC50eXBlID09PSBcImVzcmlGaWVsZFR5cGVEYXRlXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VudGVycHJpc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0UGFnZSA9IFwiYXBwZW5kTWF0Y2hGaWVsZHNcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRQYWdlID0gXCJhcHBlbmRLZXlQYWlyU2VsZWN0XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdJdGVtVXBkYXRlUGFnZS5lbWl0KG5leHRQYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBoYXNJbnN1ZmZpY2llbnRDcmVkaXRzKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiICYmXG4gICAgICAgICAgICBpc0VzcmlXb3JsZEdlb2NvZGVyKGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybCkgJiZcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9jb2RlQ29zdCAmJlxuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmdlb2NvZGVDb3N0LnRyYW5zYWN0aW9uQ3JlZGl0Q29zdCA+IGFkZEl0ZW1TdGF0ZS5nZW9jb2RlQ29zdC5hdmFpbGFibGVDcmVkaXRzKTtcbiAgICB9XG4gICAgc2hvd1VucmVzdHJpY3RlZE9yZ0NyZWRpdHNOb3RpY2UoKSB7XG4gICAgICAgIHJldHVybiAhKHRoaXMub3JnSXNSZXN0cmljdGVkIHx8IHRoaXMudXNlckhhc0Fzc2lnbmVkQ3JlZGl0cykgJiYgdGhpcy5oYXNJbnN1ZmZpY2llbnRDcmVkaXRzKCk7XG4gICAgfVxuICAgIGlzQWRkVG9NYXBUZXJtaW5hbFBhZ2UoKSB7XG4gICAgICAgIHJldHVybiAodWlTdG9yZVN0YXRlLndvcmtmbG93ID09PSBcIm1hcFwiICYmXG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubmV3SXRlbU1vZGUgPT09IFwidXJsXCIgJiZcbiAgICAgICAgICAgICFhZGRJdGVtU3RhdGUuZW5hYmxlUHVibGlzaGluZyk7XG4gICAgfVxuICAgIGFzeW5jIGFuYWx5emUoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBmaWxlLCB1cmwsIGV4aXN0aW5nSXRlbSwgaWQ6IGl0ZW1pZCwgY2xvdWRQcm92aWRlclJlc291cmNlLCB0eXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIGxhbmcgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICByZXR1cm4gYW5hbHl6ZSh7XG4gICAgICAgICAgICBhbmFseXplQXJnczogKCEhZXhpc3RpbmdJdGVtIHx8ICEhY2xvdWRQcm92aWRlclJlc291cmNlIHx8IGlzTGFyZ2VDU1YoKF9hID0gZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLnNpemUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApKSAmJiAhIWl0ZW1pZFxuICAgICAgICAgICAgICAgID8geyB0eXBlOiBcIml0ZW1cIiwgaXRlbWlkIH1cbiAgICAgICAgICAgICAgICA6IGZpbGVcbiAgICAgICAgICAgICAgICAgICAgPyB7IHR5cGU6IFwiZmlsZVwiLCBmaWxlIH1cbiAgICAgICAgICAgICAgICAgICAgOiB7IHR5cGU6IFwidXJsXCIsIHNvdXJjZVVybDogdXJsIH0sXG4gICAgICAgICAgICBpdGVtQXJnczogeyBpdGVtVHlwZTogdHlwZSB9LFxuICAgICAgICAgICAgY29uZmlnQXJnczogeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgICAgIGNvbnN0IHsgYW5hbHl6ZVJlc3VsdHMsIHR5cGUsIHNlbGVjdGVkU2hlZXQsIHN0YW5kYXJkaXplZEZpZWxkTmFtZXMsIGVuYWJsZVB1Ymxpc2hpbmcsIGNsb3VkUHJvdmlkZXJSZXNvdXJjZSwgZ2VvY29kZVNlcnZpY2VVcmwgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIGNvbmZpZywgbGFuZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IGluZm8gPSBnZXRBbmFseXplZExheWVySW5mbygpO1xuICAgICAgICB0aGlzLmlzQXBwZW5kV29ya2Zsb3cgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwiYXBwZW5kXCI7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uSW5mbyA9IGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm87XG4gICAgICAgIHRoaXMuaXNFbnRlcnByaXNlID0gcG9ydGFsLmlzUG9ydGFsO1xuICAgICAgICBjb25zdCBhcHBlbmRJbkVudGVycHJpc2UgPSB0aGlzLmlzQXBwZW5kV29ya2Zsb3cgJiYgY29uZmlnLnNlbGYuaXNQb3J0YWw7XG4gICAgICAgIGNvbnN0IHVzZXJBc3NpZ25lZENyZWRpdHMgPSBjb25maWdTdGF0ZS5hcGkgPT09IDQgPyAoX2EgPSB1c2VyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hc3NpZ25lZENyZWRpdHMgOiB1c2VyLmFzc2lnbmVkQ3JlZGl0cztcbiAgICAgICAgdGhpcy51c2VySGFzQXNzaWduZWRDcmVkaXRzID0gdXNlckFzc2lnbmVkQ3JlZGl0cyA+IDA7XG4gICAgICAgIHRoaXMub3JnSXNSZXN0cmljdGVkID0gKChfYiA9IHRoaXMuc3Vic2NyaXB0aW9uSW5mbykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXRlKSA9PT0gXCJyZXN0cmljdGVkXCI7XG4gICAgICAgIHRoaXMuaTE4biA9IHVpU3RvcmVTdGF0ZS5pMThuLmNzdkxvY2F0aW9uRmllbGRzO1xuICAgICAgICBpZiAodGhpcy5pc0FkZFRvTWFwVGVybWluYWxQYWdlKCkpIHtcbiAgICAgICAgICAgIHVpU3RvcmVTdGF0ZS5uZXh0VGV4dCA9IFwiYWRkVG9NYXBcIjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdHlwZXMgPSBhcHBlbmRJbkVudGVycHJpc2VcbiAgICAgICAgICAgID8gW1wiY29vcmRpbmF0ZXNcIiwgXCJub25lXCJdXG4gICAgICAgICAgICA6IFtcImNvb3JkaW5hdGVzXCIsIFwiYWRkcmVzc1wiLCBcIm5vbmVcIiwgXCJtZ3JzXCIsIFwidXNuZ1wiXTtcbiAgICAgICAgY29uc3Qgc2hvd0FkZHJlc3MgPSBjYW5HZW9jb2RlKHVzZXIpICYmXG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUuZ2VvY29kZVNlcnZlcnMgJiZcbiAgICAgICAgICAgICh1aVN0b3JlU3RhdGUud29ya2Zsb3cgIT09IFwibWFwXCIgfHwgZW5hYmxlUHVibGlzaGluZyk7XG4gICAgICAgIGNvbnN0IGlzRGV2ID0gaXNEZXZlbG9wZXIoY29uZmlnU3RhdGUuc3Vic2NyaXB0aW9uSW5mbyk7XG4gICAgICAgIHRoaXMuc2hvd1RvdGFsQ3JlZGl0cyA9IGNhblNob3dUb3RhbENyZWRpdHModXNlciwgcG9ydGFsKTtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9IHNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgIT09IG51bGwgJiYgc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSAhPT0gdm9pZCAwID8gc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA6IFwiU2luZ2xlXCI7XG4gICAgICAgIGNvbnN0IGlzQWRkRGlyZWN0VG9NYXAgPSB1aVN0b3JlU3RhdGUud29ya2Zsb3cgPT09IFwibWFwXCIgJiYgIWVuYWJsZVB1Ymxpc2hpbmc7XG4gICAgICAgIHRoaXMubG9jYXRpb25UeXBlcyA9IHR5cGVzXG4gICAgICAgICAgICAubWFwKChrZXkpID0+ICh7XG4gICAgICAgICAgICBvcHRpb25UaXRsZTogdGhpcy5pMThuLmxvY2F0aW9uVHlwZXNba2V5XS50aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpc0RldiAmJiBrZXkgPT09IFwiYWRkcmVzc1wiXG4gICAgICAgICAgICAgICAgPyB0aGlzLmkxOG4ubG9jYXRpb25UeXBlcy5hZGRyZXNzLmRlc2NyaXB0aW9uRGV2ZWxvcGVyXG4gICAgICAgICAgICAgICAgOiB0aGlzLmkxOG4ubG9jYXRpb25UeXBlc1trZXldLmRlc2NyaXB0aW9uLnJlcGxhY2UoXCIke3R5cGV9XCIsIChjbG91ZFByb3ZpZGVyUmVzb3VyY2UgPT09IG51bGwgfHwgY2xvdWRQcm92aWRlclJlc291cmNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG91ZFByb3ZpZGVyUmVzb3VyY2UuY2xvdWRGaWxlVHlwZSkgPT09IFwiZ29vZ2xlc2hlZXRzXCIgPyBcIkdvb2dsZSBTaGVldFwiIDogdHlwZSksXG4gICAgICAgICAgICB2YWx1ZToga2V5LFxuICAgICAgICAgICAgYmFkZ2U6IGtleSA9PT0gXCJhZGRyZXNzXCIgJiYgIWNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCAmJiAhaXNEZXZcbiAgICAgICAgICAgICAgICA/IHsgbGFiZWw6IHRoaXMuaTE4bi5jb25zdW1lc0NyZWRpdHMsIGljb246IFwiY3JlZGl0c1wiIH1cbiAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICBpY29uOiBrZXkgPT09IFwibm9uZVwiID8gXCJ0YWJsZVwiIDogXCJsYXllci1wb2ludHNcIlxuICAgICAgICB9KSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHsgdmFsdWUgfSkgPT4gXG4gICAgICAgIC8vIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1hcHAtY29tcG9uZW50cy9pc3N1ZXMvMjYwNVxuICAgICAgICAodmFsdWUgIT09IFwiYWRkcmVzc1wiIHx8IHNob3dBZGRyZXNzKSAmJlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yNzY2XG4gICAgICAgICAgICAodmFsdWUgPT09IFwiY29vcmRpbmF0ZXNcIiB8fCAhaXNBZGREaXJlY3RUb01hcCkpO1xuICAgICAgICAvLyBvbiBmaXJzdCBsb2FkLCBpZiBjb29yZGluYXRlcyBhcmUgZGV0ZWN0ZWQsIHVzZSB0aG9zZSBpbnN0ZWFkIG9mIGFkZHJlc3Nlc1xuICAgICAgICBjb25zdCBwdWJsaXNoUGFyYW1ldGVycyA9IGFuYWx5emVSZXN1bHRzID09PSBudWxsIHx8IGFuYWx5emVSZXN1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycztcbiAgICAgICAgaWYgKHB1Ymxpc2hQYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBpc0V4Y2VsID0gdHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIjtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IGlzRXhjZWxcbiAgICAgICAgICAgICAgICA/IChfZCA9IChfYyA9IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSBudWxsIHx8IHB1Ymxpc2hQYXJhbWV0ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1tzZWxlY3RlZFNoZWV0XSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogKF9lID0gcHVibGlzaFBhcmFtZXRlcnMgPT09IG51bGwgfHwgcHVibGlzaFBhcmFtZXRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHB1Ymxpc2hQYXJhbWV0ZXJzLmxheWVycykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lWzBdXG4gICAgICAgICAgICAgICAgOiBhbmFseXplUmVzdWx0cyA9PT0gbnVsbCB8fCBhbmFseXplUmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYW5hbHl6ZVJlc3VsdHMucHVibGlzaFBhcmFtZXRlcnM7XG4gICAgICAgICAgICBpZiAocGFyYW1zLmxhdGl0dWRlRmllbGROYW1lIHx8IHBhcmFtcy5sb25naXR1ZGVGaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIkxhdGl0dWRlQW5kTG9uZ2l0dWRlXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHVibGlzaFBhcmFtZXRlcnMubG9jYXRpb25UeXBlID09PSBcImNvb3JkaW5hdGVzXCIgJiZcbiAgICAgICAgICAgICAgICBwdWJsaXNoUGFyYW1ldGVycy5jb29yZGluYXRlRmllbGRUeXBlKSB7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHB1Ymxpc2hQYXJhbWV0ZXJzLmNvb3JkaW5hdGVGaWVsZFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1HUlNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcIm1ncnNcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jb29yZGluYXRlRmllbGRUeXBlID0gXCJNR1JTXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlVTTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcInVzbmdcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5jb29yZGluYXRlRmllbGRUeXBlID0gXCJVU05HXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUuY29vcmRpbmF0ZUZpZWxkVHlwZSA9IFwiTGF0aXR1ZGVBbmRMb25naXR1ZGVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtcy5sb2NhdGlvblR5cGUgPT09IFwiYWRkcmVzc1wiICYmIHNob3dBZGRyZXNzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9IFwiYWRkcmVzc1wiO1xuICAgICAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImFkZHJlc3NcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIChfZiA9IGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUpICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IChhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJub25lXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxvY2F0aW9uVHlwZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICBjb25zdCBsb2NhdGlvblR5cGUgPSB0aGlzLmxvY2F0aW9uVHlwZXNbMF0udmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gbG9jYXRpb25UeXBlO1xuICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9XG4gICAgICAgICAgICAgICAgbG9jYXRpb25UeXBlID09PSBcIm1ncnNcIiB8fCBsb2NhdGlvblR5cGUgPT09IFwidXNuZ1wiID8gXCJjb29yZGluYXRlc1wiIDogbG9jYXRpb25UeXBlO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIHVzZXIgY2FuJ3QgZ2VvY29kZSwgYW5kIHdlJ3JlIG9uIGFkZHJlc3MsIHN3YXAgdG8gY29vcmRpbmF0ZXNcbiAgICAgICAgaWYgKCFzaG93QWRkcmVzcyAmJiB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIikge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgIGFkZEl0ZW1TdGF0ZS5sb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXBkYXRlIGFuYWx5emUgdG8gdXNlIGFkZHJlc3MgaWYgd2UgaGF2ZSBubyBhZGRyZXNzIGZpZWxkcyBvbiBmaXJzdCBsb2FkXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiAmJiAhaW5mby5hZGRyZXNzRmllbGRzKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJhZGRyZXNzXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgb24gZmlyc3QgbG9hZCB0aGUgZmllbGQgbmFtZXMgaGF2ZSBub3QgYmVlbiBzZXRcbiAgICAgICAgaWYgKCFzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKSB7XG4gICAgICAgICAgICBhd2FpdCBzZXRTdGFuZGFyZGl6ZWRGaWVsZE5hbWVzKHtcbiAgICAgICAgICAgICAgICBnZW9jb2RlU2VydmljZVVybCxcbiAgICAgICAgICAgICAgICAvLyAhIFdlIHNldCB0aGUgbG9jYXRpb24gdHlwZSBhYm92ZSBzbyB3ZSBjYW4ndCBqdXN0IHVzZSB0aGUgZGVzdHJ1Y3RlZCB2YWx1ZVxuICAgICAgICAgICAgICAgIC8vIFRPRE86IHJlZmFjdG9yIHRoYXQgaW50byBhIGxvY2FsIHZhcmlhYmxlXG4gICAgICAgICAgICAgICAgbG9jYXRpb25UeXBlOiBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlLFxuICAgICAgICAgICAgICAgIGxhbmdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcHBlbmRJbkVudGVycHJpc2UpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUgPSBcImNvb3JkaW5hdGVzXCI7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRlbGVtZXRyeTogQ2FwdHVyZSBpbml0aWFsIHZhbHVlcyB0byBjb21wYXJlIGFnYWluc3RcbiAgICAgICAgdGhpcy5pbml0aWFsTG9jYXRvciA9IGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybDtcbiAgICAgICAgdGhpcy5pbml0aWFsUmVnaW9uID0gYWRkSXRlbVN0YXRlLnNvdXJjZUNvdW50cnk7XG4gICAgICAgIHRoaXMuc2V0TG9jYXRpb25UeXBlVGVsZW1ldHJ5KHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUpO1xuICAgIH1cbiAgICB2YWxpZGF0ZUZpZWxkcygpIHtcbiAgICAgICAgY29uc3QgeyBzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzLCBzZWxlY3RlZEZpZWxkcywgYmFja3VwTGF5ZXJGaWVsZHMgfSA9IGFkZEl0ZW1TdGF0ZTtcbiAgICAgICAgY29uc3QgZmllbGRzID0gIXRoaXMuaXNBcHBlbmRXb3JrZmxvdyA/IE9iamVjdC52YWx1ZXMoc2VsZWN0ZWRGaWVsZHMpIDogYmFja3VwTGF5ZXJGaWVsZHM7XG4gICAgICAgIGNvbnN0IG5vRmllbGRTZWxlY3RlZCA9ICFmaWVsZHMuZmluZCgoeyBsb2NhdGlvblR5cGUgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2hlc0xvY2F0aW9uVHlwZSA9IChsb2NhdGlvblR5cGUgPT09IG51bGwgfHwgbG9jYXRpb25UeXBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsb2NhdGlvblR5cGUudG9Mb3dlckNhc2UoKSkgPT09IHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZXNTdGFuZGFyZGl6ZWRGaWVsZCA9ICEhKHN0YW5kYXJkaXplZEZpZWxkTmFtZXMgPT09IG51bGwgfHwgc3RhbmRhcmRpemVkRmllbGROYW1lcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RhbmRhcmRpemVkRmllbGROYW1lc1tsb2NhdGlvblR5cGVdKTtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzTG9jYXRpb25UeXBlIHx8IG1hdGNoZXNTdGFuZGFyZGl6ZWRGaWVsZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHN3aXRjaCAodGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcInVzbmdcIjpcbiAgICAgICAgICAgIGNhc2UgXCJtZ3JzXCI6XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgYXQgbGVhc3Qgb25lIGZpZWxkIGhhcyBsb2NhdGlvbiB0eXBlIHVzbmdcbiAgICAgICAgICAgICAgICBpZiAobm9GaWVsZFNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uZXJyb3JzLm5vRmllbGRTZWxlY3RlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYWRkcmVzc1wiOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPT09IFwiU2luZ2xlXCIgJiYgbm9GaWVsZFNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uZXJyb3JzLm5vRmllbGRTZWxlY3RlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWxlY3RlZExvY2F0aW9uRmllbGRTZWxlY3Rpb25UeXBlID09PSBcIk11bHRpcGxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzTG9jYXRpb25GaWVsZCA9IGZpZWxkcy5maW5kKChmaWVsZCkgPT4gZmllbGQubG9jYXRpb25UeXBlICYmIGZpZWxkLmxvY2F0aW9uVHlwZSAhPT0gXCJ1bmtub3duXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc0xvY2F0aW9uRmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uZXJyb3JzLm5vRmllbGRTZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJjb29yZGluYXRlc1wiOlxuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGxhdGl0dWRlIF9hbmRfIGxvbmdpdHVkZSBhcmUgc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hpbmcgPSBmaWVsZHMuZmlsdGVyKCh7IGxvY2F0aW9uVHlwZSB9KSA9PiBsb2NhdGlvblR5cGUgPT09IFwibGF0aXR1ZGVcIiB8fCBsb2NhdGlvblR5cGUgPT09IFwibG9uZ2l0dWRlXCIpO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZy5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uZXJyb3JzLmNvb3JkaW5hdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXN5bmMgdXBkYXRlTG9jYXRpb25UeXBlKHR5cGUsIHJlYW5hbHl6ZSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID0gdHlwZTtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJub25lXCI7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMb2NhdGlvblR5cGUgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJtZ3JzXCI6XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIk1HUlNcIjtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNvb3JkaW5hdGVzXCI6XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIkxhdGl0dWRlQW5kTG9uZ2l0dWRlXCI7XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmxvY2F0aW9uVHlwZSA9IFwiY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ1c25nXCI6XG4gICAgICAgICAgICAgICAgYWRkSXRlbVN0YXRlLmNvb3JkaW5hdGVGaWVsZFR5cGUgPSBcIlVTTkdcIjtcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJjb29yZGluYXRlc1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFkZHJlc3NcIjpcbiAgICAgICAgICAgICAgICBhZGRJdGVtU3RhdGUubG9jYXRpb25UeXBlID0gXCJhZGRyZXNzXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlYW5hbHl6ZSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hbmFseXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRMb2NhdGlvblR5cGVUZWxlbWV0cnkodHlwZSk7XG4gICAgfVxuICAgIC8vIFRlbGVtZXRyeTogTWFwIGxvY2F0aW9uIHR5cGUgdG8gdGVsZXRyeSBsYWJlbFxuICAgIHNldExvY2F0aW9uVHlwZVRlbGVtZXRyeSh0eXBlKSB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcIm1ncnNcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRMb2NhdGlvblR5cGUgPSBcIm1ncnMgY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJjb29yZGluYXRlc1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExvY2F0aW9uVHlwZSA9IFwibGF0IGxvblwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInVzbmdcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRMb2NhdGlvblR5cGUgPSBcInVzbmcgY29vcmRpbmF0ZXNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhZGRyZXNzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TG9jYXRpb25UeXBlID0gXCJhZGRyZXNzIHBsYWNlIG5hbWVzXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibm9uZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExvY2F0aW9uVHlwZSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZUdlb2NvZGVTZXJ2ZXIodXJsKSB7XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5nZW9jb2RlU2VydmljZVVybCA9IHVybDtcbiAgICAgICAgLy8gVE9ETzogdXBkYXRlIGFkZEl0ZW1TdGF0ZS5pc0Fnb1dvcmxkR2VvY29kZVNlcnZlciBoZXJlIChodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvcHVsbC8xNjU3KVxuICAgICAgICBhd2FpdCB0aGlzLmFuYWx5emUoKTtcbiAgICB9XG4gICAgYXN5bmMgdXBkYXRlUmVnaW9uKHJlZ2lvbikge1xuICAgICAgICBhZGRJdGVtU3RhdGUuc291cmNlQ291bnRyeSA9IHJlZ2lvbjtcbiAgICAgICAgYXdhaXQgdGhpcy5hbmFseXplKCk7XG4gICAgfVxuICAgIGhhbmRsZUVucmljaExheWVyU3dpdGNoQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGNoZWNrZWQgPSBldmVudC50YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgdGhpcy5kaXNwbGF5RW5yaWNoTGF5ZXJTZXR0aW5ncyA9IGNoZWNrZWQ7XG4gICAgICAgIHRoaXMudXBkYXRlQ2FuZGlkYXRlRmllbGRzKGNoZWNrZWQgPyBcIk1pbmltYWxcIiA6IFwiR2VvbWV0cnlPbmx5XCIpO1xuICAgIH1cbiAgICB1cGRhdGVDYW5kaWRhdGVGaWVsZHModmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENhbmRpZGF0ZUZpZWxkc1R5cGUgPSB2YWx1ZTtcbiAgICAgICAgYWRkSXRlbVN0YXRlLmNhbmRpZGF0ZUZpZWxkc1R5cGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgcmVuZGVyTG9jYXRpb25GaWVsZHMoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhbmRhcmRpemVkRmllbGROYW1lcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCBsb2NhdGlvblJvd3MgPSB7XG4gICAgICAgICAgICBhZGRyZXNzOiBzdGFuZGFyZGl6ZWRGaWVsZE5hbWVzLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHsgbGF0aXR1ZGU6IHRoaXMuaTE4bi5sYXRpdHVkZSwgbG9uZ2l0dWRlOiB0aGlzLmkxOG4ubG9uZ2l0dWRlIH0sXG4gICAgICAgICAgICBtZ3JzOiB7IG1ncnM6IFwiTUdSU1wiIH0sXG4gICAgICAgICAgICB1c25nOiB7IHVzbmc6IFwiVVNOR1wiIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgcm93cyA9IGxvY2F0aW9uUm93c1t0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlXTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9PT0gXCJTaW5nbGVcIiAmJlxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiZcbiAgICAgICAgICAgIHJvd3MpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHJvd3MpWzBdO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwicm93XCIsIHJvbGU6IFwicm93XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNlbGxcIiwgcm9sZTogXCJjZWxsXCIgfSwgcm93c1trZXldKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImNlbGxcIiwgcm9sZTogXCJjZWxsXCIgfSwgdGhpcy5yZW5kZXJGaWVsZFNlbGVjdChrZXksIHJvd3Nba2V5XSkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKHJvd3MgJiZcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyb3dzKS5tYXAoKGtleSkgPT4gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJyb3dcIiwgcm9sZTogXCJyb3dcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2VsbFwiLCByb2xlOiBcImNlbGxcIiB9LCByb3dzW2tleV0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2VsbFwiLCByb2xlOiBcImNlbGxcIiB9LCB0aGlzLnJlbmRlckZpZWxkU2VsZWN0KGtleSwgcm93c1trZXldKSkpKSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUZpZWxkTG9jYXRpb25UeXBlKGZpZWxkTmFtZSwgYWRkcmVzc0tleSkge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSAhdGhpcy5pc0FwcGVuZFdvcmtmbG93XG4gICAgICAgICAgICA/IE9iamVjdC52YWx1ZXMoYWRkSXRlbVN0YXRlLnNlbGVjdGVkRmllbGRzKVxuICAgICAgICAgICAgOiBhZGRJdGVtU3RhdGUuYmFja3VwTGF5ZXJGaWVsZHM7XG4gICAgICAgIGZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZpZWxkLm5hbWUgPT09IGZpZWxkTmFtZSkge1xuICAgICAgICAgICAgICAgIGZpZWxkLmxvY2F0aW9uVHlwZSA9IGFkZHJlc3NLZXk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaWVsZC5sb2NhdGlvblR5cGUgPT09IGFkZHJlc3NLZXkpIHtcbiAgICAgICAgICAgICAgICBmaWVsZC5sb2NhdGlvblR5cGUgPSBcInVua25vd25cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhhbmRsZUxvY2F0aW9uRmllbGRTZWxlY3Rpb25DaGFuZ2UobmV3VHlwZSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPSBuZXdUeXBlO1xuICAgICAgICBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRMb2NhdGlvbkZpZWxkU2VsZWN0aW9uVHlwZSA9IG5ld1R5cGU7XG4gICAgfVxuICAgIHJlbmRlckZpZWxkU2VsZWN0KGFkZHJlc3NLZXksIGxhYmVsKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGRzID0gIXRoaXMuaXNBcHBlbmRXb3JrZmxvd1xuICAgICAgICAgICAgPyBhZGRJdGVtU3RhdGUuc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgIDogYWRkSXRlbVN0YXRlLmJhY2t1cExheWVyRmllbGRzO1xuICAgICAgICBjb25zdCBmaWVsZHMgPSBPYmplY3Qua2V5cyhzZWxlY3RlZEZpZWxkcykubWFwKChrZXkpID0+IHNlbGVjdGVkRmllbGRzW2tleV0pO1xuICAgICAgICBjb25zdCB1c2VEZWZhdWx0ID0gIWZpZWxkcy5zb21lKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmxvY2F0aW9uVHlwZSA9PT0gYWRkcmVzc0tleTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IGxhYmVsLCByb2xlOiBcImNlbGxcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVGaWVsZExvY2F0aW9uVHlwZShlLmN1cnJlbnRUYXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWUsIGFkZHJlc3NLZXkpIH0sIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBcInVua25vd25cIiwgc2VsZWN0ZWQ6IHVzZURlZmF1bHQgfSwgdGhpcy5pMThuLnVua25vd24pLCBmaWVsZHMubWFwKChmaWVsZCkgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBmaWVsZC5uYW1lLCBzZWxlY3RlZDogZmllbGQubG9jYXRpb25UeXBlID09PSBhZGRyZXNzS2V5IH0sIGZpZWxkLmFsaWFzIHx8IGZpZWxkLm5hbWUpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICBjb25zdCB7IGdlb2NvZGVTZXJ2aWNlVXJsLCBnZW9jb2RlU2VydmVycywgZ2VvY29kZUNvc3QsIHNvdXJjZUNvdW50cnksIGNvdW50cnlDb2RlcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICBjb25zdCB7IGNvbmZpZyB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlY29yZENvdW50ID0gKF9iID0gKF9hID0gZ2V0QW5hbHl6ZWRMYXllckluZm8oKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVzdGltYXRlZFJlY29yZENvdW50KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwO1xuICAgICAgICBjb25zdCB7IGhlbHBNYXAsIGhlbHBCYXNlIH0gPSBjb25maWc7XG4gICAgICAgIGNvbnN0IGRpciA9IGdldEVsZW1lbnREaXIodGhpcy5lbCk7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIndyYXBwZXJcIiB9LCBoKFwiYXJjZ2lzLXNlbGVjdFwiLCB7IGNsYXNzOiBcImxhYmVsLS10b3BcIiwgc2VsZWN0ZWRPcHRpb246IHRoaXMuc2VsZWN0ZWRMb2NhdGlvblR5cGUsIG9wdGlvbnM6IHRoaXMubG9jYXRpb25UeXBlcywgbGFiZWw6IHRoaXMuaTE4bi5sb2NhdGlvblNldHRpbmdzLCBsYWJlbERlc2NyaXB0aW9uOiB0aGlzLmkxOG4ubG9jYXRpb25TZXR0aW5nc0Rlc2NyaXB0aW9uLCBvbkFyY2dpc09wdGlvbkNoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlTG9jYXRpb25UeXBlKGUuZGV0YWlsLCB0cnVlKSB9KSwgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSAhPT0gXCJub25lXCIgJiYgKGgoXCJkaXZcIiwgbnVsbCwgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJhZHZhbmNlZFwiIH0sIGgoXCJidXR0b25cIiwgeyBjbGFzczogXCJhZHZhbmNlZF9fdG9nZ2xlXCIsIFwiYXJpYS1leHBhbmRlZFwiOiB0aGlzLmFkdmFuY2VkRXhwYW5kZWQudG9TdHJpbmcoKSwgXCJhcmlhLWNvbnRyb2xzXCI6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiwgb25DbGljazogKCkgPT4gKHRoaXMuYWR2YW5jZWRFeHBhbmRlZCA9ICF0aGlzLmFkdmFuY2VkRXhwYW5kZWQpIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBcImNoZXZyb24tdXBcIiwgc2NhbGU6IFwic1wiLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIGFkdmFuY2VkX19pY29uOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtDU1NfVVRJTElUWS5ydGxdOiBkaXIgPT09IFwicnRsXCIsXG4gICAgICAgICAgICAgICAgXCJhZHZhbmNlZF9faWNvbi0tb3BlblwiOiB0aGlzLmFkdmFuY2VkRXhwYW5kZWRcbiAgICAgICAgICAgIH0gfSksIHRoaXMuaTE4bi5hZHZhbmNlZFNldHRpbmdzKSwgdGhpcy5hZHZhbmNlZEV4cGFuZGVkICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiwgaWQ6IFwiYWR2YW5jZWRfX2NvbnRlbnRcIiB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwidHdvLXVwXCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjb2x1bW5cIiB9LCB0aGlzLmkxOG4ubG9jYXRvciwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwiXCIsIG9uQ2FsY2l0ZVNlbGVjdENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlR2VvY29kZVNlcnZlcihlLmN1cnJlbnRUYXJnZXQuc2VsZWN0ZWRPcHRpb24udmFsdWUpIH0sIGdlb2NvZGVTZXJ2ZXJzID09PSBudWxsIHx8IGdlb2NvZGVTZXJ2ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBnZW9jb2RlU2VydmVycy5tYXAoKHNlcnZlcikgPT4gKGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IHZhbHVlOiBzZXJ2ZXIudXJsLCBzZWxlY3RlZDogc2VydmVyLnVybCA9PT0gZ2VvY29kZVNlcnZpY2VVcmwgfSwgc2VydmVyLm5hbWUpKSkpKSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJjb2x1bW5cIiB9LCB0aGlzLmkxOG4ucmVnaW9uLCBoKFwiY2FsY2l0ZS1zZWxlY3RcIiwgeyBsYWJlbDogXCJcIiwgb25DYWxjaXRlU2VsZWN0Q2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVSZWdpb24oZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGVkT3B0aW9uLnZhbHVlKSB9LCBjb3VudHJ5Q29kZXMgPT09IG51bGwgfHwgY291bnRyeUNvZGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb3VudHJ5Q29kZXMubWFwKChjb3VudHJ5KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGNvdW50cnkudmFsdWUsIHNlbGVjdGVkOiBjb3VudHJ5LnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IHNvdXJjZUNvdW50cnkudG9Mb3dlckNhc2UoKSB9LCB0aGlzLmkxOG4uY291bnRyeUNvZGVzW2NvdW50cnkudmFsdWUudG9VcHBlckNhc2UoKV0gfHwgY291bnRyeS5sYWJlbCkpKSkpKSwgIWNvbmZpZ1N0YXRlLnBvcnRhbC5pc1BvcnRhbCAmJiAhdGhpcy5pc0FwcGVuZFdvcmtmbG93ICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZW5yaWNoLWxheWVyLWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIHsgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJlbnJpY2gtdGl0bGVcIiB9LCB0aGlzLmkxOG4uZW5yaWNoLCBoKFwiYXJjZ2lzLWluZm9ybWF0aW9uXCIsIHsgbGFiZWw6IChfYyA9IHVpU3RvcmVTdGF0ZS5pMThuKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubW9yZUluZm8sIHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgcGFkZGVkQ29udGVudDogdHJ1ZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcImVucmljaC1kZXNjcmlwdGlvblwiIH0sIHRoaXMuaTE4bi5lbnJpY2hMYXllckRlc2NyaXB0aW9uKSwgaChcImNhbGNpdGUtbGlua1wiLCB7XG4gICAgICAgICAgICAvKkB0cy1pZ25vcmUqL1xuICAgICAgICAgICAgdGFyZ2V0OiBcIl9ibGFua1wiLCBocmVmOiBgJHtoZWxwQmFzZX0ke2hlbHBNYXBbXCIxMjAwMDI1NDFcIl19YFxuICAgICAgICB9LCB0aGlzLmkxOG4uZW5yaWNoTGF5ZXJMaW5rKSkpLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBjaGVja2VkOiB0aGlzLmRpc3BsYXlFbnJpY2hMYXllclNldHRpbmdzLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IHRoaXMuaGFuZGxlRW5yaWNoTGF5ZXJTd2l0Y2hDaGFuZ2UuYmluZCh0aGlzKSB9KSksIHRoaXMuZGlzcGxheUVucmljaExheWVyU2V0dGluZ3MgPyAoaChcImNhbGNpdGUtcmFkaW8tYnV0dG9uLWdyb3VwXCIsIHsgbGF5b3V0OiBcInZlcnRpY2FsXCIsIG5hbWU6IFwiZW5yaWNoLWdyb3VwXCIsIG9uQ2FsY2l0ZVJhZGlvQnV0dG9uR3JvdXBDaGFuZ2U6IChldmVudCkgPT4gdGhpcy51cGRhdGVDYW5kaWRhdGVGaWVsZHMoZXZlbnQudGFyZ2V0LnNlbGVjdGVkSXRlbS52YWx1ZSkgfSwgW1wiTWluaW1hbFwiLCBcIkFsbEZpZWxkc1wiXS5tYXAoKHR5cGUpID0+IChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmVcIiwga2V5OiB0eXBlIH0sIGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNoZWNrZWQ6IHRoaXMuc2VsZWN0ZWRDYW5kaWRhdGVGaWVsZHNUeXBlID09PSB0eXBlLCB2YWx1ZTogdHlwZSB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJlbnJpY2gtcmFkaW8tdGV4dFwiIH0sIHRoaXMuaTE4bi5jYW5kaWRhdGVGaWVsZHNUeXBlc1t0eXBlXS5kZXNjcmlwdGlvbikpKSkpKSA6IG51bGwpKSkpKSksIGgoXCJoM1wiLCB7IGNsYXNzOiBcImhlYWRlclwiIH0sIHRoaXMuaTE4bi5sb2NhdGlvbkZpZWxkcywgXCIgXCIsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiYXN0ZXJpc2tcIiB9LCBcIipcIikpLCB0aGlzLnNlbGVjdGVkTG9jYXRpb25UeXBlID09PSBcImFkZHJlc3NcIiA/IChoKFwiY2FsY2l0ZS1yYWRpby1idXR0b24tZ3JvdXBcIiwgeyBuYW1lOiBcImxvY2F0aW9uLWZpZWxkLXNlbGVjdGlvbi1ncm91cFwiLCBsYXlvdXQ6IFwidmVydGljYWxcIiwgb25DYWxjaXRlUmFkaW9CdXR0b25Hcm91cENoYW5nZTogKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUxvY2F0aW9uRmllbGRTZWxlY3Rpb25DaGFuZ2UoZXZlbnQudGFyZ2V0LnNlbGVjdGVkSXRlbS52YWx1ZSkgfSwgW1wiU2luZ2xlXCIsIFwiTXVsdGlwbGVcIl0ubWFwKCh0eXBlKSA9PiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lXCIsIGtleTogdHlwZSB9LCBoKFwiY2FsY2l0ZS1yYWRpby1idXR0b25cIiwgeyBjaGVja2VkOiB0aGlzLnNlbGVjdGVkTG9jYXRpb25GaWVsZFNlbGVjdGlvblR5cGUgPT09IHR5cGUsIHZhbHVlOiB0eXBlIH0pLCB0aGlzLmkxOG5bdHlwZSA9PT0gXCJTaW5nbGVcIiA/IFwibG9jYXRpb25GaWVsZFNpbmdsZVwiIDogXCJsb2NhdGlvbkZpZWxkTXVsdGlwbGVcIl0pKSkpKSA6IG51bGwsIGgoXCJkaXZcIiwgeyByb2xlOiBcInRhYmxlXCIsIGNsYXNzOiBcInRhYmxlXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInJvdyByb3ctLWhlYWRlclwiLCByb2xlOiBcInJvd1wiIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiY2VsbCBjZWxsLS1oZWFkZXJcIiwgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIgfSwgdGhpcy5pMThuLmxvY2F0aW9uVHlwZSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiY2VsbCBjZWxsLS1oZWFkZXJcIiwgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgXCJhcmlhLXNvcnRcIjogXCJub25lXCIgfSwgdGhpcy5pMThuLmZpZWxkKSksIHRoaXMucmVuZGVyTG9jYXRpb25GaWVsZHMoKSkpKSwgdGhpcy5zZWxlY3RlZExvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIgJiZcbiAgICAgICAgICAgIGdlb2NvZGVDb3N0ICYmXG4gICAgICAgICAgICAhY29uZmlnU3RhdGUucG9ydGFsLmlzUG9ydGFsICYmXG4gICAgICAgICAgICBpc0VzcmlXb3JsZEdlb2NvZGVyKGdlb2NvZGVTZXJ2aWNlVXJsKSAmJiAoaChGcmFnbWVudCwgbnVsbCwgaXNEZXZlbG9wZXIoY29uZmlnU3RhdGUuc3Vic2NyaXB0aW9uSW5mbykgPyAoaChcImRpdlwiLCBudWxsLCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBzY2FsZTogXCJtXCIsIHdpZHRoOiBcImZ1bGxcIiwgb3BlbjogdHJ1ZSwgaWNvbjogXCJpbmZvcm1hdGlvblwiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLmkxOG4ucmVjb3JkQ291bnQucmVwbGFjZShcIiR7bnVtfVwiLCBgJHtyZWNvcmRDb3VudH1gKSkpKSkgOiAoaChcImFyY2dpcy1jcmVkaXQtZXN0aW1hdGVcIiwgeyB0cmFuc2FjdGlvbkNyZWRpdENvc3Q6IGdlb2NvZGVDb3N0LnRyYW5zYWN0aW9uQ3JlZGl0Q29zdCwgYXZhaWxhYmxlQ3JlZGl0czogZ2VvY29kZUNvc3QuYXZhaWxhYmxlQ3JlZGl0cywgc2hvd1RvdGFsOiB0aGlzLnNob3dUb3RhbENyZWRpdHMsIGNsYXNzOiBcImNyZWRpdC1lc3RpbWF0ZVwiLCBhcGk6IGNvbmZpZ1N0YXRlLmFwaSwgcmVmOiAoZWwpID0+ICh0aGlzLmVzdGltYXRlID0gZWwpIH0pKSwgdGhpcy5zaG93VW5yZXN0cmljdGVkT3JnQ3JlZGl0c05vdGljZSgpICYmIChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogXCJub3RpY2VcIiwga2luZDogXCJicmFuZFwiLCBpY29uOiBcImluZm9ybWF0aW9uXCIsIG9wZW46IHRydWUgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCB0aGlzLmkxOG4udW5yZXN0cmljdGVkT3JnQ3JlZGl0cy50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLmkxOG4udW5yZXN0cmljdGVkT3JnQ3JlZGl0cy5kZXNjcmlwdGlvbikpKSkpLCBoKFwiYXJjZ2lzLW5ldy1pdGVtLWFsZXJ0XCIsIHsgaGVhZGluZzogKF9kID0gdGhpcy5lcnJvcikgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnRpdGxlLCBkZXNjcmlwdGlvbjogKF9lID0gdGhpcy5lcnJvcikgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmRlc2NyaXB0aW9uLCBhY3RpdmU6ICEhdGhpcy5lcnJvciwgb25BbGVydERpc21pc3M6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc05ld0l0ZW1QYWdlc0NzdkxvY2F0aW9uRmllbGRzLnN0eWxlID0gYXJjZ2lzTmV3SXRlbVBhZ2VzQ3N2TG9jYXRpb25GaWVsZHNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc05ld0l0ZW1QYWdlc0NzdkxvY2F0aW9uRmllbGRzIGFzIGFyY2dpc19uZXdfaXRlbV9wYWdlc19jc3ZfbG9jYXRpb25fZmllbGRzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1uZXctaXRlbS1wYWdlcy1jc3YtbG9jYXRpb24tZmllbGRzLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYSBhcyBhZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nIH0gZnJvbSAnLi91cmwtNGMzYWU1NGMuanMnO1xuXG5mdW5jdGlvbiBpc0VzcmkoaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gaXRlbS5vd25lcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlc3JpXCIpKTtcbn1cbmZ1bmN0aW9uIGlzUHJlbWl1bShpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIENyZWRpdHNcIikpO1xufVxuZnVuY3Rpb24gaXNTdWJzY3JpYmVyKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIGlzRXNyaShpdGVtKSAmJiAhISgoX2EgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKFwiUmVxdWlyZXMgU3Vic2NyaXB0aW9uXCIpKTtcbn1cbmZ1bmN0aW9uIGlzT3duZXIoaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpdGVtLm93bmVyID09PSB1c2VyLnVzZXJuYW1lO1xufVxuLyoqXG4gKiBDYW4gdGhlIHVzZXIgdXBkYXRlIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW0oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikgfHwgaXRlbS5pdGVtQ29udHJvbCA9PT0gXCJ1cGRhdGVcIjtcbn1cbi8qKlxuICogSXMgdGhlIHVzZXIgZWl0aGVyIGFuIG93bmVyIG9yIGFkbWluIG9mIHRoZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHVzZXJJc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgcmV0dXJuIGlzT3duZXIoaXRlbSwgdXNlcikgfHwgaXNJdGVtQWRtaW4oaXRlbSwgdXNlcik7XG59XG4vKipcbiAqIERvZXMgdGhlIHVzZXIgaGF2ZSBhZG1pbiBjYXBhYmlsaXRpZXMgb24gdGhpcyBpdGVtXG4gKi9cbmZ1bmN0aW9uIGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gaWYgdGhpcyBmbGFnIGlzIGFscmVhZHkgc2V0IChwcm9iYWJseSBob21lIGFwcCksIHVzZSBpdFxuICAgIGlmIChpdGVtLmlzQWRtaW4gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gISFpdGVtLmlzQWRtaW47XG4gICAgfVxuICAgIGNvbnN0IGl0ZW1Pd25lciA9IGl0ZW0ub3duZXI7XG4gICAgY29uc3QgaXRlbUNvbnRyb2xBZG1pbiA9IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwiYWRtaW5cIjtcbiAgICBjb25zdCBlc3JpVXNlcnMgPSBbXCJlc3JpX2xpdmluZ2F0bGFzXCIsIFwiZXNyaV9kZW1vZ3JhcGhpY3NcIiwgXCJlc3JpX2JvdW5kYXJpZXNcIl07XG4gICAgaWYgKCgoX2EgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUG9ydGFsKSAmJlxuICAgICAgICAhaXNPd25lcihpdGVtLCB1c2VyKSAmJlxuICAgICAgICBpdGVtQ29udHJvbEFkbWluICYmXG4gICAgICAgIGl0ZW1Pd25lci5pbmNsdWRlcyhcImVzcmlfXCIpICYmXG4gICAgICAgIC8vIHBvcnRhbCBpbmNvcnJlY3RseSByZXR1cm5zIFwiaXRlbUNvbnRyb2w9XCJhZG1pblwiIGZvciBlc3JpIG93bmVkIGl0ZW1zXG4gICAgICAgICFlc3JpVXNlcnMuaW5jbHVkZXMoaXRlbU93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBpdGVtQ29udHJvbEFkbWluO1xufVxuY29uc3QgaXRlbXNCZWxvbmdUb1VzZXJPcmcgPSAoaXRlbXMsIHVzZXIpID0+IHtcbiAgICByZXR1cm4gISF1c2VyLm9yZ0lkICYmIGl0ZW1zLmV2ZXJ5KChpdGVtKSA9PiBpdGVtLmlzT3JnSXRlbSk7XG59O1xuY29uc3QgZ2V0SXRlbUhvbWVBcHBVcmwgPSAoaXRlbUlkLCBiYXNlVXJsKSA9PiBgJHthZGRUcmFpbGluZ1NsYXNoSWZNaXNzaW5nKGJhc2VVcmwpfWl0ZW0uaHRtbD9pZD0ke2l0ZW1JZH1gO1xuXG5leHBvcnQgeyBpc1N1YnNjcmliZXIgYXMgYSwgaXNQcmVtaXVtIGFzIGIsIGNhblVwZGF0ZUl0ZW0gYXMgYywgaXRlbXNCZWxvbmdUb1VzZXJPcmcgYXMgZCwgZ2V0SXRlbUhvbWVBcHBVcmwgYXMgZywgaXNPd25lciBhcyBpLCB1c2VySXNJdGVtQWRtaW4gYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pdGVtLTM1MzU1NTJkLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYiBhcyB1bmlxdWUgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRDcmVhdGVJdGVtVHlwZXMgfSBmcm9tICcuL2l0ZW0tdHlwZXMtMjAyOWIwNmIuanMnO1xuXG5mdW5jdGlvbiBmaW5kUG9zc2libGVJdGVtVHlwZXNCeUV4dGVuc2lvbihleHRlbnNpb24sIHZhbGlkYXRpb25UeXBlcykge1xuICAgIC8vIFNlYXJjaCBpdGVtIHR5cGVzIGV4dGVuc2lvbnMgZm9yIHRoZSBvbmUgaW1wb3J0ZWRcbiAgICBsZXQgaXRlbVR5cGVzO1xuICAgIGlmICh2YWxpZGF0aW9uVHlwZXMpIHtcbiAgICAgICAgaXRlbVR5cGVzID0gdmFsaWRhdGlvblR5cGVzLm1hcCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS50eXBlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGl0ZW1UeXBlcyA9IE9iamVjdC5rZXlzKGFkZENyZWF0ZUl0ZW1UeXBlcyk7XG4gICAgfVxuICAgIGxldCBwb3NzaWJsZUl0ZW1UeXBlcyA9IFtdO1xuICAgIGl0ZW1UeXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKCgoX2EgPSBhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0uZmlsZUV4dCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluZGV4T2YoZXh0ZW5zaW9uKSkgPj0gMCkge1xuICAgICAgICAgICAgcG9zc2libGVJdGVtVHlwZXMucHVzaChhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHBvc3NpYmxlSXRlbVR5cGVzO1xufVxuZnVuY3Rpb24gbWFwSXRlbVR5cGVzVG9GaWxlRXh0ZW5zaW9ucyh0eXBlcykge1xuICAgIGlmICghdHlwZXMpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB1bmlxdWUodHlwZXMuZmxhdE1hcCgodHlwZSkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBhZGRDcmVhdGVJdGVtVHlwZXNbdHlwZV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWxlRXh0OyB9KS5maWx0ZXIoKHZhbGlkKSA9PiAhIXZhbGlkKSk7XG59XG5jb25zdCBpc0xhcmdlR2VvSlNPTiA9IChzaXplSW5CeXRlcykgPT4ge1xuICAgIGNvbnN0IHNpemVJbk1CID0gc2l6ZUluQnl0ZXMgLyAxMDI0IC8gMTAyNDtcbiAgICAvLyBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtYXBwLWNvbXBvbmVudHMvaXNzdWVzLzI1NTMjaXNzdWVjb21tZW50LTM2NDU0MDRcbiAgICByZXR1cm4gc2l6ZUluTUIgPiA1MDsgLy8gNTBNQlxufTtcbmNvbnN0IGlzTGFyZ2VDU1YgPSAoc2l6ZUluQnl0ZXMpID0+IHtcbiAgICBjb25zdCBzaXplSW5NQiA9IHNpemVJbkJ5dGVzIC8gMTAyNCAvIDEwMjQ7XG4gICAgLy8gaHR0cHM6Ly9kZXZ0b3BpYS5lc3JpLmNvbS9XZWJHSVMvYXJjZ2lzLWFwcC1jb21wb25lbnRzL2lzc3Vlcy8yODc1I2lzc3VlY29tbWVudC0zNzQ4OTEzXG4gICAgcmV0dXJuIHNpemVJbk1CID4gMjA7IC8vIDIwTUJcbn07XG5cbmV4cG9ydCB7IGlzTGFyZ2VDU1YgYXMgYSwgZmluZFBvc3NpYmxlSXRlbVR5cGVzQnlFeHRlbnNpb24gYXMgZiwgaXNMYXJnZUdlb0pTT04gYXMgaSwgbWFwSXRlbVR5cGVzVG9GaWxlRXh0ZW5zaW9ucyBhcyBtIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWl0ZW0tdHlwZXMtNTg2ZjAzMDEuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgICBbXCJhclwiLCBcImFyXCJdLFxuICAgIFtcImJnXCIsIFwiYmdcIl0sXG4gICAgW1wiYnNcIiwgXCJic1wiXSxcbiAgICBbXCJjYVwiLCBcImNhXCJdLFxuICAgIFtcImNzXCIsIFwiY3NcIl0sXG4gICAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgICBbXCJkZVwiLCBcImRlXCJdLFxuICAgIFtcImVsXCIsIFwiZWxcIl0sXG4gICAgW1wiZW5cIiwgXCJlblwiXSxcbiAgICBbXCJlc1wiLCBcImVzXCJdLFxuICAgIFtcImV0XCIsIFwiZXRcIl0sXG4gICAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgICBbXCJmclwiLCBcImZyXCJdLFxuICAgIFtcImhlXCIsIFwiaGVcIl0sXG4gICAgW1wiaHJcIiwgXCJoclwiXSxcbiAgICBbXCJodVwiLCBcImh1XCJdLFxuICAgIFtcImlkXCIsIFwiaWRcIl0sXG4gICAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgICBbXCJqYVwiLCBcImphXCJdLFxuICAgIFtcImtvXCIsIFwia29cIl0sXG4gICAgW1wibHRcIiwgXCJsdFwiXSxcbiAgICBbXCJsdlwiLCBcImx2XCJdLFxuICAgIFtcIm5iXCIsIFwibmJcIl0sXG4gICAgW1wibmxcIiwgXCJubFwiXSxcbiAgICBbXCJwbFwiLCBcInBsXCJdLFxuICAgIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gICAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgICBbXCJyb1wiLCBcInJvXCJdLFxuICAgIFtcInJ1XCIsIFwicnVcIl0sXG4gICAgW1wic2tcIiwgXCJza1wiXSxcbiAgICBbXCJzbFwiLCBcInNsXCJdLFxuICAgIFtcInNyXCIsIFwic3JcIl0sXG4gICAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgICBbXCJ0aFwiLCBcInRoXCJdLFxuICAgIFtcInRyXCIsIFwidHJcIl0sXG4gICAgW1widWtcIiwgXCJ1a1wiXSxcbiAgICBbXCJ2aVwiLCBcInZpXCJdLFxuICAgIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gICAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICAgIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmIChhcGkgPT09IDQpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgICAgICAgIHBsYWNlcyxcbiAgICAgICAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgICB9XG4gICAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICAgIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcGxhY2VzLFxuICAgICAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICAgIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICAgIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgICAgIGRheTogXCJudW1lcmljXCJcbiAgICB9O1xuICAgIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICAgICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuZnVuY3Rpb24gZm9ybWF0UGx1cmFsKGxhbmcsIHN0cmluZ09iaiwgbnVtYmVyKSB7XG4gICAgY29uc3Qgc2luZ2xlcyA9IFtcImlkXCIsIFwiamFcIiwgXCJrb1wiLCBcInRoXCIsIFwidmlcIiwgXCJ6aC1jblwiLCBcInpoLWhrXCIsIFwiemgtdHdcIl07XG4gICAgY29uc3QgbGlrZUVuZ2xpc2ggPSBbXG4gICAgICAgIFwiZW5cIixcbiAgICAgICAgXCJjYVwiLFxuICAgICAgICBcImRhXCIsXG4gICAgICAgIFwiZGVcIixcbiAgICAgICAgXCJlbFwiLFxuICAgICAgICBcImVzXCIsXG4gICAgICAgIFwiZXRcIixcbiAgICAgICAgXCJmaVwiLFxuICAgICAgICBcImhpXCIsXG4gICAgICAgIFwiaHVcIixcbiAgICAgICAgXCJpdFwiLFxuICAgICAgICBcIm5iXCIsXG4gICAgICAgIFwibmxcIixcbiAgICAgICAgXCJwdC1wdFwiLFxuICAgICAgICBcInN2XCIsXG4gICAgICAgIFwidHJcIlxuICAgIF07XG4gICAgY29uc3QgbG9jYWxlID0gbGFuZyAhPT0gbnVsbCAmJiBsYW5nICE9PSB2b2lkIDAgPyBsYW5nIDogXCJlblwiO1xuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgb25lLCBvciBpdCBpcyBhIFwic2ltcGxlXCIgbGFuZ3VhZ2UsIHJldHVybiB0aGUgMSBzdHJpbmdcbiAgICBpZiAobnVtYmVyID09PSAxIHx8IHNpbmdsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLnNpbmdsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIFwiMVwiKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBub3QgMSBhbmQgdGhlIGxhbmd1YWdlIHVzZXMgdGhlIHNhbWUgcGx1cmFsaXphdGlvbiBzdHJhdGVneSBhcyBlbmdsaXNoLFxuICAgIC8vIHJldHVybiB0aGUgbXVsdGlwbGUgc3RyaW5nXG4gICAgaWYgKG51bWJlciAhPT0gMSAmJiBsaWtlRW5nbGlzaC5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmoubXVsdGlwbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG4gICAgfVxuICAgIC8vIGlmIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmtlZCwgcmV0dXJuIHRoZSBcInVua25vd25cIiBzdHJpbmdcbiAgICByZXR1cm4gc3RyaW5nT2JqLnVua25vd24ucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0UGx1cmFsIGFzIGIsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTdG9yZSB9IGZyb20gJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuXG5jb25zdCB1aVN0b3JlID0gY3JlYXRlU3RvcmUoe1xuICAgIG5leHRUZXh0OiBcIm5leHRcIixcbiAgICB3b3JrZmxvdzogXCJjb250ZW50XCIsXG4gICAgc2NhbGU6IFwibVwiLFxuICAgIGRpc2FibGVTY3JvbGw6IGZhbHNlLFxuICAgIGZlYXR1cmVGbGFnczoge31cbn0pO1xuY29uc3QgdWlTdG9yZVN0YXRlID0gdWlTdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgdWlTdG9yZSBhcyBhLCB1aVN0b3JlU3RhdGUgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD11aS1iY2E3YmNkMS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=