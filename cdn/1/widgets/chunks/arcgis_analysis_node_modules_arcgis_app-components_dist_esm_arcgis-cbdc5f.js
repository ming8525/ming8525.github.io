"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-cbdc5f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-category-schema-editor.entry.js":
/*!*************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-category-schema-editor.entry.js ***!
  \*************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_category_schema_editor: () => (/* binding */ ArcgisItemCategorySchemaEditor)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _util_2a0e2f08_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util-2a0e2f08.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/util-2a0e2f08.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./categories-ca134005.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


















const getItemCategoryAggregation = async (user, portal, group) => {
    const url = group ? `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)(portal)}/content/groups/${group.id}/` : `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)(portal)}`;
    const queryParams = group
        ? { q: _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_6__.H, countFields: "access,contentstatus,groupCategories" }
        : { q: `orgid:${user.orgId} ${_query_d62660d4_js__WEBPACK_IMPORTED_MODULE_6__.H}`, countFields: "categories" };
    try {
        const searchResult = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.r)(`${url}search`, Object.assign(Object.assign({}, queryParams), { countSize: 200, num: 0, f: "json" }));
        return { result: searchResult.aggregations.counts[0] };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const updateSchema = async ({ portal, group, categorySchema }) => {
    try {
        const orgEndpoint = group ? (0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal, group) : `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)(portal)}/portals/${portal.id}/`;
        await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.r)(`${orgEndpoint}assignCategorySchema`, { categorySchema: JSON.stringify({ categorySchema }) }, {}, "post");
        return {};
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const deleteSchema = async (portal, group) => {
    try {
        const orgEndpoint = group ? (0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_7__.g)(portal, group) : `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.g)(portal)}/portals/${portal.id}/`;
        await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_5__.r)(`${orgEndpoint}deleteCategorySchema`, {}, {}, "post");
        return {};
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
const getStandardSetCategories = async (portal) => {
    try {
        const [{ categorySchema: livingAtlasCategories }, { categorySchema: inspireCategories }, { categorySchema: isoCategories }] = await Promise.all([
            (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.a)(portal, "LivingAtlas"),
            (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.a)(portal, "Inspire"),
            (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.a)(portal, "ISO")
        ]);
        return {
            result: { LivingAtlas: livingAtlasCategories, Inspire: inspireCategories, ISO: isoCategories }
        };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};

const cleanData = (curData) => {
    curData.forEach((datum) => {
        datum.description && delete datum.description;
        datum.categories ? cleanData(datum.categories) : (datum.categories = []);
    });
};
/**
 * Prepare a category schema object for submission to server
 */
const cleanTemplateData = (originalSchema) => {
    const schema = structuredClone(originalSchema);
    cleanData(schema);
    return schema;
};

const arcgisItemCategorySchemaEditorCss = ".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background);display:flex}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:48rem}.modal--large{--calcite-modal-width:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-top:0px}.confirm-modal{--calcite-modal-width:32rem}.confirm-modal-content{padding:1rem}";

const ArcgisItemCategorySchemaEditor = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.workflowCancel = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowCancel", 7);
        this.newSchemaWorkflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newSchemaWorkflowComplete", 7);
        this.deleteAllSchema = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "deleteAllSchema", 7);
        this.hasChangeSinceLastOpen = false;
        this.didFetchTemplates = false;
        this.templateInfo = {
            // Schema will be filled in later
            custom: { schema: [{ title: "Categories", categories: [] }] },
            arcgis: { schema: [], learnMoreId: "120001580" },
            iso: { schema: [], learnMoreId: "120001581" },
            inspire: { schema: [], learnMoreId: "120001582" }
        };
        this.fetchCategoryData = async () => {
            var _a, _b;
            const { user, portal, setCategorySchema, group, templateInfo, didFetchTemplates } = this;
            const [{ result: categorySchema }, { result: categoryAggregationData }] = await Promise.all([
                (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_1__.g)({ user, portal, group }),
                getItemCategoryAggregation(user, portal, group)
            ]);
            if (!((_b = (_a = categorySchema === null || categorySchema === void 0 ? void 0 : categorySchema[0]) === null || _a === void 0 ? void 0 : _a.categories) === null || _b === void 0 ? void 0 : _b.length)) {
                // There can be no categories or no subcategories other than the root
                this.rootCategoryTitle = "Categories";
                this.categorySchema = [];
                this.newCategoryMode = true;
                if (!didFetchTemplates) {
                    this.isFetchingTemplate = true;
                    // TODO: handle error
                    const { result } = await getStandardSetCategories(portal);
                    templateInfo.arcgis.schema = result.LivingAtlas;
                    templateInfo.iso.schema = result.ISO;
                    templateInfo.inspire.schema = result.Inspire;
                    this.didFetchTemplates = true;
                    this.isFetchingTemplate = false;
                }
                return;
            }
            setCategorySchema(categorySchema);
            this.categoryAggregationData = categoryAggregationData;
        };
        this.setCategorySchema = (categorySchema) => {
            // The first one is always the root category with title "Categories" which we don't care about
            this.rootCategoryTitle = categorySchema[0].title; // But we still need to add it back when calling update
            this.categorySchema = categorySchema[0].categories;
        };
        this.closeDialog = () => {
            this.schemaToDelete = null;
            this.workflowCancel.emit({ hasChangeSinceLastOpen: this.hasChangeSinceLastOpen });
        };
        this.updateSchema = async ({ schemaToUpdate, ignoreNewCategoryMode = false, optimisticUpdate = true }) => {
            const { portal, rootCategoryTitle, handleError, fetchCategoryData, newCategoryMode, group, deleteAllSchema } = this;
            if (newCategoryMode && !ignoreNewCategoryMode) {
                this.hasUnsavedChanges = schemaToUpdate.length > 0;
                this.categorySchema = schemaToUpdate;
                return true;
            }
            this.hasChangeSinceLastOpen = true;
            // Optimistic update
            const prevSchema = this.categorySchema;
            optimisticUpdate && (this.categorySchema = schemaToUpdate);
            const updateSchemaHelper = async () => {
                this.error = null;
                // If there is no schema left, we call delete instead of update
                if (schemaToUpdate.length === 0) {
                    const { error } = await deleteSchema(portal, group);
                    if (!error) {
                        this.newCategoryMode = true;
                        deleteAllSchema.emit();
                    }
                    else {
                        // TODO: handle error
                        handleError("generic");
                        optimisticUpdate && (this.categorySchema = prevSchema);
                    }
                    return;
                }
                const { error } = await updateSchema({
                    portal,
                    categorySchema: [
                        {
                            title: rootCategoryTitle,
                            categories: newCategoryMode ? cleanTemplateData(schemaToUpdate) : schemaToUpdate
                        }
                    ],
                    group
                });
                if (!error) {
                    this.hasUnsavedChanges = false;
                    await fetchCategoryData();
                }
                else {
                    // TODO: handle error
                    handleError("generic");
                    optimisticUpdate && (this.categorySchema = prevSchema);
                }
            };
            /**
             * Just return true without `await` so the optimistic update works
             *  which will disable the new category input right away and rollback if there's an error
             */
            updateSchemaHelper();
            return true;
        };
        this.finishSetupNewCategorySchema = async () => {
            const { newSchemaWorkflowComplete, categorySchema, updateSchema } = this;
            const success = await updateSchema({
                schemaToUpdate: categorySchema,
                ignoreNewCategoryMode: true
            });
            if (success) {
                this.newCategoryMode = false;
                newSchemaWorkflowComplete.emit({ newSchema: categorySchema });
            }
        };
        this.renderTemplates = () => {
            const { templateInfo, i18n, chosenTemplate, config, setCategorySchema } = this;
            const { helpBase, helpMap } = config;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "template-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "template-title" }, i18n.template.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select-group", null, Object.keys(templateInfo).map((templateKey) => {
                const { learnMoreId } = templateInfo[templateKey];
                return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile-select", { key: templateKey, checked: chosenTemplate === templateKey, description: i18n.template.templateList[templateKey].message, heading: i18n.template.templateList[templateKey].title, width: "auto", value: templateKey, onCalciteTileSelectChange: (e) => {
                        const newTemplate = e.target.value;
                        this.chosenTemplate = newTemplate;
                        setCategorySchema(templateInfo[newTemplate].schema);
                        // User can save a template as is
                        this.hasUnsavedChanges = newTemplate !== "custom";
                    } }, learnMoreId && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { href: `${helpBase}${helpMap[learnMoreId]}`, role: "presentation", class: "template-link", iconEnd: "launch", target: "_blank", rel: "noopener noreferrer" }, i18n.template.learnMore))));
            }))));
        };
        this.renderDeleteConfirmationModal = () => {
            var _a;
            const { i18n, updateSchema, schemaToDelete } = this;
            if (!schemaToDelete) {
                return null;
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { kind: "danger", scale: "m", widthScale: "s", onCalciteModalClose: (event) => {
                    event.stopPropagation();
                    this.schemaToDelete = null;
                }, open: !!schemaToDelete, class: "confirm-modal" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header" }, i18n.warning.deleteInUseCategory.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "confirm-modal-content" }, i18n.warning.deleteInUseCategory.message.replace("${numItem}", (_a = schemaToDelete.count) === null || _a === void 0 ? void 0 : _a.toLocaleString())), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline", "data-id": "cancelButton", onClick: () => (this.schemaToDelete = null), width: "full" }, i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", "data-id": "nextButton", onClick: () => {
                    updateSchema({ schemaToUpdate: schemaToDelete.schema });
                    this.schemaToDelete = null;
                }, width: "full" }, i18n.warning.deleteInUseCategory.cta)));
        };
        this.handleError = (type) => {
            const { i18n } = this;
            let message = i18n.error[type].message;
            if (type === "maxCharacter") {
                message = message.replace("${maxCharacter}", `${_util_2a0e2f08_js__WEBPACK_IMPORTED_MODULE_4__.M}`);
            }
            this.error = { title: i18n.error[type].title, message };
        };
        this.user = undefined;
        this.portal = undefined;
        this.config = undefined;
        this.group = undefined;
        this.isActive = undefined;
        this.newCategoryMode = false;
        this.categorySchema = [];
        this.categoryAggregationData = {
            fieldName: "categories",
            fieldValues: []
        };
        this.hasUnsavedChanges = undefined;
        this.error = null;
        this.isFetchingSchemaOnActiveChange = false;
        this.isFetchingTemplate = false;
        this.schemaToDelete = undefined;
        this.chosenTemplate = "custom";
    }
    async componentWillLoad() {
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.el);
        this.i18n = locale[0];
    }
    componentDidLoad() {
        this.handleIsActiveChange();
    }
    async handleIsActiveChange() {
        // Just want to reset this whenever isActive changes
        this.hasChangeSinceLastOpen = false;
        this.chosenTemplate = "custom";
        this.error = null;
        this.schemaToDelete = null;
        // Public user doesn't have access to categories unless they do it through group
        if (this.isActive && (!(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(this.user) || this.group)) {
            this.isFetchingSchemaOnActiveChange = true;
            await this.fetchCategoryData();
            this.isFetchingSchemaOnActiveChange = false;
        }
    }
    render() {
        const { newCategoryMode, categorySchema, categoryAggregationData, isActive, isFetchingSchemaOnActiveChange, closeDialog, i18n, updateSchema, error, renderTemplates, chosenTemplate, isFetchingTemplate, workflowCancel, finishSetupNewCategorySchema, hasUnsavedChanges, handleError, renderDeleteConfirmationModal } = this;
        // ! Have to check for isFetchingSchemaOnActiveChange or the modal width won't change dynamically once it's rendered
        if (!isActive || isFetchingSchemaOnActiveChange) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: isActive, onCalciteModalClose: closeDialog, scale: "m", class: { modal: true, "modal--large": newCategoryMode } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header", class: "header" }, i18n.modalHeader), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "stage" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { icon: true, open: !!error, label: error === null || error === void 0 ? void 0 : error.title, kind: "danger", onCalciteAlertClose: () => (this.error = null) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, error === null || error === void 0 ? void 0 : error.message)), isFetchingTemplate && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-scrim", { loading: true }, i18n.loadingText), newCategoryMode && renderTemplates(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "inner-container": true, "inner-container--new-category": newCategoryMode } }, !newCategoryMode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "help-text" }, i18n.helpText), renderDeleteConfirmationModal(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-schema-editor", { newCategoryMode: newCategoryMode, showInputByDefault: chosenTemplate === "custom", canEditCategory: () => true, categoryAggregationData: categoryAggregationData, categorySchema: categorySchema, canCollapseAll: !newCategoryMode, saveNewTitle: async ({ newSchema }) => 
            // We don't want to optimistic update here since the input has the loading spinner
            updateSchema({ schemaToUpdate: newSchema, optimisticUpdate: false }), saveNewCategory: async ({ newSchema }) => updateSchema({ schemaToUpdate: newSchema }), onArcgisSchemaEditorDelete: async ({ detail: { newSchema, categoryCount } }) => categoryCount
                ? (this.schemaToDelete = { schema: newSchema, count: categoryCount })
                : updateSchema({ schemaToUpdate: newSchema }), onArcgisSchemaEditorListOrderChange: async ({ detail: { newSchema } }) => updateSchema({ schemaToUpdate: newSchema }), onArcgisSchemaEditorInvalidMove: ({ detail: { errorCode } }) => {
                handleError(errorCode);
            }, onArcgisSchemaEditorTitleInvalid: ({ detail: { errorCode } }) => {
                handleError(errorCode);
            } }))), newCategoryMode && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", "data-id": "cancelButton", onClick: () => workflowCancel.emit(), width: "full" }, i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", "data-id": "nextButton", onClick: finishSetupNewCategorySchema, width: "full", disabled: !hasUnsavedChanges }, i18n.finishSetup)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "isActive": ["handleIsActiveChange"]
    }; }
};
ArcgisItemCategorySchemaEditor.style = arcgisItemCategorySchemaEditorCss;



//# sourceMappingURL=arcgis-item-category-schema-editor.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CATEGORY_BASE_PATH),
/* harmony export */   U: () => (/* binding */ UPPER_CATEGORY_BASE_PATH),
/* harmony export */   a: () => (/* binding */ getCategoryUIPath),
/* harmony export */   g: () => (/* binding */ getRootCategoryPath)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const CATEGORY_BASE_PATH = "/categories";
const UPPER_CATEGORY_BASE_PATH = "/Categories";

// TODO: add unit tests
/**
 * Construct the path of the category based on the parent path and the category title
 */
const getCategoryUIPath = (parentPath, category, lowerCase = true) => {
    const basePath = parentPath !== null && parentPath !== void 0 ? parentPath : "";
    return `${basePath}${basePath.endsWith("/") ? "" : "/"}${lowerCase ? category.title.toLocaleLowerCase() : category.title}`;
};
/**
 * Find the root node title to use for categories
 */
function getRootCategoryPath(categories) {
    var _a;
    let categoryTitle = (_a = categories === null || categories === void 0 ? void 0 : categories[0]) === null || _a === void 0 ? void 0 : _a.title;
    if (categoryTitle && categoryTitle.charAt(0) !== "/") {
        categoryTitle = `/${categoryTitle}`;
    }
    return categoryTitle || UPPER_CATEGORY_BASE_PATH;
}



//# sourceMappingURL=categories-ca134005.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getGroupRestBaseUrl)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const getGroupRestBaseUrl = (portal, group) => (0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_1__.a)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/community/groups/${group.id}`);



//# sourceMappingURL=group-6a6303b0.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isSubscriber),
/* harmony export */   b: () => (/* binding */ isPremium),
/* harmony export */   c: () => (/* binding */ canUpdateItem),
/* harmony export */   d: () => (/* binding */ itemsBelongToUserOrg),
/* harmony export */   g: () => (/* binding */ getItemHomeAppUrl),
/* harmony export */   i: () => (/* binding */ isOwner),
/* harmony export */   u: () => (/* binding */ userIsItemAdmin)
/* harmony export */ });
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function isEsri(item) {
    var _a;
    return !!((_a = item.owner) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes("esri"));
}
function isPremium(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Credits"));
}
function isSubscriber(item) {
    var _a;
    return isEsri(item) && !!((_a = item.typeKeywords) === null || _a === void 0 ? void 0 : _a.includes("Requires Subscription"));
}
function isOwner(item, user) {
    return item.owner === user.username;
}
/**
 * Can the user update the item
 */
function canUpdateItem(item, user) {
    return userIsItemAdmin(item, user) || item.itemControl === "update";
}
/**
 * Is the user either an owner or admin of the item
 */
function userIsItemAdmin(item, user) {
    return isOwner(item, user) || isItemAdmin(item, user);
}
/**
 * Does the user have admin capabilities on this item
 */
function isItemAdmin(item, user) {
    var _a;
    // if this flag is already set (probably home app), use it
    if (item.isAdmin != null) {
        return !!item.isAdmin;
    }
    const itemOwner = item.owner;
    const itemControlAdmin = item.itemControl === "admin";
    const esriUsers = ["esri_livingatlas", "esri_demographics", "esri_boundaries"];
    if (((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
        !isOwner(item, user) &&
        itemControlAdmin &&
        itemOwner.includes("esri_") &&
        // portal incorrectly returns "itemControl="admin" for esri owned items
        !esriUsers.includes(itemOwner)) {
        return false;
    }
    return itemControlAdmin;
}
const itemsBelongToUserOrg = (items, user) => {
    return !!user.orgId && items.every((item) => item.isOrgItem);
};
const getItemHomeAppUrl = (itemId, baseUrl) => `${(0,_url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_0__.a)(baseUrl)}item.html?id=${itemId}`;



//# sourceMappingURL=item-3535552d.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ isPublicUser),
/* harmony export */   b: () => (/* binding */ isOrgAdmin),
/* harmony export */   c: () => (/* binding */ isHostedPortal),
/* harmony export */   d: () => (/* binding */ isCustomRole),
/* harmony export */   e: () => (/* binding */ canUpdateOrgGroups),
/* harmony export */   f: () => (/* binding */ canUpdateItemCategories),
/* harmony export */   g: () => (/* binding */ canManageCollaborations),
/* harmony export */   h: () => (/* binding */ isOrgUser),
/* harmony export */   i: () => (/* binding */ isDeveloper),
/* harmony export */   j: () => (/* binding */ canShareItemToGroup),
/* harmony export */   k: () => (/* binding */ canShareItemToOrg),
/* harmony export */   l: () => (/* binding */ adminCanShareOthersItemToGroup),
/* harmony export */   m: () => (/* binding */ canShareOthersItemsToOrg),
/* harmony export */   n: () => (/* binding */ canShareItemToPublic),
/* harmony export */   o: () => (/* binding */ canShareOthersItemsToPublic),
/* harmony export */   p: () => (/* binding */ hasAdminSharePrivilege),
/* harmony export */   q: () => (/* binding */ canViewOthersOrgItems)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const getUserRole = (user) => {
    var _a, _b, _c;
    return typeof (user === null || user === void 0 ? void 0 : user.role) === "string" && !!(user === null || user === void 0 ? void 0 : user.role)
        ? user === null || user === void 0 ? void 0 : user.role
        : (_b = (_a = user === null || user === void 0 ? void 0 : user.roleId) !== null && _a !== void 0 ? _a : user === null || user === void 0 ? void 0 : user.id) !== null && _b !== void 0 ? _b : (_c = user === null || user === void 0 ? void 0 : user.sourceJSON) === null || _c === void 0 ? void 0 : _c.id;
};
function isPublicUser(user) {
    return user && !user.orgId;
}
function isHostedPortal(portal) {
    return !portal.isPortal || !!portal.isBackedBySDS;
}
function isDeveloper(subscriptionInfo) {
    const devSubscriptionTypes = ["Trial Developer", "Developer", "Developer Subscription"];
    return devSubscriptionTypes.includes(subscriptionInfo === null || subscriptionInfo === void 0 ? void 0 : subscriptionInfo.type);
}
function isOrgAdmin(user) {
    return getUserRole(user) === "org_admin" || getUserRole(user) === "account_admin";
}
function isOrgUser(user) {
    return getUserRole(user) === "org_user" || getUserRole(user) === "account_user";
}
function isCustomRole(user) {
    // The Home App collapse the `roleId` and `role` into a single `id` property, that's why
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/blob/master/src/js/arcgisonline/sharing/dijit/Role.ts#L469 works
    // In practice, we only need to check if `roleId` exist
    //  https://devtopia.esri.com/WebGIS/arcgis-portal-app/issues/44682#issuecomment-4146866
    return !!(user === null || user === void 0 ? void 0 : user.roleId) && user.roleId.length > 0;
}
/**
 * Checks whether the privilege "portal:admin:updateItemCategorySchema" is granted.
 */
function canUpdateItemCategories(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateItemCategorySchema"));
}
/**
 * Checks whether the privilege "portal:admin:updateGroups" is granted.
 */
function canUpdateOrgGroups(user) {
    var _a;
    return !!((_a = user === null || user === void 0 ? void 0 : user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:admin:updateGroups"));
}
/**
 * Checks whether the user is allowed to update other user's items in their organization.
 */
function canUpdateOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:updateItems");
}
/**
 * Checks to ensure the portal is an organization portal
 */
function isOrgPortal(portal) {
    return !!(portal.urlKey && portal.customBaseUrl) || !!portal.isPortal;
}
/**
 * Checks whether the user is allowed to share their item to groups
 */
function canShareItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToGroup");
}
/**
 * Checks whether the user can share an item on a given portal
 */
function canShare(user, portal) {
    return (!isOrgPortal(portal) ||
        canShareItemToGroup(user) ||
        canShareItemToOrg(user) ||
        (!!portal.canSharePublic && canShareItemToPublic(user)));
}
/**
 * Checks whether the user is allowed to share their item ot the organization.
 */
function canShareItemToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToOrg");
}
/**
 * Checks whether the user is allowed to share their item to public
 */
function canShareItemToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:user:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToOrg(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToOrg");
}
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItemsToPublic(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToPublic");
}
/**
 * Checks whether the user can share other user's items
 */
function adminCanShareOthersItemToGroup(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:shareToGroup");
}
/**
 * Checks whether the user is in an allowed organization and has the power to manage collaborations
 */
function canManageCollaborations(config, user, portal, subscriptionInfo) {
    const excludedOrgTypes = ["Trial", "Trial Press", "Trial Developer", "Developer Subscription", "Evaluation"];
    const isValidOrgType = subscriptionInfo && !excludedOrgTypes.includes(subscriptionInfo.type);
    const hasPrivilege = ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:manageCollaborations");
    return !!((config === null || config === void 0 ? void 0 : config.collaborationsEnabled) &&
        user &&
        (isOrgAdmin(user) || hasPrivilege) &&
        ((portal === null || portal === void 0 ? void 0 : portal.isPortal) || isValidOrgType));
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOrgItems(user) {
    return ((user === null || user === void 0 ? void 0 : user.privileges) || []).includes("portal:admin:viewItems");
}
/**
 * Checks whether the user can view other organization users' items
 */
function canViewOthersOrgItems(user) {
    return !!user && (!isCustomRole(user) || (isCustomRole(user) && canViewOrgItems(user)));
}
// TODO: add unit tests
const hasAdminSharePrivilege = ({ items, user, portal }) => {
    const item = items[0];
    // enterprise incorrectly returns items owned by "esri_" as item control admin (WebGIS/arcgis-portal-app#38695)
    const owner = item.owner;
    const whitelistOwner = ["esri_livingatlas"];
    if (portal.isPortal && owner !== user.username && owner.includes("esri_") && !whitelistOwner.includes(owner)) {
        return false;
    }
    const isOwnerOrAdmin = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.u)(item, user);
    const isCustom = isCustomRole(user);
    const canShareOrgItems = canShareOthersItems(user);
    const canUpdateAndShare = (0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.c)(item, user) &&
        canUpdateOrgItems(user) &&
        !isCustom &&
        (canShare(user, portal) || canShareOthersItems(user));
    // if it's the item owner or admin, or custom admin who can share
    return isOwnerOrAdmin || canUpdateAndShare || ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.d)(items, user) && canShareOrgItems);
};
/**
 * Checks whether the user can share other user's items
 */
function canShareOthersItems(user) {
    return adminCanShareOthersItemToGroup(user) || canShareOthersItemsToOrg(user) || canShareOthersItemsToPublic(user);
}



//# sourceMappingURL=privileges-5c382f61.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   H: () => (/* binding */ HIDDEN_ITEMS_QUERY)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const HIDDEN_ITEMS_QUERY = `-type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" -type:"Map Area" -typekeywords:"MapAreaPackage" -type:"Indoors Map Configuration" -typekeywords:"SMX"`;



//# sourceMappingURL=query-d62660d4.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/util-2a0e2f08.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/util-2a0e2f08.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   M: () => (/* binding */ MAX_CATEGORY_NAME_LENGTH),
/* harmony export */   a: () => (/* binding */ getNewCategorySchemaFromDelete),
/* harmony export */   b: () => (/* binding */ getCategoryFromPath),
/* harmony export */   c: () => (/* binding */ checkNewCategoryTitleValid),
/* harmony export */   d: () => (/* binding */ getNewCategorySchemaFromTitleChange),
/* harmony export */   e: () => (/* binding */ getNewCategorySchemaFromCategoryAdd),
/* harmony export */   f: () => (/* binding */ getPathLength),
/* harmony export */   g: () => (/* binding */ getNewCategorySchemaFromMove),
/* harmony export */   h: () => (/* binding */ getUICategoryFromCategorySchema),
/* harmony export */   i: () => (/* binding */ countNumCategories)
/* harmony export */ });
/* harmony import */ var _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./categories-ca134005.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// TODO: add unit tests
const getNewCategorySchemaFromMove = (category, { fromCategory: { path: fromPath }, toCategory: { path: toPath }, fromIndex, toIndex }) => {
    // Copy since this will be a destructive operation
    const uiCategory = structuredClone(category);
    const fromCategory = getCategoryFromPath(uiCategory, fromPath);
    let toCategory = fromCategory;
    if (fromPath !== toPath) {
        toCategory = getCategoryFromPath(uiCategory, toPath);
    }
    const [removed] = fromCategory.targetCategory.categories.splice(fromIndex, 1);
    toCategory.targetCategory.categories.splice(toIndex, 0, removed);
    return getCategorySchemaFromUICategory(uiCategory);
};
const getNewCategorySchemaFromTitleChange = (category, { newTitle, path }) => {
    const uiCategory = structuredClone(category);
    const categoryToChange = getCategoryFromPath(uiCategory, path);
    categoryToChange.targetCategory.title = newTitle;
    return getCategorySchemaFromUICategory(uiCategory);
};
const getNewCategorySchemaFromCategoryAdd = (category, { newTitle, path }) => {
    const uiCategory = structuredClone(category);
    // Remove the last part since it's just the placeholder
    // e.g. `/categories/category 1/new-input` -> `/categories/category 1`
    const containerPath = path.replace(/\/[^/]+$/, "");
    if (containerPath) {
        const { targetCategory } = getCategoryFromPath(uiCategory, containerPath);
        targetCategory.categories.push({ title: newTitle, categories: [], count: 0, path: null });
    }
    else {
        /**
         * This means we're adding a root level category when there is no category yet
         *
         * Can happens when we first set up the category schema
         */
        uiCategory.categories.push({ title: newTitle, categories: [], count: 0, path: null });
    }
    return getCategorySchemaFromUICategory(uiCategory);
};
const getNewCategorySchemaFromDelete = (category, { path }) => {
    const uiCategory = structuredClone(category);
    const { targetIndex, parentCategory } = getCategoryFromPath(uiCategory, path);
    parentCategory === null || parentCategory === void 0 ? void 0 : parentCategory.categories.splice(targetIndex, 1);
    return getCategorySchemaFromUICategory(uiCategory);
};
// * --- Utils
// Path we want to remove the base path since we count root as 0th level then also remove the beginning `/` to avoid empty string
const getPathLength = (path) => { var _a; return (_a = path === null || path === void 0 ? void 0 : path.replace(_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.C, "").slice(1).split("/").length) !== null && _a !== void 0 ? _a : 0; };
/**
 * Get the category from schema based on the path
 */
const getCategoryFromPath = (uiCategory, path) => {
    if (path == null || path === _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.C) {
        // Root level
        return { targetCategory: uiCategory, targetIndex: 1, parentCategory: null };
    }
    // Path starts with `/` so remove it
    const pathParts = path.slice(1).split("/");
    let curPath = path.indexOf(_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.C) === 0 ? (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.a)("", { title: pathParts.shift() }) : "";
    let parentCategory = null;
    let targetCategory = uiCategory;
    let targetIndex = 0;
    do {
        curPath = (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.a)(curPath, { title: pathParts.shift() });
        parentCategory = targetCategory;
        targetIndex = targetCategory.categories.findIndex((subcategory) => subcategory.path === curPath);
        targetCategory = targetCategory.categories[targetIndex];
    } while (pathParts.length > 0 && targetCategory.categories.length);
    return { targetCategory, targetIndex, parentCategory };
};
/**
 * Create a nested category schema from the aggregated search result starting from root
 */
const getUICategoryFromCategorySchema = (categorySchema, categoryAggregationData) => {
    var _a, _b;
    return ({
        title: "",
        path: null,
        count: (_b = (_a = categoryAggregationData.fieldValues.find((fieldValue) => fieldValue.value === _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.C)) === null || _a === void 0 ? void 0 : _a.count) !== null && _b !== void 0 ? _b : 0,
        categories: getUICategoryFromCategorySchemaRecursive(null, categorySchema, categoryAggregationData)
    });
};
const getCategorySchemaFromUICategory = (uiCategory) => uiCategory.categories.map(getCategoryFromUICategory);
const getCategoryFromUICategory = (uiCategory) => ({
    title: uiCategory.title,
    categories: uiCategory.categories.map(getCategoryFromUICategory)
});
const getUICategoryFromCategorySchemaRecursive = (parentPath, categorySchema, categoryAggregationData) => {
    return categorySchema.map((category) => {
        var _a, _b;
        const path = (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.a)(parentPath !== null && parentPath !== void 0 ? parentPath : _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_0__.C, category);
        const categoryCount = (_a = categoryAggregationData.fieldValues.find((fieldValue) => fieldValue.value === path)) === null || _a === void 0 ? void 0 : _a.count;
        const subcategories = getUICategoryFromCategorySchemaRecursive(path, (_b = category.categories) !== null && _b !== void 0 ? _b : [], categoryAggregationData);
        return {
            title: category.title,
            path,
            count: categoryCount !== null && categoryCount !== void 0 ? categoryCount : 0,
            categories: subcategories
        };
    });
};
const countNumCategories = (categorySchema) => {
    // + 1 is itself
    return categorySchema.reduce((acc, cur) => { var _a; return acc + 1 + countNumCategories((_a = cur.categories) !== null && _a !== void 0 ? _a : []); }, 0);
};
const checkNewCategoryTitleValid = ({ targetCategory, targetParentCategory }) => {
    var _a;
    const categoryLowerCaseTitle = (_a = targetCategory.title.toLocaleLowerCase()) === null || _a === void 0 ? void 0 : _a.trim();
    if (!categoryLowerCaseTitle) {
        return "emptyTitle";
    }
    if (categoryLowerCaseTitle.length > MAX_CATEGORY_NAME_LENGTH) {
        return "maxCharacter";
    }
    // No duplicate category name on the same level
    if (targetParentCategory.categories.some((category) => category.title.toLowerCase() === categoryLowerCaseTitle && category.path !== targetCategory.path)) {
        return "destinationHasSameName";
    }
    return null;
};
const MAX_CATEGORY_NAME_LENGTH = 100;



//# sourceMappingURL=util-2a0e2f08.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWNiZGM1Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNpSDtBQUNWO0FBQ2pDO0FBQ1Q7QUFDTTtBQUNNO0FBQ1g7QUFDQztBQUNqQztBQUNEO0FBQ0Y7QUFDUztBQUNEO0FBQ1A7QUFDRDtBQUNPO0FBQ0E7O0FBRWxDO0FBQ0EsMkJBQTJCLHNEQUFjLFNBQVMsa0JBQWtCLFNBQVMsUUFBUSxzREFBYyxTQUFTO0FBQzVHO0FBQ0EsWUFBWSxHQUFHLGlEQUFrQjtBQUNqQyxZQUFZLFlBQVksWUFBWSxFQUFFLGlEQUFrQixDQUFDO0FBQ3pEO0FBQ0EsbUNBQW1DLHNEQUFPLElBQUksSUFBSSx1Q0FBdUMsa0JBQWtCLG1DQUFtQztBQUM5SSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFNBQVM7QUFDMUI7QUFDQTtBQUNBLDhCQUE4QiwrQkFBK0I7QUFDN0Q7QUFDQSxvQ0FBb0MscURBQW1CLHFCQUFxQixzREFBYyxTQUFTLFdBQVcsVUFBVTtBQUN4SCxjQUFjLHNEQUFPLElBQUksWUFBWSx5QkFBeUIsaUNBQWlDLGdCQUFnQixHQUFHLElBQUk7QUFDdEg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsU0FBUztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxxREFBbUIscUJBQXFCLHNEQUFjLFNBQVMsV0FBVyxVQUFVO0FBQ3hILGNBQWMsc0RBQU8sSUFBSSxZQUFZLHlCQUF5QixJQUFJO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFNBQVM7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsdUNBQXVDLElBQUksbUNBQW1DLElBQUksK0JBQStCO0FBQ2xJLFlBQVksMERBQTBCO0FBQ3RD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QjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFFBQVEsc0VBQXNFLHNEQUFrQjtBQUNsSTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxzREFBa0I7QUFDbkQ7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHNEQUFrQixVQUFVLDBEQUFpQixPQUFPLDBCQUEwQjtBQUM3RztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwwREFBaUIsWUFBWSwwQkFBMEI7QUFDekU7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5R0FBeUcsc0RBQWtCO0FBQzNIO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDBEQUFpQiw2REFBNkQsc0RBQWtCO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFFBQVEsaUdBQWlHO0FBQzFKO0FBQ0Esc0NBQXNDLHNDQUFzQztBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW1WOztBQUVuViIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1pdGVtLWNhdGVnb3J5LXNjaGVtYS1lZGl0b3IuZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY2F0ZWdvcmllcy05ZjBmMzdlZS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jYXRlZ29yaWVzLWNhMTM0MDA1LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2dyb3VwLTZhNjMwM2IwLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2l0ZW0tMzUzNTU1MmQuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0wNTBiNmRiOS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3F1ZXJ5LWQ2MjY2MGQ0LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3V0aWwtMmEwZTJmMDguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEYgYXMgRnJhZ21lbnQsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYSBhcyBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcywgZyBhcyBnZXRJdGVtQ2F0ZWdvcnlTY2hlbWEgfSBmcm9tICcuL2NhdGVnb3JpZXMtOWYwZjM3ZWUuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgYSBhcyBpc1B1YmxpY1VzZXIgfSBmcm9tICcuL3ByaXZpbGVnZXMtNWMzODJmNjEuanMnO1xuaW1wb3J0IHsgTSBhcyBNQVhfQ0FURUdPUllfTkFNRV9MRU5HVEggfSBmcm9tICcuL3V0aWwtMmEwZTJmMDguanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRSZXN0QmFzZVVybCwgciBhcyByZXF1ZXN0IH0gZnJvbSAnLi9wb3J0YWwtZDUxOGI1NzEuanMnO1xuaW1wb3J0IHsgSCBhcyBISURERU5fSVRFTVNfUVVFUlkgfSBmcm9tICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0R3JvdXBSZXN0QmFzZVVybCB9IGZyb20gJy4vZ3JvdXAtNmE2MzAzYjAuanMnO1xuaW1wb3J0ICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vaXRlbS0zNTM1NTUyZC5qcyc7XG5pbXBvcnQgJy4vdXJsLTRjM2FlNTRjLmpzJztcbmltcG9ydCAnLi9jYXRlZ29yaWVzLWNhMTM0MDA1LmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcblxuY29uc3QgZ2V0SXRlbUNhdGVnb3J5QWdncmVnYXRpb24gPSBhc3luYyAodXNlciwgcG9ydGFsLCBncm91cCkgPT4ge1xuICAgIGNvbnN0IHVybCA9IGdyb3VwID8gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29udGVudC9ncm91cHMvJHtncm91cC5pZH0vYCA6IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9YDtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IGdyb3VwXG4gICAgICAgID8geyBxOiBISURERU5fSVRFTVNfUVVFUlksIGNvdW50RmllbGRzOiBcImFjY2Vzcyxjb250ZW50c3RhdHVzLGdyb3VwQ2F0ZWdvcmllc1wiIH1cbiAgICAgICAgOiB7IHE6IGBvcmdpZDoke3VzZXIub3JnSWR9ICR7SElEREVOX0lURU1TX1FVRVJZfWAsIGNvdW50RmllbGRzOiBcImNhdGVnb3JpZXNcIiB9O1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IGF3YWl0IHJlcXVlc3QoYCR7dXJsfXNlYXJjaGAsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcXVlcnlQYXJhbXMpLCB7IGNvdW50U2l6ZTogMjAwLCBudW06IDAsIGY6IFwianNvblwiIH0pKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBzZWFyY2hSZXN1bHQuYWdncmVnYXRpb25zLmNvdW50c1swXSB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmNvbnN0IHVwZGF0ZVNjaGVtYSA9IGFzeW5jICh7IHBvcnRhbCwgZ3JvdXAsIGNhdGVnb3J5U2NoZW1hIH0pID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBvcmdFbmRwb2ludCA9IGdyb3VwID8gZ2V0R3JvdXBSZXN0QmFzZVVybChwb3J0YWwsIGdyb3VwKSA6IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L3BvcnRhbHMvJHtwb3J0YWwuaWR9L2A7XG4gICAgICAgIGF3YWl0IHJlcXVlc3QoYCR7b3JnRW5kcG9pbnR9YXNzaWduQ2F0ZWdvcnlTY2hlbWFgLCB7IGNhdGVnb3J5U2NoZW1hOiBKU09OLnN0cmluZ2lmeSh7IGNhdGVnb3J5U2NoZW1hIH0pIH0sIHt9LCBcInBvc3RcIik7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5jb25zdCBkZWxldGVTY2hlbWEgPSBhc3luYyAocG9ydGFsLCBncm91cCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG9yZ0VuZHBvaW50ID0gZ3JvdXAgPyBnZXRHcm91cFJlc3RCYXNlVXJsKHBvcnRhbCwgZ3JvdXApIDogYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vcG9ydGFscy8ke3BvcnRhbC5pZH0vYDtcbiAgICAgICAgYXdhaXQgcmVxdWVzdChgJHtvcmdFbmRwb2ludH1kZWxldGVDYXRlZ29yeVNjaGVtYWAsIHt9LCB7fSwgXCJwb3N0XCIpO1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgICB9XG59O1xuY29uc3QgZ2V0U3RhbmRhcmRTZXRDYXRlZ29yaWVzID0gYXN5bmMgKHBvcnRhbCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IFt7IGNhdGVnb3J5U2NoZW1hOiBsaXZpbmdBdGxhc0NhdGVnb3JpZXMgfSwgeyBjYXRlZ29yeVNjaGVtYTogaW5zcGlyZUNhdGVnb3JpZXMgfSwgeyBjYXRlZ29yeVNjaGVtYTogaXNvQ2F0ZWdvcmllcyB9XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgXCJMaXZpbmdBdGxhc1wiKSxcbiAgICAgICAgICAgIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgXCJJbnNwaXJlXCIpLFxuICAgICAgICAgICAgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMocG9ydGFsLCBcIklTT1wiKVxuICAgICAgICBdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3VsdDogeyBMaXZpbmdBdGxhczogbGl2aW5nQXRsYXNDYXRlZ29yaWVzLCBJbnNwaXJlOiBpbnNwaXJlQ2F0ZWdvcmllcywgSVNPOiBpc29DYXRlZ29yaWVzIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5cbmNvbnN0IGNsZWFuRGF0YSA9IChjdXJEYXRhKSA9PiB7XG4gICAgY3VyRGF0YS5mb3JFYWNoKChkYXR1bSkgPT4ge1xuICAgICAgICBkYXR1bS5kZXNjcmlwdGlvbiAmJiBkZWxldGUgZGF0dW0uZGVzY3JpcHRpb247XG4gICAgICAgIGRhdHVtLmNhdGVnb3JpZXMgPyBjbGVhbkRhdGEoZGF0dW0uY2F0ZWdvcmllcykgOiAoZGF0dW0uY2F0ZWdvcmllcyA9IFtdKTtcbiAgICB9KTtcbn07XG4vKipcbiAqIFByZXBhcmUgYSBjYXRlZ29yeSBzY2hlbWEgb2JqZWN0IGZvciBzdWJtaXNzaW9uIHRvIHNlcnZlclxuICovXG5jb25zdCBjbGVhblRlbXBsYXRlRGF0YSA9IChvcmlnaW5hbFNjaGVtYSkgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IHN0cnVjdHVyZWRDbG9uZShvcmlnaW5hbFNjaGVtYSk7XG4gICAgY2xlYW5EYXRhKHNjaGVtYSk7XG4gICAgcmV0dXJuIHNjaGVtYTtcbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1DYXRlZ29yeVNjaGVtYUVkaXRvckNzcyA9IFwiLnN0YWdle2hlaWdodDoxMDAlO292ZXJmbG93OmhpZGRlbjstLXR3LXRyYW5zbGF0ZS14OjBweDt0cmFuc2Zvcm06dHJhbnNsYXRlKHZhcigtLXR3LXRyYW5zbGF0ZS14KSwgdmFyKC0tdHctdHJhbnNsYXRlLXkpKSByb3RhdGUodmFyKC0tdHctcm90YXRlKSkgc2tld1godmFyKC0tdHctc2tldy14KSkgc2tld1kodmFyKC0tdHctc2tldy15KSkgc2NhbGVYKHZhcigtLXR3LXNjYWxlLXgpKSBzY2FsZVkodmFyKC0tdHctc2NhbGUteSkpO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKTtkaXNwbGF5OmZsZXh9QG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDogMTA4MHB4KXsuc3RhZ2V7aGVpZ2h0Om1pbig3MDBweCwgNjB2aCl9fS5tb2RhbHstLWNhbGNpdGUtbW9kYWwtY29udGVudC1wYWRkaW5nOjA7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjQ4cmVtfS5tb2RhbC0tbGFyZ2V7LS1jYWxjaXRlLW1vZGFsLXdpZHRoOjEwODBweH0udGVtcGxhdGUtY29udGFpbmVye292ZXJmbG93OmF1dG87d2lkdGg6MjByZW07cGFkZGluZzoxcmVtfS50ZW1wbGF0ZS10aXRsZXttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tYm90dG9tOjFyZW07Zm9udC1zaXplOjEuMTI1cmVtfS50ZW1wbGF0ZS1saW5re2ZvbnQtc2l6ZTowLjc1cmVtfS5pbm5lci1jb250YWluZXJ7b3ZlcmZsb3c6YXV0bzt3aWR0aDoxMDAlO3BhZGRpbmc6MnJlbX0uaW5uZXItY29udGFpbmVyLS1uZXctY2F0ZWdvcnl7cGFkZGluZy1pbmxpbmUtc3RhcnQ6MC41cmVtO3BhZGRpbmc6MXJlbX0uaGVscC10ZXh0e21hcmdpbi10b3A6MHB4fS5jb25maXJtLW1vZGFsey0tY2FsY2l0ZS1tb2RhbC13aWR0aDozMnJlbX0uY29uZmlybS1tb2RhbC1jb250ZW50e3BhZGRpbmc6MXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUNhdGVnb3J5U2NoZW1hRWRpdG9yID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy53b3JrZmxvd0NhbmNlbCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwid29ya2Zsb3dDYW5jZWxcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3U2NoZW1hV29ya2Zsb3dDb21wbGV0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3U2NoZW1hV29ya2Zsb3dDb21wbGV0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5kZWxldGVBbGxTY2hlbWEgPSBjcmVhdGVFdmVudCh0aGlzLCBcImRlbGV0ZUFsbFNjaGVtYVwiLCA3KTtcbiAgICAgICAgdGhpcy5oYXNDaGFuZ2VTaW5jZUxhc3RPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGlkRmV0Y2hUZW1wbGF0ZXMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZUluZm8gPSB7XG4gICAgICAgICAgICAvLyBTY2hlbWEgd2lsbCBiZSBmaWxsZWQgaW4gbGF0ZXJcbiAgICAgICAgICAgIGN1c3RvbTogeyBzY2hlbWE6IFt7IHRpdGxlOiBcIkNhdGVnb3JpZXNcIiwgY2F0ZWdvcmllczogW10gfV0gfSxcbiAgICAgICAgICAgIGFyY2dpczogeyBzY2hlbWE6IFtdLCBsZWFybk1vcmVJZDogXCIxMjAwMDE1ODBcIiB9LFxuICAgICAgICAgICAgaXNvOiB7IHNjaGVtYTogW10sIGxlYXJuTW9yZUlkOiBcIjEyMDAwMTU4MVwiIH0sXG4gICAgICAgICAgICBpbnNwaXJlOiB7IHNjaGVtYTogW10sIGxlYXJuTW9yZUlkOiBcIjEyMDAwMTU4MlwiIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5mZXRjaENhdGVnb3J5RGF0YSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCwgc2V0Q2F0ZWdvcnlTY2hlbWEsIGdyb3VwLCB0ZW1wbGF0ZUluZm8sIGRpZEZldGNoVGVtcGxhdGVzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgW3sgcmVzdWx0OiBjYXRlZ29yeVNjaGVtYSB9LCB7IHJlc3VsdDogY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEgfV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAgICAgZ2V0SXRlbUNhdGVnb3J5U2NoZW1hKHsgdXNlciwgcG9ydGFsLCBncm91cCB9KSxcbiAgICAgICAgICAgICAgICBnZXRJdGVtQ2F0ZWdvcnlBZ2dyZWdhdGlvbih1c2VyLCBwb3J0YWwsIGdyb3VwKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBpZiAoISgoX2IgPSAoX2EgPSBjYXRlZ29yeVNjaGVtYSA9PT0gbnVsbCB8fCBjYXRlZ29yeVNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2F0ZWdvcnlTY2hlbWFbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYXRlZ29yaWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGNhbiBiZSBubyBjYXRlZ29yaWVzIG9yIG5vIHN1YmNhdGVnb3JpZXMgb3RoZXIgdGhhbiB0aGUgcm9vdFxuICAgICAgICAgICAgICAgIHRoaXMucm9vdENhdGVnb3J5VGl0bGUgPSBcIkNhdGVnb3JpZXNcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmNhdGVnb3J5U2NoZW1hID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdDYXRlZ29yeU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICghZGlkRmV0Y2hUZW1wbGF0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZldGNoaW5nVGVtcGxhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBoYW5kbGUgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyByZXN1bHQgfSA9IGF3YWl0IGdldFN0YW5kYXJkU2V0Q2F0ZWdvcmllcyhwb3J0YWwpO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXJjZ2lzLnNjaGVtYSA9IHJlc3VsdC5MaXZpbmdBdGxhcztcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVJbmZvLmlzby5zY2hlbWEgPSByZXN1bHQuSVNPO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUluZm8uaW5zcGlyZS5zY2hlbWEgPSByZXN1bHQuSW5zcGlyZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWRGZXRjaFRlbXBsYXRlcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNGZXRjaGluZ1RlbXBsYXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldENhdGVnb3J5U2NoZW1hKGNhdGVnb3J5U2NoZW1hKTtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEgPSBjYXRlZ29yeUFnZ3JlZ2F0aW9uRGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXRDYXRlZ29yeVNjaGVtYSA9IChjYXRlZ29yeVNjaGVtYSkgPT4ge1xuICAgICAgICAgICAgLy8gVGhlIGZpcnN0IG9uZSBpcyBhbHdheXMgdGhlIHJvb3QgY2F0ZWdvcnkgd2l0aCB0aXRsZSBcIkNhdGVnb3JpZXNcIiB3aGljaCB3ZSBkb24ndCBjYXJlIGFib3V0XG4gICAgICAgICAgICB0aGlzLnJvb3RDYXRlZ29yeVRpdGxlID0gY2F0ZWdvcnlTY2hlbWFbMF0udGl0bGU7IC8vIEJ1dCB3ZSBzdGlsbCBuZWVkIHRvIGFkZCBpdCBiYWNrIHdoZW4gY2FsbGluZyB1cGRhdGVcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlTY2hlbWEgPSBjYXRlZ29yeVNjaGVtYVswXS5jYXRlZ29yaWVzO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zY2hlbWFUb0RlbGV0ZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q2FuY2VsLmVtaXQoeyBoYXNDaGFuZ2VTaW5jZUxhc3RPcGVuOiB0aGlzLmhhc0NoYW5nZVNpbmNlTGFzdE9wZW4gfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlU2NoZW1hID0gYXN5bmMgKHsgc2NoZW1hVG9VcGRhdGUsIGlnbm9yZU5ld0NhdGVnb3J5TW9kZSA9IGZhbHNlLCBvcHRpbWlzdGljVXBkYXRlID0gdHJ1ZSB9KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHBvcnRhbCwgcm9vdENhdGVnb3J5VGl0bGUsIGhhbmRsZUVycm9yLCBmZXRjaENhdGVnb3J5RGF0YSwgbmV3Q2F0ZWdvcnlNb2RlLCBncm91cCwgZGVsZXRlQWxsU2NoZW1hIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKG5ld0NhdGVnb3J5TW9kZSAmJiAhaWdub3JlTmV3Q2F0ZWdvcnlNb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYXNVbnNhdmVkQ2hhbmdlcyA9IHNjaGVtYVRvVXBkYXRlLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jYXRlZ29yeVNjaGVtYSA9IHNjaGVtYVRvVXBkYXRlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5oYXNDaGFuZ2VTaW5jZUxhc3RPcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vIE9wdGltaXN0aWMgdXBkYXRlXG4gICAgICAgICAgICBjb25zdCBwcmV2U2NoZW1hID0gdGhpcy5jYXRlZ29yeVNjaGVtYTtcbiAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUgJiYgKHRoaXMuY2F0ZWdvcnlTY2hlbWEgPSBzY2hlbWFUb1VwZGF0ZSk7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVTY2hlbWFIZWxwZXIgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gc2NoZW1hIGxlZnQsIHdlIGNhbGwgZGVsZXRlIGluc3RlYWQgb2YgdXBkYXRlXG4gICAgICAgICAgICAgICAgaWYgKHNjaGVtYVRvVXBkYXRlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBkZWxldGVTY2hlbWEocG9ydGFsLCBncm91cCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV3Q2F0ZWdvcnlNb2RlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUFsbFNjaGVtYS5lbWl0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBoYW5kbGUgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVycm9yKFwiZ2VuZXJpY1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUgJiYgKHRoaXMuY2F0ZWdvcnlTY2hlbWEgPSBwcmV2U2NoZW1hKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHVwZGF0ZVNjaGVtYSh7XG4gICAgICAgICAgICAgICAgICAgIHBvcnRhbCxcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTY2hlbWE6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcm9vdENhdGVnb3J5VGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllczogbmV3Q2F0ZWdvcnlNb2RlID8gY2xlYW5UZW1wbGF0ZURhdGEoc2NoZW1hVG9VcGRhdGUpIDogc2NoZW1hVG9VcGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzVW5zYXZlZENoYW5nZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZmV0Y2hDYXRlZ29yeURhdGEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVFcnJvcihcImdlbmVyaWNcIik7XG4gICAgICAgICAgICAgICAgICAgIG9wdGltaXN0aWNVcGRhdGUgJiYgKHRoaXMuY2F0ZWdvcnlTY2hlbWEgPSBwcmV2U2NoZW1hKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBKdXN0IHJldHVybiB0cnVlIHdpdGhvdXQgYGF3YWl0YCBzbyB0aGUgb3B0aW1pc3RpYyB1cGRhdGUgd29ya3NcbiAgICAgICAgICAgICAqICB3aGljaCB3aWxsIGRpc2FibGUgdGhlIG5ldyBjYXRlZ29yeSBpbnB1dCByaWdodCBhd2F5IGFuZCByb2xsYmFjayBpZiB0aGVyZSdzIGFuIGVycm9yXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHVwZGF0ZVNjaGVtYUhlbHBlcigpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmluaXNoU2V0dXBOZXdDYXRlZ29yeVNjaGVtYSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbmV3U2NoZW1hV29ya2Zsb3dDb21wbGV0ZSwgY2F0ZWdvcnlTY2hlbWEsIHVwZGF0ZVNjaGVtYSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB1cGRhdGVTY2hlbWEoe1xuICAgICAgICAgICAgICAgIHNjaGVtYVRvVXBkYXRlOiBjYXRlZ29yeVNjaGVtYSxcbiAgICAgICAgICAgICAgICBpZ25vcmVOZXdDYXRlZ29yeU1vZGU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5ld0NhdGVnb3J5TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG5ld1NjaGVtYVdvcmtmbG93Q29tcGxldGUuZW1pdCh7IG5ld1NjaGVtYTogY2F0ZWdvcnlTY2hlbWEgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGVzID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB0ZW1wbGF0ZUluZm8sIGkxOG4sIGNob3NlblRlbXBsYXRlLCBjb25maWcsIHNldENhdGVnb3J5U2NoZW1hIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwQmFzZSwgaGVscE1hcCB9ID0gY29uZmlnO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwidGVtcGxhdGUtY29udGFpbmVyXCIgfSwgaChcInBcIiwgeyBjbGFzczogXCJ0ZW1wbGF0ZS10aXRsZVwiIH0sIGkxOG4udGVtcGxhdGUudGl0bGUpLCBoKFwiY2FsY2l0ZS10aWxlLXNlbGVjdC1ncm91cFwiLCBudWxsLCBPYmplY3Qua2V5cyh0ZW1wbGF0ZUluZm8pLm1hcCgodGVtcGxhdGVLZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxlYXJuTW9yZUlkIH0gPSB0ZW1wbGF0ZUluZm9bdGVtcGxhdGVLZXldO1xuICAgICAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdGlsZS1zZWxlY3RcIiwgeyBrZXk6IHRlbXBsYXRlS2V5LCBjaGVja2VkOiBjaG9zZW5UZW1wbGF0ZSA9PT0gdGVtcGxhdGVLZXksIGRlc2NyaXB0aW9uOiBpMThuLnRlbXBsYXRlLnRlbXBsYXRlTGlzdFt0ZW1wbGF0ZUtleV0ubWVzc2FnZSwgaGVhZGluZzogaTE4bi50ZW1wbGF0ZS50ZW1wbGF0ZUxpc3RbdGVtcGxhdGVLZXldLnRpdGxlLCB3aWR0aDogXCJhdXRvXCIsIHZhbHVlOiB0ZW1wbGF0ZUtleSwgb25DYWxjaXRlVGlsZVNlbGVjdENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RlbXBsYXRlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNob3NlblRlbXBsYXRlID0gbmV3VGVtcGxhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXRlZ29yeVNjaGVtYSh0ZW1wbGF0ZUluZm9bbmV3VGVtcGxhdGVdLnNjaGVtYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2VyIGNhbiBzYXZlIGEgdGVtcGxhdGUgYXMgaXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzVW5zYXZlZENoYW5nZXMgPSBuZXdUZW1wbGF0ZSAhPT0gXCJjdXN0b21cIjtcbiAgICAgICAgICAgICAgICAgICAgfSB9LCBsZWFybk1vcmVJZCAmJiAoaChcImNhbGNpdGUtbGlua1wiLCB7IGhyZWY6IGAke2hlbHBCYXNlfSR7aGVscE1hcFtsZWFybk1vcmVJZF19YCwgcm9sZTogXCJwcmVzZW50YXRpb25cIiwgY2xhc3M6IFwidGVtcGxhdGUtbGlua1wiLCBpY29uRW5kOiBcImxhdW5jaFwiLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIHJlbDogXCJub29wZW5lciBub3JlZmVycmVyXCIgfSwgaTE4bi50ZW1wbGF0ZS5sZWFybk1vcmUpKSkpO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyRGVsZXRlQ29uZmlybWF0aW9uTW9kYWwgPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCB7IGkxOG4sIHVwZGF0ZVNjaGVtYSwgc2NoZW1hVG9EZWxldGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoIXNjaGVtYVRvRGVsZXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsga2luZDogXCJkYW5nZXJcIiwgc2NhbGU6IFwibVwiLCB3aWR0aFNjYWxlOiBcInNcIiwgb25DYWxjaXRlTW9kYWxDbG9zZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVtYVRvRGVsZXRlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9LCBvcGVuOiAhIXNjaGVtYVRvRGVsZXRlLCBjbGFzczogXCJjb25maXJtLW1vZGFsXCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiaGVhZGVyXCIgfSwgaTE4bi53YXJuaW5nLmRlbGV0ZUluVXNlQ2F0ZWdvcnkudGl0bGUpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50XCIsIGNsYXNzOiBcImNvbmZpcm0tbW9kYWwtY29udGVudFwiIH0sIGkxOG4ud2FybmluZy5kZWxldGVJblVzZUNhdGVnb3J5Lm1lc3NhZ2UucmVwbGFjZShcIiR7bnVtSXRlbX1cIiwgKF9hID0gc2NoZW1hVG9EZWxldGUuY291bnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvY2FsZVN0cmluZygpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwic2Vjb25kYXJ5XCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZVwiLCBcImRhdGEtaWRcIjogXCJjYW5jZWxCdXR0b25cIiwgb25DbGljazogKCkgPT4gKHRoaXMuc2NoZW1hVG9EZWxldGUgPSBudWxsKSwgd2lkdGg6IFwiZnVsbFwiIH0sIGkxOG4uY2FuY2VsKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgXCJkYXRhLWlkXCI6IFwibmV4dEJ1dHRvblwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVNjaGVtYSh7IHNjaGVtYVRvVXBkYXRlOiBzY2hlbWFUb0RlbGV0ZS5zY2hlbWEgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1hVG9EZWxldGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sIHdpZHRoOiBcImZ1bGxcIiB9LCBpMThuLndhcm5pbmcuZGVsZXRlSW5Vc2VDYXRlZ29yeS5jdGEpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3IgPSAodHlwZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBpMThuLmVycm9yW3R5cGVdLm1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJtYXhDaGFyYWN0ZXJcIikge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoXCIke21heENoYXJhY3Rlcn1cIiwgYCR7TUFYX0NBVEVHT1JZX05BTUVfTEVOR1RIfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lcnJvciA9IHsgdGl0bGU6IGkxOG4uZXJyb3JbdHlwZV0udGl0bGUsIG1lc3NhZ2UgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubmV3Q2F0ZWdvcnlNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2F0ZWdvcnlTY2hlbWEgPSBbXTtcbiAgICAgICAgdGhpcy5jYXRlZ29yeUFnZ3JlZ2F0aW9uRGF0YSA9IHtcbiAgICAgICAgICAgIGZpZWxkTmFtZTogXCJjYXRlZ29yaWVzXCIsXG4gICAgICAgICAgICBmaWVsZFZhbHVlczogW11cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYXNVbnNhdmVkQ2hhbmdlcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgICAgIHRoaXMuaXNGZXRjaGluZ1NjaGVtYU9uQWN0aXZlQ2hhbmdlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNGZXRjaGluZ1RlbXBsYXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2NoZW1hVG9EZWxldGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2hvc2VuVGVtcGxhdGUgPSBcImN1c3RvbVwiO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLmhhbmRsZUlzQWN0aXZlQ2hhbmdlKCk7XG4gICAgfVxuICAgIGFzeW5jIGhhbmRsZUlzQWN0aXZlQ2hhbmdlKCkge1xuICAgICAgICAvLyBKdXN0IHdhbnQgdG8gcmVzZXQgdGhpcyB3aGVuZXZlciBpc0FjdGl2ZSBjaGFuZ2VzXG4gICAgICAgIHRoaXMuaGFzQ2hhbmdlU2luY2VMYXN0T3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNob3NlblRlbXBsYXRlID0gXCJjdXN0b21cIjtcbiAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgICAgIHRoaXMuc2NoZW1hVG9EZWxldGUgPSBudWxsO1xuICAgICAgICAvLyBQdWJsaWMgdXNlciBkb2Vzbid0IGhhdmUgYWNjZXNzIHRvIGNhdGVnb3JpZXMgdW5sZXNzIHRoZXkgZG8gaXQgdGhyb3VnaCBncm91cFxuICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZSAmJiAoIWlzUHVibGljVXNlcih0aGlzLnVzZXIpIHx8IHRoaXMuZ3JvdXApKSB7XG4gICAgICAgICAgICB0aGlzLmlzRmV0Y2hpbmdTY2hlbWFPbkFjdGl2ZUNoYW5nZSA9IHRydWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmZldGNoQ2F0ZWdvcnlEYXRhKCk7XG4gICAgICAgICAgICB0aGlzLmlzRmV0Y2hpbmdTY2hlbWFPbkFjdGl2ZUNoYW5nZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBuZXdDYXRlZ29yeU1vZGUsIGNhdGVnb3J5U2NoZW1hLCBjYXRlZ29yeUFnZ3JlZ2F0aW9uRGF0YSwgaXNBY3RpdmUsIGlzRmV0Y2hpbmdTY2hlbWFPbkFjdGl2ZUNoYW5nZSwgY2xvc2VEaWFsb2csIGkxOG4sIHVwZGF0ZVNjaGVtYSwgZXJyb3IsIHJlbmRlclRlbXBsYXRlcywgY2hvc2VuVGVtcGxhdGUsIGlzRmV0Y2hpbmdUZW1wbGF0ZSwgd29ya2Zsb3dDYW5jZWwsIGZpbmlzaFNldHVwTmV3Q2F0ZWdvcnlTY2hlbWEsIGhhc1Vuc2F2ZWRDaGFuZ2VzLCBoYW5kbGVFcnJvciwgcmVuZGVyRGVsZXRlQ29uZmlybWF0aW9uTW9kYWwgfSA9IHRoaXM7XG4gICAgICAgIC8vICEgSGF2ZSB0byBjaGVjayBmb3IgaXNGZXRjaGluZ1NjaGVtYU9uQWN0aXZlQ2hhbmdlIG9yIHRoZSBtb2RhbCB3aWR0aCB3b24ndCBjaGFuZ2UgZHluYW1pY2FsbHkgb25jZSBpdCdzIHJlbmRlcmVkXG4gICAgICAgIGlmICghaXNBY3RpdmUgfHwgaXNGZXRjaGluZ1NjaGVtYU9uQWN0aXZlQ2hhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgb3BlbjogaXNBY3RpdmUsIG9uQ2FsY2l0ZU1vZGFsQ2xvc2U6IGNsb3NlRGlhbG9nLCBzY2FsZTogXCJtXCIsIGNsYXNzOiB7IG1vZGFsOiB0cnVlLCBcIm1vZGFsLS1sYXJnZVwiOiBuZXdDYXRlZ29yeU1vZGUgfSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJoZWFkZXJcIiwgY2xhc3M6IFwiaGVhZGVyXCIgfSwgaTE4bi5tb2RhbEhlYWRlciksIGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwic3RhZ2VcIiB9LCBoKFwiY2FsY2l0ZS1hbGVydFwiLCB7IGljb246IHRydWUsIG9wZW46ICEhZXJyb3IsIGxhYmVsOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IudGl0bGUsIGtpbmQ6IFwiZGFuZ2VyXCIsIG9uQ2FsY2l0ZUFsZXJ0Q2xvc2U6ICgpID0+ICh0aGlzLmVycm9yID0gbnVsbCkgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlKSksIGlzRmV0Y2hpbmdUZW1wbGF0ZSAmJiBoKFwiY2FsY2l0ZS1zY3JpbVwiLCB7IGxvYWRpbmc6IHRydWUgfSwgaTE4bi5sb2FkaW5nVGV4dCksIG5ld0NhdGVnb3J5TW9kZSAmJiByZW5kZXJUZW1wbGF0ZXMoKSwgaChcImRpdlwiLCB7IGNsYXNzOiB7IFwiaW5uZXItY29udGFpbmVyXCI6IHRydWUsIFwiaW5uZXItY29udGFpbmVyLS1uZXctY2F0ZWdvcnlcIjogbmV3Q2F0ZWdvcnlNb2RlIH0gfSwgIW5ld0NhdGVnb3J5TW9kZSAmJiBoKFwicFwiLCB7IGNsYXNzOiBcImhlbHAtdGV4dFwiIH0sIGkxOG4uaGVscFRleHQpLCByZW5kZXJEZWxldGVDb25maXJtYXRpb25Nb2RhbCgpLCBoKFwiYXJjZ2lzLXNjaGVtYS1lZGl0b3JcIiwgeyBuZXdDYXRlZ29yeU1vZGU6IG5ld0NhdGVnb3J5TW9kZSwgc2hvd0lucHV0QnlEZWZhdWx0OiBjaG9zZW5UZW1wbGF0ZSA9PT0gXCJjdXN0b21cIiwgY2FuRWRpdENhdGVnb3J5OiAoKSA9PiB0cnVlLCBjYXRlZ29yeUFnZ3JlZ2F0aW9uRGF0YTogY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEsIGNhdGVnb3J5U2NoZW1hOiBjYXRlZ29yeVNjaGVtYSwgY2FuQ29sbGFwc2VBbGw6ICFuZXdDYXRlZ29yeU1vZGUsIHNhdmVOZXdUaXRsZTogYXN5bmMgKHsgbmV3U2NoZW1hIH0pID0+IFxuICAgICAgICAgICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBvcHRpbWlzdGljIHVwZGF0ZSBoZXJlIHNpbmNlIHRoZSBpbnB1dCBoYXMgdGhlIGxvYWRpbmcgc3Bpbm5lclxuICAgICAgICAgICAgdXBkYXRlU2NoZW1hKHsgc2NoZW1hVG9VcGRhdGU6IG5ld1NjaGVtYSwgb3B0aW1pc3RpY1VwZGF0ZTogZmFsc2UgfSksIHNhdmVOZXdDYXRlZ29yeTogYXN5bmMgKHsgbmV3U2NoZW1hIH0pID0+IHVwZGF0ZVNjaGVtYSh7IHNjaGVtYVRvVXBkYXRlOiBuZXdTY2hlbWEgfSksIG9uQXJjZ2lzU2NoZW1hRWRpdG9yRGVsZXRlOiBhc3luYyAoeyBkZXRhaWw6IHsgbmV3U2NoZW1hLCBjYXRlZ29yeUNvdW50IH0gfSkgPT4gY2F0ZWdvcnlDb3VudFxuICAgICAgICAgICAgICAgID8gKHRoaXMuc2NoZW1hVG9EZWxldGUgPSB7IHNjaGVtYTogbmV3U2NoZW1hLCBjb3VudDogY2F0ZWdvcnlDb3VudCB9KVxuICAgICAgICAgICAgICAgIDogdXBkYXRlU2NoZW1hKHsgc2NoZW1hVG9VcGRhdGU6IG5ld1NjaGVtYSB9KSwgb25BcmNnaXNTY2hlbWFFZGl0b3JMaXN0T3JkZXJDaGFuZ2U6IGFzeW5jICh7IGRldGFpbDogeyBuZXdTY2hlbWEgfSB9KSA9PiB1cGRhdGVTY2hlbWEoeyBzY2hlbWFUb1VwZGF0ZTogbmV3U2NoZW1hIH0pLCBvbkFyY2dpc1NjaGVtYUVkaXRvckludmFsaWRNb3ZlOiAoeyBkZXRhaWw6IHsgZXJyb3JDb2RlIH0gfSkgPT4ge1xuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9yKGVycm9yQ29kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NjaGVtYUVkaXRvclRpdGxlSW52YWxpZDogKHsgZGV0YWlsOiB7IGVycm9yQ29kZSB9IH0pID0+IHtcbiAgICAgICAgICAgICAgICBoYW5kbGVFcnJvcihlcnJvckNvZGUpO1xuICAgICAgICAgICAgfSB9KSkpLCBuZXdDYXRlZ29yeU1vZGUgJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwic2Vjb25kYXJ5XCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIFwiZGF0YS1pZFwiOiBcImNhbmNlbEJ1dHRvblwiLCBvbkNsaWNrOiAoKSA9PiB3b3JrZmxvd0NhbmNlbC5lbWl0KCksIHdpZHRoOiBcImZ1bGxcIiB9LCBpMThuLmNhbmNlbCksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwicHJpbWFyeVwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIFwiZGF0YS1pZFwiOiBcIm5leHRCdXR0b25cIiwgb25DbGljazogZmluaXNoU2V0dXBOZXdDYXRlZ29yeVNjaGVtYSwgd2lkdGg6IFwiZnVsbFwiLCBkaXNhYmxlZDogIWhhc1Vuc2F2ZWRDaGFuZ2VzIH0sIGkxOG4uZmluaXNoU2V0dXApKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwiaXNBY3RpdmVcIjogW1wiaGFuZGxlSXNBY3RpdmVDaGFuZ2VcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzSXRlbUNhdGVnb3J5U2NoZW1hRWRpdG9yLnN0eWxlID0gYXJjZ2lzSXRlbUNhdGVnb3J5U2NoZW1hRWRpdG9yQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNJdGVtQ2F0ZWdvcnlTY2hlbWFFZGl0b3IgYXMgYXJjZ2lzX2l0ZW1fY2F0ZWdvcnlfc2NoZW1hX2VkaXRvciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaXRlbS1jYXRlZ29yeS1zY2hlbWEtZWRpdG9yLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIHIgYXMgcmVxdWVzdCwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEdyb3VwUmVzdEJhc2VVcmwgfSBmcm9tICcuL2dyb3VwLTZhNjMwM2IwLmpzJztcbmltcG9ydCB7IGEgYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcblxuY29uc3QgZ2V0SXRlbUNhdGVnb3J5U2NoZW1hID0gYXN5bmMgKHsgcG9ydGFsLCB1c2VyLCBncm91cCwgdXNlQ2FjaGUgPSBmYWxzZSB9KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZldGNoUmVzdWx0ID0gYXdhaXQgKGdyb3VwXG4gICAgICAgICAgICA/IGZldGNoR3JvdXBDYXRlZ29yaWVzKGdyb3VwLmlkLCBwb3J0YWwsIHVzZUNhY2hlKVxuICAgICAgICAgICAgOiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IChfYSA9IGZldGNoUmVzdWx0ID09PSBudWxsIHx8IGZldGNoUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmZXRjaFJlc3VsdC5jYXRlZ29yeVNjaGVtYSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbCB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufTtcbmFzeW5jIGZ1bmN0aW9uIGZldGNoQ2F0ZWdvcmllcyhwb3J0YWwsIHVzZXIsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIHVzZXIgIT09IG51bGwgJiYgdXNlciAhPT0gdm9pZCAwID8gdXNlciA6ICh1c2VyID0gY29uZmlnU3RhdGUudXNlcik7XG4gICAgaWYgKCEocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmlkKSB8fCAodXNlciAmJiBpc1B1YmxpY1VzZXIodXNlcikpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy8ke3BvcnRhbC5pZH0vY2F0ZWdvcnlTY2hlbWFgKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIHBvcnRhbC5pZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoR3JvdXBDYXRlZ29yaWVzKGdyb3VwSWQsIHBvcnRhbCwgdXNlQ2FjaGUgPSB0cnVlKSB7XG4gICAgcG9ydGFsICE9PSBudWxsICYmIHBvcnRhbCAhPT0gdm9pZCAwID8gcG9ydGFsIDogKHBvcnRhbCA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgIGlmICghZ3JvdXBJZCB8fCAhcG9ydGFsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiByZXF1ZXN0KGAke2dldEdyb3VwUmVzdEJhc2VVcmwocG9ydGFsLCB7IGlkOiBncm91cElkIH0pfWNhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBncm91cElkKSA6IGdldFNjaGVtYSgpO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMaXZpbmdBdGxhc1NjaGVtYShwb3J0YWwsIGNhdGVnb3J5TmFtZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBiYXNlID0gZ2V0UmVzdEJhc2VVcmwocG9ydGFsKTtcbiAgICBjb25zdCBzZWxmID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfXBvcnRhbHMvc2VsZmApO1xuICAgIGNvbnN0IGdyb3VwU2VhcmNoID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlfWNvbW11bml0eS9ncm91cHM/cT0ke3NlbGYuY29udGVudENhdGVnb3J5U2V0c0dyb3VwUXVlcnl9YCk7XG4gICAgY29uc3QgY2F0ZWdvcnlHcm91cCA9IChfYSA9IGdyb3VwU2VhcmNoID09PSBudWxsIHx8IGdyb3VwU2VhcmNoID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cFNlYXJjaC5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF07XG4gICAgY29uc3Qgc2NoZW1hSXRlbVNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb250ZW50L2dyb3Vwcy8ke2NhdGVnb3J5R3JvdXAuaWR9L3NlYXJjaGAsIHtcbiAgICAgICAgcTogYHR5cGVrZXl3b3JkczogJHtjYXRlZ29yeU5hbWV9YFxuICAgIH0pO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW0gPSBzY2hlbWFJdGVtU2VhcmNoLnJlc3VsdHNbMF07XG4gICAgcmV0dXJuIHJlcXVlc3QoYCR7YmFzZX1jb250ZW50L2l0ZW1zLyR7c2NoZW1hSXRlbS5pZH0vZGF0YWApO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMocG9ydGFsLCBjYXRlZ29yeU5hbWUsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIGNvbnN0IGdldFNjaGVtYSA9ICgpID0+IGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgY2F0ZWdvcnlOYW1lKSA6IGdldFNjaGVtYSgpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ2F0ZWdvcmllcyh7IGNhdGVnb3JpZXMsIGl0ZW1JZHMsIHBvcnRhbCB9KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7Z2V0UmVzdEJhc2VVcmwocG9ydGFsKX0vY29udGVudC91cGRhdGVJdGVtc2A7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gSlNPTi5zdHJpbmdpZnkoaXRlbUlkcy5tYXAoKGlkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIFtpZF06IHsgY2F0ZWdvcmllczogQXJyYXkuaXNBcnJheShjYXRlZ29yaWVzKSA/IGNhdGVnb3JpZXMgOiBjYXRlZ29yaWVzW2lkXSB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogYXdhaXQgcmVxdWVzdCh1cmwsIHsgaXRlbXMgfSwge30sIFwicG9zdFwiKSB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBmZXRjaExpdmluZ0F0bGFzQ2F0ZWdvcmllcyBhcyBhLCBmZXRjaEdyb3VwQ2F0ZWdvcmllcyBhcyBiLCBmZXRjaENhdGVnb3JpZXMgYXMgZiwgZ2V0SXRlbUNhdGVnb3J5U2NoZW1hIGFzIGcsIHVwZGF0ZUNhdGVnb3JpZXMgYXMgdSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYXRlZ29yaWVzLTlmMGYzN2VlLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuY29uc3QgQ0FURUdPUllfQkFTRV9QQVRIID0gXCIvY2F0ZWdvcmllc1wiO1xuY29uc3QgVVBQRVJfQ0FURUdPUllfQkFTRV9QQVRIID0gXCIvQ2F0ZWdvcmllc1wiO1xuXG4vLyBUT0RPOiBhZGQgdW5pdCB0ZXN0c1xuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIHBhdGggb2YgdGhlIGNhdGVnb3J5IGJhc2VkIG9uIHRoZSBwYXJlbnQgcGF0aCBhbmQgdGhlIGNhdGVnb3J5IHRpdGxlXG4gKi9cbmNvbnN0IGdldENhdGVnb3J5VUlQYXRoID0gKHBhcmVudFBhdGgsIGNhdGVnb3J5LCBsb3dlckNhc2UgPSB0cnVlKSA9PiB7XG4gICAgY29uc3QgYmFzZVBhdGggPSBwYXJlbnRQYXRoICE9PSBudWxsICYmIHBhcmVudFBhdGggIT09IHZvaWQgMCA/IHBhcmVudFBhdGggOiBcIlwiO1xuICAgIHJldHVybiBgJHtiYXNlUGF0aH0ke2Jhc2VQYXRoLmVuZHNXaXRoKFwiL1wiKSA/IFwiXCIgOiBcIi9cIn0ke2xvd2VyQ2FzZSA/IGNhdGVnb3J5LnRpdGxlLnRvTG9jYWxlTG93ZXJDYXNlKCkgOiBjYXRlZ29yeS50aXRsZX1gO1xufTtcbi8qKlxuICogRmluZCB0aGUgcm9vdCBub2RlIHRpdGxlIHRvIHVzZSBmb3IgY2F0ZWdvcmllc1xuICovXG5mdW5jdGlvbiBnZXRSb290Q2F0ZWdvcnlQYXRoKGNhdGVnb3JpZXMpIHtcbiAgICB2YXIgX2E7XG4gICAgbGV0IGNhdGVnb3J5VGl0bGUgPSAoX2EgPSBjYXRlZ29yaWVzID09PSBudWxsIHx8IGNhdGVnb3JpZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNhdGVnb3JpZXNbMF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aXRsZTtcbiAgICBpZiAoY2F0ZWdvcnlUaXRsZSAmJiBjYXRlZ29yeVRpdGxlLmNoYXJBdCgwKSAhPT0gXCIvXCIpIHtcbiAgICAgICAgY2F0ZWdvcnlUaXRsZSA9IGAvJHtjYXRlZ29yeVRpdGxlfWA7XG4gICAgfVxuICAgIHJldHVybiBjYXRlZ29yeVRpdGxlIHx8IFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSDtcbn1cblxuZXhwb3J0IHsgQ0FURUdPUllfQkFTRV9QQVRIIGFzIEMsIFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSCBhcyBVLCBnZXRDYXRlZ29yeVVJUGF0aCBhcyBhLCBnZXRSb290Q2F0ZWdvcnlQYXRoIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy1jYTEzNDAwNS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZFRyYWlsaW5nU2xhc2hJZk1pc3NpbmcgfSBmcm9tICcuL3VybC00YzNhZTU0Yy5qcyc7XG5cbmNvbnN0IGdldEdyb3VwUmVzdEJhc2VVcmwgPSAocG9ydGFsLCBncm91cCkgPT4gYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfS9jb21tdW5pdHkvZ3JvdXBzLyR7Z3JvdXAuaWR9YCk7XG5cbmV4cG9ydCB7IGdldEdyb3VwUmVzdEJhc2VVcmwgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ncm91cC02YTYzMDNiMC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyB9IGZyb20gJy4vdXJsLTRjM2FlNTRjLmpzJztcblxuZnVuY3Rpb24gaXNFc3JpKGl0ZW0pIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IGl0ZW0ub3duZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZXNyaVwiKSk7XG59XG5mdW5jdGlvbiBpc1ByZW1pdW0oaXRlbSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gaXNFc3JpKGl0ZW0pICYmICEhKChfYSA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJSZXF1aXJlcyBDcmVkaXRzXCIpKTtcbn1cbmZ1bmN0aW9uIGlzU3Vic2NyaWJlcihpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBpc0VzcmkoaXRlbSkgJiYgISEoKF9hID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcIlJlcXVpcmVzIFN1YnNjcmlwdGlvblwiKSk7XG59XG5mdW5jdGlvbiBpc093bmVyKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gaXRlbS5vd25lciA9PT0gdXNlci51c2VybmFtZTtcbn1cbi8qKlxuICogQ2FuIHRoZSB1c2VyIHVwZGF0ZSB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVJdGVtKGl0ZW0sIHVzZXIpIHtcbiAgICByZXR1cm4gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpIHx8IGl0ZW0uaXRlbUNvbnRyb2wgPT09IFwidXBkYXRlXCI7XG59XG4vKipcbiAqIElzIHRoZSB1c2VyIGVpdGhlciBhbiBvd25lciBvciBhZG1pbiBvZiB0aGUgaXRlbVxuICovXG5mdW5jdGlvbiB1c2VySXNJdGVtQWRtaW4oaXRlbSwgdXNlcikge1xuICAgIHJldHVybiBpc093bmVyKGl0ZW0sIHVzZXIpIHx8IGlzSXRlbUFkbWluKGl0ZW0sIHVzZXIpO1xufVxuLyoqXG4gKiBEb2VzIHRoZSB1c2VyIGhhdmUgYWRtaW4gY2FwYWJpbGl0aWVzIG9uIHRoaXMgaXRlbVxuICovXG5mdW5jdGlvbiBpc0l0ZW1BZG1pbihpdGVtLCB1c2VyKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGlmIHRoaXMgZmxhZyBpcyBhbHJlYWR5IHNldCAocHJvYmFibHkgaG9tZSBhcHApLCB1c2UgaXRcbiAgICBpZiAoaXRlbS5pc0FkbWluICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICEhaXRlbS5pc0FkbWluO1xuICAgIH1cbiAgICBjb25zdCBpdGVtT3duZXIgPSBpdGVtLm93bmVyO1xuICAgIGNvbnN0IGl0ZW1Db250cm9sQWRtaW4gPSBpdGVtLml0ZW1Db250cm9sID09PSBcImFkbWluXCI7XG4gICAgY29uc3QgZXNyaVVzZXJzID0gW1wiZXNyaV9saXZpbmdhdGxhc1wiLCBcImVzcmlfZGVtb2dyYXBoaWNzXCIsIFwiZXNyaV9ib3VuZGFyaWVzXCJdO1xuICAgIGlmICgoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiZcbiAgICAgICAgIWlzT3duZXIoaXRlbSwgdXNlcikgJiZcbiAgICAgICAgaXRlbUNvbnRyb2xBZG1pbiAmJlxuICAgICAgICBpdGVtT3duZXIuaW5jbHVkZXMoXCJlc3JpX1wiKSAmJlxuICAgICAgICAvLyBwb3J0YWwgaW5jb3JyZWN0bHkgcmV0dXJucyBcIml0ZW1Db250cm9sPVwiYWRtaW5cIiBmb3IgZXNyaSBvd25lZCBpdGVtc1xuICAgICAgICAhZXNyaVVzZXJzLmluY2x1ZGVzKGl0ZW1Pd25lcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUNvbnRyb2xBZG1pbjtcbn1cbmNvbnN0IGl0ZW1zQmVsb25nVG9Vc2VyT3JnID0gKGl0ZW1zLCB1c2VyKSA9PiB7XG4gICAgcmV0dXJuICEhdXNlci5vcmdJZCAmJiBpdGVtcy5ldmVyeSgoaXRlbSkgPT4gaXRlbS5pc09yZ0l0ZW0pO1xufTtcbmNvbnN0IGdldEl0ZW1Ib21lQXBwVXJsID0gKGl0ZW1JZCwgYmFzZVVybCkgPT4gYCR7YWRkVHJhaWxpbmdTbGFzaElmTWlzc2luZyhiYXNlVXJsKX1pdGVtLmh0bWw/aWQ9JHtpdGVtSWR9YDtcblxuZXhwb3J0IHsgaXNTdWJzY3JpYmVyIGFzIGEsIGlzUHJlbWl1bSBhcyBiLCBjYW5VcGRhdGVJdGVtIGFzIGMsIGl0ZW1zQmVsb25nVG9Vc2VyT3JnIGFzIGQsIGdldEl0ZW1Ib21lQXBwVXJsIGFzIGcsIGlzT3duZXIgYXMgaSwgdXNlcklzSXRlbUFkbWluIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS0zNTM1NTUyZC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuXG5jb25zdCBsYW5ndWFnZU1hcCA9IG5ldyBNYXAoW1xuICAgIFtcImFyXCIsIFwiYXJcIl0sXG4gICAgW1wiYmdcIiwgXCJiZ1wiXSxcbiAgICBbXCJic1wiLCBcImJzXCJdLFxuICAgIFtcImNhXCIsIFwiY2FcIl0sXG4gICAgW1wiY3NcIiwgXCJjc1wiXSxcbiAgICBbXCJkYVwiLCBcImRhXCJdLFxuICAgIFtcImRlXCIsIFwiZGVcIl0sXG4gICAgW1wiZWxcIiwgXCJlbFwiXSxcbiAgICBbXCJlblwiLCBcImVuXCJdLFxuICAgIFtcImVzXCIsIFwiZXNcIl0sXG4gICAgW1wiZXRcIiwgXCJldFwiXSxcbiAgICBbXCJmaVwiLCBcImZpXCJdLFxuICAgIFtcImZyXCIsIFwiZnJcIl0sXG4gICAgW1wiaGVcIiwgXCJoZVwiXSxcbiAgICBbXCJoclwiLCBcImhyXCJdLFxuICAgIFtcImh1XCIsIFwiaHVcIl0sXG4gICAgW1wiaWRcIiwgXCJpZFwiXSxcbiAgICBbXCJpdFwiLCBcIml0XCJdLFxuICAgIFtcImphXCIsIFwiamFcIl0sXG4gICAgW1wia29cIiwgXCJrb1wiXSxcbiAgICBbXCJsdFwiLCBcImx0XCJdLFxuICAgIFtcImx2XCIsIFwibHZcIl0sXG4gICAgW1wibmJcIiwgXCJuYlwiXSxcbiAgICBbXCJubFwiLCBcIm5sXCJdLFxuICAgIFtcInBsXCIsIFwicGxcIl0sXG4gICAgW1wicHQtYnJcIiwgXCJwdC1CUlwiXSxcbiAgICBbXCJwdC1wdFwiLCBcInB0LVBUXCJdLFxuICAgIFtcInJvXCIsIFwicm9cIl0sXG4gICAgW1wicnVcIiwgXCJydVwiXSxcbiAgICBbXCJza1wiLCBcInNrXCJdLFxuICAgIFtcInNsXCIsIFwic2xcIl0sXG4gICAgW1wic3JcIiwgXCJzclwiXSxcbiAgICBbXCJzdlwiLCBcInN2XCJdLFxuICAgIFtcInRoXCIsIFwidGhcIl0sXG4gICAgW1widHJcIiwgXCJ0clwiXSxcbiAgICBbXCJ1a1wiLCBcInVrXCJdLFxuICAgIFtcInZpXCIsIFwidmlcIl0sXG4gICAgW1wiemgtY25cIiwgXCJ6aC1DTlwiXSxcbiAgICBbXCJ6aC1oa1wiLCBcInpoLUhLXCJdLFxuICAgIFtcInpoLXR3XCIsIFwiemgtVFdcIl1cbl0pO1xuLy8gcnRsXG5mdW5jdGlvbiBnZXRFbGVtZW50RGlyKGVsKSB7XG4gICAgcmV0dXJuIGdldEVsZW1lbnRQcm9wKGVsLCBcImRpclwiLCBcImx0clwiKTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRQcm9wKGVsLCBwcm9wLCB2YWx1ZSkge1xuICAgIGNvbnN0IGNsb3Nlc3RXaXRoUHJvcCA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbCwgYFske3Byb3B9XWApO1xuICAgIHJldHVybiBjbG9zZXN0V2l0aFByb3AgPyBjbG9zZXN0V2l0aFByb3AuZ2V0QXR0cmlidXRlKHByb3ApIDogdmFsdWU7XG59XG4vLyBjc3NcbmNvbnN0IENTU19VVElMSVRZID0ge1xuICAgIHJ0bDogXCJhcmNnaXMtLXJ0bFwiXG59O1xuYXN5bmMgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgYXBpLCB0eXBlLCBwbGFjZXMgfSA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKGFwaSA9PT0gNCkge1xuICAgICAgICBjb25zdCBbaW50bF0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2ludGxcIl0pO1xuICAgICAgICBjb25zdCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyA9IGludGwuY29udmVydE51bWJlckZvcm1hdFRvSW50bE9wdGlvbnMoe1xuICAgICAgICAgICAgcGxhY2VzLFxuICAgICAgICAgICAgc3R5bGU6IHR5cGUsXG4gICAgICAgICAgICBkaWdpdFNlcGFyYXRvcjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKG51bWJlciwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBudW1iZXJGb3JtYXRJbnRsT3B0aW9ucyksIHsgc3R5bGU6IHR5cGUgfSkpO1xuICAgIH1cbiAgICBjb25zdCBbZG9qb051bWJlcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJkb2pvL251bWJlclwiXSk7XG4gICAgcmV0dXJuIGRvam9OdW1iZXIuZm9ybWF0KG51bWJlciwge1xuICAgICAgICB0eXBlLFxuICAgICAgICBwbGFjZXMsXG4gICAgICAgIHBhdHRlcm46IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wYXR0ZXJuXG4gICAgfSk7XG59XG5jb25zdCBjYWNoZSA9IHt9O1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xuICAgIGNvbnN0IGRheVNob3J0TW9udGhZZWFyID0ge1xuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIlxuICAgIH07XG4gICAgaWYgKCFjYWNoZVtsYW5nXSkge1xuICAgICAgICBjYWNoZVtsYW5nXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLCBkYXlTaG9ydE1vbnRoWWVhcik7XG4gICAgfVxuICAgIHJldHVybiBjYWNoZVtsYW5nXS5mb3JtYXQoZGF0ZSk7XG59XG5mdW5jdGlvbiBmb3JtYXRQbHVyYWwobGFuZywgc3RyaW5nT2JqLCBudW1iZXIpIHtcbiAgICBjb25zdCBzaW5nbGVzID0gW1wiaWRcIiwgXCJqYVwiLCBcImtvXCIsIFwidGhcIiwgXCJ2aVwiLCBcInpoLWNuXCIsIFwiemgtaGtcIiwgXCJ6aC10d1wiXTtcbiAgICBjb25zdCBsaWtlRW5nbGlzaCA9IFtcbiAgICAgICAgXCJlblwiLFxuICAgICAgICBcImNhXCIsXG4gICAgICAgIFwiZGFcIixcbiAgICAgICAgXCJkZVwiLFxuICAgICAgICBcImVsXCIsXG4gICAgICAgIFwiZXNcIixcbiAgICAgICAgXCJldFwiLFxuICAgICAgICBcImZpXCIsXG4gICAgICAgIFwiaGlcIixcbiAgICAgICAgXCJodVwiLFxuICAgICAgICBcIml0XCIsXG4gICAgICAgIFwibmJcIixcbiAgICAgICAgXCJubFwiLFxuICAgICAgICBcInB0LXB0XCIsXG4gICAgICAgIFwic3ZcIixcbiAgICAgICAgXCJ0clwiXG4gICAgXTtcbiAgICBjb25zdCBsb2NhbGUgPSBsYW5nICE9PSBudWxsICYmIGxhbmcgIT09IHZvaWQgMCA/IGxhbmcgOiBcImVuXCI7XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBvbmUsIG9yIGl0IGlzIGEgXCJzaW1wbGVcIiBsYW5ndWFnZSwgcmV0dXJuIHRoZSAxIHN0cmluZ1xuICAgIGlmIChudW1iZXIgPT09IDEgfHwgc2luZ2xlcy5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmouc2luZ2xlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgXCIxXCIpO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG5vdCAxIGFuZCB0aGUgbGFuZ3VhZ2UgdXNlcyB0aGUgc2FtZSBwbHVyYWxpemF0aW9uIHN0cmF0ZWd5IGFzIGVuZ2xpc2gsXG4gICAgLy8gcmV0dXJuIHRoZSBtdWx0aXBsZSBzdHJpbmdcbiAgICBpZiAobnVtYmVyICE9PSAxICYmIGxpa2VFbmdsaXNoLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5tdWx0aXBsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbiAgICB9XG4gICAgLy8gaWYgbm9uZSBvZiB0aGUgYWJvdmUgd29ya2VkLCByZXR1cm4gdGhlIFwidW5rbm93blwiIHN0cmluZ1xuICAgIHJldHVybiBzdHJpbmdPYmoudW5rbm93bi5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIGAke251bWJlcn1gKTtcbn1cblxuZXhwb3J0IHsgQ1NTX1VUSUxJVFkgYXMgQywgZm9ybWF0RGF0ZSBhcyBhLCBmb3JtYXRQbHVyYWwgYXMgYiwgZm9ybWF0TnVtYmVyIGFzIGYsIGdldEVsZW1lbnREaXIgYXMgZywgbGFuZ3VhZ2VNYXAgYXMgbCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGwgYXMgbGFuZ3VhZ2VNYXAgfSBmcm9tICcuL2xhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFzc2V0UGF0aCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG4vLyBodHRwczovL21lZGl1bS5jb20vc3RlbmNpbC10cmlja3MvaW1wbGVtZW50aW5nLWludGVybmF0aW9uYWxpc2F0aW9uLWkxOG4td2l0aC1zdGVuY2lsLTVlNjU1OTU1NDExN1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFwicnUtUlVcIiBtYXBzIHRvIFwicnVcIiB1c2UgY2FzZVxuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcuc2xpY2UoMCwgMikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIC8vIGl0J3MgT0sgaWYgd2UgZG9uJ3QgaGF2ZSB0aGUgNCBsZXR0ZXIgbGFuZ3VhZ2UgZmlsZSBmb3IgaXRcbiAgICAvLyA0IGxldHRlciBsYW5ndWFnZSBjb2RlIG5lZWRlZCBmb3IgZm9ybWF0dGluZyBudW1iZXJzXG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcuc2xpY2UoMCwgMikpKSB7XG4gICAgICAgICAgICAvLyB3ZSBzdXBwb3J0IHRoZSAyIGxldHRlciBjb2RlZCBsYW5ndWFnZVxuICAgICAgICAgICAgLy8gZS5nLiBpdC1DSCB2cyBpdFxuICAgICAgICAgICAgcmV0dXJuIGxhbmc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKGdldEFzc2V0UGF0aChgLi4vYXJjZ2lzLWFwcC1hc3NldHMvaTE4bi8ke2NvbXBvbmVudE5hbWV9LmkxOG4uJHtsb2NhbGV9Lmpzb25gKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH0sICgpID0+IHJlamVjdCgpKTtcbiAgICB9KTtcbn1cbmNvbnN0IHN0cmluZ0NhY2hlID0ge307XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgY29uc3QgaWQgPSBgJHtjb21wb25lbnROYW1lfSR7bG9jYWxlfWA7XG4gICAgaWYgKCFzdHJpbmdDYWNoZVtpZF0pIHtcbiAgICAgICAgc3RyaW5nQ2FjaGVbaWRdID0gZmV0Y2hMb2NhbGVTdHJpbmdzRm9yQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGxvY2FsZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdDYWNoZVtpZF07XG59XG4vKipcbiAqIEdldCBzdHJpbmdzIGFuZCBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgMiBsYW5ndWFnZSBjb2Rlcy5cbiAqIFRoZSBmaXJzdCBvbmUgcmV0dXJucyBhIGNvZGUgdGhhdCdzIGFsc28gc3VwcG9ydGVkIGFzIGEgbGFuZ3VhZ2UgZmlsZS5cbiAqIFRoZSBzZWNvbmQgb25lIHJldHVybnMgYSBjb2RlIHdoZXJlIHRoZXJlIGlzIHN1cHBvcnQgZm9yIHRoZSBmaXJzdCAyIGxldHRlcnMgb2YgdGhlIGNvZGUgYXMgcGFydCBvZiBhIGxhbmd1YWdlIGZpbGUsXG4gKiBidXQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIDQgbGV0dGVyIGNvZGUgZnJvbSB0aGUgcGFnZS5cbiAqIEUuZy4gRm9yIFwiaXQtY2hcIiBpdCB3aWxsIHJldHVybiBcIml0XCIgYXMgdGhlIGZpcnN0IGxhbmd1YWdlIGNvZGUgYW5kIFwiaXQtY2hcIiBhcyB0aGUgc2Vjb25kLlxuICogVGhlIHNlY29uZCBvbmUgaXMgcmVxdWlyZWQgZm9yIGVzcmkuaW50bC5zZXRMb2NhbGUoKSB0byBnZXQgdGhlIGNvcnJlY3QgZm9ybWF0dGluZy5cbiAqXG4gKiBJZiBhIHRhZ05hbWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBvdmVyd2l0ZSB0aGUgZWxlbWVudCdzIHRhZ05hbWVcbiAqXG4gKiAgQHJldHVybiBbIHN0cmluZ3MsIGZpcnN0IGxhbmd1YWdlIGNvZGUsIHNlY29uZCBsYW5ndWFnZSBjb2RlXVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKGVsZW1lbnQsIHRhZ05hbWUpIHtcbiAgICBjb25zdCBjb21wb25lbnROYW1lID0gdGFnTmFtZSB8fCBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZSA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRMYW5ndWFnZUludGwgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpO1xuICAgIGxldCBzdHJpbmdzO1xuICAgIHRyeSB7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgY29tcG9uZW50TGFuZ3VhZ2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYG5vIGxvY2FsZSBmb3IgJHtjb21wb25lbnROYW1lfSAoJHtjb21wb25lbnRMYW5ndWFnZX0pIGxvYWRpbmcgZGVmYXVsdCBsb2NhbGUgZW4uYCk7XG4gICAgICAgIHN0cmluZ3MgPSBhd2FpdCBmZXRjaExvY2FsZVN0cmluZ3NGcm9tQ2FjaGUoY29tcG9uZW50TmFtZSwgXCJlblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzdHJpbmdzLCBjb21wb25lbnRMYW5ndWFnZSwgY29tcG9uZW50TGFuZ3VhZ2VJbnRsXTtcbn1cblxuZXhwb3J0IHsgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIGFzIGEsIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgYXMgZyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2NhbGUtMDUwYjZkYjkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyB1IGFzIHVzZXJJc0l0ZW1BZG1pbiwgYyBhcyBjYW5VcGRhdGVJdGVtLCBkIGFzIGl0ZW1zQmVsb25nVG9Vc2VyT3JnIH0gZnJvbSAnLi9pdGVtLTM1MzU1NTJkLmpzJztcblxuY29uc3QgZ2V0VXNlclJvbGUgPSAodXNlcikgPT4ge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiB0eXBlb2YgKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlKSA9PT0gXCJzdHJpbmdcIiAmJiAhISh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZSlcbiAgICAgICAgPyB1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZVxuICAgICAgICA6IChfYiA9IChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5yb2xlSWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5pZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogKF9jID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5pZDtcbn07XG5mdW5jdGlvbiBpc1B1YmxpY1VzZXIodXNlcikge1xuICAgIHJldHVybiB1c2VyICYmICF1c2VyLm9yZ0lkO1xufVxuZnVuY3Rpb24gaXNIb3N0ZWRQb3J0YWwocG9ydGFsKSB7XG4gICAgcmV0dXJuICFwb3J0YWwuaXNQb3J0YWwgfHwgISFwb3J0YWwuaXNCYWNrZWRCeVNEUztcbn1cbmZ1bmN0aW9uIGlzRGV2ZWxvcGVyKHN1YnNjcmlwdGlvbkluZm8pIHtcbiAgICBjb25zdCBkZXZTdWJzY3JpcHRpb25UeXBlcyA9IFtcIlRyaWFsIERldmVsb3BlclwiLCBcIkRldmVsb3BlclwiLCBcIkRldmVsb3BlciBTdWJzY3JpcHRpb25cIl07XG4gICAgcmV0dXJuIGRldlN1YnNjcmlwdGlvblR5cGVzLmluY2x1ZGVzKHN1YnNjcmlwdGlvbkluZm8gPT09IG51bGwgfHwgc3Vic2NyaXB0aW9uSW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3Vic2NyaXB0aW9uSW5mby50eXBlKTtcbn1cbmZ1bmN0aW9uIGlzT3JnQWRtaW4odXNlcikge1xuICAgIHJldHVybiBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJvcmdfYWRtaW5cIiB8fCBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJhY2NvdW50X2FkbWluXCI7XG59XG5mdW5jdGlvbiBpc09yZ1VzZXIodXNlcikge1xuICAgIHJldHVybiBnZXRVc2VyUm9sZSh1c2VyKSA9PT0gXCJvcmdfdXNlclwiIHx8IGdldFVzZXJSb2xlKHVzZXIpID09PSBcImFjY291bnRfdXNlclwiO1xufVxuZnVuY3Rpb24gaXNDdXN0b21Sb2xlKHVzZXIpIHtcbiAgICAvLyBUaGUgSG9tZSBBcHAgY29sbGFwc2UgdGhlIGByb2xlSWRgIGFuZCBgcm9sZWAgaW50byBhIHNpbmdsZSBgaWRgIHByb3BlcnR5LCB0aGF0J3Mgd2h5XG4gICAgLy8gIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2Jsb2IvbWFzdGVyL3NyYy9qcy9hcmNnaXNvbmxpbmUvc2hhcmluZy9kaWppdC9Sb2xlLnRzI0w0Njkgd29ya3NcbiAgICAvLyBJbiBwcmFjdGljZSwgd2Ugb25seSBuZWVkIHRvIGNoZWNrIGlmIGByb2xlSWRgIGV4aXN0XG4gICAgLy8gIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwL2lzc3Vlcy80NDY4MiNpc3N1ZWNvbW1lbnQtNDE0Njg2NlxuICAgIHJldHVybiAhISh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucm9sZUlkKSAmJiB1c2VyLnJvbGVJZC5sZW5ndGggPiAwO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgcHJpdmlsZWdlIFwicG9ydGFsOmFkbWluOnVwZGF0ZUl0ZW1DYXRlZ29yeVNjaGVtYVwiIGlzIGdyYW50ZWQuXG4gKi9cbmZ1bmN0aW9uIGNhblVwZGF0ZUl0ZW1DYXRlZ29yaWVzKHVzZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICEhKChfYSA9IHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46dXBkYXRlSXRlbUNhdGVnb3J5U2NoZW1hXCIpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHByaXZpbGVnZSBcInBvcnRhbDphZG1pbjp1cGRhdGVHcm91cHNcIiBpcyBncmFudGVkLlxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVPcmdHcm91cHModXNlcikge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gISEoKF9hID0gdXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVHcm91cHNcIikpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHVwZGF0ZSBvdGhlciB1c2VyJ3MgaXRlbXMgaW4gdGhlaXIgb3JnYW5pemF0aW9uLlxuICovXG5mdW5jdGlvbiBjYW5VcGRhdGVPcmdJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDphZG1pbjp1cGRhdGVJdGVtc1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHRvIGVuc3VyZSB0aGUgcG9ydGFsIGlzIGFuIG9yZ2FuaXphdGlvbiBwb3J0YWxcbiAqL1xuZnVuY3Rpb24gaXNPcmdQb3J0YWwocG9ydGFsKSB7XG4gICAgcmV0dXJuICEhKHBvcnRhbC51cmxLZXkgJiYgcG9ydGFsLmN1c3RvbUJhc2VVcmwpIHx8ICEhcG9ydGFsLmlzUG9ydGFsO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHNoYXJlIHRoZWlyIGl0ZW0gdG8gZ3JvdXBzXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvR3JvdXAodXNlcikge1xuICAgIHJldHVybiAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpzaGFyZVRvR3JvdXBcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBhbiBpdGVtIG9uIGEgZ2l2ZW4gcG9ydGFsXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlKHVzZXIsIHBvcnRhbCkge1xuICAgIHJldHVybiAoIWlzT3JnUG9ydGFsKHBvcnRhbCkgfHxcbiAgICAgICAgY2FuU2hhcmVJdGVtVG9Hcm91cCh1c2VyKSB8fFxuICAgICAgICBjYW5TaGFyZUl0ZW1Ub09yZyh1c2VyKSB8fFxuICAgICAgICAoISFwb3J0YWwuY2FuU2hhcmVQdWJsaWMgJiYgY2FuU2hhcmVJdGVtVG9QdWJsaWModXNlcikpKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBzaGFyZSB0aGVpciBpdGVtIG90IHRoZSBvcmdhbml6YXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNhblNoYXJlSXRlbVRvT3JnKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOnVzZXI6c2hhcmVUb09yZ1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBzaGFyZSB0aGVpciBpdGVtIHRvIHB1YmxpY1xuICovXG5mdW5jdGlvbiBjYW5TaGFyZUl0ZW1Ub1B1YmxpYyh1c2VyKSB7XG4gICAgcmV0dXJuICgodXNlciA9PT0gbnVsbCB8fCB1c2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1c2VyLnByaXZpbGVnZXMpIHx8IFtdKS5pbmNsdWRlcyhcInBvcnRhbDp1c2VyOnNoYXJlVG9QdWJsaWNcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtc1RvT3JnKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9PcmdcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9QdWJsaWNcIik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gYWRtaW5DYW5TaGFyZU90aGVyc0l0ZW1Ub0dyb3VwKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnNoYXJlVG9Hcm91cFwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgaXMgaW4gYW4gYWxsb3dlZCBvcmdhbml6YXRpb24gYW5kIGhhcyB0aGUgcG93ZXIgdG8gbWFuYWdlIGNvbGxhYm9yYXRpb25zXG4gKi9cbmZ1bmN0aW9uIGNhbk1hbmFnZUNvbGxhYm9yYXRpb25zKGNvbmZpZywgdXNlciwgcG9ydGFsLCBzdWJzY3JpcHRpb25JbmZvKSB7XG4gICAgY29uc3QgZXhjbHVkZWRPcmdUeXBlcyA9IFtcIlRyaWFsXCIsIFwiVHJpYWwgUHJlc3NcIiwgXCJUcmlhbCBEZXZlbG9wZXJcIiwgXCJEZXZlbG9wZXIgU3Vic2NyaXB0aW9uXCIsIFwiRXZhbHVhdGlvblwiXTtcbiAgICBjb25zdCBpc1ZhbGlkT3JnVHlwZSA9IHN1YnNjcmlwdGlvbkluZm8gJiYgIWV4Y2x1ZGVkT3JnVHlwZXMuaW5jbHVkZXMoc3Vic2NyaXB0aW9uSW5mby50eXBlKTtcbiAgICBjb25zdCBoYXNQcml2aWxlZ2UgPSAoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5wcml2aWxlZ2VzKSB8fCBbXSkuaW5jbHVkZXMoXCJwb3J0YWw6YWRtaW46bWFuYWdlQ29sbGFib3JhdGlvbnNcIik7XG4gICAgcmV0dXJuICEhKChjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWcuY29sbGFib3JhdGlvbnNFbmFibGVkKSAmJlxuICAgICAgICB1c2VyICYmXG4gICAgICAgIChpc09yZ0FkbWluKHVzZXIpIHx8IGhhc1ByaXZpbGVnZSkgJiZcbiAgICAgICAgKChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpIHx8IGlzVmFsaWRPcmdUeXBlKSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiB2aWV3IG90aGVyIG9yZ2FuaXphdGlvbiB1c2VycycgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuVmlld09yZ0l0ZW1zKHVzZXIpIHtcbiAgICByZXR1cm4gKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIucHJpdmlsZWdlcykgfHwgW10pLmluY2x1ZGVzKFwicG9ydGFsOmFkbWluOnZpZXdJdGVtc1wiKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHVzZXIgY2FuIHZpZXcgb3RoZXIgb3JnYW5pemF0aW9uIHVzZXJzJyBpdGVtc1xuICovXG5mdW5jdGlvbiBjYW5WaWV3T3RoZXJzT3JnSXRlbXModXNlcikge1xuICAgIHJldHVybiAhIXVzZXIgJiYgKCFpc0N1c3RvbVJvbGUodXNlcikgfHwgKGlzQ3VzdG9tUm9sZSh1c2VyKSAmJiBjYW5WaWV3T3JnSXRlbXModXNlcikpKTtcbn1cbi8vIFRPRE86IGFkZCB1bml0IHRlc3RzXG5jb25zdCBoYXNBZG1pblNoYXJlUHJpdmlsZWdlID0gKHsgaXRlbXMsIHVzZXIsIHBvcnRhbCB9KSA9PiB7XG4gICAgY29uc3QgaXRlbSA9IGl0ZW1zWzBdO1xuICAgIC8vIGVudGVycHJpc2UgaW5jb3JyZWN0bHkgcmV0dXJucyBpdGVtcyBvd25lZCBieSBcImVzcmlfXCIgYXMgaXRlbSBjb250cm9sIGFkbWluIChXZWJHSVMvYXJjZ2lzLXBvcnRhbC1hcHAjMzg2OTUpXG4gICAgY29uc3Qgb3duZXIgPSBpdGVtLm93bmVyO1xuICAgIGNvbnN0IHdoaXRlbGlzdE93bmVyID0gW1wiZXNyaV9saXZpbmdhdGxhc1wiXTtcbiAgICBpZiAocG9ydGFsLmlzUG9ydGFsICYmIG93bmVyICE9PSB1c2VyLnVzZXJuYW1lICYmIG93bmVyLmluY2x1ZGVzKFwiZXNyaV9cIikgJiYgIXdoaXRlbGlzdE93bmVyLmluY2x1ZGVzKG93bmVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGlzT3duZXJPckFkbWluID0gdXNlcklzSXRlbUFkbWluKGl0ZW0sIHVzZXIpO1xuICAgIGNvbnN0IGlzQ3VzdG9tID0gaXNDdXN0b21Sb2xlKHVzZXIpO1xuICAgIGNvbnN0IGNhblNoYXJlT3JnSXRlbXMgPSBjYW5TaGFyZU90aGVyc0l0ZW1zKHVzZXIpO1xuICAgIGNvbnN0IGNhblVwZGF0ZUFuZFNoYXJlID0gY2FuVXBkYXRlSXRlbShpdGVtLCB1c2VyKSAmJlxuICAgICAgICBjYW5VcGRhdGVPcmdJdGVtcyh1c2VyKSAmJlxuICAgICAgICAhaXNDdXN0b20gJiZcbiAgICAgICAgKGNhblNoYXJlKHVzZXIsIHBvcnRhbCkgfHwgY2FuU2hhcmVPdGhlcnNJdGVtcyh1c2VyKSk7XG4gICAgLy8gaWYgaXQncyB0aGUgaXRlbSBvd25lciBvciBhZG1pbiwgb3IgY3VzdG9tIGFkbWluIHdobyBjYW4gc2hhcmVcbiAgICByZXR1cm4gaXNPd25lck9yQWRtaW4gfHwgY2FuVXBkYXRlQW5kU2hhcmUgfHwgKGl0ZW1zQmVsb25nVG9Vc2VyT3JnKGl0ZW1zLCB1c2VyKSAmJiBjYW5TaGFyZU9yZ0l0ZW1zKTtcbn07XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSB1c2VyIGNhbiBzaGFyZSBvdGhlciB1c2VyJ3MgaXRlbXNcbiAqL1xuZnVuY3Rpb24gY2FuU2hhcmVPdGhlcnNJdGVtcyh1c2VyKSB7XG4gICAgcmV0dXJuIGFkbWluQ2FuU2hhcmVPdGhlcnNJdGVtVG9Hcm91cCh1c2VyKSB8fCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcodXNlcikgfHwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljKHVzZXIpO1xufVxuXG5leHBvcnQgeyBpc1B1YmxpY1VzZXIgYXMgYSwgaXNPcmdBZG1pbiBhcyBiLCBpc0hvc3RlZFBvcnRhbCBhcyBjLCBpc0N1c3RvbVJvbGUgYXMgZCwgY2FuVXBkYXRlT3JnR3JvdXBzIGFzIGUsIGNhblVwZGF0ZUl0ZW1DYXRlZ29yaWVzIGFzIGYsIGNhbk1hbmFnZUNvbGxhYm9yYXRpb25zIGFzIGcsIGlzT3JnVXNlciBhcyBoLCBpc0RldmVsb3BlciBhcyBpLCBjYW5TaGFyZUl0ZW1Ub0dyb3VwIGFzIGosIGNhblNoYXJlSXRlbVRvT3JnIGFzIGssIGFkbWluQ2FuU2hhcmVPdGhlcnNJdGVtVG9Hcm91cCBhcyBsLCBjYW5TaGFyZU90aGVyc0l0ZW1zVG9PcmcgYXMgbSwgY2FuU2hhcmVJdGVtVG9QdWJsaWMgYXMgbiwgY2FuU2hhcmVPdGhlcnNJdGVtc1RvUHVibGljIGFzIG8sIGhhc0FkbWluU2hhcmVQcml2aWxlZ2UgYXMgcCwgY2FuVmlld090aGVyc09yZ0l0ZW1zIGFzIHEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJpdmlsZWdlcy01YzM4MmY2MS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IEhJRERFTl9JVEVNU19RVUVSWSA9IGAtdHlwZTpcIkNvZGUgQXR0YWNobWVudFwiIC10eXBlOlwiRmVhdHVyZWQgSXRlbXNcIiAtdHlwZTpcIlN5bWJvbCBTZXRcIiAtdHlwZTpcIkNvbG9yIFNldFwiIC10eXBlOlwiV2luZG93cyBWaWV3ZXIgQWRkIEluXCIgLXR5cGU6XCJXaW5kb3dzIFZpZXdlciBDb25maWd1cmF0aW9uXCIgLXR5cGU6XCJNYXAgQXJlYVwiIC10eXBla2V5d29yZHM6XCJNYXBBcmVhUGFja2FnZVwiIC10eXBlOlwiSW5kb29ycyBNYXAgQ29uZmlndXJhdGlvblwiIC10eXBla2V5d29yZHM6XCJTTVhcImA7XG5cbmV4cG9ydCB7IEhJRERFTl9JVEVNU19RVUVSWSBhcyBIIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXF1ZXJ5LWQ2MjY2MGQ0LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgQyBhcyBDQVRFR09SWV9CQVNFX1BBVEgsIGEgYXMgZ2V0Q2F0ZWdvcnlVSVBhdGggfSBmcm9tICcuL2NhdGVnb3JpZXMtY2ExMzQwMDUuanMnO1xuXG4vLyBUT0RPOiBhZGQgdW5pdCB0ZXN0c1xuY29uc3QgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tTW92ZSA9IChjYXRlZ29yeSwgeyBmcm9tQ2F0ZWdvcnk6IHsgcGF0aDogZnJvbVBhdGggfSwgdG9DYXRlZ29yeTogeyBwYXRoOiB0b1BhdGggfSwgZnJvbUluZGV4LCB0b0luZGV4IH0pID0+IHtcbiAgICAvLyBDb3B5IHNpbmNlIHRoaXMgd2lsbCBiZSBhIGRlc3RydWN0aXZlIG9wZXJhdGlvblxuICAgIGNvbnN0IHVpQ2F0ZWdvcnkgPSBzdHJ1Y3R1cmVkQ2xvbmUoY2F0ZWdvcnkpO1xuICAgIGNvbnN0IGZyb21DYXRlZ29yeSA9IGdldENhdGVnb3J5RnJvbVBhdGgodWlDYXRlZ29yeSwgZnJvbVBhdGgpO1xuICAgIGxldCB0b0NhdGVnb3J5ID0gZnJvbUNhdGVnb3J5O1xuICAgIGlmIChmcm9tUGF0aCAhPT0gdG9QYXRoKSB7XG4gICAgICAgIHRvQ2F0ZWdvcnkgPSBnZXRDYXRlZ29yeUZyb21QYXRoKHVpQ2F0ZWdvcnksIHRvUGF0aCk7XG4gICAgfVxuICAgIGNvbnN0IFtyZW1vdmVkXSA9IGZyb21DYXRlZ29yeS50YXJnZXRDYXRlZ29yeS5jYXRlZ29yaWVzLnNwbGljZShmcm9tSW5kZXgsIDEpO1xuICAgIHRvQ2F0ZWdvcnkudGFyZ2V0Q2F0ZWdvcnkuY2F0ZWdvcmllcy5zcGxpY2UodG9JbmRleCwgMCwgcmVtb3ZlZCk7XG4gICAgcmV0dXJuIGdldENhdGVnb3J5U2NoZW1hRnJvbVVJQ2F0ZWdvcnkodWlDYXRlZ29yeSk7XG59O1xuY29uc3QgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tVGl0bGVDaGFuZ2UgPSAoY2F0ZWdvcnksIHsgbmV3VGl0bGUsIHBhdGggfSkgPT4ge1xuICAgIGNvbnN0IHVpQ2F0ZWdvcnkgPSBzdHJ1Y3R1cmVkQ2xvbmUoY2F0ZWdvcnkpO1xuICAgIGNvbnN0IGNhdGVnb3J5VG9DaGFuZ2UgPSBnZXRDYXRlZ29yeUZyb21QYXRoKHVpQ2F0ZWdvcnksIHBhdGgpO1xuICAgIGNhdGVnb3J5VG9DaGFuZ2UudGFyZ2V0Q2F0ZWdvcnkudGl0bGUgPSBuZXdUaXRsZTtcbiAgICByZXR1cm4gZ2V0Q2F0ZWdvcnlTY2hlbWFGcm9tVUlDYXRlZ29yeSh1aUNhdGVnb3J5KTtcbn07XG5jb25zdCBnZXROZXdDYXRlZ29yeVNjaGVtYUZyb21DYXRlZ29yeUFkZCA9IChjYXRlZ29yeSwgeyBuZXdUaXRsZSwgcGF0aCB9KSA9PiB7XG4gICAgY29uc3QgdWlDYXRlZ29yeSA9IHN0cnVjdHVyZWRDbG9uZShjYXRlZ29yeSk7XG4gICAgLy8gUmVtb3ZlIHRoZSBsYXN0IHBhcnQgc2luY2UgaXQncyBqdXN0IHRoZSBwbGFjZWhvbGRlclxuICAgIC8vIGUuZy4gYC9jYXRlZ29yaWVzL2NhdGVnb3J5IDEvbmV3LWlucHV0YCAtPiBgL2NhdGVnb3JpZXMvY2F0ZWdvcnkgMWBcbiAgICBjb25zdCBjb250YWluZXJQYXRoID0gcGF0aC5yZXBsYWNlKC9cXC9bXi9dKyQvLCBcIlwiKTtcbiAgICBpZiAoY29udGFpbmVyUGF0aCkge1xuICAgICAgICBjb25zdCB7IHRhcmdldENhdGVnb3J5IH0gPSBnZXRDYXRlZ29yeUZyb21QYXRoKHVpQ2F0ZWdvcnksIGNvbnRhaW5lclBhdGgpO1xuICAgICAgICB0YXJnZXRDYXRlZ29yeS5jYXRlZ29yaWVzLnB1c2goeyB0aXRsZTogbmV3VGl0bGUsIGNhdGVnb3JpZXM6IFtdLCBjb3VudDogMCwgcGF0aDogbnVsbCB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1lYW5zIHdlJ3JlIGFkZGluZyBhIHJvb3QgbGV2ZWwgY2F0ZWdvcnkgd2hlbiB0aGVyZSBpcyBubyBjYXRlZ29yeSB5ZXRcbiAgICAgICAgICpcbiAgICAgICAgICogQ2FuIGhhcHBlbnMgd2hlbiB3ZSBmaXJzdCBzZXQgdXAgdGhlIGNhdGVnb3J5IHNjaGVtYVxuICAgICAgICAgKi9cbiAgICAgICAgdWlDYXRlZ29yeS5jYXRlZ29yaWVzLnB1c2goeyB0aXRsZTogbmV3VGl0bGUsIGNhdGVnb3JpZXM6IFtdLCBjb3VudDogMCwgcGF0aDogbnVsbCB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGdldENhdGVnb3J5U2NoZW1hRnJvbVVJQ2F0ZWdvcnkodWlDYXRlZ29yeSk7XG59O1xuY29uc3QgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tRGVsZXRlID0gKGNhdGVnb3J5LCB7IHBhdGggfSkgPT4ge1xuICAgIGNvbnN0IHVpQ2F0ZWdvcnkgPSBzdHJ1Y3R1cmVkQ2xvbmUoY2F0ZWdvcnkpO1xuICAgIGNvbnN0IHsgdGFyZ2V0SW5kZXgsIHBhcmVudENhdGVnb3J5IH0gPSBnZXRDYXRlZ29yeUZyb21QYXRoKHVpQ2F0ZWdvcnksIHBhdGgpO1xuICAgIHBhcmVudENhdGVnb3J5ID09PSBudWxsIHx8IHBhcmVudENhdGVnb3J5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJlbnRDYXRlZ29yeS5jYXRlZ29yaWVzLnNwbGljZSh0YXJnZXRJbmRleCwgMSk7XG4gICAgcmV0dXJuIGdldENhdGVnb3J5U2NoZW1hRnJvbVVJQ2F0ZWdvcnkodWlDYXRlZ29yeSk7XG59O1xuLy8gKiAtLS0gVXRpbHNcbi8vIFBhdGggd2Ugd2FudCB0byByZW1vdmUgdGhlIGJhc2UgcGF0aCBzaW5jZSB3ZSBjb3VudCByb290IGFzIDB0aCBsZXZlbCB0aGVuIGFsc28gcmVtb3ZlIHRoZSBiZWdpbm5pbmcgYC9gIHRvIGF2b2lkIGVtcHR5IHN0cmluZ1xuY29uc3QgZ2V0UGF0aExlbmd0aCA9IChwYXRoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHBhdGggPT09IG51bGwgfHwgcGF0aCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGF0aC5yZXBsYWNlKENBVEVHT1JZX0JBU0VfUEFUSCwgXCJcIikuc2xpY2UoMSkuc3BsaXQoXCIvXCIpLmxlbmd0aCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDsgfTtcbi8qKlxuICogR2V0IHRoZSBjYXRlZ29yeSBmcm9tIHNjaGVtYSBiYXNlZCBvbiB0aGUgcGF0aFxuICovXG5jb25zdCBnZXRDYXRlZ29yeUZyb21QYXRoID0gKHVpQ2F0ZWdvcnksIHBhdGgpID0+IHtcbiAgICBpZiAocGF0aCA9PSBudWxsIHx8IHBhdGggPT09IENBVEVHT1JZX0JBU0VfUEFUSCkge1xuICAgICAgICAvLyBSb290IGxldmVsXG4gICAgICAgIHJldHVybiB7IHRhcmdldENhdGVnb3J5OiB1aUNhdGVnb3J5LCB0YXJnZXRJbmRleDogMSwgcGFyZW50Q2F0ZWdvcnk6IG51bGwgfTtcbiAgICB9XG4gICAgLy8gUGF0aCBzdGFydHMgd2l0aCBgL2Agc28gcmVtb3ZlIGl0XG4gICAgY29uc3QgcGF0aFBhcnRzID0gcGF0aC5zbGljZSgxKS5zcGxpdChcIi9cIik7XG4gICAgbGV0IGN1clBhdGggPSBwYXRoLmluZGV4T2YoQ0FURUdPUllfQkFTRV9QQVRIKSA9PT0gMCA/IGdldENhdGVnb3J5VUlQYXRoKFwiXCIsIHsgdGl0bGU6IHBhdGhQYXJ0cy5zaGlmdCgpIH0pIDogXCJcIjtcbiAgICBsZXQgcGFyZW50Q2F0ZWdvcnkgPSBudWxsO1xuICAgIGxldCB0YXJnZXRDYXRlZ29yeSA9IHVpQ2F0ZWdvcnk7XG4gICAgbGV0IHRhcmdldEluZGV4ID0gMDtcbiAgICBkbyB7XG4gICAgICAgIGN1clBhdGggPSBnZXRDYXRlZ29yeVVJUGF0aChjdXJQYXRoLCB7IHRpdGxlOiBwYXRoUGFydHMuc2hpZnQoKSB9KTtcbiAgICAgICAgcGFyZW50Q2F0ZWdvcnkgPSB0YXJnZXRDYXRlZ29yeTtcbiAgICAgICAgdGFyZ2V0SW5kZXggPSB0YXJnZXRDYXRlZ29yeS5jYXRlZ29yaWVzLmZpbmRJbmRleCgoc3ViY2F0ZWdvcnkpID0+IHN1YmNhdGVnb3J5LnBhdGggPT09IGN1clBhdGgpO1xuICAgICAgICB0YXJnZXRDYXRlZ29yeSA9IHRhcmdldENhdGVnb3J5LmNhdGVnb3JpZXNbdGFyZ2V0SW5kZXhdO1xuICAgIH0gd2hpbGUgKHBhdGhQYXJ0cy5sZW5ndGggPiAwICYmIHRhcmdldENhdGVnb3J5LmNhdGVnb3JpZXMubGVuZ3RoKTtcbiAgICByZXR1cm4geyB0YXJnZXRDYXRlZ29yeSwgdGFyZ2V0SW5kZXgsIHBhcmVudENhdGVnb3J5IH07XG59O1xuLyoqXG4gKiBDcmVhdGUgYSBuZXN0ZWQgY2F0ZWdvcnkgc2NoZW1hIGZyb20gdGhlIGFnZ3JlZ2F0ZWQgc2VhcmNoIHJlc3VsdCBzdGFydGluZyBmcm9tIHJvb3RcbiAqL1xuY29uc3QgZ2V0VUlDYXRlZ29yeUZyb21DYXRlZ29yeVNjaGVtYSA9IChjYXRlZ29yeVNjaGVtYSwgY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEpID0+IHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoe1xuICAgICAgICB0aXRsZTogXCJcIixcbiAgICAgICAgcGF0aDogbnVsbCxcbiAgICAgICAgY291bnQ6IChfYiA9IChfYSA9IGNhdGVnb3J5QWdncmVnYXRpb25EYXRhLmZpZWxkVmFsdWVzLmZpbmQoKGZpZWxkVmFsdWUpID0+IGZpZWxkVmFsdWUudmFsdWUgPT09IENBVEVHT1JZX0JBU0VfUEFUSCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb3VudCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCxcbiAgICAgICAgY2F0ZWdvcmllczogZ2V0VUlDYXRlZ29yeUZyb21DYXRlZ29yeVNjaGVtYVJlY3Vyc2l2ZShudWxsLCBjYXRlZ29yeVNjaGVtYSwgY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEpXG4gICAgfSk7XG59O1xuY29uc3QgZ2V0Q2F0ZWdvcnlTY2hlbWFGcm9tVUlDYXRlZ29yeSA9ICh1aUNhdGVnb3J5KSA9PiB1aUNhdGVnb3J5LmNhdGVnb3JpZXMubWFwKGdldENhdGVnb3J5RnJvbVVJQ2F0ZWdvcnkpO1xuY29uc3QgZ2V0Q2F0ZWdvcnlGcm9tVUlDYXRlZ29yeSA9ICh1aUNhdGVnb3J5KSA9PiAoe1xuICAgIHRpdGxlOiB1aUNhdGVnb3J5LnRpdGxlLFxuICAgIGNhdGVnb3JpZXM6IHVpQ2F0ZWdvcnkuY2F0ZWdvcmllcy5tYXAoZ2V0Q2F0ZWdvcnlGcm9tVUlDYXRlZ29yeSlcbn0pO1xuY29uc3QgZ2V0VUlDYXRlZ29yeUZyb21DYXRlZ29yeVNjaGVtYVJlY3Vyc2l2ZSA9IChwYXJlbnRQYXRoLCBjYXRlZ29yeVNjaGVtYSwgY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEpID0+IHtcbiAgICByZXR1cm4gY2F0ZWdvcnlTY2hlbWEubWFwKChjYXRlZ29yeSkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBwYXRoID0gZ2V0Q2F0ZWdvcnlVSVBhdGgocGFyZW50UGF0aCAhPT0gbnVsbCAmJiBwYXJlbnRQYXRoICE9PSB2b2lkIDAgPyBwYXJlbnRQYXRoIDogQ0FURUdPUllfQkFTRV9QQVRILCBjYXRlZ29yeSk7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5Q291bnQgPSAoX2EgPSBjYXRlZ29yeUFnZ3JlZ2F0aW9uRGF0YS5maWVsZFZhbHVlcy5maW5kKChmaWVsZFZhbHVlKSA9PiBmaWVsZFZhbHVlLnZhbHVlID09PSBwYXRoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvdW50O1xuICAgICAgICBjb25zdCBzdWJjYXRlZ29yaWVzID0gZ2V0VUlDYXRlZ29yeUZyb21DYXRlZ29yeVNjaGVtYVJlY3Vyc2l2ZShwYXRoLCAoX2IgPSBjYXRlZ29yeS5jYXRlZ29yaWVzKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXSwgY2F0ZWdvcnlBZ2dyZWdhdGlvbkRhdGEpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IGNhdGVnb3J5LnRpdGxlLFxuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIGNvdW50OiBjYXRlZ29yeUNvdW50ICE9PSBudWxsICYmIGNhdGVnb3J5Q291bnQgIT09IHZvaWQgMCA/IGNhdGVnb3J5Q291bnQgOiAwLFxuICAgICAgICAgICAgY2F0ZWdvcmllczogc3ViY2F0ZWdvcmllc1xuICAgICAgICB9O1xuICAgIH0pO1xufTtcbmNvbnN0IGNvdW50TnVtQ2F0ZWdvcmllcyA9IChjYXRlZ29yeVNjaGVtYSkgPT4ge1xuICAgIC8vICsgMSBpcyBpdHNlbGZcbiAgICByZXR1cm4gY2F0ZWdvcnlTY2hlbWEucmVkdWNlKChhY2MsIGN1cikgPT4geyB2YXIgX2E7IHJldHVybiBhY2MgKyAxICsgY291bnROdW1DYXRlZ29yaWVzKChfYSA9IGN1ci5jYXRlZ29yaWVzKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXSk7IH0sIDApO1xufTtcbmNvbnN0IGNoZWNrTmV3Q2F0ZWdvcnlUaXRsZVZhbGlkID0gKHsgdGFyZ2V0Q2F0ZWdvcnksIHRhcmdldFBhcmVudENhdGVnb3J5IH0pID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgY2F0ZWdvcnlMb3dlckNhc2VUaXRsZSA9IChfYSA9IHRhcmdldENhdGVnb3J5LnRpdGxlLnRvTG9jYWxlTG93ZXJDYXNlKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50cmltKCk7XG4gICAgaWYgKCFjYXRlZ29yeUxvd2VyQ2FzZVRpdGxlKSB7XG4gICAgICAgIHJldHVybiBcImVtcHR5VGl0bGVcIjtcbiAgICB9XG4gICAgaWYgKGNhdGVnb3J5TG93ZXJDYXNlVGl0bGUubGVuZ3RoID4gTUFYX0NBVEVHT1JZX05BTUVfTEVOR1RIKSB7XG4gICAgICAgIHJldHVybiBcIm1heENoYXJhY3RlclwiO1xuICAgIH1cbiAgICAvLyBObyBkdXBsaWNhdGUgY2F0ZWdvcnkgbmFtZSBvbiB0aGUgc2FtZSBsZXZlbFxuICAgIGlmICh0YXJnZXRQYXJlbnRDYXRlZ29yeS5jYXRlZ29yaWVzLnNvbWUoKGNhdGVnb3J5KSA9PiBjYXRlZ29yeS50aXRsZS50b0xvd2VyQ2FzZSgpID09PSBjYXRlZ29yeUxvd2VyQ2FzZVRpdGxlICYmIGNhdGVnb3J5LnBhdGggIT09IHRhcmdldENhdGVnb3J5LnBhdGgpKSB7XG4gICAgICAgIHJldHVybiBcImRlc3RpbmF0aW9uSGFzU2FtZU5hbWVcIjtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59O1xuY29uc3QgTUFYX0NBVEVHT1JZX05BTUVfTEVOR1RIID0gMTAwO1xuXG5leHBvcnQgeyBNQVhfQ0FURUdPUllfTkFNRV9MRU5HVEggYXMgTSwgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tRGVsZXRlIGFzIGEsIGdldENhdGVnb3J5RnJvbVBhdGggYXMgYiwgY2hlY2tOZXdDYXRlZ29yeVRpdGxlVmFsaWQgYXMgYywgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tVGl0bGVDaGFuZ2UgYXMgZCwgZ2V0TmV3Q2F0ZWdvcnlTY2hlbWFGcm9tQ2F0ZWdvcnlBZGQgYXMgZSwgZ2V0UGF0aExlbmd0aCBhcyBmLCBnZXROZXdDYXRlZ29yeVNjaGVtYUZyb21Nb3ZlIGFzIGcsIGdldFVJQ2F0ZWdvcnlGcm9tQ2F0ZWdvcnlTY2hlbWEgYXMgaCwgY291bnROdW1DYXRlZ29yaWVzIGFzIGkgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbC0yYTBlMmYwOC5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=