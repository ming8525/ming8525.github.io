/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-cbdc5f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-cbdc5f"],{42567:(e,t,a)=>{a.r(t),a.d(t,{arcgis_item_category_schema_editor:()=>m});var r=a(81149),n=a(66495),o=a(82218),i=a(12046),l=a(90406),s=a(20164),c=a(79759),d=a(92638);a(49853),a(70464),a(42577),a(51837),a(69283),a(74689),a(79210);const u=async(e,t,a)=>{const r=a?`${(0,s.g)(t)}/content/groups/${a.id}/`:`${(0,s.g)(t)}`,n=a?{q:c.H,countFields:"access,contentstatus,groupCategories"}:{q:`orgid:${e.orgId} ${c.H}`,countFields:"categories"};try{return{result:(await(0,s.r)(`${r}search`,Object.assign(Object.assign({},n),{countSize:200,num:0,f:"json"}))).aggregations.counts[0]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},h=e=>{e.forEach((e=>{e.description&&delete e.description,e.categories?h(e.categories):e.categories=[]}))},g=e=>{const t=structuredClone(e);return h(t),t},m=class{constructor(e){(0,r.r)(this,e),this.workflowCancel=(0,r.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,r.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,r.c)(this,"deleteAllSchema",7),this.hasChangeSinceLastOpen=!1,this.didFetchTemplates=!1,this.templateInfo={custom:{schema:[{title:"Categories",categories:[]}]},arcgis:{schema:[],learnMoreId:"120001580"},iso:{schema:[],learnMoreId:"120001581"},inspire:{schema:[],learnMoreId:"120001582"}},this.fetchCategoryData=async()=>{var e,t;const{user:a,portal:r,setCategorySchema:o,group:i,templateInfo:l,didFetchTemplates:s}=this,[{result:c},{result:d}]=await Promise.all([(0,n.g)({user:a,portal:r,group:i}),u(a,r,i)]);if(null===(t=null===(e=null==c?void 0:c[0])||void 0===e?void 0:e.categories)||void 0===t?void 0:t.length)o(c),this.categoryAggregationData=d;else if(this.rootCategoryTitle="Categories",this.categorySchema=[],this.newCategoryMode=!0,!s){this.isFetchingTemplate=!0;const{result:e}=await(async e=>{try{const[{categorySchema:t},{categorySchema:a},{categorySchema:r}]=await Promise.all([(0,n.a)(e,"LivingAtlas"),(0,n.a)(e,"Inspire"),(0,n.a)(e,"ISO")]);return{result:{LivingAtlas:t,Inspire:a,ISO:r}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r);l.arcgis.schema=e.LivingAtlas,l.iso.schema=e.ISO,l.inspire.schema=e.Inspire,this.didFetchTemplates=!0,this.isFetchingTemplate=!1}},this.setCategorySchema=e=>{this.rootCategoryTitle=e[0].title,this.categorySchema=e[0].categories},this.closeDialog=()=>{this.schemaToDelete=null,this.workflowCancel.emit({hasChangeSinceLastOpen:this.hasChangeSinceLastOpen})},this.updateSchema=async({schemaToUpdate:e,ignoreNewCategoryMode:t=!1,optimisticUpdate:a=!0})=>{const{portal:r,rootCategoryTitle:n,handleError:o,fetchCategoryData:i,newCategoryMode:l,group:c,deleteAllSchema:u}=this;if(l&&!t)return this.hasUnsavedChanges=e.length>0,this.categorySchema=e,!0;this.hasChangeSinceLastOpen=!0;const h=this.categorySchema;return a&&(this.categorySchema=e),(async()=>{if(this.error=null,0===e.length){const{error:e}=await(async(e,t)=>{try{const a=t?(0,d.g)(e,t):`${(0,s.g)(e)}/portals/${e.id}/`;return await(0,s.r)(`${a}deleteCategorySchema`,{},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r,c);return void(e?(o("generic"),a&&(this.categorySchema=h)):(this.newCategoryMode=!0,u.emit()))}const{error:t}=await(async({portal:e,group:t,categorySchema:a})=>{try{const r=t?(0,d.g)(e,t):`${(0,s.g)(e)}/portals/${e.id}/`;return await(0,s.r)(`${r}assignCategorySchema`,{categorySchema:JSON.stringify({categorySchema:a})},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({portal:r,categorySchema:[{title:n,categories:l?g(e):e}],group:c});t?(o("generic"),a&&(this.categorySchema=h)):(this.hasUnsavedChanges=!1,await i())})(),!0},this.finishSetupNewCategorySchema=async()=>{const{newSchemaWorkflowComplete:e,categorySchema:t,updateSchema:a}=this;await a({schemaToUpdate:t,ignoreNewCategoryMode:!0})&&(this.newCategoryMode=!1,e.emit({newSchema:t}))},this.renderTemplates=()=>{const{templateInfo:e,i18n:t,chosenTemplate:a,config:n,setCategorySchema:o}=this,{helpBase:i,helpMap:l}=n;return(0,r.h)("div",{class:"template-container"},(0,r.h)("p",{class:"template-title"},t.template.title),(0,r.h)("calcite-tile-select-group",null,Object.keys(e).map((n=>{const{learnMoreId:s}=e[n];return(0,r.h)("calcite-tile-select",{key:n,checked:a===n,description:t.template.templateList[n].message,heading:t.template.templateList[n].title,width:"auto",value:n,onCalciteTileSelectChange:t=>{const a=t.target.value;this.chosenTemplate=a,o(e[a].schema),this.hasUnsavedChanges="custom"!==a}},s&&(0,r.h)("calcite-link",{href:`${i}${l[s]}`,role:"presentation",class:"template-link",iconEnd:"launch",target:"_blank",rel:"noopener noreferrer"},t.template.learnMore))}))))},this.renderDeleteConfirmationModal=()=>{var e;const{i18n:t,updateSchema:a,schemaToDelete:n}=this;return n?(0,r.h)("calcite-modal",{kind:"danger",scale:"m",widthScale:"s",onCalciteModalClose:e=>{e.stopPropagation(),this.schemaToDelete=null},open:!!n,class:"confirm-modal"},(0,r.h)("div",{slot:"header"},t.warning.deleteInUseCategory.title),(0,r.h)("div",{slot:"content",class:"confirm-modal-content"},t.warning.deleteInUseCategory.message.replace("${numItem}",null===(e=n.count)||void 0===e?void 0:e.toLocaleString())),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline","data-id":"cancelButton",onClick:()=>this.schemaToDelete=null,width:"full"},t.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:()=>{a({schemaToUpdate:n.schema}),this.schemaToDelete=null},width:"full"},t.warning.deleteInUseCategory.cta)):null},this.handleError=e=>{const{i18n:t}=this;let a=t.error[e].message;"maxCharacter"===e&&(a=a.replace("${maxCharacter}",`${l.M}`)),this.error={title:t.error[e].title,message:a}},this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.isActive=void 0,this.newCategoryMode=!1,this.categorySchema=[],this.categoryAggregationData={fieldName:"categories",fieldValues:[]},this.hasUnsavedChanges=void 0,this.error=null,this.isFetchingSchemaOnActiveChange=!1,this.isFetchingTemplate=!1,this.schemaToDelete=void 0,this.chosenTemplate="custom"}async componentWillLoad(){const e=await(0,o.g)(this.el);this.i18n=e[0]}componentDidLoad(){this.handleIsActiveChange()}async handleIsActiveChange(){this.hasChangeSinceLastOpen=!1,this.chosenTemplate="custom",this.error=null,this.schemaToDelete=null,!this.isActive||(0,i.a)(this.user)&&!this.group||(this.isFetchingSchemaOnActiveChange=!0,await this.fetchCategoryData(),this.isFetchingSchemaOnActiveChange=!1)}render(){const{newCategoryMode:e,categorySchema:t,categoryAggregationData:a,isActive:n,isFetchingSchemaOnActiveChange:o,closeDialog:i,i18n:l,updateSchema:s,error:c,renderTemplates:d,chosenTemplate:u,isFetchingTemplate:h,workflowCancel:g,finishSetupNewCategorySchema:m,hasUnsavedChanges:p,handleError:v,renderDeleteConfirmationModal:y}=this;return!n||o?null:(0,r.h)("calcite-modal",{open:n,onCalciteModalClose:i,scale:"m",class:{modal:!0,"modal--large":e}},(0,r.h)("div",{slot:"header",class:"header"},l.modalHeader),(0,r.h)("div",{slot:"content",class:"stage"},(0,r.h)("calcite-alert",{icon:!0,open:!!c,label:null==c?void 0:c.title,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,r.h)("div",{slot:"message"},null==c?void 0:c.message)),h&&(0,r.h)("calcite-scrim",{loading:!0},l.loadingText),e&&d(),(0,r.h)("div",{class:{"inner-container":!0,"inner-container--new-category":e}},!e&&(0,r.h)("p",{class:"help-text"},l.helpText),y(),(0,r.h)("arcgis-schema-editor",{newCategoryMode:e,showInputByDefault:"custom"===u,canEditCategory:()=>!0,categoryAggregationData:a,categorySchema:t,canCollapseAll:!e,saveNewTitle:async({newSchema:e})=>s({schemaToUpdate:e,optimisticUpdate:!1}),saveNewCategory:async({newSchema:e})=>s({schemaToUpdate:e}),onArcgisSchemaEditorDelete:async({detail:{newSchema:e,categoryCount:t}})=>t?this.schemaToDelete={schema:e,count:t}:s({schemaToUpdate:e}),onArcgisSchemaEditorListOrderChange:async({detail:{newSchema:e}})=>s({schemaToUpdate:e}),onArcgisSchemaEditorInvalidMove:({detail:{errorCode:e}})=>{v(e)},onArcgisSchemaEditorTitleInvalid:({detail:{errorCode:e}})=>{v(e)}}))),e&&(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>g.emit(),width:"full"},l.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:m,width:"full",disabled:!p},l.finishSetup)))}get el(){return(0,r.d)(this)}static get watchers(){return{isActive:["handleIsActiveChange"]}}};m.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background);display:flex}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:48rem}.modal--large{--calcite-modal-width:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-top:0px}.confirm-modal{--calcite-modal-width:32rem}.confirm-modal-content{padding:1rem}"},66495:(e,t,a)=>{a.d(t,{a:()=>d,b:()=>c,f:()=>s,g:()=>l,u:()=>u});var r=a(20164),n=a(49853),o=a(92638),i=a(12046);const l=async({portal:e,user:t,group:a,useCache:r=!1})=>{var n;try{const o=await(a?c(a.id,e,r):s(e,t,r));return{result:null!==(n=null==o?void 0:o.categorySchema)&&void 0!==n?n:null}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};async function s(e,t,a=!0){if(null!=e||(e=n.c.portal),null!=t||(t=n.c.user),!(null==e?void 0:e.id)||t&&(0,i.a)(t))return null;const o=()=>(0,r.r)(`${(0,r.g)(e)}portals/${e.id}/categorySchema`);return a?(0,r.f)(o,"categorySchema",e.id):o()}async function c(e,t,a=!0){if(null!=t||(t=null===n.c||void 0===n.c?void 0:n.c.portal),!e||!t)return null;const i=()=>(0,r.r)(`${(0,o.g)(t,{id:e})}categorySchema`);return a?(0,r.f)(i,"categorySchema",e):i()}async function d(e,t,a=!0){const n=()=>async function(e,t){var a;const n=(0,r.g)(e),o=await(0,r.r)(`${n}portals/self`),i=await(0,r.r)(`${n}community/groups?q=${o.contentCategorySetsGroupQuery}`),l=null===(a=null==i?void 0:i.results)||void 0===a?void 0:a[0],s=(await(0,r.r)(`${n}content/groups/${l.id}/search`,{q:`typekeywords: ${t}`})).results[0];return(0,r.r)(`${n}content/items/${s.id}/data`)}(e,t);return a?(0,r.f)(n,"categorySchema",t):n()}async function u({categories:e,itemIds:t,portal:a}){try{const n=`${(0,r.g)(a)}/content/updateItems`,o=JSON.stringify(t.map((t=>({[t]:{categories:Array.isArray(e)?e:e[t]}}))));return{result:await(0,r.r)(n,{items:o},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}},85984:(e,t,a)=>{a.d(t,{C:()=>r,U:()=>n,a:()=>o,g:()=>i});const r="/categories",n="/Categories",o=(e,t,a=!0)=>{const r=null!=e?e:"";return`${r}${r.endsWith("/")?"":"/"}${a?t.title.toLocaleLowerCase():t.title}`};function i(e){var t;let a=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||n}},92638:(e,t,a)=>{a.d(t,{g:()=>o});var r=a(20164),n=a(79210);const o=(e,t)=>(0,n.a)(`${(0,r.g)(e)}/community/groups/${t.id}`)},74689:(e,t,a)=>{a.d(t,{a:()=>i,b:()=>o,c:()=>s,d:()=>d,g:()=>u,i:()=>l,u:()=>c});var r=a(79210);function n(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function o(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function i(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function l(e,t){return e.owner===t.username}function s(e,t){return c(e,t)||"update"===e.itemControl}function c(e,t){return l(e,t)||function(e,t){var a;if(null!=e.isAdmin)return!!e.isAdmin;const r=e.owner,n="admin"===e.itemControl;return!((null===(a=e.portal)||void 0===a?void 0:a.isPortal)&&!l(e,t)&&n&&r.includes("esri_")&&!["esri_livingatlas","esri_demographics","esri_boundaries"].includes(r))&&n}(e,t)}const d=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),u=(e,t)=>`${(0,r.a)(t)}item.html?id=${e}`},12046:(e,t,a)=>{a.d(t,{a:()=>o,b:()=>s,c:()=>i,d:()=>d,e:()=>h,f:()=>u,g:()=>f,h:()=>c,i:()=>l,j:()=>g,k:()=>m,l:()=>C,m:()=>v,n:()=>p,o:()=>y,p:()=>S,q:()=>w});var r=a(74689);const n=e=>{var t,a,r;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(a=null!==(t=null==e?void 0:e.roleId)&&void 0!==t?t:null==e?void 0:e.id)&&void 0!==a?a:null===(r=null==e?void 0:e.sourceJSON)||void 0===r?void 0:r.id};function o(e){return e&&!e.orgId}function i(e){return!e.isPortal||!!e.isBackedBySDS}function l(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function s(e){return"org_admin"===n(e)||"account_admin"===n(e)}function c(e){return"org_user"===n(e)||"account_user"===n(e)}function d(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function u(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateItemCategorySchema"))}function h(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateGroups"))}function g(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function m(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function p(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function v(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function y(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function C(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function f(e,t,a,r){const n=r&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(r.type),o=((null==t?void 0:t.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!t||!s(t)&&!o||!(null==a?void 0:a.isPortal)&&!n)}function w(e){return!!e&&(!d(e)||d(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const S=({items:e,user:t,portal:a})=>{const n=e[0],o=n.owner;if(a.isPortal&&o!==t.username&&o.includes("esri_")&&!["esri_livingatlas"].includes(o))return!1;const i=(0,r.u)(n,t),l=d(t),s=T(t),c=(0,r.c)(n,t)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(t)&&!l&&(function(e,t){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(t)||g(e)||m(e)||!!t.canSharePublic&&p(e)}(t,a)||T(t));return i||c||(0,r.d)(e,t)&&s};function T(e){return C(e)||v(e)||y(e)}},79759:(e,t,a)=>{a.d(t,{H:()=>r});const r='-type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" -type:"Map Area" -typekeywords:"MapAreaPackage" -type:"Indoors Map Configuration" -typekeywords:"SMX"'},90406:(e,t,a)=>{a.d(t,{M:()=>v,a:()=>l,b:()=>c,c:()=>p,d:()=>o,e:()=>i,f:()=>s,g:()=>n,h:()=>d,i:()=>m});var r=a(85984);const n=(e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:r,toIndex:n})=>{const o=structuredClone(e),i=c(o,t);let l=i;t!==a&&(l=c(o,a));const[s]=i.targetCategory.categories.splice(r,1);return l.targetCategory.categories.splice(n,0,s),u(o)},o=(e,{newTitle:t,path:a})=>{const r=structuredClone(e);return c(r,a).targetCategory.title=t,u(r)},i=(e,{newTitle:t,path:a})=>{const r=structuredClone(e),n=a.replace(/\/[^/]+$/,"");if(n){const{targetCategory:e}=c(r,n);e.categories.push({title:t,categories:[],count:0,path:null})}else r.categories.push({title:t,categories:[],count:0,path:null});return u(r)},l=(e,{path:t})=>{const a=structuredClone(e),{targetIndex:r,parentCategory:n}=c(a,t);return null==n||n.categories.splice(r,1),u(a)},s=e=>{var t;return null!==(t=null==e?void 0:e.replace(r.C,"").slice(1).split("/").length)&&void 0!==t?t:0},c=(e,t)=>{if(null==t||t===r.C)return{targetCategory:e,targetIndex:1,parentCategory:null};const a=t.slice(1).split("/");let n=0===t.indexOf(r.C)?(0,r.a)("",{title:a.shift()}):"",o=null,i=e,l=0;do{n=(0,r.a)(n,{title:a.shift()}),o=i,l=i.categories.findIndex((e=>e.path===n)),i=i.categories[l]}while(a.length>0&&i.categories.length);return{targetCategory:i,targetIndex:l,parentCategory:o}},d=(e,t)=>{var a,n;return{title:"",path:null,count:null!==(n=null===(a=t.fieldValues.find((e=>e.value===r.C)))||void 0===a?void 0:a.count)&&void 0!==n?n:0,categories:g(null,e,t)}},u=e=>e.categories.map(h),h=e=>({title:e.title,categories:e.categories.map(h)}),g=(e,t,a)=>t.map((t=>{var n,o;const i=(0,r.a)(null!=e?e:r.C,t),l=null===(n=a.fieldValues.find((e=>e.value===i)))||void 0===n?void 0:n.count,s=g(i,null!==(o=t.categories)&&void 0!==o?o:[],a);return{title:t.title,path:i,count:null!=l?l:0,categories:s}})),m=e=>e.reduce(((e,t)=>{var a;return e+1+m(null!==(a=t.categories)&&void 0!==a?a:[])}),0),p=({targetCategory:e,targetParentCategory:t})=>{var a;const r=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();return r?r.length>v?"maxCharacter":t.categories.some((t=>t.title.toLowerCase()===r&&t.path!==e.path))?"destinationHasSameName":null:"emptyTitle"},v=100}}]);