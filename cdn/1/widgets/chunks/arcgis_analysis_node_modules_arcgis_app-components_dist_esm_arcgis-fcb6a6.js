"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-fcb6a6"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser_31.entry.js":
/*!*************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-browser_31.entry.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_browser: () => (/* binding */ ArcgisItemBrowser),
/* harmony export */   arcgis_item_browser_actions: () => (/* binding */ ArcgisItemBrowserActions),
/* harmony export */   arcgis_item_browser_bucket_select: () => (/* binding */ ArcgisItemBrowserBucketSelect),
/* harmony export */   arcgis_item_browser_card: () => (/* binding */ ArcgisItemBrowserCard$1),
/* harmony export */   arcgis_item_browser_card_sublayer_select: () => (/* binding */ ArcgisItemBrowserCard),
/* harmony export */   arcgis_item_browser_card_thumbnail: () => (/* binding */ ArcgisItemBrowserCardThumbnail),
/* harmony export */   arcgis_item_browser_content: () => (/* binding */ ArcgisItemBrowserContent),
/* harmony export */   arcgis_item_browser_filter_categories: () => (/* binding */ ArcgisItemBrowserFilterCategories),
/* harmony export */   arcgis_item_browser_filter_collaborations: () => (/* binding */ ArcgisItemBrowserFilterCollaborations),
/* harmony export */   arcgis_item_browser_filter_content_status: () => (/* binding */ ArcgisItemBrowserFilterContentStatus),
/* harmony export */   arcgis_item_browser_filter_date: () => (/* binding */ ArcgisItemBrowserFilterDate),
/* harmony export */   arcgis_item_browser_filter_extent: () => (/* binding */ ArcgisItemBrowserFilterExtent),
/* harmony export */   arcgis_item_browser_filter_folder: () => (/* binding */ ArcgisItemBrowserFilterFolder),
/* harmony export */   arcgis_item_browser_filter_group: () => (/* binding */ ArcgisItemBrowserFilterGroup),
/* harmony export */   arcgis_item_browser_filter_industry: () => (/* binding */ ArcgisItemBrowserFilterIndustry),
/* harmony export */   arcgis_item_browser_filter_item_type: () => (/* binding */ ArcgisItemBrowserFilterItemType),
/* harmony export */   arcgis_item_browser_filter_location: () => (/* binding */ ArcgisItemBrowserFilterLocation),
/* harmony export */   arcgis_item_browser_filter_region: () => (/* binding */ ArcgisItemBrowserFilterRegion),
/* harmony export */   arcgis_item_browser_filter_sharing: () => (/* binding */ ArcgisItemBrowserFilterSharing),
/* harmony export */   arcgis_item_browser_filter_tags: () => (/* binding */ ArcgisItemBrowserFilterTags),
/* harmony export */   arcgis_item_browser_filters: () => (/* binding */ ArcgisItemBrowserFilters),
/* harmony export */   arcgis_item_browser_pagination: () => (/* binding */ ArcgisItemBrowserPagination),
/* harmony export */   arcgis_item_browser_preview: () => (/* binding */ ArcgisItemBrowserPreview),
/* harmony export */   arcgis_item_browser_preview_copy: () => (/* binding */ ArcgisItemBrowserPreviewCopy),
/* harmony export */   arcgis_item_browser_preview_field_details: () => (/* binding */ ArcgisItemBrowserPreviewFieldDetails),
/* harmony export */   arcgis_item_browser_search: () => (/* binding */ ArcgisItemBrowserSearch),
/* harmony export */   arcgis_item_browser_sort: () => (/* binding */ ArcgisItemBrowserSort),
/* harmony export */   arcgis_item_browser_table: () => (/* binding */ ArcgisItemBrowserTable),
/* harmony export */   arcgis_item_browser_table_row: () => (/* binding */ ArcgisItemBrowserTableRow),
/* harmony export */   arcgis_item_browser_top_bar: () => (/* binding */ ArcgisItemBrowserTopBar),
/* harmony export */   arcgis_item_browser_view: () => (/* binding */ ArcgisItemBrowserView)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./resize-a17b7292.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/resize-a17b7292.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./store-7fa26472.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./services-5925c4b4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./categories-9f0f37ee.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js");
/* harmony import */ var _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./categories-ca134005.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js");
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/* harmony import */ var _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./items-a4f5e98b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/items-a4f5e98b.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _badges_555e1b90_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./badges-555e1b90.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-555e1b90.js");
/* harmony import */ var _user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./user-0fa9ff5a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-0fa9ff5a.js");
/* harmony import */ var _utils_aa26c49f_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./utils-aa26c49f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-aa26c49f.js");
/* harmony import */ var _type_to_icon_7546439f_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./type-to-icon-7546439f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-7546439f.js");
/* harmony import */ var _utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./utils-2f459d6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-2f459d6d.js");
/* harmony import */ var _delete_items_32d24534_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./delete-items-32d24534.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/delete-items-32d24534.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */















































function getSearchSublayerIcon(geo) {
    const lookup = {
        point: "point",
        polyline: "line",
        polygon: "polygon",
        nonspatial: "table",
        multipoint: "layer-points"
    };
    return lookup[geo] || "table";
}
const geometryTypeLookup = {
    esriGeometryPoint: "point",
    esriGeometryPolyline: "polyline",
    esriGeometryPolygon: "polygon",
    esriGeometryMultipoint: "multipoint",
    none: "nonspatial",
    table: "nonspatial"
};
/* Convert a real feature layer to the search result index's form **/
function getSearchResultSublayer(sublayer) {
    const { description, geometryType, fieldAliases, title, id } = sublayer;
    return {
        description,
        fieldAliases: Array.isArray(fieldAliases) ? fieldAliases.join(",") : fieldAliases,
        geometryType: geometryTypeLookup[geometryType] || "nonspatial",
        id,
        title
    };
}

/**
 * Check if items are being stored with sublayers
 */
function isSublayer(selectedItem) {
    const entry = selectedItem;
    return !!(entry.item && entry.sublayer);
}
/**
 * Given a selected item entry and an item + sublayer,
 * determine if they represent the same entity
 */
function isSameItem({ item, sublayer, selectedItem }) {
    var _a, _b;
    if (isSublayer(selectedItem) && sublayer) {
        return (item === null || item === void 0 ? void 0 : item.id) === ((_a = selectedItem.item) === null || _a === void 0 ? void 0 : _a.id) && sublayer.id === ((_b = selectedItem.sublayer) === null || _b === void 0 ? void 0 : _b.id);
    }
    else {
        return (item === null || item === void 0 ? void 0 : item.id) === selectedItem.id;
    }
}
/**
 * Check if an item is present in a set of selected items
 */
function isSelected({ item, sublayer, selectedItems }) {
    return selectedItems.some((selectedItem) => isSameItem({ item, sublayer, selectedItem }));
}
/**
 * Filter out an item from a set of selected items
 */
function deselectItem({ item, sublayer, selectedItems }) {
    return selectedItems.filter((selectedItem) => !isSameItem({ item, sublayer, selectedItem }));
}
/**
 * Add an element to the selectedItems array
 */
function selectItem({ item, sublayer, selectedItems }) {
    // assume that if there is a sublayer we should be storing in that form
    const entry = sublayer ? { item, sublayer } : item;
    if (!isSelected({ item, sublayer, selectedItems })) {
        return [...selectedItems, entry];
    }
    return [...selectedItems];
}
/**
 * Find all selected sublayers for a given item
 */
function findSelectedSublayers({ item, selectedItems }) {
    return selectedItems.filter((selectedItem) => { var _a; return ((_a = selectedItem.item) === null || _a === void 0 ? void 0 : _a.id) === (item === null || item === void 0 ? void 0 : item.id); });
}

const arcgisItemBrowserCss = ":host{position:relative;display:flex;height:100%;min-height:100%;width:100%;flex-direction:column;overflow-y:auto;overflow-x:hidden;background-color:var(--calcite-color-background);--item-browser-max-width:100%;--item-browser-pane-width:18.75rem;--item-browser-pane-z-index:11;--item-browser-top-bar-background:var(--calcite-color-foreground-1)}:host([height=auto]){display:flex;height:auto;flex-direction:column}arcgis-browser{--arcgis-browser-max-width:var(--item-browser-max-width);--arcgis-browser-pane-width:var(--item-browser-pane-width);--arcgis-browser-pane-z-index:var(--item-browser-pane-z-index);--arcgis-browser-top-bar-background:var(--item-browser-top-bar-background)}.content--padded-bottom{padding-bottom:1.5rem}@media screen and (max-width: 640px){:host{--item-browser-pane-width:100%}}";

const ArcgisItemBrowser = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserUpdate", 7);
        this.arcgisItemBrowserLoading = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserLoading", 7);
        this.arcgisItemBrowserSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSelect", 7);
        this.arcgisItemBrowserPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPreview", 7);
        this.arcgisItemBrowserSublayerPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSublayerPreview", 7);
        this.arcgisItemBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
        this.liveRegionUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "liveRegionUpdate", 7);
        this.allowFetch = false;
        this.currentResults = [];
        this.updateFiltersEmpty = () => {
            var _a;
            this.store.state.filtersEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="filters"]`));
        };
        this.updateTopbarEmpty = () => {
            var _a;
            this.store.state.topbarEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="top-bar"]`));
        };
        this.updateSortEmpty = () => {
            var _a;
            this.store.state.sortEmpty = !((_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`[slot="sort"]`));
        };
        this.filterMutationObserver = new MutationObserver(this.updateFiltersEmpty);
        this.topbarMutationObserver = new MutationObserver(this.updateTopbarEmpty);
        this.sortMutationObserver = new MutationObserver(this.updateSortEmpty);
        this.fetchItems = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)(async () => {
            var _a, _b;
            this.loading = true;
            this.arcgisItemBrowserLoading.emit();
            this.currentResults = [];
            this.store.state.preview = null;
            if (!this.portal || !this.allowFetch) {
                this.loading = false;
                return;
            }
            let query = this.getQuery();
            if (this.preflight) {
                query = await this.preflight(query);
            }
            const { response, error } = await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.m)(this.queryItems(query), 500);
            // TODO: handle more error cases here.
            // for now this is a no-op for the recycle bin case.
            if (error) {
                return;
            }
            this.arcgisItemBrowserUpdate.emit(Object.assign(Object.assign(Object.assign({}, response), { selectedItems: this.selectedItems, filters: (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.c)(Object.assign({}, this.store.state.filters), this.bucket), searchTerm: this.searchTerm, recycleBin: this.store.state.recycleBin }), this.sort));
            this.currentResponse = response;
            this.currentResults = response.results;
            // add all tags from the items to the tags picker.
            this.store.state.knownTags = (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.a)(response, this.store.state.knownTags, (_b = (_a = this.store.state.filters) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.tags);
            this.store.state.highlights = (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.b)(response, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config);
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
            this.loading = false;
        }, 150);
        this.resize = () => {
            var _a, _b;
            const width = this.el.clientWidth || ((_a = this.el.parentElement) === null || _a === void 0 ? void 0 : _a.clientWidth) || 0;
            const height = this.el.clientHeight || ((_b = this.el.parentElement) === null || _b === void 0 ? void 0 : _b.clientHeight) || 0;
            this.formFactor = width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
            const oldFormFactor = this.store.state.width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm ? "large" : "small";
            /** when going from large to small or small to large, collapse or expand filters, accordingly */
            if (oldFormFactor === "large" && this.formFactor === "small") {
                /** use panel layout if enabled on smaller item browsers */
                this.store.state.panel = this.usePanelLayout;
                this.store.state.filtersExpanded = false;
            }
            if (oldFormFactor === "small" && this.formFactor === "large") {
                /** panel layout won't work on larger item browsers */
                this.store.state.panel = false;
                this.store.state.filtersExpanded = true;
            }
            this.store.state.width = width;
            this.store.state.height = height;
        };
        this.renderSelectedItem = (selectedItem) => {
            const usingSublayers = isSublayer(selectedItem);
            const item = usingSublayers ? selectedItem.item : selectedItem;
            const sublayer = usingSublayers ? selectedItem.sublayer : null;
            const description = usingSublayers ? sublayer.title : null;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected-item", { heading: item.title, description: description, onArcgisSelectedItemRemove: () => {
                    this.selectedItems = deselectItem({ item, sublayer, selectedItems: this.selectedItems });
                    this.arcgisItemBrowserSelect.emit(this.selectedItems);
                } }, usingSublayers ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { slot: "content-start", icon: getSearchSublayerIcon(selectedItem.sublayer.geometryType), scale: "s" })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { slot: "content-start", item: item, portal: this.portal, scale: "s", showText: false }))));
        };
        this.api = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.subscriptionInfo = undefined;
        this.userLicensedItems = undefined;
        this.config = undefined;
        this.groupId = undefined;
        this.selection = "none";
        this.selectedItems = [];
        this.allowedGeometries = [..._thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.d];
        this.allowedSubscriptionContentTypes = undefined;
        this.view = "list";
        this.bucket = undefined;
        this.num = 20;
        this.q = "";
        this.filter = "";
        this.height = "full";
        this.preflight = undefined;
        this.fetch = undefined;
        this.showFieldStatistics = false;
        this.store = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_1__.c)({ filters: {} });
        this.hidePreviewFooters = false;
        this.hideContentTop = false;
        this.contentPaddedBottom = false;
        this.usePanelLayout = false;
        this.baseUrls = {};
        this.searchTerm = "";
        this.sort = undefined;
        this.page = { num: this.num, start: 1, nextStart: -1 };
        this.loading = true;
        this.formFactor = undefined;
        this.previewItem = undefined;
        this.currentResponse = undefined;
    }
    /** Manually trigger a fetch of new results */
    async refresh() {
        this.fetchItems();
    }
    async componentWillLoad() {
        const { el, groupId, view, bucket, allowedGeometries, selectedItems, showFieldStatistics } = this;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.g)(el);
        this.i18n = locale[0];
        if (bucket) {
            this.store.state.bucket = bucket;
        }
        this.store.state.groupId = groupId;
        this.store.state.i18n = locale[0];
        this.store.state.lang = locale[1];
        this.store.state.view = view;
        this.store.state.selection = this.selection;
        this.store.state.selectedItems = selectedItems;
        this.store.state.allowedGeometries = allowedGeometries;
        this.store.state.showFieldStatistics = showFieldStatistics;
        this.store.state.interaction = "keyboard";
        this.initializeConfig();
        this.store.state.width = 420;
        this.store.state.panel = true;
        this.store.state.filtersExpanded = false;
        this.formFactor = "small";
        this.filterMutationObserver.observe(el, { childList: true });
        this.topbarMutationObserver.observe(el, { childList: true });
        this.sortMutationObserver.observe(el, { childList: true });
        this.updateFiltersEmpty();
        this.updateTopbarEmpty();
        this.updateSortEmpty();
        this.resize();
        this.resizeHandler = () => requestAnimationFrame(this.resize);
        window.addEventListener("resize", this.resizeHandler);
        if (this.usePanelLayout || (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.c)(this.el, "calcite-shell-panel")) {
            this.store.state.panel = true;
            this.store.state.filtersExpanded = false;
        }
    }
    disconnectedCallback() {
        var _a;
        (_a = this.store.state.resizeObserver) === null || _a === void 0 ? void 0 : _a.unobserve(this.el);
        this.filterMutationObserver.disconnect();
        this.topbarMutationObserver.disconnect();
        this.sortMutationObserver.disconnect();
        this.filterClearHandler(false);
        window.removeEventListener("resize", this.resizeHandler);
    }
    updateUser(newUser) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user = newUser);
    }
    updateUserLicensedItems(licensedItems) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.userLicensedItems) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.userLicensedItems = licensedItems);
    }
    updateSubscriptionInfo(subscriptionInfo) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.subscriptionInfo) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.subscriptionInfo = subscriptionInfo);
    }
    updatePortal(newPortal) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = newPortal);
    }
    updateAPI(newValue) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = newValue);
    }
    updateConfig(newConfig) {
        var _a;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config = newConfig);
    }
    updateSelection(newValue) {
        this.store.state.selection = newValue;
    }
    updateGroupID(id) {
        this.store.state.groupId = id;
    }
    updateSublayerSelectionGeometryTypes(types) {
        this.store.state.allowedGeometries = types;
    }
    updateSelectedItems(items) {
        this.store.state.selectedItems = items;
    }
    updateFieldStatistics(value) {
        this.store.state.showFieldStatistics = value;
    }
    updateView(view) {
        this.store.state.view = view;
    }
    updateBucket(bucket) {
        var _a, _b, _c, _d;
        this.store.state.bucket = bucket;
        const isMyRecycleBin = bucket === "my" && ((_b = (_a = this.store.state.filters) === null || _a === void 0 ? void 0 : _a.folder) === null || _b === void 0 ? void 0 : _b.folder) === "recycle";
        const isOrgRecycleBin = bucket === "org" && ((_d = (_c = this.store.state.filters) === null || _c === void 0 ? void 0 : _c.contentType) === null || _d === void 0 ? void 0 : _d.contentType) === "recycle";
        this.store.state.recycleBin = isMyRecycleBin || isOrgRecycleBin;
        this.selectedItems = [];
        this.arcgisItemBrowserSelect.emit(this.selectedItems);
        this.fetchItems();
    }
    updateQ() {
        this.resetPagination();
        this.fetchItems();
    }
    async componentDidLoad() {
        this.resize();
        this.initializeConfig();
        // initially, fetch is locked
        // wait for all components to emit events impacting state prior to initial fetch
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
        this.allowFetch = true;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            this.fetchItems();
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => {
                this.initializeConfig();
                this.fetchItems();
            });
        }
    }
    filterHandler(e) {
        var _a, _b;
        const filters = Object.assign(Object.assign({}, this.store.state.filters), { [e.detail.id]: e.detail });
        // when we move to the recycle bin, set a flag in state
        if (((_a = e.detail) === null || _a === void 0 ? void 0 : _a.id) === "folder") {
            this.store.state.recycleBin = e.detail.folder === "recycle";
        }
        if (((_b = e.detail) === null || _b === void 0 ? void 0 : _b.id) === "contentType") {
            this.store.state.recycleBin =
                e.detail.contentType === "recycle";
        }
        // remove filter from set
        if (!e.detail.value) {
            delete filters[e.detail.id];
        }
        this.store.state.filters = filters;
        this.resetPagination();
        this.fetchItems();
    }
    filterRemoveHandler(e) {
        if (!e.detail) {
            return;
        }
        const filters = Object.assign({}, this.store.state.filters);
        delete filters[e.detail];
        this.store.state.filters = filters;
        this.resetPagination();
        this.fetchItems();
    }
    filterClearHandler(doFetchItems = true) {
        const newFilters = {};
        const filters = this.store.state.filters;
        // preserve filters we don't show in the filter chip set
        if (this.bucket === "my" && (filters === null || filters === void 0 ? void 0 : filters.folder)) {
            newFilters.folder = filters.folder;
        }
        if (this.bucket === "group" && (filters === null || filters === void 0 ? void 0 : filters.group)) {
            newFilters.group = filters.group;
        }
        this.store.state.filters = newFilters;
        this.resetPagination();
        doFetchItems && this.fetchItems();
    }
    genericFilterClearHandler() {
        this.filterClearHandler();
    }
    searchHandler(e) {
        const newTerm = e.detail;
        this.searchTerm = newTerm;
        this.resetPagination();
        if (newTerm) {
            this.fetchItems();
        }
        else {
            this.fetchItems.invoke();
        }
    }
    bucketHandler(e) {
        this.store.state.bucket = e.detail;
        this.bucket = e.detail;
        this.store.state.recycleBin = false;
        this.resetPagination();
        this.fetchItems();
    }
    sortHandler(e) {
        this.sort = e.detail;
        this.store.state.sort = e.detail;
        this.fetchItems();
    }
    viewHandler(e) {
        this.view = e.detail;
        this.store.state.view = e.detail;
    }
    async pageHandler(e) {
        var _a;
        this.page = e.detail;
        if (this.allowFetch) {
            await this.fetchItems();
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(400);
            (_a = this.el.shadowRoot.querySelector(".scrolling")) === null || _a === void 0 ? void 0 : _a.scrollTo({ behavior: "smooth", top: 0 });
        }
    }
    selectHandler(e) {
        const selectedItems = this.selectedItems;
        const { selected, item, sublayer } = e.detail;
        switch (this.selection) {
            case "single":
            case "single-sublayer":
                // by passing an empty array for selected items we ensure only the current item is selected
                this.selectedItems = selectItem({ item, sublayer, selectedItems: [] });
                break;
            case "multiple":
            case "multiple-sublayer":
                this.selectedItems = selected
                    ? selectItem({ item, sublayer, selectedItems })
                    : deselectItem({ item, sublayer, selectedItems });
                break;
        }
        this.arcgisItemBrowserSelect.emit(this.selectedItems);
    }
    async togglePreview({ detail }) {
        this.store.state.filtersExpanded = false;
        // don't show preview for recycle bin
        if (this.store.state.recycleBin) {
            return;
        }
        if (!detail || this.store.state.preview === detail.id) {
            this.store.state.preview = null;
            this.previewItem = null;
            this.arcgisItemBrowserPreview.emit();
            this.arcgisItemBrowserSublayerPreview.emit();
            this.restoreFocus();
        }
        else {
            this.restoreFocusElement = document.activeElement;
            this.store.state.preview = detail.id;
            this.previewItem = Object.assign({}, detail);
            this.arcgisItemBrowserPreview.emit(Object.assign({}, detail));
        }
        this.arcgisItemBrowserInternalUIAction.emit({
            action: this.previewItem ? "open panel" : "close panel",
            category: "card action"
        });
    }
    tileSelectHandler(e) {
        const { item } = e.detail;
        this.arcgisItemBrowserSelect.emit([item]);
    }
    columnUpdateHandler(e) {
        this.store.state.columns = e.detail;
    }
    handleMove() {
        this.store.state.interaction = "mouse";
    }
    handleTouch() {
        this.store.state.interaction = "touch";
    }
    handleKey() {
        this.store.state.interaction = "keyboard";
    }
    async initializeConfig() {
        var _a, _b, _c, _d;
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api = this.api);
        (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) !== null && _b !== void 0 ? _b : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user = this.user);
        (_c = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) !== null && _c !== void 0 ? _c : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal = this.portal);
        (_d = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) !== null && _d !== void 0 ? _d : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config = this.config);
    }
    resetPagination() {
        this.page.start = 1;
        this.page.total = 0;
    }
    getQuery() {
        return Object.assign(Object.assign({ filters: this.store.state.filters, searchTerm: this.searchTerm, baseQuery: this.q, baseFilter: this.filter, bucket: this.bucket, allowedGeometries: this.allowedGeometries }, this.sort), this.page);
    }
    async queryItems(query) {
        var _a, _b;
        let response;
        if (this.fetch) {
            response = await this.fetch(query);
        }
        else {
            const { portal, user, store, groupId, config } = this;
            try {
                response = await (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.q)({ portal, query, user, store, groupId, config });
            }
            catch (error) {
                return { error };
            }
        }
        if (await (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.i)(this.portal, (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.bucket)) {
            (_b = response === null || response === void 0 ? void 0 : response.results) === null || _b === void 0 ? void 0 : _b.forEach(({ id }) => {
                this.baseUrls[id] = "arcgis.com";
            });
        }
        return { response };
    }
    restoreFocus() {
        if (this.restoreFocusElement) {
            const el = this.restoreFocusElement;
            if (el.restoreFocus) {
                el.restoreFocus();
            }
            else if (el.setFocus) {
                el.setFocus();
            }
            else if (el.focus) {
                el.focus();
            }
        }
    }
    renderSelected() {
        var _a, _b, _c, _d, _e, _f;
        const wholePageSelected = ((_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.length) &&
            ((_b = this.currentResults) === null || _b === void 0 ? void 0 : _b.every((item) => isSelected({ item, selectedItems: this.selectedItems })));
        const totalSelectedItems = (_c = this.selectedItems) === null || _c === void 0 ? void 0 : _c.length;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-selected", { slot: "selection", loading: this.loading, total: (_d = this.currentResults) === null || _d === void 0 ? void 0 : _d.length, totalSelected: (_e = this.store.state.selectedItems) === null || _e === void 0 ? void 0 : _e.length, hideSelectedText: this.store.state.width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm, heading: this.selection === "multiple-sublayer"
                ? this.i18n.itemBrowser.selectedLayers
                : this.i18n.itemBrowser.selectedItems, emptyText: this.selection === "multiple-sublayer"
                ? this.i18n.itemBrowser.noSelectedLayers
                : this.i18n.itemBrowser.noSelectedItems, checked: wholePageSelected, indeterminate: !wholePageSelected && !!totalSelectedItems, hideCheckbox: this.selection === "multiple-sublayer", onArcgisSelectedDeselectAll: () => {
                this.selectedItems = [];
                this.arcgisItemBrowserSelect.emit(this.selectedItems);
            }, onArcgisSelectedSelectPage: () => {
                var _a;
                let selectedItems = [...this.selectedItems];
                (_a = this.currentResults) === null || _a === void 0 ? void 0 : _a.forEach((item) => {
                    selectedItems = selectItem({ item, selectedItems });
                });
                this.selectedItems = selectedItems;
                this.arcgisItemBrowserSelect.emit(this.selectedItems);
            } }, (_f = this.store.state.selectedItems) === null || _f === void 0 ? void 0 : _f.map(this.renderSelectedItem)));
    }
    renderSlot(name, defaultContent) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: name }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: name }, defaultContent)));
    }
    render() {
        const { previewItem, loading, hideContentTop, i18n, selectedItems, selection, currentResponse, store, api, renderSlot, searchTerm, formFactor, view, height } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser", { preview: !!previewItem, loading: loading, hideContentTop: hideContentTop, selected: selectedItems, alwaysShowSelection: selection === null || selection === void 0 ? void 0 : selection.includes("multiple"), alwaysShowContent: view === "table", response: currentResponse, store: store, api: api, formFactor: formFactor, searchTerm: searchTerm, height: height }, renderSlot("top-bar"), renderSlot("view"), renderSlot("sort"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview", { slot: "preview", item: this.previewItem, portal: this.portal, user: this.user, key: this.store.state.preview, onArcgisItemBrowserPreviewClose: () => {
                this.store.state.preview = null;
                this.arcgisItemBrowserPreview.emit();
                this.arcgisItemBrowserSublayerPreview.emit();
                this.restoreFocus();
            }, onArcgisInternalItemBrowserSublayer: (e) => {
                e.stopPropagation();
                this.arcgisItemBrowserSublayerPreview.emit(e.detail);
            }, hidePreviewFooters: this.hidePreviewFooters }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "summary-top" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-summary-top" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "preview-footer" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "sublayer-footer" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "sublayer-preview-footer" }))), this.renderSelected(), renderSlot("actions"), renderSlot("content-start"), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: { "content--padded-bottom": this.contentPaddedBottom } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content" })), renderSlot("content-end"), renderSlot("pagination"), renderSlot("filters"), renderSlot("scroll-end"), renderSlot("no-results", i18n.content.noResults), renderSlot("no-content", i18n.content.noContent))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "user": ["updateUser"],
        "userLicensedItems": ["updateUserLicensedItems"],
        "subscriptionInfo": ["updateSubscriptionInfo"],
        "portal": ["updatePortal"],
        "api": ["updateAPI"],
        "config": ["updateConfig"],
        "selection": ["updateSelection"],
        "groupId": ["updateGroupID"],
        "allowedGeometries": ["updateSublayerSelectionGeometryTypes"],
        "selectedItems": ["updateSelectedItems"],
        "showFieldStatistics": ["updateFieldStatistics"],
        "view": ["updateView"],
        "bucket": ["updateBucket"],
        "q": ["updateQ"],
        "filter": ["updateQ"]
    }; }
};
ArcgisItemBrowser.style = arcgisItemBrowserCss;

const ArcgisItemBrowserActions = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.actions = [];
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-actions", { actions: this.actions, selection: this.store.state.selectedItems, store: this.store })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

function canViewAGO(settings, portal, user) {
    var _a, _b, _c, _d, _e;
    if (portal.isPortal) {
        return (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties) === null || _a === void 0 ? void 0 : _a.searchArcGISOnlineEnabled) !== null && _b !== void 0 ? _b : true;
    }
    if (!user || (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.b)(user)) {
        return true;
    }
    return (_e = (_d = (_c = portal.sourceJSON) === null || _c === void 0 ? void 0 : _c.canSearchPublic) !== null && _d !== void 0 ? _d : portal.canSearchPublic) !== null && _e !== void 0 ? _e : true;
}
async function getValidOptions(portal, user, options) {
    var _a, _b;
    if (!portal) {
        return [];
    }
    const settings = await (0,_api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_10__.j)(portal);
    const provisionedListings = (_a = ((options === null || options === void 0 ? void 0 : options.includes("subscription content")) && await (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.e)(user, portal))) !== null && _a !== void 0 ? _a : [];
    const properties = settings === null || settings === void 0 ? void 0 : settings.portalConfigProperties;
    const canViewLivingAtlas = (_b = properties === null || properties === void 0 ? void 0 : properties.portalLivingAtlasConfigEnabled) !== null && _b !== void 0 ? _b : true;
    return options.filter((option) => {
        // for public portals, allow anonymous users to see the portal's public content
        if (!user && option === "org") {
            return (portal === null || portal === void 0 ? void 0 : portal.access) === "public";
        }
        // anonymous should not see my content or org content
        if (!user && ["my", "favorites", "group", "org"].includes(option)) {
            return false;
        }
        // users without create/receive item privs can't have my content (#4398)
        if (user && !((0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_11__.l)(user) || (0,_privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_11__.n)(user)) && option === "my") {
            return false;
        }
        // public users should not see org option
        if (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(user) && option === "org") {
            return false;
        }
        if (option === "subscription content" && (!user || !(provisionedListings === null || provisionedListings === void 0 ? void 0 : provisionedListings.length))) {
            return false;
        }
        // portals can configure wether users should see LA or AGO #3817
        if ((!canViewLivingAtlas && (option === "living atlas" || option === "living atlas analysis")) ||
            (!canViewAGO(settings, portal, user) && option === "all")) {
            return false;
        }
        return true;
    });
}

const arcgisItemBrowserBucketSelectCss = ":host{display:block}.large{border-inline-end:1px solid var(--calcite-color-border-3)}.button{padding:0.5rem;--calcite-font-weight-normal:500}";

const ArcgisItemBrowserBucketSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserBucketSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserBucketSelect", 7);
        this.selectOption = (option) => {
            this.bucket = option;
            // assume if the user clicked it, it's valid
            this.validBucket = option;
            this.arcgisItemBrowserBucketSelect.emit(option);
        };
        this.optionLabel = (option) => {
            var _a;
            if (option === "org" && !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) {
                return (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) === null || _a === void 0 ? void 0 : _a.name;
            }
            return this.i18n[option];
        };
        this.options = [
            "my",
            "favorites",
            "group",
            "org",
            "living atlas",
            "all"
        ];
        this.bucket = "my";
        this.validBucket = undefined;
        this.validOptions = undefined;
    }
    updateOptions(newOptions) {
        this.updateValidOptions(newOptions);
    }
    async updateValidOptions(options, forceEmit) {
        const oldBucket = this.validBucket;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        this.validOptions = await getValidOptions(portal, user, options);
        this.validBucket = this.validOptions.includes(this.bucket) ? this.bucket : this.validOptions[0];
        // if we had to change the bucket, emit an event
        if (oldBucket !== this.validBucket || forceEmit) {
            this.arcgisItemBrowserBucketSelect.emit(this.validBucket);
        }
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.bucketSelect;
        await this.updateValidOptions(this.options, true);
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("user", () => {
            this.updateValidOptions(this.options);
        });
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => {
            this.updateValidOptions(this.options);
        });
    }
    render() {
        const { validOptions, validBucket, selectOption, optionLabel } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                large: this.store.state.width >= _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm
            } }, (validOptions === null || validOptions === void 0 ? void 0 : validOptions.length) > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-start", scale: "m", widthScale: "m", type: "click" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "button", kind: "neutral", appearance: "transparent", "icon-end": "chevron-down", slot: "trigger" }, optionLabel(validBucket)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "single" }, validOptions.map((option) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { selected: validBucket === option, onCalciteDropdownItemSelect: () => selectOption(option) }, optionLabel(option))))))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "options": ["updateOptions"]
    }; }
};
ArcgisItemBrowserBucketSelect.style = arcgisItemBrowserBucketSelectCss;

const arcgisItemBrowserCardCss = ":host{display:block;min-width:0px}.item-browser-card{position:relative;box-sizing:border-box;display:flex;height:100%;flex-direction:column;color:var(--calcite-color-text-1);opacity:0;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-duration:150ms;outline-color:transparent;background-color:var(--calcite-color-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-color-border-3)}.item-browser-card:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.item-browser-card--loaded{opacity:1}.item-browser-card--selected{border-color:var(--calcite-color-brand)}.item-browser-card--hoverable{cursor:pointer}.item-browser-card__top{padding:1rem}.item-browser-card__hover-text{position:absolute;inset:0px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:1rem;font-weight:500;opacity:0;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-color:rgba(21, 21, 21, 0.7);color:white}.item-browser-card__upper{flex:1 1 0%;background-color:var(--calcite-color-foreground-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.item-browser-card__upper:hover{background-color:var(--calcite-color-background)}.item-browser-card__upper:hover .item-browser-card__hover-text,.item-browser-card:focus .item-browser-card__hover-text{opacity:1}.item-browser-card__upper--link{color:var(--calcite-color-text-1);text-decoration-line:none;outline-color:transparent}.item-browser-card__upper--link:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:2px}.item-browser-card__title__span{position:relative;display:inline;border-style:none;background-color:transparent;padding:0px;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-image:linear-gradient(transparent, transparent);background-position-x:0%, 100%;background-position-y:min(1.25em, 100%);background-repeat:no-repeat, no-repeat;background-size:100% 1px, 100% 1px}.item-browser-card--previewed .item-browser-card__title__span{background-image:linear-gradient(var(--calcite-color-text-3), var(--calcite-color-text-3))}.item-browser-card--previewed{outline:1px solid var(--calcite-color-brand);outline-offset:-2px}.item-browser-card--previewed .item-browser-card__top{background-color:var(--calcite-color-background)}.item-browser-card__content{display:flex;min-width:0px;flex:1 1 0%;flex-direction:column}.item-browser-card__details{margin-top:0.25rem;display:flex;flex-direction:row}.item-browser-card__detail{font-size:0.875rem;color:var(--calcite-color-text-2)}.item-browser-card__calendar-icon{color:var(--calcite-color-text-3);margin-inline-end:0.5rem}.item-browser-card__footer{margin-top:auto;display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-top:1px solid var(--calcite-color-border-3)}.item-browser-card__footer__start{display:flex;min-width:0px;flex:1 1 0%;flex-direction:row;align-items:center;overflow:hidden;margin-inline-end:0.75rem}.item-browser-card__footer__start--owner{margin-inline-start:-0.25rem}.item-browser-card__footer-divider{border-right:1px solid var(--calcite-color-border-input);margin-inline-start:0.75rem;margin-inline-end:0.5rem;display:inline-block;height:1.5rem;width:0px}.item-browser-card__footer-divider--list{margin-left:1rem;margin-right:1rem}.item-browser-card__profile-wrap{box-sizing:border-box;max-width:100%;padding:0.25rem}.item-browser-card__summary{margin:0px;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-2)}.item-browser-card__divider{display:flex;align-items:center;flex:0 0 auto}.item-browser-card__divider:not([empty]):before{content:\"\";height:1.25rem;width:1px;background-color:var(--calcite-color-border-1);margin-inline:0.75rem}.item-browser-card__divider:first-child:before{display:none}.item-browser-card-flex{display:flex}.item-browser-card-flex-1{min-width:0px;flex:1 1 0%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.item-browser-card__input{margin-inline-end:1rem;margin-top:0.125rem}.item-browser-card__input--end{margin-inline-end:0px;margin-inline-start:1rem}.item-browser-card__title{margin-top:0px;margin-bottom:0px;overflow-wrap:break-word;padding-top:0px;padding-bottom:0px;font-size:1.125rem;font-weight:500;line-height:1.375}.item-browser-card__title--grid{font-size:1rem}.item-browser-card__title--padded{margin-bottom:0.5rem}.item-browser-card__snippet{margin:0px;margin-bottom:0.75rem;flex:1 1 0%;padding:0px;font-size:0.875rem}.item-browser-card__badges--stacked{margin-top:0.5rem}.item-browser-card__thumbnail{margin:0px;box-sizing:content-box;width:8rem;padding:0px;padding-inline-start:2rem;flex:0 0 auto}.item-browser-card__thumbnail--grid{position:relative;margin:0px;width:100%;padding:0px;border-bottom:1px solid var(--calcite-color-foreground-2)}.item-browser-card__owner{min-width:0px}.item-browser-card--panel{margin-bottom:0px;cursor:pointer;display:block;width:100%}.item-browser-card--xs .item-browser-card__top,.item-browser-card--xxs .item-browser-card__top{padding:0.75rem}.item-browser-card--xs .item-browser-card__title--padded,.item-browser-card--xxs .item-browser-card__title--padded{margin-bottom:0.25rem}.item-browser-card--xs .item-browser-card__footer,.item-browser-card--xxs .item-browser-card__footer{padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem}.item-browser-card--xs .item-browser-card__detail,.item-browser-card--xxs .item-browser-card__detail{font-size:0.75rem}.item-browser-card--xs .item-browser-card__title,.item-browser-card--xxs .item-browser-card__title{font-size:0.875rem}.item-browser-card--xxs .item-browser-card__title{font-size:0.75rem}.item-browser-card--xxs .item-browser-card__thumbnail{padding-inline-start:0.75rem;width:55px}.item-browser-card--xxs .item-browser-card__footer__start{margin-inline-end:0.5rem}.item-browser-card--xs .item-browser-card__thumbnail{width:5rem;padding-inline-start:0.5rem}";

const ArcgisItemBrowserCard$1 = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
        this.arcgisItemBrowserActionsOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserActionsOpen", 7);
        this.arcgisItemBrowserCardSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
        this.arcgisItemBrowserCardPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardPreview", 7);
        var _a;
        this.handleResizeEvent = (e) => {
            e.stopPropagation();
            this.resize(e.detail.width);
        };
        this.handleCardClick = () => {
            var _a;
            // when using the cards as a link, don't do any special handling
            if (this.link) {
                return;
            }
            const preview = this.preview === "top";
            const selection = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection;
            const { item } = this;
            if (preview && !this.store.state.recycleBin) {
                this.arcgisItemBrowserCardPreview.emit(item);
                return;
            }
            if (selection === "single") {
                this.arcgisItemBrowserCardSelect.emit({ item, selected: true });
            }
            else if (selection === "multiple") {
                this.arcgisItemBrowserCardSelect.emit({
                    item,
                    selected: !isSelected({ item, selectedItems: this.store.state.selectedItems })
                });
            }
        };
        this.item = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.api = 4;
        this.baseUrl = (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
        this.link = undefined;
        this.newTab = undefined;
        this.selected = undefined;
        this.selection = undefined;
        this.name = undefined;
        this.preview = undefined;
        this.showOwner = true;
        this.showDateUpdated = true;
        this.showItemType = true;
        this.showSummary = false;
        this.showBadges = true;
        this.showAccess = undefined;
        this.showFavorite = undefined;
        this.showThumbnail = true;
        this.actions = [];
        this.hover = undefined;
        this.formFactor = undefined;
        this.updatedText = "";
        this.shortUpdatedText = "";
        this.loaded = undefined;
        this.noSpaceForDate = true;
    }
    /* Calling this setFocus causes calcite to focus here when the user popup is closed... */
    async restoreFocus() {
        if (this.link && this.linkEl) {
            this.linkEl.focus();
            return;
        }
        if (this.preview === "top" && this.sectionEl) {
            this.sectionEl.focus();
            return;
        }
    }
    async componentWillLoad() {
        var _a, _b, _c, _d, _e;
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.card;
        (_a = this.formFactor) !== null && _a !== void 0 ? _a : (this.formFactor = ((_b = this.store) === null || _b === void 0 ? void 0 : _b.state.panel) ? "xs" : "lg");
        (0,_resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.s)(this.store).observe(this.el);
        this.el.addEventListener("arcgisBrowserResize", this.handleResizeEvent);
        const formattedDate = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)(this.item.modified);
        this.updatedText = this.i18n.lastUpdated.replace("${date}", formattedDate);
        this.shortUpdatedText = formattedDate;
        this.portal = (_c = this.portal) !== null && _c !== void 0 ? _c : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal;
        this.user = (_d = this.user) !== null && _d !== void 0 ? _d : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user;
        this.api = (_e = this.api) !== null && _e !== void 0 ? _e : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api;
    }
    async componentDidLoad() {
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
        this.loaded = true;
    }
    disconnectedCallback() {
        var _a, _b, _c, _d;
        (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.resizeObserver) === null || _c === void 0 ? void 0 : _c.unobserve(this.el);
        (_d = this.el) === null || _d === void 0 ? void 0 : _d.removeEventListener("arcgisBrowserResize", this.handleResizeEvent);
    }
    resize(width) {
        switch (true) {
            case width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.md:
                this.formFactor = "lg";
                break;
            case width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm:
                this.formFactor = "md";
                break;
            case width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xs:
                this.formFactor = "sm";
                break;
            case width > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xxs:
                this.formFactor = "xs";
                break;
            default:
                this.formFactor = "xxs";
                break;
        }
    }
    renderSelection(selected) {
        var _a, _b;
        const { i18n, item } = this;
        const selection = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection;
        const classes = {
            "item-browser-card__input": true,
            "item-browser-card__input--end": ((_b = this.store) === null || _b === void 0 ? void 0 : _b.state.view) === "grid"
        };
        if (selection === "single") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-radio-button", { class: classes, checked: selected, value: item.title, name: this.name, onClick: (e) => {
                    e.stopPropagation();
                }, onCalciteRadioButtonChange: () => {
                    this.arcgisItemBrowserCardSelect.emit({ item, selected: true });
                } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, i18n.select.replace("${title}", item.title))));
        }
        if (selection === "multiple") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { class: classes, checked: selected, onClick: (e) => {
                    e.stopPropagation();
                }, onCalciteCheckboxChange: () => {
                    this.arcgisItemBrowserCardSelect.emit({ item, selected: !selected });
                }, value: item.id }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, item.title)));
        }
        return null;
    }
    renderOwner() {
        var _a, _b, _c;
        const { item, api, portal, formFactor } = this;
        const isOnlineInPortal = (portal === null || portal === void 0 ? void 0 : portal.isPortal) && this.store.state.bucket === "all";
        const baseUrl = isOnlineInPortal
            ? "https://www.arcgis.com/home/"
            : (_a = this.baseUrl) !== null && _a !== void 0 ? _a : (_b = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _b === void 0 ? void 0 : _b.baseUrl;
        if (!this.showOwner) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__profile-wrap", onClick: (e) => {
                e.preventDefault();
                e.stopPropagation();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { underline: true, item: item, api: api, portal: portal, baseUrl: baseUrl, showName: ((_c = this.store) === null || _c === void 0 ? void 0 : _c.state.view) !== "grid", checkOnline: portal.isPortal && this.store.state.bucket === "all", class: "item-browser-card__owner", scale: ["md", "lg"].includes(formFactor) ? "m" : "s", onArcgisUserPopupInternalUIAction: (e) => {
                e.stopPropagation();
                this.arcgisItemBrowserInternalUIAction.emit(e.detail);
            } })));
    }
    renderItemType() {
        var _a;
        const { item, portal, showItemType, formFactor } = this;
        if (!showItemType) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { class: {
                "item-browser-card__divider": !((_a = this.store) === null || _a === void 0 ? void 0 : _a.state.panel)
            }, scale: ["xxs", "xs"].includes(formFactor) ? "s" : "m", item: item, portal: portal }));
    }
    render() {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
        const { item, user, portal, formFactor, i18n, loaded, showDateUpdated, showItemType, showOwner, showBadges, showSummary, showThumbnail, link, newTab, showAccess, actions } = this;
        const current = ((_a = this.store) === null || _a === void 0 ? void 0 : _a.state.preview) === this.item.id;
        const grid = ((_b = this.store) === null || _b === void 0 ? void 0 : _b.state.view) === "grid";
        const topPreview = this.preview === "top";
        const topPreviewAttributes = {
            tabIndex: 0,
            role: "button",
            "aria-haspopup": "dialog",
            "aria-labelledby": "open-details",
            onKeyPress: (e) => {
                if (e.key === "Enter" || e.key == " ") {
                    e.preventDefault();
                    this.handleCardClick();
                }
            }
        };
        const selection = (_c = this.store) === null || _c === void 0 ? void 0 : _c.state.selection;
        const itemSelection = ["single", "multiple"].includes(selection);
        const selected = itemSelection &&
            isSelected({ item: this.item, selectedItems: (_d = this.store) === null || _d === void 0 ? void 0 : _d.state.selectedItems });
        const CardTag = this.link ? "a" : "div";
        const linkAttributes = Object.assign({ href: link }, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {}));
        const extraSmall = ["xxs", "xs"].includes(formFactor);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", Object.assign({ class: {
                "item-browser-card": true,
                "item-browser-card--hoverable": true,
                [`item-browser-card--${formFactor}`]: true,
                "item-browser-card--panel": (_e = this.store) === null || _e === void 0 ? void 0 : _e.state.panel,
                "item-browser-card--loaded": loaded,
                "item-browser-card--previewed": ((_f = this.store) === null || _f === void 0 ? void 0 : _f.state.preview) === item.id,
                "item-browser-card--selected": selected
            }, onMouseOver: () => (this.hover = true), onMouseOut: () => (this.hover = false) }, (link ? {} : { onClick: this.handleCardClick }), (topPreview && !link ? topPreviewAttributes : {}), { ref: (el) => (this.sectionEl = el) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-top" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(CardTag, Object.assign({ class: { "item-browser-card__upper": true, "item-browser-card__upper--link": !!link } }, (link ? linkAttributes : {}), { ref: (el) => (this.linkEl = el) }), grid && showThumbnail && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "item-browser-card__thumbnail--grid" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }), topPreview && !link && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__hover-text", id: "open-details" }, ((_h = (_g = this.store) === null || _g === void 0 ? void 0 : _g.state) === null || _h === void 0 ? void 0 : _h.preview) === item.id ? i18n.closeDetails : i18n.openDetails)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex item-browser-card__top" }, !grid && this.renderSelection(selected), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex-1" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card-flex" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: {
                "item-browser-card__title": true,
                "item-browser-card__title--padded": showItemType || (showSummary && !!item.snippet),
                "item-browser-card__title--grid": grid,
                "item-browser-card-flex-1": true
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "item-browser-card__title__span" }, item.title)), grid && this.renderSelection(selected)), showSummary && item.snippet && !extraSmall && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "item-browser-card__summary" }, item.snippet.length > 250
            ? `${item.snippet.substring(0, 250)}…`
            : item.snippet)), ((_j = this.store) === null || _j === void 0 ? void 0 : _j.state.panel) && this.renderItemType(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__details" }, !((_k = this.store) === null || _k === void 0 ? void 0 : _k.state.panel) && this.renderItemType(), showDateUpdated && formFactor !== "xxs" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: {
                "item-browser-card__detail": true,
                "item-browser-card__divider": true
            } }, ["xxs", "xs", "sm"].includes(formFactor) || grid
            ? this.shortUpdatedText
            : this.updatedText)), showBadges && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { item: item, user: user, portal: portal, width: formFactor === "lg" && !grid ? "full" : "narrow", showTooltips: true, class: {
                "item-browser-card__badges": true,
                "item-browser-card__divider": true
            }, scale: "s" })))), !grid && showThumbnail && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("figure", { class: "item-browser-card__thumbnail" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__footer", onClick: (e) => {
                const classList = e.target.classList;
                // any slotted components will not propagate up, as we don't want them to trigger a preview
                if (!classList.contains("item-browser-card__footer") &&
                    !classList.contains("item-browser-card__footer__start")) {
                    e.stopPropagation();
                }
            }, onKeyPress: (e) => {
                if (e.key === "Enter" || e.key == " ") {
                    e.stopPropagation();
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                "item-browser-card__footer__start": true,
                "item-browser-card__footer__start--owner": showOwner
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-start" }), !grid && this.renderOwner()), grid && this.renderOwner(), showAccess && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "item-browser-card__access-wrap", onClick: (e) => {
                e.preventDefault();
                e.stopPropagation();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-summary", { item: item, class: "item-browser-card__access", scale: "s", showText: !grid && formFactor === "lg" }))), (showAccess || (grid && showOwner)) && ((_l = this.actions) === null || _l === void 0 ? void 0 : _l.length) > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: {
                "item-browser-card__footer-divider": true,
                "item-browser-card__footer-divider--list": !grid
            } })), this.showFavorite && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-favorite", { item: item, portal: portal, user: user || (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user), iconOnly: true })), this.preview === "action" && !this.store.state.recycleBin && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { scale: "s", appearance: current ? "solid" : "outline", kind: "neutral", onClick: (e) => {
                e.preventDefault();
                e.stopPropagation();
                this.arcgisItemBrowserCardPreview.emit(this.item);
            } }, current ? i18n.hidePreview : i18n.preview)), (selection === null || selection === void 0 ? void 0 : selection.includes("sublayer")) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-sublayer-select", { item: item, user: user, portal: portal, selection: selection === "multiple-sublayer" ? "multiple" : "single", showErrors: true })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "actions-end" }), actions.length > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", slot: "trigger", alignment: "center", appearance: "solid", text: i18n.moreOptions, textEnabled: false, icon: "ellipsis", onClick: (e) => {
                this.arcgisItemBrowserActionsOpen.emit({
                    el: e.target,
                    actions
                });
            } }))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserCard$1.style = arcgisItemBrowserCardCss;

const arcgisItemBrowserCardSublayerSelectCss = ".title{max-width:32rem;word-wrap:break-word;word-break:break-word}.dropdown-item-disabled{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}.dropdown{display:block}";

const ArcgisItemBrowserCard = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserCardSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
        this.renderSublayer = (sublayer) => {
            var _a, _b;
            const { item, store } = this;
            const disabled = !((_b = (_a = store === null || store === void 0 ? void 0 : store.state) === null || _a === void 0 ? void 0 : _a.allowedGeometries) === null || _b === void 0 ? void 0 : _b.includes(sublayer.geometryType));
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", Object.assign({ iconStart: getSearchSublayerIcon(sublayer.geometryType), selected: isSelected({
                    item,
                    sublayer,
                    selectedItems: store.state.selectedItems
                }) }, (disabled
                ? { ariaDisabled: true, tabIndex: -1, className: "dropdown-item-disabled" }
                : {}), { ref: (el) => {
                    if (disabled) {
                        el.tabIndex = -1;
                    }
                }, onCalciteDropdownItemSelect: (e) => {
                    const selected = e.currentTarget.selected;
                    const { item } = this;
                    this.arcgisItemBrowserCardSelect.emit({
                        item,
                        sublayer,
                        // single select should remain selected on click, multi select should toggle
                        selected: this.selection === "single" || !selected
                    });
                } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "title" }, sublayer.title)));
        };
        this.isAllowedGeometry = (geometry) => { var _a, _b, _c; return (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.allowedGeometries) === null || _c === void 0 ? void 0 : _c.includes(geometry); };
        this.sortSublayers = (a, b) => {
            const validA = this.isAllowedGeometry(a.geometryType);
            const validB = this.isAllowedGeometry(b.geometryType);
            if (validA === validB) {
                return b.id - a.id;
            }
            return validA ? -1 : 1;
        };
        this.renderSelectText = (selectedSublayers) => {
            var _a, _b;
            const multiple = this.selection === "multiple";
            if (this.item && !this.item.sublayers) {
                if (isSelected({ item: this.item, selectedItems: (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selectedItems })) {
                    return this.i18n.selectedSingle;
                }
                return this.i18n.select;
            }
            if ((selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) === 0) {
                return multiple ? this.i18n.selectLayers : this.i18n.select;
            }
            if (multiple) {
                return this.i18n.selectedLayers.replace("${num}", `${selectedSublayers.length}`);
            }
            const selected = selectedSublayers[0];
            // @ts-ignore
            return this.i18n.selectedName.replace("${name}", (_b = selected.sublayer) === null || _b === void 0 ? void 0 : _b.title);
        };
        this.item = undefined;
        this.user = undefined;
        this.portal = undefined;
        this.width = "auto";
        this.appearance = "outline";
        this.selection = undefined;
        this.showErrors = false;
        this.sublayers = undefined;
        this.loading = false;
        this.fetched = false;
        this.alertActive = false;
    }
    async componentWillLoad() {
        var _a, _b, _c;
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.i18n.cardSublayerSelect;
        this.sublayers = (_b = this.item) === null || _b === void 0 ? void 0 : _b.sublayers;
        if (!this.item) {
            return;
        }
        if ((_c = this.item) === null || _c === void 0 ? void 0 : _c.sublayers) {
            this.sublayers = this.item.sublayers;
        }
        else {
            const response = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.o)("serviceInfo", this.item.id);
            if (response === null || response === void 0 ? void 0 : response.result) {
                this.processResponse(response);
            }
        }
    }
    processResponse(response) {
        if (response === null || response === void 0 ? void 0 : response.result) {
            const layers = response.result.map(getSearchResultSublayer).sort(this.sortSublayers);
            this.sublayers = layers;
            this.item.sublayers = layers;
            this.fetched = true;
        }
        else if (response.error) {
            this.alertActive = true;
        }
    }
    async attemptLoad() {
        var _a;
        this.loading = true;
        this.alertActive = false;
        // for items without sublayers in the search index,
        // try fetching the service info
        const response = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.f)(() => (0,_services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_13__.f)({
            item: this.item,
            portal: this.portal,
            layers: null,
            isSecure: false
        }), "serviceInfo", this.item.id);
        // make real sublayers look like search sublayers
        this.processResponse(response);
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(100);
        if (this.dropdown) {
            this.dropdown.open = true;
        }
        this.loading = false;
        return !!((_a = this.sublayers) === null || _a === void 0 ? void 0 : _a.length);
    }
    render() {
        var _a, _b;
        const { store, width, appearance, loading, i18n, alertActive } = this;
        const item = this.item;
        if (!store || !item) {
            return null;
        }
        const scale = width === "auto" ? "s" : "m";
        const selectedItems = store === null || store === void 0 ? void 0 : store.state.selectedItems;
        const selectedSublayers = findSelectedSublayers({ item, selectedItems });
        const isItemSelected = isSelected({ item, selectedItems });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_a = item === null || item === void 0 ? void 0 : item.sublayers) === null || _a === void 0 ? void 0 : _a.length) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { class: "dropdown", widthScale: "l", placement: appearance === "solid" ? "top" : "bottom-end", scale: "s", closeOnSelectDisabled: true, overlayPositioning: "fixed", ref: (el) => (this.dropdown = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { loading: loading, disabled: loading, slot: "trigger", scale: scale, appearance: (selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) || appearance === "solid" ? "solid" : "outline", kind: "neutral", iconEnd: "chevron-down", width: width }, this.renderSelectText(selectedSublayers)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: this.selection }, (_b = this.sublayers) === null || _b === void 0 ? void 0 : _b.sort(this.sortSublayers).map(this.renderSublayer)))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { loading: loading, disabled: loading || alertActive, class: "dropdown", slot: "trigger", scale: scale, appearance: (selectedSublayers === null || selectedSublayers === void 0 ? void 0 : selectedSublayers.length) ? "solid" : "outline", kind: "neutral", width: width, onClick: async () => {
                if (this.item &&
                    !this.sublayers &&
                    this.item.type !== "Image Service" &&
                    !this.fetched) {
                    const foundLayers = await this.attemptLoad();
                    if (foundLayers || this.alertActive) {
                        return;
                    }
                }
                this.arcgisItemBrowserCardSelect.emit({
                    item,
                    selected: !isItemSelected
                });
            } }, this.renderSelectText(selectedSublayers))), this.showErrors && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-alert", { label: i18n.errorTitle, icon: true, kind: "danger", onCalciteAlertClose: () => {
                this.alertActive = false;
            }, open: !!alertActive, tabIndex: !alertActive ? -1 : null }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, i18n.errorTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message", class: "alert__message" }, i18n.errorBody), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", onClick: async () => {
                (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.c)("serviceInfo", this.item.id);
                await this.attemptLoad();
            } }, i18n.retry)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserCard.style = arcgisItemBrowserCardSublayerSelectCss;

const arcgisItemBrowserCardThumbnailCss = ":host{position:relative;display:block}.outer{position:relative;width:100%;padding-top:66.66%}.inner{position:absolute;inset:0px;background-color:var(--calcite-color-background)}.inner--loading{animation-duration:1s;animation-fill-mode:forwards;animation-iteration-count:infinite;animation-name:thumbnail-shimmer;animation-timing-function:linear;background-image:linear-gradient(to right, var(--calcite-color-background) 0%, var(--calcite-color-foreground-2), var(--calcite-color-background) 40%, var(--calcite-color-background) 100%);background-repeat:no-repeat;background-size:800px 100%}.thumbnail{height:100%;width:100%;-o-object-fit:cover;object-fit:cover;opacity:1;transition-property:opacity;transition:opacity 300ms linear}.thumbnail--loading{opacity:0}@keyframes thumbnail-shimmer{0%{background-position:-468px 0}100%{background-position:468px 0}}";

const ArcgisItemBrowserCardThumbnail = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.item = undefined;
        this.user = undefined;
        this.portal = undefined;
        this.loading = true;
        this.useDefault = undefined;
        this.thumbnailUrl = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.setThumbnailUrl();
    }
    handleItemChange() {
        this.setThumbnailUrl();
    }
    async setThumbnailUrl() {
        var _a, _b;
        const { item, portal } = this;
        if (this.useDefault) {
            this.thumbnailUrl = (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.f)(this.item);
            return;
        }
        this.thumbnailUrl = await (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.h)(portal, item, (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket);
    }
    render() {
        const { loading, useDefault, thumbnailUrl } = this;
        if (!thumbnailUrl) {
            return;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "outer" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { inner: true, "inner--loading": loading } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("img", { class: {
                thumbnail: true,
                "thumbnail--loading": loading
            }, alt: "", src: thumbnailUrl,
            // @ts-ignore
            crossorigin: "anonymous", onLoad: (e) => {
                const image = e.currentTarget;
                if (!useDefault && (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.j)(image)) {
                    this.useDefault = true;
                }
                this.loading = false;
            }, onError: () => {
                this.useDefault = true;
                this.loading = false;
                this.setThumbnailUrl();
            } }), loading && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "placeholder" })))));
    }
    static get assetsDirs() { return ["assets"]; }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "item": ["handleItemChange"]
    }; }
};
ArcgisItemBrowserCardThumbnail.style = arcgisItemBrowserCardThumbnailCss;

const arcgisItemBrowserContentCss = ":host{--arcgis-item-browser-content-spacing:0.5rem}.grid-container slot,.list slot{display:grid;grid-gap:var(--arcgis-item-browser-content-spacing)}.columns-1 slot{grid-template-columns:repeat(1, 1fr)}.columns-2 slot{grid-template-columns:repeat(2, 1fr)}.columns-3 slot{grid-template-columns:repeat(3, 1fr)}.columns-4 slot{grid-template-columns:repeat(4, 1fr)}.no-space slot{gap:0.25rem}";

const ArcgisItemBrowserContent = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.actionElement = undefined;
        this.actions = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    getColumnCount(width) {
        if (this.store.state.view !== "grid") {
            return 1;
        }
        const filter = this.store.state.filtersEmpty ? 1 : 0;
        switch (true) {
            case width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xs:
                return 1;
            case width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.sm:
                return 2;
            case width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.md:
                return 1 + filter;
            case width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xl:
                return 2 + filter;
            default:
                return 3 + filter;
        }
    }
    async updateActionsMenu(e) {
        var _a;
        const { actions, el } = e.detail;
        // close if already open
        if (el === this.actionElement && ((_a = this.popoverElement) === null || _a === void 0 ? void 0 : _a.open)) {
            this.popoverElement.open = false;
            this.focusAction();
            return;
        }
        this.actions = actions;
        this.actionElement = el;
        if (this.popoverElement) {
            this.popoverElement.open = true;
        }
    }
    async focusAction() {
        var _a, _b, _c, _d;
        (_b = (_a = this.actionElement) === null || _a === void 0 ? void 0 : _a.focus) === null || _b === void 0 ? void 0 : _b.call(_a);
        (_d = (_c = this.actionElement) === null || _c === void 0 ? void 0 : _c.setFocus) === null || _d === void 0 ? void 0 : _d.call(_c);
    }
    render() {
        var _a;
        const view = this.store.state.view;
        const columnCount = this.getColumnCount(this.store.state.width);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: {
                [view === "grid" ? "grid-container" : view]: true,
                [`columns-${columnCount}`]: true,
                "no-space": this.store.state.width < _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.b.xs && this.store.state.panel
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { referenceElement: this.actionElement, label: this.store.state.i18n.card.moreOptions, placement: "bottom-end", scale: "m", overlayPositioning: "fixed", pointerDisabled: true, autoClose: true, triggerDisabled: true, onCalcitePopoverClose: () => {
                this.focusAction();
            }, ref: async (el) => {
                this.popoverElement = el;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "none", onKeyDown: (e) => {
                e.stopPropagation();
            } }, (_a = this.actions) === null || _a === void 0 ? void 0 : _a.map(({ text, newTab, link, action }) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", Object.assign({ onClick: (e) => {
                if (action) {
                    e.preventDefault();
                    action();
                }
            }, key: text }, (!action && link
            ? Object.assign(Object.assign({}, (newTab ? { target: "_blank", rel: "noopener noreferrer" } : {})), { href: link }) : {})), text)))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserContent.style = arcgisItemBrowserContentCss;

const canEditCategorySchema = async ({ groupId, portal, user }) => {
    var _a;
    const isAnon = !user;
    const userPublic = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(user);
    const customRole = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.d)(user);
    const isAdmin = (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.b)(user);
    const isEditingGroupSchema = !!groupId;
    const group = isEditingGroupSchema ? await (0,_items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.f)(groupId, portal) : null;
    const groupOwnerName = group === null || group === void 0 ? void 0 : group.owner;
    const groupOwner = isEditingGroupSchema ? await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__.f)(groupOwnerName, portal) : null;
    const groupOwnedByMyOrg = !userPublic && user.orgId === (groupOwner === null || groupOwner === void 0 ? void 0 : groupOwner.orgId);
    const groupMembershipType = (_a = group === null || group === void 0 ? void 0 : group.userMembership) === null || _a === void 0 ? void 0 : _a.memberType;
    const canManageGroupCategories = !isAnon &&
        (groupMembershipType === "owner" ||
            groupMembershipType === "admin" ||
            (groupOwnedByMyOrg && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.e)(user)));
    const canManageItemCategories = !isAnon && !userPublic && (isAdmin || (customRole && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.f)(user)));
    return !group ? canManageItemCategories : canManageGroupCategories;
};

const arcgisItemBrowserFilterCategoriesCss = ".no-category-title{margin-bottom:0.25rem;margin-top:1rem;font-size:1rem}.no-category-description:not(:last-child){margin-bottom:1rem;margin-top:0px}";

const ArcgisItemBrowserFilterCategories = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.arcgisItemBrowserCategorySchemaUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCategorySchemaUpdate", 7);
        this.refetchCategories = async () => {
            if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
                await this.fetchCategories(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal, false);
            }
        };
        this.fetchCategories = async (portal, useCache = false) => {
            var _a, _b, _c, _d, _e, _f;
            const isLivingAtlas = ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "living atlas";
            const isGroup = ((_d = (_c = this.store) === null || _c === void 0 ? void 0 : _c.state) === null || _d === void 0 ? void 0 : _d.bucket) === "group";
            const groupId = this.groupId || this.store.state.groupId;
            if (this.isAllGroups()) {
                this.schema = null;
                this.arcgisItemBrowserCategorySchemaUpdate.emit(null);
                return;
            }
            const response = isLivingAtlas
                ? await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_15__.a)(portal, "LivingAtlas", useCache)
                : groupId && groupId !== "all" && isGroup
                    ? await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_15__.b)(groupId, portal, useCache)
                    : await (0,_categories_9f0f37ee_js__WEBPACK_IMPORTED_MODULE_15__.f)(portal, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user, useCache);
            const schema = (_f = (_e = response === null || response === void 0 ? void 0 : response.categorySchema) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.categories;
            this.setSchema(schema);
            this.loading = false;
        };
        this.setSchema = (schema) => {
            this.schema = schema;
            this.arcgisItemBrowserCategorySchemaUpdate.emit(schema);
        };
        this.renderSchemaEditor = () => {
            const { groupId, allowEdit, isEditing, handleEditSchemaComplete, setSchema } = this;
            const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
            if (!allowEdit) {
                return null;
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tunnel", { reference: this.el }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-category-schema-editor", { isActive: isEditing, group: groupId ? { id: groupId } : undefined, user: user, config: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config, portal: portal, onWorkflowCancel: async (event) => {
                    handleEditSchemaComplete(event.detail.hasChangeSinceLastOpen);
                }, onNewSchemaWorkflowComplete: async ({ detail }) => {
                    this.isEditing = false;
                    setSchema(detail.newSchema);
                }, onDeleteAllSchema: async () => {
                    handleEditSchemaComplete(true);
                } })));
        };
        this.handleEditSchemaComplete = async (doRefetchCategories) => {
            this.isEditing = false;
            if (doRefetchCategories) {
                await this.refetchCategories();
            }
            const { category, schema, clearFilter, checkSchemaFilterStillValid } = this;
            if (category && !checkSchemaFilterStillValid(schema, category, _categories_ca134005_js__WEBPACK_IMPORTED_MODULE_16__.U)) {
                clearFilter();
            }
        };
        this.checkSchemaFilterStillValid = (schema, category, parentPath) => {
            return schema.some((item) => {
                var _a;
                const categoryPath = (0,_categories_ca134005_js__WEBPACK_IMPORTED_MODULE_16__.a)(parentPath, item, false);
                if (categoryPath === category) {
                    return true;
                }
                if ((_a = item.categories) === null || _a === void 0 ? void 0 : _a.length) {
                    return this.checkSchemaFilterStillValid(item.categories, category, categoryPath);
                }
                return false;
            });
        };
        this.clearFilter = () => {
            this.category = null;
            this.emitFilterEvent();
        };
        this.category = undefined;
        this.expanded = undefined;
        this.groupId = undefined;
        this.allowEdit = undefined;
        this.loading = undefined;
        this.schema = [];
        this.isEditing = false;
        this.canEdit = false;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterCategories;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            await this.fetchCategories(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
            await this.checkAllowEdit();
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", (portal) => {
                this.fetchCategories(portal);
            });
        }
        // when a group is selected, trigger a fetch of categories
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.b)(this.store, () => {
            this.fetchCategories(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
        });
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("categories", this.store, () => (this.category = null));
        // when the bucket is changed, it will impact which categories we want to show, so fetch again
        (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.o)(this.store, () => {
            this.fetchCategories(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
        });
    }
    isAllGroups() {
        var _a, _b;
        const groupId = this.groupId || this.store.state.groupId;
        return ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "group" && (!groupId || groupId === "all");
    }
    async checkAllowEdit() {
        const { allowEdit, groupId } = this;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        if (!allowEdit) {
            this.canEdit = false;
            return;
        }
        this.canEdit = await canEditCategorySchema({ user, portal, groupId });
    }
    async componentDidLoad() {
        if (this.category) {
            this.emitFilterEvent();
        }
        this.store.onChange("bucket", () => this.refetchCategories());
        this.store.onChange("groupId", () => {
            this.refetchCategories();
            this.checkAllowEdit();
        });
    }
    emitFilterEvent() {
        const { category, i18n } = this;
        const value = category ? JSON.stringify([category]) : "";
        const categoryLabel = category === "_none_" ? i18n.uncategorized : category === null || category === void 0 ? void 0 : category.replace("/Categories/", "");
        const label = i18n.category.replace("${category}", categoryLabel);
        this.arcgisItemBrowserFilter.emit({
            id: "categories",
            param: "categories",
            value,
            label,
            category
        });
    }
    renderNestedCategories(schema, previousValue) {
        return schema.map((category) => {
            var _a;
            // Keep breadcrumbs of categories' ancestry
            const value = previousValue
                ? `${previousValue}/${category.title}`
                : `/Categories/${category.title}`;
            const hasChildren = !!((_a = category.categories) === null || _a === void 0 ? void 0 : _a.length);
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": value, "data-children": hasChildren, selected: this.category === value, key: `${value}--${hasChildren}` }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, category.title), hasChildren && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, this.renderNestedCategories(category.categories, value)))));
        });
    }
    render() {
        var _a, _b, _c;
        const { loading, schema, allowEdit, canEdit, i18n, renderSchemaEditor } = this;
        const hasSchema = (schema === null || schema === void 0 ? void 0 : schema.length) > 0;
        if (loading ||
            (!hasSchema && !allowEdit) ||
            this.isAllGroups() ||
            ((0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) && ((_a = this.store) === null || _a === void 0 ? void 0 : _a.state.bucket) !== "group")) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.categories, expanded: this.expanded, active: !!this.category, filterID: "categories", onArcgisBrowserFilterRemove: () => {
                this.category = null;
            } }, hasSchema ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
                const category = (dataset === null || dataset === void 0 ? void 0 : dataset.value) || "";
                if (this.category === category) {
                    this.category = null;
                }
                else {
                    this.category = category;
                }
                this.emitFilterEvent();
            } }, !!(this.groupId || this.store.state.groupId) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": "_none_", selected: this.category === "_none_" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, i18n.uncategorized))), this.renderNestedCategories(schema))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "no-category-title" }, i18n.noCategoriesTitle), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "no-category-description" }, i18n.noCategories), canEdit && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "add-category-button", appearance: "outline", color: "blue", onClick: () => (this.isEditing = true) }, i18n.setupCategories)))), hasSchema && allowEdit && canEdit && ((_c = (_b = this.store) === null || _b === void 0 ? void 0 : _b.state) === null || _c === void 0 ? void 0 : _c.bucket) !== "living atlas" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { iconStart: "pencil", appearance: "transparent", kind: "neutral", slot: "action", onClick: () => (this.isEditing = true) }))), renderSchemaEditor()));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterCategories.style = arcgisItemBrowserFilterCategoriesCss;

async function fetchCollaborations(portal) {
    const restBaseUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.s)(portal);
    const { collaborations } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${restBaseUrl}portals/self/collaborationsSummary`, {
        includeParticipantInfo: true
    });
    return collaborations;
}
// gets the collaborated items and returns just the unique item ids for that collaboration as an array
async function fetchCollaboratedItems(collaborationId, participantId, portal) {
    const restBaseUrl = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.s)(portal);
    const { collaboratedItems } = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${restBaseUrl}portals/self/collaboratedItems`, Object.assign({ collaborationId }, (participantId ? { participantId } : {})));
    if (collaboratedItems === null || collaboratedItems === void 0 ? void 0 : collaboratedItems.length) {
        return collaboratedItems.map((entry) => Object.keys(entry)[0]);
    }
    return [];
}
// Looks up items used in a collaboration, returns an array of item ids
async function fetchCollaborationContent(collaborationId, participantId, portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.f)(() => fetchCollaboratedItems(collaborationId, participantId, portal), "collaborationContent", `${collaborationId}/${participantId}`);
}

const ArcgisItemBrowserFilterCollaborations = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.loadCollaborations = async () => {
            const { portal, user, config, subscriptionInfo } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c !== null && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c !== void 0 ? _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c : {};
            if (!this.collaborations &&
                portal &&
                user &&
                !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(user) &&
                (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.g)(config, user, portal, subscriptionInfo)) {
                this.collaborations = await fetchCollaborations(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
            }
        };
        this.collaboration = undefined;
        this.participant = undefined;
        this.collaborationName = undefined;
        this.expanded = undefined;
        this.collaborations = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterCollaborations;
    }
    async componentDidLoad() {
        if (this.collaboration) {
            this.emitEvent();
        }
        this.loadCollaborations();
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", this.loadCollaborations);
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("user", this.loadCollaborations);
        (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("subscriptionInfo", this.loadCollaborations);
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("collaborations", this.store, () => (this.collaboration = null));
    }
    async getEventDetail() {
        const { collaboration, participant, collaborationName, i18n } = this;
        if (!collaboration) {
            return {
                id: "collaborations",
                param: "q",
                value: "",
                label: "",
                collaboration: {
                    id: "",
                    name: ""
                }
            };
        }
        const items = await fetchCollaborationContent(collaboration, participant, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
        const participantSuffix = participant ? `__${participant}` : "";
        return {
            id: "collaborations",
            param: "q",
            value: items ? `id:(${items.join(" OR ")})` : "",
            label: collaborationName ? i18n.label.replace("${name}", this.collaborationName) : "",
            collaboration: {
                id: collaboration,
                name: collaborationName
            },
            additionalParams: {
                origin: `${collaboration}${participantSuffix}`
            }
        };
    }
    async emitEvent() {
        const detail = await this.getEventDetail();
        this.arcgisItemBrowserFilter.emit(detail);
    }
    renderParticipant(participant, collaborationId) {
        var _a;
        const [id, name] = Object.entries(participant)[0];
        const participantId = `${collaborationId}/${id}`;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-id": participantId, "data-name": name, selected: (_a = this.collaboration) === null || _a === void 0 ? void 0 : _a.includes(participantId) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, name)));
    }
    render() {
        const { config, user, portal, subscriptionInfo } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const { collaborations } = this;
        if (!user ||
            !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.g)(config, user, portal, subscriptionInfo) ||
            !(collaborations === null || collaborations === void 0 ? void 0 : collaborations.length)) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.collaboration, filterID: "collaborations", onArcgisBrowserFilterRemove: () => {
                this.collaboration = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
                const [collaborationId, participantId] = (_b = item === null || item === void 0 ? void 0 : item.dataset.id.split("/")) !== null && _b !== void 0 ? _b : [];
                const collaborationName = item === null || item === void 0 ? void 0 : item.dataset.name;
                if (!collaborationName) {
                    return;
                }
                if (this.collaboration === collaborationId &&
                    (!participantId || participantId === this.participant)) {
                    this.collaboration = null;
                    this.collaborationName = null;
                    this.participant = null;
                }
                else {
                    this.collaboration = collaborationId;
                    this.collaborationName = collaborationName;
                    this.participant = participantId;
                }
                this.emitEvent();
            } }, collaborations.map(({ collaborationId, collaborationName, participants }) => {
            var _a;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-id": collaborationId, "data-name": collaborationName, selected: (_a = this.collaboration) === null || _a === void 0 ? void 0 : _a.includes(collaborationId) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, collaborationName), (participants === null || participants === void 0 ? void 0 : participants.length) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children" }, (participants || []).map((participant) => this.renderParticipant(participant, collaborationId))))));
        }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterContentStatus = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.contentStatus = undefined;
        this.expanded = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterContentStatus;
    }
    componentDidLoad() {
        if (this.contentStatus) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("contentStatus", this.store, () => (this.contentStatus = null));
    }
    getEventDetail() {
        var _a;
        const { contentStatus, i18n } = this;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const orgId = portal && !portal.isPortal ? ` orgid:${portal.id}` : "";
        const orgMember = user && !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(user);
        const orgAuthoritativeQuery = `((contentstatus:org_authoritative${orgId}) OR contentstatus:public_authoritative)`;
        const values = {
            authoritative: orgMember ? orgAuthoritativeQuery : "contentstatus:public_authoritative",
            deprecated: "contentstatus:deprecated"
        };
        return {
            id: "contentStatus",
            param: "filter",
            value: (_a = values[contentStatus]) !== null && _a !== void 0 ? _a : "",
            label: contentStatus ? i18n.label.replace("${contentStatus}", i18n[contentStatus]) : "",
            contentStatus
        };
    }
    render() {
        const statuses = ["authoritative", "deprecated"];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.contentStatus, filterID: "contentStatus", onArcgisBrowserFilterRemove: () => {
                this.contentStatus = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "m", onCalciteTreeSelect: (event) => {
                var _a;
                const node = event.target;
                const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
                const contentStatus = item === null || item === void 0 ? void 0 : item.dataset.contentStatus;
                if (this.contentStatus === contentStatus) {
                    this.contentStatus = null;
                }
                else {
                    this.contentStatus = contentStatus;
                }
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            } }, statuses.map((status) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-content-status": status, selected: status === this.contentStatus }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[status])))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterDate = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.property = "modified";
        this.range = undefined;
        this.start = undefined;
        this.end = undefined;
        this.expanded = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    getEventDetail(detail) {
        return Object.assign({ param: "q" }, detail);
    }
    render() {
        const { property, range, start, end, store, expanded } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter-date", { serverProperty: property === "modified" ? property : "uploaded", property: this.property, store: store, start: start, end: end, range: range, expanded: expanded, onArcgisBrowserFilter: (e) => {
                this.arcgisItemBrowserFilter.emit(this.getEventDetail(e.detail));
            } }));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisItemBrowserFilterExtentCss = ".filter-extent{margin-bottom:0.5rem;display:flex;width:100%}.filter-extent__label{flex:1 1 0%}.filter-extent__switch{padding-left:0.25rem;padding-right:0.25rem}.filter-extent--padded{box-sizing:border-box;padding-left:1rem;padding-right:1rem;padding-top:0px;padding-bottom:0.5rem}";

const ArcgisItemBrowserFilterExtent = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.extent = undefined;
        this.checked = undefined;
    }
    emitCheckedChange() {
        this.arcgisItemBrowserFilter.emit(this.getEventDetail());
    }
    emitExtentChange() {
        if (this.checked) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterExtent;
    }
    componentDidLoad() {
        if (this.extent && this.checked) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("extent", this.store, () => (this.checked = false));
    }
    getEventDetail() {
        const { extent, checked, i18n } = this;
        return {
            id: "extent",
            param: "bbox",
            value: checked && extent ? extent : "",
            label: extent && checked ? i18n.label : "",
            extent
        };
    }
    render() {
        var _a, _b;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "filter-extent": true, "filter-extent--padded": (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.panel } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "filter-extent__label" }, this.i18n.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { class: "filter-extent__switch", checked: this.checked, onCalciteSwitchChange: (e) => {
                this.checked = e.target.checked;
            } })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "checked": ["emitCheckedChange"],
        "extent": ["emitExtentChange"]
    }; }
};
ArcgisItemBrowserFilterExtent.style = arcgisItemBrowserFilterExtentCss;

const arcgisItemBrowserFilterFolderCss = ".hide.sc-arcgis-item-browser-filter-folder{display:none}.folders.sc-arcgis-item-browser-filter-folder{max-height:16.5rem;min-height:4rem;position:relative;z-index:0;overflow:auto;padding-top:2.5rem}.folder-action.sc-arcgis-item-browser-filter-folder{opacity:0;margin:2px}.folder.sc-arcgis-item-browser-filter-folder:hover .folder-action.sc-arcgis-item-browser-filter-folder,.folder.sc-arcgis-item-browser-filter-folder:focus-within .folder-action.sc-arcgis-item-browser-filter-folder{opacity:1}calcite-list-item.sc-arcgis-item-browser-filter-folder:not([selected]){--calcite-color-foreground-1:var(--calcite-color-background)}.recycle-bin.sc-arcgis-item-browser-filter-folder{position:sticky;bottom:0px}.tooltip.sc-arcgis-item-browser-filter-folder{margin:0px;padding:0px}.folder-edit.sc-arcgis-item-browser-filter-folder{position:relative;display:flex}.folder-edit__input.sc-arcgis-item-browser-filter-folder{position:relative;z-index:0;box-sizing:border-box;display:block;height:2.5rem;width:100%;border-style:none;padding-top:1rem;padding-bottom:1rem;padding-inline-end:0.5rem;padding-inline-start:3.5rem;font-size:0.75rem;color:var(--calcite-color-text-1);--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;transition-duration:150ms;outline-color:transparent;border:1px solid var(--calcite-color-border-1);margin-inline-end:-1px;background-color:transparent;font-family:inherit}.folder-edit__input.sc-arcgis-item-browser-filter-folder:focus{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.folder-edit__icon.sc-arcgis-item-browser-filter-folder{position:absolute;inset:0px;margin-left:1rem;margin-right:1rem;margin-top:0.75rem;margin-bottom:0.75rem}.header.sc-arcgis-item-browser-filter-folder{margin:0px;padding:0px;font-size:1.25rem;font-weight:400;color:var(--calcite-color-text-1)}.headline.sc-arcgis-item-browser-filter-folder{margin:0px;padding:0px;padding-bottom:0.5rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.description.sc-arcgis-item-browser-filter-folder{margin:0px;padding:0px;font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-2)}";

const ArcgisItemBrowserFilterFolder = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.hovered = false;
        this.folder = "all";
        this.showRecycle = undefined;
        this.allowEdits = undefined;
        this.expanded = undefined;
        this.folders = [];
        this.currentEdit = undefined;
        this.deleteFolderId = undefined;
        this.createOpen = undefined;
        this.createClosing = undefined;
        this.createTitle = "";
        this.deleteOpen = undefined;
        this.deleteClosing = undefined;
        this.processing = undefined;
        this.tooltip = undefined;
        this.tooltipReferenceElement = undefined;
        this.deleteItemsModalRef = undefined;
        this.deleteFolderContent = undefined;
    }
    async updateFolders() {
        this.fetchUserFolders(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterFolder;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) {
            this.fetchUserFolders(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("user", (user) => this.fetchUserFolders(user));
        }
    }
    componentDidLoad() {
        var _a, _b, _c;
        // if we're navigating back to the folder picker but we already had selected a folder, restore it
        if ((_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.filters) === null || _c === void 0 ? void 0 : _c.folder) {
            this.folder = this.store.state.filters.folder.folder;
        }
        if (this.folder && this.folder !== "all") {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        if (this.expanded && this.accordionItem) {
            this.accordionItem.expanded = true;
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("folder", this.store, () => (this.folder = "all"));
    }
    getEventDetail() {
        var _a;
        const { folder } = this;
        const folderName = folder === _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user.username ? "root" : folder;
        const selectedFolder = (_a = this.folders) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === folder);
        const folderTitle = (selectedFolder === null || selectedFolder === void 0 ? void 0 : selectedFolder.title) || "";
        const value = folder !== "all" ? `ownerfolder:${folderName}` : "";
        return {
            id: "folder",
            param: "q",
            value,
            label: this.i18n.label.replace("${folder}", folderTitle),
            folder,
            folderData: selectedFolder
        };
    }
    resetEdit() {
        this.inlineEdit = null;
        this.currentEdit = null;
    }
    // close the dialog, and then clear local state
    async resetCreate() {
        this.createClosing = true;
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(250);
        this.createOpen = false;
        this.createClosing = false;
        this.processing = false;
        this.createTitle = "";
    }
    async resetDelete() {
        this.deleteClosing = true;
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(250);
        this.deleteOpen = false;
        this.deleteClosing = false;
        this.processing = false;
        this.deleteFolderId = "";
    }
    async setTooltip(text, el, hover) {
        // fast movements over an element will give a mouse over event, but tooltip won't have time to register the mouse out
        // to avoid that, wait a bit on hover events prior to setting up the tooltip
        if (hover) {
            await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(40);
            if (!el.matches(`${el.tagName}:hover`)) {
                return;
            }
        }
        this.tooltip = text;
        this.tooltipReferenceElement = el;
        requestAnimationFrame(() => {
            if (this.tooltipElement && (!hover || el.matches(`${el.tagName}:hover`))) {
                this.tooltipElement.open = true;
                // as a failsafe, attach a mouse out event to the reference element as calcite tooltip doesn't always clean up correctly
                this.tooltipReferenceElement.addEventListener("mouseout", async () => {
                    await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(200);
                    if (this.tooltipReferenceElement === el) {
                        this.tooltipElement.open = false;
                    }
                });
                this.tooltipReferenceElement.addEventListener("keydown", (e) => {
                    if (e.key === "Escape") {
                        this.tooltipElement.open = false;
                    }
                });
            }
        });
    }
    async createFolder() {
        // TODO: handle missing or invalid title, possible errors
        if (this.createTitle) {
            this.processing = true;
            await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__.c)(this.createTitle, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
            this.resetCreate();
            // reset the list of folders
            this.fetchUserFolders(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
        }
    }
    updateFolder(folder) {
        // optimistically update the folder title in the dom
        this.folders = this.folders.map((existingFolder) => {
            if (existingFolder.id == folder.id) {
                existingFolder.title = this.currentEdit.title;
            }
            return existingFolder;
        });
        (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__.u)(folder.id, this.currentEdit.title, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
        this.resetEdit();
        // TODO: handle errors here
    }
    async fetchUserFolders(user) {
        const folders = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__.g)(user);
        this.folders = [
            { id: "all", created: new Date(), title: this.i18n.all, username: "" },
            ...folders
        ];
    }
    getFolderIcon(id) {
        var _a;
        switch (id) {
            case "all":
                return "folders";
            case (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _a === void 0 ? void 0 : _a.username:
                return "home";
            case "recycle":
                return "recycle-bin";
            default:
                return "folder";
        }
    }
    renderListItem(folder) {
        var _a;
        const { i18n } = this;
        const { title, id } = folder;
        const specialFolders = ["all", (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _a === void 0 ? void 0 : _a.username, "recycle"];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: { folder: true, "recycle-bin": id === "recycle" }, label: title, value: title, key: id, onCalciteListItemSelect: () => {
                this.resetEdit();
                this.folder = id;
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            }, selected: this.folder === id }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: this.getFolderIcon(id), slot: "content-start", scale: "s" }), !specialFolders.includes(id) && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { class: "folder-action", icon: "pencil", text: i18n.editFolder, slot: "actions-end", scale: "s", onClick: () => {
                this.resetEdit();
                this.currentEdit = Object.assign({}, folder);
            }, onMouseOver: (e) => {
                this.setTooltip(i18n.editFolder, e.target, true);
            }, onFocus: (e) => {
                this.setTooltip(i18n.editFolder, e.target);
            }, id: `${id}-edit-button` }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "trash", text: i18n.deleteFolder, slot: "actions-end", class: "folder-action", scale: "s", id: `${id}-delete-button`, onMouseEnter: (e) => {
                this.setTooltip(i18n.deleteFolder, e.target, true);
            }, onFocus: (e) => {
                this.setTooltip(i18n.deleteFolder, e.target);
            }, onClick: async () => {
                this.deleteFolderId = folder.id;
                this.deleteOpen = true;
            } })))));
    }
    renderEdit(folder) {
        const { i18n } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("form", { class: "folder-edit", onSubmit: (e) => {
                var _a;
                e.preventDefault();
                if ((_a = this.currentEdit) === null || _a === void 0 ? void 0 : _a.title) {
                    this.updateFolder(folder);
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { class: "folder-edit__input", value: folder.title, onInput: (e) => {
                this.currentEdit.title = e.target.value;
            }, ref: (el) => {
                if (!this.inlineEdit && this.currentEdit) {
                    this.inlineEdit = el;
                    requestAnimationFrame(() => {
                        el === null || el === void 0 ? void 0 : el.focus();
                    });
                }
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "folder", class: "folder-edit__icon", scale: "s" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { iconStart: "x", label: i18n.cancel, appearance: "outline", kind: "neutral", scale: "m", onClick: () => this.resetEdit(), onMouseEnter: (e) => {
                this.setTooltip(i18n.cancel, e.target, true);
            }, onFocus: (e) => {
                this.setTooltip(i18n.cancel, e.target);
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { iconStart: "check", label: i18n.save, appearance: "solid", kind: "brand", scale: "m", type: "submit", onMouseEnter: (e) => {
                this.setTooltip(i18n.save, e.target, true);
            }, onFocus: (e) => {
                this.setTooltip(i18n.save, e.target);
            } })));
    }
    renderCreate() {
        const { i18n, el } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tunnel", { reference: el, key: "create-modal" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { open: !this.createClosing, onCalciteModalClose: () => this.resetCreate(), outsideCloseDisabled: true, scale: "m", widthScale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h2", { slot: "header", class: "header" }, i18n.createAFolder), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, i18n.folderName, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { onCalciteInputInput: (e) => {
                this.createTitle = e.target.value;
            }, onKeyDown: (e) => {
                if (this.createTitle && e.key === "Enter") {
                    e.preventDefault();
                    this.createFolder();
                }
            } }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "secondary", appearance: "outline-fill", "data-id": "cancelButton", onClick: () => this.resetCreate(), width: "full" }, i18n.cancel), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "primary", appearance: "solid", kind: "brand", loading: this.processing, onClick: () => this.createFolder(), width: "full", disabled: !this.createTitle }, i18n.save))));
    }
    renderDelete() {
        var _a;
        const { el } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-tunnel", { reference: el, key: "delete-modal" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-delete-folder", { folder: (_a = this.folders) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === this.deleteFolderId), portal: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal, user: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user, active: !this.deleteClosing, onArcgisDeleteFolderClose: async () => {
                var _a;
                this.resetDelete();
                // reset the list of folders
                await this.fetchUserFolders(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
                // TODO: Force content update if active folder was deleted
                const selectedFolder = (_a = this.folders) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === this.folder);
                if (!selectedFolder) {
                    this.folder = "all";
                    this.arcgisItemBrowserFilter.emit(this.getEventDetail());
                }
            } })));
    }
    render() {
        var _a;
        const { user, portal } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const bucket = this.store.state.bucket;
        const { i18n, folders, deleteOpen, createOpen, tooltip, tooltipReferenceElement, showRecycle } = this;
        const hide = !user || !folders || (bucket && bucket !== "my");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.folders, expanded: this.expanded, noPadding: true, class: { hide }, onMouseOver: () => {
                this.hovered = true;
            }, onMouseOut: () => {
                this.hovered = false;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { filterEnabled: true, selectionAppearance: "border", selectionMode: "single-persist", loading: !folders, class: "folders", ref: (el) => {
                var _a;
                const filter = (_a = el === null || el === void 0 ? void 0 : el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-filter");
                if (filter) {
                    filter.style.setProperty("--calcite-color-foreground-1", "var(--calcite-color-background)");
                    // for some reason, inside shadow dom _and_ a popover, in safari the sticky positioning used by calcite stops working.
                    filter.style.position = "absolute";
                    filter.style.top = "-48px";
                }
            } }, folders.map((folder) => {
            var _a;
            return this.currentEdit && ((_a = this.currentEdit) === null || _a === void 0 ? void 0 : _a.id) === (folder === null || folder === void 0 ? void 0 : folder.id)
                ? this.renderEdit(folder)
                : this.renderListItem(folder);
        }), showRecycle && !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(user) && !(portal === null || portal === void 0 ? void 0 : portal.isPortal) &&
            this.renderListItem({
                created: "now",
                id: "recycle",
                title: i18n.recycleBin,
                username: (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) === null || _a === void 0 ? void 0 : _a.username
            })), this.allowEdits && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: "create-folder-button", iconStart: "folder-plus", appearance: "transparent", kind: "neutral", slot: "action", onClick: () => {
                this.createOpen = true;
            }, onMouseEnter: async (e) => {
                this.setTooltip(i18n.createFolder, e.target, true);
            }, onFocus: (e) => {
                this.setTooltip(i18n.createFolder, e.target);
            } }))), createOpen && this.renderCreate(), deleteOpen && this.renderDelete(), !!tooltip && tooltipReferenceElement && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { referenceElement: this.tooltipReferenceElement, ref: (el) => {
                if (!this.tooltipElement) {
                    this.tooltipElement = el;
                    el.open = true;
                }
            } }, tooltip))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterFolder.style = arcgisItemBrowserFilterFolderCss;

const arcgisItemBrowserFilterGroupCss = ".hide.sc-arcgis-item-browser-filter-group{display:none}.groups.sc-arcgis-item-browser-filter-group{max-height:16.5rem;min-height:4rem;position:relative;z-index:0;overflow:auto;padding-top:2.5rem}calcite-list-item.sc-arcgis-item-browser-filter-group:not([selected]){--calcite-color-foreground-1:var(--calcite-color-background)}.group-thumbnail.sc-arcgis-item-browser-filter-group{margin-left:0.5rem;margin-right:0.5rem}";

const ArcgisItemBrowserFilterGroup = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.group = "all";
        this.allowEdits = undefined;
        this.expanded = undefined;
        this.groups = [];
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterGroup;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            this.fetchUserGroups();
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("user", () => this.fetchUserGroups());
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => this.fetchUserGroups());
        }
    }
    componentDidLoad() {
        if (this.expanded && this.accordionItem) {
            this.accordionItem.expanded = true;
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("group", this.store, () => (this.group = "all"));
    }
    getEventDetail() {
        var _a, _b;
        const { group } = this;
        const selectedGroup = (_a = this.groups) === null || _a === void 0 ? void 0 : _a.find((f) => f.id === group);
        const groupTitle = (selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.title) || "";
        const value = group !== "all"
            ? `group:${group}`
            : `group:(${(_b = this.groups) === null || _b === void 0 ? void 0 : _b.map(({ id }) => id).join(" OR ")})`;
        return {
            id: "group",
            param: "q",
            value,
            label: this.i18n.label.replace("${group}", groupTitle),
            group
        };
    }
    async fetchUserGroups() {
        var _a, _b;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user && _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            const groups = await (0,_user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_19__.d)();
            this.groups = [{ id: "all", title: this.i18n.all }, ...groups];
            if (((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "group") {
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            }
        }
    }
    render() {
        const { user } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c;
        const bucket = this.store.state.bucket;
        const { i18n, groups } = this;
        const hide = !user || !groups || (bucket && bucket !== "group");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.groups, expanded: this.expanded, noPadding: true, class: { hide } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { filterEnabled: true, selectionAppearance: "border", selectionMode: "single", loading: !groups, class: "groups", ref: (el) => {
                var _a;
                const filter = (_a = el === null || el === void 0 ? void 0 : el.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("calcite-filter");
                if (filter) {
                    filter.style.setProperty("--calcite-color-foreground-1", "var(--calcite-color-background)");
                    // for some reason, inside shadow dom _and_ a popover, in safari the sticky positioning used by calcite stops working.
                    filter.style.position = "absolute";
                    filter.style.top = "-48px";
                }
            } }, groups === null || groups === void 0 ? void 0 : groups.map((group) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "group", label: group.title, value: group.id, key: group.id, onCalciteListItemSelect: () => {
                this.group = group.id;
                this.store.state.groupId = group.id;
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            }, selected: this.group === group.id }, group.id === "all" ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "users", slot: "content-start", scale: "s" })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-group-thumbnail", { slot: "content-start", class: "group-thumbnail", group: group, portal: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal, tooltip: false, scale: "s" })))))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterGroup.style = arcgisItemBrowserFilterGroupCss;

const templateIndustries = [
    "Agriculture",
    "Electric Utilities",
    "Environment",
    "Forestry",
    "Gas Utilities",
    "General",
    "Natural Resources",
    "Petroleum",
    "Public Safety",
    "Telecommunications",
    "Transportation",
    "Water Utilities"
];

const ArcgisItemBrowserFilterIndustry = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.industry = undefined;
        this.expanded = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterIndustry;
    }
    async componentDidLoad() {
        if (this.industry) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("industry", this.store, () => (this.industry = null));
    }
    getEventDetail() {
        const { industry } = this;
        const value = industry ? `typekeywords: "${industry}"` : "";
        const label = this.i18n.Industry.replace("${industry}", this.i18n[industry]);
        return { id: "industry", param: "filter", value, label, industry };
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.industry, filterID: "industry", onArcgisBrowserFilterRemove: () => {
                this.industry = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "single", scale: "s", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const industry = ((_b = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset.industry) || "";
                if (this.industry === industry) {
                    this.industry = null;
                }
                else {
                    this.industry = industry;
                }
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            } }, templateIndustries.map((industry) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-industry": industry, selected: industry === this.industry }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[industry])))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterItemType = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.renderItemType = ([key, option]) => {
            const { itemType, allowedItemTypes } = this;
            const disallowedType = !(allowedItemTypes === null || allowedItemTypes === void 0 ? void 0 : allowedItemTypes.includes(key));
            const childrenAllowed = allowedItemTypes &&
                disallowedType &&
                option.children &&
                Object.keys(option.children).some((child) => allowedItemTypes.includes(child));
            if ((disallowedType && !childrenAllowed) ||
                (option.show && !option.show(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.userLicensedItems))) {
                return null;
            }
            if (disallowedType && childrenAllowed) {
                return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, Object.entries(option.children).map(this.renderItemType));
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-item-type": key, "data-children": !!option.children, selected: key === itemType }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.a[key]), option.children && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, Object.entries(option.children).map(this.renderItemType)))));
        };
        this.itemType = undefined;
        this.allowedItemTypes = _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.d;
        this.expanded = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterItemType;
    }
    componentDidLoad() {
        var _a;
        if (this.itemType) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            let activeItem = (_a = this.el) === null || _a === void 0 ? void 0 : _a.querySelector(`calcite-tree-item[data-item-type="${this.itemType}"]`);
            // expand parents on load if initial value was provided
            while (activeItem) {
                activeItem.expanded = true;
                activeItem = activeItem.parentElement.closest("calcite-tree-item");
                if (!(activeItem === null || activeItem === void 0 ? void 0 : activeItem.closest("arcgis-item-browser-filter-item-type"))) {
                    activeItem = null;
                }
            }
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("itemType", this.store, () => (this.itemType = null));
    }
    getEventDetail() {
        const { itemType } = this;
        const option = (0,_items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.g)(itemType);
        const value = (option === null || option === void 0 ? void 0 : option.q) ? `(${option.q})` : "";
        const label = option ? this.i18n.itemType.replace("${itemType}", _items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.a[itemType]) : "";
        return { id: "itemType", param: "q", value, label, itemType };
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.itemType, filterID: "itemType", onArcgisBrowserFilterRemove: () => {
                this.itemType = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
                const itemType = (dataset === null || dataset === void 0 ? void 0 : dataset.itemType) || "";
                if (this.itemType === itemType) {
                    this.itemType = null;
                }
                else {
                    this.itemType = itemType;
                }
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            } }, Object.entries(_items_a4f5e98b_js__WEBPACK_IMPORTED_MODULE_18__.i).map(this.renderItemType))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

function geocoderSupportsSuggestions(geocoder) {
    return !!((geocoder.singleLineFieldName || (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_21__.i)(geocoder.url) || geocoder.enableSuggestions) &&
        geocoder.placefinding);
}
function getSearchGeocodingServices(portal, config, i18n) {
    var _a;
    const helperServices = portal.helperServices || {};
    let geocoders = [...(helperServices.geocode || [])];
    const geocodeAutoComplete = (_a = config.geocodeAutoComplete) !== null && _a !== void 0 ? _a : false;
    return geocoders
        .filter(geocoderSupportsSuggestions)
        .map((geocoder) => {
        // determine if we need to enable suggestions
        const enableSuggestions = geocoder.suggest === true && geocodeAutoComplete ? true : false;
        const isEsri = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_21__.i)(geocoder.url);
        return Object.assign(Object.assign({}, geocoder), { name: isEsri ? "ArcGIS World Geocoding Service" : geocoder.name, enableSuggestions, categories: isEsri ? ["Populated Place", "Coordinate System"] : null, placefinding: isEsri ? true : geocoder.placefinding, outFields: isEsri ? ["Match_addr", "Addr_type", "StAddr", "City"] : null, placeholder: geocoder.placeholder || i18n.findLocationText, singleLineFieldName: geocoder.singleLineFieldName || "SingleLine", highlightSymbol: null, localSearchOptions: {
                minScale: 300000,
                distance: 50000
            } });
    });
}
function createExtentSearchOptions(portal, config, i18n, value) {
    var _a;
    const suggestionsEnabled = (_a = config === null || config === void 0 ? void 0 : config.geocodeAutoComplete) !== null && _a !== void 0 ? _a : false;
    const searchLayers = []; // type === "extent"
    const geocoders = getSearchGeocodingServices(portal, config, i18n);
    const options = {
        suggestionsEnabled,
        minSuggestCharacters: 3,
        maxResults: 5,
        searchTerm: value || null,
        activeSourceIndex: "all",
        sources: searchLayers.concat(geocoders),
        popupEnabled: false,
        portal
    };
    // remove activeSourceIndex if there is only a single geocoder
    if (options.sources.length === 1) {
        delete options.activeSourceIndex;
    }
    return options;
}

const arcgisItemBrowserFilterLocationCss = ".location-filter__container{box-sizing:border-box;display:flex;width:100%}.location-filter__input{flex:1 1 0%;--calcite-color-border-input:var(--calcite-color-border-3)}.location-filter__button{margin-inline-start:-1px}.location-filter__suggestions{box-sizing:border-box;height:8rem;overflow-y:auto;border-top:1px solid var(--calcite-color-border-1);border-bottom:1px solid var(--calcite-color-border-1);width:calc(var(--item-browser-pane-width) - 2.5rem)}.location-filter__no-results{margin-top:3rem;margin-bottom:0px;padding-top:0.5rem;padding-bottom:0px;text-align:center;color:var(--calcite-color-text-3)}";

const ArcgisItemBrowserFilterLocation = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.arcgisItemBrowserSort = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
        this.suggest = (term) => {
            this.loadingSuggestions = true;
            if ((term === null || term === void 0 ? void 0 : term.length) > 2) {
                this.searchViewModel.suggest(term);
            }
            else {
                this.loadingSuggestions = false;
                this.suggestions = [];
            }
        };
        this.debouncedSuggest = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.d)(this.suggest.bind(this), 1000);
        this.updateSuggest = (term) => {
            if ((term === null || term === void 0 ? void 0 : term.length) > 2) {
                this.loadingSuggestions = true;
            }
            this.debouncedSuggest(term);
        };
        this.location = undefined;
        this.extent = undefined;
        this.expanded = undefined;
        this.loading = undefined;
        this.searching = undefined;
        this.suggestions = [];
        this.loadingSuggestions = undefined;
        this.searchTerm = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterLocation;
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("location", this.store, () => {
            var _a;
            this.location = null;
            this.extent = null;
            (_a = this.searchViewModel) === null || _a === void 0 ? void 0 : _a.clear();
            this.searchTerm = "";
        });
    }
    async componentDidLoad() {
        if (this.location && this.extent) {
            this.searchTerm = this.location;
            this.emitFilterEvent();
        }
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            this.setupSearch();
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", () => {
                this.setupSearch();
            });
        }
    }
    async setupSearch() {
        const options = createExtentSearchOptions(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal, _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config, this.i18n, this.location);
        const [SearchViewModel] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_20__.l)(["esri/widgets/Search/SearchViewModel"]);
        this.searchViewModel = new SearchViewModel(Object.assign(Object.assign({}, options), { allPlaceholder: this.i18n.findLocationText, showInfoWindowOnSelect: false }));
        this.searchViewModel.on("suggest-start", () => {
            this.loadingSuggestions = true;
        });
        this.searchViewModel.on("suggest-complete", async (e) => {
            this.suggestions = [...e.results];
            this.loadingSuggestions = false;
        });
        this.searchViewModel.on("search-start", () => {
            this.loadingSuggestions = false;
            this.searching = true;
            this.suggestPopover.open = false;
        });
        this.searchViewModel.on("search-complete", () => {
            this.searching = false;
        });
        this.searchViewModel.on("select-result", this.handleLocationChange.bind(this));
        this.searchViewModel.on("search-clear", () => {
            if (this.extent && this.location) {
                this.location = null;
                this.extent = null;
                this.emitFilterEvent();
            }
        });
    }
    handleLocationChange(event) {
        this.location = event.result.name;
        const ext = event.result.extent;
        this.extent = `${ext.xmin},${ext.ymin},${ext.xmax},${ext.ymax}`;
        this.emitFilterEvent();
    }
    emitFilterEvent() {
        const { location, extent } = this;
        const label = this.i18n.label.replace("${location}", location);
        this.arcgisItemBrowserFilter.emit({
            id: "location",
            param: "bbox",
            value: extent !== null && extent !== void 0 ? extent : "",
            label,
            location,
            extent
        });
        // when filtering by location, only relevance sort order is allowed
        if (extent) {
            this.arcgisItemBrowserSort.emit({ sortField: "relevance", sortOrder: "desc" });
        }
    }
    handleSuggestSelect(suggestion) {
        var _a;
        this.searchViewModel.search(suggestion);
        this.searchTerm = suggestion.text;
        (_a = this.input) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    hasResults() {
        var _a;
        return (_a = this.suggestions) === null || _a === void 0 ? void 0 : _a.some((service) => { var _a; return (_a = service === null || service === void 0 ? void 0 : service.results) === null || _a === void 0 ? void 0 : _a.length; });
    }
    renderSuggestions(service) {
        var _a;
        return (_a = service === null || service === void 0 ? void 0 : service.results) === null || _a === void 0 ? void 0 : _a.map((suggestion) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "location-filter__suggestion", key: suggestion.key, label: suggestion.text, onClick: () => this.handleSuggestSelect(suggestion), onKeyPress: (e) => {
                if (e.key === "Enter") {
                    this.handleSuggestSelect(suggestion);
                }
            } })));
    }
    render() {
        var _a, _b;
        if ((_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api) === 3) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.location, expanded: this.expanded, active: !!this.location, filterID: "location", onArcgisBrowserFilterRemove: () => {
                this.location = null;
                this.extent = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "location-filter__container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { loading: this.searching || this.loadingSuggestions, type: "text", value: this.searchTerm, placeholder: this.i18n.findLocationText, scale: "m", class: "location-filter__input", ref: (el) => (this.input = el), clearable: true, onKeyPress: (e) => {
                const value = e.target.value;
                if (e.key === "Enter" && e.target === e.currentTarget) {
                    this.searchTerm = value;
                    this.searchViewModel.suggest(value);
                    return;
                }
            }, onKeyDown: (e) => {
                var _a, _b;
                if (e.key === "ArrowDown" && !this.loadingSuggestions && ((_a = this.suggestions) === null || _a === void 0 ? void 0 : _a.length)) {
                    e.preventDefault();
                    e.stopPropagation();
                    (_b = this.el.querySelector("calcite-list-item")) === null || _b === void 0 ? void 0 : _b.setFocus();
                }
            }, onCalciteInputInput: (e) => {
                const value = e.target.value;
                this.searchTerm = value;
                this.updateSuggest(value);
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "location-filter__button", label: "search", slot: "action", kind: "neutral", appearance: "outline-fill", iconStart: "search", scale: "m", ref: (el) => (this.searchButton = el), onClick: () => {
                this.suggest(this.searchTerm);
            }, onKeyPress: (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    this.suggest(this.searchTerm);
                }
            }, disabled: !this.searchTerm })), !this.loadingSuggestions && ((_a = this.searchTerm) === null || _a === void 0 ? void 0 : _a.length) > 2 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.i18n.suggestions, referenceElement: this.searchButton, ref: (el) => (this.suggestPopover = el), autoClose: true, pointerDisabled: true, offsetDistance: 0, overlayPositioning: "fixed", open: true, placement: "bottom-end", flipPlacements: ["top-end"] }, this.hasResults() ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { key: this.searchTerm, class: "location-filter__suggestions" }, (_b = this.suggestions) === null || _b === void 0 ? void 0 : _b.map((service) => this.renderSuggestions(service)))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "location-filter__suggestions" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "location-filter__no-results" }, this.i18n.noResults.replace("${searchTerm}", this.searchTerm)))))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserFilterLocation.style = arcgisItemBrowserFilterLocationCss;

async function fetchRegions(portal) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.g)(portal)}portals/regions`);
}

const ArcgisItemBrowserFilterRegion = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.regions = [];
        this.region = undefined;
        this.expanded = undefined;
        this.loading = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterRegion;
        if (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal) {
            this.fetchRegions(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal);
        }
        else {
            (0,_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.o)("portal", (portal) => this.fetchRegions(portal));
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("region", this.store, () => (this.region = null));
    }
    async fetchRegions(portal) {
        this.regions = await fetchRegions(portal);
        this.loading = false;
    }
    async componentDidLoad() {
        if (this.region) {
            this.emitFilterEvent();
        }
    }
    emitFilterEvent() {
        var _a;
        const { region, i18n } = this;
        const categoryValue = region ? `/region/${region.toLowerCase()}` : "";
        const value = region ? JSON.stringify([categoryValue]) : "";
        const activeRegion = (_a = this.regions) === null || _a === void 0 ? void 0 : _a.find((r) => r.region === region);
        const label = i18n.region.replace("${region}", (activeRegion === null || activeRegion === void 0 ? void 0 : activeRegion.localizedName) || (activeRegion === null || activeRegion === void 0 ? void 0 : activeRegion.name) || "");
        this.arcgisItemBrowserFilter.emit({
            id: "region",
            param: "categories",
            categoryValue,
            value,
            label,
            region
        });
    }
    render() {
        var _a;
        const { loading, regions, store } = this;
        if (loading || !(regions === null || regions === void 0 ? void 0 : regions.length) || ((_a = store.state) === null || _a === void 0 ? void 0 : _a.bucket) !== "living atlas") {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.regions, expanded: this.expanded, active: !!this.region, filterID: "region", onArcgisBrowserFilterRemove: () => {
                this.region = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
                var _a, _b;
                const node = event.target;
                const dataset = (_b = (_a = node === null || node === void 0 ? void 0 : node.selectedItems) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.dataset;
                const region = (dataset === null || dataset === void 0 ? void 0 : dataset.value) || "";
                if (this.region === region) {
                    this.region = null;
                }
                else {
                    this.region = region;
                }
                this.emitFilterEvent();
            } }, regions.map(({ name, region, localizedName }) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-value": region, selected: this.region === region }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, localizedName || name)))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterSharing = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.filterLevel = (sharingLevel) => {
            if (sharingLevel === "org") {
                return !(0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_9__.a)(_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user);
            }
            return true;
        };
        this.sharingLevels = [["owner", ["private", "shared"]], "org", "public"];
        this.renderLevel = (sharingLevel) => {
            const [level, children] = Array.isArray(sharingLevel) ? sharingLevel : [sharingLevel];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree-item", { "data-sharing": level, selected: (children === null || children === void 0 ? void 0 : children.includes(this.sharing)) || level === this.sharing }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", null, this.i18n[level]), children && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { slot: "children", selectionMode: "children" }, children.map(this.renderLevel)))));
        };
        this.sharing = undefined;
        this.expanded = undefined;
    }
    componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterSharing;
    }
    componentDidLoad() {
        if (this.sharing) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("sharing", this.store, () => (this.sharing = null));
    }
    getEventDetail() {
        const { sharing, i18n } = this;
        const value = sharing === "owner" ? `(access:private OR access:shared)` : `(access: ${sharing})`;
        return {
            id: "sharing",
            param: "q",
            value: sharing ? value : "",
            label: sharing ? i18n.label.replace("${sharing}", i18n[sharing]) : "",
            sharing
        };
    }
    render() {
        var _a, _b;
        if (((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "all" || !_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: this.i18n.title, expanded: this.expanded, active: !!this.sharing, filterID: "sharing", onArcgisBrowserFilterRemove: () => {
                this.sharing = null;
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tree", { selectionMode: "children", scale: "m", onCalciteTreeSelect: (event) => {
                var _a;
                const node = event.target;
                const item = (_a = node.selectedItems) === null || _a === void 0 ? void 0 : _a[0];
                const sharing = item === null || item === void 0 ? void 0 : item.dataset.sharing;
                if (this.sharing === sharing) {
                    this.sharing = null;
                }
                else {
                    this.sharing = sharing;
                }
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            } }, this.sharingLevels.filter(this.filterLevel).map((level) => this.renderLevel(level)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilterTags = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserFilter = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserFilter", 7);
        this.deselectAllTags = () => {
            this.el
                .querySelectorAll("calcite-combobox-item[selected]")
                .forEach((item) => {
                item.selected = false;
            });
        };
        this.tags = undefined;
        this.expanded = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.filterTags;
    }
    async componentDidLoad() {
        if (this.tags) {
            this.arcgisItemBrowserFilter.emit(this.getEventDetail());
        }
        (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_17__.a)("tags", this.store, () => {
            this.tags = null;
            this.deselectAllTags();
        });
    }
    getEventDetail() {
        const { tags } = this;
        const value = (tags === null || tags === void 0 ? void 0 : tags.length) ? `tags:(${tags.map((tag) => `"${tag}"`).join(" OR ")})` : "";
        const label = (tags === null || tags === void 0 ? void 0 : tags.length) ? this.i18n.label.replace("${tags}", tags.join(", ")) : "";
        return { id: "tags", param: "filter", value, tags, label };
    }
    componentDidRender() {
        const items = this.el.querySelectorAll("calcite-combobox-item");
        const values = [];
        items.forEach((item) => {
            // remove duplicate items which were added by calcite combobox
            if (values.includes(item.value)) {
                item.parentElement.removeChild(item);
            }
            else {
                values.push(item.value);
            }
        });
    }
    render() {
        var _a;
        const { i18n } = this;
        const knownTags = this.store.state.knownTags || [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filter", { heading: i18n.title, expanded: this.expanded, active: !!((_a = this.tags) === null || _a === void 0 ? void 0 : _a.length), onArcgisBrowserFilterRemove: () => {
                this.tags = [];
                this.deselectAllTags();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox", { label: i18n.title, overlayPositioning: "fixed", placeholder: i18n.selectTags, scale: "s", maxItems: 5, allowCustomValues: true, clearDisabled: true, onCalciteComboboxChange: (e) => {
                var _a;
                this.tags = (_a = e.target.selectedItems) === null || _a === void 0 ? void 0 : _a.map((item) => item.value);
                this.arcgisItemBrowserFilter.emit(this.getEventDetail());
            }, style: { marginBottom: "1rem" }, ref: (el) => {
                var _a;
                const div = el.shadowRoot.querySelector("div");
                if (div && ((_a = this.store.state) === null || _a === void 0 ? void 0 : _a.panel)) {
                    div.insertAdjacentHTML("beforeend", `<style>
              .floating-ui-container--active {
                visibility: visible !important;
                pointer-events: auto !important;
                position: absolute !important;
              }
              </style>`);
                }
            } }, knownTags.map((tag) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-combobox-item", { key: tag, value: tag, textLabel: tag.length > 36 ? `${tag.slice(0, 36)}...` : tag }))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserFilters = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    render() {
        var _a, _b;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-filters", { store: this.store, style: ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "subscription content" ? { display: "none" } : {} }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "top" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "top" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bottom" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bottom" }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserPagination = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPage", 7);
        this.total = undefined;
        this.start = undefined;
        this.num = 60;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        const { start, total, num } = this;
        this.arcgisItemBrowserPage.emit({ start, total, num });
    }
    render() {
        const { start, total, num, store } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-pagination", { start: start, total: total, num: num, store: store, onArcgisBrowserPage: (e) => this.arcgisItemBrowserPage.emit(e.detail) }));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisItemBrowserPreviewCss = ":host{display:flex;height:100%;width:100%;flex:1 1 0%;flex-direction:column;background-color:var(--calcite-color-background)}.preview__header{margin-inline-start:0.75rem}.preview__title{margin:0px;overflow-wrap:break-word;padding:0px;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);line-height:1.375}.title{margin-top:0.75rem;margin-bottom:0.75rem;padding:0px;font-size:1.125rem;font-weight:500;color:var(--calcite-color-text-1);word-wrap:break-word;word-break:break-word}.badges{margin-bottom:1rem;display:block}.badges[empty]{display:none}calcite-accordion-item{--calcite-accordion-item-padding:1rem 1rem;--calcite-accordion-item-background:var(--calcite-color-foreground-1);width:100%;box-sizing:border-box;border-bottom:1px solid var(--calcite-color-border-2)}.section{background-color:var(--calcite-color-background);padding-left:1rem;padding-right:1rem;padding-top:1rem;padding-bottom:1rem;margin:0rem -1rem calc(-1rem - 1px) -1rem;line-height:1.35}.section--tight{padding-top:0px;padding-bottom:0px;padding-left:0px;padding-right:0px}.details-title{margin-top:1rem;margin-bottom:0px;padding-bottom:0.25rem;padding-top:0px;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-3);--calcite-label-margin-bottom:0}.details-title:first-of-type{margin-top:0px}.details-title--label{padding-bottom:0px}.details-text{margin:0px;overflow-wrap:break-word;padding:0px;font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-1)}.details-text a{color:var(--calcite-color-text-link)}.details--text-empty{font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-3)}.description{width:100%;overflow:auto;overflow-wrap:break-word;padding-bottom:0.25rem;line-height:1.35}.description *{max-width:100%;font-size:0.875rem !important}.description{--item-browser-table-border:1px solid var(--calcite-color-border-2)}.description table{width:100%;border-collapse:collapse;--tw-border-spacing-x:0px;--tw-border-spacing-y:0px;border-spacing:var(--tw-border-spacing-x) var(--tw-border-spacing-y);overflow:auto;background-color:var(--calcite-color-foreground-1);text-align:start;font-size:0.75rem;border:var(--item-browser-table-border)}.description table>thead{background-color:var(--calcite-color-foreground-1);font-weight:400;border-bottom:var(--item-browser-table-border)}.description table>tbody{width:100%;overflow:auto}.description table>tfoot{border-top:var(--item-browser-table-border)}.description table th,.description table td{padding:0.5rem;text-align:start;font-weight:300;border-left:var(--item-browser-table-border);border-right:var(--item-browser-table-border)}.description table tr{text-align:start;border-bottom:var(--item-browser-table-border)}.description table tr:last-child{border-bottom:none}.favorite{display:block;padding-top:1.5rem}.copy-input{--calcite-color-background:var(--calcite-color-foreground-1)}.sublayer-item{--tw-shadow:none}.sublayer__tabs{flex:1 1 auto;background-color:var(--calcite-color-background)}.sublayer__tabs--white{background-color:var(--calcite-color-foreground-1)}.sublayer-item__content{max-width:10.875rem;display:flex;min-width:0px;flex-direction:column}.sublayer-item__title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-top:0.5rem;padding-bottom:0.5rem;font-size:0.875rem;color:var(--calcite-color-text-2);text-decoration-line:underline}.sublayer-item__title--matched{padding-top:0px;padding-bottom:0px}.sublayer-item__description{font-size:0.75rem;color:var(--calcite-color-text-3)}.sublayer__header{display:flex;background-color:var(--calcite-color-foreground-1);padding-left:1rem;padding-right:1rem;padding-top:1rem;padding-bottom:0.5rem;font-weight:500;color:var(--calcite-color-text-1)}.sublayer__header__title{min-width:0px;overflow-wrap:break-word}.sublayer__tab-nav{background-color:var(--calcite-color-foreground-1);padding-left:1rem;padding-right:1rem}.sublayer__content{height:100%;background-color:var(--calcite-color-foreground-1);margin-top:-0.5rem}.sublayer__content--overview{box-sizing:border-box;background-color:var(--calcite-color-background);padding-top:2rem;padding-bottom:2rem;padding-left:1.25rem;padding-right:1.25rem}.footer-actions{display:grid;width:100%;grid-template-columns:repeat(1, minmax(0, 1fr));gap:0.5rem}.error-container{display:flex;height:100%;padding:1rem}";

const ArcgisItemBrowserPreview = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserPreviewClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserPreviewClose", 7);
        this.arcgisInternalItemBrowserSublayer = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisInternalItemBrowserSublayer", 7);
        this.arcgisItemBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
        this.sortSublayers = (a, b) => {
            const matchedA = this.layerMatches(a);
            const matchedB = this.layerMatches(b);
            if (matchedA === matchedB) {
                return b.id - a.id;
            }
            return matchedA ? -1 : 1;
        };
        this.layerMatches = (layer) => {
            var _a, _b, _c, _d, _e;
            return (_e = (_d = (_c = (_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.highlights) === null || _c === void 0 ? void 0 : _c[this.item.id]) === null || _d === void 0 ? void 0 : _d.sublayers) === null || _e === void 0 ? void 0 : _e.includes(layer.id);
        };
        this.renderField = (field) => {
            if (field.name === "OBJECTID") {
                return;
            }
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-field-details", { field: field, item: this.item, sublayer: this.sublayer, api: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api, showFieldStatistics: this.store.state.showFieldStatistics }));
        };
        this.handleLayerClick = (layer) => {
            this.sublayer = layer;
            this.fetchSublayer();
            this.arcgisItemBrowserInternalUIAction.emit({
                action: "click",
                category: "panel action",
                details: "sublayer"
            });
            this.arcgisInternalItemBrowserSublayer.emit(Object.assign({}, layer));
        };
        this.renderLayer = (layer) => {
            const matches = this.layerMatches(layer);
            const { icon } = (0,_utils_aa26c49f_js__WEBPACK_IMPORTED_MODULE_25__.g)({ geometry: layer.geometryType, type: layer.type });
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { onClick: () => this.handleLayerClick(layer), onKeyDown: (event) => {
                    if (event.key === " " || event.key === "Enter") {
                        event.preventDefault();
                        this.handleLayerClick(layer);
                    }
                }, class: "sublayer-item" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: icon, flipRtl: true, scale: "s", slot: "content-start" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { slot: "content", class: "sublayer-item__content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { "sublayer-item__title": true, "sublayer-item__title--matched": matches } }, layer.title || layer.name), matches && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "sublayer-item__description" }, this.i18n.matched)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-end", icon: "chevron-right", flipRtl: true, style: { display: "flex", justifyContent: "flex-end" } })));
        };
        this.item = undefined;
        this.portal = undefined;
        this.user = undefined;
        this.hidePreviewFooters = false;
        this.fullItem = undefined;
        this.formattedViews = undefined;
        this.loadingLayers = true;
        this.layerError = undefined;
        this.layers = [];
        this.sublayer = undefined;
        this.fullSublayer = undefined;
        this.showLayers = undefined;
        this.userInfo = undefined;
        this.tab = "fields";
        this.itemError = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.preview;
        this.layerTypes = this.store.state.i18n.layerTypes;
        this.lang = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_5__.a)(this.el);
        this.init();
    }
    updatePreview() {
        this.init();
    }
    async fetchItem() {
        this.itemError = null;
        return (0,_thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_7__.k)(this.item, this.portal, this.user, this.store);
    }
    async init() {
        var _a, _b, _c, _d, _e, _f;
        if (!this.item) {
            return;
        }
        const { item, portal, lang } = this;
        this.fullItem = null;
        this.shouldExpandOverview = true;
        this.loadingLayers = true;
        const response = await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.m)(this.fetchItem(), 600);
        if (response.error) {
            this.itemError =
                response.error.code === "disabledSubscription"
                    ? this.i18n.itemError.subscription
                    : this.i18n.itemError.unhandled;
            return;
        }
        this.fullItem = response.result;
        this.formattedViews = await (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.f)(item.numViews || 0, {
            api: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.api,
            places: 0,
            type: "decimal"
        });
        this.userInfo = await (0,_user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_24__.a)(item, portal, lang);
        (_a = this.flowItem) === null || _a === void 0 ? void 0 : _a.setFocus();
        const typeToShowLayers = [
            "Feature Service",
            "Layer Template",
            "Feature Collection"
        ];
        this.showLayers =
            typeToShowLayers.includes(item.type) && !((_b = item.typeKeywords) === null || _b === void 0 ? void 0 : _b.includes("Route Layer"));
        if (this.showLayers) {
            // layer templates store their layers/schema in item data
            if (item.type === "Layer Template" &&
                ((_c = item.typeKeywords) === null || _c === void 0 ? void 0 : _c.map((keyword) => keyword.toLowerCase()).includes("service template"))) {
                const data = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__.g)(this.portal)}content/items/${this.item.id}/data`);
                this.layers = [...((_d = data.layers) !== null && _d !== void 0 ? _d : []), ...((_e = data.tables) !== null && _e !== void 0 ? _e : [])];
            }
            else {
                const response = await (0,_services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_13__.f)({
                    item: this.fullItem,
                    portal: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.portal,
                    layers: null,
                    isSecure: false
                });
                if (response.result) {
                    this.layers = (_f = response.result) === null || _f === void 0 ? void 0 : _f.sort(this.sortSublayers);
                }
                else if (response.error) {
                    this.layerError = this.i18n.layerError;
                    if (response.error.code === "serviceNotExist") {
                        this.layerError.message = this.i18n.noServiceMessage;
                    }
                }
            }
        }
        this.loadingLayers = false;
    }
    handleAccordionItemClick(element, details) {
        this.arcgisItemBrowserInternalUIAction.emit({
            action: element.expanded ? "expand" : "collapse",
            category: "panel action",
            details
        });
    }
    async fetchSublayer() {
        const layerResponse = await (0,_services_5925c4b4_js__WEBPACK_IMPORTED_MODULE_13__.a)(this.portal, this.sublayer.id, this.item.url);
        this.fullSublayer = layerResponse === null || layerResponse === void 0 ? void 0 : layerResponse.result;
    }
    closePreview() {
        this.sublayer = null;
        this.fullItem = null;
        this.arcgisItemBrowserInternalUIAction.emit({
            action: "close panel",
            category: "panel action"
        });
        this.arcgisItemBrowserPreviewClose.emit();
    }
    renderHeader() {
        var _a;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "header-content", class: "preview__header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { class: "preview__title" }, (_a = this.item) === null || _a === void 0 ? void 0 : _a.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { item: this.item, portal: this.portal, scale: "m" })));
    }
    renderLayers() {
        var _a;
        return this.loadingLayers ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: this.i18n.loading, scale: "s" })) : this.layerError ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { icon: true, open: true, scale: "s", width: "full", kind: "warning" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.layerError.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this.layerError.message)))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { "selection-mode": "none", loading: this.loadingLayers, ref: (list) => {
                var _a;
                const table = (_a = list === null || list === void 0 ? void 0 : list.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector("table");
                if (table) {
                    table.style.borderSpacing = "0";
                }
            } }, (_a = this.layers) === null || _a === void 0 ? void 0 : _a.map(this.renderLayer))));
    }
    isAccordionItem(element) {
        return element.tagName === "CALCITE-ACCORDION-ITEM";
    }
    handleSublayerSectionChange(section) {
        this.tab = section;
        this.arcgisItemBrowserInternalUIAction.emit({
            action: "click",
            category: "panel action",
            details: `sublayer ${section}`
        });
    }
    renderSublayerPreview() {
        var _a, _b, _c, _d;
        const { sublayer, item, i18n, fullSublayer } = this;
        const { geometryType, title, name, description } = sublayer;
        const { type, isGeometry } = (0,_utils_aa26c49f_js__WEBPACK_IMPORTED_MODULE_25__.g)({
            geometry: geometryType,
            type: sublayer.type
        });
        const layerType = this.layerTypes[type];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, onCalciteFlowItemBack: (e) => {
                e.stopPropagation();
                this.arcgisInternalItemBrowserSublayer.emit();
                this.sublayer = null;
            }, onCalciteFlowItemClose: (e) => {
                e.stopPropagation();
                this.closePreview();
            } }, this.renderHeader(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-sublayer-type", { name: name || title, geometry: sublayer.geometryType, type: sublayer.type, showType: false, scale: "s" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tabs", { position: "top", scale: "m", layout: "center", class: { sublayer__tabs: true, "sublayer__tabs--white": this.tab === "fields" } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-nav", { slot: "title-group", class: "sublayer__tab-nav" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-title", { onClick: () => this.handleSublayerSectionChange("fields"), selected: this.tab === "fields" }, i18n.fields), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab-title", { onClick: () => this.handleSublayerSectionChange("overview"), selected: this.tab === "overview" }, i18n.overview)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__content" }, sublayer.fields ? (sublayer.fields.map(this.renderField)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noFields)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tab", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "sublayer__content sublayer__content--overview" }, this.renderDetail(isGeometry ? i18n.geometryTypeTitle : i18n.layerTypeTitle, layerType), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.description), description ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "details-text description", innerHTML: (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.s)((0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.d)(description)) })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)), !((_a = this.portal) === null || _a === void 0 ? void 0 : _a.isPortal) &&
            this.renderDetail(i18n.dataUpdated, (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)((_b = fullSublayer === null || fullSublayer === void 0 ? void 0 : fullSublayer.editingInfo) === null || _b === void 0 ? void 0 : _b.dataLastEditDate)), !((_c = this.portal) === null || _c === void 0 ? void 0 : _c.isPortal) &&
            this.renderDetail(i18n.schemaUpdated, (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)((_d = fullSublayer === null || fullSublayer === void 0 ? void 0 : fullSublayer.editingInfo) === null || _d === void 0 ? void 0 : _d.schemaLastEditDate)), item.url && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: `${item.url}/${sublayer.id}`, heading: i18n.URL }))))), !this.hidePreviewFooters && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, this.renderSublayerSelect(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "sublayer-footer" })))));
    }
    renderDetail(title, text, emptyText, html) {
        const textNode = !emptyText || text ? (html ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text", innerHTML: (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.s)(text) })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text" }, text))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, emptyText));
        return [(0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, title), textNode];
    }
    renderSublayerSelect() {
        var _a, _b, _c;
        if ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection) === null || _b === void 0 ? void 0 : _b.includes("sublayer")) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-sublayer-select", { item: this.item, user: this.user, portal: this.portal, selection: ((_c = this.store) === null || _c === void 0 ? void 0 : _c.state.selection) === "multiple-sublayer" ? "multiple" : "single", appearance: "solid", width: "full" }));
        }
        return null;
    }
    render() {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        const { item, fullItem, i18n, user, sublayer, userInfo, portal, itemError } = this;
        const owner = (_a = item === null || item === void 0 ? void 0 : item.owner) !== null && _a !== void 0 ? _a : "";
        const managedBy = (0,_badges_555e1b90_js__WEBPACK_IMPORTED_MODULE_23__.g)(fullItem) === "public_authoritative"
            ? this.i18n.itemManagedBy.replace("${username}", owner)
            : owner;
        const layersHeader = ((_b = this.layers) === null || _b === void 0 ? void 0 : _b.length)
            ? i18n.layersCount.replace("${count}", `${((_c = this.layers) === null || _c === void 0 ? void 0 : _c.length) || 0}`)
            : i18n.layers;
        const matchedSublayers = (_f = (_e = (_d = this.store) === null || _d === void 0 ? void 0 : _d.state.highlights) === null || _e === void 0 ? void 0 : _e[item === null || item === void 0 ? void 0 : item.id]) === null || _f === void 0 ? void 0 : _f.sublayers;
        const layersDescription = (matchedSublayers === null || matchedSublayers === void 0 ? void 0 : matchedSublayers.length) && !this.loadingLayers
            ? i18n.matchedNumber.replace("${num}", `${matchedSublayers.length}`)
            : null;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { closable: true, loading: !fullItem && !itemError, onCalciteFlowItemClose: (e) => {
                e.stopPropagation();
                this.closePreview();
            }, ref: (el) => (this.flowItem = el) }, this.renderHeader(), !!itemError && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "error-container" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { kind: "danger", open: true, scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, this.i18n.itemError.title), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, itemError)))), fullItem && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion", { "icon-position": "start", appearance: "transparent", key: item.id, class: "accordion", onClick: async (e) => {
                const target = e.target;
                if (this.isAccordionItem(target)) {
                    await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(300);
                    if (target.expanded) {
                        target.scrollIntoView({ behavior: "smooth", block: "start" });
                    }
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.thumbnail, ref: (el) => {
                this.thumbnailElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.thumbnailElement, "thumbnail") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section section--tight" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-card-thumbnail", { item: item, user: user, portal: portal }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.overview, ref: (el) => {
                this.overviewElement = el;
                if (this.shouldExpandOverview) {
                    el.expanded = true;
                    this.shouldExpandOverview = false;
                }
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.overviewElement, "overview") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "summary-top" }), this.renderDetail(i18n.summary, fullItem.snippet, i18n.noSummary), !!((_g = (0,_badges_555e1b90_js__WEBPACK_IMPORTED_MODULE_23__.a)(item, portal, user)) === null || _g === void 0 ? void 0 : _g.length) && [
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.itemStatus),
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { class: "badges", item: item, portal: portal, user: user, scale: "s", width: "full" })
        ], (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.owner), ((_h = this.store) === null || _h === void 0 ? void 0 : _h.state.panel) ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-avatar", { user: userInfo, scale: "s", portal: portal, showName: true, description: managedBy })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { baseUrl: _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config.baseUrl, portal: portal, item: fullItem })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "details-title" }, i18n.shared), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-summary", { item: fullItem, scale: "s" }), this.renderDetail(i18n.updated, (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)(fullItem.modified)), !!user && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-favorite", { class: "favorite", user: user, portal: portal, item: fullItem, width: "full" })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.description, key: "description", ref: (el) => {
                this.descriptionElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.descriptionElement, "description") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, fullItem.description ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description", innerHTML: (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__.s)(fullItem.description) })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "details-text details-text--empty" }, i18n.noDescription)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: i18n.details, ref: (el) => {
                this.detailsElement = el;
            }, onClick: (e) => this.isAccordionItem(e.target) &&
                this.handleAccordionItemClick(this.detailsElement, "details") }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, this.renderDetail(i18n.created, (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)(fullItem.created)), this.renderDetail(i18n.viewCount, this.formattedViews), item.type === "Dashboard" &&
            this.renderDetail(i18n.dashboardViews, ((_j = item.typeKeywords) === null || _j === void 0 ? void 0 : _j.includes("Mobile"))
                ? i18n.dashboardMobile
                : i18n.dashboardDesktop), !!fullItem.size &&
            this.renderDetail(i18n.fileSize, (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_22__.f)(fullItem.size)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: fullItem.id, heading: i18n.ID }), fullItem.url && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-browser-preview-copy", { text: fullItem.url, heading: i18n.URL })), this.renderDetail(i18n.credits, fullItem.accessInformation, i18n.noCredits), this.renderDetail(i18n.termsOfUse, fullItem.licenseInfo, i18n.noTermsOfUse, true))), this.showLayers && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-accordion-item", { heading: layersHeader, description: layersDescription, ref: (el) => {
                this.layersElement = el;
            }, onClick: async (e) => {
                if (this.isAccordionItem(e.target)) {
                    this.handleAccordionItemClick(this.layersElement, "layers");
                }
            } }, this.renderLayers()))))), !this.hidePreviewFooters && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "footer", class: "footer-actions" }, this.renderSublayerSelect(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "footer" })))), !!sublayer && this.renderSublayerPreview())));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "item": ["updatePreview"]
    }; }
};
ArcgisItemBrowserPreview.style = arcgisItemBrowserPreviewCss;

const arcgisItemBrowserPreviewCopyCss = ".heading{margin-top:1rem;margin-bottom:0px;padding-bottom:0.25rem;padding-top:0px;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-3);--calcite-label-margin-bottom:0}.label{padding-bottom:0px}.input{--calcite-color-background:var(--calcite-color-foreground-1)}.action{position:relative}.tooltip{position:absolute;white-space:nowrap;border-radius:var(--calcite-border-radius);background-color:var(--calcite-color-foreground-1);padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-1);opacity:0;--tw-shadow:0 4px 8px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);--tw-shadow-colored:0 4px 8px -1px var(--tw-shadow-color), 0 2px 4px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;transition-duration:150ms;transform:translateY(-8px);top:calc(100% + 4px);inset-inline-end:0;width:auto;border:1px solid var(--calcite-color-border-3);line-height:1.375}.button:hover+.tooltip,.button:focus+.tooltip{opacity:1;transform:translateY(0)}";

const ArcgisItemBrowserPreviewCopy = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserInternalUIAction = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserInternalUIAction", 7);
        this.heading = undefined;
        this.text = undefined;
        this.copied = false;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.copy;
    }
    async handleCopy(text) {
        navigator.clipboard.writeText(text);
        this.copied = true;
        const isSublayer = this.el.parentElement.classList.contains("sublayer__content");
        this.arcgisItemBrowserInternalUIAction.emit({
            action: "copy",
            category: "panel action",
            details: isSublayer ? "layers" : "details"
        });
        await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(10000);
        this.copied = false;
    }
    render() {
        const { heading, text, i18n } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "label", scale: "s" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h4", { class: "heading" }, heading), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { value: text, readOnly: true, alignment: "start", type: "text", label: heading, scale: "s", class: "input" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "action", class: "action" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "button", slot: "action", iconStart: "copy-to-clipboard", id: "copy-button", kind: "neutral", scale: "s", onClick: () => this.handleCopy(text), onMouseOut: async () => {
                await (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_4__.t)(200);
                this.copied = false;
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "tooltip" }, this.copied ? i18n === null || i18n === void 0 ? void 0 : i18n.copied : i18n === null || i18n === void 0 ? void 0 : i18n.copy))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserPreviewCopy.style = arcgisItemBrowserPreviewCopyCss;

const ArcgisItemBrowserPreviewFieldDetails = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.field = undefined;
        this.item = undefined;
        this.sublayer = undefined;
        this.showFieldStatistics = undefined;
        this.api = 4;
        this.layer = undefined;
    }
    async getFieldData() {
        if (!this.layer) {
            const [FeatureLayer] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_20__.l)(["esri/layers/FeatureLayer"]);
            const layer = new FeatureLayer({
                // Notice that the url doesn't end with /2
                url: this.item.url,
                layerId: this.sublayer.id
            });
            await layer.load();
            this.layer = layer;
        }
    }
    render() {
        const { field, showFieldStatistics, api } = this;
        if (!field) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: field.alias || field.name, description: field.name, headingLevel: 5, collapsible: showFieldStatistics && api === 4 && this.item.type === "Feature Service", onCalciteBlockToggle: () => {
                this.getFieldData();
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { slot: "icon", icon: _type_to_icon_7546439f_js__WEBPACK_IMPORTED_MODULE_26__.f[field.type] || "string", scale: "s", class: "layer-icon" }), !!this.layer && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-field-info", { layer: this.layer, fieldName: field.name }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserSearch = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserSearch = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSearch", 7);
        this.arcgisItemBrowserSearchInput = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSearchInput", 7);
        this.term = undefined;
        this.placeholder = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    render() {
        var _a, _b;
        const { term, placeholder } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) !== "subscription content" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-search", { term: term, placeholder: placeholder, onArcgisBrowserSearch: (e) => this.arcgisItemBrowserSearch.emit(e.detail), onArcgisBrowserSearchInput: (e) => this.arcgisItemBrowserSearchInput.emit(e.detail) }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const defaultSortOrders = {
    my: {
        sortField: "modified",
        sortOrder: "desc"
    },
    favorites: {
        sortField: "modified",
        sortOrder: "desc"
    },
    group: {
        sortField: "modified",
        sortOrder: "desc"
    },
    org: {
        sortField: "modified",
        sortOrder: "desc"
    },
    "subscription content": {
        sortField: "relevance",
        sortOrder: "asc"
    },
    "living atlas": {
        sortField: "relevance",
        sortOrder: "asc"
    },
    "living atlas analysis": {
        sortField: "relevance",
        sortOrder: "asc"
    },
    all: {
        sortField: "relevance",
        sortOrder: "asc"
    }
};

const ArcgisItemBrowserSort = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserSort = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
        this.options = ["title", "relevance", "modified"];
        this.field = undefined;
        this.order = undefined;
        this.activeField = undefined;
        this.activeOrder = undefined;
        this.userSetSort = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        const { field, options } = this;
        if (!field) {
            const bucketSort = this.store.state.bucket && defaultSortOrders[this.store.state.bucket];
            this.activeField = bucketSort ? bucketSort.sortField : (options === null || options === void 0 ? void 0 : options[0]) || "relevance";
            this.activeOrder = (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__.a)(this.activeField);
        }
        else {
            this.userSetSort = true;
            this.activeField = field;
            this.activeOrder = this.order || (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__.a)(field);
        }
        (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.o)(this.store, (bucket) => {
            const defaultSort = defaultSortOrders[bucket];
            if (defaultSort) {
                this.updateSortField(defaultSort.sortField);
            }
        });
        (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.a)(this.store, (sort) => {
            this.activeField = sort.sortField;
            this.activeOrder = sort.sortOrder;
        });
    }
    componentDidLoad() {
        this.arcgisItemBrowserSort.emit({
            sortField: this.field || this.activeField,
            sortOrder: this.order || (this.field ? (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__.a)(this.field) : this.activeOrder)
        });
    }
    updateSortField(field) {
        this.activeField = field;
        this.activeOrder = (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__.a)(field);
        this.arcgisItemBrowserSort.emit({
            sortField: this.activeField,
            sortOrder: this.activeOrder
        });
    }
    updateSortOrder(order) {
        this.activeOrder = order;
        this.arcgisItemBrowserSort.emit({
            sortField: this.activeField,
            sortOrder: this.activeOrder
        });
    }
    render() {
        var _a, _b;
        const { activeField, activeOrder, field, order, options } = this;
        const selectedField = activeField || (options.includes(field) ? field : options[0]);
        const selectedOrder = activeOrder || order;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) !== "subscription content" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-sort", { store: this.store, field: selectedField, order: selectedOrder, options: options, onArcgisBrowserSortFieldChange: (e) => this.updateSortField(e.detail), onArcgisBrowserSortOrderChange: (e) => this.updateSortOrder(e.detail) }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const COLUMNS = {
    title: {
        width: "minmax(0, 7fr)"
    },
    type: {
        width: "minmax(0, 5fr)",
        hidden: true
    },
    modified: {
        width: "7.5rem"
    },
    badges: {
        width: "6.5rem",
        hidden: true
    },
    owner: {
        width: "minmax(0, 3fr)"
    },
    sharing: {
        width: "6rem",
        hidden: true
    },
    size: {
        width: "minmax(0, 2fr)"
    },
    deleted: {
        width: "12rem"
    },
    details: {
        width: "8rem",
        hidden: true
    },
    favorite: {
        width: "3.5rem",
        hidden: true
    },
    actions: {
        width: "3.5rem",
        hidden: true
    }
};
function calculateDaysUntilDeletion(date) {
    const dateDeleted = new Date(date);
    const expirationDate = new Date(dateDeleted.setDate(dateDeleted.getDate() + _delete_items_32d24534_js__WEBPACK_IMPORTED_MODULE_28__.D));
    // Cap minimum days remaining at 1 to ensure cultureUtil doesn't lose its `single` string
    return Math.max(Math.ceil((expirationDate.valueOf() - Date.now()) / 86400000), 1);
}

const arcgisItemBrowserTableCss = ".table{background-color:var(--calcite-color-foreground-1)}.header{display:grid;grid-template-columns:var(--item-browser-table-columns)}.button__-text-sorted{font-weight:500}.column-header{border-bottom:1px solid var(--calcite-color-border-2);margin-bottom:1px}.column-header--sorted{border-bottom-color:var(--calcite-color-brand)}.screen-reader-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";

const ArcgisItemBrowserTable = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserColumnUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserColumnUpdate", 7);
        this.arcgisItemBrowserSort = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserSort", 7);
        this.rows = [];
        this.columns = [
            "title",
            "type",
            "modified",
            "badges",
            "owner",
            "sharing",
            "details",
            "actions"
        ];
        this.activeFocus = [0, 0];
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.table;
        (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.b)(this.store, (preview) => {
            // when the preview is closed, restore focus to the grid
            if (!preview && this.store.state.activeFocus) {
                const [row, column] = this.store.state.activeFocus;
                this.updateRows();
                const rowElement = this.rows[row];
                rowElement === null || rowElement === void 0 ? void 0 : rowElement.focusColumn(column);
            }
        });
    }
    async componentDidLoad() {
        this.arcgisItemBrowserColumnUpdate.emit(this.columns);
    }
    updateColumns(columns) {
        this.arcgisItemBrowserColumnUpdate.emit(columns);
    }
    async attemptMove([row, column], direction) {
        const rowElement = this.rows[row];
        if (await rowElement.canFocusColumn(column)) {
            this.store.state.activeFocus = [row, column];
            requestAnimationFrame(() => rowElement.focusColumn(column));
        }
        else {
            switch (direction) {
                case "right":
                    return this.moveRight([row, column]);
                case "left":
                    return this.moveLeft([row, column]);
                case "up":
                    return this.moveUp([row, column]);
                case "down":
                    return this.moveDown([row, column]);
            }
        }
    }
    updateRows() {
        this.rows = this.rowSlot.assignedElements();
    }
    getLastColumnIndex() {
        const isMultiSelect = this.store.state.selection === "multiple";
        return this.columns.length - (isMultiSelect ? 0 : 1);
    }
    getLastRowIndex() {
        return this.rows.length - 1;
    }
    async moveRight([row, currentColumn]) {
        const desiredColumn = currentColumn >= this.getLastColumnIndex() ? 0 : currentColumn + 1;
        this.attemptMove([row, desiredColumn], "right");
    }
    async moveLeft([row, currentColumn]) {
        const desiredColumn = currentColumn < 1 ? this.getLastColumnIndex() : currentColumn - 1;
        this.attemptMove([row, desiredColumn], "left");
    }
    async moveUp([currentRow, column]) {
        const desiredRow = currentRow < 1 ? this.getLastRowIndex() : currentRow - 1;
        this.attemptMove([desiredRow, column], "up");
    }
    async moveDown([currentRow, column]) {
        const desiredRow = currentRow + 1 > this.getLastRowIndex() ? 0 : currentRow + 1;
        this.attemptMove([desiredRow, column], "down");
    }
    handleKeyboard(e) {
        const { key } = e;
        const current = this.store.state.activeFocus || [0, 0];
        this.updateRows();
        switch (key) {
            case "ArrowDown":
                e.preventDefault();
                return this.moveDown(current);
            case "ArrowUp":
                e.preventDefault();
                return this.moveUp(current);
            case "ArrowLeft":
                e.preventDefault();
                return this.moveLeft(current);
            case "ArrowRight":
                e.preventDefault();
                return this.moveRight(current);
        }
    }
    renderColumn(id) {
        const label = this.i18n.headers[id];
        const { hidden } = COLUMNS[id];
        const { sortField, sortOrder } = this.store.state.sort || {};
        const sortID = id === "deleted" ? "modified" : id;
        const isSorted = sortField === sortID;
        return hidden ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", class: "column-header" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-reader-only" }, label))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { "column-header": true, "column-header--sorted": isSorted } }, !!(id === "title" && this.store.state.selection === "multiple") && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", class: "screen-reader-only" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.i18n.selection))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "columnheader", "aria-sort": sortOrder === "asc" ? "ascending" : "descending" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", alignment: "icon-end-space-between", tabindex: "-1", scale: "m", appearance: "transparent", kind: isSorted ? "brand" : "neutral", "icon-end": isSorted && sortOrder === "asc" ? "caret-up" : "caret-down", onClick: () => {
                // if we are already sorting on this field, flip it
                if (isSorted) {
                    this.arcgisItemBrowserSort.emit({
                        sortField: sortID,
                        sortOrder: sortOrder === "asc" ? "desc" : "asc"
                    });
                }
                else {
                    this.arcgisItemBrowserSort.emit({
                        sortField: sortID,
                        sortOrder: (0,_utils_2f459d6d_js__WEBPACK_IMPORTED_MODULE_27__.a)(sortID)
                    });
                }
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: { button__text: true, "button__text--sorted": isSorted } }, label)))));
    }
    render() {
        const isMultiSelect = this.store.state.selection === "multiple";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { style: {
                "--item-browser-table-columns": `${this.columns.map((id) => COLUMNS[id].width).join(" ")}`
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ class: "table", "aria-label": this.i18n.caption, role: "grid", "aria-readonly": "true" }, (isMultiSelect ? { "aria-multiselectable": "true" } : {}), { onKeyDown: (e) => this.handleKeyboard(e) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "rowgroup" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "row", class: "header" }, this.columns.map((id) => this.renderColumn(id)))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { ref: (el) => (this.rowSlot = el) })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "columns": ["updateColumns"]
    }; }
};
ArcgisItemBrowserTable.style = arcgisItemBrowserTableCss;

const arcgisItemBrowserTableRowCss = ":host{display:block;--item-browser-table-row-active-background:#bbd5fa26}.row{display:grid;background-color:var(--calcite-color-foreground-1);grid-template-columns:var(--item-browser-table-columns);border:1px solid var(--calcite-color-foreground-1);border-top:1px solid var(--calcite-color-border-2);margin-top:-1px}.row--first{border-top-color:var(--calcite-color-foreground-1)}.row--selected{position:relative;border-color:var(--calcite-color-brand);background-color:var(--item-browser-table-row-active-background)}.row--selected-last{border-top-color:var(--item-browser-table-row-active-background)}.cell{display:flex;align-items:center;justify-content:flex-start;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;font-size:0.875rem;color:var(--calcite-color-text-1);outline-color:transparent;line-height:1.35}.cell:focus{outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.cell--narrow{padding-inline-start:0.5rem}.cell--overflow{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow-wrap:break-word}.checkbox-wrap{display:flex}.checkbox__title{flex:1 1 0%}.user-popup{width:100%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.date-deleted{display:block;padding-bottom:0.25rem;font-size:0.875rem;font-weight:400;color:var(--calcite-color-text-1)}.deletes-in{display:block;font-size:0.75rem;font-weight:400;color:var(--calcite-color-text-2)}.button{border:1px solid var(--calcite-color-foreground-3);font-family:inherit;box-sizing:border-box;display:flex;height:2rem;max-width:100%;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;align-items:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;background-color:var(--calcite-color-foreground-1);padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;color:var(--calcite-color-text-1);text-decoration-line:none;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.button:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.button:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.button--transparent{border:1px solid transparent;background:transparent;padding-left:0.5rem;padding-right:0.5rem}.button--transparent:hover{background-color:var(--calcite-color-foreground-2);box-shadow:none}.button__icon{pointer-events:none}";

const ArcgisItemBrowserTableRow = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserColumnUpdate = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserColumnUpdate", 7);
        this.arcgisItemBrowserCardSelect = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardSelect", 7);
        this.arcgisItemBrowserCardPreview = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserCardPreview", 7);
        this.arcgisItemBrowserActionsOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserActionsOpen", 7);
        this.arcgisItemBrowserRestoreItem = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserRestoreItem", 7);
        var _a;
        this.columnRefs = {};
        this.item = undefined;
        this.portal = undefined;
        this.index = undefined;
        this.user = undefined;
        this.api = 4;
        this.baseUrl = (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.config) === null || _a === void 0 ? void 0 : _a.baseUrl;
        this.link = undefined;
        this.newTab = undefined;
        this.name = undefined;
        this.preview = undefined;
        this.showItemType = true;
        this.showBadges = true;
        this.showSharing = true;
        this.actions = [];
        this.hasMouse = undefined;
        this.mouseOverColumn = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.tableRow;
    }
    async canFocusColumn(index) {
        var _a;
        const columns = this.store.state.columns || [];
        const adjustedIndex = this.getColumnNumber(index);
        const id = columns[adjustedIndex];
        // only allow tabbing to the badges if there are badges displayed
        if (id === "badges") {
            return !this.badges.empty;
        }
        return !!((_a = this.columnRefs[id]) === null || _a === void 0 ? void 0 : _a.method) || adjustedIndex < 0;
    }
    async focusColumn(column) {
        var _a;
        let adjustedColumn = column;
        // selectable tables have the checkbox and title in a single column
        // offset the column number to allow movement as if they were separate columns
        if (this.store.state.selection === "multiple") {
            if (column === 0) {
                (_a = this.checkbox) === null || _a === void 0 ? void 0 : _a.setFocus();
                return;
            }
            adjustedColumn = column - 1;
        }
        const { el, method } = this.columnRefs[this.store.state.columns[adjustedColumn]] || {};
        el[method]();
    }
    getColumnNumber(column) {
        if (this.store.state.selection === "multiple") {
            return column - 1;
        }
        return column;
    }
    isSimpleColumn(id) {
        return !["owner", "details", "favorite", "actions"].includes(id);
    }
    onClick(cb) {
        return {
            onClick: () => {
                cb();
            },
            onKeyDown: (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    cb();
                }
            }
        };
    }
    renderTitle(selected) {
        var _a, _b, _c, _d;
        const { item } = this;
        const activeColumn = (_b = (_a = this.store.state.activeFocus) === null || _a === void 0 ? void 0 : _a[1]) !== null && _b !== void 0 ? _b : 0;
        const rowHasFocus = ((_d = (_c = this.store.state.activeFocus) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : 0) === this.index;
        const columnHasFocus = activeColumn < 2;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "checkbox-wrap", onMouseOver: () => {
                this.mouseOverColumn = 0;
            }, key: "title" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { role: "gridcell", class: "cell" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", Object.assign({}, ((rowHasFocus && columnHasFocus) || (this.hasMouse && this.mouseOverColumn === 0)
            ? {}
            : { inert: true }), { class: "checkbox", checked: selected, ref: (el) => {
                this.checkbox = el;
            }, onClick: (e) => {
                e.stopPropagation();
                this.store.state.activeFocus = [this.index, 0];
            }, onCalciteCheckboxChange: () => {
                this.arcgisItemBrowserCardSelect.emit({ item, selected: !selected });
            }, value: item.id }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "screen-readers-only" }, item.title))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ onMouseOver: () => {
                this.mouseOverColumn = 0;
            }, role: "gridcell", class: "cell cell--narrow checkbox__title", id: `row-${item.id}`, tabindex: activeColumn === 1 && rowHasFocus ? 0 : -1 }, this.onClick(() => {
            if (this.preview === "title" && !this.store.state.recycleBin) {
                this.arcgisItemBrowserCardPreview.emit(item);
            }
            this.store.state.activeFocus = [this.index, 1];
        }), { ref: (el) => {
                this.columnRefs.title = { el, method: "focus" };
            } }), this.item.title)));
    }
    renderDeleted() {
        const { item, i18n, store } = this;
        const days = calculateDaysUntilDeletion(item.modified);
        const dateText = days < 2 ? i18n.deletesTomorrow : (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.b)(store.state.lang, i18n.deletes, days);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "date-deleted" }, (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)(item.modified)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "deletes-in" }, dateText)));
    }
    renderColumn(id, columnIndex, selected) {
        var _a, _b, _c, _d;
        const { item, api, portal, baseUrl, user, actions } = this;
        const activeColumn = (_b = (_a = this.store.state.activeFocus) === null || _a === void 0 ? void 0 : _a[1]) !== null && _b !== void 0 ? _b : 0;
        const isSimpleColumn = this.isSimpleColumn(id);
        const rowHasFocus = ((_d = (_c = this.store.state.activeFocus) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : 0) === this.index;
        const columnHasFocus = columnIndex === this.getColumnNumber(activeColumn);
        if (id === "title" && this.store.state.selection === "multiple") {
            return this.renderTitle(selected);
        }
        const tab = { tabIndex: columnHasFocus && rowHasFocus ? 0 : -1 };
        const truncate = ["owner"].includes(id);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ key: id }, (isSimpleColumn ? tab : {}), { role: "gridcell", class: { cell: true, "cell--overflow": truncate }, ref: (el) => {
                if (isSimpleColumn) {
                    this.columnRefs[id] = { el, method: "focus" };
                }
            },
            // on click, set the active focus coordinates to that cell
            onClick: () => {
                setTimeout(() => {
                    const column = this.store.state.selection === "multiple" ? columnIndex + 1 : columnIndex;
                    if (!columnHasFocus || !rowHasFocus) {
                        this.store.state.activeFocus = [this.index, column];
                    }
                    if (id === "title" && this.preview === "title" && !this.store.state.recycleBin) {
                        this.arcgisItemBrowserCardPreview.emit(item);
                    }
                }, 100);
            }, onMouseOver: () => {
                this.mouseOverColumn = columnIndex;
            } }), id === "title" && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.item.title), id === "type" && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-type", { item: item, portal: this.portal, scale: "m" }), id === "modified" && (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_12__.a)(item.modified), id === "deleted" && this.renderDeleted(), id === "size" && (0,_file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_22__.f)(item.size), id === "badges" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-badges", { ref: (el) => (this.badges = el), showTooltips: true, item: item, width: "narrow", scale: "s", tabIndex: -1 })), id === "sharing" && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-share-summary", { showText: false, item: item, scale: "s" }), id === "owner" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-user-popup", { item: item, underline: true, api: api, portal: portal, baseUrl: baseUrl, scale: "m", class: "user-popup", showAvatar: false, ref: (el) => {
                this.columnRefs.owner = { el, method: "setFocus" };
            }, tabIndex: -1 })), id === "details" &&
            (this.store.state.recycleBin ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", Object.assign({}, tab, { class: "button", ref: (el) => {
                    this.columnRefs.details = { el, method: "focus" };
                }, onClick: () => {
                    this.arcgisItemBrowserRestoreItem.emit(this.item);
                } }), this.i18n.restore)) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("a", Object.assign({}, tab, { href: `${(0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_29__.r)(this.baseUrl)}/item.html?id=${item.id}`, class: "button", ref: (el) => {
                    this.columnRefs.details = { el, method: "focus" };
                } }), this.i18n.details))), id === "favorite" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-favorite", { item: item, portal: portal, user: user || (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_2__.c.user), iconOnly: true, ref: (el) => {
                this.columnRefs.favorite = { el, method: "setFocus" };
            }, tabIndex: -1 })), id === "actions" && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, actions.length > 0 && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", Object.assign({}, tab, { class: "button button--transparent", "aria-label": this.i18n.moreOptions, "aria-haspopup": "true", slot: "trigger", ref: (el) => {
                this.columnRefs.actions = { el, method: "focus" };
            }, onClick: (e) => {
                this.arcgisItemBrowserActionsOpen.emit({
                    el: e.target,
                    actions
                });
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: "ellipsis", scale: "s", class: "button__icon" })))))));
    }
    render() {
        var _a, _b;
        const columns = this.store.state.columns || [];
        const { item } = this;
        const selection = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state.selection;
        const itemSelection = ["single", "multiple"].includes(selection);
        const selected = itemSelection && isSelected({ item, selectedItems: (_b = this.store) === null || _b === void 0 ? void 0 : _b.state.selectedItems });
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, Object.assign({}, (selected ? { "data-selected": true } : {}), { onMouseOver: () => {
                this.hasMouse = true;
            }, onMouseOut: () => {
                this.hasMouse = false;
            } }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", Object.assign({ class: {
                row: true,
                "row--selected": selected,
                "row--first": this.index === 0
            }, role: "row" }, (selected ? { ariaSelected: true } : {}), { "aria-labelledby": `row-${item.id}` }), columns.map((id, i) => this.renderColumn(id, i, selected)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemBrowserTableRow.style = arcgisItemBrowserTableRowCss;

const ArcgisItemBrowserTopBar = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
    }
    render() {
        var _a, _b;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-browser-top-bar", { store: this.store, filtersDisabled: ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.bucket) === "subscription content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-start" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-start" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "bucket" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "bucket" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "search" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "search" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", { name: "content-end" })))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisItemBrowserView = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisItemBrowserView = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisItemBrowserView", 7);
        this.options = ["grid", "list"];
        this.view = undefined;
    }
    async componentWillLoad() {
        this.store = (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.g)(this.el);
        this.i18n = this.store.state.i18n.view;
        const { view } = this;
        if (!view) {
            this.view = this.store.state.view || "list";
        }
        (0,_store_7fa26472_js__WEBPACK_IMPORTED_MODULE_8__.c)(this.store, (newView) => {
            this.view = newView;
        });
    }
    syncStore(newView) {
        this.store.state.view = newView;
    }
    componentDidLoad() {
        this.arcgisItemBrowserView.emit(this.view);
    }
    renderOption(option) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-item", { key: option, selected: option === this.view, onCalciteDropdownItemSelect: () => this.arcgisItemBrowserView.emit(option), iconStart: option }, this.i18n[option]));
    }
    renderButton() {
        var _a, _b;
        const { i18n, view } = this;
        const baseAttrs = {
            class: "button",
            slot: "trigger",
            scale: "m",
            appearance: "outline-fill",
            kind: "neutral",
            iconStart: view,
            iconFlipRtl: "start",
            ariaLabel: `${i18n.view}: ${i18n[view]}`
        };
        return ((_b = (_a = this.store) === null || _a === void 0 ? void 0 : _a.state) === null || _b === void 0 ? void 0 : _b.width) > _resize_a17b7292_js__WEBPACK_IMPORTED_MODULE_6__.D ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", Object.assign({}, baseAttrs), i18n[view])) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", Object.assign({}, baseAttrs)));
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown", { placement: "bottom-end", scale: "m", overlayPositioning: "fixed", widthScale: "s" }, this.renderButton(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-dropdown-group", { selectionMode: "single" }, this.options.map((option) => this.renderOption(option))))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "view": ["syncStore"]
    }; }
};



//# sourceMappingURL=arcgis-item-browser_31.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-555e1b90.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/badges-555e1b90.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getBadges),
/* harmony export */   b: () => (/* binding */ getTooltip),
/* harmony export */   g: () => (/* binding */ getContentStatus),
/* harmony export */   i: () => (/* binding */ isPublicAuthoritative)
/* harmony export */ });
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./user-0fa9ff5a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-0fa9ff5a.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const retiredUrlParts = [
    "3DInsetMap",
    "3DScene",
    "3DViz",
    "AttachmentViewer",
    "CapacityAnalysis",
    "Compare/storytelling_compare",
    "Compare/storytelling_tabbed",
    "Compare/storytelling_sidepanel",
    "Compare/Multiviewer",
    "Compare/Search",
    "Compare/Configure",
    "Compare/SideBySideViewer_Configure",
    "Compare3d",
    "CompareAnalysis",
    "CompareMaps",
    "Directions",
    "Edit",
    "Editor",
    "Elevations",
    "ElevationsProfile",
    "Embed",
    "Filter",
    "FilterGallery",
    "GeoList",
    "GeoTour",
    "HeaderFooter",
    "Identify",
    "ImageInterpretation",
    "ImageryViewer",
    "ImpactSummary",
    "InformationLookup",
    "InteractiveFilter",
    "InteractiveLegend",
    "LayerShowcase",
    "Legend",
    "LiveMaps",
    "LocalPerspective",
    "MapAndAppGallery",
    "MapCarousel",
    "MapTools",
    "Media",
    "MinimalGallery",
    "Minimalist",
    "Nearby",
    "OnePane",
    "Panels",
    "PanelsLegend",
    "Profile",
    "PublicGallery",
    "PublicInformation",
    "ServiceLookup",
    "SimpleMapViewer",
    "SimpleViewer",
    "SocialMedia",
    "Solutions/s2.html?app=apps2/FindEditFilter",
    "Solutions/s2.html?app=apps2/Finder",
    "StorytellingTextLegend",
    "StoryMapBasic",
    "Styler",
    "SummaryViewer",
    "Time",
    "TimeAware",
    "TwoPane",
    "Viewer",
    "ZoneLookup"
];

function isRetiredItemType(type) {
    return _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_2__.r.includes(type);
}
function isRetiredStoryMap(item) {
    var _a, _b;
    return ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && item.type === "Web Mapping Application" && ((_b = item.typeKeywords) === null || _b === void 0 ? void 0 : _b.includes("Story Map"));
}
function isCityEngineWebScene(item) {
    return item.type === "CityEngine Web Scene";
}
function isRetiredApp(item) {
    var _a;
    const isRetiredUrl = retiredUrlParts.some((urlPart) => {
        var _a;
        const containsHtml = urlPart.includes(".html");
        const fullRetiredPath = `/apps/${urlPart}${!containsHtml ? "/" : ""}`;
        return (_a = item.url) === null || _a === void 0 ? void 0 : _a.includes(fullRetiredPath);
    });
    return ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) && item.type === "Web Mapping Application" && item.url && isRetiredUrl;
}
function getContentStatus(item) {
    var _a;
    return (item === null || item === void 0 ? void 0 : item.contentStatus) || ((_a = item === null || item === void 0 ? void 0 : item.sourceJSON) === null || _a === void 0 ? void 0 : _a.contentStatus);
}
function isOrgAuthoritative(item) {
    return getContentStatus(item) === "org_authoritative";
}
function isPublicAuthoritative(item) {
    return getContentStatus(item) === "public_authoritative";
}
function getBadges(item, portal, user) {
    var _a, _b, _c, _d, _e, _f, _g;
    const badges = [];
    const groupDesignations = (_b = (item.groupDesignations || ((_a = item.sourceJSON) === null || _a === void 0 ? void 0 : _a.groupDesignations))) === null || _b === void 0 ? void 0 : _b.split(", ");
    if (isOrgAuthoritative(item) || isPublicAuthoritative(item)) {
        badges.push("Authoritative");
    }
    if (getContentStatus(item) === "deprecated") {
        badges.push("Deprecated");
    }
    if (item.type === "Solution" && ((_c = item.typeKeywords) === null || _c === void 0 ? void 0 : _c.includes("ArcGIS Solution"))) {
        badges.push("Solution");
    }
    if (((_d = item.typeKeywords) === null || _d === void 0 ? void 0 : _d.includes("Public Data Collection")) && user) {
        badges.push("Public Data Collection");
    }
    if (isRetiredItemType(item.type) || isRetiredStoryMap(item) || isRetiredApp(item)) {
        badges.push("Retired");
    }
    if (groupDesignations === null || groupDesignations === void 0 ? void 0 : groupDesignations.includes("livingatlas")) {
        badges.push("Living Atlas");
    }
    if (groupDesignations && groupDesignations.includes("opendata")) {
        badges.push("Open Data");
    }
    if ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.b)(item)) {
        badges.push("Premium");
    }
    if ((0,_item_3535552d_js__WEBPACK_IMPORTED_MODULE_0__.a)(item)) {
        badges.push("Subscriber");
    }
    if (item.origin || ((_e = item.sourceJSON) === null || _e === void 0 ? void 0 : _e.origin)) {
        badges.push("Collaboration");
    }
    if ((item.listed || ((_f = item.sourceJSON) === null || _f === void 0 ? void 0 : _f.listed)) && !(portal === null || portal === void 0 ? void 0 : portal.isPortal)) {
        badges.push("Marketplace");
    }
    if (((_g = item.typeKeywords) === null || _g === void 0 ? void 0 : _g.includes("Registered App")) &&
        item.type !== "API Key" &&
        (!(portal === null || portal === void 0 ? void 0 : portal.isPortal) || item.owner !== "esri_apps")) {
        badges.push("Registered");
    }
    return badges;
}
async function getTooltip(badgeType, item, user, i18n, locale) {
    var _a, _b;
    const publicUser = !user || (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_1__.a)(user);
    switch (badgeType) {
        case "Authoritative":
            if (getContentStatus(item) === "public_authoritative") {
                const verified = await (0,_user_0fa9ff5a_js__WEBPACK_IMPORTED_MODULE_3__.b)(item, locale);
                const name = ((_a = item.portal) === null || _a === void 0 ? void 0 : _a.isPortal) ? (_b = item.portal) === null || _b === void 0 ? void 0 : _b.name : verified === null || verified === void 0 ? void 0 : verified.name;
                return i18n.Authoritative.tooltip.public.replace("${name}", name);
            }
            else {
                return i18n.Authoritative.tooltip.org;
            }
        case "Retired":
            const retired = i18n.Retired.tooltip;
            if (isRetiredStoryMap(item)) {
                return retired.storyMap;
            }
            else if (isCityEngineWebScene(item)) {
                return retired.cityEngine;
            }
            else if (isRetiredApp(item)) {
                return retired.app;
            }
            else {
                return retired.general;
            }
        case "Subscriber":
            return publicUser ? i18n.Subscriber.tooltip.public : i18n.Subscriber.tooltip.org;
        case "Premium":
            return publicUser ? i18n.Premium.tooltip.public : i18n.Premium.tooltip.org;
        case "Registered":
            return i18n.Registered.tooltip;
        default:
            return i18n[badgeType].tooltip;
    }
}



//# sourceMappingURL=badges-555e1b90.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-9f0f37ee.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLivingAtlasCategories),
/* harmony export */   b: () => (/* binding */ fetchGroupCategories),
/* harmony export */   f: () => (/* binding */ fetchCategories),
/* harmony export */   g: () => (/* binding */ getItemCategorySchema),
/* harmony export */   u: () => (/* binding */ updateCategories)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./group-6a6303b0.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/group-6a6303b0.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





const getItemCategorySchema = async ({ portal, user, group, useCache = false }) => {
    var _a;
    try {
        const fetchResult = await (group
            ? fetchGroupCategories(group.id, portal, useCache)
            : fetchCategories(portal, user, useCache));
        return { result: (_a = fetchResult === null || fetchResult === void 0 ? void 0 : fetchResult.categorySchema) !== null && _a !== void 0 ? _a : null };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
};
async function fetchCategories(portal, user, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    user !== null && user !== void 0 ? user : (user = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user);
    if (!(portal === null || portal === void 0 ? void 0 : portal.id) || (user && (0,_privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_3__.a)(user))) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}portals/${portal.id}/categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", portal.id) : getSchema();
}
async function fetchGroupCategories(groupId, portal, useCache = true) {
    portal !== null && portal !== void 0 ? portal : (portal = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.portal);
    if (!groupId || !portal) {
        return null;
    }
    const getSchema = () => (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${(0,_group_6a6303b0_js__WEBPACK_IMPORTED_MODULE_2__.g)(portal, { id: groupId })}categorySchema`);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", groupId) : getSchema();
}
async function fetchLivingAtlasSchema(portal, categoryName) {
    var _a;
    const base = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal);
    const self = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}portals/self`);
    const groupSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}community/groups?q=${self.contentCategorySetsGroupQuery}`);
    const categoryGroup = (_a = groupSearch === null || groupSearch === void 0 ? void 0 : groupSearch.results) === null || _a === void 0 ? void 0 : _a[0];
    const schemaItemSearch = await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/groups/${categoryGroup.id}/search`, {
        q: `typekeywords: ${categoryName}`
    });
    const schemaItem = schemaItemSearch.results[0];
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(`${base}content/items/${schemaItem.id}/data`);
}
async function fetchLivingAtlasCategories(portal, categoryName, useCache = true) {
    const getSchema = () => fetchLivingAtlasSchema(portal, categoryName);
    return useCache ? (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.f)(getSchema, "categorySchema", categoryName) : getSchema();
}
async function updateCategories({ categories, itemIds, portal }) {
    try {
        const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}/content/updateItems`;
        const items = JSON.stringify(itemIds.map((id) => {
            return {
                [id]: { categories: Array.isArray(categories) ? categories : categories[id] }
            };
        }));
        return { result: await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, { items }, {}, "post") };
    }
    catch (error) {
        console.error(error);
        return { error: { code: "unhandledError" } };
    }
}



//# sourceMappingURL=categories-9f0f37ee.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/categories-ca134005.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CATEGORY_BASE_PATH),
/* harmony export */   U: () => (/* binding */ UPPER_CATEGORY_BASE_PATH),
/* harmony export */   a: () => (/* binding */ getCategoryUIPath),
/* harmony export */   g: () => (/* binding */ getRootCategoryPath)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const CATEGORY_BASE_PATH = "/categories";
const UPPER_CATEGORY_BASE_PATH = "/Categories";

// TODO: add unit tests
/**
 * Construct the path of the category based on the parent path and the category title
 */
const getCategoryUIPath = (parentPath, category, lowerCase = true) => {
    const basePath = parentPath !== null && parentPath !== void 0 ? parentPath : "";
    return `${basePath}${basePath.endsWith("/") ? "" : "/"}${lowerCase ? category.title.toLocaleLowerCase() : category.title}`;
};
/**
 * Find the root node title to use for categories
 */
function getRootCategoryPath(categories) {
    var _a;
    let categoryTitle = (_a = categories === null || categories === void 0 ? void 0 : categories[0]) === null || _a === void 0 ? void 0 : _a.title;
    if (categoryTitle && categoryTitle.charAt(0) !== "/") {
        categoryTitle = `/${categoryTitle}`;
    }
    return categoryTitle || UPPER_CATEGORY_BASE_PATH;
}



//# sourceMappingURL=categories-ca134005.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js":
/*!**********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js ***!
  \**********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ sanitizeFileName),
/* harmony export */   f: () => (/* binding */ formatFileSize),
/* harmony export */   g: () => (/* binding */ getItemInfoByType),
/* harmony export */   s: () => (/* binding */ sanitizeFileInput),
/* harmony export */   v: () => (/* binding */ validateOverwriteFileName)
/* harmony export */ });
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



function sanitizeFileName(name, addGUID) {
    //TODO: add new param to spec file.
    const expression = /(?:\.([^.]+))?$/;
    const invalidTitleCharacters = /\.|-/g;
    let fileName = name.replace(/^.*(\\|\/|:)/, "");
    let extension = (fileName && expression.exec(fileName)[1] ? expression.exec(fileName)[1].toLowerCase() : "");
    let title = "";
    if (fileName.indexOf(".rft.") > -1) {
        const [name, suffix] = fileName.split(".rft.");
        extension = `rft.${suffix}`;
        title = name;
    }
    if (fileName && !title) {
        title = fileName.lastIndexOf(".") === -1 ? fileName : fileName.substring(0, fileName.lastIndexOf("."));
    }
    // Replace any invalid characters with an underscore
    title = title.replace(invalidTitleCharacters, "_");
    // Allow file upload of existing item's file name // currently used in append
    if (addGUID) {
        title = makeUniqueFileName(title);
        fileName = `${title}.${extension}`;
    }
    return { title, fileName, extension };
}
// Helper method that takes in a file & returns the cleaned up file name as is and in title form, and the detected file extension
function sanitizeFileInput(file, addGUID) {
    return sanitizeFileName(file.name, !!addGUID);
}
function makeUniqueFileName(name) {
    return `${name}_${(0,_guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_1__.g)()}`;
}
function validateOverwriteFileName(uploadedFileName, sourceFileName) {
    let fileName = uploadedFileName;
    const position = uploadedFileName.lastIndexOf("\\");
    if (position > -1) {
        fileName = fileName.substring(position + 1, fileName.length);
    }
    return fileName.replace(/\ /g, "_") === sourceFileName.replace(/\ /g, "_");
}
function getItemInfoByType(type) {
    if (_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[type]) {
        return _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[type];
    }
    else {
        return _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[Object.keys(_item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a).find((fileType) => _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_0__.a[fileType].type === type)];
    }
}
function formatFileSize(size) {
    if (!size) {
        return "0 B";
    }
    const i = Math.floor(Math.log(size) / Math.log(1024));
    const adjustedSize = Math.round(size / Math.pow(1024, i));
    const unit = ["B", "KB", "MB", "GB", "TB"][i];
    return `${adjustedSize} ${unit}`;
}



//# sourceMappingURL=file-bf8ab90f.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js":
/*!**************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/services-5925c4b4.js ***!
  \**************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ fetchLayer),
/* harmony export */   f: () => (/* binding */ fetchFeatureServiceInfo),
/* harmony export */   s: () => (/* binding */ setMatched)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function parseSublayer(sublayer, layers, isTable) {
    var _a, _b;
    return {
        description: sublayer.description,
        fieldAliases: (_a = sublayer.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
        fields: sublayer.fields,
        geometryType: isTable ? "table" : sublayer.geometryType,
        id: sublayer.id,
        title: sublayer.name,
        type: sublayer.type,
        matched: (_b = layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === sublayer.id)) === null || _b === void 0 ? void 0 : _b.matched
    };
}
function serverRequest(url, isSecure) {
    const { config } = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c;
    const hosted = (0,_url_35875a10_js__WEBPACK_IMPORTED_MODULE_2__.a)(url);
    const requestOptions = Object.assign(Object.assign({ useProxy: false, timeout: config.isMultiTenant === false ? 60000 : 5000, addSSL: hosted }, (isSecure ? {} : { addTokenManually: false })), { usePost: true, disableIdentityLookup: true });
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(url, {}, requestOptions, "post");
}
function getErrorCode(error) {
    var _a, _b;
    return (error === null || error === void 0 ? void 0 : error.code) || ((_b = (_a = error === null || error === void 0 ? void 0 : error.details) === null || _a === void 0 ? void 0 : _a.raw) === null || _b === void 0 ? void 0 : _b.code);
}
function serviceDoesNotExist(error) {
    const code = getErrorCode(error);
    return [404, 500].includes(code) || (error === null || error === void 0 ? void 0 : error.message) === "Invalid URL";
}
function shouldRetryWithToken(isSecure, error) {
    const code = getErrorCode(error);
    return !isSecure && ((code === 499 && (error === null || error === void 0 ? void 0 : error.message) === "Token Required") || code === 403) && !!_config_75adf962_js__WEBPACK_IMPORTED_MODULE_1__.c.user;
}
async function fetchLayer(portal, id, url, isSecure) {
    const errorResult = { error: { code: "unhandledError" } };
    try {
        try {
            const result = await serverRequest(`${url}/${id}`, isSecure);
            return { result };
        }
        catch (error) {
            if (shouldRetryWithToken(isSecure, error)) {
                return fetchLayer(portal, id, url, true);
            }
            if (serviceDoesNotExist(error)) {
                errorResult.error.code = "serviceNotExist";
            }
            return errorResult;
        }
    }
    catch (error) {
        return errorResult;
    }
}
function filterLayers(layers, matchedLayers, data, isTable) {
    var _a, _b;
    const hasTables = data === null || data === void 0 ? void 0 : data.tables;
    const hasDefinedDataLayers = ((_a = data === null || data === void 0 ? void 0 : data.layers) === null || _a === void 0 ? void 0 : _a.length) > 0 || hasTables;
    const ids = [...((data === null || data === void 0 ? void 0 : data.layers) || []).map((layer) => layer.id), ...(_b = ((data === null || data === void 0 ? void 0 : data.tables) || [])) === null || _b === void 0 ? void 0 : _b.map((table) => table.id)];
    // if data has defined layers, only use layers in data, not the whole service (WebGIS/arcgis-portal-app#39768)
    // if data has defined layers, but no defined tables, allow all tables through (WebGIS/arcgis-portal-app#40067)
    const sublayers = (layers || [])
        .filter(({ id, type }) => !hasDefinedDataLayers || (type === "Table" && !hasTables) || ids.includes(id))
        .map((layer) => parseSublayer(layer, matchedLayers, isTable));
    return sublayers;
}
async function fetchLayers({ serviceInfo, item, layers, isSecure, data }) {
    var _a, _b;
    const { url } = item;
    if (!((_a = serviceInfo.layers) === null || _a === void 0 ? void 0 : _a.length) && !((_b = serviceInfo.tables) === null || _b === void 0 ? void 0 : _b.length) && (serviceInfo === null || serviceInfo === void 0 ? void 0 : serviceInfo.fields)) {
        return { result: [parseSublayer(serviceInfo, layers)] };
    }
    try {
        const { layers: sublayers, tables } = await serverRequest(`${url}/layers`, isSecure);
        return {
            result: [...filterLayers(sublayers, layers, data), ...filterLayers(tables, layers, data, true)].sort((a, b) => a.id - b.id)
        };
    }
    catch (error) {
        return { error: { code: "unhandledError" } };
    }
}
function setMatched(sublayers, matchedLayers) {
    return sublayers.map((sublayer) => {
        var _a;
        return Object.assign(Object.assign({}, sublayer), { matched: (_a = matchedLayers === null || matchedLayers === void 0 ? void 0 : matchedLayers.find((layer) => layer.id === sublayer.id)) === null || _a === void 0 ? void 0 : _a.matched });
    });
}
async function fetchFeatureServiceInfo({ item, portal, layers, isSecure, data, retry }) {
    var _a;
    const errorResult = { error: { code: "unhandledError" } };
    try {
        if (!data && !retry) {
            try {
                const token = (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.e)(portal);
                const tokenParam = token ? `&token=${token}` : "";
                const url = `${(0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.g)(portal)}content/items/${item.id}/data?f=json${tokenParam}`;
                // Use fetch instead of request to stop redirects (WebGIS/arcgis-portal-app#40164)
                const response = await fetch(url);
                const text = await response.text();
                if (text) {
                    data = JSON.parse(text);
                }
                if (data === null || data === void 0 ? void 0 : data.error) {
                    // Treat this expired account as if the service doesn't exist (WebGIS/arcgis-portal-app#40163)
                    if (data.error.code === 403 && ((_a = data.error) === null || _a === void 0 ? void 0 : _a.messageCode) === "SB_0006") {
                        errorResult.error.code = "serviceNotExist";
                        return errorResult;
                    }
                }
            }
            catch (error) {
                // if we can't get item data, just move on
                data = null;
            }
        }
        if (item.type === "Feature Collection") {
            if (data === null || data === void 0 ? void 0 : data.layers) {
                return {
                    result: data.layers.map(({ layerDefinition }, id) => {
                        var _a;
                        return ({
                            description: "",
                            fields: layerDefinition.fields,
                            fieldAliases: (_a = layerDefinition.fields) === null || _a === void 0 ? void 0 : _a.map((field) => field.alias),
                            geometryType: layerDefinition.geometryType,
                            type: layerDefinition.type,
                            id,
                            matched: false,
                            title: layerDefinition.name
                        });
                    })
                };
            }
        }
        try {
            const { url } = item;
            const serviceInfo = await serverRequest(url, isSecure);
            return fetchLayers({
                serviceInfo,
                item,
                layers,
                isSecure,
                data
            });
        }
        catch (error) {
            if (shouldRetryWithToken(isSecure, error)) {
                return fetchFeatureServiceInfo({ item, portal, layers, data, isSecure: true });
            }
            if (serviceDoesNotExist(error)) {
                errorResult.error.code = "serviceNotExist";
            }
            return errorResult;
        }
    }
    catch (error) {
        return errorResult;
    }
}



//# sourceMappingURL=services-5925c4b4.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-7fa26472.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ onItemBrowserSortChange),
/* harmony export */   b: () => (/* binding */ onItemBrowserPreviewChange),
/* harmony export */   c: () => (/* binding */ onItemBrowserViewChange),
/* harmony export */   g: () => (/* binding */ getItemBrowserStore),
/* harmony export */   o: () => (/* binding */ onItemBrowserBucketChange)
/* harmony export */ });
/* harmony import */ var _store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./store-8b1b0846.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-8b1b0846.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


function getItemBrowserStore(el) {
    return (0,_store_8b1b0846_js__WEBPACK_IMPORTED_MODULE_0__.g)(el, "arcgis-item-browser");
}
const onItemBrowserViewChange = (store, callback) => {
    store.onChange("view", (newView) => {
        callback(newView);
    });
};
const onItemBrowserBucketChange = (store, callback) => {
    store.onChange("bucket", (newBucket) => {
        callback(newBucket);
    });
};
const onItemBrowserPreviewChange = (store, callback) => {
    store.onChange("preview", (preview) => {
        callback(preview);
    });
};
const onItemBrowserSortChange = (store, callback) => {
    store.onChange("sort", (sort) => {
        callback(sort);
    });
};



//# sourceMappingURL=store-7fa26472.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-7546439f.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/type-to-icon-7546439f.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ featureLayerIconInfo),
/* harmony export */   e: () => (/* binding */ esriGeometryIcons),
/* harmony export */   f: () => (/* binding */ fieldTypeIcons)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const featureLayerIconInfo = {
    point: "point",
    line: "line",
    polygon: "polygon",
    multipatch: "cube",
    table: "table",
    multipoint: "layer-points"
};
const esriGeometryIcons = {
    esriGeometryPoint: "point",
    esriGeometryPolyline: "line",
    esriGeometryPolygon: "polygon",
    esriGeometryMultiPatch: "cube",
    esriGeometryMultipoint: "point",
    none: "table"
};
const fieldTypeIcons = {
    esriFieldTypeOID: "key",
    esriFieldTypeBoolean: "boolean",
    esriFieldTypeString: "string",
    esriFieldTypeSingle: "number",
    esriFieldTypeDouble: "number",
    esriFieldTypeInteger: "integer",
    esriFieldTypeSmallInteger: "integer",
    esriFieldTypeGlobalID: "key",
    esriFieldTypeDate: "date-time",
    esriFieldTypeBigInteger: "integer",
    esriFieldTypeDateOnly: "calendar",
    esriFieldTypeTimeOnly: "clock",
    esriFieldTypeTimestampOffset: "time-zone"
};



//# sourceMappingURL=type-to-icon-7546439f.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-aa26c49f.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/utils-aa26c49f.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getSublayerTypeInfo)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
/** Get the correct geometry icon based on layer/table type and geometry type
 * will handles types used by the jsapi, the esri types used on the server,
 * and the types returned by the Search API
 */
function getSublayerTypeInfo({ geometry, type }) {
    switch (type) {
        case "Catalog Layer":
            return {
                icon: "catalog-dataset",
                type: "catalog",
                isGeometry: false
            };
        case "Parcel Layer":
            return {
                icon: "parcel-layer",
                type: "parcel",
                isGeometry: false
            };
        case "Oriented Imagery Layer":
            return {
                icon: "oriented-imagery-layer",
                type: "oriented imagery",
                isGeometry: false
            };
        case "Table":
            return {
                icon: "table",
                type: "table",
                isGeometry: true
            };
    }
    switch (geometry) {
        case "point":
        case "esriGeometryPoint":
            return {
                type: "point",
                icon: "point",
                isGeometry: true
            };
        case "esriGeometryMultipoint":
        case "multipoint":
            return {
                type: "multipoint",
                icon: "layer-points",
                isGeometry: true
            };
        case "line":
        case "polyline":
        case "esriGeometryPolyline":
            return {
                type: "line",
                icon: "line",
                isGeometry: true
            };
        case "polygon":
        case "esriGeometryPolygon":
            return {
                type: "polygon",
                icon: "polygon",
                isGeometry: true
            };
        case "multipatch":
        case "esriGeometryMultiPatch":
            return {
                type: "multipatch",
                icon: "cube",
                isGeometry: true
            };
        default:
            return {
                type: "table",
                icon: "table",
                isGeometry: true
            };
    }
}



//# sourceMappingURL=utils-aa26c49f.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWZjYjZhNi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzRIO0FBQ3JFO0FBQ3NCO0FBQzBDO0FBQ2pDO0FBQ2tCO0FBQ2tCO0FBQzJLO0FBQ3pHO0FBQ047QUFDM0g7QUFDMEI7QUFDYztBQUNaO0FBQzREO0FBQ3ZCO0FBQzNCO0FBQ1Y7QUFDd0Q7QUFDUDtBQUMzRTtBQUNJO0FBQ1I7QUFDb0I7QUFDakI7QUFDRztBQUNFO0FBQ0Y7QUFDTztBQUNUO0FBQzlCO0FBQ0Y7QUFDQztBQUNGO0FBQ0Q7QUFDUTtBQUNQO0FBQ1c7QUFDUDtBQUNOO0FBQ1E7QUFDQTtBQUNMO0FBQ0Q7QUFDRztBQUNKOztBQUUzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBcUQ7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDhCQUE4QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLCtCQUErQjtBQUNyRCw2REFBNkQsOEJBQThCO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLCtCQUErQjtBQUN2RCxnRUFBZ0UsOEJBQThCO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0Es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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVvQzs7QUFFcEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaXRlbS1icm93c2VyXzMxLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2JhZGdlcy01NTVlMWI5MC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9jYXRlZ29yaWVzLTlmMGYzN2VlLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2NhdGVnb3JpZXMtY2ExMzQwMDUuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vZmlsZS1iZjhhYjkwZi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zZXJ2aWNlcy01OTI1YzRiNC5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9zdG9yZS03ZmEyNjQ3Mi5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS90eXBlLXRvLWljb24tNzU0NjQzOWYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vdXRpbHMtYWEyNmM0OWYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBGIGFzIEZyYWdtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlLCBvIGFzIG9uQ29uZmlnQ2hhbmdlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnksIHMgYXMgc2FuaXRpemVIVE1MLCBkIGFzIGRlY29kZUhUTUxFbnRpdGllcyB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCB7IGQgYXMgZGVib3VuY2UsIHQgYXMgdGltZW91dCwgbSBhcyBtaW5EZWxheSB9IGZyb20gJy4vZnVuY3Rpb25hbC00NGRlOGZjZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MsIGEgYXMgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgYiBhcyBicmVha3BvaW50cywgcyBhcyBzZXR1cFJlc2l6ZU9ic2VydmVyLCBEIGFzIERST1BET1dOX0lDT05fRElTUExBWV9DVVRPRkZfU0laRSB9IGZyb20gJy4vcmVzaXplLWExN2I3MjkyLmpzJztcbmltcG9ydCB7IGQgYXMgZGVmYXVsdEdlb21ldHJpZXMsIHEgYXMgcXVlcnlJdGVtcywgaSBhcyBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUsIGMgYXMgY2xlYW5GaWx0ZXJzLCBhIGFzIGdldFRhZ3MsIGIgYXMgZ2V0SGlnaGxpZ2h0cywgZSBhcyBnZXRQcm92aXNpb25lZExpc3RpbmdzLCBmIGFzIGdldERlZmF1bHRUaHVtYm5haWwsIGggYXMgZ2V0QWRqdXN0ZWRUaHVtYm5haWwsIGogYXMgaXNCbGFua0ltYWdlLCBrIGFzIGZldGNoUHJldmlld0l0ZW0gfSBmcm9tICcuL3RodW1ibmFpbC1iY2I4OWU2OS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEl0ZW1Ccm93c2VyU3RvcmUsIG8gYXMgb25JdGVtQnJvd3NlckJ1Y2tldENoYW5nZSwgYSBhcyBvbkl0ZW1Ccm93c2VyU29ydENoYW5nZSwgYiBhcyBvbkl0ZW1Ccm93c2VyUHJldmlld0NoYW5nZSwgYyBhcyBvbkl0ZW1Ccm93c2VyVmlld0NoYW5nZSB9IGZyb20gJy4vc3RvcmUtN2ZhMjY0NzIuanMnO1xuaW1wb3J0IHsgYSBhcyBpc1B1YmxpY1VzZXIsIGIgYXMgaXNPcmdBZG1pbiwgZSBhcyBjYW5VcGRhdGVPcmdHcm91cHMsIGYgYXMgY2FuVXBkYXRlSXRlbUNhdGVnb3JpZXMsIGQgYXMgaXNDdXN0b21Sb2xlLCBnIGFzIGNhbk1hbmFnZUNvbGxhYm9yYXRpb25zIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCB7IGogYXMgZ2V0UG9ydGFsU2V0dGluZ3MgfSBmcm9tICcuL2FwaS0yZTNhMTM2Zi5qcyc7XG5pbXBvcnQgeyBsIGFzIGNhbkNyZWF0ZUl0ZW1zLCBuIGFzIGNhblJlY2VpdmVJdGVtcyB9IGZyb20gJy4vcHJpdmlsZWdlcy03NDYzOWRhZS5qcyc7XG5pbXBvcnQgeyBhIGFzIGZvcm1hdERhdGUsIGYgYXMgZm9ybWF0TnVtYmVyLCBiIGFzIGZvcm1hdFBsdXJhbCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hGZWF0dXJlU2VydmljZUluZm8sIGEgYXMgZmV0Y2hMYXllciB9IGZyb20gJy4vc2VydmljZXMtNTkyNWM0YjQuanMnO1xuaW1wb3J0IHsgZiBhcyBmcm9tQ2FjaGUsIGMgYXMgY2xlYXJDYWNoZSwgbyBhcyBpbkNhY2hlLCBzIGFzIGdldFBvcnRhbFJlc3RCYXNlVXJsLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBhIGFzIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzLCBiIGFzIGZldGNoR3JvdXBDYXRlZ29yaWVzLCBmIGFzIGZldGNoQ2F0ZWdvcmllcyB9IGZyb20gJy4vY2F0ZWdvcmllcy05ZjBmMzdlZS5qcyc7XG5pbXBvcnQgeyBVIGFzIFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSCwgYSBhcyBnZXRDYXRlZ29yeVVJUGF0aCB9IGZyb20gJy4vY2F0ZWdvcmllcy1jYTEzNDAwNS5qcyc7XG5pbXBvcnQgeyBiIGFzIG9uR3JvdXBJZENoYW5nZSwgYSBhcyBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUgfSBmcm9tICcuL3N0b3JlLThiMWIwODQ2LmpzJztcbmltcG9ydCB7IGYgYXMgZmV0Y2hHcm91cCwgYSBhcyBpdGVtVHlwZU5hbWVzLCBkIGFzIGRlZmF1bHRJdGVtVHlwZXMsIGcgYXMgZ2V0SXRlbVR5cGVPcHRpb24sIGkgYXMgaXRlbVR5cGVPcHRpb25zIH0gZnJvbSAnLi9pdGVtcy1hNGY1ZTk4Yi5qcyc7XG5pbXBvcnQgeyBmIGFzIGZldGNoVXNlciwgYyBhcyBjcmVhdGVGb2xkZXIsIHUgYXMgdXBkYXRlRm9sZGVyLCBnIGFzIGdldEZvbGRlcnMsIGQgYXMgZ2V0U2lnbmVkSW5Vc2Vyc0dyb3VwcyB9IGZyb20gJy4vdXNlci0zZWE2OWMzYS5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBpIGFzIGlzRXNyaVdvcmxkR2VvY29kZXIgfSBmcm9tICcuL2dlb2NvZGUtNjRlMGIwZDMuanMnO1xuaW1wb3J0IHsgZiBhcyBmb3JtYXRGaWxlU2l6ZSB9IGZyb20gJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldENvbnRlbnRTdGF0dXMsIGEgYXMgZ2V0QmFkZ2VzIH0gZnJvbSAnLi9iYWRnZXMtNTU1ZTFiOTAuanMnO1xuaW1wb3J0IHsgYSBhcyBmZXRjaEl0ZW1Vc2VySW5mbyB9IGZyb20gJy4vdXNlci0wZmE5ZmY1YS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFN1YmxheWVyVHlwZUluZm8gfSBmcm9tICcuL3V0aWxzLWFhMjZjNDlmLmpzJztcbmltcG9ydCB7IGYgYXMgZmllbGRUeXBlSWNvbnMgfSBmcm9tICcuL3R5cGUtdG8taWNvbi03NTQ2NDM5Zi5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldERlZmF1bHRTb3J0T3JkZXIgfSBmcm9tICcuL3V0aWxzLTJmNDU5ZDZkLmpzJztcbmltcG9ydCB7IEQgYXMgREFZU19JTl9SRUNZQ0xFX0JJTiB9IGZyb20gJy4vZGVsZXRlLWl0ZW1zLTMyZDI0NTM0LmpzJztcbmltcG9ydCB7IHIgYXMgcmVtb3ZlVHJhaWxpbmdTbGFzaCB9IGZyb20gJy4vdXJsLTM1ODc1YTEwLmpzJztcbmltcG9ydCAnLi9zZXJ2aWNlLThjMmM0MjQxLmpzJztcbmltcG9ydCAnLi9xdWVyeS1kNjI2NjBkNC5qcyc7XG5pbXBvcnQgJy4vc3RyaW5nLTU4YTVmZWYzLmpzJztcbmltcG9ydCAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcbmltcG9ydCAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCAnLi9pdGVtLXByb3BlcnRpZXMtMTA0OTFiMmUuanMnO1xuaW1wb3J0ICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCAnLi91aS1iY2E3YmNkMS5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25hbC04MTM3M2Y2ZC5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgJy4vZ3JvdXAtNmE2MzAzYjAuanMnO1xuaW1wb3J0ICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuaW1wb3J0ICcuL3N0b3JhZ2UtMDM1M2E3NjkuanMnO1xuaW1wb3J0ICcuL2Fncy1lYjQ1OGEwMy5qcyc7XG5cbmZ1bmN0aW9uIGdldFNlYXJjaFN1YmxheWVySWNvbihnZW8pIHtcbiAgICBjb25zdCBsb29rdXAgPSB7XG4gICAgICAgIHBvaW50OiBcInBvaW50XCIsXG4gICAgICAgIHBvbHlsaW5lOiBcImxpbmVcIixcbiAgICAgICAgcG9seWdvbjogXCJwb2x5Z29uXCIsXG4gICAgICAgIG5vbnNwYXRpYWw6IFwidGFibGVcIixcbiAgICAgICAgbXVsdGlwb2ludDogXCJsYXllci1wb2ludHNcIlxuICAgIH07XG4gICAgcmV0dXJuIGxvb2t1cFtnZW9dIHx8IFwidGFibGVcIjtcbn1cbmNvbnN0IGdlb21ldHJ5VHlwZUxvb2t1cCA9IHtcbiAgICBlc3JpR2VvbWV0cnlQb2ludDogXCJwb2ludFwiLFxuICAgIGVzcmlHZW9tZXRyeVBvbHlsaW5lOiBcInBvbHlsaW5lXCIsXG4gICAgZXNyaUdlb21ldHJ5UG9seWdvbjogXCJwb2x5Z29uXCIsXG4gICAgZXNyaUdlb21ldHJ5TXVsdGlwb2ludDogXCJtdWx0aXBvaW50XCIsXG4gICAgbm9uZTogXCJub25zcGF0aWFsXCIsXG4gICAgdGFibGU6IFwibm9uc3BhdGlhbFwiXG59O1xuLyogQ29udmVydCBhIHJlYWwgZmVhdHVyZSBsYXllciB0byB0aGUgc2VhcmNoIHJlc3VsdCBpbmRleCdzIGZvcm0gKiovXG5mdW5jdGlvbiBnZXRTZWFyY2hSZXN1bHRTdWJsYXllcihzdWJsYXllcikge1xuICAgIGNvbnN0IHsgZGVzY3JpcHRpb24sIGdlb21ldHJ5VHlwZSwgZmllbGRBbGlhc2VzLCB0aXRsZSwgaWQgfSA9IHN1YmxheWVyO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBmaWVsZEFsaWFzZXM6IEFycmF5LmlzQXJyYXkoZmllbGRBbGlhc2VzKSA/IGZpZWxkQWxpYXNlcy5qb2luKFwiLFwiKSA6IGZpZWxkQWxpYXNlcyxcbiAgICAgICAgZ2VvbWV0cnlUeXBlOiBnZW9tZXRyeVR5cGVMb29rdXBbZ2VvbWV0cnlUeXBlXSB8fCBcIm5vbnNwYXRpYWxcIixcbiAgICAgICAgaWQsXG4gICAgICAgIHRpdGxlXG4gICAgfTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBpdGVtcyBhcmUgYmVpbmcgc3RvcmVkIHdpdGggc3VibGF5ZXJzXG4gKi9cbmZ1bmN0aW9uIGlzU3VibGF5ZXIoc2VsZWN0ZWRJdGVtKSB7XG4gICAgY29uc3QgZW50cnkgPSBzZWxlY3RlZEl0ZW07XG4gICAgcmV0dXJuICEhKGVudHJ5Lml0ZW0gJiYgZW50cnkuc3VibGF5ZXIpO1xufVxuLyoqXG4gKiBHaXZlbiBhIHNlbGVjdGVkIGl0ZW0gZW50cnkgYW5kIGFuIGl0ZW0gKyBzdWJsYXllcixcbiAqIGRldGVybWluZSBpZiB0aGV5IHJlcHJlc2VudCB0aGUgc2FtZSBlbnRpdHlcbiAqL1xuZnVuY3Rpb24gaXNTYW1lSXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW0gfSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKGlzU3VibGF5ZXIoc2VsZWN0ZWRJdGVtKSAmJiBzdWJsYXllcikge1xuICAgICAgICByZXR1cm4gKGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5pZCkgPT09ICgoX2EgPSBzZWxlY3RlZEl0ZW0uaXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkKSAmJiBzdWJsYXllci5pZCA9PT0gKChfYiA9IHNlbGVjdGVkSXRlbS5zdWJsYXllcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmlkKSA9PT0gc2VsZWN0ZWRJdGVtLmlkO1xuICAgIH1cbn1cbi8qKlxuICogQ2hlY2sgaWYgYW4gaXRlbSBpcyBwcmVzZW50IGluIGEgc2V0IG9mIHNlbGVjdGVkIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGlzU2VsZWN0ZWQoeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtcyB9KSB7XG4gICAgcmV0dXJuIHNlbGVjdGVkSXRlbXMuc29tZSgoc2VsZWN0ZWRJdGVtKSA9PiBpc1NhbWVJdGVtKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbSB9KSk7XG59XG4vKipcbiAqIEZpbHRlciBvdXQgYW4gaXRlbSBmcm9tIGEgc2V0IG9mIHNlbGVjdGVkIGl0ZW1zXG4gKi9cbmZ1bmN0aW9uIGRlc2VsZWN0SXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW1zIH0pIHtcbiAgICByZXR1cm4gc2VsZWN0ZWRJdGVtcy5maWx0ZXIoKHNlbGVjdGVkSXRlbSkgPT4gIWlzU2FtZUl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtIH0pKTtcbn1cbi8qKlxuICogQWRkIGFuIGVsZW1lbnQgdG8gdGhlIHNlbGVjdGVkSXRlbXMgYXJyYXlcbiAqL1xuZnVuY3Rpb24gc2VsZWN0SXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW1zIH0pIHtcbiAgICAvLyBhc3N1bWUgdGhhdCBpZiB0aGVyZSBpcyBhIHN1YmxheWVyIHdlIHNob3VsZCBiZSBzdG9yaW5nIGluIHRoYXQgZm9ybVxuICAgIGNvbnN0IGVudHJ5ID0gc3VibGF5ZXIgPyB7IGl0ZW0sIHN1YmxheWVyIH0gOiBpdGVtO1xuICAgIGlmICghaXNTZWxlY3RlZCh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW1zIH0pKSB7XG4gICAgICAgIHJldHVybiBbLi4uc2VsZWN0ZWRJdGVtcywgZW50cnldO1xuICAgIH1cbiAgICByZXR1cm4gWy4uLnNlbGVjdGVkSXRlbXNdO1xufVxuLyoqXG4gKiBGaW5kIGFsbCBzZWxlY3RlZCBzdWJsYXllcnMgZm9yIGEgZ2l2ZW4gaXRlbVxuICovXG5mdW5jdGlvbiBmaW5kU2VsZWN0ZWRTdWJsYXllcnMoeyBpdGVtLCBzZWxlY3RlZEl0ZW1zIH0pIHtcbiAgICByZXR1cm4gc2VsZWN0ZWRJdGVtcy5maWx0ZXIoKHNlbGVjdGVkSXRlbSkgPT4geyB2YXIgX2E7IHJldHVybiAoKF9hID0gc2VsZWN0ZWRJdGVtLml0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgPT09IChpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uaWQpOyB9KTtcbn1cblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJDc3MgPSBcIjpob3N0e3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6ZmxleDtoZWlnaHQ6MTAwJTttaW4taGVpZ2h0OjEwMCU7d2lkdGg6MTAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3cteTphdXRvO292ZXJmbG93LXg6aGlkZGVuO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKTstLWl0ZW0tYnJvd3Nlci1tYXgtd2lkdGg6MTAwJTstLWl0ZW0tYnJvd3Nlci1wYW5lLXdpZHRoOjE4Ljc1cmVtOy0taXRlbS1icm93c2VyLXBhbmUtei1pbmRleDoxMTstLWl0ZW0tYnJvd3Nlci10b3AtYmFyLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfTpob3N0KFtoZWlnaHQ9YXV0b10pe2Rpc3BsYXk6ZmxleDtoZWlnaHQ6YXV0bztmbGV4LWRpcmVjdGlvbjpjb2x1bW59YXJjZ2lzLWJyb3dzZXJ7LS1hcmNnaXMtYnJvd3Nlci1tYXgtd2lkdGg6dmFyKC0taXRlbS1icm93c2VyLW1heC13aWR0aCk7LS1hcmNnaXMtYnJvd3Nlci1wYW5lLXdpZHRoOnZhcigtLWl0ZW0tYnJvd3Nlci1wYW5lLXdpZHRoKTstLWFyY2dpcy1icm93c2VyLXBhbmUtei1pbmRleDp2YXIoLS1pdGVtLWJyb3dzZXItcGFuZS16LWluZGV4KTstLWFyY2dpcy1icm93c2VyLXRvcC1iYXItYmFja2dyb3VuZDp2YXIoLS1pdGVtLWJyb3dzZXItdG9wLWJhci1iYWNrZ3JvdW5kKX0uY29udGVudC0tcGFkZGVkLWJvdHRvbXtwYWRkaW5nLWJvdHRvbToxLjVyZW19QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjQwcHgpezpob3N0ey0taXRlbS1icm93c2VyLXBhbmUtd2lkdGg6MTAwJX19XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclVwZGF0ZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJVcGRhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJMb2FkaW5nID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckxvYWRpbmdcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTZWxlY3QgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyU2VsZWN0XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclN1YmxheWVyUHJldmlld1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvblwiLCA3KTtcbiAgICAgICAgdGhpcy5saXZlUmVnaW9uVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJsaXZlUmVnaW9uVXBkYXRlXCIsIDcpO1xuICAgICAgICB0aGlzLmFsbG93RmV0Y2ggPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jdXJyZW50UmVzdWx0cyA9IFtdO1xuICAgICAgICB0aGlzLnVwZGF0ZUZpbHRlcnNFbXB0eSA9ICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0VtcHR5ID0gISgoX2EgPSB0aGlzLmVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihgW3Nsb3Q9XCJmaWx0ZXJzXCJdYCkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZVRvcGJhckVtcHR5ID0gKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS50b3BiYXJFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwidG9wLWJhclwiXWApKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVTb3J0RW1wdHkgPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnNvcnRFbXB0eSA9ICEoKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYFtzbG90PVwic29ydFwiXWApKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5maWx0ZXJNdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkpO1xuICAgICAgICB0aGlzLnRvcGJhck11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcih0aGlzLnVwZGF0ZVRvcGJhckVtcHR5KTtcbiAgICAgICAgdGhpcy5zb3J0TXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHRoaXMudXBkYXRlU29ydEVtcHR5KTtcbiAgICAgICAgdGhpcy5mZXRjaEl0ZW1zID0gZGVib3VuY2UoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyTG9hZGluZy5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZXN1bHRzID0gW107XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCF0aGlzLnBvcnRhbCB8fCAhdGhpcy5hbGxvd0ZldGNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHF1ZXJ5ID0gdGhpcy5nZXRRdWVyeSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJlZmxpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcXVlcnkgPSBhd2FpdCB0aGlzLnByZWZsaWdodChxdWVyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IHJlc3BvbnNlLCBlcnJvciB9ID0gYXdhaXQgbWluRGVsYXkodGhpcy5xdWVyeUl0ZW1zKHF1ZXJ5KSwgNTAwKTtcbiAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBtb3JlIGVycm9yIGNhc2VzIGhlcmUuXG4gICAgICAgICAgICAvLyBmb3Igbm93IHRoaXMgaXMgYSBuby1vcCBmb3IgdGhlIHJlY3ljbGUgYmluIGNhc2UuXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyVXBkYXRlLmVtaXQoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlc3BvbnNlKSwgeyBzZWxlY3RlZEl0ZW1zOiB0aGlzLnNlbGVjdGVkSXRlbXMsIGZpbHRlcnM6IGNsZWFuRmlsdGVycyhPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMpLCB0aGlzLmJ1Y2tldCksIHNlYXJjaFRlcm06IHRoaXMuc2VhcmNoVGVybSwgcmVjeWNsZUJpbjogdGhpcy5zdG9yZS5zdGF0ZS5yZWN5Y2xlQmluIH0pLCB0aGlzLnNvcnQpKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZXN1bHRzID0gcmVzcG9uc2UucmVzdWx0cztcbiAgICAgICAgICAgIC8vIGFkZCBhbGwgdGFncyBmcm9tIHRoZSBpdGVtcyB0byB0aGUgdGFncyBwaWNrZXIuXG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmtub3duVGFncyA9IGdldFRhZ3MocmVzcG9uc2UsIHRoaXMuc3RvcmUuc3RhdGUua25vd25UYWdzLCAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudGFncyk7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmhpZ2hsaWdodHMgPSBnZXRIaWdobGlnaHRzKHJlc3BvbnNlLCBjb25maWdTdGF0ZS5jb25maWcpO1xuICAgICAgICAgICAgYXdhaXQgdGltZW91dCgxMDApO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0sIDE1MCk7XG4gICAgICAgIHRoaXMucmVzaXplID0gKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5lbC5jbGllbnRXaWR0aCB8fCAoKF9hID0gdGhpcy5lbC5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xpZW50V2lkdGgpIHx8IDA7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmVsLmNsaWVudEhlaWdodCB8fCAoKF9iID0gdGhpcy5lbC5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xpZW50SGVpZ2h0KSB8fCAwO1xuICAgICAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gd2lkdGggPiBicmVha3BvaW50cy5zbSA/IFwibGFyZ2VcIiA6IFwic21hbGxcIjtcbiAgICAgICAgICAgIGNvbnN0IG9sZEZvcm1GYWN0b3IgPSB0aGlzLnN0b3JlLnN0YXRlLndpZHRoID4gYnJlYWtwb2ludHMuc20gPyBcImxhcmdlXCIgOiBcInNtYWxsXCI7XG4gICAgICAgICAgICAvKiogd2hlbiBnb2luZyBmcm9tIGxhcmdlIHRvIHNtYWxsIG9yIHNtYWxsIHRvIGxhcmdlLCBjb2xsYXBzZSBvciBleHBhbmQgZmlsdGVycywgYWNjb3JkaW5nbHkgKi9cbiAgICAgICAgICAgIGlmIChvbGRGb3JtRmFjdG9yID09PSBcImxhcmdlXCIgJiYgdGhpcy5mb3JtRmFjdG9yID09PSBcInNtYWxsXCIpIHtcbiAgICAgICAgICAgICAgICAvKiogdXNlIHBhbmVsIGxheW91dCBpZiBlbmFibGVkIG9uIHNtYWxsZXIgaXRlbSBicm93c2VycyAqL1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUucGFuZWwgPSB0aGlzLnVzZVBhbmVsTGF5b3V0O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob2xkRm9ybUZhY3RvciA9PT0gXCJzbWFsbFwiICYmIHRoaXMuZm9ybUZhY3RvciA9PT0gXCJsYXJnZVwiKSB7XG4gICAgICAgICAgICAgICAgLyoqIHBhbmVsIGxheW91dCB3b24ndCB3b3JrIG9uIGxhcmdlciBpdGVtIGJyb3dzZXJzICovXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wYW5lbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSA9IChzZWxlY3RlZEl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVzaW5nU3VibGF5ZXJzID0gaXNTdWJsYXllcihzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHVzaW5nU3VibGF5ZXJzID8gc2VsZWN0ZWRJdGVtLml0ZW0gOiBzZWxlY3RlZEl0ZW07XG4gICAgICAgICAgICBjb25zdCBzdWJsYXllciA9IHVzaW5nU3VibGF5ZXJzID8gc2VsZWN0ZWRJdGVtLnN1YmxheWVyIDogbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdXNpbmdTdWJsYXllcnMgPyBzdWJsYXllci50aXRsZSA6IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc2VsZWN0ZWQtaXRlbVwiLCB7IGhlYWRpbmc6IGl0ZW0udGl0bGUsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwgb25BcmNnaXNTZWxlY3RlZEl0ZW1SZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gZGVzZWxlY3RJdGVtKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbXM6IHRoaXMuc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICAgICAgICAgICAgfSB9LCB1c2luZ1N1YmxheWVycyA/IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGljb246IGdldFNlYXJjaFN1YmxheWVySWNvbihzZWxlY3RlZEl0ZW0uc3VibGF5ZXIuZ2VvbWV0cnlUeXBlKSwgc2NhbGU6IFwic1wiIH0pKSA6IChoKFwiYXJjZ2lzLWl0ZW0tdHlwZVwiLCB7IHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBpdGVtOiBpdGVtLCBwb3J0YWw6IHRoaXMucG9ydGFsLCBzY2FsZTogXCJzXCIsIHNob3dUZXh0OiBmYWxzZSB9KSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uSW5mbyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyTGljZW5zZWRJdGVtcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb25maWcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXBJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBcIm5vbmVcIjtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuYWxsb3dlZEdlb21ldHJpZXMgPSBbLi4uZGVmYXVsdEdlb21ldHJpZXNdO1xuICAgICAgICB0aGlzLmFsbG93ZWRTdWJzY3JpcHRpb25Db250ZW50VHlwZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmlldyA9IFwibGlzdFwiO1xuICAgICAgICB0aGlzLmJ1Y2tldCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5udW0gPSAyMDtcbiAgICAgICAgdGhpcy5xID0gXCJcIjtcbiAgICAgICAgdGhpcy5maWx0ZXIgPSBcIlwiO1xuICAgICAgICB0aGlzLmhlaWdodCA9IFwiZnVsbFwiO1xuICAgICAgICB0aGlzLnByZWZsaWdodCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5mZXRjaCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93RmllbGRTdGF0aXN0aWNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBjcmVhdGVTdG9yZSh7IGZpbHRlcnM6IHt9IH0pO1xuICAgICAgICB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhpZGVDb250ZW50VG9wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29udGVudFBhZGRlZEJvdHRvbSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnVzZVBhbmVsTGF5b3V0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYmFzZVVybHMgPSB7fTtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gXCJcIjtcbiAgICAgICAgdGhpcy5zb3J0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBhZ2UgPSB7IG51bTogdGhpcy5udW0sIHN0YXJ0OiAxLCBuZXh0U3RhcnQ6IC0xIH07XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZm9ybUZhY3RvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wcmV2aWV3SXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jdXJyZW50UmVzcG9uc2UgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKiBNYW51YWxseSB0cmlnZ2VyIGEgZmV0Y2ggb2YgbmV3IHJlc3VsdHMgKi9cbiAgICBhc3luYyByZWZyZXNoKCkge1xuICAgICAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgZWwsIGdyb3VwSWQsIHZpZXcsIGJ1Y2tldCwgYWxsb3dlZEdlb21ldHJpZXMsIHNlbGVjdGVkSXRlbXMsIHNob3dGaWVsZFN0YXRpc3RpY3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGxvY2FsZSA9IGF3YWl0IGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVbMF07XG4gICAgICAgIGlmIChidWNrZXQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0ID0gYnVja2V0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZ3JvdXBJZCA9IGdyb3VwSWQ7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuaTE4biA9IGxvY2FsZVswXTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5sYW5nID0gbG9jYWxlWzFdO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnZpZXcgPSB2aWV3O1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW1zO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmFsbG93ZWRHZW9tZXRyaWVzID0gYWxsb3dlZEdlb21ldHJpZXM7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuc2hvd0ZpZWxkU3RhdGlzdGljcyA9IHNob3dGaWVsZFN0YXRpc3RpY3M7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuaW50ZXJhY3Rpb24gPSBcImtleWJvYXJkXCI7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbmZpZygpO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLndpZHRoID0gNDIwO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJzbWFsbFwiO1xuICAgICAgICB0aGlzLmZpbHRlck11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlbCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XG4gICAgICAgIHRoaXMudG9wYmFyTXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGVsLCB7IGNoaWxkTGlzdDogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5zb3J0TXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGVsLCB7IGNoaWxkTGlzdDogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJzRW1wdHkoKTtcbiAgICAgICAgdGhpcy51cGRhdGVUb3BiYXJFbXB0eSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZVNvcnRFbXB0eSgpO1xuICAgICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgICAgICB0aGlzLnJlc2l6ZUhhbmRsZXIgPSAoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZXNpemUpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLnJlc2l6ZUhhbmRsZXIpO1xuICAgICAgICBpZiAodGhpcy51c2VQYW5lbExheW91dCB8fCBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkodGhpcy5lbCwgXCJjYWxjaXRlLXNoZWxsLXBhbmVsXCIpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnBhbmVsID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5zdG9yZS5zdGF0ZS5yZXNpemVPYnNlcnZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVub2JzZXJ2ZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5maWx0ZXJNdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhpcy50b3BiYXJNdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhpcy5zb3J0TXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuZmlsdGVyQ2xlYXJIYW5kbGVyKGZhbHNlKTtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5yZXNpemVIYW5kbGVyKTtcbiAgICB9XG4gICAgdXBkYXRlVXNlcihuZXdVc2VyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gY29uZmlnU3RhdGUudXNlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnVzZXIgPSBuZXdVc2VyKTtcbiAgICB9XG4gICAgdXBkYXRlVXNlckxpY2Vuc2VkSXRlbXMobGljZW5zZWRJdGVtcykge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLnVzZXJMaWNlbnNlZEl0ZW1zKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoY29uZmlnU3RhdGUudXNlckxpY2Vuc2VkSXRlbXMgPSBsaWNlbnNlZEl0ZW1zKTtcbiAgICB9XG4gICAgdXBkYXRlU3Vic2NyaXB0aW9uSW5mbyhzdWJzY3JpcHRpb25JbmZvKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gY29uZmlnU3RhdGUuc3Vic2NyaXB0aW9uSW5mbykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnN1YnNjcmlwdGlvbkluZm8gPSBzdWJzY3JpcHRpb25JbmZvKTtcbiAgICB9XG4gICAgdXBkYXRlUG9ydGFsKG5ld1BvcnRhbCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IG5ld1BvcnRhbCk7XG4gICAgfVxuICAgIHVwZGF0ZUFQSShuZXdWYWx1ZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLmFwaSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmFwaSA9IG5ld1ZhbHVlKTtcbiAgICB9XG4gICAgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZykge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmNvbmZpZyA9IG5ld0NvbmZpZyk7XG4gICAgfVxuICAgIHVwZGF0ZVNlbGVjdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9IG5ld1ZhbHVlO1xuICAgIH1cbiAgICB1cGRhdGVHcm91cElEKGlkKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZ3JvdXBJZCA9IGlkO1xuICAgIH1cbiAgICB1cGRhdGVTdWJsYXllclNlbGVjdGlvbkdlb21ldHJ5VHlwZXModHlwZXMpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5hbGxvd2VkR2VvbWV0cmllcyA9IHR5cGVzO1xuICAgIH1cbiAgICB1cGRhdGVTZWxlY3RlZEl0ZW1zKGl0ZW1zKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcyA9IGl0ZW1zO1xuICAgIH1cbiAgICB1cGRhdGVGaWVsZFN0YXRpc3RpY3ModmFsdWUpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5zaG93RmllbGRTdGF0aXN0aWNzID0gdmFsdWU7XG4gICAgfVxuICAgIHVwZGF0ZVZpZXcodmlldykge1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnZpZXcgPSB2aWV3O1xuICAgIH1cbiAgICB1cGRhdGVCdWNrZXQoYnVja2V0KSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQgPSBidWNrZXQ7XG4gICAgICAgIGNvbnN0IGlzTXlSZWN5Y2xlQmluID0gYnVja2V0ID09PSBcIm15XCIgJiYgKChfYiA9IChfYSA9IHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvbGRlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvbGRlcikgPT09IFwicmVjeWNsZVwiO1xuICAgICAgICBjb25zdCBpc09yZ1JlY3ljbGVCaW4gPSBidWNrZXQgPT09IFwib3JnXCIgJiYgKChfZCA9IChfYyA9IHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNvbnRlbnRUeXBlKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuY29udGVudFR5cGUpID09PSBcInJlY3ljbGVcIjtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5yZWN5Y2xlQmluID0gaXNNeVJlY3ljbGVCaW4gfHwgaXNPcmdSZWN5Y2xlQmluO1xuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICAgIHRoaXMuZmV0Y2hJdGVtcygpO1xuICAgIH1cbiAgICB1cGRhdGVRKCkge1xuICAgICAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgICAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplQ29uZmlnKCk7XG4gICAgICAgIC8vIGluaXRpYWxseSwgZmV0Y2ggaXMgbG9ja2VkXG4gICAgICAgIC8vIHdhaXQgZm9yIGFsbCBjb21wb25lbnRzIHRvIGVtaXQgZXZlbnRzIGltcGFjdGluZyBzdGF0ZSBwcmlvciB0byBpbml0aWFsIGZldGNoXG4gICAgICAgIGF3YWl0IHRpbWVvdXQoNDAwKTtcbiAgICAgICAgdGhpcy5hbGxvd0ZldGNoID0gdHJ1ZTtcbiAgICAgICAgaWYgKGNvbmZpZ1N0YXRlLnBvcnRhbCkge1xuICAgICAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplQ29uZmlnKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmaWx0ZXJIYW5kbGVyKGUpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgZmlsdGVycyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzKSwgeyBbZS5kZXRhaWwuaWRdOiBlLmRldGFpbCB9KTtcbiAgICAgICAgLy8gd2hlbiB3ZSBtb3ZlIHRvIHRoZSByZWN5Y2xlIGJpbiwgc2V0IGEgZmxhZyBpbiBzdGF0ZVxuICAgICAgICBpZiAoKChfYSA9IGUuZGV0YWlsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQpID09PSBcImZvbGRlclwiKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnJlY3ljbGVCaW4gPSBlLmRldGFpbC5mb2xkZXIgPT09IFwicmVjeWNsZVwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoKF9iID0gZS5kZXRhaWwpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZCkgPT09IFwiY29udGVudFR5cGVcIikge1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5yZWN5Y2xlQmluID1cbiAgICAgICAgICAgICAgICBlLmRldGFpbC5jb250ZW50VHlwZSA9PT0gXCJyZWN5Y2xlXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVtb3ZlIGZpbHRlciBmcm9tIHNldFxuICAgICAgICBpZiAoIWUuZGV0YWlsLnZhbHVlKSB7XG4gICAgICAgICAgICBkZWxldGUgZmlsdGVyc1tlLmRldGFpbC5pZF07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzID0gZmlsdGVycztcbiAgICAgICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgfVxuICAgIGZpbHRlclJlbW92ZUhhbmRsZXIoZSkge1xuICAgICAgICBpZiAoIWUuZGV0YWlsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsdGVycyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycyk7XG4gICAgICAgIGRlbGV0ZSBmaWx0ZXJzW2UuZGV0YWlsXTtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzID0gZmlsdGVycztcbiAgICAgICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgfVxuICAgIGZpbHRlckNsZWFySGFuZGxlcihkb0ZldGNoSXRlbXMgPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IG5ld0ZpbHRlcnMgPSB7fTtcbiAgICAgICAgY29uc3QgZmlsdGVycyA9IHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycztcbiAgICAgICAgLy8gcHJlc2VydmUgZmlsdGVycyB3ZSBkb24ndCBzaG93IGluIHRoZSBmaWx0ZXIgY2hpcCBzZXRcbiAgICAgICAgaWYgKHRoaXMuYnVja2V0ID09PSBcIm15XCIgJiYgKGZpbHRlcnMgPT09IG51bGwgfHwgZmlsdGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsdGVycy5mb2xkZXIpKSB7XG4gICAgICAgICAgICBuZXdGaWx0ZXJzLmZvbGRlciA9IGZpbHRlcnMuZm9sZGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJ1Y2tldCA9PT0gXCJncm91cFwiICYmIChmaWx0ZXJzID09PSBudWxsIHx8IGZpbHRlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbHRlcnMuZ3JvdXApKSB7XG4gICAgICAgICAgICBuZXdGaWx0ZXJzLmdyb3VwID0gZmlsdGVycy5ncm91cDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmZpbHRlcnMgPSBuZXdGaWx0ZXJzO1xuICAgICAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgICAgICBkb0ZldGNoSXRlbXMgJiYgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgfVxuICAgIGdlbmVyaWNGaWx0ZXJDbGVhckhhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMuZmlsdGVyQ2xlYXJIYW5kbGVyKCk7XG4gICAgfVxuICAgIHNlYXJjaEhhbmRsZXIoZSkge1xuICAgICAgICBjb25zdCBuZXdUZXJtID0gZS5kZXRhaWw7XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IG5ld1Rlcm07XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIGlmIChuZXdUZXJtKSB7XG4gICAgICAgICAgICB0aGlzLmZldGNoSXRlbXMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hJdGVtcy5pbnZva2UoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBidWNrZXRIYW5kbGVyKGUpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQgPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5idWNrZXQgPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5yZWN5Y2xlQmluID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMuZmV0Y2hJdGVtcygpO1xuICAgIH1cbiAgICBzb3J0SGFuZGxlcihlKSB7XG4gICAgICAgIHRoaXMuc29ydCA9IGUuZGV0YWlsO1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnNvcnQgPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5mZXRjaEl0ZW1zKCk7XG4gICAgfVxuICAgIHZpZXdIYW5kbGVyKGUpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gZS5kZXRhaWw7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUudmlldyA9IGUuZGV0YWlsO1xuICAgIH1cbiAgICBhc3luYyBwYWdlSGFuZGxlcihlKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5wYWdlID0gZS5kZXRhaWw7XG4gICAgICAgIGlmICh0aGlzLmFsbG93RmV0Y2gpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZmV0Y2hJdGVtcygpO1xuICAgICAgICAgICAgYXdhaXQgdGltZW91dCg0MDApO1xuICAgICAgICAgICAgKF9hID0gdGhpcy5lbC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCIuc2Nyb2xsaW5nXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2Nyb2xsVG8oeyBiZWhhdmlvcjogXCJzbW9vdGhcIiwgdG9wOiAwIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbGVjdEhhbmRsZXIoZSkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gdGhpcy5zZWxlY3RlZEl0ZW1zO1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkLCBpdGVtLCBzdWJsYXllciB9ID0gZS5kZXRhaWw7XG4gICAgICAgIHN3aXRjaCAodGhpcy5zZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgXCJzaW5nbGVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJzaW5nbGUtc3VibGF5ZXJcIjpcbiAgICAgICAgICAgICAgICAvLyBieSBwYXNzaW5nIGFuIGVtcHR5IGFycmF5IGZvciBzZWxlY3RlZCBpdGVtcyB3ZSBlbnN1cmUgb25seSB0aGUgY3VycmVudCBpdGVtIGlzIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gc2VsZWN0SXRlbSh7IGl0ZW0sIHN1YmxheWVyLCBzZWxlY3RlZEl0ZW1zOiBbXSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtdWx0aXBsZVwiOlxuICAgICAgICAgICAgY2FzZSBcIm11bHRpcGxlLXN1YmxheWVyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgPyBzZWxlY3RJdGVtKHsgaXRlbSwgc3VibGF5ZXIsIHNlbGVjdGVkSXRlbXMgfSlcbiAgICAgICAgICAgICAgICAgICAgOiBkZXNlbGVjdEl0ZW0oeyBpdGVtLCBzdWJsYXllciwgc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VsZWN0LmVtaXQodGhpcy5zZWxlY3RlZEl0ZW1zKTtcbiAgICB9XG4gICAgYXN5bmMgdG9nZ2xlUHJldmlldyh7IGRldGFpbCB9KSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVyc0V4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRvbid0IHNob3cgcHJldmlldyBmb3IgcmVjeWNsZSBiaW5cbiAgICAgICAgaWYgKHRoaXMuc3RvcmUuc3RhdGUucmVjeWNsZUJpbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGV0YWlsIHx8IHRoaXMuc3RvcmUuc3RhdGUucHJldmlldyA9PT0gZGV0YWlsLmlkKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3SXRlbSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldy5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVGb2N1c0VsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5wcmV2aWV3ID0gZGV0YWlsLmlkO1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3SXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIGRldGFpbCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUHJldmlldy5lbWl0KE9iamVjdC5hc3NpZ24oe30sIGRldGFpbCkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgICAgICAgYWN0aW9uOiB0aGlzLnByZXZpZXdJdGVtID8gXCJvcGVuIHBhbmVsXCIgOiBcImNsb3NlIHBhbmVsXCIsXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXJkIGFjdGlvblwiXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB0aWxlU2VsZWN0SGFuZGxlcihlKSB7XG4gICAgICAgIGNvbnN0IHsgaXRlbSB9ID0gZS5kZXRhaWw7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTZWxlY3QuZW1pdChbaXRlbV0pO1xuICAgIH1cbiAgICBjb2x1bW5VcGRhdGVIYW5kbGVyKGUpIHtcbiAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5jb2x1bW5zID0gZS5kZXRhaWw7XG4gICAgfVxuICAgIGhhbmRsZU1vdmUoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuaW50ZXJhY3Rpb24gPSBcIm1vdXNlXCI7XG4gICAgfVxuICAgIGhhbmRsZVRvdWNoKCkge1xuICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmludGVyYWN0aW9uID0gXCJ0b3VjaFwiO1xuICAgIH1cbiAgICBoYW5kbGVLZXkoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuaW50ZXJhY3Rpb24gPSBcImtleWJvYXJkXCI7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemVDb25maWcoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgKF9hID0gY29uZmlnU3RhdGUuYXBpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoY29uZmlnU3RhdGUuYXBpID0gdGhpcy5hcGkpO1xuICAgICAgICAoX2IgPSBjb25maWdTdGF0ZS51c2VyKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAoY29uZmlnU3RhdGUudXNlciA9IHRoaXMudXNlcik7XG4gICAgICAgIChfYyA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKGNvbmZpZ1N0YXRlLnBvcnRhbCA9IHRoaXMucG9ydGFsKTtcbiAgICAgICAgKF9kID0gY29uZmlnU3RhdGUuY29uZmlnKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAoY29uZmlnU3RhdGUuY29uZmlnID0gdGhpcy5jb25maWcpO1xuICAgIH1cbiAgICByZXNldFBhZ2luYXRpb24oKSB7XG4gICAgICAgIHRoaXMucGFnZS5zdGFydCA9IDE7XG4gICAgICAgIHRoaXMucGFnZS50b3RhbCA9IDA7XG4gICAgfVxuICAgIGdldFF1ZXJ5KCkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgZmlsdGVyczogdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzLCBzZWFyY2hUZXJtOiB0aGlzLnNlYXJjaFRlcm0sIGJhc2VRdWVyeTogdGhpcy5xLCBiYXNlRmlsdGVyOiB0aGlzLmZpbHRlciwgYnVja2V0OiB0aGlzLmJ1Y2tldCwgYWxsb3dlZEdlb21ldHJpZXM6IHRoaXMuYWxsb3dlZEdlb21ldHJpZXMgfSwgdGhpcy5zb3J0KSwgdGhpcy5wYWdlKTtcbiAgICB9XG4gICAgYXN5bmMgcXVlcnlJdGVtcyhxdWVyeSkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBsZXQgcmVzcG9uc2U7XG4gICAgICAgIGlmICh0aGlzLmZldGNoKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMuZmV0Y2gocXVlcnkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgeyBwb3J0YWwsIHVzZXIsIHN0b3JlLCBncm91cElkLCBjb25maWcgfSA9IHRoaXM7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgcXVlcnlJdGVtcyh7IHBvcnRhbCwgcXVlcnksIHVzZXIsIHN0b3JlLCBncm91cElkLCBjb25maWcgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBlcnJvciB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChhd2FpdCBpc1BvcnRhbFZpZXdpbmdBcmNHSVNPbmxpbmUodGhpcy5wb3J0YWwsIChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZS5idWNrZXQpKSB7XG4gICAgICAgICAgICAoX2IgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UucmVzdWx0cykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goKHsgaWQgfSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYmFzZVVybHNbaWRdID0gXCJhcmNnaXMuY29tXCI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyByZXNwb25zZSB9O1xuICAgIH1cbiAgICByZXN0b3JlRm9jdXMoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3RvcmVGb2N1c0VsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy5yZXN0b3JlRm9jdXNFbGVtZW50O1xuICAgICAgICAgICAgaWYgKGVsLnJlc3RvcmVGb2N1cykge1xuICAgICAgICAgICAgICAgIGVsLnJlc3RvcmVGb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZWwuc2V0Rm9jdXMpIHtcbiAgICAgICAgICAgICAgICBlbC5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZWwuZm9jdXMpIHtcbiAgICAgICAgICAgICAgICBlbC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlclNlbGVjdGVkKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICAgICAgY29uc3Qgd2hvbGVQYWdlU2VsZWN0ZWQgPSAoKF9hID0gdGhpcy5jdXJyZW50UmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgJiZcbiAgICAgICAgICAgICgoX2IgPSB0aGlzLmN1cnJlbnRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZXZlcnkoKGl0ZW0pID0+IGlzU2VsZWN0ZWQoeyBpdGVtLCBzZWxlY3RlZEl0ZW1zOiB0aGlzLnNlbGVjdGVkSXRlbXMgfSkpKTtcbiAgICAgICAgY29uc3QgdG90YWxTZWxlY3RlZEl0ZW1zID0gKF9jID0gdGhpcy5zZWxlY3RlZEl0ZW1zKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubGVuZ3RoO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc2VsZWN0ZWRcIiwgeyBzbG90OiBcInNlbGVjdGlvblwiLCBsb2FkaW5nOiB0aGlzLmxvYWRpbmcsIHRvdGFsOiAoX2QgPSB0aGlzLmN1cnJlbnRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QubGVuZ3RoLCB0b3RhbFNlbGVjdGVkOiAoX2UgPSB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5sZW5ndGgsIGhpZGVTZWxlY3RlZFRleHQ6IHRoaXMuc3RvcmUuc3RhdGUud2lkdGggPCBicmVha3BvaW50cy5zbSwgaGVhZGluZzogdGhpcy5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGUtc3VibGF5ZXJcIlxuICAgICAgICAgICAgICAgID8gdGhpcy5pMThuLml0ZW1Ccm93c2VyLnNlbGVjdGVkTGF5ZXJzXG4gICAgICAgICAgICAgICAgOiB0aGlzLmkxOG4uaXRlbUJyb3dzZXIuc2VsZWN0ZWRJdGVtcywgZW1wdHlUZXh0OiB0aGlzLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZS1zdWJsYXllclwiXG4gICAgICAgICAgICAgICAgPyB0aGlzLmkxOG4uaXRlbUJyb3dzZXIubm9TZWxlY3RlZExheWVyc1xuICAgICAgICAgICAgICAgIDogdGhpcy5pMThuLml0ZW1Ccm93c2VyLm5vU2VsZWN0ZWRJdGVtcywgY2hlY2tlZDogd2hvbGVQYWdlU2VsZWN0ZWQsIGluZGV0ZXJtaW5hdGU6ICF3aG9sZVBhZ2VTZWxlY3RlZCAmJiAhIXRvdGFsU2VsZWN0ZWRJdGVtcywgaGlkZUNoZWNrYm94OiB0aGlzLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZS1zdWJsYXllclwiLCBvbkFyY2dpc1NlbGVjdGVkRGVzZWxlY3RBbGw6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VsZWN0LmVtaXQodGhpcy5zZWxlY3RlZEl0ZW1zKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU2VsZWN0ZWRTZWxlY3RQYWdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW1zID0gWy4uLnRoaXMuc2VsZWN0ZWRJdGVtc107XG4gICAgICAgICAgICAgICAgKF9hID0gdGhpcy5jdXJyZW50UmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdEl0ZW0oeyBpdGVtLCBzZWxlY3RlZEl0ZW1zIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdGVkSXRlbXM7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlbGVjdC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICAgICAgICB9IH0sIChfZiA9IHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLm1hcCh0aGlzLnJlbmRlclNlbGVjdGVkSXRlbSkpKTtcbiAgICB9XG4gICAgcmVuZGVyU2xvdChuYW1lLCBkZWZhdWx0Q29udGVudCkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBuYW1lIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogbmFtZSB9LCBkZWZhdWx0Q29udGVudCkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHByZXZpZXdJdGVtLCBsb2FkaW5nLCBoaWRlQ29udGVudFRvcCwgaTE4biwgc2VsZWN0ZWRJdGVtcywgc2VsZWN0aW9uLCBjdXJyZW50UmVzcG9uc2UsIHN0b3JlLCBhcGksIHJlbmRlclNsb3QsIHNlYXJjaFRlcm0sIGZvcm1GYWN0b3IsIHZpZXcsIGhlaWdodCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3NlclwiLCB7IHByZXZpZXc6ICEhcHJldmlld0l0ZW0sIGxvYWRpbmc6IGxvYWRpbmcsIGhpZGVDb250ZW50VG9wOiBoaWRlQ29udGVudFRvcCwgc2VsZWN0ZWQ6IHNlbGVjdGVkSXRlbXMsIGFsd2F5c1Nob3dTZWxlY3Rpb246IHNlbGVjdGlvbiA9PT0gbnVsbCB8fCBzZWxlY3Rpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGlvbi5pbmNsdWRlcyhcIm11bHRpcGxlXCIpLCBhbHdheXNTaG93Q29udGVudDogdmlldyA9PT0gXCJ0YWJsZVwiLCByZXNwb25zZTogY3VycmVudFJlc3BvbnNlLCBzdG9yZTogc3RvcmUsIGFwaTogYXBpLCBmb3JtRmFjdG9yOiBmb3JtRmFjdG9yLCBzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBoZWlnaHQ6IGhlaWdodCB9LCByZW5kZXJTbG90KFwidG9wLWJhclwiKSwgcmVuZGVyU2xvdChcInZpZXdcIiksIHJlbmRlclNsb3QoXCJzb3J0XCIpLCBoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1wcmV2aWV3XCIsIHsgc2xvdDogXCJwcmV2aWV3XCIsIGl0ZW06IHRoaXMucHJldmlld0l0ZW0sIHBvcnRhbDogdGhpcy5wb3J0YWwsIHVzZXI6IHRoaXMudXNlciwga2V5OiB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcsIG9uQXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3Q2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLnByZXZpZXcgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmVGb2N1cygpO1xuICAgICAgICAgICAgfSwgb25BcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXI6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU3VibGF5ZXJQcmV2aWV3LmVtaXQoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfSwgaGlkZVByZXZpZXdGb290ZXJzOiB0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJzdW1tYXJ5LXRvcFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJwcmV2aWV3LXN1bW1hcnktdG9wXCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJmb290ZXJcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwicHJldmlldy1mb290ZXJcIiB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcInN1YmxheWVyLWZvb3RlclwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJzdWJsYXllci1wcmV2aWV3LWZvb3RlclwiIH0pKSksIHRoaXMucmVuZGVyU2VsZWN0ZWQoKSwgcmVuZGVyU2xvdChcImFjdGlvbnNcIiksIHJlbmRlclNsb3QoXCJjb250ZW50LXN0YXJ0XCIpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50XCIsIGNsYXNzOiB7IFwiY29udGVudC0tcGFkZGVkLWJvdHRvbVwiOiB0aGlzLmNvbnRlbnRQYWRkZWRCb3R0b20gfSB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiY29udGVudFwiIH0pKSwgcmVuZGVyU2xvdChcImNvbnRlbnQtZW5kXCIpLCByZW5kZXJTbG90KFwicGFnaW5hdGlvblwiKSwgcmVuZGVyU2xvdChcImZpbHRlcnNcIiksIHJlbmRlclNsb3QoXCJzY3JvbGwtZW5kXCIpLCByZW5kZXJTbG90KFwibm8tcmVzdWx0c1wiLCBpMThuLmNvbnRlbnQubm9SZXN1bHRzKSwgcmVuZGVyU2xvdChcIm5vLWNvbnRlbnRcIiwgaTE4bi5jb250ZW50Lm5vQ29udGVudCkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInVzZXJcIjogW1widXBkYXRlVXNlclwiXSxcbiAgICAgICAgXCJ1c2VyTGljZW5zZWRJdGVtc1wiOiBbXCJ1cGRhdGVVc2VyTGljZW5zZWRJdGVtc1wiXSxcbiAgICAgICAgXCJzdWJzY3JpcHRpb25JbmZvXCI6IFtcInVwZGF0ZVN1YnNjcmlwdGlvbkluZm9cIl0sXG4gICAgICAgIFwicG9ydGFsXCI6IFtcInVwZGF0ZVBvcnRhbFwiXSxcbiAgICAgICAgXCJhcGlcIjogW1widXBkYXRlQVBJXCJdLFxuICAgICAgICBcImNvbmZpZ1wiOiBbXCJ1cGRhdGVDb25maWdcIl0sXG4gICAgICAgIFwic2VsZWN0aW9uXCI6IFtcInVwZGF0ZVNlbGVjdGlvblwiXSxcbiAgICAgICAgXCJncm91cElkXCI6IFtcInVwZGF0ZUdyb3VwSURcIl0sXG4gICAgICAgIFwiYWxsb3dlZEdlb21ldHJpZXNcIjogW1widXBkYXRlU3VibGF5ZXJTZWxlY3Rpb25HZW9tZXRyeVR5cGVzXCJdLFxuICAgICAgICBcInNlbGVjdGVkSXRlbXNcIjogW1widXBkYXRlU2VsZWN0ZWRJdGVtc1wiXSxcbiAgICAgICAgXCJzaG93RmllbGRTdGF0aXN0aWNzXCI6IFtcInVwZGF0ZUZpZWxkU3RhdGlzdGljc1wiXSxcbiAgICAgICAgXCJ2aWV3XCI6IFtcInVwZGF0ZVZpZXdcIl0sXG4gICAgICAgIFwiYnVja2V0XCI6IFtcInVwZGF0ZUJ1Y2tldFwiXSxcbiAgICAgICAgXCJxXCI6IFtcInVwZGF0ZVFcIl0sXG4gICAgICAgIFwiZmlsdGVyXCI6IFtcInVwZGF0ZVFcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXIuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckNzcztcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gW107XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyLWFjdGlvbnNcIiwgeyBhY3Rpb25zOiB0aGlzLmFjdGlvbnMsIHNlbGVjdGlvbjogdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3RlZEl0ZW1zLCBzdG9yZTogdGhpcy5zdG9yZSB9KSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5mdW5jdGlvbiBjYW5WaWV3QUdPKHNldHRpbmdzLCBwb3J0YWwsIHVzZXIpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIGlmIChwb3J0YWwuaXNQb3J0YWwpIHtcbiAgICAgICAgcmV0dXJuIChfYiA9IChfYSA9IHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5wb3J0YWxDb25maWdQcm9wZXJ0aWVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2VhcmNoQXJjR0lTT25saW5lRW5hYmxlZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCF1c2VyIHx8IGlzT3JnQWRtaW4odXNlcikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiAoX2UgPSAoX2QgPSAoX2MgPSBwb3J0YWwuc291cmNlSlNPTikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNhblNlYXJjaFB1YmxpYykgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogcG9ydGFsLmNhblNlYXJjaFB1YmxpYykgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogdHJ1ZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFZhbGlkT3B0aW9ucyhwb3J0YWwsIHVzZXIsIG9wdGlvbnMpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICghcG9ydGFsKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBnZXRQb3J0YWxTZXR0aW5ncyhwb3J0YWwpO1xuICAgIGNvbnN0IHByb3Zpc2lvbmVkTGlzdGluZ3MgPSAoX2EgPSAoKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5pbmNsdWRlcyhcInN1YnNjcmlwdGlvbiBjb250ZW50XCIpKSAmJiBhd2FpdCBnZXRQcm92aXNpb25lZExpc3RpbmdzKHVzZXIsIHBvcnRhbCkpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXTtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gc2V0dGluZ3MgPT09IG51bGwgfHwgc2V0dGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNldHRpbmdzLnBvcnRhbENvbmZpZ1Byb3BlcnRpZXM7XG4gICAgY29uc3QgY2FuVmlld0xpdmluZ0F0bGFzID0gKF9iID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLnBvcnRhbExpdmluZ0F0bGFzQ29uZmlnRW5hYmxlZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogdHJ1ZTtcbiAgICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4ge1xuICAgICAgICAvLyBmb3IgcHVibGljIHBvcnRhbHMsIGFsbG93IGFub255bW91cyB1c2VycyB0byBzZWUgdGhlIHBvcnRhbCdzIHB1YmxpYyBjb250ZW50XG4gICAgICAgIGlmICghdXNlciAmJiBvcHRpb24gPT09IFwib3JnXCIpIHtcbiAgICAgICAgICAgIHJldHVybiAocG9ydGFsID09PSBudWxsIHx8IHBvcnRhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsLmFjY2VzcykgPT09IFwicHVibGljXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gYW5vbnltb3VzIHNob3VsZCBub3Qgc2VlIG15IGNvbnRlbnQgb3Igb3JnIGNvbnRlbnRcbiAgICAgICAgaWYgKCF1c2VyICYmIFtcIm15XCIsIFwiZmF2b3JpdGVzXCIsIFwiZ3JvdXBcIiwgXCJvcmdcIl0uaW5jbHVkZXMob3B0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVzZXJzIHdpdGhvdXQgY3JlYXRlL3JlY2VpdmUgaXRlbSBwcml2cyBjYW4ndCBoYXZlIG15IGNvbnRlbnQgKCM0Mzk4KVxuICAgICAgICBpZiAodXNlciAmJiAhKGNhbkNyZWF0ZUl0ZW1zKHVzZXIpIHx8IGNhblJlY2VpdmVJdGVtcyh1c2VyKSkgJiYgb3B0aW9uID09PSBcIm15XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBwdWJsaWMgdXNlcnMgc2hvdWxkIG5vdCBzZWUgb3JnIG9wdGlvblxuICAgICAgICBpZiAodXNlciAmJiBpc1B1YmxpY1VzZXIodXNlcikgJiYgb3B0aW9uID09PSBcIm9yZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbiA9PT0gXCJzdWJzY3JpcHRpb24gY29udGVudFwiICYmICghdXNlciB8fCAhKHByb3Zpc2lvbmVkTGlzdGluZ3MgPT09IG51bGwgfHwgcHJvdmlzaW9uZWRMaXN0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvdmlzaW9uZWRMaXN0aW5ncy5sZW5ndGgpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHBvcnRhbHMgY2FuIGNvbmZpZ3VyZSB3ZXRoZXIgdXNlcnMgc2hvdWxkIHNlZSBMQSBvciBBR08gIzM4MTdcbiAgICAgICAgaWYgKCghY2FuVmlld0xpdmluZ0F0bGFzICYmIChvcHRpb24gPT09IFwibGl2aW5nIGF0bGFzXCIgfHwgb3B0aW9uID09PSBcImxpdmluZyBhdGxhcyBhbmFseXNpc1wiKSkgfHxcbiAgICAgICAgICAgICghY2FuVmlld0FHTyhzZXR0aW5ncywgcG9ydGFsLCB1c2VyKSAmJiBvcHRpb24gPT09IFwiYWxsXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0Q3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrfS5sYXJnZXtib3JkZXItaW5saW5lLWVuZDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMyl9LmJ1dHRvbntwYWRkaW5nOjAuNXJlbTstLWNhbGNpdGUtZm9udC13ZWlnaHQtbm9ybWFsOjUwMH1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJCdWNrZXRTZWxlY3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckJ1Y2tldFNlbGVjdFwiLCA3KTtcbiAgICAgICAgdGhpcy5zZWxlY3RPcHRpb24gPSAob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmJ1Y2tldCA9IG9wdGlvbjtcbiAgICAgICAgICAgIC8vIGFzc3VtZSBpZiB0aGUgdXNlciBjbGlja2VkIGl0LCBpdCdzIHZhbGlkXG4gICAgICAgICAgICB0aGlzLnZhbGlkQnVja2V0ID0gb3B0aW9uO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckJ1Y2tldFNlbGVjdC5lbWl0KG9wdGlvbik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub3B0aW9uTGFiZWwgPSAob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBpZiAob3B0aW9uID09PSBcIm9yZ1wiICYmICFjb25maWdTdGF0ZS51c2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChfYSA9IGNvbmZpZ1N0YXRlLnBvcnRhbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuW29wdGlvbl07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IFtcbiAgICAgICAgICAgIFwibXlcIixcbiAgICAgICAgICAgIFwiZmF2b3JpdGVzXCIsXG4gICAgICAgICAgICBcImdyb3VwXCIsXG4gICAgICAgICAgICBcIm9yZ1wiLFxuICAgICAgICAgICAgXCJsaXZpbmcgYXRsYXNcIixcbiAgICAgICAgICAgIFwiYWxsXCJcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5idWNrZXQgPSBcIm15XCI7XG4gICAgICAgIHRoaXMudmFsaWRCdWNrZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmFsaWRPcHRpb25zID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB1cGRhdGVPcHRpb25zKG5ld09wdGlvbnMpIHtcbiAgICAgICAgdGhpcy51cGRhdGVWYWxpZE9wdGlvbnMobmV3T3B0aW9ucyk7XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZVZhbGlkT3B0aW9ucyhvcHRpb25zLCBmb3JjZUVtaXQpIHtcbiAgICAgICAgY29uc3Qgb2xkQnVja2V0ID0gdGhpcy52YWxpZEJ1Y2tldDtcbiAgICAgICAgY29uc3QgeyB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICB0aGlzLnZhbGlkT3B0aW9ucyA9IGF3YWl0IGdldFZhbGlkT3B0aW9ucyhwb3J0YWwsIHVzZXIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnZhbGlkQnVja2V0ID0gdGhpcy52YWxpZE9wdGlvbnMuaW5jbHVkZXModGhpcy5idWNrZXQpID8gdGhpcy5idWNrZXQgOiB0aGlzLnZhbGlkT3B0aW9uc1swXTtcbiAgICAgICAgLy8gaWYgd2UgaGFkIHRvIGNoYW5nZSB0aGUgYnVja2V0LCBlbWl0IGFuIGV2ZW50XG4gICAgICAgIGlmIChvbGRCdWNrZXQgIT09IHRoaXMudmFsaWRCdWNrZXQgfHwgZm9yY2VFbWl0KSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0LmVtaXQodGhpcy52YWxpZEJ1Y2tldCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uYnVja2V0U2VsZWN0O1xuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVZhbGlkT3B0aW9ucyh0aGlzLm9wdGlvbnMsIHRydWUpO1xuICAgICAgICBvbkNvbmZpZ0NoYW5nZShcInVzZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVWYWxpZE9wdGlvbnModGhpcy5vcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG9uQ29uZmlnQ2hhbmdlKFwicG9ydGFsXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmFsaWRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsaWRPcHRpb25zLCB2YWxpZEJ1Y2tldCwgc2VsZWN0T3B0aW9uLCBvcHRpb25MYWJlbCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIGxhcmdlOiB0aGlzLnN0b3JlLnN0YXRlLndpZHRoID49IGJyZWFrcG9pbnRzLnNtXG4gICAgICAgICAgICB9IH0sICh2YWxpZE9wdGlvbnMgPT09IG51bGwgfHwgdmFsaWRPcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2YWxpZE9wdGlvbnMubGVuZ3RoKSA+IDAgJiYgKGgoXCJjYWxjaXRlLWRyb3Bkb3duXCIsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1zdGFydFwiLCBzY2FsZTogXCJtXCIsIHdpZHRoU2NhbGU6IFwibVwiLCB0eXBlOiBcImNsaWNrXCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgY2xhc3M6IFwiYnV0dG9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIFwiaWNvbi1lbmRcIjogXCJjaGV2cm9uLWRvd25cIiwgc2xvdDogXCJ0cmlnZ2VyXCIgfSwgb3B0aW9uTGFiZWwodmFsaWRCdWNrZXQpKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiIH0sIHZhbGlkT3B0aW9ucy5tYXAoKG9wdGlvbikgPT4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBzZWxlY3RlZDogdmFsaWRCdWNrZXQgPT09IG9wdGlvbiwgb25DYWxjaXRlRHJvcGRvd25JdGVtU2VsZWN0OiAoKSA9PiBzZWxlY3RPcHRpb24ob3B0aW9uKSB9LCBvcHRpb25MYWJlbChvcHRpb24pKSkpKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJvcHRpb25zXCI6IFtcInVwZGF0ZU9wdGlvbnNcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJCdWNrZXRTZWxlY3Quc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckJ1Y2tldFNlbGVjdENzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJDYXJkQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrO21pbi13aWR0aDowcHh9Lml0ZW0tYnJvd3Nlci1jYXJke3Bvc2l0aW9uOnJlbGF0aXZlO2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtvcGFjaXR5OjA7LS10dy1zaGFkb3c6MCAwICMwMDAwOy0tdHctc2hhZG93LWNvbG9yZWQ6MCAwICMwMDAwO2JveC1zaGFkb3c6dmFyKC0tdHctcmluZy1vZmZzZXQtc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1yaW5nLXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctc2hhZG93KTt0cmFuc2l0aW9uLWR1cmF0aW9uOjE1MG1zO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7dHJhbnNpdGlvbi1wcm9wZXJ0eTpiYWNrZ3JvdW5kLWNvbG9yLCBvdXRsaW5lLCBvdXRsaW5lLW9mZnNldCwgb3BhY2l0eTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTMpfS5pdGVtLWJyb3dzZXItY2FyZDpmb2N1c3t6LWluZGV4OjEwO291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9Lml0ZW0tYnJvd3Nlci1jYXJkLS1sb2FkZWR7b3BhY2l0eToxfS5pdGVtLWJyb3dzZXItY2FyZC0tc2VsZWN0ZWR7Ym9yZGVyLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5pdGVtLWJyb3dzZXItY2FyZC0taG92ZXJhYmxle2N1cnNvcjpwb2ludGVyfS5pdGVtLWJyb3dzZXItY2FyZF9fdG9we3BhZGRpbmc6MXJlbX0uaXRlbS1icm93c2VyLWNhcmRfX2hvdmVyLXRleHR7cG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjt0ZXh0LWFsaWduOmNlbnRlcjtmb250LXNpemU6MXJlbTtmb250LXdlaWdodDo1MDA7b3BhY2l0eTowO3RyYW5zaXRpb246YWxsIHZhcigtLWNhbGNpdGUtYW5pbWF0aW9uLXRpbWluZykgZWFzZS1pbi1vdXQgMHMsIG91dGxpbmUgMHMsIG91dGxpbmUtb2Zmc2V0IDBzO2JhY2tncm91bmQtY29sb3I6cmdiYSgyMSwgMjEsIDIxLCAwLjcpO2NvbG9yOndoaXRlfS5pdGVtLWJyb3dzZXItY2FyZF9fdXBwZXJ7ZmxleDoxIDEgMCU7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHN9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlcjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCl9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlcjpob3ZlciAuaXRlbS1icm93c2VyLWNhcmRfX2hvdmVyLXRleHQsLml0ZW0tYnJvd3Nlci1jYXJkOmZvY3VzIC5pdGVtLWJyb3dzZXItY2FyZF9faG92ZXItdGV4dHtvcGFjaXR5OjF9Lml0ZW0tYnJvd3Nlci1jYXJkX191cHBlci0tbGlua3tjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTtvdXRsaW5lLWNvbG9yOnRyYW5zcGFyZW50fS5pdGVtLWJyb3dzZXItY2FyZF9fdXBwZXItLWxpbms6Zm9jdXN7ei1pbmRleDoxMDtvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9Lml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZV9fc3Bhbntwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmlubGluZTtib3JkZXItc3R5bGU6bm9uZTtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O3BhZGRpbmc6MHB4O3RyYW5zaXRpb246YWxsIHZhcigtLWNhbGNpdGUtYW5pbWF0aW9uLXRpbWluZykgZWFzZS1pbi1vdXQgMHMsIG91dGxpbmUgMHMsIG91dGxpbmUtb2Zmc2V0IDBzO2JhY2tncm91bmQtaW1hZ2U6bGluZWFyLWdyYWRpZW50KHRyYW5zcGFyZW50LCB0cmFuc3BhcmVudCk7YmFja2dyb3VuZC1wb3NpdGlvbi14OjAlLCAxMDAlO2JhY2tncm91bmQtcG9zaXRpb24teTptaW4oMS4yNWVtLCAxMDAlKTtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQsIG5vLXJlcGVhdDtiYWNrZ3JvdW5kLXNpemU6MTAwJSAxcHgsIDEwMCUgMXB4fS5pdGVtLWJyb3dzZXItY2FyZC0tcHJldmlld2VkIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGVfX3NwYW57YmFja2dyb3VuZC1pbWFnZTpsaW5lYXItZ3JhZGllbnQodmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpLCB2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMykpfS5pdGVtLWJyb3dzZXItY2FyZC0tcHJldmlld2Vke291dGxpbmU6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9Lml0ZW0tYnJvd3Nlci1jYXJkLS1wcmV2aWV3ZWQgLml0ZW0tYnJvd3Nlci1jYXJkX190b3B7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpfS5pdGVtLWJyb3dzZXItY2FyZF9fY29udGVudHtkaXNwbGF5OmZsZXg7bWluLXdpZHRoOjBweDtmbGV4OjEgMSAwJTtmbGV4LWRpcmVjdGlvbjpjb2x1bW59Lml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWxze21hcmdpbi10b3A6MC4yNXJlbTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93fS5pdGVtLWJyb3dzZXItY2FyZF9fZGV0YWlse2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMil9Lml0ZW0tYnJvd3Nlci1jYXJkX19jYWxlbmRhci1pY29ue2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKTttYXJnaW4taW5saW5lLWVuZDowLjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJ7bWFyZ2luLXRvcDphdXRvO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtO3BhZGRpbmctdG9wOjAuNXJlbTtwYWRkaW5nLWJvdHRvbTowLjVyZW07Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMyl9Lml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJfX3N0YXJ0e2Rpc3BsYXk6ZmxleDttaW4td2lkdGg6MHB4O2ZsZXg6MSAxIDAlO2ZsZXgtZGlyZWN0aW9uOnJvdzthbGlnbi1pdGVtczpjZW50ZXI7b3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1pbmxpbmUtZW5kOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJfX3N0YXJ0LS1vd25lcnttYXJnaW4taW5saW5lLXN0YXJ0Oi0wLjI1cmVtfS5pdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyLWRpdmlkZXJ7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci1pbnB1dCk7bWFyZ2luLWlubGluZS1zdGFydDowLjc1cmVtO21hcmdpbi1pbmxpbmUtZW5kOjAuNXJlbTtkaXNwbGF5OmlubGluZS1ibG9jaztoZWlnaHQ6MS41cmVtO3dpZHRoOjBweH0uaXRlbS1icm93c2VyLWNhcmRfX2Zvb3Rlci1kaXZpZGVyLS1saXN0e21hcmdpbi1sZWZ0OjFyZW07bWFyZ2luLXJpZ2h0OjFyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19wcm9maWxlLXdyYXB7Ym94LXNpemluZzpib3JkZXItYm94O21heC13aWR0aDoxMDAlO3BhZGRpbmc6MC4yNXJlbX0uaXRlbS1icm93c2VyLWNhcmRfX3N1bW1hcnl7bWFyZ2luOjBweDtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW07Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpfS5pdGVtLWJyb3dzZXItY2FyZF9fZGl2aWRlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXg6MCAwIGF1dG99Lml0ZW0tYnJvd3Nlci1jYXJkX19kaXZpZGVyOm5vdChbZW1wdHldKTpiZWZvcmV7Y29udGVudDpcXFwiXFxcIjtoZWlnaHQ6MS4yNXJlbTt3aWR0aDoxcHg7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xKTttYXJnaW4taW5saW5lOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19kaXZpZGVyOmZpcnN0LWNoaWxkOmJlZm9yZXtkaXNwbGF5Om5vbmV9Lml0ZW0tYnJvd3Nlci1jYXJkLWZsZXh7ZGlzcGxheTpmbGV4fS5pdGVtLWJyb3dzZXItY2FyZC1mbGV4LTF7bWluLXdpZHRoOjBweDtmbGV4OjEgMSAwJX0uc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9Lml0ZW0tYnJvd3Nlci1jYXJkX19pbnB1dHttYXJnaW4taW5saW5lLWVuZDoxcmVtO21hcmdpbi10b3A6MC4xMjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19pbnB1dC0tZW5ke21hcmdpbi1pbmxpbmUtZW5kOjBweDttYXJnaW4taW5saW5lLXN0YXJ0OjFyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZXttYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7cGFkZGluZy10b3A6MHB4O3BhZGRpbmctYm90dG9tOjBweDtmb250LXNpemU6MS4xMjVyZW07Zm9udC13ZWlnaHQ6NTAwO2xpbmUtaGVpZ2h0OjEuMzc1fS5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGUtLWdyaWR7Zm9udC1zaXplOjFyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZS0tcGFkZGVke21hcmdpbi1ib3R0b206MC41cmVtfS5pdGVtLWJyb3dzZXItY2FyZF9fc25pcHBldHttYXJnaW46MHB4O21hcmdpbi1ib3R0b206MC43NXJlbTtmbGV4OjEgMSAwJTtwYWRkaW5nOjBweDtmb250LXNpemU6MC44NzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX19iYWRnZXMtLXN0YWNrZWR7bWFyZ2luLXRvcDowLjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWx7bWFyZ2luOjBweDtib3gtc2l6aW5nOmNvbnRlbnQtYm94O3dpZHRoOjhyZW07cGFkZGluZzowcHg7cGFkZGluZy1pbmxpbmUtc3RhcnQ6MnJlbTtmbGV4OjAgMCBhdXRvfS5pdGVtLWJyb3dzZXItY2FyZF9fdGh1bWJuYWlsLS1ncmlke3Bvc2l0aW9uOnJlbGF0aXZlO21hcmdpbjowcHg7d2lkdGg6MTAwJTtwYWRkaW5nOjBweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMil9Lml0ZW0tYnJvd3Nlci1jYXJkX19vd25lcnttaW4td2lkdGg6MHB4fS5pdGVtLWJyb3dzZXItY2FyZC0tcGFuZWx7bWFyZ2luLWJvdHRvbTowcHg7Y3Vyc29yOnBvaW50ZXI7ZGlzcGxheTpibG9jazt3aWR0aDoxMDAlfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX190b3AsLml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX190b3B7cGFkZGluZzowLjc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZS0tcGFkZGVkLC5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGUtLXBhZGRlZHttYXJnaW4tYm90dG9tOjAuMjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14cyAuaXRlbS1icm93c2VyLWNhcmRfX2Zvb3RlciwuaXRlbS1icm93c2VyLWNhcmQtLXh4cyAuaXRlbS1icm93c2VyLWNhcmRfX2Zvb3RlcntwYWRkaW5nLXRvcDowLjI1cmVtO3BhZGRpbmctYm90dG9tOjAuMjVyZW07cGFkZGluZy1sZWZ0OjAuNzVyZW07cGFkZGluZy1yaWdodDowLjc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHMgLml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWwsLml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX19kZXRhaWx7Zm9udC1zaXplOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14cyAuaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlLC5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGV7Zm9udC1zaXplOjAuODc1cmVtfS5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fdGl0bGV7Zm9udC1zaXplOjAuNzVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14eHMgLml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWx7cGFkZGluZy1pbmxpbmUtc3RhcnQ6MC43NXJlbTt3aWR0aDo1NXB4fS5pdGVtLWJyb3dzZXItY2FyZC0teHhzIC5pdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyX19zdGFydHttYXJnaW4taW5saW5lLWVuZDowLjVyZW19Lml0ZW0tYnJvd3Nlci1jYXJkLS14cyAuaXRlbS1icm93c2VyLWNhcmRfX3RodW1ibmFpbHt3aWR0aDo1cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjAuNXJlbX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJDYXJkJDEgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQWN0aW9uc09wZW4gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyQWN0aW9uc09wZW5cIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3RcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkUHJldmlldyA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJDYXJkUHJldmlld1wiLCA3KTtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50ID0gKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZShlLmRldGFpbC53aWR0aCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FyZENsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgLy8gd2hlbiB1c2luZyB0aGUgY2FyZHMgYXMgYSBsaW5rLCBkb24ndCBkbyBhbnkgc3BlY2lhbCBoYW5kbGluZ1xuICAgICAgICAgICAgaWYgKHRoaXMubGluaykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHByZXZpZXcgPSB0aGlzLnByZXZpZXcgPT09IFwidG9wXCI7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUuc2VsZWN0aW9uO1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtIH0gPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHByZXZpZXcgJiYgIXRoaXMuc3RvcmUuc3RhdGUucmVjeWNsZUJpbikge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkUHJldmlldy5lbWl0KGl0ZW0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZWxlY3Rpb24gPT09IFwic2luZ2xlXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHsgaXRlbSwgc2VsZWN0ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0LmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICBpdGVtLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogIWlzU2VsZWN0ZWQoeyBpdGVtLCBzZWxlY3RlZEl0ZW1zOiB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXMgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pdGVtID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcnRhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFwaSA9IDQ7XG4gICAgICAgIHRoaXMuYmFzZVVybCA9IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5iYXNlVXJsO1xuICAgICAgICB0aGlzLmxpbmsgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubmV3VGFiID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5uYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnByZXZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd093bmVyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93RGF0ZVVwZGF0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnNob3dJdGVtVHlwZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd1N1bW1hcnkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93QmFkZ2VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93QWNjZXNzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dGYXZvcml0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93VGh1bWJuYWlsID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gW107XG4gICAgICAgIHRoaXMuaG92ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZm9ybUZhY3RvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51cGRhdGVkVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXMuc2hvcnRVcGRhdGVkVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXMubG9hZGVkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5vU3BhY2VGb3JEYXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgLyogQ2FsbGluZyB0aGlzIHNldEZvY3VzIGNhdXNlcyBjYWxjaXRlIHRvIGZvY3VzIGhlcmUgd2hlbiB0aGUgdXNlciBwb3B1cCBpcyBjbG9zZWQuLi4gKi9cbiAgICBhc3luYyByZXN0b3JlRm9jdXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmxpbmsgJiYgdGhpcy5saW5rRWwpIHtcbiAgICAgICAgICAgIHRoaXMubGlua0VsLmZvY3VzKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJldmlldyA9PT0gXCJ0b3BcIiAmJiB0aGlzLnNlY3Rpb25FbCkge1xuICAgICAgICAgICAgdGhpcy5zZWN0aW9uRWwuZm9jdXMoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5jYXJkO1xuICAgICAgICAoX2EgPSB0aGlzLmZvcm1GYWN0b3IpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICh0aGlzLmZvcm1GYWN0b3IgPSAoKF9iID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXRlLnBhbmVsKSA/IFwieHNcIiA6IFwibGdcIik7XG4gICAgICAgIHNldHVwUmVzaXplT2JzZXJ2ZXIodGhpcy5zdG9yZSkub2JzZXJ2ZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzQnJvd3NlclJlc2l6ZVwiLCB0aGlzLmhhbmRsZVJlc2l6ZUV2ZW50KTtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdERhdGUodGhpcy5pdGVtLm1vZGlmaWVkKTtcbiAgICAgICAgdGhpcy51cGRhdGVkVGV4dCA9IHRoaXMuaTE4bi5sYXN0VXBkYXRlZC5yZXBsYWNlKFwiJHtkYXRlfVwiLCBmb3JtYXR0ZWREYXRlKTtcbiAgICAgICAgdGhpcy5zaG9ydFVwZGF0ZWRUZXh0ID0gZm9ybWF0dGVkRGF0ZTtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSAoX2MgPSB0aGlzLnBvcnRhbCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogY29uZmlnU3RhdGUucG9ydGFsO1xuICAgICAgICB0aGlzLnVzZXIgPSAoX2QgPSB0aGlzLnVzZXIpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IGNvbmZpZ1N0YXRlLnVzZXI7XG4gICAgICAgIHRoaXMuYXBpID0gKF9lID0gdGhpcy5hcGkpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IGNvbmZpZ1N0YXRlLmFwaTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGltZW91dCgxMDApO1xuICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIChfYyA9IChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJlc2l6ZU9ic2VydmVyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudW5vYnNlcnZlKHRoaXMuZWwpO1xuICAgICAgICAoX2QgPSB0aGlzLmVsKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc0Jyb3dzZXJSZXNpemVcIiwgdGhpcy5oYW5kbGVSZXNpemVFdmVudCk7XG4gICAgfVxuICAgIHJlc2l6ZSh3aWR0aCkge1xuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy5tZDpcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1GYWN0b3IgPSBcImxnXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIHdpZHRoID4gYnJlYWtwb2ludHMuc206XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJtZFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSB3aWR0aCA+IGJyZWFrcG9pbnRzLnhzOlxuICAgICAgICAgICAgICAgIHRoaXMuZm9ybUZhY3RvciA9IFwic21cIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2Ugd2lkdGggPiBicmVha3BvaW50cy54eHM6XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtRmFjdG9yID0gXCJ4c1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1GYWN0b3IgPSBcInh4c1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlclNlbGVjdGlvbihzZWxlY3RlZCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGkxOG4sIGl0ZW0gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZS5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IGNsYXNzZXMgPSB7XG4gICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX19pbnB1dFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9faW5wdXQtLWVuZFwiOiAoKF9iID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXRlLnZpZXcpID09PSBcImdyaWRcIlxuICAgICAgICB9O1xuICAgICAgICBpZiAoc2VsZWN0aW9uID09PSBcInNpbmdsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXJhZGlvLWJ1dHRvblwiLCB7IGNsYXNzOiBjbGFzc2VzLCBjaGVja2VkOiBzZWxlY3RlZCwgdmFsdWU6IGl0ZW0udGl0bGUsIG5hbWU6IHRoaXMubmFtZSwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9LCBvbkNhbGNpdGVSYWRpb0J1dHRvbkNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdC5lbWl0KHsgaXRlbSwgc2VsZWN0ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfSB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInNjcmVlbi1yZWFkZXJzLW9ubHlcIiB9LCBpMThuLnNlbGVjdC5yZXBsYWNlKFwiJHt0aXRsZX1cIiwgaXRlbS50aXRsZSkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWNoZWNrYm94XCIsIHsgY2xhc3M6IGNsYXNzZXMsIGNoZWNrZWQ6IHNlbGVjdGVkLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUNoZWNrYm94Q2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0LmVtaXQoeyBpdGVtLCBzZWxlY3RlZDogIXNlbGVjdGVkIH0pO1xuICAgICAgICAgICAgICAgIH0sIHZhbHVlOiBpdGVtLmlkIH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic2NyZWVuLXJlYWRlcnMtb25seVwiIH0sIGl0ZW0udGl0bGUpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJlbmRlck93bmVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgeyBpdGVtLCBhcGksIHBvcnRhbCwgZm9ybUZhY3RvciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaXNPbmxpbmVJblBvcnRhbCA9IChwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpICYmIHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0ID09PSBcImFsbFwiO1xuICAgICAgICBjb25zdCBiYXNlVXJsID0gaXNPbmxpbmVJblBvcnRhbFxuICAgICAgICAgICAgPyBcImh0dHBzOi8vd3d3LmFyY2dpcy5jb20vaG9tZS9cIlxuICAgICAgICAgICAgOiAoX2EgPSB0aGlzLmJhc2VVcmwpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYiA9IGNvbmZpZ1N0YXRlLmNvbmZpZykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJhc2VVcmw7XG4gICAgICAgIGlmICghdGhpcy5zaG93T3duZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19wcm9maWxlLXdyYXBcIiwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0gfSwgaChcImFyY2dpcy11c2VyLXBvcHVwXCIsIHsgdW5kZXJsaW5lOiB0cnVlLCBpdGVtOiBpdGVtLCBhcGk6IGFwaSwgcG9ydGFsOiBwb3J0YWwsIGJhc2VVcmw6IGJhc2VVcmwsIHNob3dOYW1lOiAoKF9jID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXRlLnZpZXcpICE9PSBcImdyaWRcIiwgY2hlY2tPbmxpbmU6IHBvcnRhbC5pc1BvcnRhbCAmJiB0aGlzLnN0b3JlLnN0YXRlLmJ1Y2tldCA9PT0gXCJhbGxcIiwgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX293bmVyXCIsIHNjYWxlOiBbXCJtZFwiLCBcImxnXCJdLmluY2x1ZGVzKGZvcm1GYWN0b3IpID8gXCJtXCIgOiBcInNcIiwgb25BcmNnaXNVc2VyUG9wdXBJbnRlcm5hbFVJQWN0aW9uOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckl0ZW1UeXBlKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgaXRlbSwgcG9ydGFsLCBzaG93SXRlbVR5cGUsIGZvcm1GYWN0b3IgfSA9IHRoaXM7XG4gICAgICAgIGlmICghc2hvd0l0ZW1UeXBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS10eXBlXCIsIHsgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX19kaXZpZGVyXCI6ICEoKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnBhbmVsKVxuICAgICAgICAgICAgfSwgc2NhbGU6IFtcInh4c1wiLCBcInhzXCJdLmluY2x1ZGVzKGZvcm1GYWN0b3IpID8gXCJzXCIgOiBcIm1cIiwgaXRlbTogaXRlbSwgcG9ydGFsOiBwb3J0YWwgfSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2gsIF9qLCBfaywgX2w7XG4gICAgICAgIGNvbnN0IHsgaXRlbSwgdXNlciwgcG9ydGFsLCBmb3JtRmFjdG9yLCBpMThuLCBsb2FkZWQsIHNob3dEYXRlVXBkYXRlZCwgc2hvd0l0ZW1UeXBlLCBzaG93T3duZXIsIHNob3dCYWRnZXMsIHNob3dTdW1tYXJ5LCBzaG93VGh1bWJuYWlsLCBsaW5rLCBuZXdUYWIsIHNob3dBY2Nlc3MsIGFjdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSAoKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnByZXZpZXcpID09PSB0aGlzLml0ZW0uaWQ7XG4gICAgICAgIGNvbnN0IGdyaWQgPSAoKF9iID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXRlLnZpZXcpID09PSBcImdyaWRcIjtcbiAgICAgICAgY29uc3QgdG9wUHJldmlldyA9IHRoaXMucHJldmlldyA9PT0gXCJ0b3BcIjtcbiAgICAgICAgY29uc3QgdG9wUHJldmlld0F0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICB0YWJJbmRleDogMCxcbiAgICAgICAgICAgIHJvbGU6IFwiYnV0dG9uXCIsXG4gICAgICAgICAgICBcImFyaWEtaGFzcG9wdXBcIjogXCJkaWFsb2dcIixcbiAgICAgICAgICAgIFwiYXJpYS1sYWJlbGxlZGJ5XCI6IFwib3Blbi1kZXRhaWxzXCIsXG4gICAgICAgICAgICBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiIHx8IGUua2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDYXJkQ2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IChfYyA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zdGF0ZS5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IGl0ZW1TZWxlY3Rpb24gPSBbXCJzaW5nbGVcIiwgXCJtdWx0aXBsZVwiXS5pbmNsdWRlcyhzZWxlY3Rpb24pO1xuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGl0ZW1TZWxlY3Rpb24gJiZcbiAgICAgICAgICAgIGlzU2VsZWN0ZWQoeyBpdGVtOiB0aGlzLml0ZW0sIHNlbGVjdGVkSXRlbXM6IChfZCA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdGF0ZS5zZWxlY3RlZEl0ZW1zIH0pO1xuICAgICAgICBjb25zdCBDYXJkVGFnID0gdGhpcy5saW5rID8gXCJhXCIgOiBcImRpdlwiO1xuICAgICAgICBjb25zdCBsaW5rQXR0cmlidXRlcyA9IE9iamVjdC5hc3NpZ24oeyBocmVmOiBsaW5rIH0sIChuZXdUYWIgPyB7IHRhcmdldDogXCJfYmxhbmtcIiwgcmVsOiBcIm5vb3BlbmVyIG5vcmVmZXJyZXJcIiB9IDoge30pKTtcbiAgICAgICAgY29uc3QgZXh0cmFTbWFsbCA9IFtcInh4c1wiLCBcInhzXCJdLmluY2x1ZGVzKGZvcm1GYWN0b3IpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcInNlY3Rpb25cIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmQtLWhvdmVyYWJsZVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFtgaXRlbS1icm93c2VyLWNhcmQtLSR7Zm9ybUZhY3Rvcn1gXTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkLS1wYW5lbFwiOiAoX2UgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Uuc3RhdGUucGFuZWwsXG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZC0tbG9hZGVkXCI6IGxvYWRlZCxcbiAgICAgICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkLS1wcmV2aWV3ZWRcIjogKChfZiA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zdGF0ZS5wcmV2aWV3KSA9PT0gaXRlbS5pZCxcbiAgICAgICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkLS1zZWxlY3RlZFwiOiBzZWxlY3RlZFxuICAgICAgICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+ICh0aGlzLmhvdmVyID0gdHJ1ZSksIG9uTW91c2VPdXQ6ICgpID0+ICh0aGlzLmhvdmVyID0gZmFsc2UpIH0sIChsaW5rID8ge30gOiB7IG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2FyZENsaWNrIH0pLCAodG9wUHJldmlldyAmJiAhbGluayA/IHRvcFByZXZpZXdBdHRyaWJ1dGVzIDoge30pLCB7IHJlZjogKGVsKSA9PiAodGhpcy5zZWN0aW9uRWwgPSBlbCkgfSksIGgoXCJzbG90XCIsIHsgbmFtZTogXCJjb250ZW50LXRvcFwiIH0pLCBoKENhcmRUYWcsIE9iamVjdC5hc3NpZ24oeyBjbGFzczogeyBcIml0ZW0tYnJvd3Nlci1jYXJkX191cHBlclwiOiB0cnVlLCBcIml0ZW0tYnJvd3Nlci1jYXJkX191cHBlci0tbGlua1wiOiAhIWxpbmsgfSB9LCAobGluayA/IGxpbmtBdHRyaWJ1dGVzIDoge30pLCB7IHJlZjogKGVsKSA9PiAodGhpcy5saW5rRWwgPSBlbCkgfSksIGdyaWQgJiYgc2hvd1RodW1ibmFpbCAmJiAoaChcImZpZ3VyZVwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX190aHVtYm5haWwtLWdyaWRcIiB9LCBoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1jYXJkLXRodW1ibmFpbFwiLCB7IGl0ZW06IGl0ZW0sIHVzZXI6IHVzZXIsIHBvcnRhbDogcG9ydGFsIH0pLCB0b3BQcmV2aWV3ICYmICFsaW5rICYmIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX2hvdmVyLXRleHRcIiwgaWQ6IFwib3Blbi1kZXRhaWxzXCIgfSwgKChfaCA9IChfZyA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy5zdGF0ZSkgPT09IG51bGwgfHwgX2ggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9oLnByZXZpZXcpID09PSBpdGVtLmlkID8gaTE4bi5jbG9zZURldGFpbHMgOiBpMThuLm9wZW5EZXRhaWxzKSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkLWZsZXggaXRlbS1icm93c2VyLWNhcmRfX3RvcFwiIH0sICFncmlkICYmIHRoaXMucmVuZGVyU2VsZWN0aW9uKHNlbGVjdGVkKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkLWZsZXgtMVwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZC1mbGV4XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19jb250ZW50XCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkLWZsZXhcIiB9LCBoKFwiaDNcIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX3RpdGxlXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fdGl0bGUtLXBhZGRlZFwiOiBzaG93SXRlbVR5cGUgfHwgKHNob3dTdW1tYXJ5ICYmICEhaXRlbS5zbmlwcGV0KSxcbiAgICAgICAgICAgICAgICBcIml0ZW0tYnJvd3Nlci1jYXJkX190aXRsZS0tZ3JpZFwiOiBncmlkLFxuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmQtZmxleC0xXCI6IHRydWVcbiAgICAgICAgICAgIH0gfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fdGl0bGVfX3NwYW5cIiB9LCBpdGVtLnRpdGxlKSksIGdyaWQgJiYgdGhpcy5yZW5kZXJTZWxlY3Rpb24oc2VsZWN0ZWQpKSwgc2hvd1N1bW1hcnkgJiYgaXRlbS5zbmlwcGV0ICYmICFleHRyYVNtYWxsICYmIChoKFwicFwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19zdW1tYXJ5XCIgfSwgaXRlbS5zbmlwcGV0Lmxlbmd0aCA+IDI1MFxuICAgICAgICAgICAgPyBgJHtpdGVtLnNuaXBwZXQuc3Vic3RyaW5nKDAsIDI1MCl94oCmYFxuICAgICAgICAgICAgOiBpdGVtLnNuaXBwZXQpKSwgKChfaiA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9qID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfai5zdGF0ZS5wYW5lbCkgJiYgdGhpcy5yZW5kZXJJdGVtVHlwZSgpLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaXRlbS1icm93c2VyLWNhcmRfX2RldGFpbHNcIiB9LCAhKChfayA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfay5zdGF0ZS5wYW5lbCkgJiYgdGhpcy5yZW5kZXJJdGVtVHlwZSgpLCBzaG93RGF0ZVVwZGF0ZWQgJiYgZm9ybUZhY3RvciAhPT0gXCJ4eHNcIiAmJiAoaChcInNwYW5cIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2RldGFpbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2RpdmlkZXJcIjogdHJ1ZVxuICAgICAgICAgICAgfSB9LCBbXCJ4eHNcIiwgXCJ4c1wiLCBcInNtXCJdLmluY2x1ZGVzKGZvcm1GYWN0b3IpIHx8IGdyaWRcbiAgICAgICAgICAgID8gdGhpcy5zaG9ydFVwZGF0ZWRUZXh0XG4gICAgICAgICAgICA6IHRoaXMudXBkYXRlZFRleHQpKSwgc2hvd0JhZGdlcyAmJiAoaChcImFyY2dpcy1pdGVtLWJhZGdlc1wiLCB7IGl0ZW06IGl0ZW0sIHVzZXI6IHVzZXIsIHBvcnRhbDogcG9ydGFsLCB3aWR0aDogZm9ybUZhY3RvciA9PT0gXCJsZ1wiICYmICFncmlkID8gXCJmdWxsXCIgOiBcIm5hcnJvd1wiLCBzaG93VG9vbHRpcHM6IHRydWUsIGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fYmFkZ2VzXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fZGl2aWRlclwiOiB0cnVlXG4gICAgICAgICAgICB9LCBzY2FsZTogXCJzXCIgfSkpKSksICFncmlkICYmIHNob3dUaHVtYm5haWwgJiYgKGgoXCJmaWd1cmVcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fdGh1bWJuYWlsXCIgfSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC10aHVtYm5haWxcIiwgeyBpdGVtOiBpdGVtLCB1c2VyOiB1c2VyLCBwb3J0YWw6IHBvcnRhbCB9KSkpKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImNvbnRlbnQtZW5kXCIgfSkpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJpdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyXCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gZS50YXJnZXQuY2xhc3NMaXN0O1xuICAgICAgICAgICAgICAgIC8vIGFueSBzbG90dGVkIGNvbXBvbmVudHMgd2lsbCBub3QgcHJvcGFnYXRlIHVwLCBhcyB3ZSBkb24ndCB3YW50IHRoZW0gdG8gdHJpZ2dlciBhIHByZXZpZXdcbiAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTGlzdC5jb250YWlucyhcIml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgIWNsYXNzTGlzdC5jb250YWlucyhcIml0ZW0tYnJvd3Nlci1jYXJkX19mb290ZXJfX3N0YXJ0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25LZXlQcmVzczogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiB8fCBlLmtleSA9PSBcIiBcIikge1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyX19zdGFydFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2Zvb3Rlcl9fc3RhcnQtLW93bmVyXCI6IHNob3dPd25lclxuICAgICAgICAgICAgfSB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiYWN0aW9ucy1zdGFydFwiIH0pLCAhZ3JpZCAmJiB0aGlzLnJlbmRlck93bmVyKCkpLCBncmlkICYmIHRoaXMucmVuZGVyT3duZXIoKSwgc2hvd0FjY2VzcyAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19hY2Nlc3Mtd3JhcFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSB9LCBoKFwiYXJjZ2lzLWl0ZW0tc2hhcmUtc3VtbWFyeVwiLCB7IGl0ZW06IGl0ZW0sIGNsYXNzOiBcIml0ZW0tYnJvd3Nlci1jYXJkX19hY2Nlc3NcIiwgc2NhbGU6IFwic1wiLCBzaG93VGV4dDogIWdyaWQgJiYgZm9ybUZhY3RvciA9PT0gXCJsZ1wiIH0pKSksIChzaG93QWNjZXNzIHx8IChncmlkICYmIHNob3dPd25lcikpICYmICgoX2wgPSB0aGlzLmFjdGlvbnMpID09PSBudWxsIHx8IF9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbC5sZW5ndGgpID4gMCAmJiAoaChcInNwYW5cIiwgeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiaXRlbS1icm93c2VyLWNhcmRfX2Zvb3Rlci1kaXZpZGVyXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJpdGVtLWJyb3dzZXItY2FyZF9fZm9vdGVyLWRpdmlkZXItLWxpc3RcIjogIWdyaWRcbiAgICAgICAgICAgIH0gfSkpLCB0aGlzLnNob3dGYXZvcml0ZSAmJiAoaChcImFyY2dpcy1pdGVtLWZhdm9yaXRlXCIsIHsgaXRlbTogaXRlbSwgcG9ydGFsOiBwb3J0YWwsIHVzZXI6IHVzZXIgfHwgKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyKSwgaWNvbk9ubHk6IHRydWUgfSkpLCB0aGlzLnByZXZpZXcgPT09IFwiYWN0aW9uXCIgJiYgIXRoaXMuc3RvcmUuc3RhdGUucmVjeWNsZUJpbiAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2NhbGU6IFwic1wiLCBhcHBlYXJhbmNlOiBjdXJyZW50ID8gXCJzb2xpZFwiIDogXCJvdXRsaW5lXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkUHJldmlldy5lbWl0KHRoaXMuaXRlbSk7XG4gICAgICAgICAgICB9IH0sIGN1cnJlbnQgPyBpMThuLmhpZGVQcmV2aWV3IDogaTE4bi5wcmV2aWV3KSksIChzZWxlY3Rpb24gPT09IG51bGwgfHwgc2VsZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3Rpb24uaW5jbHVkZXMoXCJzdWJsYXllclwiKSkgJiYgKGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLWNhcmQtc3VibGF5ZXItc2VsZWN0XCIsIHsgaXRlbTogaXRlbSwgdXNlcjogdXNlciwgcG9ydGFsOiBwb3J0YWwsIHNlbGVjdGlvbjogc2VsZWN0aW9uID09PSBcIm11bHRpcGxlLXN1YmxheWVyXCIgPyBcIm11bHRpcGxlXCIgOiBcInNpbmdsZVwiLCBzaG93RXJyb3JzOiB0cnVlIH0pKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImFjdGlvbnMtZW5kXCIgfSksIGFjdGlvbnMubGVuZ3RoID4gMCAmJiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2NhbGU6IFwic1wiLCBzbG90OiBcInRyaWdnZXJcIiwgYWxpZ25tZW50OiBcImNlbnRlclwiLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHRleHQ6IGkxOG4ubW9yZU9wdGlvbnMsIHRleHRFbmFibGVkOiBmYWxzZSwgaWNvbjogXCJlbGxpcHNpc1wiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zT3Blbi5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgZWw6IGUudGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IH0pKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckNhcmQkMS5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyQ2FyZENzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU3VibGF5ZXJTZWxlY3RDc3MgPSBcIi50aXRsZXttYXgtd2lkdGg6MzJyZW07d29yZC13cmFwOmJyZWFrLXdvcmQ7d29yZC1icmVhazpicmVhay13b3JkfS5kcm9wZG93bi1pdGVtLWRpc2FibGVke3BvaW50ZXItZXZlbnRzOm5vbmU7b3BhY2l0eTp2YXIoLS1jYWxjaXRlLXVpLW9wYWNpdHktZGlzYWJsZWQpfS5kcm9wZG93bntkaXNwbGF5OmJsb2NrfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckNhcmQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0XCIsIDcpO1xuICAgICAgICB0aGlzLnJlbmRlclN1YmxheWVyID0gKHN1YmxheWVyKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtLCBzdG9yZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGRpc2FibGVkID0gISgoX2IgPSAoX2EgPSBzdG9yZSA9PT0gbnVsbCB8fCBzdG9yZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3RvcmUuc3RhdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hbGxvd2VkR2VvbWV0cmllcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKHN1YmxheWVyLmdlb21ldHJ5VHlwZSkpO1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1kcm9wZG93bi1pdGVtXCIsIE9iamVjdC5hc3NpZ24oeyBpY29uU3RhcnQ6IGdldFNlYXJjaFN1YmxheWVySWNvbihzdWJsYXllci5nZW9tZXRyeVR5cGUpLCBzZWxlY3RlZDogaXNTZWxlY3RlZCh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIHN1YmxheWVyLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1zOiBzdG9yZS5zdGF0ZS5zZWxlY3RlZEl0ZW1zXG4gICAgICAgICAgICAgICAgfSkgfSwgKGRpc2FibGVkXG4gICAgICAgICAgICAgICAgPyB7IGFyaWFEaXNhYmxlZDogdHJ1ZSwgdGFiSW5kZXg6IC0xLCBjbGFzc05hbWU6IFwiZHJvcGRvd24taXRlbS1kaXNhYmxlZFwiIH1cbiAgICAgICAgICAgICAgICA6IHt9KSwgeyByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnRhYkluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBvbkNhbGNpdGVEcm9wZG93bkl0ZW1TZWxlY3Q6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGl0ZW0gfSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0LmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmxheWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2luZ2xlIHNlbGVjdCBzaG91bGQgcmVtYWluIHNlbGVjdGVkIG9uIGNsaWNrLCBtdWx0aSBzZWxlY3Qgc2hvdWxkIHRvZ2dsZVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0aW9uID09PSBcInNpbmdsZVwiIHx8ICFzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IH0pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInRpdGxlXCIgfSwgc3VibGF5ZXIudGl0bGUpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXNBbGxvd2VkR2VvbWV0cnkgPSAoZ2VvbWV0cnkpID0+IHsgdmFyIF9hLCBfYiwgX2M7IHJldHVybiAoX2MgPSAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hbGxvd2VkR2VvbWV0cmllcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmluY2x1ZGVzKGdlb21ldHJ5KTsgfTtcbiAgICAgICAgdGhpcy5zb3J0U3VibGF5ZXJzID0gKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkQSA9IHRoaXMuaXNBbGxvd2VkR2VvbWV0cnkoYS5nZW9tZXRyeVR5cGUpO1xuICAgICAgICAgICAgY29uc3QgdmFsaWRCID0gdGhpcy5pc0FsbG93ZWRHZW9tZXRyeShiLmdlb21ldHJ5VHlwZSk7XG4gICAgICAgICAgICBpZiAodmFsaWRBID09PSB2YWxpZEIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYi5pZCAtIGEuaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsaWRBID8gLTEgOiAxO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlclNlbGVjdFRleHQgPSAoc2VsZWN0ZWRTdWJsYXllcnMpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBjb25zdCBtdWx0aXBsZSA9IHRoaXMuc2VsZWN0aW9uID09PSBcIm11bHRpcGxlXCI7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtICYmICF0aGlzLml0ZW0uc3VibGF5ZXJzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0ZWQoeyBpdGVtOiB0aGlzLml0ZW0sIHNlbGVjdGVkSXRlbXM6IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZS5zZWxlY3RlZEl0ZW1zIH0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uc2VsZWN0ZWRTaW5nbGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG4uc2VsZWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChzZWxlY3RlZFN1YmxheWVycyA9PT0gbnVsbCB8fCBzZWxlY3RlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRTdWJsYXllcnMubGVuZ3RoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtdWx0aXBsZSA/IHRoaXMuaTE4bi5zZWxlY3RMYXllcnMgOiB0aGlzLmkxOG4uc2VsZWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bi5zZWxlY3RlZExheWVycy5yZXBsYWNlKFwiJHtudW19XCIsIGAke3NlbGVjdGVkU3VibGF5ZXJzLmxlbmd0aH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gc2VsZWN0ZWRTdWJsYXllcnNbMF07XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuLnNlbGVjdGVkTmFtZS5yZXBsYWNlKFwiJHtuYW1lfVwiLCAoX2IgPSBzZWxlY3RlZC5zdWJsYXllcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRpdGxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pdGVtID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLndpZHRoID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IFwib3V0bGluZVwiO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93RXJyb3JzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3VibGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mZXRjaGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWxlcnRBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLmkxOG4uY2FyZFN1YmxheWVyU2VsZWN0O1xuICAgICAgICB0aGlzLnN1YmxheWVycyA9IChfYiA9IHRoaXMuaXRlbSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN1YmxheWVycztcbiAgICAgICAgaWYgKCF0aGlzLml0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKF9jID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3VibGF5ZXJzKSB7XG4gICAgICAgICAgICB0aGlzLnN1YmxheWVycyA9IHRoaXMuaXRlbS5zdWJsYXllcnM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGluQ2FjaGUoXCJzZXJ2aWNlSW5mb1wiLCB0aGlzLml0ZW0uaWQpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UucmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zdCBsYXllcnMgPSByZXNwb25zZS5yZXN1bHQubWFwKGdldFNlYXJjaFJlc3VsdFN1YmxheWVyKS5zb3J0KHRoaXMuc29ydFN1YmxheWVycyk7XG4gICAgICAgICAgICB0aGlzLnN1YmxheWVycyA9IGxheWVycztcbiAgICAgICAgICAgIHRoaXMuaXRlbS5zdWJsYXllcnMgPSBsYXllcnM7XG4gICAgICAgICAgICB0aGlzLmZldGNoZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmFsZXJ0QWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBhdHRlbXB0TG9hZCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmFsZXJ0QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIC8vIGZvciBpdGVtcyB3aXRob3V0IHN1YmxheWVycyBpbiB0aGUgc2VhcmNoIGluZGV4LFxuICAgICAgICAvLyB0cnkgZmV0Y2hpbmcgdGhlIHNlcnZpY2UgaW5mb1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZyb21DYWNoZSgoKSA9PiBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7XG4gICAgICAgICAgICBpdGVtOiB0aGlzLml0ZW0sXG4gICAgICAgICAgICBwb3J0YWw6IHRoaXMucG9ydGFsLFxuICAgICAgICAgICAgbGF5ZXJzOiBudWxsLFxuICAgICAgICAgICAgaXNTZWN1cmU6IGZhbHNlXG4gICAgICAgIH0pLCBcInNlcnZpY2VJbmZvXCIsIHRoaXMuaXRlbS5pZCk7XG4gICAgICAgIC8vIG1ha2UgcmVhbCBzdWJsYXllcnMgbG9vayBsaWtlIHNlYXJjaCBzdWJsYXllcnNcbiAgICAgICAgdGhpcy5wcm9jZXNzUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICBhd2FpdCB0aW1lb3V0KDEwMCk7XG4gICAgICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gISEoKF9hID0gdGhpcy5zdWJsYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgc3RvcmUsIHdpZHRoLCBhcHBlYXJhbmNlLCBsb2FkaW5nLCBpMThuLCBhbGVydEFjdGl2ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbTtcbiAgICAgICAgaWYgKCFzdG9yZSB8fCAhaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2NhbGUgPSB3aWR0aCA9PT0gXCJhdXRvXCIgPyBcInNcIiA6IFwibVwiO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gc3RvcmUgPT09IG51bGwgfHwgc3RvcmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN0b3JlLnN0YXRlLnNlbGVjdGVkSXRlbXM7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkU3VibGF5ZXJzID0gZmluZFNlbGVjdGVkU3VibGF5ZXJzKHsgaXRlbSwgc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICAgICAgY29uc3QgaXNJdGVtU2VsZWN0ZWQgPSBpc1NlbGVjdGVkKHsgaXRlbSwgc2VsZWN0ZWRJdGVtcyB9KTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsICgoX2EgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uc3VibGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA/IChoKFwiY2FsY2l0ZS1kcm9wZG93blwiLCB7IGNsYXNzOiBcImRyb3Bkb3duXCIsIHdpZHRoU2NhbGU6IFwibFwiLCBwbGFjZW1lbnQ6IGFwcGVhcmFuY2UgPT09IFwic29saWRcIiA/IFwidG9wXCIgOiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwic1wiLCBjbG9zZU9uU2VsZWN0RGlzYWJsZWQ6IHRydWUsIG92ZXJsYXlQb3NpdGlvbmluZzogXCJmaXhlZFwiLCByZWY6IChlbCkgPT4gKHRoaXMuZHJvcGRvd24gPSBlbCkgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgbG9hZGluZzogbG9hZGluZywgZGlzYWJsZWQ6IGxvYWRpbmcsIHNsb3Q6IFwidHJpZ2dlclwiLCBzY2FsZTogc2NhbGUsIGFwcGVhcmFuY2U6IChzZWxlY3RlZFN1YmxheWVycyA9PT0gbnVsbCB8fCBzZWxlY3RlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRTdWJsYXllcnMubGVuZ3RoKSB8fCBhcHBlYXJhbmNlID09PSBcInNvbGlkXCIgPyBcInNvbGlkXCIgOiBcIm91dGxpbmVcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25FbmQ6IFwiY2hldnJvbi1kb3duXCIsIHdpZHRoOiB3aWR0aCB9LCB0aGlzLnJlbmRlclNlbGVjdFRleHQoc2VsZWN0ZWRTdWJsYXllcnMpKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiB0aGlzLnNlbGVjdGlvbiB9LCAoX2IgPSB0aGlzLnN1YmxheWVycykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnNvcnQodGhpcy5zb3J0U3VibGF5ZXJzKS5tYXAodGhpcy5yZW5kZXJTdWJsYXllcikpKSkgOiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgbG9hZGluZzogbG9hZGluZywgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgYWxlcnRBY3RpdmUsIGNsYXNzOiBcImRyb3Bkb3duXCIsIHNsb3Q6IFwidHJpZ2dlclwiLCBzY2FsZTogc2NhbGUsIGFwcGVhcmFuY2U6IChzZWxlY3RlZFN1YmxheWVycyA9PT0gbnVsbCB8fCBzZWxlY3RlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRTdWJsYXllcnMubGVuZ3RoKSA/IFwic29saWRcIiA6IFwib3V0bGluZVwiLCBraW5kOiBcIm5ldXRyYWxcIiwgd2lkdGg6IHdpZHRoLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbSAmJlxuICAgICAgICAgICAgICAgICAgICAhdGhpcy5zdWJsYXllcnMgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtLnR5cGUgIT09IFwiSW1hZ2UgU2VydmljZVwiICYmXG4gICAgICAgICAgICAgICAgICAgICF0aGlzLmZldGNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm91bmRMYXllcnMgPSBhd2FpdCB0aGlzLmF0dGVtcHRMb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZExheWVycyB8fCB0aGlzLmFsZXJ0QWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3QuZW1pdCh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiAhaXNJdGVtU2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5yZW5kZXJTZWxlY3RUZXh0KHNlbGVjdGVkU3VibGF5ZXJzKSkpLCB0aGlzLnNob3dFcnJvcnMgJiYgKGgoXCJjYWxjaXRlLWFsZXJ0XCIsIHsgbGFiZWw6IGkxOG4uZXJyb3JUaXRsZSwgaWNvbjogdHJ1ZSwga2luZDogXCJkYW5nZXJcIiwgb25DYWxjaXRlQWxlcnRDbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0sIG9wZW46ICEhYWxlcnRBY3RpdmUsIHRhYkluZGV4OiAhYWxlcnRBY3RpdmUgPyAtMSA6IG51bGwgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBpMThuLmVycm9yVGl0bGUpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIsIGNsYXNzOiBcImFsZXJ0X19tZXNzYWdlXCIgfSwgaTE4bi5lcnJvckJvZHkpLCBoKFwiY2FsY2l0ZS1saW5rXCIsIHsgc2xvdDogXCJsaW5rXCIsIG9uQ2xpY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjbGVhckNhY2hlKFwic2VydmljZUluZm9cIiwgdGhpcy5pdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmF0dGVtcHRMb2FkKCk7XG4gICAgICAgICAgICB9IH0sIGkxOG4ucmV0cnkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyQ2FyZC5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFN1YmxheWVyU2VsZWN0Q3NzO1xuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWxDc3MgPSBcIjpob3N0e3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2t9Lm91dGVye3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7cGFkZGluZy10b3A6NjYuNjYlfS5pbm5lcntwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowcHg7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpfS5pbm5lci0tbG9hZGluZ3thbmltYXRpb24tZHVyYXRpb246MXM7YW5pbWF0aW9uLWZpbGwtbW9kZTpmb3J3YXJkczthbmltYXRpb24taXRlcmF0aW9uLWNvdW50OmluZmluaXRlO2FuaW1hdGlvbi1uYW1lOnRodW1ibmFpbC1zaGltbWVyO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246bGluZWFyO2JhY2tncm91bmQtaW1hZ2U6bGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpIDAlLCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMiksIHZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCkgNDAlLCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpIDEwMCUpO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXNpemU6ODAwcHggMTAwJX0udGh1bWJuYWlse2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7LW8tb2JqZWN0LWZpdDpjb3ZlcjtvYmplY3QtZml0OmNvdmVyO29wYWNpdHk6MTt0cmFuc2l0aW9uLXByb3BlcnR5Om9wYWNpdHk7dHJhbnNpdGlvbjpvcGFjaXR5IDMwMG1zIGxpbmVhcn0udGh1bWJuYWlsLS1sb2FkaW5ne29wYWNpdHk6MH1Aa2V5ZnJhbWVzIHRodW1ibmFpbC1zaGltbWVyezAle2JhY2tncm91bmQtcG9zaXRpb246LTQ2OHB4IDB9MTAwJXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjQ2OHB4IDB9fVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckNhcmRUaHVtYm5haWwgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMudXNlRGVmYXVsdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50aHVtYm5haWxVcmwgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5zZXRUaHVtYm5haWxVcmwoKTtcbiAgICB9XG4gICAgaGFuZGxlSXRlbUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5zZXRUaHVtYm5haWxVcmwoKTtcbiAgICB9XG4gICAgYXN5bmMgc2V0VGh1bWJuYWlsVXJsKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGl0ZW0sIHBvcnRhbCB9ID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMudXNlRGVmYXVsdCkge1xuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxVcmwgPSBnZXREZWZhdWx0VGh1bWJuYWlsKHRoaXMuaXRlbSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aHVtYm5haWxVcmwgPSBhd2FpdCBnZXRBZGp1c3RlZFRodW1ibmFpbChwb3J0YWwsIGl0ZW0sIChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJ1Y2tldCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsb2FkaW5nLCB1c2VEZWZhdWx0LCB0aHVtYm5haWxVcmwgfSA9IHRoaXM7XG4gICAgICAgIGlmICghdGh1bWJuYWlsVXJsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJvdXRlclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogeyBpbm5lcjogdHJ1ZSwgXCJpbm5lci0tbG9hZGluZ1wiOiBsb2FkaW5nIH0gfSwgaChcImltZ1wiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwidGh1bWJuYWlsLS1sb2FkaW5nXCI6IGxvYWRpbmdcbiAgICAgICAgICAgIH0sIGFsdDogXCJcIiwgc3JjOiB0aHVtYm5haWxVcmwsXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjcm9zc29yaWdpbjogXCJhbm9ueW1vdXNcIiwgb25Mb2FkOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlID0gZS5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmICghdXNlRGVmYXVsdCAmJiBpc0JsYW5rSW1hZ2UoaW1hZ2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlRGVmYXVsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSwgb25FcnJvcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlRGVmYXVsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUaHVtYm5haWxVcmwoKTtcbiAgICAgICAgICAgIH0gfSksIGxvYWRpbmcgJiYgaChcImRpdlwiLCB7IGNsYXNzOiBcInBsYWNlaG9sZGVyXCIgfSkpKSkpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJhc3NldHNcIl07IH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJpdGVtXCI6IFtcImhhbmRsZUl0ZW1DaGFuZ2VcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJDYXJkVGh1bWJuYWlsLnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJDYXJkVGh1bWJuYWlsQ3NzO1xuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckNvbnRlbnRDc3MgPSBcIjpob3N0ey0tYXJjZ2lzLWl0ZW0tYnJvd3Nlci1jb250ZW50LXNwYWNpbmc6MC41cmVtfS5ncmlkLWNvbnRhaW5lciBzbG90LC5saXN0IHNsb3R7ZGlzcGxheTpncmlkO2dyaWQtZ2FwOnZhcigtLWFyY2dpcy1pdGVtLWJyb3dzZXItY29udGVudC1zcGFjaW5nKX0uY29sdW1ucy0xIHNsb3R7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgxLCAxZnIpfS5jb2x1bW5zLTIgc2xvdHtncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KDIsIDFmcil9LmNvbHVtbnMtMyBzbG90e2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMywgMWZyKX0uY29sdW1ucy00IHNsb3R7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCg0LCAxZnIpfS5uby1zcGFjZSBzbG90e2dhcDowLjI1cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckNvbnRlbnQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFjdGlvbkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIH1cbiAgICBnZXRDb2x1bW5Db3VudCh3aWR0aCkge1xuICAgICAgICBpZiAodGhpcy5zdG9yZS5zdGF0ZS52aWV3ICE9PSBcImdyaWRcIikge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsdGVyID0gdGhpcy5zdG9yZS5zdGF0ZS5maWx0ZXJzRW1wdHkgPyAxIDogMDtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIHdpZHRoIDwgYnJlYWtwb2ludHMueHM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICBjYXNlIHdpZHRoIDwgYnJlYWtwb2ludHMuc206XG4gICAgICAgICAgICAgICAgcmV0dXJuIDI7XG4gICAgICAgICAgICBjYXNlIHdpZHRoIDwgYnJlYWtwb2ludHMubWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIDEgKyBmaWx0ZXI7XG4gICAgICAgICAgICBjYXNlIHdpZHRoIDwgYnJlYWtwb2ludHMueGw6XG4gICAgICAgICAgICAgICAgcmV0dXJuIDIgKyBmaWx0ZXI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAzICsgZmlsdGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZUFjdGlvbnNNZW51KGUpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGFjdGlvbnMsIGVsIH0gPSBlLmRldGFpbDtcbiAgICAgICAgLy8gY2xvc2UgaWYgYWxyZWFkeSBvcGVuXG4gICAgICAgIGlmIChlbCA9PT0gdGhpcy5hY3Rpb25FbGVtZW50ICYmICgoX2EgPSB0aGlzLnBvcG92ZXJFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub3BlbikpIHtcbiAgICAgICAgICAgIHRoaXMucG9wb3ZlckVsZW1lbnQub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5mb2N1c0FjdGlvbigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IGFjdGlvbnM7XG4gICAgICAgIHRoaXMuYWN0aW9uRWxlbWVudCA9IGVsO1xuICAgICAgICBpZiAodGhpcy5wb3BvdmVyRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyRWxlbWVudC5vcGVuID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBmb2N1c0FjdGlvbigpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICAoX2IgPSAoX2EgPSB0aGlzLmFjdGlvbkVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb2N1cykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EpO1xuICAgICAgICAoX2QgPSAoX2MgPSB0aGlzLmFjdGlvbkVsZW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5zZXRGb2N1cykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmNhbGwoX2MpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuc3RvcmUuc3RhdGUudmlldztcbiAgICAgICAgY29uc3QgY29sdW1uQ291bnQgPSB0aGlzLmdldENvbHVtbkNvdW50KHRoaXMuc3RvcmUuc3RhdGUud2lkdGgpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgW3ZpZXcgPT09IFwiZ3JpZFwiID8gXCJncmlkLWNvbnRhaW5lclwiIDogdmlld106IHRydWUsXG4gICAgICAgICAgICAgICAgW2Bjb2x1bW5zLSR7Y29sdW1uQ291bnR9YF06IHRydWUsXG4gICAgICAgICAgICAgICAgXCJuby1zcGFjZVwiOiB0aGlzLnN0b3JlLnN0YXRlLndpZHRoIDwgYnJlYWtwb2ludHMueHMgJiYgdGhpcy5zdG9yZS5zdGF0ZS5wYW5lbFxuICAgICAgICAgICAgfSB9LCBoKFwic2xvdFwiLCBudWxsKSksIGgoXCJjYWxjaXRlLXBvcG92ZXJcIiwgeyByZWZlcmVuY2VFbGVtZW50OiB0aGlzLmFjdGlvbkVsZW1lbnQsIGxhYmVsOiB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uY2FyZC5tb3JlT3B0aW9ucywgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwibVwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgcG9pbnRlckRpc2FibGVkOiB0cnVlLCBhdXRvQ2xvc2U6IHRydWUsIHRyaWdnZXJEaXNhYmxlZDogdHJ1ZSwgb25DYWxjaXRlUG9wb3ZlckNsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c0FjdGlvbigpO1xuICAgICAgICAgICAgfSwgcmVmOiBhc3luYyAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJFbGVtZW50ID0gZWw7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWRyb3Bkb3duLWdyb3VwXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJub25lXCIsIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSB9LCAoX2EgPSB0aGlzLmFjdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHsgdGV4dCwgbmV3VGFiLCBsaW5rLCBhY3Rpb24gfSkgPT4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgT2JqZWN0LmFzc2lnbih7IG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGtleTogdGV4dCB9LCAoIWFjdGlvbiAmJiBsaW5rXG4gICAgICAgICAgICA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgKG5ld1RhYiA/IHsgdGFyZ2V0OiBcIl9ibGFua1wiLCByZWw6IFwibm9vcGVuZXIgbm9yZWZlcnJlclwiIH0gOiB7fSkpLCB7IGhyZWY6IGxpbmsgfSkgOiB7fSkpLCB0ZXh0KSkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyQ29udGVudC5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyQ29udGVudENzcztcblxuY29uc3QgY2FuRWRpdENhdGVnb3J5U2NoZW1hID0gYXN5bmMgKHsgZ3JvdXBJZCwgcG9ydGFsLCB1c2VyIH0pID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgaXNBbm9uID0gIXVzZXI7XG4gICAgY29uc3QgdXNlclB1YmxpYyA9IGlzUHVibGljVXNlcih1c2VyKTtcbiAgICBjb25zdCBjdXN0b21Sb2xlID0gaXNDdXN0b21Sb2xlKHVzZXIpO1xuICAgIGNvbnN0IGlzQWRtaW4gPSBpc09yZ0FkbWluKHVzZXIpO1xuICAgIGNvbnN0IGlzRWRpdGluZ0dyb3VwU2NoZW1hID0gISFncm91cElkO1xuICAgIGNvbnN0IGdyb3VwID0gaXNFZGl0aW5nR3JvdXBTY2hlbWEgPyBhd2FpdCBmZXRjaEdyb3VwKGdyb3VwSWQsIHBvcnRhbCkgOiBudWxsO1xuICAgIGNvbnN0IGdyb3VwT3duZXJOYW1lID0gZ3JvdXAgPT09IG51bGwgfHwgZ3JvdXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyb3VwLm93bmVyO1xuICAgIGNvbnN0IGdyb3VwT3duZXIgPSBpc0VkaXRpbmdHcm91cFNjaGVtYSA/IGF3YWl0IGZldGNoVXNlcihncm91cE93bmVyTmFtZSwgcG9ydGFsKSA6IG51bGw7XG4gICAgY29uc3QgZ3JvdXBPd25lZEJ5TXlPcmcgPSAhdXNlclB1YmxpYyAmJiB1c2VyLm9yZ0lkID09PSAoZ3JvdXBPd25lciA9PT0gbnVsbCB8fCBncm91cE93bmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cE93bmVyLm9yZ0lkKTtcbiAgICBjb25zdCBncm91cE1lbWJlcnNoaXBUeXBlID0gKF9hID0gZ3JvdXAgPT09IG51bGwgfHwgZ3JvdXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyb3VwLnVzZXJNZW1iZXJzaGlwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWVtYmVyVHlwZTtcbiAgICBjb25zdCBjYW5NYW5hZ2VHcm91cENhdGVnb3JpZXMgPSAhaXNBbm9uICYmXG4gICAgICAgIChncm91cE1lbWJlcnNoaXBUeXBlID09PSBcIm93bmVyXCIgfHxcbiAgICAgICAgICAgIGdyb3VwTWVtYmVyc2hpcFR5cGUgPT09IFwiYWRtaW5cIiB8fFxuICAgICAgICAgICAgKGdyb3VwT3duZWRCeU15T3JnICYmIGNhblVwZGF0ZU9yZ0dyb3Vwcyh1c2VyKSkpO1xuICAgIGNvbnN0IGNhbk1hbmFnZUl0ZW1DYXRlZ29yaWVzID0gIWlzQW5vbiAmJiAhdXNlclB1YmxpYyAmJiAoaXNBZG1pbiB8fCAoY3VzdG9tUm9sZSAmJiBjYW5VcGRhdGVJdGVtQ2F0ZWdvcmllcyh1c2VyKSkpO1xuICAgIHJldHVybiAhZ3JvdXAgPyBjYW5NYW5hZ2VJdGVtQ2F0ZWdvcmllcyA6IGNhbk1hbmFnZUdyb3VwQ2F0ZWdvcmllcztcbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyQ2F0ZWdvcmllc0NzcyA9IFwiLm5vLWNhdGVnb3J5LXRpdGxle21hcmdpbi1ib3R0b206MC4yNXJlbTttYXJnaW4tdG9wOjFyZW07Zm9udC1zaXplOjFyZW19Lm5vLWNhdGVnb3J5LWRlc2NyaXB0aW9uOm5vdCg6bGFzdC1jaGlsZCl7bWFyZ2luLWJvdHRvbToxcmVtO21hcmdpbi10b3A6MHB4fVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNhdGVnb3JpZXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhdGVnb3J5U2NoZW1hVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNhdGVnb3J5U2NoZW1hVXBkYXRlXCIsIDcpO1xuICAgICAgICB0aGlzLnJlZmV0Y2hDYXRlZ29yaWVzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZldGNoQ2F0ZWdvcmllcyhjb25maWdTdGF0ZS5wb3J0YWwsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5mZXRjaENhdGVnb3JpZXMgPSBhc3luYyAocG9ydGFsLCB1c2VDYWNoZSA9IGZhbHNlKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICAgICAgICAgIGNvbnN0IGlzTGl2aW5nQXRsYXMgPSAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSA9PT0gXCJsaXZpbmcgYXRsYXNcIjtcbiAgICAgICAgICAgIGNvbnN0IGlzR3JvdXAgPSAoKF9kID0gKF9jID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXRlKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuYnVja2V0KSA9PT0gXCJncm91cFwiO1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBJZCA9IHRoaXMuZ3JvdXBJZCB8fCB0aGlzLnN0b3JlLnN0YXRlLmdyb3VwSWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0FsbEdyb3VwcygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlbWEgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDYXRlZ29yeVNjaGVtYVVwZGF0ZS5lbWl0KG51bGwpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gaXNMaXZpbmdBdGxhc1xuICAgICAgICAgICAgICAgID8gYXdhaXQgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMocG9ydGFsLCBcIkxpdmluZ0F0bGFzXCIsIHVzZUNhY2hlKVxuICAgICAgICAgICAgICAgIDogZ3JvdXBJZCAmJiBncm91cElkICE9PSBcImFsbFwiICYmIGlzR3JvdXBcbiAgICAgICAgICAgICAgICAgICAgPyBhd2FpdCBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwsIHVzZUNhY2hlKVxuICAgICAgICAgICAgICAgICAgICA6IGF3YWl0IGZldGNoQ2F0ZWdvcmllcyhwb3J0YWwsIGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyLCB1c2VDYWNoZSk7XG4gICAgICAgICAgICBjb25zdCBzY2hlbWEgPSAoX2YgPSAoX2UgPSByZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UuY2F0ZWdvcnlTY2hlbWEpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZVswXSkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mLmNhdGVnb3JpZXM7XG4gICAgICAgICAgICB0aGlzLnNldFNjaGVtYShzY2hlbWEpO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2V0U2NoZW1hID0gKHNjaGVtYSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2F0ZWdvcnlTY2hlbWFVcGRhdGUuZW1pdChzY2hlbWEpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlclNjaGVtYUVkaXRvciA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgZ3JvdXBJZCwgYWxsb3dFZGl0LCBpc0VkaXRpbmcsIGhhbmRsZUVkaXRTY2hlbWFDb21wbGV0ZSwgc2V0U2NoZW1hIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICAgICAgaWYgKCFhbGxvd0VkaXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAoaChcImFyY2dpcy10dW5uZWxcIiwgeyByZWZlcmVuY2U6IHRoaXMuZWwgfSwgaChcImFyY2dpcy1pdGVtLWNhdGVnb3J5LXNjaGVtYS1lZGl0b3JcIiwgeyBpc0FjdGl2ZTogaXNFZGl0aW5nLCBncm91cDogZ3JvdXBJZCA/IHsgaWQ6IGdyb3VwSWQgfSA6IHVuZGVmaW5lZCwgdXNlcjogdXNlciwgY29uZmlnOiBjb25maWdTdGF0ZS5jb25maWcsIHBvcnRhbDogcG9ydGFsLCBvbldvcmtmbG93Q2FuY2VsOiBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRWRpdFNjaGVtYUNvbXBsZXRlKGV2ZW50LmRldGFpbC5oYXNDaGFuZ2VTaW5jZUxhc3RPcGVuKTtcbiAgICAgICAgICAgICAgICB9LCBvbk5ld1NjaGVtYVdvcmtmbG93Q29tcGxldGU6IGFzeW5jICh7IGRldGFpbCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFZGl0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNldFNjaGVtYShkZXRhaWwubmV3U2NoZW1hKTtcbiAgICAgICAgICAgICAgICB9LCBvbkRlbGV0ZUFsbFNjaGVtYTogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVFZGl0U2NoZW1hQ29tcGxldGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSB9KSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUVkaXRTY2hlbWFDb21wbGV0ZSA9IGFzeW5jIChkb1JlZmV0Y2hDYXRlZ29yaWVzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGRvUmVmZXRjaENhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZmV0Y2hDYXRlZ29yaWVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNhdGVnb3J5LCBzY2hlbWEsIGNsZWFyRmlsdGVyLCBjaGVja1NjaGVtYUZpbHRlclN0aWxsVmFsaWQgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgJiYgIWNoZWNrU2NoZW1hRmlsdGVyU3RpbGxWYWxpZChzY2hlbWEsIGNhdGVnb3J5LCBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEgpKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJGaWx0ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jaGVja1NjaGVtYUZpbHRlclN0aWxsVmFsaWQgPSAoc2NoZW1hLCBjYXRlZ29yeSwgcGFyZW50UGF0aCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHNjaGVtYS5zb21lKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5UGF0aCA9IGdldENhdGVnb3J5VUlQYXRoKHBhcmVudFBhdGgsIGl0ZW0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2F0ZWdvcnlQYXRoID09PSBjYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IGl0ZW0uY2F0ZWdvcmllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja1NjaGVtYUZpbHRlclN0aWxsVmFsaWQoaXRlbS5jYXRlZ29yaWVzLCBjYXRlZ29yeSwgY2F0ZWdvcnlQYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2xlYXJGaWx0ZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2F0ZWdvcnkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXBJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbGxvd0VkaXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBbXTtcbiAgICAgICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW5FZGl0ID0gZmFsc2U7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckNhdGVnb3JpZXM7XG4gICAgICAgIGlmIChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmZldGNoQ2F0ZWdvcmllcyhjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jaGVja0FsbG93RWRpdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKHBvcnRhbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyB3aGVuIGEgZ3JvdXAgaXMgc2VsZWN0ZWQsIHRyaWdnZXIgYSBmZXRjaCBvZiBjYXRlZ29yaWVzXG4gICAgICAgIG9uR3JvdXBJZENoYW5nZSh0aGlzLnN0b3JlLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZldGNoQ2F0ZWdvcmllcyhjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICB9KTtcbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiY2F0ZWdvcmllc1wiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5jYXRlZ29yeSA9IG51bGwpKTtcbiAgICAgICAgLy8gd2hlbiB0aGUgYnVja2V0IGlzIGNoYW5nZWQsIGl0IHdpbGwgaW1wYWN0IHdoaWNoIGNhdGVnb3JpZXMgd2Ugd2FudCB0byBzaG93LCBzbyBmZXRjaCBhZ2FpblxuICAgICAgICBvbkl0ZW1Ccm93c2VyQnVja2V0Q2hhbmdlKHRoaXMuc3RvcmUsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hDYXRlZ29yaWVzKGNvbmZpZ1N0YXRlLnBvcnRhbCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpc0FsbEdyb3VwcygpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgZ3JvdXBJZCA9IHRoaXMuZ3JvdXBJZCB8fCB0aGlzLnN0b3JlLnN0YXRlLmdyb3VwSWQ7XG4gICAgICAgIHJldHVybiAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSA9PT0gXCJncm91cFwiICYmICghZ3JvdXBJZCB8fCBncm91cElkID09PSBcImFsbFwiKTtcbiAgICB9XG4gICAgYXN5bmMgY2hlY2tBbGxvd0VkaXQoKSB7XG4gICAgICAgIGNvbnN0IHsgYWxsb3dFZGl0LCBncm91cElkIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGlmICghYWxsb3dFZGl0KSB7XG4gICAgICAgICAgICB0aGlzLmNhbkVkaXQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbkVkaXQgPSBhd2FpdCBjYW5FZGl0Q2F0ZWdvcnlTY2hlbWEoeyB1c2VyLCBwb3J0YWwsIGdyb3VwSWQgfSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmNhdGVnb3J5KSB7XG4gICAgICAgICAgICB0aGlzLmVtaXRGaWx0ZXJFdmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RvcmUub25DaGFuZ2UoXCJidWNrZXRcIiwgKCkgPT4gdGhpcy5yZWZldGNoQ2F0ZWdvcmllcygpKTtcbiAgICAgICAgdGhpcy5zdG9yZS5vbkNoYW5nZShcImdyb3VwSWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWZldGNoQ2F0ZWdvcmllcygpO1xuICAgICAgICAgICAgdGhpcy5jaGVja0FsbG93RWRpdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZW1pdEZpbHRlckV2ZW50KCkge1xuICAgICAgICBjb25zdCB7IGNhdGVnb3J5LCBpMThuIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGNhdGVnb3J5ID8gSlNPTi5zdHJpbmdpZnkoW2NhdGVnb3J5XSkgOiBcIlwiO1xuICAgICAgICBjb25zdCBjYXRlZ29yeUxhYmVsID0gY2F0ZWdvcnkgPT09IFwiX25vbmVfXCIgPyBpMThuLnVuY2F0ZWdvcml6ZWQgOiBjYXRlZ29yeSA9PT0gbnVsbCB8fCBjYXRlZ29yeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2F0ZWdvcnkucmVwbGFjZShcIi9DYXRlZ29yaWVzL1wiLCBcIlwiKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpMThuLmNhdGVnb3J5LnJlcGxhY2UoXCIke2NhdGVnb3J5fVwiLCBjYXRlZ29yeUxhYmVsKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHtcbiAgICAgICAgICAgIGlkOiBcImNhdGVnb3JpZXNcIixcbiAgICAgICAgICAgIHBhcmFtOiBcImNhdGVnb3JpZXNcIixcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICBjYXRlZ29yeVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyTmVzdGVkQ2F0ZWdvcmllcyhzY2hlbWEsIHByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHNjaGVtYS5tYXAoKGNhdGVnb3J5KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAvLyBLZWVwIGJyZWFkY3J1bWJzIG9mIGNhdGVnb3JpZXMnIGFuY2VzdHJ5XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByZXZpb3VzVmFsdWVcbiAgICAgICAgICAgICAgICA/IGAke3ByZXZpb3VzVmFsdWV9LyR7Y2F0ZWdvcnkudGl0bGV9YFxuICAgICAgICAgICAgICAgIDogYC9DYXRlZ29yaWVzLyR7Y2F0ZWdvcnkudGl0bGV9YDtcbiAgICAgICAgICAgIGNvbnN0IGhhc0NoaWxkcmVuID0gISEoKF9hID0gY2F0ZWdvcnkuY2F0ZWdvcmllcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCk7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS12YWx1ZVwiOiB2YWx1ZSwgXCJkYXRhLWNoaWxkcmVuXCI6IGhhc0NoaWxkcmVuLCBzZWxlY3RlZDogdGhpcy5jYXRlZ29yeSA9PT0gdmFsdWUsIGtleTogYCR7dmFsdWV9LS0ke2hhc0NoaWxkcmVufWAgfSwgaChcImFcIiwgbnVsbCwgY2F0ZWdvcnkudGl0bGUpLCBoYXNDaGlsZHJlbiAmJiAoaChcImNhbGNpdGUtdHJlZVwiLCB7IHNsb3Q6IFwiY2hpbGRyZW5cIiwgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiIH0sIHRoaXMucmVuZGVyTmVzdGVkQ2F0ZWdvcmllcyhjYXRlZ29yeS5jYXRlZ29yaWVzLCB2YWx1ZSkpKSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgY29uc3QgeyBsb2FkaW5nLCBzY2hlbWEsIGFsbG93RWRpdCwgY2FuRWRpdCwgaTE4biwgcmVuZGVyU2NoZW1hRWRpdG9yIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBoYXNTY2hlbWEgPSAoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2NoZW1hLmxlbmd0aCkgPiAwO1xuICAgICAgICBpZiAobG9hZGluZyB8fFxuICAgICAgICAgICAgKCFoYXNTY2hlbWEgJiYgIWFsbG93RWRpdCkgfHxcbiAgICAgICAgICAgIHRoaXMuaXNBbGxHcm91cHMoKSB8fFxuICAgICAgICAgICAgKGlzUHVibGljVXNlcihjb25maWdTdGF0ZS51c2VyKSAmJiAoKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLmJ1Y2tldCkgIT09IFwiZ3JvdXBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi5jYXRlZ29yaWVzLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuY2F0ZWdvcnksIGZpbHRlcklEOiBcImNhdGVnb3JpZXNcIiwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYXRlZ29yeSA9IG51bGw7XG4gICAgICAgICAgICB9IH0sIGhhc1NjaGVtYSA/IChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhc2V0ID0gKF9iID0gKF9hID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSAoZGF0YXNldCA9PT0gbnVsbCB8fCBkYXRhc2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhc2V0LnZhbHVlKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhdGVnb3J5ID09PSBjYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICAgICAgICAgIH0gfSwgISEodGhpcy5ncm91cElkIHx8IHRoaXMuc3RvcmUuc3RhdGUuZ3JvdXBJZCkgJiYgKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS12YWx1ZVwiOiBcIl9ub25lX1wiLCBzZWxlY3RlZDogdGhpcy5jYXRlZ29yeSA9PT0gXCJfbm9uZV9cIiB9LCBoKFwiYVwiLCBudWxsLCBpMThuLnVuY2F0ZWdvcml6ZWQpKSksIHRoaXMucmVuZGVyTmVzdGVkQ2F0ZWdvcmllcyhzY2hlbWEpKSkgOiAoaChcImRpdlwiLCBudWxsLCBoKFwicFwiLCB7IGNsYXNzOiBcIm5vLWNhdGVnb3J5LXRpdGxlXCIgfSwgaTE4bi5ub0NhdGVnb3JpZXNUaXRsZSksIGgoXCJwXCIsIHsgY2xhc3M6IFwibm8tY2F0ZWdvcnktZGVzY3JpcHRpb25cIiB9LCBpMThuLm5vQ2F0ZWdvcmllcyksIGNhbkVkaXQgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiBcImFkZC1jYXRlZ29yeS1idXR0b25cIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lXCIsIGNvbG9yOiBcImJsdWVcIiwgb25DbGljazogKCkgPT4gKHRoaXMuaXNFZGl0aW5nID0gdHJ1ZSkgfSwgaTE4bi5zZXR1cENhdGVnb3JpZXMpKSkpLCBoYXNTY2hlbWEgJiYgYWxsb3dFZGl0ICYmIGNhbkVkaXQgJiYgKChfYyA9IChfYiA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdGF0ZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmJ1Y2tldCkgIT09IFwibGl2aW5nIGF0bGFzXCIgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGljb25TdGFydDogXCJwZW5jaWxcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2xvdDogXCJhY3Rpb25cIiwgb25DbGljazogKCkgPT4gKHRoaXMuaXNFZGl0aW5nID0gdHJ1ZSkgfSkpKSwgcmVuZGVyU2NoZW1hRWRpdG9yKCkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyQ2F0ZWdvcmllcy5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyQ2F0ZWdvcmllc0NzcztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hDb2xsYWJvcmF0aW9ucyhwb3J0YWwpIHtcbiAgICBjb25zdCByZXN0QmFzZVVybCA9IGdldFBvcnRhbFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3QgeyBjb2xsYWJvcmF0aW9ucyB9ID0gYXdhaXQgcmVxdWVzdChgJHtyZXN0QmFzZVVybH1wb3J0YWxzL3NlbGYvY29sbGFib3JhdGlvbnNTdW1tYXJ5YCwge1xuICAgICAgICBpbmNsdWRlUGFydGljaXBhbnRJbmZvOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbGxhYm9yYXRpb25zO1xufVxuLy8gZ2V0cyB0aGUgY29sbGFib3JhdGVkIGl0ZW1zIGFuZCByZXR1cm5zIGp1c3QgdGhlIHVuaXF1ZSBpdGVtIGlkcyBmb3IgdGhhdCBjb2xsYWJvcmF0aW9uIGFzIGFuIGFycmF5XG5hc3luYyBmdW5jdGlvbiBmZXRjaENvbGxhYm9yYXRlZEl0ZW1zKGNvbGxhYm9yYXRpb25JZCwgcGFydGljaXBhbnRJZCwgcG9ydGFsKSB7XG4gICAgY29uc3QgcmVzdEJhc2VVcmwgPSBnZXRQb3J0YWxSZXN0QmFzZVVybChwb3J0YWwpO1xuICAgIGNvbnN0IHsgY29sbGFib3JhdGVkSXRlbXMgfSA9IGF3YWl0IHJlcXVlc3QoYCR7cmVzdEJhc2VVcmx9cG9ydGFscy9zZWxmL2NvbGxhYm9yYXRlZEl0ZW1zYCwgT2JqZWN0LmFzc2lnbih7IGNvbGxhYm9yYXRpb25JZCB9LCAocGFydGljaXBhbnRJZCA/IHsgcGFydGljaXBhbnRJZCB9IDoge30pKSk7XG4gICAgaWYgKGNvbGxhYm9yYXRlZEl0ZW1zID09PSBudWxsIHx8IGNvbGxhYm9yYXRlZEl0ZW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2xsYWJvcmF0ZWRJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGNvbGxhYm9yYXRlZEl0ZW1zLm1hcCgoZW50cnkpID0+IE9iamVjdC5rZXlzKGVudHJ5KVswXSk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbn1cbi8vIExvb2tzIHVwIGl0ZW1zIHVzZWQgaW4gYSBjb2xsYWJvcmF0aW9uLCByZXR1cm5zIGFuIGFycmF5IG9mIGl0ZW0gaWRzXG5hc3luYyBmdW5jdGlvbiBmZXRjaENvbGxhYm9yYXRpb25Db250ZW50KGNvbGxhYm9yYXRpb25JZCwgcGFydGljaXBhbnRJZCwgcG9ydGFsKSB7XG4gICAgcmV0dXJuIGZyb21DYWNoZSgoKSA9PiBmZXRjaENvbGxhYm9yYXRlZEl0ZW1zKGNvbGxhYm9yYXRpb25JZCwgcGFydGljaXBhbnRJZCwgcG9ydGFsKSwgXCJjb2xsYWJvcmF0aW9uQ29udGVudFwiLCBgJHtjb2xsYWJvcmF0aW9uSWR9LyR7cGFydGljaXBhbnRJZH1gKTtcbn1cblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJDb2xsYWJvcmF0aW9ucyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmxvYWRDb2xsYWJvcmF0aW9ucyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcG9ydGFsLCB1c2VyLCBjb25maWcsIHN1YnNjcmlwdGlvbkluZm8gfSA9IGNvbmZpZ1N0YXRlICE9PSBudWxsICYmIGNvbmZpZ1N0YXRlICE9PSB2b2lkIDAgPyBjb25maWdTdGF0ZSA6IHt9O1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbGxhYm9yYXRpb25zICYmXG4gICAgICAgICAgICAgICAgcG9ydGFsICYmXG4gICAgICAgICAgICAgICAgdXNlciAmJlxuICAgICAgICAgICAgICAgICFpc1B1YmxpY1VzZXIodXNlcikgJiZcbiAgICAgICAgICAgICAgICBjYW5NYW5hZ2VDb2xsYWJvcmF0aW9ucyhjb25maWcsIHVzZXIsIHBvcnRhbCwgc3Vic2NyaXB0aW9uSW5mbykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxhYm9yYXRpb25zID0gYXdhaXQgZmV0Y2hDb2xsYWJvcmF0aW9ucyhjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNvbGxhYm9yYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGFydGljaXBhbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29sbGFib3JhdGlvbk5hbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29sbGFib3JhdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckNvbGxhYm9yYXRpb25zO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5jb2xsYWJvcmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9hZENvbGxhYm9yYXRpb25zKCk7XG4gICAgICAgIG9uQ29uZmlnQ2hhbmdlKFwicG9ydGFsXCIsIHRoaXMubG9hZENvbGxhYm9yYXRpb25zKTtcbiAgICAgICAgb25Db25maWdDaGFuZ2UoXCJ1c2VyXCIsIHRoaXMubG9hZENvbGxhYm9yYXRpb25zKTtcbiAgICAgICAgb25Db25maWdDaGFuZ2UoXCJzdWJzY3JpcHRpb25JbmZvXCIsIHRoaXMubG9hZENvbGxhYm9yYXRpb25zKTtcbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiY29sbGFib3JhdGlvbnNcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuY29sbGFib3JhdGlvbiA9IG51bGwpKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIGNvbnN0IHsgY29sbGFib3JhdGlvbiwgcGFydGljaXBhbnQsIGNvbGxhYm9yYXRpb25OYW1lLCBpMThuIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIWNvbGxhYm9yYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IFwiY29sbGFib3JhdGlvbnNcIixcbiAgICAgICAgICAgICAgICBwYXJhbTogXCJxXCIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiXCIsXG4gICAgICAgICAgICAgICAgY29sbGFib3JhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBpZDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBmZXRjaENvbGxhYm9yYXRpb25Db250ZW50KGNvbGxhYm9yYXRpb24sIHBhcnRpY2lwYW50LCBjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudFN1ZmZpeCA9IHBhcnRpY2lwYW50ID8gYF9fJHtwYXJ0aWNpcGFudH1gIDogXCJcIjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBcImNvbGxhYm9yYXRpb25zXCIsXG4gICAgICAgICAgICBwYXJhbTogXCJxXCIsXG4gICAgICAgICAgICB2YWx1ZTogaXRlbXMgPyBgaWQ6KCR7aXRlbXMuam9pbihcIiBPUiBcIil9KWAgOiBcIlwiLFxuICAgICAgICAgICAgbGFiZWw6IGNvbGxhYm9yYXRpb25OYW1lID8gaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtuYW1lfVwiLCB0aGlzLmNvbGxhYm9yYXRpb25OYW1lKSA6IFwiXCIsXG4gICAgICAgICAgICBjb2xsYWJvcmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGNvbGxhYm9yYXRpb24sXG4gICAgICAgICAgICAgICAgbmFtZTogY29sbGFib3JhdGlvbk5hbWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRpdGlvbmFsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgb3JpZ2luOiBgJHtjb2xsYWJvcmF0aW9ufSR7cGFydGljaXBhbnRTdWZmaXh9YFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBhc3luYyBlbWl0RXZlbnQoKSB7XG4gICAgICAgIGNvbnN0IGRldGFpbCA9IGF3YWl0IHRoaXMuZ2V0RXZlbnREZXRhaWwoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KGRldGFpbCk7XG4gICAgfVxuICAgIHJlbmRlclBhcnRpY2lwYW50KHBhcnRpY2lwYW50LCBjb2xsYWJvcmF0aW9uSWQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBbaWQsIG5hbWVdID0gT2JqZWN0LmVudHJpZXMocGFydGljaXBhbnQpWzBdO1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudElkID0gYCR7Y29sbGFib3JhdGlvbklkfS8ke2lkfWA7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLWlkXCI6IHBhcnRpY2lwYW50SWQsIFwiZGF0YS1uYW1lXCI6IG5hbWUsIHNlbGVjdGVkOiAoX2EgPSB0aGlzLmNvbGxhYm9yYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhwYXJ0aWNpcGFudElkKSB9LCBoKFwiYVwiLCBudWxsLCBuYW1lKSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCB1c2VyLCBwb3J0YWwsIHN1YnNjcmlwdGlvbkluZm8gfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBjb25zdCB7IGNvbGxhYm9yYXRpb25zIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIXVzZXIgfHxcbiAgICAgICAgICAgICFjYW5NYW5hZ2VDb2xsYWJvcmF0aW9ucyhjb25maWcsIHVzZXIsIHBvcnRhbCwgc3Vic2NyaXB0aW9uSW5mbykgfHxcbiAgICAgICAgICAgICEoY29sbGFib3JhdGlvbnMgPT09IG51bGwgfHwgY29sbGFib3JhdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbGxhYm9yYXRpb25zLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmNvbGxhYm9yYXRpb24sIGZpbHRlcklEOiBcImNvbGxhYm9yYXRpb25zXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXTtcbiAgICAgICAgICAgICAgICBjb25zdCBbY29sbGFib3JhdGlvbklkLCBwYXJ0aWNpcGFudElkXSA9IChfYiA9IGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5kYXRhc2V0LmlkLnNwbGl0KFwiL1wiKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgICAgICAgICAgY29uc3QgY29sbGFib3JhdGlvbk5hbWUgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uZGF0YXNldC5uYW1lO1xuICAgICAgICAgICAgICAgIGlmICghY29sbGFib3JhdGlvbk5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2xsYWJvcmF0aW9uID09PSBjb2xsYWJvcmF0aW9uSWQgJiZcbiAgICAgICAgICAgICAgICAgICAgKCFwYXJ0aWNpcGFudElkIHx8IHBhcnRpY2lwYW50SWQgPT09IHRoaXMucGFydGljaXBhbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbk5hbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2lwYW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGFib3JhdGlvbiA9IGNvbGxhYm9yYXRpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsYWJvcmF0aW9uTmFtZSA9IGNvbGxhYm9yYXRpb25OYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2lwYW50ID0gcGFydGljaXBhbnRJZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0RXZlbnQoKTtcbiAgICAgICAgICAgIH0gfSwgY29sbGFib3JhdGlvbnMubWFwKCh7IGNvbGxhYm9yYXRpb25JZCwgY29sbGFib3JhdGlvbk5hbWUsIHBhcnRpY2lwYW50cyB9KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1pZFwiOiBjb2xsYWJvcmF0aW9uSWQsIFwiZGF0YS1uYW1lXCI6IGNvbGxhYm9yYXRpb25OYW1lLCBzZWxlY3RlZDogKF9hID0gdGhpcy5jb2xsYWJvcmF0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoY29sbGFib3JhdGlvbklkKSB9LCBoKFwiYVwiLCBudWxsLCBjb2xsYWJvcmF0aW9uTmFtZSksIChwYXJ0aWNpcGFudHMgPT09IG51bGwgfHwgcGFydGljaXBhbnRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJ0aWNpcGFudHMubGVuZ3RoKSAmJiAoaChcImNhbGNpdGUtdHJlZVwiLCB7IHNsb3Q6IFwiY2hpbGRyZW5cIiB9LCAocGFydGljaXBhbnRzIHx8IFtdKS5tYXAoKHBhcnRpY2lwYW50KSA9PiB0aGlzLnJlbmRlclBhcnRpY2lwYW50KHBhcnRpY2lwYW50LCBjb2xsYWJvcmF0aW9uSWQpKSkpKSk7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbnRlbnRTdGF0dXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5jb250ZW50U3RhdHVzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJDb250ZW50U3RhdHVzO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50U3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJjb250ZW50U3RhdHVzXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLmNvbnRlbnRTdGF0dXMgPSBudWxsKSk7XG4gICAgfVxuICAgIGdldEV2ZW50RGV0YWlsKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgY29udGVudFN0YXR1cywgaTE4biB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyB1c2VyLCBwb3J0YWwgfSA9IGNvbmZpZ1N0YXRlO1xuICAgICAgICBjb25zdCBvcmdJZCA9IHBvcnRhbCAmJiAhcG9ydGFsLmlzUG9ydGFsID8gYCBvcmdpZDoke3BvcnRhbC5pZH1gIDogXCJcIjtcbiAgICAgICAgY29uc3Qgb3JnTWVtYmVyID0gdXNlciAmJiAhaXNQdWJsaWNVc2VyKHVzZXIpO1xuICAgICAgICBjb25zdCBvcmdBdXRob3JpdGF0aXZlUXVlcnkgPSBgKChjb250ZW50c3RhdHVzOm9yZ19hdXRob3JpdGF0aXZlJHtvcmdJZH0pIE9SIGNvbnRlbnRzdGF0dXM6cHVibGljX2F1dGhvcml0YXRpdmUpYDtcbiAgICAgICAgY29uc3QgdmFsdWVzID0ge1xuICAgICAgICAgICAgYXV0aG9yaXRhdGl2ZTogb3JnTWVtYmVyID8gb3JnQXV0aG9yaXRhdGl2ZVF1ZXJ5IDogXCJjb250ZW50c3RhdHVzOnB1YmxpY19hdXRob3JpdGF0aXZlXCIsXG4gICAgICAgICAgICBkZXByZWNhdGVkOiBcImNvbnRlbnRzdGF0dXM6ZGVwcmVjYXRlZFwiXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJjb250ZW50U3RhdHVzXCIsXG4gICAgICAgICAgICBwYXJhbTogXCJmaWx0ZXJcIixcbiAgICAgICAgICAgIHZhbHVlOiAoX2EgPSB2YWx1ZXNbY29udGVudFN0YXR1c10pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCIsXG4gICAgICAgICAgICBsYWJlbDogY29udGVudFN0YXR1cyA/IGkxOG4ubGFiZWwucmVwbGFjZShcIiR7Y29udGVudFN0YXR1c31cIiwgaTE4bltjb250ZW50U3RhdHVzXSkgOiBcIlwiLFxuICAgICAgICAgICAgY29udGVudFN0YXR1c1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHN0YXR1c2VzID0gW1wiYXV0aG9yaXRhdGl2ZVwiLCBcImRlcHJlY2F0ZWRcIl07XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmNvbnRlbnRTdGF0dXMsIGZpbHRlcklEOiBcImNvbnRlbnRTdGF0dXNcIiwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50U3RhdHVzID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHNjYWxlOiBcIm1cIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRTdGF0dXMgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uZGF0YXNldC5jb250ZW50U3RhdHVzO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRTdGF0dXMgPT09IGNvbnRlbnRTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZW50U3RhdHVzID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGVudFN0YXR1cyA9IGNvbnRlbnRTdGF0dXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICAgICAgfSB9LCBzdGF0dXNlcy5tYXAoKHN0YXR1cykgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1jb250ZW50LXN0YXR1c1wiOiBzdGF0dXMsIHNlbGVjdGVkOiBzdGF0dXMgPT09IHRoaXMuY29udGVudFN0YXR1cyB9LCBoKFwiYVwiLCBudWxsLCB0aGlzLmkxOG5bc3RhdHVzXSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRGF0ZSA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLnByb3BlcnR5ID0gXCJtb2RpZmllZFwiO1xuICAgICAgICB0aGlzLnJhbmdlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXJ0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmVuZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIH1cbiAgICBnZXRFdmVudERldGFpbChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBwYXJhbTogXCJxXCIgfSwgZGV0YWlsKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHByb3BlcnR5LCByYW5nZSwgc3RhcnQsIGVuZCwgc3RvcmUsIGV4cGFuZGVkIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXItZGF0ZVwiLCB7IHNlcnZlclByb3BlcnR5OiBwcm9wZXJ0eSA9PT0gXCJtb2RpZmllZFwiID8gcHJvcGVydHkgOiBcInVwbG9hZGVkXCIsIHByb3BlcnR5OiB0aGlzLnByb3BlcnR5LCBzdG9yZTogc3RvcmUsIHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIHJhbmdlOiByYW5nZSwgZXhwYW5kZWQ6IGV4cGFuZGVkLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXI6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoZS5kZXRhaWwpKTtcbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudENzcyA9IFwiLmZpbHRlci1leHRlbnR7bWFyZ2luLWJvdHRvbTowLjVyZW07ZGlzcGxheTpmbGV4O3dpZHRoOjEwMCV9LmZpbHRlci1leHRlbnRfX2xhYmVse2ZsZXg6MSAxIDAlfS5maWx0ZXItZXh0ZW50X19zd2l0Y2h7cGFkZGluZy1sZWZ0OjAuMjVyZW07cGFkZGluZy1yaWdodDowLjI1cmVtfS5maWx0ZXItZXh0ZW50LS1wYWRkZWR7Ym94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmctbGVmdDoxcmVtO3BhZGRpbmctcmlnaHQ6MXJlbTtwYWRkaW5nLXRvcDowcHg7cGFkZGluZy1ib3R0b206MC41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmV4dGVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jaGVja2VkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBlbWl0Q2hlY2tlZENoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgfVxuICAgIGVtaXRFeHRlbnRDaGFuZ2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckV4dGVudDtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZXh0ZW50ICYmIHRoaXMuY2hlY2tlZCkge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgIH1cbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiZXh0ZW50XCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLmNoZWNrZWQgPSBmYWxzZSkpO1xuICAgIH1cbiAgICBnZXRFdmVudERldGFpbCgpIHtcbiAgICAgICAgY29uc3QgeyBleHRlbnQsIGNoZWNrZWQsIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJleHRlbnRcIixcbiAgICAgICAgICAgIHBhcmFtOiBcImJib3hcIixcbiAgICAgICAgICAgIHZhbHVlOiBjaGVja2VkICYmIGV4dGVudCA/IGV4dGVudCA6IFwiXCIsXG4gICAgICAgICAgICBsYWJlbDogZXh0ZW50ICYmIGNoZWNrZWQgPyBpMThuLmxhYmVsIDogXCJcIixcbiAgICAgICAgICAgIGV4dGVudFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IHsgXCJmaWx0ZXItZXh0ZW50XCI6IHRydWUsIFwiZmlsdGVyLWV4dGVudC0tcGFkZGVkXCI6IChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnBhbmVsIH0gfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBsYXlvdXQ6IFwiaW5saW5lXCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJmaWx0ZXItZXh0ZW50X19sYWJlbFwiIH0sIHRoaXMuaTE4bi50aXRsZSksIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IGNsYXNzOiBcImZpbHRlci1leHRlbnRfX3N3aXRjaFwiLCBjaGVja2VkOiB0aGlzLmNoZWNrZWQsIG9uQ2FsY2l0ZVN3aXRjaENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSBlLnRhcmdldC5jaGVja2VkO1xuICAgICAgICAgICAgfSB9KSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcImNoZWNrZWRcIjogW1wiZW1pdENoZWNrZWRDaGFuZ2VcIl0sXG4gICAgICAgIFwiZXh0ZW50XCI6IFtcImVtaXRFeHRlbnRDaGFuZ2VcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJFeHRlbnQuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudENzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJGb2xkZXJDc3MgPSBcIi5oaWRlLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntkaXNwbGF5Om5vbmV9LmZvbGRlcnMuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye21heC1oZWlnaHQ6MTYuNXJlbTttaW4taGVpZ2h0OjRyZW07cG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDowO292ZXJmbG93OmF1dG87cGFkZGluZy10b3A6Mi41cmVtfS5mb2xkZXItYWN0aW9uLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntvcGFjaXR5OjA7bWFyZ2luOjJweH0uZm9sZGVyLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcjpob3ZlciAuZm9sZGVyLWFjdGlvbi5zYy1hcmNnaXMtaXRlbS1icm93c2VyLWZpbHRlci1mb2xkZXIsLmZvbGRlci5zYy1hcmNnaXMtaXRlbS1icm93c2VyLWZpbHRlci1mb2xkZXI6Zm9jdXMtd2l0aGluIC5mb2xkZXItYWN0aW9uLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntvcGFjaXR5OjF9Y2FsY2l0ZS1saXN0LWl0ZW0uc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVyOm5vdChbc2VsZWN0ZWRdKXstLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xOnZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZCl9LnJlY3ljbGUtYmluLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntwb3NpdGlvbjpzdGlja3k7Ym90dG9tOjBweH0udG9vbHRpcC5zYy1hcmNnaXMtaXRlbS1icm93c2VyLWZpbHRlci1mb2xkZXJ7bWFyZ2luOjBweDtwYWRkaW5nOjBweH0uZm9sZGVyLWVkaXQuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye3Bvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6ZmxleH0uZm9sZGVyLWVkaXRfX2lucHV0LnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjA7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjIuNXJlbTt3aWR0aDoxMDAlO2JvcmRlci1zdHlsZTpub25lO3BhZGRpbmctdG9wOjFyZW07cGFkZGluZy1ib3R0b206MXJlbTtwYWRkaW5nLWlubGluZS1lbmQ6MC41cmVtO3BhZGRpbmctaW5saW5lLXN0YXJ0OjMuNXJlbTtmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7LS10dy1zaGFkb3c6MCAwICMwMDAwOy0tdHctc2hhZG93LWNvbG9yZWQ6MCAwICMwMDAwO2JveC1zaGFkb3c6dmFyKC0tdHctcmluZy1vZmZzZXQtc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1yaW5nLXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctc2hhZG93KTt0cmFuc2l0aW9uLXByb3BlcnR5OmNvbG9yLCBiYWNrZ3JvdW5kLWNvbG9yLCBib3JkZXItY29sb3IsIHRleHQtZGVjb3JhdGlvbi1jb2xvciwgZmlsbCwgc3Ryb2tlLCBvcGFjaXR5LCBib3gtc2hhZG93LCB0cmFuc2Zvcm0sIGZpbHRlciwgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI7dHJhbnNpdGlvbi1wcm9wZXJ0eTpjb2xvciwgYmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCB0ZXh0LWRlY29yYXRpb24tY29sb3IsIGZpbGwsIHN0cm9rZSwgb3BhY2l0eSwgYm94LXNoYWRvdywgdHJhbnNmb3JtLCBmaWx0ZXIsIGJhY2tkcm9wLWZpbHRlcjt0cmFuc2l0aW9uLXByb3BlcnR5OmNvbG9yLCBiYWNrZ3JvdW5kLWNvbG9yLCBib3JkZXItY29sb3IsIHRleHQtZGVjb3JhdGlvbi1jb2xvciwgZmlsbCwgc3Ryb2tlLCBvcGFjaXR5LCBib3gtc2hhZG93LCB0cmFuc2Zvcm0sIGZpbHRlciwgYmFja2Ryb3AtZmlsdGVyLCAtd2Via2l0LWJhY2tkcm9wLWZpbHRlcjt0cmFuc2l0aW9uLWR1cmF0aW9uOjE1MG1zO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xKTttYXJnaW4taW5saW5lLWVuZDotMXB4O2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7Zm9udC1mYW1pbHk6aW5oZXJpdH0uZm9sZGVyLWVkaXRfX2lucHV0LnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcjpmb2N1c3stLXR3LXNoYWRvdzowIDAgIzAwMDA7LS10dy1zaGFkb3ctY29sb3JlZDowIDAgIzAwMDA7Ym94LXNoYWRvdzp2YXIoLS10dy1yaW5nLW9mZnNldC1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXJpbmctc2hhZG93LCAwIDAgIzAwMDApLCB2YXIoLS10dy1zaGFkb3cpO291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9LmZvbGRlci1lZGl0X19pY29uLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcntwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDowcHg7bWFyZ2luLWxlZnQ6MXJlbTttYXJnaW4tcmlnaHQ6MXJlbTttYXJnaW4tdG9wOjAuNzVyZW07bWFyZ2luLWJvdHRvbTowLjc1cmVtfS5oZWFkZXIuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye21hcmdpbjowcHg7cGFkZGluZzowcHg7Zm9udC1zaXplOjEuMjVyZW07Zm9udC13ZWlnaHQ6NDAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0uaGVhZGxpbmUuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZm9sZGVye21hcmdpbjowcHg7cGFkZGluZzowcHg7cGFkZGluZy1ib3R0b206MC41cmVtO2ZvbnQtc2l6ZToxcmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmRlc2NyaXB0aW9uLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWZvbGRlcnttYXJnaW46MHB4O3BhZGRpbmc6MHB4O2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckZvbGRlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmhvdmVyZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mb2xkZXIgPSBcImFsbFwiO1xuICAgICAgICB0aGlzLnNob3dSZWN5Y2xlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsbG93RWRpdHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZm9sZGVycyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRFZGl0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRlbGV0ZUZvbGRlcklkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNyZWF0ZU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2xvc2luZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jcmVhdGVUaXRsZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZGVsZXRlT3BlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kZWxldGVDbG9zaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudG9vbHRpcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50b29sdGlwUmVmZXJlbmNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kZWxldGVJdGVtc01vZGFsUmVmID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRlbGV0ZUZvbGRlckNvbnRlbnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZUZvbGRlcnMoKSB7XG4gICAgICAgIHRoaXMuZmV0Y2hVc2VyRm9sZGVycyhjb25maWdTdGF0ZS51c2VyKTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVyRm9sZGVyO1xuICAgICAgICBpZiAoY29uZmlnU3RhdGUudXNlcikge1xuICAgICAgICAgICAgdGhpcy5mZXRjaFVzZXJGb2xkZXJzKGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb25Db25maWdDaGFuZ2UoXCJ1c2VyXCIsICh1c2VyKSA9PiB0aGlzLmZldGNoVXNlckZvbGRlcnModXNlcikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICAvLyBpZiB3ZSdyZSBuYXZpZ2F0aW5nIGJhY2sgdG8gdGhlIGZvbGRlciBwaWNrZXIgYnV0IHdlIGFscmVhZHkgaGFkIHNlbGVjdGVkIGEgZm9sZGVyLCByZXN0b3JlIGl0XG4gICAgICAgIGlmICgoX2MgPSAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5maWx0ZXJzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZm9sZGVyKSB7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IHRoaXMuc3RvcmUuc3RhdGUuZmlsdGVycy5mb2xkZXIuZm9sZGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmZvbGRlciAmJiB0aGlzLmZvbGRlciAhPT0gXCJhbGxcIikge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kZWQgJiYgdGhpcy5hY2NvcmRpb25JdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmFjY29yZGlvbkl0ZW0uZXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcImZvbGRlclwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5mb2xkZXIgPSBcImFsbFwiKSk7XG4gICAgfVxuICAgIGdldEV2ZW50RGV0YWlsKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgZm9sZGVyIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBmb2xkZXJOYW1lID0gZm9sZGVyID09PSBjb25maWdTdGF0ZS51c2VyLnVzZXJuYW1lID8gXCJyb290XCIgOiBmb2xkZXI7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyID0gKF9hID0gdGhpcy5mb2xkZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgoZikgPT4gZi5pZCA9PT0gZm9sZGVyKTtcbiAgICAgICAgY29uc3QgZm9sZGVyVGl0bGUgPSAoc2VsZWN0ZWRGb2xkZXIgPT09IG51bGwgfHwgc2VsZWN0ZWRGb2xkZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdGVkRm9sZGVyLnRpdGxlKSB8fCBcIlwiO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGZvbGRlciAhPT0gXCJhbGxcIiA/IGBvd25lcmZvbGRlcjoke2ZvbGRlck5hbWV9YCA6IFwiXCI7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJmb2xkZXJcIixcbiAgICAgICAgICAgIHBhcmFtOiBcInFcIixcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgbGFiZWw6IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHtmb2xkZXJ9XCIsIGZvbGRlclRpdGxlKSxcbiAgICAgICAgICAgIGZvbGRlcixcbiAgICAgICAgICAgIGZvbGRlckRhdGE6IHNlbGVjdGVkRm9sZGVyXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJlc2V0RWRpdCgpIHtcbiAgICAgICAgdGhpcy5pbmxpbmVFZGl0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdXJyZW50RWRpdCA9IG51bGw7XG4gICAgfVxuICAgIC8vIGNsb3NlIHRoZSBkaWFsb2csIGFuZCB0aGVuIGNsZWFyIGxvY2FsIHN0YXRlXG4gICAgYXN5bmMgcmVzZXRDcmVhdGUoKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2xvc2luZyA9IHRydWU7XG4gICAgICAgIGF3YWl0IHRpbWVvdXQoMjUwKTtcbiAgICAgICAgdGhpcy5jcmVhdGVPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2xvc2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jcmVhdGVUaXRsZSA9IFwiXCI7XG4gICAgfVxuICAgIGFzeW5jIHJlc2V0RGVsZXRlKCkge1xuICAgICAgICB0aGlzLmRlbGV0ZUNsb3NpbmcgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aW1lb3V0KDI1MCk7XG4gICAgICAgIHRoaXMuZGVsZXRlT3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRlbGV0ZUNsb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGVsZXRlRm9sZGVySWQgPSBcIlwiO1xuICAgIH1cbiAgICBhc3luYyBzZXRUb29sdGlwKHRleHQsIGVsLCBob3Zlcikge1xuICAgICAgICAvLyBmYXN0IG1vdmVtZW50cyBvdmVyIGFuIGVsZW1lbnQgd2lsbCBnaXZlIGEgbW91c2Ugb3ZlciBldmVudCwgYnV0IHRvb2x0aXAgd29uJ3QgaGF2ZSB0aW1lIHRvIHJlZ2lzdGVyIHRoZSBtb3VzZSBvdXRcbiAgICAgICAgLy8gdG8gYXZvaWQgdGhhdCwgd2FpdCBhIGJpdCBvbiBob3ZlciBldmVudHMgcHJpb3IgdG8gc2V0dGluZyB1cCB0aGUgdG9vbHRpcFxuICAgICAgICBpZiAoaG92ZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoNDApO1xuICAgICAgICAgICAgaWYgKCFlbC5tYXRjaGVzKGAke2VsLnRhZ05hbWV9OmhvdmVyYCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b29sdGlwID0gdGV4dDtcbiAgICAgICAgdGhpcy50b29sdGlwUmVmZXJlbmNlRWxlbWVudCA9IGVsO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQgJiYgKCFob3ZlciB8fCBlbC5tYXRjaGVzKGAke2VsLnRhZ05hbWV9OmhvdmVyYCkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b29sdGlwRWxlbWVudC5vcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyBhcyBhIGZhaWxzYWZlLCBhdHRhY2ggYSBtb3VzZSBvdXQgZXZlbnQgdG8gdGhlIHJlZmVyZW5jZSBlbGVtZW50IGFzIGNhbGNpdGUgdG9vbHRpcCBkb2Vzbid0IGFsd2F5cyBjbGVhbiB1cCBjb3JyZWN0bHlcbiAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXBSZWZlcmVuY2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMjAwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9vbHRpcFJlZmVyZW5jZUVsZW1lbnQgPT09IGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50Lm9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcFJlZmVyZW5jZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXBFbGVtZW50Lm9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgY3JlYXRlRm9sZGVyKCkge1xuICAgICAgICAvLyBUT0RPOiBoYW5kbGUgbWlzc2luZyBvciBpbnZhbGlkIHRpdGxlLCBwb3NzaWJsZSBlcnJvcnNcbiAgICAgICAgaWYgKHRoaXMuY3JlYXRlVGl0bGUpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICAgICAgICBhd2FpdCBjcmVhdGVGb2xkZXIodGhpcy5jcmVhdGVUaXRsZSwgY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgICAgICB0aGlzLnJlc2V0Q3JlYXRlKCk7XG4gICAgICAgICAgICAvLyByZXNldCB0aGUgbGlzdCBvZiBmb2xkZXJzXG4gICAgICAgICAgICB0aGlzLmZldGNoVXNlckZvbGRlcnMoY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlRm9sZGVyKGZvbGRlcikge1xuICAgICAgICAvLyBvcHRpbWlzdGljYWxseSB1cGRhdGUgdGhlIGZvbGRlciB0aXRsZSBpbiB0aGUgZG9tXG4gICAgICAgIHRoaXMuZm9sZGVycyA9IHRoaXMuZm9sZGVycy5tYXAoKGV4aXN0aW5nRm9sZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdGb2xkZXIuaWQgPT0gZm9sZGVyLmlkKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmdGb2xkZXIudGl0bGUgPSB0aGlzLmN1cnJlbnRFZGl0LnRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nRm9sZGVyO1xuICAgICAgICB9KTtcbiAgICAgICAgdXBkYXRlRm9sZGVyKGZvbGRlci5pZCwgdGhpcy5jdXJyZW50RWRpdC50aXRsZSwgY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgIHRoaXMucmVzZXRFZGl0KCk7XG4gICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvcnMgaGVyZVxuICAgIH1cbiAgICBhc3luYyBmZXRjaFVzZXJGb2xkZXJzKHVzZXIpIHtcbiAgICAgICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGdldEZvbGRlcnModXNlcik7XG4gICAgICAgIHRoaXMuZm9sZGVycyA9IFtcbiAgICAgICAgICAgIHsgaWQ6IFwiYWxsXCIsIGNyZWF0ZWQ6IG5ldyBEYXRlKCksIHRpdGxlOiB0aGlzLmkxOG4uYWxsLCB1c2VybmFtZTogXCJcIiB9LFxuICAgICAgICAgICAgLi4uZm9sZGVyc1xuICAgICAgICBdO1xuICAgIH1cbiAgICBnZXRGb2xkZXJJY29uKGlkKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgc3dpdGNoIChpZCkge1xuICAgICAgICAgICAgY2FzZSBcImFsbFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImZvbGRlcnNcIjtcbiAgICAgICAgICAgIGNhc2UgKF9hID0gY29uZmlnU3RhdGUudXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVzZXJuYW1lOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImhvbWVcIjtcbiAgICAgICAgICAgIGNhc2UgXCJyZWN5Y2xlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwicmVjeWNsZS1iaW5cIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZm9sZGVyXCI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyTGlzdEl0ZW0oZm9sZGVyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IHRpdGxlLCBpZCB9ID0gZm9sZGVyO1xuICAgICAgICBjb25zdCBzcGVjaWFsRm9sZGVycyA9IFtcImFsbFwiLCAoX2EgPSBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXNlcm5hbWUsIFwicmVjeWNsZVwiXTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBjbGFzczogeyBmb2xkZXI6IHRydWUsIFwicmVjeWNsZS1iaW5cIjogaWQgPT09IFwicmVjeWNsZVwiIH0sIGxhYmVsOiB0aXRsZSwgdmFsdWU6IHRpdGxlLCBrZXk6IGlkLCBvbkNhbGNpdGVMaXN0SXRlbVNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRFZGl0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2xkZXIgPSBpZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgICAgIH0sIHNlbGVjdGVkOiB0aGlzLmZvbGRlciA9PT0gaWQgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IHRoaXMuZ2V0Rm9sZGVySWNvbihpZCksIHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBzY2FsZTogXCJzXCIgfSksICFzcGVjaWFsRm9sZGVycy5pbmNsdWRlcyhpZCkgJiYgKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IGNsYXNzOiBcImZvbGRlci1hY3Rpb25cIiwgaWNvbjogXCJwZW5jaWxcIiwgdGV4dDogaTE4bi5lZGl0Rm9sZGVyLCBzbG90OiBcImFjdGlvbnMtZW5kXCIsIHNjYWxlOiBcInNcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRFZGl0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RWRpdCA9IE9iamVjdC5hc3NpZ24oe30sIGZvbGRlcik7XG4gICAgICAgICAgICB9LCBvbk1vdXNlT3ZlcjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRvb2x0aXAoaTE4bi5lZGl0Rm9sZGVyLCBlLnRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBvbkZvY3VzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcChpMThuLmVkaXRGb2xkZXIsIGUudGFyZ2V0KTtcbiAgICAgICAgICAgIH0sIGlkOiBgJHtpZH0tZWRpdC1idXR0b25gIH0pLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpY29uOiBcInRyYXNoXCIsIHRleHQ6IGkxOG4uZGVsZXRlRm9sZGVyLCBzbG90OiBcImFjdGlvbnMtZW5kXCIsIGNsYXNzOiBcImZvbGRlci1hY3Rpb25cIiwgc2NhbGU6IFwic1wiLCBpZDogYCR7aWR9LWRlbGV0ZS1idXR0b25gLCBvbk1vdXNlRW50ZXI6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUb29sdGlwKGkxOG4uZGVsZXRlRm9sZGVyLCBlLnRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBvbkZvY3VzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcChpMThuLmRlbGV0ZUZvbGRlciwgZS50YXJnZXQpO1xuICAgICAgICAgICAgfSwgb25DbGljazogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlRm9sZGVySWQgPSBmb2xkZXIuaWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWxldGVPcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gfSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXJFZGl0KGZvbGRlcikge1xuICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImZvcm1cIiwgeyBjbGFzczogXCJmb2xkZXItZWRpdFwiLCBvblN1Ym1pdDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLmN1cnJlbnRFZGl0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGb2xkZXIoZm9sZGVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJpbnB1dFwiLCB7IGNsYXNzOiBcImZvbGRlci1lZGl0X19pbnB1dFwiLCB2YWx1ZTogZm9sZGVyLnRpdGxlLCBvbklucHV0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVkaXQudGl0bGUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgIH0sIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlubGluZUVkaXQgJiYgdGhpcy5jdXJyZW50RWRpdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlubGluZUVkaXQgPSBlbDtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsID09PSBudWxsIHx8IGVsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJmb2xkZXJcIiwgY2xhc3M6IFwiZm9sZGVyLWVkaXRfX2ljb25cIiwgc2NhbGU6IFwic1wiIH0pLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBpY29uU3RhcnQ6IFwieFwiLCBsYWJlbDogaTE4bi5jYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZVwiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2NhbGU6IFwibVwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLnJlc2V0RWRpdCgpLCBvbk1vdXNlRW50ZXI6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUb29sdGlwKGkxOG4uY2FuY2VsLCBlLnRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBvbkZvY3VzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcChpMThuLmNhbmNlbCwgZS50YXJnZXQpO1xuICAgICAgICAgICAgfSB9KSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgaWNvblN0YXJ0OiBcImNoZWNrXCIsIGxhYmVsOiBpMThuLnNhdmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwga2luZDogXCJicmFuZFwiLCBzY2FsZTogXCJtXCIsIHR5cGU6IFwic3VibWl0XCIsIG9uTW91c2VFbnRlcjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRvb2x0aXAoaTE4bi5zYXZlLCBlLnRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBvbkZvY3VzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcChpMThuLnNhdmUsIGUudGFyZ2V0KTtcbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyQ3JlYXRlKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4sIGVsIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtdHVubmVsXCIsIHsgcmVmZXJlbmNlOiBlbCwga2V5OiBcImNyZWF0ZS1tb2RhbFwiIH0sIGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgb3BlbjogIXRoaXMuY3JlYXRlQ2xvc2luZywgb25DYWxjaXRlTW9kYWxDbG9zZTogKCkgPT4gdGhpcy5yZXNldENyZWF0ZSgpLCBvdXRzaWRlQ2xvc2VEaXNhYmxlZDogdHJ1ZSwgc2NhbGU6IFwibVwiLCB3aWR0aFNjYWxlOiBcInNcIiB9LCBoKFwiaDJcIiwgeyBzbG90OiBcImhlYWRlclwiLCBjbGFzczogXCJoZWFkZXJcIiB9LCBpMThuLmNyZWF0ZUFGb2xkZXIpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50XCIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgaTE4bi5mb2xkZXJOYW1lLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IG9uQ2FsY2l0ZUlucHV0SW5wdXQ6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVUaXRsZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNyZWF0ZVRpdGxlICYmIGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZvbGRlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJzZWNvbmRhcnlcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgXCJkYXRhLWlkXCI6IFwiY2FuY2VsQnV0dG9uXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMucmVzZXRDcmVhdGUoKSwgd2lkdGg6IFwiZnVsbFwiIH0sIGkxOG4uY2FuY2VsKSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJwcmltYXJ5XCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwga2luZDogXCJicmFuZFwiLCBsb2FkaW5nOiB0aGlzLnByb2Nlc3NpbmcsIG9uQ2xpY2s6ICgpID0+IHRoaXMuY3JlYXRlRm9sZGVyKCksIHdpZHRoOiBcImZ1bGxcIiwgZGlzYWJsZWQ6ICF0aGlzLmNyZWF0ZVRpdGxlIH0sIGkxOG4uc2F2ZSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckRlbGV0ZSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGVsIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtdHVubmVsXCIsIHsgcmVmZXJlbmNlOiBlbCwga2V5OiBcImRlbGV0ZS1tb2RhbFwiIH0sIGgoXCJhcmNnaXMtZGVsZXRlLWZvbGRlclwiLCB7IGZvbGRlcjogKF9hID0gdGhpcy5mb2xkZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgoZikgPT4gZi5pZCA9PT0gdGhpcy5kZWxldGVGb2xkZXJJZCksIHBvcnRhbDogY29uZmlnU3RhdGUucG9ydGFsLCB1c2VyOiBjb25maWdTdGF0ZS51c2VyLCBhY3RpdmU6ICF0aGlzLmRlbGV0ZUNsb3NpbmcsIG9uQXJjZ2lzRGVsZXRlRm9sZGVyQ2xvc2U6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldERlbGV0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRoZSBsaXN0IG9mIGZvbGRlcnNcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZldGNoVXNlckZvbGRlcnMoY29uZmlnU3RhdGUudXNlcik7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogRm9yY2UgY29udGVudCB1cGRhdGUgaWYgYWN0aXZlIGZvbGRlciB3YXMgZGVsZXRlZFxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyID0gKF9hID0gdGhpcy5mb2xkZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgoZikgPT4gZi5pZCA9PT0gdGhpcy5mb2xkZXIpO1xuICAgICAgICAgICAgICAgIGlmICghc2VsZWN0ZWRGb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2xkZXIgPSBcImFsbFwiO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IHVzZXIsIHBvcnRhbCB9ID0gY29uZmlnU3RhdGU7XG4gICAgICAgIGNvbnN0IGJ1Y2tldCA9IHRoaXMuc3RvcmUuc3RhdGUuYnVja2V0O1xuICAgICAgICBjb25zdCB7IGkxOG4sIGZvbGRlcnMsIGRlbGV0ZU9wZW4sIGNyZWF0ZU9wZW4sIHRvb2x0aXAsIHRvb2x0aXBSZWZlcmVuY2VFbGVtZW50LCBzaG93UmVjeWNsZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaGlkZSA9ICF1c2VyIHx8ICFmb2xkZXJzIHx8IChidWNrZXQgJiYgYnVja2V0ICE9PSBcIm15XCIpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IGkxOG4uZm9sZGVycywgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIG5vUGFkZGluZzogdHJ1ZSwgY2xhc3M6IHsgaGlkZSB9LCBvbk1vdXNlT3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZCA9IHRydWU7XG4gICAgICAgICAgICB9LCBvbk1vdXNlT3V0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBmaWx0ZXJFbmFibGVkOiB0cnVlLCBzZWxlY3Rpb25BcHBlYXJhbmNlOiBcImJvcmRlclwiLCBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZS1wZXJzaXN0XCIsIGxvYWRpbmc6ICFmb2xkZXJzLCBjbGFzczogXCJmb2xkZXJzXCIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IChfYSA9IGVsID09PSBudWxsIHx8IGVsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtZmlsdGVyXCIpO1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyLnN0eWxlLnNldFByb3BlcnR5KFwiLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMVwiLCBcInZhcigtLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZClcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBzb21lIHJlYXNvbiwgaW5zaWRlIHNoYWRvdyBkb20gX2FuZF8gYSBwb3BvdmVyLCBpbiBzYWZhcmkgdGhlIHN0aWNreSBwb3NpdGlvbmluZyB1c2VkIGJ5IGNhbGNpdGUgc3RvcHMgd29ya2luZy5cbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuc3R5bGUudG9wID0gXCItNDhweFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgZm9sZGVycy5tYXAoKGZvbGRlcikgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEVkaXQgJiYgKChfYSA9IHRoaXMuY3VycmVudEVkaXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgPT09IChmb2xkZXIgPT09IG51bGwgfHwgZm9sZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmb2xkZXIuaWQpXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlbmRlckVkaXQoZm9sZGVyKVxuICAgICAgICAgICAgICAgIDogdGhpcy5yZW5kZXJMaXN0SXRlbShmb2xkZXIpO1xuICAgICAgICB9KSwgc2hvd1JlY3ljbGUgJiYgIWlzUHVibGljVXNlcih1c2VyKSAmJiAhKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgJiZcbiAgICAgICAgICAgIHRoaXMucmVuZGVyTGlzdEl0ZW0oe1xuICAgICAgICAgICAgICAgIGNyZWF0ZWQ6IFwibm93XCIsXG4gICAgICAgICAgICAgICAgaWQ6IFwicmVjeWNsZVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLnJlY3ljbGVCaW4sXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IChfYSA9IGNvbmZpZ1N0YXRlID09PSBudWxsIHx8IGNvbmZpZ1N0YXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdTdGF0ZS51c2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXNlcm5hbWVcbiAgICAgICAgICAgIH0pKSwgdGhpcy5hbGxvd0VkaXRzICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBpZDogXCJjcmVhdGUtZm9sZGVyLWJ1dHRvblwiLCBpY29uU3RhcnQ6IFwiZm9sZGVyLXBsdXNcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgc2xvdDogXCJhY3Rpb25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT3BlbiA9IHRydWU7XG4gICAgICAgICAgICB9LCBvbk1vdXNlRW50ZXI6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUb29sdGlwKGkxOG4uY3JlYXRlRm9sZGVyLCBlLnRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBvbkZvY3VzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcChpMThuLmNyZWF0ZUZvbGRlciwgZS50YXJnZXQpO1xuICAgICAgICAgICAgfSB9KSkpLCBjcmVhdGVPcGVuICYmIHRoaXMucmVuZGVyQ3JlYXRlKCksIGRlbGV0ZU9wZW4gJiYgdGhpcy5yZW5kZXJEZWxldGUoKSwgISF0b29sdGlwICYmIHRvb2x0aXBSZWZlcmVuY2VFbGVtZW50ICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgcmVmZXJlbmNlRWxlbWVudDogdGhpcy50b29sdGlwUmVmZXJlbmNlRWxlbWVudCwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b29sdGlwRWxlbWVudCA9IGVsO1xuICAgICAgICAgICAgICAgICAgICBlbC5vcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIHRvb2x0aXApKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJGb2xkZXIuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckZvbGRlckNzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJHcm91cENzcyA9IFwiLmhpZGUuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXB7ZGlzcGxheTpub25lfS5ncm91cHMuc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXB7bWF4LWhlaWdodDoxNi41cmVtO21pbi1oZWlnaHQ6NHJlbTtwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjA7b3ZlcmZsb3c6YXV0bztwYWRkaW5nLXRvcDoyLjVyZW19Y2FsY2l0ZS1saXN0LWl0ZW0uc2MtYXJjZ2lzLWl0ZW0tYnJvd3Nlci1maWx0ZXItZ3JvdXA6bm90KFtzZWxlY3RlZF0pey0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTE6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX0uZ3JvdXAtdGh1bWJuYWlsLnNjLWFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWdyb3Vwe21hcmdpbi1sZWZ0OjAuNXJlbTttYXJnaW4tcmlnaHQ6MC41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckdyb3VwID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMuZ3JvdXAgPSBcImFsbFwiO1xuICAgICAgICB0aGlzLmFsbG93RWRpdHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gW107XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckdyb3VwO1xuICAgICAgICBpZiAoY29uZmlnU3RhdGUudXNlciAmJiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hVc2VyR3JvdXBzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvbkNvbmZpZ0NoYW5nZShcInVzZXJcIiwgKCkgPT4gdGhpcy5mZXRjaFVzZXJHcm91cHMoKSk7XG4gICAgICAgICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB0aGlzLmZldGNoVXNlckdyb3VwcygpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5leHBhbmRlZCAmJiB0aGlzLmFjY29yZGlvbkl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuYWNjb3JkaW9uSXRlbS5leHBhbmRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwiZ3JvdXBcIiwgdGhpcy5zdG9yZSwgKCkgPT4gKHRoaXMuZ3JvdXAgPSBcImFsbFwiKSk7XG4gICAgfVxuICAgIGdldEV2ZW50RGV0YWlsKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGdyb3VwIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gKF9hID0gdGhpcy5ncm91cHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChmKSA9PiBmLmlkID09PSBncm91cCk7XG4gICAgICAgIGNvbnN0IGdyb3VwVGl0bGUgPSAoc2VsZWN0ZWRHcm91cCA9PT0gbnVsbCB8fCBzZWxlY3RlZEdyb3VwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZEdyb3VwLnRpdGxlKSB8fCBcIlwiO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGdyb3VwICE9PSBcImFsbFwiXG4gICAgICAgICAgICA/IGBncm91cDoke2dyb3VwfWBcbiAgICAgICAgICAgIDogYGdyb3VwOigkeyhfYiA9IHRoaXMuZ3JvdXBzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubWFwKCh7IGlkIH0pID0+IGlkKS5qb2luKFwiIE9SIFwiKX0pYDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBcImdyb3VwXCIsXG4gICAgICAgICAgICBwYXJhbTogXCJxXCIsXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIGxhYmVsOiB0aGlzLmkxOG4ubGFiZWwucmVwbGFjZShcIiR7Z3JvdXB9XCIsIGdyb3VwVGl0bGUpLFxuICAgICAgICAgICAgZ3JvdXBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgZmV0Y2hVc2VyR3JvdXBzKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoY29uZmlnU3RhdGUudXNlciAmJiBjb25maWdTdGF0ZS5wb3J0YWwpIHtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwcyA9IGF3YWl0IGdldFNpZ25lZEluVXNlcnNHcm91cHMoKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzID0gW3sgaWQ6IFwiYWxsXCIsIHRpdGxlOiB0aGlzLmkxOG4uYWxsIH0sIC4uLmdyb3Vwc107XG4gICAgICAgICAgICBpZiAoKChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJ1Y2tldCkgPT09IFwiZ3JvdXBcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB1c2VyIH0gPSBjb25maWdTdGF0ZTtcbiAgICAgICAgY29uc3QgYnVja2V0ID0gdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQ7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgZ3JvdXBzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBoaWRlID0gIXVzZXIgfHwgIWdyb3VwcyB8fCAoYnVja2V0ICYmIGJ1Y2tldCAhPT0gXCJncm91cFwiKTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtYnJvd3Nlci1maWx0ZXJcIiwgeyBoZWFkaW5nOiBpMThuLmdyb3VwcywgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIG5vUGFkZGluZzogdHJ1ZSwgY2xhc3M6IHsgaGlkZSB9IH0sIGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBmaWx0ZXJFbmFibGVkOiB0cnVlLCBzZWxlY3Rpb25BcHBlYXJhbmNlOiBcImJvcmRlclwiLCBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiLCBsb2FkaW5nOiAhZ3JvdXBzLCBjbGFzczogXCJncm91cHNcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gKF9hID0gZWwgPT09IG51bGwgfHwgZWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsLnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKFwiY2FsY2l0ZS1maWx0ZXJcIik7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuc3R5bGUuc2V0UHJvcGVydHkoXCItLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xXCIsIFwidmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHNvbWUgcmVhc29uLCBpbnNpZGUgc2hhZG93IGRvbSBfYW5kXyBhIHBvcG92ZXIsIGluIHNhZmFyaSB0aGUgc3RpY2t5IHBvc2l0aW9uaW5nIHVzZWQgYnkgY2FsY2l0ZSBzdG9wcyB3b3JraW5nLlxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlci5zdHlsZS50b3AgPSBcIi00OHB4XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LCBncm91cHMgPT09IG51bGwgfHwgZ3JvdXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cHMubWFwKChncm91cCkgPT4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGNsYXNzOiBcImdyb3VwXCIsIGxhYmVsOiBncm91cC50aXRsZSwgdmFsdWU6IGdyb3VwLmlkLCBrZXk6IGdyb3VwLmlkLCBvbkNhbGNpdGVMaXN0SXRlbVNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAgPSBncm91cC5pZDtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmdyb3VwSWQgPSBncm91cC5pZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgICAgIH0sIHNlbGVjdGVkOiB0aGlzLmdyb3VwID09PSBncm91cC5pZCB9LCBncm91cC5pZCA9PT0gXCJhbGxcIiA/IChoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJ1c2Vyc1wiLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgc2NhbGU6IFwic1wiIH0pKSA6IChoKFwiYXJjZ2lzLWdyb3VwLXRodW1ibmFpbFwiLCB7IHNsb3Q6IFwiY29udGVudC1zdGFydFwiLCBjbGFzczogXCJncm91cC10aHVtYm5haWxcIiwgZ3JvdXA6IGdyb3VwLCBwb3J0YWw6IGNvbmZpZ1N0YXRlLnBvcnRhbCwgdG9vbHRpcDogZmFsc2UsIHNjYWxlOiBcInNcIiB9KSkpKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJHcm91cC5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyR3JvdXBDc3M7XG5cbmNvbnN0IHRlbXBsYXRlSW5kdXN0cmllcyA9IFtcbiAgICBcIkFncmljdWx0dXJlXCIsXG4gICAgXCJFbGVjdHJpYyBVdGlsaXRpZXNcIixcbiAgICBcIkVudmlyb25tZW50XCIsXG4gICAgXCJGb3Jlc3RyeVwiLFxuICAgIFwiR2FzIFV0aWxpdGllc1wiLFxuICAgIFwiR2VuZXJhbFwiLFxuICAgIFwiTmF0dXJhbCBSZXNvdXJjZXNcIixcbiAgICBcIlBldHJvbGV1bVwiLFxuICAgIFwiUHVibGljIFNhZmV0eVwiLFxuICAgIFwiVGVsZWNvbW11bmljYXRpb25zXCIsXG4gICAgXCJUcmFuc3BvcnRhdGlvblwiLFxuICAgIFwiV2F0ZXIgVXRpbGl0aWVzXCJcbl07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVySW5kdXN0cnkgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5pbmR1c3RyeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uZmlsdGVySW5kdXN0cnk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmluZHVzdHJ5KSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJpbmR1c3RyeVwiLCB0aGlzLnN0b3JlLCAoKSA9PiAodGhpcy5pbmR1c3RyeSA9IG51bGwpKTtcbiAgICB9XG4gICAgZ2V0RXZlbnREZXRhaWwoKSB7XG4gICAgICAgIGNvbnN0IHsgaW5kdXN0cnkgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gaW5kdXN0cnkgPyBgdHlwZWtleXdvcmRzOiBcIiR7aW5kdXN0cnl9XCJgIDogXCJcIjtcbiAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmkxOG4uSW5kdXN0cnkucmVwbGFjZShcIiR7aW5kdXN0cnl9XCIsIHRoaXMuaTE4bltpbmR1c3RyeV0pO1xuICAgICAgICByZXR1cm4geyBpZDogXCJpbmR1c3RyeVwiLCBwYXJhbTogXCJmaWx0ZXJcIiwgdmFsdWUsIGxhYmVsLCBpbmR1c3RyeSB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISF0aGlzLmluZHVzdHJ5LCBmaWx0ZXJJRDogXCJpbmR1c3RyeVwiLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmluZHVzdHJ5ID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtdHJlZVwiLCB7IHNlbGVjdGlvbk1vZGU6IFwic2luZ2xlXCIsIHNjYWxlOiBcInNcIiwgb25DYWxjaXRlVHJlZVNlbGVjdDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZHVzdHJ5ID0gKChfYiA9IChfYSA9IG5vZGUuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YXNldC5pbmR1c3RyeSkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbmR1c3RyeSA9PT0gaW5kdXN0cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmR1c3RyeSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZHVzdHJ5ID0gaW5kdXN0cnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICAgICAgfSB9LCB0ZW1wbGF0ZUluZHVzdHJpZXMubWFwKChpbmR1c3RyeSkgPT4gKGgoXCJjYWxjaXRlLXRyZWUtaXRlbVwiLCB7IFwiZGF0YS1pbmR1c3RyeVwiOiBpbmR1c3RyeSwgc2VsZWN0ZWQ6IGluZHVzdHJ5ID09PSB0aGlzLmluZHVzdHJ5IH0sIGgoXCJhXCIsIG51bGwsIHRoaXMuaTE4bltpbmR1c3RyeV0pKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckl0ZW1UeXBlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMucmVuZGVySXRlbVR5cGUgPSAoW2tleSwgb3B0aW9uXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtVHlwZSwgYWxsb3dlZEl0ZW1UeXBlcyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGRpc2FsbG93ZWRUeXBlID0gIShhbGxvd2VkSXRlbVR5cGVzID09PSBudWxsIHx8IGFsbG93ZWRJdGVtVHlwZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFsbG93ZWRJdGVtVHlwZXMuaW5jbHVkZXMoa2V5KSk7XG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbkFsbG93ZWQgPSBhbGxvd2VkSXRlbVR5cGVzICYmXG4gICAgICAgICAgICAgICAgZGlzYWxsb3dlZFR5cGUgJiZcbiAgICAgICAgICAgICAgICBvcHRpb24uY2hpbGRyZW4gJiZcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhvcHRpb24uY2hpbGRyZW4pLnNvbWUoKGNoaWxkKSA9PiBhbGxvd2VkSXRlbVR5cGVzLmluY2x1ZGVzKGNoaWxkKSk7XG4gICAgICAgICAgICBpZiAoKGRpc2FsbG93ZWRUeXBlICYmICFjaGlsZHJlbkFsbG93ZWQpIHx8XG4gICAgICAgICAgICAgICAgKG9wdGlvbi5zaG93ICYmICFvcHRpb24uc2hvdyhjb25maWdTdGF0ZS5wb3J0YWwsIGNvbmZpZ1N0YXRlLnVzZXJMaWNlbnNlZEl0ZW1zKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkaXNhbGxvd2VkVHlwZSAmJiBjaGlsZHJlbkFsbG93ZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaChGcmFnbWVudCwgbnVsbCwgT2JqZWN0LmVudHJpZXMob3B0aW9uLmNoaWxkcmVuKS5tYXAodGhpcy5yZW5kZXJJdGVtVHlwZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtaXRlbS10eXBlXCI6IGtleSwgXCJkYXRhLWNoaWxkcmVuXCI6ICEhb3B0aW9uLmNoaWxkcmVuLCBzZWxlY3RlZDoga2V5ID09PSBpdGVtVHlwZSB9LCBoKFwiYVwiLCBudWxsLCBpdGVtVHlwZU5hbWVzW2tleV0pLCBvcHRpb24uY2hpbGRyZW4gJiYgKGgoXCJjYWxjaXRlLXRyZWVcIiwgeyBzbG90OiBcImNoaWxkcmVuXCIsIHNlbGVjdGlvbk1vZGU6IFwiY2hpbGRyZW5cIiB9LCBPYmplY3QuZW50cmllcyhvcHRpb24uY2hpbGRyZW4pLm1hcCh0aGlzLnJlbmRlckl0ZW1UeXBlKSkpKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXRlbVR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWxsb3dlZEl0ZW1UeXBlcyA9IGRlZmF1bHRJdGVtVHlwZXM7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlckl0ZW1UeXBlO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLml0ZW1UeXBlKSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgICAgIGxldCBhY3RpdmVJdGVtID0gKF9hID0gdGhpcy5lbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoYGNhbGNpdGUtdHJlZS1pdGVtW2RhdGEtaXRlbS10eXBlPVwiJHt0aGlzLml0ZW1UeXBlfVwiXWApO1xuICAgICAgICAgICAgLy8gZXhwYW5kIHBhcmVudHMgb24gbG9hZCBpZiBpbml0aWFsIHZhbHVlIHdhcyBwcm92aWRlZFxuICAgICAgICAgICAgd2hpbGUgKGFjdGl2ZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVJdGVtLmV4cGFuZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBhY3RpdmVJdGVtID0gYWN0aXZlSXRlbS5wYXJlbnRFbGVtZW50LmNsb3Nlc3QoXCJjYWxjaXRlLXRyZWUtaXRlbVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIShhY3RpdmVJdGVtID09PSBudWxsIHx8IGFjdGl2ZUl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZUl0ZW0uY2xvc2VzdChcImFyY2dpcy1pdGVtLWJyb3dzZXItZmlsdGVyLWl0ZW0tdHlwZVwiKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlSXRlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcIml0ZW1UeXBlXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLml0ZW1UeXBlID0gbnVsbCkpO1xuICAgIH1cbiAgICBnZXRFdmVudERldGFpbCgpIHtcbiAgICAgICAgY29uc3QgeyBpdGVtVHlwZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gZ2V0SXRlbVR5cGVPcHRpb24oaXRlbVR5cGUpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IChvcHRpb24gPT09IG51bGwgfHwgb3B0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb24ucSkgPyBgKCR7b3B0aW9uLnF9KWAgOiBcIlwiO1xuICAgICAgICBjb25zdCBsYWJlbCA9IG9wdGlvbiA/IHRoaXMuaTE4bi5pdGVtVHlwZS5yZXBsYWNlKFwiJHtpdGVtVHlwZX1cIiwgaXRlbVR5cGVOYW1lc1tpdGVtVHlwZV0pIDogXCJcIjtcbiAgICAgICAgcmV0dXJuIHsgaWQ6IFwiaXRlbVR5cGVcIiwgcGFyYW06IFwicVwiLCB2YWx1ZSwgbGFiZWwsIGl0ZW1UeXBlIH07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuaXRlbVR5cGUsIGZpbHRlcklEOiBcIml0ZW1UeXBlXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSBudWxsO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhc2V0ID0gKF9iID0gKF9hID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbVR5cGUgPSAoZGF0YXNldCA9PT0gbnVsbCB8fCBkYXRhc2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhc2V0Lml0ZW1UeXBlKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1UeXBlID09PSBpdGVtVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1UeXBlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbVR5cGUgPSBpdGVtVHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgICAgICB9IH0sIE9iamVjdC5lbnRyaWVzKGl0ZW1UeXBlT3B0aW9ucykubWFwKHRoaXMucmVuZGVySXRlbVR5cGUpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5mdW5jdGlvbiBnZW9jb2RlclN1cHBvcnRzU3VnZ2VzdGlvbnMoZ2VvY29kZXIpIHtcbiAgICByZXR1cm4gISEoKGdlb2NvZGVyLnNpbmdsZUxpbmVGaWVsZE5hbWUgfHwgaXNFc3JpV29ybGRHZW9jb2RlcihnZW9jb2Rlci51cmwpIHx8IGdlb2NvZGVyLmVuYWJsZVN1Z2dlc3Rpb25zKSAmJlxuICAgICAgICBnZW9jb2Rlci5wbGFjZWZpbmRpbmcpO1xufVxuZnVuY3Rpb24gZ2V0U2VhcmNoR2VvY29kaW5nU2VydmljZXMocG9ydGFsLCBjb25maWcsIGkxOG4pIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgaGVscGVyU2VydmljZXMgPSBwb3J0YWwuaGVscGVyU2VydmljZXMgfHwge307XG4gICAgbGV0IGdlb2NvZGVycyA9IFsuLi4oaGVscGVyU2VydmljZXMuZ2VvY29kZSB8fCBbXSldO1xuICAgIGNvbnN0IGdlb2NvZGVBdXRvQ29tcGxldGUgPSAoX2EgPSBjb25maWcuZ2VvY29kZUF1dG9Db21wbGV0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2U7XG4gICAgcmV0dXJuIGdlb2NvZGVyc1xuICAgICAgICAuZmlsdGVyKGdlb2NvZGVyU3VwcG9ydHNTdWdnZXN0aW9ucylcbiAgICAgICAgLm1hcCgoZ2VvY29kZXIpID0+IHtcbiAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gZW5hYmxlIHN1Z2dlc3Rpb25zXG4gICAgICAgIGNvbnN0IGVuYWJsZVN1Z2dlc3Rpb25zID0gZ2VvY29kZXIuc3VnZ2VzdCA9PT0gdHJ1ZSAmJiBnZW9jb2RlQXV0b0NvbXBsZXRlID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICBjb25zdCBpc0VzcmkgPSBpc0VzcmlXb3JsZEdlb2NvZGVyKGdlb2NvZGVyLnVybCk7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGdlb2NvZGVyKSwgeyBuYW1lOiBpc0VzcmkgPyBcIkFyY0dJUyBXb3JsZCBHZW9jb2RpbmcgU2VydmljZVwiIDogZ2VvY29kZXIubmFtZSwgZW5hYmxlU3VnZ2VzdGlvbnMsIGNhdGVnb3JpZXM6IGlzRXNyaSA/IFtcIlBvcHVsYXRlZCBQbGFjZVwiLCBcIkNvb3JkaW5hdGUgU3lzdGVtXCJdIDogbnVsbCwgcGxhY2VmaW5kaW5nOiBpc0VzcmkgPyB0cnVlIDogZ2VvY29kZXIucGxhY2VmaW5kaW5nLCBvdXRGaWVsZHM6IGlzRXNyaSA/IFtcIk1hdGNoX2FkZHJcIiwgXCJBZGRyX3R5cGVcIiwgXCJTdEFkZHJcIiwgXCJDaXR5XCJdIDogbnVsbCwgcGxhY2Vob2xkZXI6IGdlb2NvZGVyLnBsYWNlaG9sZGVyIHx8IGkxOG4uZmluZExvY2F0aW9uVGV4dCwgc2luZ2xlTGluZUZpZWxkTmFtZTogZ2VvY29kZXIuc2luZ2xlTGluZUZpZWxkTmFtZSB8fCBcIlNpbmdsZUxpbmVcIiwgaGlnaGxpZ2h0U3ltYm9sOiBudWxsLCBsb2NhbFNlYXJjaE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBtaW5TY2FsZTogMzAwMDAwLFxuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiA1MDAwMFxuICAgICAgICAgICAgfSB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUV4dGVudFNlYXJjaE9wdGlvbnMocG9ydGFsLCBjb25maWcsIGkxOG4sIHZhbHVlKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zRW5hYmxlZCA9IChfYSA9IGNvbmZpZyA9PT0gbnVsbCB8fCBjb25maWcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZy5nZW9jb2RlQXV0b0NvbXBsZXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZTtcbiAgICBjb25zdCBzZWFyY2hMYXllcnMgPSBbXTsgLy8gdHlwZSA9PT0gXCJleHRlbnRcIlxuICAgIGNvbnN0IGdlb2NvZGVycyA9IGdldFNlYXJjaEdlb2NvZGluZ1NlcnZpY2VzKHBvcnRhbCwgY29uZmlnLCBpMThuKTtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBzdWdnZXN0aW9uc0VuYWJsZWQsXG4gICAgICAgIG1pblN1Z2dlc3RDaGFyYWN0ZXJzOiAzLFxuICAgICAgICBtYXhSZXN1bHRzOiA1LFxuICAgICAgICBzZWFyY2hUZXJtOiB2YWx1ZSB8fCBudWxsLFxuICAgICAgICBhY3RpdmVTb3VyY2VJbmRleDogXCJhbGxcIixcbiAgICAgICAgc291cmNlczogc2VhcmNoTGF5ZXJzLmNvbmNhdChnZW9jb2RlcnMpLFxuICAgICAgICBwb3B1cEVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICBwb3J0YWxcbiAgICB9O1xuICAgIC8vIHJlbW92ZSBhY3RpdmVTb3VyY2VJbmRleCBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xlIGdlb2NvZGVyXG4gICAgaWYgKG9wdGlvbnMuc291cmNlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgZGVsZXRlIG9wdGlvbnMuYWN0aXZlU291cmNlSW5kZXg7XG4gICAgfVxuICAgIHJldHVybiBvcHRpb25zO1xufVxuXG5jb25zdCBhcmNnaXNJdGVtQnJvd3NlckZpbHRlckxvY2F0aW9uQ3NzID0gXCIubG9jYXRpb24tZmlsdGVyX19jb250YWluZXJ7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6ZmxleDt3aWR0aDoxMDAlfS5sb2NhdGlvbi1maWx0ZXJfX2lucHV0e2ZsZXg6MSAxIDAlOy0tY2FsY2l0ZS1jb2xvci1ib3JkZXItaW5wdXQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMyl9LmxvY2F0aW9uLWZpbHRlcl9fYnV0dG9ue21hcmdpbi1pbmxpbmUtc3RhcnQ6LTFweH0ubG9jYXRpb24tZmlsdGVyX19zdWdnZXN0aW9uc3tib3gtc2l6aW5nOmJvcmRlci1ib3g7aGVpZ2h0OjhyZW07b3ZlcmZsb3cteTphdXRvO2JvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTEpO2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTEpO3dpZHRoOmNhbGModmFyKC0taXRlbS1icm93c2VyLXBhbmUtd2lkdGgpIC0gMi41cmVtKX0ubG9jYXRpb24tZmlsdGVyX19uby1yZXN1bHRze21hcmdpbi10b3A6M3JlbTttYXJnaW4tYm90dG9tOjBweDtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MHB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJMb2NhdGlvbiA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU29ydCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJTb3J0XCIsIDcpO1xuICAgICAgICB0aGlzLnN1Z2dlc3QgPSAodGVybSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCh0ZXJtID09PSBudWxsIHx8IHRlcm0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlcm0ubGVuZ3RoKSA+IDIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5zdWdnZXN0KHRlcm0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN1Z2dlc3Rpb25zID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGVib3VuY2VkU3VnZ2VzdCA9IGRlYm91bmNlKHRoaXMuc3VnZ2VzdC5iaW5kKHRoaXMpLCAxMDAwKTtcbiAgICAgICAgdGhpcy51cGRhdGVTdWdnZXN0ID0gKHRlcm0pID0+IHtcbiAgICAgICAgICAgIGlmICgodGVybSA9PT0gbnVsbCB8fCB0ZXJtID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZXJtLmxlbmd0aCkgPiAyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kZWJvdW5jZWRTdWdnZXN0KHRlcm0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxvY2F0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4dGVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNlYXJjaGluZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdWdnZXN0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJMb2NhdGlvbjtcbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwibG9jYXRpb25cIiwgdGhpcy5zdG9yZSwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdGhpcy5sb2NhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmV4dGVudCA9IG51bGw7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLnNlYXJjaFZpZXdNb2RlbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSBcIlwiO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgaWYgKHRoaXMubG9jYXRpb24gJiYgdGhpcy5leHRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IHRoaXMubG9jYXRpb247XG4gICAgICAgICAgICB0aGlzLmVtaXRGaWx0ZXJFdmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSB7XG4gICAgICAgICAgICB0aGlzLnNldHVwU2VhcmNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvbkNvbmZpZ0NoYW5nZShcInBvcnRhbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cFNlYXJjaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgc2V0dXBTZWFyY2goKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjcmVhdGVFeHRlbnRTZWFyY2hPcHRpb25zKGNvbmZpZ1N0YXRlLnBvcnRhbCwgY29uZmlnU3RhdGUuY29uZmlnLCB0aGlzLmkxOG4sIHRoaXMubG9jYXRpb24pO1xuICAgICAgICBjb25zdCBbU2VhcmNoVmlld01vZGVsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvd2lkZ2V0cy9TZWFyY2gvU2VhcmNoVmlld01vZGVsXCJdKTtcbiAgICAgICAgdGhpcy5zZWFyY2hWaWV3TW9kZWwgPSBuZXcgU2VhcmNoVmlld01vZGVsKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyksIHsgYWxsUGxhY2Vob2xkZXI6IHRoaXMuaTE4bi5maW5kTG9jYXRpb25UZXh0LCBzaG93SW5mb1dpbmRvd09uU2VsZWN0OiBmYWxzZSB9KSk7XG4gICAgICAgIHRoaXMuc2VhcmNoVmlld01vZGVsLm9uKFwic3VnZ2VzdC1zdGFydFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInN1Z2dlc3QtY29tcGxldGVcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3VnZ2VzdGlvbnMgPSBbLi4uZS5yZXN1bHRzXTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1N1Z2dlc3Rpb25zID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInNlYXJjaC1zdGFydFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdWdnZXN0UG9wb3Zlci5vcGVuID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlYXJjaFZpZXdNb2RlbC5vbihcInNlYXJjaC1jb21wbGV0ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZWFyY2hWaWV3TW9kZWwub24oXCJzZWxlY3QtcmVzdWx0XCIsIHRoaXMuaGFuZGxlTG9jYXRpb25DaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2VhcmNoVmlld01vZGVsLm9uKFwic2VhcmNoLWNsZWFyXCIsICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4dGVudCAmJiB0aGlzLmxvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5leHRlbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdEZpbHRlckV2ZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVMb2NhdGlvbkNoYW5nZShldmVudCkge1xuICAgICAgICB0aGlzLmxvY2F0aW9uID0gZXZlbnQucmVzdWx0Lm5hbWU7XG4gICAgICAgIGNvbnN0IGV4dCA9IGV2ZW50LnJlc3VsdC5leHRlbnQ7XG4gICAgICAgIHRoaXMuZXh0ZW50ID0gYCR7ZXh0LnhtaW59LCR7ZXh0LnltaW59LCR7ZXh0LnhtYXh9LCR7ZXh0LnltYXh9YDtcbiAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICB9XG4gICAgZW1pdEZpbHRlckV2ZW50KCkge1xuICAgICAgICBjb25zdCB7IGxvY2F0aW9uLCBleHRlbnQgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5pMThuLmxhYmVsLnJlcGxhY2UoXCIke2xvY2F0aW9ufVwiLCBsb2NhdGlvbik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh7XG4gICAgICAgICAgICBpZDogXCJsb2NhdGlvblwiLFxuICAgICAgICAgICAgcGFyYW06IFwiYmJveFwiLFxuICAgICAgICAgICAgdmFsdWU6IGV4dGVudCAhPT0gbnVsbCAmJiBleHRlbnQgIT09IHZvaWQgMCA/IGV4dGVudCA6IFwiXCIsXG4gICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgIGxvY2F0aW9uLFxuICAgICAgICAgICAgZXh0ZW50XG4gICAgICAgIH0pO1xuICAgICAgICAvLyB3aGVuIGZpbHRlcmluZyBieSBsb2NhdGlvbiwgb25seSByZWxldmFuY2Ugc29ydCBvcmRlciBpcyBhbGxvd2VkXG4gICAgICAgIGlmIChleHRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoeyBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsIHNvcnRPcmRlcjogXCJkZXNjXCIgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlU3VnZ2VzdFNlbGVjdChzdWdnZXN0aW9uKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5zZWFyY2hWaWV3TW9kZWwuc2VhcmNoKHN1Z2dlc3Rpb24pO1xuICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSBzdWdnZXN0aW9uLnRleHQ7XG4gICAgICAgIChfYSA9IHRoaXMuaW5wdXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICBoYXNSZXN1bHRzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoX2EgPSB0aGlzLnN1Z2dlc3Rpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc29tZSgoc2VydmljZSkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBzZXJ2aWNlID09PSBudWxsIHx8IHNlcnZpY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlcnZpY2UucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDsgfSk7XG4gICAgfVxuICAgIHJlbmRlclN1Z2dlc3Rpb25zKHNlcnZpY2UpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gc2VydmljZSA9PT0gbnVsbCB8fCBzZXJ2aWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHN1Z2dlc3Rpb24pID0+IChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX3N1Z2dlc3Rpb25cIiwga2V5OiBzdWdnZXN0aW9uLmtleSwgbGFiZWw6IHN1Z2dlc3Rpb24udGV4dCwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVTdWdnZXN0U2VsZWN0KHN1Z2dlc3Rpb24pLCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3VnZ2VzdFNlbGVjdChzdWdnZXN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUuYXBpKSA9PT0gMykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLmxvY2F0aW9uLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMubG9jYXRpb24sIGZpbHRlcklEOiBcImxvY2F0aW9uXCIsIG9uQXJjZ2lzQnJvd3NlckZpbHRlclJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb24gPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZXh0ZW50ID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImxvY2F0aW9uLWZpbHRlcl9fY29udGFpbmVyXCIgfSwgaChcImNhbGNpdGUtaW5wdXRcIiwgeyBsb2FkaW5nOiB0aGlzLnNlYXJjaGluZyB8fCB0aGlzLmxvYWRpbmdTdWdnZXN0aW9ucywgdHlwZTogXCJ0ZXh0XCIsIHZhbHVlOiB0aGlzLnNlYXJjaFRlcm0sIHBsYWNlaG9sZGVyOiB0aGlzLmkxOG4uZmluZExvY2F0aW9uVGV4dCwgc2NhbGU6IFwibVwiLCBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX2lucHV0XCIsIHJlZjogKGVsKSA9PiAodGhpcy5pbnB1dCA9IGVsKSwgY2xlYXJhYmxlOiB0cnVlLCBvbktleVByZXNzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hWaWV3TW9kZWwuc3VnZ2VzdCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbktleURvd246IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dEb3duXCIgJiYgIXRoaXMubG9hZGluZ1N1Z2dlc3Rpb25zICYmICgoX2EgPSB0aGlzLnN1Z2dlc3Rpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIChfYiA9IHRoaXMuZWwucXVlcnlTZWxlY3RvcihcImNhbGNpdGUtbGlzdC1pdGVtXCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVJbnB1dElucHV0OiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdWdnZXN0KHZhbHVlKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19idXR0b25cIiwgbGFiZWw6IFwic2VhcmNoXCIsIHNsb3Q6IFwiYWN0aW9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBpY29uU3RhcnQ6IFwic2VhcmNoXCIsIHNjYWxlOiBcIm1cIiwgcmVmOiAoZWwpID0+ICh0aGlzLnNlYXJjaEJ1dHRvbiA9IGVsKSwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VnZ2VzdCh0aGlzLnNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgfSwgb25LZXlQcmVzczogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiB8fCBlLmtleSA9PT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWdnZXN0KHRoaXMuc2VhcmNoVGVybSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZGlzYWJsZWQ6ICF0aGlzLnNlYXJjaFRlcm0gfSkpLCAhdGhpcy5sb2FkaW5nU3VnZ2VzdGlvbnMgJiYgKChfYSA9IHRoaXMuc2VhcmNoVGVybSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAyICYmIChoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgbGFiZWw6IHRoaXMuaTE4bi5zdWdnZXN0aW9ucywgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5zZWFyY2hCdXR0b24sIHJlZjogKGVsKSA9PiAodGhpcy5zdWdnZXN0UG9wb3ZlciA9IGVsKSwgYXV0b0Nsb3NlOiB0cnVlLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIG9mZnNldERpc3RhbmNlOiAwLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgb3BlbjogdHJ1ZSwgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgZmxpcFBsYWNlbWVudHM6IFtcInRvcC1lbmRcIl0gfSwgdGhpcy5oYXNSZXN1bHRzKCkgPyAoaChcImNhbGNpdGUtbGlzdFwiLCB7IGtleTogdGhpcy5zZWFyY2hUZXJtLCBjbGFzczogXCJsb2NhdGlvbi1maWx0ZXJfX3N1Z2dlc3Rpb25zXCIgfSwgKF9iID0gdGhpcy5zdWdnZXN0aW9ucykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgoc2VydmljZSkgPT4gdGhpcy5yZW5kZXJTdWdnZXN0aW9ucyhzZXJ2aWNlKSkpKSA6IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19zdWdnZXN0aW9uc1wiIH0sIGgoXCJwXCIsIHsgY2xhc3M6IFwibG9jYXRpb24tZmlsdGVyX19uby1yZXN1bHRzXCIgfSwgdGhpcy5pMThuLm5vUmVzdWx0cy5yZXBsYWNlKFwiJHtzZWFyY2hUZXJtfVwiLCB0aGlzLnNlYXJjaFRlcm0pKSkpKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlckZpbHRlckxvY2F0aW9uLnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJMb2NhdGlvbkNzcztcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hSZWdpb25zKHBvcnRhbCkge1xuICAgIHJldHVybiByZXF1ZXN0KGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9cG9ydGFscy9yZWdpb25zYCk7XG59XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyUmVnaW9uID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJcIiwgNyk7XG4gICAgICAgIHRoaXMucmVnaW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJSZWdpb247XG4gICAgICAgIGlmIChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKSB7XG4gICAgICAgICAgICB0aGlzLmZldGNoUmVnaW9ucyhjb25maWdTdGF0ZS5wb3J0YWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb25Db25maWdDaGFuZ2UoXCJwb3J0YWxcIiwgKHBvcnRhbCkgPT4gdGhpcy5mZXRjaFJlZ2lvbnMocG9ydGFsKSk7XG4gICAgICAgIH1cbiAgICAgICAgb25Ccm93c2VyRmlsdGVyUmVtb3ZlKFwicmVnaW9uXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLnJlZ2lvbiA9IG51bGwpKTtcbiAgICB9XG4gICAgYXN5bmMgZmV0Y2hSZWdpb25zKHBvcnRhbCkge1xuICAgICAgICB0aGlzLnJlZ2lvbnMgPSBhd2FpdCBmZXRjaFJlZ2lvbnMocG9ydGFsKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlZ2lvbikge1xuICAgICAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbWl0RmlsdGVyRXZlbnQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyByZWdpb24sIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5VmFsdWUgPSByZWdpb24gPyBgL3JlZ2lvbi8ke3JlZ2lvbi50b0xvd2VyQ2FzZSgpfWAgOiBcIlwiO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHJlZ2lvbiA/IEpTT04uc3RyaW5naWZ5KFtjYXRlZ29yeVZhbHVlXSkgOiBcIlwiO1xuICAgICAgICBjb25zdCBhY3RpdmVSZWdpb24gPSAoX2EgPSB0aGlzLnJlZ2lvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChyKSA9PiByLnJlZ2lvbiA9PT0gcmVnaW9uKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpMThuLnJlZ2lvbi5yZXBsYWNlKFwiJHtyZWdpb259XCIsIChhY3RpdmVSZWdpb24gPT09IG51bGwgfHwgYWN0aXZlUmVnaW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVSZWdpb24ubG9jYWxpemVkTmFtZSkgfHwgKGFjdGl2ZVJlZ2lvbiA9PT0gbnVsbCB8fCBhY3RpdmVSZWdpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZVJlZ2lvbi5uYW1lKSB8fCBcIlwiKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHtcbiAgICAgICAgICAgIGlkOiBcInJlZ2lvblwiLFxuICAgICAgICAgICAgcGFyYW06IFwiY2F0ZWdvcmllc1wiLFxuICAgICAgICAgICAgY2F0ZWdvcnlWYWx1ZSxcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICByZWdpb25cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB7IGxvYWRpbmcsIHJlZ2lvbnMsIHN0b3JlIH0gPSB0aGlzO1xuICAgICAgICBpZiAobG9hZGluZyB8fCAhKHJlZ2lvbnMgPT09IG51bGwgfHwgcmVnaW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVnaW9ucy5sZW5ndGgpIHx8ICgoX2EgPSBzdG9yZS5zdGF0ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmJ1Y2tldCkgIT09IFwibGl2aW5nIGF0bGFzXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1icm93c2VyLWZpbHRlclwiLCB7IGhlYWRpbmc6IHRoaXMuaTE4bi5yZWdpb25zLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMucmVnaW9uLCBmaWx0ZXJJRDogXCJyZWdpb25cIiwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpb24gPSBudWxsO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhc2V0ID0gKF9iID0gKF9hID0gbm9kZSA9PT0gbnVsbCB8fCBub2RlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmRhdGFzZXQ7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVnaW9uID0gKGRhdGFzZXQgPT09IG51bGwgfHwgZGF0YXNldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YXNldC52YWx1ZSkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWdpb24gPT09IHJlZ2lvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvbiA9IHJlZ2lvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0RmlsdGVyRXZlbnQoKTtcbiAgICAgICAgICAgIH0gfSwgcmVnaW9ucy5tYXAoKHsgbmFtZSwgcmVnaW9uLCBsb2NhbGl6ZWROYW1lIH0pID0+IChoKFwiY2FsY2l0ZS10cmVlLWl0ZW1cIiwgeyBcImRhdGEtdmFsdWVcIjogcmVnaW9uLCBzZWxlY3RlZDogdGhpcy5yZWdpb24gPT09IHJlZ2lvbiB9LCBoKFwiYVwiLCBudWxsLCBsb2NhbGl6ZWROYW1lIHx8IG5hbWUpKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlclNoYXJpbmcgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckZpbHRlclwiLCA3KTtcbiAgICAgICAgdGhpcy5maWx0ZXJMZXZlbCA9IChzaGFyaW5nTGV2ZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChzaGFyaW5nTGV2ZWwgPT09IFwib3JnXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWlzUHVibGljVXNlcihjb25maWdTdGF0ZS51c2VyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNoYXJpbmdMZXZlbHMgPSBbW1wib3duZXJcIiwgW1wicHJpdmF0ZVwiLCBcInNoYXJlZFwiXV0sIFwib3JnXCIsIFwicHVibGljXCJdO1xuICAgICAgICB0aGlzLnJlbmRlckxldmVsID0gKHNoYXJpbmdMZXZlbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2xldmVsLCBjaGlsZHJlbl0gPSBBcnJheS5pc0FycmF5KHNoYXJpbmdMZXZlbCkgPyBzaGFyaW5nTGV2ZWwgOiBbc2hhcmluZ0xldmVsXTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdHJlZS1pdGVtXCIsIHsgXCJkYXRhLXNoYXJpbmdcIjogbGV2ZWwsIHNlbGVjdGVkOiAoY2hpbGRyZW4gPT09IG51bGwgfHwgY2hpbGRyZW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNoaWxkcmVuLmluY2x1ZGVzKHRoaXMuc2hhcmluZykpIHx8IGxldmVsID09PSB0aGlzLnNoYXJpbmcgfSwgaChcImFcIiwgbnVsbCwgdGhpcy5pMThuW2xldmVsXSksIGNoaWxkcmVuICYmIChoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2xvdDogXCJjaGlsZHJlblwiLCBzZWxlY3Rpb25Nb2RlOiBcImNoaWxkcmVuXCIgfSwgY2hpbGRyZW4ubWFwKHRoaXMucmVuZGVyTGV2ZWwpKSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zaGFyaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5maWx0ZXJTaGFyaW5nO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBpZiAodGhpcy5zaGFyaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgfVxuICAgICAgICBvbkJyb3dzZXJGaWx0ZXJSZW1vdmUoXCJzaGFyaW5nXCIsIHRoaXMuc3RvcmUsICgpID0+ICh0aGlzLnNoYXJpbmcgPSBudWxsKSk7XG4gICAgfVxuICAgIGdldEV2ZW50RGV0YWlsKCkge1xuICAgICAgICBjb25zdCB7IHNoYXJpbmcsIGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gc2hhcmluZyA9PT0gXCJvd25lclwiID8gYChhY2Nlc3M6cHJpdmF0ZSBPUiBhY2Nlc3M6c2hhcmVkKWAgOiBgKGFjY2VzczogJHtzaGFyaW5nfSlgO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IFwic2hhcmluZ1wiLFxuICAgICAgICAgICAgcGFyYW06IFwicVwiLFxuICAgICAgICAgICAgdmFsdWU6IHNoYXJpbmcgPyB2YWx1ZSA6IFwiXCIsXG4gICAgICAgICAgICBsYWJlbDogc2hhcmluZyA/IGkxOG4ubGFiZWwucmVwbGFjZShcIiR7c2hhcmluZ31cIiwgaTE4bltzaGFyaW5nXSkgOiBcIlwiLFxuICAgICAgICAgICAgc2hhcmluZ1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGlmICgoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSA9PT0gXCJhbGxcIiB8fCAhY29uZmlnU3RhdGUudXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogdGhpcy5pMThuLnRpdGxlLCBleHBhbmRlZDogdGhpcy5leHBhbmRlZCwgYWN0aXZlOiAhIXRoaXMuc2hhcmluZywgZmlsdGVySUQ6IFwic2hhcmluZ1wiLCBvbkFyY2dpc0Jyb3dzZXJGaWx0ZXJSZW1vdmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXJpbmcgPSBudWxsO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS10cmVlXCIsIHsgc2VsZWN0aW9uTW9kZTogXCJjaGlsZHJlblwiLCBzY2FsZTogXCJtXCIsIG9uQ2FsY2l0ZVRyZWVTZWxlY3Q6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSAoX2EgPSBub2RlLnNlbGVjdGVkSXRlbXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXTtcbiAgICAgICAgICAgICAgICBjb25zdCBzaGFyaW5nID0gaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmRhdGFzZXQuc2hhcmluZztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaGFyaW5nID09PSBzaGFyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcmluZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYXJpbmcgPSBzaGFyaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyLmVtaXQodGhpcy5nZXRFdmVudERldGFpbCgpKTtcbiAgICAgICAgICAgIH0gfSwgdGhpcy5zaGFyaW5nTGV2ZWxzLmZpbHRlcih0aGlzLmZpbHRlckxldmVsKS5tYXAoKGxldmVsKSA9PiB0aGlzLnJlbmRlckxldmVsKGxldmVsKSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyVGFncyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmRlc2VsZWN0QWxsVGFncyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZWxcbiAgICAgICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVtzZWxlY3RlZF1cIilcbiAgICAgICAgICAgICAgICAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRhZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLmZpbHRlclRhZ3M7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGlmICh0aGlzLnRhZ3MpIHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXIuZW1pdCh0aGlzLmdldEV2ZW50RGV0YWlsKCkpO1xuICAgICAgICB9XG4gICAgICAgIG9uQnJvd3NlckZpbHRlclJlbW92ZShcInRhZ3NcIiwgdGhpcy5zdG9yZSwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy50YWdzID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZGVzZWxlY3RBbGxUYWdzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRFdmVudERldGFpbCgpIHtcbiAgICAgICAgY29uc3QgeyB0YWdzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB2YWx1ZSA9ICh0YWdzID09PSBudWxsIHx8IHRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhZ3MubGVuZ3RoKSA/IGB0YWdzOigke3RhZ3MubWFwKCh0YWcpID0+IGBcIiR7dGFnfVwiYCkuam9pbihcIiBPUiBcIil9KWAgOiBcIlwiO1xuICAgICAgICBjb25zdCBsYWJlbCA9ICh0YWdzID09PSBudWxsIHx8IHRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhZ3MubGVuZ3RoKSA/IHRoaXMuaTE4bi5sYWJlbC5yZXBsYWNlKFwiJHt0YWdzfVwiLCB0YWdzLmpvaW4oXCIsIFwiKSkgOiBcIlwiO1xuICAgICAgICByZXR1cm4geyBpZDogXCJ0YWdzXCIsIHBhcmFtOiBcImZpbHRlclwiLCB2YWx1ZSwgdGFncywgbGFiZWwgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkUmVuZGVyKCkge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZWwucXVlcnlTZWxlY3RvckFsbChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiKTtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gW107XG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgaXRlbXMgd2hpY2ggd2VyZSBhZGRlZCBieSBjYWxjaXRlIGNvbWJvYm94XG4gICAgICAgICAgICBpZiAodmFsdWVzLmluY2x1ZGVzKGl0ZW0udmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgaXRlbS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBpMThuIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBrbm93blRhZ3MgPSB0aGlzLnN0b3JlLnN0YXRlLmtub3duVGFncyB8fCBbXTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyXCIsIHsgaGVhZGluZzogaTE4bi50aXRsZSwgZXhwYW5kZWQ6IHRoaXMuZXhwYW5kZWQsIGFjdGl2ZTogISEoKF9hID0gdGhpcy50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSwgb25BcmNnaXNCcm93c2VyRmlsdGVyUmVtb3ZlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50YWdzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5kZXNlbGVjdEFsbFRhZ3MoKTtcbiAgICAgICAgICAgIH0gfSwgaChcImNhbGNpdGUtY29tYm9ib3hcIiwgeyBsYWJlbDogaTE4bi50aXRsZSwgb3ZlcmxheVBvc2l0aW9uaW5nOiBcImZpeGVkXCIsIHBsYWNlaG9sZGVyOiBpMThuLnNlbGVjdFRhZ3MsIHNjYWxlOiBcInNcIiwgbWF4SXRlbXM6IDUsIGFsbG93Q3VzdG9tVmFsdWVzOiB0cnVlLCBjbGVhckRpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVDb21ib2JveENoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgdGhpcy50YWdzID0gKF9hID0gZS50YXJnZXQuc2VsZWN0ZWRJdGVtcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckZpbHRlci5lbWl0KHRoaXMuZ2V0RXZlbnREZXRhaWwoKSk7XG4gICAgICAgICAgICB9LCBzdHlsZTogeyBtYXJnaW5Cb3R0b206IFwiMXJlbVwiIH0sIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpdiA9IGVsLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImRpdlwiKTtcbiAgICAgICAgICAgICAgICBpZiAoZGl2ICYmICgoX2EgPSB0aGlzLnN0b3JlLnN0YXRlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucGFuZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpdi5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgYDxzdHlsZT5cbiAgICAgICAgICAgICAgLmZsb2F0aW5nLXVpLWNvbnRhaW5lci0tYWN0aXZlIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IGF1dG8gIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGUgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA8L3N0eWxlPmApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwga25vd25UYWdzLm1hcCgodGFnKSA9PiAoaChcImNhbGNpdGUtY29tYm9ib3gtaXRlbVwiLCB7IGtleTogdGFnLCB2YWx1ZTogdGFnLCB0ZXh0TGFiZWw6IHRhZy5sZW5ndGggPiAzNiA/IGAke3RhZy5zbGljZSgwLCAzNil9Li4uYCA6IHRhZyB9KSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlcnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLWJyb3dzZXItZmlsdGVyc1wiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBzdHlsZTogKChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJ1Y2tldCkgPT09IFwic3Vic2NyaXB0aW9uIGNvbnRlbnRcIiA/IHsgZGlzcGxheTogXCJub25lXCIgfSA6IHt9IH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcInRvcFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJ0b3BcIiB9KSksIGgoXCJzbG90XCIsIG51bGwpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJib3R0b21cIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiYm90dG9tXCIgfSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyUGFnaW5hdGlvbiA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJQYWdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclBhZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMudG90YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubnVtID0gNjA7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgY29uc3QgeyBzdGFydCwgdG90YWwsIG51bSB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclBhZ2UuZW1pdCh7IHN0YXJ0LCB0b3RhbCwgbnVtIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhcnQsIHRvdGFsLCBudW0sIHN0b3JlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtYnJvd3Nlci1wYWdpbmF0aW9uXCIsIHsgc3RhcnQ6IHN0YXJ0LCB0b3RhbDogdG90YWwsIG51bTogbnVtLCBzdG9yZTogc3RvcmUsIG9uQXJjZ2lzQnJvd3NlclBhZ2U6IChlKSA9PiB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUGFnZS5lbWl0KGUuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NzcyA9IFwiOmhvc3R7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7ZmxleDoxIDEgMCU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKX0ucHJldmlld19faGVhZGVye21hcmdpbi1pbmxpbmUtc3RhcnQ6MC43NXJlbX0ucHJldmlld19fdGl0bGV7bWFyZ2luOjBweDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7cGFkZGluZzowcHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtsaW5lLWhlaWdodDoxLjM3NX0udGl0bGV7bWFyZ2luLXRvcDowLjc1cmVtO21hcmdpbi1ib3R0b206MC43NXJlbTtwYWRkaW5nOjBweDtmb250LXNpemU6MS4xMjVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTt3b3JkLXdyYXA6YnJlYWstd29yZDt3b3JkLWJyZWFrOmJyZWFrLXdvcmR9LmJhZGdlc3ttYXJnaW4tYm90dG9tOjFyZW07ZGlzcGxheTpibG9ja30uYmFkZ2VzW2VtcHR5XXtkaXNwbGF5Om5vbmV9Y2FsY2l0ZS1hY2NvcmRpb24taXRlbXstLWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW0tcGFkZGluZzoxcmVtIDFyZW07LS1jYWxjaXRlLWFjY29yZGlvbi1pdGVtLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO3dpZHRoOjEwMCU7Ym94LXNpemluZzpib3JkZXItYm94O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTIpfS5zZWN0aW9ue2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1iYWNrZ3JvdW5kKTtwYWRkaW5nLWxlZnQ6MXJlbTtwYWRkaW5nLXJpZ2h0OjFyZW07cGFkZGluZy10b3A6MXJlbTtwYWRkaW5nLWJvdHRvbToxcmVtO21hcmdpbjowcmVtIC0xcmVtIGNhbGMoLTFyZW0gLSAxcHgpIC0xcmVtO2xpbmUtaGVpZ2h0OjEuMzV9LnNlY3Rpb24tLXRpZ2h0e3BhZGRpbmctdG9wOjBweDtwYWRkaW5nLWJvdHRvbTowcHg7cGFkZGluZy1sZWZ0OjBweDtwYWRkaW5nLXJpZ2h0OjBweH0uZGV0YWlscy10aXRsZXttYXJnaW4tdG9wOjFyZW07bWFyZ2luLWJvdHRvbTowcHg7cGFkZGluZy1ib3R0b206MC4yNXJlbTtwYWRkaW5nLXRvcDowcHg7Zm9udC1zaXplOjAuNzVyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKTstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowfS5kZXRhaWxzLXRpdGxlOmZpcnN0LW9mLXR5cGV7bWFyZ2luLXRvcDowcHh9LmRldGFpbHMtdGl0bGUtLWxhYmVse3BhZGRpbmctYm90dG9tOjBweH0uZGV0YWlscy10ZXh0e21hcmdpbjowcHg7b3ZlcmZsb3ctd3JhcDpicmVhay13b3JkO3BhZGRpbmc6MHB4O2ZvbnQtc2l6ZTowLjg3NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5kZXRhaWxzLXRleHQgYXtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtbGluayl9LmRldGFpbHMtLXRleHQtZW1wdHl7Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjQwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LmRlc2NyaXB0aW9ue3dpZHRoOjEwMCU7b3ZlcmZsb3c6YXV0bztvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmQ7cGFkZGluZy1ib3R0b206MC4yNXJlbTtsaW5lLWhlaWdodDoxLjM1fS5kZXNjcmlwdGlvbiAqe21heC13aWR0aDoxMDAlO2ZvbnQtc2l6ZTowLjg3NXJlbSAhaW1wb3J0YW50fS5kZXNjcmlwdGlvbnstLWl0ZW0tYnJvd3Nlci10YWJsZS1ib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTIpfS5kZXNjcmlwdGlvbiB0YWJsZXt3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTstLXR3LWJvcmRlci1zcGFjaW5nLXg6MHB4Oy0tdHctYm9yZGVyLXNwYWNpbmcteTowcHg7Ym9yZGVyLXNwYWNpbmc6dmFyKC0tdHctYm9yZGVyLXNwYWNpbmcteCkgdmFyKC0tdHctYm9yZGVyLXNwYWNpbmcteSk7b3ZlcmZsb3c6YXV0bztiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTt0ZXh0LWFsaWduOnN0YXJ0O2ZvbnQtc2l6ZTowLjc1cmVtO2JvcmRlcjp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtYm9yZGVyKX0uZGVzY3JpcHRpb24gdGFibGU+dGhlYWR7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7Zm9udC13ZWlnaHQ6NDAwO2JvcmRlci1ib3R0b206dmFyKC0taXRlbS1icm93c2VyLXRhYmxlLWJvcmRlcil9LmRlc2NyaXB0aW9uIHRhYmxlPnRib2R5e3dpZHRoOjEwMCU7b3ZlcmZsb3c6YXV0b30uZGVzY3JpcHRpb24gdGFibGU+dGZvb3R7Ym9yZGVyLXRvcDp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtYm9yZGVyKX0uZGVzY3JpcHRpb24gdGFibGUgdGgsLmRlc2NyaXB0aW9uIHRhYmxlIHRke3BhZGRpbmc6MC41cmVtO3RleHQtYWxpZ246c3RhcnQ7Zm9udC13ZWlnaHQ6MzAwO2JvcmRlci1sZWZ0OnZhcigtLWl0ZW0tYnJvd3Nlci10YWJsZS1ib3JkZXIpO2JvcmRlci1yaWdodDp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtYm9yZGVyKX0uZGVzY3JpcHRpb24gdGFibGUgdHJ7dGV4dC1hbGlnbjpzdGFydDtib3JkZXItYm90dG9tOnZhcigtLWl0ZW0tYnJvd3Nlci10YWJsZS1ib3JkZXIpfS5kZXNjcmlwdGlvbiB0YWJsZSB0cjpsYXN0LWNoaWxke2JvcmRlci1ib3R0b206bm9uZX0uZmF2b3JpdGV7ZGlzcGxheTpibG9jaztwYWRkaW5nLXRvcDoxLjVyZW19LmNvcHktaW5wdXR7LS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfS5zdWJsYXllci1pdGVtey0tdHctc2hhZG93Om5vbmV9LnN1YmxheWVyX190YWJze2ZsZXg6MSAxIGF1dG87YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpfS5zdWJsYXllcl9fdGFicy0td2hpdGV7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSl9LnN1YmxheWVyLWl0ZW1fX2NvbnRlbnR7bWF4LXdpZHRoOjEwLjg3NXJlbTtkaXNwbGF5OmZsZXg7bWluLXdpZHRoOjBweDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59LnN1YmxheWVyLWl0ZW1fX3RpdGxle292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcDtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMik7dGV4dC1kZWNvcmF0aW9uLWxpbmU6dW5kZXJsaW5lfS5zdWJsYXllci1pdGVtX190aXRsZS0tbWF0Y2hlZHtwYWRkaW5nLXRvcDowcHg7cGFkZGluZy1ib3R0b206MHB4fS5zdWJsYXllci1pdGVtX19kZXNjcmlwdGlvbntmb250LXNpemU6MC43NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMyl9LnN1YmxheWVyX19oZWFkZXJ7ZGlzcGxheTpmbGV4O2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO3BhZGRpbmctbGVmdDoxcmVtO3BhZGRpbmctcmlnaHQ6MXJlbTtwYWRkaW5nLXRvcDoxcmVtO3BhZGRpbmctYm90dG9tOjAuNXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpfS5zdWJsYXllcl9faGVhZGVyX190aXRsZXttaW4td2lkdGg6MHB4O292ZXJmbG93LXdyYXA6YnJlYWstd29yZH0uc3VibGF5ZXJfX3RhYi1uYXZ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7cGFkZGluZy1sZWZ0OjFyZW07cGFkZGluZy1yaWdodDoxcmVtfS5zdWJsYXllcl9fY29udGVudHtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTttYXJnaW4tdG9wOi0wLjVyZW19LnN1YmxheWVyX19jb250ZW50LS1vdmVydmlld3tib3gtc2l6aW5nOmJvcmRlci1ib3g7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQpO3BhZGRpbmctdG9wOjJyZW07cGFkZGluZy1ib3R0b206MnJlbTtwYWRkaW5nLWxlZnQ6MS4yNXJlbTtwYWRkaW5nLXJpZ2h0OjEuMjVyZW19LmZvb3Rlci1hY3Rpb25ze2Rpc3BsYXk6Z3JpZDt3aWR0aDoxMDAlO2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMSwgbWlubWF4KDAsIDFmcikpO2dhcDowLjVyZW19LmVycm9yLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwMCU7cGFkZGluZzoxcmVtfVwiO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXcgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0Nsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXIgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0ludGVybmFsSXRlbUJyb3dzZXJTdWJsYXllclwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvblwiLCA3KTtcbiAgICAgICAgdGhpcy5zb3J0U3VibGF5ZXJzID0gKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZWRBID0gdGhpcy5sYXllck1hdGNoZXMoYSk7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVkQiA9IHRoaXMubGF5ZXJNYXRjaGVzKGIpO1xuICAgICAgICAgICAgaWYgKG1hdGNoZWRBID09PSBtYXRjaGVkQikge1xuICAgICAgICAgICAgICAgIHJldHVybiBiLmlkIC0gYS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVkQSA/IC0xIDogMTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5sYXllck1hdGNoZXMgPSAobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgICAgICByZXR1cm4gKF9lID0gKF9kID0gKF9jID0gKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaGlnaGxpZ2h0cykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jW3RoaXMuaXRlbS5pZF0pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zdWJsYXllcnMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5pbmNsdWRlcyhsYXllci5pZCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVuZGVyRmllbGQgPSAoZmllbGQpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWVsZC5uYW1lID09PSBcIk9CSkVDVElEXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLXByZXZpZXctZmllbGQtZGV0YWlsc1wiLCB7IGZpZWxkOiBmaWVsZCwgaXRlbTogdGhpcy5pdGVtLCBzdWJsYXllcjogdGhpcy5zdWJsYXllciwgYXBpOiBjb25maWdTdGF0ZS5hcGksIHNob3dGaWVsZFN0YXRpc3RpY3M6IHRoaXMuc3RvcmUuc3RhdGUuc2hvd0ZpZWxkU3RhdGlzdGljcyB9KSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlTGF5ZXJDbGljayA9IChsYXllcikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdWJsYXllciA9IGxheWVyO1xuICAgICAgICAgICAgdGhpcy5mZXRjaFN1YmxheWVyKCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgICAgICAgICAgICBhY3Rpb246IFwiY2xpY2tcIixcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJwYW5lbCBhY3Rpb25cIixcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiBcInN1YmxheWVyXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXIuZW1pdChPYmplY3QuYXNzaWduKHt9LCBsYXllcikpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlckxheWVyID0gKGxheWVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gdGhpcy5sYXllck1hdGNoZXMobGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgeyBpY29uIH0gPSBnZXRTdWJsYXllclR5cGVJbmZvKHsgZ2VvbWV0cnk6IGxheWVyLmdlb21ldHJ5VHlwZSwgdHlwZTogbGF5ZXIudHlwZSB9KTtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVMYXllckNsaWNrKGxheWVyKSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUxheWVyQ2xpY2sobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgY2xhc3M6IFwic3VibGF5ZXItaXRlbVwiIH0sIGgoXCJjYWxjaXRlLWljb25cIiwgeyBpY29uOiBpY29uLCBmbGlwUnRsOiB0cnVlLCBzY2FsZTogXCJzXCIsIHNsb3Q6IFwiY29udGVudC1zdGFydFwiIH0pLCBoKFwic3BhblwiLCB7IHNsb3Q6IFwiY29udGVudFwiLCBjbGFzczogXCJzdWJsYXllci1pdGVtX19jb250ZW50XCIgfSwgaChcInNwYW5cIiwgeyBjbGFzczogeyBcInN1YmxheWVyLWl0ZW1fX3RpdGxlXCI6IHRydWUsIFwic3VibGF5ZXItaXRlbV9fdGl0bGUtLW1hdGNoZWRcIjogbWF0Y2hlcyB9IH0sIGxheWVyLnRpdGxlIHx8IGxheWVyLm5hbWUpLCBtYXRjaGVzICYmIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic3VibGF5ZXItaXRlbV9fZGVzY3JpcHRpb25cIiB9LCB0aGlzLmkxOG4ubWF0Y2hlZCkpLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2NhbGU6IFwic1wiLCBzbG90OiBcImNvbnRlbnQtZW5kXCIsIGljb246IFwiY2hldnJvbi1yaWdodFwiLCBmbGlwUnRsOiB0cnVlLCBzdHlsZTogeyBkaXNwbGF5OiBcImZsZXhcIiwganVzdGlmeUNvbnRlbnQ6IFwiZmxleC1lbmRcIiB9IH0pKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oaWRlUHJldmlld0Zvb3RlcnMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mdWxsSXRlbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5mb3JtYXR0ZWRWaWV3cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sb2FkaW5nTGF5ZXJzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYXllckVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVycyA9IFtdO1xuICAgICAgICB0aGlzLnN1YmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZ1bGxTdWJsYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zaG93TGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXJJbmZvID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRhYiA9IFwiZmllbGRzXCI7XG4gICAgICAgIHRoaXMuaXRlbUVycm9yID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi5wcmV2aWV3O1xuICAgICAgICB0aGlzLmxheWVyVHlwZXMgPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4ubGF5ZXJUeXBlcztcbiAgICAgICAgdGhpcy5sYW5nID0gYXdhaXQgZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG4gICAgdXBkYXRlUHJldmlldygpIHtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuICAgIGFzeW5jIGZldGNoSXRlbSgpIHtcbiAgICAgICAgdGhpcy5pdGVtRXJyb3IgPSBudWxsO1xuICAgICAgICByZXR1cm4gZmV0Y2hQcmV2aWV3SXRlbSh0aGlzLml0ZW0sIHRoaXMucG9ydGFsLCB0aGlzLnVzZXIsIHRoaXMuc3RvcmUpO1xuICAgIH1cbiAgICBhc3luYyBpbml0KCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICAgICAgaWYgKCF0aGlzLml0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGl0ZW0sIHBvcnRhbCwgbGFuZyB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5mdWxsSXRlbSA9IG51bGw7XG4gICAgICAgIHRoaXMuc2hvdWxkRXhwYW5kT3ZlcnZpZXcgPSB0cnVlO1xuICAgICAgICB0aGlzLmxvYWRpbmdMYXllcnMgPSB0cnVlO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1pbkRlbGF5KHRoaXMuZmV0Y2hJdGVtKCksIDYwMCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgdGhpcy5pdGVtRXJyb3IgPVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yLmNvZGUgPT09IFwiZGlzYWJsZWRTdWJzY3JpcHRpb25cIlxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMuaTE4bi5pdGVtRXJyb3Iuc3Vic2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5pMThuLml0ZW1FcnJvci51bmhhbmRsZWQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mdWxsSXRlbSA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgdGhpcy5mb3JtYXR0ZWRWaWV3cyA9IGF3YWl0IGZvcm1hdE51bWJlcihpdGVtLm51bVZpZXdzIHx8IDAsIHtcbiAgICAgICAgICAgIGFwaTogY29uZmlnU3RhdGUuYXBpLFxuICAgICAgICAgICAgcGxhY2VzOiAwLFxuICAgICAgICAgICAgdHlwZTogXCJkZWNpbWFsXCJcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXNlckluZm8gPSBhd2FpdCBmZXRjaEl0ZW1Vc2VySW5mbyhpdGVtLCBwb3J0YWwsIGxhbmcpO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgY29uc3QgdHlwZVRvU2hvd0xheWVycyA9IFtcbiAgICAgICAgICAgIFwiRmVhdHVyZSBTZXJ2aWNlXCIsXG4gICAgICAgICAgICBcIkxheWVyIFRlbXBsYXRlXCIsXG4gICAgICAgICAgICBcIkZlYXR1cmUgQ29sbGVjdGlvblwiXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuc2hvd0xheWVycyA9XG4gICAgICAgICAgICB0eXBlVG9TaG93TGF5ZXJzLmluY2x1ZGVzKGl0ZW0udHlwZSkgJiYgISgoX2IgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwiUm91dGUgTGF5ZXJcIikpO1xuICAgICAgICBpZiAodGhpcy5zaG93TGF5ZXJzKSB7XG4gICAgICAgICAgICAvLyBsYXllciB0ZW1wbGF0ZXMgc3RvcmUgdGhlaXIgbGF5ZXJzL3NjaGVtYSBpbiBpdGVtIGRhdGFcbiAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwiTGF5ZXIgVGVtcGxhdGVcIiAmJlxuICAgICAgICAgICAgICAgICgoX2MgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLm1hcCgoa2V5d29yZCkgPT4ga2V5d29yZC50b0xvd2VyQ2FzZSgpKS5pbmNsdWRlcyhcInNlcnZpY2UgdGVtcGxhdGVcIikpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcXVlc3QoYCR7Z2V0UmVzdEJhc2VVcmwodGhpcy5wb3J0YWwpfWNvbnRlbnQvaXRlbXMvJHt0aGlzLml0ZW0uaWR9L2RhdGFgKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVycyA9IFsuLi4oKF9kID0gZGF0YS5sYXllcnMpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IFtdKSwgLi4uKChfZSA9IGRhdGEudGFibGVzKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBbXSldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXMuZnVsbEl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIHBvcnRhbDogY29uZmlnU3RhdGUucG9ydGFsLFxuICAgICAgICAgICAgICAgICAgICBsYXllcnM6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGlzU2VjdXJlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXllcnMgPSAoX2YgPSByZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zb3J0KHRoaXMuc29ydFN1YmxheWVycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJFcnJvciA9IHRoaXMuaTE4bi5sYXllckVycm9yO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IuY29kZSA9PT0gXCJzZXJ2aWNlTm90RXhpc3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXllckVycm9yLm1lc3NhZ2UgPSB0aGlzLmkxOG4ubm9TZXJ2aWNlTWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRpbmdMYXllcnMgPSBmYWxzZTtcbiAgICB9XG4gICAgaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKGVsZW1lbnQsIGRldGFpbHMpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckludGVybmFsVUlBY3Rpb24uZW1pdCh7XG4gICAgICAgICAgICBhY3Rpb246IGVsZW1lbnQuZXhwYW5kZWQgPyBcImV4cGFuZFwiIDogXCJjb2xsYXBzZVwiLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwicGFuZWwgYWN0aW9uXCIsXG4gICAgICAgICAgICBkZXRhaWxzXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBmZXRjaFN1YmxheWVyKCkge1xuICAgICAgICBjb25zdCBsYXllclJlc3BvbnNlID0gYXdhaXQgZmV0Y2hMYXllcih0aGlzLnBvcnRhbCwgdGhpcy5zdWJsYXllci5pZCwgdGhpcy5pdGVtLnVybCk7XG4gICAgICAgIHRoaXMuZnVsbFN1YmxheWVyID0gbGF5ZXJSZXNwb25zZSA9PT0gbnVsbCB8fCBsYXllclJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllclJlc3BvbnNlLnJlc3VsdDtcbiAgICB9XG4gICAgY2xvc2VQcmV2aWV3KCkge1xuICAgICAgICB0aGlzLnN1YmxheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5mdWxsSXRlbSA9IG51bGw7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgICAgICAgYWN0aW9uOiBcImNsb3NlIHBhbmVsXCIsXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJwYW5lbCBhY3Rpb25cIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDbG9zZS5lbWl0KCk7XG4gICAgfVxuICAgIHJlbmRlckhlYWRlcigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImhlYWRlci1jb250ZW50XCIsIGNsYXNzOiBcInByZXZpZXdfX2hlYWRlclwiIH0sIGgoXCJoM1wiLCB7IGNsYXNzOiBcInByZXZpZXdfX3RpdGxlXCIgfSwgKF9hID0gdGhpcy5pdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGUpLCBoKFwiYXJjZ2lzLWl0ZW0tdHlwZVwiLCB7IGl0ZW06IHRoaXMuaXRlbSwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2NhbGU6IFwibVwiIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckxheWVycygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkaW5nTGF5ZXJzID8gKGgoXCJjYWxjaXRlLWxvYWRlclwiLCB7IGxhYmVsOiB0aGlzLmkxOG4ubG9hZGluZywgc2NhbGU6IFwic1wiIH0pKSA6IHRoaXMubGF5ZXJFcnJvciA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGljb246IHRydWUsIG9wZW46IHRydWUsIHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiZnVsbFwiLCBraW5kOiBcIndhcm5pbmdcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIHRoaXMubGF5ZXJFcnJvci50aXRsZSksIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLmxheWVyRXJyb3IubWVzc2FnZSkpKSkgOiAoaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb24gc2VjdGlvbi0tdGlnaHRcIiB9LCBoKFwiY2FsY2l0ZS1saXN0XCIsIHsgXCJzZWxlY3Rpb24tbW9kZVwiOiBcIm5vbmVcIiwgbG9hZGluZzogdGhpcy5sb2FkaW5nTGF5ZXJzLCByZWY6IChsaXN0KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gKF9hID0gbGlzdCA9PT0gbnVsbCB8fCBsaXN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsaXN0LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKFwidGFibGVcIik7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLnN0eWxlLmJvcmRlclNwYWNpbmcgPSBcIjBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIChfYSA9IHRoaXMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKHRoaXMucmVuZGVyTGF5ZXIpKSkpO1xuICAgIH1cbiAgICBpc0FjY29yZGlvbkl0ZW0oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC50YWdOYW1lID09PSBcIkNBTENJVEUtQUNDT1JESU9OLUlURU1cIjtcbiAgICB9XG4gICAgaGFuZGxlU3VibGF5ZXJTZWN0aW9uQ2hhbmdlKHNlY3Rpb24pIHtcbiAgICAgICAgdGhpcy50YWIgPSBzZWN0aW9uO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbi5lbWl0KHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJjbGlja1wiLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwicGFuZWwgYWN0aW9uXCIsXG4gICAgICAgICAgICBkZXRhaWxzOiBgc3VibGF5ZXIgJHtzZWN0aW9ufWBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlclN1YmxheWVyUHJldmlldygpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgICAgICBjb25zdCB7IHN1YmxheWVyLCBpdGVtLCBpMThuLCBmdWxsU3VibGF5ZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZ2VvbWV0cnlUeXBlLCB0aXRsZSwgbmFtZSwgZGVzY3JpcHRpb24gfSA9IHN1YmxheWVyO1xuICAgICAgICBjb25zdCB7IHR5cGUsIGlzR2VvbWV0cnkgfSA9IGdldFN1YmxheWVyVHlwZUluZm8oe1xuICAgICAgICAgICAgZ2VvbWV0cnk6IGdlb21ldHJ5VHlwZSxcbiAgICAgICAgICAgIHR5cGU6IHN1YmxheWVyLnR5cGVcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGxheWVyVHlwZSA9IHRoaXMubGF5ZXJUeXBlc1t0eXBlXTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBjbG9zYWJsZTogdHJ1ZSwgb25DYWxjaXRlRmxvd0l0ZW1CYWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJbnRlcm5hbEl0ZW1Ccm93c2VyU3VibGF5ZXIuZW1pdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3VibGF5ZXIgPSBudWxsO1xuICAgICAgICAgICAgfSwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQcmV2aWV3KCk7XG4gICAgICAgICAgICB9IH0sIHRoaXMucmVuZGVySGVhZGVyKCksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzdWJsYXllcl9faGVhZGVyXCIgfSwgaChcImFyY2dpcy1zdWJsYXllci10eXBlXCIsIHsgbmFtZTogbmFtZSB8fCB0aXRsZSwgZ2VvbWV0cnk6IHN1YmxheWVyLmdlb21ldHJ5VHlwZSwgdHlwZTogc3VibGF5ZXIudHlwZSwgc2hvd1R5cGU6IGZhbHNlLCBzY2FsZTogXCJzXCIgfSkpLCBoKFwiY2FsY2l0ZS10YWJzXCIsIHsgcG9zaXRpb246IFwidG9wXCIsIHNjYWxlOiBcIm1cIiwgbGF5b3V0OiBcImNlbnRlclwiLCBjbGFzczogeyBzdWJsYXllcl9fdGFiczogdHJ1ZSwgXCJzdWJsYXllcl9fdGFicy0td2hpdGVcIjogdGhpcy50YWIgPT09IFwiZmllbGRzXCIgfSB9LCBoKFwiY2FsY2l0ZS10YWItbmF2XCIsIHsgc2xvdDogXCJ0aXRsZS1ncm91cFwiLCBjbGFzczogXCJzdWJsYXllcl9fdGFiLW5hdlwiIH0sIGgoXCJjYWxjaXRlLXRhYi10aXRsZVwiLCB7IG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlU3VibGF5ZXJTZWN0aW9uQ2hhbmdlKFwiZmllbGRzXCIpLCBzZWxlY3RlZDogdGhpcy50YWIgPT09IFwiZmllbGRzXCIgfSwgaTE4bi5maWVsZHMpLCBoKFwiY2FsY2l0ZS10YWItdGl0bGVcIiwgeyBvbkNsaWNrOiAoKSA9PiB0aGlzLmhhbmRsZVN1YmxheWVyU2VjdGlvbkNoYW5nZShcIm92ZXJ2aWV3XCIpLCBzZWxlY3RlZDogdGhpcy50YWIgPT09IFwib3ZlcnZpZXdcIiB9LCBpMThuLm92ZXJ2aWV3KSksIGgoXCJjYWxjaXRlLXRhYlwiLCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic3VibGF5ZXJfX2NvbnRlbnRcIiB9LCBzdWJsYXllci5maWVsZHMgPyAoc3VibGF5ZXIuZmllbGRzLm1hcCh0aGlzLnJlbmRlckZpZWxkKSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHQgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0sIGkxOG4ubm9GaWVsZHMpKSkpLCBoKFwiY2FsY2l0ZS10YWJcIiwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN1YmxheWVyX19jb250ZW50IHN1YmxheWVyX19jb250ZW50LS1vdmVydmlld1wiIH0sIHRoaXMucmVuZGVyRGV0YWlsKGlzR2VvbWV0cnkgPyBpMThuLmdlb21ldHJ5VHlwZVRpdGxlIDogaTE4bi5sYXllclR5cGVUaXRsZSwgbGF5ZXJUeXBlKSwgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uZGVzY3JpcHRpb24pLCBkZXNjcmlwdGlvbiA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0IGRlc2NyaXB0aW9uXCIsIGlubmVySFRNTDogc2FuaXRpemVIVE1MKGRlY29kZUhUTUxFbnRpdGllcyhkZXNjcmlwdGlvbikpIH0pKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub0Rlc2NyaXB0aW9uKSksICEoKF9hID0gdGhpcy5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiZcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uZGF0YVVwZGF0ZWQsIGZvcm1hdERhdGUoKF9iID0gZnVsbFN1YmxheWVyID09PSBudWxsIHx8IGZ1bGxTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnVsbFN1YmxheWVyLmVkaXRpbmdJbmZvKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGF0YUxhc3RFZGl0RGF0ZSkpLCAhKChfYyA9IHRoaXMucG9ydGFsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaXNQb3J0YWwpICYmXG4gICAgICAgICAgICB0aGlzLnJlbmRlckRldGFpbChpMThuLnNjaGVtYVVwZGF0ZWQsIGZvcm1hdERhdGUoKF9kID0gZnVsbFN1YmxheWVyID09PSBudWxsIHx8IGZ1bGxTdWJsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnVsbFN1YmxheWVyLmVkaXRpbmdJbmZvKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc2NoZW1hTGFzdEVkaXREYXRlKSksIGl0ZW0udXJsICYmIChoKFwiYXJjZ2lzLWl0ZW0tYnJvd3Nlci1wcmV2aWV3LWNvcHlcIiwgeyB0ZXh0OiBgJHtpdGVtLnVybH0vJHtzdWJsYXllci5pZH1gLCBoZWFkaW5nOiBpMThuLlVSTCB9KSkpKSksICF0aGlzLmhpZGVQcmV2aWV3Rm9vdGVycyAmJiAoaChcImRpdlwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGNsYXNzOiBcImZvb3Rlci1hY3Rpb25zXCIgfSwgdGhpcy5yZW5kZXJTdWJsYXllclNlbGVjdCgpLCBoKFwic2xvdFwiLCB7IG5hbWU6IFwic3VibGF5ZXItZm9vdGVyXCIgfSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXJEZXRhaWwodGl0bGUsIHRleHQsIGVtcHR5VGV4dCwgaHRtbCkge1xuICAgICAgICBjb25zdCB0ZXh0Tm9kZSA9ICFlbXB0eVRleHQgfHwgdGV4dCA/IChodG1sID8gKGgoXCJwXCIsIHsgY2xhc3M6IFwiZGV0YWlscy10ZXh0XCIsIGlubmVySFRNTDogc2FuaXRpemVIVE1MKHRleHQpIH0pKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dFwiIH0sIHRleHQpKSkgOiAoaChcInBcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRleHQgZGV0YWlscy10ZXh0LS1lbXB0eVwiIH0sIGVtcHR5VGV4dCkpO1xuICAgICAgICByZXR1cm4gW2goXCJoNFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGl0bGVcIiB9LCB0aXRsZSksIHRleHROb2RlXTtcbiAgICB9XG4gICAgcmVuZGVyU3VibGF5ZXJTZWxlY3QoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBpZiAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnNlbGVjdGlvbikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwic3VibGF5ZXJcIikpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImFyY2dpcy1pdGVtLWJyb3dzZXItY2FyZC1zdWJsYXllci1zZWxlY3RcIiwgeyBpdGVtOiB0aGlzLml0ZW0sIHVzZXI6IHRoaXMudXNlciwgcG9ydGFsOiB0aGlzLnBvcnRhbCwgc2VsZWN0aW9uOiAoKF9jID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXRlLnNlbGVjdGlvbikgPT09IFwibXVsdGlwbGUtc3VibGF5ZXJcIiA/IFwibXVsdGlwbGVcIiA6IFwic2luZ2xlXCIsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiZnVsbFwiIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfajtcbiAgICAgICAgY29uc3QgeyBpdGVtLCBmdWxsSXRlbSwgaTE4biwgdXNlciwgc3VibGF5ZXIsIHVzZXJJbmZvLCBwb3J0YWwsIGl0ZW1FcnJvciB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgb3duZXIgPSAoX2EgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0ub3duZXIpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgICAgIGNvbnN0IG1hbmFnZWRCeSA9IGdldENvbnRlbnRTdGF0dXMoZnVsbEl0ZW0pID09PSBcInB1YmxpY19hdXRob3JpdGF0aXZlXCJcbiAgICAgICAgICAgID8gdGhpcy5pMThuLml0ZW1NYW5hZ2VkQnkucmVwbGFjZShcIiR7dXNlcm5hbWV9XCIsIG93bmVyKVxuICAgICAgICAgICAgOiBvd25lcjtcbiAgICAgICAgY29uc3QgbGF5ZXJzSGVhZGVyID0gKChfYiA9IHRoaXMubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKVxuICAgICAgICAgICAgPyBpMThuLmxheWVyc0NvdW50LnJlcGxhY2UoXCIke2NvdW50fVwiLCBgJHsoKF9jID0gdGhpcy5sYXllcnMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sZW5ndGgpIHx8IDB9YClcbiAgICAgICAgICAgIDogaTE4bi5sYXllcnM7XG4gICAgICAgIGNvbnN0IG1hdGNoZWRTdWJsYXllcnMgPSAoX2YgPSAoX2UgPSAoX2QgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc3RhdGUuaGlnaGxpZ2h0cykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lW2l0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5pZF0pID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5zdWJsYXllcnM7XG4gICAgICAgIGNvbnN0IGxheWVyc0Rlc2NyaXB0aW9uID0gKG1hdGNoZWRTdWJsYXllcnMgPT09IG51bGwgfHwgbWF0Y2hlZFN1YmxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlZFN1YmxheWVycy5sZW5ndGgpICYmICF0aGlzLmxvYWRpbmdMYXllcnNcbiAgICAgICAgICAgID8gaTE4bi5tYXRjaGVkTnVtYmVyLnJlcGxhY2UoXCIke251bX1cIiwgYCR7bWF0Y2hlZFN1YmxheWVycy5sZW5ndGh9YClcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWZsb3dcIiwgbnVsbCwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgY2xvc2FibGU6IHRydWUsIGxvYWRpbmc6ICFmdWxsSXRlbSAmJiAhaXRlbUVycm9yLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVByZXZpZXcoKTtcbiAgICAgICAgICAgIH0sIHJlZjogKGVsKSA9PiAodGhpcy5mbG93SXRlbSA9IGVsKSB9LCB0aGlzLnJlbmRlckhlYWRlcigpLCAhIWl0ZW1FcnJvciAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImVycm9yLWNvbnRhaW5lclwiIH0sIGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IGtpbmQ6IFwiZGFuZ2VyXCIsIG9wZW46IHRydWUsIHNjYWxlOiBcInNcIiB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIHRoaXMuaTE4bi5pdGVtRXJyb3IudGl0bGUpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJtZXNzYWdlXCIgfSwgaXRlbUVycm9yKSkpKSwgZnVsbEl0ZW0gJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogXCJjb250ZW50XCIgfSwgaChcImNhbGNpdGUtYWNjb3JkaW9uXCIsIHsgXCJpY29uLXBvc2l0aW9uXCI6IFwic3RhcnRcIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBrZXk6IGl0ZW0uaWQsIGNsYXNzOiBcImFjY29yZGlvblwiLCBvbkNsaWNrOiBhc3luYyAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWNjb3JkaW9uSXRlbSh0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMzAwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5leHBhbmRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcInN0YXJ0XCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJjYWxjaXRlLWFjY29yZGlvbi1pdGVtXCIsIHsgaGVhZGluZzogaTE4bi50aHVtYm5haWwsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50aHVtYm5haWxFbGVtZW50ID0gZWw7XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBY2NvcmRpb25JdGVtQ2xpY2sodGhpcy50aHVtYm5haWxFbGVtZW50LCBcInRodW1ibmFpbFwiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvbiBzZWN0aW9uLS10aWdodFwiIH0sIGgoXCJhcmNnaXMtaXRlbS1icm93c2VyLWNhcmQtdGh1bWJuYWlsXCIsIHsgaXRlbTogaXRlbSwgdXNlcjogdXNlciwgcG9ydGFsOiBwb3J0YWwgfSkpKSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLm92ZXJ2aWV3LCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub3ZlcnZpZXdFbGVtZW50ID0gZWw7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkRXhwYW5kT3ZlcnZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuZXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3VsZEV4cGFuZE92ZXJ2aWV3ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMub3ZlcnZpZXdFbGVtZW50LCBcIm92ZXJ2aWV3XCIpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJzZWN0aW9uXCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcInN1bW1hcnktdG9wXCIgfSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uc3VtbWFyeSwgZnVsbEl0ZW0uc25pcHBldCwgaTE4bi5ub1N1bW1hcnkpLCAhISgoX2cgPSBnZXRCYWRnZXMoaXRlbSwgcG9ydGFsLCB1c2VyKSkgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLmxlbmd0aCkgJiYgW1xuICAgICAgICAgICAgaChcImg0XCIsIHsgY2xhc3M6IFwiZGV0YWlscy10aXRsZVwiIH0sIGkxOG4uaXRlbVN0YXR1cyksXG4gICAgICAgICAgICBoKFwiYXJjZ2lzLWl0ZW0tYmFkZ2VzXCIsIHsgY2xhc3M6IFwiYmFkZ2VzXCIsIGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsLCB1c2VyOiB1c2VyLCBzY2FsZTogXCJzXCIsIHdpZHRoOiBcImZ1bGxcIiB9KVxuICAgICAgICBdLCBoKFwiaDRcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRpdGxlXCIgfSwgaTE4bi5vd25lciksICgoX2ggPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2guc3RhdGUucGFuZWwpID8gKGgoXCJhcmNnaXMtdXNlci1hdmF0YXJcIiwgeyB1c2VyOiB1c2VySW5mbywgc2NhbGU6IFwic1wiLCBwb3J0YWw6IHBvcnRhbCwgc2hvd05hbWU6IHRydWUsIGRlc2NyaXB0aW9uOiBtYW5hZ2VkQnkgfSkpIDogKGgoXCJhcmNnaXMtdXNlci1wb3B1cFwiLCB7IGJhc2VVcmw6IGNvbmZpZ1N0YXRlLmNvbmZpZy5iYXNlVXJsLCBwb3J0YWw6IHBvcnRhbCwgaXRlbTogZnVsbEl0ZW0gfSkpLCBoKFwiaDRcIiwgeyBjbGFzczogXCJkZXRhaWxzLXRpdGxlXCIgfSwgaTE4bi5zaGFyZWQpLCBoKFwiYXJjZ2lzLWl0ZW0tc2hhcmUtc3VtbWFyeVwiLCB7IGl0ZW06IGZ1bGxJdGVtLCBzY2FsZTogXCJzXCIgfSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4udXBkYXRlZCwgZm9ybWF0RGF0ZShmdWxsSXRlbS5tb2RpZmllZCkpLCAhIXVzZXIgJiYgKGgoXCJhcmNnaXMtaXRlbS1mYXZvcml0ZVwiLCB7IGNsYXNzOiBcImZhdm9yaXRlXCIsIHVzZXI6IHVzZXIsIHBvcnRhbDogcG9ydGFsLCBpdGVtOiBmdWxsSXRlbSwgd2lkdGg6IFwiZnVsbFwiIH0pKSkpLCBoKFwiY2FsY2l0ZS1hY2NvcmRpb24taXRlbVwiLCB7IGhlYWRpbmc6IGkxOG4uZGVzY3JpcHRpb24sIGtleTogXCJkZXNjcmlwdGlvblwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50ID0gZWw7XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5pc0FjY29yZGlvbkl0ZW0oZS50YXJnZXQpICYmXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBY2NvcmRpb25JdGVtQ2xpY2sodGhpcy5kZXNjcmlwdGlvbkVsZW1lbnQsIFwiZGVzY3JpcHRpb25cIikgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInNlY3Rpb25cIiB9LCBmdWxsSXRlbS5kZXNjcmlwdGlvbiA/IChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiZGVzY3JpcHRpb25cIiwgaW5uZXJIVE1MOiBzYW5pdGl6ZUhUTUwoZnVsbEl0ZW0uZGVzY3JpcHRpb24pIH0pKSA6IChoKFwicFwiLCB7IGNsYXNzOiBcImRldGFpbHMtdGV4dCBkZXRhaWxzLXRleHQtLWVtcHR5XCIgfSwgaTE4bi5ub0Rlc2NyaXB0aW9uKSkpKSwgaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBpMThuLmRldGFpbHMsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZXRhaWxzRWxlbWVudCA9IGVsO1xuICAgICAgICAgICAgfSwgb25DbGljazogKGUpID0+IHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQWNjb3JkaW9uSXRlbUNsaWNrKHRoaXMuZGV0YWlsc0VsZW1lbnQsIFwiZGV0YWlsc1wiKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uY3JlYXRlZCwgZm9ybWF0RGF0ZShmdWxsSXRlbS5jcmVhdGVkKSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4udmlld0NvdW50LCB0aGlzLmZvcm1hdHRlZFZpZXdzKSwgaXRlbS50eXBlID09PSBcIkRhc2hib2FyZFwiICYmXG4gICAgICAgICAgICB0aGlzLnJlbmRlckRldGFpbChpMThuLmRhc2hib2FyZFZpZXdzLCAoKF9qID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9qID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfai5pbmNsdWRlcyhcIk1vYmlsZVwiKSlcbiAgICAgICAgICAgICAgICA/IGkxOG4uZGFzaGJvYXJkTW9iaWxlXG4gICAgICAgICAgICAgICAgOiBpMThuLmRhc2hib2FyZERlc2t0b3ApLCAhIWZ1bGxJdGVtLnNpemUgJiZcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uZmlsZVNpemUsIGZvcm1hdEZpbGVTaXplKGZ1bGxJdGVtLnNpemUpKSwgaChcImFyY2dpcy1pdGVtLWJyb3dzZXItcHJldmlldy1jb3B5XCIsIHsgdGV4dDogZnVsbEl0ZW0uaWQsIGhlYWRpbmc6IGkxOG4uSUQgfSksIGZ1bGxJdGVtLnVybCAmJiAoaChcImFyY2dpcy1pdGVtLWJyb3dzZXItcHJldmlldy1jb3B5XCIsIHsgdGV4dDogZnVsbEl0ZW0udXJsLCBoZWFkaW5nOiBpMThuLlVSTCB9KSksIHRoaXMucmVuZGVyRGV0YWlsKGkxOG4uY3JlZGl0cywgZnVsbEl0ZW0uYWNjZXNzSW5mb3JtYXRpb24sIGkxOG4ubm9DcmVkaXRzKSwgdGhpcy5yZW5kZXJEZXRhaWwoaTE4bi50ZXJtc09mVXNlLCBmdWxsSXRlbS5saWNlbnNlSW5mbywgaTE4bi5ub1Rlcm1zT2ZVc2UsIHRydWUpKSksIHRoaXMuc2hvd0xheWVycyAmJiAoaChcImNhbGNpdGUtYWNjb3JkaW9uLWl0ZW1cIiwgeyBoZWFkaW5nOiBsYXllcnNIZWFkZXIsIGRlc2NyaXB0aW9uOiBsYXllcnNEZXNjcmlwdGlvbiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyc0VsZW1lbnQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2xpY2s6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBY2NvcmRpb25JdGVtKGUudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFjY29yZGlvbkl0ZW1DbGljayh0aGlzLmxheWVyc0VsZW1lbnQsIFwibGF5ZXJzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgdGhpcy5yZW5kZXJMYXllcnMoKSkpKSkpLCAhdGhpcy5oaWRlUHJldmlld0Zvb3RlcnMgJiYgKGgoXCJkaXZcIiwgeyBzbG90OiBcImZvb3RlclwiLCBjbGFzczogXCJmb290ZXItYWN0aW9uc1wiIH0sIHRoaXMucmVuZGVyU3VibGF5ZXJTZWxlY3QoKSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImZvb3RlclwiIH0pKSkpLCAhIXN1YmxheWVyICYmIHRoaXMucmVuZGVyU3VibGF5ZXJQcmV2aWV3KCkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcIml0ZW1cIjogW1widXBkYXRlUHJldmlld1wiXVxuICAgIH07IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlclByZXZpZXcuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDc3M7XG5cbmNvbnN0IGFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NvcHlDc3MgPSBcIi5oZWFkaW5ne21hcmdpbi10b3A6MXJlbTttYXJnaW4tYm90dG9tOjBweDtwYWRkaW5nLWJvdHRvbTowLjI1cmVtO3BhZGRpbmctdG9wOjBweDtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpOy0tY2FsY2l0ZS1sYWJlbC1tYXJnaW4tYm90dG9tOjB9LmxhYmVse3BhZGRpbmctYm90dG9tOjBweH0uaW5wdXR7LS1jYWxjaXRlLWNvbG9yLWJhY2tncm91bmQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfS5hY3Rpb257cG9zaXRpb246cmVsYXRpdmV9LnRvb2x0aXB7cG9zaXRpb246YWJzb2x1dGU7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci1yYWRpdXM6dmFyKC0tY2FsY2l0ZS1ib3JkZXItcmFkaXVzKTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0xKTtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo1MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTEpO29wYWNpdHk6MDstLXR3LXNoYWRvdzowIDRweCA4cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMDgpLCAwIDJweCA0cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMDQpOy0tdHctc2hhZG93LWNvbG9yZWQ6MCA0cHggOHB4IC0xcHggdmFyKC0tdHctc2hhZG93LWNvbG9yKSwgMCAycHggNHB4IC0xcHggdmFyKC0tdHctc2hhZG93LWNvbG9yKTtib3gtc2hhZG93OnZhcigtLXR3LXJpbmctb2Zmc2V0LXNoYWRvdywgMCAwICMwMDAwKSwgdmFyKC0tdHctcmluZy1zaGFkb3csIDAgMCAjMDAwMCksIHZhcigtLXR3LXNoYWRvdyk7dHJhbnNpdGlvbi1wcm9wZXJ0eTpjb2xvciwgYmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCB0ZXh0LWRlY29yYXRpb24tY29sb3IsIGZpbGwsIHN0cm9rZSwgb3BhY2l0eSwgYm94LXNoYWRvdywgdHJhbnNmb3JtLCBmaWx0ZXIsIC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyO3RyYW5zaXRpb24tcHJvcGVydHk6Y29sb3IsIGJhY2tncm91bmQtY29sb3IsIGJvcmRlci1jb2xvciwgdGV4dC1kZWNvcmF0aW9uLWNvbG9yLCBmaWxsLCBzdHJva2UsIG9wYWNpdHksIGJveC1zaGFkb3csIHRyYW5zZm9ybSwgZmlsdGVyLCBiYWNrZHJvcC1maWx0ZXI7dHJhbnNpdGlvbi1wcm9wZXJ0eTpjb2xvciwgYmFja2dyb3VuZC1jb2xvciwgYm9yZGVyLWNvbG9yLCB0ZXh0LWRlY29yYXRpb24tY29sb3IsIGZpbGwsIHN0cm9rZSwgb3BhY2l0eSwgYm94LXNoYWRvdywgdHJhbnNmb3JtLCBmaWx0ZXIsIGJhY2tkcm9wLWZpbHRlciwgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI7dHJhbnNpdGlvbi1kdXJhdGlvbjoxNTBtczt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtOHB4KTt0b3A6Y2FsYygxMDAlICsgNHB4KTtpbnNldC1pbmxpbmUtZW5kOjA7d2lkdGg6YXV0bztib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYm9yZGVyLTMpO2xpbmUtaGVpZ2h0OjEuMzc1fS5idXR0b246aG92ZXIrLnRvb2x0aXAsLmJ1dHRvbjpmb2N1cysudG9vbHRpcHtvcGFjaXR5OjE7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMCl9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NvcHkgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VySW50ZXJuYWxVSUFjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uXCIsIDcpO1xuICAgICAgICB0aGlzLmhlYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jb3BpZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4uY29weTtcbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlQ29weSh0ZXh0KSB7XG4gICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHRleHQpO1xuICAgICAgICB0aGlzLmNvcGllZCA9IHRydWU7XG4gICAgICAgIGNvbnN0IGlzU3VibGF5ZXIgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwic3VibGF5ZXJfX2NvbnRlbnRcIik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJJbnRlcm5hbFVJQWN0aW9uLmVtaXQoe1xuICAgICAgICAgICAgYWN0aW9uOiBcImNvcHlcIixcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcInBhbmVsIGFjdGlvblwiLFxuICAgICAgICAgICAgZGV0YWlsczogaXNTdWJsYXllciA/IFwibGF5ZXJzXCIgOiBcImRldGFpbHNcIlxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgdGltZW91dCgxMDAwMCk7XG4gICAgICAgIHRoaXMuY29waWVkID0gZmFsc2U7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBoZWFkaW5nLCB0ZXh0LCBpMThuIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJsYWJlbFwiLCBzY2FsZTogXCJzXCIgfSwgaChcImg0XCIsIHsgY2xhc3M6IFwiaGVhZGluZ1wiIH0sIGhlYWRpbmcpLCBoKFwiY2FsY2l0ZS1pbnB1dFwiLCB7IHZhbHVlOiB0ZXh0LCByZWFkT25seTogdHJ1ZSwgYWxpZ25tZW50OiBcInN0YXJ0XCIsIHR5cGU6IFwidGV4dFwiLCBsYWJlbDogaGVhZGluZywgc2NhbGU6IFwic1wiLCBjbGFzczogXCJpbnB1dFwiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcImFjdGlvblwiLCBjbGFzczogXCJhY3Rpb25cIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJidXR0b25cIiwgc2xvdDogXCJhY3Rpb25cIiwgaWNvblN0YXJ0OiBcImNvcHktdG8tY2xpcGJvYXJkXCIsIGlkOiBcImNvcHktYnV0dG9uXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBzY2FsZTogXCJzXCIsIG9uQ2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlQ29weSh0ZXh0KSwgb25Nb3VzZU91dDogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMjAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvcGllZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInRvb2x0aXBcIiB9LCB0aGlzLmNvcGllZCA/IGkxOG4gPT09IG51bGwgfHwgaTE4biA9PT0gdm9pZCAwID8gdm9pZCAwIDogaTE4bi5jb3BpZWQgOiBpMThuID09PSBudWxsIHx8IGkxOG4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGkxOG4uY29weSkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0l0ZW1Ccm93c2VyUHJldmlld0NvcHkuc3R5bGUgPSBhcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDb3B5Q3NzO1xuXG5jb25zdCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXdGaWVsZERldGFpbHMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmZpZWxkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3VibGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0ZpZWxkU3RhdGlzdGljcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hcGkgPSA0O1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhc3luYyBnZXRGaWVsZERhdGEoKSB7XG4gICAgICAgIGlmICghdGhpcy5sYXllcikge1xuICAgICAgICAgICAgY29uc3QgW0ZlYXR1cmVMYXllcl0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2xheWVycy9GZWF0dXJlTGF5ZXJcIl0pO1xuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBuZXcgRmVhdHVyZUxheWVyKHtcbiAgICAgICAgICAgICAgICAvLyBOb3RpY2UgdGhhdCB0aGUgdXJsIGRvZXNuJ3QgZW5kIHdpdGggLzJcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuaXRlbS51cmwsXG4gICAgICAgICAgICAgICAgbGF5ZXJJZDogdGhpcy5zdWJsYXllci5pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhd2FpdCBsYXllci5sb2FkKCk7XG4gICAgICAgICAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGZpZWxkLCBzaG93RmllbGRTdGF0aXN0aWNzLCBhcGkgfSA9IHRoaXM7XG4gICAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGhlYWRpbmc6IGZpZWxkLmFsaWFzIHx8IGZpZWxkLm5hbWUsIGRlc2NyaXB0aW9uOiBmaWVsZC5uYW1lLCBoZWFkaW5nTGV2ZWw6IDUsIGNvbGxhcHNpYmxlOiBzaG93RmllbGRTdGF0aXN0aWNzICYmIGFwaSA9PT0gNCAmJiB0aGlzLml0ZW0udHlwZSA9PT0gXCJGZWF0dXJlIFNlcnZpY2VcIiwgb25DYWxjaXRlQmxvY2tUb2dnbGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldEZpZWxkRGF0YSgpO1xuICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgc2xvdDogXCJpY29uXCIsIGljb246IGZpZWxkVHlwZUljb25zW2ZpZWxkLnR5cGVdIHx8IFwic3RyaW5nXCIsIHNjYWxlOiBcInNcIiwgY2xhc3M6IFwibGF5ZXItaWNvblwiIH0pLCAhIXRoaXMubGF5ZXIgJiYgaChcImFyY2dpcy1maWVsZC1pbmZvXCIsIHsgbGF5ZXI6IHRoaXMubGF5ZXIsIGZpZWxkTmFtZTogZmllbGQubmFtZSB9KSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJTZWFyY2ggPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VhcmNoID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclNlYXJjaFwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlYXJjaElucHV0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclNlYXJjaElucHV0XCIsIDcpO1xuICAgICAgICB0aGlzLnRlcm0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IHRlcm0sIHBsYWNlaG9sZGVyIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgKChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmJ1Y2tldCkgIT09IFwic3Vic2NyaXB0aW9uIGNvbnRlbnRcIiAmJiAoaChcImFyY2dpcy1icm93c2VyLXNlYXJjaFwiLCB7IHRlcm06IHRlcm0sIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwgb25BcmNnaXNCcm93c2VyU2VhcmNoOiAoZSkgPT4gdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNlYXJjaC5lbWl0KGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU2VhcmNoSW5wdXQ6IChlKSA9PiB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyU2VhcmNoSW5wdXQuZW1pdChlLmRldGFpbCkgfSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5cbmNvbnN0IGRlZmF1bHRTb3J0T3JkZXJzID0ge1xuICAgIG15OiB7XG4gICAgICAgIHNvcnRGaWVsZDogXCJtb2RpZmllZFwiLFxuICAgICAgICBzb3J0T3JkZXI6IFwiZGVzY1wiXG4gICAgfSxcbiAgICBmYXZvcml0ZXM6IHtcbiAgICAgICAgc29ydEZpZWxkOiBcIm1vZGlmaWVkXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJkZXNjXCJcbiAgICB9LFxuICAgIGdyb3VwOiB7XG4gICAgICAgIHNvcnRGaWVsZDogXCJtb2RpZmllZFwiLFxuICAgICAgICBzb3J0T3JkZXI6IFwiZGVzY1wiXG4gICAgfSxcbiAgICBvcmc6IHtcbiAgICAgICAgc29ydEZpZWxkOiBcIm1vZGlmaWVkXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJkZXNjXCJcbiAgICB9LFxuICAgIFwic3Vic2NyaXB0aW9uIGNvbnRlbnRcIjoge1xuICAgICAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIlxuICAgIH0sXG4gICAgXCJsaXZpbmcgYXRsYXNcIjoge1xuICAgICAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIlxuICAgIH0sXG4gICAgXCJsaXZpbmcgYXRsYXMgYW5hbHlzaXNcIjoge1xuICAgICAgICBzb3J0RmllbGQ6IFwicmVsZXZhbmNlXCIsXG4gICAgICAgIHNvcnRPcmRlcjogXCJhc2NcIlxuICAgIH0sXG4gICAgYWxsOiB7XG4gICAgICAgIHNvcnRGaWVsZDogXCJyZWxldmFuY2VcIixcbiAgICAgICAgc29ydE9yZGVyOiBcImFzY1wiXG4gICAgfVxufTtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJTb3J0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNvcnQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyU29ydFwiLCA3KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gW1widGl0bGVcIiwgXCJyZWxldmFuY2VcIiwgXCJtb2RpZmllZFwiXTtcbiAgICAgICAgdGhpcy5maWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5vcmRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hY3RpdmVPcmRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51c2VyU2V0U29ydCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICBjb25zdCB7IGZpZWxkLCBvcHRpb25zIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIWZpZWxkKSB7XG4gICAgICAgICAgICBjb25zdCBidWNrZXRTb3J0ID0gdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXQgJiYgZGVmYXVsdFNvcnRPcmRlcnNbdGhpcy5zdG9yZS5zdGF0ZS5idWNrZXRdO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IGJ1Y2tldFNvcnQgPyBidWNrZXRTb3J0LnNvcnRGaWVsZCA6IChvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnNbMF0pIHx8IFwicmVsZXZhbmNlXCI7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZU9yZGVyID0gZ2V0RGVmYXVsdFNvcnRPcmRlcih0aGlzLmFjdGl2ZUZpZWxkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudXNlclNldFNvcnQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWVsZCA9IGZpZWxkO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVPcmRlciA9IHRoaXMub3JkZXIgfHwgZ2V0RGVmYXVsdFNvcnRPcmRlcihmaWVsZCk7XG4gICAgICAgIH1cbiAgICAgICAgb25JdGVtQnJvd3NlckJ1Y2tldENoYW5nZSh0aGlzLnN0b3JlLCAoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0U29ydCA9IGRlZmF1bHRTb3J0T3JkZXJzW2J1Y2tldF07XG4gICAgICAgICAgICBpZiAoZGVmYXVsdFNvcnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNvcnRGaWVsZChkZWZhdWx0U29ydC5zb3J0RmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb25JdGVtQnJvd3NlclNvcnRDaGFuZ2UodGhpcy5zdG9yZSwgKHNvcnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlRmllbGQgPSBzb3J0LnNvcnRGaWVsZDtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBzb3J0LnNvcnRPcmRlcjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgc29ydEZpZWxkOiB0aGlzLmZpZWxkIHx8IHRoaXMuYWN0aXZlRmllbGQsXG4gICAgICAgICAgICBzb3J0T3JkZXI6IHRoaXMub3JkZXIgfHwgKHRoaXMuZmllbGQgPyBnZXREZWZhdWx0U29ydE9yZGVyKHRoaXMuZmllbGQpIDogdGhpcy5hY3RpdmVPcmRlcilcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZVNvcnRGaWVsZChmaWVsZCkge1xuICAgICAgICB0aGlzLmFjdGl2ZUZpZWxkID0gZmllbGQ7XG4gICAgICAgIHRoaXMuYWN0aXZlT3JkZXIgPSBnZXREZWZhdWx0U29ydE9yZGVyKGZpZWxkKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNvcnQuZW1pdCh7XG4gICAgICAgICAgICBzb3J0RmllbGQ6IHRoaXMuYWN0aXZlRmllbGQsXG4gICAgICAgICAgICBzb3J0T3JkZXI6IHRoaXMuYWN0aXZlT3JkZXJcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZVNvcnRPcmRlcihvcmRlcikge1xuICAgICAgICB0aGlzLmFjdGl2ZU9yZGVyID0gb3JkZXI7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgc29ydEZpZWxkOiB0aGlzLmFjdGl2ZUZpZWxkLFxuICAgICAgICAgICAgc29ydE9yZGVyOiB0aGlzLmFjdGl2ZU9yZGVyXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgYWN0aXZlRmllbGQsIGFjdGl2ZU9yZGVyLCBmaWVsZCwgb3JkZXIsIG9wdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGQgPSBhY3RpdmVGaWVsZCB8fCAob3B0aW9ucy5pbmNsdWRlcyhmaWVsZCkgPyBmaWVsZCA6IG9wdGlvbnNbMF0pO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE9yZGVyID0gYWN0aXZlT3JkZXIgfHwgb3JkZXI7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCAoKF9iID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYnVja2V0KSAhPT0gXCJzdWJzY3JpcHRpb24gY29udGVudFwiICYmIChoKFwiYXJjZ2lzLWJyb3dzZXItc29ydFwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBmaWVsZDogc2VsZWN0ZWRGaWVsZCwgb3JkZXI6IHNlbGVjdGVkT3JkZXIsIG9wdGlvbnM6IG9wdGlvbnMsIG9uQXJjZ2lzQnJvd3NlclNvcnRGaWVsZENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlU29ydEZpZWxkKGUuZGV0YWlsKSwgb25BcmNnaXNCcm93c2VyU29ydE9yZGVyQ2hhbmdlOiAoZSkgPT4gdGhpcy51cGRhdGVTb3J0T3JkZXIoZS5kZXRhaWwpIH0pKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBDT0xVTU5TID0ge1xuICAgIHRpdGxlOiB7XG4gICAgICAgIHdpZHRoOiBcIm1pbm1heCgwLCA3ZnIpXCJcbiAgICB9LFxuICAgIHR5cGU6IHtcbiAgICAgICAgd2lkdGg6IFwibWlubWF4KDAsIDVmcilcIixcbiAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgfSxcbiAgICBtb2RpZmllZDoge1xuICAgICAgICB3aWR0aDogXCI3LjVyZW1cIlxuICAgIH0sXG4gICAgYmFkZ2VzOiB7XG4gICAgICAgIHdpZHRoOiBcIjYuNXJlbVwiLFxuICAgICAgICBoaWRkZW46IHRydWVcbiAgICB9LFxuICAgIG93bmVyOiB7XG4gICAgICAgIHdpZHRoOiBcIm1pbm1heCgwLCAzZnIpXCJcbiAgICB9LFxuICAgIHNoYXJpbmc6IHtcbiAgICAgICAgd2lkdGg6IFwiNnJlbVwiLFxuICAgICAgICBoaWRkZW46IHRydWVcbiAgICB9LFxuICAgIHNpemU6IHtcbiAgICAgICAgd2lkdGg6IFwibWlubWF4KDAsIDJmcilcIlxuICAgIH0sXG4gICAgZGVsZXRlZDoge1xuICAgICAgICB3aWR0aDogXCIxMnJlbVwiXG4gICAgfSxcbiAgICBkZXRhaWxzOiB7XG4gICAgICAgIHdpZHRoOiBcIjhyZW1cIixcbiAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgfSxcbiAgICBmYXZvcml0ZToge1xuICAgICAgICB3aWR0aDogXCIzLjVyZW1cIixcbiAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgfSxcbiAgICBhY3Rpb25zOiB7XG4gICAgICAgIHdpZHRoOiBcIjMuNXJlbVwiLFxuICAgICAgICBoaWRkZW46IHRydWVcbiAgICB9XG59O1xuZnVuY3Rpb24gY2FsY3VsYXRlRGF5c1VudGlsRGVsZXRpb24oZGF0ZSkge1xuICAgIGNvbnN0IGRhdGVEZWxldGVkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZShkYXRlRGVsZXRlZC5zZXREYXRlKGRhdGVEZWxldGVkLmdldERhdGUoKSArIERBWVNfSU5fUkVDWUNMRV9CSU4pKTtcbiAgICAvLyBDYXAgbWluaW11bSBkYXlzIHJlbWFpbmluZyBhdCAxIHRvIGVuc3VyZSBjdWx0dXJlVXRpbCBkb2Vzbid0IGxvc2UgaXRzIGBzaW5nbGVgIHN0cmluZ1xuICAgIHJldHVybiBNYXRoLm1heChNYXRoLmNlaWwoKGV4cGlyYXRpb25EYXRlLnZhbHVlT2YoKSAtIERhdGUubm93KCkpIC8gODY0MDAwMDApLCAxKTtcbn1cblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZUNzcyA9IFwiLnRhYmxle2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfS5oZWFkZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtY29sdW1ucyl9LmJ1dHRvbl9fLXRleHQtc29ydGVke2ZvbnQtd2VpZ2h0OjUwMH0uY29sdW1uLWhlYWRlcntib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0yKTttYXJnaW4tYm90dG9tOjFweH0uY29sdW1uLWhlYWRlci0tc29ydGVke2JvcmRlci1ib3R0b20tY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCl9LnNjcmVlbi1yZWFkZXItb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyVGFibGUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ29sdW1uVXBkYXRlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlckNvbHVtblVwZGF0ZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclNvcnQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyU29ydFwiLCA3KTtcbiAgICAgICAgdGhpcy5yb3dzID0gW107XG4gICAgICAgIHRoaXMuY29sdW1ucyA9IFtcbiAgICAgICAgICAgIFwidGl0bGVcIixcbiAgICAgICAgICAgIFwidHlwZVwiLFxuICAgICAgICAgICAgXCJtb2RpZmllZFwiLFxuICAgICAgICAgICAgXCJiYWRnZXNcIixcbiAgICAgICAgICAgIFwib3duZXJcIixcbiAgICAgICAgICAgIFwic2hhcmluZ1wiLFxuICAgICAgICAgICAgXCJkZXRhaWxzXCIsXG4gICAgICAgICAgICBcImFjdGlvbnNcIlxuICAgICAgICBdO1xuICAgICAgICB0aGlzLmFjdGl2ZUZvY3VzID0gWzAsIDBdO1xuICAgIH1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IGdldEl0ZW1Ccm93c2VyU3RvcmUodGhpcy5lbCk7XG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMuc3RvcmUuc3RhdGUuaTE4bi50YWJsZTtcbiAgICAgICAgb25JdGVtQnJvd3NlclByZXZpZXdDaGFuZ2UodGhpcy5zdG9yZSwgKHByZXZpZXcpID0+IHtcbiAgICAgICAgICAgIC8vIHdoZW4gdGhlIHByZXZpZXcgaXMgY2xvc2VkLCByZXN0b3JlIGZvY3VzIHRvIHRoZSBncmlkXG4gICAgICAgICAgICBpZiAoIXByZXZpZXcgJiYgdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IFtyb3csIGNvbHVtbl0gPSB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm93cygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvd0VsZW1lbnQgPSB0aGlzLnJvd3Nbcm93XTtcbiAgICAgICAgICAgICAgICByb3dFbGVtZW50ID09PSBudWxsIHx8IHJvd0VsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJvd0VsZW1lbnQuZm9jdXNDb2x1bW4oY29sdW1uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDb2x1bW5VcGRhdGUuZW1pdCh0aGlzLmNvbHVtbnMpO1xuICAgIH1cbiAgICB1cGRhdGVDb2x1bW5zKGNvbHVtbnMpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNvbHVtblVwZGF0ZS5lbWl0KGNvbHVtbnMpO1xuICAgIH1cbiAgICBhc3luYyBhdHRlbXB0TW92ZShbcm93LCBjb2x1bW5dLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgY29uc3Qgcm93RWxlbWVudCA9IHRoaXMucm93c1tyb3ddO1xuICAgICAgICBpZiAoYXdhaXQgcm93RWxlbWVudC5jYW5Gb2N1c0NvbHVtbihjb2x1bW4pKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzID0gW3JvdywgY29sdW1uXTtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiByb3dFbGVtZW50LmZvY3VzQ29sdW1uKGNvbHVtbikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW92ZVJpZ2h0KFtyb3csIGNvbHVtbl0pO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVMZWZ0KFtyb3csIGNvbHVtbl0pO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ1cFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlVXAoW3JvdywgY29sdW1uXSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRvd25cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW92ZURvd24oW3JvdywgY29sdW1uXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlUm93cygpIHtcbiAgICAgICAgdGhpcy5yb3dzID0gdGhpcy5yb3dTbG90LmFzc2lnbmVkRWxlbWVudHMoKTtcbiAgICB9XG4gICAgZ2V0TGFzdENvbHVtbkluZGV4KCkge1xuICAgICAgICBjb25zdCBpc011bHRpU2VsZWN0ID0gdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIjtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1ucy5sZW5ndGggLSAoaXNNdWx0aVNlbGVjdCA/IDAgOiAxKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJvd0luZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb3dzLmxlbmd0aCAtIDE7XG4gICAgfVxuICAgIGFzeW5jIG1vdmVSaWdodChbcm93LCBjdXJyZW50Q29sdW1uXSkge1xuICAgICAgICBjb25zdCBkZXNpcmVkQ29sdW1uID0gY3VycmVudENvbHVtbiA+PSB0aGlzLmdldExhc3RDb2x1bW5JbmRleCgpID8gMCA6IGN1cnJlbnRDb2x1bW4gKyAxO1xuICAgICAgICB0aGlzLmF0dGVtcHRNb3ZlKFtyb3csIGRlc2lyZWRDb2x1bW5dLCBcInJpZ2h0XCIpO1xuICAgIH1cbiAgICBhc3luYyBtb3ZlTGVmdChbcm93LCBjdXJyZW50Q29sdW1uXSkge1xuICAgICAgICBjb25zdCBkZXNpcmVkQ29sdW1uID0gY3VycmVudENvbHVtbiA8IDEgPyB0aGlzLmdldExhc3RDb2x1bW5JbmRleCgpIDogY3VycmVudENvbHVtbiAtIDE7XG4gICAgICAgIHRoaXMuYXR0ZW1wdE1vdmUoW3JvdywgZGVzaXJlZENvbHVtbl0sIFwibGVmdFwiKTtcbiAgICB9XG4gICAgYXN5bmMgbW92ZVVwKFtjdXJyZW50Um93LCBjb2x1bW5dKSB7XG4gICAgICAgIGNvbnN0IGRlc2lyZWRSb3cgPSBjdXJyZW50Um93IDwgMSA/IHRoaXMuZ2V0TGFzdFJvd0luZGV4KCkgOiBjdXJyZW50Um93IC0gMTtcbiAgICAgICAgdGhpcy5hdHRlbXB0TW92ZShbZGVzaXJlZFJvdywgY29sdW1uXSwgXCJ1cFwiKTtcbiAgICB9XG4gICAgYXN5bmMgbW92ZURvd24oW2N1cnJlbnRSb3csIGNvbHVtbl0pIHtcbiAgICAgICAgY29uc3QgZGVzaXJlZFJvdyA9IGN1cnJlbnRSb3cgKyAxID4gdGhpcy5nZXRMYXN0Um93SW5kZXgoKSA/IDAgOiBjdXJyZW50Um93ICsgMTtcbiAgICAgICAgdGhpcy5hdHRlbXB0TW92ZShbZGVzaXJlZFJvdywgY29sdW1uXSwgXCJkb3duXCIpO1xuICAgIH1cbiAgICBoYW5kbGVLZXlib2FyZChlKSB7XG4gICAgICAgIGNvbnN0IHsga2V5IH0gPSBlO1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cyB8fCBbMCwgMF07XG4gICAgICAgIHRoaXMudXBkYXRlUm93cygpO1xuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSBcIkFycm93RG93blwiOlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlRG93bihjdXJyZW50KTtcbiAgICAgICAgICAgIGNhc2UgXCJBcnJvd1VwXCI6XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdmVVcChjdXJyZW50KTtcbiAgICAgICAgICAgIGNhc2UgXCJBcnJvd0xlZnRcIjpcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW92ZUxlZnQoY3VycmVudCk7XG4gICAgICAgICAgICBjYXNlIFwiQXJyb3dSaWdodFwiOlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlUmlnaHQoY3VycmVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyQ29sdW1uKGlkKSB7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5pMThuLmhlYWRlcnNbaWRdO1xuICAgICAgICBjb25zdCB7IGhpZGRlbiB9ID0gQ09MVU1OU1tpZF07XG4gICAgICAgIGNvbnN0IHsgc29ydEZpZWxkLCBzb3J0T3JkZXIgfSA9IHRoaXMuc3RvcmUuc3RhdGUuc29ydCB8fCB7fTtcbiAgICAgICAgY29uc3Qgc29ydElEID0gaWQgPT09IFwiZGVsZXRlZFwiID8gXCJtb2RpZmllZFwiIDogaWQ7XG4gICAgICAgIGNvbnN0IGlzU29ydGVkID0gc29ydEZpZWxkID09PSBzb3J0SUQ7XG4gICAgICAgIHJldHVybiBoaWRkZW4gPyAoaChcImRpdlwiLCB7IHJvbGU6IFwiY29sdW1uaGVhZGVyXCIsIGNsYXNzOiBcImNvbHVtbi1oZWFkZXJcIiB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcInNjcmVlbi1yZWFkZXItb25seVwiIH0sIGxhYmVsKSkpIDogKGgoXCJkaXZcIiwgeyBjbGFzczogeyBcImNvbHVtbi1oZWFkZXJcIjogdHJ1ZSwgXCJjb2x1bW4taGVhZGVyLS1zb3J0ZWRcIjogaXNTb3J0ZWQgfSB9LCAhIShpZCA9PT0gXCJ0aXRsZVwiICYmIHRoaXMuc3RvcmUuc3RhdGUuc2VsZWN0aW9uID09PSBcIm11bHRpcGxlXCIpICYmIChoKFwiZGl2XCIsIHsgcm9sZTogXCJjb2x1bW5oZWFkZXJcIiwgY2xhc3M6IFwic2NyZWVuLXJlYWRlci1vbmx5XCIgfSwgaChcInNwYW5cIiwgbnVsbCwgdGhpcy5pMThuLnNlbGVjdGlvbikpKSwgaChcImRpdlwiLCB7IHJvbGU6IFwiY29sdW1uaGVhZGVyXCIsIFwiYXJpYS1zb3J0XCI6IHNvcnRPcmRlciA9PT0gXCJhc2NcIiA/IFwiYXNjZW5kaW5nXCIgOiBcImRlc2NlbmRpbmdcIiB9LCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyB3aWR0aDogXCJmdWxsXCIsIGFsaWdubWVudDogXCJpY29uLWVuZC1zcGFjZS1iZXR3ZWVuXCIsIHRhYmluZGV4OiBcIi0xXCIsIHNjYWxlOiBcIm1cIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBraW5kOiBpc1NvcnRlZCA/IFwiYnJhbmRcIiA6IFwibmV1dHJhbFwiLCBcImljb24tZW5kXCI6IGlzU29ydGVkICYmIHNvcnRPcmRlciA9PT0gXCJhc2NcIiA/IFwiY2FyZXQtdXBcIiA6IFwiY2FyZXQtZG93blwiLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGFscmVhZHkgc29ydGluZyBvbiB0aGlzIGZpZWxkLCBmbGlwIGl0XG4gICAgICAgICAgICAgICAgaWYgKGlzU29ydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ydEZpZWxkOiBzb3J0SUQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0T3JkZXI6IHNvcnRPcmRlciA9PT0gXCJhc2NcIiA/IFwiZGVzY1wiIDogXCJhc2NcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJTb3J0LmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ydEZpZWxkOiBzb3J0SUQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0T3JkZXI6IGdldERlZmF1bHRTb3J0T3JkZXIoc29ydElEKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sIGgoXCJzcGFuXCIsIHsgY2xhc3M6IHsgYnV0dG9uX190ZXh0OiB0cnVlLCBcImJ1dHRvbl9fdGV4dC0tc29ydGVkXCI6IGlzU29ydGVkIH0gfSwgbGFiZWwpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBpc011bHRpU2VsZWN0ID0gdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIjtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIHsgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICBcIi0taXRlbS1icm93c2VyLXRhYmxlLWNvbHVtbnNcIjogYCR7dGhpcy5jb2x1bW5zLm1hcCgoaWQpID0+IENPTFVNTlNbaWRdLndpZHRoKS5qb2luKFwiIFwiKX1gXG4gICAgICAgICAgICB9IH0sIGgoXCJkaXZcIiwgT2JqZWN0LmFzc2lnbih7IGNsYXNzOiBcInRhYmxlXCIsIFwiYXJpYS1sYWJlbFwiOiB0aGlzLmkxOG4uY2FwdGlvbiwgcm9sZTogXCJncmlkXCIsIFwiYXJpYS1yZWFkb25seVwiOiBcInRydWVcIiB9LCAoaXNNdWx0aVNlbGVjdCA/IHsgXCJhcmlhLW11bHRpc2VsZWN0YWJsZVwiOiBcInRydWVcIiB9IDoge30pLCB7IG9uS2V5RG93bjogKGUpID0+IHRoaXMuaGFuZGxlS2V5Ym9hcmQoZSkgfSksIGgoXCJkaXZcIiwgeyByb2xlOiBcInJvd2dyb3VwXCIgfSwgaChcImRpdlwiLCB7IHJvbGU6IFwicm93XCIsIGNsYXNzOiBcImhlYWRlclwiIH0sIHRoaXMuY29sdW1ucy5tYXAoKGlkKSA9PiB0aGlzLnJlbmRlckNvbHVtbihpZCkpKSksIGgoXCJkaXZcIiwgbnVsbCwgaChcInNsb3RcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMucm93U2xvdCA9IGVsKSB9KSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcImNvbHVtbnNcIjogW1widXBkYXRlQ29sdW1uc1wiXVxuICAgIH07IH1cbn07XG5BcmNnaXNJdGVtQnJvd3NlclRhYmxlLnN0eWxlID0gYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZUNzcztcblxuY29uc3QgYXJjZ2lzSXRlbUJyb3dzZXJUYWJsZVJvd0NzcyA9IFwiOmhvc3R7ZGlzcGxheTpibG9jazstLWl0ZW0tYnJvd3Nlci10YWJsZS1yb3ctYWN0aXZlLWJhY2tncm91bmQ6I2JiZDVmYTI2fS5yb3d7ZGlzcGxheTpncmlkO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO2dyaWQtdGVtcGxhdGUtY29sdW1uczp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtY29sdW1ucyk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMSk7Ym9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMik7bWFyZ2luLXRvcDotMXB4fS5yb3ctLWZpcnN0e2JvcmRlci10b3AtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpfS5yb3ctLXNlbGVjdGVke3Bvc2l0aW9uOnJlbGF0aXZlO2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWl0ZW0tYnJvd3Nlci10YWJsZS1yb3ctYWN0aXZlLWJhY2tncm91bmQpfS5yb3ctLXNlbGVjdGVkLWxhc3R7Ym9yZGVyLXRvcC1jb2xvcjp2YXIoLS1pdGVtLWJyb3dzZXItdGFibGUtcm93LWFjdGl2ZS1iYWNrZ3JvdW5kKX0uY2VsbHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpmbGV4LXN0YXJ0O3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO2ZvbnQtc2l6ZTowLjg3NXJlbTtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSk7b3V0bGluZS1jb2xvcjp0cmFuc3BhcmVudDtsaW5lLWhlaWdodDoxLjM1fS5jZWxsOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0Oi0ycHh9LmNlbGwtLW5hcnJvd3twYWRkaW5nLWlubGluZS1zdGFydDowLjVyZW19LmNlbGwtLW92ZXJmbG93e292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdy13cmFwOmJyZWFrLXdvcmR9LmNoZWNrYm94LXdyYXB7ZGlzcGxheTpmbGV4fS5jaGVja2JveF9fdGl0bGV7ZmxleDoxIDEgMCV9LnVzZXItcG9wdXB7d2lkdGg6MTAwJX0uc2NyZWVuLXJlYWRlcnMtb25seXtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxcHg7aGVpZ2h0OjFweDtwYWRkaW5nOjA7bWFyZ2luOi0xcHg7b3ZlcmZsb3c6aGlkZGVuO2NsaXA6cmVjdCgwLCAwLCAwLCAwKTt3aGl0ZS1zcGFjZTpub3dyYXA7Ym9yZGVyLXdpZHRoOjB9LmRhdGUtZGVsZXRlZHtkaXNwbGF5OmJsb2NrO3BhZGRpbmctYm90dG9tOjAuMjVyZW07Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjQwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmRlbGV0ZXMtaW57ZGlzcGxheTpibG9jaztmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo0MDA7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTIpfS5idXR0b257Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyk7Zm9udC1mYW1pbHk6aW5oZXJpdDtib3gtc2l6aW5nOmJvcmRlci1ib3g7ZGlzcGxheTpmbGV4O2hlaWdodDoycmVtO21heC13aWR0aDoxMDAlO2N1cnNvcjpwb2ludGVyOy13ZWJraXQtYXBwZWFyYW5jZTpub25lOy1tb3otYXBwZWFyYW5jZTpub25lO2FwcGVhcmFuY2U6bm9uZTthbGlnbi1pdGVtczpjZW50ZXI7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwO2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTEpO3BhZGRpbmctbGVmdDowLjc1cmVtO3BhZGRpbmctcmlnaHQ6MC43NXJlbTtwYWRkaW5nLXRvcDowLjVyZW07cGFkZGluZy1ib3R0b206MC41cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTt0ZXh0LWRlY29yYXRpb24tbGluZTpub25lO291dGxpbmUtY29sb3I6dHJhbnNwYXJlbnQ7dHJhbnNpdGlvbjphbGwgdmFyKC0tY2FsY2l0ZS1hbmltYXRpb24tdGltaW5nKSBlYXNlLWluLW91dCAwcywgb3V0bGluZSAwcywgb3V0bGluZS1vZmZzZXQgMHN9LmJ1dHRvbjpob3Zlcntib3gtc2hhZG93Omluc2V0IDAgMCAwIDFweCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyl9LmJ1dHRvbjpmb2N1c3tvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKTtvdXRsaW5lLW9mZnNldDoycHh9LmJ1dHRvbi0tdHJhbnNwYXJlbnR7Ym9yZGVyOjFweCBzb2xpZCB0cmFuc3BhcmVudDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O3BhZGRpbmctbGVmdDowLjVyZW07cGFkZGluZy1yaWdodDowLjVyZW19LmJ1dHRvbi0tdHJhbnNwYXJlbnQ6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMik7Ym94LXNoYWRvdzpub25lfS5idXR0b25fX2ljb257cG9pbnRlci1ldmVudHM6bm9uZX1cIjtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJUYWJsZVJvdyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJDb2x1bW5VcGRhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyQ29sdW1uVXBkYXRlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFNlbGVjdCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJDYXJkU2VsZWN0XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFByZXZpZXcgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFByZXZpZXdcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zT3BlbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zT3BlblwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclJlc3RvcmVJdGVtID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJdGVtQnJvd3NlclJlc3RvcmVJdGVtXCIsIDcpO1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuY29sdW1uUmVmcyA9IHt9O1xuICAgICAgICB0aGlzLml0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9ydGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYXBpID0gNDtcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gKF9hID0gY29uZmlnU3RhdGUgPT09IG51bGwgfHwgY29uZmlnU3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZ1N0YXRlLmNvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmJhc2VVcmw7XG4gICAgICAgIHRoaXMubGluayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5uZXdUYWIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubmFtZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wcmV2aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dJdGVtVHlwZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd0JhZGdlcyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd1NoYXJpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmFjdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5oYXNNb3VzZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXJDb2x1bW4gPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZ2V0SXRlbUJyb3dzZXJTdG9yZSh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gdGhpcy5zdG9yZS5zdGF0ZS5pMThuLnRhYmxlUm93O1xuICAgIH1cbiAgICBhc3luYyBjYW5Gb2N1c0NvbHVtbihpbmRleCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnMgfHwgW107XG4gICAgICAgIGNvbnN0IGFkanVzdGVkSW5kZXggPSB0aGlzLmdldENvbHVtbk51bWJlcihpbmRleCk7XG4gICAgICAgIGNvbnN0IGlkID0gY29sdW1uc1thZGp1c3RlZEluZGV4XTtcbiAgICAgICAgLy8gb25seSBhbGxvdyB0YWJiaW5nIHRvIHRoZSBiYWRnZXMgaWYgdGhlcmUgYXJlIGJhZGdlcyBkaXNwbGF5ZWRcbiAgICAgICAgaWYgKGlkID09PSBcImJhZGdlc1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gIXRoaXMuYmFkZ2VzLmVtcHR5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhISgoX2EgPSB0aGlzLmNvbHVtblJlZnNbaWRdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWV0aG9kKSB8fCBhZGp1c3RlZEluZGV4IDwgMDtcbiAgICB9XG4gICAgYXN5bmMgZm9jdXNDb2x1bW4oY29sdW1uKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgbGV0IGFkanVzdGVkQ29sdW1uID0gY29sdW1uO1xuICAgICAgICAvLyBzZWxlY3RhYmxlIHRhYmxlcyBoYXZlIHRoZSBjaGVja2JveCBhbmQgdGl0bGUgaW4gYSBzaW5nbGUgY29sdW1uXG4gICAgICAgIC8vIG9mZnNldCB0aGUgY29sdW1uIG51bWJlciB0byBhbGxvdyBtb3ZlbWVudCBhcyBpZiB0aGV5IHdlcmUgc2VwYXJhdGUgY29sdW1uc1xuICAgICAgICBpZiAodGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikge1xuICAgICAgICAgICAgaWYgKGNvbHVtbiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIChfYSA9IHRoaXMuY2hlY2tib3gpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFkanVzdGVkQ29sdW1uID0gY29sdW1uIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGVsLCBtZXRob2QgfSA9IHRoaXMuY29sdW1uUmVmc1t0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnNbYWRqdXN0ZWRDb2x1bW5dXSB8fCB7fTtcbiAgICAgICAgZWxbbWV0aG9kXSgpO1xuICAgIH1cbiAgICBnZXRDb2x1bW5OdW1iZXIoY29sdW1uKSB7XG4gICAgICAgIGlmICh0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gY29sdW1uIC0gMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29sdW1uO1xuICAgIH1cbiAgICBpc1NpbXBsZUNvbHVtbihpZCkge1xuICAgICAgICByZXR1cm4gIVtcIm93bmVyXCIsIFwiZGV0YWlsc1wiLCBcImZhdm9yaXRlXCIsIFwiYWN0aW9uc1wiXS5pbmNsdWRlcyhpZCk7XG4gICAgfVxuICAgIG9uQ2xpY2soY2IpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uS2V5RG93bjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIiB8fCBlLmtleSA9PT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJlbmRlclRpdGxlKHNlbGVjdGVkKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgY29uc3QgeyBpdGVtIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBhY3RpdmVDb2x1bW4gPSAoX2IgPSAoX2EgPSB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMV0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDA7XG4gICAgICAgIGNvbnN0IHJvd0hhc0ZvY3VzID0gKChfZCA9IChfYyA9IHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1swXSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogMCkgPT09IHRoaXMuaW5kZXg7XG4gICAgICAgIGNvbnN0IGNvbHVtbkhhc0ZvY3VzID0gYWN0aXZlQ29sdW1uIDwgMjtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY2hlY2tib3gtd3JhcFwiLCBvbk1vdXNlT3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubW91c2VPdmVyQ29sdW1uID0gMDtcbiAgICAgICAgICAgIH0sIGtleTogXCJ0aXRsZVwiIH0sIGgoXCJkaXZcIiwgeyByb2xlOiBcImdyaWRjZWxsXCIsIGNsYXNzOiBcImNlbGxcIiB9LCBoKFwiY2FsY2l0ZS1jaGVja2JveFwiLCBPYmplY3QuYXNzaWduKHt9LCAoKHJvd0hhc0ZvY3VzICYmIGNvbHVtbkhhc0ZvY3VzKSB8fCAodGhpcy5oYXNNb3VzZSAmJiB0aGlzLm1vdXNlT3ZlckNvbHVtbiA9PT0gMClcbiAgICAgICAgICAgID8ge31cbiAgICAgICAgICAgIDogeyBpbmVydDogdHJ1ZSB9KSwgeyBjbGFzczogXCJjaGVja2JveFwiLCBjaGVja2VkOiBzZWxlY3RlZCwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrYm94ID0gZWw7XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cyA9IFt0aGlzLmluZGV4LCAwXTtcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUNoZWNrYm94Q2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRTZWxlY3QuZW1pdCh7IGl0ZW0sIHNlbGVjdGVkOiAhc2VsZWN0ZWQgfSk7XG4gICAgICAgICAgICB9LCB2YWx1ZTogaXRlbS5pZCB9KSwgaChcInNwYW5cIiwgeyBjbGFzczogXCJzY3JlZW4tcmVhZGVycy1vbmx5XCIgfSwgaXRlbS50aXRsZSkpKSwgaChcImRpdlwiLCBPYmplY3QuYXNzaWduKHsgb25Nb3VzZU92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlT3ZlckNvbHVtbiA9IDA7XG4gICAgICAgICAgICB9LCByb2xlOiBcImdyaWRjZWxsXCIsIGNsYXNzOiBcImNlbGwgY2VsbC0tbmFycm93IGNoZWNrYm94X190aXRsZVwiLCBpZDogYHJvdy0ke2l0ZW0uaWR9YCwgdGFiaW5kZXg6IGFjdGl2ZUNvbHVtbiA9PT0gMSAmJiByb3dIYXNGb2N1cyA/IDAgOiAtMSB9LCB0aGlzLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldmlldyA9PT0gXCJ0aXRsZVwiICYmICF0aGlzLnN0b3JlLnN0YXRlLnJlY3ljbGVCaW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc0l0ZW1Ccm93c2VyQ2FyZFByZXZpZXcuZW1pdChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXMgPSBbdGhpcy5pbmRleCwgMV07XG4gICAgICAgIH0pLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2x1bW5SZWZzLnRpdGxlID0geyBlbCwgbWV0aG9kOiBcImZvY3VzXCIgfTtcbiAgICAgICAgICAgIH0gfSksIHRoaXMuaXRlbS50aXRsZSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRGVsZXRlZCgpIHtcbiAgICAgICAgY29uc3QgeyBpdGVtLCBpMThuLCBzdG9yZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZGF5cyA9IGNhbGN1bGF0ZURheXNVbnRpbERlbGV0aW9uKGl0ZW0ubW9kaWZpZWQpO1xuICAgICAgICBjb25zdCBkYXRlVGV4dCA9IGRheXMgPCAyID8gaTE4bi5kZWxldGVzVG9tb3Jyb3cgOiBmb3JtYXRQbHVyYWwoc3RvcmUuc3RhdGUubGFuZywgaTE4bi5kZWxldGVzLCBkYXlzKTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZGF0ZS1kZWxldGVkXCIgfSwgZm9ybWF0RGF0ZShpdGVtLm1vZGlmaWVkKSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZGVsZXRlcy1pblwiIH0sIGRhdGVUZXh0KSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2x1bW4oaWQsIGNvbHVtbkluZGV4LCBzZWxlY3RlZCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIGNvbnN0IHsgaXRlbSwgYXBpLCBwb3J0YWwsIGJhc2VVcmwsIHVzZXIsIGFjdGlvbnMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUNvbHVtbiA9IChfYiA9IChfYSA9IHRoaXMuc3RvcmUuc3RhdGUuYWN0aXZlRm9jdXMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVsxXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMDtcbiAgICAgICAgY29uc3QgaXNTaW1wbGVDb2x1bW4gPSB0aGlzLmlzU2ltcGxlQ29sdW1uKGlkKTtcbiAgICAgICAgY29uc3Qgcm93SGFzRm9jdXMgPSAoKF9kID0gKF9jID0gdGhpcy5zdG9yZS5zdGF0ZS5hY3RpdmVGb2N1cykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzBdKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAwKSA9PT0gdGhpcy5pbmRleDtcbiAgICAgICAgY29uc3QgY29sdW1uSGFzRm9jdXMgPSBjb2x1bW5JbmRleCA9PT0gdGhpcy5nZXRDb2x1bW5OdW1iZXIoYWN0aXZlQ29sdW1uKTtcbiAgICAgICAgaWYgKGlkID09PSBcInRpdGxlXCIgJiYgdGhpcy5zdG9yZS5zdGF0ZS5zZWxlY3Rpb24gPT09IFwibXVsdGlwbGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVGl0bGUoc2VsZWN0ZWQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRhYiA9IHsgdGFiSW5kZXg6IGNvbHVtbkhhc0ZvY3VzICYmIHJvd0hhc0ZvY3VzID8gMCA6IC0xIH07XG4gICAgICAgIGNvbnN0IHRydW5jYXRlID0gW1wib3duZXJcIl0uaW5jbHVkZXMoaWQpO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgT2JqZWN0LmFzc2lnbih7IGtleTogaWQgfSwgKGlzU2ltcGxlQ29sdW1uID8gdGFiIDoge30pLCB7IHJvbGU6IFwiZ3JpZGNlbGxcIiwgY2xhc3M6IHsgY2VsbDogdHJ1ZSwgXCJjZWxsLS1vdmVyZmxvd1wiOiB0cnVuY2F0ZSB9LCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1NpbXBsZUNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbHVtblJlZnNbaWRdID0geyBlbCwgbWV0aG9kOiBcImZvY3VzXCIgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gb24gY2xpY2ssIHNldCB0aGUgYWN0aXZlIGZvY3VzIGNvb3JkaW5hdGVzIHRvIHRoYXQgY2VsbFxuICAgICAgICAgICAgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLnN0b3JlLnN0YXRlLnNlbGVjdGlvbiA9PT0gXCJtdWx0aXBsZVwiID8gY29sdW1uSW5kZXggKyAxIDogY29sdW1uSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY29sdW1uSGFzRm9jdXMgfHwgIXJvd0hhc0ZvY3VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLnN0YXRlLmFjdGl2ZUZvY3VzID0gW3RoaXMuaW5kZXgsIGNvbHVtbl07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09PSBcInRpdGxlXCIgJiYgdGhpcy5wcmV2aWV3ID09PSBcInRpdGxlXCIgJiYgIXRoaXMuc3RvcmUuc3RhdGUucmVjeWNsZUJpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlckNhcmRQcmV2aWV3LmVtaXQoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgICAgfSwgb25Nb3VzZU92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlT3ZlckNvbHVtbiA9IGNvbHVtbkluZGV4O1xuICAgICAgICAgICAgfSB9KSwgaWQgPT09IFwidGl0bGVcIiAmJiBoKFwic3BhblwiLCBudWxsLCB0aGlzLml0ZW0udGl0bGUpLCBpZCA9PT0gXCJ0eXBlXCIgJiYgaChcImFyY2dpcy1pdGVtLXR5cGVcIiwgeyBpdGVtOiBpdGVtLCBwb3J0YWw6IHRoaXMucG9ydGFsLCBzY2FsZTogXCJtXCIgfSksIGlkID09PSBcIm1vZGlmaWVkXCIgJiYgZm9ybWF0RGF0ZShpdGVtLm1vZGlmaWVkKSwgaWQgPT09IFwiZGVsZXRlZFwiICYmIHRoaXMucmVuZGVyRGVsZXRlZCgpLCBpZCA9PT0gXCJzaXplXCIgJiYgZm9ybWF0RmlsZVNpemUoaXRlbS5zaXplKSwgaWQgPT09IFwiYmFkZ2VzXCIgJiYgKGgoXCJhcmNnaXMtaXRlbS1iYWRnZXNcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuYmFkZ2VzID0gZWwpLCBzaG93VG9vbHRpcHM6IHRydWUsIGl0ZW06IGl0ZW0sIHdpZHRoOiBcIm5hcnJvd1wiLCBzY2FsZTogXCJzXCIsIHRhYkluZGV4OiAtMSB9KSksIGlkID09PSBcInNoYXJpbmdcIiAmJiBoKFwiYXJjZ2lzLWl0ZW0tc2hhcmUtc3VtbWFyeVwiLCB7IHNob3dUZXh0OiBmYWxzZSwgaXRlbTogaXRlbSwgc2NhbGU6IFwic1wiIH0pLCBpZCA9PT0gXCJvd25lclwiICYmIChoKFwiYXJjZ2lzLXVzZXItcG9wdXBcIiwgeyBpdGVtOiBpdGVtLCB1bmRlcmxpbmU6IHRydWUsIGFwaTogYXBpLCBwb3J0YWw6IHBvcnRhbCwgYmFzZVVybDogYmFzZVVybCwgc2NhbGU6IFwibVwiLCBjbGFzczogXCJ1c2VyLXBvcHVwXCIsIHNob3dBdmF0YXI6IGZhbHNlLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uUmVmcy5vd25lciA9IHsgZWwsIG1ldGhvZDogXCJzZXRGb2N1c1wiIH07XG4gICAgICAgICAgICB9LCB0YWJJbmRleDogLTEgfSkpLCBpZCA9PT0gXCJkZXRhaWxzXCIgJiZcbiAgICAgICAgICAgICh0aGlzLnN0b3JlLnN0YXRlLnJlY3ljbGVCaW4gPyAoaChcImJ1dHRvblwiLCBPYmplY3QuYXNzaWduKHt9LCB0YWIsIHsgY2xhc3M6IFwiYnV0dG9uXCIsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uUmVmcy5kZXRhaWxzID0geyBlbCwgbWV0aG9kOiBcImZvY3VzXCIgfTtcbiAgICAgICAgICAgICAgICB9LCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJSZXN0b3JlSXRlbS5lbWl0KHRoaXMuaXRlbSk7XG4gICAgICAgICAgICAgICAgfSB9KSwgdGhpcy5pMThuLnJlc3RvcmUpKSA6IChoKFwiYVwiLCBPYmplY3QuYXNzaWduKHt9LCB0YWIsIHsgaHJlZjogYCR7cmVtb3ZlVHJhaWxpbmdTbGFzaCh0aGlzLmJhc2VVcmwpfS9pdGVtLmh0bWw/aWQ9JHtpdGVtLmlkfWAsIGNsYXNzOiBcImJ1dHRvblwiLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbHVtblJlZnMuZGV0YWlscyA9IHsgZWwsIG1ldGhvZDogXCJmb2N1c1wiIH07XG4gICAgICAgICAgICAgICAgfSB9KSwgdGhpcy5pMThuLmRldGFpbHMpKSksIGlkID09PSBcImZhdm9yaXRlXCIgJiYgKGgoXCJhcmNnaXMtaXRlbS1mYXZvcml0ZVwiLCB7IGl0ZW06IGl0ZW0sIHBvcnRhbDogcG9ydGFsLCB1c2VyOiB1c2VyIHx8IChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUudXNlciksIGljb25Pbmx5OiB0cnVlLCByZWY6IChlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uUmVmcy5mYXZvcml0ZSA9IHsgZWwsIG1ldGhvZDogXCJzZXRGb2N1c1wiIH07XG4gICAgICAgICAgICB9LCB0YWJJbmRleDogLTEgfSkpLCBpZCA9PT0gXCJhY3Rpb25zXCIgJiYgKGgoXCJzcGFuXCIsIG51bGwsIGFjdGlvbnMubGVuZ3RoID4gMCAmJiAoaChcImJ1dHRvblwiLCBPYmplY3QuYXNzaWduKHt9LCB0YWIsIHsgY2xhc3M6IFwiYnV0dG9uIGJ1dHRvbi0tdHJhbnNwYXJlbnRcIiwgXCJhcmlhLWxhYmVsXCI6IHRoaXMuaTE4bi5tb3JlT3B0aW9ucywgXCJhcmlhLWhhc3BvcHVwXCI6IFwidHJ1ZVwiLCBzbG90OiBcInRyaWdnZXJcIiwgcmVmOiAoZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtblJlZnMuYWN0aW9ucyA9IHsgZWwsIG1ldGhvZDogXCJmb2N1c1wiIH07XG4gICAgICAgICAgICB9LCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJBY3Rpb25zT3Blbi5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgZWw6IGUudGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IH0pLCBoKFwiY2FsY2l0ZS1pY29uXCIsIHsgaWNvbjogXCJlbGxpcHNpc1wiLCBzY2FsZTogXCJzXCIsIGNsYXNzOiBcImJ1dHRvbl9faWNvblwiIH0pKSkpKSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLnN0b3JlLnN0YXRlLmNvbHVtbnMgfHwgW107XG4gICAgICAgIGNvbnN0IHsgaXRlbSB9ID0gdGhpcztcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gKF9hID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXRlLnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgaXRlbVNlbGVjdGlvbiA9IFtcInNpbmdsZVwiLCBcIm11bHRpcGxlXCJdLmluY2x1ZGVzKHNlbGVjdGlvbik7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0gaXRlbVNlbGVjdGlvbiAmJiBpc1NlbGVjdGVkKHsgaXRlbSwgc2VsZWN0ZWRJdGVtczogKF9iID0gdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXRlLnNlbGVjdGVkSXRlbXMgfSk7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBPYmplY3QuYXNzaWduKHt9LCAoc2VsZWN0ZWQgPyB7IFwiZGF0YS1zZWxlY3RlZFwiOiB0cnVlIH0gOiB7fSksIHsgb25Nb3VzZU92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhc01vdXNlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sIG9uTW91c2VPdXQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhc01vdXNlID0gZmFsc2U7XG4gICAgICAgICAgICB9IH0pLCBoKFwiZGl2XCIsIE9iamVjdC5hc3NpZ24oeyBjbGFzczoge1xuICAgICAgICAgICAgICAgIHJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcInJvdy0tc2VsZWN0ZWRcIjogc2VsZWN0ZWQsXG4gICAgICAgICAgICAgICAgXCJyb3ctLWZpcnN0XCI6IHRoaXMuaW5kZXggPT09IDBcbiAgICAgICAgICAgIH0sIHJvbGU6IFwicm93XCIgfSwgKHNlbGVjdGVkID8geyBhcmlhU2VsZWN0ZWQ6IHRydWUgfSA6IHt9KSwgeyBcImFyaWEtbGFiZWxsZWRieVwiOiBgcm93LSR7aXRlbS5pZH1gIH0pLCBjb2x1bW5zLm1hcCgoaWQsIGkpID0+IHRoaXMucmVuZGVyQ29sdW1uKGlkLCBpLCBzZWxlY3RlZCkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzSXRlbUJyb3dzZXJUYWJsZVJvdy5zdHlsZSA9IGFyY2dpc0l0ZW1Ccm93c2VyVGFibGVSb3dDc3M7XG5cbmNvbnN0IEFyY2dpc0l0ZW1Ccm93c2VyVG9wQmFyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiYXJjZ2lzLWJyb3dzZXItdG9wLWJhclwiLCB7IHN0b3JlOiB0aGlzLnN0b3JlLCBmaWx0ZXJzRGlzYWJsZWQ6ICgoX2IgPSAoX2EgPSB0aGlzLnN0b3JlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5idWNrZXQpID09PSBcInN1YnNjcmlwdGlvbiBjb250ZW50XCIgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC1zdGFydFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJjb250ZW50LXN0YXJ0XCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJidWNrZXRcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiYnVja2V0XCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJzZWFyY2hcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwic2VhcmNoXCIgfSkpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJjb250ZW50LWVuZFwiIH0sIGgoXCJzbG90XCIsIHsgbmFtZTogXCJjb250ZW50LWVuZFwiIH0pKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzSXRlbUJyb3dzZXJWaWV3ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNJdGVtQnJvd3NlclZpZXcgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0l0ZW1Ccm93c2VyVmlld1wiLCA3KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gW1wiZ3JpZFwiLCBcImxpc3RcIl07XG4gICAgICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBnZXRJdGVtQnJvd3NlclN0b3JlKHRoaXMuZWwpO1xuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnN0b3JlLnN0YXRlLmkxOG4udmlldztcbiAgICAgICAgY29uc3QgeyB2aWV3IH0gPSB0aGlzO1xuICAgICAgICBpZiAoIXZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHRoaXMuc3RvcmUuc3RhdGUudmlldyB8fCBcImxpc3RcIjtcbiAgICAgICAgfVxuICAgICAgICBvbkl0ZW1Ccm93c2VyVmlld0NoYW5nZSh0aGlzLnN0b3JlLCAobmV3VmlldykgPT4ge1xuICAgICAgICAgICAgdGhpcy52aWV3ID0gbmV3VmlldztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN5bmNTdG9yZShuZXdWaWV3KSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc3RhdGUudmlldyA9IG5ld1ZpZXc7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJWaWV3LmVtaXQodGhpcy52aWV3KTtcbiAgICB9XG4gICAgcmVuZGVyT3B0aW9uKG9wdGlvbikge1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWRyb3Bkb3duLWl0ZW1cIiwgeyBrZXk6IG9wdGlvbiwgc2VsZWN0ZWQ6IG9wdGlvbiA9PT0gdGhpcy52aWV3LCBvbkNhbGNpdGVEcm9wZG93bkl0ZW1TZWxlY3Q6ICgpID0+IHRoaXMuYXJjZ2lzSXRlbUJyb3dzZXJWaWV3LmVtaXQob3B0aW9uKSwgaWNvblN0YXJ0OiBvcHRpb24gfSwgdGhpcy5pMThuW29wdGlvbl0pKTtcbiAgICB9XG4gICAgcmVuZGVyQnV0dG9uKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IGkxOG4sIHZpZXcgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGJhc2VBdHRycyA9IHtcbiAgICAgICAgICAgIGNsYXNzOiBcImJ1dHRvblwiLFxuICAgICAgICAgICAgc2xvdDogXCJ0cmlnZ2VyXCIsXG4gICAgICAgICAgICBzY2FsZTogXCJtXCIsXG4gICAgICAgICAgICBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLFxuICAgICAgICAgICAga2luZDogXCJuZXV0cmFsXCIsXG4gICAgICAgICAgICBpY29uU3RhcnQ6IHZpZXcsXG4gICAgICAgICAgICBpY29uRmxpcFJ0bDogXCJzdGFydFwiLFxuICAgICAgICAgICAgYXJpYUxhYmVsOiBgJHtpMThuLnZpZXd9OiAke2kxOG5bdmlld119YFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKChfYiA9IChfYSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLndpZHRoKSA+IERST1BET1dOX0lDT05fRElTUExBWV9DVVRPRkZfU0laRSA/IChoKFwiY2FsY2l0ZS1idXR0b25cIiwgT2JqZWN0LmFzc2lnbih7fSwgYmFzZUF0dHJzKSwgaTE4blt2aWV3XSkpIDogKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCBPYmplY3QuYXNzaWduKHt9LCBiYXNlQXR0cnMpKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWRyb3Bkb3duXCIsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgc2NhbGU6IFwibVwiLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgd2lkdGhTY2FsZTogXCJzXCIgfSwgdGhpcy5yZW5kZXJCdXR0b24oKSwgaChcImNhbGNpdGUtZHJvcGRvd24tZ3JvdXBcIiwgeyBzZWxlY3Rpb25Nb2RlOiBcInNpbmdsZVwiIH0sIHRoaXMub3B0aW9ucy5tYXAoKG9wdGlvbikgPT4gdGhpcy5yZW5kZXJPcHRpb24ob3B0aW9uKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJ2aWV3XCI6IFtcInN5bmNTdG9yZVwiXVxuICAgIH07IH1cbn07XG5cbmV4cG9ydCB7IEFyY2dpc0l0ZW1Ccm93c2VyIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXIsIEFyY2dpc0l0ZW1Ccm93c2VyQWN0aW9ucyBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2FjdGlvbnMsIEFyY2dpc0l0ZW1Ccm93c2VyQnVja2V0U2VsZWN0IGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfYnVja2V0X3NlbGVjdCwgQXJjZ2lzSXRlbUJyb3dzZXJDYXJkJDEgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9jYXJkLCBBcmNnaXNJdGVtQnJvd3NlckNhcmQgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9jYXJkX3N1YmxheWVyX3NlbGVjdCwgQXJjZ2lzSXRlbUJyb3dzZXJDYXJkVGh1bWJuYWlsIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfY2FyZF90aHVtYm5haWwsIEFyY2dpc0l0ZW1Ccm93c2VyQ29udGVudCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2NvbnRlbnQsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyQ2F0ZWdvcmllcyBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9jYXRlZ29yaWVzLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbGxhYm9yYXRpb25zIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX2NvbGxhYm9yYXRpb25zLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckNvbnRlbnRTdGF0dXMgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJfY29udGVudF9zdGF0dXMsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRGF0ZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9kYXRlLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlckV4dGVudCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9leHRlbnQsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyRm9sZGVyIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX2ZvbGRlciwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJHcm91cCBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9ncm91cCwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJJbmR1c3RyeSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9pbmR1c3RyeSwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJJdGVtVHlwZSBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl9pdGVtX3R5cGUsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyTG9jYXRpb24gYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJfbG9jYXRpb24sIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyUmVnaW9uIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX3JlZ2lvbiwgQXJjZ2lzSXRlbUJyb3dzZXJGaWx0ZXJTaGFyaW5nIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfZmlsdGVyX3NoYXJpbmcsIEFyY2dpc0l0ZW1Ccm93c2VyRmlsdGVyVGFncyBhcyBhcmNnaXNfaXRlbV9icm93c2VyX2ZpbHRlcl90YWdzLCBBcmNnaXNJdGVtQnJvd3NlckZpbHRlcnMgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9maWx0ZXJzLCBBcmNnaXNJdGVtQnJvd3NlclBhZ2luYXRpb24gYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9wYWdpbmF0aW9uLCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXcgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9wcmV2aWV3LCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXdDb3B5IGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfcHJldmlld19jb3B5LCBBcmNnaXNJdGVtQnJvd3NlclByZXZpZXdGaWVsZERldGFpbHMgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9wcmV2aWV3X2ZpZWxkX2RldGFpbHMsIEFyY2dpc0l0ZW1Ccm93c2VyU2VhcmNoIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfc2VhcmNoLCBBcmNnaXNJdGVtQnJvd3NlclNvcnQgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl9zb3J0LCBBcmNnaXNJdGVtQnJvd3NlclRhYmxlIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfdGFibGUsIEFyY2dpc0l0ZW1Ccm93c2VyVGFibGVSb3cgYXMgYXJjZ2lzX2l0ZW1fYnJvd3Nlcl90YWJsZV9yb3csIEFyY2dpc0l0ZW1Ccm93c2VyVG9wQmFyIGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfdG9wX2JhciwgQXJjZ2lzSXRlbUJyb3dzZXJWaWV3IGFzIGFyY2dpc19pdGVtX2Jyb3dzZXJfdmlldyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaXRlbS1icm93c2VyXzMxLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYiBhcyBpc1ByZW1pdW0sIGEgYXMgaXNTdWJzY3JpYmVyIH0gZnJvbSAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCB7IGEgYXMgaXNQdWJsaWNVc2VyIH0gZnJvbSAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCB7IHIgYXMgcmV0aXJlZEl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgeyBiIGFzIGZldGNoVmVyaWZpZWQgfSBmcm9tICcuL3VzZXItMGZhOWZmNWEuanMnO1xuXG5jb25zdCByZXRpcmVkVXJsUGFydHMgPSBbXG4gICAgXCIzREluc2V0TWFwXCIsXG4gICAgXCIzRFNjZW5lXCIsXG4gICAgXCIzRFZpelwiLFxuICAgIFwiQXR0YWNobWVudFZpZXdlclwiLFxuICAgIFwiQ2FwYWNpdHlBbmFseXNpc1wiLFxuICAgIFwiQ29tcGFyZS9zdG9yeXRlbGxpbmdfY29tcGFyZVwiLFxuICAgIFwiQ29tcGFyZS9zdG9yeXRlbGxpbmdfdGFiYmVkXCIsXG4gICAgXCJDb21wYXJlL3N0b3J5dGVsbGluZ19zaWRlcGFuZWxcIixcbiAgICBcIkNvbXBhcmUvTXVsdGl2aWV3ZXJcIixcbiAgICBcIkNvbXBhcmUvU2VhcmNoXCIsXG4gICAgXCJDb21wYXJlL0NvbmZpZ3VyZVwiLFxuICAgIFwiQ29tcGFyZS9TaWRlQnlTaWRlVmlld2VyX0NvbmZpZ3VyZVwiLFxuICAgIFwiQ29tcGFyZTNkXCIsXG4gICAgXCJDb21wYXJlQW5hbHlzaXNcIixcbiAgICBcIkNvbXBhcmVNYXBzXCIsXG4gICAgXCJEaXJlY3Rpb25zXCIsXG4gICAgXCJFZGl0XCIsXG4gICAgXCJFZGl0b3JcIixcbiAgICBcIkVsZXZhdGlvbnNcIixcbiAgICBcIkVsZXZhdGlvbnNQcm9maWxlXCIsXG4gICAgXCJFbWJlZFwiLFxuICAgIFwiRmlsdGVyXCIsXG4gICAgXCJGaWx0ZXJHYWxsZXJ5XCIsXG4gICAgXCJHZW9MaXN0XCIsXG4gICAgXCJHZW9Ub3VyXCIsXG4gICAgXCJIZWFkZXJGb290ZXJcIixcbiAgICBcIklkZW50aWZ5XCIsXG4gICAgXCJJbWFnZUludGVycHJldGF0aW9uXCIsXG4gICAgXCJJbWFnZXJ5Vmlld2VyXCIsXG4gICAgXCJJbXBhY3RTdW1tYXJ5XCIsXG4gICAgXCJJbmZvcm1hdGlvbkxvb2t1cFwiLFxuICAgIFwiSW50ZXJhY3RpdmVGaWx0ZXJcIixcbiAgICBcIkludGVyYWN0aXZlTGVnZW5kXCIsXG4gICAgXCJMYXllclNob3djYXNlXCIsXG4gICAgXCJMZWdlbmRcIixcbiAgICBcIkxpdmVNYXBzXCIsXG4gICAgXCJMb2NhbFBlcnNwZWN0aXZlXCIsXG4gICAgXCJNYXBBbmRBcHBHYWxsZXJ5XCIsXG4gICAgXCJNYXBDYXJvdXNlbFwiLFxuICAgIFwiTWFwVG9vbHNcIixcbiAgICBcIk1lZGlhXCIsXG4gICAgXCJNaW5pbWFsR2FsbGVyeVwiLFxuICAgIFwiTWluaW1hbGlzdFwiLFxuICAgIFwiTmVhcmJ5XCIsXG4gICAgXCJPbmVQYW5lXCIsXG4gICAgXCJQYW5lbHNcIixcbiAgICBcIlBhbmVsc0xlZ2VuZFwiLFxuICAgIFwiUHJvZmlsZVwiLFxuICAgIFwiUHVibGljR2FsbGVyeVwiLFxuICAgIFwiUHVibGljSW5mb3JtYXRpb25cIixcbiAgICBcIlNlcnZpY2VMb29rdXBcIixcbiAgICBcIlNpbXBsZU1hcFZpZXdlclwiLFxuICAgIFwiU2ltcGxlVmlld2VyXCIsXG4gICAgXCJTb2NpYWxNZWRpYVwiLFxuICAgIFwiU29sdXRpb25zL3MyLmh0bWw/YXBwPWFwcHMyL0ZpbmRFZGl0RmlsdGVyXCIsXG4gICAgXCJTb2x1dGlvbnMvczIuaHRtbD9hcHA9YXBwczIvRmluZGVyXCIsXG4gICAgXCJTdG9yeXRlbGxpbmdUZXh0TGVnZW5kXCIsXG4gICAgXCJTdG9yeU1hcEJhc2ljXCIsXG4gICAgXCJTdHlsZXJcIixcbiAgICBcIlN1bW1hcnlWaWV3ZXJcIixcbiAgICBcIlRpbWVcIixcbiAgICBcIlRpbWVBd2FyZVwiLFxuICAgIFwiVHdvUGFuZVwiLFxuICAgIFwiVmlld2VyXCIsXG4gICAgXCJab25lTG9va3VwXCJcbl07XG5cbmZ1bmN0aW9uIGlzUmV0aXJlZEl0ZW1UeXBlKHR5cGUpIHtcbiAgICByZXR1cm4gcmV0aXJlZEl0ZW1UeXBlcy5pbmNsdWRlcyh0eXBlKTtcbn1cbmZ1bmN0aW9uIGlzUmV0aXJlZFN0b3J5TWFwKGl0ZW0pIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiYgaXRlbS50eXBlID09PSBcIldlYiBNYXBwaW5nIEFwcGxpY2F0aW9uXCIgJiYgKChfYiA9IGl0ZW0udHlwZUtleXdvcmRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaW5jbHVkZXMoXCJTdG9yeSBNYXBcIikpO1xufVxuZnVuY3Rpb24gaXNDaXR5RW5naW5lV2ViU2NlbmUoaXRlbSkge1xuICAgIHJldHVybiBpdGVtLnR5cGUgPT09IFwiQ2l0eUVuZ2luZSBXZWIgU2NlbmVcIjtcbn1cbmZ1bmN0aW9uIGlzUmV0aXJlZEFwcChpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGlzUmV0aXJlZFVybCA9IHJldGlyZWRVcmxQYXJ0cy5zb21lKCh1cmxQYXJ0KSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgY29udGFpbnNIdG1sID0gdXJsUGFydC5pbmNsdWRlcyhcIi5odG1sXCIpO1xuICAgICAgICBjb25zdCBmdWxsUmV0aXJlZFBhdGggPSBgL2FwcHMvJHt1cmxQYXJ0fSR7IWNvbnRhaW5zSHRtbCA/IFwiL1wiIDogXCJcIn1gO1xuICAgICAgICByZXR1cm4gKF9hID0gaXRlbS51cmwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyhmdWxsUmV0aXJlZFBhdGgpO1xuICAgIH0pO1xuICAgIHJldHVybiAoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgJiYgaXRlbS50eXBlID09PSBcIldlYiBNYXBwaW5nIEFwcGxpY2F0aW9uXCIgJiYgaXRlbS51cmwgJiYgaXNSZXRpcmVkVXJsO1xufVxuZnVuY3Rpb24gZ2V0Q29udGVudFN0YXR1cyhpdGVtKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmNvbnRlbnRTdGF0dXMpIHx8ICgoX2EgPSBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uc291cmNlSlNPTikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbnRlbnRTdGF0dXMpO1xufVxuZnVuY3Rpb24gaXNPcmdBdXRob3JpdGF0aXZlKGl0ZW0pIHtcbiAgICByZXR1cm4gZ2V0Q29udGVudFN0YXR1cyhpdGVtKSA9PT0gXCJvcmdfYXV0aG9yaXRhdGl2ZVwiO1xufVxuZnVuY3Rpb24gaXNQdWJsaWNBdXRob3JpdGF0aXZlKGl0ZW0pIHtcbiAgICByZXR1cm4gZ2V0Q29udGVudFN0YXR1cyhpdGVtKSA9PT0gXCJwdWJsaWNfYXV0aG9yaXRhdGl2ZVwiO1xufVxuZnVuY3Rpb24gZ2V0QmFkZ2VzKGl0ZW0sIHBvcnRhbCwgdXNlcikge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZztcbiAgICBjb25zdCBiYWRnZXMgPSBbXTtcbiAgICBjb25zdCBncm91cERlc2lnbmF0aW9ucyA9IChfYiA9IChpdGVtLmdyb3VwRGVzaWduYXRpb25zIHx8ICgoX2EgPSBpdGVtLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ncm91cERlc2lnbmF0aW9ucykpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3BsaXQoXCIsIFwiKTtcbiAgICBpZiAoaXNPcmdBdXRob3JpdGF0aXZlKGl0ZW0pIHx8IGlzUHVibGljQXV0aG9yaXRhdGl2ZShpdGVtKSkge1xuICAgICAgICBiYWRnZXMucHVzaChcIkF1dGhvcml0YXRpdmVcIik7XG4gICAgfVxuICAgIGlmIChnZXRDb250ZW50U3RhdHVzKGl0ZW0pID09PSBcImRlcHJlY2F0ZWRcIikge1xuICAgICAgICBiYWRnZXMucHVzaChcIkRlcHJlY2F0ZWRcIik7XG4gICAgfVxuICAgIGlmIChpdGVtLnR5cGUgPT09IFwiU29sdXRpb25cIiAmJiAoKF9jID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5pbmNsdWRlcyhcIkFyY0dJUyBTb2x1dGlvblwiKSkpIHtcbiAgICAgICAgYmFkZ2VzLnB1c2goXCJTb2x1dGlvblwiKTtcbiAgICB9XG4gICAgaWYgKCgoX2QgPSBpdGVtLnR5cGVLZXl3b3JkcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmluY2x1ZGVzKFwiUHVibGljIERhdGEgQ29sbGVjdGlvblwiKSkgJiYgdXNlcikge1xuICAgICAgICBiYWRnZXMucHVzaChcIlB1YmxpYyBEYXRhIENvbGxlY3Rpb25cIik7XG4gICAgfVxuICAgIGlmIChpc1JldGlyZWRJdGVtVHlwZShpdGVtLnR5cGUpIHx8IGlzUmV0aXJlZFN0b3J5TWFwKGl0ZW0pIHx8IGlzUmV0aXJlZEFwcChpdGVtKSkge1xuICAgICAgICBiYWRnZXMucHVzaChcIlJldGlyZWRcIik7XG4gICAgfVxuICAgIGlmIChncm91cERlc2lnbmF0aW9ucyA9PT0gbnVsbCB8fCBncm91cERlc2lnbmF0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBEZXNpZ25hdGlvbnMuaW5jbHVkZXMoXCJsaXZpbmdhdGxhc1wiKSkge1xuICAgICAgICBiYWRnZXMucHVzaChcIkxpdmluZyBBdGxhc1wiKTtcbiAgICB9XG4gICAgaWYgKGdyb3VwRGVzaWduYXRpb25zICYmIGdyb3VwRGVzaWduYXRpb25zLmluY2x1ZGVzKFwib3BlbmRhdGFcIikpIHtcbiAgICAgICAgYmFkZ2VzLnB1c2goXCJPcGVuIERhdGFcIik7XG4gICAgfVxuICAgIGlmIChpc1ByZW1pdW0oaXRlbSkpIHtcbiAgICAgICAgYmFkZ2VzLnB1c2goXCJQcmVtaXVtXCIpO1xuICAgIH1cbiAgICBpZiAoaXNTdWJzY3JpYmVyKGl0ZW0pKSB7XG4gICAgICAgIGJhZGdlcy5wdXNoKFwiU3Vic2NyaWJlclwiKTtcbiAgICB9XG4gICAgaWYgKGl0ZW0ub3JpZ2luIHx8ICgoX2UgPSBpdGVtLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5vcmlnaW4pKSB7XG4gICAgICAgIGJhZGdlcy5wdXNoKFwiQ29sbGFib3JhdGlvblwiKTtcbiAgICB9XG4gICAgaWYgKChpdGVtLmxpc3RlZCB8fCAoKF9mID0gaXRlbS5zb3VyY2VKU09OKSA9PT0gbnVsbCB8fCBfZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2YubGlzdGVkKSkgJiYgIShwb3J0YWwgPT09IG51bGwgfHwgcG9ydGFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3J0YWwuaXNQb3J0YWwpKSB7XG4gICAgICAgIGJhZGdlcy5wdXNoKFwiTWFya2V0cGxhY2VcIik7XG4gICAgfVxuICAgIGlmICgoKF9nID0gaXRlbS50eXBlS2V5d29yZHMpID09PSBudWxsIHx8IF9nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZy5pbmNsdWRlcyhcIlJlZ2lzdGVyZWQgQXBwXCIpKSAmJlxuICAgICAgICBpdGVtLnR5cGUgIT09IFwiQVBJIEtleVwiICYmXG4gICAgICAgICghKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pc1BvcnRhbCkgfHwgaXRlbS5vd25lciAhPT0gXCJlc3JpX2FwcHNcIikpIHtcbiAgICAgICAgYmFkZ2VzLnB1c2goXCJSZWdpc3RlcmVkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gYmFkZ2VzO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0VG9vbHRpcChiYWRnZVR5cGUsIGl0ZW0sIHVzZXIsIGkxOG4sIGxvY2FsZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgcHVibGljVXNlciA9ICF1c2VyIHx8IGlzUHVibGljVXNlcih1c2VyKTtcbiAgICBzd2l0Y2ggKGJhZGdlVHlwZSkge1xuICAgICAgICBjYXNlIFwiQXV0aG9yaXRhdGl2ZVwiOlxuICAgICAgICAgICAgaWYgKGdldENvbnRlbnRTdGF0dXMoaXRlbSkgPT09IFwicHVibGljX2F1dGhvcml0YXRpdmVcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZlcmlmaWVkID0gYXdhaXQgZmV0Y2hWZXJpZmllZChpdGVtLCBsb2NhbGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSAoKF9hID0gaXRlbS5wb3J0YWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1BvcnRhbCkgPyAoX2IgPSBpdGVtLnBvcnRhbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm5hbWUgOiB2ZXJpZmllZCA9PT0gbnVsbCB8fCB2ZXJpZmllZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmVyaWZpZWQubmFtZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4bi5BdXRob3JpdGF0aXZlLnRvb2x0aXAucHVibGljLnJlcGxhY2UoXCIke25hbWV9XCIsIG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4uQXV0aG9yaXRhdGl2ZS50b29sdGlwLm9yZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgY2FzZSBcIlJldGlyZWRcIjpcbiAgICAgICAgICAgIGNvbnN0IHJldGlyZWQgPSBpMThuLlJldGlyZWQudG9vbHRpcDtcbiAgICAgICAgICAgIGlmIChpc1JldGlyZWRTdG9yeU1hcChpdGVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXRpcmVkLnN0b3J5TWFwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNDaXR5RW5naW5lV2ViU2NlbmUoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0aXJlZC5jaXR5RW5naW5lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNSZXRpcmVkQXBwKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldGlyZWQuYXBwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldGlyZWQuZ2VuZXJhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgY2FzZSBcIlN1YnNjcmliZXJcIjpcbiAgICAgICAgICAgIHJldHVybiBwdWJsaWNVc2VyID8gaTE4bi5TdWJzY3JpYmVyLnRvb2x0aXAucHVibGljIDogaTE4bi5TdWJzY3JpYmVyLnRvb2x0aXAub3JnO1xuICAgICAgICBjYXNlIFwiUHJlbWl1bVwiOlxuICAgICAgICAgICAgcmV0dXJuIHB1YmxpY1VzZXIgPyBpMThuLlByZW1pdW0udG9vbHRpcC5wdWJsaWMgOiBpMThuLlByZW1pdW0udG9vbHRpcC5vcmc7XG4gICAgICAgIGNhc2UgXCJSZWdpc3RlcmVkXCI6XG4gICAgICAgICAgICByZXR1cm4gaTE4bi5SZWdpc3RlcmVkLnRvb2x0aXA7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gaTE4bltiYWRnZVR5cGVdLnRvb2x0aXA7XG4gICAgfVxufVxuXG5leHBvcnQgeyBnZXRCYWRnZXMgYXMgYSwgZ2V0VG9vbHRpcCBhcyBiLCBnZXRDb250ZW50U3RhdHVzIGFzIGcsIGlzUHVibGljQXV0aG9yaXRhdGl2ZSBhcyBpIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJhZGdlcy01NTVlMWI5MC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGYgYXMgZnJvbUNhY2hlLCByIGFzIHJlcXVlc3QsIGcgYXMgZ2V0UmVzdEJhc2VVcmwgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRHcm91cFJlc3RCYXNlVXJsIH0gZnJvbSAnLi9ncm91cC02YTYzMDNiMC5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHVibGljVXNlciB9IGZyb20gJy4vcHJpdmlsZWdlcy01YzM4MmY2MS5qcyc7XG5cbmNvbnN0IGdldEl0ZW1DYXRlZ29yeVNjaGVtYSA9IGFzeW5jICh7IHBvcnRhbCwgdXNlciwgZ3JvdXAsIHVzZUNhY2hlID0gZmFsc2UgfSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBmZXRjaFJlc3VsdCA9IGF3YWl0IChncm91cFxuICAgICAgICAgICAgPyBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cC5pZCwgcG9ydGFsLCB1c2VDYWNoZSlcbiAgICAgICAgICAgIDogZmV0Y2hDYXRlZ29yaWVzKHBvcnRhbCwgdXNlciwgdXNlQ2FjaGUpKTtcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiAoX2EgPSBmZXRjaFJlc3VsdCA9PT0gbnVsbCB8fCBmZXRjaFJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmV0Y2hSZXN1bHQuY2F0ZWdvcnlTY2hlbWEpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGwgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn07XG5hc3luYyBmdW5jdGlvbiBmZXRjaENhdGVnb3JpZXMocG9ydGFsLCB1c2VyLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBwb3J0YWwgIT09IG51bGwgJiYgcG9ydGFsICE9PSB2b2lkIDAgPyBwb3J0YWwgOiAocG9ydGFsID0gY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICB1c2VyICE9PSBudWxsICYmIHVzZXIgIT09IHZvaWQgMCA/IHVzZXIgOiAodXNlciA9IGNvbmZpZ1N0YXRlLnVzZXIpO1xuICAgIGlmICghKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC5pZCkgfHwgKHVzZXIgJiYgaXNQdWJsaWNVc2VyKHVzZXIpKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRSZXN0QmFzZVVybChwb3J0YWwpfXBvcnRhbHMvJHtwb3J0YWwuaWR9L2NhdGVnb3J5U2NoZW1hYCk7XG4gICAgcmV0dXJuIHVzZUNhY2hlID8gZnJvbUNhY2hlKGdldFNjaGVtYSwgXCJjYXRlZ29yeVNjaGVtYVwiLCBwb3J0YWwuaWQpIDogZ2V0U2NoZW1hKCk7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaEdyb3VwQ2F0ZWdvcmllcyhncm91cElkLCBwb3J0YWwsIHVzZUNhY2hlID0gdHJ1ZSkge1xuICAgIHBvcnRhbCAhPT0gbnVsbCAmJiBwb3J0YWwgIT09IHZvaWQgMCA/IHBvcnRhbCA6IChwb3J0YWwgPSBjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUucG9ydGFsKTtcbiAgICBpZiAoIWdyb3VwSWQgfHwgIXBvcnRhbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZ2V0U2NoZW1hID0gKCkgPT4gcmVxdWVzdChgJHtnZXRHcm91cFJlc3RCYXNlVXJsKHBvcnRhbCwgeyBpZDogZ3JvdXBJZCB9KX1jYXRlZ29yeVNjaGVtYWApO1xuICAgIHJldHVybiB1c2VDYWNoZSA/IGZyb21DYWNoZShnZXRTY2hlbWEsIFwiY2F0ZWdvcnlTY2hlbWFcIiwgZ3JvdXBJZCkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNTY2hlbWEocG9ydGFsLCBjYXRlZ29yeU5hbWUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYmFzZSA9IGdldFJlc3RCYXNlVXJsKHBvcnRhbCk7XG4gICAgY29uc3Qgc2VsZiA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1wb3J0YWxzL3NlbGZgKTtcbiAgICBjb25zdCBncm91cFNlYXJjaCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZX1jb21tdW5pdHkvZ3JvdXBzP3E9JHtzZWxmLmNvbnRlbnRDYXRlZ29yeVNldHNHcm91cFF1ZXJ5fWApO1xuICAgIGNvbnN0IGNhdGVnb3J5R3JvdXAgPSAoX2EgPSBncm91cFNlYXJjaCA9PT0gbnVsbCB8fCBncm91cFNlYXJjaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JvdXBTZWFyY2gucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgIGNvbnN0IHNjaGVtYUl0ZW1TZWFyY2ggPSBhd2FpdCByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9ncm91cHMvJHtjYXRlZ29yeUdyb3VwLmlkfS9zZWFyY2hgLCB7XG4gICAgICAgIHE6IGB0eXBla2V5d29yZHM6ICR7Y2F0ZWdvcnlOYW1lfWBcbiAgICB9KTtcbiAgICBjb25zdCBzY2hlbWFJdGVtID0gc2NoZW1hSXRlbVNlYXJjaC5yZXN1bHRzWzBdO1xuICAgIHJldHVybiByZXF1ZXN0KGAke2Jhc2V9Y29udGVudC9pdGVtcy8ke3NjaGVtYUl0ZW0uaWR9L2RhdGFgKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGl2aW5nQXRsYXNDYXRlZ29yaWVzKHBvcnRhbCwgY2F0ZWdvcnlOYW1lLCB1c2VDYWNoZSA9IHRydWUpIHtcbiAgICBjb25zdCBnZXRTY2hlbWEgPSAoKSA9PiBmZXRjaExpdmluZ0F0bGFzU2NoZW1hKHBvcnRhbCwgY2F0ZWdvcnlOYW1lKTtcbiAgICByZXR1cm4gdXNlQ2FjaGUgPyBmcm9tQ2FjaGUoZ2V0U2NoZW1hLCBcImNhdGVnb3J5U2NoZW1hXCIsIGNhdGVnb3J5TmFtZSkgOiBnZXRTY2hlbWEoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNhdGVnb3JpZXMoeyBjYXRlZ29yaWVzLCBpdGVtSWRzLCBwb3J0YWwgfSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9L2NvbnRlbnQvdXBkYXRlSXRlbXNgO1xuICAgICAgICBjb25zdCBpdGVtcyA9IEpTT04uc3RyaW5naWZ5KGl0ZW1JZHMubWFwKChpZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBbaWRdOiB7IGNhdGVnb3JpZXM6IEFycmF5LmlzQXJyYXkoY2F0ZWdvcmllcykgPyBjYXRlZ29yaWVzIDogY2F0ZWdvcmllc1tpZF0gfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyByZXN1bHQ6IGF3YWl0IHJlcXVlc3QodXJsLCB7IGl0ZW1zIH0sIHt9LCBcInBvc3RcIikgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBlcnJvcjogeyBjb2RlOiBcInVuaGFuZGxlZEVycm9yXCIgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgZmV0Y2hMaXZpbmdBdGxhc0NhdGVnb3JpZXMgYXMgYSwgZmV0Y2hHcm91cENhdGVnb3JpZXMgYXMgYiwgZmV0Y2hDYXRlZ29yaWVzIGFzIGYsIGdldEl0ZW1DYXRlZ29yeVNjaGVtYSBhcyBnLCB1cGRhdGVDYXRlZ29yaWVzIGFzIHUgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2F0ZWdvcmllcy05ZjBmMzdlZS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IENBVEVHT1JZX0JBU0VfUEFUSCA9IFwiL2NhdGVnb3JpZXNcIjtcbmNvbnN0IFVQUEVSX0NBVEVHT1JZX0JBU0VfUEFUSCA9IFwiL0NhdGVnb3JpZXNcIjtcblxuLy8gVE9ETzogYWRkIHVuaXQgdGVzdHNcbi8qKlxuICogQ29uc3RydWN0IHRoZSBwYXRoIG9mIHRoZSBjYXRlZ29yeSBiYXNlZCBvbiB0aGUgcGFyZW50IHBhdGggYW5kIHRoZSBjYXRlZ29yeSB0aXRsZVxuICovXG5jb25zdCBnZXRDYXRlZ29yeVVJUGF0aCA9IChwYXJlbnRQYXRoLCBjYXRlZ29yeSwgbG93ZXJDYXNlID0gdHJ1ZSkgPT4ge1xuICAgIGNvbnN0IGJhc2VQYXRoID0gcGFyZW50UGF0aCAhPT0gbnVsbCAmJiBwYXJlbnRQYXRoICE9PSB2b2lkIDAgPyBwYXJlbnRQYXRoIDogXCJcIjtcbiAgICByZXR1cm4gYCR7YmFzZVBhdGh9JHtiYXNlUGF0aC5lbmRzV2l0aChcIi9cIikgPyBcIlwiIDogXCIvXCJ9JHtsb3dlckNhc2UgPyBjYXRlZ29yeS50aXRsZS50b0xvY2FsZUxvd2VyQ2FzZSgpIDogY2F0ZWdvcnkudGl0bGV9YDtcbn07XG4vKipcbiAqIEZpbmQgdGhlIHJvb3Qgbm9kZSB0aXRsZSB0byB1c2UgZm9yIGNhdGVnb3JpZXNcbiAqL1xuZnVuY3Rpb24gZ2V0Um9vdENhdGVnb3J5UGF0aChjYXRlZ29yaWVzKSB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBjYXRlZ29yeVRpdGxlID0gKF9hID0gY2F0ZWdvcmllcyA9PT0gbnVsbCB8fCBjYXRlZ29yaWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjYXRlZ29yaWVzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGl0bGU7XG4gICAgaWYgKGNhdGVnb3J5VGl0bGUgJiYgY2F0ZWdvcnlUaXRsZS5jaGFyQXQoMCkgIT09IFwiL1wiKSB7XG4gICAgICAgIGNhdGVnb3J5VGl0bGUgPSBgLyR7Y2F0ZWdvcnlUaXRsZX1gO1xuICAgIH1cbiAgICByZXR1cm4gY2F0ZWdvcnlUaXRsZSB8fCBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEg7XG59XG5cbmV4cG9ydCB7IENBVEVHT1JZX0JBU0VfUEFUSCBhcyBDLCBVUFBFUl9DQVRFR09SWV9CQVNFX1BBVEggYXMgVSwgZ2V0Q2F0ZWdvcnlVSVBhdGggYXMgYSwgZ2V0Um9vdENhdGVnb3J5UGF0aCBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNhdGVnb3JpZXMtY2ExMzQwMDUuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBhIGFzIGFkZENyZWF0ZUl0ZW1UeXBlcyB9IGZyb20gJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgeyBnIGFzIGd1aWQgfSBmcm9tICcuL2d1aWQtYWVhZWQ4NGQuanMnO1xuXG5mdW5jdGlvbiBzYW5pdGl6ZUZpbGVOYW1lKG5hbWUsIGFkZEdVSUQpIHtcbiAgICAvL1RPRE86IGFkZCBuZXcgcGFyYW0gdG8gc3BlYyBmaWxlLlxuICAgIGNvbnN0IGV4cHJlc3Npb24gPSAvKD86XFwuKFteLl0rKSk/JC87XG4gICAgY29uc3QgaW52YWxpZFRpdGxlQ2hhcmFjdGVycyA9IC9cXC58LS9nO1xuICAgIGxldCBmaWxlTmFtZSA9IG5hbWUucmVwbGFjZSgvXi4qKFxcXFx8XFwvfDopLywgXCJcIik7XG4gICAgbGV0IGV4dGVuc2lvbiA9IChmaWxlTmFtZSAmJiBleHByZXNzaW9uLmV4ZWMoZmlsZU5hbWUpWzFdID8gZXhwcmVzc2lvbi5leGVjKGZpbGVOYW1lKVsxXS50b0xvd2VyQ2FzZSgpIDogXCJcIik7XG4gICAgbGV0IHRpdGxlID0gXCJcIjtcbiAgICBpZiAoZmlsZU5hbWUuaW5kZXhPZihcIi5yZnQuXCIpID4gLTEpIHtcbiAgICAgICAgY29uc3QgW25hbWUsIHN1ZmZpeF0gPSBmaWxlTmFtZS5zcGxpdChcIi5yZnQuXCIpO1xuICAgICAgICBleHRlbnNpb24gPSBgcmZ0LiR7c3VmZml4fWA7XG4gICAgICAgIHRpdGxlID0gbmFtZTtcbiAgICB9XG4gICAgaWYgKGZpbGVOYW1lICYmICF0aXRsZSkge1xuICAgICAgICB0aXRsZSA9IGZpbGVOYW1lLmxhc3RJbmRleE9mKFwiLlwiKSA9PT0gLTEgPyBmaWxlTmFtZSA6IGZpbGVOYW1lLnN1YnN0cmluZygwLCBmaWxlTmFtZS5sYXN0SW5kZXhPZihcIi5cIikpO1xuICAgIH1cbiAgICAvLyBSZXBsYWNlIGFueSBpbnZhbGlkIGNoYXJhY3RlcnMgd2l0aCBhbiB1bmRlcnNjb3JlXG4gICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGludmFsaWRUaXRsZUNoYXJhY3RlcnMsIFwiX1wiKTtcbiAgICAvLyBBbGxvdyBmaWxlIHVwbG9hZCBvZiBleGlzdGluZyBpdGVtJ3MgZmlsZSBuYW1lIC8vIGN1cnJlbnRseSB1c2VkIGluIGFwcGVuZFxuICAgIGlmIChhZGRHVUlEKSB7XG4gICAgICAgIHRpdGxlID0gbWFrZVVuaXF1ZUZpbGVOYW1lKHRpdGxlKTtcbiAgICAgICAgZmlsZU5hbWUgPSBgJHt0aXRsZX0uJHtleHRlbnNpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHsgdGl0bGUsIGZpbGVOYW1lLCBleHRlbnNpb24gfTtcbn1cbi8vIEhlbHBlciBtZXRob2QgdGhhdCB0YWtlcyBpbiBhIGZpbGUgJiByZXR1cm5zIHRoZSBjbGVhbmVkIHVwIGZpbGUgbmFtZSBhcyBpcyBhbmQgaW4gdGl0bGUgZm9ybSwgYW5kIHRoZSBkZXRlY3RlZCBmaWxlIGV4dGVuc2lvblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlSW5wdXQoZmlsZSwgYWRkR1VJRCkge1xuICAgIHJldHVybiBzYW5pdGl6ZUZpbGVOYW1lKGZpbGUubmFtZSwgISFhZGRHVUlEKTtcbn1cbmZ1bmN0aW9uIG1ha2VVbmlxdWVGaWxlTmFtZShuYW1lKSB7XG4gICAgcmV0dXJuIGAke25hbWV9XyR7Z3VpZCgpfWA7XG59XG5mdW5jdGlvbiB2YWxpZGF0ZU92ZXJ3cml0ZUZpbGVOYW1lKHVwbG9hZGVkRmlsZU5hbWUsIHNvdXJjZUZpbGVOYW1lKSB7XG4gICAgbGV0IGZpbGVOYW1lID0gdXBsb2FkZWRGaWxlTmFtZTtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHVwbG9hZGVkRmlsZU5hbWUubGFzdEluZGV4T2YoXCJcXFxcXCIpO1xuICAgIGlmIChwb3NpdGlvbiA+IC0xKSB7XG4gICAgICAgIGZpbGVOYW1lID0gZmlsZU5hbWUuc3Vic3RyaW5nKHBvc2l0aW9uICsgMSwgZmlsZU5hbWUubGVuZ3RoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIikgPT09IHNvdXJjZUZpbGVOYW1lLnJlcGxhY2UoL1xcIC9nLCBcIl9cIik7XG59XG5mdW5jdGlvbiBnZXRJdGVtSW5mb0J5VHlwZSh0eXBlKSB7XG4gICAgaWYgKGFkZENyZWF0ZUl0ZW1UeXBlc1t0eXBlXSkge1xuICAgICAgICByZXR1cm4gYWRkQ3JlYXRlSXRlbVR5cGVzW3R5cGVdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGFkZENyZWF0ZUl0ZW1UeXBlc1tPYmplY3Qua2V5cyhhZGRDcmVhdGVJdGVtVHlwZXMpLmZpbmQoKGZpbGVUeXBlKSA9PiBhZGRDcmVhdGVJdGVtVHlwZXNbZmlsZVR5cGVdLnR5cGUgPT09IHR5cGUpXTtcbiAgICB9XG59XG5mdW5jdGlvbiBmb3JtYXRGaWxlU2l6ZShzaXplKSB7XG4gICAgaWYgKCFzaXplKSB7XG4gICAgICAgIHJldHVybiBcIjAgQlwiO1xuICAgIH1cbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhzaXplKSAvIE1hdGgubG9nKDEwMjQpKTtcbiAgICBjb25zdCBhZGp1c3RlZFNpemUgPSBNYXRoLnJvdW5kKHNpemUgLyBNYXRoLnBvdygxMDI0LCBpKSk7XG4gICAgY29uc3QgdW5pdCA9IFtcIkJcIiwgXCJLQlwiLCBcIk1CXCIsIFwiR0JcIiwgXCJUQlwiXVtpXTtcbiAgICByZXR1cm4gYCR7YWRqdXN0ZWRTaXplfSAke3VuaXR9YDtcbn1cblxuZXhwb3J0IHsgc2FuaXRpemVGaWxlTmFtZSBhcyBhLCBmb3JtYXRGaWxlU2l6ZSBhcyBmLCBnZXRJdGVtSW5mb0J5VHlwZSBhcyBnLCBzYW5pdGl6ZUZpbGVJbnB1dCBhcyBzLCB2YWxpZGF0ZU92ZXJ3cml0ZUZpbGVOYW1lIGFzIHYgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmlsZS1iZjhhYjkwZi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVxdWVzdCwgZSBhcyBnZXRUb2tlbiwgZyBhcyBnZXRSZXN0QmFzZVVybCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBhIGFzIGlzSG9zdGVkU2VydmljZSB9IGZyb20gJy4vdXJsLTM1ODc1YTEwLmpzJztcblxuZnVuY3Rpb24gcGFyc2VTdWJsYXllcihzdWJsYXllciwgbGF5ZXJzLCBpc1RhYmxlKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4ge1xuICAgICAgICBkZXNjcmlwdGlvbjogc3VibGF5ZXIuZGVzY3JpcHRpb24sXG4gICAgICAgIGZpZWxkQWxpYXNlczogKF9hID0gc3VibGF5ZXIuZmllbGRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKChmaWVsZCkgPT4gZmllbGQuYWxpYXMpLFxuICAgICAgICBmaWVsZHM6IHN1YmxheWVyLmZpZWxkcyxcbiAgICAgICAgZ2VvbWV0cnlUeXBlOiBpc1RhYmxlID8gXCJ0YWJsZVwiIDogc3VibGF5ZXIuZ2VvbWV0cnlUeXBlLFxuICAgICAgICBpZDogc3VibGF5ZXIuaWQsXG4gICAgICAgIHRpdGxlOiBzdWJsYXllci5uYW1lLFxuICAgICAgICB0eXBlOiBzdWJsYXllci50eXBlLFxuICAgICAgICBtYXRjaGVkOiAoX2IgPSBsYXllcnMgPT09IG51bGwgfHwgbGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLmlkID09PSBzdWJsYXllci5pZCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5tYXRjaGVkXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHNlcnZlclJlcXVlc3QodXJsLCBpc1NlY3VyZSkge1xuICAgIGNvbnN0IHsgY29uZmlnIH0gPSBjb25maWdTdGF0ZTtcbiAgICBjb25zdCBob3N0ZWQgPSBpc0hvc3RlZFNlcnZpY2UodXJsKTtcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IHVzZVByb3h5OiBmYWxzZSwgdGltZW91dDogY29uZmlnLmlzTXVsdGlUZW5hbnQgPT09IGZhbHNlID8gNjAwMDAgOiA1MDAwLCBhZGRTU0w6IGhvc3RlZCB9LCAoaXNTZWN1cmUgPyB7fSA6IHsgYWRkVG9rZW5NYW51YWxseTogZmFsc2UgfSkpLCB7IHVzZVBvc3Q6IHRydWUsIGRpc2FibGVJZGVudGl0eUxvb2t1cDogdHJ1ZSB9KTtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIHt9LCByZXF1ZXN0T3B0aW9ucywgXCJwb3N0XCIpO1xufVxuZnVuY3Rpb24gZ2V0RXJyb3JDb2RlKGVycm9yKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSB8fCAoKF9iID0gKF9hID0gZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmRldGFpbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yYXcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jb2RlKTtcbn1cbmZ1bmN0aW9uIHNlcnZpY2VEb2VzTm90RXhpc3QoZXJyb3IpIHtcbiAgICBjb25zdCBjb2RlID0gZ2V0RXJyb3JDb2RlKGVycm9yKTtcbiAgICByZXR1cm4gWzQwNCwgNTAwXS5pbmNsdWRlcyhjb2RlKSB8fCAoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2UpID09PSBcIkludmFsaWQgVVJMXCI7XG59XG5mdW5jdGlvbiBzaG91bGRSZXRyeVdpdGhUb2tlbihpc1NlY3VyZSwgZXJyb3IpIHtcbiAgICBjb25zdCBjb2RlID0gZ2V0RXJyb3JDb2RlKGVycm9yKTtcbiAgICByZXR1cm4gIWlzU2VjdXJlICYmICgoY29kZSA9PT0gNDk5ICYmIChlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubWVzc2FnZSkgPT09IFwiVG9rZW4gUmVxdWlyZWRcIikgfHwgY29kZSA9PT0gNDAzKSAmJiAhIWNvbmZpZ1N0YXRlLnVzZXI7XG59XG5hc3luYyBmdW5jdGlvbiBmZXRjaExheWVyKHBvcnRhbCwgaWQsIHVybCwgaXNTZWN1cmUpIHtcbiAgICBjb25zdCBlcnJvclJlc3VsdCA9IHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgICB0cnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmVyUmVxdWVzdChgJHt1cmx9LyR7aWR9YCwgaXNTZWN1cmUpO1xuICAgICAgICAgICAgcmV0dXJuIHsgcmVzdWx0IH07XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoc2hvdWxkUmV0cnlXaXRoVG9rZW4oaXNTZWN1cmUsIGVycm9yKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaExheWVyKHBvcnRhbCwgaWQsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VydmljZURvZXNOb3RFeGlzdChlcnJvcikpIHtcbiAgICAgICAgICAgICAgICBlcnJvclJlc3VsdC5lcnJvci5jb2RlID0gXCJzZXJ2aWNlTm90RXhpc3RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlcnJvclJlc3VsdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgIH1cbn1cbmZ1bmN0aW9uIGZpbHRlckxheWVycyhsYXllcnMsIG1hdGNoZWRMYXllcnMsIGRhdGEsIGlzVGFibGUpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IGhhc1RhYmxlcyA9IGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS50YWJsZXM7XG4gICAgY29uc3QgaGFzRGVmaW5lZERhdGFMYXllcnMgPSAoKF9hID0gZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgPiAwIHx8IGhhc1RhYmxlcztcbiAgICBjb25zdCBpZHMgPSBbLi4uKChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEubGF5ZXJzKSB8fCBbXSkubWFwKChsYXllcikgPT4gbGF5ZXIuaWQpLCAuLi4oX2IgPSAoKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS50YWJsZXMpIHx8IFtdKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm1hcCgodGFibGUpID0+IHRhYmxlLmlkKV07XG4gICAgLy8gaWYgZGF0YSBoYXMgZGVmaW5lZCBsYXllcnMsIG9ubHkgdXNlIGxheWVycyBpbiBkYXRhLCBub3QgdGhlIHdob2xlIHNlcnZpY2UgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCMzOTc2OClcbiAgICAvLyBpZiBkYXRhIGhhcyBkZWZpbmVkIGxheWVycywgYnV0IG5vIGRlZmluZWQgdGFibGVzLCBhbGxvdyBhbGwgdGFibGVzIHRocm91Z2ggKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDA2NylcbiAgICBjb25zdCBzdWJsYXllcnMgPSAobGF5ZXJzIHx8IFtdKVxuICAgICAgICAuZmlsdGVyKCh7IGlkLCB0eXBlIH0pID0+ICFoYXNEZWZpbmVkRGF0YUxheWVycyB8fCAodHlwZSA9PT0gXCJUYWJsZVwiICYmICFoYXNUYWJsZXMpIHx8IGlkcy5pbmNsdWRlcyhpZCkpXG4gICAgICAgIC5tYXAoKGxheWVyKSA9PiBwYXJzZVN1YmxheWVyKGxheWVyLCBtYXRjaGVkTGF5ZXJzLCBpc1RhYmxlKSk7XG4gICAgcmV0dXJuIHN1YmxheWVycztcbn1cbmFzeW5jIGZ1bmN0aW9uIGZldGNoTGF5ZXJzKHsgc2VydmljZUluZm8sIGl0ZW0sIGxheWVycywgaXNTZWN1cmUsIGRhdGEgfSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyB1cmwgfSA9IGl0ZW07XG4gICAgaWYgKCEoKF9hID0gc2VydmljZUluZm8ubGF5ZXJzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSAmJiAhKChfYiA9IHNlcnZpY2VJbmZvLnRhYmxlcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgJiYgKHNlcnZpY2VJbmZvID09PSBudWxsIHx8IHNlcnZpY2VJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXJ2aWNlSW5mby5maWVsZHMpKSB7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogW3BhcnNlU3VibGF5ZXIoc2VydmljZUluZm8sIGxheWVycyldIH07XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXJzOiBzdWJsYXllcnMsIHRhYmxlcyB9ID0gYXdhaXQgc2VydmVyUmVxdWVzdChgJHt1cmx9L2xheWVyc2AsIGlzU2VjdXJlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3VsdDogWy4uLmZpbHRlckxheWVycyhzdWJsYXllcnMsIGxheWVycywgZGF0YSksIC4uLmZpbHRlckxheWVycyh0YWJsZXMsIGxheWVycywgZGF0YSwgdHJ1ZSldLnNvcnQoKGEsIGIpID0+IGEuaWQgLSBiLmlkKVxuICAgICAgICB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiIH0gfTtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRNYXRjaGVkKHN1YmxheWVycywgbWF0Y2hlZExheWVycykge1xuICAgIHJldHVybiBzdWJsYXllcnMubWFwKChzdWJsYXllcikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHN1YmxheWVyKSwgeyBtYXRjaGVkOiAoX2EgPSBtYXRjaGVkTGF5ZXJzID09PSBudWxsIHx8IG1hdGNoZWRMYXllcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoZWRMYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLmlkID09PSBzdWJsYXllci5pZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXRjaGVkIH0pO1xuICAgIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hGZWF0dXJlU2VydmljZUluZm8oeyBpdGVtLCBwb3J0YWwsIGxheWVycywgaXNTZWN1cmUsIGRhdGEsIHJldHJ5IH0pIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgZXJyb3JSZXN1bHQgPSB7IGVycm9yOiB7IGNvZGU6IFwidW5oYW5kbGVkRXJyb3JcIiB9IH07XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFkYXRhICYmICFyZXRyeSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuKHBvcnRhbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW5QYXJhbSA9IHRva2VuID8gYCZ0b2tlbj0ke3Rva2VufWAgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke2dldFJlc3RCYXNlVXJsKHBvcnRhbCl9Y29udGVudC9pdGVtcy8ke2l0ZW0uaWR9L2RhdGE/Zj1qc29uJHt0b2tlblBhcmFtfWA7XG4gICAgICAgICAgICAgICAgLy8gVXNlIGZldGNoIGluc3RlYWQgb2YgcmVxdWVzdCB0byBzdG9wIHJlZGlyZWN0cyAoV2ViR0lTL2FyY2dpcy1wb3J0YWwtYXBwIzQwMTY0KVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRyZWF0IHRoaXMgZXhwaXJlZCBhY2NvdW50IGFzIGlmIHRoZSBzZXJ2aWNlIGRvZXNuJ3QgZXhpc3QgKFdlYkdJUy9hcmNnaXMtcG9ydGFsLWFwcCM0MDE2MylcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3IuY29kZSA9PT0gNDAzICYmICgoX2EgPSBkYXRhLmVycm9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWVzc2FnZUNvZGUpID09PSBcIlNCXzAwMDZcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JSZXN1bHQuZXJyb3IuY29kZSA9IFwic2VydmljZU5vdEV4aXN0XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3JSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4ndCBnZXQgaXRlbSBkYXRhLCBqdXN0IG1vdmUgb25cbiAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbS50eXBlID09PSBcIkZlYXR1cmUgQ29sbGVjdGlvblwiKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmxheWVycykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZGF0YS5sYXllcnMubWFwKCh7IGxheWVyRGVmaW5pdGlvbiB9LCBpZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzOiBsYXllckRlZmluaXRpb24uZmllbGRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQWxpYXNlczogKF9hID0gbGF5ZXJEZWZpbml0aW9uLmZpZWxkcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgoZmllbGQpID0+IGZpZWxkLmFsaWFzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW9tZXRyeVR5cGU6IGxheWVyRGVmaW5pdGlvbi5nZW9tZXRyeVR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbGF5ZXJEZWZpbml0aW9uLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGxheWVyRGVmaW5pdGlvbi5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHVybCB9ID0gaXRlbTtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZpY2VJbmZvID0gYXdhaXQgc2VydmVyUmVxdWVzdCh1cmwsIGlzU2VjdXJlKTtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaExheWVycyh7XG4gICAgICAgICAgICAgICAgc2VydmljZUluZm8sXG4gICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICBsYXllcnMsXG4gICAgICAgICAgICAgICAgaXNTZWN1cmUsXG4gICAgICAgICAgICAgICAgZGF0YVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoc2hvdWxkUmV0cnlXaXRoVG9rZW4oaXNTZWN1cmUsIGVycm9yKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaEZlYXR1cmVTZXJ2aWNlSW5mbyh7IGl0ZW0sIHBvcnRhbCwgbGF5ZXJzLCBkYXRhLCBpc1NlY3VyZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZXJ2aWNlRG9lc05vdEV4aXN0KGVycm9yKSkge1xuICAgICAgICAgICAgICAgIGVycm9yUmVzdWx0LmVycm9yLmNvZGUgPSBcInNlcnZpY2VOb3RFeGlzdFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVycm9yUmVzdWx0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gZXJyb3JSZXN1bHQ7XG4gICAgfVxufVxuXG5leHBvcnQgeyBmZXRjaExheWVyIGFzIGEsIGZldGNoRmVhdHVyZVNlcnZpY2VJbmZvIGFzIGYsIHNldE1hdGNoZWQgYXMgcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXJ2aWNlcy01OTI1YzRiNC5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGcgYXMgZ2V0U3RvcmUgfSBmcm9tICcuL3N0b3JlLThiMWIwODQ2LmpzJztcblxuZnVuY3Rpb24gZ2V0SXRlbUJyb3dzZXJTdG9yZShlbCkge1xuICAgIHJldHVybiBnZXRTdG9yZShlbCwgXCJhcmNnaXMtaXRlbS1icm93c2VyXCIpO1xufVxuY29uc3Qgb25JdGVtQnJvd3NlclZpZXdDaGFuZ2UgPSAoc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gICAgc3RvcmUub25DaGFuZ2UoXCJ2aWV3XCIsIChuZXdWaWV3KSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG5ld1ZpZXcpO1xuICAgIH0pO1xufTtcbmNvbnN0IG9uSXRlbUJyb3dzZXJCdWNrZXRDaGFuZ2UgPSAoc3RvcmUsIGNhbGxiYWNrKSA9PiB7XG4gICAgc3RvcmUub25DaGFuZ2UoXCJidWNrZXRcIiwgKG5ld0J1Y2tldCkgPT4ge1xuICAgICAgICBjYWxsYmFjayhuZXdCdWNrZXQpO1xuICAgIH0pO1xufTtcbmNvbnN0IG9uSXRlbUJyb3dzZXJQcmV2aWV3Q2hhbmdlID0gKHN0b3JlLCBjYWxsYmFjaykgPT4ge1xuICAgIHN0b3JlLm9uQ2hhbmdlKFwicHJldmlld1wiLCAocHJldmlldykgPT4ge1xuICAgICAgICBjYWxsYmFjayhwcmV2aWV3KTtcbiAgICB9KTtcbn07XG5jb25zdCBvbkl0ZW1Ccm93c2VyU29ydENoYW5nZSA9IChzdG9yZSwgY2FsbGJhY2spID0+IHtcbiAgICBzdG9yZS5vbkNoYW5nZShcInNvcnRcIiwgKHNvcnQpID0+IHtcbiAgICAgICAgY2FsbGJhY2soc29ydCk7XG4gICAgfSk7XG59O1xuXG5leHBvcnQgeyBvbkl0ZW1Ccm93c2VyU29ydENoYW5nZSBhcyBhLCBvbkl0ZW1Ccm93c2VyUHJldmlld0NoYW5nZSBhcyBiLCBvbkl0ZW1Ccm93c2VyVmlld0NoYW5nZSBhcyBjLCBnZXRJdGVtQnJvd3NlclN0b3JlIGFzIGcsIG9uSXRlbUJyb3dzZXJCdWNrZXRDaGFuZ2UgYXMgbyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9yZS03ZmEyNjQ3Mi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IGZlYXR1cmVMYXllckljb25JbmZvID0ge1xuICAgIHBvaW50OiBcInBvaW50XCIsXG4gICAgbGluZTogXCJsaW5lXCIsXG4gICAgcG9seWdvbjogXCJwb2x5Z29uXCIsXG4gICAgbXVsdGlwYXRjaDogXCJjdWJlXCIsXG4gICAgdGFibGU6IFwidGFibGVcIixcbiAgICBtdWx0aXBvaW50OiBcImxheWVyLXBvaW50c1wiXG59O1xuY29uc3QgZXNyaUdlb21ldHJ5SWNvbnMgPSB7XG4gICAgZXNyaUdlb21ldHJ5UG9pbnQ6IFwicG9pbnRcIixcbiAgICBlc3JpR2VvbWV0cnlQb2x5bGluZTogXCJsaW5lXCIsXG4gICAgZXNyaUdlb21ldHJ5UG9seWdvbjogXCJwb2x5Z29uXCIsXG4gICAgZXNyaUdlb21ldHJ5TXVsdGlQYXRjaDogXCJjdWJlXCIsXG4gICAgZXNyaUdlb21ldHJ5TXVsdGlwb2ludDogXCJwb2ludFwiLFxuICAgIG5vbmU6IFwidGFibGVcIlxufTtcbmNvbnN0IGZpZWxkVHlwZUljb25zID0ge1xuICAgIGVzcmlGaWVsZFR5cGVPSUQ6IFwia2V5XCIsXG4gICAgZXNyaUZpZWxkVHlwZUJvb2xlYW46IFwiYm9vbGVhblwiLFxuICAgIGVzcmlGaWVsZFR5cGVTdHJpbmc6IFwic3RyaW5nXCIsXG4gICAgZXNyaUZpZWxkVHlwZVNpbmdsZTogXCJudW1iZXJcIixcbiAgICBlc3JpRmllbGRUeXBlRG91YmxlOiBcIm51bWJlclwiLFxuICAgIGVzcmlGaWVsZFR5cGVJbnRlZ2VyOiBcImludGVnZXJcIixcbiAgICBlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyOiBcImludGVnZXJcIixcbiAgICBlc3JpRmllbGRUeXBlR2xvYmFsSUQ6IFwia2V5XCIsXG4gICAgZXNyaUZpZWxkVHlwZURhdGU6IFwiZGF0ZS10aW1lXCIsXG4gICAgZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXI6IFwiaW50ZWdlclwiLFxuICAgIGVzcmlGaWVsZFR5cGVEYXRlT25seTogXCJjYWxlbmRhclwiLFxuICAgIGVzcmlGaWVsZFR5cGVUaW1lT25seTogXCJjbG9ja1wiLFxuICAgIGVzcmlGaWVsZFR5cGVUaW1lc3RhbXBPZmZzZXQ6IFwidGltZS16b25lXCJcbn07XG5cbmV4cG9ydCB7IGZlYXR1cmVMYXllckljb25JbmZvIGFzIGEsIGVzcmlHZW9tZXRyeUljb25zIGFzIGUsIGZpZWxkVHlwZUljb25zIGFzIGYgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dHlwZS10by1pY29uLTc1NDY0MzlmLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuLyoqIEdldCB0aGUgY29ycmVjdCBnZW9tZXRyeSBpY29uIGJhc2VkIG9uIGxheWVyL3RhYmxlIHR5cGUgYW5kIGdlb21ldHJ5IHR5cGVcbiAqIHdpbGwgaGFuZGxlcyB0eXBlcyB1c2VkIGJ5IHRoZSBqc2FwaSwgdGhlIGVzcmkgdHlwZXMgdXNlZCBvbiB0aGUgc2VydmVyLFxuICogYW5kIHRoZSB0eXBlcyByZXR1cm5lZCBieSB0aGUgU2VhcmNoIEFQSVxuICovXG5mdW5jdGlvbiBnZXRTdWJsYXllclR5cGVJbmZvKHsgZ2VvbWV0cnksIHR5cGUgfSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwiQ2F0YWxvZyBMYXllclwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpY29uOiBcImNhdGFsb2ctZGF0YXNldFwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiY2F0YWxvZ1wiLFxuICAgICAgICAgICAgICAgIGlzR2VvbWV0cnk6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwiUGFyY2VsIExheWVyXCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGljb246IFwicGFyY2VsLWxheWVyXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJwYXJjZWxcIixcbiAgICAgICAgICAgICAgICBpc0dlb21ldHJ5OiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcIk9yaWVudGVkIEltYWdlcnkgTGF5ZXJcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWNvbjogXCJvcmllbnRlZC1pbWFnZXJ5LWxheWVyXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJvcmllbnRlZCBpbWFnZXJ5XCIsXG4gICAgICAgICAgICAgICAgaXNHZW9tZXRyeTogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJUYWJsZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpY29uOiBcInRhYmxlXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0YWJsZVwiLFxuICAgICAgICAgICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgfVxuICAgIHN3aXRjaCAoZ2VvbWV0cnkpIHtcbiAgICAgICAgY2FzZSBcInBvaW50XCI6XG4gICAgICAgIGNhc2UgXCJlc3JpR2VvbWV0cnlQb2ludFwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvaW50XCIsXG4gICAgICAgICAgICAgICAgaWNvbjogXCJwb2ludFwiLFxuICAgICAgICAgICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgXCJlc3JpR2VvbWV0cnlNdWx0aXBvaW50XCI6XG4gICAgICAgIGNhc2UgXCJtdWx0aXBvaW50XCI6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwibXVsdGlwb2ludFwiLFxuICAgICAgICAgICAgICAgIGljb246IFwibGF5ZXItcG9pbnRzXCIsXG4gICAgICAgICAgICAgICAgaXNHZW9tZXRyeTogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSBcImxpbmVcIjpcbiAgICAgICAgY2FzZSBcInBvbHlsaW5lXCI6XG4gICAgICAgIGNhc2UgXCJlc3JpR2VvbWV0cnlQb2x5bGluZVwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgICAgICAgICAgICBpY29uOiBcImxpbmVcIixcbiAgICAgICAgICAgICAgICBpc0dlb21ldHJ5OiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwicG9seWdvblwiOlxuICAgICAgICBjYXNlIFwiZXNyaUdlb21ldHJ5UG9seWdvblwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvbHlnb25cIixcbiAgICAgICAgICAgICAgICBpY29uOiBcInBvbHlnb25cIixcbiAgICAgICAgICAgICAgICBpc0dlb21ldHJ5OiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlIFwibXVsdGlwYXRjaFwiOlxuICAgICAgICBjYXNlIFwiZXNyaUdlb21ldHJ5TXVsdGlQYXRjaFwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm11bHRpcGF0Y2hcIixcbiAgICAgICAgICAgICAgICBpY29uOiBcImN1YmVcIixcbiAgICAgICAgICAgICAgICBpc0dlb21ldHJ5OiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRhYmxlXCIsXG4gICAgICAgICAgICAgICAgaWNvbjogXCJ0YWJsZVwiLFxuICAgICAgICAgICAgICAgIGlzR2VvbWV0cnk6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBnZXRTdWJsYXllclR5cGVJbmZvIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbHMtYWEyNmM0OWYuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9