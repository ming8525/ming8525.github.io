"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ canMatchField),
/* harmony export */   g: () => (/* binding */ getAppendParameters)
/* harmony export */ });
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */





var __rest = ( false) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
function canMatchField(field, matchField) {
    var _a;
    const fieldType = (field === null || field === void 0 ? void 0 : field.type) || null;
    const matchFieldType = (matchField === null || matchField === void 0 ? void 0 : matchField.type) || null;
    const matchFields = {
        esriFieldTypeSmallInteger: ["esriFieldTypeSmallInteger"],
        esriFieldTypeInteger: ["esriFieldTypeInteger", "esriFieldTypeSmallInteger"],
        esriFieldTypeSingle: ["esriFieldTypeSingle", "esriFieldTypeDouble"],
        esriFieldTypeDouble: [
            "esriFieldTypeDouble",
            "esriFieldTypeSingle",
            "esriFieldTypeInteger",
            "esriFieldTypeSmallInteger"
        ],
        esriFieldTypeDate: ["esriFieldTypeDate"],
        esriFieldTypeString: [
            "esriFieldTypeString",
            "esriFieldTypeSmallInteger",
            "esriFieldTypeInteger",
            "esriFieldTypeSingle",
            "esriFieldTypeDouble",
            "esriFieldTypeDate",
            "esriFieldTypeGUID"
        ],
        esriFieldTypeGUID: ["esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeOID: ["esriFieldTypeOID", "esriFieldTypeSmallInteger", "esriFieldTypeInteger"],
        esriFieldTypeGlobalID: ["esriFieldTypeGlobalID", "esriFieldTypeGUID", "esriFieldTypeString"],
        esriFieldTypeDateOnly: ["esriFieldTypeDateOnly"],
        esriFieldTypeTimeOnly: ["esriFieldTypeTimeOnly"],
        esriFieldTypeTimestampOffset: ["esriFieldTypeTimestampOffset"],
        esriFieldTypeBigInteger: ["esriFieldTypeBigInteger"]
    };
    return matchFieldType && (matchFieldType === fieldType || ((_a = matchFields[fieldType]) === null || _a === void 0 ? void 0 : _a.indexOf(matchFieldType)) > -1);
}
function getAppendParameters(addItemProps) {
    var _a;
    const { timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption, sourceDataLayer } = addItemProps;
    let finalAppendParameters, appendSourceInfo;
    const { publishParameters } = analyzeResults, rest = __rest(analyzeResults, ["publishParameters"]);
    const upsert = addAppendSelectOption === "upsert" || addAppendSelectOption === "update";
    const finalFieldMappings = formatFieldMappings(fieldMappings);
    const appendFields = createAppendFields(finalFieldMappings);
    const timezoneInfo = {
        dateFieldsTimeReference: {
            timeZone: timezone || "UTC",
            respectsDaylightSaving: true
        }
    };
    const defaultAppendParams = {
        sourceTableName: dataLayer.name,
        fieldMappings: (finalFieldMappings === null || finalFieldMappings === void 0 ? void 0 : finalFieldMappings.length) ? JSON.stringify(finalFieldMappings) : null,
        upsert,
        skipInserts: addAppendSelectOption === "update",
        skipUpdates: false,
        useGlobalIds: upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.type) === "esriFieldTypeGlobalID",
        updateGeometry: upsert ? _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.addAppendSelectUpdateTypeOption === "attributeAndGeometry" : true,
        appendFields: appendFields.length ? JSON.stringify(appendFields) : null,
        appendItemId: id,
        appendUploadFormat: _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_3__.a[_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_0__.a.type].appendUploadFormat,
        rollbackOnFailure: true
    };
    const publishInfo = __rest(publishParameters, ["layers"]);
    if (type === "CSV") {
        publishParameters.layerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    else if (type === "Microsoft Excel") {
        const layerInfo = (0,_geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_2__.a)({}, true);
        const formattedLayerInfo = getLayerToAppend(layerInfo, publishInfo); //Updated info needs to be added to the layers [] rather than the root for excel
        formattedLayerInfo.dateFieldsTimeReference = timezoneInfo.dateFieldsTimeReference;
        publishInfo.name = dataLayer.name;
        appendSourceInfo = Object.assign(Object.assign(Object.assign(Object.assign({}, timezoneInfo), { layers: [formattedLayerInfo] }), publishInfo), rest);
    }
    else {
        appendSourceInfo = Object.assign(Object.assign(Object.assign({}, timezoneInfo), publishParameters), rest);
    }
    finalAppendParameters = Object.assign(Object.assign({}, defaultAppendParams), { appendSourceInfo: JSON.stringify(appendSourceInfo) });
    if (addAppendSelectOption === "add") {
        finalAppendParameters.upsertMatchingField = sourceDataLayer.objectIdField || ((_a = sourceDataLayer.uniqueField) === null || _a === void 0 ? void 0 : _a.name);
    }
    else {
        if (upsert && (uidPair === null || uidPair === void 0 ? void 0 : uidPair.isUniqueIndex)) {
            finalAppendParameters.upsertMatchingField = uidPair === null || uidPair === void 0 ? void 0 : uidPair.name;
        }
    }
    return finalAppendParameters;
}
function getLayerToAppend(layerInfo, updatedInfo) {
    const formattedLayer = Object.assign({}, layerInfo);
    formattedLayer.locationType = updatedInfo.locationType;
    if (formattedLayer.locationType === "address") {
        formattedLayer.addressFields = updatedInfo.addressFields;
        formattedLayer.sourceCountry = updatedInfo.sourceCountry;
    }
    else if (formattedLayer.locationType === "coordinates") {
        formattedLayer.coordinateFieldType = updatedInfo.coordinateFieldType;
        if (formattedLayer.coordinateFieldType === "LatitudeAndLongitude") {
            formattedLayer.latitudeFieldName = updatedInfo.latitudeFieldName;
            formattedLayer.longitudeFieldName = updatedInfo.longitudeFieldName;
        }
        else {
            formattedLayer.coordinateFieldName = updatedInfo.coordinateFieldName;
        }
    }
    return formattedLayer;
}
function formatFieldMappings(fieldMappings) {
    const fields = fieldMappings.filter((fieldMapping) => {
        return fieldMapping.source !== _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_1__.N;
    });
    const finalFieldMappings = fields.map(({ source, name }) => {
        return { source, name };
    });
    return finalFieldMappings;
}
function createAppendFields(fieldMappings) {
    const appendFields = fieldMappings.map((mapping) => {
        return mapping.name;
    });
    return appendFields;
}



//# sourceMappingURL=append-3f264d56.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AppendOverwriteCloudPublishTypes),
/* harmony export */   N: () => (/* binding */ NONE_VALUE),
/* harmony export */   a: () => (/* binding */ appendFileTypes),
/* harmony export */   b: () => (/* binding */ AppendOverwritePublishTypes),
/* harmony export */   c: () => (/* binding */ appendExtensionsForEnterprise),
/* harmony export */   d: () => (/* binding */ appendExtensions),
/* harmony export */   u: () => (/* binding */ uidFields)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
const uidFields = ["esriFieldTypeOID", "esriFieldTypeGlobalID"];
const NONE_VALUE = "<None>";
const AppendOverwritePublishTypes = {
    "file geodatabase": "filegeodatabase",
    shapefile: "shapefile",
    geojson: "geojson",
    csv: "CSV",
    "microsoft excel": "excel",
    geopackage: "geoPackage"
};
const appendFileTypes = {
    Shapefile: "shapefile",
    "File Geodatabase": "fileGeodatabase",
    CSV: "csv",
    "Microsoft Excel": "excel",
    GeoJson: "geojson",
    GeoPackage: "geoPackage"
};
const AppendOverwriteCloudPublishTypes = {
    csv: "CSV",
    excel: "Microsoft Excel",
    shapefile: "Shapefile",
    fgdb: "File Geodatabase",
    geojson: "GeoJson",
    googlesheets: "Microsoft Excel"
};
const appendExtensions = ["zip", "csv", "xls", "xlsx", "geojson", "gpkg", "json"];
const appendExtensionsForEnterprise = ["zip", "csv", "xls", "xlsx"];



//# sourceMappingURL=append-4e11032c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ append)
/* harmony export */ });
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _append_3f264d56_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./append-3f264d56.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




async function append(addItemProps) {
    var _a;
    const appendParameters = (0,_append_3f264d56_js__WEBPACK_IMPORTED_MODULE_1__.g)(addItemProps);
    const serviceUrl = (_a = addItemProps.existingItem) === null || _a === void 0 ? void 0 : _a.url;
    const appendUrl = `${serviceUrl}/${addItemProps.sourceDataLayer.id}/append`;
    try {
        const appendResponse = (await (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_0__.r)(appendUrl, appendParameters, {}, "post"));
        const { status, recordCount } = await (0,_feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_2__.x)(addItemProps.id, {}, appendResponse === null || appendResponse === void 0 ? void 0 : appendResponse.statusUrl);
        return { result: { status, recordCount } };
    }
    catch ({ error }) {
        console.error(error);
        return { error: { code: "unhandledError", message: JSON.stringify(error) } };
    }
}



//# sourceMappingURL=append-5bb9576c.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-match-fields.entry.js":
/*!********************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-new-item-pages-append-match-fields.entry.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_new_item_pages_append_match_fields: () => (/* binding */ ArcgisNewItemPagesAppendMatchFields)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add-item-dbbe2f57.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/add-item-dbbe2f57.js");
/* harmony import */ var _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./append-4e11032c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-4e11032c.js");
/* harmony import */ var _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui-bca7bcd1.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ui-bca7bcd1.js");
/* harmony import */ var _append_3f264d56_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./append-3f264d56.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-3f264d56.js");
/* harmony import */ var _server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./server-item-8d384796.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/server-item-8d384796.js");
/* harmony import */ var _append_5bb9576c_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./append-5bb9576c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/append-5bb9576c.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _geocode_64e0b0d3_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./geocode-64e0b0d3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/geocode-64e0b0d3.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _privileges_5c382f61_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./privileges-5c382f61.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-5c382f61.js");
/* harmony import */ var _item_3535552d_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./item-3535552d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-3535552d.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _privileges_74639dae_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./privileges-74639dae.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/privileges-74639dae.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _item_types_2029b06b_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./item-types-2029b06b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-types-2029b06b.js");
/* harmony import */ var _item_properties_10491b2e_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./item-properties-10491b2e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-properties-10491b2e.js");
/* harmony import */ var _functional_81373f6d_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./functional-81373f6d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-81373f6d.js");
/* harmony import */ var _feature_layer_573bb473_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./feature-layer-573bb473.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-573bb473.js");
/* harmony import */ var _feature_layer_79fb302c_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./feature-layer-79fb302c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-79fb302c.js");
/* harmony import */ var _guid_aeaed84d_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./guid-aeaed84d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/guid-aeaed84d.js");
/* harmony import */ var _thumbnail_bcb89e69_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./thumbnail-bcb89e69.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/thumbnail-bcb89e69.js");
/* harmony import */ var _service_8c2c4241_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./service-8c2c4241.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/service-8c2c4241.js");
/* harmony import */ var _user_3ea69c3a_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./user-3ea69c3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/user-3ea69c3a.js");
/* harmony import */ var _query_d62660d4_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./query-d62660d4.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/query-d62660d4.js");
/* harmony import */ var _api_2e3a136f_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./api-2e3a136f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/api-2e3a136f.js");
/* harmony import */ var _string_58a5fef3_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./string-58a5fef3.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/string-58a5fef3.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _item_c58ffced_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./item-c58ffced.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/item-c58ffced.js");
/* harmony import */ var _feature_layer_17b64946_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./feature-layer-17b64946.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/feature-layer-17b64946.js");
/* harmony import */ var _ags_eb458a03_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./ags-eb458a03.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/ags-eb458a03.js");
/* harmony import */ var _url_35875a10_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./url-35875a10.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-35875a10.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _file_bf8ab90f_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./file-bf8ab90f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/file-bf8ab90f.js");
/* harmony import */ var _store_6a88e6c5_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./store-6a88e6c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/store-6a88e6c5.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






































const arcgisNewItemPagesAppendMatchFieldsCss = ".fields-container{display:flex;height:100%;flex-direction:column;overflow-y:auto;overflow-x:hidden}.field-table{margin-bottom:1.5rem;display:flex;flex-direction:column;overflow:auto}.search-container{display:flex;width:100%}.field-search{margin-right:0.5rem;width:50%}.field-select{width:50%}.field-name-column{margin-right:0.5rem;width:50%}.match-field-name-column{width:50%}.fields-scroll-container{margin-bottom:0.75rem;display:flex;flex-direction:column;padding-bottom:0.75rem;border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.header-row{display:flex;align-content:flex-start;justify-content:center;gap:0.25rem;padding:0.25rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.header-cell{display:flex;width:100%;font-size:1rem}.hide{display:none}.not-visible{visibility:hidden;height:0px}.cell{box-sizing:border-box;width:100%}.cell label{margin-top:0.75rem}.row{margin-bottom:0.75rem;display:flex;align-items:center;justify-content:space-between;gap:0.25rem;padding:0.25rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0}.append-timezone{border-top:0.063rem solid var(--calcite-color-foreground-3)}.from-to-fields{display:flex;flex-direction:row}.description{margin-bottom:1rem;font-size:0.875rem;font-weight:300}.header{margin-bottom:0.5rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.no-fields{margin-bottom:1.5rem}.popover-icon{cursor:pointer;color:var(--calcite-color-text-3);margin-inline-start:0.75rem;margin-top:0.125rem}.popover-content{margin:0px;font-size:0.75rem;font-weight:400}.header-popover{margin-top:-0.313rem}";

const ArcgisNewItemPagesAppendMatchFields = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.newItemUpdatePage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemUpdatePage", 7);
        this.newItemPrevPage = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemPrevPage", 7);
        this.workflowComplete = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "workflowComplete", 7);
        this.newItemToggleNavigationEnabled = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemToggleNavigationEnabled", 7);
        this.newItemDisableCloseButtons = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "newItemDisableCloseButtons", 7);
        this.validatedFields = [];
        this.fields = undefined;
        this.i18n = undefined;
        this.fieldMatches = [];
        this.error = undefined;
        this.loading = false;
        this.loaderType = "indeterminate";
        this.loaderMessage = undefined;
    }
    handleNext() {
        const matchingCompletionError = this.validateMatchings();
        if (matchingCompletionError) {
            this.error = matchingCompletionError;
            return;
        }
        _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.fieldMappings = this.fieldMatches;
        if (this.appendSelection === "add") {
            this.handleAppend();
            return;
        }
        this.newItemUpdatePage.emit("appendSelectUpdate");
    }
    validateMatchings() {
        //return an error
        const noMatches = this.fieldMatches.every((field) => {
            return field.source === _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N;
        });
        const insertNonNullable = this.fieldMatches.some((field) => {
            return field.defaultValue && !field.isUniqueIndex && !field.nullable;
        });
        if (!noMatches) {
            const nonNullableFieldsLength = this.fieldMatches.filter((field) => !field.disabled && !field.nullable && field.source === _append_4e11032c_js__WEBPACK_IMPORTED_MODULE_2__.N).length;
            if (nonNullableFieldsLength <= 0 || this.appendSelection === "update") {
                return null;
            }
            if (insertNonNullable && this.appendSelection === "add") {
                return null;
            }
            return {
                title: this.i18n.errors.nonNullableErrorTitle,
                description: this.i18n.errors.nonNullableErrorDescription
            };
        }
        return { title: this.errorLabel, description: this.i18n.errors.noMatchedFields };
    }
    disableModalButtons(disable) {
        this.newItemToggleNavigationEnabled.emit(!disable);
        this.newItemDisableCloseButtons.emit(disable);
    }
    async handleAppend() {
        var _a, _b;
        const { sourceDataLayer, existingItem, timezone, analyzeResults, type, fieldMappings, dataLayer, id, uidPair, addAppendSelectOption } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        this.disableModalButtons(true);
        this.loading = true;
        this.loaderMessage = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendLoadingMessages.appendCloseNotice;
        const response = await (0,_append_5bb9576c_js__WEBPACK_IMPORTED_MODULE_6__.a)({
            sourceDataLayer,
            existingItem,
            timezone,
            analyzeResults,
            type,
            fieldMappings,
            dataLayer,
            id,
            uidPair,
            addAppendSelectOption
        });
        if (((_b = (_a = response === null || response === void 0 ? void 0 : response.result) === null || _a === void 0 ? void 0 : _a.status) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === "completed") {
            await (0,_server_item_8d384796_js__WEBPACK_IMPORTED_MODULE_5__.d)(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.id, { permanentDelete: true });
            const emitPayload = Object.assign({
                // `publishResponse` doesn't for some flows so use this id instead
                appendType: _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.addAppendSelectOption
            }, response);
            this.workflowComplete.emit(emitPayload);
            return;
        }
        else {
            this.disableModalButtons(false);
            this.loading = false;
            this.error = {
                title: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error,
                description: _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.append.appendErrorMessages.appendError
            };
        }
    }
    async handlePrev(event) {
        var _a;
        if (this.loading) {
            return;
        }
        if (this.appendSelection === "add" &&
            !(((_a = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.analyzeResults.publishParameters.layers) === null || _a === void 0 ? void 0 : _a.length) > 1)) {
            event.preventDefault();
            this.newItemPrevPage.emit();
        }
    }
    handleFieldChange(event) {
        const newFieldMapping = Object.assign({}, event.detail);
        this.validateFieldMappings(this.validatedFields, newFieldMapping);
    }
    sortFields() {
        this.fieldMatches = this.fieldMatches.sort(function (a, b) {
            const nameA = a.name.toLowerCase();
            const nameB = b.name.toLowerCase();
            if (nameA < nameB) {
                return -1;
            }
            else if (nameA > nameB) {
                return 1;
            }
            return 0;
        });
    }
    validateFieldMappings(currentFieldMappings, newFieldMapping) {
        newFieldMapping.initialMatch = newFieldMapping.source;
        if (newFieldMapping.source !== this.noneString) {
            const duplicate = currentFieldMappings.filter((mapping) => {
                return mapping.source === newFieldMapping.source;
            });
            if ((duplicate === null || duplicate === void 0 ? void 0 : duplicate.length) > 0) {
                const duplicateIndex = duplicate[0].idx;
                currentFieldMappings[duplicateIndex].initialMatch = this.noneString;
                currentFieldMappings[duplicateIndex].source = this.noneString;
            }
        }
        currentFieldMappings[newFieldMapping.idx] = newFieldMapping;
        this.validatedFields = currentFieldMappings;
        this.fieldMatches = [...this.validatedFields];
        this.sortFields();
    }
    setNextText() {
        _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.nextText =
            this.appendSelection === "add" ? "addAndComplete" : "next";
    }
    componentWillLoad() {
        const { addAppendSelectOption, uidPair, sourceDataLayer, backupLayerFields } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        this.i18n = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendMatchFields;
        this.errorLabel = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.error;
        this.noneString = _ui_bca7bcd1_js__WEBPACK_IMPORTED_MODULE_3__.u.i18n.appendKeyValuePair.noneField;
        this.appendSelection = addAppendSelectOption;
        const dataLayerFields = backupLayerFields;
        const serviceLayerFields = sourceDataLayer.type === "csv" ? [sourceDataLayer.layerInfo] : sourceDataLayer.fields;
        const updateExistingFeatures = this.appendSelection === "upsert" || this.appendSelection === "update";
        this.setNextText();
        this.selectedKeyPair = uidPair;
        let fieldsListIndex = this.appendSelection === "add" ? 0 : 1;
        serviceLayerFields.forEach((layerInfo) => {
            if ((layerInfo === null || layerInfo === void 0 ? void 0 : layerInfo.type) !== "esriFieldTypeOID" &&
                (layerInfo === null || layerInfo === void 0 ? void 0 : layerInfo.type) !== "esriFieldTypeGlobalID" &&
                layerInfo.editable && (!updateExistingFeatures || layerInfo.name !== this.selectedKeyPair.name)) {
                //match fields that are not uid
                this.fieldMatches.push(this.createFieldMapping(layerInfo, dataLayerFields, fieldsListIndex));
                this.validatedFields.push(this.createFieldMapping(layerInfo, dataLayerFields, fieldsListIndex));
                fieldsListIndex++;
            }
        });
        if (this.appendSelection !== "add") {
            this.fieldMatches.unshift(this.selectedKeyPair);
            this.validatedFields.unshift(this.selectedKeyPair);
        }
        this.sortFields();
    }
    createFieldMapping(serviceLayerField, dataLayerFields, serviceLayerIndex) {
        const addressFields = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.dataLayer.addressFields
            ? Object.values(_add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a.dataLayer.addressFields)
            : null;
        let matched = this.noneString;
        const possibleMatches = [
            {
                source: this.noneString,
                name: serviceLayerField.name,
                type: "None",
                idx: serviceLayerIndex
            }
        ];
        dataLayerFields.forEach((fieldInfo) => {
            if ((0,_append_3f264d56_js__WEBPACK_IMPORTED_MODULE_4__.c)(serviceLayerField, fieldInfo) &&
                (this.appendSelection === "add"
                    ? true
                    : fieldInfo.name !== this.selectedKeyPair.source)) {
                possibleMatches.push({
                    source: fieldInfo.name,
                    name: serviceLayerField.name,
                    type: serviceLayerField.type,
                    idx: serviceLayerIndex
                });
                if (serviceLayerField.name.toLowerCase() === fieldInfo.name.toLowerCase() &&
                    (serviceLayerField.type === fieldInfo.type ||
                        !!(addressFields === null || addressFields === void 0 ? void 0 : addressFields.find((field) => field === fieldInfo.displayName || field === fieldInfo.name))) &&
                    (this.appendSelection === "add"
                        ? true
                        : fieldInfo.name !== this.selectedKeyPair.source)) {
                    matched = fieldInfo.name;
                }
            }
        });
        return {
            source: matched,
            name: serviceLayerField.name,
            nullable: serviceLayerField.nullable,
            type: serviceLayerField.type,
            idx: serviceLayerIndex,
            isUniqueIndex: serviceLayerField.isUniqueIndex,
            defaultValue: serviceLayerField.defaultValue,
            initialMatch: matched,
            possibleMatches
        };
    }
    render() {
        const { i18n, error } = this;
        const { originalFileName, existingItem } = _add_item_dbbe2f57_js__WEBPACK_IMPORTED_MODULE_1__.a;
        const rowHeaderInfo = {
            originalField: {
                header: i18n.originalField.header,
                moreInfo: i18n.originalField.moreInfo.replace("${featureLayerName}", existingItem.title)
            },
            uploadedField: {
                header: i18n.uploadedField.header,
                moreInfo: i18n.uploadedField.moreInfo.replace("${uploadedFileName}", originalFileName)
            }
        };
        const description = i18n.description
            .replace("${uploadedFileName}", originalFileName)
            .replace("${featureLayerName}", existingItem.title);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { "overflow-hidden": this.loading } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-loader", { type: this.loaderType, active: this.loading, text: this.loaderMessage }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "header" }, " ", i18n.header, " "), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "description" }, description), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "row", role: "row" }, Object.keys(rowHeaderInfo).map((rowHeader) => {
            const { header, moreInfo } = rowHeaderInfo[rowHeader];
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "header-cell", role: "columnheader", "aria-sort": "none" }, header, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-information", { class: "header-popover", label: moreInfo, placement: "top-start", paddedContent: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", { class: "popover-content" }, moreInfo))));
        })), this.fieldMatches.length > 0 ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "fields-scroll-container", role: "table" }, this.fieldMatches.map((mapping) => {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-append-match-field", { key: mapping.source, onFieldChange: this.handleFieldChange.bind(this), field: mapping, role: "row" }));
        }))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input-message", { class: "no-fields", icon: true, status: "valid" }, this.i18n.errors.noFields)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-new-item-alert", { heading: error === null || error === void 0 ? void 0 : error.title, description: error === null || error === void 0 ? void 0 : error.description, link: { href: error === null || error === void 0 ? void 0 : error.link, title: error === null || error === void 0 ? void 0 : error.linkText }, active: !!error, onAlertDismiss: () => (this.error = null) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisNewItemPagesAppendMatchFields.style = arcgisNewItemPagesAppendMatchFieldsCss;



//# sourceMappingURL=arcgis-new-item-pages-append-match-fields.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWE2NjkyMC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMyRDtBQUNKO0FBQ1c7QUFDQzs7QUFFbkUsY0FBYyxNQUE2QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxjQUFjO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGdIQUFnSDtBQUM1SDtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG9EQUFZO0FBQzdDO0FBQ0E7QUFDQSw0QkFBNEIsc0RBQWtCLENBQUMsb0RBQVk7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0EsMEJBQTBCLHVEQUFvQixHQUFHO0FBQ2pELDZFQUE2RTtBQUM3RTtBQUNBO0FBQ0EscUZBQXFGLG1CQUFtQiw4QkFBOEI7QUFDdEk7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBLDBEQUEwRCwwQkFBMEIsb0RBQW9EO0FBQ3hJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QyxvR0FBb0c7QUFDbEssU0FBUyxPQUFPLHFEQUFDLDRCQUE0QixpREFBaUQsK0JBQStCLHFEQUFDLDRCQUE0QiwwSkFBMEoscUlBQXFJLDhEQUE4RDtBQUN2ZjtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQztBQUNBOztBQUU0Rjs7QUFFNUYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcHBlbmQtM2YyNjRkNTYuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXBwZW5kLTRlMTEwMzJjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FwcGVuZC01YmI5NTc2Yy5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtbmV3LWl0ZW0tcGFnZXMtYXBwZW5kLW1hdGNoLWZpZWxkcy5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGEgYXMgYWRkSXRlbVN0YXRlIH0gZnJvbSAnLi9hZGQtaXRlbS1kYmJlMmY1Ny5qcyc7XG5pbXBvcnQgeyBOIGFzIE5PTkVfVkFMVUUgfSBmcm9tICcuL2FwcGVuZC00ZTExMDMyYy5qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEFuYWx5emVkTGF5ZXJJbmZvIH0gZnJvbSAnLi9nZW9jb2RlLTY0ZTBiMGQzLmpzJztcbmltcG9ydCB7IGEgYXMgYWRkQ3JlYXRlSXRlbVR5cGVzIH0gZnJvbSAnLi9pdGVtLXR5cGVzLTIwMjliMDZiLmpzJztcblxudmFyIF9fcmVzdCA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fcmVzdCkgfHwgZnVuY3Rpb24gKHMsIGUpIHtcbiAgICB2YXIgdCA9IHt9O1xuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxuICAgICAgICB0W3BdID0gc1twXTtcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcbiAgICAgICAgfVxuICAgIHJldHVybiB0O1xufTtcbmZ1bmN0aW9uIGNhbk1hdGNoRmllbGQoZmllbGQsIG1hdGNoRmllbGQpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgZmllbGRUeXBlID0gKGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC50eXBlKSB8fCBudWxsO1xuICAgIGNvbnN0IG1hdGNoRmllbGRUeXBlID0gKG1hdGNoRmllbGQgPT09IG51bGwgfHwgbWF0Y2hGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hGaWVsZC50eXBlKSB8fCBudWxsO1xuICAgIGNvbnN0IG1hdGNoRmllbGRzID0ge1xuICAgICAgICBlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyOiBbXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlSW50ZWdlcjogW1wiZXNyaUZpZWxkVHlwZUludGVnZXJcIiwgXCJlc3JpRmllbGRUeXBlU21hbGxJbnRlZ2VyXCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlU2luZ2xlOiBbXCJlc3JpRmllbGRUeXBlU2luZ2xlXCIsIFwiZXNyaUZpZWxkVHlwZURvdWJsZVwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZURvdWJsZTogW1xuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlRG91YmxlXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTaW5nbGVcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZUludGVnZXJcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVNtYWxsSW50ZWdlclwiXG4gICAgICAgIF0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVEYXRlOiBbXCJlc3JpRmllbGRUeXBlRGF0ZVwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZVN0cmluZzogW1xuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlU3RyaW5nXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZUludGVnZXJcIixcbiAgICAgICAgICAgIFwiZXNyaUZpZWxkVHlwZVNpbmdsZVwiLFxuICAgICAgICAgICAgXCJlc3JpRmllbGRUeXBlRG91YmxlXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVEYXRlXCIsXG4gICAgICAgICAgICBcImVzcmlGaWVsZFR5cGVHVUlEXCJcbiAgICAgICAgXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZUdVSUQ6IFtcImVzcmlGaWVsZFR5cGVHVUlEXCIsIFwiZXNyaUZpZWxkVHlwZVN0cmluZ1wiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZU9JRDogW1wiZXNyaUZpZWxkVHlwZU9JRFwiLCBcImVzcmlGaWVsZFR5cGVTbWFsbEludGVnZXJcIiwgXCJlc3JpRmllbGRUeXBlSW50ZWdlclwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZUdsb2JhbElEOiBbXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIiwgXCJlc3JpRmllbGRUeXBlR1VJRFwiLCBcImVzcmlGaWVsZFR5cGVTdHJpbmdcIl0sXG4gICAgICAgIGVzcmlGaWVsZFR5cGVEYXRlT25seTogW1wiZXNyaUZpZWxkVHlwZURhdGVPbmx5XCJdLFxuICAgICAgICBlc3JpRmllbGRUeXBlVGltZU9ubHk6IFtcImVzcmlGaWVsZFR5cGVUaW1lT25seVwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZVRpbWVzdGFtcE9mZnNldDogW1wiZXNyaUZpZWxkVHlwZVRpbWVzdGFtcE9mZnNldFwiXSxcbiAgICAgICAgZXNyaUZpZWxkVHlwZUJpZ0ludGVnZXI6IFtcImVzcmlGaWVsZFR5cGVCaWdJbnRlZ2VyXCJdXG4gICAgfTtcbiAgICByZXR1cm4gbWF0Y2hGaWVsZFR5cGUgJiYgKG1hdGNoRmllbGRUeXBlID09PSBmaWVsZFR5cGUgfHwgKChfYSA9IG1hdGNoRmllbGRzW2ZpZWxkVHlwZV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKG1hdGNoRmllbGRUeXBlKSkgPiAtMSk7XG59XG5mdW5jdGlvbiBnZXRBcHBlbmRQYXJhbWV0ZXJzKGFkZEl0ZW1Qcm9wcykge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB7IHRpbWV6b25lLCBhbmFseXplUmVzdWx0cywgdHlwZSwgZmllbGRNYXBwaW5ncywgZGF0YUxheWVyLCBpZCwgdWlkUGFpciwgYWRkQXBwZW5kU2VsZWN0T3B0aW9uLCBzb3VyY2VEYXRhTGF5ZXIgfSA9IGFkZEl0ZW1Qcm9wcztcbiAgICBsZXQgZmluYWxBcHBlbmRQYXJhbWV0ZXJzLCBhcHBlbmRTb3VyY2VJbmZvO1xuICAgIGNvbnN0IHsgcHVibGlzaFBhcmFtZXRlcnMgfSA9IGFuYWx5emVSZXN1bHRzLCByZXN0ID0gX19yZXN0KGFuYWx5emVSZXN1bHRzLCBbXCJwdWJsaXNoUGFyYW1ldGVyc1wiXSk7XG4gICAgY29uc3QgdXBzZXJ0ID0gYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwc2VydFwiIHx8IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiA9PT0gXCJ1cGRhdGVcIjtcbiAgICBjb25zdCBmaW5hbEZpZWxkTWFwcGluZ3MgPSBmb3JtYXRGaWVsZE1hcHBpbmdzKGZpZWxkTWFwcGluZ3MpO1xuICAgIGNvbnN0IGFwcGVuZEZpZWxkcyA9IGNyZWF0ZUFwcGVuZEZpZWxkcyhmaW5hbEZpZWxkTWFwcGluZ3MpO1xuICAgIGNvbnN0IHRpbWV6b25lSW5mbyA9IHtcbiAgICAgICAgZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U6IHtcbiAgICAgICAgICAgIHRpbWVab25lOiB0aW1lem9uZSB8fCBcIlVUQ1wiLFxuICAgICAgICAgICAgcmVzcGVjdHNEYXlsaWdodFNhdmluZzogdHJ1ZVxuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBkZWZhdWx0QXBwZW5kUGFyYW1zID0ge1xuICAgICAgICBzb3VyY2VUYWJsZU5hbWU6IGRhdGFMYXllci5uYW1lLFxuICAgICAgICBmaWVsZE1hcHBpbmdzOiAoZmluYWxGaWVsZE1hcHBpbmdzID09PSBudWxsIHx8IGZpbmFsRmllbGRNYXBwaW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmluYWxGaWVsZE1hcHBpbmdzLmxlbmd0aCkgPyBKU09OLnN0cmluZ2lmeShmaW5hbEZpZWxkTWFwcGluZ3MpIDogbnVsbCxcbiAgICAgICAgdXBzZXJ0LFxuICAgICAgICBza2lwSW5zZXJ0czogYWRkQXBwZW5kU2VsZWN0T3B0aW9uID09PSBcInVwZGF0ZVwiLFxuICAgICAgICBza2lwVXBkYXRlczogZmFsc2UsXG4gICAgICAgIHVzZUdsb2JhbElkczogdXBzZXJ0ICYmICh1aWRQYWlyID09PSBudWxsIHx8IHVpZFBhaXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpZFBhaXIudHlwZSkgPT09IFwiZXNyaUZpZWxkVHlwZUdsb2JhbElEXCIsXG4gICAgICAgIHVwZGF0ZUdlb21ldHJ5OiB1cHNlcnQgPyBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0VXBkYXRlVHlwZU9wdGlvbiA9PT0gXCJhdHRyaWJ1dGVBbmRHZW9tZXRyeVwiIDogdHJ1ZSxcbiAgICAgICAgYXBwZW5kRmllbGRzOiBhcHBlbmRGaWVsZHMubGVuZ3RoID8gSlNPTi5zdHJpbmdpZnkoYXBwZW5kRmllbGRzKSA6IG51bGwsXG4gICAgICAgIGFwcGVuZEl0ZW1JZDogaWQsXG4gICAgICAgIGFwcGVuZFVwbG9hZEZvcm1hdDogYWRkQ3JlYXRlSXRlbVR5cGVzW2FkZEl0ZW1TdGF0ZS50eXBlXS5hcHBlbmRVcGxvYWRGb3JtYXQsXG4gICAgICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlXG4gICAgfTtcbiAgICBjb25zdCBwdWJsaXNoSW5mbyA9IF9fcmVzdChwdWJsaXNoUGFyYW1ldGVycywgW1wibGF5ZXJzXCJdKTtcbiAgICBpZiAodHlwZSA9PT0gXCJDU1ZcIikge1xuICAgICAgICBwdWJsaXNoUGFyYW1ldGVycy5sYXllckluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2UgPSB0aW1lem9uZUluZm8uZGF0ZUZpZWxkc1RpbWVSZWZlcmVuY2U7XG4gICAgICAgIGFwcGVuZFNvdXJjZUluZm8gPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgcHVibGlzaFBhcmFtZXRlcnMpLCByZXN0KTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZSA9PT0gXCJNaWNyb3NvZnQgRXhjZWxcIikge1xuICAgICAgICBjb25zdCBsYXllckluZm8gPSBnZXRBbmFseXplZExheWVySW5mbyh7fSwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZExheWVySW5mbyA9IGdldExheWVyVG9BcHBlbmQobGF5ZXJJbmZvLCBwdWJsaXNoSW5mbyk7IC8vVXBkYXRlZCBpbmZvIG5lZWRzIHRvIGJlIGFkZGVkIHRvIHRoZSBsYXllcnMgW10gcmF0aGVyIHRoYW4gdGhlIHJvb3QgZm9yIGV4Y2VsXG4gICAgICAgIGZvcm1hdHRlZExheWVySW5mby5kYXRlRmllbGRzVGltZVJlZmVyZW5jZSA9IHRpbWV6b25lSW5mby5kYXRlRmllbGRzVGltZVJlZmVyZW5jZTtcbiAgICAgICAgcHVibGlzaEluZm8ubmFtZSA9IGRhdGFMYXllci5uYW1lO1xuICAgICAgICBhcHBlbmRTb3VyY2VJbmZvID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGltZXpvbmVJbmZvKSwgeyBsYXllcnM6IFtmb3JtYXR0ZWRMYXllckluZm9dIH0pLCBwdWJsaXNoSW5mbyksIHJlc3QpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXBwZW5kU291cmNlSW5mbyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aW1lem9uZUluZm8pLCBwdWJsaXNoUGFyYW1ldGVycyksIHJlc3QpO1xuICAgIH1cbiAgICBmaW5hbEFwcGVuZFBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRBcHBlbmRQYXJhbXMpLCB7IGFwcGVuZFNvdXJjZUluZm86IEpTT04uc3RyaW5naWZ5KGFwcGVuZFNvdXJjZUluZm8pIH0pO1xuICAgIGlmIChhZGRBcHBlbmRTZWxlY3RPcHRpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgZmluYWxBcHBlbmRQYXJhbWV0ZXJzLnVwc2VydE1hdGNoaW5nRmllbGQgPSBzb3VyY2VEYXRhTGF5ZXIub2JqZWN0SWRGaWVsZCB8fCAoKF9hID0gc291cmNlRGF0YUxheWVyLnVuaXF1ZUZpZWxkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAodXBzZXJ0ICYmICh1aWRQYWlyID09PSBudWxsIHx8IHVpZFBhaXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVpZFBhaXIuaXNVbmlxdWVJbmRleCkpIHtcbiAgICAgICAgICAgIGZpbmFsQXBwZW5kUGFyYW1ldGVycy51cHNlcnRNYXRjaGluZ0ZpZWxkID0gdWlkUGFpciA9PT0gbnVsbCB8fCB1aWRQYWlyID09PSB2b2lkIDAgPyB2b2lkIDAgOiB1aWRQYWlyLm5hbWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpbmFsQXBwZW5kUGFyYW1ldGVycztcbn1cbmZ1bmN0aW9uIGdldExheWVyVG9BcHBlbmQobGF5ZXJJbmZvLCB1cGRhdGVkSW5mbykge1xuICAgIGNvbnN0IGZvcm1hdHRlZExheWVyID0gT2JqZWN0LmFzc2lnbih7fSwgbGF5ZXJJbmZvKTtcbiAgICBmb3JtYXR0ZWRMYXllci5sb2NhdGlvblR5cGUgPSB1cGRhdGVkSW5mby5sb2NhdGlvblR5cGU7XG4gICAgaWYgKGZvcm1hdHRlZExheWVyLmxvY2F0aW9uVHlwZSA9PT0gXCJhZGRyZXNzXCIpIHtcbiAgICAgICAgZm9ybWF0dGVkTGF5ZXIuYWRkcmVzc0ZpZWxkcyA9IHVwZGF0ZWRJbmZvLmFkZHJlc3NGaWVsZHM7XG4gICAgICAgIGZvcm1hdHRlZExheWVyLnNvdXJjZUNvdW50cnkgPSB1cGRhdGVkSW5mby5zb3VyY2VDb3VudHJ5O1xuICAgIH1cbiAgICBlbHNlIGlmIChmb3JtYXR0ZWRMYXllci5sb2NhdGlvblR5cGUgPT09IFwiY29vcmRpbmF0ZXNcIikge1xuICAgICAgICBmb3JtYXR0ZWRMYXllci5jb29yZGluYXRlRmllbGRUeXBlID0gdXBkYXRlZEluZm8uY29vcmRpbmF0ZUZpZWxkVHlwZTtcbiAgICAgICAgaWYgKGZvcm1hdHRlZExheWVyLmNvb3JkaW5hdGVGaWVsZFR5cGUgPT09IFwiTGF0aXR1ZGVBbmRMb25naXR1ZGVcIikge1xuICAgICAgICAgICAgZm9ybWF0dGVkTGF5ZXIubGF0aXR1ZGVGaWVsZE5hbWUgPSB1cGRhdGVkSW5mby5sYXRpdHVkZUZpZWxkTmFtZTtcbiAgICAgICAgICAgIGZvcm1hdHRlZExheWVyLmxvbmdpdHVkZUZpZWxkTmFtZSA9IHVwZGF0ZWRJbmZvLmxvbmdpdHVkZUZpZWxkTmFtZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvcm1hdHRlZExheWVyLmNvb3JkaW5hdGVGaWVsZE5hbWUgPSB1cGRhdGVkSW5mby5jb29yZGluYXRlRmllbGROYW1lO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXR0ZWRMYXllcjtcbn1cbmZ1bmN0aW9uIGZvcm1hdEZpZWxkTWFwcGluZ3MoZmllbGRNYXBwaW5ncykge1xuICAgIGNvbnN0IGZpZWxkcyA9IGZpZWxkTWFwcGluZ3MuZmlsdGVyKChmaWVsZE1hcHBpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpZWxkTWFwcGluZy5zb3VyY2UgIT09IE5PTkVfVkFMVUU7XG4gICAgfSk7XG4gICAgY29uc3QgZmluYWxGaWVsZE1hcHBpbmdzID0gZmllbGRzLm1hcCgoeyBzb3VyY2UsIG5hbWUgfSkgPT4ge1xuICAgICAgICByZXR1cm4geyBzb3VyY2UsIG5hbWUgfTtcbiAgICB9KTtcbiAgICByZXR1cm4gZmluYWxGaWVsZE1hcHBpbmdzO1xufVxuZnVuY3Rpb24gY3JlYXRlQXBwZW5kRmllbGRzKGZpZWxkTWFwcGluZ3MpIHtcbiAgICBjb25zdCBhcHBlbmRGaWVsZHMgPSBmaWVsZE1hcHBpbmdzLm1hcCgobWFwcGluZykgPT4ge1xuICAgICAgICByZXR1cm4gbWFwcGluZy5uYW1lO1xuICAgIH0pO1xuICAgIHJldHVybiBhcHBlbmRGaWVsZHM7XG59XG5cbmV4cG9ydCB7IGNhbk1hdGNoRmllbGQgYXMgYywgZ2V0QXBwZW5kUGFyYW1ldGVycyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGVuZC0zZjI2NGQ1Ni5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmNvbnN0IHVpZEZpZWxkcyA9IFtcImVzcmlGaWVsZFR5cGVPSURcIiwgXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIl07XG5jb25zdCBOT05FX1ZBTFVFID0gXCI8Tm9uZT5cIjtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyA9IHtcbiAgICBcImZpbGUgZ2VvZGF0YWJhc2VcIjogXCJmaWxlZ2VvZGF0YWJhc2VcIixcbiAgICBzaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgZ2VvanNvbjogXCJnZW9qc29uXCIsXG4gICAgY3N2OiBcIkNTVlwiLFxuICAgIFwibWljcm9zb2Z0IGV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBnZW9wYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IGFwcGVuZEZpbGVUeXBlcyA9IHtcbiAgICBTaGFwZWZpbGU6IFwic2hhcGVmaWxlXCIsXG4gICAgXCJGaWxlIEdlb2RhdGFiYXNlXCI6IFwiZmlsZUdlb2RhdGFiYXNlXCIsXG4gICAgQ1NWOiBcImNzdlwiLFxuICAgIFwiTWljcm9zb2Z0IEV4Y2VsXCI6IFwiZXhjZWxcIixcbiAgICBHZW9Kc29uOiBcImdlb2pzb25cIixcbiAgICBHZW9QYWNrYWdlOiBcImdlb1BhY2thZ2VcIlxufTtcbmNvbnN0IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzID0ge1xuICAgIGNzdjogXCJDU1ZcIixcbiAgICBleGNlbDogXCJNaWNyb3NvZnQgRXhjZWxcIixcbiAgICBzaGFwZWZpbGU6IFwiU2hhcGVmaWxlXCIsXG4gICAgZmdkYjogXCJGaWxlIEdlb2RhdGFiYXNlXCIsXG4gICAgZ2VvanNvbjogXCJHZW9Kc29uXCIsXG4gICAgZ29vZ2xlc2hlZXRzOiBcIk1pY3Jvc29mdCBFeGNlbFwiXG59O1xuY29uc3QgYXBwZW5kRXh0ZW5zaW9ucyA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIiwgXCJnZW9qc29uXCIsIFwiZ3BrZ1wiLCBcImpzb25cIl07XG5jb25zdCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSA9IFtcInppcFwiLCBcImNzdlwiLCBcInhsc1wiLCBcInhsc3hcIl07XG5cbmV4cG9ydCB7IEFwcGVuZE92ZXJ3cml0ZUNsb3VkUHVibGlzaFR5cGVzIGFzIEEsIE5PTkVfVkFMVUUgYXMgTiwgYXBwZW5kRmlsZVR5cGVzIGFzIGEsIEFwcGVuZE92ZXJ3cml0ZVB1Ymxpc2hUeXBlcyBhcyBiLCBhcHBlbmRFeHRlbnNpb25zRm9yRW50ZXJwcmlzZSBhcyBjLCBhcHBlbmRFeHRlbnNpb25zIGFzIGQsIHVpZEZpZWxkcyBhcyB1IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGVuZC00ZTExMDMyYy5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVxdWVzdCB9IGZyb20gJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0QXBwZW5kUGFyYW1ldGVycyB9IGZyb20gJy4vYXBwZW5kLTNmMjY0ZDU2LmpzJztcbmltcG9ydCB7IHggYXMgZ2V0SXRlbVN0YXR1cyB9IGZyb20gJy4vZmVhdHVyZS1sYXllci01NzNiYjQ3My5qcyc7XG5cbmFzeW5jIGZ1bmN0aW9uIGFwcGVuZChhZGRJdGVtUHJvcHMpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYXBwZW5kUGFyYW1ldGVycyA9IGdldEFwcGVuZFBhcmFtZXRlcnMoYWRkSXRlbVByb3BzKTtcbiAgICBjb25zdCBzZXJ2aWNlVXJsID0gKF9hID0gYWRkSXRlbVByb3BzLmV4aXN0aW5nSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVybDtcbiAgICBjb25zdCBhcHBlbmRVcmwgPSBgJHtzZXJ2aWNlVXJsfS8ke2FkZEl0ZW1Qcm9wcy5zb3VyY2VEYXRhTGF5ZXIuaWR9L2FwcGVuZGA7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYXBwZW5kUmVzcG9uc2UgPSAoYXdhaXQgcmVxdWVzdChhcHBlbmRVcmwsIGFwcGVuZFBhcmFtZXRlcnMsIHt9LCBcInBvc3RcIikpO1xuICAgICAgICBjb25zdCB7IHN0YXR1cywgcmVjb3JkQ291bnQgfSA9IGF3YWl0IGdldEl0ZW1TdGF0dXMoYWRkSXRlbVByb3BzLmlkLCB7fSwgYXBwZW5kUmVzcG9uc2UgPT09IG51bGwgfHwgYXBwZW5kUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFwcGVuZFJlc3BvbnNlLnN0YXR1c1VybCk7XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogeyBzdGF0dXMsIHJlY29yZENvdW50IH0gfTtcbiAgICB9XG4gICAgY2F0Y2ggKHsgZXJyb3IgfSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHsgY29kZTogXCJ1bmhhbmRsZWRFcnJvclwiLCBtZXNzYWdlOiBKU09OLnN0cmluZ2lmeShlcnJvcikgfSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgYXBwZW5kIGFzIGEgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwZW5kLTViYjk1NzZjLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRJdGVtU3RhdGUgfSBmcm9tICcuL2FkZC1pdGVtLWRiYmUyZjU3LmpzJztcbmltcG9ydCB7IE4gYXMgTk9ORV9WQUxVRSB9IGZyb20gJy4vYXBwZW5kLTRlMTEwMzJjLmpzJztcbmltcG9ydCB7IHUgYXMgdWlTdG9yZVN0YXRlIH0gZnJvbSAnLi91aS1iY2E3YmNkMS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNhbk1hdGNoRmllbGQgfSBmcm9tICcuL2FwcGVuZC0zZjI2NGQ1Ni5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlbGV0ZUl0ZW0gfSBmcm9tICcuL3NlcnZlci1pdGVtLThkMzg0Nzk2LmpzJztcbmltcG9ydCB7IGEgYXMgYXBwZW5kIH0gZnJvbSAnLi9hcHBlbmQtNWJiOTU3NmMuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcbmltcG9ydCAnLi9nZW9jb2RlLTY0ZTBiMGQzLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9wcml2aWxlZ2VzLTVjMzgyZjYxLmpzJztcbmltcG9ydCAnLi9pdGVtLTM1MzU1NTJkLmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL3ByaXZpbGVnZXMtNzQ2MzlkYWUuanMnO1xuaW1wb3J0ICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgJy4vaXRlbS10eXBlcy0yMDI5YjA2Yi5qcyc7XG5pbXBvcnQgJy4vaXRlbS1wcm9wZXJ0aWVzLTEwNDkxYjJlLmpzJztcbmltcG9ydCAnLi9mdW5jdGlvbmFsLTgxMzczZjZkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTU3M2JiNDczLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTc5ZmIzMDJjLmpzJztcbmltcG9ydCAnLi9ndWlkLWFlYWVkODRkLmpzJztcbmltcG9ydCAnLi90aHVtYm5haWwtYmNiODllNjkuanMnO1xuaW1wb3J0ICcuL3NlcnZpY2UtOGMyYzQyNDEuanMnO1xuaW1wb3J0ICcuL3VzZXItM2VhNjljM2EuanMnO1xuaW1wb3J0ICcuL3F1ZXJ5LWQ2MjY2MGQ0LmpzJztcbmltcG9ydCAnLi9hcGktMmUzYTEzNmYuanMnO1xuaW1wb3J0ICcuL3N0cmluZy01OGE1ZmVmMy5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pdGVtLWM1OGZmY2VkLmpzJztcbmltcG9ydCAnLi9mZWF0dXJlLWxheWVyLTE3YjY0OTQ2LmpzJztcbmltcG9ydCAnLi9hZ3MtZWI0NThhMDMuanMnO1xuaW1wb3J0ICcuL3VybC0zNTg3NWExMC5qcyc7XG5pbXBvcnQgJy4vc3RvcmFnZS0wMzUzYTc2OS5qcyc7XG5pbXBvcnQgJy4vZmlsZS1iZjhhYjkwZi5qcyc7XG5pbXBvcnQgJy4vc3RvcmUtNmE4OGU2YzUuanMnO1xuXG5jb25zdCBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRNYXRjaEZpZWxkc0NzcyA9IFwiLmZpZWxkcy1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDAlO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtvdmVyZmxvdy15OmF1dG87b3ZlcmZsb3cteDpoaWRkZW59LmZpZWxkLXRhYmxle21hcmdpbi1ib3R0b206MS41cmVtO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3c6YXV0b30uc2VhcmNoLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJX0uZmllbGQtc2VhcmNoe21hcmdpbi1yaWdodDowLjVyZW07d2lkdGg6NTAlfS5maWVsZC1zZWxlY3R7d2lkdGg6NTAlfS5maWVsZC1uYW1lLWNvbHVtbnttYXJnaW4tcmlnaHQ6MC41cmVtO3dpZHRoOjUwJX0ubWF0Y2gtZmllbGQtbmFtZS1jb2x1bW57d2lkdGg6NTAlfS5maWVsZHMtc2Nyb2xsLWNvbnRhaW5lcnttYXJnaW4tYm90dG9tOjAuNzVyZW07ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtwYWRkaW5nLWJvdHRvbTowLjc1cmVtO2JvcmRlci1ib3R0b206MC4xMjVyZW0gc29saWQgdmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTMpfS5oZWFkZXItcm93e2Rpc3BsYXk6ZmxleDthbGlnbi1jb250ZW50OmZsZXgtc3RhcnQ7anVzdGlmeS1jb250ZW50OmNlbnRlcjtnYXA6MC4yNXJlbTtwYWRkaW5nOjAuMjVyZW07Zm9udC1zaXplOjAuODc1cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLXRleHQtMSl9LmhlYWRlci1jZWxse2Rpc3BsYXk6ZmxleDt3aWR0aDoxMDAlO2ZvbnQtc2l6ZToxcmVtfS5oaWRle2Rpc3BsYXk6bm9uZX0ubm90LXZpc2libGV7dmlzaWJpbGl0eTpoaWRkZW47aGVpZ2h0OjBweH0uY2VsbHtib3gtc2l6aW5nOmJvcmRlci1ib3g7d2lkdGg6MTAwJX0uY2VsbCBsYWJlbHttYXJnaW4tdG9wOjAuNzVyZW19LnJvd3ttYXJnaW4tYm90dG9tOjAuNzVyZW07ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtnYXA6MC4yNXJlbTtwYWRkaW5nOjAuMjVyZW07Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKTtib3JkZXItYm90dG9tOjAuMTI1cmVtIHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0zKX0uZGVzZWxlY3RlZHtvcGFjaXR5OnZhcigtLWNhbGNpdGUtdWktb3BhY2l0eS1kaXNhYmxlZCl9LnNjcmVlbi1yZWFkZXJzLW9ubHl7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MXB4O2hlaWdodDoxcHg7cGFkZGluZzowO21hcmdpbjotMXB4O292ZXJmbG93OmhpZGRlbjtjbGlwOnJlY3QoMCwgMCwgMCwgMCk7d2hpdGUtc3BhY2U6bm93cmFwO2JvcmRlci13aWR0aDowfS5sYWJlbHstLWNhbGNpdGUtbGFiZWwtbWFyZ2luLWJvdHRvbTowfS5hcHBlbmQtdGltZXpvbmV7Ym9yZGVyLXRvcDowLjA2M3JlbSBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMyl9LmZyb20tdG8tZmllbGRze2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpyb3d9LmRlc2NyaXB0aW9ue21hcmdpbi1ib3R0b206MXJlbTtmb250LXNpemU6MC44NzVyZW07Zm9udC13ZWlnaHQ6MzAwfS5oZWFkZXJ7bWFyZ2luLWJvdHRvbTowLjVyZW07Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NTAwO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0xKX0ubm8tZmllbGRze21hcmdpbi1ib3R0b206MS41cmVtfS5wb3BvdmVyLWljb257Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci10ZXh0LTMpO21hcmdpbi1pbmxpbmUtc3RhcnQ6MC43NXJlbTttYXJnaW4tdG9wOjAuMTI1cmVtfS5wb3BvdmVyLWNvbnRlbnR7bWFyZ2luOjBweDtmb250LXNpemU6MC43NXJlbTtmb250LXdlaWdodDo0MDB9LmhlYWRlci1wb3BvdmVye21hcmdpbi10b3A6LTAuMzEzcmVtfVwiO1xuXG5jb25zdCBBcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRNYXRjaEZpZWxkcyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubmV3SXRlbVVwZGF0ZVBhZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1VcGRhdGVQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibmV3SXRlbVByZXZQYWdlXCIsIDcpO1xuICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcIndvcmtmbG93Q29tcGxldGVcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbVRvZ2dsZU5hdmlnYXRpb25FbmFibGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJuZXdJdGVtVG9nZ2xlTmF2aWdhdGlvbkVuYWJsZWRcIiwgNyk7XG4gICAgICAgIHRoaXMubmV3SXRlbURpc2FibGVDbG9zZUJ1dHRvbnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcIm5ld0l0ZW1EaXNhYmxlQ2xvc2VCdXR0b25zXCIsIDcpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlZEZpZWxkcyA9IFtdO1xuICAgICAgICB0aGlzLmZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pMThuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpZWxkTWF0Y2hlcyA9IFtdO1xuICAgICAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkZXJUeXBlID0gXCJpbmRldGVybWluYXRlXCI7XG4gICAgICAgIHRoaXMubG9hZGVyTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaGFuZGxlTmV4dCgpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdDb21wbGV0aW9uRXJyb3IgPSB0aGlzLnZhbGlkYXRlTWF0Y2hpbmdzKCk7XG4gICAgICAgIGlmIChtYXRjaGluZ0NvbXBsZXRpb25FcnJvcikge1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IG1hdGNoaW5nQ29tcGxldGlvbkVycm9yO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFkZEl0ZW1TdGF0ZS5maWVsZE1hcHBpbmdzID0gdGhpcy5maWVsZE1hdGNoZXM7XG4gICAgICAgIGlmICh0aGlzLmFwcGVuZFNlbGVjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVBcHBlbmQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5ld0l0ZW1VcGRhdGVQYWdlLmVtaXQoXCJhcHBlbmRTZWxlY3RVcGRhdGVcIik7XG4gICAgfVxuICAgIHZhbGlkYXRlTWF0Y2hpbmdzKCkge1xuICAgICAgICAvL3JldHVybiBhbiBlcnJvclxuICAgICAgICBjb25zdCBub01hdGNoZXMgPSB0aGlzLmZpZWxkTWF0Y2hlcy5ldmVyeSgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBmaWVsZC5zb3VyY2UgPT09IE5PTkVfVkFMVUU7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBpbnNlcnROb25OdWxsYWJsZSA9IHRoaXMuZmllbGRNYXRjaGVzLnNvbWUoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQuZGVmYXVsdFZhbHVlICYmICFmaWVsZC5pc1VuaXF1ZUluZGV4ICYmICFmaWVsZC5udWxsYWJsZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghbm9NYXRjaGVzKSB7XG4gICAgICAgICAgICBjb25zdCBub25OdWxsYWJsZUZpZWxkc0xlbmd0aCA9IHRoaXMuZmllbGRNYXRjaGVzLmZpbHRlcigoZmllbGQpID0+ICFmaWVsZC5kaXNhYmxlZCAmJiAhZmllbGQubnVsbGFibGUgJiYgZmllbGQuc291cmNlID09PSBOT05FX1ZBTFVFKS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAobm9uTnVsbGFibGVGaWVsZHNMZW5ndGggPD0gMCB8fCB0aGlzLmFwcGVuZFNlbGVjdGlvbiA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGluc2VydE5vbk51bGxhYmxlICYmIHRoaXMuYXBwZW5kU2VsZWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmkxOG4uZXJyb3JzLm5vbk51bGxhYmxlRXJyb3JUaXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5pMThuLmVycm9ycy5ub25OdWxsYWJsZUVycm9yRGVzY3JpcHRpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgdGl0bGU6IHRoaXMuZXJyb3JMYWJlbCwgZGVzY3JpcHRpb246IHRoaXMuaTE4bi5lcnJvcnMubm9NYXRjaGVkRmllbGRzIH07XG4gICAgfVxuICAgIGRpc2FibGVNb2RhbEJ1dHRvbnMoZGlzYWJsZSkge1xuICAgICAgICB0aGlzLm5ld0l0ZW1Ub2dnbGVOYXZpZ2F0aW9uRW5hYmxlZC5lbWl0KCFkaXNhYmxlKTtcbiAgICAgICAgdGhpcy5uZXdJdGVtRGlzYWJsZUNsb3NlQnV0dG9ucy5lbWl0KGRpc2FibGUpO1xuICAgIH1cbiAgICBhc3luYyBoYW5kbGVBcHBlbmQoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGNvbnN0IHsgc291cmNlRGF0YUxheWVyLCBleGlzdGluZ0l0ZW0sIHRpbWV6b25lLCBhbmFseXplUmVzdWx0cywgdHlwZSwgZmllbGRNYXBwaW5ncywgZGF0YUxheWVyLCBpZCwgdWlkUGFpciwgYWRkQXBwZW5kU2VsZWN0T3B0aW9uIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIHRoaXMuZGlzYWJsZU1vZGFsQnV0dG9ucyh0cnVlKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkZXJNZXNzYWdlID0gdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZExvYWRpbmdNZXNzYWdlcy5hcHBlbmRDbG9zZU5vdGljZTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcHBlbmQoe1xuICAgICAgICAgICAgc291cmNlRGF0YUxheWVyLFxuICAgICAgICAgICAgZXhpc3RpbmdJdGVtLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBhbmFseXplUmVzdWx0cyxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBmaWVsZE1hcHBpbmdzLFxuICAgICAgICAgICAgZGF0YUxheWVyLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB1aWRQYWlyLFxuICAgICAgICAgICAgYWRkQXBwZW5kU2VsZWN0T3B0aW9uXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoKChfYiA9IChfYSA9IHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS5yZXN1bHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0dXMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b0xvd2VyQ2FzZSgpKSA9PT0gXCJjb21wbGV0ZWRcIikge1xuICAgICAgICAgICAgYXdhaXQgZGVsZXRlSXRlbShhZGRJdGVtU3RhdGUuaWQsIHsgcGVybWFuZW50RGVsZXRlOiB0cnVlIH0pO1xuICAgICAgICAgICAgY29uc3QgZW1pdFBheWxvYWQgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgICAgICAvLyBgcHVibGlzaFJlc3BvbnNlYCBkb2Vzbid0IGZvciBzb21lIGZsb3dzIHNvIHVzZSB0aGlzIGlkIGluc3RlYWRcbiAgICAgICAgICAgICAgICBhcHBlbmRUeXBlOiBhZGRJdGVtU3RhdGUuYWRkQXBwZW5kU2VsZWN0T3B0aW9uXG4gICAgICAgICAgICB9LCByZXNwb25zZSk7XG4gICAgICAgICAgICB0aGlzLndvcmtmbG93Q29tcGxldGUuZW1pdChlbWl0UGF5bG9hZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRpc2FibGVNb2RhbEJ1dHRvbnMoZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB1aVN0b3JlU3RhdGUuaTE4bi5lcnJvcixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdWlTdG9yZVN0YXRlLmkxOG4uYXBwZW5kLmFwcGVuZEVycm9yTWVzc2FnZXMuYXBwZW5kRXJyb3JcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgaGFuZGxlUHJldihldmVudCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwiYWRkXCIgJiZcbiAgICAgICAgICAgICEoKChfYSA9IGFkZEl0ZW1TdGF0ZS5hbmFseXplUmVzdWx0cy5wdWJsaXNoUGFyYW1ldGVycy5sYXllcnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMSkpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLm5ld0l0ZW1QcmV2UGFnZS5lbWl0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlRmllbGRDaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgbmV3RmllbGRNYXBwaW5nID0gT2JqZWN0LmFzc2lnbih7fSwgZXZlbnQuZGV0YWlsKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkTWFwcGluZ3ModGhpcy52YWxpZGF0ZWRGaWVsZHMsIG5ld0ZpZWxkTWFwcGluZyk7XG4gICAgfVxuICAgIHNvcnRGaWVsZHMoKSB7XG4gICAgICAgIHRoaXMuZmllbGRNYXRjaGVzID0gdGhpcy5maWVsZE1hdGNoZXMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgY29uc3QgbmFtZUEgPSBhLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVCID0gYi5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hbWVBID4gbmFtZUIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdmFsaWRhdGVGaWVsZE1hcHBpbmdzKGN1cnJlbnRGaWVsZE1hcHBpbmdzLCBuZXdGaWVsZE1hcHBpbmcpIHtcbiAgICAgICAgbmV3RmllbGRNYXBwaW5nLmluaXRpYWxNYXRjaCA9IG5ld0ZpZWxkTWFwcGluZy5zb3VyY2U7XG4gICAgICAgIGlmIChuZXdGaWVsZE1hcHBpbmcuc291cmNlICE9PSB0aGlzLm5vbmVTdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IGR1cGxpY2F0ZSA9IGN1cnJlbnRGaWVsZE1hcHBpbmdzLmZpbHRlcigobWFwcGluZykgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLnNvdXJjZSA9PT0gbmV3RmllbGRNYXBwaW5nLnNvdXJjZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKChkdXBsaWNhdGUgPT09IG51bGwgfHwgZHVwbGljYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkdXBsaWNhdGUubGVuZ3RoKSA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkdXBsaWNhdGVJbmRleCA9IGR1cGxpY2F0ZVswXS5pZHg7XG4gICAgICAgICAgICAgICAgY3VycmVudEZpZWxkTWFwcGluZ3NbZHVwbGljYXRlSW5kZXhdLmluaXRpYWxNYXRjaCA9IHRoaXMubm9uZVN0cmluZztcbiAgICAgICAgICAgICAgICBjdXJyZW50RmllbGRNYXBwaW5nc1tkdXBsaWNhdGVJbmRleF0uc291cmNlID0gdGhpcy5ub25lU3RyaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRGaWVsZE1hcHBpbmdzW25ld0ZpZWxkTWFwcGluZy5pZHhdID0gbmV3RmllbGRNYXBwaW5nO1xuICAgICAgICB0aGlzLnZhbGlkYXRlZEZpZWxkcyA9IGN1cnJlbnRGaWVsZE1hcHBpbmdzO1xuICAgICAgICB0aGlzLmZpZWxkTWF0Y2hlcyA9IFsuLi50aGlzLnZhbGlkYXRlZEZpZWxkc107XG4gICAgICAgIHRoaXMuc29ydEZpZWxkcygpO1xuICAgIH1cbiAgICBzZXROZXh0VGV4dCgpIHtcbiAgICAgICAgdWlTdG9yZVN0YXRlLm5leHRUZXh0ID1cbiAgICAgICAgICAgIHRoaXMuYXBwZW5kU2VsZWN0aW9uID09PSBcImFkZFwiID8gXCJhZGRBbmRDb21wbGV0ZVwiIDogXCJuZXh0XCI7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCB7IGFkZEFwcGVuZFNlbGVjdE9wdGlvbiwgdWlkUGFpciwgc291cmNlRGF0YUxheWVyLCBiYWNrdXBMYXllckZpZWxkcyB9ID0gYWRkSXRlbVN0YXRlO1xuICAgICAgICB0aGlzLmkxOG4gPSB1aVN0b3JlU3RhdGUuaTE4bi5hcHBlbmRNYXRjaEZpZWxkcztcbiAgICAgICAgdGhpcy5lcnJvckxhYmVsID0gdWlTdG9yZVN0YXRlLmkxOG4uZXJyb3I7XG4gICAgICAgIHRoaXMubm9uZVN0cmluZyA9IHVpU3RvcmVTdGF0ZS5pMThuLmFwcGVuZEtleVZhbHVlUGFpci5ub25lRmllbGQ7XG4gICAgICAgIHRoaXMuYXBwZW5kU2VsZWN0aW9uID0gYWRkQXBwZW5kU2VsZWN0T3B0aW9uO1xuICAgICAgICBjb25zdCBkYXRhTGF5ZXJGaWVsZHMgPSBiYWNrdXBMYXllckZpZWxkcztcbiAgICAgICAgY29uc3Qgc2VydmljZUxheWVyRmllbGRzID0gc291cmNlRGF0YUxheWVyLnR5cGUgPT09IFwiY3N2XCIgPyBbc291cmNlRGF0YUxheWVyLmxheWVySW5mb10gOiBzb3VyY2VEYXRhTGF5ZXIuZmllbGRzO1xuICAgICAgICBjb25zdCB1cGRhdGVFeGlzdGluZ0ZlYXR1cmVzID0gdGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwidXBzZXJ0XCIgfHwgdGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwidXBkYXRlXCI7XG4gICAgICAgIHRoaXMuc2V0TmV4dFRleHQoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEtleVBhaXIgPSB1aWRQYWlyO1xuICAgICAgICBsZXQgZmllbGRzTGlzdEluZGV4ID0gdGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwiYWRkXCIgPyAwIDogMTtcbiAgICAgICAgc2VydmljZUxheWVyRmllbGRzLmZvckVhY2goKGxheWVySW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKChsYXllckluZm8gPT09IG51bGwgfHwgbGF5ZXJJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllckluZm8udHlwZSkgIT09IFwiZXNyaUZpZWxkVHlwZU9JRFwiICYmXG4gICAgICAgICAgICAgICAgKGxheWVySW5mbyA9PT0gbnVsbCB8fCBsYXllckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGxheWVySW5mby50eXBlKSAhPT0gXCJlc3JpRmllbGRUeXBlR2xvYmFsSURcIiAmJlxuICAgICAgICAgICAgICAgIGxheWVySW5mby5lZGl0YWJsZSAmJiAoIXVwZGF0ZUV4aXN0aW5nRmVhdHVyZXMgfHwgbGF5ZXJJbmZvLm5hbWUgIT09IHRoaXMuc2VsZWN0ZWRLZXlQYWlyLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgLy9tYXRjaCBmaWVsZHMgdGhhdCBhcmUgbm90IHVpZFxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRNYXRjaGVzLnB1c2godGhpcy5jcmVhdGVGaWVsZE1hcHBpbmcobGF5ZXJJbmZvLCBkYXRhTGF5ZXJGaWVsZHMsIGZpZWxkc0xpc3RJbmRleCkpO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVkRmllbGRzLnB1c2godGhpcy5jcmVhdGVGaWVsZE1hcHBpbmcobGF5ZXJJbmZvLCBkYXRhTGF5ZXJGaWVsZHMsIGZpZWxkc0xpc3RJbmRleCkpO1xuICAgICAgICAgICAgICAgIGZpZWxkc0xpc3RJbmRleCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kU2VsZWN0aW9uICE9PSBcImFkZFwiKSB7XG4gICAgICAgICAgICB0aGlzLmZpZWxkTWF0Y2hlcy51bnNoaWZ0KHRoaXMuc2VsZWN0ZWRLZXlQYWlyKTtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVkRmllbGRzLnVuc2hpZnQodGhpcy5zZWxlY3RlZEtleVBhaXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc29ydEZpZWxkcygpO1xuICAgIH1cbiAgICBjcmVhdGVGaWVsZE1hcHBpbmcoc2VydmljZUxheWVyRmllbGQsIGRhdGFMYXllckZpZWxkcywgc2VydmljZUxheWVySW5kZXgpIHtcbiAgICAgICAgY29uc3QgYWRkcmVzc0ZpZWxkcyA9IGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkc1xuICAgICAgICAgICAgPyBPYmplY3QudmFsdWVzKGFkZEl0ZW1TdGF0ZS5kYXRhTGF5ZXIuYWRkcmVzc0ZpZWxkcylcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgbGV0IG1hdGNoZWQgPSB0aGlzLm5vbmVTdHJpbmc7XG4gICAgICAgIGNvbnN0IHBvc3NpYmxlTWF0Y2hlcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMubm9uZVN0cmluZyxcbiAgICAgICAgICAgICAgICBuYW1lOiBzZXJ2aWNlTGF5ZXJGaWVsZC5uYW1lLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiTm9uZVwiLFxuICAgICAgICAgICAgICAgIGlkeDogc2VydmljZUxheWVySW5kZXhcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgZGF0YUxheWVyRmllbGRzLmZvckVhY2goKGZpZWxkSW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbk1hdGNoRmllbGQoc2VydmljZUxheWVyRmllbGQsIGZpZWxkSW5mbykgJiZcbiAgICAgICAgICAgICAgICAodGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwiYWRkXCJcbiAgICAgICAgICAgICAgICAgICAgPyB0cnVlXG4gICAgICAgICAgICAgICAgICAgIDogZmllbGRJbmZvLm5hbWUgIT09IHRoaXMuc2VsZWN0ZWRLZXlQYWlyLnNvdXJjZSkpIHtcbiAgICAgICAgICAgICAgICBwb3NzaWJsZU1hdGNoZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogZmllbGRJbmZvLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlcnZpY2VMYXllckZpZWxkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHNlcnZpY2VMYXllckZpZWxkLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGlkeDogc2VydmljZUxheWVySW5kZXhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoc2VydmljZUxheWVyRmllbGQubmFtZS50b0xvd2VyQ2FzZSgpID09PSBmaWVsZEluZm8ubmFtZS50b0xvd2VyQ2FzZSgpICYmXG4gICAgICAgICAgICAgICAgICAgIChzZXJ2aWNlTGF5ZXJGaWVsZC50eXBlID09PSBmaWVsZEluZm8udHlwZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgISEoYWRkcmVzc0ZpZWxkcyA9PT0gbnVsbCB8fCBhZGRyZXNzRmllbGRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhZGRyZXNzRmllbGRzLmZpbmQoKGZpZWxkKSA9PiBmaWVsZCA9PT0gZmllbGRJbmZvLmRpc3BsYXlOYW1lIHx8IGZpZWxkID09PSBmaWVsZEluZm8ubmFtZSkpKSAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy5hcHBlbmRTZWxlY3Rpb24gPT09IFwiYWRkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBmaWVsZEluZm8ubmFtZSAhPT0gdGhpcy5zZWxlY3RlZEtleVBhaXIuc291cmNlKSkge1xuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkID0gZmllbGRJbmZvLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNvdXJjZTogbWF0Y2hlZCxcbiAgICAgICAgICAgIG5hbWU6IHNlcnZpY2VMYXllckZpZWxkLm5hbWUsXG4gICAgICAgICAgICBudWxsYWJsZTogc2VydmljZUxheWVyRmllbGQubnVsbGFibGUsXG4gICAgICAgICAgICB0eXBlOiBzZXJ2aWNlTGF5ZXJGaWVsZC50eXBlLFxuICAgICAgICAgICAgaWR4OiBzZXJ2aWNlTGF5ZXJJbmRleCxcbiAgICAgICAgICAgIGlzVW5pcXVlSW5kZXg6IHNlcnZpY2VMYXllckZpZWxkLmlzVW5pcXVlSW5kZXgsXG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU6IHNlcnZpY2VMYXllckZpZWxkLmRlZmF1bHRWYWx1ZSxcbiAgICAgICAgICAgIGluaXRpYWxNYXRjaDogbWF0Y2hlZCxcbiAgICAgICAgICAgIHBvc3NpYmxlTWF0Y2hlc1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgaTE4biwgZXJyb3IgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgb3JpZ2luYWxGaWxlTmFtZSwgZXhpc3RpbmdJdGVtIH0gPSBhZGRJdGVtU3RhdGU7XG4gICAgICAgIGNvbnN0IHJvd0hlYWRlckluZm8gPSB7XG4gICAgICAgICAgICBvcmlnaW5hbEZpZWxkOiB7XG4gICAgICAgICAgICAgICAgaGVhZGVyOiBpMThuLm9yaWdpbmFsRmllbGQuaGVhZGVyLFxuICAgICAgICAgICAgICAgIG1vcmVJbmZvOiBpMThuLm9yaWdpbmFsRmllbGQubW9yZUluZm8ucmVwbGFjZShcIiR7ZmVhdHVyZUxheWVyTmFtZX1cIiwgZXhpc3RpbmdJdGVtLnRpdGxlKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZGVkRmllbGQ6IHtcbiAgICAgICAgICAgICAgICBoZWFkZXI6IGkxOG4udXBsb2FkZWRGaWVsZC5oZWFkZXIsXG4gICAgICAgICAgICAgICAgbW9yZUluZm86IGkxOG4udXBsb2FkZWRGaWVsZC5tb3JlSW5mby5yZXBsYWNlKFwiJHt1cGxvYWRlZEZpbGVOYW1lfVwiLCBvcmlnaW5hbEZpbGVOYW1lKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGkxOG4uZGVzY3JpcHRpb25cbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJHt1cGxvYWRlZEZpbGVOYW1lfVwiLCBvcmlnaW5hbEZpbGVOYW1lKVxuICAgICAgICAgICAgLnJlcGxhY2UoXCIke2ZlYXR1cmVMYXllck5hbWV9XCIsIGV4aXN0aW5nSXRlbS50aXRsZSk7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiB7IFwib3ZlcmZsb3ctaGlkZGVuXCI6IHRoaXMubG9hZGluZyB9IH0sIGgoXCJhcmNnaXMtbmV3LWl0ZW0tbG9hZGVyXCIsIHsgdHlwZTogdGhpcy5sb2FkZXJUeXBlLCBhY3RpdmU6IHRoaXMubG9hZGluZywgdGV4dDogdGhpcy5sb2FkZXJNZXNzYWdlIH0pLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiaGVhZGVyXCIgfSwgXCIgXCIsIGkxOG4uaGVhZGVyLCBcIiBcIiksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJkZXNjcmlwdGlvblwiIH0sIGRlc2NyaXB0aW9uKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInJvd1wiLCByb2xlOiBcInJvd1wiIH0sIE9iamVjdC5rZXlzKHJvd0hlYWRlckluZm8pLm1hcCgocm93SGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGhlYWRlciwgbW9yZUluZm8gfSA9IHJvd0hlYWRlckluZm9bcm93SGVhZGVyXTtcbiAgICAgICAgICAgIHJldHVybiAoaChcInNwYW5cIiwgeyBjbGFzczogXCJoZWFkZXItY2VsbFwiLCByb2xlOiBcImNvbHVtbmhlYWRlclwiLCBcImFyaWEtc29ydFwiOiBcIm5vbmVcIiB9LCBoZWFkZXIsIGgoXCJhcmNnaXMtaW5mb3JtYXRpb25cIiwgeyBjbGFzczogXCJoZWFkZXItcG9wb3ZlclwiLCBsYWJlbDogbW9yZUluZm8sIHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgcGFkZGVkQ29udGVudDogdHJ1ZSB9LCBoKFwicFwiLCB7IGNsYXNzOiBcInBvcG92ZXItY29udGVudFwiIH0sIG1vcmVJbmZvKSkpKTtcbiAgICAgICAgfSkpLCB0aGlzLmZpZWxkTWF0Y2hlcy5sZW5ndGggPiAwID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJmaWVsZHMtc2Nyb2xsLWNvbnRhaW5lclwiLCByb2xlOiBcInRhYmxlXCIgfSwgdGhpcy5maWVsZE1hdGNoZXMubWFwKChtYXBwaW5nKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtbmV3LWl0ZW0tYXBwZW5kLW1hdGNoLWZpZWxkXCIsIHsga2V5OiBtYXBwaW5nLnNvdXJjZSwgb25GaWVsZENoYW5nZTogdGhpcy5oYW5kbGVGaWVsZENoYW5nZS5iaW5kKHRoaXMpLCBmaWVsZDogbWFwcGluZywgcm9sZTogXCJyb3dcIiB9KSk7XG4gICAgICAgIH0pKSkgOiAoaChcImNhbGNpdGUtaW5wdXQtbWVzc2FnZVwiLCB7IGNsYXNzOiBcIm5vLWZpZWxkc1wiLCBpY29uOiB0cnVlLCBzdGF0dXM6IFwidmFsaWRcIiB9LCB0aGlzLmkxOG4uZXJyb3JzLm5vRmllbGRzKSksIGgoXCJhcmNnaXMtbmV3LWl0ZW0tYWxlcnRcIiwgeyBoZWFkaW5nOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IudGl0bGUsIGRlc2NyaXB0aW9uOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IuZGVzY3JpcHRpb24sIGxpbms6IHsgaHJlZjogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmxpbmssIHRpdGxlOiBlcnJvciA9PT0gbnVsbCB8fCBlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyb3IubGlua1RleHQgfSwgYWN0aXZlOiAhIWVycm9yLCBvbkFsZXJ0RGlzbWlzczogKCkgPT4gKHRoaXMuZXJyb3IgPSBudWxsKSB9KSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kTWF0Y2hGaWVsZHMuc3R5bGUgPSBhcmNnaXNOZXdJdGVtUGFnZXNBcHBlbmRNYXRjaEZpZWxkc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzTmV3SXRlbVBhZ2VzQXBwZW5kTWF0Y2hGaWVsZHMgYXMgYXJjZ2lzX25ld19pdGVtX3BhZ2VzX2FwcGVuZF9tYXRjaF9maWVsZHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLW5ldy1pdGVtLXBhZ2VzLWFwcGVuZC1tYXRjaC1maWVsZHMuZW50cnkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9