"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-b08223"],{

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-098954b7.js":
/*!************************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-098954b7.js ***!
  \************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ ArcgisInfographic)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");




class DebugLog {
  constructor() {
    this.fixForLint = '';
  }
  static log(title, ...list) {
    if (DebugLog.showDebugConsoleLogs) {
      console.log('=======>' + title + ': ');
      if (list && list.length) {
        for (let ii = 0; ii < list.length; ii++) {
          console.log('...', list[ii]);
        }
      }
    }
  }
}
DebugLog.showDebugConsoleLogs = false;

function setEnvironment(environment) {
  try {
    if (environment != null && environment.length > 0) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.S.setEnvironment(environment);
      return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ok');
    }
    else {
      return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-environment');
    }
  }
  catch (ex) {
    return ex;
  }
}

class InfographicsHelper {
  constructor() {
  }
  static openInfographics(igItemId, hierarchyId, geometry, countryID) {
    try {
      InfographicsHelper._getInfographicsPlayerUrl().then((playerPageUrl) => {
        InfographicsHelper._openInfographicsTab(playerPageUrl, InfographicsHelper._getInfographicsParams(igItemId, hierarchyId, geometry, countryID));
      });
    }
    catch (ex) {
      console.log('InfographicHelper Error while getting player URL: ', ex);
    }
  }
  static _getInfographicsPlayerUrl() {
    return (new Promise(async (resolve, reject) => {
      if (InfographicsHelper._infographicsPlayerPageUrl) {
        return;
      }
      var playerPageUrl = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.getUrl('infographics');
      fetch(playerPageUrl, { method: 'HEAD' })
        .then(response => {
        response.ok ? resolve(playerPageUrl) : reject();
      }).catch(error => {
        reject(error);
      });
    }));
  }
  static _openInfographicsTab(playerPageUrl, infographicParameters) {
    var wnd = window.open(playerPageUrl, '_blank');
    var onMessage = function (_wnd) {
      var messageHandler = function (event) {
        var href = event.data && event.data.href;
        var status = event.data && event.data.status;
        if (href === playerPageUrl && status === 'waiting_for_infographic_parameters') {
          _wnd.postMessage({
            type: 'infographic_parameters',
            infographicParameters: infographicParameters
          }, href);
        }
        window.removeEventListener('message', messageHandler);
      };
      return messageHandler;
    };
    window.addEventListener('message', onMessage(wnd));
  }
  static _getInfographicsParams(igItemId, hierarchyId, geometry, countryID) {
    var token = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.token.access_token;
    var userId = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.token.username;
    let tokenExpires = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.token.expires_in;
    let ts = Date.now();
    let timeout = (tokenExpires == null) ? ts + 600000 : tokenExpires - ts;
    var expires = Math.floor(timeout / 60000 + 0.5);
    var server = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.S.getPortalBaseUrl();
    // var fullPagesOnly = BA.LocalStorage.getValue(BA.settings.localStorageID_showFullInfographics);
    // fullPagesOnly = SettingsHelper.isTrueString(fullPagesOnly);
    var params = {
      server: server,
      userId: userId,
      token: token,
      expires: expires,
      reportID: igItemId,
      countryID: countryID,
      hierarchy: hierarchyId,
      // fullPagesOnly: fullPagesOnly
      analysisAreas: [{
          feature: {
            geometry: geometry
          }
        }]
    };
    return JSON.stringify(params);
  }
}

// noinspection JSUnusedGlobalSymbols
class TransportUtil {
  constructor() {
    this.fixForLint = '';
    // debug logging set to true
  }
  // public static GEUrl =
  //   'https://geoenrich.arcgis.com/arcgis/rest/services/World/geoenrichmentserver/Geoenrichment/Enrich';// eslint-disable-line no-eval
  static setToken(username, token) {
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.setToken(username, token);
  }
  /**
   * Makes GE call to generate drivetime or walktime buffers
   *
   * @param mode = 'drivetime' or 'walktime'
   * @param sourceCountry
   * @param units = 'minutes, 'miles' or 'kilometers'
   * @param bufferValues  = 1,3,5
   * @param longitude
   * @param latitude
   */
  static async getBuffers(mode, sourceCountry, units, bufferValues, longitude, latitude) {
    if (mode != 'drivetime' && mode != 'walktime') {
      throw ('TransportUtil - invalid args');
    }
    if (TransportUtil.hasText(sourceCountry) &&
      TransportUtil.hasText(units) &&
      bufferValues &&
      typeof longitude != undefined &&
      typeof latitude != undefined) {
      let params = await TransportUtil.getParams(mode, sourceCountry, units, bufferValues, longitude, latitude);
      let response = await _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.G.enrich(params);
      let spatial = response.results[0].value.FeatureSet[0].spatialReference;
      let obj = TransportUtil.parseRings(response);
      if (obj) {
        for (let ii = 0; ii < obj.length; ii++) {
          if (obj[ii]) {
            let item = obj[ii];
            // @ts-ignore
            item.transport = mode == 'drivetime' ? 'drive' : 'walk';
            // @ts-ignore
            item.latitude = latitude;
            // @ts-ignore
            item.longitude = longitude;
            // @ts-ignore
            item.spatial = spatial;
            // location marker
            item.location = {
              geometry: {
                x: longitude,
                y: latitude,
                spatialReference: {
                  wkid: 4326
                }
              },
              symbol: {
                type: 'esriPMS',
                width: 14,
                height: 26.6,
                xoffset: 0,
                yoffset: 12.6,
                contentType: 'image/png',
                imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
              }
            };
          }
        }
      }
      return obj;
    }
    return null;
  }
  static parseRings(response) {
    // console.log('%c TRANSPORT_UTIL parseRings ', 'color:green;font-size:12pt')
    var rings = [];
    var checked = {};
    try {
      if (response && response.results && response.results.length > 0) {
        let featureSet = response.results[0].value.FeatureSet[0];
        if (featureSet.features && featureSet.features.length > 0) {
          for (let ii = 0; ii < featureSet.features.length; ii++) {
            let f = featureSet.features[ii];
            let bufferValue = f.attributes.bufferRadii;
            // filter out duplicate rings
            if (!checked[bufferValue]) {
              checked[bufferValue] = true;
              let bufferUnits = f.attributes.bufferUnits;
              let r = f.geometry.rings;
              rings.push({ value: bufferValue, units: bufferUnits, rings: r });
            }
          }
          return rings;
        }
      }
    }
    catch (ex) {
      console.log('TransportUtil parse GE result is invalid');
    }
    return undefined;
  }
  static hasText(s) {
    let test = (typeof s != undefined && s.trim().length > 0);
    return test;
  }
  static calculateSimplification(mode, bufferUnits, bufferValues) {
    let factor = 10;
    let max = 1;
    for (let ii = 0; ii < bufferValues.length; ii++) {
      max = (bufferValues[ii] > max) ? bufferValues[ii] : max;
    }
    if (mode === 'drivetime') {
      switch (bufferUnits) {
        case ('minutes'): {
          factor = Math.max(10, (0.00614 * max * max) + (3.5 * max) - 40);
          break;
        }
        case ('miles'): {
          factor = Math.max(10, (8.5 * max) - 100);
          break;
        }
        case ('kilometers'): {
          factor = Math.max(10, (5.3233 * max) - 60);
          break;
        }
      }
    }
    else if (mode === 'walktime') {
      switch (bufferUnits) {
        case ('minutes'): {
          factor = Math.max(2, (0.1437 * max) - 8.7);
          break;
        }
        case ('miles'): {
          factor = Math.max(2, (4.7 * max) - 26.8);
          break;
        }
        case ('kilometers'): {
          factor = Math.max(2, (3.11 * max) - 32.7);
          break;
        }
      }
    }
    return factor;
  }
  /*
   * getParams - generates request parameters for drivetime or walktime
   */
  static async getParams(mode, sourceCountry, units, bufferValues, longitude, latitude) {
    let isTime = units.toLowerCase() == 'minutes';
    let isDrivetime = mode == 'drivetime';
    // let defaultHierarchy = await GEClient.getGEDefaultHierarchy(sourceCountry)
    const simpleFactor = this.calculateSimplification(mode, units, bufferValues);
    // let countryObj = {
    //   sourceCountry: sourceCountry,
    //   hierarchy: defaultHierarchy
    // }
    // let jsonData: string = JSON.stringify(countryObj)
    let studyObj;
    // DRIVING BUFFERS
    if (isDrivetime) {
      studyObj = [
        {
          bufferUnits: isTime ? 'Minutes' : (units == 'miles') ? 'esriMiles' : 'esriKilometers',
          bufferRadii: bufferValues,
          areaType: 'NetworkServiceArea',
          travel_mode: {
            attributeParameterValues: [
              {
                attributeName: 'Avoid Unpaved Roads',
                parameterName: 'Restriction Usage',
                value: 'AVOID_HIGH'
              },
              {
                attributeName: 'Avoid Private Roads',
                parameterName: 'Restriction Usage',
                value: 'AVOID_MEDIUM'
              },
              {
                attributeName: 'Driving an Automobile',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Through Traffic Prohibited',
                parameterName: 'Restriction Usage',
                value: 'AVOID_HIGH'
              },
              {
                attributeName: 'TravelTime',
                parameterName: 'Vehicle Maximum Speed (km/h)',
                value: 0
              },
              {
                attributeName: 'Roads Under Construction Prohibited',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Avoid Gates',
                parameterName: 'Restriction Usage',
                value: 'AVOID_MEDIUM'
              },
              {
                attributeName: 'Avoid Express Lanes',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              },
              {
                attributeName: 'Avoid Carpool Roads',
                parameterName: 'Restriction Usage',
                value: 'PROHIBITED'
              }
            ],
            distanceAttributeName: 'Kilometers',
            id: 'FEgifRtFndKNcJMJ',
            impedanceAttributeName: (isTime) ? 'TravelTime' : 'Kilometers',
            name: (isTime) ? 'Driving Time' : 'Driving Distance',
            restrictionAttributeNames: [
              'Avoid Unpaved Roads',
              'Avoid Private Roads',
              'Driving an Automobile',
              'Through Traffic Prohibited',
              'Roads Under Construction Prohibited',
              'Avoid Gates',
              'Avoid Express Lanes',
              'Avoid Carpool Roads'
            ],
            simplificationTolerance: simpleFactor,
            simplificationToleranceUnits: 'esriMeters',
            timeAttributeName: 'TravelTime',
            type: 'AUTOMOBILE',
            useHierarchy: true,
            uturnAtJunctions: 'esriNFSBAtDeadEndsAndIntersections',
            description: 'Models the movement of cars and other similar small automobiles, such as pickup trucks, and finds solutions that optimize travel time. Travel obeys one-way roads, avoids illegal turns, and follows other rules that are specific to cars. When you specify a start time, dynamic travel speeds based on traffic are used where it is available.',
          },
          networkOptions: {
            // travel_direction: 'Away From Facility',
            polygon_overlap_type: 'Disks'
          },
          returnGeometry: true,
          geometry: {
            x: longitude,
            y: latitude,
            spatialReference: {
              wkid: 4326,
              latestWkid: 4326
            }
          }
        }
      ];
    }
    else {
      // WALKING BUFFERS
      studyObj = [
        {
          bufferUnits: isTime ? 'Minutes' : (units == 'miles') ? 'esriMiles' : 'esriKilometers',
          bufferRadii: bufferValues,
          areaType: 'NetworkServiceArea',
          travel_mode: {
            attributeParameterValues: [
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Avoid Private Roads',
                value: 'AVOID_MEDIUM'
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Walking',
                value: 'PROHIBITED'
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Preferred for Pedestrians',
                value: 'PREFER_LOW'
              },
              {
                parameterName: 'Walking Speed (km/h)',
                attributeName: 'WalkTime',
                value: 5
              },
              {
                parameterName: 'Restriction Usage',
                attributeName: 'Avoid Roads Unsuitable for Pedestrians',
                value: 'AVOID_HIGH'
              }
            ],
            description: 'Follows paths and roads that allow pedestrian traffic and finds solutions that optimize travel time. The walking speed is set to 5 kilometers per hour.',
            impedanceAttributeName: isTime ? 'WalkTime' : 'Kilometers',
            simplificationToleranceUnits: 'esriMeters',
            uturnAtJunctions: 'esriNFSBAllowBacktrack',
            restrictionAttributeNames: [
              'Avoid Private Roads',
              'Avoid Roads Unsuitable for Pedestrians',
              'Preferred for Pedestrians',
              'Walking'
            ],
            useHierarchy: false,
            simplificationTolerance: simpleFactor,
            timeAttributeName: 'WalkTime',
            distanceAttributeName: 'Kilometers',
            type: 'WALK',
            id: 'caFAgoThrvUpkFBW',
            name: isTime ? 'Walking Time' : 'Walking Distance'
          },
          networkOptions: {
            polygon_overlap_type: 'Disks'
          },
          returnGeometry: true,
          geometry: {
            x: longitude,
            y: latitude,
            spatialReference: {
              wkid: 4326,
              latestWkid: 4326
            }
          }
        }
      ];
    }
    let jsonStudy = JSON.stringify(studyObj);
    const useData = JSON.stringify({ "sourceCountry": sourceCountry });
    let json = {
      "dataCollections": ["GlobalIntersect"],
      "returnGeometry": true,
      "outSR": "{\"wkid\":4326, \"latestWkid\":4326}",
      "studyareas": jsonStudy,
      "useData": useData,
      "forStorage": false,
      "f": "json"
    };
    return json;
  }
}

class GeometryUtil {
  /*
   *  getRings
   *
   *  Generates rings for a location in the specified 'units', for
   *  the 1-3 radius values
   *
   *  units = [miles or kilometers]
   *  values = array of radius values using 1 to 3 values
   */
  static getRings(lat, lon, units, values, locationName, locationAttributes) {
    if (!values || values.length <= 0 || values.length > 3
      || (units != 'miles' && units != 'kilometers')
      || (!lat || !lon)) {
      console.log('GeometryUtil: invalid args', lat, lon, values);
      throw 'GeometryUtil: invalid args';
    }
    // let latitude = parseFloat(lat);
    // let longitude = parseFloat(lon);
    let rings = [];
    for (let ii = 0; ii < values.length; ii++) {
      let area = this.getAnalysisAreaRings(lat, lon, units, values, ii, locationName, locationAttributes);
      rings.push(area);
    }
    return rings;
  }
  static getAnalysisAreaRings(lat, lon, units, values, index, locationName, locationAttributes) {
    if (!lat || !lon || units == undefined || !values || values.length < 0 || values.length > 3) {
      DebugLog.log('arcgis-infographic analysisAreas invalid args: ', lat, lon, units, values);
      throw ('GeometryUtil.getAnalysisAreaRings: invalid args');
    }
    let sUnits = (values[index] == 1) ?
      (units == 'miles') ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('mile') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometer') :
      (units == 'miles') ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
    function getDescription() {
      let _unit = (units == 'miles') ? ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('mile') : ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometer');
      return (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ring-semicolon') + ' ' + values[index] + _unit + ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('radiusLowercase'));
    }
    function getName() {
      return values[index] + ' ' + sUnits;
    }
    function getShortName() {
      return values[index] + ' ' + sUnits;
    }
    let result = {
      feature: {
        geometry: {
          rings: []
        },
        attributes: {
          RING: index + 1,
          DESCRIPTION: '',
          latitude: lat,
          longitude: lon,
          name: getName(),
          shortName: getShortName(),
          description: getDescription(),
        }
      },
      latitude: lat,
      longitude: lon,
      location: {
        geometry: {
          x: lon,
          y: lat,
          spatialReference: {
            wkid: 4326
          }
        },
        symbol: {
          type: 'esriPMS',
          width: 14,
          height: 26.6,
          xoffset: 0,
          yoffset: 12.6,
          contentType: 'image/png',
          imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
        }
      },
      name: locationName ? locationName : getName(),
      address: '',
      shortName: getShortName(),
      locationName: locationName ? locationName : getName(),
      description: getDescription()
    };
    // Add attributes that were passed in
    if (locationAttributes) {
      const mergedAttributes = {
        ...locationAttributes,
        ...result.feature.attributes
      };
      result.feature.attributes = mergedAttributes;
    }
    let r = GeometryUtil._generateRing(lat, lon, units, values[index]);
    // @ts-ignore
    result.feature.geometry.rings.push(r);
    return result;
  }
  // generate Analysis Areas for  infographic
  //
  // Expecting rings = [ {value,units,rings},...]
  //
  // Returns:  json geometry
  static getAnalysisAreasFromRings(data, locationName, locationAttributes) {
    var obj = {
      analysisAreas: []
    };
    for (let ii = 0; ii < data.length; ii++) {
      let d = data[ii];
      let isTime = d.units.toLowerCase() == 'minutes';
      // let isSingular = d.value == 1;
      let unitLow = d.units.toLowerCase();
      let displayUnits = isTime ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('minutes') : unitLow.indexOf('miles') >= 0 ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
      let shortUnits = displayUnits.substr(0, displayUnits.length - 1);
      let shortName = d.value.toString() + ' ' + shortUnits + ' ' + d.transport;
      let descUnit = isTime ? ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('time-semicolon') + ' ' : ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('distance-semicolon') + ' ';
      let descValue = d.value.toString() + ' ' + (d.value == 1 ? shortUnits : displayUnits);
      let desc = (d.transport == 'drive' ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('drive') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('walk')) + descUnit + descValue;
      let buffer = {
        'feature': {
          'geometry': {
            'rings': d.rings,
            'spatialReference': { 'wkid': 4326 }
          },
          'attributes': {
            // "OBJECTID":      19,
            //   "RELID":         "028ddf01-c281-47f2-97bd-4cc586424890",
            'RING': ii,
            // "DESCRIPTION":   null,
            'SYMBOL': {
              'color': [204, 51, 0, 128],
              'outline': {
                'color': [204, 51, 0, 255],
                'width': 1.5,
                'type': 'esriSLS',
                'style': 'esriSLSSolid'
              },
              'type': 'esriSFS',
              'style': 'esriSFSSolid'
            }
          }
        },
        'latitude': d.latitude,
        'longitude': d.longitude,
        'name': locationName ? locationName : '',
        'address': '',
        'shortName': shortName,
        'locationName': locationName ? locationName : '',
        'description': desc,
        'location': {
          'geometry': {
            'x': d.longitude,
            'y': d.latitude,
            'spatialReference': {
              'wkid': '4326'
            }
          },
          'symbol': {
            'type': 'esriPMS',
            'width': 14,
            'height': 26.6,
            'xoffset': 0,
            'yoffset': 12.6,
            'contentType': 'image/png',
            'imageData': 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
          }
        }
      };
      // Add attributes that were passed in
      if (locationAttributes) {
        const mergedAttributes = {
          ...locationAttributes,
          ...buffer.feature.attributes
        };
        buffer.feature.attributes = mergedAttributes;
      }
      // @ts-ignore
      obj.analysisAreas.push(buffer);
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  static getAnalysisAreasFromPolygon(data, locationName, locationAttributes) {
    if (!data || !data.rings || !data.spatial) {
      DebugLog.log('getAnalysisAreasFromPolygon', 'invalid args', data);
      return '';
    }
    const obj = {
      analysisAreas: [
        {
          feature: {
            name: locationName ? locationName : '',
            geometry: {
              rings: data.rings,
              spatialReference: data.spatial
            },
            attributes: {
              RING: 1,
              SYMBOL: {
                color: [204, 51, 0, 128],
                outline: {
                  color: [204, 51, 0, 255],
                  width: 1.5,
                  type: 'esriSLS',
                  style: 'esriSLSSolid'
                },
                type: 'esriSFS',
                style: 'esriSFSSolid'
              }
            }
          },
          name: locationName ? locationName : '',
          description: locationName ? locationName : 'feature polygon'
          // location: {
          //   geometry: {
          //     x: data.longitude,
          //     y: data.latitude,
          //     spatialReference: {
          //       wkid: 4326,
          //     },
          //   },
          //   symbol: {
          //     type: 'esriPMS',
          //     width: 14,
          //     height: 26.6,
          //     xoffset: 0,
          //     yoffset: 12.6,
          //     contentType: 'image/png',
          //     imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC',
          //   },
          // },
        }
      ]
    };
    // Add attributes that were passed in
    if (locationAttributes) {
      const mergedAttributes = {
        ...locationAttributes,
        ...obj.analysisAreas[0].feature.attributes
      };
      obj.analysisAreas[0].feature.attributes = mergedAttributes;
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  /**
   * Takes data returned from getBuffers for DT/WT and returns
   * json analysis areas
   * @param data
   * @return {string}
   */
  static getAnalysisAreasFromEnrichBuffers(data, locationName, locationAttributes) {
    if (!data || data.length <= 0) {
      DebugLog.log('getAnalysisAreasFromEnrichBuffers', 'invalid args', data);
      return '';
    }
    const obj = {
      analysisAreas: [],
      spatialReference: data[0].spatial
    };
    let lat, lon;
    for (let ii = 0; ii < data.length; ii++) {
      let buffer = data[ii];
      if (!buffer || !buffer.latitude || !buffer.longitude || !buffer.rings)
        continue;
      let isTime = buffer.units.toLowerCase() == 'minutes';
      let isSingular = buffer.value == 1;
      let unitLow = buffer.units.toLowerCase();
      let displayUnits = isTime ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('minutes') : unitLow.toLowerCase().indexOf('miles') >= 0 ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('milesLowercase') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('kilometersLowercase');
      let shortUnits = displayUnits.substr(0, displayUnits.length - 1);
      let shortName = buffer.value.toString() + ' ' + shortUnits + ' ' + buffer.transport;
      let descUnit = isTime ? ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('time-semicolon') + ' ' : ' ' + _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('distance-semicolon') + ' ';
      let descValue = buffer.value.toString() + ' ' + (isSingular ? shortUnits : displayUnits);
      let desc = (buffer.transport == 'drive' ? _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('drive') : _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('walk')) + descUnit + descValue;
      if (!lat)
        lat = buffer.latitude;
      if (!lon)
        lon = buffer.longitude;
      let area = {
        feature: {
          geometry: {
            rings: buffer.rings
          },
          attributes: {
            RING: 1,
            SYMBOL: {
              color: [204, 51, 0, 128],
              outline: {
                color: [204, 51, 0, 255],
                width: 1.5,
                type: 'esriSLS',
                style: 'esriSLSSolid'
              },
              type: 'esriSFS',
              style: 'esriSFSSolid'
            }
          }
        },
        latitude: lat,
        longitude: lon,
        description: desc,
        shortName: shortName,
        name: locationName ? locationName : '',
        location: {
          geometry: {
            x: lon,
            y: lat,
            spatialReference: {
              wkid: 4326
            }
          },
          symbol: {
            type: 'esriPMS',
            width: 14,
            height: 26.6,
            xoffset: 0,
            yoffset: 12.6,
            contentType: 'image/png',
            imageData: 'iVBORw0KGgoAAAANSUhEUgAAABMAAAAjCAYAAAB2KjFhAAACtUlEQVRIS+2WS0wTURSG/zvT0kpfkGJ4pGCViA1Em9CtCQVx5QIWhiVRo8GdSNypqHElkcgOlzVh5ap1X6nEiAkQXzGBxkSKtZC0jdTSB7SdMXdwRjudB+w5q5t7T775z3/OzR0CWbT4x90Glh0CMEx43g1C3FIKz6/zhKwDCJYrldBWZIaupSDiqsE/3mBjmGeMyXLF7GiBubEVhmN2sIY6KblS3kO58BvFX5soZrbA7eYCWY67vR2Z2aZJAoyqMTLMvLXN47a1eeRiUSrmUSrmhHSGNYA11oGtMyO3FcVOYnW9xHH9VKUAcw1MfHSc9HktzvYaEN34B6suymSxCwozsQ+ReHi6n7gG7/iNZvv88W6/Ikgdtl+Y2d6I5NfXqJQK/cQ1MPHQ1uZ5oFSeSFdWtn9Ky93b/olsYvURhUWcXef7TPamGmWXfM3oPeVAi8OIeDKLpWgSrxY3qvIY1gjCl5GOvn2jCLOaWUyN9sDX6aj5wNJaErdm3yNbKAlnurCp0W709ThVPQy+i+H+ixV92OlWC+bGe1VB4sHlx2GsxTPayqhPkyNdurB7gRWEFmPasBsXT+D6YIcu7MnLz5gLf9OG0e7Njp3ThV2bXsBSNKUNo518ftML6p1aUK+oZwfqJgVRIAXLg47E1acLgvkHgtGk1kYTJkfOCEMrxnI0hbuBZSTSeWlPd87kaprqeWwkUopVHxqmdTePYMqTdeRZ9d1svzARtLnODlmbO1XvoqpnhMBkaUAhHUM2/iVE6ONrZZjIoZ+6v6BiZhOZ7yufdjjOL7ybesAaZQog+qpX/R6oKayCqYCoKAmmpVCCaYBqYGpAAbabF8z+3yPxh0XsXJUycVPuYWm3IIyAFkhRmRowl/4hdU2uSFOZHFjv7PDm0xtC+9VAmspkwOAOxw1rgWj+H4uVH6hj08HSAAAAAElFTkSuQmCC'
          }
        }
      };
      // Add attributes that were passed in
      if (locationAttributes) {
        const mergedAttributes = {
          ...locationAttributes,
          ...area.feature.attributes
        };
        area.feature.attributes = mergedAttributes;
      }
      // @ts-ignore
      obj.analysisAreas.push(area);
    }
    let s = JSON.stringify(obj).replace('{"analysisAreas"', '"analysisAreas"');
    return s.substr(0, s.length - 1);
  }
  static getDemoPolygon() {
    return '"analysisAreas": [ \
      { \
        "feature": { \
          "geometry": { \
            "rings": [ \
              [ \
                [ \
                  -118.000083501802, \
                  34.0609396322877 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0700406810389 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0791407522251 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0973379614042 \
                ], \
                [ \
                  -117.978110850314, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.96712452457, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1155312878821 \
                ], \
                [ \
                  -117.956138198827, \
                  34.1246264693743 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1246264693743 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1155312878821 \
                ], \
                [ \
                  -117.945151873083, \
                  34.1064350991486 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0973379614042 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0882398457216 \
                ], \
                [ \
                  -117.945151873083, \
                  34.0791407522251 \
                ], \
                [ \
                  -117.956138198827, \
                  34.0791407522251 \
                ], \
                [ \
                  -117.956138198827, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.96712452457, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.978110850314, \
                  34.0700406810389 \
                ], \
                [ \
                  -117.978110850314, \
                  34.0609396322877 \
                ], \
                [ \
                  -117.989097176058, \
                  34.0609396322877 \
                ], \
                [ \
                  -118.000083501802, \
                  34.0609396322877 \
                ] \
              ] \
            ], \
            "spatialReference": { \
              "wkid": 4326 \
            } \
          }, \
          "attributes": { \
            "OBJECTID": 6, \
            "NAME": "06 103", \
            "DESCRIPTION": "Area: 8.1 square miles", \
            "CREATED": 1518736922977, \
            "MODIFIED": 1518736922977, \
            "CREATOR": "fasil_ba", \
            "EDITOR": "fasil_ba", \
            "REGION": "US", \
            "FLAGS": 2, \
            "SYMBOL": {\"color\":[255,255,178,230],\"outline\":{\"color\":[0,0,0,255],\"width\":1.5,\"type\":\"esriSLS\",\"style\":\"esriSLSSolid\",\"marker\":null},\"type\":\"esriSFS\",\"style\":\"esriSFSSolid\"}, \
            "STATEFP": "06", \
            "UNSDLEA": "03690", \
            "GEOID": "0603690", \
            "NAME_": "Baldwin Park Unified School District", \
            "LSAD": "00", \
            "LOGRADE": "KG", \
            "HIGRADE": "12", \
            "MTFCC": "G5420", \
            "SDTYP": " ", \
            "FUNCSTAT": "E", \
            "ALAND": 22081431, \
            "AWATER": 626574, \
            "INTPTLAT": "+34.0896602", \
            "INTPTLON": "-117.9687223", \
            "GEOID2": 603690, \
            "COUNT_": 0, \
            "COUNT_1": 0, \
            "OID1": 75, \
            "YEAR_1": 1314, \
            "COUNTY_1": 19, \
            "DISTRICT_1": 1964287, \
            "DISTRICT_2": "Baldwin Park Unified", \
            "GEOGRAPH_1": "Baldwin Park Unified School District, CA", \
            "GEOID_12": 603690, \
            "HISP_1": 16310, \
            "PCTHISP_1": 86.91, \
            "AMIND_1": 62, \
            "PCTAMIND_1": 0.33, \
            "ASIAN_1": 731, \
            "PCTASIAN_1": 3.9, \
            "PAC_1": 32, \
            "PCTPAC_1": 0.17, \
            "FIL_1": 326, \
            "PCTFIL_1": 1.74, \
            "AFAM_1": 635, \
            "PCTAFAM_1": 3.38, \
            "WHITE_1": 552, \
            "PCTWHITE_1": 2.94, \
            "TWOORMOR_1": 107, \
            "PCTTWOOR_1": 0.57, \
            "NONEREPO_1": 12, \
            "PCTNONER_1": 0.06, \
            "TOTAL_1": 18767, \
            "NONWHITE_1": 18203, \
            "PCTNONWH_1": 97, \
            "SHAPE__Area": null, \
            "SHAPE__Length": null \
          } \
        }, \
        "name": "06 103", \
        "address": "06 103", \
        "shortName": "06 103", \
        "description": "Area: 8.1 square miles" \
      }]';
  }
  // static generateDriveTime(lat, lon, units, values) {
  //
  // }
  //
  // static generateWalkTime(lat, lon, units, values) {
  //
  // }
  /*
   * _generateRing - creates an array of arrays of lon,lat array coordinates that
   * define a circle around the given latitude, longitude at a given radius.
   *
   * Example:  [ [lon1,lat1], [lon2,lat2] ]
   *
   * 'units' - 'miles' or 'kilometers'
   * 'radius' - radius of circle in the 'units'
   */
  static _generateRing(lat, lon, units, radius) {
    if (!lat || !lon || (units != 'miles' && units != 'kilometers') || radius == undefined) {
      console.log('GeometryUtil Error: _generateRing invalid args=', lat, lon, units, radius);
    }
    var result = [];
    function fmod(X, Y) {
      return X % Y;
    }
    function toRad(n) {
      return n * Math.PI / 180;
    }
    function toDeg(n) {
      return n * 180 / Math.PI;
    }
    const earthRadius = 6371000; // meters
    var radInMeters = (units == 'miles') ? radius * 1609.344 : radius * 1000;
    var rLat = toRad(lat);
    var rLon = toRad(lon);
    var d_rad = radInMeters / earthRadius;
    for (let i = 0; i <= 360; i += 4) {
      var radial = toRad(i);
      var lat_rad = Math.asin(Math.sin(rLat) * Math.cos(d_rad) + Math.cos(rLat) * Math.sin(d_rad) * Math.cos(radial));
      var dlon_rad = Math.atan2(Math.sin(radial) * Math.sin(d_rad) * Math.cos(rLat), Math.cos(d_rad) - Math.sin(rLat) * Math.sin(lat_rad));
      var lon_rad = fmod((rLon + dlon_rad + Math.PI), 2 * Math.PI) - Math.PI;
      let coord = [];
      coord.push(toDeg(lon_rad));
      coord.push(toDeg(lat_rad));
      result.push(coord);
    }
    return result;
  }
}

/** InfographicCard
 *
 *  This class provides support for displaying an infographic inside
 *  an iframe element.
 */
class InfographicCard {
  constructor(username, token, env, options) {
    this.geoenrichmentUrl = '';
    this.portalUrl = '';
    this.portalOnlineGEProxy = false;
    this.langCode = 'en-us'; // [OPTIONAL] default language (default is en-us)
    this.sourceCountry = 'US'; // [OPTIONAL] default country code (default is US)
    this.bufferType = 'ring';
    this.bufferUnits = 'miles';
    this.bufferSizes = [1, 3, 5];
    DebugLog.showDebugConsoleLogs = true;
    this.username = username;
    this.token = token;
    this.environment = env;
    this._idPrefix = 'ba-infographic-frame-';
    const fid = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._idPrefix);
    this._iFrame = { id: fid.id, container: null, instance: null };
    this.setOptions(options);
  }
  setShadowRoot(root) {
    this._containerShadowRoot = root;
  }
  /**
   * resetOptions - returns all options to their defaults
   */
  resetOptions() {
    this.bufferType = 'ring';
    this.bufferUnits = 'miles';
    this.bufferSizes = [1, 3, 5];
    this.viewMode = 'auto'; // view mode [full, stack, slides, stack-all]
    // report
    this.reportShowHeader = true; // infographic report header display on/off
    this.reportHeaderButtonPrint = true; // show print button in header on/off
    this.reportHeaderButtonZoomLevel = true; // show zoom level button in header on/off
    this.reportHeaderButtonFullscreen = true; // show Fullscreen button in header on/off
    // export
    this.reportHeaderButtonExcel = true; // show Excel button in header on/off
    this.reportHeaderButtonImage = true; // show image button in header on/off
    this.reportHeaderButtonPdf = true; // show PDF button in header on/off
    this.reportHeaderButtonDynHtml = true; // show Dynamic HTML button in header on/off
    // style
    this.reportColorBackground = '#fff'; // infographic background color
    this.reportColorHeader = 'blue'; // infographic header color
    this.reportColorHeaderText = '#fff'; // infographic header text color
    // map
    this.runReportOnClick = true; // Boolean - runs new report on map click
    this.showSearch = true; // Boolean - shows BA map search
  }
  /** setOptions
   *    Sets one or more config and display options.  Only the options that are
   *    found in the options argument get changed by default.   If the 'reset'
   *    flag is set 'true' then all the options will be reset back to their
   *    defaults before setting values found in 'options'.
   *
   * @param options   JSON string with only the options to be changed
   * @param reset     boolean, reset options to default before applying 'options'
   */
  setOptions(options, reset) {
    if (typeof options == undefined || options == null || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(options))
      return false;
    try {
      if (reset)
        this.resetOptions();
      const opt = JSON.parse(options);
      if (!opt || opt.length <= 0)
        return false;
      // console.log('%c BAC InfographicCard setOptions', 'color:blue;font-size:9pt;', opt)
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.bufferType) && ['ring', 'drivetime', 'walktime'].includes(opt.bufferType))
        this.bufferType = opt.bufferType;
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.bufferUnits) && ['miles', 'kilometers', 'minutes'].includes(opt.bufferUnits))
        this.bufferUnits = opt.bufferUnits;
      if (opt.bufferSizes && opt.bufferSizes.length > 0 && opt.bufferSizes.length <= 3)
        this.bufferSizes = opt.bufferSizes;
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(opt.viewMode) && ['full', 'stack', 'slides', 'stack-all'].includes(opt.viewMode))
        this.viewMode = opt.viewMode;
      if (opt.report) {
        if (opt.report.showHeader != typeof undefined)
          this.reportShowHeader = opt.report.showHeader;
        if (opt.report.showZoomLevel != typeof undefined)
          this.reportHeaderButtonZoomLevel = opt.report.showZoomLevel;
        if (opt.report.showFullscreen != typeof undefined)
          this.reportHeaderButtonFullscreen = opt.report.showFullscreen;
      }
      if (opt.export) {
        if (opt.export.excel != typeof undefined)
          this.reportHeaderButtonExcel = opt.export.excel;
        if (opt.export.image != typeof undefined)
          this.reportHeaderButtonImage = opt.export.image;
        if (opt.export.pdf != typeof undefined)
          this.reportHeaderButtonPdf = opt.export.pdf;
        if (opt.report.print != typeof undefined)
          this.reportHeaderButtonPrint = opt.export.print;
        if (opt.export.dynamicHtml != typeof undefined)
          this.reportHeaderButtonDynHtml = opt.export.dynamicHtml;
      }
      if (opt.style) {
        if (opt.style.igBackgroundColor !== undefined) {
          this.reportColorBackground = opt.style.igBackgroundColor;
        }
        else if (opt.style.backgroundColor !== undefined) {
          this.reportColorBackground = opt.style.backgroundColor;
        }
        if (opt.style.headerColor != typeof undefined)
          this.reportColorHeader = opt.style.headerColor;
        if (opt.style.headerTextColor != typeof undefined)
          this.reportColorHeaderText = opt.style.headerTextColor;
      }
      if (opt.map) {
        if (opt.map.runReportOnClick != typeof undefined)
          this.runReportOnClick = opt.map.runReportOnClick;
        if (opt.map.showSearch != typeof undefined)
          this.showSearch = opt.map.showSearch;
      }
      return true;
    }
    catch (ex) {
      console.log('InfographicCard error: ', ex);
    }
    return false;
  }
  // generate infographic display options
  _createInfographicPlayerStyleOptions() {
    let arr1 = [];
    let arr2 = [];
    let arr3 = [];
    arr1.push('"showCloseButton":false');
    if (this.reportShowHeader != undefined && this.reportShowHeader == false)
      arr1.push('"showHeader":false');
    if (this.viewMode != undefined) {
      const modes = {
        full: 'full-pages',
        stack: 'panels-in-stack',
        slides: 'panels-in-slides',
        'stack-all': 'panels-in-stack-all'
      };
      let m = modes[this.viewMode];
      if (m)
        arr1.push('"viewMode":"' + m + '","resizeMode":"auto"');
    }
    if (this.reportHeaderButtonFullscreen)
      arr1.push('"showFullscreenButton": true');
    if (this.reportHeaderButtonZoomLevel)
      arr1.push('"disableZoom": true');
    if (this.reportHeaderButtonExcel)
      arr2.push('"excel": true');
    if (this.reportHeaderButtonImage)
      arr2.push('"image": true');
    if (this.reportHeaderButtonPdf)
      arr2.push('"pdf": true');
    if (this.reportHeaderButtonPrint)
      arr2.push('"print": true');
    if (this.reportHeaderButtonDynHtml)
      arr2.push('"dynamicHtml": true');
    if (this.reportColorBackground)
      arr3.push('"background":"' + this.reportColorBackground + '"');
    if (this.reportColorHeader)
      arr3.push('"headerBackground":"' + this.reportColorHeader + '"');
    if (this.reportColorHeaderText)
      arr3.push('"headerText":"' + this.reportColorHeaderText + '"');
    if (arr2.length > 0)
      arr1.push('"exportOptions": {' + arr2.toString() + '}');
    if (arr3.length > 0)
      arr1.push('"theme": {' + arr3.toString() + '}');
    return arr1.toString();
  }
  _validateSetup() {
    if (!_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.environment)) {
      return false;
    }
    if (!_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.token)) {
      DebugLog.log('InfographicCard', 'invalid token');
      return false;
    }
    if (!_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.username)) {
      DebugLog.log('InfographicCard', 'invalid username');
      return false;
    }
    if (!_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(this.reportId)) {
      DebugLog.log('InfographicCard', 'invalid report ID');
      return false;
    }
    if (!this.reportLocation) {
      if (!this.reportGeometry && !this.reportGeography) {
        DebugLog.log('InfographicCard', 'invalid location, geometry or geography');
        return false;
      }
    }
    return true;
  }
  _checkBuffersAssignDefaults() {
    if (typeof this.bufferType != undefined && typeof this.bufferUnits != undefined && typeof this.bufferSizes != undefined) {
      if (!isNaN(this.bufferSizes[0])) {
        return;
      }
    }
    if (typeof this.bufferType == undefined) {
      this.bufferType = 'ring'; // default
    }
    if (typeof this.bufferUnits == undefined) {
      this.bufferUnits = 'miles'; // default
    }
    if (typeof this.bufferSizes == undefined || isNaN(this.bufferSizes[0])) {
      // use default
      this.bufferSizes = [1];
    }
  }
  /** regenerateContent
   *    Rebuilds the infographic Card using current settings
   *
   * @param suggested   boolean, if true = will NOT render unless infographic has
   *                    already been rendered before
   */
  async regenerateContent(suggested) {
    const self = this;
    try {
      if (!suggested || (self._iFrame.container && self._iFrame.instance)) {
        if (self._iFrame.container) {
          _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.removeChildren(self._iFrame.container);
        }
        self._iFrame.instance = undefined;
        // Run report with current parameters
        await self.loadInfographic(self._iFrame.id, self._iFrame.container, self.reportLocation, self.reportGeometry, self.reportId, self.reportGeography);
      }
    }
    catch (ex) {
      console.log('InfographicCard: regenerateContent', ex);
    }
  }
  _validateReportGeometry(data) {
    if (data && data.length > 0) {
      for (let ii = 0; ii < data.length; ii++) {
        let r = data[ii];
        if (!r
          || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(r.transport)
          || !r.latitude
          || !r.longitude
          || !r.value
          || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.hasText(r.units)
          || !r.rings)
          return false;
      }
      return true;
    }
    return false;
  }
  /** _getReportGeometryAnalysisAreas
   *
   *  Take the reportGeometry JS object and generates geometry json for
   *  Drivetimes, Walktimes, or Rings
   */
  async _getReportGeometryAnalysisAreas() {
    let json = '';
    if (this.reportGeometry) {
      if (this.reportGeometry.type && this.reportGeometry.type == 'polygon') {
        json = GeometryUtil.getAnalysisAreasFromPolygon(this.reportGeometry, this.reportLocationName, this.reportLocationAttributes);
      }
      else {
        if (this.bufferType == 'drivetime' || this.bufferType == 'walktime') {
          if (this._validateReportGeometry(this.reportGeometry)) {
            json = GeometryUtil.getAnalysisAreasFromRings(this.reportGeometry, this.reportLocationName, this.reportLocationAttributes);
          }
          else
            DebugLog.log('_getReportGeometryAnalysisAreas', 'reportGeometry is invalid', this.reportGeometry);
        }
      }
    }
    else if (this.bufferType == 'drivetime' || this.bufferType == 'walktime') {
      //
      // generate the DT/WT buffers using GE enrich request
      TransportUtil.setToken(this.username, this.token);
      let obj = await TransportUtil.getBuffers(this.bufferType, this.sourceCountry, this.bufferUnits, this.bufferSizes, this.reportLocation.lon, this.reportLocation.lat);
      json = GeometryUtil.getAnalysisAreasFromEnrichBuffers(obj, this.reportLocationName, this.reportLocationAttributes);
    }
    return json;
  }
  _checkBuffers() {
    if (typeof this.bufferType != undefined && typeof this.bufferUnits != undefined && typeof this.bufferSizes != undefined) {
      if (!isNaN(this.bufferSizes[0])) {
        return;
      }
    }
    if (typeof this.bufferType == undefined) {
      this.bufferType = 'ring'; // default
    }
    if (typeof this.bufferUnits == undefined) {
      this.bufferUnits = 'miles'; // default
    }
    if (typeof this.bufferSizes == undefined || isNaN(this.bufferSizes[0])) {
      // use default
      this.bufferSizes = [1];
    }
  }
  generateNotReadyHtml() {
    let nrId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('notReadyDiv');
    return '<div id="' + nrId + '" class="notReadyOuter" > \
          <svg class="notReadySvg" preserveAspectRatio="xMidYMid meet" width="66" height="58"> \
            <g transform="matrix(0.65909094 0 0 0.65909094 0.09090962 -0)"> \
              <g> \
                <path \
                  d="M48.445312 0.15625C 48.125 0.234375 47.5625 0.445312 47.195312 0.632812C 46.648438 0.90625 46.375 1.117188 45.734375 1.757812C 45.257812 2.226562 44.765625 2.804688 44.507812 3.203125C 43.84375 4.234375 39.1875 12.441406 21.367188 43.960938C 15.171875 54.91797 7.976562 67.65625 5.375 72.25391C 2.773438 76.85547 0.554688 80.83203 0.445312 81.08984C -0.171875 82.55469 -0.117188 84.171875 0.59375 85.46094C 0.710938 85.67969 1.09375 86.13281 1.4375 86.47656C 2.148438 87.17969 2.820312 87.5625 3.828125 87.84375L3.828125 87.84375L4.421875 88L50.351562 87.984375L96.28906 87.96094L96.921875 87.75C 99.75781 86.78125 100.78125 83.85156 99.296875 80.88672C 99.13281 80.55078 92.27344 68.53906 84.05469 54.183594C 75.83594 39.835938 66.02344 22.695312 62.25 16.097656C 58.46875 9.503906 55.148438 3.75 54.859375 3.320312C 53.9375 1.9375 52.765625 0.890625 51.585938 0.40625C 50.609375 0 49.460938 -0.09375 48.445312 0.15625zM61 26.804688C 67.19531 37.61328 76.77344 54.339844 82.28125 63.96875L82.28125 63.96875L92.30469 81.47266L71.11719 81.49609C 59.460938 81.50391 40.382812 81.50391 28.71875 81.49609L28.71875 81.49609L7.507812 81.47266L20.523438 58.45703C 45.429688 14.402344 49.625 7.011719 49.695312 7.097656C 49.726562 7.128906 54.8125 15.996094 61 26.804688z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
                <path \
                  d="M49.140625 26.460938C 49.03125 26.484375 48.664062 26.570312 48.328125 26.65625C 45.28125 27.421875 42.8125 30.363281 42.8125 33.19922C 42.8125 33.558594 42.984375 35.183594 43.203125 36.80078C 43.414062 38.41797 44.085938 43.5 44.6875 48.101562C 46.257812 60.097656 46.242188 59.95703 46.375 60.45703C 46.703125 61.75 47.476562 62.78125 48.492188 63.28125C 49.015625 63.539062 49.164062 63.578125 49.804688 63.601562C 50.992188 63.65625 51.726562 63.367188 52.523438 62.539062C 53.296875 61.71875 53.648438 60.789062 53.898438 58.910156C 53.984375 58.253906 54.375 55.30078 54.765625 52.339844C 55.148438 49.382812 55.789062 44.554688 56.171875 41.59375C 56.5625 38.640625 56.953125 35.683594 57.039062 35.027344C 57.226562 33.60547 57.234375 32.64453 57.070312 32.003906C 56.429688 29.480469 54.257812 27.320312 51.65625 26.640625C 51.070312 26.484375 49.578125 26.382812 49.140625 26.460938z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
                <path \
                  d="M49.390625 66.59375C 46.695312 66.9375 44.75 69.49219 45.078125 72.26953C 45.234375 73.56641 45.75 74.62109 46.671875 75.47266C 47.5625 76.30859 48.523438 76.72266 49.726562 76.80078C 51.1875 76.88672 52.351562 76.43359 53.4375 75.33984C 54.484375 74.29297 54.9375 73.20703 54.945312 71.70703C 54.953125 70.796875 54.84375 70.27344 54.492188 69.515625C 53.554688 67.47656 51.53125 66.32031 49.390625 66.59375z" \
                  stroke="none" \
                  fill="#D4D7DD" \
                  fill-rule="nonzero" \
                /> \
              </g> \
            </g> \
          </svg> \
        </div>';
  }
  async loadInfographic(id, container, location, geometry, reportId, geography) {
    const self = this;
    if (!id || !container || (!location && !geometry && !geography) || !reportId)
      throw ('infographicCard error: invalid args loading infographic');
    self._iFrame = { id: id, container: container, instance: null };
    self.reportGeometry = geometry;
    self.reportId = reportId;
    self.reportGeography = geography;
    self.reportLocation = location;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.removeChildren(container);
    // create new iframe
    self._iFrame.container.innerHTML = '<iframe id="' + self._iFrame.id + '" class="arcgisInfographicFrame"></iframe>';
    // continue after dom settles
    const _continueLoading = async () => {
      self._iFrame.instance = self._containerShadowRoot.querySelector(_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.U.fixId(this._iFrame.id));
      if (!self._iFrame.instance) ;
      else {
        try {
          // message the infographic iframe with URL and params when loaded
          //
          // Options
          const env = _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.getEnvironment();
          // Environments env should always be correct
          // console.assert(env === self.environment)
          self.environment = env;
          setEnvironment(self.environment);
          const playerPageUrl = await InfographicsHelper._getInfographicsPlayerUrl();
          // default environment is 'www'
          const subdomain = self.environment === 'dev' ? 'devext' : self.environment === 'qa' ? 'qaext' : 'www';
          let lat = (self.reportLocation) ? self.reportLocation.lat : 0;
          let lon = (self.reportLocation) ? self.reportLocation.lon : 0;
          if (!self.reportGeometry && (!self.reportLocation || !lat || !lon) && !self.reportGeography) {
            console.log('InfographicCard error: invalid location, geometry or geography', self.reportLocation, self.reportGeometry, self.reportGeography);
          }
          else {
            self.langCode = self.langCode || 'en-us';
            self.sourceCountry = self.sourceCountry || 'US';
            const defaultHierarchy = await _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.G.getGEDefaultHierarchy(self.sourceCountry, self.portalOnlineGEProxy ? self.token : "");
            // Need to pass the second parameter in langCode as uppercase to ReportPlayer to work (e.g. pt-BR, not pt-br)
            const upperLangCode = self.langCode.length === 5 ? self.langCode.substring(0, 3) + self.langCode.substring(3).toUpperCase() : self.langCode;
            let params = '{ \
                "userId":"' + self.username + '", \
                "token":"' + self.token + '", \
                "expires":"' + (Math.floor(Date.now() + 86400000.5)).toString() + '", \
                "componentId":"' + self._iFrame.id + '", \
                "reportID":"' + self.reportId + '", \
                "countryID":"' + self.sourceCountry + '", \
                "langCode":"' + upperLangCode + '", \
                "allLanguages":true, \
                "hierarchy":"' + defaultHierarchy + '", ';
            if (self.geoenrichmentUrl) {
              params += ' "geoenrichmentUrl":"' + self.geoenrichmentUrl + '", ';
            }
            if (self.portalUrl) {
              params += ' "server":"' + self.portalUrl + '", ';
            }
            else {
              params += ' "server":"https://' + subdomain + '.arcgis.com" ,';
            }
            if (self.portalOnlineGEProxy) {
              params += ' "portalOnlineGEProxy":true ,';
            }
            let analysisAreas;
            // Use geography if it is set
            if (self.reportGeography) {
              analysisAreas = ' "analysisAreas": [{"locationName":"' + self.reportLocationName + '", "geographies":[' + JSON.stringify(self.reportGeography) + ']}] ';
            }
            else {
              analysisAreas = await self._getReportGeometryAnalysisAreas();
            }
            if (!analysisAreas) {
              // Infographic will be for a location with Rings
              if (self.bufferUnits == 'minutes') {
                // invalid units for rings
                self.bufferUnits = self.bufferUnits = 'miles'; // default units for rings
              }
              let areas = GeometryUtil.getRings(lat, lon, self.bufferUnits, self.bufferSizes, this.reportLocationName, this.reportLocationAttributes);
              params += ' "analysisAreas": ' + JSON.stringify(areas);
            }
            else {
              params += analysisAreas;
            }
            let options = self._createInfographicPlayerStyleOptions();
            if (options && options.length > 0) {
              params += ',' + options;
            }
            params += ' }';
            // After the iframe loads, we message it with the instructions about
            // the infographic that will be generated
            //
            // @ts-ignore
            self._iFrame.instance.onload = function () {
              function _delay() {
                // @ts-ignore
                if (self._iFrame && self._iFrame.instance && self._iFrame.instance.contentWindow) {
                  // console.log("%c infographicCard: iframe onload event: passing params to player => ",'color:blue;font-size:10pt', JSON.parse(params))
                  // @ts-ignore
                  self._iFrame.instance.contentWindow.postMessage({
                    type: 'infographic_parameters',
                    infographicParameters: params
                  }, playerPageUrl);
                }
              }
              setTimeout(_delay, 500);
            };
            // instantiate infographic player (report will display after loaded)
            // @ts-ignore
            self._iFrame.instance.src = playerPageUrl;
          }
        }
        catch (ex) {
          console.log('InfographicCard error', ex);
        }
      }
    };
    setTimeout(_continueLoading, 0);
  }
  // /**
  //  * Renders the infographic iframe OR the warning image
  //  *
  //  * Actual infographic display is done in the 'loadInfographic' function
  //  */
  // render() {
  //   let _showWarning = false
  //   this._checkBuffers()
  //   if(!this._validateSetup()) {
  //     DebugLog.log('InfographicCard', ' error - no location or boundary to display')
  //     _showWarning = true
  //   }
  //   if(!_showWarning && !this.reportLocation && !this.reportGeometry) {
  //     DebugLog.log('InfographicCard', ' error - no location or boundary to display')
  //     _showWarning = true
  //   }
  //   if(!_showWarning && (!this.username || !this.token)) {
  //     DebugLog.log('InfographicCard', ' render error - invalid username/token')
  //     _showWarning = true
  //   }
  //
  //   if(!_showWarning) {
  //     this._checkBuffersAssignDefaults()
  //     setToken(this.username, this.token)
  //     return '<iframe id="' + this._iFrame.id + '" class="arcgisInfographicFrame"></iframe>'
  //   } else {
  //     return this.generateNotReadyHtml()
  //   }
  // }
  /* Client interface */
  updateInfographic() {
    // assuming all properties have been updated already.
    this.regenerateContent();
  }
  /**  setReportLocation
   *      Updates the report location (lat/lon) for the report. The also
   *      forces a refresh
   *
   * @param loc see LocationType
   */
  setReportLocation(loc) {
    if (loc && loc.lat && loc.lon) {
      this.reportLocation = loc;
      this.regenerateContent(true);
    }
  }
  /**  setReportGeometry
   *      Updates the report geometry for the report and
   *      forces a refresh
   *
   * @param loc geometry object
   */
  setReportGeometry(geometry) {
    if (geometry) {
      this.reportGeometry = geometry;
      this.regenerateContent(true);
    }
  }
  /**  setReportGeography
   *      Updates the report geography for the report and
   *      forces a refresh
   *
   * @param loc geography object
   */
  setReportGeography(geography) {
    if (geography) {
      this.reportGeography = geography;
      this.regenerateContent(true);
    }
  }
  /** generateBuffers
   *    Generates drivetime or walktime buffers using the InfographicCard properties
   *
   *    Result: geometry is saved into this InfographicCard's reportGeometry
   *    Return: object = {
   *      success:boolean,
   *      error:string
   *    }
   */
  async generateBuffers() {
    // Validation
    if (!this.sourceCountry)
      return { success: false, error: 'InfographicCard sourceCountry not valid' };
    if (!this.bufferType || (this.bufferType != 'drivetime' && this.bufferType != 'walktime'))
      return {
        success: false,
        error: '[' + this.bufferType + '] invalid bufferType (must be "drivetime" or "walktime")'
      };
    if (!this.bufferSizes || this.bufferSizes.length <= 0)
      return { success: false, error: 'missing bufferSizes' };
    // let bufferValues = this.bufferSizes.toString();
    if (!this.bufferUnits || (this.bufferUnits != 'miles' && this.bufferUnits != 'kilometers' && this.bufferUnits != 'minutes'))
      return { error: 'invalid units' };
    if (!this.reportLocation || !this.reportLocation.lat)
      return { error: 'invalid latitude' };
    if (!this.reportLocation || !this.reportLocation.lon)
      return { error: 'invalid latitude' };
    // GE request to generate drivetime/walktime rings
    TransportUtil.setToken(this.username, this.token);
    let resultObject;
    let lat = this.reportLocation.lat;
    let lon = this.reportLocation.lon;
    if (this.bufferType == 'drivetime') {
      resultObject = await TransportUtil.getBuffers('drivetime', this.sourceCountry, this.bufferUnits, this.bufferSizes, lon, lat);
    }
    else {
      resultObject = await TransportUtil.getBuffers('walktime', this.sourceCountry, this.bufferUnits, this.bufferSizes, lon, lat);
    }
    // update the infographic to do the drivetime/walktime polygons
    // This assignment triggers an infographic refresh
    // this._isInternalUpdate = true;
    this.reportGeometry = resultObject;
    return resultObject;
  }
}

const arcgisInfographicCss = ":host{display:block}.notReadyOuter{position:absolute;top:0;left:0;width:100%;height:100%}.notReadyDiv{position:absolute;top:calc(50% - 50px);left:calc(50% - 50px);width:100px;height:100px}.notReadySvg{position:absolute;top:calc(50% - 29px);left:calc(50% - 33px)}.arcgisInfographicFrame{position:absolute;top:0;left:0;width:100%;height:100%;border:none}";

const ArcgisInfographic = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.r)(this, hostRef);
    this._isInternalUpdate = false; // flag to prevent full property update mechanism
    this._idPrefix = 'arcgis-infographic-';
    this._hasSetEnv = false;
    this._defaultOptions = JSON.stringify({
      bufferType: 'ring',
      bufferUnits: 'miles',
      bufferSizes: '1,3,5',
      viewMode: 'auto'
    });
  }
  // ---------------------------------------------------------------------------------------------------
  // watches
  onEnvChanged() {
    this.stEnv = this.env;
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.setEnvironment(this.env);
    if (this._infographicCard)
      this._infographicCard.environment = this.env;
    this._onPropChanged();
  }
  onTokenChanged() {
    this.stToken = this.token;
    if (this._infographicCard)
      this._infographicCard.token = this.token;
    this._onPropChanged();
  }
  onUsernameChanged() {
    this.stUsername = this.username;
    if (this._infographicCard)
      this._infographicCard.username = this.username;
    this._onPropChanged();
  }
  onLocationDisplayNameChanged() {
    // this._l('locationName',this.locationName)
    this.stLocationDisplayName = this.locationName;
    if (this._infographicCard)
      this._infographicCard.reportLocationName = this.locationName;
    this._onPropChanged();
  }
  onLocationAttributesChanged() {
    // this._l('locationName',this.locationName)
    this.stLocationAttributes = this.locationAttributes ? JSON.parse(this.locationAttributes) : {};
    if (this._infographicCard)
      this._infographicCard.reportLocationAttributes = this.stLocationAttributes;
    this._onPropChanged();
  }
  onLangCodeChanged() {
    this.stLangCode = this.langCode;
    if (this._infographicCard)
      this._infographicCard.langCode = this.langCode;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.stLangCode);
    this._onPropChanged();
  }
  onCountryChanged() {
    this.stSourceCountry = this.sourceCountry;
    if (this._infographicCard)
      this._infographicCard.sourceCountry = this.sourceCountry;
    this._onPropChanged();
  }
  onOptionsChanged() {
    this.stOptions = this.options;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic options changing...', this.options);
    if (this._infographicCard)
      this._infographicCard.setOptions(this.options, true);
    this._onPropChanged();
  }
  onReportIdChanged() {
    this.stReportId = this.reportId;
    if (this._infographicCard)
      this._infographicCard.reportId = this.reportId;
    this._onPropChanged();
  }
  onThemeChanged() {
    this.stTheme = JSON.parse(this.theme);
    this._onPropChanged();
  }
  onReportLocationChanged() {
    try {
      this.stReportLocation = this.reportLocation;
      this._onPropChanged();
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Error('onReportLocationChanged', ex);
    }
  }
  onReportGeometryChanged() {
    this.stReportGeometry = this.reportgeometry;
    // if(!this._isInternalUpdate) {
    //   if(this._infographicCard) {
    //     if(Utils.hasText(this.reportgeometry))
    //       this._infographicCard.setReportGeometry(JSON.parse(this.reportgeometry))
    //   }
    this._onPropChanged();
    // } else this._isInternalUpdate = false //reset flag
  }
  onReportGeographyChanged() {
    this.stReportGeography = this.reportgeography;
    this._onPropChanged();
  }
  // Update the Infographic Report when the arcgis-report-list changes
  reportSelectedEventHandler(e) {
    let reportId = e.detail?.value;
    if (reportId) {
      this.stReportId = reportId;
      // destroy iframe
      let frame = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.queryElementById(this._iframeId);
      if (frame && frame.parentNode) {
        frame.parentNode.removeChild(frame);
      }
      this.componentDidLoad();
    }
  }
  // Methods -------------------------------------------
  //
  /**
   * generateBuffers
   *
   * This function passes in values needed to do either a drivetime or walktime buffers
   * report.  The values passed in update the Props in the component, async returns the
   * rings, and generates a new infographic using the drivetime or walktime values.
   *
   * @param bufferType = 'walktime' or 'drivetime'
   * @param values     = string representing drivetime distance or time [example:"1,3,5"]
   * @param units      = "miles", "kilometers", or "minutes"
   * @param latitude   = map location
   * @param longitude
   *
   * @return = [
   *  { value: <bufferValue>, units: <bufferUnits>, rings: <geometry rings> },
   *  { value: <bufferValue>, units: <bufferUnits>, rings: <geometry rings> },
   *  <up to 3 results depending on length of values>
   * ]
   */
  async generateBuffers(bufferType, values, units, latitude, longitude) {
    const card = this._infographicCard;
    try {
      if (!card)
        return null;
      // bufferType
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(bufferType) && ['ring', 'drivetime', 'walktime'].includes(bufferType)) { // @ts-ignore
        card.bufferType = bufferType;
      }
      // values
      if (values && values.trim().length > 0) {
        let sizes = [];
        let arr = values.split(',');
        for (let ii = 0; ii < arr.length; ii++) {
          if (ii < 3 && arr[ii] && arr[ii].trim().length > 0) {
            sizes.push(parseFloat(arr[ii].trim()));
          }
        }
        if (sizes.length > 0)
          card.bufferSizes = sizes;
      }
      // units
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(units) && ['miles', 'kilometers', 'minutes'].includes(bufferType)) {
        // @ts-ignore
        card.bufferUnits = units;
      }
      // latitude, longitude
      if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(latitude) && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(longitude)) {
        let lat = parseFloat(latitude);
        let lon = parseFloat(longitude);
        card.reportLocation = { lat: lat, lon: lon };
        this.reportLocation = longitude + ', ' + latitude;
      }
      this._isInternalUpdate = true;
      return (card.generateBuffers());
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Error('arcgis-infographic: generate buffers error: ', ex);
      return { error: 'exception: ' + ex.toString() };
    }
  }
  async onPropChange(callback, context) {
    this._onChangeCallback = { fn: callback, ctx: context };
  }
  async updateInfographic(name, reportId, location, geometry, geography) {
    if (name && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(name)) {
      this.locationName = name;
      this.stLocationDisplayName = name;
    }
    if (reportId && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(reportId)) {
      this.reportId = reportId;
      this.stReportId = reportId;
    }
    if (location) {
      this.reportLocation = location;
      this.stReportLocation = location;
    }
    if (geometry) {
      this.reportgeometry = geometry;
      this.stReportGeometry = geometry;
    }
    if (geography) {
      this.reportgeography = geography;
      this.stReportGeography = geography;
    }
  }
  /**
   * Filters out multiple rapid events of the same type.  The callback
   * function will be called if no new events have happened during the
   * 'wait' time.
   * @param callback - your function to call when the events have settled
   * @param wait     - milliseconds delay (ex: 250)
   */
  _debounce2(callback, wait) {
    const self = this;
    const delayedCall = function () {
      self._debounceTimer = null;
      callback.apply(self);
    };
    // everytime _debounce2 is called we kill the previous timer
    if (self._debounceTimer)
      clearTimeout(self._debounceTimer);
    self._debounceTimer = setTimeout(delayedCall, wait);
  }
  _onFilteredPropChanged() {
    if (this._onChangeCallback)
      this._onChangeCallback.fn(this._onChangeCallback.ctx, this.reportLocation);
    else {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Warn('WARN- arcgis-infographic component: property sync callback not found');
    }
    this.attemptInfographicRender();
  }
  _onPropChanged() {
    this._debounce2(this._onFilteredPropChanged, 250);
  }
  _debounce(func, wait, immediate) {
    let timeout;
    const self = this;
    return function () {
      let context = self, args = arguments;
      let later = function () {
        timeout = null;
        if (!immediate)
          func.apply(context, args);
      };
      let callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow)
        func.apply(context, args);
    };
  }
  // Stencil lifecycle methods
  //
  componentWillLoad() {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic willLoad', this.options);
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic willLoad creds', this.username, this.token);
    try {
      // Each component has the ID with a suffix counter number that
      // is managed by the static instance of this component.  The
      // result is that we support multiple instances of the component
      // on any given webpage.
      if (!this._instanceId)
        this._instanceId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._idPrefix).id;
      if (!this._containerId)
        this._containerId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('componentOuter').id;
      if (!this._iframeId)
        this._iframeId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId('igFrame').id;
      // initialize state variables here without causing another render()
      this.stEnv = this.env;
      this.stToken = this.token;
      this.stUsername = this.username;
      this.stLocationDisplayName = this.locationName;
      try {
        this.stLocationAttributes = JSON.parse(this.locationAttributes);
      }
      catch (error) {
        this.stLocationAttributes = {};
      }
      this.stLangCode = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.langCode) ? this.langCode : 'en-us';
      this.stSourceCountry = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.sourceCountry) ? this.sourceCountry : 'US';
      this.stReportId = this.reportId;
      this.stTheme = null;
      if (!this.options || !_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.options)) {
        this.options = this._defaultOptions;
      }
      this.stOptions = JSON.parse(this.options);
      if (!this._hasSetEnv && this.env) {
        this._hasSetEnv = true;
        this.stEnv = this.env;
        _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.setEnvironment(this.env);
      }
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.stLangCode);
      // Set if GeoenrichmentUrl was optionally passed in
      if (this.geoenrichmentUrl) {
        _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.setGeoenrichmentUrl(this.geoenrichmentUrl);
      }
      // Set if Poratl Url was optionally passed in
      if (this.portalUrl) {
        _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.E.setPortalUrl(this.portalUrl);
      }
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic willLoad2', this.options);
      if (!this._infographicCard) {
        _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic creating new InfographicCard');
        this._infographicCard = new InfographicCard(this.username, this.token, this.env, this.options);
        this._infographicCard.setOptions(this.options, true); //@@@@@@@@@@@@
        this._infographicCard.geoenrichmentUrl = this.geoenrichmentUrl;
        this._infographicCard.portalUrl = this.portalUrl;
        this._infographicCard.portalOnlineGEProxy = this.portalOnlineGEProxy;
        this._infographicCard.reportLocationName = this.stLocationDisplayName;
        this._infographicCard.reportLocationAttributes = this.stLocationAttributes;
        this._infographicCard.sourceCountry = this.stSourceCountry;
        this._infographicCard.langCode = this.stLangCode;
        this._infographicCard.setShadowRoot(this.el.shadowRoot);
      }
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Error('arcgis-infographic ComponentWillLoad', ex);
    }
  }
  async attemptInfographicRender() {
    let container = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.queryElementById.call(this, this._containerId);
    let location, geometry, geography, reportId;
    if (this._infographicCard && this.options)
      this._infographicCard.setOptions(this.options, true);
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic attemptInfographicRender', this._infographicCard);
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('BAC arcgis-infographic attemptRender creds', this.username, this.token);
    // Sync InfographicCard properties
    if (this.reportLocation) {
      let geo = this.reportLocation.split(',');
      if (geo && geo.length == 2) {
        let lat = parseFloat(geo[1]);
        let lon = parseFloat(geo[0]);
        location = { lat: lat, lon: lon };
        this._infographicCard.setReportLocation(location);
      }
    }
    if (this.reportgeometry) {
      geometry = JSON.parse(this.reportgeometry);
      this._infographicCard.setReportGeometry(geometry);
    }
    if (this.reportgeography) {
      geography = JSON.parse(this.reportgeography);
      this._infographicCard.setReportGeography(geography);
    }
    if (this.reportId) {
      reportId = this.reportId;
      this._infographicCard.reportId = this.reportId;
    }
    // validate required data to draw an infographic
    if (container && (location || geometry || geography) && reportId) {
      await this._infographicCard.loadInfographic(this._iframeId, container, location, geometry, reportId, geography);
    }
  }
  // Main component screen generation
  componentDidLoad() {
    this.attemptInfographicRender();
  }
  render() {
    // this._l(' render() running....')
    // This initially renders the component container only and
    // will update the contents when the Stencil life cycle function
    // componentDidLoad() runs.  This is because the card render()
    // function is async, so we load it then on 'componentDidLoad' we
    // assign the iframe 'src' and do a 'postmessage' when the
    // iframe is finally ready to accept options.
    //
    return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.h)("div", { id: this._containerId, class: 'componentOuter' });
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_2__.g)(this); }
  static get watchers() { return {
    "env": ["onEnvChanged"],
    "token": ["onTokenChanged"],
    "username": ["onUsernameChanged"],
    "locationName": ["onLocationDisplayNameChanged"],
    "locationAttributes": ["onLocationAttributesChanged"],
    "langCode": ["onLangCodeChanged"],
    "sourceCountry": ["onCountryChanged"],
    "options": ["onOptionsChanged"],
    "reportId": ["onReportIdChanged"],
    "theme": ["onThemeChanged"],
    "reportLocation": ["onReportLocationChanged"],
    "reportgeometry": ["onReportGeometryChanged"],
    "reportgeography": ["onReportGeographyChanged"]
  }; }
};
ArcgisInfographic.style = arcgisInfographicCss;



//# sourceMappingURL=arcgis-infographic-098954b7.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic.entry.js":
/*!*********************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic.entry.js ***!
  \*********************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_infographic: () => (/* reexport safe */ _arcgis_infographic_098954b7_js__WEBPACK_IMPORTED_MODULE_0__.A)
/* harmony export */ });
/* harmony import */ var _arcgis_infographic_098954b7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arcgis-infographic-098954b7.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-infographic-098954b7.js");





//# sourceMappingURL=arcgis-infographic.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYmEtaW5mb2dyYXBoaWNfbm9kZV9tb2R1bGVzX2FyY2dpc19idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHNfZGlzLWIwODIyMy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWdGO0FBQzZDO0FBQ1Y7O0FBRW5IO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsa0JBQWtCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sb0RBQWM7QUFDcEIsYUFBYSxzREFBaUI7QUFDOUI7QUFDQTtBQUNBLGFBQWEsc0RBQWlCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixvREFBWTtBQUN0Qyw2QkFBNkIsZ0JBQWdCO0FBQzdDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixvREFBYTtBQUM3QixpQkFBaUIsb0RBQWE7QUFDOUIsdUJBQXVCLG9EQUFhO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvREFBYztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwR0FBMEc7QUFDMUc7QUFDQSxJQUFJLG9EQUFhO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixvREFBUTtBQUNuQztBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsaUJBQWlCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUU7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlDQUFpQztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrREFBa0Q7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDBCQUEwQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsZ0NBQWdDO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtQ0FBbUM7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG9CQUFvQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFpQixnQkFBZ0Isc0RBQWlCO0FBQzdFLDJCQUEyQixzREFBaUIsMEJBQTBCLHNEQUFpQjtBQUN2RjtBQUNBLDZDQUE2QyxzREFBaUIsc0JBQXNCLHNEQUFpQjtBQUNyRyxjQUFjLHNEQUFpQiw4REFBOEQsc0RBQWlCO0FBQzlHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGtCQUFrQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsa0JBQWtCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLHNEQUFpQixtREFBbUQsc0RBQWlCLDBCQUEwQixzREFBaUI7QUFDbEs7QUFDQTtBQUNBLG9DQUFvQyxzREFBaUIsc0NBQXNDLHNEQUFpQjtBQUM1RztBQUNBLDJDQUEyQyxzREFBaUIsaUJBQWlCLHNEQUFpQjtBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLGtCQUFrQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQWlCLGlFQUFpRSxzREFBaUIsMEJBQTBCLHNEQUFpQjtBQUNoTDtBQUNBO0FBQ0Esb0NBQW9DLHNEQUFpQixzQ0FBc0Msc0RBQWlCO0FBQzVHO0FBQ0EsZ0RBQWdELHNEQUFpQixpQkFBaUIsc0RBQWlCO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixxQkFBcUI7QUFDckIsd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0EsY0FBYztBQUNkLFdBQVc7QUFDWCwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHlDQUF5QyxvR0FBb0csaURBQWlEO0FBQ3JOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1osU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHNEQUFVO0FBQzFCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQSxrQ0FBa0M7QUFDbEMseUNBQXlDO0FBQ3pDLDZDQUE2QztBQUM3Qyw4Q0FBOEM7QUFDOUM7QUFDQSx5Q0FBeUM7QUFDekMseUNBQXlDO0FBQ3pDLHVDQUF1QztBQUN2QywyQ0FBMkM7QUFDM0M7QUFDQSx5Q0FBeUM7QUFDekMscUNBQXFDO0FBQ3JDLHlDQUF5QztBQUN6QztBQUNBLGtDQUFrQztBQUNsQyw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxzREFBSztBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxjQUFjO0FBQ3BGLFVBQVUsc0RBQUs7QUFDZjtBQUNBLFVBQVUsc0RBQUs7QUFDZjtBQUNBO0FBQ0E7QUFDQSxVQUFVLHNEQUFLO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyx3QkFBd0I7QUFDM0Q7QUFDQSwyQkFBMkIsd0JBQXdCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLFNBQVMsc0RBQUs7QUFDZDtBQUNBO0FBQ0EsU0FBUyxzREFBSztBQUNkO0FBQ0E7QUFDQTtBQUNBLFNBQVMsc0RBQUs7QUFDZDtBQUNBO0FBQ0E7QUFDQSxTQUFTLHNEQUFLO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsc0RBQUs7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQSxjQUFjLHNEQUFLO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLGNBQWMsc0RBQUs7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxzREFBVTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQUs7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxzREFBSztBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0Isb0RBQVk7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLG9EQUFRO0FBQ25EO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELCtHQUErRztBQUNsSztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFIQUFxSDtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9DQUFvQyxjQUFjLGVBQWUsa0JBQWtCLE1BQU0sT0FBTyxXQUFXLFlBQVksYUFBYSxrQkFBa0IscUJBQXFCLHNCQUFzQixZQUFZLGFBQWEsYUFBYSxrQkFBa0IscUJBQXFCLHNCQUFzQix3QkFBd0Isa0JBQWtCLE1BQU0sT0FBTyxXQUFXLFlBQVksWUFBWTs7QUFFOVg7QUFDQTtBQUNBLElBQUkscURBQWdCO0FBQ3BCLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxvREFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQWlCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxzREFBUTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHNEQUFRO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixzREFBUTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEscUVBQXFFO0FBQzdFLFFBQVEscUVBQXFFO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsc0RBQVEsa0ZBQWtGO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixpQkFBaUI7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsc0RBQVE7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHNEQUFRLHNCQUFzQixzREFBUTtBQUNoRDtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0RBQVE7QUFDZCxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQSxnQkFBZ0Isc0RBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNEQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHNEQUFRO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQVE7QUFDWixJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFVO0FBQ3JDO0FBQ0EsNEJBQTRCLHNEQUFVO0FBQ3RDO0FBQ0EseUJBQXlCLHNEQUFVO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isc0RBQVE7QUFDaEMsNkJBQTZCLHNEQUFRO0FBQ3JDO0FBQ0E7QUFDQSw0QkFBNEIsc0RBQVE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxvREFBWTtBQUNwQjtBQUNBLE1BQU0sc0RBQWlCO0FBQ3ZCO0FBQ0E7QUFDQSxRQUFRLG9EQUFZO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsb0RBQVk7QUFDcEI7QUFDQSxNQUFNLHNEQUFRO0FBQ2Q7QUFDQSxRQUFRLHNEQUFRO0FBQ2hCO0FBQ0EsOERBQThEO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHNEQUFRO0FBQ2Q7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNEQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQVE7QUFDWixJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcscURBQUMsVUFBVSxnREFBZ0Q7QUFDdEU7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVrQzs7QUFFbEM7Ozs7Ozs7Ozs7Ozs7OztBQzk1RDJFO0FBQzlDO0FBQ0s7QUFDRjs7QUFFaEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2JhLWluZm9ncmFwaGljL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2J1c2luZXNzLWFuYWx5c3QtY29tcG9uZW50cy9kaXN0L3N0ZW5jaWwtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtaW5mb2dyYXBoaWMtMDk4OTU0YjcuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWluZm9ncmFwaGljLmVudHJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC00ZTY0NzQxMS5qcyc7XG5pbXBvcnQgeyBCIGFzIEJhUmVwb3J0c0xhbmd1YWdlLCBFIGFzIEVsZW1lbnRJZHMsIFUgYXMgVXRpbHMsIGEgYXMgQmFzZVV0aWwsIEEgYXMgQUNMVXRpbHMgfSBmcm9tICcuL0VsZW1lbnRJZHMtZjdkMjU3ZTguanMnO1xuaW1wb3J0IHsgUyBhcyBTZXR0aW5nc0hlbHBlciwgRSBhcyBFbnZpcm9ubWVudHMsIFQgYXMgVG9rZW5Qcm92aWRlciwgRyBhcyBHRUNsaWVudCB9IGZyb20gJy4vR0VDbGllbnQtMWE4M2E2NTcuanMnO1xuXG5jbGFzcyBEZWJ1Z0xvZyB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZml4Rm9yTGludCA9ICcnO1xuICB9XG4gIHN0YXRpYyBsb2codGl0bGUsIC4uLmxpc3QpIHtcbiAgICBpZiAoRGVidWdMb2cuc2hvd0RlYnVnQ29uc29sZUxvZ3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKCc9PT09PT09PicgKyB0aXRsZSArICc6ICcpO1xuICAgICAgaWYgKGxpc3QgJiYgbGlzdC5sZW5ndGgpIHtcbiAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGxpc3QubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJy4uLicsIGxpc3RbaWldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuRGVidWdMb2cuc2hvd0RlYnVnQ29uc29sZUxvZ3MgPSBmYWxzZTtcblxuZnVuY3Rpb24gc2V0RW52aXJvbm1lbnQoZW52aXJvbm1lbnQpIHtcbiAgdHJ5IHtcbiAgICBpZiAoZW52aXJvbm1lbnQgIT0gbnVsbCAmJiBlbnZpcm9ubWVudC5sZW5ndGggPiAwKSB7XG4gICAgICBTZXR0aW5nc0hlbHBlci5zZXRFbnZpcm9ubWVudChlbnZpcm9ubWVudCk7XG4gICAgICByZXR1cm4gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignb2snKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignaW52YWxpZC1lbnZpcm9ubWVudCcpO1xuICAgIH1cbiAgfVxuICBjYXRjaCAoZXgpIHtcbiAgICByZXR1cm4gZXg7XG4gIH1cbn1cblxuY2xhc3MgSW5mb2dyYXBoaWNzSGVscGVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cbiAgc3RhdGljIG9wZW5JbmZvZ3JhcGhpY3MoaWdJdGVtSWQsIGhpZXJhcmNoeUlkLCBnZW9tZXRyeSwgY291bnRyeUlEKSB7XG4gICAgdHJ5IHtcbiAgICAgIEluZm9ncmFwaGljc0hlbHBlci5fZ2V0SW5mb2dyYXBoaWNzUGxheWVyVXJsKCkudGhlbigocGxheWVyUGFnZVVybCkgPT4ge1xuICAgICAgICBJbmZvZ3JhcGhpY3NIZWxwZXIuX29wZW5JbmZvZ3JhcGhpY3NUYWIocGxheWVyUGFnZVVybCwgSW5mb2dyYXBoaWNzSGVscGVyLl9nZXRJbmZvZ3JhcGhpY3NQYXJhbXMoaWdJdGVtSWQsIGhpZXJhcmNoeUlkLCBnZW9tZXRyeSwgY291bnRyeUlEKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICBjb25zb2xlLmxvZygnSW5mb2dyYXBoaWNIZWxwZXIgRXJyb3Igd2hpbGUgZ2V0dGluZyBwbGF5ZXIgVVJMOiAnLCBleCk7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBfZ2V0SW5mb2dyYXBoaWNzUGxheWVyVXJsKCkge1xuICAgIHJldHVybiAobmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKEluZm9ncmFwaGljc0hlbHBlci5faW5mb2dyYXBoaWNzUGxheWVyUGFnZVVybCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgcGxheWVyUGFnZVVybCA9IEVudmlyb25tZW50cy5nZXRVcmwoJ2luZm9ncmFwaGljcycpO1xuICAgICAgZmV0Y2gocGxheWVyUGFnZVVybCwgeyBtZXRob2Q6ICdIRUFEJyB9KVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHJlc3BvbnNlLm9rID8gcmVzb2x2ZShwbGF5ZXJQYWdlVXJsKSA6IHJlamVjdCgpO1xuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfSkpO1xuICB9XG4gIHN0YXRpYyBfb3BlbkluZm9ncmFwaGljc1RhYihwbGF5ZXJQYWdlVXJsLCBpbmZvZ3JhcGhpY1BhcmFtZXRlcnMpIHtcbiAgICB2YXIgd25kID0gd2luZG93Lm9wZW4ocGxheWVyUGFnZVVybCwgJ19ibGFuaycpO1xuICAgIHZhciBvbk1lc3NhZ2UgPSBmdW5jdGlvbiAoX3duZCkge1xuICAgICAgdmFyIG1lc3NhZ2VIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBocmVmID0gZXZlbnQuZGF0YSAmJiBldmVudC5kYXRhLmhyZWY7XG4gICAgICAgIHZhciBzdGF0dXMgPSBldmVudC5kYXRhICYmIGV2ZW50LmRhdGEuc3RhdHVzO1xuICAgICAgICBpZiAoaHJlZiA9PT0gcGxheWVyUGFnZVVybCAmJiBzdGF0dXMgPT09ICd3YWl0aW5nX2Zvcl9pbmZvZ3JhcGhpY19wYXJhbWV0ZXJzJykge1xuICAgICAgICAgIF93bmQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgdHlwZTogJ2luZm9ncmFwaGljX3BhcmFtZXRlcnMnLFxuICAgICAgICAgICAgaW5mb2dyYXBoaWNQYXJhbWV0ZXJzOiBpbmZvZ3JhcGhpY1BhcmFtZXRlcnNcbiAgICAgICAgICB9LCBocmVmKTtcbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG1lc3NhZ2VIYW5kbGVyKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWVzc2FnZUhhbmRsZXI7XG4gICAgfTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG9uTWVzc2FnZSh3bmQpKTtcbiAgfVxuICBzdGF0aWMgX2dldEluZm9ncmFwaGljc1BhcmFtcyhpZ0l0ZW1JZCwgaGllcmFyY2h5SWQsIGdlb21ldHJ5LCBjb3VudHJ5SUQpIHtcbiAgICB2YXIgdG9rZW4gPSBUb2tlblByb3ZpZGVyLnRva2VuLmFjY2Vzc190b2tlbjtcbiAgICB2YXIgdXNlcklkID0gVG9rZW5Qcm92aWRlci50b2tlbi51c2VybmFtZTtcbiAgICBsZXQgdG9rZW5FeHBpcmVzID0gVG9rZW5Qcm92aWRlci50b2tlbi5leHBpcmVzX2luO1xuICAgIGxldCB0cyA9IERhdGUubm93KCk7XG4gICAgbGV0IHRpbWVvdXQgPSAodG9rZW5FeHBpcmVzID09IG51bGwpID8gdHMgKyA2MDAwMDAgOiB0b2tlbkV4cGlyZXMgLSB0cztcbiAgICB2YXIgZXhwaXJlcyA9IE1hdGguZmxvb3IodGltZW91dCAvIDYwMDAwICsgMC41KTtcbiAgICB2YXIgc2VydmVyID0gU2V0dGluZ3NIZWxwZXIuZ2V0UG9ydGFsQmFzZVVybCgpO1xuICAgIC8vIHZhciBmdWxsUGFnZXNPbmx5ID0gQkEuTG9jYWxTdG9yYWdlLmdldFZhbHVlKEJBLnNldHRpbmdzLmxvY2FsU3RvcmFnZUlEX3Nob3dGdWxsSW5mb2dyYXBoaWNzKTtcbiAgICAvLyBmdWxsUGFnZXNPbmx5ID0gU2V0dGluZ3NIZWxwZXIuaXNUcnVlU3RyaW5nKGZ1bGxQYWdlc09ubHkpO1xuICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICBzZXJ2ZXI6IHNlcnZlcixcbiAgICAgIHVzZXJJZDogdXNlcklkLFxuICAgICAgdG9rZW46IHRva2VuLFxuICAgICAgZXhwaXJlczogZXhwaXJlcyxcbiAgICAgIHJlcG9ydElEOiBpZ0l0ZW1JZCxcbiAgICAgIGNvdW50cnlJRDogY291bnRyeUlELFxuICAgICAgaGllcmFyY2h5OiBoaWVyYXJjaHlJZCxcbiAgICAgIC8vIGZ1bGxQYWdlc09ubHk6IGZ1bGxQYWdlc09ubHlcbiAgICAgIGFuYWx5c2lzQXJlYXM6IFt7XG4gICAgICAgICAgZmVhdHVyZToge1xuICAgICAgICAgICAgZ2VvbWV0cnk6IGdlb21ldHJ5XG4gICAgICAgICAgfVxuICAgICAgICB9XVxuICAgIH07XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG4gIH1cbn1cblxuLy8gbm9pbnNwZWN0aW9uIEpTVW51c2VkR2xvYmFsU3ltYm9sc1xuY2xhc3MgVHJhbnNwb3J0VXRpbCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZml4Rm9yTGludCA9ICcnO1xuICAgIC8vIGRlYnVnIGxvZ2dpbmcgc2V0IHRvIHRydWVcbiAgfVxuICAvLyBwdWJsaWMgc3RhdGljIEdFVXJsID1cbiAgLy8gICAnaHR0cHM6Ly9nZW9lbnJpY2guYXJjZ2lzLmNvbS9hcmNnaXMvcmVzdC9zZXJ2aWNlcy9Xb3JsZC9nZW9lbnJpY2htZW50c2VydmVyL0dlb2VucmljaG1lbnQvRW5yaWNoJzsvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgc3RhdGljIHNldFRva2VuKHVzZXJuYW1lLCB0b2tlbikge1xuICAgIFRva2VuUHJvdmlkZXIuc2V0VG9rZW4odXNlcm5hbWUsIHRva2VuKTtcbiAgfVxuICAvKipcbiAgICogTWFrZXMgR0UgY2FsbCB0byBnZW5lcmF0ZSBkcml2ZXRpbWUgb3Igd2Fsa3RpbWUgYnVmZmVyc1xuICAgKlxuICAgKiBAcGFyYW0gbW9kZSA9ICdkcml2ZXRpbWUnIG9yICd3YWxrdGltZSdcbiAgICogQHBhcmFtIHNvdXJjZUNvdW50cnlcbiAgICogQHBhcmFtIHVuaXRzID0gJ21pbnV0ZXMsICdtaWxlcycgb3IgJ2tpbG9tZXRlcnMnXG4gICAqIEBwYXJhbSBidWZmZXJWYWx1ZXMgID0gMSwzLDVcbiAgICogQHBhcmFtIGxvbmdpdHVkZVxuICAgKiBAcGFyYW0gbGF0aXR1ZGVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRCdWZmZXJzKG1vZGUsIHNvdXJjZUNvdW50cnksIHVuaXRzLCBidWZmZXJWYWx1ZXMsIGxvbmdpdHVkZSwgbGF0aXR1ZGUpIHtcbiAgICBpZiAobW9kZSAhPSAnZHJpdmV0aW1lJyAmJiBtb2RlICE9ICd3YWxrdGltZScpIHtcbiAgICAgIHRocm93ICgnVHJhbnNwb3J0VXRpbCAtIGludmFsaWQgYXJncycpO1xuICAgIH1cbiAgICBpZiAoVHJhbnNwb3J0VXRpbC5oYXNUZXh0KHNvdXJjZUNvdW50cnkpICYmXG4gICAgICBUcmFuc3BvcnRVdGlsLmhhc1RleHQodW5pdHMpICYmXG4gICAgICBidWZmZXJWYWx1ZXMgJiZcbiAgICAgIHR5cGVvZiBsb25naXR1ZGUgIT0gdW5kZWZpbmVkICYmXG4gICAgICB0eXBlb2YgbGF0aXR1ZGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgcGFyYW1zID0gYXdhaXQgVHJhbnNwb3J0VXRpbC5nZXRQYXJhbXMobW9kZSwgc291cmNlQ291bnRyeSwgdW5pdHMsIGJ1ZmZlclZhbHVlcywgbG9uZ2l0dWRlLCBsYXRpdHVkZSk7XG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBHRUNsaWVudC5lbnJpY2gocGFyYW1zKTtcbiAgICAgIGxldCBzcGF0aWFsID0gcmVzcG9uc2UucmVzdWx0c1swXS52YWx1ZS5GZWF0dXJlU2V0WzBdLnNwYXRpYWxSZWZlcmVuY2U7XG4gICAgICBsZXQgb2JqID0gVHJhbnNwb3J0VXRpbC5wYXJzZVJpbmdzKHJlc3BvbnNlKTtcbiAgICAgIGlmIChvYmopIHtcbiAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IG9iai5sZW5ndGg7IGlpKyspIHtcbiAgICAgICAgICBpZiAob2JqW2lpXSkge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSBvYmpbaWldO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgaXRlbS50cmFuc3BvcnQgPSBtb2RlID09ICdkcml2ZXRpbWUnID8gJ2RyaXZlJyA6ICd3YWxrJztcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGl0ZW0ubGF0aXR1ZGUgPSBsYXRpdHVkZTtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGl0ZW0ubG9uZ2l0dWRlID0gbG9uZ2l0dWRlO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgaXRlbS5zcGF0aWFsID0gc3BhdGlhbDtcbiAgICAgICAgICAgIC8vIGxvY2F0aW9uIG1hcmtlclxuICAgICAgICAgICAgaXRlbS5sb2NhdGlvbiA9IHtcbiAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgICAgICAgICB4OiBsb25naXR1ZGUsXG4gICAgICAgICAgICAgICAgeTogbGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZToge1xuICAgICAgICAgICAgICAgICAgd2tpZDogNDMyNlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc3ltYm9sOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2VzcmlQTVMnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDI2LjYsXG4gICAgICAgICAgICAgICAgeG9mZnNldDogMCxcbiAgICAgICAgICAgICAgICB5b2Zmc2V0OiAxMi42LFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcbiAgICAgICAgICAgICAgICBpbWFnZURhdGE6ICdpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQk1BQUFBakNBWUFBQUIyS2pGaEFBQUN0VWxFUVZSSVMrMldTMHdUVVJTRy96dlQwa3Bma0dKNHBHQ1ZpQTFFbTlDdENRVng1UUlXaGlWUm84R2RTTnlwcUhFbGtjZ09selZoNWFwMVg2bkVpQWtRWHpHQnhrU0t0WkMwamRUU0I3U2RNWGR3Ump1ZEIrdzVxNXQ3VDc3NXozL096UjBDV2JUNHg5MEdsaDBDTUV4NDNnMUMzRklLejYvemhLd0RDSllybGRCV1pJYXVwU0RpcXNFLzNtQmptR2VNeVhMRjdHaUJ1YkVWaG1OMnNJWTZLYmxTM2tPNThCdkZYNXNvWnJiQTdlWUNXWTY3dlIyWjJhWkpBb3lxTVRMTXZMWE40N2ExZWVSaVVTcm1VU3JtaEhTR05ZQTExb0d0TXlPM0ZjVk9Zblc5eEhIOVZLVUFjdzFNZkhTYzlIa3R6dllhRU4zNEI2c3V5bVN4Q3dvenNRK1JlSGk2bjdnRzcvaU5adnY4OFc2L0lrZ2R0bCtZMmQ2STVOZlhxSlFLL2NRMU1QSFExdVo1b0ZTZVNGZFd0bjlLeTkzYi9vbHNZdlVSaFVXY1hlZjdUUGFtR21XWGZNM29QZVZBaThPSWVES0xwV2dTcnhZM3F2SVkxZ2pDbDVHT3ZuMmpDTE9hV1V5TjlzRFg2YWo1d05KYUVyZG0zeU5iS0FsbnVyQ3AwVzcwOVRoVlBReStpK0graXhWOTJPbFdDK2JHZTFWQjRzSGx4MkdzeFRQYXlxaFBreU5kdXJCN2dSV0VGbVBhc0JzWFQrRDZZSWN1N01uTHo1Z0xmOU9HMGU3TmpwM1RoVjJiWHNCU05LVU5vNTE4ZnRNTDZwMWFVSytvWndmcUpnVlJJQVhMZzQ3RTFhY0xndmtIZ3RHazFrWVRKa2ZPQ0VNcnhuSTBoYnVCWlNUU2VXbFBkODdrYXBycWVXd2tVb3BWSHhxbWRUZVBZTXFUZGVSWjlkMXN2ekFSdExuT0RsbWJPMVh2b3FwbmhNQmthVUFoSFVNMi9pVkU2T05yWlpqSW9aKzZ2NkJpWmhPWjd5dWZkampPTDd5YmVzQWFaUW9nK3FwWC9SNm9LYXlDcVlDb0tBbW1wVkNDYVlCcVlHcEFBYmFiRjh6KzN5UHhoMFhzWEpVeWNWUHVZV20zSUl5QUZraFJtUm93bC80aGRVMnVTRk9aSEZqdjdQRG0weHRDKzlWQW1zcGt3T0FPeHcxcmdXaitINHVWSDZoajA4SFNBQUFBQUVsRlRrU3VRbUNDJ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgc3RhdGljIHBhcnNlUmluZ3MocmVzcG9uc2UpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnJWMgVFJBTlNQT1JUX1VUSUwgcGFyc2VSaW5ncyAnLCAnY29sb3I6Z3JlZW47Zm9udC1zaXplOjEycHQnKVxuICAgIHZhciByaW5ncyA9IFtdO1xuICAgIHZhciBjaGVja2VkID0ge307XG4gICAgdHJ5IHtcbiAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5yZXN1bHRzICYmIHJlc3BvbnNlLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgZmVhdHVyZVNldCA9IHJlc3BvbnNlLnJlc3VsdHNbMF0udmFsdWUuRmVhdHVyZVNldFswXTtcbiAgICAgICAgaWYgKGZlYXR1cmVTZXQuZmVhdHVyZXMgJiYgZmVhdHVyZVNldC5mZWF0dXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGZlYXR1cmVTZXQuZmVhdHVyZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgICBsZXQgZiA9IGZlYXR1cmVTZXQuZmVhdHVyZXNbaWldO1xuICAgICAgICAgICAgbGV0IGJ1ZmZlclZhbHVlID0gZi5hdHRyaWJ1dGVzLmJ1ZmZlclJhZGlpO1xuICAgICAgICAgICAgLy8gZmlsdGVyIG91dCBkdXBsaWNhdGUgcmluZ3NcbiAgICAgICAgICAgIGlmICghY2hlY2tlZFtidWZmZXJWYWx1ZV0pIHtcbiAgICAgICAgICAgICAgY2hlY2tlZFtidWZmZXJWYWx1ZV0gPSB0cnVlO1xuICAgICAgICAgICAgICBsZXQgYnVmZmVyVW5pdHMgPSBmLmF0dHJpYnV0ZXMuYnVmZmVyVW5pdHM7XG4gICAgICAgICAgICAgIGxldCByID0gZi5nZW9tZXRyeS5yaW5ncztcbiAgICAgICAgICAgICAgcmluZ3MucHVzaCh7IHZhbHVlOiBidWZmZXJWYWx1ZSwgdW5pdHM6IGJ1ZmZlclVuaXRzLCByaW5nczogciB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJpbmdzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgY29uc29sZS5sb2coJ1RyYW5zcG9ydFV0aWwgcGFyc2UgR0UgcmVzdWx0IGlzIGludmFsaWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBzdGF0aWMgaGFzVGV4dChzKSB7XG4gICAgbGV0IHRlc3QgPSAodHlwZW9mIHMgIT0gdW5kZWZpbmVkICYmIHMudHJpbSgpLmxlbmd0aCA+IDApO1xuICAgIHJldHVybiB0ZXN0O1xuICB9XG4gIHN0YXRpYyBjYWxjdWxhdGVTaW1wbGlmaWNhdGlvbihtb2RlLCBidWZmZXJVbml0cywgYnVmZmVyVmFsdWVzKSB7XG4gICAgbGV0IGZhY3RvciA9IDEwO1xuICAgIGxldCBtYXggPSAxO1xuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBidWZmZXJWYWx1ZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBtYXggPSAoYnVmZmVyVmFsdWVzW2lpXSA+IG1heCkgPyBidWZmZXJWYWx1ZXNbaWldIDogbWF4O1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ2RyaXZldGltZScpIHtcbiAgICAgIHN3aXRjaCAoYnVmZmVyVW5pdHMpIHtcbiAgICAgICAgY2FzZSAoJ21pbnV0ZXMnKToge1xuICAgICAgICAgIGZhY3RvciA9IE1hdGgubWF4KDEwLCAoMC4wMDYxNCAqIG1heCAqIG1heCkgKyAoMy41ICogbWF4KSAtIDQwKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICgnbWlsZXMnKToge1xuICAgICAgICAgIGZhY3RvciA9IE1hdGgubWF4KDEwLCAoOC41ICogbWF4KSAtIDEwMCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoJ2tpbG9tZXRlcnMnKToge1xuICAgICAgICAgIGZhY3RvciA9IE1hdGgubWF4KDEwLCAoNS4zMjMzICogbWF4KSAtIDYwKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChtb2RlID09PSAnd2Fsa3RpbWUnKSB7XG4gICAgICBzd2l0Y2ggKGJ1ZmZlclVuaXRzKSB7XG4gICAgICAgIGNhc2UgKCdtaW51dGVzJyk6IHtcbiAgICAgICAgICBmYWN0b3IgPSBNYXRoLm1heCgyLCAoMC4xNDM3ICogbWF4KSAtIDguNyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoJ21pbGVzJyk6IHtcbiAgICAgICAgICBmYWN0b3IgPSBNYXRoLm1heCgyLCAoNC43ICogbWF4KSAtIDI2LjgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgKCdraWxvbWV0ZXJzJyk6IHtcbiAgICAgICAgICBmYWN0b3IgPSBNYXRoLm1heCgyLCAoMy4xMSAqIG1heCkgLSAzMi43KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFjdG9yO1xuICB9XG4gIC8qXG4gICAqIGdldFBhcmFtcyAtIGdlbmVyYXRlcyByZXF1ZXN0IHBhcmFtZXRlcnMgZm9yIGRyaXZldGltZSBvciB3YWxrdGltZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFBhcmFtcyhtb2RlLCBzb3VyY2VDb3VudHJ5LCB1bml0cywgYnVmZmVyVmFsdWVzLCBsb25naXR1ZGUsIGxhdGl0dWRlKSB7XG4gICAgbGV0IGlzVGltZSA9IHVuaXRzLnRvTG93ZXJDYXNlKCkgPT0gJ21pbnV0ZXMnO1xuICAgIGxldCBpc0RyaXZldGltZSA9IG1vZGUgPT0gJ2RyaXZldGltZSc7XG4gICAgLy8gbGV0IGRlZmF1bHRIaWVyYXJjaHkgPSBhd2FpdCBHRUNsaWVudC5nZXRHRURlZmF1bHRIaWVyYXJjaHkoc291cmNlQ291bnRyeSlcbiAgICBjb25zdCBzaW1wbGVGYWN0b3IgPSB0aGlzLmNhbGN1bGF0ZVNpbXBsaWZpY2F0aW9uKG1vZGUsIHVuaXRzLCBidWZmZXJWYWx1ZXMpO1xuICAgIC8vIGxldCBjb3VudHJ5T2JqID0ge1xuICAgIC8vICAgc291cmNlQ291bnRyeTogc291cmNlQ291bnRyeSxcbiAgICAvLyAgIGhpZXJhcmNoeTogZGVmYXVsdEhpZXJhcmNoeVxuICAgIC8vIH1cbiAgICAvLyBsZXQganNvbkRhdGE6IHN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGNvdW50cnlPYmopXG4gICAgbGV0IHN0dWR5T2JqO1xuICAgIC8vIERSSVZJTkcgQlVGRkVSU1xuICAgIGlmIChpc0RyaXZldGltZSkge1xuICAgICAgc3R1ZHlPYmogPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBidWZmZXJVbml0czogaXNUaW1lID8gJ01pbnV0ZXMnIDogKHVuaXRzID09ICdtaWxlcycpID8gJ2VzcmlNaWxlcycgOiAnZXNyaUtpbG9tZXRlcnMnLFxuICAgICAgICAgIGJ1ZmZlclJhZGlpOiBidWZmZXJWYWx1ZXMsXG4gICAgICAgICAgYXJlYVR5cGU6ICdOZXR3b3JrU2VydmljZUFyZWEnLFxuICAgICAgICAgIHRyYXZlbF9tb2RlOiB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVQYXJhbWV0ZXJWYWx1ZXM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBVbnBhdmVkIFJvYWRzJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnQVZPSURfSElHSCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBQcml2YXRlIFJvYWRzJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnQVZPSURfTUVESVVNJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ0RyaXZpbmcgYW4gQXV0b21vYmlsZScsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BST0hJQklURUQnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnVGhyb3VnaCBUcmFmZmljIFByb2hpYml0ZWQnLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdBVk9JRF9ISUdIJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ1RyYXZlbFRpbWUnLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdWZWhpY2xlIE1heGltdW0gU3BlZWQgKGttL2gpJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogMFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ1JvYWRzIFVuZGVyIENvbnN0cnVjdGlvbiBQcm9oaWJpdGVkJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnUFJPSElCSVRFRCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBHYXRlcycsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ0FWT0lEX01FRElVTSdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBFeHByZXNzIExhbmVzJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnUFJPSElCSVRFRCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdBdm9pZCBDYXJwb29sIFJvYWRzJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnUFJPSElCSVRFRCdcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGRpc3RhbmNlQXR0cmlidXRlTmFtZTogJ0tpbG9tZXRlcnMnLFxuICAgICAgICAgICAgaWQ6ICdGRWdpZlJ0Rm5kS05jSk1KJyxcbiAgICAgICAgICAgIGltcGVkYW5jZUF0dHJpYnV0ZU5hbWU6IChpc1RpbWUpID8gJ1RyYXZlbFRpbWUnIDogJ0tpbG9tZXRlcnMnLFxuICAgICAgICAgICAgbmFtZTogKGlzVGltZSkgPyAnRHJpdmluZyBUaW1lJyA6ICdEcml2aW5nIERpc3RhbmNlJyxcbiAgICAgICAgICAgIHJlc3RyaWN0aW9uQXR0cmlidXRlTmFtZXM6IFtcbiAgICAgICAgICAgICAgJ0F2b2lkIFVucGF2ZWQgUm9hZHMnLFxuICAgICAgICAgICAgICAnQXZvaWQgUHJpdmF0ZSBSb2FkcycsXG4gICAgICAgICAgICAgICdEcml2aW5nIGFuIEF1dG9tb2JpbGUnLFxuICAgICAgICAgICAgICAnVGhyb3VnaCBUcmFmZmljIFByb2hpYml0ZWQnLFxuICAgICAgICAgICAgICAnUm9hZHMgVW5kZXIgQ29uc3RydWN0aW9uIFByb2hpYml0ZWQnLFxuICAgICAgICAgICAgICAnQXZvaWQgR2F0ZXMnLFxuICAgICAgICAgICAgICAnQXZvaWQgRXhwcmVzcyBMYW5lcycsXG4gICAgICAgICAgICAgICdBdm9pZCBDYXJwb29sIFJvYWRzJ1xuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHNpbXBsaWZpY2F0aW9uVG9sZXJhbmNlOiBzaW1wbGVGYWN0b3IsXG4gICAgICAgICAgICBzaW1wbGlmaWNhdGlvblRvbGVyYW5jZVVuaXRzOiAnZXNyaU1ldGVycycsXG4gICAgICAgICAgICB0aW1lQXR0cmlidXRlTmFtZTogJ1RyYXZlbFRpbWUnLFxuICAgICAgICAgICAgdHlwZTogJ0FVVE9NT0JJTEUnLFxuICAgICAgICAgICAgdXNlSGllcmFyY2h5OiB0cnVlLFxuICAgICAgICAgICAgdXR1cm5BdEp1bmN0aW9uczogJ2VzcmlORlNCQXREZWFkRW5kc0FuZEludGVyc2VjdGlvbnMnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdNb2RlbHMgdGhlIG1vdmVtZW50IG9mIGNhcnMgYW5kIG90aGVyIHNpbWlsYXIgc21hbGwgYXV0b21vYmlsZXMsIHN1Y2ggYXMgcGlja3VwIHRydWNrcywgYW5kIGZpbmRzIHNvbHV0aW9ucyB0aGF0IG9wdGltaXplIHRyYXZlbCB0aW1lLiBUcmF2ZWwgb2JleXMgb25lLXdheSByb2FkcywgYXZvaWRzIGlsbGVnYWwgdHVybnMsIGFuZCBmb2xsb3dzIG90aGVyIHJ1bGVzIHRoYXQgYXJlIHNwZWNpZmljIHRvIGNhcnMuIFdoZW4geW91IHNwZWNpZnkgYSBzdGFydCB0aW1lLCBkeW5hbWljIHRyYXZlbCBzcGVlZHMgYmFzZWQgb24gdHJhZmZpYyBhcmUgdXNlZCB3aGVyZSBpdCBpcyBhdmFpbGFibGUuJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5ldHdvcmtPcHRpb25zOiB7XG4gICAgICAgICAgICAvLyB0cmF2ZWxfZGlyZWN0aW9uOiAnQXdheSBGcm9tIEZhY2lsaXR5JyxcbiAgICAgICAgICAgIHBvbHlnb25fb3ZlcmxhcF90eXBlOiAnRGlza3MnXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXR1cm5HZW9tZXRyeTogdHJ1ZSxcbiAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgeDogbG9uZ2l0dWRlLFxuICAgICAgICAgICAgeTogbGF0aXR1ZGUsXG4gICAgICAgICAgICBzcGF0aWFsUmVmZXJlbmNlOiB7XG4gICAgICAgICAgICAgIHdraWQ6IDQzMjYsXG4gICAgICAgICAgICAgIGxhdGVzdFdraWQ6IDQzMjZcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gV0FMS0lORyBCVUZGRVJTXG4gICAgICBzdHVkeU9iaiA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGJ1ZmZlclVuaXRzOiBpc1RpbWUgPyAnTWludXRlcycgOiAodW5pdHMgPT0gJ21pbGVzJykgPyAnZXNyaU1pbGVzJyA6ICdlc3JpS2lsb21ldGVycycsXG4gICAgICAgICAgYnVmZmVyUmFkaWk6IGJ1ZmZlclZhbHVlcyxcbiAgICAgICAgICBhcmVhVHlwZTogJ05ldHdvcmtTZXJ2aWNlQXJlYScsXG4gICAgICAgICAgdHJhdmVsX21vZGU6IHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZVBhcmFtZXRlclZhbHVlczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZTogJ1Jlc3RyaWN0aW9uIFVzYWdlJyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnQXZvaWQgUHJpdmF0ZSBSb2FkcycsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdBVk9JRF9NRURJVU0nXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdXYWxraW5nJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BST0hJQklURUQnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnUmVzdHJpY3Rpb24gVXNhZ2UnLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdQcmVmZXJyZWQgZm9yIFBlZGVzdHJpYW5zJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ1BSRUZFUl9MT1cnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnV2Fsa2luZyBTcGVlZCAoa20vaCknLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdXYWxrVGltZScsXG4gICAgICAgICAgICAgICAgdmFsdWU6IDVcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtZXRlck5hbWU6ICdSZXN0cmljdGlvbiBVc2FnZScsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ0F2b2lkIFJvYWRzIFVuc3VpdGFibGUgZm9yIFBlZGVzdHJpYW5zJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ0FWT0lEX0hJR0gnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0ZvbGxvd3MgcGF0aHMgYW5kIHJvYWRzIHRoYXQgYWxsb3cgcGVkZXN0cmlhbiB0cmFmZmljIGFuZCBmaW5kcyBzb2x1dGlvbnMgdGhhdCBvcHRpbWl6ZSB0cmF2ZWwgdGltZS4gVGhlIHdhbGtpbmcgc3BlZWQgaXMgc2V0IHRvIDUga2lsb21ldGVycyBwZXIgaG91ci4nLFxuICAgICAgICAgICAgaW1wZWRhbmNlQXR0cmlidXRlTmFtZTogaXNUaW1lID8gJ1dhbGtUaW1lJyA6ICdLaWxvbWV0ZXJzJyxcbiAgICAgICAgICAgIHNpbXBsaWZpY2F0aW9uVG9sZXJhbmNlVW5pdHM6ICdlc3JpTWV0ZXJzJyxcbiAgICAgICAgICAgIHV0dXJuQXRKdW5jdGlvbnM6ICdlc3JpTkZTQkFsbG93QmFja3RyYWNrJyxcbiAgICAgICAgICAgIHJlc3RyaWN0aW9uQXR0cmlidXRlTmFtZXM6IFtcbiAgICAgICAgICAgICAgJ0F2b2lkIFByaXZhdGUgUm9hZHMnLFxuICAgICAgICAgICAgICAnQXZvaWQgUm9hZHMgVW5zdWl0YWJsZSBmb3IgUGVkZXN0cmlhbnMnLFxuICAgICAgICAgICAgICAnUHJlZmVycmVkIGZvciBQZWRlc3RyaWFucycsXG4gICAgICAgICAgICAgICdXYWxraW5nJ1xuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHVzZUhpZXJhcmNoeTogZmFsc2UsXG4gICAgICAgICAgICBzaW1wbGlmaWNhdGlvblRvbGVyYW5jZTogc2ltcGxlRmFjdG9yLFxuICAgICAgICAgICAgdGltZUF0dHJpYnV0ZU5hbWU6ICdXYWxrVGltZScsXG4gICAgICAgICAgICBkaXN0YW5jZUF0dHJpYnV0ZU5hbWU6ICdLaWxvbWV0ZXJzJyxcbiAgICAgICAgICAgIHR5cGU6ICdXQUxLJyxcbiAgICAgICAgICAgIGlkOiAnY2FGQWdvVGhydlVwa0ZCVycsXG4gICAgICAgICAgICBuYW1lOiBpc1RpbWUgPyAnV2Fsa2luZyBUaW1lJyA6ICdXYWxraW5nIERpc3RhbmNlJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbmV0d29ya09wdGlvbnM6IHtcbiAgICAgICAgICAgIHBvbHlnb25fb3ZlcmxhcF90eXBlOiAnRGlza3MnXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXR1cm5HZW9tZXRyeTogdHJ1ZSxcbiAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgeDogbG9uZ2l0dWRlLFxuICAgICAgICAgICAgeTogbGF0aXR1ZGUsXG4gICAgICAgICAgICBzcGF0aWFsUmVmZXJlbmNlOiB7XG4gICAgICAgICAgICAgIHdraWQ6IDQzMjYsXG4gICAgICAgICAgICAgIGxhdGVzdFdraWQ6IDQzMjZcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICAgIGxldCBqc29uU3R1ZHkgPSBKU09OLnN0cmluZ2lmeShzdHVkeU9iaik7XG4gICAgY29uc3QgdXNlRGF0YSA9IEpTT04uc3RyaW5naWZ5KHsgXCJzb3VyY2VDb3VudHJ5XCI6IHNvdXJjZUNvdW50cnkgfSk7XG4gICAgbGV0IGpzb24gPSB7XG4gICAgICBcImRhdGFDb2xsZWN0aW9uc1wiOiBbXCJHbG9iYWxJbnRlcnNlY3RcIl0sXG4gICAgICBcInJldHVybkdlb21ldHJ5XCI6IHRydWUsXG4gICAgICBcIm91dFNSXCI6IFwie1xcXCJ3a2lkXFxcIjo0MzI2LCBcXFwibGF0ZXN0V2tpZFxcXCI6NDMyNn1cIixcbiAgICAgIFwic3R1ZHlhcmVhc1wiOiBqc29uU3R1ZHksXG4gICAgICBcInVzZURhdGFcIjogdXNlRGF0YSxcbiAgICAgIFwiZm9yU3RvcmFnZVwiOiBmYWxzZSxcbiAgICAgIFwiZlwiOiBcImpzb25cIlxuICAgIH07XG4gICAgcmV0dXJuIGpzb247XG4gIH1cbn1cblxuY2xhc3MgR2VvbWV0cnlVdGlsIHtcbiAgLypcbiAgICogIGdldFJpbmdzXG4gICAqXG4gICAqICBHZW5lcmF0ZXMgcmluZ3MgZm9yIGEgbG9jYXRpb24gaW4gdGhlIHNwZWNpZmllZCAndW5pdHMnLCBmb3JcbiAgICogIHRoZSAxLTMgcmFkaXVzIHZhbHVlc1xuICAgKlxuICAgKiAgdW5pdHMgPSBbbWlsZXMgb3Iga2lsb21ldGVyc11cbiAgICogIHZhbHVlcyA9IGFycmF5IG9mIHJhZGl1cyB2YWx1ZXMgdXNpbmcgMSB0byAzIHZhbHVlc1xuICAgKi9cbiAgc3RhdGljIGdldFJpbmdzKGxhdCwgbG9uLCB1bml0cywgdmFsdWVzLCBsb2NhdGlvbk5hbWUsIGxvY2F0aW9uQXR0cmlidXRlcykge1xuICAgIGlmICghdmFsdWVzIHx8IHZhbHVlcy5sZW5ndGggPD0gMCB8fCB2YWx1ZXMubGVuZ3RoID4gM1xuICAgICAgfHwgKHVuaXRzICE9ICdtaWxlcycgJiYgdW5pdHMgIT0gJ2tpbG9tZXRlcnMnKVxuICAgICAgfHwgKCFsYXQgfHwgIWxvbikpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdHZW9tZXRyeVV0aWw6IGludmFsaWQgYXJncycsIGxhdCwgbG9uLCB2YWx1ZXMpO1xuICAgICAgdGhyb3cgJ0dlb21ldHJ5VXRpbDogaW52YWxpZCBhcmdzJztcbiAgICB9XG4gICAgLy8gbGV0IGxhdGl0dWRlID0gcGFyc2VGbG9hdChsYXQpO1xuICAgIC8vIGxldCBsb25naXR1ZGUgPSBwYXJzZUZsb2F0KGxvbik7XG4gICAgbGV0IHJpbmdzID0gW107XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHZhbHVlcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGxldCBhcmVhID0gdGhpcy5nZXRBbmFseXNpc0FyZWFSaW5ncyhsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcywgaWksIGxvY2F0aW9uTmFtZSwgbG9jYXRpb25BdHRyaWJ1dGVzKTtcbiAgICAgIHJpbmdzLnB1c2goYXJlYSk7XG4gICAgfVxuICAgIHJldHVybiByaW5ncztcbiAgfVxuICBzdGF0aWMgZ2V0QW5hbHlzaXNBcmVhUmluZ3MobGF0LCBsb24sIHVuaXRzLCB2YWx1ZXMsIGluZGV4LCBsb2NhdGlvbk5hbWUsIGxvY2F0aW9uQXR0cmlidXRlcykge1xuICAgIGlmICghbGF0IHx8ICFsb24gfHwgdW5pdHMgPT0gdW5kZWZpbmVkIHx8ICF2YWx1ZXMgfHwgdmFsdWVzLmxlbmd0aCA8IDAgfHwgdmFsdWVzLmxlbmd0aCA+IDMpIHtcbiAgICAgIERlYnVnTG9nLmxvZygnYXJjZ2lzLWluZm9ncmFwaGljIGFuYWx5c2lzQXJlYXMgaW52YWxpZCBhcmdzOiAnLCBsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcyk7XG4gICAgICB0aHJvdyAoJ0dlb21ldHJ5VXRpbC5nZXRBbmFseXNpc0FyZWFSaW5nczogaW52YWxpZCBhcmdzJyk7XG4gICAgfVxuICAgIGxldCBzVW5pdHMgPSAodmFsdWVzW2luZGV4XSA9PSAxKSA/XG4gICAgICAodW5pdHMgPT0gJ21pbGVzJykgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlJykgOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdraWxvbWV0ZXInKSA6XG4gICAgICAodW5pdHMgPT0gJ21pbGVzJykgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlc0xvd2VyY2FzZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyc0xvd2VyY2FzZScpO1xuICAgIGZ1bmN0aW9uIGdldERlc2NyaXB0aW9uKCkge1xuICAgICAgbGV0IF91bml0ID0gKHVuaXRzID09ICdtaWxlcycpID8gJyAnICsgQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignbWlsZScpIDogJyAnICsgQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyJyk7XG4gICAgICByZXR1cm4gKEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ3Jpbmctc2VtaWNvbG9uJykgKyAnICcgKyB2YWx1ZXNbaW5kZXhdICsgX3VuaXQgKyAnICcgKyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdyYWRpdXNMb3dlcmNhc2UnKSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldE5hbWUoKSB7XG4gICAgICByZXR1cm4gdmFsdWVzW2luZGV4XSArICcgJyArIHNVbml0cztcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0U2hvcnROYW1lKCkge1xuICAgICAgcmV0dXJuIHZhbHVlc1tpbmRleF0gKyAnICcgKyBzVW5pdHM7XG4gICAgfVxuICAgIGxldCByZXN1bHQgPSB7XG4gICAgICBmZWF0dXJlOiB7XG4gICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgcmluZ3M6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICBSSU5HOiBpbmRleCArIDEsXG4gICAgICAgICAgREVTQ1JJUFRJT046ICcnLFxuICAgICAgICAgIGxhdGl0dWRlOiBsYXQsXG4gICAgICAgICAgbG9uZ2l0dWRlOiBsb24sXG4gICAgICAgICAgbmFtZTogZ2V0TmFtZSgpLFxuICAgICAgICAgIHNob3J0TmFtZTogZ2V0U2hvcnROYW1lKCksXG4gICAgICAgICAgZGVzY3JpcHRpb246IGdldERlc2NyaXB0aW9uKCksXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBsYXRpdHVkZTogbGF0LFxuICAgICAgbG9uZ2l0dWRlOiBsb24sXG4gICAgICBsb2NhdGlvbjoge1xuICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgIHg6IGxvbixcbiAgICAgICAgICB5OiBsYXQsXG4gICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZToge1xuICAgICAgICAgICAgd2tpZDogNDMyNlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3ltYm9sOiB7XG4gICAgICAgICAgdHlwZTogJ2VzcmlQTVMnLFxuICAgICAgICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICBoZWlnaHQ6IDI2LjYsXG4gICAgICAgICAgeG9mZnNldDogMCxcbiAgICAgICAgICB5b2Zmc2V0OiAxMi42LFxuICAgICAgICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcbiAgICAgICAgICBpbWFnZURhdGE6ICdpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQk1BQUFBakNBWUFBQUIyS2pGaEFBQUN0VWxFUVZSSVMrMldTMHdUVVJTRy96dlQwa3Bma0dKNHBHQ1ZpQTFFbTlDdENRVng1UUlXaGlWUm84R2RTTnlwcUhFbGtjZ09selZoNWFwMVg2bkVpQWtRWHpHQnhrU0t0WkMwamRUU0I3U2RNWGR3Ump1ZEIrdzVxNXQ3VDc3NXozL096UjBDV2JUNHg5MEdsaDBDTUV4NDNnMUMzRklLejYvemhLd0RDSllybGRCV1pJYXVwU0RpcXNFLzNtQmptR2VNeVhMRjdHaUJ1YkVWaG1OMnNJWTZLYmxTM2tPNThCdkZYNXNvWnJiQTdlWUNXWTY3dlIyWjJhWkpBb3lxTVRMTXZMWE40N2ExZWVSaVVTcm1VU3JtaEhTR05ZQTExb0d0TXlPM0ZjVk9Zblc5eEhIOVZLVUFjdzFNZkhTYzlIa3R6dllhRU4zNEI2c3V5bVN4Q3dvenNRK1JlSGk2bjdnRzcvaU5adnY4OFc2L0lrZ2R0bCtZMmQ2STVOZlhxSlFLL2NRMU1QSFExdVo1b0ZTZVNGZFd0bjlLeTkzYi9vbHNZdlVSaFVXY1hlZjdUUGFtR21XWGZNM29QZVZBaThPSWVES0xwV2dTcnhZM3F2SVkxZ2pDbDVHT3ZuMmpDTE9hV1V5TjlzRFg2YWo1d05KYUVyZG0zeU5iS0FsbnVyQ3AwVzcwOVRoVlBReStpK0graXhWOTJPbFdDK2JHZTFWQjRzSGx4MkdzeFRQYXlxaFBreU5kdXJCN2dSV0VGbVBhc0JzWFQrRDZZSWN1N01uTHo1Z0xmOU9HMGU3TmpwM1RoVjJiWHNCU05LVU5vNTE4ZnRNTDZwMWFVSytvWndmcUpnVlJJQVhMZzQ3RTFhY0xndmtIZ3RHazFrWVRKa2ZPQ0VNcnhuSTBoYnVCWlNUU2VXbFBkODdrYXBycWVXd2tVb3BWSHhxbWRUZVBZTXFUZGVSWjlkMXN2ekFSdExuT0RsbWJPMVh2b3FwbmhNQmthVUFoSFVNMi9pVkU2T05yWlpqSW9aKzZ2NkJpWmhPWjd5dWZkampPTDd5YmVzQWFaUW9nK3FwWC9SNm9LYXlDcVlDb0tBbW1wVkNDYVlCcVlHcEFBYmFiRjh6KzN5UHhoMFhzWEpVeWNWUHVZV20zSUl5QUZraFJtUm93bC80aGRVMnVTRk9aSEZqdjdQRG0weHRDKzlWQW1zcGt3T0FPeHcxcmdXaitINHVWSDZoajA4SFNBQUFBQUVsRlRrU3VRbUNDJ1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbmFtZTogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogZ2V0TmFtZSgpLFxuICAgICAgYWRkcmVzczogJycsXG4gICAgICBzaG9ydE5hbWU6IGdldFNob3J0TmFtZSgpLFxuICAgICAgbG9jYXRpb25OYW1lOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiBnZXROYW1lKCksXG4gICAgICBkZXNjcmlwdGlvbjogZ2V0RGVzY3JpcHRpb24oKVxuICAgIH07XG4gICAgLy8gQWRkIGF0dHJpYnV0ZXMgdGhhdCB3ZXJlIHBhc3NlZCBpblxuICAgIGlmIChsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcbiAgICAgIGNvbnN0IG1lcmdlZEF0dHJpYnV0ZXMgPSB7XG4gICAgICAgIC4uLmxvY2F0aW9uQXR0cmlidXRlcyxcbiAgICAgICAgLi4ucmVzdWx0LmZlYXR1cmUuYXR0cmlidXRlc1xuICAgICAgfTtcbiAgICAgIHJlc3VsdC5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xuICAgIH1cbiAgICBsZXQgciA9IEdlb21ldHJ5VXRpbC5fZ2VuZXJhdGVSaW5nKGxhdCwgbG9uLCB1bml0cywgdmFsdWVzW2luZGV4XSk7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJlc3VsdC5mZWF0dXJlLmdlb21ldHJ5LnJpbmdzLnB1c2gocik7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICAvLyBnZW5lcmF0ZSBBbmFseXNpcyBBcmVhcyBmb3IgIGluZm9ncmFwaGljXG4gIC8vXG4gIC8vIEV4cGVjdGluZyByaW5ncyA9IFsge3ZhbHVlLHVuaXRzLHJpbmdzfSwuLi5dXG4gIC8vXG4gIC8vIFJldHVybnM6ICBqc29uIGdlb21ldHJ5XG4gIHN0YXRpYyBnZXRBbmFseXNpc0FyZWFzRnJvbVJpbmdzKGRhdGEsIGxvY2F0aW9uTmFtZSwgbG9jYXRpb25BdHRyaWJ1dGVzKSB7XG4gICAgdmFyIG9iaiA9IHtcbiAgICAgIGFuYWx5c2lzQXJlYXM6IFtdXG4gICAgfTtcbiAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgZGF0YS5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGxldCBkID0gZGF0YVtpaV07XG4gICAgICBsZXQgaXNUaW1lID0gZC51bml0cy50b0xvd2VyQ2FzZSgpID09ICdtaW51dGVzJztcbiAgICAgIC8vIGxldCBpc1Npbmd1bGFyID0gZC52YWx1ZSA9PSAxO1xuICAgICAgbGV0IHVuaXRMb3cgPSBkLnVuaXRzLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgZGlzcGxheVVuaXRzID0gaXNUaW1lID8gQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignbWludXRlcycpIDogdW5pdExvdy5pbmRleE9mKCdtaWxlcycpID49IDAgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlc0xvd2VyY2FzZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyc0xvd2VyY2FzZScpO1xuICAgICAgbGV0IHNob3J0VW5pdHMgPSBkaXNwbGF5VW5pdHMuc3Vic3RyKDAsIGRpc3BsYXlVbml0cy5sZW5ndGggLSAxKTtcbiAgICAgIGxldCBzaG9ydE5hbWUgPSBkLnZhbHVlLnRvU3RyaW5nKCkgKyAnICcgKyBzaG9ydFVuaXRzICsgJyAnICsgZC50cmFuc3BvcnQ7XG4gICAgICBsZXQgZGVzY1VuaXQgPSBpc1RpbWUgPyAnICcgKyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCd0aW1lLXNlbWljb2xvbicpICsgJyAnIDogJyAnICsgQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bignZGlzdGFuY2Utc2VtaWNvbG9uJykgKyAnICc7XG4gICAgICBsZXQgZGVzY1ZhbHVlID0gZC52YWx1ZS50b1N0cmluZygpICsgJyAnICsgKGQudmFsdWUgPT0gMSA/IHNob3J0VW5pdHMgOiBkaXNwbGF5VW5pdHMpO1xuICAgICAgbGV0IGRlc2MgPSAoZC50cmFuc3BvcnQgPT0gJ2RyaXZlJyA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2RyaXZlJykgOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCd3YWxrJykpICsgZGVzY1VuaXQgKyBkZXNjVmFsdWU7XG4gICAgICBsZXQgYnVmZmVyID0ge1xuICAgICAgICAnZmVhdHVyZSc6IHtcbiAgICAgICAgICAnZ2VvbWV0cnknOiB7XG4gICAgICAgICAgICAncmluZ3MnOiBkLnJpbmdzLFxuICAgICAgICAgICAgJ3NwYXRpYWxSZWZlcmVuY2UnOiB7ICd3a2lkJzogNDMyNiB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICAnYXR0cmlidXRlcyc6IHtcbiAgICAgICAgICAgIC8vIFwiT0JKRUNUSURcIjogICAgICAxOSxcbiAgICAgICAgICAgIC8vICAgXCJSRUxJRFwiOiAgICAgICAgIFwiMDI4ZGRmMDEtYzI4MS00N2YyLTk3YmQtNGNjNTg2NDI0ODkwXCIsXG4gICAgICAgICAgICAnUklORyc6IGlpLFxuICAgICAgICAgICAgLy8gXCJERVNDUklQVElPTlwiOiAgIG51bGwsXG4gICAgICAgICAgICAnU1lNQk9MJzoge1xuICAgICAgICAgICAgICAnY29sb3InOiBbMjA0LCA1MSwgMCwgMTI4XSxcbiAgICAgICAgICAgICAgJ291dGxpbmUnOiB7XG4gICAgICAgICAgICAgICAgJ2NvbG9yJzogWzIwNCwgNTEsIDAsIDI1NV0sXG4gICAgICAgICAgICAgICAgJ3dpZHRoJzogMS41LFxuICAgICAgICAgICAgICAgICd0eXBlJzogJ2VzcmlTTFMnLFxuICAgICAgICAgICAgICAgICdzdHlsZSc6ICdlc3JpU0xTU29saWQnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICd0eXBlJzogJ2VzcmlTRlMnLFxuICAgICAgICAgICAgICAnc3R5bGUnOiAnZXNyaVNGU1NvbGlkJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgJ2xhdGl0dWRlJzogZC5sYXRpdHVkZSxcbiAgICAgICAgJ2xvbmdpdHVkZSc6IGQubG9uZ2l0dWRlLFxuICAgICAgICAnbmFtZSc6IGxvY2F0aW9uTmFtZSA/IGxvY2F0aW9uTmFtZSA6ICcnLFxuICAgICAgICAnYWRkcmVzcyc6ICcnLFxuICAgICAgICAnc2hvcnROYW1lJzogc2hvcnROYW1lLFxuICAgICAgICAnbG9jYXRpb25OYW1lJzogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogJycsXG4gICAgICAgICdkZXNjcmlwdGlvbic6IGRlc2MsXG4gICAgICAgICdsb2NhdGlvbic6IHtcbiAgICAgICAgICAnZ2VvbWV0cnknOiB7XG4gICAgICAgICAgICAneCc6IGQubG9uZ2l0dWRlLFxuICAgICAgICAgICAgJ3knOiBkLmxhdGl0dWRlLFxuICAgICAgICAgICAgJ3NwYXRpYWxSZWZlcmVuY2UnOiB7XG4gICAgICAgICAgICAgICd3a2lkJzogJzQzMjYnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICAnc3ltYm9sJzoge1xuICAgICAgICAgICAgJ3R5cGUnOiAnZXNyaVBNUycsXG4gICAgICAgICAgICAnd2lkdGgnOiAxNCxcbiAgICAgICAgICAgICdoZWlnaHQnOiAyNi42LFxuICAgICAgICAgICAgJ3hvZmZzZXQnOiAwLFxuICAgICAgICAgICAgJ3lvZmZzZXQnOiAxMi42LFxuICAgICAgICAgICAgJ2NvbnRlbnRUeXBlJzogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgICAnaW1hZ2VEYXRhJzogJ2lWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCTUFBQUFqQ0FZQUFBQjJLakZoQUFBQ3RVbEVRVlJJUysyV1Mwd1RVUlNHL3p2VDBrcGZrR0o0cEdDVmlBMUVtOUN0Q1FWeDVRSVdoaVZSbzhHZFNOeXBxSEVsa2NnT2x6Vmg1YXAxWDZuRWlBa1FYekdCeGtTS3RaQzBqZFRTQjdTZE1YZHdSanVkQit3NXE1dDdUNzc1ejMvT3pSMENXYlQ0eDkwR2xoMENNRXg0M2cxQzNGSUt6Ni96aEt3RENKWXJsZEJXWklhdXBTRGlxc0UvM21Cam1HZU15WExGN0dpQnViRVZobU4yc0lZNktibFMza081OEJ2Rlg1c29acmJBN2VZQ1dZNjd2UjJaMmFaSkFveXFNVExNdkxYTjQ3YTFlZVJpVVNybVVTcm1oSFNHTllBMTFvR3RNeU8zRmNWT1luVzl4SEg5VktVQWN3MU1mSFNjOUhrdHp2WWFFTjM0QjZzdXltU3hDd296c1ErUmVIaTZuN2dHNy9pTlp2djg4VzYvSWtnZHRsK1kyZDZJNU5mWHFKUUsvY1ExTVBIUTF1WjVvRlNlU0ZkV3RuOUt5OTNiL29sc1l2VVJoVVdjWGVmN1RQYW1HbVdYZk0zb1BlVkFpOE9JZURLTHBXZ1NyeFkzcXZJWTFnakNsNUdPdm4yakNMT2FXVXlOOXNEWDZhajV3TkphRXJkbTN5TmJLQWxudXJDcDBXNzA5VGhWUFF5K2krSCtpeFY5Mk9sV0MrYkdlMVZCNHNIbHgyR3N4VFBheXFoUGt5TmR1ckI3Z1JXRUZtUGFzQnNYVCtENllJY3U3TW5MejVnTGY5T0cwZTdOanAzVGhWMmJYc0JTTktVTm81MThmdE1MNnAxYVVLK29ad2ZxSmdWUklBWExnNDdFMWFjTGd2a0hndEdrMWtZVEprZk9DRU1yeG5JMGhidUJaU1RTZVdsUGQ4N2thcHJxZVd3a1VvcFZIeHFtZFRlUFlNcVRkZVJaOWQxc3Z6QVJ0TG5PRGxtYk8xWHZvcXBuaE1Ca2FVQWhIVU0yL2lWRTZPTnJaWmpJb1orNnY2QmlaaE9aN3l1ZmRqak9MN3liZXNBYVpRb2crcXBYL1I2b0theUNxWUNvS0FtbXBWQ0NhWUJxWUdwQUFiYWJGOHorM3lQeGgwWHNYSlV5Y1ZQdVlXbTNJSXlBRmtoUm1Sb3dsLzRoZFUydVNGT1pIRmp2N1BEbTB4dEMrOVZBbXNwa3dPQU94dzFyZ1dqK0g0dVZINmhqMDhIU0FBQUFBRWxGVGtTdVFtQ0MnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgLy8gQWRkIGF0dHJpYnV0ZXMgdGhhdCB3ZXJlIHBhc3NlZCBpblxuICAgICAgaWYgKGxvY2F0aW9uQXR0cmlidXRlcykge1xuICAgICAgICBjb25zdCBtZXJnZWRBdHRyaWJ1dGVzID0ge1xuICAgICAgICAgIC4uLmxvY2F0aW9uQXR0cmlidXRlcyxcbiAgICAgICAgICAuLi5idWZmZXIuZmVhdHVyZS5hdHRyaWJ1dGVzXG4gICAgICAgIH07XG4gICAgICAgIGJ1ZmZlci5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xuICAgICAgfVxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgb2JqLmFuYWx5c2lzQXJlYXMucHVzaChidWZmZXIpO1xuICAgIH1cbiAgICBsZXQgcyA9IEpTT04uc3RyaW5naWZ5KG9iaikucmVwbGFjZSgne1wiYW5hbHlzaXNBcmVhc1wiJywgJ1wiYW5hbHlzaXNBcmVhc1wiJyk7XG4gICAgcmV0dXJuIHMuc3Vic3RyKDAsIHMubGVuZ3RoIC0gMSk7XG4gIH1cbiAgc3RhdGljIGdldEFuYWx5c2lzQXJlYXNGcm9tUG9seWdvbihkYXRhLCBsb2NhdGlvbk5hbWUsIGxvY2F0aW9uQXR0cmlidXRlcykge1xuICAgIGlmICghZGF0YSB8fCAhZGF0YS5yaW5ncyB8fCAhZGF0YS5zcGF0aWFsKSB7XG4gICAgICBEZWJ1Z0xvZy5sb2coJ2dldEFuYWx5c2lzQXJlYXNGcm9tUG9seWdvbicsICdpbnZhbGlkIGFyZ3MnLCBkYXRhKTtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgY29uc3Qgb2JqID0ge1xuICAgICAgYW5hbHlzaXNBcmVhczogW1xuICAgICAgICB7XG4gICAgICAgICAgZmVhdHVyZToge1xuICAgICAgICAgICAgbmFtZTogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogJycsXG4gICAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgICByaW5nczogZGF0YS5yaW5ncyxcbiAgICAgICAgICAgICAgc3BhdGlhbFJlZmVyZW5jZTogZGF0YS5zcGF0aWFsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICBSSU5HOiAxLFxuICAgICAgICAgICAgICBTWU1CT0w6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogWzIwNCwgNTEsIDAsIDEyOF0sXG4gICAgICAgICAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgICAgICAgY29sb3I6IFsyMDQsIDUxLCAwLCAyNTVdLFxuICAgICAgICAgICAgICAgICAgd2lkdGg6IDEuNSxcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdlc3JpU0xTJyxcbiAgICAgICAgICAgICAgICAgIHN0eWxlOiAnZXNyaVNMU1NvbGlkJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHlwZTogJ2VzcmlTRlMnLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnZXNyaVNGU1NvbGlkJ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBuYW1lOiBsb2NhdGlvbk5hbWUgPyBsb2NhdGlvbk5hbWUgOiAnJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogbG9jYXRpb25OYW1lID8gbG9jYXRpb25OYW1lIDogJ2ZlYXR1cmUgcG9seWdvbidcbiAgICAgICAgICAvLyBsb2NhdGlvbjoge1xuICAgICAgICAgIC8vICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgICAvLyAgICAgeDogZGF0YS5sb25naXR1ZGUsXG4gICAgICAgICAgLy8gICAgIHk6IGRhdGEubGF0aXR1ZGUsXG4gICAgICAgICAgLy8gICAgIHNwYXRpYWxSZWZlcmVuY2U6IHtcbiAgICAgICAgICAvLyAgICAgICB3a2lkOiA0MzI2LFxuICAgICAgICAgIC8vICAgICB9LFxuICAgICAgICAgIC8vICAgfSxcbiAgICAgICAgICAvLyAgIHN5bWJvbDoge1xuICAgICAgICAgIC8vICAgICB0eXBlOiAnZXNyaVBNUycsXG4gICAgICAgICAgLy8gICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICAvLyAgICAgaGVpZ2h0OiAyNi42LFxuICAgICAgICAgIC8vICAgICB4b2Zmc2V0OiAwLFxuICAgICAgICAgIC8vICAgICB5b2Zmc2V0OiAxMi42LFxuICAgICAgICAgIC8vICAgICBjb250ZW50VHlwZTogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgLy8gICAgIGltYWdlRGF0YTogJ2lWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCTUFBQUFqQ0FZQUFBQjJLakZoQUFBQ3RVbEVRVlJJUysyV1Mwd1RVUlNHL3p2VDBrcGZrR0o0cEdDVmlBMUVtOUN0Q1FWeDVRSVdoaVZSbzhHZFNOeXBxSEVsa2NnT2x6Vmg1YXAxWDZuRWlBa1FYekdCeGtTS3RaQzBqZFRTQjdTZE1YZHdSanVkQit3NXE1dDdUNzc1ejMvT3pSMENXYlQ0eDkwR2xoMENNRXg0M2cxQzNGSUt6Ni96aEt3RENKWXJsZEJXWklhdXBTRGlxc0UvM21Cam1HZU15WExGN0dpQnViRVZobU4yc0lZNktibFMza081OEJ2Rlg1c29acmJBN2VZQ1dZNjd2UjJaMmFaSkFveXFNVExNdkxYTjQ3YTFlZVJpVVNybVVTcm1oSFNHTllBMTFvR3RNeU8zRmNWT1luVzl4SEg5VktVQWN3MU1mSFNjOUhrdHp2WWFFTjM0QjZzdXltU3hDd296c1ErUmVIaTZuN2dHNy9pTlp2djg4VzYvSWtnZHRsK1kyZDZJNU5mWHFKUUsvY1ExTVBIUTF1WjVvRlNlU0ZkV3RuOUt5OTNiL29sc1l2VVJoVVdjWGVmN1RQYW1HbVdYZk0zb1BlVkFpOE9JZURLTHBXZ1NyeFkzcXZJWTFnakNsNUdPdm4yakNMT2FXVXlOOXNEWDZhajV3TkphRXJkbTN5TmJLQWxudXJDcDBXNzA5VGhWUFF5K2krSCtpeFY5Mk9sV0MrYkdlMVZCNHNIbHgyR3N4VFBheXFoUGt5TmR1ckI3Z1JXRUZtUGFzQnNYVCtENllJY3U3TW5MejVnTGY5T0cwZTdOanAzVGhWMmJYc0JTTktVTm81MThmdE1MNnAxYVVLK29ad2ZxSmdWUklBWExnNDdFMWFjTGd2a0hndEdrMWtZVEprZk9DRU1yeG5JMGhidUJaU1RTZVdsUGQ4N2thcHJxZVd3a1VvcFZIeHFtZFRlUFlNcVRkZVJaOWQxc3Z6QVJ0TG5PRGxtYk8xWHZvcXBuaE1Ca2FVQWhIVU0yL2lWRTZPTnJaWmpJb1orNnY2QmlaaE9aN3l1ZmRqak9MN3liZXNBYVpRb2crcXBYL1I2b0theUNxWUNvS0FtbXBWQ0NhWUJxWUdwQUFiYWJGOHorM3lQeGgwWHNYSlV5Y1ZQdVlXbTNJSXlBRmtoUm1Sb3dsLzRoZFUydVNGT1pIRmp2N1BEbTB4dEMrOVZBbXNwa3dPQU94dzFyZ1dqK0g0dVZINmhqMDhIU0FBQUFBRWxGVGtTdVFtQ0MnLFxuICAgICAgICAgIC8vICAgfSxcbiAgICAgICAgICAvLyB9LFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfTtcbiAgICAvLyBBZGQgYXR0cmlidXRlcyB0aGF0IHdlcmUgcGFzc2VkIGluXG4gICAgaWYgKGxvY2F0aW9uQXR0cmlidXRlcykge1xuICAgICAgY29uc3QgbWVyZ2VkQXR0cmlidXRlcyA9IHtcbiAgICAgICAgLi4ubG9jYXRpb25BdHRyaWJ1dGVzLFxuICAgICAgICAuLi5vYmouYW5hbHlzaXNBcmVhc1swXS5mZWF0dXJlLmF0dHJpYnV0ZXNcbiAgICAgIH07XG4gICAgICBvYmouYW5hbHlzaXNBcmVhc1swXS5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xuICAgIH1cbiAgICBsZXQgcyA9IEpTT04uc3RyaW5naWZ5KG9iaikucmVwbGFjZSgne1wiYW5hbHlzaXNBcmVhc1wiJywgJ1wiYW5hbHlzaXNBcmVhc1wiJyk7XG4gICAgcmV0dXJuIHMuc3Vic3RyKDAsIHMubGVuZ3RoIC0gMSk7XG4gIH1cbiAgLyoqXG4gICAqIFRha2VzIGRhdGEgcmV0dXJuZWQgZnJvbSBnZXRCdWZmZXJzIGZvciBEVC9XVCBhbmQgcmV0dXJuc1xuICAgKiBqc29uIGFuYWx5c2lzIGFyZWFzXG4gICAqIEBwYXJhbSBkYXRhXG4gICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICovXG4gIHN0YXRpYyBnZXRBbmFseXNpc0FyZWFzRnJvbUVucmljaEJ1ZmZlcnMoZGF0YSwgbG9jYXRpb25OYW1lLCBsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcbiAgICBpZiAoIWRhdGEgfHwgZGF0YS5sZW5ndGggPD0gMCkge1xuICAgICAgRGVidWdMb2cubG9nKCdnZXRBbmFseXNpc0FyZWFzRnJvbUVucmljaEJ1ZmZlcnMnLCAnaW52YWxpZCBhcmdzJywgZGF0YSk7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgIGFuYWx5c2lzQXJlYXM6IFtdLFxuICAgICAgc3BhdGlhbFJlZmVyZW5jZTogZGF0YVswXS5zcGF0aWFsXG4gICAgfTtcbiAgICBsZXQgbGF0LCBsb247XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGRhdGEubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBsZXQgYnVmZmVyID0gZGF0YVtpaV07XG4gICAgICBpZiAoIWJ1ZmZlciB8fCAhYnVmZmVyLmxhdGl0dWRlIHx8ICFidWZmZXIubG9uZ2l0dWRlIHx8ICFidWZmZXIucmluZ3MpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgbGV0IGlzVGltZSA9IGJ1ZmZlci51bml0cy50b0xvd2VyQ2FzZSgpID09ICdtaW51dGVzJztcbiAgICAgIGxldCBpc1Npbmd1bGFyID0gYnVmZmVyLnZhbHVlID09IDE7XG4gICAgICBsZXQgdW5pdExvdyA9IGJ1ZmZlci51bml0cy50b0xvd2VyQ2FzZSgpO1xuICAgICAgbGV0IGRpc3BsYXlVbml0cyA9IGlzVGltZSA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ21pbnV0ZXMnKSA6IHVuaXRMb3cudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdtaWxlcycpID49IDAgPyBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdtaWxlc0xvd2VyY2FzZScpIDogQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigna2lsb21ldGVyc0xvd2VyY2FzZScpO1xuICAgICAgbGV0IHNob3J0VW5pdHMgPSBkaXNwbGF5VW5pdHMuc3Vic3RyKDAsIGRpc3BsYXlVbml0cy5sZW5ndGggLSAxKTtcbiAgICAgIGxldCBzaG9ydE5hbWUgPSBidWZmZXIudmFsdWUudG9TdHJpbmcoKSArICcgJyArIHNob3J0VW5pdHMgKyAnICcgKyBidWZmZXIudHJhbnNwb3J0O1xuICAgICAgbGV0IGRlc2NVbml0ID0gaXNUaW1lID8gJyAnICsgQmFSZXBvcnRzTGFuZ3VhZ2UuaTE4bigndGltZS1zZW1pY29sb24nKSArICcgJyA6ICcgJyArIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2Rpc3RhbmNlLXNlbWljb2xvbicpICsgJyAnO1xuICAgICAgbGV0IGRlc2NWYWx1ZSA9IGJ1ZmZlci52YWx1ZS50b1N0cmluZygpICsgJyAnICsgKGlzU2luZ3VsYXIgPyBzaG9ydFVuaXRzIDogZGlzcGxheVVuaXRzKTtcbiAgICAgIGxldCBkZXNjID0gKGJ1ZmZlci50cmFuc3BvcnQgPT0gJ2RyaXZlJyA/IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2RyaXZlJykgOiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCd3YWxrJykpICsgZGVzY1VuaXQgKyBkZXNjVmFsdWU7XG4gICAgICBpZiAoIWxhdClcbiAgICAgICAgbGF0ID0gYnVmZmVyLmxhdGl0dWRlO1xuICAgICAgaWYgKCFsb24pXG4gICAgICAgIGxvbiA9IGJ1ZmZlci5sb25naXR1ZGU7XG4gICAgICBsZXQgYXJlYSA9IHtcbiAgICAgICAgZmVhdHVyZToge1xuICAgICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICByaW5nczogYnVmZmVyLnJpbmdzXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBSSU5HOiAxLFxuICAgICAgICAgICAgU1lNQk9MOiB7XG4gICAgICAgICAgICAgIGNvbG9yOiBbMjA0LCA1MSwgMCwgMTI4XSxcbiAgICAgICAgICAgICAgb3V0bGluZToge1xuICAgICAgICAgICAgICAgIGNvbG9yOiBbMjA0LCA1MSwgMCwgMjU1XSxcbiAgICAgICAgICAgICAgICB3aWR0aDogMS41LFxuICAgICAgICAgICAgICAgIHR5cGU6ICdlc3JpU0xTJyxcbiAgICAgICAgICAgICAgICBzdHlsZTogJ2VzcmlTTFNTb2xpZCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdHlwZTogJ2VzcmlTRlMnLFxuICAgICAgICAgICAgICBzdHlsZTogJ2VzcmlTRlNTb2xpZCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGxhdGl0dWRlOiBsYXQsXG4gICAgICAgIGxvbmdpdHVkZTogbG9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzYyxcbiAgICAgICAgc2hvcnROYW1lOiBzaG9ydE5hbWUsXG4gICAgICAgIG5hbWU6IGxvY2F0aW9uTmFtZSA/IGxvY2F0aW9uTmFtZSA6ICcnLFxuICAgICAgICBsb2NhdGlvbjoge1xuICAgICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICB4OiBsb24sXG4gICAgICAgICAgICB5OiBsYXQsXG4gICAgICAgICAgICBzcGF0aWFsUmVmZXJlbmNlOiB7XG4gICAgICAgICAgICAgIHdraWQ6IDQzMjZcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHN5bWJvbDoge1xuICAgICAgICAgICAgdHlwZTogJ2VzcmlQTVMnLFxuICAgICAgICAgICAgd2lkdGg6IDE0LFxuICAgICAgICAgICAgaGVpZ2h0OiAyNi42LFxuICAgICAgICAgICAgeG9mZnNldDogMCxcbiAgICAgICAgICAgIHlvZmZzZXQ6IDEyLjYsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgICBpbWFnZURhdGE6ICdpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQk1BQUFBakNBWUFBQUIyS2pGaEFBQUN0VWxFUVZSSVMrMldTMHdUVVJTRy96dlQwa3Bma0dKNHBHQ1ZpQTFFbTlDdENRVng1UUlXaGlWUm84R2RTTnlwcUhFbGtjZ09selZoNWFwMVg2bkVpQWtRWHpHQnhrU0t0WkMwamRUU0I3U2RNWGR3Ump1ZEIrdzVxNXQ3VDc3NXozL096UjBDV2JUNHg5MEdsaDBDTUV4NDNnMUMzRklLejYvemhLd0RDSllybGRCV1pJYXVwU0RpcXNFLzNtQmptR2VNeVhMRjdHaUJ1YkVWaG1OMnNJWTZLYmxTM2tPNThCdkZYNXNvWnJiQTdlWUNXWTY3dlIyWjJhWkpBb3lxTVRMTXZMWE40N2ExZWVSaVVTcm1VU3JtaEhTR05ZQTExb0d0TXlPM0ZjVk9Zblc5eEhIOVZLVUFjdzFNZkhTYzlIa3R6dllhRU4zNEI2c3V5bVN4Q3dvenNRK1JlSGk2bjdnRzcvaU5adnY4OFc2L0lrZ2R0bCtZMmQ2STVOZlhxSlFLL2NRMU1QSFExdVo1b0ZTZVNGZFd0bjlLeTkzYi9vbHNZdlVSaFVXY1hlZjdUUGFtR21XWGZNM29QZVZBaThPSWVES0xwV2dTcnhZM3F2SVkxZ2pDbDVHT3ZuMmpDTE9hV1V5TjlzRFg2YWo1d05KYUVyZG0zeU5iS0FsbnVyQ3AwVzcwOVRoVlBReStpK0graXhWOTJPbFdDK2JHZTFWQjRzSGx4MkdzeFRQYXlxaFBreU5kdXJCN2dSV0VGbVBhc0JzWFQrRDZZSWN1N01uTHo1Z0xmOU9HMGU3TmpwM1RoVjJiWHNCU05LVU5vNTE4ZnRNTDZwMWFVSytvWndmcUpnVlJJQVhMZzQ3RTFhY0xndmtIZ3RHazFrWVRKa2ZPQ0VNcnhuSTBoYnVCWlNUU2VXbFBkODdrYXBycWVXd2tVb3BWSHhxbWRUZVBZTXFUZGVSWjlkMXN2ekFSdExuT0RsbWJPMVh2b3FwbmhNQmthVUFoSFVNMi9pVkU2T05yWlpqSW9aKzZ2NkJpWmhPWjd5dWZkampPTDd5YmVzQWFaUW9nK3FwWC9SNm9LYXlDcVlDb0tBbW1wVkNDYVlCcVlHcEFBYmFiRjh6KzN5UHhoMFhzWEpVeWNWUHVZV20zSUl5QUZraFJtUm93bC80aGRVMnVTRk9aSEZqdjdQRG0weHRDKzlWQW1zcGt3T0FPeHcxcmdXaitINHVWSDZoajA4SFNBQUFBQUVsRlRrU3VRbUNDJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8vIEFkZCBhdHRyaWJ1dGVzIHRoYXQgd2VyZSBwYXNzZWQgaW5cbiAgICAgIGlmIChsb2NhdGlvbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgY29uc3QgbWVyZ2VkQXR0cmlidXRlcyA9IHtcbiAgICAgICAgICAuLi5sb2NhdGlvbkF0dHJpYnV0ZXMsXG4gICAgICAgICAgLi4uYXJlYS5mZWF0dXJlLmF0dHJpYnV0ZXNcbiAgICAgICAgfTtcbiAgICAgICAgYXJlYS5mZWF0dXJlLmF0dHJpYnV0ZXMgPSBtZXJnZWRBdHRyaWJ1dGVzO1xuICAgICAgfVxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgb2JqLmFuYWx5c2lzQXJlYXMucHVzaChhcmVhKTtcbiAgICB9XG4gICAgbGV0IHMgPSBKU09OLnN0cmluZ2lmeShvYmopLnJlcGxhY2UoJ3tcImFuYWx5c2lzQXJlYXNcIicsICdcImFuYWx5c2lzQXJlYXNcIicpO1xuICAgIHJldHVybiBzLnN1YnN0cigwLCBzLmxlbmd0aCAtIDEpO1xuICB9XG4gIHN0YXRpYyBnZXREZW1vUG9seWdvbigpIHtcbiAgICByZXR1cm4gJ1wiYW5hbHlzaXNBcmVhc1wiOiBbIFxcXG4gICAgICB7IFxcXG4gICAgICAgIFwiZmVhdHVyZVwiOiB7IFxcXG4gICAgICAgICAgXCJnZW9tZXRyeVwiOiB7IFxcXG4gICAgICAgICAgICBcInJpbmdzXCI6IFsgXFxcbiAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTguMDAwMDgzNTAxODAyLCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDYwOTM5NjMyMjg3NyBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExOC4wMDAwODM1MDE4MDIsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wNzAwNDA2ODEwMzg5IFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE4LjAwMDA4MzUwMTgwMiwgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjA3OTE0MDc1MjIyNTEgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTguMDAwMDgzNTAxODAyLCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDg4MjM5ODQ1NzIxNiBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45ODkwOTcxNzYwNTgsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wODgyMzk4NDU3MjE2IFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk4OTA5NzE3NjA1OCwgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjA5NzMzNzk2MTQwNDIgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTc4MTEwODUwMzE0LCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMTA2NDM1MDk5MTQ4NiBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NjcxMjQ1MjQ1NywgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjEwNjQzNTA5OTE0ODYgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTU2MTM4MTk4ODI3LCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMTA2NDM1MDk5MTQ4NiBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NTYxMzgxOTg4MjcsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4xMTU1MzEyODc4ODIxIFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk1NjEzODE5ODgyNywgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjEyNDYyNjQ2OTM3NDMgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTQ1MTUxODczMDgzLCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMTI0NjI2NDY5Mzc0MyBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NDUxNTE4NzMwODMsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4xMTU1MzEyODc4ODIxIFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk0NTE1MTg3MzA4MywgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjEwNjQzNTA5OTE0ODYgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTQ1MTUxODczMDgzLCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDk3MzM3OTYxNDA0MiBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NDUxNTE4NzMwODMsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wODgyMzk4NDU3MjE2IFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk0NTE1MTg3MzA4MywgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjA3OTE0MDc1MjIyNTEgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTU2MTM4MTk4ODI3LCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDc5MTQwNzUyMjI1MSBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NTYxMzgxOTg4MjcsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wNzAwNDA2ODEwMzg5IFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk2NzEyNDUyNDU3LCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDcwMDQwNjgxMDM4OSBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExNy45NzgxMTA4NTAzMTQsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wNzAwNDA2ODEwMzg5IFxcXG4gICAgICAgICAgICAgICAgXSwgXFxcbiAgICAgICAgICAgICAgICBbIFxcXG4gICAgICAgICAgICAgICAgICAtMTE3Ljk3ODExMDg1MDMxNCwgXFxcbiAgICAgICAgICAgICAgICAgIDM0LjA2MDkzOTYzMjI4NzcgXFxcbiAgICAgICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgICAgIFsgXFxcbiAgICAgICAgICAgICAgICAgIC0xMTcuOTg5MDk3MTc2MDU4LCBcXFxuICAgICAgICAgICAgICAgICAgMzQuMDYwOTM5NjMyMjg3NyBcXFxuICAgICAgICAgICAgICAgIF0sIFxcXG4gICAgICAgICAgICAgICAgWyBcXFxuICAgICAgICAgICAgICAgICAgLTExOC4wMDAwODM1MDE4MDIsIFxcXG4gICAgICAgICAgICAgICAgICAzNC4wNjA5Mzk2MzIyODc3IFxcXG4gICAgICAgICAgICAgICAgXSBcXFxuICAgICAgICAgICAgICBdIFxcXG4gICAgICAgICAgICBdLCBcXFxuICAgICAgICAgICAgXCJzcGF0aWFsUmVmZXJlbmNlXCI6IHsgXFxcbiAgICAgICAgICAgICAgXCJ3a2lkXCI6IDQzMjYgXFxcbiAgICAgICAgICAgIH0gXFxcbiAgICAgICAgICB9LCBcXFxuICAgICAgICAgIFwiYXR0cmlidXRlc1wiOiB7IFxcXG4gICAgICAgICAgICBcIk9CSkVDVElEXCI6IDYsIFxcXG4gICAgICAgICAgICBcIk5BTUVcIjogXCIwNiAxMDNcIiwgXFxcbiAgICAgICAgICAgIFwiREVTQ1JJUFRJT05cIjogXCJBcmVhOiA4LjEgc3F1YXJlIG1pbGVzXCIsIFxcXG4gICAgICAgICAgICBcIkNSRUFURURcIjogMTUxODczNjkyMjk3NywgXFxcbiAgICAgICAgICAgIFwiTU9ESUZJRURcIjogMTUxODczNjkyMjk3NywgXFxcbiAgICAgICAgICAgIFwiQ1JFQVRPUlwiOiBcImZhc2lsX2JhXCIsIFxcXG4gICAgICAgICAgICBcIkVESVRPUlwiOiBcImZhc2lsX2JhXCIsIFxcXG4gICAgICAgICAgICBcIlJFR0lPTlwiOiBcIlVTXCIsIFxcXG4gICAgICAgICAgICBcIkZMQUdTXCI6IDIsIFxcXG4gICAgICAgICAgICBcIlNZTUJPTFwiOiB7XFxcImNvbG9yXFxcIjpbMjU1LDI1NSwxNzgsMjMwXSxcXFwib3V0bGluZVxcXCI6e1xcXCJjb2xvclxcXCI6WzAsMCwwLDI1NV0sXFxcIndpZHRoXFxcIjoxLjUsXFxcInR5cGVcXFwiOlxcXCJlc3JpU0xTXFxcIixcXFwic3R5bGVcXFwiOlxcXCJlc3JpU0xTU29saWRcXFwiLFxcXCJtYXJrZXJcXFwiOm51bGx9LFxcXCJ0eXBlXFxcIjpcXFwiZXNyaVNGU1xcXCIsXFxcInN0eWxlXFxcIjpcXFwiZXNyaVNGU1NvbGlkXFxcIn0sIFxcXG4gICAgICAgICAgICBcIlNUQVRFRlBcIjogXCIwNlwiLCBcXFxuICAgICAgICAgICAgXCJVTlNETEVBXCI6IFwiMDM2OTBcIiwgXFxcbiAgICAgICAgICAgIFwiR0VPSURcIjogXCIwNjAzNjkwXCIsIFxcXG4gICAgICAgICAgICBcIk5BTUVfXCI6IFwiQmFsZHdpbiBQYXJrIFVuaWZpZWQgU2Nob29sIERpc3RyaWN0XCIsIFxcXG4gICAgICAgICAgICBcIkxTQURcIjogXCIwMFwiLCBcXFxuICAgICAgICAgICAgXCJMT0dSQURFXCI6IFwiS0dcIiwgXFxcbiAgICAgICAgICAgIFwiSElHUkFERVwiOiBcIjEyXCIsIFxcXG4gICAgICAgICAgICBcIk1URkNDXCI6IFwiRzU0MjBcIiwgXFxcbiAgICAgICAgICAgIFwiU0RUWVBcIjogXCIgXCIsIFxcXG4gICAgICAgICAgICBcIkZVTkNTVEFUXCI6IFwiRVwiLCBcXFxuICAgICAgICAgICAgXCJBTEFORFwiOiAyMjA4MTQzMSwgXFxcbiAgICAgICAgICAgIFwiQVdBVEVSXCI6IDYyNjU3NCwgXFxcbiAgICAgICAgICAgIFwiSU5UUFRMQVRcIjogXCIrMzQuMDg5NjYwMlwiLCBcXFxuICAgICAgICAgICAgXCJJTlRQVExPTlwiOiBcIi0xMTcuOTY4NzIyM1wiLCBcXFxuICAgICAgICAgICAgXCJHRU9JRDJcIjogNjAzNjkwLCBcXFxuICAgICAgICAgICAgXCJDT1VOVF9cIjogMCwgXFxcbiAgICAgICAgICAgIFwiQ09VTlRfMVwiOiAwLCBcXFxuICAgICAgICAgICAgXCJPSUQxXCI6IDc1LCBcXFxuICAgICAgICAgICAgXCJZRUFSXzFcIjogMTMxNCwgXFxcbiAgICAgICAgICAgIFwiQ09VTlRZXzFcIjogMTksIFxcXG4gICAgICAgICAgICBcIkRJU1RSSUNUXzFcIjogMTk2NDI4NywgXFxcbiAgICAgICAgICAgIFwiRElTVFJJQ1RfMlwiOiBcIkJhbGR3aW4gUGFyayBVbmlmaWVkXCIsIFxcXG4gICAgICAgICAgICBcIkdFT0dSQVBIXzFcIjogXCJCYWxkd2luIFBhcmsgVW5pZmllZCBTY2hvb2wgRGlzdHJpY3QsIENBXCIsIFxcXG4gICAgICAgICAgICBcIkdFT0lEXzEyXCI6IDYwMzY5MCwgXFxcbiAgICAgICAgICAgIFwiSElTUF8xXCI6IDE2MzEwLCBcXFxuICAgICAgICAgICAgXCJQQ1RISVNQXzFcIjogODYuOTEsIFxcXG4gICAgICAgICAgICBcIkFNSU5EXzFcIjogNjIsIFxcXG4gICAgICAgICAgICBcIlBDVEFNSU5EXzFcIjogMC4zMywgXFxcbiAgICAgICAgICAgIFwiQVNJQU5fMVwiOiA3MzEsIFxcXG4gICAgICAgICAgICBcIlBDVEFTSUFOXzFcIjogMy45LCBcXFxuICAgICAgICAgICAgXCJQQUNfMVwiOiAzMiwgXFxcbiAgICAgICAgICAgIFwiUENUUEFDXzFcIjogMC4xNywgXFxcbiAgICAgICAgICAgIFwiRklMXzFcIjogMzI2LCBcXFxuICAgICAgICAgICAgXCJQQ1RGSUxfMVwiOiAxLjc0LCBcXFxuICAgICAgICAgICAgXCJBRkFNXzFcIjogNjM1LCBcXFxuICAgICAgICAgICAgXCJQQ1RBRkFNXzFcIjogMy4zOCwgXFxcbiAgICAgICAgICAgIFwiV0hJVEVfMVwiOiA1NTIsIFxcXG4gICAgICAgICAgICBcIlBDVFdISVRFXzFcIjogMi45NCwgXFxcbiAgICAgICAgICAgIFwiVFdPT1JNT1JfMVwiOiAxMDcsIFxcXG4gICAgICAgICAgICBcIlBDVFRXT09SXzFcIjogMC41NywgXFxcbiAgICAgICAgICAgIFwiTk9ORVJFUE9fMVwiOiAxMiwgXFxcbiAgICAgICAgICAgIFwiUENUTk9ORVJfMVwiOiAwLjA2LCBcXFxuICAgICAgICAgICAgXCJUT1RBTF8xXCI6IDE4NzY3LCBcXFxuICAgICAgICAgICAgXCJOT05XSElURV8xXCI6IDE4MjAzLCBcXFxuICAgICAgICAgICAgXCJQQ1ROT05XSF8xXCI6IDk3LCBcXFxuICAgICAgICAgICAgXCJTSEFQRV9fQXJlYVwiOiBudWxsLCBcXFxuICAgICAgICAgICAgXCJTSEFQRV9fTGVuZ3RoXCI6IG51bGwgXFxcbiAgICAgICAgICB9IFxcXG4gICAgICAgIH0sIFxcXG4gICAgICAgIFwibmFtZVwiOiBcIjA2IDEwM1wiLCBcXFxuICAgICAgICBcImFkZHJlc3NcIjogXCIwNiAxMDNcIiwgXFxcbiAgICAgICAgXCJzaG9ydE5hbWVcIjogXCIwNiAxMDNcIiwgXFxcbiAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIkFyZWE6IDguMSBzcXVhcmUgbWlsZXNcIiBcXFxuICAgICAgfV0nO1xuICB9XG4gIC8vIHN0YXRpYyBnZW5lcmF0ZURyaXZlVGltZShsYXQsIGxvbiwgdW5pdHMsIHZhbHVlcykge1xuICAvL1xuICAvLyB9XG4gIC8vXG4gIC8vIHN0YXRpYyBnZW5lcmF0ZVdhbGtUaW1lKGxhdCwgbG9uLCB1bml0cywgdmFsdWVzKSB7XG4gIC8vXG4gIC8vIH1cbiAgLypcbiAgICogX2dlbmVyYXRlUmluZyAtIGNyZWF0ZXMgYW4gYXJyYXkgb2YgYXJyYXlzIG9mIGxvbixsYXQgYXJyYXkgY29vcmRpbmF0ZXMgdGhhdFxuICAgKiBkZWZpbmUgYSBjaXJjbGUgYXJvdW5kIHRoZSBnaXZlbiBsYXRpdHVkZSwgbG9uZ2l0dWRlIGF0IGEgZ2l2ZW4gcmFkaXVzLlxuICAgKlxuICAgKiBFeGFtcGxlOiAgWyBbbG9uMSxsYXQxXSwgW2xvbjIsbGF0Ml0gXVxuICAgKlxuICAgKiAndW5pdHMnIC0gJ21pbGVzJyBvciAna2lsb21ldGVycydcbiAgICogJ3JhZGl1cycgLSByYWRpdXMgb2YgY2lyY2xlIGluIHRoZSAndW5pdHMnXG4gICAqL1xuICBzdGF0aWMgX2dlbmVyYXRlUmluZyhsYXQsIGxvbiwgdW5pdHMsIHJhZGl1cykge1xuICAgIGlmICghbGF0IHx8ICFsb24gfHwgKHVuaXRzICE9ICdtaWxlcycgJiYgdW5pdHMgIT0gJ2tpbG9tZXRlcnMnKSB8fCByYWRpdXMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLmxvZygnR2VvbWV0cnlVdGlsIEVycm9yOiBfZ2VuZXJhdGVSaW5nIGludmFsaWQgYXJncz0nLCBsYXQsIGxvbiwgdW5pdHMsIHJhZGl1cyk7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBmdW5jdGlvbiBmbW9kKFgsIFkpIHtcbiAgICAgIHJldHVybiBYICUgWTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9SYWQobikge1xuICAgICAgcmV0dXJuIG4gKiBNYXRoLlBJIC8gMTgwO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b0RlZyhuKSB7XG4gICAgICByZXR1cm4gbiAqIDE4MCAvIE1hdGguUEk7XG4gICAgfVxuICAgIGNvbnN0IGVhcnRoUmFkaXVzID0gNjM3MTAwMDsgLy8gbWV0ZXJzXG4gICAgdmFyIHJhZEluTWV0ZXJzID0gKHVuaXRzID09ICdtaWxlcycpID8gcmFkaXVzICogMTYwOS4zNDQgOiByYWRpdXMgKiAxMDAwO1xuICAgIHZhciByTGF0ID0gdG9SYWQobGF0KTtcbiAgICB2YXIgckxvbiA9IHRvUmFkKGxvbik7XG4gICAgdmFyIGRfcmFkID0gcmFkSW5NZXRlcnMgLyBlYXJ0aFJhZGl1cztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAzNjA7IGkgKz0gNCkge1xuICAgICAgdmFyIHJhZGlhbCA9IHRvUmFkKGkpO1xuICAgICAgdmFyIGxhdF9yYWQgPSBNYXRoLmFzaW4oTWF0aC5zaW4ockxhdCkgKiBNYXRoLmNvcyhkX3JhZCkgKyBNYXRoLmNvcyhyTGF0KSAqIE1hdGguc2luKGRfcmFkKSAqIE1hdGguY29zKHJhZGlhbCkpO1xuICAgICAgdmFyIGRsb25fcmFkID0gTWF0aC5hdGFuMihNYXRoLnNpbihyYWRpYWwpICogTWF0aC5zaW4oZF9yYWQpICogTWF0aC5jb3MockxhdCksIE1hdGguY29zKGRfcmFkKSAtIE1hdGguc2luKHJMYXQpICogTWF0aC5zaW4obGF0X3JhZCkpO1xuICAgICAgdmFyIGxvbl9yYWQgPSBmbW9kKChyTG9uICsgZGxvbl9yYWQgKyBNYXRoLlBJKSwgMiAqIE1hdGguUEkpIC0gTWF0aC5QSTtcbiAgICAgIGxldCBjb29yZCA9IFtdO1xuICAgICAgY29vcmQucHVzaCh0b0RlZyhsb25fcmFkKSk7XG4gICAgICBjb29yZC5wdXNoKHRvRGVnKGxhdF9yYWQpKTtcbiAgICAgIHJlc3VsdC5wdXNoKGNvb3JkKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vKiogSW5mb2dyYXBoaWNDYXJkXG4gKlxuICogIFRoaXMgY2xhc3MgcHJvdmlkZXMgc3VwcG9ydCBmb3IgZGlzcGxheWluZyBhbiBpbmZvZ3JhcGhpYyBpbnNpZGVcbiAqICBhbiBpZnJhbWUgZWxlbWVudC5cbiAqL1xuY2xhc3MgSW5mb2dyYXBoaWNDYXJkIHtcbiAgY29uc3RydWN0b3IodXNlcm5hbWUsIHRva2VuLCBlbnYsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmdlb2VucmljaG1lbnRVcmwgPSAnJztcbiAgICB0aGlzLnBvcnRhbFVybCA9ICcnO1xuICAgIHRoaXMucG9ydGFsT25saW5lR0VQcm94eSA9IGZhbHNlO1xuICAgIHRoaXMubGFuZ0NvZGUgPSAnZW4tdXMnOyAvLyBbT1BUSU9OQUxdIGRlZmF1bHQgbGFuZ3VhZ2UgKGRlZmF1bHQgaXMgZW4tdXMpXG4gICAgdGhpcy5zb3VyY2VDb3VudHJ5ID0gJ1VTJzsgLy8gW09QVElPTkFMXSBkZWZhdWx0IGNvdW50cnkgY29kZSAoZGVmYXVsdCBpcyBVUylcbiAgICB0aGlzLmJ1ZmZlclR5cGUgPSAncmluZyc7XG4gICAgdGhpcy5idWZmZXJVbml0cyA9ICdtaWxlcyc7XG4gICAgdGhpcy5idWZmZXJTaXplcyA9IFsxLCAzLCA1XTtcbiAgICBEZWJ1Z0xvZy5zaG93RGVidWdDb25zb2xlTG9ncyA9IHRydWU7XG4gICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLmVudmlyb25tZW50ID0gZW52O1xuICAgIHRoaXMuX2lkUHJlZml4ID0gJ2JhLWluZm9ncmFwaGljLWZyYW1lLSc7XG4gICAgY29uc3QgZmlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KTtcbiAgICB0aGlzLl9pRnJhbWUgPSB7IGlkOiBmaWQuaWQsIGNvbnRhaW5lcjogbnVsbCwgaW5zdGFuY2U6IG51bGwgfTtcbiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gIH1cbiAgc2V0U2hhZG93Um9vdChyb290KSB7XG4gICAgdGhpcy5fY29udGFpbmVyU2hhZG93Um9vdCA9IHJvb3Q7XG4gIH1cbiAgLyoqXG4gICAqIHJlc2V0T3B0aW9ucyAtIHJldHVybnMgYWxsIG9wdGlvbnMgdG8gdGhlaXIgZGVmYXVsdHNcbiAgICovXG4gIHJlc2V0T3B0aW9ucygpIHtcbiAgICB0aGlzLmJ1ZmZlclR5cGUgPSAncmluZyc7XG4gICAgdGhpcy5idWZmZXJVbml0cyA9ICdtaWxlcyc7XG4gICAgdGhpcy5idWZmZXJTaXplcyA9IFsxLCAzLCA1XTtcbiAgICB0aGlzLnZpZXdNb2RlID0gJ2F1dG8nOyAvLyB2aWV3IG1vZGUgW2Z1bGwsIHN0YWNrLCBzbGlkZXMsIHN0YWNrLWFsbF1cbiAgICAvLyByZXBvcnRcbiAgICB0aGlzLnJlcG9ydFNob3dIZWFkZXIgPSB0cnVlOyAvLyBpbmZvZ3JhcGhpYyByZXBvcnQgaGVhZGVyIGRpc3BsYXkgb24vb2ZmXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QcmludCA9IHRydWU7IC8vIHNob3cgcHJpbnQgYnV0dG9uIGluIGhlYWRlciBvbi9vZmZcbiAgICB0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblpvb21MZXZlbCA9IHRydWU7IC8vIHNob3cgem9vbSBsZXZlbCBidXR0b24gaW4gaGVhZGVyIG9uL29mZlxuICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRnVsbHNjcmVlbiA9IHRydWU7IC8vIHNob3cgRnVsbHNjcmVlbiBidXR0b24gaW4gaGVhZGVyIG9uL29mZlxuICAgIC8vIGV4cG9ydFxuICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRXhjZWwgPSB0cnVlOyAvLyBzaG93IEV4Y2VsIGJ1dHRvbiBpbiBoZWFkZXIgb24vb2ZmXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25JbWFnZSA9IHRydWU7IC8vIHNob3cgaW1hZ2UgYnV0dG9uIGluIGhlYWRlciBvbi9vZmZcbiAgICB0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblBkZiA9IHRydWU7IC8vIHNob3cgUERGIGJ1dHRvbiBpbiBoZWFkZXIgb24vb2ZmXG4gICAgdGhpcy5yZXBvcnRIZWFkZXJCdXR0b25EeW5IdG1sID0gdHJ1ZTsgLy8gc2hvdyBEeW5hbWljIEhUTUwgYnV0dG9uIGluIGhlYWRlciBvbi9vZmZcbiAgICAvLyBzdHlsZVxuICAgIHRoaXMucmVwb3J0Q29sb3JCYWNrZ3JvdW5kID0gJyNmZmYnOyAvLyBpbmZvZ3JhcGhpYyBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgdGhpcy5yZXBvcnRDb2xvckhlYWRlciA9ICdibHVlJzsgLy8gaW5mb2dyYXBoaWMgaGVhZGVyIGNvbG9yXG4gICAgdGhpcy5yZXBvcnRDb2xvckhlYWRlclRleHQgPSAnI2ZmZic7IC8vIGluZm9ncmFwaGljIGhlYWRlciB0ZXh0IGNvbG9yXG4gICAgLy8gbWFwXG4gICAgdGhpcy5ydW5SZXBvcnRPbkNsaWNrID0gdHJ1ZTsgLy8gQm9vbGVhbiAtIHJ1bnMgbmV3IHJlcG9ydCBvbiBtYXAgY2xpY2tcbiAgICB0aGlzLnNob3dTZWFyY2ggPSB0cnVlOyAvLyBCb29sZWFuIC0gc2hvd3MgQkEgbWFwIHNlYXJjaFxuICB9XG4gIC8qKiBzZXRPcHRpb25zXG4gICAqICAgIFNldHMgb25lIG9yIG1vcmUgY29uZmlnIGFuZCBkaXNwbGF5IG9wdGlvbnMuICBPbmx5IHRoZSBvcHRpb25zIHRoYXQgYXJlXG4gICAqICAgIGZvdW5kIGluIHRoZSBvcHRpb25zIGFyZ3VtZW50IGdldCBjaGFuZ2VkIGJ5IGRlZmF1bHQuICAgSWYgdGhlICdyZXNldCdcbiAgICogICAgZmxhZyBpcyBzZXQgJ3RydWUnIHRoZW4gYWxsIHRoZSBvcHRpb25zIHdpbGwgYmUgcmVzZXQgYmFjayB0byB0aGVpclxuICAgKiAgICBkZWZhdWx0cyBiZWZvcmUgc2V0dGluZyB2YWx1ZXMgZm91bmQgaW4gJ29wdGlvbnMnLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyAgIEpTT04gc3RyaW5nIHdpdGggb25seSB0aGUgb3B0aW9ucyB0byBiZSBjaGFuZ2VkXG4gICAqIEBwYXJhbSByZXNldCAgICAgYm9vbGVhbiwgcmVzZXQgb3B0aW9ucyB0byBkZWZhdWx0IGJlZm9yZSBhcHBseWluZyAnb3B0aW9ucydcbiAgICovXG4gIHNldE9wdGlvbnMob3B0aW9ucywgcmVzZXQpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMgPT0gbnVsbCB8fCAhVXRpbHMuaGFzVGV4dChvcHRpb25zKSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgaWYgKHJlc2V0KVxuICAgICAgICB0aGlzLnJlc2V0T3B0aW9ucygpO1xuICAgICAgY29uc3Qgb3B0ID0gSlNPTi5wYXJzZShvcHRpb25zKTtcbiAgICAgIGlmICghb3B0IHx8IG9wdC5sZW5ndGggPD0gMClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgLy8gY29uc29sZS5sb2coJyVjIEJBQyBJbmZvZ3JhcGhpY0NhcmQgc2V0T3B0aW9ucycsICdjb2xvcjpibHVlO2ZvbnQtc2l6ZTo5cHQ7Jywgb3B0KVxuICAgICAgaWYgKFV0aWxzLmhhc1RleHQob3B0LmJ1ZmZlclR5cGUpICYmIFsncmluZycsICdkcml2ZXRpbWUnLCAnd2Fsa3RpbWUnXS5pbmNsdWRlcyhvcHQuYnVmZmVyVHlwZSkpXG4gICAgICAgIHRoaXMuYnVmZmVyVHlwZSA9IG9wdC5idWZmZXJUeXBlO1xuICAgICAgaWYgKFV0aWxzLmhhc1RleHQob3B0LmJ1ZmZlclVuaXRzKSAmJiBbJ21pbGVzJywgJ2tpbG9tZXRlcnMnLCAnbWludXRlcyddLmluY2x1ZGVzKG9wdC5idWZmZXJVbml0cykpXG4gICAgICAgIHRoaXMuYnVmZmVyVW5pdHMgPSBvcHQuYnVmZmVyVW5pdHM7XG4gICAgICBpZiAob3B0LmJ1ZmZlclNpemVzICYmIG9wdC5idWZmZXJTaXplcy5sZW5ndGggPiAwICYmIG9wdC5idWZmZXJTaXplcy5sZW5ndGggPD0gMylcbiAgICAgICAgdGhpcy5idWZmZXJTaXplcyA9IG9wdC5idWZmZXJTaXplcztcbiAgICAgIGlmIChVdGlscy5oYXNUZXh0KG9wdC52aWV3TW9kZSkgJiYgWydmdWxsJywgJ3N0YWNrJywgJ3NsaWRlcycsICdzdGFjay1hbGwnXS5pbmNsdWRlcyhvcHQudmlld01vZGUpKVxuICAgICAgICB0aGlzLnZpZXdNb2RlID0gb3B0LnZpZXdNb2RlO1xuICAgICAgaWYgKG9wdC5yZXBvcnQpIHtcbiAgICAgICAgaWYgKG9wdC5yZXBvcnQuc2hvd0hlYWRlciAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0U2hvd0hlYWRlciA9IG9wdC5yZXBvcnQuc2hvd0hlYWRlcjtcbiAgICAgICAgaWYgKG9wdC5yZXBvcnQuc2hvd1pvb21MZXZlbCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uWm9vbUxldmVsID0gb3B0LnJlcG9ydC5zaG93Wm9vbUxldmVsO1xuICAgICAgICBpZiAob3B0LnJlcG9ydC5zaG93RnVsbHNjcmVlbiAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRnVsbHNjcmVlbiA9IG9wdC5yZXBvcnQuc2hvd0Z1bGxzY3JlZW47XG4gICAgICB9XG4gICAgICBpZiAob3B0LmV4cG9ydCkge1xuICAgICAgICBpZiAob3B0LmV4cG9ydC5leGNlbCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRXhjZWwgPSBvcHQuZXhwb3J0LmV4Y2VsO1xuICAgICAgICBpZiAob3B0LmV4cG9ydC5pbWFnZSAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uSW1hZ2UgPSBvcHQuZXhwb3J0LmltYWdlO1xuICAgICAgICBpZiAob3B0LmV4cG9ydC5wZGYgIT0gdHlwZW9mIHVuZGVmaW5lZClcbiAgICAgICAgICB0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblBkZiA9IG9wdC5leHBvcnQucGRmO1xuICAgICAgICBpZiAob3B0LnJlcG9ydC5wcmludCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uUHJpbnQgPSBvcHQuZXhwb3J0LnByaW50O1xuICAgICAgICBpZiAob3B0LmV4cG9ydC5keW5hbWljSHRtbCAhPSB0eXBlb2YgdW5kZWZpbmVkKVxuICAgICAgICAgIHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRHluSHRtbCA9IG9wdC5leHBvcnQuZHluYW1pY0h0bWw7XG4gICAgICB9XG4gICAgICBpZiAob3B0LnN0eWxlKSB7XG4gICAgICAgIGlmIChvcHQuc3R5bGUuaWdCYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRoaXMucmVwb3J0Q29sb3JCYWNrZ3JvdW5kID0gb3B0LnN0eWxlLmlnQmFja2dyb3VuZENvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRoaXMucmVwb3J0Q29sb3JCYWNrZ3JvdW5kID0gb3B0LnN0eWxlLmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0LnN0eWxlLmhlYWRlckNvbG9yICE9IHR5cGVvZiB1bmRlZmluZWQpXG4gICAgICAgICAgdGhpcy5yZXBvcnRDb2xvckhlYWRlciA9IG9wdC5zdHlsZS5oZWFkZXJDb2xvcjtcbiAgICAgICAgaWYgKG9wdC5zdHlsZS5oZWFkZXJUZXh0Q29sb3IgIT0gdHlwZW9mIHVuZGVmaW5lZClcbiAgICAgICAgICB0aGlzLnJlcG9ydENvbG9ySGVhZGVyVGV4dCA9IG9wdC5zdHlsZS5oZWFkZXJUZXh0Q29sb3I7XG4gICAgICB9XG4gICAgICBpZiAob3B0Lm1hcCkge1xuICAgICAgICBpZiAob3B0Lm1hcC5ydW5SZXBvcnRPbkNsaWNrICE9IHR5cGVvZiB1bmRlZmluZWQpXG4gICAgICAgICAgdGhpcy5ydW5SZXBvcnRPbkNsaWNrID0gb3B0Lm1hcC5ydW5SZXBvcnRPbkNsaWNrO1xuICAgICAgICBpZiAob3B0Lm1hcC5zaG93U2VhcmNoICE9IHR5cGVvZiB1bmRlZmluZWQpXG4gICAgICAgICAgdGhpcy5zaG93U2VhcmNoID0gb3B0Lm1hcC5zaG93U2VhcmNoO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgY29uc29sZS5sb2coJ0luZm9ncmFwaGljQ2FyZCBlcnJvcjogJywgZXgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gZ2VuZXJhdGUgaW5mb2dyYXBoaWMgZGlzcGxheSBvcHRpb25zXG4gIF9jcmVhdGVJbmZvZ3JhcGhpY1BsYXllclN0eWxlT3B0aW9ucygpIHtcbiAgICBsZXQgYXJyMSA9IFtdO1xuICAgIGxldCBhcnIyID0gW107XG4gICAgbGV0IGFycjMgPSBbXTtcbiAgICBhcnIxLnB1c2goJ1wic2hvd0Nsb3NlQnV0dG9uXCI6ZmFsc2UnKTtcbiAgICBpZiAodGhpcy5yZXBvcnRTaG93SGVhZGVyICE9IHVuZGVmaW5lZCAmJiB0aGlzLnJlcG9ydFNob3dIZWFkZXIgPT0gZmFsc2UpXG4gICAgICBhcnIxLnB1c2goJ1wic2hvd0hlYWRlclwiOmZhbHNlJyk7XG4gICAgaWYgKHRoaXMudmlld01vZGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBtb2RlcyA9IHtcbiAgICAgICAgZnVsbDogJ2Z1bGwtcGFnZXMnLFxuICAgICAgICBzdGFjazogJ3BhbmVscy1pbi1zdGFjaycsXG4gICAgICAgIHNsaWRlczogJ3BhbmVscy1pbi1zbGlkZXMnLFxuICAgICAgICAnc3RhY2stYWxsJzogJ3BhbmVscy1pbi1zdGFjay1hbGwnXG4gICAgICB9O1xuICAgICAgbGV0IG0gPSBtb2Rlc1t0aGlzLnZpZXdNb2RlXTtcbiAgICAgIGlmIChtKVxuICAgICAgICBhcnIxLnB1c2goJ1widmlld01vZGVcIjpcIicgKyBtICsgJ1wiLFwicmVzaXplTW9kZVwiOlwiYXV0b1wiJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvbkZ1bGxzY3JlZW4pXG4gICAgICBhcnIxLnB1c2goJ1wic2hvd0Z1bGxzY3JlZW5CdXR0b25cIjogdHJ1ZScpO1xuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvblpvb21MZXZlbClcbiAgICAgIGFycjEucHVzaCgnXCJkaXNhYmxlWm9vbVwiOiB0cnVlJyk7XG4gICAgaWYgKHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRXhjZWwpXG4gICAgICBhcnIyLnB1c2goJ1wiZXhjZWxcIjogdHJ1ZScpO1xuICAgIGlmICh0aGlzLnJlcG9ydEhlYWRlckJ1dHRvbkltYWdlKVxuICAgICAgYXJyMi5wdXNoKCdcImltYWdlXCI6IHRydWUnKTtcbiAgICBpZiAodGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QZGYpXG4gICAgICBhcnIyLnB1c2goJ1wicGRmXCI6IHRydWUnKTtcbiAgICBpZiAodGhpcy5yZXBvcnRIZWFkZXJCdXR0b25QcmludClcbiAgICAgIGFycjIucHVzaCgnXCJwcmludFwiOiB0cnVlJyk7XG4gICAgaWYgKHRoaXMucmVwb3J0SGVhZGVyQnV0dG9uRHluSHRtbClcbiAgICAgIGFycjIucHVzaCgnXCJkeW5hbWljSHRtbFwiOiB0cnVlJyk7XG4gICAgaWYgKHRoaXMucmVwb3J0Q29sb3JCYWNrZ3JvdW5kKVxuICAgICAgYXJyMy5wdXNoKCdcImJhY2tncm91bmRcIjpcIicgKyB0aGlzLnJlcG9ydENvbG9yQmFja2dyb3VuZCArICdcIicpO1xuICAgIGlmICh0aGlzLnJlcG9ydENvbG9ySGVhZGVyKVxuICAgICAgYXJyMy5wdXNoKCdcImhlYWRlckJhY2tncm91bmRcIjpcIicgKyB0aGlzLnJlcG9ydENvbG9ySGVhZGVyICsgJ1wiJyk7XG4gICAgaWYgKHRoaXMucmVwb3J0Q29sb3JIZWFkZXJUZXh0KVxuICAgICAgYXJyMy5wdXNoKCdcImhlYWRlclRleHRcIjpcIicgKyB0aGlzLnJlcG9ydENvbG9ySGVhZGVyVGV4dCArICdcIicpO1xuICAgIGlmIChhcnIyLmxlbmd0aCA+IDApXG4gICAgICBhcnIxLnB1c2goJ1wiZXhwb3J0T3B0aW9uc1wiOiB7JyArIGFycjIudG9TdHJpbmcoKSArICd9Jyk7XG4gICAgaWYgKGFycjMubGVuZ3RoID4gMClcbiAgICAgIGFycjEucHVzaCgnXCJ0aGVtZVwiOiB7JyArIGFycjMudG9TdHJpbmcoKSArICd9Jyk7XG4gICAgcmV0dXJuIGFycjEudG9TdHJpbmcoKTtcbiAgfVxuICBfdmFsaWRhdGVTZXR1cCgpIHtcbiAgICBpZiAoIVV0aWxzLmhhc1RleHQodGhpcy5lbnZpcm9ubWVudCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFVdGlscy5oYXNUZXh0KHRoaXMudG9rZW4pKSB7XG4gICAgICBEZWJ1Z0xvZy5sb2coJ0luZm9ncmFwaGljQ2FyZCcsICdpbnZhbGlkIHRva2VuJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghVXRpbHMuaGFzVGV4dCh0aGlzLnVzZXJuYW1lKSkge1xuICAgICAgRGVidWdMb2cubG9nKCdJbmZvZ3JhcGhpY0NhcmQnLCAnaW52YWxpZCB1c2VybmFtZScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIVV0aWxzLmhhc1RleHQodGhpcy5yZXBvcnRJZCkpIHtcbiAgICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJ2ludmFsaWQgcmVwb3J0IElEJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghdGhpcy5yZXBvcnRMb2NhdGlvbikge1xuICAgICAgaWYgKCF0aGlzLnJlcG9ydEdlb21ldHJ5ICYmICF0aGlzLnJlcG9ydEdlb2dyYXBoeSkge1xuICAgICAgICBEZWJ1Z0xvZy5sb2coJ0luZm9ncmFwaGljQ2FyZCcsICdpbnZhbGlkIGxvY2F0aW9uLCBnZW9tZXRyeSBvciBnZW9ncmFwaHknKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBfY2hlY2tCdWZmZXJzQXNzaWduRGVmYXVsdHMoKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLmJ1ZmZlclR5cGUgIT0gdW5kZWZpbmVkICYmIHR5cGVvZiB0aGlzLmJ1ZmZlclVuaXRzICE9IHVuZGVmaW5lZCAmJiB0eXBlb2YgdGhpcy5idWZmZXJTaXplcyAhPSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICghaXNOYU4odGhpcy5idWZmZXJTaXplc1swXSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMuYnVmZmVyVHlwZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyVHlwZSA9ICdyaW5nJzsgLy8gZGVmYXVsdFxuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMuYnVmZmVyVW5pdHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmJ1ZmZlclVuaXRzID0gJ21pbGVzJzsgLy8gZGVmYXVsdFxuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMuYnVmZmVyU2l6ZXMgPT0gdW5kZWZpbmVkIHx8IGlzTmFOKHRoaXMuYnVmZmVyU2l6ZXNbMF0pKSB7XG4gICAgICAvLyB1c2UgZGVmYXVsdFxuICAgICAgdGhpcy5idWZmZXJTaXplcyA9IFsxXTtcbiAgICB9XG4gIH1cbiAgLyoqIHJlZ2VuZXJhdGVDb250ZW50XG4gICAqICAgIFJlYnVpbGRzIHRoZSBpbmZvZ3JhcGhpYyBDYXJkIHVzaW5nIGN1cnJlbnQgc2V0dGluZ3NcbiAgICpcbiAgICogQHBhcmFtIHN1Z2dlc3RlZCAgIGJvb2xlYW4sIGlmIHRydWUgPSB3aWxsIE5PVCByZW5kZXIgdW5sZXNzIGluZm9ncmFwaGljIGhhc1xuICAgKiAgICAgICAgICAgICAgICAgICAgYWxyZWFkeSBiZWVuIHJlbmRlcmVkIGJlZm9yZVxuICAgKi9cbiAgYXN5bmMgcmVnZW5lcmF0ZUNvbnRlbnQoc3VnZ2VzdGVkKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghc3VnZ2VzdGVkIHx8IChzZWxmLl9pRnJhbWUuY29udGFpbmVyICYmIHNlbGYuX2lGcmFtZS5pbnN0YW5jZSkpIHtcbiAgICAgICAgaWYgKHNlbGYuX2lGcmFtZS5jb250YWluZXIpIHtcbiAgICAgICAgICBVdGlscy5yZW1vdmVDaGlsZHJlbihzZWxmLl9pRnJhbWUuY29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgICAgICBzZWxmLl9pRnJhbWUuaW5zdGFuY2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIFJ1biByZXBvcnQgd2l0aCBjdXJyZW50IHBhcmFtZXRlcnNcbiAgICAgICAgYXdhaXQgc2VsZi5sb2FkSW5mb2dyYXBoaWMoc2VsZi5faUZyYW1lLmlkLCBzZWxmLl9pRnJhbWUuY29udGFpbmVyLCBzZWxmLnJlcG9ydExvY2F0aW9uLCBzZWxmLnJlcG9ydEdlb21ldHJ5LCBzZWxmLnJlcG9ydElkLCBzZWxmLnJlcG9ydEdlb2dyYXBoeSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgY29uc29sZS5sb2coJ0luZm9ncmFwaGljQ2FyZDogcmVnZW5lcmF0ZUNvbnRlbnQnLCBleCk7XG4gICAgfVxuICB9XG4gIF92YWxpZGF0ZVJlcG9ydEdlb21ldHJ5KGRhdGEpIHtcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBkYXRhLmxlbmd0aDsgaWkrKykge1xuICAgICAgICBsZXQgciA9IGRhdGFbaWldO1xuICAgICAgICBpZiAoIXJcbiAgICAgICAgICB8fCAhVXRpbHMuaGFzVGV4dChyLnRyYW5zcG9ydClcbiAgICAgICAgICB8fCAhci5sYXRpdHVkZVxuICAgICAgICAgIHx8ICFyLmxvbmdpdHVkZVxuICAgICAgICAgIHx8ICFyLnZhbHVlXG4gICAgICAgICAgfHwgIVV0aWxzLmhhc1RleHQoci51bml0cylcbiAgICAgICAgICB8fCAhci5yaW5ncylcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIC8qKiBfZ2V0UmVwb3J0R2VvbWV0cnlBbmFseXNpc0FyZWFzXG4gICAqXG4gICAqICBUYWtlIHRoZSByZXBvcnRHZW9tZXRyeSBKUyBvYmplY3QgYW5kIGdlbmVyYXRlcyBnZW9tZXRyeSBqc29uIGZvclxuICAgKiAgRHJpdmV0aW1lcywgV2Fsa3RpbWVzLCBvciBSaW5nc1xuICAgKi9cbiAgYXN5bmMgX2dldFJlcG9ydEdlb21ldHJ5QW5hbHlzaXNBcmVhcygpIHtcbiAgICBsZXQganNvbiA9ICcnO1xuICAgIGlmICh0aGlzLnJlcG9ydEdlb21ldHJ5KSB7XG4gICAgICBpZiAodGhpcy5yZXBvcnRHZW9tZXRyeS50eXBlICYmIHRoaXMucmVwb3J0R2VvbWV0cnkudHlwZSA9PSAncG9seWdvbicpIHtcbiAgICAgICAganNvbiA9IEdlb21ldHJ5VXRpbC5nZXRBbmFseXNpc0FyZWFzRnJvbVBvbHlnb24odGhpcy5yZXBvcnRHZW9tZXRyeSwgdGhpcy5yZXBvcnRMb2NhdGlvbk5hbWUsIHRoaXMucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5idWZmZXJUeXBlID09ICdkcml2ZXRpbWUnIHx8IHRoaXMuYnVmZmVyVHlwZSA9PSAnd2Fsa3RpbWUnKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX3ZhbGlkYXRlUmVwb3J0R2VvbWV0cnkodGhpcy5yZXBvcnRHZW9tZXRyeSkpIHtcbiAgICAgICAgICAgIGpzb24gPSBHZW9tZXRyeVV0aWwuZ2V0QW5hbHlzaXNBcmVhc0Zyb21SaW5ncyh0aGlzLnJlcG9ydEdlb21ldHJ5LCB0aGlzLnJlcG9ydExvY2F0aW9uTmFtZSwgdGhpcy5yZXBvcnRMb2NhdGlvbkF0dHJpYnV0ZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBEZWJ1Z0xvZy5sb2coJ19nZXRSZXBvcnRHZW9tZXRyeUFuYWx5c2lzQXJlYXMnLCAncmVwb3J0R2VvbWV0cnkgaXMgaW52YWxpZCcsIHRoaXMucmVwb3J0R2VvbWV0cnkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMuYnVmZmVyVHlwZSA9PSAnZHJpdmV0aW1lJyB8fCB0aGlzLmJ1ZmZlclR5cGUgPT0gJ3dhbGt0aW1lJykge1xuICAgICAgLy9cbiAgICAgIC8vIGdlbmVyYXRlIHRoZSBEVC9XVCBidWZmZXJzIHVzaW5nIEdFIGVucmljaCByZXF1ZXN0XG4gICAgICBUcmFuc3BvcnRVdGlsLnNldFRva2VuKHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4pO1xuICAgICAgbGV0IG9iaiA9IGF3YWl0IFRyYW5zcG9ydFV0aWwuZ2V0QnVmZmVycyh0aGlzLmJ1ZmZlclR5cGUsIHRoaXMuc291cmNlQ291bnRyeSwgdGhpcy5idWZmZXJVbml0cywgdGhpcy5idWZmZXJTaXplcywgdGhpcy5yZXBvcnRMb2NhdGlvbi5sb24sIHRoaXMucmVwb3J0TG9jYXRpb24ubGF0KTtcbiAgICAgIGpzb24gPSBHZW9tZXRyeVV0aWwuZ2V0QW5hbHlzaXNBcmVhc0Zyb21FbnJpY2hCdWZmZXJzKG9iaiwgdGhpcy5yZXBvcnRMb2NhdGlvbk5hbWUsIHRoaXMucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzKTtcbiAgICB9XG4gICAgcmV0dXJuIGpzb247XG4gIH1cbiAgX2NoZWNrQnVmZmVycygpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuYnVmZmVyVHlwZSAhPSB1bmRlZmluZWQgJiYgdHlwZW9mIHRoaXMuYnVmZmVyVW5pdHMgIT0gdW5kZWZpbmVkICYmIHR5cGVvZiB0aGlzLmJ1ZmZlclNpemVzICE9IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKCFpc05hTih0aGlzLmJ1ZmZlclNpemVzWzBdKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJUeXBlID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5idWZmZXJUeXBlID0gJ3JpbmcnOyAvLyBkZWZhdWx0XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJVbml0cyA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyVW5pdHMgPSAnbWlsZXMnOyAvLyBkZWZhdWx0XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5idWZmZXJTaXplcyA9PSB1bmRlZmluZWQgfHwgaXNOYU4odGhpcy5idWZmZXJTaXplc1swXSkpIHtcbiAgICAgIC8vIHVzZSBkZWZhdWx0XG4gICAgICB0aGlzLmJ1ZmZlclNpemVzID0gWzFdO1xuICAgIH1cbiAgfVxuICBnZW5lcmF0ZU5vdFJlYWR5SHRtbCgpIHtcbiAgICBsZXQgbnJJZCA9IEVsZW1lbnRJZHMuZ2VuZXJhdGVJZCgnbm90UmVhZHlEaXYnKTtcbiAgICByZXR1cm4gJzxkaXYgaWQ9XCInICsgbnJJZCArICdcIiBjbGFzcz1cIm5vdFJlYWR5T3V0ZXJcIiA+IFxcXG4gICAgICAgICAgPHN2ZyBjbGFzcz1cIm5vdFJlYWR5U3ZnXCIgcHJlc2VydmVBc3BlY3RSYXRpbz1cInhNaWRZTWlkIG1lZXRcIiB3aWR0aD1cIjY2XCIgaGVpZ2h0PVwiNThcIj4gXFxcbiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT1cIm1hdHJpeCgwLjY1OTA5MDk0IDAgMCAwLjY1OTA5MDk0IDAuMDkwOTA5NjIgLTApXCI+IFxcXG4gICAgICAgICAgICAgIDxnPiBcXFxuICAgICAgICAgICAgICAgIDxwYXRoIFxcXG4gICAgICAgICAgICAgICAgICBkPVwiTTQ4LjQ0NTMxMiAwLjE1NjI1QyA0OC4xMjUgMC4yMzQzNzUgNDcuNTYyNSAwLjQ0NTMxMiA0Ny4xOTUzMTIgMC42MzI4MTJDIDQ2LjY0ODQzOCAwLjkwNjI1IDQ2LjM3NSAxLjExNzE4OCA0NS43MzQzNzUgMS43NTc4MTJDIDQ1LjI1NzgxMiAyLjIyNjU2MiA0NC43NjU2MjUgMi44MDQ2ODggNDQuNTA3ODEyIDMuMjAzMTI1QyA0My44NDM3NSA0LjIzNDM3NSAzOS4xODc1IDEyLjQ0MTQwNiAyMS4zNjcxODggNDMuOTYwOTM4QyAxNS4xNzE4NzUgNTQuOTE3OTcgNy45NzY1NjIgNjcuNjU2MjUgNS4zNzUgNzIuMjUzOTFDIDIuNzczNDM4IDc2Ljg1NTQ3IDAuNTU0Njg4IDgwLjgzMjAzIDAuNDQ1MzEyIDgxLjA4OTg0QyAtMC4xNzE4NzUgODIuNTU0NjkgLTAuMTE3MTg4IDg0LjE3MTg3NSAwLjU5Mzc1IDg1LjQ2MDk0QyAwLjcxMDkzOCA4NS42Nzk2OSAxLjA5Mzc1IDg2LjEzMjgxIDEuNDM3NSA4Ni40NzY1NkMgMi4xNDg0MzggODcuMTc5NjkgMi44MjAzMTIgODcuNTYyNSAzLjgyODEyNSA4Ny44NDM3NUwzLjgyODEyNSA4Ny44NDM3NUw0LjQyMTg3NSA4OEw1MC4zNTE1NjIgODcuOTg0Mzc1TDk2LjI4OTA2IDg3Ljk2MDk0TDk2LjkyMTg3NSA4Ny43NUMgOTkuNzU3ODEgODYuNzgxMjUgMTAwLjc4MTI1IDgzLjg1MTU2IDk5LjI5Njg3NSA4MC44ODY3MkMgOTkuMTMyODEgODAuNTUwNzggOTIuMjczNDQgNjguNTM5MDYgODQuMDU0NjkgNTQuMTgzNTk0QyA3NS44MzU5NCAzOS44MzU5MzggNjYuMDIzNDQgMjIuNjk1MzEyIDYyLjI1IDE2LjA5NzY1NkMgNTguNDY4NzUgOS41MDM5MDYgNTUuMTQ4NDM4IDMuNzUgNTQuODU5Mzc1IDMuMzIwMzEyQyA1My45Mzc1IDEuOTM3NSA1Mi43NjU2MjUgMC44OTA2MjUgNTEuNTg1OTM4IDAuNDA2MjVDIDUwLjYwOTM3NSAwIDQ5LjQ2MDkzOCAtMC4wOTM3NSA0OC40NDUzMTIgMC4xNTYyNXpNNjEgMjYuODA0Njg4QyA2Ny4xOTUzMSAzNy42MTMyOCA3Ni43NzM0NCA1NC4zMzk4NDQgODIuMjgxMjUgNjMuOTY4NzVMODIuMjgxMjUgNjMuOTY4NzVMOTIuMzA0NjkgODEuNDcyNjZMNzEuMTE3MTkgODEuNDk2MDlDIDU5LjQ2MDkzOCA4MS41MDM5MSA0MC4zODI4MTIgODEuNTAzOTEgMjguNzE4NzUgODEuNDk2MDlMMjguNzE4NzUgODEuNDk2MDlMNy41MDc4MTIgODEuNDcyNjZMMjAuNTIzNDM4IDU4LjQ1NzAzQyA0NS40Mjk2ODggMTQuNDAyMzQ0IDQ5LjYyNSA3LjAxMTcxOSA0OS42OTUzMTIgNy4wOTc2NTZDIDQ5LjcyNjU2MiA3LjEyODkwNiA1NC44MTI1IDE1Ljk5NjA5NCA2MSAyNi44MDQ2ODh6XCIgXFxcbiAgICAgICAgICAgICAgICAgIHN0cm9rZT1cIm5vbmVcIiBcXFxuICAgICAgICAgICAgICAgICAgZmlsbD1cIiNENEQ3RERcIiBcXFxuICAgICAgICAgICAgICAgICAgZmlsbC1ydWxlPVwibm9uemVyb1wiIFxcXG4gICAgICAgICAgICAgICAgLz4gXFxcbiAgICAgICAgICAgICAgICA8cGF0aCBcXFxuICAgICAgICAgICAgICAgICAgZD1cIk00OS4xNDA2MjUgMjYuNDYwOTM4QyA0OS4wMzEyNSAyNi40ODQzNzUgNDguNjY0MDYyIDI2LjU3MDMxMiA0OC4zMjgxMjUgMjYuNjU2MjVDIDQ1LjI4MTI1IDI3LjQyMTg3NSA0Mi44MTI1IDMwLjM2MzI4MSA0Mi44MTI1IDMzLjE5OTIyQyA0Mi44MTI1IDMzLjU1ODU5NCA0Mi45ODQzNzUgMzUuMTgzNTk0IDQzLjIwMzEyNSAzNi44MDA3OEMgNDMuNDE0MDYyIDM4LjQxNzk3IDQ0LjA4NTkzOCA0My41IDQ0LjY4NzUgNDguMTAxNTYyQyA0Ni4yNTc4MTIgNjAuMDk3NjU2IDQ2LjI0MjE4OCA1OS45NTcwMyA0Ni4zNzUgNjAuNDU3MDNDIDQ2LjcwMzEyNSA2MS43NSA0Ny40NzY1NjIgNjIuNzgxMjUgNDguNDkyMTg4IDYzLjI4MTI1QyA0OS4wMTU2MjUgNjMuNTM5MDYyIDQ5LjE2NDA2MiA2My41NzgxMjUgNDkuODA0Njg4IDYzLjYwMTU2MkMgNTAuOTkyMTg4IDYzLjY1NjI1IDUxLjcyNjU2MiA2My4zNjcxODggNTIuNTIzNDM4IDYyLjUzOTA2MkMgNTMuMjk2ODc1IDYxLjcxODc1IDUzLjY0ODQzOCA2MC43ODkwNjIgNTMuODk4NDM4IDU4LjkxMDE1NkMgNTMuOTg0Mzc1IDU4LjI1MzkwNiA1NC4zNzUgNTUuMzAwNzggNTQuNzY1NjI1IDUyLjMzOTg0NEMgNTUuMTQ4NDM4IDQ5LjM4MjgxMiA1NS43ODkwNjIgNDQuNTU0Njg4IDU2LjE3MTg3NSA0MS41OTM3NUMgNTYuNTYyNSAzOC42NDA2MjUgNTYuOTUzMTI1IDM1LjY4MzU5NCA1Ny4wMzkwNjIgMzUuMDI3MzQ0QyA1Ny4yMjY1NjIgMzMuNjA1NDcgNTcuMjM0Mzc1IDMyLjY0NDUzIDU3LjA3MDMxMiAzMi4wMDM5MDZDIDU2LjQyOTY4OCAyOS40ODA0NjkgNTQuMjU3ODEyIDI3LjMyMDMxMiA1MS42NTYyNSAyNi42NDA2MjVDIDUxLjA3MDMxMiAyNi40ODQzNzUgNDkuNTc4MTI1IDI2LjM4MjgxMiA0OS4xNDA2MjUgMjYuNDYwOTM4elwiIFxcXG4gICAgICAgICAgICAgICAgICBzdHJva2U9XCJub25lXCIgXFxcbiAgICAgICAgICAgICAgICAgIGZpbGw9XCIjRDREN0REXCIgXFxcbiAgICAgICAgICAgICAgICAgIGZpbGwtcnVsZT1cIm5vbnplcm9cIiBcXFxuICAgICAgICAgICAgICAgIC8+IFxcXG4gICAgICAgICAgICAgICAgPHBhdGggXFxcbiAgICAgICAgICAgICAgICAgIGQ9XCJNNDkuMzkwNjI1IDY2LjU5Mzc1QyA0Ni42OTUzMTIgNjYuOTM3NSA0NC43NSA2OS40OTIxOSA0NS4wNzgxMjUgNzIuMjY5NTNDIDQ1LjIzNDM3NSA3My41NjY0MSA0NS43NSA3NC42MjEwOSA0Ni42NzE4NzUgNzUuNDcyNjZDIDQ3LjU2MjUgNzYuMzA4NTkgNDguNTIzNDM4IDc2LjcyMjY2IDQ5LjcyNjU2MiA3Ni44MDA3OEMgNTEuMTg3NSA3Ni44ODY3MiA1Mi4zNTE1NjIgNzYuNDMzNTkgNTMuNDM3NSA3NS4zMzk4NEMgNTQuNDg0Mzc1IDc0LjI5Mjk3IDU0LjkzNzUgNzMuMjA3MDMgNTQuOTQ1MzEyIDcxLjcwNzAzQyA1NC45NTMxMjUgNzAuNzk2ODc1IDU0Ljg0Mzc1IDcwLjI3MzQ0IDU0LjQ5MjE4OCA2OS41MTU2MjVDIDUzLjU1NDY4OCA2Ny40NzY1NiA1MS41MzEyNSA2Ni4zMjAzMSA0OS4zOTA2MjUgNjYuNTkzNzV6XCIgXFxcbiAgICAgICAgICAgICAgICAgIHN0cm9rZT1cIm5vbmVcIiBcXFxuICAgICAgICAgICAgICAgICAgZmlsbD1cIiNENEQ3RERcIiBcXFxuICAgICAgICAgICAgICAgICAgZmlsbC1ydWxlPVwibm9uemVyb1wiIFxcXG4gICAgICAgICAgICAgICAgLz4gXFxcbiAgICAgICAgICAgICAgPC9nPiBcXFxuICAgICAgICAgICAgPC9nPiBcXFxuICAgICAgICAgIDwvc3ZnPiBcXFxuICAgICAgICA8L2Rpdj4nO1xuICB9XG4gIGFzeW5jIGxvYWRJbmZvZ3JhcGhpYyhpZCwgY29udGFpbmVyLCBsb2NhdGlvbiwgZ2VvbWV0cnksIHJlcG9ydElkLCBnZW9ncmFwaHkpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBpZiAoIWlkIHx8ICFjb250YWluZXIgfHwgKCFsb2NhdGlvbiAmJiAhZ2VvbWV0cnkgJiYgIWdlb2dyYXBoeSkgfHwgIXJlcG9ydElkKVxuICAgICAgdGhyb3cgKCdpbmZvZ3JhcGhpY0NhcmQgZXJyb3I6IGludmFsaWQgYXJncyBsb2FkaW5nIGluZm9ncmFwaGljJyk7XG4gICAgc2VsZi5faUZyYW1lID0geyBpZDogaWQsIGNvbnRhaW5lcjogY29udGFpbmVyLCBpbnN0YW5jZTogbnVsbCB9O1xuICAgIHNlbGYucmVwb3J0R2VvbWV0cnkgPSBnZW9tZXRyeTtcbiAgICBzZWxmLnJlcG9ydElkID0gcmVwb3J0SWQ7XG4gICAgc2VsZi5yZXBvcnRHZW9ncmFwaHkgPSBnZW9ncmFwaHk7XG4gICAgc2VsZi5yZXBvcnRMb2NhdGlvbiA9IGxvY2F0aW9uO1xuICAgIFV0aWxzLnJlbW92ZUNoaWxkcmVuKGNvbnRhaW5lcik7XG4gICAgLy8gY3JlYXRlIG5ldyBpZnJhbWVcbiAgICBzZWxmLl9pRnJhbWUuY29udGFpbmVyLmlubmVySFRNTCA9ICc8aWZyYW1lIGlkPVwiJyArIHNlbGYuX2lGcmFtZS5pZCArICdcIiBjbGFzcz1cImFyY2dpc0luZm9ncmFwaGljRnJhbWVcIj48L2lmcmFtZT4nO1xuICAgIC8vIGNvbnRpbnVlIGFmdGVyIGRvbSBzZXR0bGVzXG4gICAgY29uc3QgX2NvbnRpbnVlTG9hZGluZyA9IGFzeW5jICgpID0+IHtcbiAgICAgIHNlbGYuX2lGcmFtZS5pbnN0YW5jZSA9IHNlbGYuX2NvbnRhaW5lclNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihVdGlscy5maXhJZCh0aGlzLl9pRnJhbWUuaWQpKTtcbiAgICAgIGlmICghc2VsZi5faUZyYW1lLmluc3RhbmNlKSA7XG4gICAgICBlbHNlIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBtZXNzYWdlIHRoZSBpbmZvZ3JhcGhpYyBpZnJhbWUgd2l0aCBVUkwgYW5kIHBhcmFtcyB3aGVuIGxvYWRlZFxuICAgICAgICAgIC8vXG4gICAgICAgICAgLy8gT3B0aW9uc1xuICAgICAgICAgIGNvbnN0IGVudiA9IEVudmlyb25tZW50cy5nZXRFbnZpcm9ubWVudCgpO1xuICAgICAgICAgIC8vIEVudmlyb25tZW50cyBlbnYgc2hvdWxkIGFsd2F5cyBiZSBjb3JyZWN0XG4gICAgICAgICAgLy8gY29uc29sZS5hc3NlcnQoZW52ID09PSBzZWxmLmVudmlyb25tZW50KVxuICAgICAgICAgIHNlbGYuZW52aXJvbm1lbnQgPSBlbnY7XG4gICAgICAgICAgc2V0RW52aXJvbm1lbnQoc2VsZi5lbnZpcm9ubWVudCk7XG4gICAgICAgICAgY29uc3QgcGxheWVyUGFnZVVybCA9IGF3YWl0IEluZm9ncmFwaGljc0hlbHBlci5fZ2V0SW5mb2dyYXBoaWNzUGxheWVyVXJsKCk7XG4gICAgICAgICAgLy8gZGVmYXVsdCBlbnZpcm9ubWVudCBpcyAnd3d3J1xuICAgICAgICAgIGNvbnN0IHN1YmRvbWFpbiA9IHNlbGYuZW52aXJvbm1lbnQgPT09ICdkZXYnID8gJ2RldmV4dCcgOiBzZWxmLmVudmlyb25tZW50ID09PSAncWEnID8gJ3FhZXh0JyA6ICd3d3cnO1xuICAgICAgICAgIGxldCBsYXQgPSAoc2VsZi5yZXBvcnRMb2NhdGlvbikgPyBzZWxmLnJlcG9ydExvY2F0aW9uLmxhdCA6IDA7XG4gICAgICAgICAgbGV0IGxvbiA9IChzZWxmLnJlcG9ydExvY2F0aW9uKSA/IHNlbGYucmVwb3J0TG9jYXRpb24ubG9uIDogMDtcbiAgICAgICAgICBpZiAoIXNlbGYucmVwb3J0R2VvbWV0cnkgJiYgKCFzZWxmLnJlcG9ydExvY2F0aW9uIHx8ICFsYXQgfHwgIWxvbikgJiYgIXNlbGYucmVwb3J0R2VvZ3JhcGh5KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSW5mb2dyYXBoaWNDYXJkIGVycm9yOiBpbnZhbGlkIGxvY2F0aW9uLCBnZW9tZXRyeSBvciBnZW9ncmFwaHknLCBzZWxmLnJlcG9ydExvY2F0aW9uLCBzZWxmLnJlcG9ydEdlb21ldHJ5LCBzZWxmLnJlcG9ydEdlb2dyYXBoeSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5sYW5nQ29kZSA9IHNlbGYubGFuZ0NvZGUgfHwgJ2VuLXVzJztcbiAgICAgICAgICAgIHNlbGYuc291cmNlQ291bnRyeSA9IHNlbGYuc291cmNlQ291bnRyeSB8fCAnVVMnO1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdEhpZXJhcmNoeSA9IGF3YWl0IEdFQ2xpZW50LmdldEdFRGVmYXVsdEhpZXJhcmNoeShzZWxmLnNvdXJjZUNvdW50cnksIHNlbGYucG9ydGFsT25saW5lR0VQcm94eSA/IHNlbGYudG9rZW4gOiBcIlwiKTtcbiAgICAgICAgICAgIC8vIE5lZWQgdG8gcGFzcyB0aGUgc2Vjb25kIHBhcmFtZXRlciBpbiBsYW5nQ29kZSBhcyB1cHBlcmNhc2UgdG8gUmVwb3J0UGxheWVyIHRvIHdvcmsgKGUuZy4gcHQtQlIsIG5vdCBwdC1icilcbiAgICAgICAgICAgIGNvbnN0IHVwcGVyTGFuZ0NvZGUgPSBzZWxmLmxhbmdDb2RlLmxlbmd0aCA9PT0gNSA/IHNlbGYubGFuZ0NvZGUuc3Vic3RyaW5nKDAsIDMpICsgc2VsZi5sYW5nQ29kZS5zdWJzdHJpbmcoMykudG9VcHBlckNhc2UoKSA6IHNlbGYubGFuZ0NvZGU7XG4gICAgICAgICAgICBsZXQgcGFyYW1zID0gJ3sgXFxcbiAgICAgICAgICAgICAgICBcInVzZXJJZFwiOlwiJyArIHNlbGYudXNlcm5hbWUgKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJ0b2tlblwiOlwiJyArIHNlbGYudG9rZW4gKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJleHBpcmVzXCI6XCInICsgKE1hdGguZmxvb3IoRGF0ZS5ub3coKSArIDg2NDAwMDAwLjUpKS50b1N0cmluZygpICsgJ1wiLCBcXFxuICAgICAgICAgICAgICAgIFwiY29tcG9uZW50SWRcIjpcIicgKyBzZWxmLl9pRnJhbWUuaWQgKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJyZXBvcnRJRFwiOlwiJyArIHNlbGYucmVwb3J0SWQgKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJjb3VudHJ5SURcIjpcIicgKyBzZWxmLnNvdXJjZUNvdW50cnkgKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJsYW5nQ29kZVwiOlwiJyArIHVwcGVyTGFuZ0NvZGUgKyAnXCIsIFxcXG4gICAgICAgICAgICAgICAgXCJhbGxMYW5ndWFnZXNcIjp0cnVlLCBcXFxuICAgICAgICAgICAgICAgIFwiaGllcmFyY2h5XCI6XCInICsgZGVmYXVsdEhpZXJhcmNoeSArICdcIiwgJztcbiAgICAgICAgICAgIGlmIChzZWxmLmdlb2VucmljaG1lbnRVcmwpIHtcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcgXCJnZW9lbnJpY2htZW50VXJsXCI6XCInICsgc2VsZi5nZW9lbnJpY2htZW50VXJsICsgJ1wiLCAnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYucG9ydGFsVXJsKSB7XG4gICAgICAgICAgICAgIHBhcmFtcyArPSAnIFwic2VydmVyXCI6XCInICsgc2VsZi5wb3J0YWxVcmwgKyAnXCIsICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcgXCJzZXJ2ZXJcIjpcImh0dHBzOi8vJyArIHN1YmRvbWFpbiArICcuYXJjZ2lzLmNvbVwiICwnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYucG9ydGFsT25saW5lR0VQcm94eSkge1xuICAgICAgICAgICAgICBwYXJhbXMgKz0gJyBcInBvcnRhbE9ubGluZUdFUHJveHlcIjp0cnVlICwnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGFuYWx5c2lzQXJlYXM7XG4gICAgICAgICAgICAvLyBVc2UgZ2VvZ3JhcGh5IGlmIGl0IGlzIHNldFxuICAgICAgICAgICAgaWYgKHNlbGYucmVwb3J0R2VvZ3JhcGh5KSB7XG4gICAgICAgICAgICAgIGFuYWx5c2lzQXJlYXMgPSAnIFwiYW5hbHlzaXNBcmVhc1wiOiBbe1wibG9jYXRpb25OYW1lXCI6XCInICsgc2VsZi5yZXBvcnRMb2NhdGlvbk5hbWUgKyAnXCIsIFwiZ2VvZ3JhcGhpZXNcIjpbJyArIEpTT04uc3RyaW5naWZ5KHNlbGYucmVwb3J0R2VvZ3JhcGh5KSArICddfV0gJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBhbmFseXNpc0FyZWFzID0gYXdhaXQgc2VsZi5fZ2V0UmVwb3J0R2VvbWV0cnlBbmFseXNpc0FyZWFzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWFuYWx5c2lzQXJlYXMpIHtcbiAgICAgICAgICAgICAgLy8gSW5mb2dyYXBoaWMgd2lsbCBiZSBmb3IgYSBsb2NhdGlvbiB3aXRoIFJpbmdzXG4gICAgICAgICAgICAgIGlmIChzZWxmLmJ1ZmZlclVuaXRzID09ICdtaW51dGVzJykge1xuICAgICAgICAgICAgICAgIC8vIGludmFsaWQgdW5pdHMgZm9yIHJpbmdzXG4gICAgICAgICAgICAgICAgc2VsZi5idWZmZXJVbml0cyA9IHNlbGYuYnVmZmVyVW5pdHMgPSAnbWlsZXMnOyAvLyBkZWZhdWx0IHVuaXRzIGZvciByaW5nc1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGxldCBhcmVhcyA9IEdlb21ldHJ5VXRpbC5nZXRSaW5ncyhsYXQsIGxvbiwgc2VsZi5idWZmZXJVbml0cywgc2VsZi5idWZmZXJTaXplcywgdGhpcy5yZXBvcnRMb2NhdGlvbk5hbWUsIHRoaXMucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzKTtcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcgXCJhbmFseXNpc0FyZWFzXCI6ICcgKyBKU09OLnN0cmluZ2lmeShhcmVhcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgcGFyYW1zICs9IGFuYWx5c2lzQXJlYXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb3B0aW9ucyA9IHNlbGYuX2NyZWF0ZUluZm9ncmFwaGljUGxheWVyU3R5bGVPcHRpb25zKCk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcGFyYW1zICs9ICcsJyArIG9wdGlvbnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMgKz0gJyB9JztcbiAgICAgICAgICAgIC8vIEFmdGVyIHRoZSBpZnJhbWUgbG9hZHMsIHdlIG1lc3NhZ2UgaXQgd2l0aCB0aGUgaW5zdHJ1Y3Rpb25zIGFib3V0XG4gICAgICAgICAgICAvLyB0aGUgaW5mb2dyYXBoaWMgdGhhdCB3aWxsIGJlIGdlbmVyYXRlZFxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNlbGYuX2lGcmFtZS5pbnN0YW5jZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGZ1bmN0aW9uIF9kZWxheSgpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuX2lGcmFtZSAmJiBzZWxmLl9pRnJhbWUuaW5zdGFuY2UgJiYgc2VsZi5faUZyYW1lLmluc3RhbmNlLmNvbnRlbnRXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiJWMgaW5mb2dyYXBoaWNDYXJkOiBpZnJhbWUgb25sb2FkIGV2ZW50OiBwYXNzaW5nIHBhcmFtcyB0byBwbGF5ZXIgPT4gXCIsJ2NvbG9yOmJsdWU7Zm9udC1zaXplOjEwcHQnLCBKU09OLnBhcnNlKHBhcmFtcykpXG4gICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICBzZWxmLl9pRnJhbWUuaW5zdGFuY2UuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbmZvZ3JhcGhpY19wYXJhbWV0ZXJzJyxcbiAgICAgICAgICAgICAgICAgICAgaW5mb2dyYXBoaWNQYXJhbWV0ZXJzOiBwYXJhbXNcbiAgICAgICAgICAgICAgICAgIH0sIHBsYXllclBhZ2VVcmwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KF9kZWxheSwgNTAwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBpbnN0YW50aWF0ZSBpbmZvZ3JhcGhpYyBwbGF5ZXIgKHJlcG9ydCB3aWxsIGRpc3BsYXkgYWZ0ZXIgbG9hZGVkKVxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgc2VsZi5faUZyYW1lLmluc3RhbmNlLnNyYyA9IHBsYXllclBhZ2VVcmw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChleCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdJbmZvZ3JhcGhpY0NhcmQgZXJyb3InLCBleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHNldFRpbWVvdXQoX2NvbnRpbnVlTG9hZGluZywgMCk7XG4gIH1cbiAgLy8gLyoqXG4gIC8vICAqIFJlbmRlcnMgdGhlIGluZm9ncmFwaGljIGlmcmFtZSBPUiB0aGUgd2FybmluZyBpbWFnZVxuICAvLyAgKlxuICAvLyAgKiBBY3R1YWwgaW5mb2dyYXBoaWMgZGlzcGxheSBpcyBkb25lIGluIHRoZSAnbG9hZEluZm9ncmFwaGljJyBmdW5jdGlvblxuICAvLyAgKi9cbiAgLy8gcmVuZGVyKCkge1xuICAvLyAgIGxldCBfc2hvd1dhcm5pbmcgPSBmYWxzZVxuICAvLyAgIHRoaXMuX2NoZWNrQnVmZmVycygpXG4gIC8vICAgaWYoIXRoaXMuX3ZhbGlkYXRlU2V0dXAoKSkge1xuICAvLyAgICAgRGVidWdMb2cubG9nKCdJbmZvZ3JhcGhpY0NhcmQnLCAnIGVycm9yIC0gbm8gbG9jYXRpb24gb3IgYm91bmRhcnkgdG8gZGlzcGxheScpXG4gIC8vICAgICBfc2hvd1dhcm5pbmcgPSB0cnVlXG4gIC8vICAgfVxuICAvLyAgIGlmKCFfc2hvd1dhcm5pbmcgJiYgIXRoaXMucmVwb3J0TG9jYXRpb24gJiYgIXRoaXMucmVwb3J0R2VvbWV0cnkpIHtcbiAgLy8gICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJyBlcnJvciAtIG5vIGxvY2F0aW9uIG9yIGJvdW5kYXJ5IHRvIGRpc3BsYXknKVxuICAvLyAgICAgX3Nob3dXYXJuaW5nID0gdHJ1ZVxuICAvLyAgIH1cbiAgLy8gICBpZighX3Nob3dXYXJuaW5nICYmICghdGhpcy51c2VybmFtZSB8fCAhdGhpcy50b2tlbikpIHtcbiAgLy8gICAgIERlYnVnTG9nLmxvZygnSW5mb2dyYXBoaWNDYXJkJywgJyByZW5kZXIgZXJyb3IgLSBpbnZhbGlkIHVzZXJuYW1lL3Rva2VuJylcbiAgLy8gICAgIF9zaG93V2FybmluZyA9IHRydWVcbiAgLy8gICB9XG4gIC8vXG4gIC8vICAgaWYoIV9zaG93V2FybmluZykge1xuICAvLyAgICAgdGhpcy5fY2hlY2tCdWZmZXJzQXNzaWduRGVmYXVsdHMoKVxuICAvLyAgICAgc2V0VG9rZW4odGhpcy51c2VybmFtZSwgdGhpcy50b2tlbilcbiAgLy8gICAgIHJldHVybiAnPGlmcmFtZSBpZD1cIicgKyB0aGlzLl9pRnJhbWUuaWQgKyAnXCIgY2xhc3M9XCJhcmNnaXNJbmZvZ3JhcGhpY0ZyYW1lXCI+PC9pZnJhbWU+J1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZU5vdFJlYWR5SHRtbCgpXG4gIC8vICAgfVxuICAvLyB9XG4gIC8qIENsaWVudCBpbnRlcmZhY2UgKi9cbiAgdXBkYXRlSW5mb2dyYXBoaWMoKSB7XG4gICAgLy8gYXNzdW1pbmcgYWxsIHByb3BlcnRpZXMgaGF2ZSBiZWVuIHVwZGF0ZWQgYWxyZWFkeS5cbiAgICB0aGlzLnJlZ2VuZXJhdGVDb250ZW50KCk7XG4gIH1cbiAgLyoqICBzZXRSZXBvcnRMb2NhdGlvblxuICAgKiAgICAgIFVwZGF0ZXMgdGhlIHJlcG9ydCBsb2NhdGlvbiAobGF0L2xvbikgZm9yIHRoZSByZXBvcnQuIFRoZSBhbHNvXG4gICAqICAgICAgZm9yY2VzIGEgcmVmcmVzaFxuICAgKlxuICAgKiBAcGFyYW0gbG9jIHNlZSBMb2NhdGlvblR5cGVcbiAgICovXG4gIHNldFJlcG9ydExvY2F0aW9uKGxvYykge1xuICAgIGlmIChsb2MgJiYgbG9jLmxhdCAmJiBsb2MubG9uKSB7XG4gICAgICB0aGlzLnJlcG9ydExvY2F0aW9uID0gbG9jO1xuICAgICAgdGhpcy5yZWdlbmVyYXRlQ29udGVudCh0cnVlKTtcbiAgICB9XG4gIH1cbiAgLyoqICBzZXRSZXBvcnRHZW9tZXRyeVxuICAgKiAgICAgIFVwZGF0ZXMgdGhlIHJlcG9ydCBnZW9tZXRyeSBmb3IgdGhlIHJlcG9ydCBhbmRcbiAgICogICAgICBmb3JjZXMgYSByZWZyZXNoXG4gICAqXG4gICAqIEBwYXJhbSBsb2MgZ2VvbWV0cnkgb2JqZWN0XG4gICAqL1xuICBzZXRSZXBvcnRHZW9tZXRyeShnZW9tZXRyeSkge1xuICAgIGlmIChnZW9tZXRyeSkge1xuICAgICAgdGhpcy5yZXBvcnRHZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgICAgdGhpcy5yZWdlbmVyYXRlQ29udGVudCh0cnVlKTtcbiAgICB9XG4gIH1cbiAgLyoqICBzZXRSZXBvcnRHZW9ncmFwaHlcbiAgICogICAgICBVcGRhdGVzIHRoZSByZXBvcnQgZ2VvZ3JhcGh5IGZvciB0aGUgcmVwb3J0IGFuZFxuICAgKiAgICAgIGZvcmNlcyBhIHJlZnJlc2hcbiAgICpcbiAgICogQHBhcmFtIGxvYyBnZW9ncmFwaHkgb2JqZWN0XG4gICAqL1xuICBzZXRSZXBvcnRHZW9ncmFwaHkoZ2VvZ3JhcGh5KSB7XG4gICAgaWYgKGdlb2dyYXBoeSkge1xuICAgICAgdGhpcy5yZXBvcnRHZW9ncmFwaHkgPSBnZW9ncmFwaHk7XG4gICAgICB0aGlzLnJlZ2VuZXJhdGVDb250ZW50KHRydWUpO1xuICAgIH1cbiAgfVxuICAvKiogZ2VuZXJhdGVCdWZmZXJzXG4gICAqICAgIEdlbmVyYXRlcyBkcml2ZXRpbWUgb3Igd2Fsa3RpbWUgYnVmZmVycyB1c2luZyB0aGUgSW5mb2dyYXBoaWNDYXJkIHByb3BlcnRpZXNcbiAgICpcbiAgICogICAgUmVzdWx0OiBnZW9tZXRyeSBpcyBzYXZlZCBpbnRvIHRoaXMgSW5mb2dyYXBoaWNDYXJkJ3MgcmVwb3J0R2VvbWV0cnlcbiAgICogICAgUmV0dXJuOiBvYmplY3QgPSB7XG4gICAqICAgICAgc3VjY2Vzczpib29sZWFuLFxuICAgKiAgICAgIGVycm9yOnN0cmluZ1xuICAgKiAgICB9XG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZUJ1ZmZlcnMoKSB7XG4gICAgLy8gVmFsaWRhdGlvblxuICAgIGlmICghdGhpcy5zb3VyY2VDb3VudHJ5KVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW5mb2dyYXBoaWNDYXJkIHNvdXJjZUNvdW50cnkgbm90IHZhbGlkJyB9O1xuICAgIGlmICghdGhpcy5idWZmZXJUeXBlIHx8ICh0aGlzLmJ1ZmZlclR5cGUgIT0gJ2RyaXZldGltZScgJiYgdGhpcy5idWZmZXJUeXBlICE9ICd3YWxrdGltZScpKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnWycgKyB0aGlzLmJ1ZmZlclR5cGUgKyAnXSBpbnZhbGlkIGJ1ZmZlclR5cGUgKG11c3QgYmUgXCJkcml2ZXRpbWVcIiBvciBcIndhbGt0aW1lXCIpJ1xuICAgICAgfTtcbiAgICBpZiAoIXRoaXMuYnVmZmVyU2l6ZXMgfHwgdGhpcy5idWZmZXJTaXplcy5sZW5ndGggPD0gMClcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ21pc3NpbmcgYnVmZmVyU2l6ZXMnIH07XG4gICAgLy8gbGV0IGJ1ZmZlclZhbHVlcyA9IHRoaXMuYnVmZmVyU2l6ZXMudG9TdHJpbmcoKTtcbiAgICBpZiAoIXRoaXMuYnVmZmVyVW5pdHMgfHwgKHRoaXMuYnVmZmVyVW5pdHMgIT0gJ21pbGVzJyAmJiB0aGlzLmJ1ZmZlclVuaXRzICE9ICdraWxvbWV0ZXJzJyAmJiB0aGlzLmJ1ZmZlclVuaXRzICE9ICdtaW51dGVzJykpXG4gICAgICByZXR1cm4geyBlcnJvcjogJ2ludmFsaWQgdW5pdHMnIH07XG4gICAgaWYgKCF0aGlzLnJlcG9ydExvY2F0aW9uIHx8ICF0aGlzLnJlcG9ydExvY2F0aW9uLmxhdClcbiAgICAgIHJldHVybiB7IGVycm9yOiAnaW52YWxpZCBsYXRpdHVkZScgfTtcbiAgICBpZiAoIXRoaXMucmVwb3J0TG9jYXRpb24gfHwgIXRoaXMucmVwb3J0TG9jYXRpb24ubG9uKVxuICAgICAgcmV0dXJuIHsgZXJyb3I6ICdpbnZhbGlkIGxhdGl0dWRlJyB9O1xuICAgIC8vIEdFIHJlcXVlc3QgdG8gZ2VuZXJhdGUgZHJpdmV0aW1lL3dhbGt0aW1lIHJpbmdzXG4gICAgVHJhbnNwb3J0VXRpbC5zZXRUb2tlbih0aGlzLnVzZXJuYW1lLCB0aGlzLnRva2VuKTtcbiAgICBsZXQgcmVzdWx0T2JqZWN0O1xuICAgIGxldCBsYXQgPSB0aGlzLnJlcG9ydExvY2F0aW9uLmxhdDtcbiAgICBsZXQgbG9uID0gdGhpcy5yZXBvcnRMb2NhdGlvbi5sb247XG4gICAgaWYgKHRoaXMuYnVmZmVyVHlwZSA9PSAnZHJpdmV0aW1lJykge1xuICAgICAgcmVzdWx0T2JqZWN0ID0gYXdhaXQgVHJhbnNwb3J0VXRpbC5nZXRCdWZmZXJzKCdkcml2ZXRpbWUnLCB0aGlzLnNvdXJjZUNvdW50cnksIHRoaXMuYnVmZmVyVW5pdHMsIHRoaXMuYnVmZmVyU2l6ZXMsIGxvbiwgbGF0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXN1bHRPYmplY3QgPSBhd2FpdCBUcmFuc3BvcnRVdGlsLmdldEJ1ZmZlcnMoJ3dhbGt0aW1lJywgdGhpcy5zb3VyY2VDb3VudHJ5LCB0aGlzLmJ1ZmZlclVuaXRzLCB0aGlzLmJ1ZmZlclNpemVzLCBsb24sIGxhdCk7XG4gICAgfVxuICAgIC8vIHVwZGF0ZSB0aGUgaW5mb2dyYXBoaWMgdG8gZG8gdGhlIGRyaXZldGltZS93YWxrdGltZSBwb2x5Z29uc1xuICAgIC8vIFRoaXMgYXNzaWdubWVudCB0cmlnZ2VycyBhbiBpbmZvZ3JhcGhpYyByZWZyZXNoXG4gICAgLy8gdGhpcy5faXNJbnRlcm5hbFVwZGF0ZSA9IHRydWU7XG4gICAgdGhpcy5yZXBvcnRHZW9tZXRyeSA9IHJlc3VsdE9iamVjdDtcbiAgICByZXR1cm4gcmVzdWx0T2JqZWN0O1xuICB9XG59XG5cbmNvbnN0IGFyY2dpc0luZm9ncmFwaGljQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrfS5ub3RSZWFkeU91dGVye3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS5ub3RSZWFkeURpdntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6Y2FsYyg1MCUgLSA1MHB4KTtsZWZ0OmNhbGMoNTAlIC0gNTBweCk7d2lkdGg6MTAwcHg7aGVpZ2h0OjEwMHB4fS5ub3RSZWFkeVN2Z3twb3NpdGlvbjphYnNvbHV0ZTt0b3A6Y2FsYyg1MCUgLSAyOXB4KTtsZWZ0OmNhbGMoNTAlIC0gMzNweCl9LmFyY2dpc0luZm9ncmFwaGljRnJhbWV7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Ym9yZGVyOm5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc0luZm9ncmFwaGljID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLl9pc0ludGVybmFsVXBkYXRlID0gZmFsc2U7IC8vIGZsYWcgdG8gcHJldmVudCBmdWxsIHByb3BlcnR5IHVwZGF0ZSBtZWNoYW5pc21cbiAgICB0aGlzLl9pZFByZWZpeCA9ICdhcmNnaXMtaW5mb2dyYXBoaWMtJztcbiAgICB0aGlzLl9oYXNTZXRFbnYgPSBmYWxzZTtcbiAgICB0aGlzLl9kZWZhdWx0T3B0aW9ucyA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIGJ1ZmZlclR5cGU6ICdyaW5nJyxcbiAgICAgIGJ1ZmZlclVuaXRzOiAnbWlsZXMnLFxuICAgICAgYnVmZmVyU2l6ZXM6ICcxLDMsNScsXG4gICAgICB2aWV3TW9kZTogJ2F1dG8nXG4gICAgfSk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIHdhdGNoZXNcbiAgb25FbnZDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQodGhpcy5lbnYpO1xuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuZW52aXJvbm1lbnQgPSB0aGlzLmVudjtcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XG4gIH1cbiAgb25Ub2tlbkNoYW5nZWQoKSB7XG4gICAgdGhpcy5zdFRva2VuID0gdGhpcy50b2tlbjtcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnRva2VuID0gdGhpcy50b2tlbjtcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XG4gIH1cbiAgb25Vc2VybmFtZUNoYW5nZWQoKSB7XG4gICAgdGhpcy5zdFVzZXJuYW1lID0gdGhpcy51c2VybmFtZTtcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnVzZXJuYW1lID0gdGhpcy51c2VybmFtZTtcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XG4gIH1cbiAgb25Mb2NhdGlvbkRpc3BsYXlOYW1lQ2hhbmdlZCgpIHtcbiAgICAvLyB0aGlzLl9sKCdsb2NhdGlvbk5hbWUnLHRoaXMubG9jYXRpb25OYW1lKVxuICAgIHRoaXMuc3RMb2NhdGlvbkRpc3BsYXlOYW1lID0gdGhpcy5sb2NhdGlvbk5hbWU7XG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5yZXBvcnRMb2NhdGlvbk5hbWUgPSB0aGlzLmxvY2F0aW9uTmFtZTtcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XG4gIH1cbiAgb25Mb2NhdGlvbkF0dHJpYnV0ZXNDaGFuZ2VkKCkge1xuICAgIC8vIHRoaXMuX2woJ2xvY2F0aW9uTmFtZScsdGhpcy5sb2NhdGlvbk5hbWUpXG4gICAgdGhpcy5zdExvY2F0aW9uQXR0cmlidXRlcyA9IHRoaXMubG9jYXRpb25BdHRyaWJ1dGVzID8gSlNPTi5wYXJzZSh0aGlzLmxvY2F0aW9uQXR0cmlidXRlcykgOiB7fTtcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnJlcG9ydExvY2F0aW9uQXR0cmlidXRlcyA9IHRoaXMuc3RMb2NhdGlvbkF0dHJpYnV0ZXM7XG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgpO1xuICB9XG4gIG9uTGFuZ0NvZGVDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RMYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGU7XG4gICAgaWYgKHRoaXMuX2luZm9ncmFwaGljQ2FyZClcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5sYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGU7XG4gICAgQmFSZXBvcnRzTGFuZ3VhZ2UuX2luaXRpYWxpemUodGhpcy5zdExhbmdDb2RlKTtcbiAgICB0aGlzLl9vblByb3BDaGFuZ2VkKCk7XG4gIH1cbiAgb25Db3VudHJ5Q2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0U291cmNlQ291bnRyeSA9IHRoaXMuc291cmNlQ291bnRyeTtcbiAgICBpZiAodGhpcy5faW5mb2dyYXBoaWNDYXJkKVxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNvdXJjZUNvdW50cnkgPSB0aGlzLnNvdXJjZUNvdW50cnk7XG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgpO1xuICB9XG4gIG9uT3B0aW9uc0NoYW5nZWQoKSB7XG4gICAgdGhpcy5zdE9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgQmFzZVV0aWwuTG9nKCdCQUMgYXJjZ2lzLWluZm9ncmFwaGljIG9wdGlvbnMgY2hhbmdpbmcuLi4nLCB0aGlzLm9wdGlvbnMpO1xuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMsIHRydWUpO1xuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcbiAgfVxuICBvblJlcG9ydElkQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0UmVwb3J0SWQgPSB0aGlzLnJlcG9ydElkO1xuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQpXG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQucmVwb3J0SWQgPSB0aGlzLnJlcG9ydElkO1xuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcbiAgfVxuICBvblRoZW1lQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0VGhlbWUgPSBKU09OLnBhcnNlKHRoaXMudGhlbWUpO1xuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcbiAgfVxuICBvblJlcG9ydExvY2F0aW9uQ2hhbmdlZCgpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zdFJlcG9ydExvY2F0aW9uID0gdGhpcy5yZXBvcnRMb2NhdGlvbjtcbiAgICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICBCYXNlVXRpbC5FcnJvcignb25SZXBvcnRMb2NhdGlvbkNoYW5nZWQnLCBleCk7XG4gICAgfVxuICB9XG4gIG9uUmVwb3J0R2VvbWV0cnlDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RSZXBvcnRHZW9tZXRyeSA9IHRoaXMucmVwb3J0Z2VvbWV0cnk7XG4gICAgLy8gaWYoIXRoaXMuX2lzSW50ZXJuYWxVcGRhdGUpIHtcbiAgICAvLyAgIGlmKHRoaXMuX2luZm9ncmFwaGljQ2FyZCkge1xuICAgIC8vICAgICBpZihVdGlscy5oYXNUZXh0KHRoaXMucmVwb3J0Z2VvbWV0cnkpKVxuICAgIC8vICAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5zZXRSZXBvcnRHZW9tZXRyeShKU09OLnBhcnNlKHRoaXMucmVwb3J0Z2VvbWV0cnkpKVxuICAgIC8vICAgfVxuICAgIHRoaXMuX29uUHJvcENoYW5nZWQoKTtcbiAgICAvLyB9IGVsc2UgdGhpcy5faXNJbnRlcm5hbFVwZGF0ZSA9IGZhbHNlIC8vcmVzZXQgZmxhZ1xuICB9XG4gIG9uUmVwb3J0R2VvZ3JhcGh5Q2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0UmVwb3J0R2VvZ3JhcGh5ID0gdGhpcy5yZXBvcnRnZW9ncmFwaHk7XG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgpO1xuICB9XG4gIC8vIFVwZGF0ZSB0aGUgSW5mb2dyYXBoaWMgUmVwb3J0IHdoZW4gdGhlIGFyY2dpcy1yZXBvcnQtbGlzdCBjaGFuZ2VzXG4gIHJlcG9ydFNlbGVjdGVkRXZlbnRIYW5kbGVyKGUpIHtcbiAgICBsZXQgcmVwb3J0SWQgPSBlLmRldGFpbD8udmFsdWU7XG4gICAgaWYgKHJlcG9ydElkKSB7XG4gICAgICB0aGlzLnN0UmVwb3J0SWQgPSByZXBvcnRJZDtcbiAgICAgIC8vIGRlc3Ryb3kgaWZyYW1lXG4gICAgICBsZXQgZnJhbWUgPSBBQ0xVdGlscy5xdWVyeUVsZW1lbnRCeUlkKHRoaXMuX2lmcmFtZUlkKTtcbiAgICAgIGlmIChmcmFtZSAmJiBmcmFtZS5wYXJlbnROb2RlKSB7XG4gICAgICAgIGZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZnJhbWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5jb21wb25lbnREaWRMb2FkKCk7XG4gICAgfVxuICB9XG4gIC8vIE1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvL1xuICAvKipcbiAgICogZ2VuZXJhdGVCdWZmZXJzXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gcGFzc2VzIGluIHZhbHVlcyBuZWVkZWQgdG8gZG8gZWl0aGVyIGEgZHJpdmV0aW1lIG9yIHdhbGt0aW1lIGJ1ZmZlcnNcbiAgICogcmVwb3J0LiAgVGhlIHZhbHVlcyBwYXNzZWQgaW4gdXBkYXRlIHRoZSBQcm9wcyBpbiB0aGUgY29tcG9uZW50LCBhc3luYyByZXR1cm5zIHRoZVxuICAgKiByaW5ncywgYW5kIGdlbmVyYXRlcyBhIG5ldyBpbmZvZ3JhcGhpYyB1c2luZyB0aGUgZHJpdmV0aW1lIG9yIHdhbGt0aW1lIHZhbHVlcy5cbiAgICpcbiAgICogQHBhcmFtIGJ1ZmZlclR5cGUgPSAnd2Fsa3RpbWUnIG9yICdkcml2ZXRpbWUnXG4gICAqIEBwYXJhbSB2YWx1ZXMgICAgID0gc3RyaW5nIHJlcHJlc2VudGluZyBkcml2ZXRpbWUgZGlzdGFuY2Ugb3IgdGltZSBbZXhhbXBsZTpcIjEsMyw1XCJdXG4gICAqIEBwYXJhbSB1bml0cyAgICAgID0gXCJtaWxlc1wiLCBcImtpbG9tZXRlcnNcIiwgb3IgXCJtaW51dGVzXCJcbiAgICogQHBhcmFtIGxhdGl0dWRlICAgPSBtYXAgbG9jYXRpb25cbiAgICogQHBhcmFtIGxvbmdpdHVkZVxuICAgKlxuICAgKiBAcmV0dXJuID0gW1xuICAgKiAgeyB2YWx1ZTogPGJ1ZmZlclZhbHVlPiwgdW5pdHM6IDxidWZmZXJVbml0cz4sIHJpbmdzOiA8Z2VvbWV0cnkgcmluZ3M+IH0sXG4gICAqICB7IHZhbHVlOiA8YnVmZmVyVmFsdWU+LCB1bml0czogPGJ1ZmZlclVuaXRzPiwgcmluZ3M6IDxnZW9tZXRyeSByaW5ncz4gfSxcbiAgICogIDx1cCB0byAzIHJlc3VsdHMgZGVwZW5kaW5nIG9uIGxlbmd0aCBvZiB2YWx1ZXM+XG4gICAqIF1cbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlQnVmZmVycyhidWZmZXJUeXBlLCB2YWx1ZXMsIHVuaXRzLCBsYXRpdHVkZSwgbG9uZ2l0dWRlKSB7XG4gICAgY29uc3QgY2FyZCA9IHRoaXMuX2luZm9ncmFwaGljQ2FyZDtcbiAgICB0cnkge1xuICAgICAgaWYgKCFjYXJkKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIC8vIGJ1ZmZlclR5cGVcbiAgICAgIGlmIChBQ0xVdGlscy5oYXNUZXh0KGJ1ZmZlclR5cGUpICYmIFsncmluZycsICdkcml2ZXRpbWUnLCAnd2Fsa3RpbWUnXS5pbmNsdWRlcyhidWZmZXJUeXBlKSkgeyAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNhcmQuYnVmZmVyVHlwZSA9IGJ1ZmZlclR5cGU7XG4gICAgICB9XG4gICAgICAvLyB2YWx1ZXNcbiAgICAgIGlmICh2YWx1ZXMgJiYgdmFsdWVzLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBzaXplcyA9IFtdO1xuICAgICAgICBsZXQgYXJyID0gdmFsdWVzLnNwbGl0KCcsJyk7XG4gICAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBhcnIubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgaWYgKGlpIDwgMyAmJiBhcnJbaWldICYmIGFycltpaV0udHJpbSgpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNpemVzLnB1c2gocGFyc2VGbG9hdChhcnJbaWldLnRyaW0oKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc2l6ZXMubGVuZ3RoID4gMClcbiAgICAgICAgICBjYXJkLmJ1ZmZlclNpemVzID0gc2l6ZXM7XG4gICAgICB9XG4gICAgICAvLyB1bml0c1xuICAgICAgaWYgKEFDTFV0aWxzLmhhc1RleHQodW5pdHMpICYmIFsnbWlsZXMnLCAna2lsb21ldGVycycsICdtaW51dGVzJ10uaW5jbHVkZXMoYnVmZmVyVHlwZSkpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjYXJkLmJ1ZmZlclVuaXRzID0gdW5pdHM7XG4gICAgICB9XG4gICAgICAvLyBsYXRpdHVkZSwgbG9uZ2l0dWRlXG4gICAgICBpZiAoQUNMVXRpbHMuaGFzVGV4dChsYXRpdHVkZSkgJiYgQUNMVXRpbHMuaGFzVGV4dChsb25naXR1ZGUpKSB7XG4gICAgICAgIGxldCBsYXQgPSBwYXJzZUZsb2F0KGxhdGl0dWRlKTtcbiAgICAgICAgbGV0IGxvbiA9IHBhcnNlRmxvYXQobG9uZ2l0dWRlKTtcbiAgICAgICAgY2FyZC5yZXBvcnRMb2NhdGlvbiA9IHsgbGF0OiBsYXQsIGxvbjogbG9uIH07XG4gICAgICAgIHRoaXMucmVwb3J0TG9jYXRpb24gPSBsb25naXR1ZGUgKyAnLCAnICsgbGF0aXR1ZGU7XG4gICAgICB9XG4gICAgICB0aGlzLl9pc0ludGVybmFsVXBkYXRlID0gdHJ1ZTtcbiAgICAgIHJldHVybiAoY2FyZC5nZW5lcmF0ZUJ1ZmZlcnMoKSk7XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgQmFzZVV0aWwuRXJyb3IoJ2FyY2dpcy1pbmZvZ3JhcGhpYzogZ2VuZXJhdGUgYnVmZmVycyBlcnJvcjogJywgZXgpO1xuICAgICAgcmV0dXJuIHsgZXJyb3I6ICdleGNlcHRpb246ICcgKyBleC50b1N0cmluZygpIH07XG4gICAgfVxuICB9XG4gIGFzeW5jIG9uUHJvcENoYW5nZShjYWxsYmFjaywgY29udGV4dCkge1xuICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2sgPSB7IGZuOiBjYWxsYmFjaywgY3R4OiBjb250ZXh0IH07XG4gIH1cbiAgYXN5bmMgdXBkYXRlSW5mb2dyYXBoaWMobmFtZSwgcmVwb3J0SWQsIGxvY2F0aW9uLCBnZW9tZXRyeSwgZ2VvZ3JhcGh5KSB7XG4gICAgaWYgKG5hbWUgJiYgQUNMVXRpbHMuaGFzVGV4dChuYW1lKSkge1xuICAgICAgdGhpcy5sb2NhdGlvbk5hbWUgPSBuYW1lO1xuICAgICAgdGhpcy5zdExvY2F0aW9uRGlzcGxheU5hbWUgPSBuYW1lO1xuICAgIH1cbiAgICBpZiAocmVwb3J0SWQgJiYgQUNMVXRpbHMuaGFzVGV4dChyZXBvcnRJZCkpIHtcbiAgICAgIHRoaXMucmVwb3J0SWQgPSByZXBvcnRJZDtcbiAgICAgIHRoaXMuc3RSZXBvcnRJZCA9IHJlcG9ydElkO1xuICAgIH1cbiAgICBpZiAobG9jYXRpb24pIHtcbiAgICAgIHRoaXMucmVwb3J0TG9jYXRpb24gPSBsb2NhdGlvbjtcbiAgICAgIHRoaXMuc3RSZXBvcnRMb2NhdGlvbiA9IGxvY2F0aW9uO1xuICAgIH1cbiAgICBpZiAoZ2VvbWV0cnkpIHtcbiAgICAgIHRoaXMucmVwb3J0Z2VvbWV0cnkgPSBnZW9tZXRyeTtcbiAgICAgIHRoaXMuc3RSZXBvcnRHZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgIH1cbiAgICBpZiAoZ2VvZ3JhcGh5KSB7XG4gICAgICB0aGlzLnJlcG9ydGdlb2dyYXBoeSA9IGdlb2dyYXBoeTtcbiAgICAgIHRoaXMuc3RSZXBvcnRHZW9ncmFwaHkgPSBnZW9ncmFwaHk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBGaWx0ZXJzIG91dCBtdWx0aXBsZSByYXBpZCBldmVudHMgb2YgdGhlIHNhbWUgdHlwZS4gIFRoZSBjYWxsYmFja1xuICAgKiBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBpZiBubyBuZXcgZXZlbnRzIGhhdmUgaGFwcGVuZWQgZHVyaW5nIHRoZVxuICAgKiAnd2FpdCcgdGltZS5cbiAgICogQHBhcmFtIGNhbGxiYWNrIC0geW91ciBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGV2ZW50cyBoYXZlIHNldHRsZWRcbiAgICogQHBhcmFtIHdhaXQgICAgIC0gbWlsbGlzZWNvbmRzIGRlbGF5IChleDogMjUwKVxuICAgKi9cbiAgX2RlYm91bmNlMihjYWxsYmFjaywgd2FpdCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IGRlbGF5ZWRDYWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5fZGVib3VuY2VUaW1lciA9IG51bGw7XG4gICAgICBjYWxsYmFjay5hcHBseShzZWxmKTtcbiAgICB9O1xuICAgIC8vIGV2ZXJ5dGltZSBfZGVib3VuY2UyIGlzIGNhbGxlZCB3ZSBraWxsIHRoZSBwcmV2aW91cyB0aW1lclxuICAgIGlmIChzZWxmLl9kZWJvdW5jZVRpbWVyKVxuICAgICAgY2xlYXJUaW1lb3V0KHNlbGYuX2RlYm91bmNlVGltZXIpO1xuICAgIHNlbGYuX2RlYm91bmNlVGltZXIgPSBzZXRUaW1lb3V0KGRlbGF5ZWRDYWxsLCB3YWl0KTtcbiAgfVxuICBfb25GaWx0ZXJlZFByb3BDaGFuZ2VkKCkge1xuICAgIGlmICh0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKVxuICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjay5mbih0aGlzLl9vbkNoYW5nZUNhbGxiYWNrLmN0eCwgdGhpcy5yZXBvcnRMb2NhdGlvbik7XG4gICAgZWxzZSB7XG4gICAgICBCYXNlVXRpbC5XYXJuKCdXQVJOLSBhcmNnaXMtaW5mb2dyYXBoaWMgY29tcG9uZW50OiBwcm9wZXJ0eSBzeW5jIGNhbGxiYWNrIG5vdCBmb3VuZCcpO1xuICAgIH1cbiAgICB0aGlzLmF0dGVtcHRJbmZvZ3JhcGhpY1JlbmRlcigpO1xuICB9XG4gIF9vblByb3BDaGFuZ2VkKCkge1xuICAgIHRoaXMuX2RlYm91bmNlMih0aGlzLl9vbkZpbHRlcmVkUHJvcENoYW5nZWQsIDI1MCk7XG4gIH1cbiAgX2RlYm91bmNlKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xuICAgIGxldCB0aW1lb3V0O1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgY29udGV4dCA9IHNlbGYsIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICBsZXQgbGF0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICBpZiAoIWltbWVkaWF0ZSlcbiAgICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgfTtcbiAgICAgIGxldCBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xuICAgICAgaWYgKGNhbGxOb3cpXG4gICAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfTtcbiAgfVxuICAvLyBTdGVuY2lsIGxpZmVjeWNsZSBtZXRob2RzXG4gIC8vXG4gIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIEJhc2VVdGlsLkxvZygnQkFDIGFyY2dpcy1pbmZvZ3JhcGhpYyB3aWxsTG9hZCcsIHRoaXMub3B0aW9ucyk7XG4gICAgQmFzZVV0aWwuTG9nKCdCQUMgYXJjZ2lzLWluZm9ncmFwaGljIHdpbGxMb2FkIGNyZWRzJywgdGhpcy51c2VybmFtZSwgdGhpcy50b2tlbik7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEVhY2ggY29tcG9uZW50IGhhcyB0aGUgSUQgd2l0aCBhIHN1ZmZpeCBjb3VudGVyIG51bWJlciB0aGF0XG4gICAgICAvLyBpcyBtYW5hZ2VkIGJ5IHRoZSBzdGF0aWMgaW5zdGFuY2Ugb2YgdGhpcyBjb21wb25lbnQuICBUaGVcbiAgICAgIC8vIHJlc3VsdCBpcyB0aGF0IHdlIHN1cHBvcnQgbXVsdGlwbGUgaW5zdGFuY2VzIG9mIHRoZSBjb21wb25lbnRcbiAgICAgIC8vIG9uIGFueSBnaXZlbiB3ZWJwYWdlLlxuICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZUlkKVxuICAgICAgICB0aGlzLl9pbnN0YW5jZUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KS5pZDtcbiAgICAgIGlmICghdGhpcy5fY29udGFpbmVySWQpXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lcklkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKCdjb21wb25lbnRPdXRlcicpLmlkO1xuICAgICAgaWYgKCF0aGlzLl9pZnJhbWVJZClcbiAgICAgICAgdGhpcy5faWZyYW1lSWQgPSBFbGVtZW50SWRzLmdlbmVyYXRlSWQoJ2lnRnJhbWUnKS5pZDtcbiAgICAgIC8vIGluaXRpYWxpemUgc3RhdGUgdmFyaWFibGVzIGhlcmUgd2l0aG91dCBjYXVzaW5nIGFub3RoZXIgcmVuZGVyKClcbiAgICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICAgIHRoaXMuc3RUb2tlbiA9IHRoaXMudG9rZW47XG4gICAgICB0aGlzLnN0VXNlcm5hbWUgPSB0aGlzLnVzZXJuYW1lO1xuICAgICAgdGhpcy5zdExvY2F0aW9uRGlzcGxheU5hbWUgPSB0aGlzLmxvY2F0aW9uTmFtZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuc3RMb2NhdGlvbkF0dHJpYnV0ZXMgPSBKU09OLnBhcnNlKHRoaXMubG9jYXRpb25BdHRyaWJ1dGVzKTtcbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLnN0TG9jYXRpb25BdHRyaWJ1dGVzID0ge307XG4gICAgICB9XG4gICAgICB0aGlzLnN0TGFuZ0NvZGUgPSBBQ0xVdGlscy5oYXNUZXh0KHRoaXMubGFuZ0NvZGUpID8gdGhpcy5sYW5nQ29kZSA6ICdlbi11cyc7XG4gICAgICB0aGlzLnN0U291cmNlQ291bnRyeSA9IEFDTFV0aWxzLmhhc1RleHQodGhpcy5zb3VyY2VDb3VudHJ5KSA/IHRoaXMuc291cmNlQ291bnRyeSA6ICdVUyc7XG4gICAgICB0aGlzLnN0UmVwb3J0SWQgPSB0aGlzLnJlcG9ydElkO1xuICAgICAgdGhpcy5zdFRoZW1lID0gbnVsbDtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zIHx8ICFBQ0xVdGlscy5oYXNUZXh0KHRoaXMub3B0aW9ucykpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5fZGVmYXVsdE9wdGlvbnM7XG4gICAgICB9XG4gICAgICB0aGlzLnN0T3B0aW9ucyA9IEpTT04ucGFyc2UodGhpcy5vcHRpb25zKTtcbiAgICAgIGlmICghdGhpcy5faGFzU2V0RW52ICYmIHRoaXMuZW52KSB7XG4gICAgICAgIHRoaXMuX2hhc1NldEVudiA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICAgICAgRW52aXJvbm1lbnRzLnNldEVudmlyb25tZW50KHRoaXMuZW52KTtcbiAgICAgIH1cbiAgICAgIEJhUmVwb3J0c0xhbmd1YWdlLl9pbml0aWFsaXplKHRoaXMuc3RMYW5nQ29kZSk7XG4gICAgICAvLyBTZXQgaWYgR2VvZW5yaWNobWVudFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cbiAgICAgIGlmICh0aGlzLmdlb2VucmljaG1lbnRVcmwpIHtcbiAgICAgICAgRW52aXJvbm1lbnRzLnNldEdlb2VucmljaG1lbnRVcmwodGhpcy5nZW9lbnJpY2htZW50VXJsKTtcbiAgICAgIH1cbiAgICAgIC8vIFNldCBpZiBQb3JhdGwgVXJsIHdhcyBvcHRpb25hbGx5IHBhc3NlZCBpblxuICAgICAgaWYgKHRoaXMucG9ydGFsVXJsKSB7XG4gICAgICAgIEVudmlyb25tZW50cy5zZXRQb3J0YWxVcmwodGhpcy5wb3J0YWxVcmwpO1xuICAgICAgfVxuICAgICAgQmFzZVV0aWwuTG9nKCdCQUMgYXJjZ2lzLWluZm9ncmFwaGljIHdpbGxMb2FkMicsIHRoaXMub3B0aW9ucyk7XG4gICAgICBpZiAoIXRoaXMuX2luZm9ncmFwaGljQ2FyZCkge1xuICAgICAgICBCYXNlVXRpbC5Mb2coJ0JBQyBhcmNnaXMtaW5mb2dyYXBoaWMgY3JlYXRpbmcgbmV3IEluZm9ncmFwaGljQ2FyZCcpO1xuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQgPSBuZXcgSW5mb2dyYXBoaWNDYXJkKHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4sIHRoaXMuZW52LCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMsIHRydWUpOyAvL0BAQEBAQEBAQEBAQFxuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuZ2VvZW5yaWNobWVudFVybCA9IHRoaXMuZ2VvZW5yaWNobWVudFVybDtcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnBvcnRhbFVybCA9IHRoaXMucG9ydGFsVXJsO1xuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQucG9ydGFsT25saW5lR0VQcm94eSA9IHRoaXMucG9ydGFsT25saW5lR0VQcm94eTtcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnJlcG9ydExvY2F0aW9uTmFtZSA9IHRoaXMuc3RMb2NhdGlvbkRpc3BsYXlOYW1lO1xuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQucmVwb3J0TG9jYXRpb25BdHRyaWJ1dGVzID0gdGhpcy5zdExvY2F0aW9uQXR0cmlidXRlcztcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNvdXJjZUNvdW50cnkgPSB0aGlzLnN0U291cmNlQ291bnRyeTtcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLmxhbmdDb2RlID0gdGhpcy5zdExhbmdDb2RlO1xuICAgICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0U2hhZG93Um9vdCh0aGlzLmVsLnNoYWRvd1Jvb3QpO1xuICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXgpIHtcbiAgICAgIEJhc2VVdGlsLkVycm9yKCdhcmNnaXMtaW5mb2dyYXBoaWMgQ29tcG9uZW50V2lsbExvYWQnLCBleCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGF0dGVtcHRJbmZvZ3JhcGhpY1JlbmRlcigpIHtcbiAgICBsZXQgY29udGFpbmVyID0gQUNMVXRpbHMucXVlcnlFbGVtZW50QnlJZC5jYWxsKHRoaXMsIHRoaXMuX2NvbnRhaW5lcklkKTtcbiAgICBsZXQgbG9jYXRpb24sIGdlb21ldHJ5LCBnZW9ncmFwaHksIHJlcG9ydElkO1xuICAgIGlmICh0aGlzLl9pbmZvZ3JhcGhpY0NhcmQgJiYgdGhpcy5vcHRpb25zKVxuICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNldE9wdGlvbnModGhpcy5vcHRpb25zLCB0cnVlKTtcbiAgICBCYXNlVXRpbC5Mb2coJ0JBQyBhcmNnaXMtaW5mb2dyYXBoaWMgYXR0ZW1wdEluZm9ncmFwaGljUmVuZGVyJywgdGhpcy5faW5mb2dyYXBoaWNDYXJkKTtcbiAgICBCYXNlVXRpbC5Mb2coJ0JBQyBhcmNnaXMtaW5mb2dyYXBoaWMgYXR0ZW1wdFJlbmRlciBjcmVkcycsIHRoaXMudXNlcm5hbWUsIHRoaXMudG9rZW4pO1xuICAgIC8vIFN5bmMgSW5mb2dyYXBoaWNDYXJkIHByb3BlcnRpZXNcbiAgICBpZiAodGhpcy5yZXBvcnRMb2NhdGlvbikge1xuICAgICAgbGV0IGdlbyA9IHRoaXMucmVwb3J0TG9jYXRpb24uc3BsaXQoJywnKTtcbiAgICAgIGlmIChnZW8gJiYgZ2VvLmxlbmd0aCA9PSAyKSB7XG4gICAgICAgIGxldCBsYXQgPSBwYXJzZUZsb2F0KGdlb1sxXSk7XG4gICAgICAgIGxldCBsb24gPSBwYXJzZUZsb2F0KGdlb1swXSk7XG4gICAgICAgIGxvY2F0aW9uID0geyBsYXQ6IGxhdCwgbG9uOiBsb24gfTtcbiAgICAgICAgdGhpcy5faW5mb2dyYXBoaWNDYXJkLnNldFJlcG9ydExvY2F0aW9uKGxvY2F0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMucmVwb3J0Z2VvbWV0cnkpIHtcbiAgICAgIGdlb21ldHJ5ID0gSlNPTi5wYXJzZSh0aGlzLnJlcG9ydGdlb21ldHJ5KTtcbiAgICAgIHRoaXMuX2luZm9ncmFwaGljQ2FyZC5zZXRSZXBvcnRHZW9tZXRyeShnZW9tZXRyeSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlcG9ydGdlb2dyYXBoeSkge1xuICAgICAgZ2VvZ3JhcGh5ID0gSlNPTi5wYXJzZSh0aGlzLnJlcG9ydGdlb2dyYXBoeSk7XG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQuc2V0UmVwb3J0R2VvZ3JhcGh5KGdlb2dyYXBoeSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlcG9ydElkKSB7XG4gICAgICByZXBvcnRJZCA9IHRoaXMucmVwb3J0SWQ7XG4gICAgICB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQucmVwb3J0SWQgPSB0aGlzLnJlcG9ydElkO1xuICAgIH1cbiAgICAvLyB2YWxpZGF0ZSByZXF1aXJlZCBkYXRhIHRvIGRyYXcgYW4gaW5mb2dyYXBoaWNcbiAgICBpZiAoY29udGFpbmVyICYmIChsb2NhdGlvbiB8fCBnZW9tZXRyeSB8fCBnZW9ncmFwaHkpICYmIHJlcG9ydElkKSB7XG4gICAgICBhd2FpdCB0aGlzLl9pbmZvZ3JhcGhpY0NhcmQubG9hZEluZm9ncmFwaGljKHRoaXMuX2lmcmFtZUlkLCBjb250YWluZXIsIGxvY2F0aW9uLCBnZW9tZXRyeSwgcmVwb3J0SWQsIGdlb2dyYXBoeSk7XG4gICAgfVxuICB9XG4gIC8vIE1haW4gY29tcG9uZW50IHNjcmVlbiBnZW5lcmF0aW9uXG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgdGhpcy5hdHRlbXB0SW5mb2dyYXBoaWNSZW5kZXIoKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgLy8gdGhpcy5fbCgnIHJlbmRlcigpIHJ1bm5pbmcuLi4uJylcbiAgICAvLyBUaGlzIGluaXRpYWxseSByZW5kZXJzIHRoZSBjb21wb25lbnQgY29udGFpbmVyIG9ubHkgYW5kXG4gICAgLy8gd2lsbCB1cGRhdGUgdGhlIGNvbnRlbnRzIHdoZW4gdGhlIFN0ZW5jaWwgbGlmZSBjeWNsZSBmdW5jdGlvblxuICAgIC8vIGNvbXBvbmVudERpZExvYWQoKSBydW5zLiAgVGhpcyBpcyBiZWNhdXNlIHRoZSBjYXJkIHJlbmRlcigpXG4gICAgLy8gZnVuY3Rpb24gaXMgYXN5bmMsIHNvIHdlIGxvYWQgaXQgdGhlbiBvbiAnY29tcG9uZW50RGlkTG9hZCcgd2VcbiAgICAvLyBhc3NpZ24gdGhlIGlmcmFtZSAnc3JjJyBhbmQgZG8gYSAncG9zdG1lc3NhZ2UnIHdoZW4gdGhlXG4gICAgLy8gaWZyYW1lIGlzIGZpbmFsbHkgcmVhZHkgdG8gYWNjZXB0IG9wdGlvbnMuXG4gICAgLy9cbiAgICByZXR1cm4gaChcImRpdlwiLCB7IGlkOiB0aGlzLl9jb250YWluZXJJZCwgY2xhc3M6ICdjb21wb25lbnRPdXRlcicgfSk7XG4gIH1cbiAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgIFwiZW52XCI6IFtcIm9uRW52Q2hhbmdlZFwiXSxcbiAgICBcInRva2VuXCI6IFtcIm9uVG9rZW5DaGFuZ2VkXCJdLFxuICAgIFwidXNlcm5hbWVcIjogW1wib25Vc2VybmFtZUNoYW5nZWRcIl0sXG4gICAgXCJsb2NhdGlvbk5hbWVcIjogW1wib25Mb2NhdGlvbkRpc3BsYXlOYW1lQ2hhbmdlZFwiXSxcbiAgICBcImxvY2F0aW9uQXR0cmlidXRlc1wiOiBbXCJvbkxvY2F0aW9uQXR0cmlidXRlc0NoYW5nZWRcIl0sXG4gICAgXCJsYW5nQ29kZVwiOiBbXCJvbkxhbmdDb2RlQ2hhbmdlZFwiXSxcbiAgICBcInNvdXJjZUNvdW50cnlcIjogW1wib25Db3VudHJ5Q2hhbmdlZFwiXSxcbiAgICBcIm9wdGlvbnNcIjogW1wib25PcHRpb25zQ2hhbmdlZFwiXSxcbiAgICBcInJlcG9ydElkXCI6IFtcIm9uUmVwb3J0SWRDaGFuZ2VkXCJdLFxuICAgIFwidGhlbWVcIjogW1wib25UaGVtZUNoYW5nZWRcIl0sXG4gICAgXCJyZXBvcnRMb2NhdGlvblwiOiBbXCJvblJlcG9ydExvY2F0aW9uQ2hhbmdlZFwiXSxcbiAgICBcInJlcG9ydGdlb21ldHJ5XCI6IFtcIm9uUmVwb3J0R2VvbWV0cnlDaGFuZ2VkXCJdLFxuICAgIFwicmVwb3J0Z2VvZ3JhcGh5XCI6IFtcIm9uUmVwb3J0R2VvZ3JhcGh5Q2hhbmdlZFwiXVxuICB9OyB9XG59O1xuQXJjZ2lzSW5mb2dyYXBoaWMuc3R5bGUgPSBhcmNnaXNJbmZvZ3JhcGhpY0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzSW5mb2dyYXBoaWMgYXMgQSB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaW5mb2dyYXBoaWMtMDk4OTU0YjcuanMubWFwIiwiZXhwb3J0IHsgQSBhcyBhcmNnaXNfaW5mb2dyYXBoaWMgfSBmcm9tICcuL2FyY2dpcy1pbmZvZ3JhcGhpYy0wOTg5NTRiNy5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtNGU2NDc0MTEuanMnO1xuaW1wb3J0ICcuL0VsZW1lbnRJZHMtZjdkMjU3ZTguanMnO1xuaW1wb3J0ICcuL0dFQ2xpZW50LTFhODNhNjU3LmpzJztcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWluZm9ncmFwaGljLmVudHJ5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==