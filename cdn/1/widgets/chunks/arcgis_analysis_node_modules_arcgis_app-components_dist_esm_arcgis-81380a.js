/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a"],{6531:(i,t,a)=>{a.r(t),a.d(t,{arcgis_item_classification:()=>o});var s=a(81149),e=a(82218),l=a(72532),n=a(49853);a(42577),a(51837),a(69283),a(20164),a(79210),a(70464);const o=class{constructor(i){(0,s.r)(this,i),this.orgClassificationType=null,this.orgItemClassificationValue=null,this.retrieveClassificationSchema=async()=>{var i,t;try{const a=`${this.config.restBaseUrl}portals/self/ClassificationSchema`,s=await(0,l.r)(a);this.classificationSchema=s,this.classificationCategoryArr=null===(i=s.classifications)||void 0===i?void 0:i.map((i=>({id:i.id,value:i.label,label:i.label,color:i.color}))),this.setAttributeCategory(null===(t=s.attributeCategories)||void 0===t?void 0:t[0])}catch(i){console.log("error: ",i),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.retrieveItemClassificationValue=async()=>{var i;try{const t=`${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}`,a=null===(i=(await(0,l.a)(t)).item)||void 0===i?void 0:i.classification;this.itemClassificationValue=a?JSON.parse(a):{classification:this.classificationSchema.classifications[0].label},this.orgItemClassificationValue=structuredClone(this.itemClassificationValue),this.classificationType=this.convertClassificationType(this.retrieveClassificationType(a?{label:JSON.parse(a).classification}:this.classificationSchema.classifications[0])),this.orgClassificationType=structuredClone(this.itemClassificationValue),this.displayClassificationVal(this.itemClassificationValue),a&&(this.doesValidate=this.validateClassificationVal(JSON.parse(a)))}catch(i){console.log("error: ",i),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.hasNonexistingAttribute=i=>!!i.find((i=>!this.classificationSchema.attributes[i])),this.hasDisabledAttribute=(i,t)=>{let a=!1;return(async()=>{for(const s in i){const e=i[s];try{if(!await(0,l.i)(e,this.classificationSchema,JSON.stringify(t))){a=!0;break}}catch(i){a=!0;break}}})(),a},this.hasUpdatedAttributeValues=(i,t)=>{let a=!1;return(async()=>{for(const s in i){const e=i[s],n=t[e];if((this.classificationSchema.layoutElements[e]||"text").includes("-select"))try{const i=await(0,l.e)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue));n.forEach((t=>{i.find((i=>i.label!==t))&&(a=!0)}))}catch(i){return void(a=!0)}}})(),a},this.validateClassificationVal=i=>{var t;const a=null===(t=Object.keys(i))||void 0===t?void 0:t.filter((i=>"classification"!==i));return 0===a.length||!this.hasNonexistingAttribute(a)&&!this.hasDisabledAttribute(a,i)&&!this.hasUpdatedAttributeValues(a,i)},this.saveItemClassificationValue=async()=>{try{this.isSaving=!0;const i=`${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}/update`;(await(0,l.s)(i,this.itemClassificationValue)).success&&(this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"success",alertIndicatorIcon:"check-circle",alertIndicatorInfo:this.i18n.classificationValueSaved}),this.closeClassificationEditModal("save"),this.retrieveClassificationSchema(),this.retrieveItemClassificationValue())}catch(i){console.log("error: ",i),this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.handleDisplayNotificationModal=i=>{this.alertIndicator=i,this.isNotificationModalActive=!0},this.handleCloseNotificationModal=()=>this.isNotificationModalActive=!1,this.itemId=void 0,this.userName=void 0,this.config=void 0,this.isDisplayModal=void 0,this.setIsDisplayModal=void 0,this.displayClassificationVal=void 0,this.api=void 0,this.classificationSchema=null,this.classificationCategoryArr=[],this.classificationType=null,this.itemClassificationValue=null,this.attributeCategory="General",this.doesValidate=!0,this.isSaving=!1,this.isResetting=!1,this.isNotificationModalActive=!1,this.alertIndicator={alertIndicatorActive:!1,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:""}}async componentWillLoad(){var i;const t=await(0,e.g)(this.el);this.i18n=t[0],this.retrieveClassificationSchema(),this.retrieveItemClassificationValue(),null!==(i=n.c.api)&&void 0!==i||(n.c.api=this.api)}retrieveClassificationType(i){var t;return null===(t=this.classificationSchema)||void 0===t?void 0:t.classifications.find((t=>t.label===i.label))}convertClassificationType(i){return{id:i.id,color:i.color,value:i.label,label:i.label}}setClassificationType(i){this.classificationType=i}setItemClassificationValue(i){this.itemClassificationValue=i}setAttributeCategory(i){this.attributeCategory=i}openClassificationEditModal(){this.setIsDisplayModal(!0),this.doesValidate||this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:this.i18n.itemClassificationValidateError})}closeClassificationEditModal(i){"cancel"===i&&(this.classificationType=this.orgClassificationType,this.itemClassificationValue=this.orgItemClassificationValue),this.setIsDisplayModal(!1)}resetClassificationValue(){this.setClassificationType(this.convertClassificationType(this.retrieveClassificationType(Object.assign({},this.classificationSchema.classifications[0])))),this.setItemClassificationValue({classification:this.classificationSchema.classifications[0].label})}displayIntoTip(){console.log("test")}renderHeader(){return(0,s.h)("h3",{slot:"header"},this.i18n.itemClassificationEditLabel,(0,s.h)("calcite-icon",{class:"classification-info-tip",scale:"s",icon:"information",onClick:this.displayIntoTip}))}renderContent(){return(0,s.h)("div",{slot:"content",class:"portal-item-classification-content"},(0,s.h)("item-classification-info",{i18n:this.i18n,itemClassificationValue:this.itemClassificationValue,classificationSchema:this.classificationSchema}),(0,s.h)("item-classification-category",{i18n:this.i18n,classificationCategoryArr:this.classificationCategoryArr,classificationType:this.classificationType,setClassificationType:this.setClassificationType.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this)}),!!this.classificationSchema&&!!this.itemClassificationValue&&(0,s.h)("item-classification-content",{itemClassificationValue:this.itemClassificationValue,classificationSchema:this.classificationSchema,attributeCategory:this.attributeCategory,setAttributeCategory:this.setAttributeCategory.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this),onArcgisItemClassificationContentDisplayNotification:i=>this.handleDisplayNotificationModal(i.detail),isSaving:this.isSaving}))}renderFooter(){const{i18n:i}=this;return(0,s.h)(s.F,null,(0,s.h)("calcite-button",{"aria-label":i.reset,scale:"l",slot:"back",width:"full",appearance:"outline",disabled:this.isSaving,onClick:()=>this.resetClassificationValue()},this.isResetting?(0,s.h)("div",{class:"resetIndicator"},(0,s.h)("calcite-loader",{label:"resettingClassification",scale:"m",inline:!0}),(0,s.h)("span",{class:"resetIndicator"},i.resetting)):(0,s.h)("div",null,i.reset)),(0,s.h)("calcite-button",{"aria-label":i.save,scale:"l",slot:"primary",width:"full",onClick:()=>this.saveItemClassificationValue()},this.isSaving?(0,s.h)("div",{class:"saveIndicator"},(0,s.h)("calcite-loader",{label:"savingClassification",scale:"m",inline:!0}),(0,s.h)("span",{class:"savingIndicator"},i.saving)):(0,s.h)("div",null,i.save)),(0,s.h)("calcite-button",{"aria-label":i.cancel,scale:"l",slot:"secondary",width:"full",appearance:"outline",onClick:()=>this.closeClassificationEditModal("cancel"),disabled:this.isSaving},(0,s.h)("div",null,i.cancel)))}renderModal(){return(0,s.h)(s.F,null,this.renderHeader(),this.renderContent(),this.renderFooter())}render(){return(0,s.h)(s.F,null,(0,s.h)("button",{onClick:()=>this.openClassificationEditModal()},this.i18n.openModal),(0,s.h)("calcite-modal",{class:"portal-item-classification-viewer",open:this.isDisplayModal,scale:"m",widthScale:"m",outsideCloseDisabled:!0,onCalciteModalClose:()=>this.closeClassificationEditModal("cancel")},this.renderModal()),this.isNotificationModalActive&&(0,s.h)("item-classification-notification",{i18n:this.i18n,alertIndicator:this.alertIndicator,onArcgisItemClassificationNotificationClose:()=>{this.handleCloseNotificationModal()}}))}get el(){return(0,s.d)(this)}};o.style=".portal-item-classification-viewer{--calcite-modal-content-padding:0}.saveIndicator{display:inline-flex;width:100%;align-items:center;justify-content:center}.savingIndicator{margin:0 10px}.classification-info-tip{margin-left:3px;cursor:pointer}"},72532:(i,t,a)=>{a.d(t,{a:()=>n,e:()=>h,i:()=>r,r:()=>o,s:()=>c});var s=a(49853),e=a(69283),l=a(20164);function n(i){return(0,l.r)(i)}function o(i){return(0,l.r)(i)}function c(i,t){const a={classification:JSON.stringify(t)};return(0,l.r)(i,a,{},"post")}async function r(i,t,a){var s;const e=null===(s=null==t?void 0:t.attributes)||void 0===s?void 0:s[i],l=null==e?void 0:e.isAttributeEnabled;if(!e)return!1;if(!l)return!0;const n={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await d(l)).execute(n)}async function h(i,t,a){var s,e;const l=null===(s=null==t?void 0:t.attributes)||void 0===s?void 0:s[i],n=null==l?void 0:l.valueExpression,o=null==l?void 0:l.validValues,c=null==l?void 0:l.validValuesMap;if(!l)return null;if(null==o?void 0:o.length)return o;if(c&&(null===(e=Object.keys(c))||void 0===e?void 0:e.length))return c;if(!n)return null;const r={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await d(n)).execute(r)}async function d(i){if(3===(null===s.c||void 0===s.c?void 0:s.c.api))return async function(i){const[t]=await(0,e.l)(["esri/arcadeProfiles/visualizationProfile"]);return await t.initialize([i]),{execute:()=>!1}}(i);const[t]=await(0,e.l)(["esri/arcade"]);return t.createArcadeExecutor(i,{variables:[{name:"schemaJsonString",type:"text"},{name:"valueJsonString",type:"text"},{name:"attributeId",type:"text"}]})}}}]);