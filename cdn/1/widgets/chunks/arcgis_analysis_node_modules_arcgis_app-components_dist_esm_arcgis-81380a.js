"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-classification.entry.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-item-classification.entry.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_item_classification: () => (/* binding */ ArcgisItemClassification)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./classification-7bcadbab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/classification-7bcadbab.js");
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/* harmony import */ var _url_4c3ae54c_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./url-4c3ae54c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/url-4c3ae54c.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */












const arcgisItemClassificationCss = ".portal-item-classification-viewer{--calcite-modal-content-padding:0}.saveIndicator{display:inline-flex;width:100%;align-items:center;justify-content:center}.savingIndicator{margin:0 10px}.classification-info-tip{margin-left:3px;cursor:pointer}";

const ArcgisItemClassification = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.orgClassificationType = null;
        this.orgItemClassificationValue = null;
        this.retrieveClassificationSchema = async () => {
            var _a, _b;
            try {
                const url = `${this.config.restBaseUrl}portals/self/ClassificationSchema`;
                const response = await (0,_classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__.r)(url);
                this.classificationSchema = response;
                this.classificationCategoryArr = (_a = response.classifications) === null || _a === void 0 ? void 0 : _a.map((classification) => {
                    return {
                        id: classification.id,
                        value: classification.label,
                        label: classification.label,
                        color: classification.color
                    };
                });
                this.setAttributeCategory((_b = response.attributeCategories) === null || _b === void 0 ? void 0 : _b[0]);
            }
            catch (error) {
                console.log("error: ", error);
                this.handleDisplayNotificationModal({
                    alertIndicatorActive: true,
                    alertIndicatorType: "danger",
                    alertIndicatorIcon: "exclamation-mark-triangle",
                    alertIndicatorInfo: error === null || error === void 0 ? void 0 : error.message
                });
            }
        };
        this.retrieveItemClassificationValue = async () => {
            var _a;
            try {
                const url = `${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}`;
                const response = await (0,_classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__.a)(url);
                const itemClassification = (_a = response.item) === null || _a === void 0 ? void 0 : _a.classification;
                this.itemClassificationValue = !!itemClassification
                    ? JSON.parse(itemClassification)
                    : { classification: this.classificationSchema.classifications[0].label };
                this.orgItemClassificationValue = structuredClone(this.itemClassificationValue);
                this.classificationType = this.convertClassificationType(this.retrieveClassificationType(!!itemClassification
                    ? { label: JSON.parse(itemClassification).classification }
                    : this.classificationSchema.classifications[0]));
                this.orgClassificationType = structuredClone(this.itemClassificationValue);
                this.displayClassificationVal(this.itemClassificationValue);
                if (!!itemClassification) {
                    this.doesValidate = this.validateClassificationVal(JSON.parse(itemClassification));
                }
            }
            catch (error) {
                console.log("error: ", error);
                this.handleDisplayNotificationModal({
                    alertIndicatorActive: true,
                    alertIndicatorType: "danger",
                    alertIndicatorIcon: "exclamation-mark-triangle",
                    alertIndicatorInfo: error === null || error === void 0 ? void 0 : error.message
                });
            }
        };
        this.hasNonexistingAttribute = (classificationPropertyArr) => {
            let propRes = classificationPropertyArr.find((property) => !this.classificationSchema.attributes[property]);
            return !!propRes;
        };
        this.hasDisabledAttribute = (classificationPropertyArr, itemClassification) => {
            const check = async () => {
                for (const index in classificationPropertyArr) {
                    const property = classificationPropertyArr[index];
                    try {
                        const isEnabled = await (0,_classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__.i)(property, this.classificationSchema, JSON.stringify(itemClassification));
                        if (!isEnabled) {
                            hasDisabledAtt = true;
                            break;
                        }
                    }
                    catch (error) {
                        hasDisabledAtt = true;
                        break;
                    }
                }
            };
            let hasDisabledAtt = false;
            check();
            return hasDisabledAtt;
        };
        this.hasUpdatedAttributeValues = (classificationPropertyArr, itemClassification) => {
            const check = async () => {
                for (const index in classificationPropertyArr) {
                    const property = classificationPropertyArr[index];
                    const propertyValues = itemClassification[property];
                    const layoutElement = this.classificationSchema.layoutElements[property] || "text";
                    if (layoutElement.includes("-select")) {
                        try {
                            const valueExpressionResult = await (0,_classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__.e)(property, this.classificationSchema, JSON.stringify(this.itemClassificationValue));
                            propertyValues.forEach((propertyVal) => {
                                if (valueExpressionResult.find((result) => result.label !== propertyVal)) {
                                    hasUnmatch = true;
                                    return;
                                }
                            });
                        }
                        catch (error) {
                            hasUnmatch = true;
                            return;
                        }
                    }
                }
            };
            let hasUnmatch = false;
            check();
            return hasUnmatch;
        };
        this.validateClassificationVal = (itemClassification) => {
            var _a;
            const classificationPropertyArr = (_a = Object.keys(itemClassification)) === null || _a === void 0 ? void 0 : _a.filter((key) => key !== "classification");
            // item classification is empty
            if (classificationPropertyArr.length === 0) {
                return true;
            }
            // loop for any non-existing attribute in the classification schema
            if (this.hasNonexistingAttribute(classificationPropertyArr)) {
                return false;
            }
            // loop for any non-enabled attribute in the classification schema
            if (this.hasDisabledAttribute(classificationPropertyArr, itemClassification)) {
                return false;
            }
            // loop for any updated attribute in the classification schema
            if (this.hasUpdatedAttributeValues(classificationPropertyArr, itemClassification)) {
                return false;
            }
            return true;
        };
        this.saveItemClassificationValue = async () => {
            try {
                this.isSaving = true;
                const url = `${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}/update`;
                const response = await (0,_classification_7bcadbab_js__WEBPACK_IMPORTED_MODULE_2__.s)(url, this.itemClassificationValue);
                if (response.success) {
                    this.isSaving = false;
                    this.handleDisplayNotificationModal({
                        alertIndicatorActive: true,
                        alertIndicatorType: "success",
                        alertIndicatorIcon: "check-circle",
                        alertIndicatorInfo: this.i18n.classificationValueSaved
                    });
                    this.closeClassificationEditModal("save");
                    // pull data again
                    this.retrieveClassificationSchema();
                    this.retrieveItemClassificationValue();
                }
            }
            catch (error) {
                console.log("error: ", error);
                this.isSaving = false;
                this.handleDisplayNotificationModal({
                    alertIndicatorActive: true,
                    alertIndicatorType: "danger",
                    alertIndicatorIcon: "exclamation-mark-triangle",
                    alertIndicatorInfo: error === null || error === void 0 ? void 0 : error.message
                });
            }
        };
        // Open notification modal
        this.handleDisplayNotificationModal = (alertIndicator) => {
            this.alertIndicator = alertIndicator;
            this.isNotificationModalActive = true;
        };
        // Close notification modal
        this.handleCloseNotificationModal = () => (this.isNotificationModalActive = false);
        this.itemId = undefined;
        this.userName = undefined;
        this.config = undefined;
        this.isDisplayModal = undefined;
        this.setIsDisplayModal = undefined;
        this.displayClassificationVal = undefined;
        this.api = undefined;
        this.classificationSchema = null;
        this.classificationCategoryArr = [];
        this.classificationType = null;
        this.itemClassificationValue = null;
        this.attributeCategory = "General";
        this.doesValidate = true;
        this.isSaving = false;
        this.isResetting = false;
        this.isNotificationModalActive = false;
        this.alertIndicator = {
            alertIndicatorActive: false,
            alertIndicatorType: "danger",
            alertIndicatorIcon: "exclamation-mark-triangle",
            alertIndicatorInfo: ""
        };
    }
    async componentWillLoad() {
        var _a;
        const locale = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
        this.i18n = locale[0];
        this.retrieveClassificationSchema();
        this.retrieveItemClassificationValue();
        (_a = _config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api) !== null && _a !== void 0 ? _a : (_config_75adf962_js__WEBPACK_IMPORTED_MODULE_3__.c.api = this.api);
    }
    retrieveClassificationType(classification) {
        var _a;
        return (_a = this.classificationSchema) === null || _a === void 0 ? void 0 : _a.classifications.find((classificationItem) => classificationItem.label === classification.label);
    }
    convertClassificationType(classification) {
        return {
            id: classification.id,
            color: classification.color,
            value: classification.label,
            label: classification.label
        };
    }
    setClassificationType(newType) {
        this.classificationType = newType;
    }
    setItemClassificationValue(newValue) {
        this.itemClassificationValue = newValue;
    }
    setAttributeCategory(category) {
        this.attributeCategory = category;
    }
    openClassificationEditModal() {
        this.setIsDisplayModal(true);
        if (!this.doesValidate) {
            this.handleDisplayNotificationModal({
                alertIndicatorActive: true,
                alertIndicatorType: "danger",
                alertIndicatorIcon: "exclamation-mark-triangle",
                alertIndicatorInfo: this.i18n.itemClassificationValidateError
            });
        }
    }
    closeClassificationEditModal(action) {
        if (action === "cancel") {
            this.classificationType = this.orgClassificationType;
            this.itemClassificationValue = this.orgItemClassificationValue;
        }
        this.setIsDisplayModal(false);
    }
    resetClassificationValue() {
        this.setClassificationType(this.convertClassificationType(this.retrieveClassificationType(Object.assign({}, this.classificationSchema.classifications[0]))));
        this.setItemClassificationValue({
            classification: this.classificationSchema.classifications[0].label
        });
    }
    displayIntoTip() {
        console.log("test");
    }
    renderHeader() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("h3", { slot: "header" }, this.i18n.itemClassificationEditLabel, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { class: "classification-info-tip", scale: "s", icon: "information", onClick: this.displayIntoTip })));
    }
    renderContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content", class: "portal-item-classification-content" }, 
        /* Current Selection */
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("item-classification-info", { i18n: this.i18n, itemClassificationValue: this.itemClassificationValue, classificationSchema: this.classificationSchema }), 
        /* classification category */
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("item-classification-category", { i18n: this.i18n, classificationCategoryArr: this.classificationCategoryArr, classificationType: this.classificationType, setClassificationType: this.setClassificationType.bind(this), setItemClassificationValue: this.setItemClassificationValue.bind(this) }), 
        /* classification content */
        !!this.classificationSchema && !!this.itemClassificationValue && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("item-classification-content", { itemClassificationValue: this.itemClassificationValue, classificationSchema: this.classificationSchema, attributeCategory: this.attributeCategory, setAttributeCategory: this.setAttributeCategory.bind(this), setItemClassificationValue: this.setItemClassificationValue.bind(this), onArcgisItemClassificationContentDisplayNotification: (e) => this.handleDisplayNotificationModal(e.detail), isSaving: this.isSaving }))));
    }
    renderFooter() {
        const { i18n } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": i18n.reset, scale: "l", slot: "back", width: "full", appearance: "outline", disabled: this.isSaving, onClick: () => this.resetClassificationValue() }, this.isResetting ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "resetIndicator" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "resettingClassification", scale: "m", inline: true }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "resetIndicator" }, i18n.resetting))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, i18n.reset))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": i18n.save, scale: "l", slot: "primary", width: "full", onClick: () => this.saveItemClassificationValue() }, this.isSaving ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "saveIndicator" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-loader", { label: "savingClassification", scale: "m", inline: true }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { class: "savingIndicator" }, i18n.saving))) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, i18n.save))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { "aria-label": i18n.cancel, scale: "l", slot: "secondary", width: "full", appearance: "outline", onClick: () => this.closeClassificationEditModal("cancel"), disabled: this.isSaving }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, i18n.cancel))));
    }
    renderModal() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, this.renderHeader(), this.renderContent(), this.renderFooter()));
    }
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("button", { onClick: () => this.openClassificationEditModal() }, this.i18n.openModal), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-modal", { class: "portal-item-classification-viewer", open: this.isDisplayModal, scale: "m", widthScale: "m", outsideCloseDisabled: true, onCalciteModalClose: () => this.closeClassificationEditModal("cancel") }, this.renderModal()), 
        /* Show notification indicator */
        this.isNotificationModalActive && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("item-classification-notification", { i18n: this.i18n, alertIndicator: this.alertIndicator, onArcgisItemClassificationNotificationClose: () => {
                this.handleCloseNotificationModal();
            } }))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisItemClassification.style = arcgisItemClassificationCss;



//# sourceMappingURL=arcgis-item-classification.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/classification-7bcadbab.js":
/*!********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/classification-7bcadbab.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ requestItemClassificationValue),
/* harmony export */   e: () => (/* binding */ evaluateValueExpression),
/* harmony export */   i: () => (/* binding */ isAttributeEnabled),
/* harmony export */   r: () => (/* binding */ requestClassificationSchema),
/* harmony export */   s: () => (/* binding */ submitItemClassificationValue)
/* harmony export */ });
/* harmony import */ var _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-75adf962.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/config-75adf962.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _portal_d518b571_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./portal-d518b571.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/portal-d518b571.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




function requestItemClassificationValue(url) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_2__.r)(url);
}
function requestClassificationSchema(url) {
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_2__.r)(url);
}
function submitItemClassificationValue(url, classificationValue) {
    const data = { classification: JSON.stringify(classificationValue) };
    return (0,_portal_d518b571_js__WEBPACK_IMPORTED_MODULE_2__.r)(url, data, {}, "post");
}
async function isAttributeEnabled(attributeId, classificationSchema, valueJson) {
    var _a;
    const attributeIdVal = (_a = classificationSchema === null || classificationSchema === void 0 ? void 0 : classificationSchema.attributes) === null || _a === void 0 ? void 0 : _a[attributeId];
    const isAttributeEnabled = attributeIdVal === null || attributeIdVal === void 0 ? void 0 : attributeIdVal.isAttributeEnabled;
    if (!attributeIdVal) {
        return false;
    }
    if (!isAttributeEnabled) {
        return true;
    }
    const arcadeInput = {
        schemaJsonString: JSON.stringify(classificationSchema),
        valueJsonString: valueJson,
        attributeId: attributeId
    };
    const arcadeScriptExecutor = await getExecutor(isAttributeEnabled);
    return arcadeScriptExecutor.execute(arcadeInput);
}
async function evaluateValueExpression(attributeId, classificationSchema, valueJson) {
    var _a, _b;
    const attributeIdVal = (_a = classificationSchema === null || classificationSchema === void 0 ? void 0 : classificationSchema.attributes) === null || _a === void 0 ? void 0 : _a[attributeId];
    const valueExpression = attributeIdVal === null || attributeIdVal === void 0 ? void 0 : attributeIdVal.valueExpression;
    const validValues = attributeIdVal === null || attributeIdVal === void 0 ? void 0 : attributeIdVal.validValues;
    const validValuesMap = attributeIdVal === null || attributeIdVal === void 0 ? void 0 : attributeIdVal.validValuesMap;
    if (!attributeIdVal) {
        return null;
    }
    if (!!(validValues === null || validValues === void 0 ? void 0 : validValues.length)) {
        return validValues;
    }
    if (!!validValuesMap && !!((_b = Object.keys(validValuesMap)) === null || _b === void 0 ? void 0 : _b.length)) {
        return validValuesMap;
    }
    if (!valueExpression) {
        return null;
    }
    const arcadeInput = {
        schemaJsonString: JSON.stringify(classificationSchema),
        valueJsonString: valueJson,
        attributeId: attributeId
    };
    const arcadeScriptExecutor = await getExecutor(valueExpression);
    return arcadeScriptExecutor.execute(arcadeInput);
}
async function getExecutor(arcadeExpressionInput) {
    if ((_config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c === null || _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c === void 0 ? void 0 : _config_75adf962_js__WEBPACK_IMPORTED_MODULE_0__.c.api) === 3) {
        return getExecutor3x(arcadeExpressionInput);
    }
    const [arcade] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/arcade"]);
    return arcade.createArcadeExecutor(arcadeExpressionInput, {
        variables: [
            {
                name: "schemaJsonString",
                type: "text"
            },
            {
                name: "valueJsonString",
                type: "text"
            },
            {
                name: "attributeId",
                type: "text"
            }
        ]
    });
}
async function getExecutor3x(arcadeExpressionInput) {
    const [visualizationProfile] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_1__.l)(["esri/arcadeProfiles/visualizationProfile"]);
    /* const profile = */ await visualizationProfile.initialize([arcadeExpressionInput]);
    // TODO: implement working executor in 3.x here
    return {
        execute: () => false
    };
}



//# sourceMappingURL=classification-7bcadbab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTgxMzgwYS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMrRjtBQUN6QjtBQUMwSTtBQUN4SjtBQUM3QjtBQUNTO0FBQ0Q7QUFDTDtBQUNIO0FBQ087QUFDTDs7QUFFN0Isd0VBQXdFLGtDQUFrQyxlQUFlLG9CQUFvQixXQUFXLG1CQUFtQix1QkFBdUIsaUJBQWlCLGNBQWMseUJBQXlCLGdCQUFnQixlQUFlOztBQUV6UjtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix3QkFBd0I7QUFDdkQsdUNBQXVDLDhEQUEyQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHdCQUF3QixnQkFBZ0IsY0FBYyxTQUFTLFlBQVk7QUFDMUcsdUNBQXVDLDhEQUE4QjtBQUNyRTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsOERBQWtCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixjQUFjLEVBQUUsT0FBTztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsZUFBZSxHQUFHLGtCQUFrQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTs7QUFFNEU7O0FBRTVFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLWl0ZW0tY2xhc3NpZmljYXRpb24uZW50cnkuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vY2xhc3NpZmljYXRpb24tN2JjYWRiYWIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsZS0wNTBiNmRiOS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgaCwgRiBhcyBGcmFnbWVudCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3RDbGFzc2lmaWNhdGlvblNjaGVtYSwgYSBhcyByZXF1ZXN0SXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUsIHMgYXMgc3VibWl0SXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUsIGkgYXMgaXNBdHRyaWJ1dGVFbmFibGVkLCBlIGFzIGV2YWx1YXRlVmFsdWVFeHByZXNzaW9uIH0gZnJvbSAnLi9jbGFzc2lmaWNhdGlvbi03YmNhZGJhYi5qcyc7XG5pbXBvcnQgeyBjIGFzIGNvbmZpZ1N0YXRlIH0gZnJvbSAnLi9jb25maWctNzVhZGY5NjIuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vcG9ydGFsLWQ1MThiNTcxLmpzJztcbmltcG9ydCAnLi91cmwtNGMzYWU1NGMuanMnO1xuaW1wb3J0ICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgYXJjZ2lzSXRlbUNsYXNzaWZpY2F0aW9uQ3NzID0gXCIucG9ydGFsLWl0ZW0tY2xhc3NpZmljYXRpb24tdmlld2Vyey0tY2FsY2l0ZS1tb2RhbC1jb250ZW50LXBhZGRpbmc6MH0uc2F2ZUluZGljYXRvcntkaXNwbGF5OmlubGluZS1mbGV4O3dpZHRoOjEwMCU7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXJ9LnNhdmluZ0luZGljYXRvcnttYXJnaW46MCAxMHB4fS5jbGFzc2lmaWNhdGlvbi1pbmZvLXRpcHttYXJnaW4tbGVmdDozcHg7Y3Vyc29yOnBvaW50ZXJ9XCI7XG5cbmNvbnN0IEFyY2dpc0l0ZW1DbGFzc2lmaWNhdGlvbiA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMub3JnQ2xhc3NpZmljYXRpb25UeXBlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vcmdJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSA9IG51bGw7XG4gICAgICAgIHRoaXMucmV0cmlldmVDbGFzc2lmaWNhdGlvblNjaGVtYSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuY29uZmlnLnJlc3RCYXNlVXJsfXBvcnRhbHMvc2VsZi9DbGFzc2lmaWNhdGlvblNjaGVtYWA7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0Q2xhc3NpZmljYXRpb25TY2hlbWEodXJsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZpY2F0aW9uU2NoZW1hID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvbkNhdGVnb3J5QXJyID0gKF9hID0gcmVzcG9uc2UuY2xhc3NpZmljYXRpb25zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKChjbGFzc2lmaWNhdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNsYXNzaWZpY2F0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNsYXNzaWZpY2F0aW9uLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNsYXNzaWZpY2F0aW9uLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNsYXNzaWZpY2F0aW9uLmNvbG9yXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVDYXRlZ29yeSgoX2IgPSByZXNwb25zZS5hdHRyaWJ1dGVDYXRlZ29yaWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvcjogXCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURpc3BsYXlOb3RpZmljYXRpb25Nb2RhbCh7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9yQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvclR5cGU6IFwiZGFuZ2VyXCIsXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9ySWNvbjogXCJleGNsYW1hdGlvbi1tYXJrLXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9ySW5mbzogZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZXRyaWV2ZUl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmNvbmZpZy5yZXN0QmFzZVVybH1jb250ZW50L3VzZXJzLyR7dGhpcy51c2VyTmFtZX0vaXRlbXMvJHt0aGlzLml0ZW1JZH1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdEl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKHVybCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbUNsYXNzaWZpY2F0aW9uID0gKF9hID0gcmVzcG9uc2UuaXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzaWZpY2F0aW9uO1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUgPSAhIWl0ZW1DbGFzc2lmaWNhdGlvblxuICAgICAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UoaXRlbUNsYXNzaWZpY2F0aW9uKVxuICAgICAgICAgICAgICAgICAgICA6IHsgY2xhc3NpZmljYXRpb246IHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEuY2xhc3NpZmljYXRpb25zWzBdLmxhYmVsIH07XG4gICAgICAgICAgICAgICAgdGhpcy5vcmdJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSA9IHN0cnVjdHVyZWRDbG9uZSh0aGlzLml0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZpY2F0aW9uVHlwZSA9IHRoaXMuY29udmVydENsYXNzaWZpY2F0aW9uVHlwZSh0aGlzLnJldHJpZXZlQ2xhc3NpZmljYXRpb25UeXBlKCEhaXRlbUNsYXNzaWZpY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgID8geyBsYWJlbDogSlNPTi5wYXJzZShpdGVtQ2xhc3NpZmljYXRpb24pLmNsYXNzaWZpY2F0aW9uIH1cbiAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmNsYXNzaWZpY2F0aW9uU2NoZW1hLmNsYXNzaWZpY2F0aW9uc1swXSkpO1xuICAgICAgICAgICAgICAgIHRoaXMub3JnQ2xhc3NpZmljYXRpb25UeXBlID0gc3RydWN0dXJlZENsb25lKHRoaXMuaXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheUNsYXNzaWZpY2F0aW9uVmFsKHRoaXMuaXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICghIWl0ZW1DbGFzc2lmaWNhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvZXNWYWxpZGF0ZSA9IHRoaXMudmFsaWRhdGVDbGFzc2lmaWNhdGlvblZhbChKU09OLnBhcnNlKGl0ZW1DbGFzc2lmaWNhdGlvbikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3I6IFwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEaXNwbGF5Tm90aWZpY2F0aW9uTW9kYWwoe1xuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYWxlcnRJbmRpY2F0b3JUeXBlOiBcImRhbmdlclwiLFxuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckljb246IFwiZXhjbGFtYXRpb24tbWFyay10cmlhbmdsZVwiLFxuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckluZm86IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFzTm9uZXhpc3RpbmdBdHRyaWJ1dGUgPSAoY2xhc3NpZmljYXRpb25Qcm9wZXJ0eUFycikgPT4ge1xuICAgICAgICAgICAgbGV0IHByb3BSZXMgPSBjbGFzc2lmaWNhdGlvblByb3BlcnR5QXJyLmZpbmQoKHByb3BlcnR5KSA9PiAhdGhpcy5jbGFzc2lmaWNhdGlvblNjaGVtYS5hdHRyaWJ1dGVzW3Byb3BlcnR5XSk7XG4gICAgICAgICAgICByZXR1cm4gISFwcm9wUmVzO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhc0Rpc2FibGVkQXR0cmlidXRlID0gKGNsYXNzaWZpY2F0aW9uUHJvcGVydHlBcnIsIGl0ZW1DbGFzc2lmaWNhdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2hlY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbmRleCBpbiBjbGFzc2lmaWNhdGlvblByb3BlcnR5QXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gY2xhc3NpZmljYXRpb25Qcm9wZXJ0eUFycltpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0VuYWJsZWQgPSBhd2FpdCBpc0F0dHJpYnV0ZUVuYWJsZWQocHJvcGVydHksIHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEsIEpTT04uc3RyaW5naWZ5KGl0ZW1DbGFzc2lmaWNhdGlvbikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNEaXNhYmxlZEF0dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNEaXNhYmxlZEF0dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgaGFzRGlzYWJsZWRBdHQgPSBmYWxzZTtcbiAgICAgICAgICAgIGNoZWNrKCk7XG4gICAgICAgICAgICByZXR1cm4gaGFzRGlzYWJsZWRBdHQ7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFzVXBkYXRlZEF0dHJpYnV0ZVZhbHVlcyA9IChjbGFzc2lmaWNhdGlvblByb3BlcnR5QXJyLCBpdGVtQ2xhc3NpZmljYXRpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5kZXggaW4gY2xhc3NpZmljYXRpb25Qcm9wZXJ0eUFycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IGNsYXNzaWZpY2F0aW9uUHJvcGVydHlBcnJbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlcyA9IGl0ZW1DbGFzc2lmaWNhdGlvbltwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dEVsZW1lbnQgPSB0aGlzLmNsYXNzaWZpY2F0aW9uU2NoZW1hLmxheW91dEVsZW1lbnRzW3Byb3BlcnR5XSB8fCBcInRleHRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheW91dEVsZW1lbnQuaW5jbHVkZXMoXCItc2VsZWN0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlRXhwcmVzc2lvblJlc3VsdCA9IGF3YWl0IGV2YWx1YXRlVmFsdWVFeHByZXNzaW9uKHByb3BlcnR5LCB0aGlzLmNsYXNzaWZpY2F0aW9uU2NoZW1hLCBKU09OLnN0cmluZ2lmeSh0aGlzLml0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZXMuZm9yRWFjaCgocHJvcGVydHlWYWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlRXhwcmVzc2lvblJlc3VsdC5maW5kKChyZXN1bHQpID0+IHJlc3VsdC5sYWJlbCAhPT0gcHJvcGVydHlWYWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNVbm1hdGNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzVW5tYXRjaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxldCBoYXNVbm1hdGNoID0gZmFsc2U7XG4gICAgICAgICAgICBjaGVjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGhhc1VubWF0Y2g7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudmFsaWRhdGVDbGFzc2lmaWNhdGlvblZhbCA9IChpdGVtQ2xhc3NpZmljYXRpb24pID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uUHJvcGVydHlBcnIgPSAoX2EgPSBPYmplY3Qua2V5cyhpdGVtQ2xhc3NpZmljYXRpb24pKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKChrZXkpID0+IGtleSAhPT0gXCJjbGFzc2lmaWNhdGlvblwiKTtcbiAgICAgICAgICAgIC8vIGl0ZW0gY2xhc3NpZmljYXRpb24gaXMgZW1wdHlcbiAgICAgICAgICAgIGlmIChjbGFzc2lmaWNhdGlvblByb3BlcnR5QXJyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbG9vcCBmb3IgYW55IG5vbi1leGlzdGluZyBhdHRyaWJ1dGUgaW4gdGhlIGNsYXNzaWZpY2F0aW9uIHNjaGVtYVxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzTm9uZXhpc3RpbmdBdHRyaWJ1dGUoY2xhc3NpZmljYXRpb25Qcm9wZXJ0eUFycikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBsb29wIGZvciBhbnkgbm9uLWVuYWJsZWQgYXR0cmlidXRlIGluIHRoZSBjbGFzc2lmaWNhdGlvbiBzY2hlbWFcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0Rpc2FibGVkQXR0cmlidXRlKGNsYXNzaWZpY2F0aW9uUHJvcGVydHlBcnIsIGl0ZW1DbGFzc2lmaWNhdGlvbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBsb29wIGZvciBhbnkgdXBkYXRlZCBhdHRyaWJ1dGUgaW4gdGhlIGNsYXNzaWZpY2F0aW9uIHNjaGVtYVxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzVXBkYXRlZEF0dHJpYnV0ZVZhbHVlcyhjbGFzc2lmaWNhdGlvblByb3BlcnR5QXJyLCBpdGVtQ2xhc3NpZmljYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2F2ZUl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmNvbmZpZy5yZXN0QmFzZVVybH1jb250ZW50L3VzZXJzLyR7dGhpcy51c2VyTmFtZX0vaXRlbXMvJHt0aGlzLml0ZW1JZH0vdXBkYXRlYDtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHN1Ym1pdEl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKHVybCwgdGhpcy5pdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURpc3BsYXlOb3RpZmljYXRpb25Nb2RhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9yVHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckljb246IFwiY2hlY2stY2lyY2xlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckluZm86IHRoaXMuaTE4bi5jbGFzc2lmaWNhdGlvblZhbHVlU2F2ZWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDbGFzc2lmaWNhdGlvbkVkaXRNb2RhbChcInNhdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIHB1bGwgZGF0YSBhZ2FpblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJldHJpZXZlQ2xhc3NpZmljYXRpb25TY2hlbWEoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXRyaWV2ZUl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvcjogXCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEaXNwbGF5Tm90aWZpY2F0aW9uTW9kYWwoe1xuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYWxlcnRJbmRpY2F0b3JUeXBlOiBcImRhbmdlclwiLFxuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckljb246IFwiZXhjbGFtYXRpb24tbWFyay10cmlhbmdsZVwiLFxuICAgICAgICAgICAgICAgICAgICBhbGVydEluZGljYXRvckluZm86IGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIE9wZW4gbm90aWZpY2F0aW9uIG1vZGFsXG4gICAgICAgIHRoaXMuaGFuZGxlRGlzcGxheU5vdGlmaWNhdGlvbk1vZGFsID0gKGFsZXJ0SW5kaWNhdG9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFsZXJ0SW5kaWNhdG9yID0gYWxlcnRJbmRpY2F0b3I7XG4gICAgICAgICAgICB0aGlzLmlzTm90aWZpY2F0aW9uTW9kYWxBY3RpdmUgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICAvLyBDbG9zZSBub3RpZmljYXRpb24gbW9kYWxcbiAgICAgICAgdGhpcy5oYW5kbGVDbG9zZU5vdGlmaWNhdGlvbk1vZGFsID0gKCkgPT4gKHRoaXMuaXNOb3RpZmljYXRpb25Nb2RhbEFjdGl2ZSA9IGZhbHNlKTtcbiAgICAgICAgdGhpcy5pdGVtSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXNlck5hbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29uZmlnID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmlzRGlzcGxheU1vZGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNldElzRGlzcGxheU1vZGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRpc3BsYXlDbGFzc2lmaWNhdGlvblZhbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hcGkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEgPSBudWxsO1xuICAgICAgICB0aGlzLmNsYXNzaWZpY2F0aW9uQ2F0ZWdvcnlBcnIgPSBbXTtcbiAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvblR5cGUgPSBudWxsO1xuICAgICAgICB0aGlzLml0ZW1DbGFzc2lmaWNhdGlvblZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVDYXRlZ29yeSA9IFwiR2VuZXJhbFwiO1xuICAgICAgICB0aGlzLmRvZXNWYWxpZGF0ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1Jlc2V0dGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzTm90aWZpY2F0aW9uTW9kYWxBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hbGVydEluZGljYXRvciA9IHtcbiAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9yQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9yVHlwZTogXCJkYW5nZXJcIixcbiAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9ySWNvbjogXCJleGNsYW1hdGlvbi1tYXJrLXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICBhbGVydEluZGljYXRvckluZm86IFwiXCJcbiAgICAgICAgfTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5pMThuID0gbG9jYWxlWzBdO1xuICAgICAgICB0aGlzLnJldHJpZXZlQ2xhc3NpZmljYXRpb25TY2hlbWEoKTtcbiAgICAgICAgdGhpcy5yZXRyaWV2ZUl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlKCk7XG4gICAgICAgIChfYSA9IGNvbmZpZ1N0YXRlLmFwaSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKGNvbmZpZ1N0YXRlLmFwaSA9IHRoaXMuYXBpKTtcbiAgICB9XG4gICAgcmV0cmlldmVDbGFzc2lmaWNhdGlvblR5cGUoY2xhc3NpZmljYXRpb24pIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gdGhpcy5jbGFzc2lmaWNhdGlvblNjaGVtYSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzaWZpY2F0aW9ucy5maW5kKChjbGFzc2lmaWNhdGlvbkl0ZW0pID0+IGNsYXNzaWZpY2F0aW9uSXRlbS5sYWJlbCA9PT0gY2xhc3NpZmljYXRpb24ubGFiZWwpO1xuICAgIH1cbiAgICBjb252ZXJ0Q2xhc3NpZmljYXRpb25UeXBlKGNsYXNzaWZpY2F0aW9uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogY2xhc3NpZmljYXRpb24uaWQsXG4gICAgICAgICAgICBjb2xvcjogY2xhc3NpZmljYXRpb24uY29sb3IsXG4gICAgICAgICAgICB2YWx1ZTogY2xhc3NpZmljYXRpb24ubGFiZWwsXG4gICAgICAgICAgICBsYWJlbDogY2xhc3NpZmljYXRpb24ubGFiZWxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2V0Q2xhc3NpZmljYXRpb25UeXBlKG5ld1R5cGUpIHtcbiAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvblR5cGUgPSBuZXdUeXBlO1xuICAgIH1cbiAgICBzZXRJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZShuZXdWYWx1ZSkge1xuICAgICAgICB0aGlzLml0ZW1DbGFzc2lmaWNhdGlvblZhbHVlID0gbmV3VmFsdWU7XG4gICAgfVxuICAgIHNldEF0dHJpYnV0ZUNhdGVnb3J5KGNhdGVnb3J5KSB7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlQ2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICB9XG4gICAgb3BlbkNsYXNzaWZpY2F0aW9uRWRpdE1vZGFsKCkge1xuICAgICAgICB0aGlzLnNldElzRGlzcGxheU1vZGFsKHRydWUpO1xuICAgICAgICBpZiAoIXRoaXMuZG9lc1ZhbGlkYXRlKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZURpc3BsYXlOb3RpZmljYXRpb25Nb2RhbCh7XG4gICAgICAgICAgICAgICAgYWxlcnRJbmRpY2F0b3JBY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgYWxlcnRJbmRpY2F0b3JUeXBlOiBcImRhbmdlclwiLFxuICAgICAgICAgICAgICAgIGFsZXJ0SW5kaWNhdG9ySWNvbjogXCJleGNsYW1hdGlvbi1tYXJrLXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICAgICAgYWxlcnRJbmRpY2F0b3JJbmZvOiB0aGlzLmkxOG4uaXRlbUNsYXNzaWZpY2F0aW9uVmFsaWRhdGVFcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2VDbGFzc2lmaWNhdGlvbkVkaXRNb2RhbChhY3Rpb24pIHtcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJjYW5jZWxcIikge1xuICAgICAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvblR5cGUgPSB0aGlzLm9yZ0NsYXNzaWZpY2F0aW9uVHlwZTtcbiAgICAgICAgICAgIHRoaXMuaXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUgPSB0aGlzLm9yZ0l0ZW1DbGFzc2lmaWNhdGlvblZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0SXNEaXNwbGF5TW9kYWwoZmFsc2UpO1xuICAgIH1cbiAgICByZXNldENsYXNzaWZpY2F0aW9uVmFsdWUoKSB7XG4gICAgICAgIHRoaXMuc2V0Q2xhc3NpZmljYXRpb25UeXBlKHRoaXMuY29udmVydENsYXNzaWZpY2F0aW9uVHlwZSh0aGlzLnJldHJpZXZlQ2xhc3NpZmljYXRpb25UeXBlKE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEuY2xhc3NpZmljYXRpb25zWzBdKSkpKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSh7XG4gICAgICAgICAgICBjbGFzc2lmaWNhdGlvbjogdGhpcy5jbGFzc2lmaWNhdGlvblNjaGVtYS5jbGFzc2lmaWNhdGlvbnNbMF0ubGFiZWxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGRpc3BsYXlJbnRvVGlwKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcInRlc3RcIik7XG4gICAgfVxuICAgIHJlbmRlckhlYWRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiaDNcIiwgeyBzbG90OiBcImhlYWRlclwiIH0sIHRoaXMuaTE4bi5pdGVtQ2xhc3NpZmljYXRpb25FZGl0TGFiZWwsIGgoXCJjYWxjaXRlLWljb25cIiwgeyBjbGFzczogXCJjbGFzc2lmaWNhdGlvbi1pbmZvLXRpcFwiLCBzY2FsZTogXCJzXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiwgb25DbGljazogdGhpcy5kaXNwbGF5SW50b1RpcCB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnRcIiwgY2xhc3M6IFwicG9ydGFsLWl0ZW0tY2xhc3NpZmljYXRpb24tY29udGVudFwiIH0sIFxuICAgICAgICAvKiBDdXJyZW50IFNlbGVjdGlvbiAqL1xuICAgICAgICBoKFwiaXRlbS1jbGFzc2lmaWNhdGlvbi1pbmZvXCIsIHsgaTE4bjogdGhpcy5pMThuLCBpdGVtQ2xhc3NpZmljYXRpb25WYWx1ZTogdGhpcy5pdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSwgY2xhc3NpZmljYXRpb25TY2hlbWE6IHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEgfSksIFxuICAgICAgICAvKiBjbGFzc2lmaWNhdGlvbiBjYXRlZ29yeSAqL1xuICAgICAgICBoKFwiaXRlbS1jbGFzc2lmaWNhdGlvbi1jYXRlZ29yeVwiLCB7IGkxOG46IHRoaXMuaTE4biwgY2xhc3NpZmljYXRpb25DYXRlZ29yeUFycjogdGhpcy5jbGFzc2lmaWNhdGlvbkNhdGVnb3J5QXJyLCBjbGFzc2lmaWNhdGlvblR5cGU6IHRoaXMuY2xhc3NpZmljYXRpb25UeXBlLCBzZXRDbGFzc2lmaWNhdGlvblR5cGU6IHRoaXMuc2V0Q2xhc3NpZmljYXRpb25UeXBlLmJpbmQodGhpcyksIHNldEl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlOiB0aGlzLnNldEl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlLmJpbmQodGhpcykgfSksIFxuICAgICAgICAvKiBjbGFzc2lmaWNhdGlvbiBjb250ZW50ICovXG4gICAgICAgICEhdGhpcy5jbGFzc2lmaWNhdGlvblNjaGVtYSAmJiAhIXRoaXMuaXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUgJiYgKGgoXCJpdGVtLWNsYXNzaWZpY2F0aW9uLWNvbnRlbnRcIiwgeyBpdGVtQ2xhc3NpZmljYXRpb25WYWx1ZTogdGhpcy5pdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSwgY2xhc3NpZmljYXRpb25TY2hlbWE6IHRoaXMuY2xhc3NpZmljYXRpb25TY2hlbWEsIGF0dHJpYnV0ZUNhdGVnb3J5OiB0aGlzLmF0dHJpYnV0ZUNhdGVnb3J5LCBzZXRBdHRyaWJ1dGVDYXRlZ29yeTogdGhpcy5zZXRBdHRyaWJ1dGVDYXRlZ29yeS5iaW5kKHRoaXMpLCBzZXRJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZTogdGhpcy5zZXRJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZS5iaW5kKHRoaXMpLCBvbkFyY2dpc0l0ZW1DbGFzc2lmaWNhdGlvbkNvbnRlbnREaXNwbGF5Tm90aWZpY2F0aW9uOiAoZSkgPT4gdGhpcy5oYW5kbGVEaXNwbGF5Tm90aWZpY2F0aW9uTW9kYWwoZS5kZXRhaWwpLCBpc1NhdmluZzogdGhpcy5pc1NhdmluZyB9KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRm9vdGVyKCkge1xuICAgICAgICBjb25zdCB7IGkxOG4gfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgXCJhcmlhLWxhYmVsXCI6IGkxOG4ucmVzZXQsIHNjYWxlOiBcImxcIiwgc2xvdDogXCJiYWNrXCIsIHdpZHRoOiBcImZ1bGxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lXCIsIGRpc2FibGVkOiB0aGlzLmlzU2F2aW5nLCBvbkNsaWNrOiAoKSA9PiB0aGlzLnJlc2V0Q2xhc3NpZmljYXRpb25WYWx1ZSgpIH0sIHRoaXMuaXNSZXNldHRpbmcgPyAoaChcImRpdlwiLCB7IGNsYXNzOiBcInJlc2V0SW5kaWNhdG9yXCIgfSwgaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IFwicmVzZXR0aW5nQ2xhc3NpZmljYXRpb25cIiwgc2NhbGU6IFwibVwiLCBpbmxpbmU6IHRydWUgfSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwicmVzZXRJbmRpY2F0b3JcIiB9LCBpMThuLnJlc2V0dGluZykpKSA6IChoKFwiZGl2XCIsIG51bGwsIGkxOG4ucmVzZXQpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IFwiYXJpYS1sYWJlbFwiOiBpMThuLnNhdmUsIHNjYWxlOiBcImxcIiwgc2xvdDogXCJwcmltYXJ5XCIsIHdpZHRoOiBcImZ1bGxcIiwgb25DbGljazogKCkgPT4gdGhpcy5zYXZlSXRlbUNsYXNzaWZpY2F0aW9uVmFsdWUoKSB9LCB0aGlzLmlzU2F2aW5nID8gKGgoXCJkaXZcIiwgeyBjbGFzczogXCJzYXZlSW5kaWNhdG9yXCIgfSwgaChcImNhbGNpdGUtbG9hZGVyXCIsIHsgbGFiZWw6IFwic2F2aW5nQ2xhc3NpZmljYXRpb25cIiwgc2NhbGU6IFwibVwiLCBpbmxpbmU6IHRydWUgfSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwic2F2aW5nSW5kaWNhdG9yXCIgfSwgaTE4bi5zYXZpbmcpKSkgOiAoaChcImRpdlwiLCBudWxsLCBpMThuLnNhdmUpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IFwiYXJpYS1sYWJlbFwiOiBpMThuLmNhbmNlbCwgc2NhbGU6IFwibFwiLCBzbG90OiBcInNlY29uZGFyeVwiLCB3aWR0aDogXCJmdWxsXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZVwiLCBvbkNsaWNrOiAoKSA9PiB0aGlzLmNsb3NlQ2xhc3NpZmljYXRpb25FZGl0TW9kYWwoXCJjYW5jZWxcIiksIGRpc2FibGVkOiB0aGlzLmlzU2F2aW5nIH0sIGgoXCJkaXZcIiwgbnVsbCwgaTE4bi5jYW5jZWwpKSkpO1xuICAgIH1cbiAgICByZW5kZXJNb2RhbCgpIHtcbiAgICAgICAgcmV0dXJuIChoKEZyYWdtZW50LCBudWxsLCB0aGlzLnJlbmRlckhlYWRlcigpLCB0aGlzLnJlbmRlckNvbnRlbnQoKSwgdGhpcy5yZW5kZXJGb290ZXIoKSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImJ1dHRvblwiLCB7IG9uQ2xpY2s6ICgpID0+IHRoaXMub3BlbkNsYXNzaWZpY2F0aW9uRWRpdE1vZGFsKCkgfSwgdGhpcy5pMThuLm9wZW5Nb2RhbCksIGgoXCJjYWxjaXRlLW1vZGFsXCIsIHsgY2xhc3M6IFwicG9ydGFsLWl0ZW0tY2xhc3NpZmljYXRpb24tdmlld2VyXCIsIG9wZW46IHRoaXMuaXNEaXNwbGF5TW9kYWwsIHNjYWxlOiBcIm1cIiwgd2lkdGhTY2FsZTogXCJtXCIsIG91dHNpZGVDbG9zZURpc2FibGVkOiB0cnVlLCBvbkNhbGNpdGVNb2RhbENsb3NlOiAoKSA9PiB0aGlzLmNsb3NlQ2xhc3NpZmljYXRpb25FZGl0TW9kYWwoXCJjYW5jZWxcIikgfSwgdGhpcy5yZW5kZXJNb2RhbCgpKSwgXG4gICAgICAgIC8qIFNob3cgbm90aWZpY2F0aW9uIGluZGljYXRvciAqL1xuICAgICAgICB0aGlzLmlzTm90aWZpY2F0aW9uTW9kYWxBY3RpdmUgJiYgKGgoXCJpdGVtLWNsYXNzaWZpY2F0aW9uLW5vdGlmaWNhdGlvblwiLCB7IGkxOG46IHRoaXMuaTE4biwgYWxlcnRJbmRpY2F0b3I6IHRoaXMuYWxlcnRJbmRpY2F0b3IsIG9uQXJjZ2lzSXRlbUNsYXNzaWZpY2F0aW9uTm90aWZpY2F0aW9uQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsb3NlTm90aWZpY2F0aW9uTW9kYWwoKTtcbiAgICAgICAgICAgIH0gfSkpKSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNJdGVtQ2xhc3NpZmljYXRpb24uc3R5bGUgPSBhcmNnaXNJdGVtQ2xhc3NpZmljYXRpb25Dc3M7XG5cbmV4cG9ydCB7IEFyY2dpc0l0ZW1DbGFzc2lmaWNhdGlvbiBhcyBhcmNnaXNfaXRlbV9jbGFzc2lmaWNhdGlvbiB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtaXRlbS1jbGFzc2lmaWNhdGlvbi5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY29uZmlnU3RhdGUgfSBmcm9tICcuL2NvbmZpZy03NWFkZjk2Mi5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyByIGFzIHJlcXVlc3QgfSBmcm9tICcuL3BvcnRhbC1kNTE4YjU3MS5qcyc7XG5cbmZ1bmN0aW9uIHJlcXVlc3RJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSh1cmwpIHtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwpO1xufVxuZnVuY3Rpb24gcmVxdWVzdENsYXNzaWZpY2F0aW9uU2NoZW1hKHVybCkge1xuICAgIHJldHVybiByZXF1ZXN0KHVybCk7XG59XG5mdW5jdGlvbiBzdWJtaXRJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSh1cmwsIGNsYXNzaWZpY2F0aW9uVmFsdWUpIHtcbiAgICBjb25zdCBkYXRhID0geyBjbGFzc2lmaWNhdGlvbjogSlNPTi5zdHJpbmdpZnkoY2xhc3NpZmljYXRpb25WYWx1ZSkgfTtcbiAgICByZXR1cm4gcmVxdWVzdCh1cmwsIGRhdGEsIHt9LCBcInBvc3RcIik7XG59XG5hc3luYyBmdW5jdGlvbiBpc0F0dHJpYnV0ZUVuYWJsZWQoYXR0cmlidXRlSWQsIGNsYXNzaWZpY2F0aW9uU2NoZW1hLCB2YWx1ZUpzb24pIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYXR0cmlidXRlSWRWYWwgPSAoX2EgPSBjbGFzc2lmaWNhdGlvblNjaGVtYSA9PT0gbnVsbCB8fCBjbGFzc2lmaWNhdGlvblNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xhc3NpZmljYXRpb25TY2hlbWEuYXR0cmlidXRlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2F0dHJpYnV0ZUlkXTtcbiAgICBjb25zdCBpc0F0dHJpYnV0ZUVuYWJsZWQgPSBhdHRyaWJ1dGVJZFZhbCA9PT0gbnVsbCB8fCBhdHRyaWJ1dGVJZFZhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXR0cmlidXRlSWRWYWwuaXNBdHRyaWJ1dGVFbmFibGVkO1xuICAgIGlmICghYXR0cmlidXRlSWRWYWwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIWlzQXR0cmlidXRlRW5hYmxlZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgYXJjYWRlSW5wdXQgPSB7XG4gICAgICAgIHNjaGVtYUpzb25TdHJpbmc6IEpTT04uc3RyaW5naWZ5KGNsYXNzaWZpY2F0aW9uU2NoZW1hKSxcbiAgICAgICAgdmFsdWVKc29uU3RyaW5nOiB2YWx1ZUpzb24sXG4gICAgICAgIGF0dHJpYnV0ZUlkOiBhdHRyaWJ1dGVJZFxuICAgIH07XG4gICAgY29uc3QgYXJjYWRlU2NyaXB0RXhlY3V0b3IgPSBhd2FpdCBnZXRFeGVjdXRvcihpc0F0dHJpYnV0ZUVuYWJsZWQpO1xuICAgIHJldHVybiBhcmNhZGVTY3JpcHRFeGVjdXRvci5leGVjdXRlKGFyY2FkZUlucHV0KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGV2YWx1YXRlVmFsdWVFeHByZXNzaW9uKGF0dHJpYnV0ZUlkLCBjbGFzc2lmaWNhdGlvblNjaGVtYSwgdmFsdWVKc29uKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCBhdHRyaWJ1dGVJZFZhbCA9IChfYSA9IGNsYXNzaWZpY2F0aW9uU2NoZW1hID09PSBudWxsIHx8IGNsYXNzaWZpY2F0aW9uU2NoZW1hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbGFzc2lmaWNhdGlvblNjaGVtYS5hdHRyaWJ1dGVzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbYXR0cmlidXRlSWRdO1xuICAgIGNvbnN0IHZhbHVlRXhwcmVzc2lvbiA9IGF0dHJpYnV0ZUlkVmFsID09PSBudWxsIHx8IGF0dHJpYnV0ZUlkVmFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdHRyaWJ1dGVJZFZhbC52YWx1ZUV4cHJlc3Npb247XG4gICAgY29uc3QgdmFsaWRWYWx1ZXMgPSBhdHRyaWJ1dGVJZFZhbCA9PT0gbnVsbCB8fCBhdHRyaWJ1dGVJZFZhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXR0cmlidXRlSWRWYWwudmFsaWRWYWx1ZXM7XG4gICAgY29uc3QgdmFsaWRWYWx1ZXNNYXAgPSBhdHRyaWJ1dGVJZFZhbCA9PT0gbnVsbCB8fCBhdHRyaWJ1dGVJZFZhbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXR0cmlidXRlSWRWYWwudmFsaWRWYWx1ZXNNYXA7XG4gICAgaWYgKCFhdHRyaWJ1dGVJZFZhbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKCEhKHZhbGlkVmFsdWVzID09PSBudWxsIHx8IHZhbGlkVmFsdWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2YWxpZFZhbHVlcy5sZW5ndGgpKSB7XG4gICAgICAgIHJldHVybiB2YWxpZFZhbHVlcztcbiAgICB9XG4gICAgaWYgKCEhdmFsaWRWYWx1ZXNNYXAgJiYgISEoKF9iID0gT2JqZWN0LmtleXModmFsaWRWYWx1ZXNNYXApKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSkge1xuICAgICAgICByZXR1cm4gdmFsaWRWYWx1ZXNNYXA7XG4gICAgfVxuICAgIGlmICghdmFsdWVFeHByZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBhcmNhZGVJbnB1dCA9IHtcbiAgICAgICAgc2NoZW1hSnNvblN0cmluZzogSlNPTi5zdHJpbmdpZnkoY2xhc3NpZmljYXRpb25TY2hlbWEpLFxuICAgICAgICB2YWx1ZUpzb25TdHJpbmc6IHZhbHVlSnNvbixcbiAgICAgICAgYXR0cmlidXRlSWQ6IGF0dHJpYnV0ZUlkXG4gICAgfTtcbiAgICBjb25zdCBhcmNhZGVTY3JpcHRFeGVjdXRvciA9IGF3YWl0IGdldEV4ZWN1dG9yKHZhbHVlRXhwcmVzc2lvbik7XG4gICAgcmV0dXJuIGFyY2FkZVNjcmlwdEV4ZWN1dG9yLmV4ZWN1dGUoYXJjYWRlSW5wdXQpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0RXhlY3V0b3IoYXJjYWRlRXhwcmVzc2lvbklucHV0KSB7XG4gICAgaWYgKChjb25maWdTdGF0ZSA9PT0gbnVsbCB8fCBjb25maWdTdGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29uZmlnU3RhdGUuYXBpKSA9PT0gMykge1xuICAgICAgICByZXR1cm4gZ2V0RXhlY3V0b3IzeChhcmNhZGVFeHByZXNzaW9uSW5wdXQpO1xuICAgIH1cbiAgICBjb25zdCBbYXJjYWRlXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvYXJjYWRlXCJdKTtcbiAgICByZXR1cm4gYXJjYWRlLmNyZWF0ZUFyY2FkZUV4ZWN1dG9yKGFyY2FkZUV4cHJlc3Npb25JbnB1dCwge1xuICAgICAgICB2YXJpYWJsZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInNjaGVtYUpzb25TdHJpbmdcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInZhbHVlSnNvblN0cmluZ1wiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiYXR0cmlidXRlSWRcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIlxuICAgICAgICAgICAgfVxuICAgICAgICBdXG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRFeGVjdXRvcjN4KGFyY2FkZUV4cHJlc3Npb25JbnB1dCkge1xuICAgIGNvbnN0IFt2aXN1YWxpemF0aW9uUHJvZmlsZV0gPSBhd2FpdCBsb2FkTW9kdWxlcyhbXCJlc3JpL2FyY2FkZVByb2ZpbGVzL3Zpc3VhbGl6YXRpb25Qcm9maWxlXCJdKTtcbiAgICAvKiBjb25zdCBwcm9maWxlID0gKi8gYXdhaXQgdmlzdWFsaXphdGlvblByb2ZpbGUuaW5pdGlhbGl6ZShbYXJjYWRlRXhwcmVzc2lvbklucHV0XSk7XG4gICAgLy8gVE9ETzogaW1wbGVtZW50IHdvcmtpbmcgZXhlY3V0b3IgaW4gMy54IGhlcmVcbiAgICByZXR1cm4ge1xuICAgICAgICBleGVjdXRlOiAoKSA9PiBmYWxzZVxuICAgIH07XG59XG5cbmV4cG9ydCB7IHJlcXVlc3RJdGVtQ2xhc3NpZmljYXRpb25WYWx1ZSBhcyBhLCBldmFsdWF0ZVZhbHVlRXhwcmVzc2lvbiBhcyBlLCBpc0F0dHJpYnV0ZUVuYWJsZWQgYXMgaSwgcmVxdWVzdENsYXNzaWZpY2F0aW9uU2NoZW1hIGFzIHIsIHN1Ym1pdEl0ZW1DbGFzc2lmaWNhdGlvblZhbHVlIGFzIHMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2xhc3NpZmljYXRpb24tN2JjYWRiYWIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeSB9IGZyb20gJy4vZG9tLTRkMzY3Njc3LmpzJztcblxuY29uc3QgbGFuZ3VhZ2VNYXAgPSBuZXcgTWFwKFtcbiAgICBbXCJhclwiLCBcImFyXCJdLFxuICAgIFtcImJnXCIsIFwiYmdcIl0sXG4gICAgW1wiYnNcIiwgXCJic1wiXSxcbiAgICBbXCJjYVwiLCBcImNhXCJdLFxuICAgIFtcImNzXCIsIFwiY3NcIl0sXG4gICAgW1wiZGFcIiwgXCJkYVwiXSxcbiAgICBbXCJkZVwiLCBcImRlXCJdLFxuICAgIFtcImVsXCIsIFwiZWxcIl0sXG4gICAgW1wiZW5cIiwgXCJlblwiXSxcbiAgICBbXCJlc1wiLCBcImVzXCJdLFxuICAgIFtcImV0XCIsIFwiZXRcIl0sXG4gICAgW1wiZmlcIiwgXCJmaVwiXSxcbiAgICBbXCJmclwiLCBcImZyXCJdLFxuICAgIFtcImhlXCIsIFwiaGVcIl0sXG4gICAgW1wiaHJcIiwgXCJoclwiXSxcbiAgICBbXCJodVwiLCBcImh1XCJdLFxuICAgIFtcImlkXCIsIFwiaWRcIl0sXG4gICAgW1wiaXRcIiwgXCJpdFwiXSxcbiAgICBbXCJqYVwiLCBcImphXCJdLFxuICAgIFtcImtvXCIsIFwia29cIl0sXG4gICAgW1wibHRcIiwgXCJsdFwiXSxcbiAgICBbXCJsdlwiLCBcImx2XCJdLFxuICAgIFtcIm5iXCIsIFwibmJcIl0sXG4gICAgW1wibmxcIiwgXCJubFwiXSxcbiAgICBbXCJwbFwiLCBcInBsXCJdLFxuICAgIFtcInB0LWJyXCIsIFwicHQtQlJcIl0sXG4gICAgW1wicHQtcHRcIiwgXCJwdC1QVFwiXSxcbiAgICBbXCJyb1wiLCBcInJvXCJdLFxuICAgIFtcInJ1XCIsIFwicnVcIl0sXG4gICAgW1wic2tcIiwgXCJza1wiXSxcbiAgICBbXCJzbFwiLCBcInNsXCJdLFxuICAgIFtcInNyXCIsIFwic3JcIl0sXG4gICAgW1wic3ZcIiwgXCJzdlwiXSxcbiAgICBbXCJ0aFwiLCBcInRoXCJdLFxuICAgIFtcInRyXCIsIFwidHJcIl0sXG4gICAgW1widWtcIiwgXCJ1a1wiXSxcbiAgICBbXCJ2aVwiLCBcInZpXCJdLFxuICAgIFtcInpoLWNuXCIsIFwiemgtQ05cIl0sXG4gICAgW1wiemgtaGtcIiwgXCJ6aC1IS1wiXSxcbiAgICBbXCJ6aC10d1wiLCBcInpoLVRXXCJdXG5dKTtcbi8vIHJ0bFxuZnVuY3Rpb24gZ2V0RWxlbWVudERpcihlbCkge1xuICAgIHJldHVybiBnZXRFbGVtZW50UHJvcChlbCwgXCJkaXJcIiwgXCJsdHJcIik7XG59XG5mdW5jdGlvbiBnZXRFbGVtZW50UHJvcChlbCwgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBjbG9zZXN0V2l0aFByb3AgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWwsIGBbJHtwcm9wfV1gKTtcbiAgICByZXR1cm4gY2xvc2VzdFdpdGhQcm9wID8gY2xvc2VzdFdpdGhQcm9wLmdldEF0dHJpYnV0ZShwcm9wKSA6IHZhbHVlO1xufVxuLy8gY3NzXG5jb25zdCBDU1NfVVRJTElUWSA9IHtcbiAgICBydGw6IFwiYXJjZ2lzLS1ydGxcIlxufTtcbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFwaSwgdHlwZSwgcGxhY2VzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmIChhcGkgPT09IDQpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgY29uc3QgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMgPSBpbnRsLmNvbnZlcnROdW1iZXJGb3JtYXRUb0ludGxPcHRpb25zKHtcbiAgICAgICAgICAgIHBsYWNlcyxcbiAgICAgICAgICAgIHN0eWxlOiB0eXBlLFxuICAgICAgICAgICAgZGlnaXRTZXBhcmF0b3I6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnRsLmZvcm1hdE51bWJlcihudW1iZXIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbnVtYmVyRm9ybWF0SW50bE9wdGlvbnMpLCB7IHN0eWxlOiB0eXBlIH0pKTtcbiAgICB9XG4gICAgY29uc3QgW2Rvam9OdW1iZXJdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZG9qby9udW1iZXJcIl0pO1xuICAgIHJldHVybiBkb2pvTnVtYmVyLmZvcm1hdChudW1iZXIsIHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcGxhY2VzLFxuICAgICAgICBwYXR0ZXJuOiBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucGF0dGVyblxuICAgIH0pO1xufVxuY29uc3QgY2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkge1xuICAgIGNvbnN0IGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcbiAgICBjb25zdCBkYXlTaG9ydE1vbnRoWWVhciA9IHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcInNob3J0XCIsXG4gICAgICAgIGRheTogXCJudW1lcmljXCJcbiAgICB9O1xuICAgIGlmICghY2FjaGVbbGFuZ10pIHtcbiAgICAgICAgY2FjaGVbbGFuZ10gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZywgZGF5U2hvcnRNb250aFllYXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2FjaGVbbGFuZ10uZm9ybWF0KGRhdGUpO1xufVxuZnVuY3Rpb24gZm9ybWF0UGx1cmFsKGxhbmcsIHN0cmluZ09iaiwgbnVtYmVyKSB7XG4gICAgY29uc3Qgc2luZ2xlcyA9IFtcImlkXCIsIFwiamFcIiwgXCJrb1wiLCBcInRoXCIsIFwidmlcIiwgXCJ6aC1jblwiLCBcInpoLWhrXCIsIFwiemgtdHdcIl07XG4gICAgY29uc3QgbGlrZUVuZ2xpc2ggPSBbXG4gICAgICAgIFwiZW5cIixcbiAgICAgICAgXCJjYVwiLFxuICAgICAgICBcImRhXCIsXG4gICAgICAgIFwiZGVcIixcbiAgICAgICAgXCJlbFwiLFxuICAgICAgICBcImVzXCIsXG4gICAgICAgIFwiZXRcIixcbiAgICAgICAgXCJmaVwiLFxuICAgICAgICBcImhpXCIsXG4gICAgICAgIFwiaHVcIixcbiAgICAgICAgXCJpdFwiLFxuICAgICAgICBcIm5iXCIsXG4gICAgICAgIFwibmxcIixcbiAgICAgICAgXCJwdC1wdFwiLFxuICAgICAgICBcInN2XCIsXG4gICAgICAgIFwidHJcIlxuICAgIF07XG4gICAgY29uc3QgbG9jYWxlID0gbGFuZyAhPT0gbnVsbCAmJiBsYW5nICE9PSB2b2lkIDAgPyBsYW5nIDogXCJlblwiO1xuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgb25lLCBvciBpdCBpcyBhIFwic2ltcGxlXCIgbGFuZ3VhZ2UsIHJldHVybiB0aGUgMSBzdHJpbmdcbiAgICBpZiAobnVtYmVyID09PSAxIHx8IHNpbmdsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLnNpbmdsZS5yZXBsYWNlKFwiJHtudW1iZXJ9XCIsIFwiMVwiKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIG51bWJlciBpcyBub3QgMSBhbmQgdGhlIGxhbmd1YWdlIHVzZXMgdGhlIHNhbWUgcGx1cmFsaXphdGlvbiBzdHJhdGVneSBhcyBlbmdsaXNoLFxuICAgIC8vIHJldHVybiB0aGUgbXVsdGlwbGUgc3RyaW5nXG4gICAgaWYgKG51bWJlciAhPT0gMSAmJiBsaWtlRW5nbGlzaC5pbmNsdWRlcyhsb2NhbGUpKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdPYmoubXVsdGlwbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG4gICAgfVxuICAgIC8vIGlmIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmtlZCwgcmV0dXJuIHRoZSBcInVua25vd25cIiBzdHJpbmdcbiAgICByZXR1cm4gc3RyaW5nT2JqLnVua25vd24ucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBgJHtudW1iZXJ9YCk7XG59XG5cbmV4cG9ydCB7IENTU19VVElMSVRZIGFzIEMsIGZvcm1hdERhdGUgYXMgYSwgZm9ybWF0UGx1cmFsIGFzIGIsIGZvcm1hdE51bWJlciBhcyBmLCBnZXRFbGVtZW50RGlyIGFzIGcsIGxhbmd1YWdlTWFwIGFzIGwgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgeyBsIGFzIGxhbmd1YWdlTWFwIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBc3NldFBhdGggfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcblxuLy8gaHR0cHM6Ly9tZWRpdW0uY29tL3N0ZW5jaWwtdHJpY2tzL2ltcGxlbWVudGluZy1pbnRlcm5hdGlvbmFsaXNhdGlvbi1pMThuLXdpdGgtc3RlbmNpbC01ZTY1NTk1NTQxMTdcbmZ1bmN0aW9uIGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZShlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgY2xvc2VzdEVsZW1lbnQgPSAoX2EgPSBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkoZWxlbWVudCwgXCJbbGFuZ11cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChfYyA9IChfYiA9IGVsZW1lbnQuc2hhZG93Um9vdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm93bmVyRG9jdW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgLy8gbGFuZ3VhZ2Ugc2V0IGJ5IHRoZSBjYWxsaW5nIGFwcGxpY2F0aW9uIG9yIGJyb3dzZXIuIGRlZmF1bHRzIHRvIGVuZ2xpc2guXG4gICAgY29uc3QgbGFuZyA9ICgoY2xvc2VzdEVsZW1lbnQgPT09IG51bGwgfHwgY2xvc2VzdEVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsb3Nlc3RFbGVtZW50LmxhbmcpIHx8IChuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8IFwiZW5cIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGFuZ3VhZ2VNYXAuaGFzKGxhbmcpKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBcInJ1LVJVXCIgbWFwcyB0byBcInJ1XCIgdXNlIGNhc2VcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nLnNsaWNlKDAsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2VJbnRsKGVsZW1lbnQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvLyBpdCdzIE9LIGlmIHdlIGRvbid0IGhhdmUgdGhlIDQgbGV0dGVyIGxhbmd1YWdlIGZpbGUgZm9yIGl0XG4gICAgLy8gNCBsZXR0ZXIgbGFuZ3VhZ2UgY29kZSBuZWVkZWQgZm9yIGZvcm1hdHRpbmcgbnVtYmVyc1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nLnNsaWNlKDAsIDIpKSkge1xuICAgICAgICAgICAgLy8gd2Ugc3VwcG9ydCB0aGUgMiBsZXR0ZXIgY29kZWQgbGFuZ3VhZ2VcbiAgICAgICAgICAgIC8vIGUuZy4gaXQtQ0ggdnMgaXRcbiAgICAgICAgICAgIHJldHVybiBsYW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBmZXRjaChnZXRBc3NldFBhdGgoYC4uL2FyY2dpcy1hcHAtYXNzZXRzL2kxOG4vJHtjb21wb25lbnROYW1lfS5pMThuLiR7bG9jYWxlfS5qc29uYCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5vaylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5qc29uKCkpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICB9LCAoKSA9PiByZWplY3QoKSk7XG4gICAgfSk7XG59XG5jb25zdCBzdHJpbmdDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGxvY2FsZSkge1xuICAgIGNvbnN0IGlkID0gYCR7Y29tcG9uZW50TmFtZX0ke2xvY2FsZX1gO1xuICAgIGlmICghc3RyaW5nQ2FjaGVbaWRdKSB7XG4gICAgICAgIHN0cmluZ0NhY2hlW2lkXSA9IGZldGNoTG9jYWxlU3RyaW5nc0ZvckNvbXBvbmVudChjb21wb25lbnROYW1lLCBsb2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nQ2FjaGVbaWRdO1xufVxuLyoqXG4gKiBHZXQgc3RyaW5ncyBhbmQgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGlzIG1ldGhvZCByZXR1cm5zIDIgbGFuZ3VhZ2UgY29kZXMuXG4gKiBUaGUgZmlyc3Qgb25lIHJldHVybnMgYSBjb2RlIHRoYXQncyBhbHNvIHN1cHBvcnRlZCBhcyBhIGxhbmd1YWdlIGZpbGUuXG4gKiBUaGUgc2Vjb25kIG9uZSByZXR1cm5zIGEgY29kZSB3aGVyZSB0aGVyZSBpcyBzdXBwb3J0IGZvciB0aGUgZmlyc3QgMiBsZXR0ZXJzIG9mIHRoZSBjb2RlIGFzIHBhcnQgb2YgYSBsYW5ndWFnZSBmaWxlLFxuICogYnV0IHdpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCA0IGxldHRlciBjb2RlIGZyb20gdGhlIHBhZ2UuXG4gKiBFLmcuIEZvciBcIml0LWNoXCIgaXQgd2lsbCByZXR1cm4gXCJpdFwiIGFzIHRoZSBmaXJzdCBsYW5ndWFnZSBjb2RlIGFuZCBcIml0LWNoXCIgYXMgdGhlIHNlY29uZC5cbiAqIFRoZSBzZWNvbmQgb25lIGlzIHJlcXVpcmVkIGZvciBlc3JpLmludGwuc2V0TG9jYWxlKCkgdG8gZ2V0IHRoZSBjb3JyZWN0IGZvcm1hdHRpbmcuXG4gKlxuICogSWYgYSB0YWdOYW1lIGlzIHByb3ZpZGVkIGl0IHdpbGwgb3ZlcndpdGUgdGhlIGVsZW1lbnQncyB0YWdOYW1lXG4gKlxuICogIEByZXR1cm4gWyBzdHJpbmdzLCBmaXJzdCBsYW5ndWFnZSBjb2RlLCBzZWNvbmQgbGFuZ3VhZ2UgY29kZV1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyhlbGVtZW50LCB0YWdOYW1lKSB7XG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IHRhZ05hbWUgfHwgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2UgPSBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCk7XG4gICAgY29uc3QgY29tcG9uZW50TGFuZ3VhZ2VJbnRsID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KTtcbiAgICBsZXQgc3RyaW5ncztcbiAgICB0cnkge1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudExhbmd1YWdlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBubyBsb2NhbGUgZm9yICR7Y29tcG9uZW50TmFtZX0gKCR7Y29tcG9uZW50TGFuZ3VhZ2V9KSBsb2FkaW5nIGRlZmF1bHQgbG9jYWxlIGVuLmApO1xuICAgICAgICBzdHJpbmdzID0gYXdhaXQgZmV0Y2hMb2NhbGVTdHJpbmdzRnJvbUNhY2hlKGNvbXBvbmVudE5hbWUsIFwiZW5cIik7XG4gICAgfVxuICAgIHJldHVybiBbc3RyaW5ncywgY29tcG9uZW50TGFuZ3VhZ2UsIGNvbXBvbmVudExhbmd1YWdlSW50bF07XG59XG5cbmV4cG9ydCB7IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZSBhcyBhLCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9jYWxlLTA1MGI2ZGI5LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==