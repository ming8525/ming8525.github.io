/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3195c3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3195c3"],{4758:(e,i,s)=>{s.r(i),s.d(i,{arcgis_smart_mapping_panels_relationship:()=>d,arcgis_smart_mapping_relationship_color_slider:()=>u,arcgis_smart_mapping_relationship_legend:()=>m});var t=s(81149),a=s(9225),l=s(5996),r=(s(69283),s(49306),s(67214)),n=s(51837),o=s(41267),h=s(74537);s(82218),s(42577),s(70464),s(10519);const d=class{constructor(e){(0,t.r)(this,e),this.arcgisSmartMappingPanelsRelationshipClose=(0,t.c)(this,"arcgisSmartMappingPanelsRelationshipClose",7),this.arcgisSmartMappingPanelsRelationshipBackClick=(0,t.c)(this,"arcgisSmartMappingPanelsRelationshipBackClick",7),this.arcgisSmartMappingPanelsRelationshipError=(0,t.c)(this,"arcgisSmartMappingPanelsRelationshipError",7),this.colorSliderNodes=[],this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:i}=a.s,s=(0,a.h)(e);this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){}render(){var e;const{layer:i,hideLayerTitle:s,isRTL:l,mapImageSublayer:r,strings:o}=a.s,h=s?void 0:null!==(e=null==r?void 0:r.title)&&void 0!==e?e:i.title;return(0,t.h)(t.H,{class:"calcite-match-height"},(0,t.h)("calcite-flow-item",{heading:o.panels.styleOptions,description:h,class:{"flow-item":!0,[n.C.rtl]:l},closable:(0,a.aa)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:()=>this.handleDone(),onCalciteFlowItemBack:()=>{this.arcgisSmartMappingPanelsRelationshipBackClick.emit()},ref:e=>{e&&(this.flowItemNode=e)}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderLegend(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=a.s;return(0,t.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.handleDone(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,t.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>this.handleCancel(),appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{visualizationOpen:e,hideTransparency:i,hideRotation:s}=this,{strings:l}=a.s;return(0,t.h)("calcite-block",{class:"relationship-block",heading:l.panels.relationship.relationshipStyle,collapsible:!i||!s,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderSymbol(),this.renderGridSize(),this.renderMethod(),this.renderField1(),this.renderField2(),this.renderBackgroundStyle(),this.renderDefaultSymbol())}renderSymbol(){const{layer:e,mapView:i,modules:s}=a.s,l=(0,a.h)(e).uniqueValueInfos;if(!l.length)return null;const r=s.relationshipSchemes.getSchemes({basemap:i.map.basemap,geometryType:(0,a.D)(e)}),n=(0,a.a9)(r,Math.min(l.length,10))[0].colors;let o=((null==l?void 0:l.length)?l.filter(((e,i)=>i<10)).map(((e,i)=>(0,a.t)(e.symbol)||new s.esriColor(n[i%n.length]))):[]).reverse();return(0,t.h)("arcgis-smart-mapping-symbol-button",{colors:o,type:"relationship-ramp",rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,t.f)(this.hostElement),this.colorSliderNodes[0]&&(0,t.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,t.f)(this.colorSliderNodes[1]),(0,t.f)(this.legendNode),this.rotationNode&&(0,t.f)(this.rotationNode)}})}renderGridSize(){const{layer:e,strings:i}=a.s,s=(0,a.h)(e).authoringInfo.numClasses;return(0,t.h)("calcite-label",null,i.panels.relationship.gridSize,(0,t.h)("calcite-select",{label:i.panels.relationship.gridSize,onCalciteSelectChange:e=>{const i=e.target;this.handleGridSizeChange(parseFloat(i.value))}},(0,t.h)("calcite-option",{value:"2",selected:2===s},i.panels.relationship.gridsize2),(0,t.h)("calcite-option",{value:"3",selected:3===s},i.panels.relationship.gridsize3),(0,t.h)("calcite-option",{value:"4",selected:4===s},i.panels.relationship.gridsize4)))}renderMethod(){const{layer:e}=a.s,i=(0,a.g)();return(0,t.h)("arcgis-smart-mapping-method-button",{onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,a.E)(),onArcgisSmartMappingMethodButtonChange:s=>{const n=s.target,o=(0,a.h)(e);"manual"===s.detail?(o.authoringInfo.classificationMethod="manual",(0,a.ab)(),(0,t.f)(this.hostElement)):(0,l.r)((0,r.a)({classificationMethod:s.detail}),this.flowItemNode).then((s=>{if(["relationship-size"].indexOf(i)>-1){const e=(0,a.a)(o,"size");s.renderer.visualVariables=s.renderer.visualVariables||[],s.renderer.visualVariables.push(e);const i=(0,a.p)(o,"size");s.renderer.authoringInfo=s.renderer.authoringInfo||{},s.renderer.authoringInfo.visualVariables=s.renderer.authoringInfo.visualVariables||[],s.renderer.authoringInfo.visualVariables.push(i)}(0,a.e)(s.renderer,e),(0,a.ab)(),(0,t.f)(this.hostElement),(0,t.f)(n)}),(e=>{(0,t.f)(n),this.arcgisSmartMappingPanelsRelationshipError.emit(e)}))},ref:e=>this.methodButtonNode=e})}renderField1(){const{layer:e}=a.s,i=(0,a.h)(e).authoringInfo.field1,s=(0,a.u)(i.field),l=s.layerField.alias||s.layerField.name;return(0,t.h)("calcite-block-section",{text:l},(0,t.h)("div",{class:"block-section-padding"},this.renderDividedBy(0),this.renderColorSlider(0)))}renderField2(){const{layer:e}=a.s,i=(0,a.h)(e).authoringInfo.field2,s=(0,a.u)(i.field),l=s.layerField.alias||s.layerField.name;return(0,t.h)("calcite-block-section",{text:l},(0,t.h)("div",{class:"block-section-padding"},this.renderDividedBy(1),this.renderColorSlider(1)))}renderDividedBy(e){const{layer:i}=a.s,s=(0,a.h)(i).authoringInfo,l=(0===e?s.field1:s.field2).normalizationField;return(0,t.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"relationship",fieldPos:e,normalizationField:l,onArcgisSmartMappingDividedByChange:()=>{(0,t.f)(this.hostElement),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}})}renderColorSlider(e){return(0,t.h)("arcgis-smart-mapping-relationship-color-slider",{fieldPos:e,ref:i=>this.colorSliderNodes[e]=i,onArcgisSmartMappingRelationshipColorSliderChange:()=>this.methodButtonNode&&(0,t.f)(this.methodButtonNode)})}renderBackgroundStyle(){const{layer:e}=a.s;return(0,a.q)(e)&&"relationship-size"===(0,a.g)()?(0,t.h)("arcgis-smart-mapping-background-symbol",null):null}renderDefaultSymbol(){return(0,t.h)("arcgis-smart-mapping-default-symbol",null)}renderLegend(){return(0,t.h)("arcgis-smart-mapping-relationship-legend",{onArcgisSmartMappingRelationshipLegendFocusChange:()=>{(0,t.f)(this.hostElement)},ref:e=>this.legendNode=e})}renderTransparency(){const{hideTransparency:e}=this;if(e)return;const{layer:i}=a.s,s=(0,a.h)(i),l=(0,a.a)(s,"opacity");return(0,t.h)("arcgis-smart-mapping-transparency",{open:!!l,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}renderRotation(){if(this.hideRotation)return;const{layer:e}=a.s,i=(0,a.h)(e),s=(0,a.a)(i,"opacity"),l=(0,a.a)(i,"rotation");return(0,t.h)("arcgis-smart-mapping-rotation",{open:!s&&!!l,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:i}=this;(0,a.j)(e,i),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){const{layer:i}=a.s;(0,a.E)(),(0,l.r)((0,r.a)({numClasses:e}),this.flowItemNode).then((e=>{if("relationship-size"===(0,a.g)()){const s=(0,a.h)(i),t=(0,a.a)(s,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(t);const l=(0,a.p)(s,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(l)}(0,a.e)(e.renderer,i),(0,a.ab)(),(0,t.f)(this.hostElement),this.colorSliderNodes[0]&&(0,t.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,t.f)(this.colorSliderNodes[1])}))}get hostElement(){return(0,t.d)(this)}};d.style=":host{width:100%}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}";const u=class{constructor(e){(0,t.r)(this,e),this.arcgisSmartMappingRelationshipColorSliderChange=(0,t.c)(this,"arcgisSmartMappingRelationshipColorSliderChange",7),this.arcgisSmartMappingRelationshipColorSliderError=(0,t.c)(this,"arcgisSmartMappingRelationshipColorSliderError",7),this.currentBreakValues=[],this.fieldPos=void 0,this.histogramStatus=a.b.MISSING,this.statisticsStatus=a.b.MISSING}async updateStatistics(){var e;this.statisticsStatus=a.b.MISSING,this.statistics=null,this.histogramStatus=a.b.MISSING,this.histogram=null,null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSlider=void 0,this.getStatistics()}componentWillLoad(){this.flowItemNode=(0,a.F)(this.hostElement,"calcite-flow-item"),this.getStatistics()}componentDidLoad(){const{config:e}=a.s;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`)}render(){var e;const{statisticsStatus:i}=this,{layer:s,strings:l}=a.s,r=(0,a.h)(s).authoringInfo;if(i!==a.b.FAILED&&i!==a.b.MISSING){if(this.statisticsStatus===a.b.IN_PROGRESS||this.histogramStatus===a.b.IN_PROGRESS&&!this.colorSlider)return this.renderColorSliderLoading();{const e=this.prepareColorSlider(),i=0===this.fieldPos?r.field1.classBreakInfos:r.field2.classBreakInfos;return this.currentBreakValues=i.map((e=>({min:e.minValue,max:e.maxValue}))),e||this.colorSlider?(0,t.h)("div",{class:"slider-box"},(0,t.h)("calcite-label",null,l.panels.relationship.dataRange),(0,t.h)("div",{ref:e=>{e&&this.afterColorSliderCreate(e)}})):this.renderColorSliderLoading()}}null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSlider=void 0}renderColorSliderLoading(){const{strings:e}=a.s;return(0,t.h)("div",{class:"slider-box"},(0,t.h)("calcite-loader",{label:e.loading}))}afterColorSliderCreate(e){if(!this.colorSlider.container){const i=document.createElement("div");e.appendChild(i),this.colorSlider.container=i}}createColorSliderChangeEvents(){this.colorSlider&&(this.colorSlider.on("min-change",(e=>{e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.colorSlider.slider.max):this.onMinMaxChange(e.value,this.colorSlider.slider.max)})),this.colorSlider.on("max-change",(e=>{e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.colorSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min):this.onMinMaxChange(this.colorSlider.slider.min,e.value)})),this.colorSlider.on("thumb-change",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("thumb-drag",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})))}getClassBreaksColors(){const{layer:e,modules:i}=a.s,s=(0,a.h)(e),t=s.authoringInfo,l=(0===this.fieldPos?t.field1.classBreakInfos:t.field2.classBreakInfos).map((e=>({min:e.minValue,max:e.maxValue})));let r=new i.esriColor([0,0,0,1]),n=new i.esriColor([0,0,0,1]);s.uniqueValueGroups[0].classes.forEach((e=>{"HH"===e.values[0].value?r=(0,a.t)(e.symbol):"LL"===e.values[0].value&&(n=(0,a.t)(e.symbol))}));let o=(r.r+r.g+r.b)/3;const h=(n.r+n.g+n.b)/3;if(2===l.length)l[1].color=new i.esriColor([o,o,o,1]),l[0].color=new i.esriColor([h,h,h,1]);else if(3===l.length)l[2].color=new i.esriColor([o,o,o,1]),o=(o+h)/2,l[1].color=new i.esriColor([o,o,o,1]),l[0].color=new i.esriColor([h,h,h,1]);else{l[3].color=new i.esriColor([o,o,o,1]);let e=o+(h-o)/3;l[2].color=new i.esriColor([e,e,e,1]),e=o+2*(h-o)/3,l[1].color=new i.esriColor([e,e,e,1]),l[0].color=new i.esriColor([h,h,h,1])}return l}getHistogram(e,i,s,t,l){var r;const{layer:n,mapView:o,modules:h}=a.s,d=n;(s=s||this.statistics)&&0!==s.count&&(this.histogramStatus=a.b.IN_PROGRESS,h.histogram({layer:d,view:o,field:e.field,numBins:50,minValue:null!=t?t:s.min,maxValue:null!=l?l:s.max,normalizationField:i,forBinning:"featureReduction"in d&&"binning"===(null===(r=d.featureReduction)||void 0===r?void 0:r.type)}).then((e=>{this.histogram=e,this.histogramStatus=a.b.SUCCESS}),(e=>{console.log("error-histogram",e),this.histogramStatus=a.b.FAILED})))}getStatistics(){var e;const{layer:i,mapView:s,modules:t}=a.s,l=i,r=(0,a.h)(l).authoringInfo,n=0===this.fieldPos?r.field1:r.field2,o=n.classBreakInfos;if(!o||this.statistics)return;const h={field:n.field,simpleFieldType:a.w.NUMBER},d=n.normalizationField;let u=o[0].minValue,c=o[o.length-1].maxValue;this.statisticsStatus=a.b.IN_PROGRESS,t.summaryStatistics({layer:l,view:s,field:n.field,normalizationField:d,forBinning:"featureReduction"in l&&"binning"===(null===(e=l.featureReduction)||void 0===e?void 0:e.type)}).then((e=>{if(0===e.count)e.min=0,e.max=100,e.avg=(c+u)/2;else if(!(0,a.ac)(e.avg)||!(0,a.ac)(e.min)||!(0,a.ac)(e.max))return void(this.statisticsStatus=a.b.FAILED);e=(0,a.ad)(e),u=null!=u?u:e.min,c=null!=c?c:e.max,this.statistics=e,this.statisticsStatus=a.b.SUCCESS,this.getHistogram(h,d,e,u,c)}),(e=>{console.log("error-summaryStatistics",e),this.statisticsStatus=a.b.FAILED}))}onMinMaxChange(e,i){const{statistics:s}=this,{layer:t}=a.s,n=(0,a.h)(t),o=n.authoringInfo,d=0===this.fieldPos?o.field1:o.field2,u=d.normalizationField,c={field:d.field,simpleFieldType:a.w.NUMBER},m=0===this.fieldPos?o.field1.classBreakInfos:o.field2.classBreakInfos;m[0].minValue=e,m[m.length-1].maxValue=i,(0,l.r)((0,r.u)(),this.flowItemNode).then((l=>{(0,a.e)(l,t),(0,a.ab)(),this.getHistogram(c,u,s,e,i),(0,h.u)(this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),n.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingRelationshipColorSliderChange.emit()}prepareColorSlider(){var e,i;const{statistics:s,histogram:t,histogramStatus:l}=this,{layer:r,modules:n}=a.s,d=(0,a.h)(r).authoringInfo,u=0===this.fieldPos?d.field1.classBreakInfos:d.field2.classBreakInfos;if(!u||l===a.b.IN_PROGRESS)return!1;let c=u[0].minValue,m=u[u.length-1].maxValue;if(({min:c,max:m}=(0,a.ad)({min:c,max:m})),this.colorSlider){const e=this.colorSlider;if("dragging"===(null===(i=e.slider)||void 0===i?void 0:i.state))return!0;const a={histogramConfig:{bins:null==t?void 0:t.bins,average:Math.round(10*s.avg)/10,standardDeviation:s.stddev,standardDeviationCount:1},min:null!=c?c:s.min,max:null!=m?m:s.max};a.breaks=this.getClassBreaksColors(),a.precision=(0,o.g)(a.breaks),a.histogramConfig.barCreatedFunction=t&&h.b.bind(this,a.breaks,t,this.colorSliderBars),(0,h.u)(e,this.colorSliderBars,a.breaks,t),this.colorSlider.set(a)}else{const i=this.getClassBreaksColors(),s={histogramConfig:{bins:null===(e=this.histogram)||void 0===e?void 0:e.bins,average:Math.round(10*this.statistics.avg)/10,standardDeviation:this.statistics.stddev,standardDeviationCount:1},min:null!=c?c:this.statistics.min,max:null!=m?m:this.statistics.max,breaks:i};this.colorSliderBars=[],s.precision=(0,o.g)(s.breaks),s.histogramConfig.barCreatedFunction=this.histogram&&h.b.bind(this,s.breaks,this.histogram,this.colorSliderBars),(0,h.u)(this.colorSlider,this.colorSliderBars,s.breaks,this.histogram),this.colorSlider=new n.ClassedColorSlider(s),this.createColorSliderChangeEvents()}return(0,a.ac)(this.colorSlider)}updateRendererBreaks(e){const{layer:i}=a.s,s=(0,a.h)(i).authoringInfo,t=0===this.fieldPos?s.field1:s.field2;s.classificationMethod="manual",t.classBreakInfos&&(t.classBreakInfos.forEach(((i,s)=>{i.minValue===e[s].min&&i.maxValue===e[s].max||(t.classBreakInfos[s].minValue=e[s].min,t.classBreakInfos[s].maxValue=e[s].max,this.currentBreakValues[s].min=e[s].min,this.currentBreakValues[s].max=e[s].max)})),(0,l.r)((0,r.u)(),this.flowItemNode).then((e=>{(0,a.e)(e,i),(0,a.ab)(),(0,h.u)(this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),this.arcgisSmartMappingRelationshipColorSliderChange.emit())}get hostElement(){return(0,t.d)(this)}};var c;u.style=".slider-box{height:310px;margin-top:6px}.esri-classed-color-slider{min-width:200px}.esri-classed-color-slider__histogram-container{width:70px}.esri-classed-color-slider .esri-slider .esri-slider__content{height:200px}.esri-classed-color-slider .esri-slider .esri-slider__label,.esri-classed-color-slider .esri-slider .esri-slider__min,.esri-classed-color-slider .esri-slider .esri-slider__max{text-decoration:underline}.esri-classed-color-slider .esri-slider .esri-slider__label:hover,.esri-classed-color-slider .esri-slider .esri-slider__min:hover,.esri-classed-color-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}",function(e){e.focusUp16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L5.93,3.78 L8,5.85 L10.07,3.78 L14.29,8 L8,14.29 L1.71,8 Z",e.focusRight16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L8,1.71 L12.22,5.93 L10.15,8 L12.22,10.07 L8,14.29 L1.71,8 Z",e.focusLeft16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M3.78,10.07 L5.85,8 L3.78,5.93 L8,1.71 L14.29,8 L8,14.29 L3.78,10.07 Z",e.focusDown16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M8,1.71 L14.29,8 L10.07,12.22 L8,10.15 L5.93,12.22 L1.71,8 L8,1.71 Z",e.code16="M6.865 13.965l-.957-.29 3.213-10.62.957.29zM15.19 8.45l-3.837-3.805-.704.71 3.131 3.104-3.135 3.19.712.702zm-9.833 3.2L2.221 8.458l3.13-3.104-.703-.71L.811 8.45l3.833 3.9z",e.fields16="M10.578 1A2.425 2.425 0 0 1 13 3.422V6c0 .552.448 1 1 1v1c-.552 0-1 .448-1 1v2.578A2.425 2.425 0 0 1 10.578 14H10v-1h.578c.785 0 1.421-.637 1.422-1.422V9c0-.574.247-1.121.679-1.5A1.995 1.995 0 0 1 12 6V3.422c0-.785-.637-1.421-1.422-1.422H10V1h.578zM6 1v1h-.578C4.637 2 4.001 2.637 4 3.422V6c0 .574-.247 1.121-.679 1.5.432.379.68.926.679 1.5v2.578c0 .785.637 1.421 1.422 1.422H6v1h-.578A2.425 2.425 0 0 1 3 11.578V9c0-.552-.448-1-1-1V7c.552 0 1-.448 1-1V3.422A2.425 2.425 0 0 1 5.422 1H6z"}(c||(c={}));const m=class{constructor(e){(0,t.r)(this,e),this.arcgisSmartMappingRelationshipLegendFocusChange=(0,t.c)(this,"arcgisSmartMappingRelationshipLegendFocusChange",7),this.arcgisSmartMappingRelationshipLegendError=(0,t.c)(this,"arcgisSmartMappingRelationshipLegendError",7),this.valueTextNodes=[]}componentWillLoad(){this.flowItemNode=(0,a.F)(this.hostElement,"calcite-flow-item")}render(){const{strings:e}=a.s;return(0,t.h)("calcite-block",{open:!0,heading:e.relationshipLegend.legend,collapsible:!0},this.renderContent())}renderContent(){return(0,t.h)("div",null,(0,t.h)("div",{class:"attributes"},this.renderAttribute(0),this.renderAttribute(1)),this.renderFocus(),this.renderLabels())}renderAttribute(e){const{layer:i}=a.s,s=(0,a.h)(i).authoringInfo,l=0===e?s.field1:s.field2,r=(0,a.u)(l.field);let n=this.getColorOrder(e);return(0,t.h)("div",{class:"attribute"},(0,t.h)("div",{class:"attribute-color-icon","aria-hidden":"true"},n.map(((e,i)=>this.getSwatch(n[i])))),(0,t.h)("div",{class:"attribute-name"},r.label))}renderFocus(){return(0,t.h)("arcgis-smart-mapping-relationship-focus-button",{flowItemNode:this.flowItemNode,onArcgisSmartMappingRelationshipFocusButtonBeforeOpen:()=>(0,a.E)(),onArcgisSmartMappingRelationshipFocusButtonChange:()=>{this.arcgisSmartMappingRelationshipLegendFocusChange.emit(),(0,t.f)(this.hostElement)},onArcgisSmartMappingRelationshipFocusButtonError:({detail:e})=>this.arcgisSmartMappingRelationshipLegendError.emit(e)})}renderLabels(){const{layer:e,strings:i}=a.s,s=(0,a.h)(e).authoringInfo.numClasses;return(0,t.h)("calcite-label",null,i.relationshipLegend.labels,(0,t.h)("calcite-list",null,this.renderLabel(0),this.renderLabel(s-1),this.renderLabel(s*s-s),this.renderLabel(s*s-1)))}renderLabel(e){const{layer:i}=a.s,s=(0,a.h)(i).authoringInfo,l=s.numClasses,r=s.focus,n=0===e?c.focusUp16:e===("LH"===r||"HL"===r?l*l-l:l-1)?c.focusLeft16:e===("LH"===r||"HL"===r?l-1:l*l-l)?c.focusRight16:c.focusDown16;return(0,t.h)("calcite-list-item",null,this.renderIconNode(n),this.renderTextNode(e))}renderIconNode(e){const{layer:i}=a.s,s=!(0,a.h)(i).authoringInfo.focus;return(0,t.h)("div",{slot:"actions-start",class:"label-icon"},(0,t.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16",class:s?"rotate-45":""},(0,t.h)("path",{d:e})))}renderTextNode(e){const{layer:i,strings:s}=a.s,l=(0,a.h)(i),r=l.authoringInfo,n=r.numClasses,o=r.focus,h=l.uniqueValueInfos[e],d=0===e?s.relationshipLegend.accessibility.editLabelForTop:e===("LH"===o||"HL"===o?n*n-n:n-1)?s.relationshipLegend.accessibility.editLabelForLeft:e===("LH"===o||"HL"===o?n-1:n*n-n)?s.relationshipLegend.accessibility.editLabelForRight:s.relationshipLegend.accessibility.editLabelForBottom;return this.selectedLabelText===e?(0,t.h)("calcite-input",{slot:"content",scale:"s",value:h.label,onFocusout:i=>{const s=i.target;this.handleLabelTextChange(e,s.value)},onKeyUp:i=>{if("Escape"===i.key||"Enter"===i.key){const s=i.target;this.handleLabelTextChange(e,s.value)}},ref:e=>null==e?void 0:e.setFocus()}):(0,t.h)("div",{class:"label",slot:"content",tabIndex:0,"aria-label":d,onClick:()=>this.handleLabelTextClick(e),onKeyUp:i=>{" "!==i.key&&"Enter"!==i.key||this.handleLabelTextClick(e)},ref:i=>this.valueTextNodes[e]=i},h.label)}getColorOrder(e){const{layer:i}=a.s,s=(0,a.h)(i).authoringInfo||{};let t=[];if(2===s.numClasses)switch(s.focus){case"HH":default:t=0===e?[3,1]:[3,2];break;case"HL":t=0===e?[2,0]:[2,3];break;case"LH":t=0===e?[1,3]:[1,0];break;case"LL":t=0===e?[0,2]:[0,1]}else if(3===s.numClasses)switch(s.focus){case"HH":default:t=0===e?[8,5,2]:[8,7,6];break;case"HL":t=0===e?[6,3,0]:[6,7,8];break;case"LH":t=0===e?[2,5,8]:[2,1,0];break;case"LL":t=0===e?[0,3,6]:[0,1,2]}else switch(s.focus){case"HH":default:t=0===e?[15,11,7,3]:[15,14,13,12];break;case"HL":t=0===e?[12,8,4,0]:[12,13,14,15];break;case"LH":t=0===e?[3,7,11,15]:[3,2,1,0];break;case"LL":t=0===e?[0,4,8,12]:[0,1,2,3]}return t}getSwatch(e){const{layer:i}=a.s,s=(0,a.h)(i);return(0,t.h)("div",{class:"attribute-color-icon-selection",ref:i=>{if(i){const t=(0,a.t)(s.uniqueValueInfos[e].symbol);i.style.width=100/s.authoringInfo.numClasses+"px",i.style.backgroundColor=(null==t?void 0:t.toHex())||"#ffffff"}}})}handleLabelTextClick(e){this.selectedLabelText=e,(0,t.f)(this.hostElement)}handleLabelTextChange(e,i){const{layer:s}=a.s;(0,a.h)(s).uniqueValueGroups[0].classes[e].label=i,this.selectedLabelText=void 0,(0,a.ab)(),(0,t.f)(this.hostElement),setTimeout((()=>{var i;return null===(i=this.valueTextNodes[e])||void 0===i?void 0:i.focus()}),300)}get hostElement(){return(0,t.d)(this)}};m.style=".attribute{display:flex;padding-bottom:6px}.attributes{margin:12px 0}.attribute-name{padding:0 10px;width:calc(100% - 45px);word-break:break-all}.attribute-color-icon{width:45px;height:16px;overflow:hidden;border-radius:3px;display:flex;align-self:center}.attribute-color-icon-selection{height:16px;display:inline-block}.label{display:flex;padding:6px 0;align-items:center}.label div{display:flex}.label-icon{color:rgba(50, 50, 50, 0.4);display:flex;flex-direction:column;justify-content:center;cursor:default}.label-icon .rotate-45{transform:rotate(45deg)}"},5996:(e,i,s)=>{let t,a;function l(e){e.loading=!1}function r(e,i){return function(e){e.loading=!0,a=!1,t&&clearTimeout(t),t=setTimeout((()=>{l(e),a=!0}),6e4)}(i),e.then((e=>(l(i),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(i),Promise.reject(e))))}s.d(i,{r:()=>r})},41267:(e,i,s)=>{s.d(i,{a:()=>n,b:()=>r,g:()=>u,u:()=>l});var t=s(9225),a=(s(69283),s(10519));function l(e){const{layer:i,modules:s}=t.s,l=(0,t.h)(i),r=s.esriLang.clone(l.classBreakInfos);l.classBreakInfos=[],r.forEach(((i,s)=>{i=function(e,i,s,l){if((0,a.i)(i))if(0===i);else if(i<1){const a=Math.round(1/i);e.minValue="first"===l?Math.floor(e.minValue/i)/a:Math.round(e.minValue/i)/a,e.maxValue="last"===l?Math.ceil(e.maxValue/i)/a:Math.round(e.maxValue/i)/a,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString(t.s.fullLocale,{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(t.s.fullLocale,{maximumSignificantDigits:15})}`}else e.minValue="first"===l?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===l?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=(s>0?"> ":"")+e.minValue.toLocaleString()+" - "+e.maxValue.toLocaleString();return e}(i,e,s,0===s?"first":s===r.length-1?"last":void 0),l.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function r(e){const{layer:i}=t.s,s=(0,t.h)(i).classBreakInfos;let a=e,l=1/0;s.forEach((e=>{a||(a=Math.max(o(e.minValue),o(e.maxValue))),l=Math.min(l,e.maxValue-e.minValue)}));const r=[];return l>1e7?(r.push(1e7),r.push(1e6),r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e6?(r.push(1e6),r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e5?(r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e4?(r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e3?(r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001)):l>100?(r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5)):l>10?(r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>1?(a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.1?(a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.01?(a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.001?(a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7)):l>1e-4?(a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7),a>8&&r.push(1e-8)):l>1e-5&&(a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7),a>8&&r.push(1e-8),a>9&&r.push(1e-9)),r}function n(){const{layer:e}=t.s,i=(0,t.h)(e);let s=1e10;return i.classBreakInfos.forEach((e=>{s=Math.min(s,h(e.minValue)),s=Math.min(s,h(e.maxValue))})),s}function o(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function h(e){let i=1e-8;for(;d(Math.round(e/i)*i)===e;)i*=10;return i/10}function d(e){return parseFloat(e.toPrecision(12))}function u(e){var i,s,t,l,r,n,h,u;let c=0;e.forEach((e=>{(0,a.i)(e.value)?c=Math.max(o(d(e.value)),c):((0,a.i)(e.minValue)&&(c=Math.max(o(d(e.minValue)),c)),(0,a.i)(e.maxValue)&&(c=Math.max(o(d(e.maxValue)),c)),(0,a.i)(e.min)&&(c=Math.max(o(d(e.min)),c)),(0,a.i)(e.max)&&(c=Math.max(o(d(e.max)),c)))})),c=Math.min(c,3);const m=e[0],p=e[e.length-1],f=Math.min(null!==(s=null!==(i=m.minValue)&&void 0!==i?i:m.min)&&void 0!==s?s:m.value,null!==(l=null!==(t=p.minValue)&&void 0!==t?t:p.min)&&void 0!==l?l:p.value),g=Math.max(null!==(n=null!==(r=m.maxValue)&&void 0!==r?r:m.max)&&void 0!==n?n:m.value,null!==(u=null!==(h=p.maxValue)&&void 0!==h?h:p.max)&&void 0!==u?u:p.value)-f;return g/e.length<2e-7?c=8:g/e.length<2e-6?c=7:g/e.length<2e-5?c=6:g/e.length<2e-4?c=5:g/e.length<.002?c=4:g/e.length<.02?c=3:g/e.length<.2?c=Math.max(c,2):g/e.length<2&&(c=Math.max(c,1)),Math.round(c)}},67214:(e,i,s)=>{s.d(i,{a:()=>r,c:()=>l,u:()=>n});var t=s(9225),a=(s(69283),s(10519));function l(e){var i,s;const{layer:l,mapImageSublayer:r,mapView:n,modules:o}=t.s,h=l,d=(0,t.g)();let u=e.relationshipScheme;if(!u&&["relationship","relationship-size"].indexOf(d)>-1&&(u=(0,t.a0)()),e=e||{},"relationship-size"===d){const s=(0,t.h)(h).clone(),a=s.authoringInfo;if(a&&(null===(i=e.fieldInfos)||void 0===i?void 0:i.length)>1&&e.fieldInfos[0].field==a.field1.field&&e.fieldInfos[1].field==a.field2.field){if(s.visualVariables=(0,t.n)(s,"size"),s.authoringInfo.visualVariables=(0,t.o)(s,"size"),(0,t.q)(h)){const e=(0,t.S)(h,n),i=s.uniqueValueInfos.slice();i.map((i=>{const s=(0,t.t)(i.symbol);i.symbol=e.clone(),(0,t.r)(i.symbol,s)})),s.uniqueValueInfos=i}return Promise.resolve({renderer:s})}}const c=(0,t.m)((0,t.h)(h)),m={layer:h,view:n,field1:{field:e.fieldInfos[0].field},field2:{field:e.fieldInfos[1].field},classificationMethod:"quantile",numClasses:3,focus:"HH",relationshipScheme:u,outlineOptimizationEnabled:!r&&(!(0,a.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!r&&(!(0,a.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(s=h.featureReduction)||void 0===s?void 0:s.type)};return o.RelationshipCreator.createRenderer(m).then((e=>((0,t.l)(c,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function r(e){var i;const{layer:s,mapImageSublayer:l,mapView:r,modules:n}=t.s,o=s;e=e||{};const h=(0,t.h)(o),d=(0,t.g)(),u=h.authoringInfo,c=(0,t.a)(h,"size");if(e.fieldInfos&&e.fieldInfos.length>1&&e.fieldInfos[0].field==u.field1.field&&e.normalizationField1===u.field1.normalizationField&&e.fieldInfos[1].field==u.field2.field&&e.normalizationField2===u.field2.normalizationField&&(delete e.fieldInfos,delete e.normalizationField1,delete e.normalizationField2,(0,t.R)(e)&&!c))return Promise.resolve({renderer:h.clone()});let m=e.relationshipScheme;!m&&["relationship","relationship-size"].indexOf(d)>-1&&(m=(0,t.a0)());const p=(0,t.m)(h);let f=e.fieldInfos?e.fieldInfos[0]:{field:u.field1.field,simpleFieldType:t.w.NUMBER},g=e.fieldInfos?e.fieldInfos[1]:{field:u.field2.field,simpleFieldType:t.w.NUMBER};const b=void 0!==e.normalizationField1?e.normalizationField1:u.field1.normalizationField,S=void 0!==e.normalizationField2?e.normalizationField2:u.field2.normalizationField,v=h.uniqueValueInfos&&h.uniqueValueInfos.length?h.uniqueValueInfos[0].symbol:null,C=h.defaultSymbol,y=h.defaultLabel,x=e.numClasses?e.numClasses:u.numClasses;return n.RelationshipCreator.createRenderer({layer:o,view:r,field1:{field:f?f.field:h.field,normalizationField:b},field2:{field:g?g.field:h.field,normalizationField:S},classificationMethod:e.classificationMethod?e.classificationMethod:"manual"!==u.classificationMethod?u.classificationMethod:"quantile",numClasses:x,focus:e.focus?e.focus:u.focus,relationshipScheme:m,outlineOptimizationEnabled:!l&&((0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!p.sizeOutlineVisVar),sizeOptimizationEnabled:!l&&((0,a.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!p.sizeAutoVisVar),legendOptions:e.legendOptions?e.legendOptions:h.legendOptions,defaultSymbolEnabled:(0,a.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!h.defaultSymbol,forBinning:"binning"===(null===(i=o.featureReduction)||void 0===i?void 0:i.type)}).then((i=>((0,t.l)(p,i.renderer),v&&i.renderer.uniqueValueInfos.forEach((e=>{const i=v.clone();(0,t.r)(i,(0,t.t)(e.symbol)),e.symbol=i})),e.numClasses&&e.numClasses!==u.numClasses||(0,t.h)(o).uniqueValueInfos.forEach((e=>{i.renderer.uniqueValueInfos.forEach((i=>{e.value===i.value&&(i.label=e.label)}))})),C&&(i.renderer.defaultSymbol=C,i.renderer.defaultLabel=y),Promise.resolve(i))),(e=>Promise.reject(e)))}function n(e){const{layer:i,modules:s}=t.s;e=e||{};const a=(0,t.h)(i),l=a.authoringInfo;return s.RelationshipCreator.updateRenderer({field1:l.field1,field2:l.field2,numClasses:e.numClasses?e.numClasses:l.numClasses,focus:e.focus?"none"===e.focus?null:e.focus:l.focus,colors:e.colors,renderer:a})}},74537:(e,i,s)=>{s.d(i,{b:()=>a,u:()=>l});var t=s(9225);function a(e,i,s,t,a){const l=(null==e?void 0:e.length)?n(e,i.bins[t]):r(e.stops,i.bins[t]);l&&a.setAttribute("fill",l.toHex()),l&&a.setAttribute("opacity",`${Math.max(l.a,.2)}`),s.push(a)}function l(e,i,s,t){null==i||i.forEach(((i,a)=>{const l=(t||e.histogramConfig).bins[a],o=e.breaks?n(s||e.breaks,l):r((s||e).stops,l);o&&i.setAttribute("fill",o.toHex()),o&&i.setAttribute("opacity",`${Math.max(o.a,.2)}`)}))}function r(e,i){const{modules:s}=t.s;if(!i)return;const a=(i.maxValue-i.minValue)/2+i.minValue;let l=e[0],r=e[e.length-1];const n=l.value,o=r.value;if(a<n)return l.color;if(a>o)return r.color;const h=e.filter((e=>e.value===a));if(h.length>0)return h[0].color;l=null,r=null,e.forEach(((i,s)=>{!l&&!r&&i.value>=a&&(l=e[s-1],r=i)}));const d=(a-l.value)/(r.value-l.value);return s.esriColor.blendColors(l.color,r.color,d)}function n(e,i){if(!i)return;const s=(i.maxValue-i.minValue)/2+i.minValue;let t=e[0],a=e[e.length-1];if(s<t.min||s>a.max)return;const l=e.filter((e=>e.min===s));return l.length>0?l[0].color:(t=e[e.length-1],a=null,e.forEach(((i,l)=>{!a&&i.min>=s&&(t=e[l-1],a=i)})),t.color)}s(69283),s(49306)}}]);