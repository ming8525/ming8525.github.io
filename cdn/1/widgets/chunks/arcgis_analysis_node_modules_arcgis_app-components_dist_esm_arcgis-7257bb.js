/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb"],{47481:(e,i,a)=>{a.r(i),a.d(i,{arcgis_smart_mapping_panels_gallery:()=>F});var s=a(81149),t=a(53868),l=a(9225),n=a(5996),r=(a(69283),a(49306)),o=a(51837),c=a(10519),d=a(7659),p=a(25902),m=a(98371),g=a(40630),u=a(70616),h=a(86478),f=a(21747),y=a(81555),z=a(67214),b=a(70490),v=a(80046);function S(e){var i;const{layer:a,mapView:s,modules:t}=l.s,n=a;return e=e||{},t.DotDensityCreator.createRenderer({layer:n,view:s,attributes:(0,c.i)(e.attributes)?e.attributes:(r=e.fieldInfos,r.map((e=>({field:e.field,label:E(e.field)})))),dotBlendingEnabled:!(0,c.i)(e.dotBlendingEnabled)||e.dotBlendingEnabled,dotValueOptimizationEnabled:!(0,c.i)(e.dotValueOptimizationEnabled)||e.dotValueOptimizationEnabled,outlineOptimizationEnabled:!(0,c.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled,legendOptions:e.legendOptions,forBinning:"binning"===(null===(i=n.featureReduction)||void 0===i?void 0:i.type)});var r}function E(e){const i=l.s.fields.filter((i=>i.layerField.name===e));return i.length?i[0].label:""}function I(e){const{layer:i}=l.s;e=e||{};const a=[],s=[];return a.push(e.fieldInfos[0]),a.push(e.fieldInfos[1]),s.push(e.fieldInfos[2]),function(e){const{layer:i}=l.s;if("relationship"===(0,l.g)()&&void 0===e.normalizationField1&&void 0===e.normalizationField2){const a=(0,l.h)(i).authoringInfo;if(e.fieldInfos&&e.fieldInfos.length>1&&e.fieldInfos[0].field==a.field1.field&&e.fieldInfos[1].field==a.field2.field)return!0}return!1}(e)?C((0,l.h)(i),s,e).then((e=>Promise.resolve({renderer:e})),(e=>Promise.reject(e))):(0,z.c)(Object.assign(Object.assign({},e),{fieldInfos:a})).then((i=>C(i.renderer,s,e).then((e=>(i.renderer=e,Promise.resolve(i))),(e=>Promise.reject(e)))),(e=>Promise.reject(e)))}function C(e,i,a){const{layer:s,modules:t}=l.s;return(0,m.c)(Object.assign(Object.assign({},a),{fieldInfos:i})).then((i=>{const a=i.renderer;e.visualVariables=(0,l.n)(e,"size")||[],e.visualVariables=(0,l.n)(e,"size","auto")||[];const n=(0,l.a)(a,"size");e.visualVariables.push(n),e.authoringInfo.visualVariables=(0,l.o)(e,"size")||[];const r=(0,l.p)(a,"size");if(e.authoringInfo.visualVariables.push(r),(0,l.q)(s)){let i=a.classBreakInfos[0].symbol;const s=[];e.uniqueValueInfos.forEach((e=>{s.push(t.esriLang.clone(e))})),s.forEach((i=>{e.removeUniqueValueInfo(i.value)})),s.forEach((a=>{const s=i.clone();(0,l.r)(s,(0,l.t)(a.symbol)),e.addUniqueValueInfo({value:a.value,symbol:s,label:a.label})})),e.backgroundFillSymbol=a.backgroundFillSymbol;const n=(0,l.a)(a,"size","outline");n&&e.visualVariables.push(n)}return Promise.resolve(e)}),(e=>Promise.reject(e)))}let T;function k(e){T&&clearTimeout(T),T=setTimeout((()=>{T=null,function(e){var i,a;const{selectedFields:s,layer:t,mapImageSublayer:n}=l.s,r="ogc-feature"===t.type,o="wfs"===t.type,b=null===(a=null===(i=t.capabilities)||void 0===i?void 0:i.query)||void 0===a?void 0:a.supportsSqlExpression,E=r||o||b,C=s.map((e=>(0,l.u)(e.field))),T=(0,l.f)(t),k=(0,l.g)();if(!(0,l.v)(s,T))if(0===s.length)e("heatmap"===k?(0,g.c)():(0,d.c)());else if(1===s.length){const i=C[0];if("heatmap"===k&&E&&!s[0].expression&&s[0].simpleFieldType===l.w.NUMBER)e((0,g.c)({fieldInfos:s}));else if("color-size"===k&&(0,l.x)(s[0],T[0]))e((0,p.c)({fieldInfos:s}));else if("type-size"===k&&(0,l.x)(s[0],T[0]))e((0,y.c)({fieldInfos:s}));else if(["color-size","type-size"].indexOf(k)>-1&&(0,l.x)(s[0],T[T.length>1?1:0]))e((0,m.c)({fieldInfos:s}));else if(s[0].expression)s[0].simpleFieldType===l.w.NUMBER?e((0,m.c)({fieldInfos:s})):s[0].simpleFieldType===l.w.DATE?e((0,p.c)({fieldInfos:s})):e((0,y.c)({fieldInfos:s}));else if(i.simpleFieldType===l.w.STRING||"string"===(0,l.y)(i)||"domain"in i.layerField&&i.layerField.domain)e((0,y.c)({fieldInfos:s}));else if(["integer","double","single","small-integer","big-integer"].indexOf((0,l.z)(i.layerField))>-1&&"objectIdField"in t&&t.objectIdField!==i.layerField.name)if((0,l.A)(t))"featureReduction"in t&&t.featureReduction?e((0,p.c)({fieldInfos:s})):e((0,m.c)({fieldInfos:s}));else if((0,l.B)(t))e((0,m.c)({fieldInfos:s}));else{const a=(0,l.y)(i);["integer","small-integer","big-integer"].indexOf((0,l.z)(i.layerField))>-1||(0,c.i)(a)&&"integer"===a?e((0,m.c)({fieldInfos:s})):e((0,p.c)({fieldInfos:s}))}else"date"===(0,l.z)(i.layerField)&&("color-age-size"===k&&(0,l.x)(s[0],T[0])?e((0,p.a)({fieldInfos:s})):["color-size-age","type-size-age"].indexOf(k)>-1&&(0,l.x)(s[0],T[1])?e((0,m.a)({fieldInfos:s})):e(n?(0,p.a)({fieldInfos:s}):(0,p.c)({fieldInfos:s})))}else if(2===s.length){const i=C[0];"type"!==k&&"type-size"!==k||!(0,l.x)(s[0],T[0])?s[0].expression?s[0].simpleFieldType===l.w.NUMBER&&s[1].simpleFieldType===l.w.NUMBER?e((0,m.b)({fieldInfos:s})):e((0,v.c)({fieldInfos:s})):s[0].simpleFieldType===l.w.STRING||"string"===(0,l.y)(i)||"domain"in i.layerField&&i.layerField.domain?s[1].simpleFieldType===l.w.DATE&&(["color-size-age","type-size-age"].indexOf(k)>-1||n)?e((0,v.a)({fieldInfos:s})):e((0,v.c)({fieldInfos:s})):s[0].simpleFieldType===l.w.DATE||s[1].simpleFieldType===l.w.DATE?s[0].simpleFieldType===l.w.DATE&&(["color-age","color-age-size"].indexOf(k)>-1||n)?e((0,m.d)({fieldInfos:s})):s[1].simpleFieldType===l.w.DATE&&(["color-size-age","type-size-age"].indexOf(k)>-1||n)?e((0,m.e)({fieldInfos:s})):e((0,m.b)({fieldInfos:s})):s[0].expression||s[1].expression?e((0,m.b)({fieldInfos:s})):"dot-density"===k?e(S({fieldInfos:s})):"predominance"===k?e((0,u.c)({fieldInfos:s})):"predominance-size"===k?e((0,u.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===k?e((0,h.c)({fieldInfos:s})):"chart-size"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!0})):"compare"===k?e((0,f.c)({fieldInfos:s})):["relationship","relationship-size"].indexOf(k)>-1?e((0,z.c)({fieldInfos:s})):e((0,m.b)({fieldInfos:s})):e((0,v.c)({fieldInfos:s}))}else 3===s.length&&(["relationship","relationship-size"].indexOf(k)>-1||s[2].expression||!E)?e(I({fieldInfos:s})):"dot-density"===k&&s.length<=8?e(S({fieldInfos:s})):"predominance-size"===k?e((0,u.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!1})):"chart-size"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!0})):n&&!E||s[2].simpleFieldType===l.w.DATE?e(I({fieldInfos:s})):e((0,u.c)({fieldInfos:s}))}(e)}),1e3)}a(82218),a(42577),a(70464);const F=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsGalleryClose=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClose",7),this.arcgisSmartMappingPanelsGalleryError=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryError",7),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClusterRequiresUpdate",7),this.tileNodes=[],this.lastSortBy=r.L.default,this.addExpression=async()=>{(0,l.E)();try{const e=await(0,t.u)();e.simpleFieldType===l.w.UNKNOWN&&(e.simpleFieldType=l.w.NUMBER);const{selectedFields:i,modules:a,strings:s}=l.s;if(2===i.length&&(null==e?void 0:e.simpleFieldType)===l.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===i.length&&i[0].simpleFieldType===l.w.STRING&&(null==e?void 0:e.simpleFieldType)===l.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const n=a.esriLang.clone(i);if(n.push(e),3===n.length)for(let e=0;e<3;e++){const i=n[e];if(i.simpleFieldType===l.w.DATE&&2!==e){n.splice(e,1),n.splice(2,0,i);break}}n.length>1&&n[1].simpleFieldType===l.w.STRING&&n.reverse(),l.s.selectedFields=n,k(this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleArcadeEdit=async e=>{(0,l.E)();try{const{selectedFields:i,strings:a}=l.s,n=await(0,t.u)(i[e]);if(n.simpleFieldType===l.w.UNKNOWN&&(n.simpleFieldType=l.w.NUMBER),0!==e&&(null==n?void 0:n.simpleFieldType)===l.w.STRING&&i[0].simpleFieldType===l.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:a.panels.gallery.errors.expressionMustBeNumber,type:"warning"});"string"===n.simpleFieldType?(i.splice(e,1),i.unshift(n),(0,s.f)(this.hostElement)):i[e]=n,l.s.selectedFields=i,k(this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleListOrderChange=e=>{const{selectedFields:i,modules:a}=l.s,s=[];e.target.querySelectorAll("calcite-list-item").forEach((e=>{s.push(a.esriLang.clone(i[parseInt(e.value)]))})),l.s.selectedFields=s,k(this.galleryRequestWrapper)},this.handleListChange=e=>{const{selectedFields:i}=l.s;i[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)},this.handleRemoveAttribute=e=>{this.modifyFieldPickList=!0;const{selectedFields:i}=l.s;l.s.selectedFields=null==i?void 0:i.filter(((i,a)=>a!==e)),k(this.galleryRequestWrapper)},this.handleSelectClick=e=>{!function(e,i){const{selectedFields:a}=l.s;switch(e){case"simple":l.s.selectedFields=[],i((0,d.c)());break;case"type":i((0,y.c)({fieldInfos:a}));break;case"color":i((0,p.c)({fieldInfos:a}));break;case"size":i((0,m.c)({fieldInfos:a}));break;case"color-age":i((0,p.a)({fieldInfos:a}));break;case"size-age":i((0,m.a)({fieldInfos:a}));break;case"dot-density":i(S({fieldInfos:a}));break;case"heatmap":i((0,g.c)({fieldInfos:a}));break;case"compare":i((0,f.c)({fieldInfos:a}));break;case"relationship":i((0,z.c)({fieldInfos:a}));break;case"relationship-size":i(I({fieldInfos:a}));break;case"predominance":i((0,u.c)({fieldInfos:a}));break;case"predominance-size":i((0,u.c)({fieldInfos:a,includeSizeVariable:!0}));break;case"chart":i((0,h.c)({fieldInfos:a}));break;case"chart-size":i((0,h.c)({fieldInfos:a,includeSizeVariable:!0}));break;case"type-size":i((0,v.c)({fieldInfos:a}));break;case"type-size-age":i((0,v.a)({fieldInfos:a}));break;case"color-size":1===a.length?i((0,b.c)({fieldInfos:a})):i((0,m.b)({fieldInfos:a}));break;case"color-age-size":i((0,m.d)({fieldInfos:a}));break;case"color-size-age":i((0,m.e)({fieldInfos:a}))}}(e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{const{flowNode:i}=this,{selectedFields:a}=l.s;switch(e){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()})),e.addEventListener("onArcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsDotDensityError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"color-size":case"color-age-size":case"color-size-age":if(a.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e)}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e)}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(()=>{i.removeChild(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),i.appendChild(e);break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:i}=this;(0,l.j)(e,i),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{strings:i}=l.s;(0,n.r)(e,this.flowItemNode).then((e=>{const{layer:i,mapImageSublayer:a}=l.s;(0,l.e)(e.renderer.clone(),i),a&&(a.renderer=e.renderer),(0,s.f)(this.hostElement),this.checkCluster(),this.checkClusterRenderer(),this.focusSelectedTile()}),(()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:i.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:i}=l.s,a=(0,l.h)(e);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0,this.flowNode=(0,l.F)(this.hostElement,"calcite-flow")}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}render(){var e,i,a;const{layer:t,hideLayerTitle:n,isRTL:r,strings:c}=l.s;let d=!1;if("featureReduction"in t&&"cluster"===(null===(e=t.featureReduction)||void 0===e?void 0:e.type)){const e=t.featureReduction;"pie-chart"!==(null===(i=e.renderer)||void 0===i?void 0:i.type)||(null===(a=e.renderer.authoringInfo)||void 0===a?void 0:a.isAutoGenerated)||(d=!0)}return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:c.panels.gallery.styles,description:n?void 0:t.title,class:{"flow-item":!0,[o.C.rtl]:r},closable:!0,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,ref:e=>this.flowItemNode=e},d?this.renderClusteringWarning():this.renderGalleryContent()))}renderGalleryContent(){return(0,s.h)(s.F,null,this.renderDoneButton(),this.renderCancelButton(),this.renderStepOne(),this.renderStepTwo())}renderClusteringWarning(){const{strings:e}=l.s;return(0,s.h)(s.F,null,(0,s.h)("div",null,(0,s.h)("calcite-tip",{closeDisabled:!0},(0,s.h)("div",null,e.panels.gallery.chartClusterMsg))),(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.done))}renderDoneButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.done,onClick:this.handleDone,appearance:"solid",width:"half"},i.done):null}renderCancelButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},i.cancel):null}renderStepOne(){const{layer:e,selectedFields:i,strings:a}=l.s,t=i.length,n=(0,l.C)().string>0,r=3===t&&i[2].expression,o=3===t&&i[2].simpleFieldType===l.w.DATE;let c=i.map(((e,i)=>this.renderAttribute(i)));const d=t>1&&!n&&!r&&!o;return(0,s.h)("div",{class:"attributes gallery-block"},(0,s.h)("div",null,(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",scale:"m",icon:"number-circle-1"})),(0,s.h)("div",{class:"attributes-header-text center"},a.panels.gallery.chooseAttributes)),!t&&(0,s.h)("div",{class:"attributes-msg center"},a.panels.gallery.chooseAttributesMsg),(0,s.h)("calcite-list",{class:c.length>0?"attribute-list":"",key:`gallery-attributes-selects-${i}`,dragEnabled:d,onCalciteListOrderChange:this.handleListOrderChange},c),e&&this.renderAddButtons(),e&&this.renderTip())}renderAttribute(e){const{selectedFields:i,strings:a}=l.s,t=i[e].field||i[e].expressionTitle,n=!!i[e].expression,r=(0,l.u)(i[e].field),o=r?r.label:i[e].expressionTitle,c=i[e].simpleFieldType,d=!n&&(c===l.w.NUMBER?"number":c===l.w.STRING?"date-only"===(0,l.z)(null==r?void 0:r.layerField)?"calendar":"string":c===l.w.DATE?"date-time":null);return(0,s.h)("calcite-list-item",{key:`gallery-attribute-${e}-${t}`,label:o,value:e,onClick:i=>i.target&&this.handleListChange(e),onKeyDown:i=>{" "===i.key&&(i.preventDefault(),this.handleListChange(e))}},d&&(0,s.h)("div",{slot:"actions-end"},(0,s.h)("calcite-icon",{scale:"s",icon:d,class:"field-type"})),(0,s.h)("calcite-action",{key:`gallery-attribute-${e}-${t}-remove`,slot:"actions-end",text:n?a.panels.gallery.removeExpression:a.panels.gallery.removeField,label:n?a.panels.gallery.removeExpression:a.panels.gallery.removeField,onClick:i=>{i.stopPropagation(),this.handleRemoveAttribute(e)},onKeyDown:i=>{"Enter"!==i.key&&" "!==i.key||(i.stopPropagation(),this.handleRemoveAttribute(e))}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderTip(){var e;const{selectedFields:i,portal:a,strings:t}=l.s;if(i.length>1)return;if(!i.length&&(0,l.G)(l.N.ARCGIS_COMPONENT_NOTIFICATIONS,l.M.SMART_MAPPING_TIP1_DISMISSED)||1===i.length&&(0,l.G)(l.N.ARCGIS_COMPONENT_NOTIFICATIONS,l.M.SMART_MAPPING_TIP2_DISMISSED))return null;const n=t.panels.gallery.tip1.indexOf("${smartMappingLink}"),r=(null===(e=a.helpMap)||void 0===e?void 0:e.m)||a.helpMap;return(0,s.h)("div",{key:"gallery-tip",class:"tip"},(0,s.h)("calcite-input-message",{key:"gallery-tip-message",icon:"lightbulb",class:"tip-message"},0===i.length&&a.helpBase&&r?(0,s.h)("div",{key:"gallery-tip-text"},(0,s.h)("span",{class:"tip-text"},t.panels.gallery.tip1.substring(0,n)),(0,s.h)("calcite-link",{target:"_blank",href:`${a.helpBase}${r[120003249]}`},t.panels.gallery.tip1Link),(0,s.h)("span",{class:"tip-text"},t.panels.gallery.tip1.substring(n+19))):0===i.length?(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},t.panels.gallery.tip1.replace("${smartMappingLink}",t.panels.gallery.tip1Link)," "):(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},t.panels.gallery.tip2)),(0,s.h)("calcite-action",{scale:"s",label:t.close,text:t.close,onClick:()=>{const{selectedFields:e}=l.s;e.length?(0,l.H)(l.N.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.M.SMART_MAPPING_TIP2_DISMISSED,value:"true"}):(0,l.H)(l.N.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.M.SMART_MAPPING_TIP1_DISMISSED,value:"true"}),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderAddButtons(){var e,i;const{layer:a,mapImageSublayer:t,selectedFields:n,strings:r,supportsArcade:o}=l.s,c=n.length,d=(0,l.I)(),p=(0,l.C)(),m=p.string>0,g=p.date>0,u=p.expression>0,h=null===(i=null===(e=a.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression;let f=!(t&&!o&&1===c||!(c<10)||2===c&&(m||u)||t&&2===c&&g||3===c&&(g||n[2].expression||!h));f=f&&(1===p.string&&p.number+p.date===0&&d.number+d.date>0||0===p.string&&p.date<2&&p.number+p.date<3&&p.string+p.number+p.date<d.string+d.number+d.date||p.number>=2&&p.number<d.number);const y=(!t||o)&&(c<2||2===c&&!u&&n[0].simpleFieldType===l.w.NUMBER&&n[1].simpleFieldType===l.w.NUMBER);return(0,s.h)("div",{class:"add-button-div"},(0,s.h)("div",{class:"add-buttons"},(0,s.h)("calcite-button",{disabled:!f,onClick:()=>this.openFieldPickList(),appearance:"outline-fill",kind:"neutral",width:"full",label:r.panels.gallery.addField,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addFieldButtonNode=e},r.panels.gallery.field),(0,s.h)("span",null,"  "),(0,s.h)("calcite-button",{disabled:!y,onClick:this.addExpression,appearance:"outline-fill",kind:"neutral",width:"full",label:r.panels.gallery.addExpression,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addExpressionButtonNode=e},r.expression)))}renderStepTwo(){const{selectedFields:e,strings:i}=l.s,a=function(){var e,i;const{layer:a,mapImageSublayer:s,selectedFields:t,supportsArcade:n}=l.s,r="ogc-feature"===a.type,o="wfs"===a.type,c="stream"===a.type,d="featureReduction"in a&&a.featureReduction,p=t.length,m=(0,l.C)(),g=m.string>0,u=m.date>0,h=m.expression>0,f=null===(i=null===(e=a.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression,y=r||o||c||f,z=[];return z.push("simple"),1!==p||g||s&&u||z.push("color"),1!==p||g||s&&u||z.push("size"),s&&!n||1!==p||!u||h||!y||z.push("color-age"),s&&!n||1!==p||!u||h||!y||z.push("size-age"),s&&!n||1!==p&&2!==p||g||s&&u||z.push("color-size"),s&&!n||2!==p||g||!u||t[0].simpleFieldType!==l.w.DATE||t[0].expression||!y||s&&m.date>1||z.push("color-age-size"),s&&!n||2!==p||g||!u||t[1].simpleFieldType!==l.w.DATE||t[1].expression||!y||s&&m.date>1||z.push("color-size-age"),(!s||n)&&p>0&&p<=8&&!h&&(0,l.q)(a)&&!g&&!u&&y&&z.push("dot-density"),(!s||n)&&p>1&&p<=10&&!h&&!g&&!u&&y&&z.push("predominance"),s&&!n||!(p>1)||h||g||u||!y||z.push("predominance-size"),!s&&!d&&p>1&&p<=10&&!h&&["polygon","point","multipoint"].indexOf((0,l.D)(a))>-1&&!g&&!u&&y&&z.push("chart"),!s&&!d&&p>1&&!h&&["polygon","point","multipoint"].indexOf((0,l.D)(a))>-1&&!g&&!u&&y&&z.push("chart-size"),s&&!n||2!==p||h||g||u||z.push("relationship"),s&&!n||3!==p||h&&(1!==m.expression||!t[2].expression)||s&&u||z.push("relationship-size"),s&&!n||2!==p||h||g||u||z.push("compare"),1!==p||s&&u||z.push("type"),s&&!n||2!==p||!(m.date<2)||s&&u||z.push("type-size"),(!s||n)&&2===p&&u&&m.date<2&&t[1].simpleFieldType===l.w.DATE&&t[1].field&&y&&z.push("type-size-age"),s&&!n||!(["point","multipoint"].indexOf((0,l.D)(a))>-1)||d||!(y&&p<=1||!y&&0===p)||g||u||0!==m.expression||z.push("heatmap"),z}(),t=function(){const{layer:e}=l.s,i=(0,l.g)(),a=(0,l.f)(e),s=a.length>0?a[0].simpleFieldType:null;let t=[];switch(i){case"simple":t=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":t=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":t=["color","size","color-age","size-age","color-size","dot-density"],t="string"===s||"date"===s?t.concat(["type","heatmap","simple"]):t.concat(["heatmap","simple","type"]),t=t.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":t=["color-age","color","size","size-age","color-size","dot-density"],t="string"===s||"date"===s?t.concat(["type","heatmap","simple"]):t.concat(["heatmap","simple","type"]),t=t.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":t=["size","size-age","color","color-age","color-size","dot-density"],t="string"===s||"date"===s?t.concat(["type","heatmap","simple"]):t.concat(["heatmap","simple","type"]),t=t.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":t=["size-age","size","color-age","color","color-size","dot-density"],t="string"===s||"date"===s?t.concat(["type","heatmap","simple"]):t.concat(["heatmap","simple","type"]),t=t.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":t=["heatmap","color","size","color-age","size-age","color-size","dot-density"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]),t=t.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":t=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]);break;case"chart":t=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]);break;case"dot-density":t=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]);break;case"compare":t=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(t=t.concat(["type"])),t=t.concat(["simple"]),s&&"string"===s||(t=t.concat(["type"]));break;case"relationship":t=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(t=t.concat(["type"])),t=t.concat(["simple"]),s&&"string"===s||(t=t.concat(["type"]));break;case"color-size":t=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":t=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":t=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":t=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":t=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":t=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]);break;case"chart-size":t=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],t="string"===s?t.concat(["type","simple"]):t.concat(["simple","type"]);break;case"relationship-size":t=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(t=t.concat(["type"])),t=t.concat(["simple"]),"string"!==s&&(t=t.concat(["type"]));break;default:t=["color","size","color-age","size-age","color-size"],"string"===s&&(t=t.concat(["type"])),t=t.concat(["heatmap","simple"]),"string"!==s&&(t=t.concat(["type"])),t=t.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return t}(),n=(null==e?void 0:e.length)?1===e.length&&e[0].field&&e[0].simpleFieldType===l.w.NUMBER?i.panels.gallery.styleMsg.oneNumber:2===e.length&&e[0].field&&e[1].field&&e[0].simpleFieldType===l.w.NUMBER&&e[1].simpleFieldType===l.w.NUMBER?i.panels.gallery.styleMsg.multipleNumber:i.panels.gallery.styleMsg.any:i.panels.gallery.styleMsg.empty;a.sort(((e,i)=>t.indexOf(e)-t.indexOf(i)));const r=a.map(((e,i)=>this.renderStyleTile(e,i)));return(0,s.h)("div",{class:"gallery-block"},(0,s.h)("div",{class:"attributes-header"},(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",scale:"m",icon:"number-circle-2"})),(0,s.h)("div",{class:"styles-msg-title center"},i.panels.gallery.pickStyle),(0,s.h)("div",{class:"styles-msg center"},n)),r)}renderStyleTile(e,i){const a=(0,l.g)(),t=(0,l.J)();return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${t}`,tileType:"gallery",type:e,selected:e===a,ref:e=>{e&&(this.tileNodes[i]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail)})}addField(e){const{selectedFields:i,modules:a}=l.s;(0,l.K)(e);const s=a.esriLang.clone(i);if(e.forEach((e=>{const i=(0,l.u)(e);i.simpleFieldType===l.w.STRING?s.unshift({field:e,simpleFieldType:l.w.STRING}):s.push({field:e,simpleFieldType:i.simpleFieldType})})),3===s.length)for(let e=0;e<3;e++){const i=s[e];if(i.simpleFieldType===l.w.DATE&&2!==e){s.splice(e,1),s.splice(2,0,i);break}}(0,l.v)(i,s)||(l.s.selectedFields=s,k(this.galleryRequestWrapper))}editAttribute(e,i){const{selectedFields:a,modules:s}=l.s;(0,l.K)(e);const t=s.esriLang.clone(a);e.forEach((e=>{const s=(0,l.u)(e);"string"===s.simpleFieldType?(a.splice(i,1),a.unshift({field:e,simpleFieldType:l.w.STRING})):a[i]={field:e,simpleFieldType:s.simpleFieldType}})),(0,l.v)(a,t)||(l.s.selectedFields=a,k(this.galleryRequestWrapper))}checkCluster(){const{layer:e}=l.s;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){var e;const{layer:i}=l.s;if("featureReduction"in i&&"cluster"===(null===(e=i.featureReduction)||void 0===e?void 0:e.type)){const e=i.featureReduction;e.renderer=null,i.featureReduction=e.clone()}}openFieldPickList(e=!1,i=null){(0,l.E)();const{fields:a,selectedFields:s}=l.s;let t,n=s.map((e=>e.field));t=a.filter((a=>{let s=!n.includes(a.layerField.name);return e&&(s=s||a.layerField.name===n[i]),s}));const r=document.createElement("arcgis-smart-mapping-field-pick-list");r.fields=t,r.popoverProps={refElement:this.flowItemNode,placement:"leading",offsetDistance:0,popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},r.singleEditMode=e,r.fieldToReplace=e?s[i]:null,r.lastSortBy=this.lastSortBy,document.body.appendChild(r),(0,l.L)(this.flowItemNode,!0),r.addEventListener("arcgisSmartMappingFieldPickListClose",(a=>{var s;this.modifyFieldPickList=!0,document.body.removeChild(r),(0,l.L)(this.flowItemNode,!1),(null===(s=a.detail)||void 0===s?void 0:s.selectedFields)&&(e?this.editAttribute(a.detail.selectedFields,i):this.addField(a.detail.selectedFields)),this.addFieldButtonNode.setFocus()})),r.addEventListener("arcgisSmartMappingFieldPickListSortByChange",(e=>{this.lastSortBy=e.detail}))}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.tileNodes[0])||void 0===e?void 0:e.setFocus()}))),300)}get hostElement(){return(0,s.d)(this)}};F.style=".add-button-div{margin:0 3px}.add-buttons{display:flex;flex-direction:row;justify-content:space-between;background-color:#ffffff}.attributes{padding:6px 6px 0 6px;background-color:#ffffff}.attributes-header-text{font-weight:bold;font-size:16px;padding:10px 0}.attributes-msg{font-size:var(--calcite-font-size--2)}.attributes-add-new{margin-top:10px}.tip{margin-top:15px;display:flex;justify-content:space-between}.tip-message{justify-content:center}.tip-text{color:#3d5f1d}.tip-close{margin-top:4px}.field-type{display:flex;align-items:center;height:100%;color:var(--calcite-color-text-1)}.attribute-list{border-bottom:1px solid #e0e0e0}.gallery-block{padding:12px 3px;margin-bottom:12px;background-color:#ffffff;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.center{display:flex;align-items:center;justify-content:center;text-align:center}.number-icon{color:var(--calcite-color-brand)}.styles-msg-title{padding:6px;font-weight:bold;font-size:16px;display:flex;justify-content:center}.styles-msg{font-size:var(--calcite-font-size--2)}"},21747:(e,i,a)=>{a.d(i,{a:()=>n,c:()=>l});var s=a(9225),t=(a(69283),a(10519));function l(e){var i;const{layer:a,mapImageSublayer:l,mapView:n,modules:r}=s.s,o=a;e=e||{};const c=(0,s.m)((0,s.h)(o));return r.ColorCreator.createContinuousRenderer({layer:o,view:n,field:e.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,s.P)("above-and-below"),normalizationField:e.fieldInfos[1].field,outlineOptimizationEnabled:!l&&((0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:(0,s.q)(o)),sizeOptimizationEnabled:!l&&(!(0,t.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(i=o.featureReduction)||void 0===i?void 0:i.type)}).then((e=>(((0,s.p)(e.renderer,"color")||{}).style="ratio",(0,s.l)(c,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function n(e){var i,a,l,n;const{layer:r,mapImageSublayer:o,mapView:c,modules:d}=s.s,p=r;e=e||{};const m=(0,s.h)(p),g=(0,s.a)(m,"color");if(g&&e.fieldInfo&&e.fieldInfo.field==g.field&&e.normalizationField===g.normalizationField&&(delete e.fieldInfos,(0,s.R)(e)))return Promise.resolve({renderer:m.clone()});const u=(0,s.p)(m,"color"),h=(0,s.m)(m);let f=e.fieldInfos?e.fieldInfos[0]:g?{field:g.field,expression:g.valueExpression,expressionTitle:g.valueExpressionTitle,simpleFieldType:s.w.NUMBER}:{field:m.field,expression:m.valueExpression,expressionTitle:m.valueExpressionTitle,simpleFieldType:s.w.NUMBER};const y=e.normalizationField?e.normalizationField:g?g.normalizationField:m.normalizationField,z=m.classBreakInfos&&m.classBreakInfos.length?m.classBreakInfos[0].symbol:null,b=m.defaultSymbol,v=m.defaultLabel;let S=!1;(null===e.normalizationField||e.normalizationField||e.fieldInfo)&&(S=!0);const E=e.discardMinMax?void 0:(0,t.i)(e.min)?e.min:S?void 0:u?u.minSliderValue:m.classBreakInfos[0].minValue,I=e.discardMinMax?void 0:(0,t.i)(e.max)?e.max:S?void 0:u?u.maxSliderValue:m.classBreakInfos[m.classBreakInfos.length-1].maxValue;return d.ColorCreator.createContinuousRenderer({layer:p,view:c,field:f?f.field:m.field,theme:"above-and-below",colorScheme:(0,s.P)("above-and-below"),normalizationField:y,minValue:E,maxValue:I,outlineOptimizationEnabled:!o&&((0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!h.sizeOutlineVisVar),sizeOptimizationEnabled:!o&&((0,t.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!h.sizeAutoVisVar),legendOptions:(null===(i=e.legendOptions)||void 0===i?void 0:i.toJSON())||(null===(a=null==g?void 0:g.legendOptions)||void 0===a?void 0:a.toJSON())||(null===(l=m.legendOptions)||void 0===l?void 0:l.toJSON()),defaultSymbolEnabled:(0,t.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!m.defaultSymbol,forBinning:"binning"===(null===(n=p.featureReduction)||void 0===n?void 0:n.type)}).then((i=>{if(e.discardMinMax){const e=(0,s.a)(m,"color"),a=(0,s.a)(i.renderer,"color");e.stops.forEach(((e,i)=>e.value=a.stops[i].value))}return((0,s.p)(i.renderer,"color")||{}).style="ratio",(0,s.l)(h,i.renderer),z&&i.renderer.classBreakInfos&&i.renderer.classBreakInfos.length&&(i.renderer.classBreakInfos[0].symbol=z),b&&(i.renderer.defaultSymbol=b,i.renderer.defaultLabel=v),Promise.resolve(i)}),(e=>Promise.reject(e)))}},53868:(e,i,a)=>{a.d(i,{u:()=>t});var s=a(9225);async function t(e){const{layer:i,strings:a,modules:t}=s.s,n=i,r="// "+a.arcade.defaultExpressionScript_line1+"\r\n// "+a.arcade.defaultExpressionScript_line2+"\r\n// Round(($feature.oak_count / $feature.all_trees_count) * 100, 2)\r\n\r\n",o=document.createElement("arcgis-modal-arcade");return o.arcadeScript=(null==e?void 0:e.expression)||r,o.arcadeProfile=function(){const{layer:e}=s.s;return{id:"visualization",definitions:{$feature:e}}}(),o.testData=await async function(){const{mapView:e}=s.s;return{profileVariableInstances:{$feature:await l(),$view:{scale:e.scale}},spatialReference:e.spatialReference}}(),o.addExistingExpressions=!0,o.layer=n,o.arcadeTitle=(null==e?void 0:e.expressionTitle)||a.arcade.newExpression,o.arcadeTitleEditable=!0,o.arcadeTitleEditingEnabled=!(null==e?void 0:e.expressionTitle),document.body.appendChild(o),new Promise(((e,i)=>{o.addEventListener("arcgisModalArcadeClose",(a=>{if(document.body.removeChild(o),!a.detail)return void i();const{script:l,title:c,predictOutputType:d}=a.detail;if(l&&l!==r)return t.fieldUtils.getExpressionFields(n,[l]).then((i=>{(0,s.O)(i),e({expression:l,expressionTitle:c,simpleFieldType:"number"===d?s.w.NUMBER:"string"===d?s.w.STRING:"date"===d?s.w.NUMBER:s.w.UNKNOWN})}));i()}))}))}async function l(){var e;const{layer:i,mapView:a,modules:t}=s.s;let l;if(!("fields"in i))return null;{await async function(){const{oneFeatureResponse:e,oneFeatureResponseStatus:i}=s.s;if(e&&i!==s.b.MISSING)return s.s.oneFeatureResponse;{const e=await function(){const{mapView:e,layer:i,mapImageSublayer:a}=s.s;return"fields"in i?a?n():e.whenLayerView(i).then((e=>{if("feature"===i.type&&!i.url||"wfs"===i.type){const e=i.createQuery();return e.start=0,e.num=5,e.outFields=["*"],i.queryFeatures(e).then((e=>e.features&&e.features.length?Promise.resolve(e):Promise.resolve(r())))}{const a="hasM"in i&&i.hasM,s="hasZ"in i&&i.hasZ,t=e.availableFields.length===i.fields.length&&!a&&!s;if("createQuery"in i&&t){const a=i.createQuery();return a.start=0,a.num=5,a.outFields=["*"],e.queryFeatures(a).then((e=>e.features&&e.features.length?Promise.resolve(e):n()))}return n()}})):Promise.reject("getOneFeature: wrong layer type")}();return s.s.oneFeatureResponse=(null==e?void 0:e.features.length)&&e,s.s.oneFeatureResponseStatus=(null==e?void 0:e.features.length)?s.b.SUCCESS:s.b.FAILED,e}}();const{oneFeatureResponse:o}=s.s;if(null===(e=null==o?void 0:o.features)||void 0===e?void 0:e.length)l=t.esriLang.clone(o.features[0]);else{const e={};i.fields.forEach((i=>{["small-integer","big-integer","integer","single","double","string","date","date-only","oid","guid"].indexOf(i.type)>-1&&!1===i.nullable?i.defaultValue?e[i.name]=i.defaultValue:"string"===i.type?e[i.name]="":e[i.name]=0:e[i.name]=null}));const n=a.extent;let r,o;(0,s.q)(i)?(r=new t.Polygon({spatialReference:new t.SpatialReference(a.spatialReference.toJSON())}),r.addRing([[n.xmin,n.ymin],[n.xmax,n.ymin],[n.xmax,n.ymax],[n.xmin,n.ymax],[n.xmin,n.ymin]]),o=new t.SimpleLineSymbol):(0,s.A)(i)?(r=new t.Point(n.center.toJSON()),o=new t.SimpleMarkerSymbol):(0,s.B)(i)&&(r=new t.Polyline({spatialReference:new t.SpatialReference(a.spatialReference.toJSON())}),r.addPath([[n.xmin,n.ymin],[n.xmax,n.ymax]]),o=new t.SimpleFillSymbol),l=new t.Graphic({geometry:r,symbol:o,attributes:e})}}return l}function n(){var e,i;const{layer:a,mapView:t,modules:l}=s.s;if(!("queryFeatures"in a))return Promise.resolve(r());const n=new l.Query({outFields:["*"],where:"1=1",outSpatialReference:t.spatialReference,returnGeometry:!0,returnM:"hasM"in a&&a.hasM,returnZ:"hasZ"in a&&a.hasZ});return"sourceJSON"in a&&(null===(i=null===(e=a.sourceJSON)||void 0===e?void 0:e.advancedQueryCapabilities)||void 0===i?void 0:i.supportsPagination)&&(n.num=1),a.queryFeatures(n).then((e=>Promise.resolve(e)),(()=>Promise.resolve(r())))}function r(){const{layer:e,modules:i}=s.s,a={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?a[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?a[e.name]=0:"date-only"===e.type?a[e.name]=null:a[e.name]=""}));const t=new i.Graphic({geometry:void 0,symbol:void 0,attributes:a});return new i.FeatureSet({features:[t],fields:[],geometryType:(0,s.D)(e),spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}a(69283),a(49306)},40630:(e,i,a)=>{a.d(i,{a:()=>n,c:()=>t,u:()=>l});var s=a(9225);function t(e){var i;const{layer:a,mapView:t,modules:l}=s.s,n=a,r=(0,s.h)(n);return e=e||{},"heatmap"===(0,s.g)()&&(e.radius=e.radius||r.radius,e.heatmapScheme=e.heatmapScheme||(0,s.V)()),(null===(i=e.fieldInfos)||void 0===i?void 0:i.length)&&(0,s.O)([e.fieldInfos[0].field]),l.HeatmapCreator.createRenderer({layer:n,view:t,field:e.fieldInfos&&e.fieldInfos.length?e.fieldInfos[0].field:null,radius:e.radius||10,heatmapScheme:e.heatmapScheme||void 0})}function l(e){const{layer:i,modules:a}=s.s,t=(0,s.h)(i);return a.HeatmapCreator.updateRenderer({renderer:t,fadeRatio:e})}function n(e){const{layer:i,mapView:a,modules:t}=s.s,l=i,n=(0,s.h)(l);return e=e||{},t.heatmapStatistics({layer:l,view:a,field:n.field,radius:e.radius||n.radius||10}).then((e=>(n.minDensity=e.min,n.maxDensity=e.max,Promise.resolve(e))),(e=>Promise.reject(e)))}a(69283),a(49306)},7659:(e,i,a)=>{a.d(i,{a:()=>n,b:()=>r,c:()=>l});var s=a(9225),t=(a(69283),a(10519));function l(e){var i;const{layer:a,mapImageSublayer:l,mapView:n,modules:r}=s.s,o=a;e=e||{};const c=(0,s.m)((0,s.h)(o));return r.LocationCreator.createRenderer({layer:o,view:n,outlineOptimizationEnabled:!l&&(!(0,t.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!l&&(!(0,t.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),forBinning:"binning"===(null===(i=o.featureReduction)||void 0===i?void 0:i.type)}).then((e=>((0,s.l)(c,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function n(){var e;const{layer:i,mapView:a,modules:t}=s.s,l=i;return t.LocationCreator.createRenderer({layer:l,view:a,outlineOptimizationEnabled:!0,forBinning:"binning"===(null===(e=l.featureReduction)||void 0===e?void 0:e.type)}).then((e=>{const i=(0,s.a)(e.renderer,"size","outline");return Promise.resolve(i)}))}function r(){var e;const{layer:i,mapView:a,modules:t}=s.s,l=i;return t.LocationCreator.createRenderer({layer:l,view:a,outlineOptimizationEnabled:!1,sizeOptimizationEnabled:!0,forBinning:"binning"===(null===(e=l.featureReduction)||void 0===e?void 0:e.type)}).then((e=>{const i=(0,s.a)(e.renderer,"size","auto");return Promise.resolve(i)}))}}}]);