"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-5a65ec"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layer-override_3.entry.js":
/*!**************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-layer-override_3.entry.js ***!
  \**************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_layer_override: () => (/* binding */ ArcgisLayerOverride),
/* harmony export */   arcgis_layer_override_properties: () => (/* binding */ ArcgisLayerOverrideProperties),
/* harmony export */   arcgis_layer_override_status: () => (/* binding */ ArcgisLayerOverrideStatus)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./localStorage-9c4e7a3a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */









const CSS$2 = {
    container: "container",
    details: "details",
    buttons: "buttons",
    topButton: "top-button",
    properties: "properties",
    propertiesIcon: "properties-icon"
};

/**
 * get override status
 * @param props - LayerOverrideProps
 */
function getLayerOriginInfo(props) {
    const { layer, layerOriginUtils } = props;
    props.layerOriginInfo = layerOriginUtils.getLayerOriginInfo(layer, "web-map");
    //console.log("layerOriginInfo (web-map)", props.layerOriginInfo);
    //console.log("layerOriginInfo (portal-item)", layerOriginUtils.getLayerOriginInfo(layer, "portal-item"));
}

const arcgisLayerOverrideCss = ":host{height:100%}.container{padding:6px;background-color:white}.details{width:100%;margin-bottom:8px;cursor:pointer}.buttons{margin-bottom:14px}.top-button{margin-bottom:4px}.properties{margin-bottom:16px;cursor:pointer}.properties-icon{height:100%;padding:0 var(--calcite-notice-spacing-token-large)}";

const ArcgisLayerOverride = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisLayerOverrideChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideChange", 7);
        this.arcgisLayerOverrideDuplicateClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideDuplicateClick", 7);
        this.arcgisLayerOverrideSaveLayerClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideSaveLayerClick", 7);
        this.arcgisLayerOverrideSaveAsLayerClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideSaveAsLayerClick", 7);
        // --------------------------------------------------------------------------
        //
        //  Private methods
        //
        // --------------------------------------------------------------------------
        this.afterCreateSource = (node) => {
            this.sourceNode = node;
        };
        this.afterCreateStatusAction = (node) => {
            this.statusActionNode = node;
        };
        this.afterCreatePropertiesButton = (node) => {
            this.propertiesNode = node;
        };
        this.onPanelScroll = async () => {
            var _a, _b;
            if (this.statusPopover) {
                const rect = await ((_a = this.statusPopover) === null || _a === void 0 ? void 0 : _a.getPopoverRect());
                if ((rect === null || rect === void 0 ? void 0 : rect.top) < 0) {
                    this.closePopovers();
                }
            }
            if (this.propertiesPopover) {
                const rect = await ((_b = this.propertiesPopover) === null || _b === void 0 ? void 0 : _b.getPopoverRect());
                if ((rect === null || rect === void 0 ? void 0 : rect.top) < 0) {
                    this.closePopovers();
                }
            }
        };
        this.openDetails = () => {
            const { layer } = this;
            const { portalItem } = layer;
            let url;
            if (portalItem === null || portalItem === void 0 ? void 0 : portalItem.portal) {
                if (portalItem.portal.urlKey) {
                    url = `//${portalItem.portal.urlKey}.${portalItem.portal.customBaseUrl}/home/item.html?id=${portalItem.id}&sublayer=${layer.layerId}`;
                }
                else {
                    url = `//${portalItem.portal.portalHostname}/home/item.html?id=${portalItem.id}&sublayer=${layer.layerId}`;
                }
            }
            else {
                url = `${layer.url}/${layer.layerId}`;
            }
            window.open(url);
        };
        this.saveLayer = (event) => {
            event.stopPropagation();
            const { layer } = this;
            this.arcgisLayerOverrideSaveLayerClick.emit(layer.id);
        };
        this.saveAsLayer = (event) => {
            event.stopPropagation();
            const { layer } = this;
            this.arcgisLayerOverrideSaveAsLayerClick.emit(layer.id);
        };
        this.duplicateLayer = (event) => {
            event.stopPropagation();
            const { layer } = this;
            this.arcgisLayerOverrideDuplicateClick.emit(layer.id);
        };
        this.openStatus = async (event) => {
            event.stopPropagation();
            if (this.containerPanelNode.disabled) {
                return;
            }
            // layer status floating panel
            if (this.statusPopover) {
                if (this.statusPopover.parentNode) {
                    // already open, hide it
                    this.statusPopover.parentNode.removeChild(this.statusPopover);
                    this.statusPopover = null;
                    return;
                }
                else {
                    // got closed by something outside
                    this.statusPopover = null;
                }
            }
            this.closePopovers();
            await this.scrollIntoView(this.sourceNode);
            const { props, strings } = this;
            const popover = document.createElement("arcgis-layer-override-status");
            popover.props = props;
            popover.strings = strings;
            popover.popoverReferenceElement = this.sourceNode;
            document.body.appendChild(popover);
            this.statusPopover = popover;
            this.disableContainer(true);
        };
        this.openManageProps = async () => {
            // manage layer properties floating panel
            // layer status floating panel
            if (this.propertiesPopover) {
                if (this.propertiesPopover.parentNode) {
                    // already open, hide it
                    this.propertiesPopover.parentNode.removeChild(this.propertiesPopover);
                    this.propertiesPopover = null;
                    return;
                }
                else {
                    // got closed by something outside
                    this.propertiesPopover = null;
                }
            }
            this.closePopovers();
            await this.scrollIntoView(this.sourceNode);
            const { props, strings } = this;
            const popover = document.createElement("arcgis-layer-override-properties");
            popover.props = props;
            popover.strings = strings;
            popover.popoverReferenceElement = this.sourceNode;
            document.body.appendChild(popover);
            this.propertiesPopover = popover;
            this.disableContainer(true);
        };
        this.layer = undefined;
        this.config = undefined;
        this.portal = undefined;
        this.props = undefined;
        this.reRender = false;
    }
    closeAllPopoversHandler() {
        this.closePopovers();
    }
    arcgisLayerOverridePropChange() {
        this.arcgisLayerOverrideChange.emit();
        this.reRender = !this.reRender;
    }
    arcgisLayerOverrideStatusChange() {
        this.reRender = !this.reRender;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    /**
     * Set focus on component
     */
    async setFocus() { }
    /**
     * Close popovers before removing component
     */
    async done() {
        this.closePopovers();
    }
    /**
     * Refresh content, e.g. after layer properties changes
     */
    async refresh() {
        getLayerOriginInfo(this.props);
        this.reRender = !this.reRender;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const [strings] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = strings;
        // build LayerOverrideProps
        this.props = {
            layer: this.layer,
            portal: this.portal,
            config: this.config
        };
        const [layerOriginUtils] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__.l)(["esri/layers/support/layerOriginUtils"]);
        this.props.layerOriginUtils = layerOriginUtils;
        layerOriginUtils.isSupportedLayer(this.layer);
        getLayerOriginInfo(this.props);
    }
    async componentDidLoad() {
        var _a;
        // once component is visible make other calls
        this.containerPanelNode = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.q)(this.hostElement, "calcite-panel");
        if (!this.containerPanelNode) {
            this.containerPanelNode = (0,_commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_2__.q)(this.hostElement, "calcite-flow-item");
        }
        (_a = this.containerPanelNode) === null || _a === void 0 ? void 0 : _a.addEventListener("calcitePanelScroll", this.onPanelScroll);
    }
    disconnectedCallback() {
        var _a;
        (_a = this.containerPanelNode) === null || _a === void 0 ? void 0 : _a.removeEventListener("calcitePanelScroll", this.onPanelScroll);
        this.closePopovers();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.container }, this.renderSource(), this.renderCopy(), this.renderStatus(), this.renderProperties())));
    }
    renderSource() {
        var _a;
        const { strings, layer } = this;
        const itemTitle = (_a = layer.portalItem) === null || _a === void 0 ? void 0 : _a.title;
        const layerTitle = layer.title;
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__.g)(this.hostElement) === "rtl";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { ref: this.afterCreateSource }, strings.sourceLayer, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { class: CSS$2.details, heading: itemTitle && itemTitle !== layerTitle
                ? rtl
                    ? `${layerTitle} / ${itemTitle}`
                    : `${itemTitle} / ${layerTitle}`
                : layerTitle, description: layer.isTable ? "Table" : "Feature layer", onClick: this.openDetails }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-end", icon: "launch", text: strings.sourceLayer, onClick: this.openDetails }))));
    }
    renderCopy() {
        var _a;
        const { strings, layer, props } = this;
        const { portal } = props;
        const canCreateItems = this.canCreateItems(portal === null || portal === void 0 ? void 0 : portal.user);
        const canSave = ["admin", "update"].indexOf((_a = layer.portalItem) === null || _a === void 0 ? void 0 : _a.itemControl) > -1;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.buttons }, canSave && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "save", class: CSS$2.topButton, label: strings.save, onClick: this.saveLayer }, strings.save)), canCreateItems && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "save", class: CSS$2.topButton, label: strings.saveAs, onClick: this.saveAsLayer }, strings.saveAs)), !layer.isTable && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", appearance: "outline-fill", kind: "neutral", iconStart: "duplicate", label: strings.duplicate, onClick: this.duplicateLayer }, strings.duplicate))));
    }
    renderStatus() {
        const { strings, layer, props } = this;
        const { layerOriginInfo } = props;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS$2.properties, width: "full", scale: "s", open: true, onClick: this.openStatus }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, layerOriginInfo.status === "source"
            ? strings.propsFromSource
            : layerOriginInfo.status === "overridden"
                ? strings.propsSetInWebmap
                : strings.somePropsSetInWebmap), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", icon: "information", scale: "s", compact: true, class: CSS$2.propertiesIcon, text: layer.isTable ? strings.tableStatus : strings.layerStatus, onClick: this.openStatus, ref: this.afterCreateStatusAction })));
    }
    renderProperties() {
        const { strings, layer } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", width: "full", label: layer.isTable ? strings.manageTableProps : strings.manageLayerProps, onClick: this.openManageProps, ref: this.afterCreatePropertiesButton }, layer.isTable ? strings.manageTableProps : strings.manageLayerProps));
    }
    closePopovers() {
        this.closeStatusPopover();
        this.closePropertiesPopover();
        this.disableContainer(false);
    }
    closeStatusPopover() {
        var _a;
        if (this.statusPopover) {
            (_a = this.statusPopover.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.statusPopover);
            this.statusPopover = null;
            setTimeout(() => {
                // doesn't work without timeout
                this.statusActionNode.setFocus();
            }, 300);
        }
    }
    closePropertiesPopover() {
        var _a;
        if (this.propertiesPopover) {
            (_a = this.propertiesPopover.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.propertiesPopover);
            this.propertiesPopover = null;
            setTimeout(() => {
                // doesn't work without timeout
                this.propertiesNode.setFocus();
            }, 300);
        }
    }
    scrollIntoView(referenceElement) {
        var _a;
        if (((_a = referenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.top) < 0) {
            // let's make sure it fully shows
            referenceElement.scrollIntoView({
                behavior: "smooth",
                block: "nearest",
                inline: "start"
            });
            // wait until scrolling is done
            return new Promise(async (resolve) => {
                let count = 0;
                const hndl = setInterval(() => {
                    var _a;
                    if (count > 10 || ((_a = referenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.top) >= 0) {
                        clearInterval(hndl);
                        resolve();
                    }
                    count++;
                }, 100);
            });
        }
        else {
            return Promise.resolve();
        }
    }
    disableContainer(disable) {
        if (this.containerPanelNode) {
            this.containerPanelNode.disabled = disable;
        }
    }
    canCreateItems(user) {
        var _a;
        return user && (this.isPublicUser(user) || ((_a = user.privileges) === null || _a === void 0 ? void 0 : _a.includes("portal:user:createItem")));
    }
    isPublicUser(user) {
        return !user.orgId;
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverride.style = arcgisLayerOverrideCss;

const CSS$1 = {
    popover: "popover",
    content: "content",
    notice: "notice",
    tile: "tile",
    tooltip: "tooltip"
};

const arcgisLayerOverridePropertiesCss = ".popover{z-index:100}.content{padding:0.5rem 0.75rem;background-color:#ffffff;max-height:80vh}.notice{margin-bottom:16px}.tile{cursor:pointer}.tooltip{max-width:80%}";

const ArcgisLayerOverrideProperties = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.closeAllPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeAllPopovers", 7);
        this.arcgisLayerOverridePropertiesChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverridePropertiesChange", 7);
        // --------------------------------------------------------------------------
        //
        //  Private methods
        //
        // --------------------------------------------------------------------------
        this.afterCreatePopover = (node) => {
            this.popoverNode = node;
        };
        this.afterCreateCloseButton = (node) => {
            this.closeButtonNode = node;
        };
        this.handleCloseClick = () => {
            this.closeAllPopovers.emit();
        };
        this.resetToSource = (event) => {
            event.stopPropagation();
            const { props } = this;
            const { layer, layerOriginUtils } = props;
            layerOriginUtils.clearOverrides(layer, "web-map");
            this.reRender = !this.reRender;
            this.arcgisLayerOverridePropertiesChange.emit();
        };
        this.disconnectProps = (event) => {
            event.stopPropagation();
            const { props } = this;
            const { layer, layerOriginUtils } = props;
            layerOriginUtils.disconnectFromSource(layer, "web-map");
            this.reRender = !this.reRender;
            this.arcgisLayerOverridePropertiesChange.emit();
        };
        this.props = undefined;
        this.popoverReferenceElement = undefined;
        this.strings = undefined;
        this.reRender = false;
        this.isOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    /**
     * Repositions popover
     */
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    /**
     * Calls getBoundingClientRect() on popover
     */
    async getPopoverRect() {
        var _a;
        return (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentDidLoad() {
        this.popoverNode.reposition();
        this.isOpen = true;
        // need timeout because of re-render
        setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 100);
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a;
        const { popoverReferenceElement, strings, props } = this;
        const { layer } = props;
        const nodeWidth = popoverReferenceElement.clientWidth;
        // let the popover start at the top of the reference element
        const offsetDistance = popoverReferenceElement.clientHeight ||
            ((_a = popoverReferenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.height) ||
            96;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "bottom", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -1 * offsetDistance, offsetSkidding: 0, class: CSS$1.popover, style: nodeWidth
                ? {
                    width: `${nodeWidth + 60}px`
                }
                : null, label: layer.isTable ? strings.manageTableProps : strings.manageLayerProps, ref: this.afterCreatePopover, onCalcitePopoverBeforeClose: () => this.closeAllPopovers.emit() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { style: nodeWidth
                ? {
                    width: `${nodeWidth + 58}px`
                }
                : null }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: layer.isTable ? strings.manageTableProps : strings.manageLayerProps }, this.renderCloseButton(), this.renderContent())))));
    }
    renderCloseButton() {
        const { strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton, icon: "x" }));
    }
    renderContent() {
        const { strings, props } = this;
        const { layer } = props;
        // always make a new call in case things have changed
        getLayerOriginInfo(props);
        const { layerOriginInfo } = props;
        const resetToSourceDisabled = layerOriginInfo.status === "source";
        const disconnectDisabled = layerOriginInfo.status === "overridden";
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$1.content }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS$1.notice, width: "full", scale: "s", open: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "title" }, layerOriginInfo.status === "source"
            ? strings.propsFromSource
            : layerOriginInfo.status === "overridden"
                ? strings.propsSetInWebmap
                : strings.somePropsSetInWebmap)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "layer-override-reset" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { heading: strings.resetToSource, description: strings.discardProps, class: CSS$1.tile, disabled: resetToSourceDisabled, onClick: !resetToSourceDisabled ? this.resetToSource : null }, resetToSourceDisabled ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-start", icon: "reset" })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-start", icon: "reset", text: strings.resetToSource, onClick: !resetToSourceDisabled ? this.resetToSource : null })))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { id: "layer-override-disconnect" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tile", { heading: layer.isTable ? strings.disconnectPropsTable : strings.disconnectProps, description: strings.setPropsInWebmap, class: CSS$1.tile, disabled: disconnectDisabled, onClick: !disconnectDisabled ? this.disconnectProps : null }, disconnectDisabled ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { scale: "s", slot: "content-start", icon: "unlink" })) : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { scale: "s", compact: true, slot: "content-start", icon: "unlink", text: strings.disconnectProps, onClick: !disconnectDisabled ? this.disconnectProps : null })))), resetToSourceDisabled && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { class: CSS$1.tooltip, placement: "top", offsetDistance: -50, overlayPositioning: "fixed", referenceElement: "layer-override-reset", label: strings.propsCannotBeReset }, strings.propsCannotBeReset)), disconnectDisabled && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { class: CSS$1.tooltip, placement: "top", offsetDistance: -50, overlayPositioning: "fixed", referenceElement: "layer-override-disconnect", label: strings.propsCannotBeDisconnected }, strings.propsCannotBeDisconnected))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverrideProperties.style = arcgisLayerOverridePropertiesCss;

const CSS = {
    popover: "popover",
    content: "content",
    notice: "notice",
    filter: "filter",
    blockContent: "block-content",
    listHeader: "list-header"
};

const arcgisLayerOverrideStatusCss = ".popover{z-index:100}.content{max-height:60vh}.notice{margin:8px}.filter{border-width:0px 0px 1px;border-color:var(--calcite-color-border-3);border-style:solid}.block-content{background-color:var(--calcite-color-foreground-2)}.list-header{padding:0.75rem 0.5rem 0.25rem 0.5rem}";

const ArcgisLayerOverrideStatus = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.closeAllPopovers = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "closeAllPopovers", 7);
        this.arcgisLayerOverrideStatusChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisLayerOverrideStatusChange", 7);
        this.documentTabHandler = undefined;
        this.documentClickHandler = undefined;
        this.allItems = [];
        this.dataTypes = [
            "data",
            "definition-expression",
            "popup",
            "refresh-interval",
            "use-view-time",
            //"editing-enabled",
            "form-template",
            "floor-info",
            "custom-parameters",
            "charts"
        ];
        this.appearanceTypes = [
            "renderer",
            "labels",
            "scale-range",
            "opacity",
            "feature-reduction",
            "blend-mode",
            "effect",
            "legend-enabled",
            "order-by"
        ];
        // --------------------------------------------------------------------------
        //
        //  Private methods
        //
        // --------------------------------------------------------------------------
        this.afterCreatePopover = (node) => {
            this.popoverNode = node;
        };
        this.afterCreateCloseButton = (node) => {
            this.closeButtonNode = node;
        };
        this.handleCloseClick = () => {
            this.closeAllPopovers.emit();
        };
        this.props = undefined;
        this.popoverReferenceElement = undefined;
        this.strings = undefined;
        this.reRender = false;
        this.filteredItems = undefined;
        this.isOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    /**
     * Repositions popover
     */
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    /**
     * Calls getBoundingClientRect() on popover
     */
    async getPopoverRect() {
        var _a;
        return (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        var _a, _b;
        const { strings } = this;
        // always make a new call in case things have changed
        const beforeStatus = (_a = this.props.layerOriginInfo) === null || _a === void 0 ? void 0 : _a.status;
        getLayerOriginInfo(this.props);
        const afterStatus = (_b = this.props.layerOriginInfo) === null || _b === void 0 ? void 0 : _b.status;
        if (beforeStatus !== afterStatus) {
            // refesh notice text
            this.arcgisLayerOverrideStatusChange.emit();
        }
        this.allItems = [
            {
                value: "data",
                title: strings.status.data
            },
            {
                value: "definition-expression",
                title: strings.status.filter
            },
            {
                value: "popup",
                title: strings.status.popupsAndAttributes
            },
            {
                value: "refresh-interval",
                title: strings.status.refreshInterval
            },
            {
                value: "use-view-time",
                title: strings.status.time
            },
            {
                value: "editing-enabled",
                title: strings.status.editing
            },
            {
                value: "form-template",
                title: strings.status.formTemplate
            },
            {
                value: "floor-info",
                title: strings.status.floorInfo
            },
            {
                value: "custom-parameters",
                title: strings.status.customParameters
            },
            {
                value: "charts",
                title: strings.status.charts
            },
            {
                value: "renderer",
                title: strings.status.style
            },
            {
                value: "labels",
                title: strings.status.labels
            },
            {
                value: "scale-range",
                title: strings.status.visibleRange
            },
            {
                value: "opacity",
                title: strings.status.transparency
            },
            {
                value: "feature-reduction",
                title: strings.status.aggregation
            },
            {
                value: "blend-mode",
                title: strings.status.blending
            },
            {
                value: "effect",
                title: strings.status.effects
            },
            {
                value: "legend-enabled",
                title: strings.status.legend
            },
            {
                value: "order-by",
                title: strings.status.orderBy
            }
        ];
    }
    componentDidLoad() {
        this.popoverNode.reposition();
        this.isOpen = true;
        // need timeout because of re-render
        setTimeout(() => requestAnimationFrame(() => this.closeButtonNode.setFocus()), 100);
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a;
        const { popoverReferenceElement, strings, props } = this;
        const { layer } = props;
        const nodeWidth = popoverReferenceElement.clientWidth;
        const nodeHeight = document.body.clientHeight;
        // let the popover start at the top of the reference element
        const offsetDistance = popoverReferenceElement.clientHeight ||
            ((_a = popoverReferenceElement.getBoundingClientRect()) === null || _a === void 0 ? void 0 : _a.height) ||
            96;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { placement: "bottom", dir: document.dir, open: this.isOpen, pointerDisabled: true, referenceElement: popoverReferenceElement, offsetDistance: -1 * offsetDistance, offsetSkidding: 0, class: CSS.popover, style: nodeWidth
                ? {
                    width: `${nodeWidth + 60}px`
                }
                : null, label: "", ref: this.afterCreatePopover, onCalcitePopoverBeforeClose: () => this.closeAllPopovers.emit() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { style: nodeWidth
                ? {
                    width: `${nodeWidth + 58}px`,
                    maxHeight: `${nodeHeight * 0.7}px`
                }
                : null }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: layer.isTable ? strings.tableStatus : strings.layerStatus, ref: (node) => {
                node.addEventListener("calciteFlowItemScroll", () => this.closeInfoPopover());
            } }, this.renderCloseButton(), this.renderContent())))));
    }
    renderCloseButton() {
        const { strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { text: strings.close, scale: "s", slot: "header-actions-end", onClick: this.handleCloseClick, ref: this.afterCreateCloseButton, icon: "x" }));
    }
    renderContent() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.content }, this.renderInfo(), this.renderSearch(), this.renderDataContent(), this.renderAppearanceContent()));
    }
    renderInfo() {
        const { props, strings } = this;
        const { config } = props;
        const { helpBase, helpMap } = config;
        if ((0,_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.g)(_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.l.ARCGIS_COMPONENT_NOTIFICATIONS, _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.a.LAYER_OVERRIDE_STATUS_TIP_DISMISSED)) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: CSS.notice, open: true, closable: true, scale: "s", width: "auto", onCalciteNoticeClose: () => {
                (0,_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.s)(_localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.l.ARCGIS_COMPONENT_NOTIFICATIONS, {
                    key: _localStorage_9c4e7a3a_js__WEBPACK_IMPORTED_MODULE_5__.a.LAYER_OVERRIDE_STATUS_TIP_DISMISSED,
                    value: "true"
                });
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, strings.tip), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-link", { slot: "link", title: strings.learnMore, target: "_blank", href: `${helpBase}${helpMap["120002913"]}` }, strings.learnMore)));
    }
    renderSearch() {
        const { allItems, strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-filter", { items: allItems, messageOverrides: { label: strings.status.searchPlaceholder, clear: strings.status.clear }, placeholder: strings.status.searchPlaceholder, class: CSS.filter, onCalciteFilterChange: (event) => {
                this.filteredItems = event.target.filteredItems;
                this.dataBlockNode.open = true;
                if (this.appearanceBlockNode) {
                    this.appearanceBlockNode.open = true;
                }
                setTimeout(() => {
                    // doesn't work without timeout
                    this.reposition();
                }, 100);
            } }));
    }
    renderDataContent() {
        const { allItems, filteredItems, dataTypes, strings } = this;
        let items = (filteredItems || allItems)
            .filter((item) => dataTypes.indexOf(item.value) > -1)
            .map((item) => {
            if (item.value === "data") {
                // data is never overridden
                return [item.title, "source"];
            }
            else {
                return [item.title, this.getOverrideType(item.value)];
            }
        });
        items.sort((a, b) => a[0].localeCompare(b[0]));
        // move "data" to beginning of list; unless it's filtered out
        const dataItem = items.find((item) => item[0] === strings.status.data);
        if (dataItem) {
            items = items.filter((item) => item[0] !== strings.status.data);
            items.unshift(dataItem);
        }
        const sourceItems = items.filter((item) => item[1] === "source");
        const mapItems = items.filter((item) => item[1] === "webmap");
        const hasSourceItems = sourceItems.length > 0;
        const hasMapItems = mapItems.length > 0;
        const summary = hasSourceItems && hasMapItems
            ? strings.somePropsSetInWebmap
            : hasSourceItems
                ? strings.propsFromSource
                : strings.propsSetInWebmap;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: strings.status.dataProps, description: summary, collapsible: true, open: hasMapItems, onCalciteBlockOpen: () => {
                setTimeout(() => {
                    // doesn't work without timeout
                    this.reposition();
                }, 100);
            }, onCalciteBlockClose: () => {
                setTimeout(() => {
                    // doesn't work without timeout
                    this.reposition();
                }, 100);
            }, ref: (node) => (this.dataBlockNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.blockContent }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, hasMapItems && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS.listHeader, scale: "s" }, strings.setInWebmap)), hasMapItems && mapItems.map(([label, type]) => this.renderListItem(label, type)), hasSourceItems && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: CSS.listHeader, scale: "s" }, strings.setFromSource)), hasSourceItems && sourceItems.map(([label, type]) => this.renderListItem(label, type))))));
    }
    renderAppearanceContent() {
        const { allItems, filteredItems, appearanceTypes, strings, props } = this;
        const { layer } = props;
        if (layer.isTable) {
            return null;
        }
        const items = (filteredItems || allItems)
            .filter((item) => appearanceTypes.indexOf(item.value) > -1)
            .map((item) => [item.title, this.getOverrideType(item.value)]);
        items.sort((a, b) => a[0].localeCompare(b[0]));
        const sourceItems = items.filter((item) => item[1] === "source");
        const mapItems = items.filter((item) => item[1] === "webmap");
        const hasSourceItems = sourceItems.length > 0;
        const hasMapItems = mapItems.length > 0;
        const summary = hasSourceItems && hasMapItems
            ? strings.somePropsSetInWebmap
            : hasSourceItems
                ? strings.propsFromSource
                : strings.propsSetInWebmap;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { heading: strings.status.appearanceProps, description: summary, collapsible: true, open: hasMapItems, onCalciteBlockOpen: () => {
                setTimeout(() => {
                    // doesn't work without timeout
                    this.reposition();
                }, 100);
            }, onCalciteBlockClose: () => {
                setTimeout(() => {
                    // doesn't work without timeout
                    this.reposition();
                }, 100);
            }, ref: (node) => (this.appearanceBlockNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.blockContent }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, hasMapItems && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.listHeader }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.setInWebmap))), hasMapItems && mapItems.map(([label, type]) => this.renderListItem(label, type)), hasSourceItems && ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS.listHeader }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { scale: "s" }, strings.setFromSource))), hasSourceItems && sourceItems.map(([label, type]) => this.renderListItem(label, type))))));
    }
    renderListItem(label, type) {
        const { strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { label: label }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: strings.moreInfo, icon: "information", onClick: (event) => this.moreInfo(label, type, event) })));
    }
    moreInfo(label, type, event) {
        const { popoverNode, strings } = this;
        const referenceNode = event.currentTarget;
        this.closeInfoPopover();
        const div = document.createElement("div");
        div.innerHTML =
            type === "source"
                ? strings.propReflectUpdates.replace("${label}", label)
                : strings.propNotConnected.replace("${label}", label);
        div.style = `width: ${popoverNode.clientWidth * 0.8}px; font-size: var(--calcite-font-size--1); line-height: 1rem; margin: 0.75rem;`;
        /* issue with calcite
        const labelNode = document.createElement("calcite-label");
        labelNode.scale = "m";
        labelNode.innerHTML = type === "source" ? strings.propReflectUpdates : strings.propNotConnected;
        (labelNode as any).style = `width: ${popoverNode.clientWidth * 0.7}px;`;
        */
        const moreInfoPopover = document.createElement("calcite-popover");
        moreInfoPopover.heading = type === "source" ? strings.setFromSource : strings.setInWebmap;
        moreInfoPopover.placement = "auto";
        moreInfoPopover.offsetSkidding = 5;
        moreInfoPopover.closable = true;
        moreInfoPopover.label = strings.moreInfo;
        moreInfoPopover.referenceElement = referenceNode;
        moreInfoPopover.className = `js-app-flyout`; // js-app-flyout needed by app
        document.body.appendChild(moreInfoPopover);
        moreInfoPopover.appendChild(div);
        moreInfoPopover.setAttribute("open", "true");
        moreInfoPopover.reposition();
        moreInfoPopover.addEventListener("calcitePopoverClose", () => {
            this.closeInfoPopover();
        });
        // need to wait until it's all visible
        setTimeout(() => moreInfoPopover.setFocus(), 100);
        setTimeout(() => {
            // close popover when tabbing out
            this.documentTabHandler = (event) => {
                if (event.key === "Tab") {
                    event.stopPropagation();
                    this.closeInfoPopover();
                }
            };
            document.addEventListener("keydown", this.documentTabHandler);
            // close popover when clicking outside
            this.documentClickHandler = () => this.closeInfoPopover();
            document.addEventListener("click", this.documentClickHandler);
        }, 100);
        this.moreInfoPopoverNode = moreInfoPopover;
    }
    closeInfoPopover() {
        var _a;
        if (this.moreInfoPopoverNode) {
            (_a = this.moreInfoPopoverNode.referenceElement) === null || _a === void 0 ? void 0 : _a.setFocus();
            document.body.removeChild(this.moreInfoPopoverNode);
            this.moreInfoPopoverNode = null;
        }
        if (this.documentTabHandler) {
            document.removeEventListener("keydown", this.documentTabHandler);
            this.documentTabHandler = undefined;
        }
        if (this.documentClickHandler) {
            document.removeEventListener("click", this.documentClickHandler);
            this.documentClickHandler = undefined;
        }
    }
    isOverridden(id) {
        var _a, _b, _c;
        const { props } = this;
        const { layerOriginInfo } = props;
        return !!(((_c = (_b = (_a = layerOriginInfo === null || layerOriginInfo === void 0 ? void 0 : layerOriginInfo.propertyGroupOriginInfos) === null || _a === void 0 ? void 0 : _a.filter((info) => info.id === id)) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.status) === "overridden");
    }
    getOverrideType(id) {
        return this.isOverridden(id) ? "webmap" : "source";
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerOverrideStatus.style = arcgisLayerOverrideStatusCss;



//# sourceMappingURL=arcgis-layer-override_3.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/localStorage-9c4e7a3a.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ arcgisComponentNotificationsKeys),
/* harmony export */   g: () => (/* binding */ getSingleObjectLocalStorage),
/* harmony export */   l: () => (/* binding */ localStorageKeys),
/* harmony export */   s: () => (/* binding */ setSingleObjectLocalStorage)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
var localStorageKeys;
(function (localStorageKeys) {
    localStorageKeys["ARCGIS_COMPONENT_NOTIFICATIONS"] = "arcgisComponent_notifications";
})(localStorageKeys || (localStorageKeys = {}));
var arcgisComponentNotificationsKeys;
(function (arcgisComponentNotificationsKeys) {
    arcgisComponentNotificationsKeys["FEATURE_REDUCTION_WARNING_DISMISSED"] = "arcgis_feature_reduction_warning_dismissed";
    arcgisComponentNotificationsKeys["POPUP_WARNING_DISMISSED"] = "arcgis_popup_warning_dismissed";
    arcgisComponentNotificationsKeys["INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED"] = "arcgis_symbol_styler_incompatible_vector_symbols_dismissed";
    arcgisComponentNotificationsKeys["EFFECTS_TIP_DISMISSED"] = "arcgis_effects_tip_dismissed";
    arcgisComponentNotificationsKeys["LAYER_VIEW_DEFINITION_DISMISSED"] = "arcgis_layer_view_definition_dismissed";
    arcgisComponentNotificationsKeys["LAYER_OVERRIDE_STATUS_TIP_DISMISSED"] = "arcgis_layer_override_status_tip_dismissed";
    arcgisComponentNotificationsKeys["SMART_MAPPING_TIP1_DISMISSED"] = "arcgis_smart_mapping_tip1_dismissed";
    arcgisComponentNotificationsKeys["SMART_MAPPING_TIP2_DISMISSED"] = "arcgis_smart_mapping_tip2_dismissed";
    arcgisComponentNotificationsKeys["LAYER_VIEW_JOIN_TIP_DISMISSED"] = "arcgis_layer_view_join_tip_dismissed";
    arcgisComponentNotificationsKeys["MULTIDIMENSIONAL_INFO_TIP_DISMISSED"] = "arcgis_multidimensional_info_tip_dismissed";
})(arcgisComponentNotificationsKeys || (arcgisComponentNotificationsKeys = {}));
const getLocalStorage = (localStorageKey) => {
    return localStorage.getItem(localStorageKey);
};
const setLocalStorage = (localStorageKey, value) => {
    localStorage.setItem(localStorageKey, value);
};
const getObjectLocalStorage = (localStorageKey) => {
    return JSON.parse(getLocalStorage(localStorageKey)) || {};
};
const setSingleObjectLocalStorage = (localStorageKey, keyValueObject) => {
    const setLocalStorageVal = getObjectLocalStorage(localStorageKey);
    setLocalStorageVal[keyValueObject.key] = keyValueObject.value;
    setLocalStorage(localStorageKey, JSON.stringify(setLocalStorageVal));
};
const getSingleObjectLocalStorage = (localStorageKey, objectKey) => {
    const getLocalStorageVal = getObjectLocalStorage(localStorageKey);
    if (getLocalStorageVal === null || getLocalStorageVal === void 0 ? void 0 : getLocalStorageVal.hasOwnProperty(objectKey)) {
        return getLocalStorageVal[objectKey];
    }
    else {
        return null;
    }
};



//# sourceMappingURL=localStorage-9c4e7a3a.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTVhNjVlYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQzZHO0FBQ3ZDO0FBQ0U7QUFDWDtBQUNHO0FBQzhHO0FBQ25KO0FBQ1E7O0FBRW5DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMEJBQTBCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHNDQUFzQyxZQUFZLFdBQVcsWUFBWSx1QkFBdUIsU0FBUyxXQUFXLGtCQUFrQixlQUFlLFNBQVMsbUJBQW1CLFlBQVksa0JBQWtCLFlBQVksbUJBQW1CLGVBQWUsaUJBQWlCLFlBQVksb0RBQW9EOztBQUU5VTtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIseUNBQXlDLHFEQUFXO0FBQ3BELGlEQUFpRCxxREFBVztBQUM1RCxpREFBaUQscURBQVc7QUFDNUQsbURBQW1ELHFEQUFXO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix5QkFBeUIsR0FBRyxnQ0FBZ0MscUJBQXFCLGNBQWMsWUFBWSxjQUFjO0FBQ3hKO0FBQ0E7QUFDQSwrQkFBK0IsaUNBQWlDLHFCQUFxQixjQUFjLFlBQVksY0FBYztBQUM3SDtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsVUFBVSxHQUFHLGNBQWM7QUFDcEQ7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwwQ0FB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QUNBO0FBQ0E7QUFDQSxpQ0FBaUMsbURBQWlDO0FBQ2xFO0FBQ0E7QUFDQSxRQUFRLHdEQUFXO0FBQ25CLGVBQWUsd0RBQVc7QUFDMUI7QUFDQTtBQUNBLFlBQVksd0RBQVc7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMscURBQVksOEJBQThCLGNBQWMsUUFBUSxPQUFPO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsY0FBYyxFQUFFLE9BQU87QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGVBQWUsR0FBRyxrQkFBa0I7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7O0FBRTRFOztBQUU1RSIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1sYXllci1vdmVycmlkZV8zLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvY2FsU3RvcmFnZS05YzRlN2EzYS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sb2NhbGUtMDUwYjZkYjkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MgfSBmcm9tICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgeyBxIGFzIHF1ZXJ5UGFyZW50RWxlbWVudCB9IGZyb20gJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcbmltcG9ydCB7IGwgYXMgbG9hZE1vZHVsZXMgfSBmcm9tICcuL2xvYWRNb2R1bGVzLWI0YWMxMjQ3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0RWxlbWVudERpciB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlLCBzIGFzIHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSwgYSBhcyBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cywgbCBhcyBsb2NhbFN0b3JhZ2VLZXlzIH0gZnJvbSAnLi9sb2NhbFN0b3JhZ2UtOWM0ZTdhM2EuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuXG5jb25zdCBDU1MkMiA9IHtcbiAgICBjb250YWluZXI6IFwiY29udGFpbmVyXCIsXG4gICAgZGV0YWlsczogXCJkZXRhaWxzXCIsXG4gICAgYnV0dG9uczogXCJidXR0b25zXCIsXG4gICAgdG9wQnV0dG9uOiBcInRvcC1idXR0b25cIixcbiAgICBwcm9wZXJ0aWVzOiBcInByb3BlcnRpZXNcIixcbiAgICBwcm9wZXJ0aWVzSWNvbjogXCJwcm9wZXJ0aWVzLWljb25cIlxufTtcblxuLyoqXG4gKiBnZXQgb3ZlcnJpZGUgc3RhdHVzXG4gKiBAcGFyYW0gcHJvcHMgLSBMYXllck92ZXJyaWRlUHJvcHNcbiAqL1xuZnVuY3Rpb24gZ2V0TGF5ZXJPcmlnaW5JbmZvKHByb3BzKSB7XG4gICAgY29uc3QgeyBsYXllciwgbGF5ZXJPcmlnaW5VdGlscyB9ID0gcHJvcHM7XG4gICAgcHJvcHMubGF5ZXJPcmlnaW5JbmZvID0gbGF5ZXJPcmlnaW5VdGlscy5nZXRMYXllck9yaWdpbkluZm8obGF5ZXIsIFwid2ViLW1hcFwiKTtcbiAgICAvL2NvbnNvbGUubG9nKFwibGF5ZXJPcmlnaW5JbmZvICh3ZWItbWFwKVwiLCBwcm9wcy5sYXllck9yaWdpbkluZm8pO1xuICAgIC8vY29uc29sZS5sb2coXCJsYXllck9yaWdpbkluZm8gKHBvcnRhbC1pdGVtKVwiLCBsYXllck9yaWdpblV0aWxzLmdldExheWVyT3JpZ2luSW5mbyhsYXllciwgXCJwb3J0YWwtaXRlbVwiKSk7XG59XG5cbmNvbnN0IGFyY2dpc0xheWVyT3ZlcnJpZGVDc3MgPSBcIjpob3N0e2hlaWdodDoxMDAlfS5jb250YWluZXJ7cGFkZGluZzo2cHg7YmFja2dyb3VuZC1jb2xvcjp3aGl0ZX0uZGV0YWlsc3t3aWR0aDoxMDAlO21hcmdpbi1ib3R0b206OHB4O2N1cnNvcjpwb2ludGVyfS5idXR0b25ze21hcmdpbi1ib3R0b206MTRweH0udG9wLWJ1dHRvbnttYXJnaW4tYm90dG9tOjRweH0ucHJvcGVydGllc3ttYXJnaW4tYm90dG9tOjE2cHg7Y3Vyc29yOnBvaW50ZXJ9LnByb3BlcnRpZXMtaWNvbntoZWlnaHQ6MTAwJTtwYWRkaW5nOjAgdmFyKC0tY2FsY2l0ZS1ub3RpY2Utc3BhY2luZy10b2tlbi1sYXJnZSl9XCI7XG5cbmNvbnN0IEFyY2dpc0xheWVyT3ZlcnJpZGUgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc0xheWVyT3ZlcnJpZGVDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xheWVyT3ZlcnJpZGVDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZUR1cGxpY2F0ZUNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYXllck92ZXJyaWRlRHVwbGljYXRlQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVNhdmVMYXllckNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNMYXllck92ZXJyaWRlU2F2ZUxheWVyQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVNhdmVBc0xheWVyQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xheWVyT3ZlcnJpZGVTYXZlQXNMYXllckNsaWNrXCIsIDcpO1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVTb3VyY2UgPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VOb2RlID0gbm9kZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hZnRlckNyZWF0ZVN0YXR1c0FjdGlvbiA9IChub2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0FjdGlvbk5vZGUgPSBub2RlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFmdGVyQ3JlYXRlUHJvcGVydGllc0J1dHRvbiA9IChub2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnRpZXNOb2RlID0gbm9kZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vblBhbmVsU2Nyb2xsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1c1BvcG92ZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWN0ID0gYXdhaXQgKChfYSA9IHRoaXMuc3RhdHVzUG9wb3ZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFBvcG92ZXJSZWN0KCkpO1xuICAgICAgICAgICAgICAgIGlmICgocmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LnRvcCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BlcnRpZXNQb3BvdmVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjdCA9IGF3YWl0ICgoX2IgPSB0aGlzLnByb3BlcnRpZXNQb3BvdmVyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0UG9wb3ZlclJlY3QoKSk7XG4gICAgICAgICAgICAgICAgaWYgKChyZWN0ID09PSBudWxsIHx8IHJlY3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlY3QudG9wKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9wZW5EZXRhaWxzID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgcG9ydGFsSXRlbSB9ID0gbGF5ZXI7XG4gICAgICAgICAgICBsZXQgdXJsO1xuICAgICAgICAgICAgaWYgKHBvcnRhbEl0ZW0gPT09IG51bGwgfHwgcG9ydGFsSXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9ydGFsSXRlbS5wb3J0YWwpIHtcbiAgICAgICAgICAgICAgICBpZiAocG9ydGFsSXRlbS5wb3J0YWwudXJsS2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHVybCA9IGAvLyR7cG9ydGFsSXRlbS5wb3J0YWwudXJsS2V5fS4ke3BvcnRhbEl0ZW0ucG9ydGFsLmN1c3RvbUJhc2VVcmx9L2hvbWUvaXRlbS5odG1sP2lkPSR7cG9ydGFsSXRlbS5pZH0mc3VibGF5ZXI9JHtsYXllci5sYXllcklkfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSBgLy8ke3BvcnRhbEl0ZW0ucG9ydGFsLnBvcnRhbEhvc3RuYW1lfS9ob21lL2l0ZW0uaHRtbD9pZD0ke3BvcnRhbEl0ZW0uaWR9JnN1YmxheWVyPSR7bGF5ZXIubGF5ZXJJZH1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHVybCA9IGAke2xheWVyLnVybH0vJHtsYXllci5sYXllcklkfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aW5kb3cub3Blbih1cmwpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNhdmVMYXllciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlU2F2ZUxheWVyQ2xpY2suZW1pdChsYXllci5pZCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2F2ZUFzTGF5ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVNhdmVBc0xheWVyQ2xpY2suZW1pdChsYXllci5pZCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZHVwbGljYXRlTGF5ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgeyBsYXllciB9ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZUR1cGxpY2F0ZUNsaWNrLmVtaXQobGF5ZXIuaWQpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9wZW5TdGF0dXMgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyUGFuZWxOb2RlLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbGF5ZXIgc3RhdHVzIGZsb2F0aW5nIHBhbmVsXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXNQb3BvdmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzUG9wb3Zlci5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgb3BlbiwgaGlkZSBpdFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c1BvcG92ZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnN0YXR1c1BvcG92ZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c1BvcG92ZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBnb3QgY2xvc2VkIGJ5IHNvbWV0aGluZyBvdXRzaWRlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzUG9wb3ZlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjcm9sbEludG9WaWV3KHRoaXMuc291cmNlTm9kZSk7XG4gICAgICAgICAgICBjb25zdCB7IHByb3BzLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgcG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtbGF5ZXItb3ZlcnJpZGUtc3RhdHVzXCIpO1xuICAgICAgICAgICAgcG9wb3Zlci5wcm9wcyA9IHByb3BzO1xuICAgICAgICAgICAgcG9wb3Zlci5zdHJpbmdzID0gc3RyaW5ncztcbiAgICAgICAgICAgIHBvcG92ZXIucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLnNvdXJjZU5vZGU7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcG92ZXIpO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNQb3BvdmVyID0gcG9wb3ZlcjtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcih0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vcGVuTWFuYWdlUHJvcHMgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBtYW5hZ2UgbGF5ZXIgcHJvcGVydGllcyBmbG9hdGluZyBwYW5lbFxuICAgICAgICAgICAgLy8gbGF5ZXIgc3RhdHVzIGZsb2F0aW5nIHBhbmVsXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzUG9wb3Zlcikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BlcnRpZXNQb3BvdmVyLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxyZWFkeSBvcGVuLCBoaWRlIGl0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydGllc1BvcG92ZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnByb3BlcnRpZXNQb3BvdmVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzUG9wb3ZlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdvdCBjbG9zZWQgYnkgc29tZXRoaW5nIG91dHNpZGVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzUG9wb3ZlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjcm9sbEludG9WaWV3KHRoaXMuc291cmNlTm9kZSk7XG4gICAgICAgICAgICBjb25zdCB7IHByb3BzLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgcG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtbGF5ZXItb3ZlcnJpZGUtcHJvcGVydGllc1wiKTtcbiAgICAgICAgICAgIHBvcG92ZXIucHJvcHMgPSBwcm9wcztcbiAgICAgICAgICAgIHBvcG92ZXIuc3RyaW5ncyA9IHN0cmluZ3M7XG4gICAgICAgICAgICBwb3BvdmVyLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50ID0gdGhpcy5zb3VyY2VOb2RlO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwb3BvdmVyKTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllc1BvcG92ZXIgPSBwb3BvdmVyO1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKHRydWUpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVSZW5kZXIgPSBmYWxzZTtcbiAgICB9XG4gICAgY2xvc2VBbGxQb3BvdmVyc0hhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICAgIH1cbiAgICBhcmNnaXNMYXllck92ZXJyaWRlUHJvcENoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlQ2hhbmdlLmVtaXQoKTtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgIH1cbiAgICBhcmNnaXNMYXllck92ZXJyaWRlU3RhdHVzQ2hhbmdlKCkge1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBwdWJsaWMgY2FsbHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvKipcbiAgICAgKiBTZXQgZm9jdXMgb24gY29tcG9uZW50XG4gICAgICovXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7IH1cbiAgICAvKipcbiAgICAgKiBDbG9zZSBwb3BvdmVycyBiZWZvcmUgcmVtb3ZpbmcgY29tcG9uZW50XG4gICAgICovXG4gICAgYXN5bmMgZG9uZSgpIHtcbiAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXJzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggY29udGVudCwgZS5nLiBhZnRlciBsYXllciBwcm9wZXJ0aWVzIGNoYW5nZXNcbiAgICAgKi9cbiAgICBhc3luYyByZWZyZXNoKCkge1xuICAgICAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gICAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBbc3RyaW5nc10gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzO1xuICAgICAgICAvLyBidWlsZCBMYXllck92ZXJyaWRlUHJvcHNcbiAgICAgICAgdGhpcy5wcm9wcyA9IHtcbiAgICAgICAgICAgIGxheWVyOiB0aGlzLmxheWVyLFxuICAgICAgICAgICAgcG9ydGFsOiB0aGlzLnBvcnRhbCxcbiAgICAgICAgICAgIGNvbmZpZzogdGhpcy5jb25maWdcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgW2xheWVyT3JpZ2luVXRpbHNdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9sYXllcnMvc3VwcG9ydC9sYXllck9yaWdpblV0aWxzXCJdKTtcbiAgICAgICAgdGhpcy5wcm9wcy5sYXllck9yaWdpblV0aWxzID0gbGF5ZXJPcmlnaW5VdGlscztcbiAgICAgICAgbGF5ZXJPcmlnaW5VdGlscy5pc1N1cHBvcnRlZExheWVyKHRoaXMubGF5ZXIpO1xuICAgICAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gb25jZSBjb21wb25lbnQgaXMgdmlzaWJsZSBtYWtlIG90aGVyIGNhbGxzXG4gICAgICAgIHRoaXMuY29udGFpbmVyUGFuZWxOb2RlID0gcXVlcnlQYXJlbnRFbGVtZW50KHRoaXMuaG9zdEVsZW1lbnQsIFwiY2FsY2l0ZS1wYW5lbFwiKTtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lclBhbmVsTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXJQYW5lbE5vZGUgPSBxdWVyeVBhcmVudEVsZW1lbnQodGhpcy5ob3N0RWxlbWVudCwgXCJjYWxjaXRlLWZsb3ctaXRlbVwiKTtcbiAgICAgICAgfVxuICAgICAgICAoX2EgPSB0aGlzLmNvbnRhaW5lclBhbmVsTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFkZEV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlUGFuZWxTY3JvbGxcIiwgdGhpcy5vblBhbmVsU2Nyb2xsKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5jb250YWluZXJQYW5lbE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2FsY2l0ZVBhbmVsU2Nyb2xsXCIsIHRoaXMub25QYW5lbFNjcm9sbCk7XG4gICAgICAgIHRoaXMuY2xvc2VQb3BvdmVycygpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImRpdlwiLCB7IGNsYXNzOiBDU1MkMi5jb250YWluZXIgfSwgdGhpcy5yZW5kZXJTb3VyY2UoKSwgdGhpcy5yZW5kZXJDb3B5KCksIHRoaXMucmVuZGVyU3RhdHVzKCksIHRoaXMucmVuZGVyUHJvcGVydGllcygpKSkpO1xuICAgIH1cbiAgICByZW5kZXJTb3VyY2UoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgaXRlbVRpdGxlID0gKF9hID0gbGF5ZXIucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpdGxlO1xuICAgICAgICBjb25zdCBsYXllclRpdGxlID0gbGF5ZXIudGl0bGU7XG4gICAgICAgIGNvbnN0IHJ0bCA9IGdldEVsZW1lbnREaXIodGhpcy5ob3N0RWxlbWVudCkgPT09IFwicnRsXCI7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVTb3VyY2UgfSwgc3RyaW5ncy5zb3VyY2VMYXllciwgaChcImNhbGNpdGUtdGlsZVwiLCB7IGNsYXNzOiBDU1MkMi5kZXRhaWxzLCBoZWFkaW5nOiBpdGVtVGl0bGUgJiYgaXRlbVRpdGxlICE9PSBsYXllclRpdGxlXG4gICAgICAgICAgICAgICAgPyBydGxcbiAgICAgICAgICAgICAgICAgICAgPyBgJHtsYXllclRpdGxlfSAvICR7aXRlbVRpdGxlfWBcbiAgICAgICAgICAgICAgICAgICAgOiBgJHtpdGVtVGl0bGV9IC8gJHtsYXllclRpdGxlfWBcbiAgICAgICAgICAgICAgICA6IGxheWVyVGl0bGUsIGRlc2NyaXB0aW9uOiBsYXllci5pc1RhYmxlID8gXCJUYWJsZVwiIDogXCJGZWF0dXJlIGxheWVyXCIsIG9uQ2xpY2s6IHRoaXMub3BlbkRldGFpbHMgfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2NhbGU6IFwic1wiLCBjb21wYWN0OiB0cnVlLCBzbG90OiBcImNvbnRlbnQtZW5kXCIsIGljb246IFwibGF1bmNoXCIsIHRleHQ6IHN0cmluZ3Muc291cmNlTGF5ZXIsIG9uQ2xpY2s6IHRoaXMub3BlbkRldGFpbHMgfSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckNvcHkoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciwgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgcG9ydGFsIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3QgY2FuQ3JlYXRlSXRlbXMgPSB0aGlzLmNhbkNyZWF0ZUl0ZW1zKHBvcnRhbCA9PT0gbnVsbCB8fCBwb3J0YWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcnRhbC51c2VyKTtcbiAgICAgICAgY29uc3QgY2FuU2F2ZSA9IFtcImFkbWluXCIsIFwidXBkYXRlXCJdLmluZGV4T2YoKF9hID0gbGF5ZXIucG9ydGFsSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLml0ZW1Db250cm9sKSA+IC0xO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDIuYnV0dG9ucyB9LCBjYW5TYXZlICYmIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyB3aWR0aDogXCJmdWxsXCIsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBpY29uU3RhcnQ6IFwic2F2ZVwiLCBjbGFzczogQ1NTJDIudG9wQnV0dG9uLCBsYWJlbDogc3RyaW5ncy5zYXZlLCBvbkNsaWNrOiB0aGlzLnNhdmVMYXllciB9LCBzdHJpbmdzLnNhdmUpKSwgY2FuQ3JlYXRlSXRlbXMgJiYgKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHdpZHRoOiBcImZ1bGxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwga2luZDogXCJuZXV0cmFsXCIsIGljb25TdGFydDogXCJzYXZlXCIsIGNsYXNzOiBDU1MkMi50b3BCdXR0b24sIGxhYmVsOiBzdHJpbmdzLnNhdmVBcywgb25DbGljazogdGhpcy5zYXZlQXNMYXllciB9LCBzdHJpbmdzLnNhdmVBcykpLCAhbGF5ZXIuaXNUYWJsZSAmJiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgd2lkdGg6IFwiZnVsbFwiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgaWNvblN0YXJ0OiBcImR1cGxpY2F0ZVwiLCBsYWJlbDogc3RyaW5ncy5kdXBsaWNhdGUsIG9uQ2xpY2s6IHRoaXMuZHVwbGljYXRlTGF5ZXIgfSwgc3RyaW5ncy5kdXBsaWNhdGUpKSkpO1xuICAgIH1cbiAgICByZW5kZXJTdGF0dXMoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgbGF5ZXIsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyT3JpZ2luSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbm90aWNlXCIsIHsgY2xhc3M6IENTUyQyLnByb3BlcnRpZXMsIHdpZHRoOiBcImZ1bGxcIiwgc2NhbGU6IFwic1wiLCBvcGVuOiB0cnVlLCBvbkNsaWNrOiB0aGlzLm9wZW5TdGF0dXMgfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwidGl0bGVcIiB9LCBsYXllck9yaWdpbkluZm8uc3RhdHVzID09PSBcInNvdXJjZVwiXG4gICAgICAgICAgICA/IHN0cmluZ3MucHJvcHNGcm9tU291cmNlXG4gICAgICAgICAgICA6IGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwib3ZlcnJpZGRlblwiXG4gICAgICAgICAgICAgICAgPyBzdHJpbmdzLnByb3BzU2V0SW5XZWJtYXBcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3Muc29tZVByb3BzU2V0SW5XZWJtYXApLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIGljb246IFwiaW5mb3JtYXRpb25cIiwgc2NhbGU6IFwic1wiLCBjb21wYWN0OiB0cnVlLCBjbGFzczogQ1NTJDIucHJvcGVydGllc0ljb24sIHRleHQ6IGxheWVyLmlzVGFibGUgPyBzdHJpbmdzLnRhYmxlU3RhdHVzIDogc3RyaW5ncy5sYXllclN0YXR1cywgb25DbGljazogdGhpcy5vcGVuU3RhdHVzLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVTdGF0dXNBY3Rpb24gfSkpKTtcbiAgICB9XG4gICAgcmVuZGVyUHJvcGVydGllcygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBsYXllciB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgd2lkdGg6IFwiZnVsbFwiLCBsYWJlbDogbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MubWFuYWdlVGFibGVQcm9wcyA6IHN0cmluZ3MubWFuYWdlTGF5ZXJQcm9wcywgb25DbGljazogdGhpcy5vcGVuTWFuYWdlUHJvcHMsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVByb3BlcnRpZXNCdXR0b24gfSwgbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MubWFuYWdlVGFibGVQcm9wcyA6IHN0cmluZ3MubWFuYWdlTGF5ZXJQcm9wcykpO1xuICAgIH1cbiAgICBjbG9zZVBvcG92ZXJzKCkge1xuICAgICAgICB0aGlzLmNsb3NlU3RhdHVzUG9wb3ZlcigpO1xuICAgICAgICB0aGlzLmNsb3NlUHJvcGVydGllc1BvcG92ZXIoKTtcbiAgICAgICAgdGhpcy5kaXNhYmxlQ29udGFpbmVyKGZhbHNlKTtcbiAgICB9XG4gICAgY2xvc2VTdGF0dXNQb3BvdmVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLnN0YXR1c1BvcG92ZXIpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMuc3RhdHVzUG9wb3Zlci5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlQ2hpbGQodGhpcy5zdGF0dXNQb3BvdmVyKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzUG9wb3ZlciA9IG51bGw7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNBY3Rpb25Ob2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlUHJvcGVydGllc1BvcG92ZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKHRoaXMucHJvcGVydGllc1BvcG92ZXIpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMucHJvcGVydGllc1BvcG92ZXIucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHRoaXMucHJvcGVydGllc1BvcG92ZXIpO1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzUG9wb3ZlciA9IG51bGw7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzTm9kZS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzY3JvbGxJbnRvVmlldyhyZWZlcmVuY2VFbGVtZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKCgoX2EgPSByZWZlcmVuY2VFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9wKSA8IDApIHtcbiAgICAgICAgICAgIC8vIGxldCdzIG1ha2Ugc3VyZSBpdCBmdWxseSBzaG93c1xuICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudC5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgICAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgICAgICAgICAgYmxvY2s6IFwibmVhcmVzdFwiLFxuICAgICAgICAgICAgICAgIGlubGluZTogXCJzdGFydFwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHdhaXQgdW50aWwgc2Nyb2xsaW5nIGlzIGRvbmVcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgY29uc3QgaG5kbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAxMCB8fCAoKF9hID0gcmVmZXJlbmNlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvcCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChobmRsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkaXNhYmxlQ29udGFpbmVyKGRpc2FibGUpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyUGFuZWxOb2RlKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclBhbmVsTm9kZS5kaXNhYmxlZCA9IGRpc2FibGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2FuQ3JlYXRlSXRlbXModXNlcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiB1c2VyICYmICh0aGlzLmlzUHVibGljVXNlcih1c2VyKSB8fCAoKF9hID0gdXNlci5wcml2aWxlZ2VzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5jbHVkZXMoXCJwb3J0YWw6dXNlcjpjcmVhdGVJdGVtXCIpKSk7XG4gICAgfVxuICAgIGlzUHVibGljVXNlcih1c2VyKSB7XG4gICAgICAgIHJldHVybiAhdXNlci5vcmdJZDtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xheWVyT3ZlcnJpZGUuc3R5bGUgPSBhcmNnaXNMYXllck92ZXJyaWRlQ3NzO1xuXG5jb25zdCBDU1MkMSA9IHtcbiAgICBwb3BvdmVyOiBcInBvcG92ZXJcIixcbiAgICBjb250ZW50OiBcImNvbnRlbnRcIixcbiAgICBub3RpY2U6IFwibm90aWNlXCIsXG4gICAgdGlsZTogXCJ0aWxlXCIsXG4gICAgdG9vbHRpcDogXCJ0b29sdGlwXCJcbn07XG5cbmNvbnN0IGFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wZXJ0aWVzQ3NzID0gXCIucG9wb3Zlcnt6LWluZGV4OjEwMH0uY29udGVudHtwYWRkaW5nOjAuNXJlbSAwLjc1cmVtO2JhY2tncm91bmQtY29sb3I6I2ZmZmZmZjttYXgtaGVpZ2h0Ojgwdmh9Lm5vdGljZXttYXJnaW4tYm90dG9tOjE2cHh9LnRpbGV7Y3Vyc29yOnBvaW50ZXJ9LnRvb2x0aXB7bWF4LXdpZHRoOjgwJX1cIjtcblxuY29uc3QgQXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmNsb3NlQWxsUG9wb3ZlcnMgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNsb3NlQWxsUG9wb3ZlcnNcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXNDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wZXJ0aWVzQ2hhbmdlXCIsIDcpO1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVQb3BvdmVyID0gKG5vZGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBub2RlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFmdGVyQ3JlYXRlQ2xvc2VCdXR0b24gPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZUJ1dHRvbk5vZGUgPSBub2RlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNsb3NlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlQWxsUG9wb3ZlcnMuZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlc2V0VG9Tb3VyY2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgbGF5ZXIsIGxheWVyT3JpZ2luVXRpbHMgfSA9IHByb3BzO1xuICAgICAgICAgICAgbGF5ZXJPcmlnaW5VdGlscy5jbGVhck92ZXJyaWRlcyhsYXllciwgXCJ3ZWItbWFwXCIpO1xuICAgICAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNMYXllck92ZXJyaWRlUHJvcGVydGllc0NoYW5nZS5lbWl0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGlzY29ubmVjdFByb3BzID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxheWVyLCBsYXllck9yaWdpblV0aWxzIH0gPSBwcm9wcztcbiAgICAgICAgICAgIGxheWVyT3JpZ2luVXRpbHMuZGlzY29ubmVjdEZyb21Tb3VyY2UobGF5ZXIsIFwid2ViLW1hcFwiKTtcbiAgICAgICAgICAgIHRoaXMucmVSZW5kZXIgPSAhdGhpcy5yZVJlbmRlcjtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXNDaGFuZ2UuZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnByb3BzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvcG92ZXJSZWZlcmVuY2VFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVSZW5kZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIHB1YmxpYyBjYWxsc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8qKlxuICAgICAqIFJlcG9zaXRpb25zIHBvcG92ZXJcbiAgICAgKi9cbiAgICBhc3luYyByZXBvc2l0aW9uKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBvc2l0aW9uKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxzIGdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIG9uIHBvcG92ZXJcbiAgICAgKi9cbiAgICBhc3luYyBnZXRQb3BvdmVyUmVjdCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gdGhpcy5wb3BvdmVyTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5yZXBvc2l0aW9uKCk7XG4gICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICAgICAgLy8gbmVlZCB0aW1lb3V0IGJlY2F1c2Ugb2YgcmUtcmVuZGVyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuY2xvc2VCdXR0b25Ob2RlLnNldEZvY3VzKCkpLCAxMDApO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQsIHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3Qgbm9kZVdpZHRoID0gcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICAgIC8vIGxldCB0aGUgcG9wb3ZlciBzdGFydCBhdCB0aGUgdG9wIG9mIHRoZSByZWZlcmVuY2UgZWxlbWVudFxuICAgICAgICBjb25zdCBvZmZzZXREaXN0YW5jZSA9IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LmNsaWVudEhlaWdodCB8fFxuICAgICAgICAgICAgKChfYSA9IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaGVpZ2h0KSB8fFxuICAgICAgICAgICAgOTY7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCB7IGNsYXNzOiBcImpzLWFwcC1mbHlvdXRcIiB9LCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgcGxhY2VtZW50OiBcImJvdHRvbVwiLCBkaXI6IGRvY3VtZW50LmRpciwgb3BlbjogdGhpcy5pc09wZW4sIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogcG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQsIG9mZnNldERpc3RhbmNlOiAtMSAqIG9mZnNldERpc3RhbmNlLCBvZmZzZXRTa2lkZGluZzogMCwgY2xhc3M6IENTUyQxLnBvcG92ZXIsIHN0eWxlOiBub2RlV2lkdGhcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGAke25vZGVXaWR0aCArIDYwfXB4YFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IG51bGwsIGxhYmVsOiBsYXllci5pc1RhYmxlID8gc3RyaW5ncy5tYW5hZ2VUYWJsZVByb3BzIDogc3RyaW5ncy5tYW5hZ2VMYXllclByb3BzLCByZWY6IHRoaXMuYWZ0ZXJDcmVhdGVQb3BvdmVyLCBvbkNhbGNpdGVQb3BvdmVyQmVmb3JlQ2xvc2U6ICgpID0+IHRoaXMuY2xvc2VBbGxQb3BvdmVycy5lbWl0KCkgfSwgaChcImNhbGNpdGUtZmxvd1wiLCB7IHN0eWxlOiBub2RlV2lkdGhcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGAke25vZGVXaWR0aCArIDU4fXB4YFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IG51bGwgfSwgaChcImNhbGNpdGUtZmxvdy1pdGVtXCIsIHsgaGVhZGluZzogbGF5ZXIuaXNUYWJsZSA/IHN0cmluZ3MubWFuYWdlVGFibGVQcm9wcyA6IHN0cmluZ3MubWFuYWdlTGF5ZXJQcm9wcyB9LCB0aGlzLnJlbmRlckNsb3NlQnV0dG9uKCksIHRoaXMucmVuZGVyQ29udGVudCgpKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckNsb3NlQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jbG9zZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImhlYWRlci1hY3Rpb25zLWVuZFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsb3NlQ2xpY2ssIHJlZjogdGhpcy5hZnRlckNyZWF0ZUNsb3NlQnV0dG9uLCBpY29uOiBcInhcIiB9KSk7XG4gICAgfVxuICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHByb3BzO1xuICAgICAgICAvLyBhbHdheXMgbWFrZSBhIG5ldyBjYWxsIGluIGNhc2UgdGhpbmdzIGhhdmUgY2hhbmdlZFxuICAgICAgICBnZXRMYXllck9yaWdpbkluZm8ocHJvcHMpO1xuICAgICAgICBjb25zdCB7IGxheWVyT3JpZ2luSW5mbyB9ID0gcHJvcHM7XG4gICAgICAgIGNvbnN0IHJlc2V0VG9Tb3VyY2VEaXNhYmxlZCA9IGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwic291cmNlXCI7XG4gICAgICAgIGNvbnN0IGRpc2Nvbm5lY3REaXNhYmxlZCA9IGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwib3ZlcnJpZGRlblwiO1xuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDEuY29udGVudCB9LCBoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogQ1NTJDEubm90aWNlLCB3aWR0aDogXCJmdWxsXCIsIHNjYWxlOiBcInNcIiwgb3BlbjogdHJ1ZSB9LCBoKFwiZGl2XCIsIHsgc2xvdDogXCJ0aXRsZVwiIH0sIGxheWVyT3JpZ2luSW5mby5zdGF0dXMgPT09IFwic291cmNlXCJcbiAgICAgICAgICAgID8gc3RyaW5ncy5wcm9wc0Zyb21Tb3VyY2VcbiAgICAgICAgICAgIDogbGF5ZXJPcmlnaW5JbmZvLnN0YXR1cyA9PT0gXCJvdmVycmlkZGVuXCJcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucHJvcHNTZXRJbldlYm1hcFxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy5zb21lUHJvcHNTZXRJbldlYm1hcCkpLCBoKFwiZGl2XCIsIHsgaWQ6IFwibGF5ZXItb3ZlcnJpZGUtcmVzZXRcIiB9LCBoKFwiY2FsY2l0ZS10aWxlXCIsIHsgaGVhZGluZzogc3RyaW5ncy5yZXNldFRvU291cmNlLCBkZXNjcmlwdGlvbjogc3RyaW5ncy5kaXNjYXJkUHJvcHMsIGNsYXNzOiBDU1MkMS50aWxlLCBkaXNhYmxlZDogcmVzZXRUb1NvdXJjZURpc2FibGVkLCBvbkNsaWNrOiAhcmVzZXRUb1NvdXJjZURpc2FibGVkID8gdGhpcy5yZXNldFRvU291cmNlIDogbnVsbCB9LCByZXNldFRvU291cmNlRGlzYWJsZWQgPyAoaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGljb246IFwicmVzZXRcIiB9KSkgOiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2NhbGU6IFwic1wiLCBjb21wYWN0OiB0cnVlLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgaWNvbjogXCJyZXNldFwiLCB0ZXh0OiBzdHJpbmdzLnJlc2V0VG9Tb3VyY2UsIG9uQ2xpY2s6ICFyZXNldFRvU291cmNlRGlzYWJsZWQgPyB0aGlzLnJlc2V0VG9Tb3VyY2UgOiBudWxsIH0pKSkpLCBoKFwiZGl2XCIsIHsgaWQ6IFwibGF5ZXItb3ZlcnJpZGUtZGlzY29ubmVjdFwiIH0sIGgoXCJjYWxjaXRlLXRpbGVcIiwgeyBoZWFkaW5nOiBsYXllci5pc1RhYmxlID8gc3RyaW5ncy5kaXNjb25uZWN0UHJvcHNUYWJsZSA6IHN0cmluZ3MuZGlzY29ubmVjdFByb3BzLCBkZXNjcmlwdGlvbjogc3RyaW5ncy5zZXRQcm9wc0luV2VibWFwLCBjbGFzczogQ1NTJDEudGlsZSwgZGlzYWJsZWQ6IGRpc2Nvbm5lY3REaXNhYmxlZCwgb25DbGljazogIWRpc2Nvbm5lY3REaXNhYmxlZCA/IHRoaXMuZGlzY29ubmVjdFByb3BzIDogbnVsbCB9LCBkaXNjb25uZWN0RGlzYWJsZWQgPyAoaChcImNhbGNpdGUtaWNvblwiLCB7IHNjYWxlOiBcInNcIiwgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGljb246IFwidW5saW5rXCIgfSkpIDogKGgoXCJjYWxjaXRlLWFjdGlvblwiLCB7IHNjYWxlOiBcInNcIiwgY29tcGFjdDogdHJ1ZSwgc2xvdDogXCJjb250ZW50LXN0YXJ0XCIsIGljb246IFwidW5saW5rXCIsIHRleHQ6IHN0cmluZ3MuZGlzY29ubmVjdFByb3BzLCBvbkNsaWNrOiAhZGlzY29ubmVjdERpc2FibGVkID8gdGhpcy5kaXNjb25uZWN0UHJvcHMgOiBudWxsIH0pKSkpLCByZXNldFRvU291cmNlRGlzYWJsZWQgJiYgKGgoXCJjYWxjaXRlLXRvb2x0aXBcIiwgeyBjbGFzczogQ1NTJDEudG9vbHRpcCwgcGxhY2VtZW50OiBcInRvcFwiLCBvZmZzZXREaXN0YW5jZTogLTUwLCBvdmVybGF5UG9zaXRpb25pbmc6IFwiZml4ZWRcIiwgcmVmZXJlbmNlRWxlbWVudDogXCJsYXllci1vdmVycmlkZS1yZXNldFwiLCBsYWJlbDogc3RyaW5ncy5wcm9wc0Nhbm5vdEJlUmVzZXQgfSwgc3RyaW5ncy5wcm9wc0Nhbm5vdEJlUmVzZXQpKSwgZGlzY29ubmVjdERpc2FibGVkICYmIChoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgY2xhc3M6IENTUyQxLnRvb2x0aXAsIHBsYWNlbWVudDogXCJ0b3BcIiwgb2Zmc2V0RGlzdGFuY2U6IC01MCwgb3ZlcmxheVBvc2l0aW9uaW5nOiBcImZpeGVkXCIsIHJlZmVyZW5jZUVsZW1lbnQ6IFwibGF5ZXItb3ZlcnJpZGUtZGlzY29ubmVjdFwiLCBsYWJlbDogc3RyaW5ncy5wcm9wc0Nhbm5vdEJlRGlzY29ubmVjdGVkIH0sIHN0cmluZ3MucHJvcHNDYW5ub3RCZURpc2Nvbm5lY3RlZCkpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNMYXllck92ZXJyaWRlUHJvcGVydGllcy5zdHlsZSA9IGFyY2dpc0xheWVyT3ZlcnJpZGVQcm9wZXJ0aWVzQ3NzO1xuXG5jb25zdCBDU1MgPSB7XG4gICAgcG9wb3ZlcjogXCJwb3BvdmVyXCIsXG4gICAgY29udGVudDogXCJjb250ZW50XCIsXG4gICAgbm90aWNlOiBcIm5vdGljZVwiLFxuICAgIGZpbHRlcjogXCJmaWx0ZXJcIixcbiAgICBibG9ja0NvbnRlbnQ6IFwiYmxvY2stY29udGVudFwiLFxuICAgIGxpc3RIZWFkZXI6IFwibGlzdC1oZWFkZXJcIlxufTtcblxuY29uc3QgYXJjZ2lzTGF5ZXJPdmVycmlkZVN0YXR1c0NzcyA9IFwiLnBvcG92ZXJ7ei1pbmRleDoxMDB9LmNvbnRlbnR7bWF4LWhlaWdodDo2MHZofS5ub3RpY2V7bWFyZ2luOjhweH0uZmlsdGVye2JvcmRlci13aWR0aDowcHggMHB4IDFweDtib3JkZXItY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMyk7Ym9yZGVyLXN0eWxlOnNvbGlkfS5ibG9jay1jb250ZW50e2JhY2tncm91bmQtY29sb3I6dmFyKC0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTIpfS5saXN0LWhlYWRlcntwYWRkaW5nOjAuNzVyZW0gMC41cmVtIDAuMjVyZW0gMC41cmVtfVwiO1xuXG5jb25zdCBBcmNnaXNMYXllck92ZXJyaWRlU3RhdHVzID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5jbG9zZUFsbFBvcG92ZXJzID0gY3JlYXRlRXZlbnQodGhpcywgXCJjbG9zZUFsbFBvcG92ZXJzXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXNDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXNDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRUYWJIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsbEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuZGF0YVR5cGVzID0gW1xuICAgICAgICAgICAgXCJkYXRhXCIsXG4gICAgICAgICAgICBcImRlZmluaXRpb24tZXhwcmVzc2lvblwiLFxuICAgICAgICAgICAgXCJwb3B1cFwiLFxuICAgICAgICAgICAgXCJyZWZyZXNoLWludGVydmFsXCIsXG4gICAgICAgICAgICBcInVzZS12aWV3LXRpbWVcIixcbiAgICAgICAgICAgIC8vXCJlZGl0aW5nLWVuYWJsZWRcIixcbiAgICAgICAgICAgIFwiZm9ybS10ZW1wbGF0ZVwiLFxuICAgICAgICAgICAgXCJmbG9vci1pbmZvXCIsXG4gICAgICAgICAgICBcImN1c3RvbS1wYXJhbWV0ZXJzXCIsXG4gICAgICAgICAgICBcImNoYXJ0c1wiXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuYXBwZWFyYW5jZVR5cGVzID0gW1xuICAgICAgICAgICAgXCJyZW5kZXJlclwiLFxuICAgICAgICAgICAgXCJsYWJlbHNcIixcbiAgICAgICAgICAgIFwic2NhbGUtcmFuZ2VcIixcbiAgICAgICAgICAgIFwib3BhY2l0eVwiLFxuICAgICAgICAgICAgXCJmZWF0dXJlLXJlZHVjdGlvblwiLFxuICAgICAgICAgICAgXCJibGVuZC1tb2RlXCIsXG4gICAgICAgICAgICBcImVmZmVjdFwiLFxuICAgICAgICAgICAgXCJsZWdlbmQtZW5hYmxlZFwiLFxuICAgICAgICAgICAgXCJvcmRlci1ieVwiXG4gICAgICAgIF07XG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAgICAgLy9cbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIgPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZSA9IG5vZGU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYWZ0ZXJDcmVhdGVDbG9zZUJ1dHRvbiA9IChub2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlQnV0dG9uTm9kZSA9IG5vZGU7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xvc2VDbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VBbGxQb3BvdmVycy5lbWl0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9wb3ZlclJlZmVyZW5jZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBwdWJsaWMgY2FsbHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvKipcbiAgICAgKiBSZXBvc2l0aW9ucyBwb3BvdmVyXG4gICAgICovXG4gICAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxscyBnZXRCb3VuZGluZ0NsaWVudFJlY3QoKSBvbiBwb3BvdmVyXG4gICAgICovXG4gICAgYXN5bmMgZ2V0UG9wb3ZlclJlY3QoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgcmV0dXJuIChfYSA9IHRoaXMucG9wb3Zlck5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIC8vIGFsd2F5cyBtYWtlIGEgbmV3IGNhbGwgaW4gY2FzZSB0aGluZ3MgaGF2ZSBjaGFuZ2VkXG4gICAgICAgIGNvbnN0IGJlZm9yZVN0YXR1cyA9IChfYSA9IHRoaXMucHJvcHMubGF5ZXJPcmlnaW5JbmZvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdHVzO1xuICAgICAgICBnZXRMYXllck9yaWdpbkluZm8odGhpcy5wcm9wcyk7XG4gICAgICAgIGNvbnN0IGFmdGVyU3RhdHVzID0gKF9iID0gdGhpcy5wcm9wcy5sYXllck9yaWdpbkluZm8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zdGF0dXM7XG4gICAgICAgIGlmIChiZWZvcmVTdGF0dXMgIT09IGFmdGVyU3RhdHVzKSB7XG4gICAgICAgICAgICAvLyByZWZlc2ggbm90aWNlIHRleHRcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzTGF5ZXJPdmVycmlkZVN0YXR1c0NoYW5nZS5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hbGxJdGVtcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJkYXRhXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmRhdGFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiZGVmaW5pdGlvbi1leHByZXNzaW9uXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmZpbHRlclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJwb3B1cFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5wb3B1cHNBbmRBdHRyaWJ1dGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBcInJlZnJlc2gtaW50ZXJ2YWxcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMucmVmcmVzaEludGVydmFsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBcInVzZS12aWV3LXRpbWVcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMudGltZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJlZGl0aW5nLWVuYWJsZWRcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuZWRpdGluZ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJmb3JtLXRlbXBsYXRlXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmZvcm1UZW1wbGF0ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJmbG9vci1pbmZvXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmZsb29ySW5mb1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJjdXN0b20tcGFyYW1ldGVyc1wiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5jdXN0b21QYXJhbWV0ZXJzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBcImNoYXJ0c1wiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5jaGFydHNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwicmVuZGVyZXJcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuc3R5bGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwibGFiZWxzXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZ3Muc3RhdHVzLmxhYmVsc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJzY2FsZS1yYW5nZVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy52aXNpYmxlUmFuZ2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwib3BhY2l0eVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy50cmFuc3BhcmVuY3lcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiZmVhdHVyZS1yZWR1Y3Rpb25cIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuYWdncmVnYXRpb25cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwiYmxlbmQtbW9kZVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5ibGVuZGluZ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJlZmZlY3RcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMuZWZmZWN0c1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogXCJsZWdlbmQtZW5hYmxlZFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBzdHJpbmdzLnN0YXR1cy5sZWdlbmRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IFwib3JkZXItYnlcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5ncy5zdGF0dXMub3JkZXJCeVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICB0aGlzLnBvcG92ZXJOb2RlLnJlcG9zaXRpb24oKTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgICAgICAvLyBuZWVkIHRpbWVvdXQgYmVjYXVzZSBvZiByZS1yZW5kZXJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5jbG9zZUJ1dHRvbk5vZGUuc2V0Rm9jdXMoKSksIDEwMCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudCwgc3RyaW5ncywgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCBub2RlV2lkdGggPSBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICAgICAgY29uc3Qgbm9kZUhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xuICAgICAgICAvLyBsZXQgdGhlIHBvcG92ZXIgc3RhcnQgYXQgdGhlIHRvcCBvZiB0aGUgcmVmZXJlbmNlIGVsZW1lbnRcbiAgICAgICAgY29uc3Qgb2Zmc2V0RGlzdGFuY2UgPSBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudC5jbGllbnRIZWlnaHQgfHxcbiAgICAgICAgICAgICgoX2EgPSBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmhlaWdodCkgfHxcbiAgICAgICAgICAgIDk2O1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHBsYWNlbWVudDogXCJib3R0b21cIiwgZGlyOiBkb2N1bWVudC5kaXIsIG9wZW46IHRoaXMuaXNPcGVuLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHBvcG92ZXJSZWZlcmVuY2VFbGVtZW50LCBvZmZzZXREaXN0YW5jZTogLTEgKiBvZmZzZXREaXN0YW5jZSwgb2Zmc2V0U2tpZGRpbmc6IDAsIGNsYXNzOiBDU1MucG9wb3Zlciwgc3R5bGU6IG5vZGVXaWR0aFxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogYCR7bm9kZVdpZHRoICsgNjB9cHhgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDogbnVsbCwgbGFiZWw6IFwiXCIsIHJlZjogdGhpcy5hZnRlckNyZWF0ZVBvcG92ZXIsIG9uQ2FsY2l0ZVBvcG92ZXJCZWZvcmVDbG9zZTogKCkgPT4gdGhpcy5jbG9zZUFsbFBvcG92ZXJzLmVtaXQoKSB9LCBoKFwiY2FsY2l0ZS1mbG93XCIsIHsgc3R5bGU6IG5vZGVXaWR0aFxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogYCR7bm9kZVdpZHRoICsgNTh9cHhgLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IGAke25vZGVIZWlnaHQgKiAwLjd9cHhgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDogbnVsbCB9LCBoKFwiY2FsY2l0ZS1mbG93LWl0ZW1cIiwgeyBoZWFkaW5nOiBsYXllci5pc1RhYmxlID8gc3RyaW5ncy50YWJsZVN0YXR1cyA6IHN0cmluZ3MubGF5ZXJTdGF0dXMsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlRmxvd0l0ZW1TY3JvbGxcIiwgKCkgPT4gdGhpcy5jbG9zZUluZm9Qb3BvdmVyKCkpO1xuICAgICAgICAgICAgfSB9LCB0aGlzLnJlbmRlckNsb3NlQnV0dG9uKCksIHRoaXMucmVuZGVyQ29udGVudCgpKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckNsb3NlQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgdGV4dDogc3RyaW5ncy5jbG9zZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImhlYWRlci1hY3Rpb25zLWVuZFwiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsb3NlQ2xpY2ssIHJlZjogdGhpcy5hZnRlckNyZWF0ZUNsb3NlQnV0dG9uLCBpY29uOiBcInhcIiB9KSk7XG4gICAgfVxuICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MuY29udGVudCB9LCB0aGlzLnJlbmRlckluZm8oKSwgdGhpcy5yZW5kZXJTZWFyY2goKSwgdGhpcy5yZW5kZXJEYXRhQ29udGVudCgpLCB0aGlzLnJlbmRlckFwcGVhcmFuY2VDb250ZW50KCkpKTtcbiAgICB9XG4gICAgcmVuZGVySW5mbygpIHtcbiAgICAgICAgY29uc3QgeyBwcm9wcywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjb25maWcgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCB7IGhlbHBCYXNlLCBoZWxwTWFwIH0gPSBjb25maWc7XG4gICAgICAgIGlmIChnZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UobG9jYWxTdG9yYWdlS2V5cy5BUkNHSVNfQ09NUE9ORU5UX05PVElGSUNBVElPTlMsIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLkxBWUVSX09WRVJSSURFX1NUQVRVU19USVBfRElTTUlTU0VEKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogQ1NTLm5vdGljZSwgb3BlbjogdHJ1ZSwgY2xvc2FibGU6IHRydWUsIHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiYXV0b1wiLCBvbkNhbGNpdGVOb3RpY2VDbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXlzLkFSQ0dJU19DT01QT05FTlRfTk9USUZJQ0FUSU9OUywge1xuICAgICAgICAgICAgICAgICAgICBrZXk6IGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzLkxBWUVSX09WRVJSSURFX1NUQVRVU19USVBfRElTTUlTU0VELFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJ0cnVlXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gfSwgaChcImRpdlwiLCB7IHNsb3Q6IFwibWVzc2FnZVwiIH0sIHN0cmluZ3MudGlwKSwgaChcImNhbGNpdGUtbGlua1wiLCB7IHNsb3Q6IFwibGlua1wiLCB0aXRsZTogc3RyaW5ncy5sZWFybk1vcmUsIHRhcmdldDogXCJfYmxhbmtcIiwgaHJlZjogYCR7aGVscEJhc2V9JHtoZWxwTWFwW1wiMTIwMDAyOTEzXCJdfWAgfSwgc3RyaW5ncy5sZWFybk1vcmUpKSk7XG4gICAgfVxuICAgIHJlbmRlclNlYXJjaCgpIHtcbiAgICAgICAgY29uc3QgeyBhbGxJdGVtcywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1maWx0ZXJcIiwgeyBpdGVtczogYWxsSXRlbXMsIG1lc3NhZ2VPdmVycmlkZXM6IHsgbGFiZWw6IHN0cmluZ3Muc3RhdHVzLnNlYXJjaFBsYWNlaG9sZGVyLCBjbGVhcjogc3RyaW5ncy5zdGF0dXMuY2xlYXIgfSwgcGxhY2Vob2xkZXI6IHN0cmluZ3Muc3RhdHVzLnNlYXJjaFBsYWNlaG9sZGVyLCBjbGFzczogQ1NTLmZpbHRlciwgb25DYWxjaXRlRmlsdGVyQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBldmVudC50YXJnZXQuZmlsdGVyZWRJdGVtcztcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFCbG9ja05vZGUub3BlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwZWFyYW5jZUJsb2NrTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVhcmFuY2VCbG9ja05vZGUub3BlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9IH0pKTtcbiAgICB9XG4gICAgcmVuZGVyRGF0YUNvbnRlbnQoKSB7XG4gICAgICAgIGNvbnN0IHsgYWxsSXRlbXMsIGZpbHRlcmVkSXRlbXMsIGRhdGFUeXBlcywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgbGV0IGl0ZW1zID0gKGZpbHRlcmVkSXRlbXMgfHwgYWxsSXRlbXMpXG4gICAgICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiBkYXRhVHlwZXMuaW5kZXhPZihpdGVtLnZhbHVlKSA+IC0xKVxuICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IFwiZGF0YVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gZGF0YSBpcyBuZXZlciBvdmVycmlkZGVuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtpdGVtLnRpdGxlLCBcInNvdXJjZVwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBbaXRlbS50aXRsZSwgdGhpcy5nZXRPdmVycmlkZVR5cGUoaXRlbS52YWx1ZSldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaXRlbXMuc29ydCgoYSwgYikgPT4gYVswXS5sb2NhbGVDb21wYXJlKGJbMF0pKTtcbiAgICAgICAgLy8gbW92ZSBcImRhdGFcIiB0byBiZWdpbm5pbmcgb2YgbGlzdDsgdW5sZXNzIGl0J3MgZmlsdGVyZWQgb3V0XG4gICAgICAgIGNvbnN0IGRhdGFJdGVtID0gaXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbVswXSA9PT0gc3RyaW5ncy5zdGF0dXMuZGF0YSk7XG4gICAgICAgIGlmIChkYXRhSXRlbSkge1xuICAgICAgICAgICAgaXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMF0gIT09IHN0cmluZ3Muc3RhdHVzLmRhdGEpO1xuICAgICAgICAgICAgaXRlbXMudW5zaGlmdChkYXRhSXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMV0gPT09IFwic291cmNlXCIpO1xuICAgICAgICBjb25zdCBtYXBJdGVtcyA9IGl0ZW1zLmZpbHRlcigoaXRlbSkgPT4gaXRlbVsxXSA9PT0gXCJ3ZWJtYXBcIik7XG4gICAgICAgIGNvbnN0IGhhc1NvdXJjZUl0ZW1zID0gc291cmNlSXRlbXMubGVuZ3RoID4gMDtcbiAgICAgICAgY29uc3QgaGFzTWFwSXRlbXMgPSBtYXBJdGVtcy5sZW5ndGggPiAwO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaGFzU291cmNlSXRlbXMgJiYgaGFzTWFwSXRlbXNcbiAgICAgICAgICAgID8gc3RyaW5ncy5zb21lUHJvcHNTZXRJbldlYm1hcFxuICAgICAgICAgICAgOiBoYXNTb3VyY2VJdGVtc1xuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wcm9wc0Zyb21Tb3VyY2VcbiAgICAgICAgICAgICAgICA6IHN0cmluZ3MucHJvcHNTZXRJbldlYm1hcDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGhlYWRpbmc6IHN0cmluZ3Muc3RhdHVzLmRhdGFQcm9wcywgZGVzY3JpcHRpb246IHN1bW1hcnksIGNvbGxhcHNpYmxlOiB0cnVlLCBvcGVuOiBoYXNNYXBJdGVtcywgb25DYWxjaXRlQmxvY2tPcGVuOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3Qgd29yayB3aXRob3V0IHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH0sIG9uQ2FsY2l0ZUJsb2NrQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZG9lc24ndCB3b3JrIHdpdGhvdXQgdGltZW91dFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZGF0YUJsb2NrTm9kZSA9IG5vZGUpIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmJsb2NrQ29udGVudCB9LCBoKFwiY2FsY2l0ZS1saXN0XCIsIG51bGwsIGhhc01hcEl0ZW1zICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBDU1MubGlzdEhlYWRlciwgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Muc2V0SW5XZWJtYXApKSwgaGFzTWFwSXRlbXMgJiYgbWFwSXRlbXMubWFwKChbbGFiZWwsIHR5cGVdKSA9PiB0aGlzLnJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSksIGhhc1NvdXJjZUl0ZW1zICYmIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBDU1MubGlzdEhlYWRlciwgc2NhbGU6IFwic1wiIH0sIHN0cmluZ3Muc2V0RnJvbVNvdXJjZSkpLCBoYXNTb3VyY2VJdGVtcyAmJiBzb3VyY2VJdGVtcy5tYXAoKFtsYWJlbCwgdHlwZV0pID0+IHRoaXMucmVuZGVyTGlzdEl0ZW0obGFiZWwsIHR5cGUpKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckFwcGVhcmFuY2VDb250ZW50KCkge1xuICAgICAgICBjb25zdCB7IGFsbEl0ZW1zLCBmaWx0ZXJlZEl0ZW1zLCBhcHBlYXJhbmNlVHlwZXMsIHN0cmluZ3MsIHByb3BzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBwcm9wcztcbiAgICAgICAgaWYgKGxheWVyLmlzVGFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gKGZpbHRlcmVkSXRlbXMgfHwgYWxsSXRlbXMpXG4gICAgICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiBhcHBlYXJhbmNlVHlwZXMuaW5kZXhPZihpdGVtLnZhbHVlKSA+IC0xKVxuICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gW2l0ZW0udGl0bGUsIHRoaXMuZ2V0T3ZlcnJpZGVUeXBlKGl0ZW0udmFsdWUpXSk7XG4gICAgICAgIGl0ZW1zLnNvcnQoKGEsIGIpID0+IGFbMF0ubG9jYWxlQ29tcGFyZShiWzBdKSk7XG4gICAgICAgIGNvbnN0IHNvdXJjZUl0ZW1zID0gaXRlbXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtWzFdID09PSBcInNvdXJjZVwiKTtcbiAgICAgICAgY29uc3QgbWFwSXRlbXMgPSBpdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMV0gPT09IFwid2VibWFwXCIpO1xuICAgICAgICBjb25zdCBoYXNTb3VyY2VJdGVtcyA9IHNvdXJjZUl0ZW1zLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IGhhc01hcEl0ZW1zID0gbWFwSXRlbXMubGVuZ3RoID4gMDtcbiAgICAgICAgY29uc3Qgc3VtbWFyeSA9IGhhc1NvdXJjZUl0ZW1zICYmIGhhc01hcEl0ZW1zXG4gICAgICAgICAgICA/IHN0cmluZ3Muc29tZVByb3BzU2V0SW5XZWJtYXBcbiAgICAgICAgICAgIDogaGFzU291cmNlSXRlbXNcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucHJvcHNGcm9tU291cmNlXG4gICAgICAgICAgICAgICAgOiBzdHJpbmdzLnByb3BzU2V0SW5XZWJtYXA7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBoZWFkaW5nOiBzdHJpbmdzLnN0YXR1cy5hcHBlYXJhbmNlUHJvcHMsIGRlc2NyaXB0aW9uOiBzdW1tYXJ5LCBjb2xsYXBzaWJsZTogdHJ1ZSwgb3BlbjogaGFzTWFwSXRlbXMsIG9uQ2FsY2l0ZUJsb2NrT3BlbjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IHdvcmsgd2l0aG91dCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9LCBvbkNhbGNpdGVCbG9ja0Nsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3Qgd29yayB3aXRob3V0IHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLmFwcGVhcmFuY2VCbG9ja05vZGUgPSBub2RlKSB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IENTUy5ibG9ja0NvbnRlbnQgfSwgaChcImNhbGNpdGUtbGlzdFwiLCBudWxsLCBoYXNNYXBJdGVtcyAmJiAoaChcImRpdlwiLCB7IGNsYXNzOiBDU1MubGlzdEhlYWRlciB9LCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IHNjYWxlOiBcInNcIiB9LCBzdHJpbmdzLnNldEluV2VibWFwKSkpLCBoYXNNYXBJdGVtcyAmJiBtYXBJdGVtcy5tYXAoKFtsYWJlbCwgdHlwZV0pID0+IHRoaXMucmVuZGVyTGlzdEl0ZW0obGFiZWwsIHR5cGUpKSwgaGFzU291cmNlSXRlbXMgJiYgKGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTLmxpc3RIZWFkZXIgfSwgaChcImNhbGNpdGUtbGFiZWxcIiwgeyBzY2FsZTogXCJzXCIgfSwgc3RyaW5ncy5zZXRGcm9tU291cmNlKSkpLCBoYXNTb3VyY2VJdGVtcyAmJiBzb3VyY2VJdGVtcy5tYXAoKFtsYWJlbCwgdHlwZV0pID0+IHRoaXMucmVuZGVyTGlzdEl0ZW0obGFiZWwsIHR5cGUpKSkpKSk7XG4gICAgfVxuICAgIHJlbmRlckxpc3RJdGVtKGxhYmVsLCB0eXBlKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyBsYWJlbDogbGFiZWwgfSwgaChcImNhbGNpdGUtYWN0aW9uXCIsIHsgc2xvdDogXCJhY3Rpb25zLWVuZFwiLCB0ZXh0OiBzdHJpbmdzLm1vcmVJbmZvLCBpY29uOiBcImluZm9ybWF0aW9uXCIsIG9uQ2xpY2s6IChldmVudCkgPT4gdGhpcy5tb3JlSW5mbyhsYWJlbCwgdHlwZSwgZXZlbnQpIH0pKSk7XG4gICAgfVxuICAgIG1vcmVJbmZvKGxhYmVsLCB0eXBlLCBldmVudCkge1xuICAgICAgICBjb25zdCB7IHBvcG92ZXJOb2RlLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCByZWZlcmVuY2VOb2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgdGhpcy5jbG9zZUluZm9Qb3BvdmVyKCk7XG4gICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgPVxuICAgICAgICAgICAgdHlwZSA9PT0gXCJzb3VyY2VcIlxuICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wcm9wUmVmbGVjdFVwZGF0ZXMucmVwbGFjZShcIiR7bGFiZWx9XCIsIGxhYmVsKVxuICAgICAgICAgICAgICAgIDogc3RyaW5ncy5wcm9wTm90Q29ubmVjdGVkLnJlcGxhY2UoXCIke2xhYmVsfVwiLCBsYWJlbCk7XG4gICAgICAgIGRpdi5zdHlsZSA9IGB3aWR0aDogJHtwb3BvdmVyTm9kZS5jbGllbnRXaWR0aCAqIDAuOH1weDsgZm9udC1zaXplOiB2YXIoLS1jYWxjaXRlLWZvbnQtc2l6ZS0tMSk7IGxpbmUtaGVpZ2h0OiAxcmVtOyBtYXJnaW46IDAuNzVyZW07YDtcbiAgICAgICAgLyogaXNzdWUgd2l0aCBjYWxjaXRlXG4gICAgICAgIGNvbnN0IGxhYmVsTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLWxhYmVsXCIpO1xuICAgICAgICBsYWJlbE5vZGUuc2NhbGUgPSBcIm1cIjtcbiAgICAgICAgbGFiZWxOb2RlLmlubmVySFRNTCA9IHR5cGUgPT09IFwic291cmNlXCIgPyBzdHJpbmdzLnByb3BSZWZsZWN0VXBkYXRlcyA6IHN0cmluZ3MucHJvcE5vdENvbm5lY3RlZDtcbiAgICAgICAgKGxhYmVsTm9kZSBhcyBhbnkpLnN0eWxlID0gYHdpZHRoOiAke3BvcG92ZXJOb2RlLmNsaWVudFdpZHRoICogMC43fXB4O2A7XG4gICAgICAgICovXG4gICAgICAgIGNvbnN0IG1vcmVJbmZvUG9wb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLXBvcG92ZXJcIik7XG4gICAgICAgIG1vcmVJbmZvUG9wb3Zlci5oZWFkaW5nID0gdHlwZSA9PT0gXCJzb3VyY2VcIiA/IHN0cmluZ3Muc2V0RnJvbVNvdXJjZSA6IHN0cmluZ3Muc2V0SW5XZWJtYXA7XG4gICAgICAgIG1vcmVJbmZvUG9wb3Zlci5wbGFjZW1lbnQgPSBcImF1dG9cIjtcbiAgICAgICAgbW9yZUluZm9Qb3BvdmVyLm9mZnNldFNraWRkaW5nID0gNTtcbiAgICAgICAgbW9yZUluZm9Qb3BvdmVyLmNsb3NhYmxlID0gdHJ1ZTtcbiAgICAgICAgbW9yZUluZm9Qb3BvdmVyLmxhYmVsID0gc3RyaW5ncy5tb3JlSW5mbztcbiAgICAgICAgbW9yZUluZm9Qb3BvdmVyLnJlZmVyZW5jZUVsZW1lbnQgPSByZWZlcmVuY2VOb2RlO1xuICAgICAgICBtb3JlSW5mb1BvcG92ZXIuY2xhc3NOYW1lID0gYGpzLWFwcC1mbHlvdXRgOyAvLyBqcy1hcHAtZmx5b3V0IG5lZWRlZCBieSBhcHBcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtb3JlSW5mb1BvcG92ZXIpO1xuICAgICAgICBtb3JlSW5mb1BvcG92ZXIuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICAgICAgbW9yZUluZm9Qb3BvdmVyLnNldEF0dHJpYnV0ZShcIm9wZW5cIiwgXCJ0cnVlXCIpO1xuICAgICAgICBtb3JlSW5mb1BvcG92ZXIucmVwb3NpdGlvbigpO1xuICAgICAgICBtb3JlSW5mb1BvcG92ZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVQb3BvdmVyQ2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZUluZm9Qb3BvdmVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBuZWVkIHRvIHdhaXQgdW50aWwgaXQncyBhbGwgdmlzaWJsZVxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IG1vcmVJbmZvUG9wb3Zlci5zZXRGb2N1cygpLCAxMDApO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIC8vIGNsb3NlIHBvcG92ZXIgd2hlbiB0YWJiaW5nIG91dFxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudFRhYkhhbmRsZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5kb2N1bWVudFRhYkhhbmRsZXIpO1xuICAgICAgICAgICAgLy8gY2xvc2UgcG9wb3ZlciB3aGVuIGNsaWNraW5nIG91dHNpZGVcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIgPSAoKSA9PiB0aGlzLmNsb3NlSW5mb1BvcG92ZXIoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyKTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgdGhpcy5tb3JlSW5mb1BvcG92ZXJOb2RlID0gbW9yZUluZm9Qb3BvdmVyO1xuICAgIH1cbiAgICBjbG9zZUluZm9Qb3BvdmVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLm1vcmVJbmZvUG9wb3Zlck5vZGUpIHtcbiAgICAgICAgICAgIChfYSA9IHRoaXMubW9yZUluZm9Qb3BvdmVyTm9kZS5yZWZlcmVuY2VFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5tb3JlSW5mb1BvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHRoaXMubW9yZUluZm9Qb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnRUYWJIYW5kbGVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmRvY3VtZW50VGFiSGFuZGxlcik7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50VGFiSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kb2N1bWVudENsaWNrSGFuZGxlcikge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc092ZXJyaWRkZW4oaWQpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXJPcmlnaW5JbmZvIH0gPSBwcm9wcztcbiAgICAgICAgcmV0dXJuICEhKCgoX2MgPSAoX2IgPSAoX2EgPSBsYXllck9yaWdpbkluZm8gPT09IG51bGwgfHwgbGF5ZXJPcmlnaW5JbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllck9yaWdpbkluZm8ucHJvcGVydHlHcm91cE9yaWdpbkluZm9zKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKChpbmZvKSA9PiBpbmZvLmlkID09PSBpZCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlswXSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnN0YXR1cykgPT09IFwib3ZlcnJpZGRlblwiKTtcbiAgICB9XG4gICAgZ2V0T3ZlcnJpZGVUeXBlKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzT3ZlcnJpZGRlbihpZCkgPyBcIndlYm1hcFwiIDogXCJzb3VyY2VcIjtcbiAgICB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXMuc3R5bGUgPSBhcmNnaXNMYXllck92ZXJyaWRlU3RhdHVzQ3NzO1xuXG5leHBvcnQgeyBBcmNnaXNMYXllck92ZXJyaWRlIGFzIGFyY2dpc19sYXllcl9vdmVycmlkZSwgQXJjZ2lzTGF5ZXJPdmVycmlkZVByb3BlcnRpZXMgYXMgYXJjZ2lzX2xheWVyX292ZXJyaWRlX3Byb3BlcnRpZXMsIEFyY2dpc0xheWVyT3ZlcnJpZGVTdGF0dXMgYXMgYXJjZ2lzX2xheWVyX292ZXJyaWRlX3N0YXR1cyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXMtbGF5ZXItb3ZlcnJpZGVfMy5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbnZhciBsb2NhbFN0b3JhZ2VLZXlzO1xuKGZ1bmN0aW9uIChsb2NhbFN0b3JhZ2VLZXlzKSB7XG4gICAgbG9jYWxTdG9yYWdlS2V5c1tcIkFSQ0dJU19DT01QT05FTlRfTk9USUZJQ0FUSU9OU1wiXSA9IFwiYXJjZ2lzQ29tcG9uZW50X25vdGlmaWNhdGlvbnNcIjtcbn0pKGxvY2FsU3RvcmFnZUtleXMgfHwgKGxvY2FsU3RvcmFnZUtleXMgPSB7fSkpO1xudmFyIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzO1xuKGZ1bmN0aW9uIChhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cykge1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiRkVBVFVSRV9SRURVQ1RJT05fV0FSTklOR19ESVNNSVNTRURcIl0gPSBcImFyY2dpc19mZWF0dXJlX3JlZHVjdGlvbl93YXJuaW5nX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiUE9QVVBfV0FSTklOR19ESVNNSVNTRURcIl0gPSBcImFyY2dpc19wb3B1cF93YXJuaW5nX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiSU5DT01QQVRJQkxFX1ZFQ1RPUl9TWU1CT0xTX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3N5bWJvbF9zdHlsZXJfaW5jb21wYXRpYmxlX3ZlY3Rvcl9zeW1ib2xzX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiRUZGRUNUU19USVBfRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfZWZmZWN0c190aXBfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJMQVlFUl9WSUVXX0RFRklOSVRJT05fRElTTUlTU0VEXCJdID0gXCJhcmNnaXNfbGF5ZXJfdmlld19kZWZpbml0aW9uX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiTEFZRVJfT1ZFUlJJREVfU1RBVFVTX1RJUF9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19sYXllcl9vdmVycmlkZV9zdGF0dXNfdGlwX2Rpc21pc3NlZFwiO1xuICAgIGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzW1wiU01BUlRfTUFQUElOR19USVAxX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX3NtYXJ0X21hcHBpbmdfdGlwMV9kaXNtaXNzZWRcIjtcbiAgICBhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5c1tcIlNNQVJUX01BUFBJTkdfVElQMl9ESVNNSVNTRURcIl0gPSBcImFyY2dpc19zbWFydF9tYXBwaW5nX3RpcDJfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJMQVlFUl9WSUVXX0pPSU5fVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX2xheWVyX3ZpZXdfam9pbl90aXBfZGlzbWlzc2VkXCI7XG4gICAgYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXNbXCJNVUxUSURJTUVOU0lPTkFMX0lORk9fVElQX0RJU01JU1NFRFwiXSA9IFwiYXJjZ2lzX211bHRpZGltZW5zaW9uYWxfaW5mb190aXBfZGlzbWlzc2VkXCI7XG59KShhcmNnaXNDb21wb25lbnROb3RpZmljYXRpb25zS2V5cyB8fCAoYXJjZ2lzQ29tcG9uZW50Tm90aWZpY2F0aW9uc0tleXMgPSB7fSkpO1xuY29uc3QgZ2V0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSkgPT4ge1xuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbFN0b3JhZ2VLZXkpO1xufTtcbmNvbnN0IHNldExvY2FsU3RvcmFnZSA9IChsb2NhbFN0b3JhZ2VLZXksIHZhbHVlKSA9PiB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0obG9jYWxTdG9yYWdlS2V5LCB2YWx1ZSk7XG59O1xuY29uc3QgZ2V0T2JqZWN0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSkgPT4ge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGdldExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXkpKSB8fCB7fTtcbn07XG5jb25zdCBzZXRTaW5nbGVPYmplY3RMb2NhbFN0b3JhZ2UgPSAobG9jYWxTdG9yYWdlS2V5LCBrZXlWYWx1ZU9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHNldExvY2FsU3RvcmFnZVZhbCA9IGdldE9iamVjdExvY2FsU3RvcmFnZShsb2NhbFN0b3JhZ2VLZXkpO1xuICAgIHNldExvY2FsU3RvcmFnZVZhbFtrZXlWYWx1ZU9iamVjdC5rZXldID0ga2V5VmFsdWVPYmplY3QudmFsdWU7XG4gICAgc2V0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoc2V0TG9jYWxTdG9yYWdlVmFsKSk7XG59O1xuY29uc3QgZ2V0U2luZ2xlT2JqZWN0TG9jYWxTdG9yYWdlID0gKGxvY2FsU3RvcmFnZUtleSwgb2JqZWN0S2V5KSA9PiB7XG4gICAgY29uc3QgZ2V0TG9jYWxTdG9yYWdlVmFsID0gZ2V0T2JqZWN0TG9jYWxTdG9yYWdlKGxvY2FsU3RvcmFnZUtleSk7XG4gICAgaWYgKGdldExvY2FsU3RvcmFnZVZhbCA9PT0gbnVsbCB8fCBnZXRMb2NhbFN0b3JhZ2VWYWwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdldExvY2FsU3RvcmFnZVZhbC5oYXNPd25Qcm9wZXJ0eShvYmplY3RLZXkpKSB7XG4gICAgICAgIHJldHVybiBnZXRMb2NhbFN0b3JhZ2VWYWxbb2JqZWN0S2V5XTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn07XG5cbmV4cG9ydCB7IGFyY2dpc0NvbXBvbmVudE5vdGlmaWNhdGlvbnNLZXlzIGFzIGEsIGdldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSBhcyBnLCBsb2NhbFN0b3JhZ2VLZXlzIGFzIGwsIHNldFNpbmdsZU9iamVjdExvY2FsU3RvcmFnZSBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsU3RvcmFnZS05YzRlN2EzYS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAgIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAgICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICAgICAgICByZXR1cm4gbGFuZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICAgIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgICAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gICAgbGV0IHN0cmluZ3M7XG4gICAgdHJ5IHtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsZS0wNTBiNmRiOS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=