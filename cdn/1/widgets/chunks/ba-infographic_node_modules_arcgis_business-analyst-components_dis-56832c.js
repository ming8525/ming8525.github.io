"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-56832c"],{

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-report-list.entry.js":
/*!*********************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgis-report-list.entry.js ***!
  \*********************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_report_list: () => (/* binding */ ArcgisReportList)
/* harmony export */ });
/* harmony import */ var _index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-4e647411.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/index-4e647411.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");
/* harmony import */ var _arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./arcgisReports-a1dc26aa.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js");





const arcgisReportListCss = ":host{display:block}calcite-tree-item{font-size:14.5pt;color:#333;font-family:Arial, Helvetica, sans-serif}.notReadyOuter{position:absolute;top:0;left:0;width:100%;height:100%}.notReadyDiv{position:absolute;top:calc(50% - 50px);left:calc(50% - 50px);width:100px;height:100px}.notReadySvg{position:absolute;top:calc(50% - 29px);left:calc(50% - 33px)}.arcgisReportsTreeItem{background-color:white;color:#585859;font-size:13pt;min-height:33px;border-bottom:solid 1px lightgray}.arcgisReportsTreeItemIcon{margin-top:-3px;margin-right:6px}calcite-tree-item[aria-selected=\"true\"]{background-color:#f6f6f6 !important}calcite-tab-title[aria-expanded=\"true\"]{background-color:#4991df;color:whitesmoke;font-size:11.5pt;margin:4px 0 1px 4px;min-width:calc(50% - 17px);border:solid 1px #4991df;border-top-left-radius:4px;border-bottom-left-radius:4px}calcite-tab-title[aria-expanded=\"false\"]{background-color:white;color:#4590e1;font-size:11.5pt;margin:4px 4px 1px 0;min-width:calc(50% - 17px);border:solid 1px #4991df;border-top-right-radius:4px;border-bottom-right-radius:4px}.arcgisReportsTreeDiv{width:100%;max-height:500px;overflow:scroll}.ba-dark{background-color:#2b2b2b !important;color:#fefefe !important}.ba-dark-item{background-color:#464646 !important;color:#fefefe !important}.ba-dark-item-selected{background-color:#363636 !important;color:#fefefe !important}";

const ArcgisReportList = class {
  constructor(hostRef) {
    (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
    this.reportSelected = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "reportSelected", 7);
    this.reportChecked = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "reportChecked", 7);
    this.accordionInit = (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "accordionInit", 7);
    this._idPrefix = 'arcgis-report-list-';
    this._containerPrefix = 'arl-container-';
    this._accordionPrefix = 'acc-';
    this._itemPrefix = 'arl-item-';
    this._groupPrefix = 'arl-group-';
    this._hasSetEnv = false;
    this._accList = ['MyInfographics', 'EsriInfographics', 'SharedInfographics', 'GalleryInfographics'];
    this._dbg = false;
    this.stSourceCountry = 'US';
    this._isInitialized = false;
    this.stMultipleChoice = false;
    this.stShowCheckboxes = true;
    this.stShowDefault = false;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A._verbose = true;
    this._groupId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._groupPrefix).id;
    this.langCode = 'en-us';
    this.sourceCountry = 'US';
    this.stMultipleChoice = false;
    this.stShowCheckboxes = true;
    this.stReportList = {};
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.langCode);
    this._instanceId = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._idPrefix).id;
    this._infographics = {
      MyInfographics: {
        dataId: 2,
        tag: 'report-my-infographics',
        data: undefined,
        accordionId: _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._instanceId + this._accordionPrefix).id
      },
      EsriInfographics: {
        dataId: 3,
        tag: 'report-esri-infographics',
        data: undefined,
        accordionId: _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._instanceId + this._accordionPrefix).id
      },
      SharedInfographics: {
        dataId: 4,
        tag: 'report-shared-infographics',
        data: undefined,
        accordionId: _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._instanceId + this._accordionPrefix).id
      },
      GalleryInfographics: {
        dataId: 5,
        tag: 'report-gallery-infographics',
        data: undefined,
        accordionId: _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.E.generateId(this._instanceId + this._accordionPrefix).id
      }
    };
    this._onChangeQueue = {};
  }
  queryElementById(id) {
    const elem = (!this.el || !this.el.shadowRoot) ? null
      : this.el.shadowRoot.querySelector(_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.fixId(id));
    return elem;
  }
  // ---------------------------------------------------------------------------------------------------
  // watches
  onEnvChanged() {
    this.stEnv = this.env;
    _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setEnvironment(this.env);
  }
  onLangCodeChanged() {
    this.stLangCode = this.langCode;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B._initialize(this.stLangCode);
  }
  onSourceCountryChanged() {
    this.stSourceCountry = this.sourceCountry;
  }
  onColorsChanged() {
    this.stColors = JSON.parse(this.colors);
  }
  onDefaultReportChanged() {
    this.stDefaultReportId = this.defaultReportId;
  }
  onSelectedReportChanged() {
    this.stSelectedReportId = this.selectedReportId;
  }
  onshowCheckboxesChanged() {
    this.stShowCheckboxes = this.showCheckboxes;
  }
  onshowDefaultChanged() {
    // this.stShowDefault = this.showDefault == 'true'
  }
  onreportListChanged() {
    // reportList comes in as {
    //   public: [ {id, title, date, isChecked }, ...]},
    //   shared: [...]
    //   user: [...]
    // }
    this.stReportList = Object.keys(this.reportList).length ? JSON.parse(this.reportList) : {};
    this.initializeTemplatesList();
  }
  async setColors(colors) {
    this.stColors = colors;
  }
  async initialize(username, token, country, language, showCheckboxes, reportList, showDefault) {
    const self = this;
    self.token = token;
    self.username = username;
    self.sourceCountry = country;
    self.langCode = language;
    self.stShowCheckboxes = !showCheckboxes ? false : true;
    self.stReportList = Object.keys(reportList).length ? JSON.parse(reportList) : {};
    if (showDefault) {
      this._tmpIgnoreDefault = true;
    }
    // self.stShowDefault = !showDefault ? false : true
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('ArcgisBaReports initialize -flags=', self.stShowCheckboxes, self.stShowDefault);
    (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.s)(username, token); // set the ba-reports token
    // Set if GeoenrichmentUrl was optionally passed in
    if (self.geoenrichmentUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setGeoenrichmentUrl(self.geoenrichmentUrl);
    }
    // Set if PortalUrl was optionally passed in
    if (self.portalUrl) {
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setPortalUrl(self.portalUrl);
    }
    try {
      // Fetch infographic templates from server
      let infos = await (0,_arcgisReports_a1dc26aa_js__WEBPACK_IMPORTED_MODULE_3__.g)(country, false);
      if (infos) {
        self.initializeTemplatesList(infos);
      }
      else {
        self._infographics.MyInfographics.data = undefined;
        self._infographics.EsriInfographics.data = undefined;
        self._infographics.SharedInfographics.data = undefined;
        self._infographics.GalleryInfographics.data = undefined;
      }
      this._isInitialized = true;
    }
    catch (ex) {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Error('arcgis-report-list request for esri reports failed', ex);
    }
  }
  // Merges the previous template list checked states into a new list.
  // If all items in list1 are checked, the new items will be checked,
  // otherwise the new items will remain unchecked.  The result is an
  // updated list2
  //    list1 = previous report list
  //    list2 = new report list just fetched from server
  //
  mergeChecked(list1, list2) {
    if (!list1)
      return list2;
    if (!list2)
      return list1;
    let allChecked = true, ii, idx1 = {}, idx2 = {};
    // build list2 index
    for (ii = 0; ii < list2.length; ii++) {
      idx2[list2[ii].id] = list2[ii];
    }
    // create list1 index and update idx2 checked states from list1
    for (ii = 0; ii < list1.length; ii++) {
      if (!list1.isChecked) {
        allChecked = false;
      }
      const lid = list1[ii].id;
      idx1[lid] = true; // id exists in idx1
      // if list1 item exists in list2 - we are removing any
      // list1 items that are not in the new fetched list
      if (idx2[lid]) {
        // keep prev isChecked state
        idx2[lid].isChecked = list1[ii].isChecked;
      }
    }
    // idx2 is now updated with all the list1 checked states.
    // Next, update the checked status of new items only if all
    // the list1 items were checked (category was checked)
    if (allChecked) {
      for (ii = 0; ii < list2.length; ii++) {
        const lid = list2[ii].id;
        // if the item is new to list1
        if (!idx1[lid]) {
          list2[ii].isChecked = true;
        }
      }
    }
    return list2;
  }
  initializeTemplatesList(infos) {
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('REPORT LIST: init list', infos, this.stReportList);
    let userReports, publicReports, sharedReports, galleryReports;
    if (Object.keys(this.stReportList).length) {
      userReports = this.mergeChecked(this.stReportList.user, infos?.user);
      publicReports = this.mergeChecked(this.stReportList.public, infos?.public);
      sharedReports = this.mergeChecked(this.stReportList.shared, infos?.shared);
      galleryReports = this.mergeChecked(this.stReportList.gallery, infos?.gallery);
    }
    else if (infos) {
      // default list and checked states
      userReports = infos.user.map(report => { return { ...report, isChecked: false }; });
      publicReports = infos.public.map(report => { return { ...report, isChecked: true }; });
      sharedReports = infos.shared.map(report => { return { ...report, isChecked: false }; });
      galleryReports = infos.gallery.map(report => { return { ...report, isChecked: false }; });
    }
    else {
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Error('ArcgisReportList error initializing infographic templates - no data');
      return;
    }
    this.accordionInit.emit({ user: userReports, public: publicReports, shared: sharedReports, gallery: galleryReports });
    this._infographics.MyInfographics.data = userReports;
    this._infographics.EsriInfographics.data = publicReports;
    this._infographics.SharedInfographics.data = sharedReports;
    this._infographics.GalleryInfographics.data = galleryReports;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('REPORT LIST init end', this._infographics);
  }
  _accordianItemClickHandler(ev) {
    this.onReportClicked.call(this, ev);
  }
  _accordianItemsCheckedHandler(ev) {
    this.reportChecked.emit(ev.detail);
  }
  // @Method()
  async setShowDefault(flag, defaultId) {
    if (flag) {
      this._tmpIgnoreDefault = true;
    }
    if (defaultId) {
      this._tmpIgnoreDefault = true;
    } // tmp remove this
    // this.stShowDefault = flag
    // this.stDefaultReportId = defaultId
  }
  async setMultipleChoice(flag) {
    this.stMultipleChoice = flag;
  }
  /**
   * Sets host callback for property change notifications
   * @param callback  - function supplied by host after component is instantiated
   * @param context   - object reference that is returned in the callback (to the host)
   *
   * Callback data format:
   *    {
   *      <property name>: <value>,
   *      <other prop name: value,
   *      ...
   *    }
   */
  async onPropChange(callback, context) {
    this._onChangeCallback = { fn: callback, ctx: context };
  }
  async setColorTheme(name) {
    if (name && _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(name) && this.el) {
      this.stColorTheme = name.trim().toLowerCase();
      const n = name.trim().toLowerCase();
      if (n === 'light') {
        this._accordionTheme = n;
        this.el.style.setProperty('--calcite-ui-brand', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#00619b');
        this.el.style.setProperty('--calcite-ui-brand-press', '#004874');
        this.el.style.setProperty('--calcite-ui-background', '#f8f8f8');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#f3f3f3');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#eaeaea');
        this.el.style.setProperty('--calcite-ui-text-1', '#151515');
        this.el.style.setProperty('--calcite-ui-text-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-text-3', '#6a6a6a');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-link', '#00619b');
        this.el.style.setProperty('--calcite-ui-border-1', '#cacaca');
        this.el.style.setProperty('--calcite-ui-border-2', '#d4d4d4');
        this.el.style.setProperty('--calcite-ui-border-3', '#dfdfdf');
        this.el.style.setProperty('--calcite-ui-border-input', '#949494');
        this.el.style.setProperty('--calcite-ui-info', '#00619b');
        this.el.style.setProperty('--calcite-ui-success', '#35ac46');
      }
      else if (n === 'dark') {
        this._accordionTheme = n;
        this.el.style.setProperty('--calcite-ui-brand', '#009af2');
        this.el.style.setProperty('--calcite-ui-brand-hover', '#007ac2');
        this.el.style.setProperty('--calcite-ui-brand-press', '#00619b');
        this.el.style.setProperty('--calcite-ui-background', '#353535');
        this.el.style.setProperty('--calcite-ui-foreground-1', '#2b2b2b');
        this.el.style.setProperty('--calcite-ui-foreground-2', '#202020');
        this.el.style.setProperty('--calcite-ui-foreground-3', '#151515');
        this.el.style.setProperty('--calcite-ui-text-1', '#ffffff');
        this.el.style.setProperty('--calcite-ui-text-2', '#bfbfbf');
        this.el.style.setProperty('--calcite-ui-text-3', '#9f9f9f');
        this.el.style.setProperty('--calcite-ui-text-inverse', '#151515');
        this.el.style.setProperty('--calcite-ui-text-link', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-border-1', '#555555');
        this.el.style.setProperty('--calcite-ui-border-2', '#4a4a4a');
        this.el.style.setProperty('--calcite-ui-border-3', '#404040');
        this.el.style.setProperty('--calcite-ui-border-input', '#757575');
        this.el.style.setProperty('--calcite-ui-info', '#00a0ff');
        this.el.style.setProperty('--calcite-ui-success', '#36da43');
      }
      // @ts-ignore
      this._getShadowAccordion('MyInfographics').setColorTheme(n);
      // @ts-ignore
      this._getShadowAccordion('EsriInfographics').setColorTheme(n);
      // @ts-ignore
      this._getShadowAccordion('SharedInfographics').setColorTheme(n);
      // @ts-ignore
      this._getShadowAccordion('GalleryInfographics').setColorTheme(n);
    }
  }
  // @Method()
  async setSelectedId(id) {
    this.stSelectedReportId = id;
    this._setAccordionsReportId();
  }
  async onDefaultReportChange(callback, context) {
    this._onDefaultReportCallback = { fn: callback, ctx: context };
  }
  async onAccordionItemsChecked(callback, context) {
    this._onCheckboxChangeCallback = { fn: callback, ctx: context };
  }
  // infographic tree default report id changed
  reportSelectedEventHandler(e) {
    const result = { reportId: e.detail.reportId, name: e.detail.name };
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('REPORT LIST DEFAULT IG CHANGED=', result);
    const cb = this._onDefaultReportCallback;
    if (cb && typeof cb.fn === 'function') {
      cb.fn.call(cb.ctx, result);
    }
  }
  _getShadowAccordion(name) {
    const id = this._infographics[name].accordionId;
    const elem = (this.el?.shadowRoot) ? this.el.shadowRoot.getElementById(id) : null;
    return elem;
  }
  _setAccordionsReportId() {
    const self = this;
    if (this.stSelectedReportId) {
      this._accList.forEach((a) => {
        const accElem = self._getShadowAccordion(a);
        if (accElem) {
          // @ts-ignore
          accElem.setSelectedId(self.stSelectedReportId);
        }
      });
    }
  }
  _setAccordionsCheckbox() {
    const self = this;
    this._accList.forEach((a) => {
      const accElem = self._getShadowAccordion(a);
      if (accElem) {
        // @ts-ignore
        accElem.setShowCheckbox(self.stShowCheckboxes);
      }
    });
  }
  _setAccordionsDefault() {
    // const self = this
    // if (this.stShowDefault) {
    //   const id = this.stDefaultReportId
    //   this._accList.forEach((a) => {
    //     const accElem = self._getShadowAccordion(a)
    //     if (accElem) {
    //       // @ts-ignore
    //       accElem.setShowDefault(true, id)
    //     }
    //   })
    // }
  }
  /**
   * Filters out multiple rapid events of the same type.  The callback
   * function will be called if no new events have happened during the
   * 'wait' time.
   * @param callback - your function to call when the events have settled
   * @param wait     - milliseconds delay (ex: 250)
   */
  _debounce2(callback, wait) {
    const self = this;
    const delayedCall = function () {
      self._debounceTimer = null;
      callback.apply(self);
    };
    // everytime _debounce2 is called we kill the previous timer
    if (self._debounceTimer)
      clearTimeout(self._debounceTimer);
    self._debounceTimer = setTimeout(delayedCall, wait);
  }
  _onFilteredPropChanged() {
    if (this._onChangeCallback)
      this._onChangeCallback.fn(this._onChangeCallback.ctx, this._onChangeQueue);
    // clear queue
    this._onChangeQueue = {};
  }
  /**
   * Function called by this component internally when a Prop changes
   * @param name  - of Prop
   * @param value - value after change
   */
  _onPropChanged(name, value) {
    // Add name/value to queue
    // Subsequent calls with the same name/value just updates
    // the value until the callback clears the queue
    this._onChangeQueue[name] = value;
    this._debounce2(this._onFilteredPropChanged, 250);
  }
  onReportClicked(e) {
    let id = e.detail.item.id;
    this.setReportId(id, e.detail.item.name);
  }
  setReportId(newValue, name) {
    const self = this;
    this.selectedReportId = newValue;
    this.reportSelected.emit({ id: self.selectedReportId, name: name });
    this._onPropChanged('reportId', this.selectedReportId);
  }
  async componentWillLoad() {
    this.stColors = this.colors;
    if (!this._hasSetEnv && this.env) {
      this._hasSetEnv = true;
      this.stEnv = this.env;
      _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_2__.E.setEnvironment(this.env);
    }
    this.stShowCheckboxes = this.showCheckboxes;
    this.stSelectedReportId = this.selectedReportId;
    // this.stShowDefault = this.showDefault == 'true'
    this.stDefaultReportId = this.defaultReportId || 'f9d96323b8cf4be9b052ee33fcdb6675'; // debug only
  }
  componentDidLoad() {
    const self = this;
    if (_ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.hasText(this.colors)) {
      this.stColors = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.A.parseThemeString(this.colors);
    }
    if (self.stColors) {
      self.el.style.setProperty('--calcite-ui-brand', self.stColors.brand);
      self.el.style.setProperty('--calcite-ui-foreground-1', self.stColors.foreground1);
      self.el.style.setProperty('--calcite-ui-foreground-2', self.stColors.foreground2);
      self.el.style.setProperty('--calcite-ui-foreground-3', self.stColors.foreground2);
      self.el.style.setProperty('--calcite-ui-text-1', self.stColors.text1);
      self.el.style.setProperty('--calcite-ui-text-2', self.stColors.text2);
      self.el.style.setProperty('--calcite-ui-text-3', self.stColors.text3);
      self.el.style.setProperty('--calcite-ui-border-2', self.stColors.border2);
      self.el.style.setProperty('--calcite-accordion-item-background', self.stColors.accordionBackground);
      self.el.style.setProperty('--calcite-accordion-item-foreground', self.stColors.accordionForeground);
    }
    // if (self.stShowDefault) {
    //   self._setAccordionsDefault()
    // }
  }
  componentDidUpdate() {
    this._setAccordionsReportId();
    // if (this.stShowDefault) {
    //   this._setAccordionsDefault()
    // }
    if (this.stShowCheckboxes) {
      this._setAccordionsCheckbox();
    }
  }
  render() {
    if (!this._isInitialized)
      return;
    const self = this;
    return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, self.renderList('EsriInfographics'), self.renderList('MyInfographics'), self.renderList('SharedInfographics'), self.renderList('GalleryInfographics')));
  }
  renderList(name) {
    const self = this;
    const multi = self.stMultipleChoice.toString();
    const tags = {
      'MyInfographics': 'report-my-infographics',
      'EsriInfographics': 'report-esri-infographics',
      'SharedInfographics': 'report-shared-infographics',
      'GalleryInfographics': 'report-gallery-infographics'
    };
    const reports = self._infographics[name].data;
    _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('REPORT LIST renderList', name, reports);
    if (reports && reports.length > 0) {
      let arr = [];
      if ((multi == 'true') && reports.length > 4) {
        // Add 'All' row with checkbox
        let a = {
          id: -1,
          name: _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('dropdown-all'),
          icon: 'file-text',
          usesCheckbox: true,
          isChecked: (name == 'EsriInfographics')
        };
        arr.push(a);
      }
      reports.forEach(function (item) {
        let row = {
          id: item.id,
          name: item.title,
          date: item.date,
          isChecked: item.isChecked,
          icon: 'file-text'
        };
        if (multi == 'true') {
          row.usesCheckbox = true;
          //row.isChecked = (name == 'EsriInfographics')
        }
        arr.push(row);
      });
      const content = JSON.stringify(arr);
      const displayName = _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n(tags[name]);
      const accId = self._infographics[name].accordionId;
      _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.a.Log('REPORTS render: ', this.stShowCheckboxes, this.stShowDefault, content);
      // create an accordion for this level with all records
      return ((0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.h)("ba-accordion", { id: accId, class: "reportList", displayname: displayName, reportsGroupId: name, content: content, showCheckboxes: this.stShowCheckboxes,
        //  showDefault={this.stShowDefault.toString()}
        //  defaultReportId={this.stDefaultReportId}
        // removing reportList prop, use content only
        //reportList={JSON.stringify(this.stReportList)}
        selectedId: this.stSelectedReportId, onAccordionItemClicked: ev => this._accordianItemClickHandler(ev), onAccordionItemsChecked: (ev) => this._accordianItemsCheckedHandler(ev) }));
    }
    return '';
  }
  get el() { return (0,_index_4e647411_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
  static get watchers() { return {
    "env": ["onEnvChanged"],
    "langCode": ["onLangCodeChanged"],
    "sourceCountry": ["onSourceCountryChanged"],
    "colors": ["onColorsChanged"],
    "defaultReportId": ["onDefaultReportChanged"],
    "selectedReportId": ["onSelectedReportChanged"],
    "showCheckboxes": ["onshowCheckboxesChanged"],
    "showDefault": ["onshowDefaultChanged"],
    "reportList": ["onreportListChanged"]
  }; }
};
ArcgisReportList.style = arcgisReportListCss;



//# sourceMappingURL=arcgis-report-list.entry.js.map

/***/ }),

/***/ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js":
/*!*******************************************************************************************************************************************************!*\
  !*** ./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/arcgisReports-a1dc26aa.js ***!
  \*******************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getInfographicTemplatesList),
/* harmony export */   s: () => (/* binding */ setToken)
/* harmony export */ });
/* harmony import */ var _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GEClient-1a83a657.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/GEClient-1a83a657.js");
/* harmony import */ var _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ElementIds-f7d257e8.js */ "./extensions/widgets/ba-infographic/node_modules/@arcgis/business-analyst-components/dist/stencil-components/dist/esm/ElementIds-f7d257e8.js");



function setToken(username, token) {
    try {
        if (username != null && username.length > 0) {
            if (token != null && token.length > 0) {
                _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.T.setToken(username, token);
                return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('ok');
            }
            else {
                return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-token');
            }
        }
        else {
            return _ElementIds_f7d257e8_js__WEBPACK_IMPORTED_MODULE_1__.B.i18n('invalid-username');
        }
    }
    catch (ex) {
        return ex;
    }
}
async function getInfographicTemplatesList(countryCode, full = false) {
    return await _GEClient_1a83a657_js__WEBPACK_IMPORTED_MODULE_0__.G.getInfographicTemplatesList(countryCode, full);
}



//# sourceMappingURL=arcgisReports-a1dc26aa.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYmEtaW5mb2dyYXBoaWNfbm9kZV9tb2R1bGVzX2FyY2dpc19idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHNfZGlzLTU2ODMyYy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFrRztBQUNlO0FBQ3REO0FBQ21DOztBQUU5RixtQ0FBbUMsY0FBYyxrQkFBa0IsaUJBQWlCLFdBQVcseUNBQXlDLGVBQWUsa0JBQWtCLE1BQU0sT0FBTyxXQUFXLFlBQVksYUFBYSxrQkFBa0IscUJBQXFCLHNCQUFzQixZQUFZLGFBQWEsYUFBYSxrQkFBa0IscUJBQXFCLHNCQUFzQix1QkFBdUIsdUJBQXVCLGNBQWMsZUFBZSxnQkFBZ0Isa0NBQWtDLDJCQUEyQixnQkFBZ0IsaUJBQWlCLDBDQUEwQyxvQ0FBb0MsMENBQTBDLHlCQUF5QixpQkFBaUIsaUJBQWlCLHFCQUFxQiwyQkFBMkIseUJBQXlCLDJCQUEyQiw4QkFBOEIsMkNBQTJDLHVCQUF1QixjQUFjLGlCQUFpQixxQkFBcUIsMkJBQTJCLHlCQUF5Qiw0QkFBNEIsK0JBQStCLHNCQUFzQixXQUFXLGlCQUFpQixnQkFBZ0IsU0FBUyxvQ0FBb0MseUJBQXlCLGNBQWMsb0NBQW9DLHlCQUF5Qix1QkFBdUIsb0NBQW9DLHlCQUF5Qjs7QUFFcDNDO0FBQ0E7QUFDQSxJQUFJLHFEQUFnQjtBQUNwQiwwQkFBMEIscURBQVc7QUFDckMseUJBQXlCLHFEQUFXO0FBQ3BDLHlCQUF5QixxREFBVztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQVE7QUFDWixvQkFBb0Isc0RBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQWlCO0FBQ3JCLHVCQUF1QixzREFBVTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHNEQUFVO0FBQy9CLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzREFBVTtBQUMvQixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsc0RBQVU7QUFDL0IsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHNEQUFVO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxzREFBUTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLG9EQUFZO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLElBQUksc0RBQWlCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiw0QkFBNEIsT0FBTztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHNEQUFRO0FBQ1osSUFBSSw2REFBUSxtQkFBbUI7QUFDL0I7QUFDQTtBQUNBLE1BQU0sb0RBQVk7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsTUFBTSxvREFBWTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNkRBQTJCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0RBQVE7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0EsaUJBQWlCLG1CQUFtQjtBQUNwQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsbUJBQW1CO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxzREFBUTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxTQUFTLGdDQUFnQztBQUN4RixtREFBbUQsU0FBUywrQkFBK0I7QUFDM0YsbURBQW1ELFNBQVMsZ0NBQWdDO0FBQzVGLHFEQUFxRCxTQUFTLGdDQUFnQztBQUM5RjtBQUNBO0FBQ0EsTUFBTSxzREFBUTtBQUNkO0FBQ0E7QUFDQSw4QkFBOEIsMEZBQTBGO0FBQ3hIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxzREFBUTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBLGdCQUFnQixzREFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsSUFBSSxzREFBUTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHVDQUF1QztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sb0RBQVk7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUY7QUFDekY7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBUTtBQUNoQixzQkFBc0Isc0RBQVE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxxREFBQztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHNEQUFRO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHNEQUFpQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLDBCQUEwQixzREFBaUI7QUFDM0M7QUFDQSxNQUFNLHNEQUFRO0FBQ2Q7QUFDQSxjQUFjLHFEQUFDLG1CQUFtQjtBQUNsQyx5QkFBeUI7QUFDekIsNkJBQTZCO0FBQzdCO0FBQ0Esc0JBQXNCO0FBQ3RCLHlMQUF5TDtBQUN6TDtBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU8scURBQVU7QUFDOUIsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFa0Q7O0FBRWxEOzs7Ozs7Ozs7Ozs7Ozs7OztBQ3RoQjJFO0FBQ1Q7O0FBRWxFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9EQUFhO0FBQzdCLHVCQUF1QixzREFBaUI7QUFDeEM7QUFDQTtBQUNBLHVCQUF1QixzREFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHNEQUFpQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvREFBUTtBQUN6Qjs7QUFFMkQ7O0FBRTNEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9iYS1pbmZvZ3JhcGhpYy9ub2RlX21vZHVsZXMvQGFyY2dpcy9idXNpbmVzcy1hbmFseXN0LWNvbXBvbmVudHMvZGlzdC9zdGVuY2lsLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXJlcG9ydC1saXN0LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYmEtaW5mb2dyYXBoaWMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYnVzaW5lc3MtYW5hbHlzdC1jb21wb25lbnRzL2Rpc3Qvc3RlbmNpbC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpc1JlcG9ydHMtYTFkYzI2YWEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBnIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LTRlNjQ3NDExLmpzJztcbmltcG9ydCB7IEEgYXMgQUNMVXRpbHMsIEUgYXMgRWxlbWVudElkcywgQiBhcyBCYVJlcG9ydHNMYW5ndWFnZSwgYSBhcyBCYXNlVXRpbCB9IGZyb20gJy4vRWxlbWVudElkcy1mN2QyNTdlOC5qcyc7XG5pbXBvcnQgeyBFIGFzIEVudmlyb25tZW50cyB9IGZyb20gJy4vR0VDbGllbnQtMWE4M2E2NTcuanMnO1xuaW1wb3J0IHsgcyBhcyBzZXRUb2tlbiwgZyBhcyBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QgfSBmcm9tICcuL2FyY2dpc1JlcG9ydHMtYTFkYzI2YWEuanMnO1xuXG5jb25zdCBhcmNnaXNSZXBvcnRMaXN0Q3NzID0gXCI6aG9zdHtkaXNwbGF5OmJsb2NrfWNhbGNpdGUtdHJlZS1pdGVte2ZvbnQtc2l6ZToxNC41cHQ7Y29sb3I6IzMzMztmb250LWZhbWlseTpBcmlhbCwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmfS5ub3RSZWFkeU91dGVye3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS5ub3RSZWFkeURpdntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6Y2FsYyg1MCUgLSA1MHB4KTtsZWZ0OmNhbGMoNTAlIC0gNTBweCk7d2lkdGg6MTAwcHg7aGVpZ2h0OjEwMHB4fS5ub3RSZWFkeVN2Z3twb3NpdGlvbjphYnNvbHV0ZTt0b3A6Y2FsYyg1MCUgLSAyOXB4KTtsZWZ0OmNhbGMoNTAlIC0gMzNweCl9LmFyY2dpc1JlcG9ydHNUcmVlSXRlbXtiYWNrZ3JvdW5kLWNvbG9yOndoaXRlO2NvbG9yOiM1ODU4NTk7Zm9udC1zaXplOjEzcHQ7bWluLWhlaWdodDozM3B4O2JvcmRlci1ib3R0b206c29saWQgMXB4IGxpZ2h0Z3JheX0uYXJjZ2lzUmVwb3J0c1RyZWVJdGVtSWNvbnttYXJnaW4tdG9wOi0zcHg7bWFyZ2luLXJpZ2h0OjZweH1jYWxjaXRlLXRyZWUtaXRlbVthcmlhLXNlbGVjdGVkPVxcXCJ0cnVlXFxcIl17YmFja2dyb3VuZC1jb2xvcjojZjZmNmY2ICFpbXBvcnRhbnR9Y2FsY2l0ZS10YWItdGl0bGVbYXJpYS1leHBhbmRlZD1cXFwidHJ1ZVxcXCJde2JhY2tncm91bmQtY29sb3I6IzQ5OTFkZjtjb2xvcjp3aGl0ZXNtb2tlO2ZvbnQtc2l6ZToxMS41cHQ7bWFyZ2luOjRweCAwIDFweCA0cHg7bWluLXdpZHRoOmNhbGMoNTAlIC0gMTdweCk7Ym9yZGVyOnNvbGlkIDFweCAjNDk5MWRmO2JvcmRlci10b3AtbGVmdC1yYWRpdXM6NHB4O2JvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6NHB4fWNhbGNpdGUtdGFiLXRpdGxlW2FyaWEtZXhwYW5kZWQ9XFxcImZhbHNlXFxcIl17YmFja2dyb3VuZC1jb2xvcjp3aGl0ZTtjb2xvcjojNDU5MGUxO2ZvbnQtc2l6ZToxMS41cHQ7bWFyZ2luOjRweCA0cHggMXB4IDA7bWluLXdpZHRoOmNhbGMoNTAlIC0gMTdweCk7Ym9yZGVyOnNvbGlkIDFweCAjNDk5MWRmO2JvcmRlci10b3AtcmlnaHQtcmFkaXVzOjRweDtib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czo0cHh9LmFyY2dpc1JlcG9ydHNUcmVlRGl2e3dpZHRoOjEwMCU7bWF4LWhlaWdodDo1MDBweDtvdmVyZmxvdzpzY3JvbGx9LmJhLWRhcmt7YmFja2dyb3VuZC1jb2xvcjojMmIyYjJiICFpbXBvcnRhbnQ7Y29sb3I6I2ZlZmVmZSAhaW1wb3J0YW50fS5iYS1kYXJrLWl0ZW17YmFja2dyb3VuZC1jb2xvcjojNDY0NjQ2ICFpbXBvcnRhbnQ7Y29sb3I6I2ZlZmVmZSAhaW1wb3J0YW50fS5iYS1kYXJrLWl0ZW0tc2VsZWN0ZWR7YmFja2dyb3VuZC1jb2xvcjojMzYzNjM2ICFpbXBvcnRhbnQ7Y29sb3I6I2ZlZmVmZSAhaW1wb3J0YW50fVwiO1xuXG5jb25zdCBBcmNnaXNSZXBvcnRMaXN0ID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICB0aGlzLnJlcG9ydFNlbGVjdGVkID0gY3JlYXRlRXZlbnQodGhpcywgXCJyZXBvcnRTZWxlY3RlZFwiLCA3KTtcbiAgICB0aGlzLnJlcG9ydENoZWNrZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcInJlcG9ydENoZWNrZWRcIiwgNyk7XG4gICAgdGhpcy5hY2NvcmRpb25Jbml0ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhY2NvcmRpb25Jbml0XCIsIDcpO1xuICAgIHRoaXMuX2lkUHJlZml4ID0gJ2FyY2dpcy1yZXBvcnQtbGlzdC0nO1xuICAgIHRoaXMuX2NvbnRhaW5lclByZWZpeCA9ICdhcmwtY29udGFpbmVyLSc7XG4gICAgdGhpcy5fYWNjb3JkaW9uUHJlZml4ID0gJ2FjYy0nO1xuICAgIHRoaXMuX2l0ZW1QcmVmaXggPSAnYXJsLWl0ZW0tJztcbiAgICB0aGlzLl9ncm91cFByZWZpeCA9ICdhcmwtZ3JvdXAtJztcbiAgICB0aGlzLl9oYXNTZXRFbnYgPSBmYWxzZTtcbiAgICB0aGlzLl9hY2NMaXN0ID0gWydNeUluZm9ncmFwaGljcycsICdFc3JpSW5mb2dyYXBoaWNzJywgJ1NoYXJlZEluZm9ncmFwaGljcycsICdHYWxsZXJ5SW5mb2dyYXBoaWNzJ107XG4gICAgdGhpcy5fZGJnID0gZmFsc2U7XG4gICAgdGhpcy5zdFNvdXJjZUNvdW50cnkgPSAnVVMnO1xuICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0TXVsdGlwbGVDaG9pY2UgPSBmYWxzZTtcbiAgICB0aGlzLnN0U2hvd0NoZWNrYm94ZXMgPSB0cnVlO1xuICAgIHRoaXMuc3RTaG93RGVmYXVsdCA9IGZhbHNlO1xuICAgIEFDTFV0aWxzLl92ZXJib3NlID0gdHJ1ZTtcbiAgICB0aGlzLl9ncm91cElkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2dyb3VwUHJlZml4KS5pZDtcbiAgICB0aGlzLmxhbmdDb2RlID0gJ2VuLXVzJztcbiAgICB0aGlzLnNvdXJjZUNvdW50cnkgPSAnVVMnO1xuICAgIHRoaXMuc3RNdWx0aXBsZUNob2ljZSA9IGZhbHNlO1xuICAgIHRoaXMuc3RTaG93Q2hlY2tib3hlcyA9IHRydWU7XG4gICAgdGhpcy5zdFJlcG9ydExpc3QgPSB7fTtcbiAgICBCYVJlcG9ydHNMYW5ndWFnZS5faW5pdGlhbGl6ZSh0aGlzLmxhbmdDb2RlKTtcbiAgICB0aGlzLl9pbnN0YW5jZUlkID0gRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2lkUHJlZml4KS5pZDtcbiAgICB0aGlzLl9pbmZvZ3JhcGhpY3MgPSB7XG4gICAgICBNeUluZm9ncmFwaGljczoge1xuICAgICAgICBkYXRhSWQ6IDIsXG4gICAgICAgIHRhZzogJ3JlcG9ydC1teS1pbmZvZ3JhcGhpY3MnLFxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXG4gICAgICAgIGFjY29yZGlvbklkOiBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faW5zdGFuY2VJZCArIHRoaXMuX2FjY29yZGlvblByZWZpeCkuaWRcbiAgICAgIH0sXG4gICAgICBFc3JpSW5mb2dyYXBoaWNzOiB7XG4gICAgICAgIGRhdGFJZDogMyxcbiAgICAgICAgdGFnOiAncmVwb3J0LWVzcmktaW5mb2dyYXBoaWNzJyxcbiAgICAgICAgZGF0YTogdW5kZWZpbmVkLFxuICAgICAgICBhY2NvcmRpb25JZDogRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2luc3RhbmNlSWQgKyB0aGlzLl9hY2NvcmRpb25QcmVmaXgpLmlkXG4gICAgICB9LFxuICAgICAgU2hhcmVkSW5mb2dyYXBoaWNzOiB7XG4gICAgICAgIGRhdGFJZDogNCxcbiAgICAgICAgdGFnOiAncmVwb3J0LXNoYXJlZC1pbmZvZ3JhcGhpY3MnLFxuICAgICAgICBkYXRhOiB1bmRlZmluZWQsXG4gICAgICAgIGFjY29yZGlvbklkOiBFbGVtZW50SWRzLmdlbmVyYXRlSWQodGhpcy5faW5zdGFuY2VJZCArIHRoaXMuX2FjY29yZGlvblByZWZpeCkuaWRcbiAgICAgIH0sXG4gICAgICBHYWxsZXJ5SW5mb2dyYXBoaWNzOiB7XG4gICAgICAgIGRhdGFJZDogNSxcbiAgICAgICAgdGFnOiAncmVwb3J0LWdhbGxlcnktaW5mb2dyYXBoaWNzJyxcbiAgICAgICAgZGF0YTogdW5kZWZpbmVkLFxuICAgICAgICBhY2NvcmRpb25JZDogRWxlbWVudElkcy5nZW5lcmF0ZUlkKHRoaXMuX2luc3RhbmNlSWQgKyB0aGlzLl9hY2NvcmRpb25QcmVmaXgpLmlkXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLl9vbkNoYW5nZVF1ZXVlID0ge307XG4gIH1cbiAgcXVlcnlFbGVtZW50QnlJZChpZCkge1xuICAgIGNvbnN0IGVsZW0gPSAoIXRoaXMuZWwgfHwgIXRoaXMuZWwuc2hhZG93Um9vdCkgPyBudWxsXG4gICAgICA6IHRoaXMuZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKEFDTFV0aWxzLmZpeElkKGlkKSk7XG4gICAgcmV0dXJuIGVsZW07XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIHdhdGNoZXNcbiAgb25FbnZDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICBFbnZpcm9ubWVudHMuc2V0RW52aXJvbm1lbnQodGhpcy5lbnYpO1xuICB9XG4gIG9uTGFuZ0NvZGVDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RMYW5nQ29kZSA9IHRoaXMubGFuZ0NvZGU7XG4gICAgQmFSZXBvcnRzTGFuZ3VhZ2UuX2luaXRpYWxpemUodGhpcy5zdExhbmdDb2RlKTtcbiAgfVxuICBvblNvdXJjZUNvdW50cnlDaGFuZ2VkKCkge1xuICAgIHRoaXMuc3RTb3VyY2VDb3VudHJ5ID0gdGhpcy5zb3VyY2VDb3VudHJ5O1xuICB9XG4gIG9uQ29sb3JzQ2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0Q29sb3JzID0gSlNPTi5wYXJzZSh0aGlzLmNvbG9ycyk7XG4gIH1cbiAgb25EZWZhdWx0UmVwb3J0Q2hhbmdlZCgpIHtcbiAgICB0aGlzLnN0RGVmYXVsdFJlcG9ydElkID0gdGhpcy5kZWZhdWx0UmVwb3J0SWQ7XG4gIH1cbiAgb25TZWxlY3RlZFJlcG9ydENoYW5nZWQoKSB7XG4gICAgdGhpcy5zdFNlbGVjdGVkUmVwb3J0SWQgPSB0aGlzLnNlbGVjdGVkUmVwb3J0SWQ7XG4gIH1cbiAgb25zaG93Q2hlY2tib3hlc0NoYW5nZWQoKSB7XG4gICAgdGhpcy5zdFNob3dDaGVja2JveGVzID0gdGhpcy5zaG93Q2hlY2tib3hlcztcbiAgfVxuICBvbnNob3dEZWZhdWx0Q2hhbmdlZCgpIHtcbiAgICAvLyB0aGlzLnN0U2hvd0RlZmF1bHQgPSB0aGlzLnNob3dEZWZhdWx0ID09ICd0cnVlJ1xuICB9XG4gIG9ucmVwb3J0TGlzdENoYW5nZWQoKSB7XG4gICAgLy8gcmVwb3J0TGlzdCBjb21lcyBpbiBhcyB7XG4gICAgLy8gICBwdWJsaWM6IFsge2lkLCB0aXRsZSwgZGF0ZSwgaXNDaGVja2VkIH0sIC4uLl19LFxuICAgIC8vICAgc2hhcmVkOiBbLi4uXVxuICAgIC8vICAgdXNlcjogWy4uLl1cbiAgICAvLyB9XG4gICAgdGhpcy5zdFJlcG9ydExpc3QgPSBPYmplY3Qua2V5cyh0aGlzLnJlcG9ydExpc3QpLmxlbmd0aCA/IEpTT04ucGFyc2UodGhpcy5yZXBvcnRMaXN0KSA6IHt9O1xuICAgIHRoaXMuaW5pdGlhbGl6ZVRlbXBsYXRlc0xpc3QoKTtcbiAgfVxuICBhc3luYyBzZXRDb2xvcnMoY29sb3JzKSB7XG4gICAgdGhpcy5zdENvbG9ycyA9IGNvbG9ycztcbiAgfVxuICBhc3luYyBpbml0aWFsaXplKHVzZXJuYW1lLCB0b2tlbiwgY291bnRyeSwgbGFuZ3VhZ2UsIHNob3dDaGVja2JveGVzLCByZXBvcnRMaXN0LCBzaG93RGVmYXVsdCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHNlbGYudG9rZW4gPSB0b2tlbjtcbiAgICBzZWxmLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgc2VsZi5zb3VyY2VDb3VudHJ5ID0gY291bnRyeTtcbiAgICBzZWxmLmxhbmdDb2RlID0gbGFuZ3VhZ2U7XG4gICAgc2VsZi5zdFNob3dDaGVja2JveGVzID0gIXNob3dDaGVja2JveGVzID8gZmFsc2UgOiB0cnVlO1xuICAgIHNlbGYuc3RSZXBvcnRMaXN0ID0gT2JqZWN0LmtleXMocmVwb3J0TGlzdCkubGVuZ3RoID8gSlNPTi5wYXJzZShyZXBvcnRMaXN0KSA6IHt9O1xuICAgIGlmIChzaG93RGVmYXVsdCkge1xuICAgICAgdGhpcy5fdG1wSWdub3JlRGVmYXVsdCA9IHRydWU7XG4gICAgfVxuICAgIC8vIHNlbGYuc3RTaG93RGVmYXVsdCA9ICFzaG93RGVmYXVsdCA/IGZhbHNlIDogdHJ1ZVxuICAgIEJhc2VVdGlsLkxvZygnQXJjZ2lzQmFSZXBvcnRzIGluaXRpYWxpemUgLWZsYWdzPScsIHNlbGYuc3RTaG93Q2hlY2tib3hlcywgc2VsZi5zdFNob3dEZWZhdWx0KTtcbiAgICBzZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pOyAvLyBzZXQgdGhlIGJhLXJlcG9ydHMgdG9rZW5cbiAgICAvLyBTZXQgaWYgR2VvZW5yaWNobWVudFVybCB3YXMgb3B0aW9uYWxseSBwYXNzZWQgaW5cbiAgICBpZiAoc2VsZi5nZW9lbnJpY2htZW50VXJsKSB7XG4gICAgICBFbnZpcm9ubWVudHMuc2V0R2VvZW5yaWNobWVudFVybChzZWxmLmdlb2VucmljaG1lbnRVcmwpO1xuICAgIH1cbiAgICAvLyBTZXQgaWYgUG9ydGFsVXJsIHdhcyBvcHRpb25hbGx5IHBhc3NlZCBpblxuICAgIGlmIChzZWxmLnBvcnRhbFVybCkge1xuICAgICAgRW52aXJvbm1lbnRzLnNldFBvcnRhbFVybChzZWxmLnBvcnRhbFVybCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAvLyBGZXRjaCBpbmZvZ3JhcGhpYyB0ZW1wbGF0ZXMgZnJvbSBzZXJ2ZXJcbiAgICAgIGxldCBpbmZvcyA9IGF3YWl0IGdldEluZm9ncmFwaGljVGVtcGxhdGVzTGlzdChjb3VudHJ5LCBmYWxzZSk7XG4gICAgICBpZiAoaW5mb3MpIHtcbiAgICAgICAgc2VsZi5pbml0aWFsaXplVGVtcGxhdGVzTGlzdChpbmZvcyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLk15SW5mb2dyYXBoaWNzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5Fc3JpSW5mb2dyYXBoaWNzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHNlbGYuX2luZm9ncmFwaGljcy5TaGFyZWRJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgc2VsZi5faW5mb2dyYXBoaWNzLkdhbGxlcnlJbmZvZ3JhcGhpY3MuZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIH1cbiAgICBjYXRjaCAoZXgpIHtcbiAgICAgIEJhc2VVdGlsLkVycm9yKCdhcmNnaXMtcmVwb3J0LWxpc3QgcmVxdWVzdCBmb3IgZXNyaSByZXBvcnRzIGZhaWxlZCcsIGV4KTtcbiAgICB9XG4gIH1cbiAgLy8gTWVyZ2VzIHRoZSBwcmV2aW91cyB0ZW1wbGF0ZSBsaXN0IGNoZWNrZWQgc3RhdGVzIGludG8gYSBuZXcgbGlzdC5cbiAgLy8gSWYgYWxsIGl0ZW1zIGluIGxpc3QxIGFyZSBjaGVja2VkLCB0aGUgbmV3IGl0ZW1zIHdpbGwgYmUgY2hlY2tlZCxcbiAgLy8gb3RoZXJ3aXNlIHRoZSBuZXcgaXRlbXMgd2lsbCByZW1haW4gdW5jaGVja2VkLiAgVGhlIHJlc3VsdCBpcyBhblxuICAvLyB1cGRhdGVkIGxpc3QyXG4gIC8vICAgIGxpc3QxID0gcHJldmlvdXMgcmVwb3J0IGxpc3RcbiAgLy8gICAgbGlzdDIgPSBuZXcgcmVwb3J0IGxpc3QganVzdCBmZXRjaGVkIGZyb20gc2VydmVyXG4gIC8vXG4gIG1lcmdlQ2hlY2tlZChsaXN0MSwgbGlzdDIpIHtcbiAgICBpZiAoIWxpc3QxKVxuICAgICAgcmV0dXJuIGxpc3QyO1xuICAgIGlmICghbGlzdDIpXG4gICAgICByZXR1cm4gbGlzdDE7XG4gICAgbGV0IGFsbENoZWNrZWQgPSB0cnVlLCBpaSwgaWR4MSA9IHt9LCBpZHgyID0ge307XG4gICAgLy8gYnVpbGQgbGlzdDIgaW5kZXhcbiAgICBmb3IgKGlpID0gMDsgaWkgPCBsaXN0Mi5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGlkeDJbbGlzdDJbaWldLmlkXSA9IGxpc3QyW2lpXTtcbiAgICB9XG4gICAgLy8gY3JlYXRlIGxpc3QxIGluZGV4IGFuZCB1cGRhdGUgaWR4MiBjaGVja2VkIHN0YXRlcyBmcm9tIGxpc3QxXG4gICAgZm9yIChpaSA9IDA7IGlpIDwgbGlzdDEubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBpZiAoIWxpc3QxLmlzQ2hlY2tlZCkge1xuICAgICAgICBhbGxDaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBsaWQgPSBsaXN0MVtpaV0uaWQ7XG4gICAgICBpZHgxW2xpZF0gPSB0cnVlOyAvLyBpZCBleGlzdHMgaW4gaWR4MVxuICAgICAgLy8gaWYgbGlzdDEgaXRlbSBleGlzdHMgaW4gbGlzdDIgLSB3ZSBhcmUgcmVtb3ZpbmcgYW55XG4gICAgICAvLyBsaXN0MSBpdGVtcyB0aGF0IGFyZSBub3QgaW4gdGhlIG5ldyBmZXRjaGVkIGxpc3RcbiAgICAgIGlmIChpZHgyW2xpZF0pIHtcbiAgICAgICAgLy8ga2VlcCBwcmV2IGlzQ2hlY2tlZCBzdGF0ZVxuICAgICAgICBpZHgyW2xpZF0uaXNDaGVja2VkID0gbGlzdDFbaWldLmlzQ2hlY2tlZDtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gaWR4MiBpcyBub3cgdXBkYXRlZCB3aXRoIGFsbCB0aGUgbGlzdDEgY2hlY2tlZCBzdGF0ZXMuXG4gICAgLy8gTmV4dCwgdXBkYXRlIHRoZSBjaGVja2VkIHN0YXR1cyBvZiBuZXcgaXRlbXMgb25seSBpZiBhbGxcbiAgICAvLyB0aGUgbGlzdDEgaXRlbXMgd2VyZSBjaGVja2VkIChjYXRlZ29yeSB3YXMgY2hlY2tlZClcbiAgICBpZiAoYWxsQ2hlY2tlZCkge1xuICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbGlzdDIubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgIGNvbnN0IGxpZCA9IGxpc3QyW2lpXS5pZDtcbiAgICAgICAgLy8gaWYgdGhlIGl0ZW0gaXMgbmV3IHRvIGxpc3QxXG4gICAgICAgIGlmICghaWR4MVtsaWRdKSB7XG4gICAgICAgICAgbGlzdDJbaWldLmlzQ2hlY2tlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxpc3QyO1xuICB9XG4gIGluaXRpYWxpemVUZW1wbGF0ZXNMaXN0KGluZm9zKSB7XG4gICAgQmFzZVV0aWwuTG9nKCdSRVBPUlQgTElTVDogaW5pdCBsaXN0JywgaW5mb3MsIHRoaXMuc3RSZXBvcnRMaXN0KTtcbiAgICBsZXQgdXNlclJlcG9ydHMsIHB1YmxpY1JlcG9ydHMsIHNoYXJlZFJlcG9ydHMsIGdhbGxlcnlSZXBvcnRzO1xuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLnN0UmVwb3J0TGlzdCkubGVuZ3RoKSB7XG4gICAgICB1c2VyUmVwb3J0cyA9IHRoaXMubWVyZ2VDaGVja2VkKHRoaXMuc3RSZXBvcnRMaXN0LnVzZXIsIGluZm9zPy51c2VyKTtcbiAgICAgIHB1YmxpY1JlcG9ydHMgPSB0aGlzLm1lcmdlQ2hlY2tlZCh0aGlzLnN0UmVwb3J0TGlzdC5wdWJsaWMsIGluZm9zPy5wdWJsaWMpO1xuICAgICAgc2hhcmVkUmVwb3J0cyA9IHRoaXMubWVyZ2VDaGVja2VkKHRoaXMuc3RSZXBvcnRMaXN0LnNoYXJlZCwgaW5mb3M/LnNoYXJlZCk7XG4gICAgICBnYWxsZXJ5UmVwb3J0cyA9IHRoaXMubWVyZ2VDaGVja2VkKHRoaXMuc3RSZXBvcnRMaXN0LmdhbGxlcnksIGluZm9zPy5nYWxsZXJ5KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaW5mb3MpIHtcbiAgICAgIC8vIGRlZmF1bHQgbGlzdCBhbmQgY2hlY2tlZCBzdGF0ZXNcbiAgICAgIHVzZXJSZXBvcnRzID0gaW5mb3MudXNlci5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IGZhbHNlIH07IH0pO1xuICAgICAgcHVibGljUmVwb3J0cyA9IGluZm9zLnB1YmxpYy5tYXAocmVwb3J0ID0+IHsgcmV0dXJuIHsgLi4ucmVwb3J0LCBpc0NoZWNrZWQ6IHRydWUgfTsgfSk7XG4gICAgICBzaGFyZWRSZXBvcnRzID0gaW5mb3Muc2hhcmVkLm1hcChyZXBvcnQgPT4geyByZXR1cm4geyAuLi5yZXBvcnQsIGlzQ2hlY2tlZDogZmFsc2UgfTsgfSk7XG4gICAgICBnYWxsZXJ5UmVwb3J0cyA9IGluZm9zLmdhbGxlcnkubWFwKHJlcG9ydCA9PiB7IHJldHVybiB7IC4uLnJlcG9ydCwgaXNDaGVja2VkOiBmYWxzZSB9OyB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBCYXNlVXRpbC5FcnJvcignQXJjZ2lzUmVwb3J0TGlzdCBlcnJvciBpbml0aWFsaXppbmcgaW5mb2dyYXBoaWMgdGVtcGxhdGVzIC0gbm8gZGF0YScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmFjY29yZGlvbkluaXQuZW1pdCh7IHVzZXI6IHVzZXJSZXBvcnRzLCBwdWJsaWM6IHB1YmxpY1JlcG9ydHMsIHNoYXJlZDogc2hhcmVkUmVwb3J0cywgZ2FsbGVyeTogZ2FsbGVyeVJlcG9ydHMgfSk7XG4gICAgdGhpcy5faW5mb2dyYXBoaWNzLk15SW5mb2dyYXBoaWNzLmRhdGEgPSB1c2VyUmVwb3J0cztcbiAgICB0aGlzLl9pbmZvZ3JhcGhpY3MuRXNyaUluZm9ncmFwaGljcy5kYXRhID0gcHVibGljUmVwb3J0cztcbiAgICB0aGlzLl9pbmZvZ3JhcGhpY3MuU2hhcmVkSW5mb2dyYXBoaWNzLmRhdGEgPSBzaGFyZWRSZXBvcnRzO1xuICAgIHRoaXMuX2luZm9ncmFwaGljcy5HYWxsZXJ5SW5mb2dyYXBoaWNzLmRhdGEgPSBnYWxsZXJ5UmVwb3J0cztcbiAgICBCYXNlVXRpbC5Mb2coJ1JFUE9SVCBMSVNUIGluaXQgZW5kJywgdGhpcy5faW5mb2dyYXBoaWNzKTtcbiAgfVxuICBfYWNjb3JkaWFuSXRlbUNsaWNrSGFuZGxlcihldikge1xuICAgIHRoaXMub25SZXBvcnRDbGlja2VkLmNhbGwodGhpcywgZXYpO1xuICB9XG4gIF9hY2NvcmRpYW5JdGVtc0NoZWNrZWRIYW5kbGVyKGV2KSB7XG4gICAgdGhpcy5yZXBvcnRDaGVja2VkLmVtaXQoZXYuZGV0YWlsKTtcbiAgfVxuICAvLyBATWV0aG9kKClcbiAgYXN5bmMgc2V0U2hvd0RlZmF1bHQoZmxhZywgZGVmYXVsdElkKSB7XG4gICAgaWYgKGZsYWcpIHtcbiAgICAgIHRoaXMuX3RtcElnbm9yZURlZmF1bHQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZGVmYXVsdElkKSB7XG4gICAgICB0aGlzLl90bXBJZ25vcmVEZWZhdWx0ID0gdHJ1ZTtcbiAgICB9IC8vIHRtcCByZW1vdmUgdGhpc1xuICAgIC8vIHRoaXMuc3RTaG93RGVmYXVsdCA9IGZsYWdcbiAgICAvLyB0aGlzLnN0RGVmYXVsdFJlcG9ydElkID0gZGVmYXVsdElkXG4gIH1cbiAgYXN5bmMgc2V0TXVsdGlwbGVDaG9pY2UoZmxhZykge1xuICAgIHRoaXMuc3RNdWx0aXBsZUNob2ljZSA9IGZsYWc7XG4gIH1cbiAgLyoqXG4gICAqIFNldHMgaG9zdCBjYWxsYmFjayBmb3IgcHJvcGVydHkgY2hhbmdlIG5vdGlmaWNhdGlvbnNcbiAgICogQHBhcmFtIGNhbGxiYWNrICAtIGZ1bmN0aW9uIHN1cHBsaWVkIGJ5IGhvc3QgYWZ0ZXIgY29tcG9uZW50IGlzIGluc3RhbnRpYXRlZFxuICAgKiBAcGFyYW0gY29udGV4dCAgIC0gb2JqZWN0IHJlZmVyZW5jZSB0aGF0IGlzIHJldHVybmVkIGluIHRoZSBjYWxsYmFjayAodG8gdGhlIGhvc3QpXG4gICAqXG4gICAqIENhbGxiYWNrIGRhdGEgZm9ybWF0OlxuICAgKiAgICB7XG4gICAqICAgICAgPHByb3BlcnR5IG5hbWU+OiA8dmFsdWU+LFxuICAgKiAgICAgIDxvdGhlciBwcm9wIG5hbWU6IHZhbHVlLFxuICAgKiAgICAgIC4uLlxuICAgKiAgICB9XG4gICAqL1xuICBhc3luYyBvblByb3BDaGFuZ2UoY2FsbGJhY2ssIGNvbnRleHQpIHtcbiAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0geyBmbjogY2FsbGJhY2ssIGN0eDogY29udGV4dCB9O1xuICB9XG4gIGFzeW5jIHNldENvbG9yVGhlbWUobmFtZSkge1xuICAgIGlmIChuYW1lICYmIEFDTFV0aWxzLmhhc1RleHQobmFtZSkgJiYgdGhpcy5lbCkge1xuICAgICAgdGhpcy5zdENvbG9yVGhlbWUgPSBuYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgbiA9IG5hbWUudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAobiA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICB0aGlzLl9hY2NvcmRpb25UaGVtZSA9IG47XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1icmFuZCcsICcjMDA3YWMyJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1icmFuZC1ob3ZlcicsICcjMDA2MTliJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1icmFuZC1wcmVzcycsICcjMDA0ODc0Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1iYWNrZ3JvdW5kJywgJyNmOGY4ZjgnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMScsICcjZmZmZmZmJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTInLCAnI2YzZjNmMycpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0zJywgJyNlYWVhZWEnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtMScsICcjMTUxNTE1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTInLCAnIzRhNGE0YScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0zJywgJyM2YTZhNmEnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtaW52ZXJzZScsICcjZmZmZmZmJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LWxpbmsnLCAnIzAwNjE5YicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLTEnLCAnI2NhY2FjYScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLTInLCAnI2Q0ZDRkNCcpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLTMnLCAnI2RmZGZkZicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYm9yZGVyLWlucHV0JywgJyM5NDk0OTQnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWluZm8nLCAnIzAwNjE5YicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktc3VjY2VzcycsICcjMzVhYzQ2Jyk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChuID09PSAnZGFyaycpIHtcbiAgICAgICAgdGhpcy5fYWNjb3JkaW9uVGhlbWUgPSBuO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQnLCAnIzAwOWFmMicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtaG92ZXInLCAnIzAwN2FjMicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQtcHJlc3MnLCAnIzAwNjE5YicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYmFja2dyb3VuZCcsICcjMzUzNTM1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEnLCAnIzJiMmIyYicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0yJywgJyMyMDIwMjAnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWZvcmVncm91bmQtMycsICcjMTUxNTE1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTEnLCAnI2ZmZmZmZicpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC0yJywgJyNiZmJmYmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXRleHQtMycsICcjOWY5ZjlmJyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LWludmVyc2UnLCAnIzE1MTUxNScpO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktdGV4dC1saW5rJywgJyMwMGEwZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0xJywgJyM1NTU1NTUnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0yJywgJyM0YTRhNGEnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci0zJywgJyM0MDQwNDAnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLWJvcmRlci1pbnB1dCcsICcjNzU3NTc1Jyk7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1pbmZvJywgJyMwMGEwZmYnKTtcbiAgICAgICAgdGhpcy5lbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jYWxjaXRlLXVpLXN1Y2Nlc3MnLCAnIzM2ZGE0MycpO1xuICAgICAgfVxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgdGhpcy5fZ2V0U2hhZG93QWNjb3JkaW9uKCdNeUluZm9ncmFwaGljcycpLnNldENvbG9yVGhlbWUobik7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB0aGlzLl9nZXRTaGFkb3dBY2NvcmRpb24oJ0VzcmlJbmZvZ3JhcGhpY3MnKS5zZXRDb2xvclRoZW1lKG4pO1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgdGhpcy5fZ2V0U2hhZG93QWNjb3JkaW9uKCdTaGFyZWRJbmZvZ3JhcGhpY3MnKS5zZXRDb2xvclRoZW1lKG4pO1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgdGhpcy5fZ2V0U2hhZG93QWNjb3JkaW9uKCdHYWxsZXJ5SW5mb2dyYXBoaWNzJykuc2V0Q29sb3JUaGVtZShuKTtcbiAgICB9XG4gIH1cbiAgLy8gQE1ldGhvZCgpXG4gIGFzeW5jIHNldFNlbGVjdGVkSWQoaWQpIHtcbiAgICB0aGlzLnN0U2VsZWN0ZWRSZXBvcnRJZCA9IGlkO1xuICAgIHRoaXMuX3NldEFjY29yZGlvbnNSZXBvcnRJZCgpO1xuICB9XG4gIGFzeW5jIG9uRGVmYXVsdFJlcG9ydENoYW5nZShjYWxsYmFjaywgY29udGV4dCkge1xuICAgIHRoaXMuX29uRGVmYXVsdFJlcG9ydENhbGxiYWNrID0geyBmbjogY2FsbGJhY2ssIGN0eDogY29udGV4dCB9O1xuICB9XG4gIGFzeW5jIG9uQWNjb3JkaW9uSXRlbXNDaGVja2VkKGNhbGxiYWNrLCBjb250ZXh0KSB7XG4gICAgdGhpcy5fb25DaGVja2JveENoYW5nZUNhbGxiYWNrID0geyBmbjogY2FsbGJhY2ssIGN0eDogY29udGV4dCB9O1xuICB9XG4gIC8vIGluZm9ncmFwaGljIHRyZWUgZGVmYXVsdCByZXBvcnQgaWQgY2hhbmdlZFxuICByZXBvcnRTZWxlY3RlZEV2ZW50SGFuZGxlcihlKSB7XG4gICAgY29uc3QgcmVzdWx0ID0geyByZXBvcnRJZDogZS5kZXRhaWwucmVwb3J0SWQsIG5hbWU6IGUuZGV0YWlsLm5hbWUgfTtcbiAgICBCYXNlVXRpbC5Mb2coJ1JFUE9SVCBMSVNUIERFRkFVTFQgSUcgQ0hBTkdFRD0nLCByZXN1bHQpO1xuICAgIGNvbnN0IGNiID0gdGhpcy5fb25EZWZhdWx0UmVwb3J0Q2FsbGJhY2s7XG4gICAgaWYgKGNiICYmIHR5cGVvZiBjYi5mbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2IuZm4uY2FsbChjYi5jdHgsIHJlc3VsdCk7XG4gICAgfVxuICB9XG4gIF9nZXRTaGFkb3dBY2NvcmRpb24obmFtZSkge1xuICAgIGNvbnN0IGlkID0gdGhpcy5faW5mb2dyYXBoaWNzW25hbWVdLmFjY29yZGlvbklkO1xuICAgIGNvbnN0IGVsZW0gPSAodGhpcy5lbD8uc2hhZG93Um9vdCkgPyB0aGlzLmVsLnNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoaWQpIDogbnVsbDtcbiAgICByZXR1cm4gZWxlbTtcbiAgfVxuICBfc2V0QWNjb3JkaW9uc1JlcG9ydElkKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGlmICh0aGlzLnN0U2VsZWN0ZWRSZXBvcnRJZCkge1xuICAgICAgdGhpcy5fYWNjTGlzdC5mb3JFYWNoKChhKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjY0VsZW0gPSBzZWxmLl9nZXRTaGFkb3dBY2NvcmRpb24oYSk7XG4gICAgICAgIGlmIChhY2NFbGVtKSB7XG4gICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgIGFjY0VsZW0uc2V0U2VsZWN0ZWRJZChzZWxmLnN0U2VsZWN0ZWRSZXBvcnRJZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBfc2V0QWNjb3JkaW9uc0NoZWNrYm94KCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX2FjY0xpc3QuZm9yRWFjaCgoYSkgPT4ge1xuICAgICAgY29uc3QgYWNjRWxlbSA9IHNlbGYuX2dldFNoYWRvd0FjY29yZGlvbihhKTtcbiAgICAgIGlmIChhY2NFbGVtKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgYWNjRWxlbS5zZXRTaG93Q2hlY2tib3goc2VsZi5zdFNob3dDaGVja2JveGVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBfc2V0QWNjb3JkaW9uc0RlZmF1bHQoKSB7XG4gICAgLy8gY29uc3Qgc2VsZiA9IHRoaXNcbiAgICAvLyBpZiAodGhpcy5zdFNob3dEZWZhdWx0KSB7XG4gICAgLy8gICBjb25zdCBpZCA9IHRoaXMuc3REZWZhdWx0UmVwb3J0SWRcbiAgICAvLyAgIHRoaXMuX2FjY0xpc3QuZm9yRWFjaCgoYSkgPT4ge1xuICAgIC8vICAgICBjb25zdCBhY2NFbGVtID0gc2VsZi5fZ2V0U2hhZG93QWNjb3JkaW9uKGEpXG4gICAgLy8gICAgIGlmIChhY2NFbGVtKSB7XG4gICAgLy8gICAgICAgLy8gQHRzLWlnbm9yZVxuICAgIC8vICAgICAgIGFjY0VsZW0uc2V0U2hvd0RlZmF1bHQodHJ1ZSwgaWQpXG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH0pXG4gICAgLy8gfVxuICB9XG4gIC8qKlxuICAgKiBGaWx0ZXJzIG91dCBtdWx0aXBsZSByYXBpZCBldmVudHMgb2YgdGhlIHNhbWUgdHlwZS4gIFRoZSBjYWxsYmFja1xuICAgKiBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBpZiBubyBuZXcgZXZlbnRzIGhhdmUgaGFwcGVuZWQgZHVyaW5nIHRoZVxuICAgKiAnd2FpdCcgdGltZS5cbiAgICogQHBhcmFtIGNhbGxiYWNrIC0geW91ciBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGV2ZW50cyBoYXZlIHNldHRsZWRcbiAgICogQHBhcmFtIHdhaXQgICAgIC0gbWlsbGlzZWNvbmRzIGRlbGF5IChleDogMjUwKVxuICAgKi9cbiAgX2RlYm91bmNlMihjYWxsYmFjaywgd2FpdCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IGRlbGF5ZWRDYWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5fZGVib3VuY2VUaW1lciA9IG51bGw7XG4gICAgICBjYWxsYmFjay5hcHBseShzZWxmKTtcbiAgICB9O1xuICAgIC8vIGV2ZXJ5dGltZSBfZGVib3VuY2UyIGlzIGNhbGxlZCB3ZSBraWxsIHRoZSBwcmV2aW91cyB0aW1lclxuICAgIGlmIChzZWxmLl9kZWJvdW5jZVRpbWVyKVxuICAgICAgY2xlYXJUaW1lb3V0KHNlbGYuX2RlYm91bmNlVGltZXIpO1xuICAgIHNlbGYuX2RlYm91bmNlVGltZXIgPSBzZXRUaW1lb3V0KGRlbGF5ZWRDYWxsLCB3YWl0KTtcbiAgfVxuICBfb25GaWx0ZXJlZFByb3BDaGFuZ2VkKCkge1xuICAgIGlmICh0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKVxuICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjay5mbih0aGlzLl9vbkNoYW5nZUNhbGxiYWNrLmN0eCwgdGhpcy5fb25DaGFuZ2VRdWV1ZSk7XG4gICAgLy8gY2xlYXIgcXVldWVcbiAgICB0aGlzLl9vbkNoYW5nZVF1ZXVlID0ge307XG4gIH1cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCBieSB0aGlzIGNvbXBvbmVudCBpbnRlcm5hbGx5IHdoZW4gYSBQcm9wIGNoYW5nZXNcbiAgICogQHBhcmFtIG5hbWUgIC0gb2YgUHJvcFxuICAgKiBAcGFyYW0gdmFsdWUgLSB2YWx1ZSBhZnRlciBjaGFuZ2VcbiAgICovXG4gIF9vblByb3BDaGFuZ2VkKG5hbWUsIHZhbHVlKSB7XG4gICAgLy8gQWRkIG5hbWUvdmFsdWUgdG8gcXVldWVcbiAgICAvLyBTdWJzZXF1ZW50IGNhbGxzIHdpdGggdGhlIHNhbWUgbmFtZS92YWx1ZSBqdXN0IHVwZGF0ZXNcbiAgICAvLyB0aGUgdmFsdWUgdW50aWwgdGhlIGNhbGxiYWNrIGNsZWFycyB0aGUgcXVldWVcbiAgICB0aGlzLl9vbkNoYW5nZVF1ZXVlW25hbWVdID0gdmFsdWU7XG4gICAgdGhpcy5fZGVib3VuY2UyKHRoaXMuX29uRmlsdGVyZWRQcm9wQ2hhbmdlZCwgMjUwKTtcbiAgfVxuICBvblJlcG9ydENsaWNrZWQoZSkge1xuICAgIGxldCBpZCA9IGUuZGV0YWlsLml0ZW0uaWQ7XG4gICAgdGhpcy5zZXRSZXBvcnRJZChpZCwgZS5kZXRhaWwuaXRlbS5uYW1lKTtcbiAgfVxuICBzZXRSZXBvcnRJZChuZXdWYWx1ZSwgbmFtZSkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuc2VsZWN0ZWRSZXBvcnRJZCA9IG5ld1ZhbHVlO1xuICAgIHRoaXMucmVwb3J0U2VsZWN0ZWQuZW1pdCh7IGlkOiBzZWxmLnNlbGVjdGVkUmVwb3J0SWQsIG5hbWU6IG5hbWUgfSk7XG4gICAgdGhpcy5fb25Qcm9wQ2hhbmdlZCgncmVwb3J0SWQnLCB0aGlzLnNlbGVjdGVkUmVwb3J0SWQpO1xuICB9XG4gIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgIHRoaXMuc3RDb2xvcnMgPSB0aGlzLmNvbG9ycztcbiAgICBpZiAoIXRoaXMuX2hhc1NldEVudiAmJiB0aGlzLmVudikge1xuICAgICAgdGhpcy5faGFzU2V0RW52ID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3RFbnYgPSB0aGlzLmVudjtcbiAgICAgIEVudmlyb25tZW50cy5zZXRFbnZpcm9ubWVudCh0aGlzLmVudik7XG4gICAgfVxuICAgIHRoaXMuc3RTaG93Q2hlY2tib3hlcyA9IHRoaXMuc2hvd0NoZWNrYm94ZXM7XG4gICAgdGhpcy5zdFNlbGVjdGVkUmVwb3J0SWQgPSB0aGlzLnNlbGVjdGVkUmVwb3J0SWQ7XG4gICAgLy8gdGhpcy5zdFNob3dEZWZhdWx0ID0gdGhpcy5zaG93RGVmYXVsdCA9PSAndHJ1ZSdcbiAgICB0aGlzLnN0RGVmYXVsdFJlcG9ydElkID0gdGhpcy5kZWZhdWx0UmVwb3J0SWQgfHwgJ2Y5ZDk2MzIzYjhjZjRiZTliMDUyZWUzM2ZjZGI2Njc1JzsgLy8gZGVidWcgb25seVxuICB9XG4gIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgaWYgKEFDTFV0aWxzLmhhc1RleHQodGhpcy5jb2xvcnMpKSB7XG4gICAgICB0aGlzLnN0Q29sb3JzID0gQUNMVXRpbHMucGFyc2VUaGVtZVN0cmluZyh0aGlzLmNvbG9ycyk7XG4gICAgfVxuICAgIGlmIChzZWxmLnN0Q29sb3JzKSB7XG4gICAgICBzZWxmLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtdWktYnJhbmQnLCBzZWxmLnN0Q29sb3JzLmJyYW5kKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTEnLCBzZWxmLnN0Q29sb3JzLmZvcmVncm91bmQxKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTInLCBzZWxmLnN0Q29sb3JzLmZvcmVncm91bmQyKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1mb3JlZ3JvdW5kLTMnLCBzZWxmLnN0Q29sb3JzLmZvcmVncm91bmQyKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTEnLCBzZWxmLnN0Q29sb3JzLnRleHQxKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTInLCBzZWxmLnN0Q29sb3JzLnRleHQyKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS10ZXh0LTMnLCBzZWxmLnN0Q29sb3JzLnRleHQzKTtcbiAgICAgIHNlbGYuZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tY2FsY2l0ZS11aS1ib3JkZXItMicsIHNlbGYuc3RDb2xvcnMuYm9yZGVyMik7XG4gICAgICBzZWxmLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW0tYmFja2dyb3VuZCcsIHNlbGYuc3RDb2xvcnMuYWNjb3JkaW9uQmFja2dyb3VuZCk7XG4gICAgICBzZWxmLmVsLnN0eWxlLnNldFByb3BlcnR5KCctLWNhbGNpdGUtYWNjb3JkaW9uLWl0ZW0tZm9yZWdyb3VuZCcsIHNlbGYuc3RDb2xvcnMuYWNjb3JkaW9uRm9yZWdyb3VuZCk7XG4gICAgfVxuICAgIC8vIGlmIChzZWxmLnN0U2hvd0RlZmF1bHQpIHtcbiAgICAvLyAgIHNlbGYuX3NldEFjY29yZGlvbnNEZWZhdWx0KClcbiAgICAvLyB9XG4gIH1cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIHRoaXMuX3NldEFjY29yZGlvbnNSZXBvcnRJZCgpO1xuICAgIC8vIGlmICh0aGlzLnN0U2hvd0RlZmF1bHQpIHtcbiAgICAvLyAgIHRoaXMuX3NldEFjY29yZGlvbnNEZWZhdWx0KClcbiAgICAvLyB9XG4gICAgaWYgKHRoaXMuc3RTaG93Q2hlY2tib3hlcykge1xuICAgICAgdGhpcy5fc2V0QWNjb3JkaW9uc0NoZWNrYm94KCk7XG4gICAgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICBpZiAoIXRoaXMuX2lzSW5pdGlhbGl6ZWQpXG4gICAgICByZXR1cm47XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIChoKFwiZGl2XCIsIG51bGwsIHNlbGYucmVuZGVyTGlzdCgnRXNyaUluZm9ncmFwaGljcycpLCBzZWxmLnJlbmRlckxpc3QoJ015SW5mb2dyYXBoaWNzJyksIHNlbGYucmVuZGVyTGlzdCgnU2hhcmVkSW5mb2dyYXBoaWNzJyksIHNlbGYucmVuZGVyTGlzdCgnR2FsbGVyeUluZm9ncmFwaGljcycpKSk7XG4gIH1cbiAgcmVuZGVyTGlzdChuYW1lKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgbXVsdGkgPSBzZWxmLnN0TXVsdGlwbGVDaG9pY2UudG9TdHJpbmcoKTtcbiAgICBjb25zdCB0YWdzID0ge1xuICAgICAgJ015SW5mb2dyYXBoaWNzJzogJ3JlcG9ydC1teS1pbmZvZ3JhcGhpY3MnLFxuICAgICAgJ0VzcmlJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LWVzcmktaW5mb2dyYXBoaWNzJyxcbiAgICAgICdTaGFyZWRJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LXNoYXJlZC1pbmZvZ3JhcGhpY3MnLFxuICAgICAgJ0dhbGxlcnlJbmZvZ3JhcGhpY3MnOiAncmVwb3J0LWdhbGxlcnktaW5mb2dyYXBoaWNzJ1xuICAgIH07XG4gICAgY29uc3QgcmVwb3J0cyA9IHNlbGYuX2luZm9ncmFwaGljc1tuYW1lXS5kYXRhO1xuICAgIEJhc2VVdGlsLkxvZygnUkVQT1JUIExJU1QgcmVuZGVyTGlzdCcsIG5hbWUsIHJlcG9ydHMpO1xuICAgIGlmIChyZXBvcnRzICYmIHJlcG9ydHMubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IGFyciA9IFtdO1xuICAgICAgaWYgKChtdWx0aSA9PSAndHJ1ZScpICYmIHJlcG9ydHMubGVuZ3RoID4gNCkge1xuICAgICAgICAvLyBBZGQgJ0FsbCcgcm93IHdpdGggY2hlY2tib3hcbiAgICAgICAgbGV0IGEgPSB7XG4gICAgICAgICAgaWQ6IC0xLFxuICAgICAgICAgIG5hbWU6IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2Ryb3Bkb3duLWFsbCcpLFxuICAgICAgICAgIGljb246ICdmaWxlLXRleHQnLFxuICAgICAgICAgIHVzZXNDaGVja2JveDogdHJ1ZSxcbiAgICAgICAgICBpc0NoZWNrZWQ6IChuYW1lID09ICdFc3JpSW5mb2dyYXBoaWNzJylcbiAgICAgICAgfTtcbiAgICAgICAgYXJyLnB1c2goYSk7XG4gICAgICB9XG4gICAgICByZXBvcnRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgbGV0IHJvdyA9IHtcbiAgICAgICAgICBpZDogaXRlbS5pZCxcbiAgICAgICAgICBuYW1lOiBpdGVtLnRpdGxlLFxuICAgICAgICAgIGRhdGU6IGl0ZW0uZGF0ZSxcbiAgICAgICAgICBpc0NoZWNrZWQ6IGl0ZW0uaXNDaGVja2VkLFxuICAgICAgICAgIGljb246ICdmaWxlLXRleHQnXG4gICAgICAgIH07XG4gICAgICAgIGlmIChtdWx0aSA9PSAndHJ1ZScpIHtcbiAgICAgICAgICByb3cudXNlc0NoZWNrYm94ID0gdHJ1ZTtcbiAgICAgICAgICAvL3Jvdy5pc0NoZWNrZWQgPSAobmFtZSA9PSAnRXNyaUluZm9ncmFwaGljcycpXG4gICAgICAgIH1cbiAgICAgICAgYXJyLnB1c2gocm93KTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGFycik7XG4gICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4odGFnc1tuYW1lXSk7XG4gICAgICBjb25zdCBhY2NJZCA9IHNlbGYuX2luZm9ncmFwaGljc1tuYW1lXS5hY2NvcmRpb25JZDtcbiAgICAgIEJhc2VVdGlsLkxvZygnUkVQT1JUUyByZW5kZXI6ICcsIHRoaXMuc3RTaG93Q2hlY2tib3hlcywgdGhpcy5zdFNob3dEZWZhdWx0LCBjb250ZW50KTtcbiAgICAgIC8vIGNyZWF0ZSBhbiBhY2NvcmRpb24gZm9yIHRoaXMgbGV2ZWwgd2l0aCBhbGwgcmVjb3Jkc1xuICAgICAgcmV0dXJuIChoKFwiYmEtYWNjb3JkaW9uXCIsIHsgaWQ6IGFjY0lkLCBjbGFzczogXCJyZXBvcnRMaXN0XCIsIGRpc3BsYXluYW1lOiBkaXNwbGF5TmFtZSwgcmVwb3J0c0dyb3VwSWQ6IG5hbWUsIGNvbnRlbnQ6IGNvbnRlbnQsIHNob3dDaGVja2JveGVzOiB0aGlzLnN0U2hvd0NoZWNrYm94ZXMsXG4gICAgICAgIC8vICBzaG93RGVmYXVsdD17dGhpcy5zdFNob3dEZWZhdWx0LnRvU3RyaW5nKCl9XG4gICAgICAgIC8vICBkZWZhdWx0UmVwb3J0SWQ9e3RoaXMuc3REZWZhdWx0UmVwb3J0SWR9XG4gICAgICAgIC8vIHJlbW92aW5nIHJlcG9ydExpc3QgcHJvcCwgdXNlIGNvbnRlbnQgb25seVxuICAgICAgICAvL3JlcG9ydExpc3Q9e0pTT04uc3RyaW5naWZ5KHRoaXMuc3RSZXBvcnRMaXN0KX1cbiAgICAgICAgc2VsZWN0ZWRJZDogdGhpcy5zdFNlbGVjdGVkUmVwb3J0SWQsIG9uQWNjb3JkaW9uSXRlbUNsaWNrZWQ6IGV2ID0+IHRoaXMuX2FjY29yZGlhbkl0ZW1DbGlja0hhbmRsZXIoZXYpLCBvbkFjY29yZGlvbkl0ZW1zQ2hlY2tlZDogKGV2KSA9PiB0aGlzLl9hY2NvcmRpYW5JdGVtc0NoZWNrZWRIYW5kbGVyKGV2KSB9KSk7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfVxuICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgXCJlbnZcIjogW1wib25FbnZDaGFuZ2VkXCJdLFxuICAgIFwibGFuZ0NvZGVcIjogW1wib25MYW5nQ29kZUNoYW5nZWRcIl0sXG4gICAgXCJzb3VyY2VDb3VudHJ5XCI6IFtcIm9uU291cmNlQ291bnRyeUNoYW5nZWRcIl0sXG4gICAgXCJjb2xvcnNcIjogW1wib25Db2xvcnNDaGFuZ2VkXCJdLFxuICAgIFwiZGVmYXVsdFJlcG9ydElkXCI6IFtcIm9uRGVmYXVsdFJlcG9ydENoYW5nZWRcIl0sXG4gICAgXCJzZWxlY3RlZFJlcG9ydElkXCI6IFtcIm9uU2VsZWN0ZWRSZXBvcnRDaGFuZ2VkXCJdLFxuICAgIFwic2hvd0NoZWNrYm94ZXNcIjogW1wib25zaG93Q2hlY2tib3hlc0NoYW5nZWRcIl0sXG4gICAgXCJzaG93RGVmYXVsdFwiOiBbXCJvbnNob3dEZWZhdWx0Q2hhbmdlZFwiXSxcbiAgICBcInJlcG9ydExpc3RcIjogW1wib25yZXBvcnRMaXN0Q2hhbmdlZFwiXVxuICB9OyB9XG59O1xuQXJjZ2lzUmVwb3J0TGlzdC5zdHlsZSA9IGFyY2dpc1JlcG9ydExpc3RDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1JlcG9ydExpc3QgYXMgYXJjZ2lzX3JlcG9ydF9saXN0IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1yZXBvcnQtbGlzdC5lbnRyeS5qcy5tYXAiLCJpbXBvcnQgeyBHIGFzIEdFQ2xpZW50LCBUIGFzIFRva2VuUHJvdmlkZXIgfSBmcm9tICcuL0dFQ2xpZW50LTFhODNhNjU3LmpzJztcbmltcG9ydCB7IEIgYXMgQmFSZXBvcnRzTGFuZ3VhZ2UgfSBmcm9tICcuL0VsZW1lbnRJZHMtZjdkMjU3ZTguanMnO1xuXG5mdW5jdGlvbiBzZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodXNlcm5hbWUgIT0gbnVsbCAmJiB1c2VybmFtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAodG9rZW4gIT0gbnVsbCAmJiB0b2tlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgVG9rZW5Qcm92aWRlci5zZXRUb2tlbih1c2VybmFtZSwgdG9rZW4pO1xuICAgICAgICAgICAgICAgIHJldHVybiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdvaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJhUmVwb3J0c0xhbmd1YWdlLmkxOG4oJ2ludmFsaWQtdG9rZW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBCYVJlcG9ydHNMYW5ndWFnZS5pMThuKCdpbnZhbGlkLXVzZXJuYW1lJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgIHJldHVybiBleDtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QoY291bnRyeUNvZGUsIGZ1bGwgPSBmYWxzZSkge1xuICAgIHJldHVybiBhd2FpdCBHRUNsaWVudC5nZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QoY291bnRyeUNvZGUsIGZ1bGwpO1xufVxuXG5leHBvcnQgeyBnZXRJbmZvZ3JhcGhpY1RlbXBsYXRlc0xpc3QgYXMgZywgc2V0VG9rZW4gYXMgcyB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmNnaXNSZXBvcnRzLWExZGMyNmFhLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==