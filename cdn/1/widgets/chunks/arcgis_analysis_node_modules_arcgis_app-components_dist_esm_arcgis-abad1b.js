"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-abad1b"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-floor-configuration_11.entry.js":
/*!********************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-floor-configuration_11.entry.js ***!
  \********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_floor_configuration: () => (/* binding */ ArcgisFloorConfiguration),
/* harmony export */   arcgis_floor_configuration_add_layers: () => (/* binding */ ArcgisFloorAddLayers),
/* harmony export */   arcgis_floor_configuration_add_layers_flow: () => (/* binding */ ArcgisFloorAddLayersFlow),
/* harmony export */   arcgis_floor_configuration_additional_layers: () => (/* binding */ ArcgisFloorAdditionalLayers),
/* harmony export */   arcgis_floor_configuration_field_list: () => (/* binding */ ArcgisFieldList),
/* harmony export */   arcgis_floor_configuration_field_picker: () => (/* binding */ ArcgisFloorFieldPicker),
/* harmony export */   arcgis_floor_configuration_field_select: () => (/* binding */ ArcgisFloorConfigurationFieldSelect),
/* harmony export */   arcgis_floor_configuration_layer_list: () => (/* binding */ ArcgisLayerList),
/* harmony export */   arcgis_floor_configuration_layer_picker: () => (/* binding */ ArcgisLayerPicker),
/* harmony export */   arcgis_floor_configuration_replace_field: () => (/* binding */ ArcgisFloorReplaceField),
/* harmony export */   arcgis_floor_configuration_select_fields: () => (/* binding */ ArcgisFloorSelectFields)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */






const CSS = {
    container: "container",
    section: "section",
    title: "title",
    missing: "missing"
};

const floorInfoSchema = {
    facilityLayer: {
        facilityIdField: "FACILITY_ID",
        siteIdField: "SITE_ID",
        nameField: "NAME"
    },
    levelLayer: {
        levelIdField: "LEVEL_ID",
        facilityIdField: "FACILITY_ID",
        longNameField: "NAME",
        shortNameField: "NAME_SHORT",
        levelNumberField: "LEVEL_NUMBER",
        verticalOrderField: "VERTICAL_ORDER"
    },
    siteLayer: {
        siteIdField: "SITE_ID",
        nameField: "NAME"
    }
};
let tempFloorInfo;
const getMapFloorInfo = (view) => {
    var _a;
    const map = view === null || view === void 0 ? void 0 : view.map;
    tempFloorInfo = tempFloorInfo || (map === null || map === void 0 ? void 0 : map.floorInfo) || Object.assign({}, floorInfoSchema);
    // SiteLayer is optional, but might be specified without a
    // layerId if so we should remove it so the schema can still validate
    tempFloorInfo.siteLayer = ((_a = tempFloorInfo === null || tempFloorInfo === void 0 ? void 0 : tempFloorInfo.siteLayer) === null || _a === void 0 ? void 0 : _a.layerId) ? tempFloorInfo.siteLayer : null;
    return tempFloorInfo;
};
const setMapFloorInfo = (view) => {
    const map = view === null || view === void 0 ? void 0 : view.map;
    const mapFloorInfo = getMapFloorInfo(view);
    if (map && validateFloorInfo(mapFloorInfo)) {
        map.set("floorInfo", mapFloorInfo);
    }
    else {
        removeMapFloorInfo(view);
    }
};
const updateMapFloorInfo = (floorInfoProps, view) => {
    const mapFloorInfo = getMapFloorInfo(view);
    const { name } = floorInfoProps;
    const layer = floorInfoProps.layer;
    const isSublayer = !!(layer === null || layer === void 0 ? void 0 : layer.layer);
    if (layer) {
        mapFloorInfo[name] = Object.assign({}, floorInfoSchema[name]);
        mapFloorInfo[name].layerId = isSublayer ? layer.layer.id : layer.id;
        mapFloorInfo[name].sublayerId = isSublayer ? layer.id : undefined;
    }
    else {
        mapFloorInfo[name] = undefined;
    }
    setMapFloorInfo(view);
};
const removeMapFloorInfo = (view) => {
    const map = view === null || view === void 0 ? void 0 : view.map;
    if (map) {
        map.floorInfo = null;
    }
};
const validateFloorInfo = (mapFloorInfo) => {
    var _a, _b;
    return ((_a = mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.facilityLayer) === null || _a === void 0 ? void 0 : _a.layerId) &&
        ((_b = mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.levelLayer) === null || _b === void 0 ? void 0 : _b.layerId) &&
        (!(mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.siteLayer) || (mapFloorInfo === null || mapFloorInfo === void 0 ? void 0 : mapFloorInfo.siteLayer.layerId))
        ? true
        : false;
};
const getRequiredFields = (name) => {
    const schema = floorInfoSchema[name];
    return Object.values(schema);
};
const getNonFloorLayers = (view) => {
    const { map } = view;
    const { allLayers } = map;
    let nonFloorLayers = [];
    allLayers.forEach((layer) => {
        const { type, floorInfo } = layer;
        if (type === "map-image") {
            const { allSublayers } = layer;
            nonFloorLayers = nonFloorLayers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex && !(subLayer === null || subLayer === void 0 ? void 0 : subLayer.floorInfo)).toArray());
        }
        else if (!floorInfo && type === "feature") {
            nonFloorLayers.push(layer);
        }
    });
    return nonFloorLayers;
};
const getCompatibleLayers = async (view) => {
    const { map } = view;
    const { allLayers } = map;
    const promises = allLayers
        .map(async (layer) => await loadAll(layer))
        .filter((layer) => (layer === null || layer === void 0 ? void 0 : layer.loadStatus) !== "failed");
    // Make sure all layers and sublayers are loaded
    // before checking them for compatibility
    const validLayers = await Promise.all(promises);
    let compatibleLayers = [];
    validLayers.forEach((layer) => {
        const { type, geometryType } = layer;
        if (type === "map-image") {
            const { allSublayers } = layer;
            compatibleLayers = compatibleLayers.concat(allSublayers
                .filter((subLayer) => { var _a; return subLayer.fieldsIndex && ((_a = subLayer.sourceJSON) === null || _a === void 0 ? void 0 : _a.geometryType) === "esriGeometryPolygon"; })
                .toArray());
        }
        else if (type === "feature" && geometryType === "polygon") {
            compatibleLayers.push(layer);
        }
    });
    return compatibleLayers;
};
const loadAll = (layer) => {
    try {
        layer.loadAll ? layer.loadAll() : layer.load();
    }
    catch (_a) { }
    return layer;
};
const getFloorLayer = (name, view) => {
    var _a, _b;
    const map = view.map;
    const layers = map.allLayers;
    const floorInfo = getMapFloorInfo(view);
    const layerId = (_a = floorInfo === null || floorInfo === void 0 ? void 0 : floorInfo[name]) === null || _a === void 0 ? void 0 : _a.layerId;
    const sublayerId = (_b = floorInfo === null || floorInfo === void 0 ? void 0 : floorInfo[name]) === null || _b === void 0 ? void 0 : _b.sublayerId;
    let floorLayer = layerId ? layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId) : null;
    if ((floorLayer === null || floorLayer === void 0 ? void 0 : floorLayer.type) === "map-image") {
        floorLayer = floorLayer.allSublayers.find((sublayer) => sublayer.id === sublayerId);
    }
    return floorLayer;
};
const setFloorInfo = (element) => {
    let { layer, field } = element;
    if ((element === null || element === void 0 ? void 0 : element.localName) === "arcgis-field-list") {
        field = element.selection.values().next().value;
    }
    const floorInfo = layer.floorInfo || {};
    floorInfo.floorField = field.name;
    layer.set("floorInfo", floorInfo);
};

const ArcgisFloorConfiguration = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.floorInfoChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "floorInfoChange", 7);
        this.view = undefined;
        this.layer = undefined;
        this.open = true;
        this.disabled = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        const [strings] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.hostElement);
        this.strings = strings;
        const { view } = this;
        this.props = {
            view,
            strings
        };
        this.disabled = this.disabled || (await this.getDisabled());
    }
    async componentDidLoad() {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__.l)(["esri/intl"]);
        this.intl = intl;
        this.intl.setLocale(document.documentElement.lang);
    }
    //--------------------------------------------------------------------------
    //
    //  Event Listeners
    //
    //--------------------------------------------------------------------------
    addMapFloorInfo() {
        setMapFloorInfo(this.view);
        this.floorInfoChange.emit();
    }
    removeFloorInfo() {
        removeMapFloorInfo(this.view);
        this.floorInfoChange.emit();
    }
    updateFloorInfo(props) {
        updateMapFloorInfo(props, this.view);
        this.floorInfoChange.emit();
    }
    disableContainer(e) {
        const { detail } = e;
        const container = this.hostElement.closest("calcite-flow-item");
        if (container) {
            container.disabled = detail;
        }
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    closeAllLayerPickers() {
        const pickers = document.querySelectorAll("arcgis-floor-configuration-layer-picker");
        pickers.forEach((picker) => (picker.open = false));
    }
    async getDisabled() {
        const mapView = this.view;
        const compatibleLayers = await getCompatibleLayers(mapView);
        const sections = ["facilityLayer", "levelLayer"];
        // For each floorInfoSection we need to check that each polygon layer in the map
        // has the required fields in order to enable this component
        const supportedSections = sections.filter((sectionName) => {
            var _a;
            return (_a = compatibleLayers.filter((layer) => this.hasRequiredFields(layer, getRequiredFields(sectionName)))) === null || _a === void 0 ? void 0 : _a.length;
        });
        return !(supportedSections === null || supportedSections === void 0 ? void 0 : supportedSections.length);
    }
    hasRequiredFields(layer, requiredFields) {
        if (layer) {
            const { fieldsIndex } = layer;
            return ((fieldsIndex && requiredFields.every((fieldName) => !!fieldsIndex.get(fieldName))) || false);
        }
        else {
            return false;
        }
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { strings, open, disabled } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: CSS.container, heading: strings.heading, collapsible: true, disabled: disabled, open: open && !disabled }, this.renderFloorConfiguration())));
    }
    renderFloorConfiguration() {
        const { strings, view } = this;
        const map = view.map;
        const open = (map === null || map === void 0 ? void 0 : map.floorInfo) ? true : false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.enable, open: open, "toggle-display": "switch", onCalciteBlockSectionToggle: (e) => e.currentTarget.open ? this.addMapFloorInfo() : this.removeFloorInfo() }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", null, strings.summary), this.renderLayerPicker("siteLayer"), this.renderLayerPicker("facilityLayer"), this.renderLayerPicker("levelLayer"), this.renderAdditionalLayers()));
    }
    renderLayerPicker(name) {
        const { strings, view } = this;
        const floorLayer = getFloorLayer(name, view);
        const requiredFields = getRequiredFields(name);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-picker", { view: this.view, label: strings[name], strings: strings, selectedLayer: floorLayer, requiredFields: requiredFields, onListChange: (e) => this.updateFloorInfo({ layer: (e === null || e === void 0 ? void 0 : e.detail) ? e === null || e === void 0 ? void 0 : e.detail[0] : null, name: name }) }));
    }
    renderAdditionalLayers() {
        const { strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block-section", { text: strings.additionalLayers, open: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-additional-layers", { view: this.view, strings: this.strings, onDisable: (e) => this.disableContainer(e) })));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorAddLayers = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.listChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
        this.view = undefined;
        this.layers = undefined;
        this.selection = new Map();
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Events
    //
    //--------------------------------------------------------------------------
    selectionChange() {
        this.listChange.emit(this.selection);
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
    }
    renderPanel() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-list", { layers: getNonFloorLayers(this.view), "filter-enabled": true, multiple: true, strings: this.strings, onListChange: (e) => (this.selection = e.detail) })));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "selection": ["selectionChange"]
    }; }
};

const arcgisFloorConfigurationAddLayersFlowCss = ".content{width:20vw;max-width:420px;min-width:240px;max-height:40vh}";

const ArcgisFloorAddLayersFlow = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.done = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "done", 7);
        this.dismiss = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dismiss", 7);
        this.view = undefined;
        this.strings = undefined;
        this.layers = undefined;
        this.selectedLayers = undefined;
        this.mode = "create";
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderFlow());
    }
    renderFlow() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (el) => this.createPanels(el) });
    }
    // --------------------------------------------------------------------------
    //
    //  Event Handlers
    //
    //--------------------------------------------------------------------------
    onCreate(e) {
        e.stopPropagation();
        this.done.emit();
    }
    onEdit(e) {
        e.stopPropagation();
        this.done.emit();
    }
    onDismiss(e) {
        e.stopPropagation();
        this.dismiss.emit();
    }
    // --------------------------------------------------------------------------
    //
    //  Protected methods
    //
    // --------------------------------------------------------------------------
    createPanels(el) {
        const { mode } = this;
        if (mode === "create") {
            return this.createAddLayersPanel(el);
        }
        else if (mode === "edit") {
            return this.createReplaceFieldsPanel(el);
        }
    }
    createAddLayersPanel(flow) {
        const addLayersPanel = document.createElement("arcgis-floor-configuration-add-layers");
        addLayersPanel.strings = this.strings;
        addLayersPanel.view = this.view;
        addLayersPanel.classList.add("content");
        addLayersPanel.addEventListener("listChange", (e) => { var _a; return (nextButton.disabled = !((_a = e.detail) === null || _a === void 0 ? void 0 : _a.length)); });
        const panel = this.createPanel({
            heading: this.strings.addLayers
        });
        panel.appendChild(addLayersPanel);
        const dismissButton = this.createButton({
            label: this.strings.cancel,
            appearance: "outline-fill",
            eventListener: this.onDismiss.bind(this)
        });
        panel.appendChild(dismissButton);
        const nextButton = this.createButton({
            label: this.strings.next,
            appearance: "solid",
            disabled: true,
            eventListener: () => {
                //const selectedLayers = (this.selectedLayers = addLayersPanel.selection);
                this.createSelectFloorFieldsPanel(addLayersPanel.selection, flow);
            }
        });
        panel.appendChild(nextButton);
        flow.appendChild(panel);
    }
    createSelectFloorFieldsPanel(layers, flow) {
        const selectFloorFieldsPanel = document.createElement("arcgis-floor-configuration-select-fields");
        selectFloorFieldsPanel.classList.add("content");
        selectFloorFieldsPanel.strings = this.strings;
        selectFloorFieldsPanel.layers = layers;
        selectFloorFieldsPanel.view = this.view;
        const panel = this.createPanel({
            heading: this.strings.selectFloorField
        });
        panel.appendChild(selectFloorFieldsPanel);
        const cancelButton = this.createButton({
            label: this.strings.cancel,
            appearance: "outline-fill",
            eventListener: this.onDismiss.bind(this)
        });
        panel.appendChild(cancelButton);
        const doneButton = this.createButton({
            label: this.strings.add,
            appearance: "solid",
            eventListener: async (e) => {
                await selectFloorFieldsPanel.commit();
                this.onCreate(e);
            }
        });
        panel.appendChild(doneButton);
        flow.appendChild(panel);
    }
    createReplaceFieldsPanel(flow) {
        const layer = this.layers[0];
        const replaceFloorFieldsPanel = document.createElement("arcgis-floor-configuration-replace-field");
        replaceFloorFieldsPanel.classList.add("content");
        replaceFloorFieldsPanel.strings = this.strings;
        replaceFloorFieldsPanel.view = this.view;
        replaceFloorFieldsPanel.layer = layer;
        const panel = this.createPanel({
            heading: layer.title,
            summary: this.strings.replaceFloorField
        });
        panel.appendChild(replaceFloorFieldsPanel);
        const replaceButton = this.createButton({
            label: this.strings.replace,
            width: "full",
            eventListener: async (e) => {
                await replaceFloorFieldsPanel.commit();
                this.onEdit(e);
            }
        });
        panel.appendChild(replaceButton);
        flow.appendChild(panel);
    }
    createPanel(panelProps) {
        const panel = document.createElement("calcite-flow-item");
        panel.heading = panelProps.heading;
        panel.description = panelProps.summary;
        panel.closable = true;
        panel.closed = false;
        panel.addEventListener("calcitePanelClose", this.onDismiss.bind(this));
        return panel;
    }
    createButton(buttonProps) {
        const { appearance = "solid", label, eventListener, width = "half", disabled = false } = buttonProps;
        const button = document.createElement("calcite-button");
        button.slot = "footer";
        button.appearance = appearance;
        button.disabled = disabled;
        button.width = width;
        const text = document.createTextNode(label);
        button.appendChild(text);
        button.addEventListener("click", eventListener);
        return button;
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorAddLayersFlow.style = arcgisFloorConfigurationAddLayersFlowCss;

const arcgisFloorConfigurationAdditionalLayersCss = ":host{height:100%}calcite-notice{margin-bottom:1em}";

const ArcgisFloorAdditionalLayers = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.dismiss = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "dismiss", 7);
        this.disable = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "disable", 7);
        this.floorInfoChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "floorInfoChange", 7);
        this.reRender = undefined;
        this.view = undefined;
        this.strings = undefined;
        this.placement = "bottom-start";
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    disconnectedCallback() {
        var _a;
        const { popoverNode } = this;
        if (popoverNode) {
            popoverNode.open = false;
            (_a = popoverNode.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(popoverNode);
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        return (_a = this.layerPanel) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    open() {
        // To avoid flicker when the popover aligns to the
        // referenceElement we add a small delay before opening
        setTimeout(() => (this.popoverNode.open = true), 25);
    }
    close(changes) {
        this.disableContainer(false);
        const { popoverNode } = this;
        popoverNode.open = false;
        popoverNode.remove();
        this.popoverNode = null;
        this.reRender = !this.reRender;
        if (changes) {
            this.floorInfoChange.emit();
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Event Listeners
    //
    //--------------------------------------------------------------------------
    create() {
        const popoverNode = this.createPopover();
        const createFlow = this.createAddLayersFlow("create");
        popoverNode.appendChild(createFlow);
        this.open();
    }
    edit(e) {
        const layer = this.getSelectedLayer(e);
        const popoverNode = this.createPopover();
        const editFlow = this.createAddLayersFlow("edit");
        editFlow.layers = [layer];
        popoverNode.appendChild(editFlow);
        this.open();
    }
    removeLayer(layer) {
        layer.floorInfo = null;
        this.reRender = !this.reRender;
        this.floorInfoChange.emit();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderNotice(), this.renderPanel()));
    }
    renderNotice() {
        const { strings } = this;
        const layers = this.getLayers();
        return (layers === null || layers === void 0 ? void 0 : layers.length) ? null : ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { scale: "s", width: "auto", open: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, strings.additionalLayersTip)));
    }
    renderPanel() {
        const { strings } = this;
        const nonFloorLayers = getNonFloorLayers(this.view);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { ref: (el) => (this.layerPanel = el) }, this.renderLayers(), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-fab", { slot: "fab", icon: "plus", appearance: "outline-fill", kind: "neutral", "text-enabled": true, label: strings.addLayers, text: strings.addLayers, disabled: nonFloorLayers.length === 0, scale: "s", ref: (el) => (this.triggerButton = el), onClick: () => this.create() })));
    }
    renderLayers() {
        const layers = this.getLayers();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-value-list", { dir: "ltr", class: "calcite-mode-light", onClick: (e) => this.edit(e) }, layers.map((layer) => this.renderLayer(layer))));
    }
    renderLayer(floorLayer) {
        const { title, floorInfo, id } = floorLayer;
        const { floorField } = floorInfo;
        const fieldName = `{${floorField}}`;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-value-list-item", { label: title, description: fieldName, value: id }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { slot: "actions-end", text: this.strings.remove, icon: "x", onClick: (e) => {
                e.stopPropagation();
                this.removeLayer(floorLayer);
            } })));
    }
    // --------------------------------------------------------------------------
    //
    //  Protected methods
    //
    // --------------------------------------------------------------------------
    disableContainer(disable) {
        const block = this.el.closest("calcite-block");
        if (block) {
            block.disabled = disable;
        }
        this.disable.emit(disable);
    }
    createAddLayersFlow(mode) {
        this.disableContainer(true);
        const addLayersFlow = (this.addLayersFlow = document.createElement("arcgis-floor-configuration-add-layers-flow"));
        addLayersFlow.strings = this.strings;
        addLayersFlow.view = this.view;
        addLayersFlow.mode = mode;
        addLayersFlow.addEventListener("done", this.close.bind(this, true));
        addLayersFlow.addEventListener("dismiss", this.close.bind(this, false));
        return addLayersFlow;
    }
    createPopover() {
        const referenceElement = this.el;
        const popoverNode = (this.popoverNode =
            document.createElement("calcite-popover"));
        popoverNode.classList.add("js-app-primary-flyout");
        popoverNode.referenceElement = referenceElement;
        popoverNode.offsetDistance = -550;
        popoverNode.offsetSkidding = 0;
        popoverNode.label = this.strings.addLayers;
        popoverNode.placement = "bottom-start";
        popoverNode.pointerDisabled = true;
        document.body.appendChild(popoverNode);
        return popoverNode;
    }
    getSelectedLayer(e) {
        var _a, _b, _c, _d, _e;
        if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-value-list-item" ||
            ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-value-list-item") {
            const id = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
            return this.findLayer(id);
        }
    }
    getLayers() {
        const mapView = this.view;
        const { map } = mapView;
        const { allLayers } = map;
        let layers = [];
        allLayers.forEach((layer) => {
            const { type, floorInfo } = layer;
            if (type === "map-image") {
                const { allSublayers } = layer;
                layers = layers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex && (subLayer === null || subLayer === void 0 ? void 0 : subLayer.floorInfo)).toArray());
            }
            else if (floorInfo) {
                layers.push(layer);
            }
        });
        return layers;
    }
    findLayer(layerId) {
        const layers = this.getLayers();
        return layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId);
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorAdditionalLayers.style = arcgisFloorConfigurationAdditionalLayersCss;

const ArcgisFieldList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.listChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
        this.layer = undefined;
        this.selection = new Map();
        this.filterEnabled = true;
        this.multiple = false;
        this.strings = undefined;
        this.fieldType = "string";
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { "filter-enabled": this.filterEnabled, "filter-placeholder": this.strings.filter, multiple: this.multiple, onClick: (e) => this.onListChange(e) }, this.renderFields())));
    }
    renderFields() {
        let fields = this.getFields();
        return (fields || []).map((field) => this.renderField(field));
    }
    renderField(field) {
        const fieldName = `{${field.name}}`;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { label: field.alias, description: fieldName, selected: this.selection.has(field.name), value: field.name }));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    onListChange(e) {
        const { selection } = this;
        this.updateSelection(e);
        this.listChange.emit(Array.from(selection.values()));
    }
    updateSelection(e) {
        var _a, _b, _c, _d, _e;
        if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-pick-list-item" ||
            ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-pick-list-item") {
            const { selection } = this;
            const selectedFieldName = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
            const isRemoved = selection.has(selectedFieldName);
            const selectedField = this.findField(selectedFieldName);
            if (!this.multiple) {
                selection.clear();
            }
            if (!isRemoved) {
                this.selection.set(selectedFieldName, selectedField);
            }
            else {
                this.selection.delete(selectedField.name);
            }
        }
    }
    getFields() {
        const { layer, fieldType } = this;
        const { fields } = layer;
        return (fields === null || fields === void 0 ? void 0 : fields.length)
            ? fields.filter((field) => !fieldType || (field === null || field === void 0 ? void 0 : field.type) === fieldType)
            : [];
    }
    findField(name) {
        const { layer } = this;
        return layer.fieldsIndex.get(name);
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorFieldPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.iconEnd = "pencil";
        this.label = undefined;
        this.layer = undefined;
        this.placement = "auto";
        this.open = undefined;
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        var _a;
        const buttonText = ((_a = this.layer) === null || _a === void 0 ? void 0 : _a.title) || this.strings.none;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", kind: "neutral", scale: "m", "icon-end": this.iconEnd, ref: (el) => (this.triggerButton = el), onClick: () => (this.open = !this.open) }, buttonText)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.label, pointerDisabled: true, referenceElement: this.triggerButton, open: this.open, closable: true, placement: this.placement }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisFloorConfigurationFieldSelect = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.layer = undefined;
        this.strings = undefined;
        this.field = undefined;
        this.fieldType = "string";
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.onSelectChange();
    }
    // --------------------------------------------------------------------------
    //
    //  Private Functions
    //
    //--------------------------------------------------------------------------
    findField(fieldName) {
        return this.layer.fieldsIndex.get(fieldName);
    }
    // --------------------------------------------------------------------------
    //
    //  Event Handlers
    //
    //--------------------------------------------------------------------------
    onSelectChange() {
        const { select } = this;
        const selectedOption = select === null || select === void 0 ? void 0 : select.selectedOption;
        this.field = selectedOption
            ? this.findField(selectedOption.value)
            : this.field || this.getFields()[0];
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { title } = this.layer;
        const fields = this.getFields();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, title, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { label: "select", ref: (e) => (this.select = e), onCalciteSelectChange: () => this.onSelectChange() }, fields.map((field) => this.renderField(field))))));
    }
    renderField(field) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { label: field.alias, value: field.name });
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    getFields() {
        const { layer, fieldType } = this;
        const { fields } = layer;
        return (fields === null || fields === void 0 ? void 0 : fields.length)
            ? fields.filter((field) => !fieldType || (field === null || field === void 0 ? void 0 : field.type) === fieldType)
            : [];
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const ArcgisLayerList = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.listChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
        this.layers = undefined;
        this.selection = new Map();
        this.filterEnabled = true;
        this.multiple = false;
        this.strings = undefined;
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list", { "filter-enabled": this.filterEnabled, "filter-placeholder": this.strings.filter, multiple: this.multiple, onClick: (e) => this.onListChange(e) }, this.renderLayers())));
    }
    renderLayers() {
        const { layers, selection } = this;
        return (layers || []).map((layer) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-pick-list-item", { label: layer.title, description: this.getLayerType(layer), selected: selection.has(layer.id), value: layer.id })));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    onListChange(e) {
        const { selection } = this;
        this.updateSelection(e);
        this.listChange.emit(Array.from(selection.values()));
    }
    updateSelection(e) {
        var _a, _b, _c, _d, _e;
        if (((_a = e.target) === null || _a === void 0 ? void 0 : _a.localName) === "calcite-pick-list-item" ||
            ((_c = (_b = e.target) === null || _b === void 0 ? void 0 : _b.parentElement) === null || _c === void 0 ? void 0 : _c.localName) === "calcite-pick-list-item") {
            const { selection } = this;
            const selectedLayerId = (_d = e.target.value) !== null && _d !== void 0 ? _d : (_e = e.target.parentElement) === null || _e === void 0 ? void 0 : _e.value;
            const isRemoved = selection.has(selectedLayerId);
            const selectedLayer = this.findLayer(selectedLayerId);
            if (!this.multiple) {
                selection.clear();
            }
            if (!isRemoved) {
                this.selection.set(selectedLayer.id, selectedLayer);
            }
            else {
                this.selection.delete(selectedLayer.id);
            }
        }
    }
    findLayer(layerId) {
        const { layers } = this;
        return layers === null || layers === void 0 ? void 0 : layers.find((layer) => layer.id === layerId);
    }
    getLayerType(layer) {
        const { layerTypes } = this.strings;
        const { geometryType = "unknown", sourceJSON } = layer;
        return geometryType !== "unknown"
            ? layerTypes[geometryType]
            : layerTypes[this.jsonTypeToLayerType(sourceJSON === null || sourceJSON === void 0 ? void 0 : sourceJSON.geometryType)];
    }
    jsonTypeToLayerType(type) {
        if (type === "esriGeometryPolygon") {
            return "polygon";
        }
        else if (type === "esriGeometryPoint") {
            return "point";
        }
        else if (type === "esriGeometryPolyline") {
            return "line";
        }
        else {
            return "unknown";
        }
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};

const arcgisFloorConfigurationLayerPickerCss = "calcite-label span{width:100%;display:flex;justify-content:space-between}calcite-label span calcite-action{margin-left:0.3em}.arcgis--rtl calcite-label span calcite-action{margin-left:auto;margin-right:0.3em}";

const ArcgisLayerPicker = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.listChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "listChange", 7);
        this.selectedLayer = undefined;
        this.view = undefined;
        this.iconEnd = "pencil";
        this.label = undefined;
        this.placement = "bottom-start";
        this.open = false;
        this.strings = undefined;
        this.requiredFields = undefined;
        this.geometryType = "polygon";
    }
    //--------------------------------------------------------------------------
    //
    //  Events
    //
    //--------------------------------------------------------------------------
    calcitePopoverCloseHandler() {
        this.open = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        if (this.panel) {
            return this.panel.setFocus();
        }
        else {
            return Promise.resolve();
        }
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { selectedLayer } = this;
        const buttonText = (selectedLayer === null || selectedLayer === void 0 ? void 0 : selectedLayer.title) || this.strings.none;
        const layers = this.getLayers();
        const disabled = this.open || !(layers === null || layers === void 0 ? void 0 : layers.length);
        const selection = new Map();
        if (selectedLayer) {
            selection.set(selectedLayer.id, selectedLayer);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.label, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "outline-fill", alignment: "icon-end-space-between", kind: "neutral", scale: "m", "icon-end": "pencil", width: "full", disabled: disabled, ref: (el) => (this.triggerButton = el), onClick: () => {
                this.open = !this.open;
                setTimeout(() => this.setFocus(), 25);
            } }, buttonText), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "x", scale: "s", text: this.strings.clear, disabled: !this.selectedLayer, onClick: () => {
                this.selectedLayer = null;
                this.listChange.emit();
            } }))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { label: this.label, pointerDisabled: true, referenceElement: this.triggerButton, open: this.open, placement: this.placement, ref: (el) => (this.popoverNode = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { heading: this.label, closed: false, "width-scale": "m", "height-scale": "m", ref: (el) => (this.panel = el) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-layer-list", { strings: this.strings, layers: layers, selection: selection, onListChange: (e) => (this.selectedLayer = e === null || e === void 0 ? void 0 : e.detail[0]) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { width: "full", slot: "footer", onClick: () => (this.open = false) }, this.strings.done)))));
    }
    // --------------------------------------------------------------------------
    //
    //  Private methods
    //
    // --------------------------------------------------------------------------
    getLayers() {
        const compatibleLayers = this.getCompatibleLayers();
        return (compatibleLayers === null || compatibleLayers === void 0 ? void 0 : compatibleLayers.length)
            ? compatibleLayers.filter((layer) => this.checkRequiredFields(layer))
            : [];
    }
    getCompatibleLayers() {
        const { geometryType } = this;
        const { map } = this.view;
        const { allLayers } = map;
        let compatibleLayers = [];
        allLayers.forEach((layer) => {
            const { type } = layer;
            if (type === "map-image") {
                const { allSublayers } = layer;
                compatibleLayers = compatibleLayers.concat(allSublayers.filter((subLayer) => subLayer.fieldsIndex).toArray());
            }
            else if ((type === "feature" && !geometryType) || (layer === null || layer === void 0 ? void 0 : layer.geometryType) === geometryType) {
                compatibleLayers.push(layer);
            }
        });
        return compatibleLayers;
    }
    checkRequiredFields(layer) {
        const { requiredFields } = this;
        const { fieldsIndex } = layer;
        return requiredFields && fieldsIndex
            ? requiredFields.every((fieldName) => fieldsIndex.get(fieldName))
            : true;
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisLayerPicker.style = arcgisFloorConfigurationLayerPickerCss;

const arcgisFloorConfigurationReplaceFieldCss = "section{padding:0.5rem 0.75rem;background-color:white}";

const ArcgisFloorReplaceField = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.view = undefined;
        this.layer = undefined;
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public
    //
    //--------------------------------------------------------------------------
    async commit() {
        return new Promise(async (resolve) => {
            const lists = Array.from(this.el.shadowRoot.querySelectorAll("arcgis-field-list"));
            lists.map((list) => setFloorInfo(list));
            resolve();
        });
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
    }
    renderPanel() {
        const layer = this.layer;
        const field = this.findField(layer.floorInfo.floorField);
        const fieldSelection = new Map();
        fieldSelection.set(field.name, field);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-field-list", { strings: this.strings, layer: layer, selection: fieldSelection })));
    }
    // --------------------------------------------------------------------------
    //
    //  Protected methods
    //
    // --------------------------------------------------------------------------
    findField(name) {
        const layer = this.layer;
        return layer.fieldsIndex.get(name);
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorReplaceField.style = arcgisFloorConfigurationReplaceFieldCss;

const arcgisFloorConfigurationSelectFieldsCss = "section{padding:0.5rem 0.75rem;background-color:white}";

const ArcgisFloorSelectFields = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.view = undefined;
        this.layers = undefined;
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async commit() {
        return new Promise(async (resolve) => {
            const selects = Array.from(this.el.shadowRoot.querySelectorAll("arcgis-floor-configuration-field-select"));
            selects.forEach((select) => setFloorInfo(select));
            resolve();
        });
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, this.renderPanel());
    }
    renderPanel() {
        const { layers } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("section", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("p", null, this.strings.selectMessage), layers.map((layer) => this.renderSelect(layer))));
    }
    renderSelect(layer) {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-floor-configuration-field-select", { strings: this.strings, layer: layer });
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisFloorSelectFields.style = arcgisFloorConfigurationSelectFieldsCss;



//# sourceMappingURL=arcgis-floor-configuration_11.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js":
/*!******************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS_UTILITY),
/* harmony export */   a: () => (/* binding */ formatDate),
/* harmony export */   b: () => (/* binding */ formatPlural),
/* harmony export */   f: () => (/* binding */ formatNumber),
/* harmony export */   g: () => (/* binding */ getElementDir),
/* harmony export */   l: () => (/* binding */ languageMap)
/* harmony export */ });
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */



const languageMap = new Map([
    ["ar", "ar"],
    ["bg", "bg"],
    ["bs", "bs"],
    ["ca", "ca"],
    ["cs", "cs"],
    ["da", "da"],
    ["de", "de"],
    ["el", "el"],
    ["en", "en"],
    ["es", "es"],
    ["et", "et"],
    ["fi", "fi"],
    ["fr", "fr"],
    ["he", "he"],
    ["hr", "hr"],
    ["hu", "hu"],
    ["id", "id"],
    ["it", "it"],
    ["ja", "ja"],
    ["ko", "ko"],
    ["lt", "lt"],
    ["lv", "lv"],
    ["nb", "nb"],
    ["nl", "nl"],
    ["pl", "pl"],
    ["pt-br", "pt-BR"],
    ["pt-pt", "pt-PT"],
    ["ro", "ro"],
    ["ru", "ru"],
    ["sk", "sk"],
    ["sl", "sl"],
    ["sr", "sr"],
    ["sv", "sv"],
    ["th", "th"],
    ["tr", "tr"],
    ["uk", "uk"],
    ["vi", "vi"],
    ["zh-cn", "zh-CN"],
    ["zh-hk", "zh-HK"],
    ["zh-tw", "zh-TW"]
]);
// rtl
function getElementDir(el) {
    return getElementProp(el, "dir", "ltr");
}
function getElementProp(el, prop, value) {
    const closestWithProp = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_1__.c)(el, `[${prop}]`);
    return closestWithProp ? closestWithProp.getAttribute(prop) : value;
}
// css
const CSS_UTILITY = {
    rtl: "arcgis--rtl"
};
async function formatNumber(number, options) {
    const { api, type, places } = options || {};
    if (api === 4) {
        const [intl] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["esri/intl"]);
        const numberFormatIntlOptions = intl.convertNumberFormatToIntlOptions({
            places,
            style: type,
            digitSeparator: true
        });
        return intl.formatNumber(number, Object.assign(Object.assign({}, numberFormatIntlOptions), { style: type }));
    }
    const [dojoNumber] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_0__.l)(["dojo/number"]);
    return dojoNumber.format(number, {
        type,
        places,
        pattern: options === null || options === void 0 ? void 0 : options.pattern
    });
}
const cache = {};
function formatDate(date) {
    const lang = document.documentElement.lang;
    const dayShortMonthYear = {
        year: "numeric",
        month: "short",
        day: "numeric"
    };
    if (!cache[lang]) {
        cache[lang] = new Intl.DateTimeFormat(document.documentElement.lang, dayShortMonthYear);
    }
    return cache[lang].format(date);
}
function formatPlural(lang, stringObj, number) {
    const singles = ["id", "ja", "ko", "th", "vi", "zh-cn", "zh-hk", "zh-tw"];
    const likeEnglish = [
        "en",
        "ca",
        "da",
        "de",
        "el",
        "es",
        "et",
        "fi",
        "hi",
        "hu",
        "it",
        "nb",
        "nl",
        "pt-pt",
        "sv",
        "tr"
    ];
    const locale = lang !== null && lang !== void 0 ? lang : "en";
    // if the number is one, or it is a "simple" language, return the 1 string
    if (number === 1 || singles.includes(locale)) {
        return stringObj.single.replace("${number}", "1");
    }
    // if the number is not 1 and the language uses the same pluralization strategy as english,
    // return the multiple string
    if (number !== 1 && likeEnglish.includes(locale)) {
        return stringObj.multiple.replace("${number}", `${number}`);
    }
    // if none of the above worked, return the "unknown" string
    return stringObj.unknown.replace("${number}", `${number}`);
}



//# sourceMappingURL=languageUtil-ef0e54b2.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js":
/*!************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js ***!
  \************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getComponentClosestLanguage),
/* harmony export */   g: () => (/* binding */ getLocaleComponentStrings)
/* harmony export */ });
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */




// https://medium.com/stencil-tricks/implementing-internationalisation-i18n-with-stencil-5e6559554117
function getComponentClosestLanguage(element) {
    var _a, _b, _c;
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        // "ru-RU" maps to "ru" use case
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang.slice(0, 2));
        }
        else {
            return "en";
        }
    }
}
function getComponentClosestLanguageIntl(element) {
    var _a, _b, _c;
    // it's OK if we don't have the 4 letter language file for it
    // 4 letter language code needed for formatting numbers
    const closestElement = (_a = (0,_dom_4d367677_js__WEBPACK_IMPORTED_MODULE_0__.c)(element, "[lang]")) !== null && _a !== void 0 ? _a : (_c = (_b = element.shadowRoot) === null || _b === void 0 ? void 0 : _b.ownerDocument) === null || _c === void 0 ? void 0 : _c.documentElement;
    // language set by the calling application or browser. defaults to english.
    const lang = ((closestElement === null || closestElement === void 0 ? void 0 : closestElement.lang) || (navigator === null || navigator === void 0 ? void 0 : navigator.language) || "en").toLowerCase();
    if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang)) {
        return _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.get(lang);
    }
    else {
        if (_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_1__.l.has(lang.slice(0, 2))) {
            // we support the 2 letter coded language
            // e.g. it-CH vs it
            return lang;
        }
        else {
            return "en";
        }
    }
}
function fetchLocaleStringsForComponent(componentName, locale) {
    return new Promise((resolve, reject) => {
        fetch((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_2__.a)(`../arcgis-app-assets/i18n/${componentName}.i18n.${locale}.json`)).then((result) => {
            if (result.ok)
                resolve(result.json());
            else
                reject();
        }, () => reject());
    });
}
const stringCache = {};
function fetchLocaleStringsFromCache(componentName, locale) {
    const id = `${componentName}${locale}`;
    if (!stringCache[id]) {
        stringCache[id] = fetchLocaleStringsForComponent(componentName, locale);
    }
    return stringCache[id];
}
/**
 * Get strings and language codes.
 * This method returns 2 language codes.
 * The first one returns a code that's also supported as a language file.
 * The second one returns a code where there is support for the first 2 letters of the code as part of a language file,
 * but will return the original 4 letter code from the page.
 * E.g. For "it-ch" it will return "it" as the first language code and "it-ch" as the second.
 * The second one is required for esri.intl.setLocale() to get the correct formatting.
 *
 * If a tagName is provided it will overwite the element's tagName
 *
 *  @return [ strings, first language code, second language code]
 */
async function getLocaleComponentStrings(element, tagName) {
    const componentName = tagName || element.tagName.toLowerCase();
    const componentLanguage = getComponentClosestLanguage(element);
    const componentLanguageIntl = getComponentClosestLanguageIntl(element);
    let strings;
    try {
        strings = await fetchLocaleStringsFromCache(componentName, componentLanguage);
    }
    catch (e) {
        console.warn(`no locale for ${componentName} (${componentLanguage}) loading default locale en.`);
        strings = await fetchLocaleStringsFromCache(componentName, "en");
    }
    return [strings, componentLanguage, componentLanguageIntl];
}



//# sourceMappingURL=locale-050b6db9.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLWFiYWQxYi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDdkM7QUFDVDtBQUNsQztBQUNTOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrSEFBa0g7QUFDbEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQjtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCLFlBQVksWUFBWTtBQUN4QjtBQUNBO0FBQ0EsZ0JBQWdCLGtCQUFrQjtBQUNsQztBQUNBLG9CQUFvQixlQUFlO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCLFlBQVksWUFBWTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFCQUFxQjtBQUNyQztBQUNBLG9CQUFvQixlQUFlO0FBQ25DO0FBQ0Esd0NB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QUFDQTtBQUNBO0FBQzJFO0FBQ2I7QUFDTjs7QUFFeEQ7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG1EQUFpQztBQUNsRTtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQixlQUFlLHdEQUFXO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0RBQVc7QUFDdkIsbUJBQW1CLHdEQUFXO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG1EQUFpQztBQUNsRTtBQUNBO0FBQ0EsUUFBUSx3REFBVztBQUNuQixlQUFlLHdEQUFXO0FBQzFCO0FBQ0E7QUFDQSxZQUFZLHdEQUFXO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHFEQUFZLDhCQUE4QixjQUFjLFFBQVEsT0FBTztBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGNBQWMsRUFBRSxPQUFPO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxlQUFlLEdBQUcsa0JBQWtCO0FBQzFFO0FBQ0E7QUFDQTtBQUNBOztBQUU0RTs7QUFFNUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbl8xMS5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vZXh0ZW5zaW9ucy93aWRnZXRzL2FyY2dpcy9hbmFseXNpcy9ub2RlX21vZHVsZXMvQGFyY2dpcy9hcHAtY29tcG9uZW50cy9kaXN0L2VzbS9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vbG9jYWxlLTA1MGI2ZGI5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBjIGFzIGNyZWF0ZUV2ZW50LCBoLCBIIGFzIEhvc3QsIGQgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzIH0gZnJvbSAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcblxuY29uc3QgQ1NTID0ge1xuICAgIGNvbnRhaW5lcjogXCJjb250YWluZXJcIixcbiAgICBzZWN0aW9uOiBcInNlY3Rpb25cIixcbiAgICB0aXRsZTogXCJ0aXRsZVwiLFxuICAgIG1pc3Npbmc6IFwibWlzc2luZ1wiXG59O1xuXG5jb25zdCBmbG9vckluZm9TY2hlbWEgPSB7XG4gICAgZmFjaWxpdHlMYXllcjoge1xuICAgICAgICBmYWNpbGl0eUlkRmllbGQ6IFwiRkFDSUxJVFlfSURcIixcbiAgICAgICAgc2l0ZUlkRmllbGQ6IFwiU0lURV9JRFwiLFxuICAgICAgICBuYW1lRmllbGQ6IFwiTkFNRVwiXG4gICAgfSxcbiAgICBsZXZlbExheWVyOiB7XG4gICAgICAgIGxldmVsSWRGaWVsZDogXCJMRVZFTF9JRFwiLFxuICAgICAgICBmYWNpbGl0eUlkRmllbGQ6IFwiRkFDSUxJVFlfSURcIixcbiAgICAgICAgbG9uZ05hbWVGaWVsZDogXCJOQU1FXCIsXG4gICAgICAgIHNob3J0TmFtZUZpZWxkOiBcIk5BTUVfU0hPUlRcIixcbiAgICAgICAgbGV2ZWxOdW1iZXJGaWVsZDogXCJMRVZFTF9OVU1CRVJcIixcbiAgICAgICAgdmVydGljYWxPcmRlckZpZWxkOiBcIlZFUlRJQ0FMX09SREVSXCJcbiAgICB9LFxuICAgIHNpdGVMYXllcjoge1xuICAgICAgICBzaXRlSWRGaWVsZDogXCJTSVRFX0lEXCIsXG4gICAgICAgIG5hbWVGaWVsZDogXCJOQU1FXCJcbiAgICB9XG59O1xubGV0IHRlbXBGbG9vckluZm87XG5jb25zdCBnZXRNYXBGbG9vckluZm8gPSAodmlldykgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBtYXAgPSB2aWV3ID09PSBudWxsIHx8IHZpZXcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZpZXcubWFwO1xuICAgIHRlbXBGbG9vckluZm8gPSB0ZW1wRmxvb3JJbmZvIHx8IChtYXAgPT09IG51bGwgfHwgbWFwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXAuZmxvb3JJbmZvKSB8fCBPYmplY3QuYXNzaWduKHt9LCBmbG9vckluZm9TY2hlbWEpO1xuICAgIC8vIFNpdGVMYXllciBpcyBvcHRpb25hbCwgYnV0IG1pZ2h0IGJlIHNwZWNpZmllZCB3aXRob3V0IGFcbiAgICAvLyBsYXllcklkIGlmIHNvIHdlIHNob3VsZCByZW1vdmUgaXQgc28gdGhlIHNjaGVtYSBjYW4gc3RpbGwgdmFsaWRhdGVcbiAgICB0ZW1wRmxvb3JJbmZvLnNpdGVMYXllciA9ICgoX2EgPSB0ZW1wRmxvb3JJbmZvID09PSBudWxsIHx8IHRlbXBGbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBGbG9vckluZm8uc2l0ZUxheWVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGF5ZXJJZCkgPyB0ZW1wRmxvb3JJbmZvLnNpdGVMYXllciA6IG51bGw7XG4gICAgcmV0dXJuIHRlbXBGbG9vckluZm87XG59O1xuY29uc3Qgc2V0TWFwRmxvb3JJbmZvID0gKHZpZXcpID0+IHtcbiAgICBjb25zdCBtYXAgPSB2aWV3ID09PSBudWxsIHx8IHZpZXcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZpZXcubWFwO1xuICAgIGNvbnN0IG1hcEZsb29ySW5mbyA9IGdldE1hcEZsb29ySW5mbyh2aWV3KTtcbiAgICBpZiAobWFwICYmIHZhbGlkYXRlRmxvb3JJbmZvKG1hcEZsb29ySW5mbykpIHtcbiAgICAgICAgbWFwLnNldChcImZsb29ySW5mb1wiLCBtYXBGbG9vckluZm8pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVtb3ZlTWFwRmxvb3JJbmZvKHZpZXcpO1xuICAgIH1cbn07XG5jb25zdCB1cGRhdGVNYXBGbG9vckluZm8gPSAoZmxvb3JJbmZvUHJvcHMsIHZpZXcpID0+IHtcbiAgICBjb25zdCBtYXBGbG9vckluZm8gPSBnZXRNYXBGbG9vckluZm8odmlldyk7XG4gICAgY29uc3QgeyBuYW1lIH0gPSBmbG9vckluZm9Qcm9wcztcbiAgICBjb25zdCBsYXllciA9IGZsb29ySW5mb1Byb3BzLmxheWVyO1xuICAgIGNvbnN0IGlzU3VibGF5ZXIgPSAhIShsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubGF5ZXIpO1xuICAgIGlmIChsYXllcikge1xuICAgICAgICBtYXBGbG9vckluZm9bbmFtZV0gPSBPYmplY3QuYXNzaWduKHt9LCBmbG9vckluZm9TY2hlbWFbbmFtZV0pO1xuICAgICAgICBtYXBGbG9vckluZm9bbmFtZV0ubGF5ZXJJZCA9IGlzU3VibGF5ZXIgPyBsYXllci5sYXllci5pZCA6IGxheWVyLmlkO1xuICAgICAgICBtYXBGbG9vckluZm9bbmFtZV0uc3VibGF5ZXJJZCA9IGlzU3VibGF5ZXIgPyBsYXllci5pZCA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1hcEZsb29ySW5mb1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgc2V0TWFwRmxvb3JJbmZvKHZpZXcpO1xufTtcbmNvbnN0IHJlbW92ZU1hcEZsb29ySW5mbyA9ICh2aWV3KSA9PiB7XG4gICAgY29uc3QgbWFwID0gdmlldyA9PT0gbnVsbCB8fCB2aWV3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2aWV3Lm1hcDtcbiAgICBpZiAobWFwKSB7XG4gICAgICAgIG1hcC5mbG9vckluZm8gPSBudWxsO1xuICAgIH1cbn07XG5jb25zdCB2YWxpZGF0ZUZsb29ySW5mbyA9IChtYXBGbG9vckluZm8pID0+IHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoKF9hID0gbWFwRmxvb3JJbmZvID09PSBudWxsIHx8IG1hcEZsb29ySW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwRmxvb3JJbmZvLmZhY2lsaXR5TGF5ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYXllcklkKSAmJlxuICAgICAgICAoKF9iID0gbWFwRmxvb3JJbmZvID09PSBudWxsIHx8IG1hcEZsb29ySW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwRmxvb3JJbmZvLmxldmVsTGF5ZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sYXllcklkKSAmJlxuICAgICAgICAoIShtYXBGbG9vckluZm8gPT09IG51bGwgfHwgbWFwRmxvb3JJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBGbG9vckluZm8uc2l0ZUxheWVyKSB8fCAobWFwRmxvb3JJbmZvID09PSBudWxsIHx8IG1hcEZsb29ySW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWFwRmxvb3JJbmZvLnNpdGVMYXllci5sYXllcklkKSlcbiAgICAgICAgPyB0cnVlXG4gICAgICAgIDogZmFsc2U7XG59O1xuY29uc3QgZ2V0UmVxdWlyZWRGaWVsZHMgPSAobmFtZSkgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IGZsb29ySW5mb1NjaGVtYVtuYW1lXTtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhzY2hlbWEpO1xufTtcbmNvbnN0IGdldE5vbkZsb29yTGF5ZXJzID0gKHZpZXcpID0+IHtcbiAgICBjb25zdCB7IG1hcCB9ID0gdmlldztcbiAgICBjb25zdCB7IGFsbExheWVycyB9ID0gbWFwO1xuICAgIGxldCBub25GbG9vckxheWVycyA9IFtdO1xuICAgIGFsbExheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICBjb25zdCB7IHR5cGUsIGZsb29ySW5mbyB9ID0gbGF5ZXI7XG4gICAgICAgIGlmICh0eXBlID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB7IGFsbFN1YmxheWVycyB9ID0gbGF5ZXI7XG4gICAgICAgICAgICBub25GbG9vckxheWVycyA9IG5vbkZsb29yTGF5ZXJzLmNvbmNhdChhbGxTdWJsYXllcnMuZmlsdGVyKChzdWJMYXllcikgPT4gc3ViTGF5ZXIuZmllbGRzSW5kZXggJiYgIShzdWJMYXllciA9PT0gbnVsbCB8fCBzdWJMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3ViTGF5ZXIuZmxvb3JJbmZvKSkudG9BcnJheSgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghZmxvb3JJbmZvICYmIHR5cGUgPT09IFwiZmVhdHVyZVwiKSB7XG4gICAgICAgICAgICBub25GbG9vckxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBub25GbG9vckxheWVycztcbn07XG5jb25zdCBnZXRDb21wYXRpYmxlTGF5ZXJzID0gYXN5bmMgKHZpZXcpID0+IHtcbiAgICBjb25zdCB7IG1hcCB9ID0gdmlldztcbiAgICBjb25zdCB7IGFsbExheWVycyB9ID0gbWFwO1xuICAgIGNvbnN0IHByb21pc2VzID0gYWxsTGF5ZXJzXG4gICAgICAgIC5tYXAoYXN5bmMgKGxheWVyKSA9PiBhd2FpdCBsb2FkQWxsKGxheWVyKSlcbiAgICAgICAgLmZpbHRlcigobGF5ZXIpID0+IChsYXllciA9PT0gbnVsbCB8fCBsYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXIubG9hZFN0YXR1cykgIT09IFwiZmFpbGVkXCIpO1xuICAgIC8vIE1ha2Ugc3VyZSBhbGwgbGF5ZXJzIGFuZCBzdWJsYXllcnMgYXJlIGxvYWRlZFxuICAgIC8vIGJlZm9yZSBjaGVja2luZyB0aGVtIGZvciBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgdmFsaWRMYXllcnMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgbGV0IGNvbXBhdGlibGVMYXllcnMgPSBbXTtcbiAgICB2YWxpZExheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICBjb25zdCB7IHR5cGUsIGdlb21ldHJ5VHlwZSB9ID0gbGF5ZXI7XG4gICAgICAgIGlmICh0eXBlID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB7IGFsbFN1YmxheWVycyB9ID0gbGF5ZXI7XG4gICAgICAgICAgICBjb21wYXRpYmxlTGF5ZXJzID0gY29tcGF0aWJsZUxheWVycy5jb25jYXQoYWxsU3VibGF5ZXJzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoc3ViTGF5ZXIpID0+IHsgdmFyIF9hOyByZXR1cm4gc3ViTGF5ZXIuZmllbGRzSW5kZXggJiYgKChfYSA9IHN1YkxheWVyLnNvdXJjZUpTT04pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZW9tZXRyeVR5cGUpID09PSBcImVzcmlHZW9tZXRyeVBvbHlnb25cIjsgfSlcbiAgICAgICAgICAgICAgICAudG9BcnJheSgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlID09PSBcImZlYXR1cmVcIiAmJiBnZW9tZXRyeVR5cGUgPT09IFwicG9seWdvblwiKSB7XG4gICAgICAgICAgICBjb21wYXRpYmxlTGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbXBhdGlibGVMYXllcnM7XG59O1xuY29uc3QgbG9hZEFsbCA9IChsYXllcikgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGxheWVyLmxvYWRBbGwgPyBsYXllci5sb2FkQWxsKCkgOiBsYXllci5sb2FkKCk7XG4gICAgfVxuICAgIGNhdGNoIChfYSkgeyB9XG4gICAgcmV0dXJuIGxheWVyO1xufTtcbmNvbnN0IGdldEZsb29yTGF5ZXIgPSAobmFtZSwgdmlldykgPT4ge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgbWFwID0gdmlldy5tYXA7XG4gICAgY29uc3QgbGF5ZXJzID0gbWFwLmFsbExheWVycztcbiAgICBjb25zdCBmbG9vckluZm8gPSBnZXRNYXBGbG9vckluZm8odmlldyk7XG4gICAgY29uc3QgbGF5ZXJJZCA9IChfYSA9IGZsb29ySW5mbyA9PT0gbnVsbCB8fCBmbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZsb29ySW5mb1tuYW1lXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxheWVySWQ7XG4gICAgY29uc3Qgc3VibGF5ZXJJZCA9IChfYiA9IGZsb29ySW5mbyA9PT0gbnVsbCB8fCBmbG9vckluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZsb29ySW5mb1tuYW1lXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN1YmxheWVySWQ7XG4gICAgbGV0IGZsb29yTGF5ZXIgPSBsYXllcklkID8gbGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmZpbmQoKGxheWVyKSA9PiBsYXllci5pZCA9PT0gbGF5ZXJJZCkgOiBudWxsO1xuICAgIGlmICgoZmxvb3JMYXllciA9PT0gbnVsbCB8fCBmbG9vckxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmbG9vckxheWVyLnR5cGUpID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgIGZsb29yTGF5ZXIgPSBmbG9vckxheWVyLmFsbFN1YmxheWVycy5maW5kKChzdWJsYXllcikgPT4gc3VibGF5ZXIuaWQgPT09IHN1YmxheWVySWQpO1xuICAgIH1cbiAgICByZXR1cm4gZmxvb3JMYXllcjtcbn07XG5jb25zdCBzZXRGbG9vckluZm8gPSAoZWxlbWVudCkgPT4ge1xuICAgIGxldCB7IGxheWVyLCBmaWVsZCB9ID0gZWxlbWVudDtcbiAgICBpZiAoKGVsZW1lbnQgPT09IG51bGwgfHwgZWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWxlbWVudC5sb2NhbE5hbWUpID09PSBcImFyY2dpcy1maWVsZC1saXN0XCIpIHtcbiAgICAgICAgZmllbGQgPSBlbGVtZW50LnNlbGVjdGlvbi52YWx1ZXMoKS5uZXh0KCkudmFsdWU7XG4gICAgfVxuICAgIGNvbnN0IGZsb29ySW5mbyA9IGxheWVyLmZsb29ySW5mbyB8fCB7fTtcbiAgICBmbG9vckluZm8uZmxvb3JGaWVsZCA9IGZpZWxkLm5hbWU7XG4gICAgbGF5ZXIuc2V0KFwiZmxvb3JJbmZvXCIsIGZsb29ySW5mbyk7XG59O1xuXG5jb25zdCBBcmNnaXNGbG9vckNvbmZpZ3VyYXRpb24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmZsb29ySW5mb0NoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZmxvb3JJbmZvQ2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3BlbiA9IHRydWU7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBjb25zdCBbc3RyaW5nc10gPSBhd2FpdCBnZXRMb2NhbGVDb21wb25lbnRTdHJpbmdzKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBzdHJpbmdzO1xuICAgICAgICBjb25zdCB7IHZpZXcgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgc3RyaW5nc1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZCB8fCAoYXdhaXQgdGhpcy5nZXREaXNhYmxlZCgpKTtcbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgY29uc3QgW2ludGxdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9pbnRsXCJdKTtcbiAgICAgICAgdGhpcy5pbnRsID0gaW50bDtcbiAgICAgICAgdGhpcy5pbnRsLnNldExvY2FsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZyk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBFdmVudCBMaXN0ZW5lcnNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhZGRNYXBGbG9vckluZm8oKSB7XG4gICAgICAgIHNldE1hcEZsb29ySW5mbyh0aGlzLnZpZXcpO1xuICAgICAgICB0aGlzLmZsb29ySW5mb0NoYW5nZS5lbWl0KCk7XG4gICAgfVxuICAgIHJlbW92ZUZsb29ySW5mbygpIHtcbiAgICAgICAgcmVtb3ZlTWFwRmxvb3JJbmZvKHRoaXMudmlldyk7XG4gICAgICAgIHRoaXMuZmxvb3JJbmZvQ2hhbmdlLmVtaXQoKTtcbiAgICB9XG4gICAgdXBkYXRlRmxvb3JJbmZvKHByb3BzKSB7XG4gICAgICAgIHVwZGF0ZU1hcEZsb29ySW5mbyhwcm9wcywgdGhpcy52aWV3KTtcbiAgICAgICAgdGhpcy5mbG9vckluZm9DaGFuZ2UuZW1pdCgpO1xuICAgIH1cbiAgICBkaXNhYmxlQ29udGFpbmVyKGUpIHtcbiAgICAgICAgY29uc3QgeyBkZXRhaWwgfSA9IGU7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuaG9zdEVsZW1lbnQuY2xvc2VzdChcImNhbGNpdGUtZmxvdy1pdGVtXCIpO1xuICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250YWluZXIuZGlzYWJsZWQgPSBkZXRhaWw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY2xvc2VBbGxMYXllclBpY2tlcnMoKSB7XG4gICAgICAgIGNvbnN0IHBpY2tlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tbGF5ZXItcGlja2VyXCIpO1xuICAgICAgICBwaWNrZXJzLmZvckVhY2goKHBpY2tlcikgPT4gKHBpY2tlci5vcGVuID0gZmFsc2UpKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0RGlzYWJsZWQoKSB7XG4gICAgICAgIGNvbnN0IG1hcFZpZXcgPSB0aGlzLnZpZXc7XG4gICAgICAgIGNvbnN0IGNvbXBhdGlibGVMYXllcnMgPSBhd2FpdCBnZXRDb21wYXRpYmxlTGF5ZXJzKG1hcFZpZXcpO1xuICAgICAgICBjb25zdCBzZWN0aW9ucyA9IFtcImZhY2lsaXR5TGF5ZXJcIiwgXCJsZXZlbExheWVyXCJdO1xuICAgICAgICAvLyBGb3IgZWFjaCBmbG9vckluZm9TZWN0aW9uIHdlIG5lZWQgdG8gY2hlY2sgdGhhdCBlYWNoIHBvbHlnb24gbGF5ZXIgaW4gdGhlIG1hcFxuICAgICAgICAvLyBoYXMgdGhlIHJlcXVpcmVkIGZpZWxkcyBpbiBvcmRlciB0byBlbmFibGUgdGhpcyBjb21wb25lbnRcbiAgICAgICAgY29uc3Qgc3VwcG9ydGVkU2VjdGlvbnMgPSBzZWN0aW9ucy5maWx0ZXIoKHNlY3Rpb25OYW1lKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKF9hID0gY29tcGF0aWJsZUxheWVycy5maWx0ZXIoKGxheWVyKSA9PiB0aGlzLmhhc1JlcXVpcmVkRmllbGRzKGxheWVyLCBnZXRSZXF1aXJlZEZpZWxkcyhzZWN0aW9uTmFtZSkpKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAhKHN1cHBvcnRlZFNlY3Rpb25zID09PSBudWxsIHx8IHN1cHBvcnRlZFNlY3Rpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdXBwb3J0ZWRTZWN0aW9ucy5sZW5ndGgpO1xuICAgIH1cbiAgICBoYXNSZXF1aXJlZEZpZWxkcyhsYXllciwgcmVxdWlyZWRGaWVsZHMpIHtcbiAgICAgICAgaWYgKGxheWVyKSB7XG4gICAgICAgICAgICBjb25zdCB7IGZpZWxkc0luZGV4IH0gPSBsYXllcjtcbiAgICAgICAgICAgIHJldHVybiAoKGZpZWxkc0luZGV4ICYmIHJlcXVpcmVkRmllbGRzLmV2ZXJ5KChmaWVsZE5hbWUpID0+ICEhZmllbGRzSW5kZXguZ2V0KGZpZWxkTmFtZSkpKSB8fCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzLCBvcGVuLCBkaXNhYmxlZCB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWJsb2NrXCIsIHsgY2xhc3M6IENTUy5jb250YWluZXIsIGhlYWRpbmc6IHN0cmluZ3MuaGVhZGluZywgY29sbGFwc2libGU6IHRydWUsIGRpc2FibGVkOiBkaXNhYmxlZCwgb3Blbjogb3BlbiAmJiAhZGlzYWJsZWQgfSwgdGhpcy5yZW5kZXJGbG9vckNvbmZpZ3VyYXRpb24oKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmxvb3JDb25maWd1cmF0aW9uKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MsIHZpZXcgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IG1hcCA9IHZpZXcubWFwO1xuICAgICAgICBjb25zdCBvcGVuID0gKG1hcCA9PT0gbnVsbCB8fCBtYXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hcC5mbG9vckluZm8pID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmVuYWJsZSwgb3Blbjogb3BlbiwgXCJ0b2dnbGUtZGlzcGxheVwiOiBcInN3aXRjaFwiLCBvbkNhbGNpdGVCbG9ja1NlY3Rpb25Ub2dnbGU6IChlKSA9PiBlLmN1cnJlbnRUYXJnZXQub3BlbiA/IHRoaXMuYWRkTWFwRmxvb3JJbmZvKCkgOiB0aGlzLnJlbW92ZUZsb29ySW5mbygpIH0sIGgoXCJwXCIsIG51bGwsIHN0cmluZ3Muc3VtbWFyeSksIHRoaXMucmVuZGVyTGF5ZXJQaWNrZXIoXCJzaXRlTGF5ZXJcIiksIHRoaXMucmVuZGVyTGF5ZXJQaWNrZXIoXCJmYWNpbGl0eUxheWVyXCIpLCB0aGlzLnJlbmRlckxheWVyUGlja2VyKFwibGV2ZWxMYXllclwiKSwgdGhpcy5yZW5kZXJBZGRpdGlvbmFsTGF5ZXJzKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyTGF5ZXJQaWNrZXIobmFtZSkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MsIHZpZXcgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGZsb29yTGF5ZXIgPSBnZXRGbG9vckxheWVyKG5hbWUsIHZpZXcpO1xuICAgICAgICBjb25zdCByZXF1aXJlZEZpZWxkcyA9IGdldFJlcXVpcmVkRmllbGRzKG5hbWUpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1sYXllci1waWNrZXJcIiwgeyB2aWV3OiB0aGlzLnZpZXcsIGxhYmVsOiBzdHJpbmdzW25hbWVdLCBzdHJpbmdzOiBzdHJpbmdzLCBzZWxlY3RlZExheWVyOiBmbG9vckxheWVyLCByZXF1aXJlZEZpZWxkczogcmVxdWlyZWRGaWVsZHMsIG9uTGlzdENoYW5nZTogKGUpID0+IHRoaXMudXBkYXRlRmxvb3JJbmZvKHsgbGF5ZXI6IChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuZGV0YWlsKSA/IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5kZXRhaWxbMF0gOiBudWxsLCBuYW1lOiBuYW1lIH0pIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyQWRkaXRpb25hbExheWVycygpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJsb2NrLXNlY3Rpb25cIiwgeyB0ZXh0OiBzdHJpbmdzLmFkZGl0aW9uYWxMYXllcnMsIG9wZW46IHRydWUgfSwgaChcImFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uLWFkZGl0aW9uYWwtbGF5ZXJzXCIsIHsgdmlldzogdGhpcy52aWV3LCBzdHJpbmdzOiB0aGlzLnN0cmluZ3MsIG9uRGlzYWJsZTogKGUpID0+IHRoaXMuZGlzYWJsZUNvbnRhaW5lcihlKSB9KSkpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNGbG9vckFkZExheWVycyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGlzdENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50c1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHNlbGVjdGlvbkNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5saXN0Q2hhbmdlLmVtaXQodGhpcy5zZWxlY3Rpb24pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gaChIb3N0LCBudWxsLCB0aGlzLnJlbmRlclBhbmVsKCkpO1xuICAgIH1cbiAgICByZW5kZXJQYW5lbCgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwic2VjdGlvblwiLCBudWxsLCBoKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tbGF5ZXItbGlzdFwiLCB7IGxheWVyczogZ2V0Tm9uRmxvb3JMYXllcnModGhpcy52aWV3KSwgXCJmaWx0ZXItZW5hYmxlZFwiOiB0cnVlLCBtdWx0aXBsZTogdHJ1ZSwgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBvbkxpc3RDaGFuZ2U6IChlKSA9PiAodGhpcy5zZWxlY3Rpb24gPSBlLmRldGFpbCkgfSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwic2VsZWN0aW9uXCI6IFtcInNlbGVjdGlvbkNoYW5nZVwiXVxuICAgIH07IH1cbn07XG5cbmNvbnN0IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZExheWVyc0Zsb3dDc3MgPSBcIi5jb250ZW50e3dpZHRoOjIwdnc7bWF4LXdpZHRoOjQyMHB4O21pbi13aWR0aDoyNDBweDttYXgtaGVpZ2h0OjQwdmh9XCI7XG5cbmNvbnN0IEFyY2dpc0Zsb29yQWRkTGF5ZXJzRmxvdyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuZG9uZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZG9uZVwiLCA3KTtcbiAgICAgICAgdGhpcy5kaXNtaXNzID0gY3JlYXRlRXZlbnQodGhpcywgXCJkaXNtaXNzXCIsIDcpO1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllcnMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRMYXllcnMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubW9kZSA9IFwiY3JlYXRlXCI7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiBoKEhvc3QsIG51bGwsIHRoaXMucmVuZGVyRmxvdygpKTtcbiAgICB9XG4gICAgcmVuZGVyRmxvdygpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJjYWxjaXRlLWZsb3dcIiwgeyByZWY6IChlbCkgPT4gdGhpcy5jcmVhdGVQYW5lbHMoZWwpIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50IEhhbmRsZXJzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgb25DcmVhdGUoZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmRvbmUuZW1pdCgpO1xuICAgIH1cbiAgICBvbkVkaXQoZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmRvbmUuZW1pdCgpO1xuICAgIH1cbiAgICBvbkRpc21pc3MoZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmRpc21pc3MuZW1pdCgpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByb3RlY3RlZCBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNyZWF0ZVBhbmVscyhlbCkge1xuICAgICAgICBjb25zdCB7IG1vZGUgfSA9IHRoaXM7XG4gICAgICAgIGlmIChtb2RlID09PSBcImNyZWF0ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVBZGRMYXllcnNQYW5lbChlbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gXCJlZGl0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVJlcGxhY2VGaWVsZHNQYW5lbChlbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlQWRkTGF5ZXJzUGFuZWwoZmxvdykge1xuICAgICAgICBjb25zdCBhZGRMYXllcnNQYW5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1hZGQtbGF5ZXJzXCIpO1xuICAgICAgICBhZGRMYXllcnNQYW5lbC5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICBhZGRMYXllcnNQYW5lbC52aWV3ID0gdGhpcy52aWV3O1xuICAgICAgICBhZGRMYXllcnNQYW5lbC5jbGFzc0xpc3QuYWRkKFwiY29udGVudFwiKTtcbiAgICAgICAgYWRkTGF5ZXJzUGFuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImxpc3RDaGFuZ2VcIiwgKGUpID0+IHsgdmFyIF9hOyByZXR1cm4gKG5leHRCdXR0b24uZGlzYWJsZWQgPSAhKChfYSA9IGUuZGV0YWlsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSk7IH0pO1xuICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuY3JlYXRlUGFuZWwoe1xuICAgICAgICAgICAgaGVhZGluZzogdGhpcy5zdHJpbmdzLmFkZExheWVyc1xuICAgICAgICB9KTtcbiAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQoYWRkTGF5ZXJzUGFuZWwpO1xuICAgICAgICBjb25zdCBkaXNtaXNzQnV0dG9uID0gdGhpcy5jcmVhdGVCdXR0b24oe1xuICAgICAgICAgICAgbGFiZWw6IHRoaXMuc3RyaW5ncy5jYW5jZWwsXG4gICAgICAgICAgICBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLFxuICAgICAgICAgICAgZXZlbnRMaXN0ZW5lcjogdGhpcy5vbkRpc21pc3MuYmluZCh0aGlzKVxuICAgICAgICB9KTtcbiAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQoZGlzbWlzc0J1dHRvbik7XG4gICAgICAgIGNvbnN0IG5leHRCdXR0b24gPSB0aGlzLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAgICAgICBsYWJlbDogdGhpcy5zdHJpbmdzLm5leHQsXG4gICAgICAgICAgICBhcHBlYXJhbmNlOiBcInNvbGlkXCIsXG4gICAgICAgICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIGV2ZW50TGlzdGVuZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvL2NvbnN0IHNlbGVjdGVkTGF5ZXJzID0gKHRoaXMuc2VsZWN0ZWRMYXllcnMgPSBhZGRMYXllcnNQYW5lbC5zZWxlY3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU2VsZWN0Rmxvb3JGaWVsZHNQYW5lbChhZGRMYXllcnNQYW5lbC5zZWxlY3Rpb24sIGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQobmV4dEJ1dHRvbik7XG4gICAgICAgIGZsb3cuYXBwZW5kQ2hpbGQocGFuZWwpO1xuICAgIH1cbiAgICBjcmVhdGVTZWxlY3RGbG9vckZpZWxkc1BhbmVsKGxheWVycywgZmxvdykge1xuICAgICAgICBjb25zdCBzZWxlY3RGbG9vckZpZWxkc1BhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uLXNlbGVjdC1maWVsZHNcIik7XG4gICAgICAgIHNlbGVjdEZsb29yRmllbGRzUGFuZWwuY2xhc3NMaXN0LmFkZChcImNvbnRlbnRcIik7XG4gICAgICAgIHNlbGVjdEZsb29yRmllbGRzUGFuZWwuc3RyaW5ncyA9IHRoaXMuc3RyaW5ncztcbiAgICAgICAgc2VsZWN0Rmxvb3JGaWVsZHNQYW5lbC5sYXllcnMgPSBsYXllcnM7XG4gICAgICAgIHNlbGVjdEZsb29yRmllbGRzUGFuZWwudmlldyA9IHRoaXMudmlldztcbiAgICAgICAgY29uc3QgcGFuZWwgPSB0aGlzLmNyZWF0ZVBhbmVsKHtcbiAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5zZWxlY3RGbG9vckZpZWxkXG4gICAgICAgIH0pO1xuICAgICAgICBwYW5lbC5hcHBlbmRDaGlsZChzZWxlY3RGbG9vckZpZWxkc1BhbmVsKTtcbiAgICAgICAgY29uc3QgY2FuY2VsQnV0dG9uID0gdGhpcy5jcmVhdGVCdXR0b24oe1xuICAgICAgICAgICAgbGFiZWw6IHRoaXMuc3RyaW5ncy5jYW5jZWwsXG4gICAgICAgICAgICBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLFxuICAgICAgICAgICAgZXZlbnRMaXN0ZW5lcjogdGhpcy5vbkRpc21pc3MuYmluZCh0aGlzKVxuICAgICAgICB9KTtcbiAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQoY2FuY2VsQnV0dG9uKTtcbiAgICAgICAgY29uc3QgZG9uZUJ1dHRvbiA9IHRoaXMuY3JlYXRlQnV0dG9uKHtcbiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MuYWRkLFxuICAgICAgICAgICAgYXBwZWFyYW5jZTogXCJzb2xpZFwiLFxuICAgICAgICAgICAgZXZlbnRMaXN0ZW5lcjogYXN5bmMgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxlY3RGbG9vckZpZWxkc1BhbmVsLmNvbW1pdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMub25DcmVhdGUoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBwYW5lbC5hcHBlbmRDaGlsZChkb25lQnV0dG9uKTtcbiAgICAgICAgZmxvdy5hcHBlbmRDaGlsZChwYW5lbCk7XG4gICAgfVxuICAgIGNyZWF0ZVJlcGxhY2VGaWVsZHNQYW5lbChmbG93KSB7XG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5sYXllcnNbMF07XG4gICAgICAgIGNvbnN0IHJlcGxhY2VGbG9vckZpZWxkc1BhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uLXJlcGxhY2UtZmllbGRcIik7XG4gICAgICAgIHJlcGxhY2VGbG9vckZpZWxkc1BhbmVsLmNsYXNzTGlzdC5hZGQoXCJjb250ZW50XCIpO1xuICAgICAgICByZXBsYWNlRmxvb3JGaWVsZHNQYW5lbC5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICByZXBsYWNlRmxvb3JGaWVsZHNQYW5lbC52aWV3ID0gdGhpcy52aWV3O1xuICAgICAgICByZXBsYWNlRmxvb3JGaWVsZHNQYW5lbC5sYXllciA9IGxheWVyO1xuICAgICAgICBjb25zdCBwYW5lbCA9IHRoaXMuY3JlYXRlUGFuZWwoe1xuICAgICAgICAgICAgaGVhZGluZzogbGF5ZXIudGl0bGUsXG4gICAgICAgICAgICBzdW1tYXJ5OiB0aGlzLnN0cmluZ3MucmVwbGFjZUZsb29yRmllbGRcbiAgICAgICAgfSk7XG4gICAgICAgIHBhbmVsLmFwcGVuZENoaWxkKHJlcGxhY2VGbG9vckZpZWxkc1BhbmVsKTtcbiAgICAgICAgY29uc3QgcmVwbGFjZUJ1dHRvbiA9IHRoaXMuY3JlYXRlQnV0dG9uKHtcbiAgICAgICAgICAgIGxhYmVsOiB0aGlzLnN0cmluZ3MucmVwbGFjZSxcbiAgICAgICAgICAgIHdpZHRoOiBcImZ1bGxcIixcbiAgICAgICAgICAgIGV2ZW50TGlzdGVuZXI6IGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcmVwbGFjZUZsb29yRmllbGRzUGFuZWwuY29tbWl0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVkaXQoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBwYW5lbC5hcHBlbmRDaGlsZChyZXBsYWNlQnV0dG9uKTtcbiAgICAgICAgZmxvdy5hcHBlbmRDaGlsZChwYW5lbCk7XG4gICAgfVxuICAgIGNyZWF0ZVBhbmVsKHBhbmVsUHJvcHMpIHtcbiAgICAgICAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1mbG93LWl0ZW1cIik7XG4gICAgICAgIHBhbmVsLmhlYWRpbmcgPSBwYW5lbFByb3BzLmhlYWRpbmc7XG4gICAgICAgIHBhbmVsLmRlc2NyaXB0aW9uID0gcGFuZWxQcm9wcy5zdW1tYXJ5O1xuICAgICAgICBwYW5lbC5jbG9zYWJsZSA9IHRydWU7XG4gICAgICAgIHBhbmVsLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgICBwYW5lbC5hZGRFdmVudExpc3RlbmVyKFwiY2FsY2l0ZVBhbmVsQ2xvc2VcIiwgdGhpcy5vbkRpc21pc3MuYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiBwYW5lbDtcbiAgICB9XG4gICAgY3JlYXRlQnV0dG9uKGJ1dHRvblByb3BzKSB7XG4gICAgICAgIGNvbnN0IHsgYXBwZWFyYW5jZSA9IFwic29saWRcIiwgbGFiZWwsIGV2ZW50TGlzdGVuZXIsIHdpZHRoID0gXCJoYWxmXCIsIGRpc2FibGVkID0gZmFsc2UgfSA9IGJ1dHRvblByb3BzO1xuICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FsY2l0ZS1idXR0b25cIik7XG4gICAgICAgIGJ1dHRvbi5zbG90ID0gXCJmb290ZXJcIjtcbiAgICAgICAgYnV0dG9uLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlO1xuICAgICAgICBidXR0b24uZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgICAgICAgYnV0dG9uLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsYWJlbCk7XG4gICAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZCh0ZXh0KTtcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudExpc3RlbmVyKTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0Zsb29yQWRkTGF5ZXJzRmxvdy5zdHlsZSA9IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZExheWVyc0Zsb3dDc3M7XG5cbmNvbnN0IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZGl0aW9uYWxMYXllcnNDc3MgPSBcIjpob3N0e2hlaWdodDoxMDAlfWNhbGNpdGUtbm90aWNle21hcmdpbi1ib3R0b206MWVtfVwiO1xuXG5jb25zdCBBcmNnaXNGbG9vckFkZGl0aW9uYWxMYXllcnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmRpc21pc3MgPSBjcmVhdGVFdmVudCh0aGlzLCBcImRpc21pc3NcIiwgNyk7XG4gICAgICAgIHRoaXMuZGlzYWJsZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiZGlzYWJsZVwiLCA3KTtcbiAgICAgICAgdGhpcy5mbG9vckluZm9DaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImZsb29ySW5mb0NoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGxhY2VtZW50ID0gXCJib3R0b20tc3RhcnRcIjtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgcG9wb3Zlck5vZGUgfSA9IHRoaXM7XG4gICAgICAgIGlmIChwb3BvdmVyTm9kZSkge1xuICAgICAgICAgICAgcG9wb3Zlck5vZGUub3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgKF9hID0gcG9wb3Zlck5vZGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbW92ZUNoaWxkKHBvcG92ZXJOb2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gdGhpcy5sYXllclBhbmVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgb3BlbigpIHtcbiAgICAgICAgLy8gVG8gYXZvaWQgZmxpY2tlciB3aGVuIHRoZSBwb3BvdmVyIGFsaWducyB0byB0aGVcbiAgICAgICAgLy8gcmVmZXJlbmNlRWxlbWVudCB3ZSBhZGQgYSBzbWFsbCBkZWxheSBiZWZvcmUgb3BlbmluZ1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICh0aGlzLnBvcG92ZXJOb2RlLm9wZW4gPSB0cnVlKSwgMjUpO1xuICAgIH1cbiAgICBjbG9zZShjaGFuZ2VzKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcihmYWxzZSk7XG4gICAgICAgIGNvbnN0IHsgcG9wb3Zlck5vZGUgfSA9IHRoaXM7XG4gICAgICAgIHBvcG92ZXJOb2RlLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgcG9wb3Zlck5vZGUucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICB0aGlzLnJlUmVuZGVyID0gIXRoaXMucmVSZW5kZXI7XG4gICAgICAgIGlmIChjaGFuZ2VzKSB7XG4gICAgICAgICAgICB0aGlzLmZsb29ySW5mb0NoYW5nZS5lbWl0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50IExpc3RlbmVyc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNyZWF0ZSgpIHtcbiAgICAgICAgY29uc3QgcG9wb3Zlck5vZGUgPSB0aGlzLmNyZWF0ZVBvcG92ZXIoKTtcbiAgICAgICAgY29uc3QgY3JlYXRlRmxvdyA9IHRoaXMuY3JlYXRlQWRkTGF5ZXJzRmxvdyhcImNyZWF0ZVwiKTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRmxvdyk7XG4gICAgICAgIHRoaXMub3BlbigpO1xuICAgIH1cbiAgICBlZGl0KGUpIHtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLmdldFNlbGVjdGVkTGF5ZXIoZSk7XG4gICAgICAgIGNvbnN0IHBvcG92ZXJOb2RlID0gdGhpcy5jcmVhdGVQb3BvdmVyKCk7XG4gICAgICAgIGNvbnN0IGVkaXRGbG93ID0gdGhpcy5jcmVhdGVBZGRMYXllcnNGbG93KFwiZWRpdFwiKTtcbiAgICAgICAgZWRpdEZsb3cubGF5ZXJzID0gW2xheWVyXTtcbiAgICAgICAgcG9wb3Zlck5vZGUuYXBwZW5kQ2hpbGQoZWRpdEZsb3cpO1xuICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICB9XG4gICAgcmVtb3ZlTGF5ZXIobGF5ZXIpIHtcbiAgICAgICAgbGF5ZXIuZmxvb3JJbmZvID0gbnVsbDtcbiAgICAgICAgdGhpcy5yZVJlbmRlciA9ICF0aGlzLnJlUmVuZGVyO1xuICAgICAgICB0aGlzLmZsb29ySW5mb0NoYW5nZS5lbWl0KCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCB0aGlzLnJlbmRlck5vdGljZSgpLCB0aGlzLnJlbmRlclBhbmVsKCkpKTtcbiAgICB9XG4gICAgcmVuZGVyTm90aWNlKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGxheWVycyA9IHRoaXMuZ2V0TGF5ZXJzKCk7XG4gICAgICAgIHJldHVybiAobGF5ZXJzID09PSBudWxsIHx8IGxheWVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbGF5ZXJzLmxlbmd0aCkgPyBudWxsIDogKGgoXCJjYWxjaXRlLW5vdGljZVwiLCB7IHNjYWxlOiBcInNcIiwgd2lkdGg6IFwiYXV0b1wiLCBvcGVuOiB0cnVlIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCBzdHJpbmdzLmFkZGl0aW9uYWxMYXllcnNUaXApKSk7XG4gICAgfVxuICAgIHJlbmRlclBhbmVsKCkge1xuICAgICAgICBjb25zdCB7IHN0cmluZ3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IG5vbkZsb29yTGF5ZXJzID0gZ2V0Tm9uRmxvb3JMYXllcnModGhpcy52aWV3KTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1wYW5lbFwiLCB7IHJlZjogKGVsKSA9PiAodGhpcy5sYXllclBhbmVsID0gZWwpIH0sIHRoaXMucmVuZGVyTGF5ZXJzKCksIGgoXCJjYWxjaXRlLWZhYlwiLCB7IHNsb3Q6IFwiZmFiXCIsIGljb246IFwicGx1c1wiLCBhcHBlYXJhbmNlOiBcIm91dGxpbmUtZmlsbFwiLCBraW5kOiBcIm5ldXRyYWxcIiwgXCJ0ZXh0LWVuYWJsZWRcIjogdHJ1ZSwgbGFiZWw6IHN0cmluZ3MuYWRkTGF5ZXJzLCB0ZXh0OiBzdHJpbmdzLmFkZExheWVycywgZGlzYWJsZWQ6IG5vbkZsb29yTGF5ZXJzLmxlbmd0aCA9PT0gMCwgc2NhbGU6IFwic1wiLCByZWY6IChlbCkgPT4gKHRoaXMudHJpZ2dlckJ1dHRvbiA9IGVsKSwgb25DbGljazogKCkgPT4gdGhpcy5jcmVhdGUoKSB9KSkpO1xuICAgIH1cbiAgICByZW5kZXJMYXllcnMoKSB7XG4gICAgICAgIGNvbnN0IGxheWVycyA9IHRoaXMuZ2V0TGF5ZXJzKCk7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtdmFsdWUtbGlzdFwiLCB7IGRpcjogXCJsdHJcIiwgY2xhc3M6IFwiY2FsY2l0ZS1tb2RlLWxpZ2h0XCIsIG9uQ2xpY2s6IChlKSA9PiB0aGlzLmVkaXQoZSkgfSwgbGF5ZXJzLm1hcCgobGF5ZXIpID0+IHRoaXMucmVuZGVyTGF5ZXIobGF5ZXIpKSkpO1xuICAgIH1cbiAgICByZW5kZXJMYXllcihmbG9vckxheWVyKSB7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIGZsb29ySW5mbywgaWQgfSA9IGZsb29yTGF5ZXI7XG4gICAgICAgIGNvbnN0IHsgZmxvb3JGaWVsZCB9ID0gZmxvb3JJbmZvO1xuICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBgeyR7Zmxvb3JGaWVsZH19YDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS12YWx1ZS1saXN0LWl0ZW1cIiwgeyBsYWJlbDogdGl0bGUsIGRlc2NyaXB0aW9uOiBmaWVsZE5hbWUsIHZhbHVlOiBpZCB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBzbG90OiBcImFjdGlvbnMtZW5kXCIsIHRleHQ6IHRoaXMuc3RyaW5ncy5yZW1vdmUsIGljb246IFwieFwiLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMYXllcihmbG9vckxheWVyKTtcbiAgICAgICAgICAgIH0gfSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcm90ZWN0ZWQgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBkaXNhYmxlQ29udGFpbmVyKGRpc2FibGUpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSB0aGlzLmVsLmNsb3Nlc3QoXCJjYWxjaXRlLWJsb2NrXCIpO1xuICAgICAgICBpZiAoYmxvY2spIHtcbiAgICAgICAgICAgIGJsb2NrLmRpc2FibGVkID0gZGlzYWJsZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc2FibGUuZW1pdChkaXNhYmxlKTtcbiAgICB9XG4gICAgY3JlYXRlQWRkTGF5ZXJzRmxvdyhtb2RlKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZUNvbnRhaW5lcih0cnVlKTtcbiAgICAgICAgY29uc3QgYWRkTGF5ZXJzRmxvdyA9ICh0aGlzLmFkZExheWVyc0Zsb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tYWRkLWxheWVycy1mbG93XCIpKTtcbiAgICAgICAgYWRkTGF5ZXJzRmxvdy5zdHJpbmdzID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICBhZGRMYXllcnNGbG93LnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgICAgIGFkZExheWVyc0Zsb3cubW9kZSA9IG1vZGU7XG4gICAgICAgIGFkZExheWVyc0Zsb3cuYWRkRXZlbnRMaXN0ZW5lcihcImRvbmVcIiwgdGhpcy5jbG9zZS5iaW5kKHRoaXMsIHRydWUpKTtcbiAgICAgICAgYWRkTGF5ZXJzRmxvdy5hZGRFdmVudExpc3RlbmVyKFwiZGlzbWlzc1wiLCB0aGlzLmNsb3NlLmJpbmQodGhpcywgZmFsc2UpKTtcbiAgICAgICAgcmV0dXJuIGFkZExheWVyc0Zsb3c7XG4gICAgfVxuICAgIGNyZWF0ZVBvcG92ZXIoKSB7XG4gICAgICAgIGNvbnN0IHJlZmVyZW5jZUVsZW1lbnQgPSB0aGlzLmVsO1xuICAgICAgICBjb25zdCBwb3BvdmVyTm9kZSA9ICh0aGlzLnBvcG92ZXJOb2RlID1cbiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYWxjaXRlLXBvcG92ZXJcIikpO1xuICAgICAgICBwb3BvdmVyTm9kZS5jbGFzc0xpc3QuYWRkKFwianMtYXBwLXByaW1hcnktZmx5b3V0XCIpO1xuICAgICAgICBwb3BvdmVyTm9kZS5yZWZlcmVuY2VFbGVtZW50ID0gcmVmZXJlbmNlRWxlbWVudDtcbiAgICAgICAgcG9wb3Zlck5vZGUub2Zmc2V0RGlzdGFuY2UgPSAtNTUwO1xuICAgICAgICBwb3BvdmVyTm9kZS5vZmZzZXRTa2lkZGluZyA9IDA7XG4gICAgICAgIHBvcG92ZXJOb2RlLmxhYmVsID0gdGhpcy5zdHJpbmdzLmFkZExheWVycztcbiAgICAgICAgcG9wb3Zlck5vZGUucGxhY2VtZW50ID0gXCJib3R0b20tc3RhcnRcIjtcbiAgICAgICAgcG9wb3Zlck5vZGUucG9pbnRlckRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwb3BvdmVyTm9kZSk7XG4gICAgICAgIHJldHVybiBwb3BvdmVyTm9kZTtcbiAgICB9XG4gICAgZ2V0U2VsZWN0ZWRMYXllcihlKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgIGlmICgoKF9hID0gZS50YXJnZXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2NhbE5hbWUpID09PSBcImNhbGNpdGUtdmFsdWUtbGlzdC1pdGVtXCIgfHxcbiAgICAgICAgICAgICgoX2MgPSAoX2IgPSBlLnRhcmdldCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sb2NhbE5hbWUpID09PSBcImNhbGNpdGUtdmFsdWUtbGlzdC1pdGVtXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gKF9kID0gZS50YXJnZXQudmFsdWUpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChfZSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS52YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmRMYXllcihpZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0TGF5ZXJzKCkge1xuICAgICAgICBjb25zdCBtYXBWaWV3ID0gdGhpcy52aWV3O1xuICAgICAgICBjb25zdCB7IG1hcCB9ID0gbWFwVmlldztcbiAgICAgICAgY29uc3QgeyBhbGxMYXllcnMgfSA9IG1hcDtcbiAgICAgICAgbGV0IGxheWVycyA9IFtdO1xuICAgICAgICBhbGxMYXllcnMuZm9yRWFjaCgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgdHlwZSwgZmxvb3JJbmZvIH0gPSBsYXllcjtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhbGxTdWJsYXllcnMgfSA9IGxheWVyO1xuICAgICAgICAgICAgICAgIGxheWVycyA9IGxheWVycy5jb25jYXQoYWxsU3VibGF5ZXJzLmZpbHRlcigoc3ViTGF5ZXIpID0+IHN1YkxheWVyLmZpZWxkc0luZGV4ICYmIChzdWJMYXllciA9PT0gbnVsbCB8fCBzdWJMYXllciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3ViTGF5ZXIuZmxvb3JJbmZvKSkudG9BcnJheSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZsb29ySW5mbykge1xuICAgICAgICAgICAgICAgIGxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBsYXllcnM7XG4gICAgfVxuICAgIGZpbmRMYXllcihsYXllcklkKSB7XG4gICAgICAgIGNvbnN0IGxheWVycyA9IHRoaXMuZ2V0TGF5ZXJzKCk7XG4gICAgICAgIHJldHVybiBsYXllcnMgPT09IG51bGwgfHwgbGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLmlkID09PSBsYXllcklkKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0Zsb29yQWRkaXRpb25hbExheWVycy5zdHlsZSA9IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvbkFkZGl0aW9uYWxMYXllcnNDc3M7XG5cbmNvbnN0IEFyY2dpc0ZpZWxkTGlzdCA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGlzdENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuZmlsdGVyRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZpZWxkVHlwZSA9IFwic3RyaW5nXCI7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1waWNrLWxpc3RcIiwgeyBcImZpbHRlci1lbmFibGVkXCI6IHRoaXMuZmlsdGVyRW5hYmxlZCwgXCJmaWx0ZXItcGxhY2Vob2xkZXJcIjogdGhpcy5zdHJpbmdzLmZpbHRlciwgbXVsdGlwbGU6IHRoaXMubXVsdGlwbGUsIG9uQ2xpY2s6IChlKSA9PiB0aGlzLm9uTGlzdENoYW5nZShlKSB9LCB0aGlzLnJlbmRlckZpZWxkcygpKSkpO1xuICAgIH1cbiAgICByZW5kZXJGaWVsZHMoKSB7XG4gICAgICAgIGxldCBmaWVsZHMgPSB0aGlzLmdldEZpZWxkcygpO1xuICAgICAgICByZXR1cm4gKGZpZWxkcyB8fCBbXSkubWFwKChmaWVsZCkgPT4gdGhpcy5yZW5kZXJGaWVsZChmaWVsZCkpO1xuICAgIH1cbiAgICByZW5kZXJGaWVsZChmaWVsZCkge1xuICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBgeyR7ZmllbGQubmFtZX19YDtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiLCB7IGxhYmVsOiBmaWVsZC5hbGlhcywgZGVzY3JpcHRpb246IGZpZWxkTmFtZSwgc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0aW9uLmhhcyhmaWVsZC5uYW1lKSwgdmFsdWU6IGZpZWxkLm5hbWUgfSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBvbkxpc3RDaGFuZ2UoZSkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb24oZSk7XG4gICAgICAgIHRoaXMubGlzdENoYW5nZS5lbWl0KEFycmF5LmZyb20oc2VsZWN0aW9uLnZhbHVlcygpKSk7XG4gICAgfVxuICAgIHVwZGF0ZVNlbGVjdGlvbihlKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgIGlmICgoKF9hID0gZS50YXJnZXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2NhbE5hbWUpID09PSBcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIiB8fFxuICAgICAgICAgICAgKChfYyA9IChfYiA9IGUudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxvY2FsTmFtZSkgPT09IFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiKSB7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGROYW1lID0gKF9kID0gZS50YXJnZXQudmFsdWUpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IChfZSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGlzUmVtb3ZlZCA9IHNlbGVjdGlvbi5oYXMoc2VsZWN0ZWRGaWVsZE5hbWUpO1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZCA9IHRoaXMuZmluZEZpZWxkKHNlbGVjdGVkRmllbGROYW1lKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpc1JlbW92ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5zZXQoc2VsZWN0ZWRGaWVsZE5hbWUsIHNlbGVjdGVkRmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24uZGVsZXRlKHNlbGVjdGVkRmllbGQubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RmllbGRzKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBmaWVsZFR5cGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgZmllbGRzIH0gPSBsYXllcjtcbiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT09IG51bGwgfHwgZmllbGRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZHMubGVuZ3RoKVxuICAgICAgICAgICAgPyBmaWVsZHMuZmlsdGVyKChmaWVsZCkgPT4gIWZpZWxkVHlwZSB8fCAoZmllbGQgPT09IG51bGwgfHwgZmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpZWxkLnR5cGUpID09PSBmaWVsZFR5cGUpXG4gICAgICAgICAgICA6IFtdO1xuICAgIH1cbiAgICBmaW5kRmllbGQobmFtZSkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gbGF5ZXIuZmllbGRzSW5kZXguZ2V0KG5hbWUpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBBcmNnaXNGbG9vckZpZWxkUGlja2VyID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5pY29uRW5kID0gXCJwZW5jaWxcIjtcbiAgICAgICAgdGhpcy5sYWJlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wbGFjZW1lbnQgPSBcImF1dG9cIjtcbiAgICAgICAgdGhpcy5vcGVuID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGJ1dHRvblRleHQgPSAoKF9hID0gdGhpcy5sYXllcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpdGxlKSB8fCB0aGlzLnN0cmluZ3Mubm9uZTtcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMubGFiZWwsIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBzY2FsZTogXCJtXCIsIFwiaWNvbi1lbmRcIjogdGhpcy5pY29uRW5kLCByZWY6IChlbCkgPT4gKHRoaXMudHJpZ2dlckJ1dHRvbiA9IGVsKSwgb25DbGljazogKCkgPT4gKHRoaXMub3BlbiA9ICF0aGlzLm9wZW4pIH0sIGJ1dHRvblRleHQpKSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IGxhYmVsOiB0aGlzLmxhYmVsLCBwb2ludGVyRGlzYWJsZWQ6IHRydWUsIHJlZmVyZW5jZUVsZW1lbnQ6IHRoaXMudHJpZ2dlckJ1dHRvbiwgb3BlbjogdGhpcy5vcGVuLCBjbG9zYWJsZTogdHJ1ZSwgcGxhY2VtZW50OiB0aGlzLnBsYWNlbWVudCB9LCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiY29udGVudFwiIH0sIGgoXCJzbG90XCIsIG51bGwpKSkpKTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uRmllbGRTZWxlY3QgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmllbGQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmllbGRUeXBlID0gXCJzdHJpbmdcIjtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLm9uU2VsZWN0Q2hhbmdlKCk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBGdW5jdGlvbnNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBmaW5kRmllbGQoZmllbGROYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheWVyLmZpZWxkc0luZGV4LmdldChmaWVsZE5hbWUpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50IEhhbmRsZXJzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgb25TZWxlY3RDaGFuZ2UoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0IH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IHNlbGVjdCA9PT0gbnVsbCB8fCBzZWxlY3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdC5zZWxlY3RlZE9wdGlvbjtcbiAgICAgICAgdGhpcy5maWVsZCA9IHNlbGVjdGVkT3B0aW9uXG4gICAgICAgICAgICA/IHRoaXMuZmluZEZpZWxkKHNlbGVjdGVkT3B0aW9uLnZhbHVlKVxuICAgICAgICAgICAgOiB0aGlzLmZpZWxkIHx8IHRoaXMuZ2V0RmllbGRzKClbMF07XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUgfSA9IHRoaXMubGF5ZXI7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuZ2V0RmllbGRzKCk7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiY2FsY2l0ZS1sYWJlbFwiLCBudWxsLCB0aXRsZSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgbGFiZWw6IFwic2VsZWN0XCIsIHJlZjogKGUpID0+ICh0aGlzLnNlbGVjdCA9IGUpLCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6ICgpID0+IHRoaXMub25TZWxlY3RDaGFuZ2UoKSB9LCBmaWVsZHMubWFwKChmaWVsZCkgPT4gdGhpcy5yZW5kZXJGaWVsZChmaWVsZCkpKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRmllbGQoZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJjYWxjaXRlLW9wdGlvblwiLCB7IGxhYmVsOiBmaWVsZC5hbGlhcywgdmFsdWU6IGZpZWxkLm5hbWUgfSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgLy9cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGdldEZpZWxkcygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgZmllbGRUeXBlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGZpZWxkcyB9ID0gbGF5ZXI7XG4gICAgICAgIHJldHVybiAoZmllbGRzID09PSBudWxsIHx8IGZpZWxkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmllbGRzLmxlbmd0aClcbiAgICAgICAgICAgID8gZmllbGRzLmZpbHRlcigoZmllbGQpID0+ICFmaWVsZFR5cGUgfHwgKGZpZWxkID09PSBudWxsIHx8IGZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWVsZC50eXBlKSA9PT0gZmllbGRUeXBlKVxuICAgICAgICAgICAgOiBbXTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblxuY29uc3QgQXJjZ2lzTGF5ZXJMaXN0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5saXN0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJsaXN0Q2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmxheWVycyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuZmlsdGVyRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtcGljay1saXN0XCIsIHsgXCJmaWx0ZXItZW5hYmxlZFwiOiB0aGlzLmZpbHRlckVuYWJsZWQsIFwiZmlsdGVyLXBsYWNlaG9sZGVyXCI6IHRoaXMuc3RyaW5ncy5maWx0ZXIsIG11bHRpcGxlOiB0aGlzLm11bHRpcGxlLCBvbkNsaWNrOiAoZSkgPT4gdGhpcy5vbkxpc3RDaGFuZ2UoZSkgfSwgdGhpcy5yZW5kZXJMYXllcnMoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTGF5ZXJzKCkge1xuICAgICAgICBjb25zdCB7IGxheWVycywgc2VsZWN0aW9uIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGxheWVycyB8fCBbXSkubWFwKChsYXllcikgPT4gKGgoXCJjYWxjaXRlLXBpY2stbGlzdC1pdGVtXCIsIHsgbGFiZWw6IGxheWVyLnRpdGxlLCBkZXNjcmlwdGlvbjogdGhpcy5nZXRMYXllclR5cGUobGF5ZXIpLCBzZWxlY3RlZDogc2VsZWN0aW9uLmhhcyhsYXllci5pZCksIHZhbHVlOiBsYXllci5pZCB9KSkpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBvbkxpc3RDaGFuZ2UoZSkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb24oZSk7XG4gICAgICAgIHRoaXMubGlzdENoYW5nZS5lbWl0KEFycmF5LmZyb20oc2VsZWN0aW9uLnZhbHVlcygpKSk7XG4gICAgfVxuICAgIHVwZGF0ZVNlbGVjdGlvbihlKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgIGlmICgoKF9hID0gZS50YXJnZXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sb2NhbE5hbWUpID09PSBcImNhbGNpdGUtcGljay1saXN0LWl0ZW1cIiB8fFxuICAgICAgICAgICAgKChfYyA9IChfYiA9IGUudGFyZ2V0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxvY2FsTmFtZSkgPT09IFwiY2FsY2l0ZS1waWNrLWxpc3QtaXRlbVwiKSB7XG4gICAgICAgICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGF5ZXJJZCA9IChfZCA9IGUudGFyZ2V0LnZhbHVlKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAoX2UgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UudmFsdWU7XG4gICAgICAgICAgICBjb25zdCBpc1JlbW92ZWQgPSBzZWxlY3Rpb24uaGFzKHNlbGVjdGVkTGF5ZXJJZCk7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZExheWVyID0gdGhpcy5maW5kTGF5ZXIoc2VsZWN0ZWRMYXllcklkKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpc1JlbW92ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5zZXQoc2VsZWN0ZWRMYXllci5pZCwgc2VsZWN0ZWRMYXllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5kZWxldGUoc2VsZWN0ZWRMYXllci5pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZmluZExheWVyKGxheWVySWQpIHtcbiAgICAgICAgY29uc3QgeyBsYXllcnMgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBsYXllcnMgPT09IG51bGwgfHwgbGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllcnMuZmluZCgobGF5ZXIpID0+IGxheWVyLmlkID09PSBsYXllcklkKTtcbiAgICB9XG4gICAgZ2V0TGF5ZXJUeXBlKGxheWVyKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXJUeXBlcyB9ID0gdGhpcy5zdHJpbmdzO1xuICAgICAgICBjb25zdCB7IGdlb21ldHJ5VHlwZSA9IFwidW5rbm93blwiLCBzb3VyY2VKU09OIH0gPSBsYXllcjtcbiAgICAgICAgcmV0dXJuIGdlb21ldHJ5VHlwZSAhPT0gXCJ1bmtub3duXCJcbiAgICAgICAgICAgID8gbGF5ZXJUeXBlc1tnZW9tZXRyeVR5cGVdXG4gICAgICAgICAgICA6IGxheWVyVHlwZXNbdGhpcy5qc29uVHlwZVRvTGF5ZXJUeXBlKHNvdXJjZUpTT04gPT09IG51bGwgfHwgc291cmNlSlNPTiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc291cmNlSlNPTi5nZW9tZXRyeVR5cGUpXTtcbiAgICB9XG4gICAganNvblR5cGVUb0xheWVyVHlwZSh0eXBlKSB7XG4gICAgICAgIGlmICh0eXBlID09PSBcImVzcmlHZW9tZXRyeVBvbHlnb25cIikge1xuICAgICAgICAgICAgcmV0dXJuIFwicG9seWdvblwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IFwiZXNyaUdlb21ldHJ5UG9pbnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIFwicG9pbnRcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlID09PSBcImVzcmlHZW9tZXRyeVBvbHlsaW5lXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcImxpbmVcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcInVua25vd25cIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuXG5jb25zdCBhcmNnaXNGbG9vckNvbmZpZ3VyYXRpb25MYXllclBpY2tlckNzcyA9IFwiY2FsY2l0ZS1sYWJlbCBzcGFue3dpZHRoOjEwMCU7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufWNhbGNpdGUtbGFiZWwgc3BhbiBjYWxjaXRlLWFjdGlvbnttYXJnaW4tbGVmdDowLjNlbX0uYXJjZ2lzLS1ydGwgY2FsY2l0ZS1sYWJlbCBzcGFuIGNhbGNpdGUtYWN0aW9ue21hcmdpbi1sZWZ0OmF1dG87bWFyZ2luLXJpZ2h0OjAuM2VtfVwiO1xuXG5jb25zdCBBcmNnaXNMYXllclBpY2tlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMubGlzdENoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwibGlzdENoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZExheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaWNvbkVuZCA9IFwicGVuY2lsXCI7XG4gICAgICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGxhY2VtZW50ID0gXCJib3R0b20tc3RhcnRcIjtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZXF1aXJlZEZpZWxkcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5nZW9tZXRyeVR5cGUgPSBcInBvbHlnb25cIjtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIEV2ZW50c1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNhbGNpdGVQb3BvdmVyQ2xvc2VIYW5kbGVyKCkge1xuICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpY1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy5wYW5lbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFuZWwuc2V0Rm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkTGF5ZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGJ1dHRvblRleHQgPSAoc2VsZWN0ZWRMYXllciA9PT0gbnVsbCB8fCBzZWxlY3RlZExheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZExheWVyLnRpdGxlKSB8fCB0aGlzLnN0cmluZ3Mubm9uZTtcbiAgICAgICAgY29uc3QgbGF5ZXJzID0gdGhpcy5nZXRMYXllcnMoKTtcbiAgICAgICAgY29uc3QgZGlzYWJsZWQgPSB0aGlzLm9wZW4gfHwgIShsYXllcnMgPT09IG51bGwgfHwgbGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllcnMubGVuZ3RoKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgICAgICBpZiAoc2VsZWN0ZWRMYXllcikge1xuICAgICAgICAgICAgc2VsZWN0aW9uLnNldChzZWxlY3RlZExheWVyLmlkLCBzZWxlY3RlZExheWVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtbGFiZWxcIiwgbnVsbCwgdGhpcy5sYWJlbCwgaChcInNwYW5cIiwgbnVsbCwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgYWxpZ25tZW50OiBcImljb24tZW5kLXNwYWNlLWJldHdlZW5cIiwga2luZDogXCJuZXV0cmFsXCIsIHNjYWxlOiBcIm1cIiwgXCJpY29uLWVuZFwiOiBcInBlbmNpbFwiLCB3aWR0aDogXCJmdWxsXCIsIGRpc2FibGVkOiBkaXNhYmxlZCwgcmVmOiAoZWwpID0+ICh0aGlzLnRyaWdnZXJCdXR0b24gPSBlbCksIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4gPSAhdGhpcy5vcGVuO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRGb2N1cygpLCAyNSk7XG4gICAgICAgICAgICB9IH0sIGJ1dHRvblRleHQpLCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpY29uOiBcInhcIiwgc2NhbGU6IFwic1wiLCB0ZXh0OiB0aGlzLnN0cmluZ3MuY2xlYXIsIGRpc2FibGVkOiAhdGhpcy5zZWxlY3RlZExheWVyLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExheWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RDaGFuZ2UuZW1pdCgpO1xuICAgICAgICAgICAgfSB9KSkpLCBoKFwiY2FsY2l0ZS1wb3BvdmVyXCIsIHsgbGFiZWw6IHRoaXMubGFiZWwsIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgcmVmZXJlbmNlRWxlbWVudDogdGhpcy50cmlnZ2VyQnV0dG9uLCBvcGVuOiB0aGlzLm9wZW4sIHBsYWNlbWVudDogdGhpcy5wbGFjZW1lbnQsIHJlZjogKGVsKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IGVsKSB9LCBoKFwiY2FsY2l0ZS1wYW5lbFwiLCB7IGhlYWRpbmc6IHRoaXMubGFiZWwsIGNsb3NlZDogZmFsc2UsIFwid2lkdGgtc2NhbGVcIjogXCJtXCIsIFwiaGVpZ2h0LXNjYWxlXCI6IFwibVwiLCByZWY6IChlbCkgPT4gKHRoaXMucGFuZWwgPSBlbCkgfSwgaChcImFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uLWxheWVyLWxpc3RcIiwgeyBzdHJpbmdzOiB0aGlzLnN0cmluZ3MsIGxheWVyczogbGF5ZXJzLCBzZWxlY3Rpb246IHNlbGVjdGlvbiwgb25MaXN0Q2hhbmdlOiAoZSkgPT4gKHRoaXMuc2VsZWN0ZWRMYXllciA9IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5kZXRhaWxbMF0pIH0pLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyB3aWR0aDogXCJmdWxsXCIsIHNsb3Q6IFwiZm9vdGVyXCIsIG9uQ2xpY2s6ICgpID0+ICh0aGlzLm9wZW4gPSBmYWxzZSkgfSwgdGhpcy5zdHJpbmdzLmRvbmUpKSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcml2YXRlIG1ldGhvZHNcbiAgICAvL1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZ2V0TGF5ZXJzKCkge1xuICAgICAgICBjb25zdCBjb21wYXRpYmxlTGF5ZXJzID0gdGhpcy5nZXRDb21wYXRpYmxlTGF5ZXJzKCk7XG4gICAgICAgIHJldHVybiAoY29tcGF0aWJsZUxheWVycyA9PT0gbnVsbCB8fCBjb21wYXRpYmxlTGF5ZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb21wYXRpYmxlTGF5ZXJzLmxlbmd0aClcbiAgICAgICAgICAgID8gY29tcGF0aWJsZUxheWVycy5maWx0ZXIoKGxheWVyKSA9PiB0aGlzLmNoZWNrUmVxdWlyZWRGaWVsZHMobGF5ZXIpKVxuICAgICAgICAgICAgOiBbXTtcbiAgICB9XG4gICAgZ2V0Q29tcGF0aWJsZUxheWVycygpIHtcbiAgICAgICAgY29uc3QgeyBnZW9tZXRyeVR5cGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwIH0gPSB0aGlzLnZpZXc7XG4gICAgICAgIGNvbnN0IHsgYWxsTGF5ZXJzIH0gPSBtYXA7XG4gICAgICAgIGxldCBjb21wYXRpYmxlTGF5ZXJzID0gW107XG4gICAgICAgIGFsbExheWVycy5mb3JFYWNoKChsYXllcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB0eXBlIH0gPSBsYXllcjtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBcIm1hcC1pbWFnZVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhbGxTdWJsYXllcnMgfSA9IGxheWVyO1xuICAgICAgICAgICAgICAgIGNvbXBhdGlibGVMYXllcnMgPSBjb21wYXRpYmxlTGF5ZXJzLmNvbmNhdChhbGxTdWJsYXllcnMuZmlsdGVyKChzdWJMYXllcikgPT4gc3ViTGF5ZXIuZmllbGRzSW5kZXgpLnRvQXJyYXkoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgodHlwZSA9PT0gXCJmZWF0dXJlXCIgJiYgIWdlb21ldHJ5VHlwZSkgfHwgKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsYXllci5nZW9tZXRyeVR5cGUpID09PSBnZW9tZXRyeVR5cGUpIHtcbiAgICAgICAgICAgICAgICBjb21wYXRpYmxlTGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvbXBhdGlibGVMYXllcnM7XG4gICAgfVxuICAgIGNoZWNrUmVxdWlyZWRGaWVsZHMobGF5ZXIpIHtcbiAgICAgICAgY29uc3QgeyByZXF1aXJlZEZpZWxkcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBmaWVsZHNJbmRleCB9ID0gbGF5ZXI7XG4gICAgICAgIHJldHVybiByZXF1aXJlZEZpZWxkcyAmJiBmaWVsZHNJbmRleFxuICAgICAgICAgICAgPyByZXF1aXJlZEZpZWxkcy5ldmVyeSgoZmllbGROYW1lKSA9PiBmaWVsZHNJbmRleC5nZXQoZmllbGROYW1lKSlcbiAgICAgICAgICAgIDogdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0xheWVyUGlja2VyLnN0eWxlID0gYXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uTGF5ZXJQaWNrZXJDc3M7XG5cbmNvbnN0IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvblJlcGxhY2VGaWVsZENzcyA9IFwic2VjdGlvbntwYWRkaW5nOjAuNXJlbSAwLjc1cmVtO2JhY2tncm91bmQtY29sb3I6d2hpdGV9XCI7XG5cbmNvbnN0IEFyY2dpc0Zsb29yUmVwbGFjZUZpZWxkID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21taXQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGlzdHMgPSBBcnJheS5mcm9tKHRoaXMuZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yQWxsKFwiYXJjZ2lzLWZpZWxkLWxpc3RcIikpO1xuICAgICAgICAgICAgbGlzdHMubWFwKChsaXN0KSA9PiBzZXRGbG9vckluZm8obGlzdCkpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIGgoSG9zdCwgbnVsbCwgdGhpcy5yZW5kZXJQYW5lbCgpKTtcbiAgICB9XG4gICAgcmVuZGVyUGFuZWwoKSB7XG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5sYXllcjtcbiAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmZpbmRGaWVsZChsYXllci5mbG9vckluZm8uZmxvb3JGaWVsZCk7XG4gICAgICAgIGNvbnN0IGZpZWxkU2VsZWN0aW9uID0gbmV3IE1hcCgpO1xuICAgICAgICBmaWVsZFNlbGVjdGlvbi5zZXQoZmllbGQubmFtZSwgZmllbGQpO1xuICAgICAgICByZXR1cm4gKGgoXCJzZWN0aW9uXCIsIG51bGwsIGgoXCJhcmNnaXMtZmxvb3ItY29uZmlndXJhdGlvbi1maWVsZC1saXN0XCIsIHsgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBsYXllcjogbGF5ZXIsIHNlbGVjdGlvbjogZmllbGRTZWxlY3Rpb24gfSkpKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQcm90ZWN0ZWQgbWV0aG9kc1xuICAgIC8vXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBmaW5kRmllbGQobmFtZSkge1xuICAgICAgICBjb25zdCBsYXllciA9IHRoaXMubGF5ZXI7XG4gICAgICAgIHJldHVybiBsYXllci5maWVsZHNJbmRleC5nZXQobmFtZSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNGbG9vclJlcGxhY2VGaWVsZC5zdHlsZSA9IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvblJlcGxhY2VGaWVsZENzcztcblxuY29uc3QgYXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uU2VsZWN0RmllbGRzQ3NzID0gXCJzZWN0aW9ue3BhZGRpbmc6MC41cmVtIDAuNzVyZW07YmFja2dyb3VuZC1jb2xvcjp3aGl0ZX1cIjtcblxuY29uc3QgQXJjZ2lzRmxvb3JTZWxlY3RGaWVsZHMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLnZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGF5ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbW1pdCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RzID0gQXJyYXkuZnJvbSh0aGlzLmVsLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvckFsbChcImFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uLWZpZWxkLXNlbGVjdFwiKSk7XG4gICAgICAgICAgICBzZWxlY3RzLmZvckVhY2goKHNlbGVjdCkgPT4gc2V0Rmxvb3JJbmZvKHNlbGVjdCkpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIGgoSG9zdCwgbnVsbCwgdGhpcy5yZW5kZXJQYW5lbCgpKTtcbiAgICB9XG4gICAgcmVuZGVyUGFuZWwoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXJzIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoXCJzZWN0aW9uXCIsIG51bGwsIGgoXCJwXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5zZWxlY3RNZXNzYWdlKSwgbGF5ZXJzLm1hcCgobGF5ZXIpID0+IHRoaXMucmVuZGVyU2VsZWN0KGxheWVyKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyU2VsZWN0KGxheWVyKSB7XG4gICAgICAgIHJldHVybiBoKFwiYXJjZ2lzLWZsb29yLWNvbmZpZ3VyYXRpb24tZmllbGQtc2VsZWN0XCIsIHsgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBsYXllcjogbGF5ZXIgfSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNGbG9vclNlbGVjdEZpZWxkcy5zdHlsZSA9IGFyY2dpc0Zsb29yQ29uZmlndXJhdGlvblNlbGVjdEZpZWxkc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uIGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uLCBBcmNnaXNGbG9vckFkZExheWVycyBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbl9hZGRfbGF5ZXJzLCBBcmNnaXNGbG9vckFkZExheWVyc0Zsb3cgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fYWRkX2xheWVyc19mbG93LCBBcmNnaXNGbG9vckFkZGl0aW9uYWxMYXllcnMgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fYWRkaXRpb25hbF9sYXllcnMsIEFyY2dpc0ZpZWxkTGlzdCBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbl9maWVsZF9saXN0LCBBcmNnaXNGbG9vckZpZWxkUGlja2VyIGFzIGFyY2dpc19mbG9vcl9jb25maWd1cmF0aW9uX2ZpZWxkX3BpY2tlciwgQXJjZ2lzRmxvb3JDb25maWd1cmF0aW9uRmllbGRTZWxlY3QgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fZmllbGRfc2VsZWN0LCBBcmNnaXNMYXllckxpc3QgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fbGF5ZXJfbGlzdCwgQXJjZ2lzTGF5ZXJQaWNrZXIgYXMgYXJjZ2lzX2Zsb29yX2NvbmZpZ3VyYXRpb25fbGF5ZXJfcGlja2VyLCBBcmNnaXNGbG9vclJlcGxhY2VGaWVsZCBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbl9yZXBsYWNlX2ZpZWxkLCBBcmNnaXNGbG9vclNlbGVjdEZpZWxkcyBhcyBhcmNnaXNfZmxvb3JfY29uZmlndXJhdGlvbl9zZWxlY3RfZmllbGRzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1mbG9vci1jb25maWd1cmF0aW9uXzExLmVudHJ5LmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgbCBhcyBsb2FkTW9kdWxlcyB9IGZyb20gJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0IHsgYyBhcyBjbG9zZXN0RWxlbWVudENyb3NzU2hhZG93Qm91bmRhcnkgfSBmcm9tICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5cbmNvbnN0IGxhbmd1YWdlTWFwID0gbmV3IE1hcChbXG4gICAgW1wiYXJcIiwgXCJhclwiXSxcbiAgICBbXCJiZ1wiLCBcImJnXCJdLFxuICAgIFtcImJzXCIsIFwiYnNcIl0sXG4gICAgW1wiY2FcIiwgXCJjYVwiXSxcbiAgICBbXCJjc1wiLCBcImNzXCJdLFxuICAgIFtcImRhXCIsIFwiZGFcIl0sXG4gICAgW1wiZGVcIiwgXCJkZVwiXSxcbiAgICBbXCJlbFwiLCBcImVsXCJdLFxuICAgIFtcImVuXCIsIFwiZW5cIl0sXG4gICAgW1wiZXNcIiwgXCJlc1wiXSxcbiAgICBbXCJldFwiLCBcImV0XCJdLFxuICAgIFtcImZpXCIsIFwiZmlcIl0sXG4gICAgW1wiZnJcIiwgXCJmclwiXSxcbiAgICBbXCJoZVwiLCBcImhlXCJdLFxuICAgIFtcImhyXCIsIFwiaHJcIl0sXG4gICAgW1wiaHVcIiwgXCJodVwiXSxcbiAgICBbXCJpZFwiLCBcImlkXCJdLFxuICAgIFtcIml0XCIsIFwiaXRcIl0sXG4gICAgW1wiamFcIiwgXCJqYVwiXSxcbiAgICBbXCJrb1wiLCBcImtvXCJdLFxuICAgIFtcImx0XCIsIFwibHRcIl0sXG4gICAgW1wibHZcIiwgXCJsdlwiXSxcbiAgICBbXCJuYlwiLCBcIm5iXCJdLFxuICAgIFtcIm5sXCIsIFwibmxcIl0sXG4gICAgW1wicGxcIiwgXCJwbFwiXSxcbiAgICBbXCJwdC1iclwiLCBcInB0LUJSXCJdLFxuICAgIFtcInB0LXB0XCIsIFwicHQtUFRcIl0sXG4gICAgW1wicm9cIiwgXCJyb1wiXSxcbiAgICBbXCJydVwiLCBcInJ1XCJdLFxuICAgIFtcInNrXCIsIFwic2tcIl0sXG4gICAgW1wic2xcIiwgXCJzbFwiXSxcbiAgICBbXCJzclwiLCBcInNyXCJdLFxuICAgIFtcInN2XCIsIFwic3ZcIl0sXG4gICAgW1widGhcIiwgXCJ0aFwiXSxcbiAgICBbXCJ0clwiLCBcInRyXCJdLFxuICAgIFtcInVrXCIsIFwidWtcIl0sXG4gICAgW1widmlcIiwgXCJ2aVwiXSxcbiAgICBbXCJ6aC1jblwiLCBcInpoLUNOXCJdLFxuICAgIFtcInpoLWhrXCIsIFwiemgtSEtcIl0sXG4gICAgW1wiemgtdHdcIiwgXCJ6aC1UV1wiXVxuXSk7XG4vLyBydGxcbmZ1bmN0aW9uIGdldEVsZW1lbnREaXIoZWwpIHtcbiAgICByZXR1cm4gZ2V0RWxlbWVudFByb3AoZWwsIFwiZGlyXCIsIFwibHRyXCIpO1xufVxuZnVuY3Rpb24gZ2V0RWxlbWVudFByb3AoZWwsIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgY2xvc2VzdFdpdGhQcm9wID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsLCBgWyR7cHJvcH1dYCk7XG4gICAgcmV0dXJuIGNsb3Nlc3RXaXRoUHJvcCA/IGNsb3Nlc3RXaXRoUHJvcC5nZXRBdHRyaWJ1dGUocHJvcCkgOiB2YWx1ZTtcbn1cbi8vIGNzc1xuY29uc3QgQ1NTX1VUSUxJVFkgPSB7XG4gICAgcnRsOiBcImFyY2dpcy0tcnRsXCJcbn07XG5hc3luYyBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcGksIHR5cGUsIHBsYWNlcyB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoYXBpID09PSA0KSB7XG4gICAgICAgIGNvbnN0IFtpbnRsXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImVzcmkvaW50bFwiXSk7XG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdEludGxPcHRpb25zID0gaW50bC5jb252ZXJ0TnVtYmVyRm9ybWF0VG9JbnRsT3B0aW9ucyh7XG4gICAgICAgICAgICBwbGFjZXMsXG4gICAgICAgICAgICBzdHlsZTogdHlwZSxcbiAgICAgICAgICAgIGRpZ2l0U2VwYXJhdG9yOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW50bC5mb3JtYXROdW1iZXIobnVtYmVyLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG51bWJlckZvcm1hdEludGxPcHRpb25zKSwgeyBzdHlsZTogdHlwZSB9KSk7XG4gICAgfVxuICAgIGNvbnN0IFtkb2pvTnVtYmVyXSA9IGF3YWl0IGxvYWRNb2R1bGVzKFtcImRvam8vbnVtYmVyXCJdKTtcbiAgICByZXR1cm4gZG9qb051bWJlci5mb3JtYXQobnVtYmVyLCB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIHBsYWNlcyxcbiAgICAgICAgcGF0dGVybjogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnBhdHRlcm5cbiAgICB9KTtcbn1cbmNvbnN0IGNhY2hlID0ge307XG5mdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICBjb25zdCBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XG4gICAgY29uc3QgZGF5U2hvcnRNb250aFllYXIgPSB7XG4gICAgICAgIHllYXI6IFwibnVtZXJpY1wiLFxuICAgICAgICBtb250aDogXCJzaG9ydFwiLFxuICAgICAgICBkYXk6IFwibnVtZXJpY1wiXG4gICAgfTtcbiAgICBpZiAoIWNhY2hlW2xhbmddKSB7XG4gICAgICAgIGNhY2hlW2xhbmddID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsIGRheVNob3J0TW9udGhZZWFyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlW2xhbmddLmZvcm1hdChkYXRlKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFBsdXJhbChsYW5nLCBzdHJpbmdPYmosIG51bWJlcikge1xuICAgIGNvbnN0IHNpbmdsZXMgPSBbXCJpZFwiLCBcImphXCIsIFwia29cIiwgXCJ0aFwiLCBcInZpXCIsIFwiemgtY25cIiwgXCJ6aC1oa1wiLCBcInpoLXR3XCJdO1xuICAgIGNvbnN0IGxpa2VFbmdsaXNoID0gW1xuICAgICAgICBcImVuXCIsXG4gICAgICAgIFwiY2FcIixcbiAgICAgICAgXCJkYVwiLFxuICAgICAgICBcImRlXCIsXG4gICAgICAgIFwiZWxcIixcbiAgICAgICAgXCJlc1wiLFxuICAgICAgICBcImV0XCIsXG4gICAgICAgIFwiZmlcIixcbiAgICAgICAgXCJoaVwiLFxuICAgICAgICBcImh1XCIsXG4gICAgICAgIFwiaXRcIixcbiAgICAgICAgXCJuYlwiLFxuICAgICAgICBcIm5sXCIsXG4gICAgICAgIFwicHQtcHRcIixcbiAgICAgICAgXCJzdlwiLFxuICAgICAgICBcInRyXCJcbiAgICBdO1xuICAgIGNvbnN0IGxvY2FsZSA9IGxhbmcgIT09IG51bGwgJiYgbGFuZyAhPT0gdm9pZCAwID8gbGFuZyA6IFwiZW5cIjtcbiAgICAvLyBpZiB0aGUgbnVtYmVyIGlzIG9uZSwgb3IgaXQgaXMgYSBcInNpbXBsZVwiIGxhbmd1YWdlLCByZXR1cm4gdGhlIDEgc3RyaW5nXG4gICAgaWYgKG51bWJlciA9PT0gMSB8fCBzaW5nbGVzLmluY2x1ZGVzKGxvY2FsZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ09iai5zaW5nbGUucmVwbGFjZShcIiR7bnVtYmVyfVwiLCBcIjFcIik7XG4gICAgfVxuICAgIC8vIGlmIHRoZSBudW1iZXIgaXMgbm90IDEgYW5kIHRoZSBsYW5ndWFnZSB1c2VzIHRoZSBzYW1lIHBsdXJhbGl6YXRpb24gc3RyYXRlZ3kgYXMgZW5nbGlzaCxcbiAgICAvLyByZXR1cm4gdGhlIG11bHRpcGxlIHN0cmluZ1xuICAgIGlmIChudW1iZXIgIT09IDEgJiYgbGlrZUVuZ2xpc2guaW5jbHVkZXMobG9jYWxlKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nT2JqLm11bHRpcGxlLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xuICAgIH1cbiAgICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSB3b3JrZWQsIHJldHVybiB0aGUgXCJ1bmtub3duXCIgc3RyaW5nXG4gICAgcmV0dXJuIHN0cmluZ09iai51bmtub3duLnJlcGxhY2UoXCIke251bWJlcn1cIiwgYCR7bnVtYmVyfWApO1xufVxuXG5leHBvcnQgeyBDU1NfVVRJTElUWSBhcyBDLCBmb3JtYXREYXRlIGFzIGEsIGZvcm1hdFBsdXJhbCBhcyBiLCBmb3JtYXROdW1iZXIgYXMgZiwgZ2V0RWxlbWVudERpciBhcyBnLCBsYW5ndWFnZU1hcCBhcyBsIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxhbmd1YWdlVXRpbC1lZjBlNTRiMi5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IGMgYXMgY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5IH0gZnJvbSAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0IHsgbCBhcyBsYW5ndWFnZU1hcCB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QXNzZXRQYXRoIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5cbi8vIGh0dHBzOi8vbWVkaXVtLmNvbS9zdGVuY2lsLXRyaWNrcy9pbXBsZW1lbnRpbmctaW50ZXJuYXRpb25hbGlzYXRpb24taTE4bi13aXRoLXN0ZW5jaWwtNWU2NTU5NTU0MTE3XG5mdW5jdGlvbiBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UoZWxlbWVudCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGNsb3Nlc3RFbGVtZW50ID0gKF9hID0gY2xvc2VzdEVsZW1lbnRDcm9zc1NoYWRvd0JvdW5kYXJ5KGVsZW1lbnQsIFwiW2xhbmddXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoX2MgPSAoX2IgPSBlbGVtZW50LnNoYWRvd1Jvb3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vd25lckRvY3VtZW50KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZG9jdW1lbnRFbGVtZW50O1xuICAgIC8vIGxhbmd1YWdlIHNldCBieSB0aGUgY2FsbGluZyBhcHBsaWNhdGlvbiBvciBicm93c2VyLiBkZWZhdWx0cyB0byBlbmdsaXNoLlxuICAgIGNvbnN0IGxhbmcgPSAoKGNsb3Nlc3RFbGVtZW50ID09PSBudWxsIHx8IGNsb3Nlc3RFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbG9zZXN0RWxlbWVudC5sYW5nKSB8fCAobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLmxhbmd1YWdlKSB8fCBcImVuXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxhbmd1YWdlTWFwLmhhcyhsYW5nKSkge1xuICAgICAgICByZXR1cm4gbGFuZ3VhZ2VNYXAuZ2V0KGxhbmcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gXCJydS1SVVwiIG1hcHMgdG8gXCJydVwiIHVzZSBjYXNlXG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hcC5nZXQobGFuZy5zbGljZSgwLCAyKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlSW50bChlbGVtZW50KSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy8gaXQncyBPSyBpZiB3ZSBkb24ndCBoYXZlIHRoZSA0IGxldHRlciBsYW5ndWFnZSBmaWxlIGZvciBpdFxuICAgIC8vIDQgbGV0dGVyIGxhbmd1YWdlIGNvZGUgbmVlZGVkIGZvciBmb3JtYXR0aW5nIG51bWJlcnNcbiAgICBjb25zdCBjbG9zZXN0RWxlbWVudCA9IChfYSA9IGNsb3Nlc3RFbGVtZW50Q3Jvc3NTaGFkb3dCb3VuZGFyeShlbGVtZW50LCBcIltsYW5nXVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKF9jID0gKF9iID0gZWxlbWVudC5zaGFkb3dSb290KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub3duZXJEb2N1bWVudCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBsYW5ndWFnZSBzZXQgYnkgdGhlIGNhbGxpbmcgYXBwbGljYXRpb24gb3IgYnJvd3Nlci4gZGVmYXVsdHMgdG8gZW5nbGlzaC5cbiAgICBjb25zdCBsYW5nID0gKChjbG9zZXN0RWxlbWVudCA9PT0gbnVsbCB8fCBjbG9zZXN0RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY2xvc2VzdEVsZW1lbnQubGFuZykgfHwgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5sYW5ndWFnZSkgfHwgXCJlblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZykpIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlTWFwLmdldChsYW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsYW5ndWFnZU1hcC5oYXMobGFuZy5zbGljZSgwLCAyKSkpIHtcbiAgICAgICAgICAgIC8vIHdlIHN1cHBvcnQgdGhlIDIgbGV0dGVyIGNvZGVkIGxhbmd1YWdlXG4gICAgICAgICAgICAvLyBlLmcuIGl0LUNIIHZzIGl0XG4gICAgICAgICAgICByZXR1cm4gbGFuZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgZmV0Y2goZ2V0QXNzZXRQYXRoKGAuLi9hcmNnaXMtYXBwLWFzc2V0cy9pMThuLyR7Y29tcG9uZW50TmFtZX0uaTE4bi4ke2xvY2FsZX0uanNvbmApKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQub2spXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSwgKCkgPT4gcmVqZWN0KCkpO1xuICAgIH0pO1xufVxuY29uc3Qgc3RyaW5nQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBsb2NhbGUpIHtcbiAgICBjb25zdCBpZCA9IGAke2NvbXBvbmVudE5hbWV9JHtsb2NhbGV9YDtcbiAgICBpZiAoIXN0cmluZ0NhY2hlW2lkXSkge1xuICAgICAgICBzdHJpbmdDYWNoZVtpZF0gPSBmZXRjaExvY2FsZVN0cmluZ3NGb3JDb21wb25lbnQoY29tcG9uZW50TmFtZSwgbG9jYWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0NhY2hlW2lkXTtcbn1cbi8qKlxuICogR2V0IHN0cmluZ3MgYW5kIGxhbmd1YWdlIGNvZGVzLlxuICogVGhpcyBtZXRob2QgcmV0dXJucyAyIGxhbmd1YWdlIGNvZGVzLlxuICogVGhlIGZpcnN0IG9uZSByZXR1cm5zIGEgY29kZSB0aGF0J3MgYWxzbyBzdXBwb3J0ZWQgYXMgYSBsYW5ndWFnZSBmaWxlLlxuICogVGhlIHNlY29uZCBvbmUgcmV0dXJucyBhIGNvZGUgd2hlcmUgdGhlcmUgaXMgc3VwcG9ydCBmb3IgdGhlIGZpcnN0IDIgbGV0dGVycyBvZiB0aGUgY29kZSBhcyBwYXJ0IG9mIGEgbGFuZ3VhZ2UgZmlsZSxcbiAqIGJ1dCB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgNCBsZXR0ZXIgY29kZSBmcm9tIHRoZSBwYWdlLlxuICogRS5nLiBGb3IgXCJpdC1jaFwiIGl0IHdpbGwgcmV0dXJuIFwiaXRcIiBhcyB0aGUgZmlyc3QgbGFuZ3VhZ2UgY29kZSBhbmQgXCJpdC1jaFwiIGFzIHRoZSBzZWNvbmQuXG4gKiBUaGUgc2Vjb25kIG9uZSBpcyByZXF1aXJlZCBmb3IgZXNyaS5pbnRsLnNldExvY2FsZSgpIHRvIGdldCB0aGUgY29ycmVjdCBmb3JtYXR0aW5nLlxuICpcbiAqIElmIGEgdGFnTmFtZSBpcyBwcm92aWRlZCBpdCB3aWxsIG92ZXJ3aXRlIHRoZSBlbGVtZW50J3MgdGFnTmFtZVxuICpcbiAqICBAcmV0dXJuIFsgc3RyaW5ncywgZmlyc3QgbGFuZ3VhZ2UgY29kZSwgc2Vjb25kIGxhbmd1YWdlIGNvZGVdXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldExvY2FsZUNvbXBvbmVudFN0cmluZ3MoZWxlbWVudCwgdGFnTmFtZSkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSB0YWdOYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlID0gZ2V0Q29tcG9uZW50Q2xvc2VzdExhbmd1YWdlKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbXBvbmVudExhbmd1YWdlSW50bCA9IGdldENvbXBvbmVudENsb3Nlc3RMYW5ndWFnZUludGwoZWxlbWVudCk7XG4gICAgbGV0IHN0cmluZ3M7XG4gICAgdHJ5IHtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBjb21wb25lbnRMYW5ndWFnZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihgbm8gbG9jYWxlIGZvciAke2NvbXBvbmVudE5hbWV9ICgke2NvbXBvbmVudExhbmd1YWdlfSkgbG9hZGluZyBkZWZhdWx0IGxvY2FsZSBlbi5gKTtcbiAgICAgICAgc3RyaW5ncyA9IGF3YWl0IGZldGNoTG9jYWxlU3RyaW5nc0Zyb21DYWNoZShjb21wb25lbnROYW1lLCBcImVuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gW3N0cmluZ3MsIGNvbXBvbmVudExhbmd1YWdlLCBjb21wb25lbnRMYW5ndWFnZUludGxdO1xufVxuXG5leHBvcnQgeyBnZXRDb21wb25lbnRDbG9zZXN0TGFuZ3VhZ2UgYXMgYSwgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyBhcyBnIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvY2FsZS0wNTBiNmRiOS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=