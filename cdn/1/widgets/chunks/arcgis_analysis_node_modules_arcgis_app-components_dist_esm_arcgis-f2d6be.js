/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{44315:(e,t,i)=>{i.r(t),i.d(t,{arcgis_categorize_items:()=>c});var r=i(81149),o=i(66495),n=i(85984),a=i(36238),s=i(82218),l=i(62463);i(20164),i(69283),i(49853),i(70464),i(79210),i(92638),i(12046),i(74689),i(42577),i(51837);const c=class{constructor(e){(0,r.r)(this,e),this.arcgisCategorizeItemsCancel=(0,r.c)(this,"arcgisCategorizeItemsCancel",7),this.arcgisCategorizeItemsSubmit=(0,r.c)(this,"arcgisCategorizeItemsSubmit",7),this.closeDialog=()=>{this.arcgisCategorizeItemsCancel.emit()},this.handleCategorySelected=({paths:e,selected:t})=>{const{itemIds:i,itemToCategoriesLookup:r}=this,o=Object.assign({},this.categorySelectionCountMap);if(e.forEach((e=>{o[e]=t?[...i]:[]})),i.forEach((i=>{r[i]||(r[i]=[]);const o=r[i];r[i]=t?[...o,...e]:o.filter((t=>!e.includes(t)))})),t){const t=e.reduce(((e,t)=>{let i="";return t.split("/").filter(Boolean).forEach((r=>{i=`${i}/${r}`,i!==t&&e.push(i)})),e}),[]);t.forEach((e=>{o[e]=[]})),i.forEach((e=>{const i=r[e];r[e]=i.filter((e=>!t.includes(e)))}))}this.categorySelectionCountMap=o},this.handleItemCategoryChange=(e,t)=>{const{itemToCategoriesLookup:i,categorySelectionCountMap:r,rootCategoryPath:o}=this,n=i[e],s=t.map((e=>e.startsWith(o)?e:`${o}${e}`));(0,a.f)(n,s)||(n.forEach((t=>{const i=r[t];r[t]=(null!=i?i:[]).filter((t=>t!==e))})),s.forEach((t=>{const i=r[t];r[t]=[...null!=i?i:[],e]})),i[e]=[...s],this.categorySelectionCountMap=Object.assign({},r))},this.updateCategory=async()=>{const{itemIds:e,portal:t,itemToCategoriesLookup:i,i18n:r}=this;this.isLoading=!0;const{result:n,error:a}=await(0,o.u)({categories:i,itemIds:e,portal:t});if(this.isLoading=!1,n&&!a)return this.arcgisCategorizeItemsSubmit.emit(i),void(this.hasUnsavedChanges=!1);this.error=r.errorMessage},this.checkHasChange=()=>{const{itemIds:e,itemToCategoriesLookup:t,initialItemToCategoriesLookup:i}=this;this.hasUnsavedChanges=!!t&&!!i&&e.some((e=>!(0,a.f)(t[e],i[e])))},this.renderItemCard=e=>{const{portal:t,user:i,config:o,itemToCategoriesLookup:n,handleItemCategoryChange:a,categorySchema:s,rootCategoryPath:l}=this,c=n[e.id];return(0,r.h)("arcgis-item-browser-card",{key:e.id,item:e,portal:t,user:i,baseUrl:o.baseUrl,showItemType:!0},(0,r.h)("div",{slot:"content-end",class:"category-picker-container"},(0,r.h)("arcgis-categories-picker",{portal:t,categories:c,schema:s,rootCategoryPath:l,onArcgisCategoriesPickerChange:({detail:t})=>a(e.id,t),hideLabel:!0})))},this.isActive=void 0,this.items=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.categorySchema=void 0,this.isLoading=!1,this.categorySelectionCountMap=void 0,this.itemToCategoriesLookup=void 0,this.error=void 0,this.hasUnsavedChanges=!1,this.rootCategoryPath=void 0}async componentWillLoad(){const e=await(0,s.g)(this.el);this.i18n=e[0],this.updateInternalData(this.items)}async componentDidLoad(){const{portal:e,user:t}=this;this.isLoading=!0;const{result:i,error:r}=await(0,o.g)({portal:e,user:t,useCache:!0});!r&&i&&(this.categorySchema=i[0].categories,this.rootCategoryPath=(0,n.g)(i)),this.isLoading=!1}updateInternalData(e){this.itemIds=e.map((e=>e.id)),this.itemToCategoriesLookup=e.reduce(((e,t)=>(e[t.id]=t.categories,e)),{}),this.categorySelectionCountMap=(e=>{const t={};return e.forEach((({categories:e,id:i})=>{e.forEach((e=>{t[e]||(t[e]=[]),t[e].push(i)}))})),t})(e),this.initialItemToCategoriesLookup=structuredClone(this.itemToCategoriesLookup)}handleIsActiveChange(){this.isActive||this.updateInternalData(this.items)}handleCountMapChange(){this.checkHasChange()}render(){const{items:e,categorySchema:t,categorySelectionCountMap:i,updateCategory:o,isLoading:n,i18n:a,closeDialog:s,isActive:c,renderItemCard:u,handleCategorySelected:d,error:h,hasUnsavedChanges:g,rootCategoryPath:p}=this,v=e.length;return(0,r.h)("calcite-modal",{open:c,onCalciteModalClose:s,scale:"m",class:"modal"},n&&(0,r.h)("calcite-scrim",{loading:!0},a.loadingText),(0,r.h)("div",{slot:"header"},a.modalTitle),(0,r.h)("div",{slot:"content",class:"stage"},(0,r.h)("calcite-alert",{icon:!0,open:!!h,label:h,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,r.h)("div",{slot:"message"},h)),(0,r.h)("arcgis-item-browser",{fetch:async()=>({nextStart:0,num:v,results:e,start:1,total:v}),portal:this.portal,user:this.user,config:this.config,hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,view:"list",selection:"none",num:l.a},(0,r.h)("arcgis-category-tree",{slot:"filters",rootCategoryPath:p,categorySchema:t,categorySelectionCountMap:null!=i?i:{},total:v,onArcgisCategorizeCategorySelected:({detail:e})=>d(e)}),(0,r.h)("arcgis-item-browser-content",{slot:"content"},e.map((e=>u(e)))))),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline","data-id":"cancelButton",onClick:s,width:"full"},a.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:o,width:"full",disabled:!g},a.save))}get el(){return(0,r.d)(this)}static get watchers(){return{items:["updateInternalData"],isActive:["handleIsActiveChange"],categorySelectionCountMap:["handleCountMapChange"]}}};c.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px;z-index:900}.category-picker-container{margin-top:0.5rem}"},66495:(e,t,i)=>{i.d(t,{a:()=>u,b:()=>c,f:()=>l,g:()=>s,u:()=>d});var r=i(20164),o=i(49853),n=i(92638),a=i(12046);const s=async({portal:e,user:t,group:i,useCache:r=!1})=>{var o;try{const n=await(i?c(i.id,e,r):l(e,t,r));return{result:null!==(o=null==n?void 0:n.categorySchema)&&void 0!==o?o:null}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};async function l(e,t,i=!0){if(null!=e||(e=o.c.portal),null!=t||(t=o.c.user),!(null==e?void 0:e.id)||t&&(0,a.a)(t))return null;const n=()=>(0,r.r)(`${(0,r.g)(e)}portals/${e.id}/categorySchema`);return i?(0,r.f)(n,"categorySchema",e.id):n()}async function c(e,t,i=!0){if(null!=t||(t=null===o.c||void 0===o.c?void 0:o.c.portal),!e||!t)return null;const a=()=>(0,r.r)(`${(0,n.g)(t,{id:e})}categorySchema`);return i?(0,r.f)(a,"categorySchema",e):a()}async function u(e,t,i=!0){const o=()=>async function(e,t){var i;const o=(0,r.g)(e),n=await(0,r.r)(`${o}portals/self`),a=await(0,r.r)(`${o}community/groups?q=${n.contentCategorySetsGroupQuery}`),s=null===(i=null==a?void 0:a.results)||void 0===i?void 0:i[0],l=(await(0,r.r)(`${o}content/groups/${s.id}/search`,{q:`typekeywords: ${t}`})).results[0];return(0,r.r)(`${o}content/items/${l.id}/data`)}(e,t);return i?(0,r.f)(o,"categorySchema",t):o()}async function d({categories:e,itemIds:t,portal:i}){try{const o=`${(0,r.g)(i)}/content/updateItems`,n=JSON.stringify(t.map((t=>({[t]:{categories:Array.isArray(e)?e:e[t]}}))));return{result:await(0,r.r)(o,{items:n},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}},85984:(e,t,i)=>{i.d(t,{C:()=>r,U:()=>o,a:()=>n,g:()=>a});const r="/categories",o="/Categories",n=(e,t,i=!0)=>{const r=null!=e?e:"";return`${r}${r.endsWith("/")?"":"/"}${i?t.title.toLocaleLowerCase():t.title}`};function a(e){var t;let i=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return i&&"/"!==i.charAt(0)&&(i=`/${i}`),i||o}},92638:(e,t,i)=>{i.d(t,{g:()=>n});var r=i(20164),o=i(79210);const n=(e,t)=>(0,o.a)(`${(0,r.g)(e)}/community/groups/${t.id}`)},74689:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>n,c:()=>l,d:()=>u,g:()=>d,i:()=>s,u:()=>c});var r=i(79210);function o(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function n(e){var t;return o(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function a(e){var t;return o(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function s(e,t){return e.owner===t.username}function l(e,t){return c(e,t)||"update"===e.itemControl}function c(e,t){return s(e,t)||function(e,t){var i;if(null!=e.isAdmin)return!!e.isAdmin;const r=e.owner,o="admin"===e.itemControl;return!((null===(i=e.portal)||void 0===i?void 0:i.isPortal)&&!s(e,t)&&o&&r.includes("esri_")&&!["esri_livingatlas","esri_demographics","esri_boundaries"].includes(r))&&o}(e,t)}const u=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),d=(e,t)=>`${(0,r.a)(t)}item.html?id=${e}`},12046:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>l,c:()=>a,d:()=>u,e:()=>h,f:()=>d,g:()=>f,h:()=>c,i:()=>s,j:()=>g,k:()=>p,l:()=>y,m:()=>m,n:()=>v,o:()=>C,p:()=>S,q:()=>w});var r=i(74689);const o=e=>{var t,i,r;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(i=null!==(t=null==e?void 0:e.roleId)&&void 0!==t?t:null==e?void 0:e.id)&&void 0!==i?i:null===(r=null==e?void 0:e.sourceJSON)||void 0===r?void 0:r.id};function n(e){return e&&!e.orgId}function a(e){return!e.isPortal||!!e.isBackedBySDS}function s(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function l(e){return"org_admin"===o(e)||"account_admin"===o(e)}function c(e){return"org_user"===o(e)||"account_user"===o(e)}function u(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function d(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateItemCategorySchema"))}function h(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateGroups"))}function g(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function p(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function v(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function m(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function C(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function y(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function f(e,t,i,r){const o=r&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(r.type),n=((null==t?void 0:t.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!t||!l(t)&&!n||!(null==i?void 0:i.isPortal)&&!o)}function w(e){return!!e&&(!u(e)||u(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const S=({items:e,user:t,portal:i})=>{const o=e[0],n=o.owner;if(i.isPortal&&n!==t.username&&n.includes("esri_")&&!["esri_livingatlas"].includes(n))return!1;const a=(0,r.u)(o,t),s=u(t),l=I(t),c=(0,r.c)(o,t)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(t)&&!s&&(function(e,t){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(t)||g(e)||p(e)||!!t.canSharePublic&&v(e)}(t,i)||I(t));return a||c||(0,r.d)(e,t)&&l};function I(e){return y(e)||m(e)||C(e)}},62463:(e,t,i)=>{i.d(t,{I:()=>r,a:()=>o});const r=["folder","group","contentType"],o=99999}}]);