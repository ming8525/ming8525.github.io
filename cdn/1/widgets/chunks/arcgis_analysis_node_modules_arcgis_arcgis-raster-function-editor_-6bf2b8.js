"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-6bf2b8"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/portal-d50d8334.js":
/*!***************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/portal-d50d8334.js ***!
  \***************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ getRenderingServiceValidateUrl),
/* harmony export */   b: () => (/* binding */ getRenderingImageServiceUrl),
/* harmony export */   g: () => (/* binding */ getBaseUrl)
/* harmony export */ });
/**
 * Returns a base url to pass to the item browser
 * Taken from https://devtopia.esri.com/WebGIS/arcgis-webviewer-app/blob/master/src/utils/urlUtils.ts#L106
 * @param {__esri.Portal} portal portal instance
 * @returns {string} formatted baseUrl
 */
function getBaseUrl(portal) {
    const { customBaseUrl, portalHostname, urlKey } = portal;
    const { protocol } = window.location;
    const url = urlKey !== undefined ? `${urlKey}.${customBaseUrl}` : portalHostname;
    return `${protocol}//${url}`;
}
/**
 * To get the rendering service base url based on agol/enterprise
 * @param portal
 * @returns
 */
function getRenderingServiceBaseUrl(portal) {
    const { helperServices: { rasterAnalytics: { url: GPServer } }, isPortal } = portal;
    return isPortal ? GPServer : GPServer.replace("rasteranalysis", "rasterutils");
}
/**
 * function to get rendering service validate url
 * @param {Portal} portal portal instance
 * @returns {string} url string
 */
function getRenderingServiceValidateUrl(portal) {
    return getRenderingServiceBaseUrl(portal).replace("RasterAnalysisTools/GPServer", "RasterRendering/ImageServer/validate");
}
/**
 * function to get rendering service image service url
 * @param {Portal} portal portal instance
 * @returns {string} url string
 */
function getRenderingImageServiceUrl(portal) {
    return getRenderingServiceBaseUrl(portal).replace("RasterAnalysisTools/GPServer", "RasterRendering/ImageServer");
}



//# sourceMappingURL=portal-d50d8334.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-preview.entry.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-preview.entry.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   rfx_preview: () => (/* binding */ RFxPreview)
/* harmony export */ });
/* harmony import */ var _index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-da1b7138.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/index-da1b7138.js");
/* harmony import */ var _localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./localization-helper-4819b67d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/localization-helper-4819b67d.js");
/* harmony import */ var _arcgis_core_core_lang_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @arcgis/core/core/lang.js */ "@arcgis/core/core/lang.js");
/* harmony import */ var _type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./type-gaurds-1840747f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/type-gaurds-1840747f.js");
/* harmony import */ var _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui-utils-928a4096.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js");
/* harmony import */ var _help_text_34a29835_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./help-text-34a29835.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/help-text-34a29835.js");
/* harmony import */ var _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./interfaces-d0c68944.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/interfaces-d0c68944.js");
/* harmony import */ var _layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./layer-helper-3867eef7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/layer-helper-3867eef7.js");
/* harmony import */ var _arcgis_core_rest_support_AlgorithmicColorRamp_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @arcgis/core/rest/support/AlgorithmicColorRamp.js */ "@arcgis/core/rest/support/AlgorithmicColorRamp.js");
/* harmony import */ var _arcgis_core_rest_support_MultipartColorRamp_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @arcgis/core/rest/support/MultipartColorRamp.js */ "@arcgis/core/rest/support/MultipartColorRamp.js");
/* harmony import */ var _arcgis_core_Color_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @arcgis/core/Color.js */ "@arcgis/core/Color.js");
/* harmony import */ var _colorRampUtils_8bdd46c5_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./colorRampUtils-8bdd46c5.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/colorRampUtils-8bdd46c5.js");
/* harmony import */ var _arcgis_core_rest_geoprocessor_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @arcgis/core/rest/geoprocessor.js */ "@arcgis/core/rest/geoprocessor.js");
/* harmony import */ var _arcgis_core_request_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @arcgis/core/request.js */ "@arcgis/core/request.js");
/* harmony import */ var _arcgis_core_portal_PortalItem_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @arcgis/core/portal/PortalItem.js */ "@arcgis/core/portal/PortalItem.js");
/* harmony import */ var _common_fda1462e_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./common-fda1462e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/common-fda1462e.js");
/* harmony import */ var _portal_d50d8334_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./portal-d50d8334.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/portal-d50d8334.js");
/* harmony import */ var _getTag_96af029d_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./_getTag-96af029d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/_getTag-96af029d.js");
/* harmony import */ var _resources_27c66f5c_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./resources-27c66f5c.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/resources-27c66f5c.js");
/* harmony import */ var _functions_f1f2dffd_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./functions-f1f2dffd.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/functions-f1f2dffd.js");
/* harmony import */ var _rfx_args_helper_ab401543_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./rfx-args-helper-ab401543.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/rfx-args-helper-ab401543.js");
/* harmony import */ var _arcgis_core_identity_IdentityManager_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @arcgis/core/identity/IdentityManager.js */ "@arcgis/core/identity/IdentityManager.js");
/* harmony import */ var _arcgis_core_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @arcgis/core/core/urlUtils.js */ "@arcgis/core/core/urlUtils.js");
/* harmony import */ var _arcgis_core_layers_Layer_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @arcgis/core/layers/Layer.js */ "@arcgis/core/layers/Layer.js");
/* harmony import */ var _arcgis_core_layers_ImageryLayer_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @arcgis/core/layers/ImageryLayer.js */ "@arcgis/core/layers/ImageryLayer.js");
/* harmony import */ var _arcgis_core_smartMapping_raster_renderers_stretch_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @arcgis/core/smartMapping/raster/renderers/stretch.js */ "@arcgis/core/smartMapping/raster/renderers/stretch.js");
/* harmony import */ var _Uint8Array_68e1e3f9_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./_Uint8Array-68e1e3f9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/_Uint8Array-68e1e3f9.js");




























const HTMLClasses = {
    actionButtonCotainer: "action-button-container",
    actionButton: "action-button",
    previewList: "preview-list",
    helpAction: "help-action"
};

const rfxPreviewCss = ":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.action-button-container{display:flex;justify-content:space-between}.action-button{width:48%}.preview-list{padding:var(--rfx-full-spacing) 0 var(--rfx-full-spacing) 0}.help-action{-webkit-margin-start:auto;margin-inline-start:auto}";

const RFxPreview = class {
    constructor(hostRef) {
        (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.rfxPreviewSelection = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "rfxPreviewSelection", 7);
        this.previewHelpClick = (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "previewHelpClick", 7);
        /**
         * Controls opening the preview details block on load
         * @category Private
         */
        this.openBlockInitially = true;
        this.maxPreviewLayers = 5;
        this.previewIndexCounter = 1;
        /**
         * handles the create preview layer workflow
         */
        this.createPreviewLayer = async () => {
            await this.addToPreviewLayerList();
            this.loadPreviewLayer();
        };
        /**
         * Creates and show preview if the if switch is checked. Remove preview if its unchecked
         * @param event Preview switch event
         */
        this.handlePreviewSwitchChange = (event) => {
            const element = event.target;
            const checked = element.checked;
            this.showPreviewBlock = checked;
            if (this.showPreviewBlock === false) {
                this.hidePreviewLayers();
            }
            else {
                if (this.previewLayers.length === 0) {
                    //if no layers are there, add a layer by default
                    this.createPreviewLayer();
                }
                else {
                    this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data);
                    this.loadPreviewLayer();
                }
            }
        };
        /**
         * Update the selected preview layer with current params from the editor app
         */
        this.updatePreviewLayer = async () => {
            const updatedData = await this.getTemplate();
            this.previewLayers.forEach((layer) => {
                if (layer.index === this.selectedPreviewLayerIndex) {
                    layer.data = updatedData;
                }
            });
            this.loadPreviewLayer();
        };
        /**
         * Show preview for the selected preview layer and load editor with the arg values with which the preview was created
         * @param event Event emitted when a preview layer is selected from the list
         */
        this.onPreviewSelect = (event) => {
            this.hidePreviewLayers();
            this.selectedPreviewLayerIndex = event.target?.value;
            this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data);
            this.getSelectedPreviewListItem().layer.visible = true;
        };
        /**
         * Removes the item from the list and also remove the preview from the map
         * @param event Event emitted when the preview item is closed
         */
        this.onPreviewClose = (event) => {
            const closedPreviewIndex = event.target?.value;
            this.removePreviewLayerFromMap(this.previewLayers.find((prevLayer) => prevLayer.index === closedPreviewIndex).layer);
            this.previewLayers = this.previewLayers.filter((layer) => layer.index !== closedPreviewIndex);
            if (this.previewLayers.length === 0) {
                this.showPreviewBlock = false;
            }
        };
        /**
         * Render the error icon when the preview fail to load
         */
        this.renderPreviewError = (index) => {
            return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: `preview-layer-load-error-${index}`, iconStart: "exclamation-mark-triangle", appearance: "transparent", kind: "neutral", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale }), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { label: "preview failed to load", "reference-element": `preview-layer-load-error-${index}` }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.strings.previewError))));
        };
        /**
         * Render the preview layer list
         */
        this.renderPreviewLayers = () => {
            return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: HTMLClasses.previewList, loading: this.previewLayerLoading, selectionAppearance: "border", selectionMode: "single", dir: this.direction }, this.previewLayers.map((previewLayer) => {
                return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { key: `preview-layer-item${previewLayer.index}`, id: `preview-layer-item${previewLayer.index}`, dir: this.direction, label: previewLayer.label, value: previewLayer.index, selected: previewLayer.index === this.selectedPreviewLayerIndex, closable: true, onCalciteListItemSelect: this.onPreviewSelect, onCalciteListItemClose: this.onPreviewClose }, previewLayer.status === _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__.P.error &&
                    this.renderPreviewError(previewLayer.index)));
            })));
        };
        /**
         * render the switch button to enable and disable preview
         */
        this.renderPreviewSwitch = () => {
            return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { dir: this.direction, layout: "inline", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale, ref: (el) => {
                    this.showPreviewElement = el;
                } }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", {
                // scale={UIDefaults.Scale}
                checked: this.showPreviewBlock, onCalciteSwitchChange: this.handlePreviewSwitchChange, dir: this.direction, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale
            }), this.strings.showPreview, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { class: HTMLClasses.helpAction, text: "show help", icon: "information", scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale, onClick: (e) => {
                    e.stopPropagation();
                    const helpText = (0,_help_text_34a29835_js__WEBPACK_IMPORTED_MODULE_5__.d)(this.strings.previewPopup);
                    this.previewHelpClick.emit({
                        referenceElement: this.showPreviewElement,
                        helpSrcdoc: helpText,
                        heading: this.strings.showPreview
                    });
                } })));
        };
        this.previewLayers = [];
        this.showPreviewBlock = false;
        this.previewLayerLoading = false;
        this.mapView = undefined;
        this.getTemplate = undefined;
        this.portal = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        ({ strings: this.strings, dir: this.direction } = await (0,_localization_helper_4819b67d_js__WEBPACK_IMPORTED_MODULE_1__.b)(this.hostElement, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.g)(".")));
    }
    disconnectedCallback() {
        this.removePreviewLayerFromMap(this.getSelectedPreviewListItem()?.layer);
    }
    /**
     * Add to the list to preview layers
     */
    async addToPreviewLayerList() {
        const rfxTemplate = await this.getTemplate();
        const { previewIndexCounter: currentIndex } = this;
        this.previewLayers.push({
            index: currentIndex,
            label: (0,_common_fda1462e_js__WEBPACK_IMPORTED_MODULE_15__.f)(this.strings.previewLayer, { number: currentIndex.toString() }),
            data: rfxTemplate,
            status: _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__.P.loading
        });
        this.selectedPreviewLayerIndex = currentIndex;
        this.previewIndexCounter++;
    }
    /**
     * Validate RFT using rendering service
     * @param {rfxTemplate} template which should be validated
     * @returns {boolean} boolean value if the template is valid or not
     */
    validateRFT(rfxTemplate) {
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_3__.i)(rfxTemplate)) {
            return;
        }
        const rasterRenderingService = (0,_portal_d50d8334_js__WEBPACK_IMPORTED_MODULE_16__.a)(this.portal);
        const query = {
            renderingRule: JSON.stringify(rfxTemplate),
            f: "json"
        };
        return (0,_common_fda1462e_js__WEBPACK_IMPORTED_MODULE_15__.r)(rasterRenderingService, { query }).then((response) => {
            return response?.data?.renderingRule?.isValid;
        }, (validateFail) => {
            console.log("validate request failed", validateFail);
        });
    }
    /**
     * To remove preview layer from the map
     */
    removePreviewLayerFromMap(previewLayer) {
        if ((0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_3__.i)(previewLayer)) {
            return;
        }
        previewLayer.opacity = 0;
        this.mapView.map.remove(previewLayer);
    }
    /**
     * To add preview layer to the map using raster rendering service
     * whose raster value is rfxTemplate in base64 format
     * @param rfxTemplate template with which the rendering service should be created
     */
    addPreviewLayerToMap(rfxTemplate) {
        const selectedPreview = this.getSelectedPreviewListItem();
        const layer = (0,_layer_helper_3867eef7_js__WEBPACK_IMPORTED_MODULE_7__.o)((0,_portal_d50d8334_js__WEBPACK_IMPORTED_MODULE_16__.b)(this.portal), rfxTemplate);
        //TODO: need to check 3x why and how this is working
        // if (
        //   rfxTemplate.function?.type === "LocalFunction" &&
        //   binFunctions.indexOf(rfxTemplate.function.name) > -1
        // ) {
        //   const result = await createStrecthRenderer(layer);
        //   layer.renderer = result.renderer;
        // }
        layer
            .load()
            .catch(() => (selectedPreview.status = _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__.P.error))
            .then(() => {
            selectedPreview.layer = layer;
            this.mapView.map.add(layer);
            this.mapView.whenLayerView(layer).then((layerView) => {
                layerView.watch("updating", (status) => {
                    this.previewLayerLoading = status;
                });
            });
        });
    }
    /**
     * Hide all the preview layers in the map
     */
    hidePreviewLayers() {
        this.previewLayers.forEach((previewLayer) => {
            if (!(0,_type_gaurds_1840747f_js__WEBPACK_IMPORTED_MODULE_3__.i)(previewLayer.layer)) {
                previewLayer.layer.visible = false;
            }
        });
    }
    /**
     * Load the selectedPreview layer or otherwise the last one in the list
     */
    async loadPreviewLayer() {
        this.previewLayerLoading = true;
        this.hidePreviewLayers();
        const selectedPreviewLayer = this.getSelectedPreviewListItem();
        const rfxTemplate = selectedPreviewLayer.data;
        selectedPreviewLayer.isValid = await this.validateRFT(rfxTemplate);
        if (selectedPreviewLayer.isValid) {
            selectedPreviewLayer.status = _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__.P.success;
            this.addPreviewLayerToMap(rfxTemplate);
        }
        else {
            selectedPreviewLayer.status = _interfaces_d0c68944_js__WEBPACK_IMPORTED_MODULE_6__.P.error;
            this.previewLayerLoading = false;
        }
    }
    /**
     * Gives the selected previewlist item
     * @returns <PreviewList>
     */
    getSelectedPreviewListItem() {
        if (this.selectedPreviewLayerIndex === undefined) {
            return this.previewLayers[0];
        }
        return this.previewLayers.find((previewLayer) => previewLayer.index === this.selectedPreviewLayerIndex);
    }
    /**
     * Render the action buttons update and new preview
     */
    renderActions() {
        const disableCreatePreview = this.previewLayers.length === this.maxPreviewLayers;
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: HTMLClasses.actionButtonCotainer }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: "preview-update-button", class: HTMLClasses.actionButton, kind: "neutral", appearance: "outline-fill", iconStart: "refresh", onClick: this.updatePreviewLayer, dir: this.direction, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale, disabled: this.previewLayerLoading }, this.strings.update), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { label: "", placement: "bottom-start", "reference-element": "preview-update-button" }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, this.strings.updatePopover)), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { id: "preview-create-button", class: HTMLClasses.actionButton, kind: "neutral", appearance: "outline-fill", iconStart: "plus", dir: this.direction, onClick: this.createPreviewLayer, disabled: disableCreatePreview || this.previewLayerLoading, scale: _ui_utils_928a4096_js__WEBPACK_IMPORTED_MODULE_4__.U.Scale }, this.strings.newPreview), (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-tooltip", { label: "", placement: "bottom-start", "reference-element": "preview-create-button" }, (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", null, disableCreatePreview
            ? (0,_common_fda1462e_js__WEBPACK_IMPORTED_MODULE_15__.f)(this.strings.maxPreview, {
                maxCount: this.maxPreviewLayers.toString()
            })
            : this.strings.createPopover))));
    }
    render() {
        return ((0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { collapsible: true, heading: this.strings.header, description: this.strings.description, open: this.openBlockInitially, dir: this.direction }, this.renderPreviewSwitch(), this.showPreviewBlock && this.renderPreviewLayers(), this.showPreviewBlock && this.renderActions()));
    }
    static get assetsDirs() { return ["t9n"]; }
    get hostElement() { return (0,_index_da1b7138_js__WEBPACK_IMPORTED_MODULE_0__.a)(this); }
};
RFxPreview.style = rfxPreviewCss;



//# sourceMappingURL=rfx-preview.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js":
/*!*****************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/arcgis-raster-function-editor/dist/esm/ui-utils-928a4096.js ***!
  \*****************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CalciteScale),
/* harmony export */   U: () => (/* binding */ UIDefaults),
/* harmony export */   a: () => (/* binding */ CalciteOverlayPositioning)
/* harmony export */ });
const UIDefaults = {
    Scale: "s",
    PopoverTimer: 60
};
const CalciteScale = {
    s: "s",
    m: "m"
};
const CalciteOverlayPositioning = {
    absolute: "absolute",
    fixed: "fixed"
};



//# sourceMappingURL=ui-utils-928a4096.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXJjZ2lzLXJhc3Rlci1mdW5jdGlvbi1lZGl0b3JfLTZiZjJiOC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGVBQWU7QUFDMUIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQSxZQUFZLHdDQUF3QztBQUNwRCxZQUFZLFdBQVc7QUFDdkIsMENBQTBDLE9BQU8sR0FBRyxjQUFjO0FBQ2xFLGNBQWMsU0FBUyxJQUFJLElBQUk7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGtCQUFrQixtQkFBbUIsaUJBQWlCLGFBQWE7QUFDL0U7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixhQUFhLFFBQVE7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRWtHOztBQUVsRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN4Q3FIO0FBQ2hDO0FBQ2xEO0FBQzhCO0FBQ1I7QUFDb0I7QUFDZjtBQUNlO0FBQ2xCO0FBQ0Y7QUFDMUI7QUFDTztBQUNLO0FBQ1Y7QUFDVTtBQUM2QjtBQUNxQztBQUM5RTtBQUNFO0FBQ0E7QUFDTTtBQUNXO0FBQ1g7QUFDRDtBQUNPO0FBQ2tCO0FBQzVCOztBQUVuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNkJBQTZCLDhCQUE4QixvQ0FBb0Msb0NBQW9DLG9DQUFvQyx1Q0FBdUMsdUNBQXVDLHNDQUFzQyw0Q0FBNEMsNENBQTRDLG1DQUFtQyxxQ0FBcUMscUNBQXFDLHFDQUFxQywrQkFBK0IsK0JBQStCLCtCQUErQixxQ0FBcUMsa0NBQWtDLGlDQUFpQyxpQ0FBaUMsaUNBQWlDLHFDQUFxQyw4QkFBOEIs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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDJEQUFlO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxzREFBYTtBQUN2RDtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsc0RBQWE7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLFVBQVUseUNBQXlDLEVBQUUscURBQUMscUJBQXFCLCtMQUErTCxvREFBVSw0Q0FBNEMsd0JBQXdCLHFEQUFDLHNCQUFzQixvRkFBb0YsRUFBRSxxREFBQyw2Q0FBNkMscURBQUMscUJBQXFCLHdQQUF3UCxvREFBVSxRQUFRLDRCQUE0QixxREFBQyxzQkFBc0Isb0ZBQW9GLEVBQUUscURBQUM7QUFDOTZCLGNBQWMsdURBQWE7QUFDM0I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLG9CQUFvQiw0SUFBNEk7QUFDakw7QUFDQSw4QkFBOEI7QUFDOUIsd0JBQXdCLE9BQU8scURBQVU7QUFDekM7QUFDQTs7QUFFcUM7O0FBRXJDOzs7Ozs7Ozs7Ozs7Ozs7O0FDelNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFOEU7O0FBRTlFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXJjZ2lzLXJhc3Rlci1mdW5jdGlvbi1lZGl0b3IvZGlzdC9lc20vcG9ydGFsLWQ1MGQ4MzM0LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FyY2dpcy1yYXN0ZXItZnVuY3Rpb24tZWRpdG9yL2Rpc3QvZXNtL3JmeC1wcmV2aWV3LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FyY2dpcy1yYXN0ZXItZnVuY3Rpb24tZWRpdG9yL2Rpc3QvZXNtL3VpLXV0aWxzLTkyOGE0MDk2LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUmV0dXJucyBhIGJhc2UgdXJsIHRvIHBhc3MgdG8gdGhlIGl0ZW0gYnJvd3NlclxuICogVGFrZW4gZnJvbSBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtd2Vidmlld2VyLWFwcC9ibG9iL21hc3Rlci9zcmMvdXRpbHMvdXJsVXRpbHMudHMjTDEwNlxuICogQHBhcmFtIHtfX2VzcmkuUG9ydGFsfSBwb3J0YWwgcG9ydGFsIGluc3RhbmNlXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQgYmFzZVVybFxuICovXG5mdW5jdGlvbiBnZXRCYXNlVXJsKHBvcnRhbCkge1xuICAgIGNvbnN0IHsgY3VzdG9tQmFzZVVybCwgcG9ydGFsSG9zdG5hbWUsIHVybEtleSB9ID0gcG9ydGFsO1xuICAgIGNvbnN0IHsgcHJvdG9jb2wgfSA9IHdpbmRvdy5sb2NhdGlvbjtcbiAgICBjb25zdCB1cmwgPSB1cmxLZXkgIT09IHVuZGVmaW5lZCA/IGAke3VybEtleX0uJHtjdXN0b21CYXNlVXJsfWAgOiBwb3J0YWxIb3N0bmFtZTtcbiAgICByZXR1cm4gYCR7cHJvdG9jb2x9Ly8ke3VybH1gO1xufVxuLyoqXG4gKiBUbyBnZXQgdGhlIHJlbmRlcmluZyBzZXJ2aWNlIGJhc2UgdXJsIGJhc2VkIG9uIGFnb2wvZW50ZXJwcmlzZVxuICogQHBhcmFtIHBvcnRhbFxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gZ2V0UmVuZGVyaW5nU2VydmljZUJhc2VVcmwocG9ydGFsKSB7XG4gICAgY29uc3QgeyBoZWxwZXJTZXJ2aWNlczogeyByYXN0ZXJBbmFseXRpY3M6IHsgdXJsOiBHUFNlcnZlciB9IH0sIGlzUG9ydGFsIH0gPSBwb3J0YWw7XG4gICAgcmV0dXJuIGlzUG9ydGFsID8gR1BTZXJ2ZXIgOiBHUFNlcnZlci5yZXBsYWNlKFwicmFzdGVyYW5hbHlzaXNcIiwgXCJyYXN0ZXJ1dGlsc1wiKTtcbn1cbi8qKlxuICogZnVuY3Rpb24gdG8gZ2V0IHJlbmRlcmluZyBzZXJ2aWNlIHZhbGlkYXRlIHVybFxuICogQHBhcmFtIHtQb3J0YWx9IHBvcnRhbCBwb3J0YWwgaW5zdGFuY2VcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHVybCBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gZ2V0UmVuZGVyaW5nU2VydmljZVZhbGlkYXRlVXJsKHBvcnRhbCkge1xuICAgIHJldHVybiBnZXRSZW5kZXJpbmdTZXJ2aWNlQmFzZVVybChwb3J0YWwpLnJlcGxhY2UoXCJSYXN0ZXJBbmFseXNpc1Rvb2xzL0dQU2VydmVyXCIsIFwiUmFzdGVyUmVuZGVyaW5nL0ltYWdlU2VydmVyL3ZhbGlkYXRlXCIpO1xufVxuLyoqXG4gKiBmdW5jdGlvbiB0byBnZXQgcmVuZGVyaW5nIHNlcnZpY2UgaW1hZ2Ugc2VydmljZSB1cmxcbiAqIEBwYXJhbSB7UG9ydGFsfSBwb3J0YWwgcG9ydGFsIGluc3RhbmNlXG4gKiBAcmV0dXJucyB7c3RyaW5nfSB1cmwgc3RyaW5nXG4gKi9cbmZ1bmN0aW9uIGdldFJlbmRlcmluZ0ltYWdlU2VydmljZVVybChwb3J0YWwpIHtcbiAgICByZXR1cm4gZ2V0UmVuZGVyaW5nU2VydmljZUJhc2VVcmwocG9ydGFsKS5yZXBsYWNlKFwiUmFzdGVyQW5hbHlzaXNUb29scy9HUFNlcnZlclwiLCBcIlJhc3RlclJlbmRlcmluZy9JbWFnZVNlcnZlclwiKTtcbn1cblxuZXhwb3J0IHsgZ2V0UmVuZGVyaW5nU2VydmljZVZhbGlkYXRlVXJsIGFzIGEsIGdldFJlbmRlcmluZ0ltYWdlU2VydmljZVVybCBhcyBiLCBnZXRCYXNlVXJsIGFzIGcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cG9ydGFsLWQ1MGQ4MzM0LmpzLm1hcCIsImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgZyBhcyBnZXRBc3NldFBhdGgsIGEgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtZGExYjcxMzguanMnO1xuaW1wb3J0IHsgYiBhcyBmZXRjaENvbXBvbmVudExvY2FsZVN0cmluZ3MgfSBmcm9tICcuL2xvY2FsaXphdGlvbi1oZWxwZXItNDgxOWI2N2QuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvY29yZS9sYW5nLmpzJztcbmltcG9ydCB7IGkgYXMgaXNFbXB0eURhdGFJdGVtIH0gZnJvbSAnLi90eXBlLWdhdXJkcy0xODQwNzQ3Zi5qcyc7XG5pbXBvcnQgeyBVIGFzIFVJRGVmYXVsdHMgfSBmcm9tICcuL3VpLXV0aWxzLTkyOGE0MDk2LmpzJztcbmltcG9ydCB7IGQgYXMgZ2V0SGVscFRlbXBsYXRlRm9ySW5mb01lc3NhZ2UgfSBmcm9tICcuL2hlbHAtdGV4dC0zNGEyOTgzNS5qcyc7XG5pbXBvcnQgeyBQIGFzIFByZXZpZXdTdGF0dXMgfSBmcm9tICcuL2ludGVyZmFjZXMtZDBjNjg5NDQuanMnO1xuaW1wb3J0IHsgbyBhcyBjcmVhdGVSYXN0ZXJSZW5kZXJpbmdMYXllciB9IGZyb20gJy4vbGF5ZXItaGVscGVyLTM4NjdlZWY3LmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL3Jlc3Qvc3VwcG9ydC9BbGdvcml0aG1pY0NvbG9yUmFtcC5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9yZXN0L3N1cHBvcnQvTXVsdGlwYXJ0Q29sb3JSYW1wLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL0NvbG9yLmpzJztcbmltcG9ydCAnLi9jb2xvclJhbXBVdGlscy04YmRkNDZjNS5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9yZXN0L2dlb3Byb2Nlc3Nvci5qcyc7XG5pbXBvcnQgJ0BhcmNnaXMvY29yZS9yZXF1ZXN0LmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL3BvcnRhbC9Qb3J0YWxJdGVtLmpzJztcbmltcG9ydCB7IGYgYXMgZm9ybWF0TWVzc2FnZSwgciBhcyByZXF1ZXN0IH0gZnJvbSAnLi9jb21tb24tZmRhMTQ2MmUuanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRSZW5kZXJpbmdTZXJ2aWNlVmFsaWRhdGVVcmwsIGIgYXMgZ2V0UmVuZGVyaW5nSW1hZ2VTZXJ2aWNlVXJsIH0gZnJvbSAnLi9wb3J0YWwtZDUwZDgzMzQuanMnO1xuaW1wb3J0ICcuL19nZXRUYWctOTZhZjAyOWQuanMnO1xuaW1wb3J0ICcuL3Jlc291cmNlcy0yN2M2NmY1Yy5qcyc7XG5pbXBvcnQgJy4vZnVuY3Rpb25zLWYxZjJkZmZkLmpzJztcbmltcG9ydCAnLi9yZngtYXJncy1oZWxwZXItYWI0MDE1NDMuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvaWRlbnRpdHkvSWRlbnRpdHlNYW5hZ2VyLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL2NvcmUvdXJsVXRpbHMuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvbGF5ZXJzL0xheWVyLmpzJztcbmltcG9ydCAnQGFyY2dpcy9jb3JlL2xheWVycy9JbWFnZXJ5TGF5ZXIuanMnO1xuaW1wb3J0ICdAYXJjZ2lzL2NvcmUvc21hcnRNYXBwaW5nL3Jhc3Rlci9yZW5kZXJlcnMvc3RyZXRjaC5qcyc7XG5pbXBvcnQgJy4vX1VpbnQ4QXJyYXktNjhlMWUzZjkuanMnO1xuXG5jb25zdCBIVE1MQ2xhc3NlcyA9IHtcbiAgICBhY3Rpb25CdXR0b25Db3RhaW5lcjogXCJhY3Rpb24tYnV0dG9uLWNvbnRhaW5lclwiLFxuICAgIGFjdGlvbkJ1dHRvbjogXCJhY3Rpb24tYnV0dG9uXCIsXG4gICAgcHJldmlld0xpc3Q6IFwicHJldmlldy1saXN0XCIsXG4gICAgaGVscEFjdGlvbjogXCJoZWxwLWFjdGlvblwiXG59O1xuXG5jb25zdCByZnhQcmV2aWV3Q3NzID0gXCI6cm9vdHstLWNhbGNpdGUtY29sb3ItYnJhbmQ6IzAwN2FjMjstLWNhbGNpdGUtY29sb3ItYnJhbmQtaG92ZXI6IzAwNjE5YjstLWNhbGNpdGUtY29sb3ItYnJhbmQtcHJlc3M6IzAwNDg3NDstLWNhbGNpdGUtY29sb3Itc3RhdHVzLWluZm86IzAwNjE5YjstLWNhbGNpdGUtY29sb3Itc3RhdHVzLXN1Y2Nlc3M6IzM1YWM0NjstLWNhbGNpdGUtY29sb3Itc3RhdHVzLXdhcm5pbmc6I2VkZDMxNzstLWNhbGNpdGUtY29sb3Itc3RhdHVzLWRhbmdlcjojZDgzMDIwOy0tY2FsY2l0ZS1jb2xvci1zdGF0dXMtZGFuZ2VyLWhvdmVyOiNhODJiMWU7LS1jYWxjaXRlLWNvbG9yLXN0YXR1cy1kYW5nZXItcHJlc3M6IzdjMWQxMzstLWNhbGNpdGUtY29sb3ItYmFja2dyb3VuZDojZjhmOGY4Oy0tY2FsY2l0ZS1jb2xvci1mb3JlZ3JvdW5kLTE6I2ZmZmZmZjstLWNhbGNpdGUtY29sb3ItZm9yZWdyb3VuZC0yOiNmM2YzZjM7LS1jYWxjaXRlLWNvbG9yLWZvcmVncm91bmQtMzojZWFlYWVhOy0tY2FsY2l0ZS1jb2xvci10ZXh0LTE6IzE1MTUxNTstLWNhbGNpdGUtY29sb3ItdGV4dC0yOiM0YTRhNGE7LS1jYWxjaXRlLWNvbG9yLXRleHQtMzojNmE2YTZhOy0tY2FsY2l0ZS1jb2xvci10ZXh0LWludmVyc2U6I2ZmZmZmZjstLWNhbGNpdGUtY29sb3ItdGV4dC1saW5rOiMwMDYxOWI7LS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xOiNjYWNhY2E7LS1jYWxjaXRlLWNvbG9yLWJvcmRlci0yOiNkNGQ0ZDQ7LS1jYWxjaXRlLWNvbG9yLWJvcmRlci0zOiNkZmRmZGY7LS1jYWxjaXRlLWNvbG9yLWJvcmRlci1pbnB1dDojOTQ5NDk0Oy0tcmZ4LXF1YXJ0ZXItc3BhY2luZzowLjI1cmVtOy0tcmZ4LWhhbGYtc3BhY2luZzowLjVyZW07LS1yZngtdGhyZWUtcXVhcnRlci1zcGFjaW5nOjAuNzVyZW07LS1yZngtZnVsbC1zcGFjaW5nOjFyZW07LS1yZngtY29tcG9uZW50LWRlZmF1bHQtd2lkdGg6MTAwJTstLXJmeC11aS1ib3JkZXItaW5wdXQ6dmFyKC0tY2FsY2l0ZS1jb2xvci1ib3JkZXItMik7LS1yZngtcG9wb3Zlci1jb250ZW50LW1pbi1oZWlnaHQ6MzB2aDstLXJmeC1wb3BvdmVyLWNvbnRlbnQtbWF4LWhlaWdodDo2MHZoOy0tcmZ4LXBvcG92ZXItY29udGVudC1oZWlnaHQ6NDV2aDstLXJmeC13aWRnZXQtY29udGVudC1oZWlnaHQ6MzB2aH0uYWN0aW9uLWJ1dHRvbi1jb250YWluZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVufS5hY3Rpb24tYnV0dG9ue3dpZHRoOjQ4JX0ucHJldmlldy1saXN0e3BhZGRpbmc6dmFyKC0tcmZ4LWZ1bGwtc3BhY2luZykgMCB2YXIoLS1yZngtZnVsbC1zcGFjaW5nKSAwfS5oZWxwLWFjdGlvbnstd2Via2l0LW1hcmdpbi1zdGFydDphdXRvO21hcmdpbi1pbmxpbmUtc3RhcnQ6YXV0b31cIjtcblxuY29uc3QgUkZ4UHJldmlldyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMucmZ4UHJldmlld1NlbGVjdGlvbiA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwicmZ4UHJldmlld1NlbGVjdGlvblwiLCA3KTtcbiAgICAgICAgdGhpcy5wcmV2aWV3SGVscENsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJwcmV2aWV3SGVscENsaWNrXCIsIDcpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQ29udHJvbHMgb3BlbmluZyB0aGUgcHJldmlldyBkZXRhaWxzIGJsb2NrIG9uIGxvYWRcbiAgICAgICAgICogQGNhdGVnb3J5IFByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub3BlbkJsb2NrSW5pdGlhbGx5ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tYXhQcmV2aWV3TGF5ZXJzID0gNTtcbiAgICAgICAgdGhpcy5wcmV2aWV3SW5kZXhDb3VudGVyID0gMTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGhhbmRsZXMgdGhlIGNyZWF0ZSBwcmV2aWV3IGxheWVyIHdvcmtmbG93XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNyZWF0ZVByZXZpZXdMYXllciA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkVG9QcmV2aWV3TGF5ZXJMaXN0KCk7XG4gICAgICAgICAgICB0aGlzLmxvYWRQcmV2aWV3TGF5ZXIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZXMgYW5kIHNob3cgcHJldmlldyBpZiB0aGUgaWYgc3dpdGNoIGlzIGNoZWNrZWQuIFJlbW92ZSBwcmV2aWV3IGlmIGl0cyB1bmNoZWNrZWRcbiAgICAgICAgICogQHBhcmFtIGV2ZW50IFByZXZpZXcgc3dpdGNoIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhhbmRsZVByZXZpZXdTd2l0Y2hDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICBjb25zdCBjaGVja2VkID0gZWxlbWVudC5jaGVja2VkO1xuICAgICAgICAgICAgdGhpcy5zaG93UHJldmlld0Jsb2NrID0gY2hlY2tlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dQcmV2aWV3QmxvY2sgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlUHJldmlld0xheWVycygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldmlld0xheWVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9pZiBubyBsYXllcnMgYXJlIHRoZXJlLCBhZGQgYSBsYXllciBieSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlUHJldmlld0xheWVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJmeFByZXZpZXdTZWxlY3Rpb24uZW1pdCh0aGlzLmdldFNlbGVjdGVkUHJldmlld0xpc3RJdGVtKCkuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFByZXZpZXdMYXllcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSB0aGUgc2VsZWN0ZWQgcHJldmlldyBsYXllciB3aXRoIGN1cnJlbnQgcGFyYW1zIGZyb20gdGhlIGVkaXRvciBhcHBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXBkYXRlUHJldmlld0xheWVyID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZERhdGEgPSBhd2FpdCB0aGlzLmdldFRlbXBsYXRlKCk7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdMYXllcnMuZm9yRWFjaCgobGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobGF5ZXIuaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRQcmV2aWV3TGF5ZXJJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBsYXllci5kYXRhID0gdXBkYXRlZERhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmxvYWRQcmV2aWV3TGF5ZXIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgcHJldmlldyBmb3IgdGhlIHNlbGVjdGVkIHByZXZpZXcgbGF5ZXIgYW5kIGxvYWQgZWRpdG9yIHdpdGggdGhlIGFyZyB2YWx1ZXMgd2l0aCB3aGljaCB0aGUgcHJldmlldyB3YXMgY3JlYXRlZFxuICAgICAgICAgKiBAcGFyYW0gZXZlbnQgRXZlbnQgZW1pdHRlZCB3aGVuIGEgcHJldmlldyBsYXllciBpcyBzZWxlY3RlZCBmcm9tIHRoZSBsaXN0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9uUHJldmlld1NlbGVjdCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oaWRlUHJldmlld0xheWVycygpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByZXZpZXdMYXllckluZGV4ID0gZXZlbnQudGFyZ2V0Py52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucmZ4UHJldmlld1NlbGVjdGlvbi5lbWl0KHRoaXMuZ2V0U2VsZWN0ZWRQcmV2aWV3TGlzdEl0ZW0oKS5kYXRhKTtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2VsZWN0ZWRQcmV2aWV3TGlzdEl0ZW0oKS5sYXllci52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZXMgdGhlIGl0ZW0gZnJvbSB0aGUgbGlzdCBhbmQgYWxzbyByZW1vdmUgdGhlIHByZXZpZXcgZnJvbSB0aGUgbWFwXG4gICAgICAgICAqIEBwYXJhbSBldmVudCBFdmVudCBlbWl0dGVkIHdoZW4gdGhlIHByZXZpZXcgaXRlbSBpcyBjbG9zZWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub25QcmV2aWV3Q2xvc2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlZFByZXZpZXdJbmRleCA9IGV2ZW50LnRhcmdldD8udmFsdWU7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZVByZXZpZXdMYXllckZyb21NYXAodGhpcy5wcmV2aWV3TGF5ZXJzLmZpbmQoKHByZXZMYXllcikgPT4gcHJldkxheWVyLmluZGV4ID09PSBjbG9zZWRQcmV2aWV3SW5kZXgpLmxheWVyKTtcbiAgICAgICAgICAgIHRoaXMucHJldmlld0xheWVycyA9IHRoaXMucHJldmlld0xheWVycy5maWx0ZXIoKGxheWVyKSA9PiBsYXllci5pbmRleCAhPT0gY2xvc2VkUHJldmlld0luZGV4KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXZpZXdMYXllcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93UHJldmlld0Jsb2NrID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgdGhlIGVycm9yIGljb24gd2hlbiB0aGUgcHJldmlldyBmYWlsIHRvIGxvYWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVuZGVyUHJldmlld0Vycm9yID0gKGluZGV4KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnQtZW5kXCIgfSwgaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgaWQ6IGBwcmV2aWV3LWxheWVyLWxvYWQtZXJyb3ItJHtpbmRleH1gLCBpY29uU3RhcnQ6IFwiZXhjbGFtYXRpb24tbWFyay10cmlhbmdsZVwiLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIGtpbmQ6IFwibmV1dHJhbFwiLCBzY2FsZTogVUlEZWZhdWx0cy5TY2FsZSB9KSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IGxhYmVsOiBcInByZXZpZXcgZmFpbGVkIHRvIGxvYWRcIiwgXCJyZWZlcmVuY2UtZWxlbWVudFwiOiBgcHJldmlldy1sYXllci1sb2FkLWVycm9yLSR7aW5kZXh9YCB9LCBoKFwic3BhblwiLCBudWxsLCB0aGlzLnN0cmluZ3MucHJldmlld0Vycm9yKSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciB0aGUgcHJldmlldyBsYXllciBsaXN0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlbmRlclByZXZpZXdMYXllcnMgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3RcIiwgeyBjbGFzczogSFRNTENsYXNzZXMucHJldmlld0xpc3QsIGxvYWRpbmc6IHRoaXMucHJldmlld0xheWVyTG9hZGluZywgc2VsZWN0aW9uQXBwZWFyYW5jZTogXCJib3JkZXJcIiwgc2VsZWN0aW9uTW9kZTogXCJzaW5nbGVcIiwgZGlyOiB0aGlzLmRpcmVjdGlvbiB9LCB0aGlzLnByZXZpZXdMYXllcnMubWFwKChwcmV2aWV3TGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWxpc3QtaXRlbVwiLCB7IGtleTogYHByZXZpZXctbGF5ZXItaXRlbSR7cHJldmlld0xheWVyLmluZGV4fWAsIGlkOiBgcHJldmlldy1sYXllci1pdGVtJHtwcmV2aWV3TGF5ZXIuaW5kZXh9YCwgZGlyOiB0aGlzLmRpcmVjdGlvbiwgbGFiZWw6IHByZXZpZXdMYXllci5sYWJlbCwgdmFsdWU6IHByZXZpZXdMYXllci5pbmRleCwgc2VsZWN0ZWQ6IHByZXZpZXdMYXllci5pbmRleCA9PT0gdGhpcy5zZWxlY3RlZFByZXZpZXdMYXllckluZGV4LCBjbG9zYWJsZTogdHJ1ZSwgb25DYWxjaXRlTGlzdEl0ZW1TZWxlY3Q6IHRoaXMub25QcmV2aWV3U2VsZWN0LCBvbkNhbGNpdGVMaXN0SXRlbUNsb3NlOiB0aGlzLm9uUHJldmlld0Nsb3NlIH0sIHByZXZpZXdMYXllci5zdGF0dXMgPT09IFByZXZpZXdTdGF0dXMuZXJyb3IgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJQcmV2aWV3RXJyb3IocHJldmlld0xheWVyLmluZGV4KSkpO1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHJlbmRlciB0aGUgc3dpdGNoIGJ1dHRvbiB0byBlbmFibGUgYW5kIGRpc2FibGUgcHJldmlld1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZW5kZXJQcmV2aWV3U3dpdGNoID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGRpcjogdGhpcy5kaXJlY3Rpb24sIGxheW91dDogXCJpbmxpbmVcIiwgc2NhbGU6IFVJRGVmYXVsdHMuU2NhbGUsIHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1ByZXZpZXdFbGVtZW50ID0gZWw7XG4gICAgICAgICAgICAgICAgfSB9LCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwge1xuICAgICAgICAgICAgICAgIC8vIHNjYWxlPXtVSURlZmF1bHRzLlNjYWxlfVxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6IHRoaXMuc2hvd1ByZXZpZXdCbG9jaywgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiB0aGlzLmhhbmRsZVByZXZpZXdTd2l0Y2hDaGFuZ2UsIGRpcjogdGhpcy5kaXJlY3Rpb24sIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlXG4gICAgICAgICAgICB9KSwgdGhpcy5zdHJpbmdzLnNob3dQcmV2aWV3LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBjbGFzczogSFRNTENsYXNzZXMuaGVscEFjdGlvbiwgdGV4dDogXCJzaG93IGhlbHBcIiwgaWNvbjogXCJpbmZvcm1hdGlvblwiLCBzY2FsZTogVUlEZWZhdWx0cy5TY2FsZSwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVscFRleHQgPSBnZXRIZWxwVGVtcGxhdGVGb3JJbmZvTWVzc2FnZSh0aGlzLnN0cmluZ3MucHJldmlld1BvcHVwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3SGVscENsaWNrLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlRWxlbWVudDogdGhpcy5zaG93UHJldmlld0VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWxwU3JjZG9jOiBoZWxwVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMuc3RyaW5ncy5zaG93UHJldmlld1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IH0pKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJldmlld0xheWVycyA9IFtdO1xuICAgICAgICB0aGlzLnNob3dQcmV2aWV3QmxvY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcmV2aWV3TGF5ZXJMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWFwVmlldyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5nZXRUZW1wbGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgKHsgc3RyaW5nczogdGhpcy5zdHJpbmdzLCBkaXI6IHRoaXMuZGlyZWN0aW9uIH0gPSBhd2FpdCBmZXRjaENvbXBvbmVudExvY2FsZVN0cmluZ3ModGhpcy5ob3N0RWxlbWVudCwgZ2V0QXNzZXRQYXRoKFwiLlwiKSkpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVQcmV2aWV3TGF5ZXJGcm9tTWFwKHRoaXMuZ2V0U2VsZWN0ZWRQcmV2aWV3TGlzdEl0ZW0oKT8ubGF5ZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgdG8gdGhlIGxpc3QgdG8gcHJldmlldyBsYXllcnNcbiAgICAgKi9cbiAgICBhc3luYyBhZGRUb1ByZXZpZXdMYXllckxpc3QoKSB7XG4gICAgICAgIGNvbnN0IHJmeFRlbXBsYXRlID0gYXdhaXQgdGhpcy5nZXRUZW1wbGF0ZSgpO1xuICAgICAgICBjb25zdCB7IHByZXZpZXdJbmRleENvdW50ZXI6IGN1cnJlbnRJbmRleCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5wcmV2aWV3TGF5ZXJzLnB1c2goe1xuICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRJbmRleCxcbiAgICAgICAgICAgIGxhYmVsOiBmb3JtYXRNZXNzYWdlKHRoaXMuc3RyaW5ncy5wcmV2aWV3TGF5ZXIsIHsgbnVtYmVyOiBjdXJyZW50SW5kZXgudG9TdHJpbmcoKSB9KSxcbiAgICAgICAgICAgIGRhdGE6IHJmeFRlbXBsYXRlLFxuICAgICAgICAgICAgc3RhdHVzOiBQcmV2aWV3U3RhdHVzLmxvYWRpbmdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRQcmV2aWV3TGF5ZXJJbmRleCA9IGN1cnJlbnRJbmRleDtcbiAgICAgICAgdGhpcy5wcmV2aWV3SW5kZXhDb3VudGVyKys7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIFJGVCB1c2luZyByZW5kZXJpbmcgc2VydmljZVxuICAgICAqIEBwYXJhbSB7cmZ4VGVtcGxhdGV9IHRlbXBsYXRlIHdoaWNoIHNob3VsZCBiZSB2YWxpZGF0ZWRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gYm9vbGVhbiB2YWx1ZSBpZiB0aGUgdGVtcGxhdGUgaXMgdmFsaWQgb3Igbm90XG4gICAgICovXG4gICAgdmFsaWRhdGVSRlQocmZ4VGVtcGxhdGUpIHtcbiAgICAgICAgaWYgKGlzRW1wdHlEYXRhSXRlbShyZnhUZW1wbGF0ZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYXN0ZXJSZW5kZXJpbmdTZXJ2aWNlID0gZ2V0UmVuZGVyaW5nU2VydmljZVZhbGlkYXRlVXJsKHRoaXMucG9ydGFsKTtcbiAgICAgICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICAgICAgICByZW5kZXJpbmdSdWxlOiBKU09OLnN0cmluZ2lmeShyZnhUZW1wbGF0ZSksXG4gICAgICAgICAgICBmOiBcImpzb25cIlxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcmVxdWVzdChyYXN0ZXJSZW5kZXJpbmdTZXJ2aWNlLCB7IHF1ZXJ5IH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U/LmRhdGE/LnJlbmRlcmluZ1J1bGU/LmlzVmFsaWQ7XG4gICAgICAgIH0sICh2YWxpZGF0ZUZhaWwpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidmFsaWRhdGUgcmVxdWVzdCBmYWlsZWRcIiwgdmFsaWRhdGVGYWlsKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvIHJlbW92ZSBwcmV2aWV3IGxheWVyIGZyb20gdGhlIG1hcFxuICAgICAqL1xuICAgIHJlbW92ZVByZXZpZXdMYXllckZyb21NYXAocHJldmlld0xheWVyKSB7XG4gICAgICAgIGlmIChpc0VtcHR5RGF0YUl0ZW0ocHJldmlld0xheWVyKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHByZXZpZXdMYXllci5vcGFjaXR5ID0gMDtcbiAgICAgICAgdGhpcy5tYXBWaWV3Lm1hcC5yZW1vdmUocHJldmlld0xheWVyKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVG8gYWRkIHByZXZpZXcgbGF5ZXIgdG8gdGhlIG1hcCB1c2luZyByYXN0ZXIgcmVuZGVyaW5nIHNlcnZpY2VcbiAgICAgKiB3aG9zZSByYXN0ZXIgdmFsdWUgaXMgcmZ4VGVtcGxhdGUgaW4gYmFzZTY0IGZvcm1hdFxuICAgICAqIEBwYXJhbSByZnhUZW1wbGF0ZSB0ZW1wbGF0ZSB3aXRoIHdoaWNoIHRoZSByZW5kZXJpbmcgc2VydmljZSBzaG91bGQgYmUgY3JlYXRlZFxuICAgICAqL1xuICAgIGFkZFByZXZpZXdMYXllclRvTWFwKHJmeFRlbXBsYXRlKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkUHJldmlldyA9IHRoaXMuZ2V0U2VsZWN0ZWRQcmV2aWV3TGlzdEl0ZW0oKTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBjcmVhdGVSYXN0ZXJSZW5kZXJpbmdMYXllcihnZXRSZW5kZXJpbmdJbWFnZVNlcnZpY2VVcmwodGhpcy5wb3J0YWwpLCByZnhUZW1wbGF0ZSk7XG4gICAgICAgIC8vVE9ETzogbmVlZCB0byBjaGVjayAzeCB3aHkgYW5kIGhvdyB0aGlzIGlzIHdvcmtpbmdcbiAgICAgICAgLy8gaWYgKFxuICAgICAgICAvLyAgIHJmeFRlbXBsYXRlLmZ1bmN0aW9uPy50eXBlID09PSBcIkxvY2FsRnVuY3Rpb25cIiAmJlxuICAgICAgICAvLyAgIGJpbkZ1bmN0aW9ucy5pbmRleE9mKHJmeFRlbXBsYXRlLmZ1bmN0aW9uLm5hbWUpID4gLTFcbiAgICAgICAgLy8gKSB7XG4gICAgICAgIC8vICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlU3RyZWN0aFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgLy8gICBsYXllci5yZW5kZXJlciA9IHJlc3VsdC5yZW5kZXJlcjtcbiAgICAgICAgLy8gfVxuICAgICAgICBsYXllclxuICAgICAgICAgICAgLmxvYWQoKVxuICAgICAgICAgICAgLmNhdGNoKCgpID0+IChzZWxlY3RlZFByZXZpZXcuc3RhdHVzID0gUHJldmlld1N0YXR1cy5lcnJvcikpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBzZWxlY3RlZFByZXZpZXcubGF5ZXIgPSBsYXllcjtcbiAgICAgICAgICAgIHRoaXMubWFwVmlldy5tYXAuYWRkKGxheWVyKTtcbiAgICAgICAgICAgIHRoaXMubWFwVmlldy53aGVuTGF5ZXJWaWV3KGxheWVyKS50aGVuKChsYXllclZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICBsYXllclZpZXcud2F0Y2goXCJ1cGRhdGluZ1wiLCAoc3RhdHVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlld0xheWVyTG9hZGluZyA9IHN0YXR1cztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGlkZSBhbGwgdGhlIHByZXZpZXcgbGF5ZXJzIGluIHRoZSBtYXBcbiAgICAgKi9cbiAgICBoaWRlUHJldmlld0xheWVycygpIHtcbiAgICAgICAgdGhpcy5wcmV2aWV3TGF5ZXJzLmZvckVhY2goKHByZXZpZXdMYXllcikgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc0VtcHR5RGF0YUl0ZW0ocHJldmlld0xheWVyLmxheWVyKSkge1xuICAgICAgICAgICAgICAgIHByZXZpZXdMYXllci5sYXllci52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSBzZWxlY3RlZFByZXZpZXcgbGF5ZXIgb3Igb3RoZXJ3aXNlIHRoZSBsYXN0IG9uZSBpbiB0aGUgbGlzdFxuICAgICAqL1xuICAgIGFzeW5jIGxvYWRQcmV2aWV3TGF5ZXIoKSB7XG4gICAgICAgIHRoaXMucHJldmlld0xheWVyTG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuaGlkZVByZXZpZXdMYXllcnMoKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcmV2aWV3TGF5ZXIgPSB0aGlzLmdldFNlbGVjdGVkUHJldmlld0xpc3RJdGVtKCk7XG4gICAgICAgIGNvbnN0IHJmeFRlbXBsYXRlID0gc2VsZWN0ZWRQcmV2aWV3TGF5ZXIuZGF0YTtcbiAgICAgICAgc2VsZWN0ZWRQcmV2aWV3TGF5ZXIuaXNWYWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVSRlQocmZ4VGVtcGxhdGUpO1xuICAgICAgICBpZiAoc2VsZWN0ZWRQcmV2aWV3TGF5ZXIuaXNWYWxpZCkge1xuICAgICAgICAgICAgc2VsZWN0ZWRQcmV2aWV3TGF5ZXIuc3RhdHVzID0gUHJldmlld1N0YXR1cy5zdWNjZXNzO1xuICAgICAgICAgICAgdGhpcy5hZGRQcmV2aWV3TGF5ZXJUb01hcChyZnhUZW1wbGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZWxlY3RlZFByZXZpZXdMYXllci5zdGF0dXMgPSBQcmV2aWV3U3RhdHVzLmVycm9yO1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3TGF5ZXJMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2l2ZXMgdGhlIHNlbGVjdGVkIHByZXZpZXdsaXN0IGl0ZW1cbiAgICAgKiBAcmV0dXJucyA8UHJldmlld0xpc3Q+XG4gICAgICovXG4gICAgZ2V0U2VsZWN0ZWRQcmV2aWV3TGlzdEl0ZW0oKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUHJldmlld0xheWVySW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJldmlld0xheWVyc1swXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5wcmV2aWV3TGF5ZXJzLmZpbmQoKHByZXZpZXdMYXllcikgPT4gcHJldmlld0xheWVyLmluZGV4ID09PSB0aGlzLnNlbGVjdGVkUHJldmlld0xheWVySW5kZXgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW5kZXIgdGhlIGFjdGlvbiBidXR0b25zIHVwZGF0ZSBhbmQgbmV3IHByZXZpZXdcbiAgICAgKi9cbiAgICByZW5kZXJBY3Rpb25zKCkge1xuICAgICAgICBjb25zdCBkaXNhYmxlQ3JlYXRlUHJldmlldyA9IHRoaXMucHJldmlld0xheWVycy5sZW5ndGggPT09IHRoaXMubWF4UHJldmlld0xheWVycztcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IEhUTUxDbGFzc2VzLmFjdGlvbkJ1dHRvbkNvdGFpbmVyIH0sIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGlkOiBcInByZXZpZXctdXBkYXRlLWJ1dHRvblwiLCBjbGFzczogSFRNTENsYXNzZXMuYWN0aW9uQnV0dG9uLCBraW5kOiBcIm5ldXRyYWxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgaWNvblN0YXJ0OiBcInJlZnJlc2hcIiwgb25DbGljazogdGhpcy51cGRhdGVQcmV2aWV3TGF5ZXIsIGRpcjogdGhpcy5kaXJlY3Rpb24sIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlLCBkaXNhYmxlZDogdGhpcy5wcmV2aWV3TGF5ZXJMb2FkaW5nIH0sIHRoaXMuc3RyaW5ncy51cGRhdGUpLCBoKFwiY2FsY2l0ZS10b29sdGlwXCIsIHsgbGFiZWw6IFwiXCIsIHBsYWNlbWVudDogXCJib3R0b20tc3RhcnRcIiwgXCJyZWZlcmVuY2UtZWxlbWVudFwiOiBcInByZXZpZXctdXBkYXRlLWJ1dHRvblwiIH0sIGgoXCJzcGFuXCIsIG51bGwsIHRoaXMuc3RyaW5ncy51cGRhdGVQb3BvdmVyKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGlkOiBcInByZXZpZXctY3JlYXRlLWJ1dHRvblwiLCBjbGFzczogSFRNTENsYXNzZXMuYWN0aW9uQnV0dG9uLCBraW5kOiBcIm5ldXRyYWxcIiwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgaWNvblN0YXJ0OiBcInBsdXNcIiwgZGlyOiB0aGlzLmRpcmVjdGlvbiwgb25DbGljazogdGhpcy5jcmVhdGVQcmV2aWV3TGF5ZXIsIGRpc2FibGVkOiBkaXNhYmxlQ3JlYXRlUHJldmlldyB8fCB0aGlzLnByZXZpZXdMYXllckxvYWRpbmcsIHNjYWxlOiBVSURlZmF1bHRzLlNjYWxlIH0sIHRoaXMuc3RyaW5ncy5uZXdQcmV2aWV3KSwgaChcImNhbGNpdGUtdG9vbHRpcFwiLCB7IGxhYmVsOiBcIlwiLCBwbGFjZW1lbnQ6IFwiYm90dG9tLXN0YXJ0XCIsIFwicmVmZXJlbmNlLWVsZW1lbnRcIjogXCJwcmV2aWV3LWNyZWF0ZS1idXR0b25cIiB9LCBoKFwic3BhblwiLCBudWxsLCBkaXNhYmxlQ3JlYXRlUHJldmlld1xuICAgICAgICAgICAgPyBmb3JtYXRNZXNzYWdlKHRoaXMuc3RyaW5ncy5tYXhQcmV2aWV3LCB7XG4gICAgICAgICAgICAgICAgbWF4Q291bnQ6IHRoaXMubWF4UHJldmlld0xheWVycy50b1N0cmluZygpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiB0aGlzLnN0cmluZ3MuY3JlYXRlUG9wb3ZlcikpKSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNvbGxhcHNpYmxlOiB0cnVlLCBoZWFkaW5nOiB0aGlzLnN0cmluZ3MuaGVhZGVyLCBkZXNjcmlwdGlvbjogdGhpcy5zdHJpbmdzLmRlc2NyaXB0aW9uLCBvcGVuOiB0aGlzLm9wZW5CbG9ja0luaXRpYWxseSwgZGlyOiB0aGlzLmRpcmVjdGlvbiB9LCB0aGlzLnJlbmRlclByZXZpZXdTd2l0Y2goKSwgdGhpcy5zaG93UHJldmlld0Jsb2NrICYmIHRoaXMucmVuZGVyUHJldmlld0xheWVycygpLCB0aGlzLnNob3dQcmV2aWV3QmxvY2sgJiYgdGhpcy5yZW5kZXJBY3Rpb25zKCkpKTtcbiAgICB9XG4gICAgc3RhdGljIGdldCBhc3NldHNEaXJzKCkgeyByZXR1cm4gW1widDluXCJdOyB9XG4gICAgZ2V0IGhvc3RFbGVtZW50KCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcblJGeFByZXZpZXcuc3R5bGUgPSByZnhQcmV2aWV3Q3NzO1xuXG5leHBvcnQgeyBSRnhQcmV2aWV3IGFzIHJmeF9wcmV2aWV3IH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJmeC1wcmV2aWV3LmVudHJ5LmpzLm1hcCIsImNvbnN0IFVJRGVmYXVsdHMgPSB7XG4gICAgU2NhbGU6IFwic1wiLFxuICAgIFBvcG92ZXJUaW1lcjogNjBcbn07XG5jb25zdCBDYWxjaXRlU2NhbGUgPSB7XG4gICAgczogXCJzXCIsXG4gICAgbTogXCJtXCJcbn07XG5jb25zdCBDYWxjaXRlT3ZlcmxheVBvc2l0aW9uaW5nID0ge1xuICAgIGFic29sdXRlOiBcImFic29sdXRlXCIsXG4gICAgZml4ZWQ6IFwiZml4ZWRcIlxufTtcblxuZXhwb3J0IHsgQ2FsY2l0ZVNjYWxlIGFzIEMsIFVJRGVmYXVsdHMgYXMgVSwgQ2FsY2l0ZU92ZXJsYXlQb3NpdGlvbmluZyBhcyBhIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXVpLXV0aWxzLTkyOGE0MDk2LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==