"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-6bf2b8"],{5660:(e,t,r)=>{r.d(t,{a:()=>C,b:()=>T,c:()=>k,d:()=>E,e:()=>$,f:()=>_,g:()=>R,h:()=>O,i:()=>A,j:()=>B,k:()=>U,l:()=>F,n:()=>M,o:()=>V});var i=r(46574),a=r(34319),n=r(46717),s=r(55139),o=r(57098),c=(r(78979),r(95876)),l=r(77162),d=r(53248),h=r(32804),u=r(48363),v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/;function w(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var i=arguments,a=t?t.apply(this,i):i[0],n=r.cache;if(n.has(a))return n.get(a);var s=e.apply(this,i);return r.cache=n.set(a,s)||n,s};return r.cache=new(w.Cache||h.M),r}w.Cache=h.M;var f,y,m,g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,P=/\\(\\)?/g,L=(f=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(g,(function(e,r,i,a){t.push(i?a.replace(P,"$1"):r||e)})),t},y=w(f,(function(e){return 500===m.size&&m.clear(),e})),m=y.cache,y);var x=1/0;function b(e){if("string"==typeof e||(0,c.c)(e))return e;var t=e+"";return"0"==t&&1/e==-x?"-0":t}function S(e,t,r){return null==e?e:function(e,t,r,i){if(!(0,u.j)(e))return e;for(var a=-1,n=(t=function(e,t){return(0,u.a)(e)?e:function(e,t){if((0,u.a)(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!(0,c.c)(e))||p.test(e)||!v.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:L((0,c.d)(e))}(t,e)).length,s=n-1,o=e;null!=o&&++a<n;){var l=b(t[a]),d=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(a!=s){var w=o[l];void 0===(d=void 0)&&(d=(0,u.j)(w)?w:(0,h.i)(t[a+1])?[]:{})}(0,h.a)(o,l,d),o=o[l]}return e}(e,t,r)}function k(e){return a.clone(e)}function C(){return a.clone(d.d)}function I(e){return n.urlToObject(e).path}function R(e){return e?.indexOf("?token=")>0&&(e=e.slice(0,e.indexOf("?token="))),e}function T(e){let t=R(e?.url);"feature"===e.type&&(t=`${t}/${e.layerId??0}`);const r=i.default.findCredential(e.url);return void 0!==r&&(t=`${t}?token=${r.token}`),t}function E(e){const t={url:T(e),name:e.title};if((0,l.i)(e.renderingRule)||(t.renderingRule=e.renderingRule.toJSON()),(0,l.i)(e.definitionExpression))(0,l.i)(e.mosaicRule)||(t.mosaicRule=e.mosaicRule.toJSON?.());else{let r=e.mosaicRule;(0,l.i)(r)||(r=r.clone(),r.where=e.definitionExpression,t.mosaicRule=r.toJSON())}return t}function $(e,t){if((0,l.i)(e?.url)||(0,l.i)(t))return;const r=I(e.url),i=t.find((e=>e.url===r))?.id;return i}async function _(e){if((0,l.i)(e?.url))return;const t=a.clone(e);let r;t.name||(t.name=function(e){const t=e.split("/");return t[t.length-2]}(t.url));try{r=await s.default.fromArcGISServerUrl({url:I(e.url),properties:{renderingRule:e.renderingRule,mosaicRule:e.mosaicRule}}),r.name=e.name}catch(e){}return r}async function O(e){const t=e?.url,r=e?.name;if((0,l.i)(t))return;let i;try{i=await s.default.fromArcGISServerUrl({url:I(t)}),i.name=r}catch(e){console.error("Failed to load feature layer from RFT JSON.")}return i}function A(e){return e?.toLocaleLowerCase().indexOf("f")>=0}function B(e){const t=e&&(e.extent||e.fullExtent);if((0,l.i)(t))return;const{xmin:r,ymin:i,xmax:a,ymax:n,spatialReference:s}=t,{wkid:o,latestWkid:c,wkt:d}=s,h={xmin:r,ymin:i,xmax:a,ymax:n};return(0,l.i)(o)||S(h,"spatialReference.wkid",o),(0,l.i)(c)||S(h,"spatialReference.latestWkid",c),(0,l.i)(d)||S(h,"spatialReference.wkt",d),h}async function U(e){if((0,l.i)(e))return Promise.resolve(void 0);const t=await e.queryFeatures({returnGeometry:!0,where:"1 = 1"});if((0,l.i)(t))return Promise.resolve(void 0);const r=t.features?.map((e=>e?.geometry));return r}function F(e){const t=e?.rasterInfo?.keyProperties?.ChangeAnalysisParameters,r=t?.AnalysisType;return"CCDC"===r}function M(e){return e.filter((e=>function(e){let t=!0;return!1===e.sourceJSON?.allowAnalysis&&(t=!1),(e.portalItem?.typeKeywords?.includes("Hosted Service")??!1)&&(t=!!e.portalItem.isOrgItem||t),t}(e)))}function V(e,t){const r=JSON.stringify(t);return new o.default({url:e,raster:btoa((0,c.t)(r))})}},19948:(e,t,r)=>{function i(e){const{customBaseUrl:t,portalHostname:r,urlKey:i}=e,{protocol:a}=window.location;return`${a}//${void 0!==i?`${i}.${t}`:r}`}function a(e){const{helperServices:{rasterAnalytics:{url:t}},isPortal:r}=e;return r?t:t.replace("rasteranalysis","rasterutils")}function n(e){return a(e).replace("RasterAnalysisTools/GPServer","RasterRendering/ImageServer/validate")}function s(e){return a(e).replace("RasterAnalysisTools/GPServer","RasterRendering/ImageServer")}r.d(t,{a:()=>n,b:()=>s,g:()=>i})},75517:(e,t,r)=>{r.r(t),r.d(t,{rfx_preview:()=>v});var i=r(19451),a=r(48302),n=(r(34319),r(77162)),s=r(64729),o=r(84428),c=r(53248),l=r(5660),d=(r(99248),r(16888),r(95323),r(43278),r(86944),r(83345),r(74656),r(95876)),h=r(19948);r(48363),r(36676),r(81279),r(89920),r(46574),r(46717),r(55139),r(57098),r(78979),r(32804);const u="action-button",v=class{constructor(e){(0,i.r)(this,e),this.rfxPreviewSelection=(0,i.c)(this,"rfxPreviewSelection",7),this.previewHelpClick=(0,i.c)(this,"previewHelpClick",7),this.openBlockInitially=!0,this.maxPreviewLayers=5,this.previewIndexCounter=1,this.createPreviewLayer=async()=>{await this.addToPreviewLayerList(),this.loadPreviewLayer()},this.handlePreviewSwitchChange=e=>{const t=e.target.checked;this.showPreviewBlock=t,!1===this.showPreviewBlock?this.hidePreviewLayers():0===this.previewLayers.length?this.createPreviewLayer():(this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data),this.loadPreviewLayer())},this.updatePreviewLayer=async()=>{const e=await this.getTemplate();this.previewLayers.forEach((t=>{t.index===this.selectedPreviewLayerIndex&&(t.data=e)})),this.loadPreviewLayer()},this.onPreviewSelect=e=>{this.hidePreviewLayers(),this.selectedPreviewLayerIndex=e.target?.value,this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data),this.getSelectedPreviewListItem().layer.visible=!0},this.onPreviewClose=e=>{const t=e.target?.value;this.removePreviewLayerFromMap(this.previewLayers.find((e=>e.index===t)).layer),this.previewLayers=this.previewLayers.filter((e=>e.index!==t)),0===this.previewLayers.length&&(this.showPreviewBlock=!1)},this.renderPreviewError=e=>(0,i.h)("div",{slot:"content-end"},(0,i.h)("calcite-button",{id:`preview-layer-load-error-${e}`,iconStart:"exclamation-mark-triangle",appearance:"transparent",kind:"neutral",scale:s.U.Scale}),(0,i.h)("calcite-tooltip",{label:"preview failed to load","reference-element":`preview-layer-load-error-${e}`},(0,i.h)("span",null,this.strings.previewError))),this.renderPreviewLayers=()=>(0,i.h)("calcite-list",{class:"preview-list",loading:this.previewLayerLoading,selectionAppearance:"border",selectionMode:"single",dir:this.direction},this.previewLayers.map((e=>(0,i.h)("calcite-list-item",{key:`preview-layer-item${e.index}`,id:`preview-layer-item${e.index}`,dir:this.direction,label:e.label,value:e.index,selected:e.index===this.selectedPreviewLayerIndex,closable:!0,onCalciteListItemSelect:this.onPreviewSelect,onCalciteListItemClose:this.onPreviewClose},e.status===c.P.error&&this.renderPreviewError(e.index))))),this.renderPreviewSwitch=()=>(0,i.h)("calcite-label",{dir:this.direction,layout:"inline",scale:s.U.Scale,ref:e=>{this.showPreviewElement=e}},(0,i.h)("calcite-switch",{checked:this.showPreviewBlock,onCalciteSwitchChange:this.handlePreviewSwitchChange,dir:this.direction,scale:s.U.Scale}),this.strings.showPreview,(0,i.h)("calcite-action",{class:"help-action",text:"show help",icon:"information",scale:s.U.Scale,onClick:e=>{e.stopPropagation();const t=(0,o.d)(this.strings.previewPopup);this.previewHelpClick.emit({referenceElement:this.showPreviewElement,helpSrcdoc:t,heading:this.strings.showPreview})}})),this.previewLayers=[],this.showPreviewBlock=!1,this.previewLayerLoading=!1,this.mapView=void 0,this.getTemplate=void 0,this.portal=void 0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,a.b)(this.hostElement,(0,i.g)(".")))}disconnectedCallback(){this.removePreviewLayerFromMap(this.getSelectedPreviewListItem()?.layer)}async addToPreviewLayerList(){const e=await this.getTemplate(),{previewIndexCounter:t}=this;this.previewLayers.push({index:t,label:(0,d.f)(this.strings.previewLayer,{number:t.toString()}),data:e,status:c.P.loading}),this.selectedPreviewLayerIndex=t,this.previewIndexCounter++}validateRFT(e){if((0,n.i)(e))return;const t=(0,h.a)(this.portal),r={renderingRule:JSON.stringify(e),f:"json"};return(0,d.r)(t,{query:r}).then((e=>e?.data?.renderingRule?.isValid),(e=>{console.log("validate request failed",e)}))}removePreviewLayerFromMap(e){(0,n.i)(e)||(e.opacity=0,this.mapView.map.remove(e))}addPreviewLayerToMap(e){const t=this.getSelectedPreviewListItem(),r=(0,l.o)((0,h.b)(this.portal),e);r.load().catch((()=>t.status=c.P.error)).then((()=>{t.layer=r,this.mapView.map.add(r),this.mapView.whenLayerView(r).then((e=>{e.watch("updating",(e=>{this.previewLayerLoading=e}))}))}))}hidePreviewLayers(){this.previewLayers.forEach((e=>{(0,n.i)(e.layer)||(e.layer.visible=!1)}))}async loadPreviewLayer(){this.previewLayerLoading=!0,this.hidePreviewLayers();const e=this.getSelectedPreviewListItem(),t=e.data;e.isValid=await this.validateRFT(t),e.isValid?(e.status=c.P.success,this.addPreviewLayerToMap(t)):(e.status=c.P.error,this.previewLayerLoading=!1)}getSelectedPreviewListItem(){return void 0===this.selectedPreviewLayerIndex?this.previewLayers[0]:this.previewLayers.find((e=>e.index===this.selectedPreviewLayerIndex))}renderActions(){const e=this.previewLayers.length===this.maxPreviewLayers;return(0,i.h)("div",{class:"action-button-container"},(0,i.h)("calcite-button",{id:"preview-update-button",class:u,kind:"neutral",appearance:"outline-fill",iconStart:"refresh",onClick:this.updatePreviewLayer,dir:this.direction,scale:s.U.Scale,disabled:this.previewLayerLoading},this.strings.update),(0,i.h)("calcite-tooltip",{label:"",placement:"bottom-start","reference-element":"preview-update-button"},(0,i.h)("span",null,this.strings.updatePopover)),(0,i.h)("calcite-button",{id:"preview-create-button",class:u,kind:"neutral",appearance:"outline-fill",iconStart:"plus",dir:this.direction,onClick:this.createPreviewLayer,disabled:e||this.previewLayerLoading,scale:s.U.Scale},this.strings.newPreview),(0,i.h)("calcite-tooltip",{label:"",placement:"bottom-start","reference-element":"preview-create-button"},(0,i.h)("span",null,e?(0,d.f)(this.strings.maxPreview,{maxCount:this.maxPreviewLayers.toString()}):this.strings.createPopover)))}render(){return(0,i.h)("calcite-block",{collapsible:!0,heading:this.strings.header,description:this.strings.description,open:this.openBlockInitially,dir:this.direction},this.renderPreviewSwitch(),this.showPreviewBlock&&this.renderPreviewLayers(),this.showPreviewBlock&&this.renderActions())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.a)(this)}};v.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh}.action-button-container{display:flex;justify-content:space-between}.action-button{width:48%}.preview-list{padding:var(--rfx-full-spacing) 0 var(--rfx-full-spacing) 0}.help-action{-webkit-margin-start:auto;margin-inline-start:auto}"},64729:(e,t,r)=>{r.d(t,{C:()=>a,U:()=>i,a:()=>n});const i={Scale:"s",PopoverTimer:60},a={s:"s",m:"m"},n={absolute:"absolute",fixed:"fixed"}}}]);