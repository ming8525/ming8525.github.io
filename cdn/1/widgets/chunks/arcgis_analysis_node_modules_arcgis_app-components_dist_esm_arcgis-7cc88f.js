"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7cc88f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-color.entry.js":
/*!************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-color.entry.js ***!
  \************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_color: () => (/* binding */ ArcgisSmartMappingPanelsColor)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loading-69139907.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./color-d6da0a9a.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-d6da0a9a.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */












const arcgisSmartMappingPanelsColorCss = ":host{width:100%}.flow-item{height:100%}.color-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";

const ArcgisSmartMappingPanelsColor = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsColorClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorClose", 7);
        this.arcgisSmartMappingPanelsColorBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorBackClick", 7);
        this.arcgisSmartMappingPanelsColorError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsColorError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private methods
        //
        //--------------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            this.arcgisSmartMappingPanelsColorClose.emit("save");
        };
        this.handleCancel = () => {
            const { originalRendererJSON, originalFeatureReduction } = this;
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.j)(originalRendererJSON, originalFeatureReduction);
            this.arcgisSmartMappingPanelsColorClose.emit("cancel");
        };
        this.hideTransparency = false;
        this.hideRotation = false;
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        this.visualizationOpen = true;
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        // save original renderer
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { layer, hideLayerTitle, isRTL, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: strings.panels.styleOptions, description: !hideLayerTitle ? layer.title : undefined, class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.C.rtl]: isRTL
            }, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => {
                this.arcgisSmartMappingPanelsColorBackClick.emit();
            }, ref: (node) => (this.flowItemNode = node) }, this.renderDoneButton(), this.renderCancelButton(), this.renderVisualization(), this.renderTransparency(), this.renderRotation())));
    }
    renderDoneButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancelButton() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (!layer) {
            // loading state of panel doesn't position buttons correctly
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: this.handleCancel, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    renderVisualization() {
        var _a, _b;
        const { visualizationOpen, hideTransparency, hideRotation } = this;
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["color-age", "color-age-size"].indexOf(rendererType) > -1;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const fieldName = colorVisVar
            ? colorVisVar.field
                ? (_a = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(colorVisVar.field)) === null || _a === void 0 ? void 0 : _a.label
                : colorVisVar.valueExpressionTitle || strings.expression
            : renderer.field
                ? (_b = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(renderer.field)) === null || _b === void 0 ? void 0 : _b.label
                : renderer.valueExpressionTitle || strings.expression;
        const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.f)(layer)[0];
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "color-block", heading: isAgeRenderer
                ? strings.panels.color.colorAgeStyle
                : isDateField
                    ? strings.panels.color.colorStyleDate
                    : strings.panels.color.colorStyle, collapsible: !hideTransparency || !hideRotation, open: visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, !isAgeRenderer ? (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "attribute-name" }, fieldName) : null, this.renderAge(), this.renderTheme(), this.renderDividedBy(), this.renderSymbol(), this.renderColorSlider(), this.renderBackgroundStyle(), this.renderDefaultSymbol(), this.renderShowInLegend(), this.renderClassify()));
    }
    renderAge() {
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["color-age", "color-age-size"].indexOf(rendererType) > -1;
        if (!isAgeRenderer) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-age", { rendererSubtype: "color", onArcgisSmartMappingAgeChange: () => this.sliderNode.updateStatistics(), onArcgisSmartMappingAgeError: (event) => this.arcgisSmartMappingPanelsColorError.emit(event.detail) }));
    }
    renderTheme() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return null;
        }
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-theme-button", { ref: (node) => (this.themeButtonNode = node), rendererSubtype: "color", onArcgisSmartMappingThemeButtonBeforeOpen: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingThemeButtonChange: (event) => {
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                let updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_5__.b;
                if (["color-age", "color-age-size"].indexOf(rendererType) > -1) {
                    updateCall = _color_d6da0a9a_js__WEBPACK_IMPORTED_MODULE_5__.d;
                }
                (0,_loading_69139907_js__WEBPACK_IMPORTED_MODULE_2__.r)(updateCall({
                    theme: event.detail,
                    discardMinMax: true
                }), this.flowItemNode).then((result) => {
                    renderer.visualVariables = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.n)(renderer, "color") || [];
                    renderer.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(result.renderer, "color"));
                    renderer.authoringInfo.visualVariables =
                        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.o)(renderer, "color") || [];
                    renderer.authoringInfo.visualVariables.push((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.p)(result.renderer, "color"));
                    (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                    this.themeButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    if (this.sliderNode) {
                        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                        this.sliderNode.updateStatistics();
                    }
                }, (error) => {
                    (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.themeButtonNode);
                    this.arcgisSmartMappingPanelsColorError.emit(error);
                });
            } }));
    }
    renderDividedBy() {
        const { layer, fields } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const isAgeRenderer = ["color-age", "color-age-size"].indexOf(rendererType) > -1;
        if (isAgeRenderer) {
            return null;
        }
        const counts = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.I)(fields);
        if (counts.number < 2) {
            return null;
        }
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (colorVisVar) {
            const field = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.u)(colorVisVar.field);
            const fieldInfo = {
                field: colorVisVar.field,
                expression: colorVisVar.valueExpression,
                expressionTitle: colorVisVar.valueExpressionTitle,
                simpleFieldType: field ? field.simpleFieldType : _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
            };
            if (fieldInfo.expression || fieldInfo.simpleFieldType !== _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER) {
                return null;
            }
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-divided-by", { rendererSubtype: "color", normalizationField: colorVisVar ? colorVisVar.normalizationField : renderer.normalizationField, onArcgisSmartMappingDividedByChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode.updateStatistics();
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
            }, onArcgisSmartMappingDividedByError: (event) => this.arcgisSmartMappingPanelsColorError.emit(event.detail) }));
    }
    renderSymbol() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const classBreakInfos = renderer.classBreakInfos;
        const symbol = classBreakInfos[0].symbol;
        let colors;
        if (colorVisVar) {
            colors = colorVisVar.stops.map((stop) => {
                const color = stop.color.clone();
                color.a = 1;
                return color;
            });
        }
        else if (classBreakInfos === null || classBreakInfos === void 0 ? void 0 : classBreakInfos.length) {
            colors = classBreakInfos.map((classBreakInfo) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(classBreakInfo.symbol));
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { symbol: symbol, colors: colors, type: "color-ramp", rampType: colorVisVar ? "continuous" : "discrete", ref: (node) => {
                if (node) {
                    this.symbolButtonNode = node;
                }
            }, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderColorSlider() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-color-slider", { ref: (node) => {
                if (node) {
                    this.sliderNode = node;
                }
            }, onArcgisSmartMappingColorSliderChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            }, onArcgisSmartMappingColorSliderError: (event) => this.arcgisSmartMappingPanelsColorError.emit(event.detail) }));
    }
    renderBackgroundStyle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        if (!(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.q)(layer) || ["color-size"].indexOf(rendererType) === -1) {
            return null;
        }
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", null);
    }
    renderDefaultSymbol() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-default-symbol", { ref: (node) => {
                if (node) {
                    this.defaultSymbolNode = node;
                }
            }, onArcgisSmartMappingDefaultSymbolBeforeToggle: () => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)(), onArcgisSmartMappingDefaultSymbolChange: () => (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode) }));
    }
    renderShowInLegend() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        if (!colorVisVar) {
            return null;
        }
        const legendOptions = colorVisVar.legendOptions;
        const isChecked = !legendOptions || legendOptions.showLegend !== false;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { class: "legend-toggle-padding", layout: "inline-space-between" }, strings.panels.color.includeInLegend, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: isChecked, onCalciteSwitchChange: () => this.handleIncludeInLegendToggle() })));
    }
    renderClassify() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const rendererType = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)();
        const fieldInfo = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.f)(layer)[0];
        const isDateField = fieldInfo.simpleFieldType === _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.DATE;
        const isAgeRenderer = ["color-age", "color-age-size"].indexOf(rendererType) > -1;
        if (rendererType !== "color" || isDateField || isAgeRenderer) {
            return null;
        }
        const classBreakInfos = renderer.classBreakInfos;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-classify", { ref: (node) => (this.classifyNode = node), onArcgisSmartMappingClassifyChange: (event) => {
                const instructions = event.detail;
                ((instructions === null || instructions === void 0 ? void 0 : instructions.closePopovers) || (instructions === null || instructions === void 0 ? void 0 : instructions.classesChange)) && (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                if ((instructions === null || instructions === void 0 ? void 0 : instructions.classesChange) || (instructions === null || instructions === void 0 ? void 0 : instructions.symbolChange)) {
                    this.symbolButtonNode.colors = classBreakInfos.map((classBreakInfo) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(classBreakInfo.symbol));
                }
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.sliderNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.sliderNode);
                if ((instructions === null || instructions === void 0 ? void 0 : instructions.toggle) ||
                    (!(instructions === null || instructions === void 0 ? void 0 : instructions.symbolChange) && !(instructions === null || instructions === void 0 ? void 0 : instructions.closePopovers))) {
                    this.sliderNode.updateStatistics();
                }
                this.classifyNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.classifyNode);
                this.symbolButtonNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.symbolButtonNode);
                this.defaultSymbolNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.defaultSymbolNode);
            }, onArcgisSmartMappingClassifyError: (event) => this.arcgisSmartMappingPanelsColorError.emit(event.detail) }));
    }
    renderTransparency() {
        const { hideTransparency } = this;
        if (hideTransparency) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsColorError.emit(detail) }));
    }
    renderRotation() {
        const { hideRotation } = this;
        if (hideRotation) {
            return;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, ref: (node) => (this.rotationNode = node), onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsColorError.emit(detail) }));
    }
    handleIncludeInLegendToggle() {
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const colorVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)(renderer, "color");
        const legendOptions = colorVisVar.legendOptions;
        if (legendOptions && legendOptions.showLegend === false) {
            if (legendOptions.title) {
                legendOptions.showLegend = true;
            }
            else {
                colorVisVar.legendOptions = undefined;
            }
        }
        else {
            colorVisVar.legendOptions = legendOptions || {};
            colorVisVar.legendOptions.showLegend = false;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsColor.style = arcgisSmartMappingPanelsColorCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-color.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loading-69139907.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   r: () => (/* binding */ requestWrapper)
/* harmony export */ });
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */
let _loadingTimer;
let _requestCancelled;
function startLoading(node) {
    node.loading = true;
    _requestCancelled = false;
    if (_loadingTimer) {
        clearTimeout(_loadingTimer);
    }
    _loadingTimer = setTimeout(() => {
        // took too long
        endLoading(node);
        _requestCancelled = true;
    }, 60000);
}
function endLoading(node) {
    node.loading = false;
}
function requestWrapper(request, node) {
    startLoading(node);
    return request
        .then((result) => {
        endLoading(node);
        if (!_requestCancelled) {
            return Promise.resolve(result);
        }
        else {
            return Promise.reject(new Error("timeout"));
        }
    })
        .catch((error) => {
        endLoading(node);
        return Promise.reject(error);
    });
}



//# sourceMappingURL=loading-69139907.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTdjYzg4Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUMrSDtBQUMwUztBQUM3VztBQUN6QjtBQUNBO0FBQ2lGO0FBQ3REO0FBQ2hDO0FBQ0g7QUFDRTtBQUNVOztBQUV2QyxnREFBZ0QsV0FBVyxXQUFXLFlBQVksYUFBYSxrQkFBa0IsZ0JBQWdCLHFCQUFxQix1QkFBdUIsaUJBQWlCLG9CQUFvQjs7QUFFbE47QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLGtEQUFrRCxxREFBVztBQUM3RCxzREFBc0QscURBQVc7QUFDakUsa0RBQWtELHFEQUFXO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlEQUFpRDtBQUNyRSxZQUFZLG1FQUFrQjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpQkFBaUIsRUFBRSwrREFBaUI7QUFDcEQ7QUFDQSx5QkFBeUIsbUVBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsUUFBUSxxRkFBcUY7QUFDbkk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isd0NBQXdDLEVBQUUsK0RBQWlCO0FBQzNFLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLElBQUksK0JBQStCLEVBQUUscURBQUMsd0JBQXdCO0FBQ3BGO0FBQ0EsaUJBQWlCLHdEQUFXO0FBQzVCLGFBQWEsWUFBWSxvRUFBYTtBQUN0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VztBQUNwQyw4QkFBOEIsbUVBQVM7QUFDdkMsZ0JBQWdCLHFEQUFDLHdDQUF3Qyx1RUFBdUUsUUFBUSwyREFBMkQ7QUFDbk07QUFDQTtBQUNBLGdCQUFnQixlQUFlO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixRQUFRLEVBQUUsK0RBQWlCO0FBQzNDLHlCQUF5QixtRUFBVztBQUNwQyw4QkFBOEIsbUVBQVM7QUFDdkMsK0JBQStCLG1FQUFTO0FBQ3hDLGdCQUFnQixxREFBQyxvQ0FBb0MsMkhBQTJILFFBQVEsMkRBQTJEO0FBQ25QO0FBQ0E7QUFDQSxnQkFBZ0IsUUFBUSxFQUFFLCtEQUFpQjtBQUMzQyx5QkFBeUIsbUVBQVc7QUFDcEMsNEJBQTRCLG1FQUFTO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxvRUFBYztBQUN0QjtBQUNBLHdCQUF3QixPQUFPLHFEQUFVO0FBQ3pDO0FBQ0E7O0FBRThFOztBQUU5RTs7Ozs7Ozs7Ozs7Ozs7QUN0VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFK0I7O0FBRS9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLWNvbG9yLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2xvYWRpbmctNjkxMzk5MDcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIEggYXMgSG9zdCwgZCBhcyBnZXRFbGVtZW50LCBmIGFzIGZvcmNlVXBkYXRlIH0gZnJvbSAnLi9pbmRleC1lM2JmN2RhNy5qcyc7XG5pbXBvcnQgeyBqIGFzIGFwcGx5UmVuZGVyZXJUb0FsbCwgYWEgYXMgaXNUb3BGbG93SXRlbSwgZyBhcyBnZXRSZW5kZXJlclR5cGUsIGEgYXMgZ2V0VmlzVmFyLCB1IGFzIGdldEZpZWxkLCBmIGFzIGdldFJlbmRlcmVyRmllbGRJbmZvcywgSSBhcyBnZXRMYXllckZpZWxkVHlwZUNvdW50LCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIHQgYXMgZ2V0U3ltYm9sQ29sb3IsIHEgYXMgaXNQb2x5Z29uVHlwZSwgYWIgYXMgdXBkYXRlUmVuZGVyZXIsIHMgYXMgc21hcnRNYXBwaW5nU3RhdGUsIGggYXMgZ2V0UmVuZGVyZXIsIEUgYXMgY2xvc2VQb3BvdmVycywgbiBhcyBnZXRWaXNWYXJzRXhjZXB0LCBvIGFzIGdldEF1dGhWaXNWYXJzRXhjZXB0LCBwIGFzIGdldEF1dGhWaXNWYXIgfSBmcm9tICcuL3Jhc3Rlci11bmlxdWUtdmFsdWUtMDk3NmVjN2YuanMnO1xuaW1wb3J0IHsgciBhcyByZXF1ZXN0V3JhcHBlciB9IGZyb20gJy4vbG9hZGluZy02OTEzOTkwNy5qcyc7XG5pbXBvcnQgJy4vbG9hZE1vZHVsZXMtYjRhYzEyNDcuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkVudW1zLWZjZjEzNjYxLmpzJztcbmltcG9ydCB7IGIgYXMgY3JlYXRlQ29sb3JSZW5kZXJlckZyb21FeGlzdGluZywgZCBhcyBjcmVhdGVDb2xvckFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nIH0gZnJvbSAnLi9jb2xvci1kNmRhMGE5YS5qcyc7XG5pbXBvcnQgeyBDIGFzIENTU19VVElMSVRZIH0gZnJvbSAnLi9sYW5ndWFnZVV0aWwtZWYwZTU0YjIuanMnO1xuaW1wb3J0ICcuL2xvY2FsZS0wNTBiNmRiOS5qcyc7XG5pbXBvcnQgJy4vZG9tLTRkMzY3Njc3LmpzJztcbmltcG9ydCAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRnVuY3Rpb25zLWIwODMwZTllLmpzJztcblxuY29uc3QgYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX0uY29sb3ItYmxvY2t7b3ZlcmZsb3cteDpoaWRkZW59LmF0dHJpYnV0ZS1uYW1le3dvcmQtYnJlYWs6YnJlYWstYWxsfS5sZWdlbmQtdG9nZ2xlLXBhZGRpbmd7cGFkZGluZy10b3A6MTJweDtwYWRkaW5nLWJvdHRvbToxMnB4fVwiO1xuXG5jb25zdCBBcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckJhY2tDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JCYWNrQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JFcnJvciA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JFcnJvclwiLCA3KTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JDbG9zZS5lbWl0KFwic2F2ZVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsUmVuZGVyZXJKU09OLCBvcmlnaW5hbEZlYXR1cmVSZWR1Y3Rpb24gfSA9IHRoaXM7XG4gICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwob3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbik7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yQ2xvc2UuZW1pdChcImNhbmNlbFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oaWRlVHJhbnNwYXJlbmN5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVJvdGF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVudU9wZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tCdXR0b24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYmVmb3JlQmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmZsb3dJdGVtTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnRXaWxsTG9hZCgpIHtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IHRydWU7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICAvLyBzYXZlIG9yaWdpbmFsIHJlbmRlcmVyXG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OID0gcmVuZGVyZXIudG9KU09OKCk7XG4gICAgICAgIHRoaXMub3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uID1cbiAgICAgICAgICAgIFwiZmVhdHVyZVJlZHVjdGlvblwiIGluIGxheWVyICYmIGxheWVyLmZlYXR1cmVSZWR1Y3Rpb25cbiAgICAgICAgICAgICAgICA/IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUobGF5ZXIuZmVhdHVyZVJlZHVjdGlvbilcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpOyB9KTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBoaWRlTGF5ZXJUaXRsZSwgaXNSVEwsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnN0eWxlT3B0aW9ucywgZGVzY3JpcHRpb246ICFoaWRlTGF5ZXJUaXRsZSA/IGxheWVyLnRpdGxlIDogdW5kZWZpbmVkLCBjbGFzczoge1xuICAgICAgICAgICAgICAgIFwiZmxvdy1pdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgW0NTU19VVElMSVRZLnJ0bF06IGlzUlRMXG4gICAgICAgICAgICB9LCBjbG9zYWJsZTogaXNUb3BGbG93SXRlbSh0aGlzLmhvc3RFbGVtZW50KSwgbWVudU9wZW46IHRoaXMubWVudU9wZW4sIGJlZm9yZUJhY2s6IHRoaXMuYmVmb3JlQmFjayxcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHNob3dCYWNrQnV0dG9uOiB0aGlzLnNob3dCYWNrQnV0dG9uLCBvbkNhbGNpdGVGbG93SXRlbUNsb3NlOiB0aGlzLmhhbmRsZURvbmUsIG9uQ2FsY2l0ZUZsb3dJdGVtQmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JCYWNrQ2xpY2suZW1pdCgpO1xuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJEb25lQnV0dG9uKCksIHRoaXMucmVuZGVyQ2FuY2VsQnV0dG9uKCksIHRoaXMucmVuZGVyVmlzdWFsaXphdGlvbigpLCB0aGlzLnJlbmRlclRyYW5zcGFyZW5jeSgpLCB0aGlzLnJlbmRlclJvdGF0aW9uKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlckRvbmVCdXR0b24oKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoIWxheWVyKSB7XG4gICAgICAgICAgICAvLyBsb2FkaW5nIHN0YXRlIG9mIHBhbmVsIGRvZXNuJ3QgcG9zaXRpb24gYnV0dG9ucyBjb3JyZWN0bHlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuZG9uZSwgb25DbGljazogdGhpcy5oYW5kbGVEb25lLCBhcHBlYXJhbmNlOiBcInNvbGlkXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmRvbmUpKTtcbiAgICB9XG4gICAgcmVuZGVyQ2FuY2VsQnV0dG9uKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgaWYgKCFsYXllcikge1xuICAgICAgICAgICAgLy8gbG9hZGluZyBzdGF0ZSBvZiBwYW5lbCBkb2Vzbid0IHBvc2l0aW9uIGJ1dHRvbnMgY29ycmVjdGx5XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IHNsb3Q6IFwiZm9vdGVyXCIsIGxhYmVsOiBzdHJpbmdzLmNhbmNlbCwgb25DbGljazogdGhpcy5oYW5kbGVDYW5jZWwsIGFwcGVhcmFuY2U6IFwib3V0bGluZS1maWxsXCIsIHdpZHRoOiBcImhhbGZcIiB9LCBzdHJpbmdzLmNhbmNlbCkpO1xuICAgIH1cbiAgICByZW5kZXJWaXN1YWxpemF0aW9uKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCB7IHZpc3VhbGl6YXRpb25PcGVuLCBoaWRlVHJhbnNwYXJlbmN5LCBoaWRlUm90YXRpb24gfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcImNvbG9yLWFnZVwiLCBcImNvbG9yLWFnZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IGNvbG9yVmlzVmFyXG4gICAgICAgICAgICA/IGNvbG9yVmlzVmFyLmZpZWxkXG4gICAgICAgICAgICAgICAgPyAoX2EgPSBnZXRGaWVsZChjb2xvclZpc1Zhci5maWVsZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYWJlbFxuICAgICAgICAgICAgICAgIDogY29sb3JWaXNWYXIudmFsdWVFeHByZXNzaW9uVGl0bGUgfHwgc3RyaW5ncy5leHByZXNzaW9uXG4gICAgICAgICAgICA6IHJlbmRlcmVyLmZpZWxkXG4gICAgICAgICAgICAgICAgPyAoX2IgPSBnZXRGaWVsZChyZW5kZXJlci5maWVsZCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sYWJlbFxuICAgICAgICAgICAgICAgIDogcmVuZGVyZXIudmFsdWVFeHByZXNzaW9uVGl0bGUgfHwgc3RyaW5ncy5leHByZXNzaW9uO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpWzBdO1xuICAgICAgICBjb25zdCBpc0RhdGVGaWVsZCA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1ibG9ja1wiLCB7IGNsYXNzOiBcImNvbG9yLWJsb2NrXCIsIGhlYWRpbmc6IGlzQWdlUmVuZGVyZXJcbiAgICAgICAgICAgICAgICA/IHN0cmluZ3MucGFuZWxzLmNvbG9yLmNvbG9yQWdlU3R5bGVcbiAgICAgICAgICAgICAgICA6IGlzRGF0ZUZpZWxkXG4gICAgICAgICAgICAgICAgICAgID8gc3RyaW5ncy5wYW5lbHMuY29sb3IuY29sb3JTdHlsZURhdGVcbiAgICAgICAgICAgICAgICAgICAgOiBzdHJpbmdzLnBhbmVscy5jb2xvci5jb2xvclN0eWxlLCBjb2xsYXBzaWJsZTogIWhpZGVUcmFuc3BhcmVuY3kgfHwgIWhpZGVSb3RhdGlvbiwgb3BlbjogdmlzdWFsaXphdGlvbk9wZW4sIG9uQ2FsY2l0ZUJsb2NrT3BlbjogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSB0cnVlKSwgb25DYWxjaXRlQmxvY2tDbG9zZTogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZSkgfSwgIWlzQWdlUmVuZGVyZXIgPyBoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGNsYXNzOiBcImF0dHJpYnV0ZS1uYW1lXCIgfSwgZmllbGROYW1lKSA6IG51bGwsIHRoaXMucmVuZGVyQWdlKCksIHRoaXMucmVuZGVyVGhlbWUoKSwgdGhpcy5yZW5kZXJEaXZpZGVkQnkoKSwgdGhpcy5yZW5kZXJTeW1ib2woKSwgdGhpcy5yZW5kZXJDb2xvclNsaWRlcigpLCB0aGlzLnJlbmRlckJhY2tncm91bmRTdHlsZSgpLCB0aGlzLnJlbmRlckRlZmF1bHRTeW1ib2woKSwgdGhpcy5yZW5kZXJTaG93SW5MZWdlbmQoKSwgdGhpcy5yZW5kZXJDbGFzc2lmeSgpKSk7XG4gICAgfVxuICAgIHJlbmRlckFnZSgpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXJUeXBlID0gZ2V0UmVuZGVyZXJUeXBlKCk7XG4gICAgICAgIGNvbnN0IGlzQWdlUmVuZGVyZXIgPSBbXCJjb2xvci1hZ2VcIiwgXCJjb2xvci1hZ2Utc2l6ZVwiXS5pbmRleE9mKHJlbmRlcmVyVHlwZSkgPiAtMTtcbiAgICAgICAgaWYgKCFpc0FnZVJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1hZ2VcIiwgeyByZW5kZXJlclN1YnR5cGU6IFwiY29sb3JcIiwgb25BcmNnaXNTbWFydE1hcHBpbmdBZ2VDaGFuZ2U6ICgpID0+IHRoaXMuc2xpZGVyTm9kZS51cGRhdGVTdGF0aXN0aWNzKCksIG9uQXJjZ2lzU21hcnRNYXBwaW5nQWdlRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclRoZW1lKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IGNvbG9yVmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcImNvbG9yXCIpO1xuICAgICAgICBpZiAoIWNvbG9yVmlzVmFyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZW5kZXJlclR5cGUgPSBnZXRSZW5kZXJlclR5cGUoKTtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctdGhlbWUtYnV0dG9uXCIsIHsgcmVmOiAobm9kZSkgPT4gKHRoaXMudGhlbWVCdXR0b25Ob2RlID0gbm9kZSksIHJlbmRlcmVyU3VidHlwZTogXCJjb2xvclwiLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQmVmb3JlT3BlbjogKCkgPT4gY2xvc2VQb3BvdmVycygpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ1RoZW1lQnV0dG9uQ2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgICAgICAgICBsZXQgdXBkYXRlQ2FsbCA9IGNyZWF0ZUNvbG9yUmVuZGVyZXJGcm9tRXhpc3Rpbmc7XG4gICAgICAgICAgICAgICAgaWYgKFtcImNvbG9yLWFnZVwiLCBcImNvbG9yLWFnZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNhbGwgPSBjcmVhdGVDb2xvckFnZVJlbmRlcmVyRnJvbUV4aXN0aW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXF1ZXN0V3JhcHBlcih1cGRhdGVDYWxsKHtcbiAgICAgICAgICAgICAgICAgICAgdGhlbWU6IGV2ZW50LmRldGFpbCxcbiAgICAgICAgICAgICAgICAgICAgZGlzY2FyZE1pbk1heDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pLCB0aGlzLmZsb3dJdGVtTm9kZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcyA9IGdldFZpc1ZhcnNFeGNlcHQocmVuZGVyZXIsIFwiY29sb3JcIikgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLnZpc3VhbFZhcmlhYmxlcy5wdXNoKGdldFZpc1ZhcihyZXN1bHQucmVuZGVyZXIsIFwiY29sb3JcIikpO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5hdXRob3JpbmdJbmZvLnZpc3VhbFZhcmlhYmxlcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRBdXRoVmlzVmFyc0V4Y2VwdChyZW5kZXJlciwgXCJjb2xvclwiKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuYXV0aG9yaW5nSW5mby52aXN1YWxWYXJpYWJsZXMucHVzaChnZXRBdXRoVmlzVmFyKHJlc3VsdC5yZW5kZXJlciwgXCJjb2xvclwiKSk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRoZW1lQnV0dG9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnRoZW1lQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNsaWRlck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUudXBkYXRlU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMudGhlbWVCdXR0b25Ob2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yLmVtaXQoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckRpdmlkZWRCeSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgZmllbGRzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBpc0FnZVJlbmRlcmVyID0gW1wiY29sb3ItYWdlXCIsIFwiY29sb3ItYWdlLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID4gLTE7XG4gICAgICAgIGlmIChpc0FnZVJlbmRlcmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb3VudHMgPSBnZXRMYXllckZpZWxkVHlwZUNvdW50KGZpZWxkcyk7XG4gICAgICAgIGlmIChjb3VudHMubnVtYmVyIDwgMikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGlmIChjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZChjb2xvclZpc1Zhci5maWVsZCk7XG4gICAgICAgICAgICBjb25zdCBmaWVsZEluZm8gPSB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IGNvbG9yVmlzVmFyLmZpZWxkLFxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IGNvbG9yVmlzVmFyLnZhbHVlRXhwcmVzc2lvbixcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uVGl0bGU6IGNvbG9yVmlzVmFyLnZhbHVlRXhwcmVzc2lvblRpdGxlLFxuICAgICAgICAgICAgICAgIHNpbXBsZUZpZWxkVHlwZTogZmllbGQgPyBmaWVsZC5zaW1wbGVGaWVsZFR5cGUgOiBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChmaWVsZEluZm8uZXhwcmVzc2lvbiB8fCBmaWVsZEluZm8uc2ltcGxlRmllbGRUeXBlICE9PSBzaW1wbGVGaWVsZFR5cGVzLk5VTUJFUikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWRpdmlkZWQtYnlcIiwgeyByZW5kZXJlclN1YnR5cGU6IFwiY29sb3JcIiwgbm9ybWFsaXphdGlvbkZpZWxkOiBjb2xvclZpc1ZhciA/IGNvbG9yVmlzVmFyLm5vcm1hbGl6YXRpb25GaWVsZCA6IHJlbmRlcmVyLm5vcm1hbGl6YXRpb25GaWVsZCwgb25BcmNnaXNTbWFydE1hcHBpbmdEaXZpZGVkQnlDaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUudXBkYXRlU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NpZnlOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuY2xhc3NpZnlOb2RlKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nRGl2aWRlZEJ5RXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgY29uc3QgY2xhc3NCcmVha0luZm9zID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zO1xuICAgICAgICBjb25zdCBzeW1ib2wgPSBjbGFzc0JyZWFrSW5mb3NbMF0uc3ltYm9sO1xuICAgICAgICBsZXQgY29sb3JzO1xuICAgICAgICBpZiAoY29sb3JWaXNWYXIpIHtcbiAgICAgICAgICAgIGNvbG9ycyA9IGNvbG9yVmlzVmFyLnN0b3BzLm1hcCgoc3RvcCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3RvcC5jb2xvci5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIGNvbG9yLmEgPSAxO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNsYXNzQnJlYWtJbmZvcyA9PT0gbnVsbCB8fCBjbGFzc0JyZWFrSW5mb3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsYXNzQnJlYWtJbmZvcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbG9ycyA9IGNsYXNzQnJlYWtJbmZvcy5tYXAoKGNsYXNzQnJlYWtJbmZvKSA9PiBnZXRTeW1ib2xDb2xvcihjbGFzc0JyZWFrSW5mby5zeW1ib2wpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1zeW1ib2wtYnV0dG9uXCIsIHsgc3ltYm9sOiBzeW1ib2wsIGNvbG9yczogY29sb3JzLCB0eXBlOiBcImNvbG9yLXJhbXBcIiwgcmFtcFR5cGU6IGNvbG9yVmlzVmFyID8gXCJjb250aW51b3VzXCIgOiBcImRpc2NyZXRlXCIsIHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbEJ1dHRvbk5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXJOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc2xpZGVyTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc2lmeU5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5jbGFzc2lmeU5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMucm90YXRpb25Ob2RlKTtcbiAgICAgICAgICAgIH0gfSkpO1xuICAgIH1cbiAgICByZW5kZXJDb2xvclNsaWRlcigpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctY29sb3Itc2xpZGVyXCIsIHsgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdDb2xvclNsaWRlckNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NpZnlOb2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuY2xhc3NpZnlOb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLnJvdGF0aW9uTm9kZSk7XG4gICAgICAgICAgICB9LCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0NvbG9yU2xpZGVyRXJyb3I6IChldmVudCkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckVycm9yLmVtaXQoZXZlbnQuZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckJhY2tncm91bmRTdHlsZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBpZiAoIWlzUG9seWdvblR5cGUobGF5ZXIpIHx8IFtcImNvbG9yLXNpemVcIl0uaW5kZXhPZihyZW5kZXJlclR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1iYWNrZ3JvdW5kLXN5bWJvbFwiLCBudWxsKTtcbiAgICB9XG4gICAgcmVuZGVyRGVmYXVsdFN5bWJvbCgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiYXJjZ2lzLXNtYXJ0LW1hcHBpbmctZGVmYXVsdC1zeW1ib2xcIiwgeyByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25BcmNnaXNTbWFydE1hcHBpbmdEZWZhdWx0U3ltYm9sQmVmb3JlVG9nZ2xlOiAoKSA9PiBjbG9zZVBvcG92ZXJzKCksIG9uQXJjZ2lzU21hcnRNYXBwaW5nRGVmYXVsdFN5bWJvbENoYW5nZTogKCkgPT4gZm9yY2VVcGRhdGUodGhpcy5zeW1ib2xCdXR0b25Ob2RlKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclNob3dJbkxlZ2VuZCgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBjb2xvclZpc1ZhciA9IGdldFZpc1ZhcihyZW5kZXJlciwgXCJjb2xvclwiKTtcbiAgICAgICAgaWYgKCFjb2xvclZpc1Zhcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVnZW5kT3B0aW9ucyA9IGNvbG9yVmlzVmFyLmxlZ2VuZE9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9ICFsZWdlbmRPcHRpb25zIHx8IGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCAhPT0gZmFsc2U7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGFiZWxcIiwgeyBjbGFzczogXCJsZWdlbmQtdG9nZ2xlLXBhZGRpbmdcIiwgbGF5b3V0OiBcImlubGluZS1zcGFjZS1iZXR3ZWVuXCIgfSwgc3RyaW5ncy5wYW5lbHMuY29sb3IuaW5jbHVkZUluTGVnZW5kLCBoKFwiY2FsY2l0ZS1zd2l0Y2hcIiwgeyBzY2FsZTogXCJzXCIsIGNoZWNrZWQ6IGlzQ2hlY2tlZCwgb25DYWxjaXRlU3dpdGNoQ2hhbmdlOiAoKSA9PiB0aGlzLmhhbmRsZUluY2x1ZGVJbkxlZ2VuZFRvZ2dsZSgpIH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNsYXNzaWZ5KCkge1xuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyVHlwZSA9IGdldFJlbmRlcmVyVHlwZSgpO1xuICAgICAgICBjb25zdCBmaWVsZEluZm8gPSBnZXRSZW5kZXJlckZpZWxkSW5mb3MobGF5ZXIpWzBdO1xuICAgICAgICBjb25zdCBpc0RhdGVGaWVsZCA9IGZpZWxkSW5mby5zaW1wbGVGaWVsZFR5cGUgPT09IHNpbXBsZUZpZWxkVHlwZXMuREFURTtcbiAgICAgICAgY29uc3QgaXNBZ2VSZW5kZXJlciA9IFtcImNvbG9yLWFnZVwiLCBcImNvbG9yLWFnZS1zaXplXCJdLmluZGV4T2YocmVuZGVyZXJUeXBlKSA+IC0xO1xuICAgICAgICBpZiAocmVuZGVyZXJUeXBlICE9PSBcImNvbG9yXCIgfHwgaXNEYXRlRmllbGQgfHwgaXNBZ2VSZW5kZXJlcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2xhc3NCcmVha0luZm9zID0gcmVuZGVyZXIuY2xhc3NCcmVha0luZm9zO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy1jbGFzc2lmeVwiLCB7IHJlZjogKG5vZGUpID0+ICh0aGlzLmNsYXNzaWZ5Tm9kZSA9IG5vZGUpLCBvbkFyY2dpc1NtYXJ0TWFwcGluZ0NsYXNzaWZ5Q2hhbmdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBldmVudC5kZXRhaWw7XG4gICAgICAgICAgICAgICAgKChpbnN0cnVjdGlvbnMgPT09IG51bGwgfHwgaW5zdHJ1Y3Rpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbnN0cnVjdGlvbnMuY2xvc2VQb3BvdmVycykgfHwgKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy5jbGFzc2VzQ2hhbmdlKSkgJiYgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgIGlmICgoaW5zdHJ1Y3Rpb25zID09PSBudWxsIHx8IGluc3RydWN0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5zdHJ1Y3Rpb25zLmNsYXNzZXNDaGFuZ2UpIHx8IChpbnN0cnVjdGlvbnMgPT09IG51bGwgfHwgaW5zdHJ1Y3Rpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbnN0cnVjdGlvbnMuc3ltYm9sQ2hhbmdlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbEJ1dHRvbk5vZGUuY29sb3JzID0gY2xhc3NCcmVha0luZm9zLm1hcCgoY2xhc3NCcmVha0luZm8pID0+IGdldFN5bWJvbENvbG9yKGNsYXNzQnJlYWtJbmZvLnN5bWJvbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5zbGlkZXJOb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy50b2dnbGUpIHx8XG4gICAgICAgICAgICAgICAgICAgICghKGluc3RydWN0aW9ucyA9PT0gbnVsbCB8fCBpbnN0cnVjdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluc3RydWN0aW9ucy5zeW1ib2xDaGFuZ2UpICYmICEoaW5zdHJ1Y3Rpb25zID09PSBudWxsIHx8IGluc3RydWN0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5zdHJ1Y3Rpb25zLmNsb3NlUG9wb3ZlcnMpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlck5vZGUudXBkYXRlU3RhdGlzdGljcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzaWZ5Tm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmNsYXNzaWZ5Tm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xCdXR0b25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMuc3ltYm9sQnV0dG9uTm9kZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSAmJiBmb3JjZVVwZGF0ZSh0aGlzLmRlZmF1bHRTeW1ib2xOb2RlKTtcbiAgICAgICAgICAgIH0sIG9uQXJjZ2lzU21hcnRNYXBwaW5nQ2xhc3NpZnlFcnJvcjogKGV2ZW50KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc0NvbG9yRXJyb3IuZW1pdChldmVudC5kZXRhaWwpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyVHJhbnNwYXJlbmN5KCkge1xuICAgICAgICBjb25zdCB7IGhpZGVUcmFuc3BhcmVuY3kgfSA9IHRoaXM7XG4gICAgICAgIGlmIChoaWRlVHJhbnNwYXJlbmN5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBsYXllciB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKHJlbmRlcmVyLCBcIm9wYWNpdHlcIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXRyYW5zcGFyZW5jeVwiLCB7IG9wZW46ICEhb3BhY2l0eVZpc1Zhciwgb25BcmNnaXNTbWFydE1hcHBpbmdTeW1ib2xUcmFuc3BhcmVuY3lFcnJvcjogKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICByZW5kZXJSb3RhdGlvbigpIHtcbiAgICAgICAgY29uc3QgeyBoaWRlUm90YXRpb24gfSA9IHRoaXM7XG4gICAgICAgIGlmIChoaWRlUm90YXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGxheWVyIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwib3BhY2l0eVwiKTtcbiAgICAgICAgY29uc3Qgcm90YXRpb25WaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwicm90YXRpb25cIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXJvdGF0aW9uXCIsIHsgb3BlbjogIW9wYWNpdHlWaXNWYXIgJiYgISFyb3RhdGlvblZpc1ZhciwgcmVmOiAobm9kZSkgPT4gKHRoaXMucm90YXRpb25Ob2RlID0gbm9kZSksIG9uQXJjZ2lzU21hcnRNYXBwaW5nUm90YXRpb25FcnJvcjogKHsgZGV0YWlsIH0pID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3JFcnJvci5lbWl0KGRldGFpbCkgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVJbmNsdWRlSW5MZWdlbmRUb2dnbGUoKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgY29sb3JWaXNWYXIgPSBnZXRWaXNWYXIocmVuZGVyZXIsIFwiY29sb3JcIik7XG4gICAgICAgIGNvbnN0IGxlZ2VuZE9wdGlvbnMgPSBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zO1xuICAgICAgICBpZiAobGVnZW5kT3B0aW9ucyAmJiBsZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAobGVnZW5kT3B0aW9ucy50aXRsZSkge1xuICAgICAgICAgICAgICAgIGxlZ2VuZE9wdGlvbnMuc2hvd0xlZ2VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29sb3JWaXNWYXIubGVnZW5kT3B0aW9ucyA9IGxlZ2VuZE9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBjb2xvclZpc1Zhci5sZWdlbmRPcHRpb25zLnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgIH1cbiAgICBnZXQgaG9zdEVsZW1lbnQoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG59O1xuQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3Iuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNDb2xvckNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzQ29sb3IgYXMgYXJjZ2lzX3NtYXJ0X21hcHBpbmdfcGFuZWxzX2NvbG9yIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1jb2xvci5lbnRyeS5qcy5tYXAiLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmxldCBfbG9hZGluZ1RpbWVyO1xubGV0IF9yZXF1ZXN0Q2FuY2VsbGVkO1xuZnVuY3Rpb24gc3RhcnRMb2FkaW5nKG5vZGUpIHtcbiAgICBub2RlLmxvYWRpbmcgPSB0cnVlO1xuICAgIF9yZXF1ZXN0Q2FuY2VsbGVkID0gZmFsc2U7XG4gICAgaWYgKF9sb2FkaW5nVGltZXIpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KF9sb2FkaW5nVGltZXIpO1xuICAgIH1cbiAgICBfbG9hZGluZ1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIHRvb2sgdG9vIGxvbmdcbiAgICAgICAgZW5kTG9hZGluZyhub2RlKTtcbiAgICAgICAgX3JlcXVlc3RDYW5jZWxsZWQgPSB0cnVlO1xuICAgIH0sIDYwMDAwKTtcbn1cbmZ1bmN0aW9uIGVuZExvYWRpbmcobm9kZSkge1xuICAgIG5vZGUubG9hZGluZyA9IGZhbHNlO1xufVxuZnVuY3Rpb24gcmVxdWVzdFdyYXBwZXIocmVxdWVzdCwgbm9kZSkge1xuICAgIHN0YXJ0TG9hZGluZyhub2RlKTtcbiAgICByZXR1cm4gcmVxdWVzdFxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIGVuZExvYWRpbmcobm9kZSk7XG4gICAgICAgIGlmICghX3JlcXVlc3RDYW5jZWxsZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJ0aW1lb3V0XCIpKTtcbiAgICAgICAgfVxuICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgZW5kTG9hZGluZyhub2RlKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IHsgcmVxdWVzdFdyYXBwZXIgYXMgciB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2FkaW5nLTY5MTM5OTA3LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==