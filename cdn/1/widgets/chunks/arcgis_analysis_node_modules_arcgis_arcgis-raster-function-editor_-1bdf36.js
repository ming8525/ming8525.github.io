"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-1bdf36"],{53248:(e,t,r)=>{r.d(t,{A:()=>o,G:()=>c,J:()=>i,M:()=>a,P:()=>u,U:()=>n,a:()=>l,d:()=>s});const n={IDLE:"idle",VALID:"valid",INVALID:"invalid"},i={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},a={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},s={name:"Raster",isDataset:!0,isPublic:!1,type:i.RASTER_FUNCTION_VARIABLE},o={RFX_DTEX_COMMON_SELECT:"RFX-DTEX-COMMON-SELECT",RFX_DTE_COMMON_CHECKBOX:"CALCITE-CHECKBOX",RFX_DTE_COMMON_TEXTINPUT:"CALCITE-INPUT-TEXT",RFX_DTE_COMMON_NUMBERINPUT:"CALCITE-INPUT-NUMBER",RFX_DTE_RASTER_INPUT:"RFX-DTE-RASTER-INPUT",RFX_DTE_FEATURE_SELECT:"RFX-DTE-FEATURE-SELECT",RFX_DTEX_RASTER_VARIABLES_LIST:"RFX-DTEX-RASTER-VARIABLES-LIST",RFX_CTE_RANGED_VALUE_EDITOR:"RFX-CTE-RANGED-VALUE-EDITOR",RFX_CTE_GAMMA_EDITOR:"RFX-CTE-GAMMA-EDITOR",RFX_DTE_COLOR_RAMP_SELECTOR:"RFX-DTE-COLOR-RAMP-SELECTOR",RFX_DTE_EXTENT:"RFX-DTE-EXTENT",RFX_DTE_JSON_FILE_UPLOADER:"RFX-DTE-JSON-FILE-UPLOADER",RFX_CTE_FACTOR_FUNCTION_EDITOR:"RFX-CTE-FACTOR-FUNCTION-EDITOR",RFX_CTE_NEIGHBORHOOD_VALUES:"RFX-CTE-NEIGHBORHOOD-VALUES"},l={ANALYSIS:"analysis",EDITOR:"editor"},c={textInput:"text-input",text:"text",raster:"raster-input",number:"number-input",boolean:"check-box",switch:"switch",field:"field-select",color:"color-input",select:"select",icon:"icon"},u={loading:"loading",success:"success",error:"error"}},5660:(e,t,r)=>{r.d(t,{a:()=>L,b:()=>x,c:()=>O,d:()=>D,e:()=>N,f:()=>w,g:()=>v,h:()=>S,i:()=>U,j:()=>X,k:()=>P,l:()=>M,n:()=>k,o:()=>b});var n=r(46574),i=r(34319),a=r(46717),s=r(55139),o=r(57098),l=(r(78979),r(95876)),c=r(77162),u=r(53248),h=r(32804),d=r(48363),f=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/;function R(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var s=e.apply(this,n);return r.cache=a.set(i,s)||a,s};return r.cache=new(R.Cache||h.M),r}R.Cache=h.M;var E,T,m,y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,C=/\\(\\)?/g,_=(E=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(y,(function(e,r,n,i){t.push(n?i.replace(C,"$1"):r||e)})),t},T=R(E,(function(e){return 500===m.size&&m.clear(),e})),m=T.cache,T);var F=1/0;function g(e){if("string"==typeof e||(0,l.c)(e))return e;var t=e+"";return"0"==t&&1/e==-F?"-0":t}function A(e,t,r){return null==e?e:function(e,t,r,n){if(!(0,d.j)(e))return e;for(var i=-1,a=(t=function(e,t){return(0,d.a)(e)?e:function(e,t){if((0,d.a)(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!(0,l.c)(e))||p.test(e)||!f.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:_((0,l.d)(e))}(t,e)).length,s=a-1,o=e;null!=o&&++i<a;){var c=g(t[i]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=s){var R=o[c];void 0===(u=void 0)&&(u=(0,d.j)(R)?R:(0,h.i)(t[i+1])?[]:{})}(0,h.a)(o,c,u),o=o[c]}return e}(e,t,r)}function O(e){return i.clone(e)}function L(){return i.clone(u.d)}function I(e){return a.urlToObject(e).path}function v(e){return e?.indexOf("?token=")>0&&(e=e.slice(0,e.indexOf("?token="))),e}function x(e){let t=v(e?.url);"feature"===e.type&&(t=`${t}/${e.layerId??0}`);const r=n.default.findCredential(e.url);return void 0!==r&&(t=`${t}?token=${r.token}`),t}function D(e){const t={url:x(e),name:e.title};if((0,c.i)(e.renderingRule)||(t.renderingRule=e.renderingRule.toJSON()),(0,c.i)(e.definitionExpression))(0,c.i)(e.mosaicRule)||(t.mosaicRule=e.mosaicRule.toJSON?.());else{let r=e.mosaicRule;(0,c.i)(r)||(r=r.clone(),r.where=e.definitionExpression,t.mosaicRule=r.toJSON())}return t}function N(e,t){if((0,c.i)(e?.url)||(0,c.i)(t))return;const r=I(e.url),n=t.find((e=>e.url===r))?.id;return n}async function w(e){if((0,c.i)(e?.url))return;const t=i.clone(e);let r;t.name||(t.name=function(e){const t=e.split("/");return t[t.length-2]}(t.url));try{r=await s.default.fromArcGISServerUrl({url:I(e.url),properties:{renderingRule:e.renderingRule,mosaicRule:e.mosaicRule}}),r.name=e.name}catch(e){}return r}async function S(e){const t=e?.url,r=e?.name;if((0,c.i)(t))return;let n;try{n=await s.default.fromArcGISServerUrl({url:I(t)}),n.name=r}catch(e){console.error("Failed to load feature layer from RFT JSON.")}return n}function U(e){return e?.toLocaleLowerCase().indexOf("f")>=0}function X(e){const t=e&&(e.extent||e.fullExtent);if((0,c.i)(t))return;const{xmin:r,ymin:n,xmax:i,ymax:a,spatialReference:s}=t,{wkid:o,latestWkid:l,wkt:u}=s,h={xmin:r,ymin:n,xmax:i,ymax:a};return(0,c.i)(o)||A(h,"spatialReference.wkid",o),(0,c.i)(l)||A(h,"spatialReference.latestWkid",l),(0,c.i)(u)||A(h,"spatialReference.wkt",u),h}async function P(e){if((0,c.i)(e))return Promise.resolve(void 0);const t=await e.queryFeatures({returnGeometry:!0,where:"1 = 1"});if((0,c.i)(t))return Promise.resolve(void 0);const r=t.features?.map((e=>e?.geometry));return r}function M(e){const t=e?.rasterInfo?.keyProperties?.ChangeAnalysisParameters,r=t?.AnalysisType;return"CCDC"===r}function k(e){return e.filter((e=>function(e){let t=!0;return!1===e.sourceJSON?.allowAnalysis&&(t=!1),(e.portalItem?.typeKeywords?.includes("Hosted Service")??!1)&&(t=!!e.portalItem.isOrgItem||t),t}(e)))}function b(e,t){const r=JSON.stringify(t);return new o.default({url:e,raster:btoa((0,l.t)(r))})}},4403:(e,t,r)=>{r.r(t),r.d(t,{rfx_analysis_wrapper:()=>o});var n=r(19451),i=r(48302),a=r(81279),s=(r(34319),r(5660));r(99248),r(16888),r(95323),r(43278),r(86944),r(83345),r(74656),r(95876);const o=class{constructor(e){(0,n.r)(this,e),this.analysisToolDataChange=(0,n.c)(this,"analysisToolDataChange",7),this.analysisToolClose=(0,n.c)(this,"analysisToolclose",7),this.analysisUnsupportedFunction=(0,n.c)(this,"analysisUnsupportedFunction",7),this.analysisRFxHelpPopoverChange=(0,n.c)(this,"analysisRFxHelpPopoverChange",7),this.analysisRFxBrowseLayerClick=(0,n.c)(this,"analysisRFxBrowseLayerClick",7),this.hasGlobalFunctionInRFT=!1,this.handlePreviewSelectionChange=e=>{this.editorComponent.rfxTemplate=e.detail},this.handlePreviewHelpClick=e=>{const{referenceElement:t,helpSrcdoc:r,heading:n}=e.detail,s=this.portal?.sourceJSON?.helpBase||a.j.learnMoreDocBaseURL,o=`${a.j.learnMoreDocDefaultHelpID}${a.j.learnMoreDocPreviewHelpID}`,l=(0,i.f)(o,s,this.locale);this.analysisRFxHelpPopoverChange.emit({referenceElement:t,helpSrcdoc:r,heading:n,learnMoreUrl:l})},this.rfxTemplate=void 0,this.functionName=void 0,this.usePanel=!0,this.mapLayers=void 0,this.mapView=void 0,this.user=void 0,this.portal=void 0}async onMapLayersChange(){this.rfxTemplate=await this.getUpdatedRFTWithValues()??this.rfxTemplate}async getUpdatedRFTWithValues(){return this.editorComponent?.getUpdatedRFTWithValues()}async validateRFx(){return this.editorComponent?.checkTemplateValidity()}async componentWillLoad(){const{locale:e,rtl:t}=(0,i.g)(this.hostElement);this.locale=e,this.dir=(0,i.a)(t),void 0===this.rfxTemplate&&void 0!==this.functionName&&(this.rfxTemplate=await(0,a.d)(this.functionName)),this.hasGlobalFunctionInRFT=await(0,a.i)(this.rfxTemplate,this.locale)}renderArgsEditor(){const{imageryLayers:e,featureLayers:t}=this.getFilteredLayerList(this.mapLayers);return(0,n.h)("rfx-args-editor",{ref:e=>this.editorComponent=e,rfxTemplate:this.rfxTemplate,imageryLayers:e,featureLayers:t,mapView:this.mapView,onRfxArgHelpClick:e=>{const{referenceElement:t,helpSrcdoc:r,heading:n}=e.detail;this.analysisRFxHelpPopoverChange.emit({referenceElement:t,helpSrcdoc:r,heading:n})},onRfxBrowseClick:e=>{this.analysisRFxBrowseLayerClick.emit(e.detail)},onRfxUnsupportedFunctionFound:()=>this.analysisUnsupportedFunction.emit()})}getFilteredLayerList(e){const t=[],r=[];return e?.forEach((e=>{"imagery"!==e.type&&"imagery-tile"!==e.type||function(e){return!(!e.raster||!e.url?.toLowerCase().includes("/rasterrendering/imageserver"))}(e)?"feature"===e.type&&r.push(e):t.push(e)})),{imageryLayers:(0,s.n)(t),featureLayers:r}}renderPreviewElement(){return(0,n.h)("rfx-preview",{mapView:this.mapView,portal:this.portal,getTemplate:()=>this.getUpdatedRFTWithValues(),onRfxPreviewSelection:this.handlePreviewSelectionChange,onPreviewHelpClick:this.handlePreviewHelpClick})}render(){return(0,n.h)(n.H,null,!0===this.usePanel?(0,n.h)("calcite-panel",{dir:this.dir,heading:this.rfxTemplate.name,closable:!0,onCalcitePanelClose:()=>this.analysisToolClose.emit()},this.renderArgsEditor()):(0,n.h)("div",null,this.renderArgsEditor(),!1===this.hasGlobalFunctionInRFT?this.renderPreviewElement():void 0))}get hostElement(){return(0,n.a)(this)}static get watchers(){return{mapLayers:["onMapLayersChange"]}}};r(36676),r(77162),r(48363),r(46574),r(46717),r(55139),r(57098),r(78979),r(32804),r(53248)}}]);