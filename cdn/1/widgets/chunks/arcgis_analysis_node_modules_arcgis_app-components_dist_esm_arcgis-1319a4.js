"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-1319a4"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-input_7.entry.js":
/*!***********************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-color-input_7.entry.js ***!
  \***********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_color_input: () => (/* binding */ ArcgisColorInput),
/* harmony export */   arcgis_popup_color_popover: () => (/* binding */ ArcgisPopupColorPopover),
/* harmony export */   arcgis_popup_styler_popover: () => (/* binding */ ArcgisPopupStylerPopover),
/* harmony export */   arcgis_symbol_picker_file_upload: () => (/* binding */ ArcgisSymbolStylerFileUpload),
/* harmony export */   arcgis_symbol_styler_color_ramp_input: () => (/* binding */ ArcgisSymbolStylerColorRampInput),
/* harmony export */   arcgis_symbol_styler_section: () => (/* binding */ ArcgisSymbolStylerSection),
/* harmony export */   arcgis_symbol_styler_symbol_preview: () => (/* binding */ ArcgisSymbolStylerSymbolPreview)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _storage_0353a769_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./storage-0353a769.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _popupStore_85381453_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./popupStore-85381453.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popupStore-85381453.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./colorRampUtils-8d9a3bed.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/colorRampUtils-8d9a3bed.js");
/* harmony import */ var _color_16791b45_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./color-16791b45.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/color-16791b45.js");
/* harmony import */ var _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./symbolUtils-f207d979.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolUtils-f207d979.js");
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */













const CSS$3 = {
    recent: "recent",
    preview: "preview",
    colorPickerContainer: "color-picker-container"
};
const defaultColor = "#d00b33";

const arcgisColorInputCss = ":host,arcgis-symbol-styler-inline-input{display:block}.color-picker-container{display:flex;flex-direction:column}.color-picker{--calcite-color-border-1:transparent;overflow-x:hidden}[slot=preview] calcite-color-picker-swatch{width:100%;height:24px}.recent{align-items:center;border:1px solid #949494;display:flex;gap:8px;height:32px;padding:0px 6px;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out}.recent:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.recent calcite-color-picker-swatch:not([active]){cursor:pointer}.recent calcite-color-picker-swatch:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.recent calcite-color-picker-swatch:focus[active]{border-radius:100%}.empty-swatch{cursor:default}calcite-tooltip:not([open]){visibility:hidden;pointer-events:none}";

const ArcgisColorInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisColorInputChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisColorInputChange", 7);
        this.arcgisInternalColorInputStoredColor = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisInternalColorInputStoredColor", 7);
        this.arcgisColorInputPopoverOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisColorInputPopoverOpen", 7);
        this.arcgisColorInputPopoverClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisColorInputPopoverClose", 7);
        //--------------------------------------------------------------------------
        //
        //  Event Listeners
        //
        //--------------------------------------------------------------------------
        this.focusHandler = (event) => {
            this.activeEl = event.target;
        };
        //--------------------------------------------------------------------------
        //
        //  Private Methods
        //
        //--------------------------------------------------------------------------
        this.onClose = (event) => {
            var _a;
            this.storeRecentColorToStorage((_a = this.colorPickerEl) === null || _a === void 0 ? void 0 : _a.value);
            event.stopPropagation();
            this.arcgisColorInputPopoverClose.emit();
        };
        this.handleSwatchClickOrKeyUp = (event) => {
            if ("key" in event && event.key !== "Enter" && event.key !== "Space") {
                return;
            }
            const swatch = event.currentTarget;
            const selected = swatch.color;
            this.updateColor(selected);
            setTimeout(() => this.recentColor1El.focus(), 200);
        };
        this.recentColorsKeyDownHandler = (event) => {
            if (this.recentColors.length === 1) {
                return;
            }
            const key = event.key;
            let activeRecentColorIndex;
            if (this.activeEl === this.recentColor1El) {
                activeRecentColorIndex = 1;
            }
            else if (this.activeEl === this.recentColor2El) {
                activeRecentColorIndex = 2;
            }
            else if (this.activeEl === this.recentColor3El) {
                activeRecentColorIndex = 3;
            }
            if (key === "ArrowLeft") {
                if (!activeRecentColorIndex || activeRecentColorIndex === 1) {
                    this[`recentColor${this.recentColors.length}El`].focus();
                }
                else {
                    this[`recentColor${activeRecentColorIndex - 1}El`].focus();
                }
            }
            if (key === "ArrowRight") {
                if (!activeRecentColorIndex || activeRecentColorIndex === this.recentColors.length) {
                    this.recentColor1El.focus();
                }
                else {
                    this[`recentColor${activeRecentColorIndex + 1}El`].focus();
                }
            }
        };
        this.setInlineInputRef = (el) => {
            this.inlineInputEl = el;
        };
        this.setColorPickerRef = (el) => {
            if (el) {
                this.colorPickerEl = el;
            }
            // we get a second call of this with el=null e.g. when toggling on background color in Map Viewer
        };
        this.setRecentColorRef1 = (el) => {
            if (el) {
                this.recentColor1El = el;
            }
        };
        this.setRecentColorRef2 = (el) => {
            if (el) {
                this.recentColor2El = el;
            }
        };
        this.setRecentColorRef3 = (el) => {
            if (el) {
                this.recentColor3El = el;
            }
        };
        this.onOpen = () => {
            var _a;
            (_a = this.colorPickerEl) === null || _a === void 0 ? void 0 : _a.setFocus();
            this.arcgisColorInputPopoverOpen.emit();
        };
        this.handleClear = () => {
            this.updateColor(null);
        };
        this.clearable = false;
        this.color = defaultColor;
        this.compact = false;
        this.disabled = false;
        this.placement = "auto";
        this.popoverProps = undefined;
        this.storageId = undefined;
        this.recentColors = [];
    }
    storedColorHandler(event) {
        if (!event.composedPath().includes(this.el)) {
            this.setRecentColorsFromStorage();
        }
    }
    arcgisRecentColorsUpdateHandler({ detail }) {
        this.storeRecentColorToStorage(detail);
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        await ((_a = this.inlineInputEl) === null || _a === void 0 ? void 0 : _a.setFocus());
    }
    async close() {
        await this.inlineInputEl.close();
    }
    updateColor(color, save = true) {
        if (color === this.color) {
            return;
        }
        this.color = color;
        this.arcgisColorInputChange.emit();
        if (save) {
            this.storeRecentColorToStorage(color);
        }
    }
    storeRecentColorToStorage(color) {
        if (!color) {
            return;
        }
        const recentColors = [color, ...this.recentColors.filter((recent) => recent !== color)].slice(0, 3);
        (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_2__.s)(this.storageId, recentColors, true);
        this.recentColors = recentColors;
        this.arcgisInternalColorInputStoredColor.emit();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        [this.strings] = await (0,_locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.el);
        this.setRecentColorsFromStorage();
    }
    setRecentColorsFromStorage() {
        const recentColors = (0,_storage_0353a769_js__WEBPACK_IMPORTED_MODULE_2__.g)(this.storageId, true);
        if (recentColors) {
            this.recentColors = [...recentColors];
        }
    }
    disconnectedCallback() {
        this.removeTooltip();
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { compact, disabled, recentColors, strings } = this;
        const recents = [recentColors[0], recentColors[1]];
        const rtl = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.el) === "rtl";
        if (!compact) {
            recents.push(recentColors[2]);
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler-inline-input", { disabled: disabled, intlDone: strings.commitColor, heading: strings.selectColor, label: strings.selectColor, onArcgisSymbolStylerInlineInputClose: this.onClose, onArcgisSymbolStylerInlineInputOpen: this.onOpen, popoverProps: this.popoverProps, ref: this.setInlineInputRef }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$3.colorPickerContainer, slot: "content" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker", { allowEmpty: this.clearable, class: "color-picker", key: `color-picker${compact ? "--compact" : ""}`, onCalciteColorPickerInput: (event) => {
                this.updateColor(this.colorPickerEl.value, false);
                event.stopPropagation();
            }, ref: this.setColorPickerRef, scale: compact ? "s" : "m", storageId: this.storageId, value: this.color })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "preview" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker-swatch", { color: this.color, scale: "s" })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": strings.recentColors, class: CSS$3.recent, onKeyDown: this.recentColorsKeyDownHandler, slot: "content-end", tabindex: -1 }, recents.map((recent, index) => {
            return recent ? ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker-swatch", { active: recent === this.color, color: recent, key: recent, onClick: this.handleSwatchClickOrKeyUp, onFocus: this.focusHandler, onKeyUp: this.handleSwatchClickOrKeyUp, ref: this[`setRecentColorRef${index + 1}`], role: "button", scale: "s", tabindex: 0 })) : (this.renderEmptySwatch(`empty-swatch-${index}`));
        })), this.clearable && [
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { icon: "circle-disallowed",
                //id="no-input-button"
                scale: "s", label: strings.clearColor, text: strings.clearColor, ref: (node) => (this.actionEl = node), onClick: this.handleClear, onMouseOver: () => this.addTooltip({
                    referenceElement: this.actionEl,
                    placement: rtl ? "right-start" : "left-start",
                    innerHTML: strings.noColor
                }), onMouseOut: () => this.removeTooltip() }))
        ])));
    }
    renderEmptySwatch(key) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { class: "empty-swatch", viewBox: "0 0 20 20", xmlns: "http://www.w3.org/2000/svg", width: "20", key: key }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { width: "20", height: "20", fill: "#f8f8f8", stroke: "#000", "stroke-dasharray": "2" })));
    }
    addTooltip(props) {
        this.removeTooltip();
        this.tooltipEl = document.createElement("calcite-tooltip");
        this.tooltipEl.placement = props.placement || "auto";
        this.tooltipEl.referenceElement = props.referenceElement;
        this.tooltipEl.overlayPositioning = "fixed";
        this.tooltipEl.innerHTML = props.innerHTML;
        this.tooltipEl.open = true;
        // it won't show if just added to this.el
        this.el.parentElement.appendChild(this.tooltipEl);
    }
    removeTooltip() {
        var _a;
        if ((_a = this.tooltipEl) === null || _a === void 0 ? void 0 : _a.parentNode) {
            this.tooltipEl.parentNode.removeChild(this.tooltipEl);
            this.tooltipEl = undefined;
        }
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisColorInput.style = arcgisColorInputCss;

const ArcgisPopupColorPopover = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisPopupColorPopoverClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPopupColorPopoverClose", 7);
        this.arcgisPopupColorPopoverOpen = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPopupColorPopoverOpen", 7);
        this.arcgisPopupColorPopoverChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPopupColorPopoverChange", 7);
        this.closedWithEvent = false;
        //--------------------------------------------------------------------------
        //
        //  Private Methods
        //
        //--------------------------------------------------------------------------
        this.handlePanelDismissedChange = (event) => {
            const panel = event.currentTarget;
            if (panel.closed) {
                this.close();
                panel.closed = false;
            }
            event.stopPropagation();
        };
        this.handleDone = () => {
            this.close();
        };
        this.handlePopoverOpen = (event) => {
            this.arcgisPopupColorPopoverOpen.emit();
            event.stopPropagation();
        };
        this.handlePopoverClose = (event) => {
            this.arcgisPopupColorPopoverClose.emit();
            this.closedWithEvent = true;
            event.stopPropagation();
        };
        this.handlePopoverKeyUp = ({ key }) => {
            if (key === "Escape") {
                this.close();
            }
        };
        this.disabled = false;
        this.heading = undefined;
        this.intlDone = undefined;
        this.label = undefined;
        this.hexColor = undefined;
        this.popoverProps = undefined;
        this.open = false;
    }
    disabledChanged(value) {
        if (value && this.open) {
            this.close();
        }
    }
    onInlineInputOpen(event) {
        if (!this.open) {
            return;
        }
        if (!event.composedPath().includes(this.el)) {
            this.open = false;
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.panelElement) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    async close() {
        this.open = false;
        this.arcgisPopupColorPopoverClose.emit();
        this.closedWithEvent = true;
    }
    async setOpen(open) {
        this.open = open;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle Methods
    //
    //--------------------------------------------------------------------------
    disconnectedCallback() {
        if (!this.closedWithEvent) {
            this.arcgisPopupColorPopoverClose.emit();
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { popoverProps } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { pointerDisabled: true, onKeyUp: this.handlePopoverKeyUp, label: this.label, offsetDistance: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.offsetDistance) || 0, offsetSkidding: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.offsetSkidding) || 0, flipDisabled: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.flipDisabled) || false, open: this.open, overlayPositioning: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.overlayPositioning) || "fixed", referenceElement: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.refElement) || this.previewContainerEl, onCalcitePopoverClose: this.handlePopoverClose, onCalcitePopoverOpen: this.handlePopoverOpen, placement: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.placement) || "bottom" // setting to bottom (vs auto) to workaround absolute placement issue
            ,
            triggerDisabled: true }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { closable: true, onCalcitePanelClose: this.handlePanelDismissedChange, heading: this.heading, style: (popoverProps === null || popoverProps === void 0 ? void 0 : popoverProps.maxHeight) && { maxHeight: popoverProps.maxHeight }, ref: (node) => (this.panelElement = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-color-picker", { allowEmpty: false, onCalciteColorPickerInput: (event) => {
                const hexColor = event.target.value;
                this.arcgisPopupColorPopoverChange.emit(hexColor);
                event.stopPropagation();
            }, scale: "m", value: this.hexColor, storageId: "arcgis-symbol-styler-storage-colors" }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { appearance: "solid", scale: "m", slot: "footer", width: "full", label: this.intlDone, onClick: this.handleDone }, this.intlDone)))));
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "disabled": ["disabledChanged"]
    }; }
};

const arcgisPopupStylerPopoverCss = ".styler-panel{width:328px;min-height:300px}.styler-div{width:100%}";

const ArcgisPopupStylerPopover = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisPopupStylerPopoverClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPopupStylerPopoverClose", 7);
        this.arcgisPopupStylerPopoverDisconnected = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPopupStylerPopoverDisconnected", 7);
        // ====================================
        this.documentTabHandler = undefined;
        this.documentClickHandler = undefined;
        this.panelScrollHandler = undefined;
        // --------------------------------------------------------------------------
        //
        //  Private methods
        //
        // --------------------------------------------------------------------------
        this.onOpen = () => {
            requestAnimationFrame(() => this.setFocus());
        };
        this.referenceElement = undefined;
        this.open = false;
    }
    //--------------------------------------------------------------------------
    //
    //  public calls
    //
    //--------------------------------------------------------------------------
    async reposition() {
        var _a;
        (_a = this.popoverNode) === null || _a === void 0 ? void 0 : _a.reposition();
    }
    async setFocus() {
        var _a;
        (_a = this.closeActionNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    async setOpen(open) {
        var _a;
        if (this.popoverNode) {
            this.popoverNode.open = open;
            if (open) {
                (_a = this.panelNode) === null || _a === void 0 ? void 0 : _a.setFocus();
                this.popoverNode.reposition();
            }
        }
    }
    async addStyler(stylerNode) {
        if (this.contentNode) {
            this.contentNode.appendChild(stylerNode);
        }
    }
    async getPopoverRefElement() {
        return this.closeActionNode;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    componentWillLoad() {
        this.strings = _popupStore_85381453_js__WEBPACK_IMPORTED_MODULE_4__.p.strings;
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.closeActionNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    disconnectedCallback() {
        // in case popover got removed by just removing node from DOM
        this.arcgisPopupStylerPopoverDisconnected.emit();
    }
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { referenceElement, open, strings } = this;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "js-app-flyout" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-popover", { open: open, placement: "leading-start", offsetDistance: 0, offsetSkidding: 45, pointerDisabled: true, triggerDisabled: true, label: "", referenceElement: referenceElement, onCalcitePopoverOpen: this.onOpen, ref: (node) => (this.popoverNode = node) }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", {
            // need access to the close button dom to pass to symbol styler as reference element,
            // so can't use closable:true
            closable: false, heading: strings.chartStyle, class: "styler-panel", ref: (node) => (this.panelNode = node), onCalcitePanelClose: () => {
                this.arcgisPopupStylerPopoverClose.emit();
                // focus on info icon; wait so enter key doesn't re-open it
                setTimeout(() => referenceElement.parentElement.focus(), 300);
            }
        }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-action", { id: "symbol-styler-dismiss-button", slot: "header-actions-end", scale: "s", icon: "x", text: strings.close, onClick: () => this.arcgisPopupStylerPopoverClose.emit(), ref: (node) => (this.closeActionNode = node) }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "styler-div", ref: (node) => (this.contentNode = node) })))));
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisPopupStylerPopover.style = arcgisPopupStylerPopoverCss;

const arcgisSymbolPickerFileUploadCss = ":host{display:inline-block;background-color:white;width:100%;padding:20px 5px 15px 5px;border-color:var(--calcite-color-border-1);border-width:2px;border-style:dashed;box-sizing:border-box}.file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-color-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{font-size:0.9rem;margin-bottom:0.25rem}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}";

const ArcgisSymbolStylerFileUpload = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSymbolPickerFileUploadChange = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolPickerFileUploadChange", 7);
        this.arcgisSymbolPickerFileUploadInvalidFile = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolPickerFileUploadInvalidFile", 7);
        this.arcgisSymbolPickerFileUploadError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSymbolPickerFileUploadError", 7);
        //--------------------------------------------------------------------------
        //
        //  Private Methods
        //
        //--------------------------------------------------------------------------
        this.handleDragOver = (event) => {
            event.preventDefault();
        };
        this.handleDrop = (event) => {
            event.preventDefault();
            this.processFile(event.dataTransfer.files[0]);
        };
        this.handleFileInputChange = async (event) => {
            await this.processFile(event.target.files[0]);
        };
        this.portal = undefined;
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    // --------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step", "aria-label": this.strings.fileUpload.dragDrop, onDragOver: this.handleDragOver, onDragEnter: this.handleDragOver, onDrop: this.handleDrop }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "file-step__drag-text", "aria-label": this.strings.fileUpload.dragDrop }, this.strings.fileUpload.dragDrop), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: "file-step__browse-button", appearance: "transparent", iconStart: "image", onClick: () => {
                this.fileInput.click();
            } }, this.strings.fileUpload.browse), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("input", { ref: (el) => {
                this.fileInput = el;
            }, onChange: this.handleFileInputChange, class: "file-step__file-input", type: "file", accept: ".jpg,.gif,.png,.svg,image/jpg,image/gif,image/png,image/svg+xml" }))));
    }
    async processFile(file) {
        const { portal } = this;
        if (!file) {
            return;
        }
        if (file) {
            if (!this.isValidFile(file)) {
                this.arcgisSymbolPickerFileUploadInvalidFile.emit();
                return;
            }
            if (this.isSVGFile(file)) {
                const [symbolService] = await (0,_loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_5__.l)(["esri/rest/symbolService"]);
                const symbolServiceUrl = portal.helperServices.symbols.url;
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const params = { svgImage: event.target.result };
                    symbolService.generateSymbol(symbolServiceUrl, params).then((result) => {
                        this.arcgisSymbolPickerFileUploadChange.emit({
                            cim: result.symbol,
                            fileName: file.name || "",
                            width: result.symbol.width,
                            height: result.symbol.height
                        });
                    });
                };
                reader.readAsText(file);
            }
            else {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    var image = new Image();
                    image.src = event.target.result;
                    image.onload = () => {
                        this.arcgisSymbolPickerFileUploadChange.emit({
                            dataURL: event.target.result,
                            fileName: file.name || "",
                            width: image.width,
                            height: image.height
                        });
                    };
                    image.onerror = () => {
                        this.arcgisSymbolPickerFileUploadError.emit();
                    };
                };
                reader.readAsDataURL(file);
            }
        }
    }
    isValidFile(file) {
        return (file === null || file === void 0 ? void 0 : file.name) && /\.(gif|jpg|jpeg|png|svg)$/i.test(file.name);
    }
    isSVGFile(file) {
        return (file === null || file === void 0 ? void 0 : file.name) && /\.(svg)$/i.test(file.name);
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSymbolStylerFileUpload.style = arcgisSymbolPickerFileUploadCss;

const CSS$2 = {
    recent: "recent",
    preview: "preview",
    colorPickerContainer: "color-picker-container"
};

let rampId = 0;
const CSS$1 = {
    colorRampItem: "color-ramp-item"
};
const ColorRampItem = ({ stops, style = "continuous", name, layout = "vertical", width = 20, height = 70 }) => {
    const id = `${rampId++}-color-ramp-gradient`;
    const gradientTransform = layout === "vertical" ? "rotate(90)" : "";
    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { title: name, class: CSS$1.colorRampItem },
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { xmlns: "http://www.w3.org/2000/svg", height: height, width: width },
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null,
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("linearGradient", { id: id, gradientTransform: gradientTransform }, style === "continuous" ? getGradientStops(stops) : getSolidStops(stops))),
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { x: "0", y: "0", fill: `url('#${id}')`, width: "100%", height: "100%" }))));
};
function getGradientStops(stops) {
    const colorOffset = 1 / (stops.length - 1);
    return stops.slice().map(({ r, g, b }, index) => {
        const offset = index * colorOffset * 100;
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("stop", { "stop-color": `rgb(${r}, ${g}, ${b})`, offset: `${offset}%` });
    });
}
function getSolidStops(stops) {
    const colorOffset = 1 / stops.length;
    const colors = [];
    stops.slice().forEach(({ r, g, b }, index) => {
        const offset = index * colorOffset * 100;
        const nextOffset = (index + 1) * colorOffset * 100;
        colors.push((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("stop", { "stop-color": `rgb(${r}, ${g}, ${b})`, offset: `${offset}%` }), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("stop", { "stop-color": `rgb(${r}, ${g}, ${b})`, offset: `${nextOffset}%` }));
    });
    return colors;
}

const CSS = {
    colorRampItem: "color-ramp-item"
};
const RelationshipRampColorRampItem = ({ stops, name, opacity = null, size = 48 }) => {
    const { svgUtils } = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_8__.e;
    // rendering logic, types and utils are based on JS API ramp rendering from Legend
    // these will be refactored after some utils are made public: https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/32811/
    const numClasses = Math.sqrt(stops.length);
    const colors = (0,_colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.E)(stops);
    const rotation = 0;
    const surfaceSize = Math.sqrt(Math.pow(size, 2) + Math.pow(size, 2)) + (0 ); // diagonal length + 5px padding for arrows
    let opacityStyle = null;
    if (opacity != null) {
        opacityStyle = { opacity: `${opacity}` };
    }
    const defs = [];
    const squares = [];
    const bboxes = [];
    const groupSize = size || 75;
    const cellSize = groupSize / numClasses;
    for (let i = 0; i < numClasses; i++) {
        const y = i * cellSize;
        for (let j = 0; j < numClasses; j++) {
            const x = j * cellSize;
            const fillAttrs = generateFillAttributes(colors[i][j]);
            const strokeAttrs = generateStrokeAttributes(null);
            const shape = {
                type: "rect",
                x,
                y,
                width: cellSize,
                height: cellSize
            };
            defs.push(renderDef(fillAttrs));
            squares.push(renderShape(shape, fillAttrs.fill, strokeAttrs, null));
            bboxes.push(svgUtils.getBoundingBox(shape));
        }
    }
    let svgStyle = null;
    const bbox = svgUtils.computeBBox(bboxes);
    const rectMatrix = svgUtils.getTransformMatrix(bbox, surfaceSize, surfaceSize, 0, false, rotation);
    return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("span", { title: name, class: CSS.colorRampItem },
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { style: opacityStyle },
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("svg", { width: surfaceSize, height: surfaceSize, style: svgStyle, xmlns: "http://www.w3.org/2000/svg" },
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("defs", null, defs),
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("g", { transform: rectMatrix }, squares)))));
};
function renderDef(attrs) {
    const { pattern, linearGradient } = attrs;
    if (pattern) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("pattern", { id: pattern.id, patternUnits: "userSpaceOnUse", x: pattern.x, y: pattern.y, width: pattern.width, height: pattern.height },
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("image", { x: pattern.image.x, y: pattern.image.y, width: pattern.image.width, height: pattern.image.height, href: pattern.image.href })));
    }
    if (linearGradient) {
        const stops = linearGradient.stops.map((stop, index) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("stop", { key: `${index}-stop`, offset: stop.offset, "stop-color": stop.color })));
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("linearGradient", { id: linearGradient.id, gradientUnits: "userSpaceOnUse", x1: linearGradient.x1, y1: linearGradient.y1, x2: linearGradient.x2, y2: linearGradient.y2 }, stops));
    }
    return null;
}
function getSvgPathFromCommandObjects(commandObjects) {
    return commandObjects
        .map((commandObj) => `${commandObj.command} ${commandObj.values.join(" ")}`)
        .join(" ")
        .trim();
}
let patternCount = 0;
let linearGradientCount = 0;
function renderShape(shape, fill, stroke, textAttrs) {
    if (shape) {
        if (shape.type === "circle") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("circle", { fill: fill, "fill-rule": "evenodd", stroke: stroke.color, "stroke-width": stroke.width, "stroke-linecap": stroke.cap, "stroke-linejoin": stroke.join, "stroke-dasharray": stroke.dashArray, "stroke-miterlimit": "4", cx: shape.cx, cy: shape.cy, r: shape.r }));
        }
        if (shape.type === "ellipse") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("ellipse", { fill: fill, "fill-rule": "evenodd", stroke: stroke.color, "stroke-width": stroke.width, "stroke-linecap": stroke.cap, "stroke-linejoin": stroke.join, "stroke-dasharray": stroke.dashArray, "stroke-miterlimit": "4", cx: shape.cx, cy: shape.cy, rx: shape.rx, ry: shape.ry }));
        }
        if (shape.type === "rect") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("rect", { fill: fill, "fill-rule": "evenodd", stroke: stroke.color, "stroke-width": stroke.width, "stroke-linecap": stroke.cap, "stroke-linejoin": stroke.join, "stroke-dasharray": stroke.dashArray, "stroke-miterlimit": "4", x: shape.x, y: shape.y, width: shape.width, height: shape.height }));
        }
        if (shape.type === "image") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("image", { href: shape.src, x: shape.x, y: shape.y, width: shape.width, height: shape.height, preserveAspectRatio: "none" }));
        }
        if (shape.type === "path") {
            const path = typeof shape.path !== "string" ? getSvgPathFromCommandObjects(shape.path) : shape.path;
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("path", { fill: fill, "fill-rule": "evenodd", stroke: stroke.color, "stroke-width": stroke.width, "stroke-linecap": stroke.cap, "stroke-linejoin": stroke.join, "stroke-dasharray": stroke.dashArray, "stroke-miterlimit": "4", d: path }));
        }
        if (shape.type === "text") {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("text", { fill: fill, "fill-rule": "evenodd", stroke: stroke.color, "stroke-width": stroke.width, "stroke-linecap": stroke.cap, "stroke-linejoin": stroke.join, "stroke-dasharray": stroke.dashArray, "stroke-miterlimit": "4", "text-anchor": textAttrs.align, "text-decoration": textAttrs.decoration, kerning: textAttrs.kerning, rotate: textAttrs.rotate, "text-rendering": "auto", "font-style": textAttrs.font.style, "font-variant": textAttrs.font.variant, "font-weight": textAttrs.font.weight, "font-size": textAttrs.font.size, "font-family": textAttrs.font.family, x: shape.x, y: shape.y }, shape.text));
        }
    }
    return null;
}
function generateFillAttributes(fill) {
    const attrs = {
        fill: "none",
        pattern: null,
        linearGradient: null
    };
    if (fill) {
        if ("type" in fill && fill.type === "pattern") {
            const id = `patternId-${++patternCount}`;
            attrs.fill = `url(#${id})`;
            attrs.pattern = {
                id,
                x: fill.x,
                y: fill.y,
                width: fill.width,
                height: fill.height,
                image: {
                    x: 0,
                    y: 0,
                    width: fill.width,
                    height: fill.height,
                    href: fill.src
                }
            };
        }
        else if ("type" in fill && fill.type === "linear") {
            const id = `linearGradientId-${++linearGradientCount}`;
            attrs.fill = `url(#${id})`;
            attrs.linearGradient = {
                id,
                x1: fill.x1,
                y1: fill.y1,
                x2: fill.x2,
                y2: fill.y2,
                stops: fill.colors.map((stop) => ({
                    offset: stop.offset,
                    color: stop.color && (0,_color_16791b45_js__WEBPACK_IMPORTED_MODULE_7__.c)(stop.color).toString()
                }))
            };
        }
        else if (fill) {
            const color = (0,_color_16791b45_js__WEBPACK_IMPORTED_MODULE_7__.c)(fill);
            attrs.fill = color.toString();
        }
    }
    return attrs;
}
function generateStrokeAttributes(stroke) {
    const strokeAttrs = {
        color: "none",
        width: 1,
        cap: "butt",
        join: "4",
        dashArray: "none"
    };
    if (stroke) {
        if (stroke.width != null) {
            strokeAttrs.width = stroke.width;
        }
        if (stroke.cap) {
            strokeAttrs.cap = stroke.cap;
        }
        if (stroke.join) {
            strokeAttrs.join = stroke.join.toString();
        }
        if (stroke.color) {
            strokeAttrs.color = (0,_color_16791b45_js__WEBPACK_IMPORTED_MODULE_7__.c)(stroke.color).toString();
        }
        if (stroke.style) {
            let da = null;
            if (stroke.style in styleToDashArray) {
                da = styleToDashArray[stroke.style];
            }
            if (Array.isArray(da)) {
                da = da.slice(0);
                for (let i = 0; i < da.length; ++i) {
                    da[i] *= stroke.width;
                }
                if (stroke.cap !== "butt") {
                    for (let i = 0; i < da.length; i += 2) {
                        da[i] -= stroke.width;
                        if (da[i] < 1) {
                            da[i] = 1;
                        }
                    }
                    for (let i = 1; i < da.length; i += 2) {
                        da[i] += stroke.width;
                    }
                }
                da = da.join(",");
            }
            strokeAttrs.dashArray = da;
        }
    }
    return strokeAttrs;
}
const styleToDashArray = {
    solid: "none",
    shortdash: [4, 1],
    shortdot: [1, 1],
    shortdashdot: [4, 1, 1, 1],
    shortdashdotdot: [4, 1, 1, 1, 1, 1],
    dot: [1, 3],
    dash: [4, 3],
    longdash: [8, 3],
    dashdot: [4, 3, 1, 3],
    longdashdot: [8, 3, 1, 3],
    longdashdotdot: [8, 3, 1, 3, 1, 3]
};

const arcgisSymbolStylerColorRampInputCss = ".scroller{max-height:var(--scroller-max-height, 200px);overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}.color-ramp-item{display:inline-flex;flex-grow:1}.color-ramp-item svg{display:flex}.color-picker-container{display:flex;flex-direction:column}.color-picker-container arcgis-item-palette .palette{gap:20px}calcite-color-picker-swatch{width:200px}.section{display:flex;flex-direction:column;padding:12px;background-color:var(--arcgis-app-background)}.color-ramp-selection{padding:4px 20px 4px 4px;border:1px solid lightgray;border-top:none}.arcgis--rtl .color-ramp-selection{padding:4px 4px 4px 20px;}.color-ramp-flipper calcite-icon{margin:0 0.5rem}[slot=preview] .color-ramp-item{height:24px}";

const ArcgisSymbolStylerColorRampInput = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.setInlineInputRef = (el) => {
            this.inlineInputEl = el;
        };
        this.disabled = false;
        this.options = undefined;
        this.placement = "auto";
        this.popoverProps = undefined;
        this.strings = undefined;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        await ((_a = this.inlineInputEl) === null || _a === void 0 ? void 0 : _a.setFocus());
    }
    async close() {
        var _a;
        await ((_a = this.inlineInputEl) === null || _a === void 0 ? void 0 : _a.close());
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        const { disabled, strings } = this;
        const dir = (0,_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_3__.g)(this.el);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-symbol-styler-inline-input", { disabled: disabled, intlDone: strings.done, heading: strings.ramp, label: this.options.heading, popoverProps: this.popoverProps, ref: this.setInlineInputRef, class: {
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_3__.C.rtl]: dir === "rtl"
            } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: CSS$2.colorPickerContainer, slot: "content" }, this.renderRampsContent(this.options)), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "preview" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(ColorRampItem, { stops: this.options.colorRampStops.slice().reverse(), style: this.options.style, layout: "horizontal", height: "100%", width: "100%" })))));
    }
    renderRampsContent({ activeCategory, colorRamps, isSelected, onCategoryChange, onFlip, onSelect, style }) {
        const { strings } = this;
        const { categories, ramps } = this.getCategoriesAndColorRampsBySelectedCategory(activeCategory, colorRamps);
        const is2D = style === "2d";
        const rampFlipIcon = is2D ? "rotate" : "arrow-up-down";
        const rampFlipLabel = is2D ? strings.rotateColors : strings.flipColors;
        const rampItemRenderer = is2D ? RelationshipRampColorRampItem : ColorRampItem;
        const rampsPerRow = is2D ? 3 : 6;
        return [
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "section" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, this.strings.category, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-select", { width: "full", label: this.strings.category, onCalciteSelectChange: onCategoryChange }, categories.map((category) => ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-option", { value: category, label: strings.categories[category], selected: category === activeCategory }))))), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { class: _colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.C.colorRampFlipper, appearance: "transparent", onClick: (e) => {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    onFlip();
                }, scale: "s", width: "full" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-icon", { icon: rampFlipIcon, scale: "s", style: is2D ? { transform: "rotateY(180deg)" } : null }), rampFlipLabel)),
            (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: { [_colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.C.scroller]: true, [_colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.C.colorRampSelection]: true } }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-item-palette", { items: ramps, extraItemProps: { style }, ItemRenderer: rampItemRenderer, itemsPerRow: rampsPerRow, selected: isSelected, onArcgisItemSelect: onSelect }))
        ];
    }
    getCategoriesAndColorRampsBySelectedCategory(activeCategory, allRamps) {
        const activeTags = _colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.F[activeCategory];
        const activeRamps = allRamps.filter((colorRamp) => activeCategory === "all" || activeTags.some((tag) => colorRamp.tags.indexOf(tag) > -1));
        const usedTagsSet = new Set();
        allRamps.forEach((ramp) => ramp.tags.forEach((tag) => usedTagsSet.add(tag)));
        const categories = Object.keys(_colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.F).filter((category) => category === "all" || _colorRampUtils_8d9a3bed_js__WEBPACK_IMPORTED_MODULE_6__.F[category].some((tag) => usedTagsSet.has(tag)));
        return {
            categories,
            ramps: activeRamps
        };
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSymbolStylerColorRampInput.style = arcgisSymbolStylerColorRampInputCss;

const arcgisSymbolStylerSectionCss = ":host{display:flex;flex-direction:column;background-color:var(--arcgis-app-background);padding:16px 12px}:host([disabled]){opacity:var(--arcgis-app-disabled-opacity);pointer-events:none}:host([embedded]){padding:0}";

const ArcgisSymbolStylerSection = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.disabled = false;
        this.embedded = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Render Methods
    //
    //--------------------------------------------------------------------------
    render() {
        return (
        /* intentionally using attribute to avoid focusing container when !disabled */
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { tabindex: this.disabled ? -1 : "" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("slot", null)));
    }
};
ArcgisSymbolStylerSection.style = arcgisSymbolStylerSectionCss;

const arcgisSymbolStylerSymbolPreviewCss = ":host{display:inline-block}:host(.dark){background-color:#f3f3f3}";

const ArcgisSymbolStylerSymbolPreview = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        //--------------------------------------------------------------------------
        //
        //  Private Methods
        //
        //--------------------------------------------------------------------------
        this.updatePreview = (0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_9__.d)(async () => {
            var _a;
            const { symbol } = this;
            if (!symbol) {
                return;
            }
            const options = Object.assign({}, this.options);
            // we drop size to prevent a known rendering issue  https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/41790
            if (symbol.type === "cim" && symbol.data.symbol.type === "CIMPolygonSymbol") {
                delete options.size;
            }
            const printSymbol = symbol.clone();
            if (printSymbol.type === "picture-marker" && options.size && typeof options.size === "number") {
                // renderPreviewHTML doesn't work well with non-square PMS
                // change symbol to the size we need instead
                printSymbol.width = (printSymbol.width / printSymbol.height) * options.size;
                printSymbol.height = options.size;
            }
            const currentPreviewRender = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_8__.e.symbolUtils.renderPreviewHTML(printSymbol, options);
            this.lastPreviewRender = currentPreviewRender;
            const preview = await currentPreviewRender;
            const previewIsOutdated = this.lastPreviewRender !== currentPreviewRender;
            if (previewIsOutdated) {
                return;
            }
            (_a = this.lastPreview) === null || _a === void 0 ? void 0 : _a.remove();
            this.lastPreview = preview;
            this.el.shadowRoot.append(preview);
            this.backgroundTheme = _symbolUtils_f207d979_js__WEBPACK_IMPORTED_MODULE_8__.e.previewSymbol2D.getContrastingBackgroundTheme(symbol, 245);
        }, 250);
        this.backgroundTheme = "light";
        this.contrast = false;
        this.options = undefined;
        this.symbol = undefined;
    }
    watchSymbolAndOptions() {
        this.updatePreview();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentDidLoad() {
        await this.updatePreview();
    }
    render() {
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: { dark: this.contrast && this.backgroundTheme === "dark" } });
    }
    get el() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
    static get watchers() { return {
        "symbol": ["watchSymbolAndOptions"],
        "options": ["watchSymbolAndOptions"]
    }; }
};
ArcgisSymbolStylerSymbolPreview.style = arcgisSymbolStylerSymbolPreviewCss;



//# sourceMappingURL=arcgis-color-input_7.entry.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js":
/*!***********************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ createStore)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const appendToMap = (map, propName, value) => {
    const items = map.get(propName);
    if (!items) {
        map.set(propName, [value]);
    }
    else if (!items.includes(value)) {
        items.push(value);
    }
};
const debounce = (fn, ms) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = 0;
            fn(...args);
        }, ms);
    };
};

/**
 * Check if a possible element isConnected.
 * The property might not be there, so we check for it.
 *
 * We want it to return true if isConnected is not a property,
 * otherwise we would remove these elements and would not update.
 *
 * Better leak in Edge than to be useless.
 */
const isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;
const cleanupElements = debounce((map) => {
    for (let key of map.keys()) {
        map.set(key, map.get(key).filter(isConnected));
    }
}, 2000);
const stencilSubscription = () => {
    if (typeof _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g !== 'function') {
        // If we are not in a stencil project, we do nothing.
        // This function is not really exported by @stencil/core.
        return {};
    }
    const elmsToUpdate = new Map();
    return {
        dispose: () => elmsToUpdate.clear(),
        get: (propName) => {
            const elm = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.g)();
            if (elm) {
                appendToMap(elmsToUpdate, propName, elm);
            }
        },
        set: (propName) => {
            const elements = elmsToUpdate.get(propName);
            if (elements) {
                elmsToUpdate.set(propName, elements.filter(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            }
            cleanupElements(elmsToUpdate);
        },
        reset: () => {
            elmsToUpdate.forEach((elms) => elms.forEach(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f));
            cleanupElements(elmsToUpdate);
        },
    };
};

const unwrap = (val) => (typeof val === 'function' ? val() : val);
const createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {
    const unwrappedState = unwrap(defaultState);
    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));
    const handlers = {
        dispose: [],
        get: [],
        set: [],
        reset: [],
    };
    const reset = () => {
        var _a;
        // When resetting the state, the default state may be a function - unwrap it to invoke it.
        // otherwise, the state won't be properly reset
        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));
        handlers.reset.forEach((cb) => cb());
    };
    const dispose = () => {
        // Call first dispose as resetting the state would
        // cause less updates ;)
        handlers.dispose.forEach((cb) => cb());
        reset();
    };
    const get = (propName) => {
        handlers.get.forEach((cb) => cb(propName));
        return states.get(propName);
    };
    const set = (propName, value) => {
        const oldValue = states.get(propName);
        if (shouldUpdate(value, oldValue, propName)) {
            states.set(propName, value);
            handlers.set.forEach((cb) => cb(propName, value, oldValue));
        }
    };
    const state = (typeof Proxy === 'undefined'
        ? {}
        : new Proxy(unwrappedState, {
            get(_, propName) {
                return get(propName);
            },
            ownKeys(_) {
                return Array.from(states.keys());
            },
            getOwnPropertyDescriptor() {
                return {
                    enumerable: true,
                    configurable: true,
                };
            },
            has(_, propName) {
                return states.has(propName);
            },
            set(_, propName, value) {
                set(propName, value);
                return true;
            },
        }));
    const on = (eventName, callback) => {
        handlers[eventName].push(callback);
        return () => {
            removeFromArray(handlers[eventName], callback);
        };
    };
    const onChange = (propName, cb) => {
        const unSet = on('set', (key, newValue) => {
            if (key === propName) {
                cb(newValue);
            }
        });
        // We need to unwrap the defaultState because it might be a function.
        // Otherwise we might not be sending the right reset value.
        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));
        return () => {
            unSet();
            unReset();
        };
    };
    const use = (...subscriptions) => {
        const unsubs = subscriptions.reduce((unsubs, subscription) => {
            if (subscription.set) {
                unsubs.push(on('set', subscription.set));
            }
            if (subscription.get) {
                unsubs.push(on('get', subscription.get));
            }
            if (subscription.reset) {
                unsubs.push(on('reset', subscription.reset));
            }
            if (subscription.dispose) {
                unsubs.push(on('dispose', subscription.dispose));
            }
            return unsubs;
        }, []);
        return () => unsubs.forEach((unsub) => unsub());
    };
    const forceUpdate = (key) => {
        const oldValue = states.get(key);
        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));
    };
    return {
        state,
        get,
        set,
        on,
        onChange,
        use,
        dispose,
        reset,
        forceUpdate,
    };
};
const removeFromArray = (array, item) => {
    const index = array.indexOf(item);
    if (index >= 0) {
        array[index] = array[array.length - 1];
        array.length--;
    }
};

const createStore = (defaultState, shouldUpdate) => {
    const map = createObservableMap(defaultState, shouldUpdate);
    map.use(stencilSubscription());
    return map;
};



//# sourceMappingURL=index-05956cab.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popupStore-85381453.js":
/*!****************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/popupStore-85381453.js ***!
  \****************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   c: () => (/* binding */ clearPopupState),
/* harmony export */   p: () => (/* binding */ popupState)
/* harmony export */ });
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


const popupStore = (0,_index_05956cab_js__WEBPACK_IMPORTED_MODULE_0__.c)({
    layer: null,
    mapView: null,
    portal: null,
    config: null,
    strings: null,
    currentLanguage: null,
    currentLanguageIntl: null,
    serviceType: null,
    popupTemplate: null,
    layerHasAttachment: null,
    layerHasET: null,
    layerHasAttributes: null,
    layerHasCharts: null,
    layerHasImages: null,
    layerHasText: null,
    layerDisplayType: null,
    supportsArcade: null,
    layerHasRelatedRecords: false
});
// workaround for starting a panel with a clean state
function clearPopupState(popupState) {
    popupState.layer = null;
    popupState.mapView = null;
    popupState.portal = null;
    popupState.config = null;
    popupState.strings = null;
    popupState.currentLanguage = null;
    popupState.currentLanguageIntl = null;
    popupState.serviceType = null;
    popupState.popupTemplate = null;
    popupState.layerHasAttachment = null;
    popupState.layerHasET = null;
    popupState.layerHasAttributes = null;
    popupState.layerHasCharts = null;
    popupState.layerHasImages = null;
    popupState.layerHasText = null;
    popupState.layerDisplayType = null;
    popupState.supportsArcade = null;
    popupState.layerHasRelatedRecords = false;
}
const popupState = popupStore.state;



//# sourceMappingURL=popupStore-85381453.js.map

/***/ }),

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js":
/*!*************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/storage-0353a769.js ***!
  \*************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ setSessionStorageItem),
/* harmony export */   b: () => (/* binding */ getSessionStorageItem),
/* harmony export */   c: () => (/* binding */ getCookie),
/* harmony export */   d: () => (/* binding */ setCookie),
/* harmony export */   g: () => (/* binding */ getLocalStorageItem),
/* harmony export */   s: () => (/* binding */ setLocalStorageItem)
/* harmony export */ });
/* harmony import */ var _functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./functional-44de8fcf.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/functional-44de8fcf.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */


// import stringUtil from "./strings";
/**
 * Utility methods for dealing with storage of various forms (cookies, local storage, and session storage).
 */
function setCookie(name, cookie, properties, stringify) {
    writeCookie(name, stringify ? JSON.stringify(cookie) : cookie, properties);
}
function getCookie(name, parse) {
    const cookie = readCookie(name);
    return cookie && parse ? JSON.parse(cookie) : cookie;
}
function setLocalStorageItem(name, item, stringify) {
    window.localStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getLocalStorageItem(name, parse) {
    const item = window.localStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function setSessionStorageItem(name, item, stringify) {
    window.sessionStorage.setItem(name, stringify ? JSON.stringify(item) : item);
}
function getSessionStorageItem(name, parse) {
    const item = window.sessionStorage.getItem(name);
    return item && parse ? JSON.parse(item) : item;
}
function readCookie(name) {
    const cookie = document.cookie;
    const cookieNameRE = new RegExp(`(?:^|; )${(0,_functional_44de8fcf_js__WEBPACK_IMPORTED_MODULE_0__.e)(name)}=([^;]*)`);
    const matchedCookies = cookie.match(cookieNameRE);
    return matchedCookies ? decodeURIComponent(matchedCookies[1]) : undefined;
}
function writeCookie(name, value, properties) {
    properties = properties || {};
    let expires = properties === null || properties === void 0 ? void 0 : properties.expires;
    if (typeof expires === "number") {
        const expirationDate = new Date();
        const daysFromTodayInMs = expires * 24 * 60 * 60 * 1000;
        expirationDate.setTime(Date.now() + daysFromTodayInMs);
        expires = properties.expires = expirationDate;
    }
    if (typeof expires !== "string" && (expires === null || expires === void 0 ? void 0 : expires.toUTCString)) {
        properties.expires = expires.toUTCString();
    }
    let cookie = `${name}=${encodeURIComponent(value)}`;
    let property;
    for (property in properties) {
        cookie += `; ${property}`;
        const propertyValue = properties[property];
        if (propertyValue !== true) {
            cookie += `=${propertyValue}`;
        }
    }
    document.cookie = cookie;
}



//# sourceMappingURL=storage-0353a769.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLTEzMTlhNC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDNkc7QUFDdkM7QUFDcUI7QUFDVDtBQUN2QjtBQUNFO0FBQ21DO0FBQzlDO0FBQ1c7QUFDSjtBQUM5QjtBQUNFOztBQUU3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEscUVBQXFFLGNBQWMsd0JBQXdCLGFBQWEsc0JBQXNCLGNBQWMscUNBQXFDLGtCQUFrQiwyQ0FBMkMsV0FBVyxZQUFZLFFBQVEsbUJBQW1CLHlCQUF5QixhQUFhLFFBQVEsWUFBWSxnQkFBZ0IsNkVBQTZFLGNBQWMsNkNBQTZDLG1CQUFtQixrREFBa0QsZUFBZSwwQ0FBMEMsNkNBQTZDLG1CQUFtQixrREFBa0QsbUJBQW1CLGNBQWMsZUFBZSw0QkFBNEIsa0JBQWtCLG9CQUFvQjs7QUFFcDJCO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QixzQ0FBc0MscURBQVc7QUFDakQsbURBQW1ELHFEQUFXO0FBQzlELDJDQUEyQyxxREFBVztBQUN0RCw0Q0FBNEMscURBQVc7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHlCQUF5QjtBQUNoRTtBQUNBO0FBQ0EsdUNBQXVDLDJCQUEyQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywyQkFBMkI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsUUFBUTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1REFBbUI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHNEQUF5QjtBQUN4RDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsdURBQW1CO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDJDQUEyQztBQUMzRDtBQUNBLG9CQUFvQiw0REFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLHdDQUF3QyxpUkFBaVIsRUFBRSxxREFBQyxVQUFVLG9EQUFvRCxFQUFFLHFEQUFDLDJCQUEyQix1RUFBdUUsMkJBQTJCO0FBQ3poQjtBQUNBO0FBQ0EsYUFBYSx5R0FBeUcsSUFBSSxxREFBQyxVQUFVLGlCQUFpQixFQUFFLHFEQUFDLGtDQUFrQywrQkFBK0IsSUFBSSxxREFBQyxVQUFVLHdJQUF3STtBQUNqWCw2QkFBNkIscURBQUMsa0NBQWtDLHFNQUFxTSxVQUFVLDZDQUE2Qyw2Q0FBNkMsTUFBTTtBQUMvVyxTQUFTO0FBQ1QsWUFBWSxxREFBQyxVQUFVLHFCQUFxQixFQUFFLHFEQUFDLHFCQUFxQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDJDQUEyQztBQUM1RDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IscURBQUMsVUFBVSx5R0FBeUcsRUFBRSxxREFBQyxXQUFXLHFGQUFxRjtBQUN2TztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQztBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qiw0Q0FBNEMscURBQVc7QUFDdkQsMkNBQTJDLHFEQUFXO0FBQ3RELDZDQUE2QyxxREFBVztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLEtBQUs7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsZUFBZTtBQUMvQixnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxJQUFJLHdCQUF3QixFQUFFLHFEQUFDLHNCQUFzQjtBQUMzRTtBQUNBLG1DQUFtQyxFQUFFLHFEQUFDLG9CQUFvQiw4TEFBOEwsbUNBQW1DLDZDQUE2QyxFQUFFLHFEQUFDLDJCQUEyQjtBQUN0VztBQUNBO0FBQ0E7QUFDQSxhQUFhLHNGQUFzRixHQUFHLHFEQUFDLHFCQUFxQixnSEFBZ0g7QUFDNU87QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEMsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTs7QUFFQSxtREFBbUQsWUFBWSxpQkFBaUIsWUFBWSxXQUFXOztBQUV2RztBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsNkNBQTZDLHFEQUFXO0FBQ3hELG9EQUFvRCxxREFBVztBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzREFBVTtBQUNqQztBQUNBO0FBQ0Esc0NBQXNDLFFBQVEsd0ZBQXdGO0FBQ3RJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isa0NBQWtDO0FBQ2xELGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLElBQUksd0JBQXdCLEVBQUUscURBQUMsc0JBQXNCLHlQQUF5UCxFQUFFLHFEQUFDO0FBQ3ZVO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQSxTQUFTLEVBQUUscURBQUMscUJBQXFCLG9OQUFvTixHQUFHLHFEQUFDLFVBQVUsK0RBQStEO0FBQ2xVO0FBQ0Esd0JBQXdCLE9BQU8scURBQVU7QUFDekM7QUFDQTs7QUFFQSwrQ0FBK0MscUJBQXFCLHVCQUF1QixXQUFXLDBCQUEwQiwyQ0FBMkMsaUJBQWlCLG9CQUFvQixzQkFBc0IsV0FBVyxrQkFBa0Isd0JBQXdCLHFCQUFxQixtQkFBbUIsa0NBQWtDLHFDQUFxQyxXQUFXLFlBQVksc0JBQXNCLGlCQUFpQixzQkFBc0IsMEJBQTBCLGdCQUFnQix1QkFBdUIsYUFBYTs7QUFFNWlCO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QixrREFBa0QscURBQVc7QUFDN0QsdURBQXVELHFEQUFXO0FBQ2xFLGlEQUFpRCxxREFBVztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFEQUFDLFVBQVUsZ0tBQWdLLEVBQUUscURBQUMsY0FBYyxxREFBQyxVQUFVLCtFQUErRSxxQ0FBcUMscURBQUMscUJBQXFCO0FBQ2pXO0FBQ0EsZUFBZSxtQ0FBbUMscURBQUMsWUFBWTtBQUMvRDtBQUNBLGFBQWEsaUtBQWlLO0FBQzlLO0FBQ0E7QUFDQSxnQkFBZ0IsU0FBUztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsMkRBQVc7QUFDekQ7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGlGQUFpRjtBQUMxRyxrQkFBa0IsU0FBUztBQUMzQjtBQUNBLFlBQVkscURBQUMsV0FBVyx5Q0FBeUM7QUFDakUsUUFBUSxxREFBQyxVQUFVLG1FQUFtRTtBQUN0RixZQUFZLHFEQUFDO0FBQ2IsZ0JBQWdCLHFEQUFDLHFCQUFxQiw4Q0FBOEM7QUFDcEYsWUFBWSxxREFBQyxXQUFXLCtCQUErQixHQUFHLG9DQUFvQztBQUM5RjtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsU0FBUztBQUN6QztBQUNBLGVBQWUscURBQUMsV0FBVyxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGVBQWUsT0FBTyxJQUFJO0FBQ3hGLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixTQUFTO0FBQ3RDO0FBQ0E7QUFDQSxvQkFBb0IscURBQUMsV0FBVyxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGVBQWUsT0FBTyxJQUFJLEdBQUcscURBQUMsV0FBVyxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGVBQWUsV0FBVyxJQUFJO0FBQzdLLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5Qyx3Q0FBd0M7QUFDakYsWUFBWSxXQUFXLEVBQUUsdURBQVc7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDhEQUFRO0FBQzNCO0FBQ0EsaUZBQWlGO0FBQ2pGO0FBQ0E7QUFDQSx5QkFBeUIsWUFBWSxRQUFRO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQSx3QkFBd0IsZ0JBQWdCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscURBQUMsV0FBVyx1Q0FBdUM7QUFDL0QsUUFBUSxxREFBQyxVQUFVLHFCQUFxQjtBQUN4QyxZQUFZLHFEQUFDLFVBQVUsK0ZBQStGO0FBQ3RILGdCQUFnQixxREFBQztBQUNqQixnQkFBZ0IscURBQUMsUUFBUSx1QkFBdUI7QUFDaEQ7QUFDQTtBQUNBLFlBQVksMEJBQTBCO0FBQ3RDO0FBQ0EsZ0JBQWdCLHFEQUFDLGNBQWMsMEhBQTBIO0FBQ3pKLFlBQVkscURBQUMsWUFBWSw0SEFBNEg7QUFDcko7QUFDQTtBQUNBLGlFQUFpRSxxREFBQyxXQUFXLFFBQVEsTUFBTSx1REFBdUQ7QUFDbEosZ0JBQWdCLHFEQUFDLHFCQUFxQixvSkFBb0o7QUFDMUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxvQkFBb0IsRUFBRSw0QkFBNEI7QUFDbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixxREFBQyxhQUFhLDhQQUE4UDtBQUNoUztBQUNBO0FBQ0Esb0JBQW9CLHFEQUFDLGNBQWMsOFFBQThRO0FBQ2pUO0FBQ0E7QUFDQSxvQkFBb0IscURBQUMsV0FBVyx3UkFBd1I7QUFDeFQ7QUFDQTtBQUNBLG9CQUFvQixxREFBQyxZQUFZLGdIQUFnSDtBQUNqSjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IscURBQUMsV0FBVywrTkFBK047QUFDL1A7QUFDQTtBQUNBLG9CQUFvQixxREFBQyxXQUFXLGlrQkFBaWtCO0FBQ2ptQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsZUFBZTtBQUNuRCxpQ0FBaUMsR0FBRztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakUsaUNBQWlDLEdBQUc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxxREFBTTtBQUMvQyxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHFEQUFNO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxxREFBTTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGVBQWU7QUFDL0M7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLGVBQWU7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxlQUFlO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdURBQXVELDZDQUE2QyxnQkFBZ0IsZ0JBQWdCLGtCQUFrQixhQUFhLHVCQUF1QixpQkFBaUIsb0JBQW9CLFlBQVkscUJBQXFCLGFBQWEsd0JBQXdCLGFBQWEsc0JBQXNCLHFEQUFxRCxTQUFTLDRCQUE0QixZQUFZLFNBQVMsYUFBYSxzQkFBc0IsYUFBYSw4Q0FBOEMsc0JBQXNCLHlCQUF5QiwyQkFBMkIsZ0JBQWdCLG1DQUFtQywwQkFBMEIsaUNBQWlDLGdCQUFnQixnQ0FBZ0MsWUFBWTs7QUFFendCO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEMsb0JBQW9CLDREQUFhO0FBQ2pDLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsd0NBQXdDO0FBQ3ZFLGlCQUFpQix3REFBVztBQUM1QixlQUFlLEVBQUUscURBQUMsVUFBVSxvREFBb0QsMENBQTBDLHFEQUFDLFVBQVUsaUJBQWlCLEVBQUUscURBQUMsa0JBQWtCLHNJQUFzSTtBQUNqVDtBQUNBLHlCQUF5QixtRkFBbUY7QUFDNUcsZ0JBQWdCLFVBQVU7QUFDMUIsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHFEQUFDLFVBQVUsa0JBQWtCLEVBQUUscURBQUMsK0NBQStDLHFEQUFDLHFCQUFxQixzRkFBc0YsZ0NBQWdDLHFEQUFDLHFCQUFxQiw2RkFBNkYsT0FBTyxxREFBQyxxQkFBcUIsT0FBTywwREFBSztBQUNuWTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsNkJBQTZCLEVBQUUscURBQUMsbUJBQW1CLGdEQUFnRCwrQkFBK0IsUUFBUTtBQUMzSixZQUFZLHFEQUFDLFVBQVUsU0FBUyxDQUFDLDBEQUFLLG1CQUFtQiwwREFBSyw4QkFBOEIsRUFBRSxxREFBQywwQkFBMEIsZ0NBQWdDLE9BQU8sZ0hBQWdIO0FBQ2hSO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwwREFBZ0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDBEQUFnQiw2Q0FBNkMsMERBQWdCO0FBQ3BIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEM7QUFDQTs7QUFFQSw0Q0FBNEMsYUFBYSxzQkFBc0IsOENBQThDLGtCQUFrQixrQkFBa0IsMkNBQTJDLG9CQUFvQixrQkFBa0IsVUFBVTs7QUFFNVA7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHFEQUFDLENBQUMsaURBQUksSUFBSSxtQ0FBbUMsRUFBRSxxREFBQztBQUN4RDtBQUNBO0FBQ0E7O0FBRUEsa0RBQWtELHFCQUFxQixhQUFhLHlCQUF5Qjs7QUFFN0c7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsMERBQVE7QUFDckM7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5Qyx1REFBVztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsdURBQVc7QUFDOUMsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLHFEQUFDLENBQUMsaURBQUksSUFBSSxTQUFTLDBEQUEwRDtBQUM1RjtBQUNBLGVBQWUsT0FBTyxxREFBVTtBQUNoQyw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFa2I7O0FBRWxiOzs7Ozs7Ozs7Ozs7Ozs7QUMxNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQzZFOztBQUU3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsZUFBZSxpREFBZTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHFEQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsaURBQVc7QUFDdEU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLHdEQUF3RCxpREFBVztBQUNuRTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtIQUFrSDtBQUNsSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVHQUF1RztBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU0Qjs7QUFFNUI7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2TUE7QUFDQTtBQUNBO0FBQ0E7QUFDdUQ7O0FBRXZELG1CQUFtQixxREFBVztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWlEOztBQUVqRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDNkQ7O0FBRTdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxHQUFHLDBEQUFZLE9BQU8sS0FBSztBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsS0FBSyxHQUFHLDBCQUEwQjtBQUN0RDtBQUNBO0FBQ0EscUJBQXFCLEVBQUUsU0FBUztBQUNoQztBQUNBO0FBQ0EsMEJBQTBCLGNBQWM7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7O0FBRXNKOztBQUV0SiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy1jb2xvci1pbnB1dF83LmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL2luZGV4LTA1OTU2Y2FiLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9leHRlbnNpb25zL3dpZGdldHMvYXJjZ2lzL2FuYWx5c2lzL25vZGVfbW9kdWxlcy9AYXJjZ2lzL2FwcC1jb21wb25lbnRzL2Rpc3QvZXNtL3BvcHVwU3RvcmUtODUzODE0NTMuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vc3RvcmFnZS0wMzUzYTc2OS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyB9IGZyb20gJy4vbG9jYWxlLTA1MGI2ZGI5LmpzJztcbmltcG9ydCB7IHMgYXMgc2V0TG9jYWxTdG9yYWdlSXRlbSwgZyBhcyBnZXRMb2NhbFN0b3JhZ2VJdGVtIH0gZnJvbSAnLi9zdG9yYWdlLTAzNTNhNzY5LmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0RWxlbWVudERpciwgQyBhcyBDU1NfVVRJTElUWSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCB7IHAgYXMgcG9wdXBTdGF0ZSB9IGZyb20gJy4vcG9wdXBTdG9yZS04NTM4MTQ1My5qcyc7XG5pbXBvcnQgeyBsIGFzIGxvYWRNb2R1bGVzIH0gZnJvbSAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgeyBFIGFzIGV4cGFuZDJELCBDIGFzIENTUyQ0LCBGIGFzIGNhdGVnb3JpZXNUb1RhZ3MgfSBmcm9tICcuL2NvbG9yUmFtcFV0aWxzLThkOWEzYmVkLmpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlIH0gZnJvbSAnLi9jb2xvci0xNjc5MWI0NS5qcyc7XG5pbXBvcnQgeyBlIGFzIGVzcmlNb2R1bGVzIH0gZnJvbSAnLi9zeW1ib2xVdGlscy1mMjA3ZDk3OS5qcyc7XG5pbXBvcnQgeyBkIGFzIGRlYm91bmNlIH0gZnJvbSAnLi9mdW5jdGlvbmFsLTQ0ZGU4ZmNmLmpzJztcbmltcG9ydCAnLi9kb20tNGQzNjc2NzcuanMnO1xuaW1wb3J0ICcuL2luZGV4LTA1OTU2Y2FiLmpzJztcblxuY29uc3QgQ1NTJDMgPSB7XG4gICAgcmVjZW50OiBcInJlY2VudFwiLFxuICAgIHByZXZpZXc6IFwicHJldmlld1wiLFxuICAgIGNvbG9yUGlja2VyQ29udGFpbmVyOiBcImNvbG9yLXBpY2tlci1jb250YWluZXJcIlxufTtcbmNvbnN0IGRlZmF1bHRDb2xvciA9IFwiI2QwMGIzM1wiO1xuXG5jb25zdCBhcmNnaXNDb2xvcklucHV0Q3NzID0gXCI6aG9zdCxhcmNnaXMtc3ltYm9sLXN0eWxlci1pbmxpbmUtaW5wdXR7ZGlzcGxheTpibG9ja30uY29sb3ItcGlja2VyLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5jb2xvci1waWNrZXJ7LS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xOnRyYW5zcGFyZW50O292ZXJmbG93LXg6aGlkZGVufVtzbG90PXByZXZpZXddIGNhbGNpdGUtY29sb3ItcGlja2VyLXN3YXRjaHt3aWR0aDoxMDAlO2hlaWdodDoyNHB4fS5yZWNlbnR7YWxpZ24taXRlbXM6Y2VudGVyO2JvcmRlcjoxcHggc29saWQgIzk0OTQ5NDtkaXNwbGF5OmZsZXg7Z2FwOjhweDtoZWlnaHQ6MzJweDtwYWRkaW5nOjBweCA2cHg7dHJhbnNpdGlvbjpvdXRsaW5lLW9mZnNldCAxMDBtcyBlYXNlLWluLW91dCwgb3V0bGluZS1jb2xvciAxMDBtcyBlYXNlLWluLW91dH0ucmVjZW50OmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweH0ucmVjZW50IGNhbGNpdGUtY29sb3ItcGlja2VyLXN3YXRjaDpub3QoW2FjdGl2ZV0pe2N1cnNvcjpwb2ludGVyfS5yZWNlbnQgY2FsY2l0ZS1jb2xvci1waWNrZXItc3dhdGNoOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpO291dGxpbmUtb2Zmc2V0OjJweH0ucmVjZW50IGNhbGNpdGUtY29sb3ItcGlja2VyLXN3YXRjaDpmb2N1c1thY3RpdmVde2JvcmRlci1yYWRpdXM6MTAwJX0uZW1wdHktc3dhdGNoe2N1cnNvcjpkZWZhdWx0fWNhbGNpdGUtdG9vbHRpcDpub3QoW29wZW5dKXt2aXNpYmlsaXR5OmhpZGRlbjtwb2ludGVyLWV2ZW50czpub25lfVwiO1xuXG5jb25zdCBBcmNnaXNDb2xvcklucHV0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNDb2xvcklucHV0Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNDb2xvcklucHV0Q2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc0ludGVybmFsQ29sb3JJbnB1dFN0b3JlZENvbG9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNJbnRlcm5hbENvbG9ySW5wdXRTdG9yZWRDb2xvclwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNDb2xvcklucHV0UG9wb3Zlck9wZW4gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc0NvbG9ySW5wdXRQb3BvdmVyT3BlblwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNDb2xvcklucHV0UG9wb3ZlckNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNDb2xvcklucHV0UG9wb3ZlckNsb3NlXCIsIDcpO1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vICBFdmVudCBMaXN0ZW5lcnNcbiAgICAgICAgLy9cbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLmZvY3VzSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVFbCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgfTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5vbkNsb3NlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB0aGlzLnN0b3JlUmVjZW50Q29sb3JUb1N0b3JhZ2UoKF9hID0gdGhpcy5jb2xvclBpY2tlckVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWUpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc0NvbG9ySW5wdXRQb3BvdmVyQ2xvc2UuZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVN3YXRjaENsaWNrT3JLZXlVcCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKFwia2V5XCIgaW4gZXZlbnQgJiYgZXZlbnQua2V5ICE9PSBcIkVudGVyXCIgJiYgZXZlbnQua2V5ICE9PSBcIlNwYWNlXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzd2F0Y2ggPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBzd2F0Y2guY29sb3I7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbG9yKHNlbGVjdGVkKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZWNlbnRDb2xvcjFFbC5mb2N1cygpLCAyMDApO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlY2VudENvbG9yc0tleURvd25IYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZWNlbnRDb2xvcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qga2V5ID0gZXZlbnQua2V5O1xuICAgICAgICAgICAgbGV0IGFjdGl2ZVJlY2VudENvbG9ySW5kZXg7XG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVFbCA9PT0gdGhpcy5yZWNlbnRDb2xvcjFFbCkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVJlY2VudENvbG9ySW5kZXggPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5hY3RpdmVFbCA9PT0gdGhpcy5yZWNlbnRDb2xvcjJFbCkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVJlY2VudENvbG9ySW5kZXggPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5hY3RpdmVFbCA9PT0gdGhpcy5yZWNlbnRDb2xvcjNFbCkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVJlY2VudENvbG9ySW5kZXggPSAzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGtleSA9PT0gXCJBcnJvd0xlZnRcIikge1xuICAgICAgICAgICAgICAgIGlmICghYWN0aXZlUmVjZW50Q29sb3JJbmRleCB8fCBhY3RpdmVSZWNlbnRDb2xvckluZGV4ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbYHJlY2VudENvbG9yJHt0aGlzLnJlY2VudENvbG9ycy5sZW5ndGh9RWxgXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1tgcmVjZW50Q29sb3Ike2FjdGl2ZVJlY2VudENvbG9ySW5kZXggLSAxfUVsYF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoa2V5ID09PSBcIkFycm93UmlnaHRcIikge1xuICAgICAgICAgICAgICAgIGlmICghYWN0aXZlUmVjZW50Q29sb3JJbmRleCB8fCBhY3RpdmVSZWNlbnRDb2xvckluZGV4ID09PSB0aGlzLnJlY2VudENvbG9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNlbnRDb2xvcjFFbC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1tgcmVjZW50Q29sb3Ike2FjdGl2ZVJlY2VudENvbG9ySW5kZXggKyAxfUVsYF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2V0SW5saW5lSW5wdXRSZWYgPSAoZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5saW5lSW5wdXRFbCA9IGVsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNldENvbG9yUGlja2VyUmVmID0gKGVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoZWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yUGlja2VyRWwgPSBlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHdlIGdldCBhIHNlY29uZCBjYWxsIG9mIHRoaXMgd2l0aCBlbD1udWxsIGUuZy4gd2hlbiB0b2dnbGluZyBvbiBiYWNrZ3JvdW5kIGNvbG9yIGluIE1hcCBWaWV3ZXJcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXRSZWNlbnRDb2xvclJlZjEgPSAoZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChlbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZW50Q29sb3IxRWwgPSBlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXRSZWNlbnRDb2xvclJlZjIgPSAoZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChlbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZW50Q29sb3IyRWwgPSBlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXRSZWNlbnRDb2xvclJlZjMgPSAoZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChlbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZW50Q29sb3IzRWwgPSBlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vbk9wZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLmNvbG9yUGlja2VyRWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNDb2xvcklucHV0UG9wb3Zlck9wZW4uZW1pdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZUNsZWFyID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVDb2xvcihudWxsKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jbGVhcmFibGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICAgICAgdGhpcy5jb21wYWN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wbGFjZW1lbnQgPSBcImF1dG9cIjtcbiAgICAgICAgdGhpcy5wb3BvdmVyUHJvcHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RvcmFnZUlkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnJlY2VudENvbG9ycyA9IFtdO1xuICAgIH1cbiAgICBzdG9yZWRDb2xvckhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgaWYgKCFldmVudC5jb21wb3NlZFBhdGgoKS5pbmNsdWRlcyh0aGlzLmVsKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRSZWNlbnRDb2xvcnNGcm9tU3RvcmFnZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFyY2dpc1JlY2VudENvbG9yc1VwZGF0ZUhhbmRsZXIoeyBkZXRhaWwgfSkge1xuICAgICAgICB0aGlzLnN0b3JlUmVjZW50Q29sb3JUb1N0b3JhZ2UoZGV0YWlsKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgYXdhaXQgKChfYSA9IHRoaXMuaW5saW5lSW5wdXRFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCkpO1xuICAgIH1cbiAgICBhc3luYyBjbG9zZSgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbmxpbmVJbnB1dEVsLmNsb3NlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbG9yKGNvbG9yLCBzYXZlID0gdHJ1ZSkge1xuICAgICAgICBpZiAoY29sb3IgPT09IHRoaXMuY29sb3IpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgICAgIHRoaXMuYXJjZ2lzQ29sb3JJbnB1dENoYW5nZS5lbWl0KCk7XG4gICAgICAgIGlmIChzYXZlKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlUmVjZW50Q29sb3JUb1N0b3JhZ2UoY29sb3IpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0b3JlUmVjZW50Q29sb3JUb1N0b3JhZ2UoY29sb3IpIHtcbiAgICAgICAgaWYgKCFjb2xvcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlY2VudENvbG9ycyA9IFtjb2xvciwgLi4udGhpcy5yZWNlbnRDb2xvcnMuZmlsdGVyKChyZWNlbnQpID0+IHJlY2VudCAhPT0gY29sb3IpXS5zbGljZSgwLCAzKTtcbiAgICAgICAgc2V0TG9jYWxTdG9yYWdlSXRlbSh0aGlzLnN0b3JhZ2VJZCwgcmVjZW50Q29sb3JzLCB0cnVlKTtcbiAgICAgICAgdGhpcy5yZWNlbnRDb2xvcnMgPSByZWNlbnRDb2xvcnM7XG4gICAgICAgIHRoaXMuYXJjZ2lzSW50ZXJuYWxDb2xvcklucHV0U3RvcmVkQ29sb3IuZW1pdCgpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIFt0aGlzLnN0cmluZ3NdID0gYXdhaXQgZ2V0TG9jYWxlQ29tcG9uZW50U3RyaW5ncyh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5zZXRSZWNlbnRDb2xvcnNGcm9tU3RvcmFnZSgpO1xuICAgIH1cbiAgICBzZXRSZWNlbnRDb2xvcnNGcm9tU3RvcmFnZSgpIHtcbiAgICAgICAgY29uc3QgcmVjZW50Q29sb3JzID0gZ2V0TG9jYWxTdG9yYWdlSXRlbSh0aGlzLnN0b3JhZ2VJZCwgdHJ1ZSk7XG4gICAgICAgIGlmIChyZWNlbnRDb2xvcnMpIHtcbiAgICAgICAgICAgIHRoaXMucmVjZW50Q29sb3JzID0gWy4uLnJlY2VudENvbG9yc107XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY29tcGFjdCwgZGlzYWJsZWQsIHJlY2VudENvbG9ycywgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgcmVjZW50cyA9IFtyZWNlbnRDb2xvcnNbMF0sIHJlY2VudENvbG9yc1sxXV07XG4gICAgICAgIGNvbnN0IHJ0bCA9IGdldEVsZW1lbnREaXIodGhpcy5lbCkgPT09IFwicnRsXCI7XG4gICAgICAgIGlmICghY29tcGFjdCkge1xuICAgICAgICAgICAgcmVjZW50cy5wdXNoKHJlY2VudENvbG9yc1syXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJhcmNnaXMtc3ltYm9sLXN0eWxlci1pbmxpbmUtaW5wdXRcIiwgeyBkaXNhYmxlZDogZGlzYWJsZWQsIGludGxEb25lOiBzdHJpbmdzLmNvbW1pdENvbG9yLCBoZWFkaW5nOiBzdHJpbmdzLnNlbGVjdENvbG9yLCBsYWJlbDogc3RyaW5ncy5zZWxlY3RDb2xvciwgb25BcmNnaXNTeW1ib2xTdHlsZXJJbmxpbmVJbnB1dENsb3NlOiB0aGlzLm9uQ2xvc2UsIG9uQXJjZ2lzU3ltYm9sU3R5bGVySW5saW5lSW5wdXRPcGVuOiB0aGlzLm9uT3BlbiwgcG9wb3ZlclByb3BzOiB0aGlzLnBvcG92ZXJQcm9wcywgcmVmOiB0aGlzLnNldElubGluZUlucHV0UmVmIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDMuY29sb3JQaWNrZXJDb250YWluZXIsIHNsb3Q6IFwiY29udGVudFwiIH0sIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlclwiLCB7IGFsbG93RW1wdHk6IHRoaXMuY2xlYXJhYmxlLCBjbGFzczogXCJjb2xvci1waWNrZXJcIiwga2V5OiBgY29sb3ItcGlja2VyJHtjb21wYWN0ID8gXCItLWNvbXBhY3RcIiA6IFwiXCJ9YCwgb25DYWxjaXRlQ29sb3JQaWNrZXJJbnB1dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb2xvcih0aGlzLmNvbG9yUGlja2VyRWwudmFsdWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0sIHJlZjogdGhpcy5zZXRDb2xvclBpY2tlclJlZiwgc2NhbGU6IGNvbXBhY3QgPyBcInNcIiA6IFwibVwiLCBzdG9yYWdlSWQ6IHRoaXMuc3RvcmFnZUlkLCB2YWx1ZTogdGhpcy5jb2xvciB9KSksIGgoXCJkaXZcIiwgeyBzbG90OiBcInByZXZpZXdcIiB9LCBoKFwiY2FsY2l0ZS1jb2xvci1waWNrZXItc3dhdGNoXCIsIHsgY29sb3I6IHRoaXMuY29sb3IsIHNjYWxlOiBcInNcIiB9KSksIGgoXCJkaXZcIiwgeyBcImFyaWEtbGFiZWxcIjogc3RyaW5ncy5yZWNlbnRDb2xvcnMsIGNsYXNzOiBDU1MkMy5yZWNlbnQsIG9uS2V5RG93bjogdGhpcy5yZWNlbnRDb2xvcnNLZXlEb3duSGFuZGxlciwgc2xvdDogXCJjb250ZW50LWVuZFwiLCB0YWJpbmRleDogLTEgfSwgcmVjZW50cy5tYXAoKHJlY2VudCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZWNlbnQgPyAoaChcImNhbGNpdGUtY29sb3ItcGlja2VyLXN3YXRjaFwiLCB7IGFjdGl2ZTogcmVjZW50ID09PSB0aGlzLmNvbG9yLCBjb2xvcjogcmVjZW50LCBrZXk6IHJlY2VudCwgb25DbGljazogdGhpcy5oYW5kbGVTd2F0Y2hDbGlja09yS2V5VXAsIG9uRm9jdXM6IHRoaXMuZm9jdXNIYW5kbGVyLCBvbktleVVwOiB0aGlzLmhhbmRsZVN3YXRjaENsaWNrT3JLZXlVcCwgcmVmOiB0aGlzW2BzZXRSZWNlbnRDb2xvclJlZiR7aW5kZXggKyAxfWBdLCByb2xlOiBcImJ1dHRvblwiLCBzY2FsZTogXCJzXCIsIHRhYmluZGV4OiAwIH0pKSA6ICh0aGlzLnJlbmRlckVtcHR5U3dhdGNoKGBlbXB0eS1zd2F0Y2gtJHtpbmRleH1gKSk7XG4gICAgICAgIH0pKSwgdGhpcy5jbGVhcmFibGUgJiYgW1xuICAgICAgICAgICAgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC1lbmRcIiB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpY29uOiBcImNpcmNsZS1kaXNhbGxvd2VkXCIsXG4gICAgICAgICAgICAgICAgLy9pZD1cIm5vLWlucHV0LWJ1dHRvblwiXG4gICAgICAgICAgICAgICAgc2NhbGU6IFwic1wiLCBsYWJlbDogc3RyaW5ncy5jbGVhckNvbG9yLCB0ZXh0OiBzdHJpbmdzLmNsZWFyQ29sb3IsIHJlZjogKG5vZGUpID0+ICh0aGlzLmFjdGlvbkVsID0gbm9kZSksIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2xlYXIsIG9uTW91c2VPdmVyOiAoKSA9PiB0aGlzLmFkZFRvb2x0aXAoe1xuICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VFbGVtZW50OiB0aGlzLmFjdGlvbkVsLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IHJ0bCA/IFwicmlnaHQtc3RhcnRcIiA6IFwibGVmdC1zdGFydFwiLFxuICAgICAgICAgICAgICAgICAgICBpbm5lckhUTUw6IHN0cmluZ3Mubm9Db2xvclxuICAgICAgICAgICAgICAgIH0pLCBvbk1vdXNlT3V0OiAoKSA9PiB0aGlzLnJlbW92ZVRvb2x0aXAoKSB9KSlcbiAgICAgICAgXSkpKTtcbiAgICB9XG4gICAgcmVuZGVyRW1wdHlTd2F0Y2goa2V5KSB7XG4gICAgICAgIHJldHVybiAoaChcInN2Z1wiLCB7IGNsYXNzOiBcImVtcHR5LXN3YXRjaFwiLCB2aWV3Qm94OiBcIjAgMCAyMCAyMFwiLCB4bWxuczogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCB3aWR0aDogXCIyMFwiLCBrZXk6IGtleSB9LCBoKFwicmVjdFwiLCB7IHdpZHRoOiBcIjIwXCIsIGhlaWdodDogXCIyMFwiLCBmaWxsOiBcIiNmOGY4ZjhcIiwgc3Ryb2tlOiBcIiMwMDBcIiwgXCJzdHJva2UtZGFzaGFycmF5XCI6IFwiMlwiIH0pKSk7XG4gICAgfVxuICAgIGFkZFRvb2x0aXAocHJvcHMpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XG4gICAgICAgIHRoaXMudG9vbHRpcEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbGNpdGUtdG9vbHRpcFwiKTtcbiAgICAgICAgdGhpcy50b29sdGlwRWwucGxhY2VtZW50ID0gcHJvcHMucGxhY2VtZW50IHx8IFwiYXV0b1wiO1xuICAgICAgICB0aGlzLnRvb2x0aXBFbC5yZWZlcmVuY2VFbGVtZW50ID0gcHJvcHMucmVmZXJlbmNlRWxlbWVudDtcbiAgICAgICAgdGhpcy50b29sdGlwRWwub3ZlcmxheVBvc2l0aW9uaW5nID0gXCJmaXhlZFwiO1xuICAgICAgICB0aGlzLnRvb2x0aXBFbC5pbm5lckhUTUwgPSBwcm9wcy5pbm5lckhUTUw7XG4gICAgICAgIHRoaXMudG9vbHRpcEVsLm9wZW4gPSB0cnVlO1xuICAgICAgICAvLyBpdCB3b24ndCBzaG93IGlmIGp1c3QgYWRkZWQgdG8gdGhpcy5lbFxuICAgICAgICB0aGlzLmVsLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50b29sdGlwRWwpO1xuICAgIH1cbiAgICByZW1vdmVUb29sdGlwKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICgoX2EgPSB0aGlzLnRvb2x0aXBFbCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50b29sdGlwRWwpO1xuICAgICAgICAgICAgdGhpcy50b29sdGlwRWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxufTtcbkFyY2dpc0NvbG9ySW5wdXQuc3R5bGUgPSBhcmNnaXNDb2xvcklucHV0Q3NzO1xuXG5jb25zdCBBcmNnaXNQb3B1cENvbG9yUG9wb3ZlciA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzUG9wdXBDb2xvclBvcG92ZXJDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzUG9wdXBDb2xvclBvcG92ZXJDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNQb3B1cENvbG9yUG9wb3Zlck9wZW4gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1BvcHVwQ29sb3JQb3BvdmVyT3BlblwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNQb3B1cENvbG9yUG9wb3ZlckNoYW5nZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzUG9wdXBDb2xvclBvcG92ZXJDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuY2xvc2VkV2l0aEV2ZW50ID0gZmFsc2U7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlUGFuZWxEaXNtaXNzZWRDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgIGlmIChwYW5lbC5jbG9zZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcGFuZWwuY2xvc2VkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVBvcG92ZXJPcGVuID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFyY2dpc1BvcHVwQ29sb3JQb3BvdmVyT3Blbi5lbWl0KCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVQb3BvdmVyQ2xvc2UgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzUG9wdXBDb2xvclBvcG92ZXJDbG9zZS5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlZFdpdGhFdmVudCA9IHRydWU7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVQb3BvdmVyS2V5VXAgPSAoeyBrZXkgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhlYWRpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW50bERvbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFiZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGV4Q29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9wb3ZlclByb3BzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgZGlzYWJsZWRDaGFuZ2VkKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiB0aGlzLm9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbklubGluZUlucHV0T3BlbihldmVudCkge1xuICAgICAgICBpZiAoIXRoaXMub3Blbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZXZlbnQuY29tcG9zZWRQYXRoKCkuaW5jbHVkZXModGhpcy5lbCkpIHtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBQdWJsaWMgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIHNldEZvY3VzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMucGFuZWxFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTtcbiAgICB9XG4gICAgYXN5bmMgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFyY2dpc1BvcHVwQ29sb3JQb3BvdmVyQ2xvc2UuZW1pdCgpO1xuICAgICAgICB0aGlzLmNsb3NlZFdpdGhFdmVudCA9IHRydWU7XG4gICAgfVxuICAgIGFzeW5jIHNldE9wZW4ob3Blbikge1xuICAgICAgICB0aGlzLm9wZW4gPSBvcGVuO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgTGlmZWN5Y2xlIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsb3NlZFdpdGhFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5hcmNnaXNQb3B1cENvbG9yUG9wb3ZlckNsb3NlLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgcG9wb3ZlclByb3BzIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgb25LZXlVcDogdGhpcy5oYW5kbGVQb3BvdmVyS2V5VXAsIGxhYmVsOiB0aGlzLmxhYmVsLCBvZmZzZXREaXN0YW5jZTogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5vZmZzZXREaXN0YW5jZSkgfHwgMCwgb2Zmc2V0U2tpZGRpbmc6IChwb3BvdmVyUHJvcHMgPT09IG51bGwgfHwgcG9wb3ZlclByb3BzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3BvdmVyUHJvcHMub2Zmc2V0U2tpZGRpbmcpIHx8IDAsIGZsaXBEaXNhYmxlZDogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5mbGlwRGlzYWJsZWQpIHx8IGZhbHNlLCBvcGVuOiB0aGlzLm9wZW4sIG92ZXJsYXlQb3NpdGlvbmluZzogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5vdmVybGF5UG9zaXRpb25pbmcpIHx8IFwiZml4ZWRcIiwgcmVmZXJlbmNlRWxlbWVudDogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5yZWZFbGVtZW50KSB8fCB0aGlzLnByZXZpZXdDb250YWluZXJFbCwgb25DYWxjaXRlUG9wb3ZlckNsb3NlOiB0aGlzLmhhbmRsZVBvcG92ZXJDbG9zZSwgb25DYWxjaXRlUG9wb3Zlck9wZW46IHRoaXMuaGFuZGxlUG9wb3Zlck9wZW4sIHBsYWNlbWVudDogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5wbGFjZW1lbnQpIHx8IFwiYm90dG9tXCIgLy8gc2V0dGluZyB0byBib3R0b20gKHZzIGF1dG8pIHRvIHdvcmthcm91bmQgYWJzb2x1dGUgcGxhY2VtZW50IGlzc3VlXG4gICAgICAgICAgICAsXG4gICAgICAgICAgICB0cmlnZ2VyRGlzYWJsZWQ6IHRydWUgfSwgaChcImNhbGNpdGUtcGFuZWxcIiwgeyBjbG9zYWJsZTogdHJ1ZSwgb25DYWxjaXRlUGFuZWxDbG9zZTogdGhpcy5oYW5kbGVQYW5lbERpc21pc3NlZENoYW5nZSwgaGVhZGluZzogdGhpcy5oZWFkaW5nLCBzdHlsZTogKHBvcG92ZXJQcm9wcyA9PT0gbnVsbCB8fCBwb3BvdmVyUHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcG92ZXJQcm9wcy5tYXhIZWlnaHQpICYmIHsgbWF4SGVpZ2h0OiBwb3BvdmVyUHJvcHMubWF4SGVpZ2h0IH0sIHJlZjogKG5vZGUpID0+ICh0aGlzLnBhbmVsRWxlbWVudCA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLWNvbG9yLXBpY2tlclwiLCB7IGFsbG93RW1wdHk6IGZhbHNlLCBvbkNhbGNpdGVDb2xvclBpY2tlcklucHV0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBoZXhDb2xvciA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1BvcHVwQ29sb3JQb3BvdmVyQ2hhbmdlLmVtaXQoaGV4Q29sb3IpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSwgc2NhbGU6IFwibVwiLCB2YWx1ZTogdGhpcy5oZXhDb2xvciwgc3RvcmFnZUlkOiBcImFyY2dpcy1zeW1ib2wtc3R5bGVyLXN0b3JhZ2UtY29sb3JzXCIgfSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGFwcGVhcmFuY2U6IFwic29saWRcIiwgc2NhbGU6IFwibVwiLCBzbG90OiBcImZvb3RlclwiLCB3aWR0aDogXCJmdWxsXCIsIGxhYmVsOiB0aGlzLmludGxEb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUgfSwgdGhpcy5pbnRsRG9uZSkpKSkpO1xuICAgIH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJkaXNhYmxlZFwiOiBbXCJkaXNhYmxlZENoYW5nZWRcIl1cbiAgICB9OyB9XG59O1xuXG5jb25zdCBhcmNnaXNQb3B1cFN0eWxlclBvcG92ZXJDc3MgPSBcIi5zdHlsZXItcGFuZWx7d2lkdGg6MzI4cHg7bWluLWhlaWdodDozMDBweH0uc3R5bGVyLWRpdnt3aWR0aDoxMDAlfVwiO1xuXG5jb25zdCBBcmNnaXNQb3B1cFN0eWxlclBvcG92ZXIgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1BvcHVwU3R5bGVyUG9wb3ZlckNsb3NlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNQb3B1cFN0eWxlclBvcG92ZXJDbG9zZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNQb3B1cFN0eWxlclBvcG92ZXJEaXNjb25uZWN0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1BvcHVwU3R5bGVyUG9wb3ZlckRpc2Nvbm5lY3RlZFwiLCA3KTtcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIHRoaXMuZG9jdW1lbnRUYWJIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tIYW5kbGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBhbmVsU2Nyb2xsSGFuZGxlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgbWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0aGlzLm9uT3BlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnNldEZvY3VzKCkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlZmVyZW5jZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgcHVibGljIGNhbGxzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgcmVwb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLnBvcG92ZXJOb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwb3NpdGlvbigpO1xuICAgIH1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAoX2EgPSB0aGlzLmNsb3NlQWN0aW9uTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgfVxuICAgIGFzeW5jIHNldE9wZW4ob3Blbikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh0aGlzLnBvcG92ZXJOb2RlKSB7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJOb2RlLm9wZW4gPSBvcGVuO1xuICAgICAgICAgICAgaWYgKG9wZW4pIHtcbiAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLnBhbmVsTm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyTm9kZS5yZXBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgYWRkU3R5bGVyKHN0eWxlck5vZGUpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGVudE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudE5vZGUuYXBwZW5kQ2hpbGQoc3R5bGVyTm9kZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgZ2V0UG9wb3ZlclJlZkVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlQWN0aW9uTm9kZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICB0aGlzLnN0cmluZ3MgPSBwb3B1cFN0YXRlLnN0cmluZ3M7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuY2xvc2VBY3Rpb25Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICAvLyBpbiBjYXNlIHBvcG92ZXIgZ290IHJlbW92ZWQgYnkganVzdCByZW1vdmluZyBub2RlIGZyb20gRE9NXG4gICAgICAgIHRoaXMuYXJjZ2lzUG9wdXBTdHlsZXJQb3BvdmVyRGlzY29ubmVjdGVkLmVtaXQoKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyByZWZlcmVuY2VFbGVtZW50LCBvcGVuLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJqcy1hcHAtZmx5b3V0XCIgfSwgaChcImNhbGNpdGUtcG9wb3ZlclwiLCB7IG9wZW46IG9wZW4sIHBsYWNlbWVudDogXCJsZWFkaW5nLXN0YXJ0XCIsIG9mZnNldERpc3RhbmNlOiAwLCBvZmZzZXRTa2lkZGluZzogNDUsIHBvaW50ZXJEaXNhYmxlZDogdHJ1ZSwgdHJpZ2dlckRpc2FibGVkOiB0cnVlLCBsYWJlbDogXCJcIiwgcmVmZXJlbmNlRWxlbWVudDogcmVmZXJlbmNlRWxlbWVudCwgb25DYWxjaXRlUG9wb3Zlck9wZW46IHRoaXMub25PcGVuLCByZWY6IChub2RlKSA9PiAodGhpcy5wb3BvdmVyTm9kZSA9IG5vZGUpIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHtcbiAgICAgICAgICAgIC8vIG5lZWQgYWNjZXNzIHRvIHRoZSBjbG9zZSBidXR0b24gZG9tIHRvIHBhc3MgdG8gc3ltYm9sIHN0eWxlciBhcyByZWZlcmVuY2UgZWxlbWVudCxcbiAgICAgICAgICAgIC8vIHNvIGNhbid0IHVzZSBjbG9zYWJsZTp0cnVlXG4gICAgICAgICAgICBjbG9zYWJsZTogZmFsc2UsIGhlYWRpbmc6IHN0cmluZ3MuY2hhcnRTdHlsZSwgY2xhc3M6IFwic3R5bGVyLXBhbmVsXCIsIHJlZjogKG5vZGUpID0+ICh0aGlzLnBhbmVsTm9kZSA9IG5vZGUpLCBvbkNhbGNpdGVQYW5lbENsb3NlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNQb3B1cFN0eWxlclBvcG92ZXJDbG9zZS5lbWl0KCk7XG4gICAgICAgICAgICAgICAgLy8gZm9jdXMgb24gaW5mbyBpY29uOyB3YWl0IHNvIGVudGVyIGtleSBkb2Vzbid0IHJlLW9wZW4gaXRcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlZmVyZW5jZUVsZW1lbnQucGFyZW50RWxlbWVudC5mb2N1cygpLCAzMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBoKFwiY2FsY2l0ZS1hY3Rpb25cIiwgeyBpZDogXCJzeW1ib2wtc3R5bGVyLWRpc21pc3MtYnV0dG9uXCIsIHNsb3Q6IFwiaGVhZGVyLWFjdGlvbnMtZW5kXCIsIHNjYWxlOiBcInNcIiwgaWNvbjogXCJ4XCIsIHRleHQ6IHN0cmluZ3MuY2xvc2UsIG9uQ2xpY2s6ICgpID0+IHRoaXMuYXJjZ2lzUG9wdXBTdHlsZXJQb3BvdmVyQ2xvc2UuZW1pdCgpLCByZWY6IChub2RlKSA9PiAodGhpcy5jbG9zZUFjdGlvbk5vZGUgPSBub2RlKSB9KSwgaChcImRpdlwiLCB7IGNsYXNzOiBcInN0eWxlci1kaXZcIiwgcmVmOiAobm9kZSkgPT4gKHRoaXMuY29udGVudE5vZGUgPSBub2RlKSB9KSkpKSk7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNQb3B1cFN0eWxlclBvcG92ZXIuc3R5bGUgPSBhcmNnaXNQb3B1cFN0eWxlclBvcG92ZXJDc3M7XG5cbmNvbnN0IGFyY2dpc1N5bWJvbFBpY2tlckZpbGVVcGxvYWRDc3MgPSBcIjpob3N0e2Rpc3BsYXk6aW5saW5lLWJsb2NrO2JhY2tncm91bmQtY29sb3I6d2hpdGU7d2lkdGg6MTAwJTtwYWRkaW5nOjIwcHggNXB4IDE1cHggNXB4O2JvcmRlci1jb2xvcjp2YXIoLS1jYWxjaXRlLWNvbG9yLWJvcmRlci0xKTtib3JkZXItd2lkdGg6MnB4O2JvcmRlci1zdHlsZTpkYXNoZWQ7Ym94LXNpemluZzpib3JkZXItYm94fS5maWxlLXN0ZXB7dGV4dC1hbGlnbjpjZW50ZXJ9LmZpbGUtc3RlcF9fdXBsb2FkLWljb257bWFyZ2luLWJvdHRvbTowLjVyZW07bWFyZ2luLXRvcDowLjI1cmVtO2NvbG9yOnZhcigtLWNhbGNpdGUtY29sb3ItdGV4dC0zKX0uZmlsZS1zdGVwX191cGxvYWQtaWNvbiBjYWxjaXRlLWljb257d2lkdGg6NHJlbTtoZWlnaHQ6NHJlbX0uZmlsZS1zdGVwX19kcmFnLXRleHR7Zm9udC1zaXplOjAuOXJlbTttYXJnaW4tYm90dG9tOjAuMjVyZW19LmZpbGUtc3RlcF9fYnJvd3NlLWJ1dHRvbnttYXJnaW4tdG9wOjFyZW19LmZpbGUtc3RlcF9fZmlsZS1pbnB1dHtkaXNwbGF5Om5vbmV9XCI7XG5cbmNvbnN0IEFyY2dpc1N5bWJvbFN0eWxlckZpbGVVcGxvYWQgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1N5bWJvbFBpY2tlckZpbGVVcGxvYWRDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1N5bWJvbFBpY2tlckZpbGVVcGxvYWRDaGFuZ2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sUGlja2VyRmlsZVVwbG9hZEludmFsaWRGaWxlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTeW1ib2xQaWNrZXJGaWxlVXBsb2FkSW52YWxpZEZpbGVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sUGlja2VyRmlsZVVwbG9hZEVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNTeW1ib2xQaWNrZXJGaWxlVXBsb2FkRXJyb3JcIiwgNyk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlRHJvcCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0ZpbGUoZXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzWzBdKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5oYW5kbGVGaWxlSW5wdXRDaGFuZ2UgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0ZpbGUoZXZlbnQudGFyZ2V0LmZpbGVzWzBdKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wb3J0YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RyaW5ncyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUmVuZGVyIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImZpbGUtc3RlcFwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5zdHJpbmdzLmZpbGVVcGxvYWQuZHJhZ0Ryb3AsIG9uRHJhZ092ZXI6IHRoaXMuaGFuZGxlRHJhZ092ZXIsIG9uRHJhZ0VudGVyOiB0aGlzLmhhbmRsZURyYWdPdmVyLCBvbkRyb3A6IHRoaXMuaGFuZGxlRHJvcCB9LCBoKFwiZGl2XCIsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmaWxlLXN0ZXBfX2RyYWctdGV4dFwiLCBcImFyaWEtbGFiZWxcIjogdGhpcy5zdHJpbmdzLmZpbGVVcGxvYWQuZHJhZ0Ryb3AgfSwgdGhpcy5zdHJpbmdzLmZpbGVVcGxvYWQuZHJhZ0Ryb3ApLCBoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBjbGFzczogXCJmaWxlLXN0ZXBfX2Jyb3dzZS1idXR0b25cIiwgYXBwZWFyYW5jZTogXCJ0cmFuc3BhcmVudFwiLCBpY29uU3RhcnQ6IFwiaW1hZ2VcIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgICAgICAgICB9IH0sIHRoaXMuc3RyaW5ncy5maWxlVXBsb2FkLmJyb3dzZSksIGgoXCJpbnB1dFwiLCB7IHJlZjogKGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlSW5wdXQgPSBlbDtcbiAgICAgICAgICAgIH0sIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUZpbGVJbnB1dENoYW5nZSwgY2xhc3M6IFwiZmlsZS1zdGVwX19maWxlLWlucHV0XCIsIHR5cGU6IFwiZmlsZVwiLCBhY2NlcHQ6IFwiLmpwZywuZ2lmLC5wbmcsLnN2ZyxpbWFnZS9qcGcsaW1hZ2UvZ2lmLGltYWdlL3BuZyxpbWFnZS9zdmcreG1sXCIgfSkpKSk7XG4gICAgfVxuICAgIGFzeW5jIHByb2Nlc3NGaWxlKGZpbGUpIHtcbiAgICAgICAgY29uc3QgeyBwb3J0YWwgfSA9IHRoaXM7XG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZEZpbGUoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1N5bWJvbFBpY2tlckZpbGVVcGxvYWRJbnZhbGlkRmlsZS5lbWl0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNTVkdGaWxlKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3N5bWJvbFNlcnZpY2VdID0gYXdhaXQgbG9hZE1vZHVsZXMoW1wiZXNyaS9yZXN0L3N5bWJvbFNlcnZpY2VcIl0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN5bWJvbFNlcnZpY2VVcmwgPSBwb3J0YWwuaGVscGVyU2VydmljZXMuc3ltYm9scy51cmw7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsgc3ZnSW1hZ2U6IGV2ZW50LnRhcmdldC5yZXN1bHQgfTtcbiAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VydmljZS5nZW5lcmF0ZVN5bWJvbChzeW1ib2xTZXJ2aWNlVXJsLCBwYXJhbXMpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTeW1ib2xQaWNrZXJGaWxlVXBsb2FkQ2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpbTogcmVzdWx0LnN5bWJvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogZmlsZS5uYW1lIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHJlc3VsdC5zeW1ib2wud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiByZXN1bHQuc3ltYm9sLmhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzU3ltYm9sUGlja2VyRmlsZVVwbG9hZENoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVVJMOiBldmVudC50YXJnZXQucmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpbWFnZS5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTeW1ib2xQaWNrZXJGaWxlVXBsb2FkRXJyb3IuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaXNWYWxpZEZpbGUoZmlsZSkge1xuICAgICAgICByZXR1cm4gKGZpbGUgPT09IG51bGwgfHwgZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsZS5uYW1lKSAmJiAvXFwuKGdpZnxqcGd8anBlZ3xwbmd8c3ZnKSQvaS50ZXN0KGZpbGUubmFtZSk7XG4gICAgfVxuICAgIGlzU1ZHRmlsZShmaWxlKSB7XG4gICAgICAgIHJldHVybiAoZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWxlLm5hbWUpICYmIC9cXC4oc3ZnKSQvaS50ZXN0KGZpbGUubmFtZSk7XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTeW1ib2xTdHlsZXJGaWxlVXBsb2FkLnN0eWxlID0gYXJjZ2lzU3ltYm9sUGlja2VyRmlsZVVwbG9hZENzcztcblxuY29uc3QgQ1NTJDIgPSB7XG4gICAgcmVjZW50OiBcInJlY2VudFwiLFxuICAgIHByZXZpZXc6IFwicHJldmlld1wiLFxuICAgIGNvbG9yUGlja2VyQ29udGFpbmVyOiBcImNvbG9yLXBpY2tlci1jb250YWluZXJcIlxufTtcblxubGV0IHJhbXBJZCA9IDA7XG5jb25zdCBDU1MkMSA9IHtcbiAgICBjb2xvclJhbXBJdGVtOiBcImNvbG9yLXJhbXAtaXRlbVwiXG59O1xuY29uc3QgQ29sb3JSYW1wSXRlbSA9ICh7IHN0b3BzLCBzdHlsZSA9IFwiY29udGludW91c1wiLCBuYW1lLCBsYXlvdXQgPSBcInZlcnRpY2FsXCIsIHdpZHRoID0gMjAsIGhlaWdodCA9IDcwIH0pID0+IHtcbiAgICBjb25zdCBpZCA9IGAke3JhbXBJZCsrfS1jb2xvci1yYW1wLWdyYWRpZW50YDtcbiAgICBjb25zdCBncmFkaWVudFRyYW5zZm9ybSA9IGxheW91dCA9PT0gXCJ2ZXJ0aWNhbFwiID8gXCJyb3RhdGUoOTApXCIgOiBcIlwiO1xuICAgIHJldHVybiAoaChcInNwYW5cIiwgeyB0aXRsZTogbmFtZSwgY2xhc3M6IENTUyQxLmNvbG9yUmFtcEl0ZW0gfSxcbiAgICAgICAgaChcInN2Z1wiLCB7IHhtbG5zOiBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIGhlaWdodDogaGVpZ2h0LCB3aWR0aDogd2lkdGggfSxcbiAgICAgICAgICAgIGgoXCJkZWZzXCIsIG51bGwsXG4gICAgICAgICAgICAgICAgaChcImxpbmVhckdyYWRpZW50XCIsIHsgaWQ6IGlkLCBncmFkaWVudFRyYW5zZm9ybTogZ3JhZGllbnRUcmFuc2Zvcm0gfSwgc3R5bGUgPT09IFwiY29udGludW91c1wiID8gZ2V0R3JhZGllbnRTdG9wcyhzdG9wcykgOiBnZXRTb2xpZFN0b3BzKHN0b3BzKSkpLFxuICAgICAgICAgICAgaChcInJlY3RcIiwgeyB4OiBcIjBcIiwgeTogXCIwXCIsIGZpbGw6IGB1cmwoJyMke2lkfScpYCwgd2lkdGg6IFwiMTAwJVwiLCBoZWlnaHQ6IFwiMTAwJVwiIH0pKSkpO1xufTtcbmZ1bmN0aW9uIGdldEdyYWRpZW50U3RvcHMoc3RvcHMpIHtcbiAgICBjb25zdCBjb2xvck9mZnNldCA9IDEgLyAoc3RvcHMubGVuZ3RoIC0gMSk7XG4gICAgcmV0dXJuIHN0b3BzLnNsaWNlKCkubWFwKCh7IHIsIGcsIGIgfSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiBjb2xvck9mZnNldCAqIDEwMDtcbiAgICAgICAgcmV0dXJuIGgoXCJzdG9wXCIsIHsgXCJzdG9wLWNvbG9yXCI6IGByZ2IoJHtyfSwgJHtnfSwgJHtifSlgLCBvZmZzZXQ6IGAke29mZnNldH0lYCB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldFNvbGlkU3RvcHMoc3RvcHMpIHtcbiAgICBjb25zdCBjb2xvck9mZnNldCA9IDEgLyBzdG9wcy5sZW5ndGg7XG4gICAgY29uc3QgY29sb3JzID0gW107XG4gICAgc3RvcHMuc2xpY2UoKS5mb3JFYWNoKCh7IHIsIGcsIGIgfSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiBjb2xvck9mZnNldCAqIDEwMDtcbiAgICAgICAgY29uc3QgbmV4dE9mZnNldCA9IChpbmRleCArIDEpICogY29sb3JPZmZzZXQgKiAxMDA7XG4gICAgICAgIGNvbG9ycy5wdXNoKGgoXCJzdG9wXCIsIHsgXCJzdG9wLWNvbG9yXCI6IGByZ2IoJHtyfSwgJHtnfSwgJHtifSlgLCBvZmZzZXQ6IGAke29mZnNldH0lYCB9KSwgaChcInN0b3BcIiwgeyBcInN0b3AtY29sb3JcIjogYHJnYigke3J9LCAke2d9LCAke2J9KWAsIG9mZnNldDogYCR7bmV4dE9mZnNldH0lYCB9KSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbG9ycztcbn1cblxuY29uc3QgQ1NTID0ge1xuICAgIGNvbG9yUmFtcEl0ZW06IFwiY29sb3ItcmFtcC1pdGVtXCJcbn07XG5jb25zdCBSZWxhdGlvbnNoaXBSYW1wQ29sb3JSYW1wSXRlbSA9ICh7IHN0b3BzLCBuYW1lLCBvcGFjaXR5ID0gbnVsbCwgc2l6ZSA9IDQ4IH0pID0+IHtcbiAgICBjb25zdCB7IHN2Z1V0aWxzIH0gPSBlc3JpTW9kdWxlcztcbiAgICAvLyByZW5kZXJpbmcgbG9naWMsIHR5cGVzIGFuZCB1dGlscyBhcmUgYmFzZWQgb24gSlMgQVBJIHJhbXAgcmVuZGVyaW5nIGZyb20gTGVnZW5kXG4gICAgLy8gdGhlc2Ugd2lsbCBiZSByZWZhY3RvcmVkIGFmdGVyIHNvbWUgdXRpbHMgYXJlIG1hZGUgcHVibGljOiBodHRwczovL2RldnRvcGlhLmVzcmkuY29tL1dlYkdJUy9hcmNnaXMtanMtYXBpL3B1bGwvMzI4MTEvXG4gICAgY29uc3QgbnVtQ2xhc3NlcyA9IE1hdGguc3FydChzdG9wcy5sZW5ndGgpO1xuICAgIGNvbnN0IGNvbG9ycyA9IGV4cGFuZDJEKHN0b3BzKTtcbiAgICBjb25zdCByb3RhdGlvbiA9IDA7XG4gICAgY29uc3Qgc3VyZmFjZVNpemUgPSBNYXRoLnNxcnQoTWF0aC5wb3coc2l6ZSwgMikgKyBNYXRoLnBvdyhzaXplLCAyKSkgKyAoMCApOyAvLyBkaWFnb25hbCBsZW5ndGggKyA1cHggcGFkZGluZyBmb3IgYXJyb3dzXG4gICAgbGV0IG9wYWNpdHlTdHlsZSA9IG51bGw7XG4gICAgaWYgKG9wYWNpdHkgIT0gbnVsbCkge1xuICAgICAgICBvcGFjaXR5U3R5bGUgPSB7IG9wYWNpdHk6IGAke29wYWNpdHl9YCB9O1xuICAgIH1cbiAgICBjb25zdCBkZWZzID0gW107XG4gICAgY29uc3Qgc3F1YXJlcyA9IFtdO1xuICAgIGNvbnN0IGJib3hlcyA9IFtdO1xuICAgIGNvbnN0IGdyb3VwU2l6ZSA9IHNpemUgfHwgNzU7XG4gICAgY29uc3QgY2VsbFNpemUgPSBncm91cFNpemUgLyBudW1DbGFzc2VzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQ2xhc3NlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHkgPSBpICogY2VsbFNpemU7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbnVtQ2xhc3NlczsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCB4ID0gaiAqIGNlbGxTaXplO1xuICAgICAgICAgICAgY29uc3QgZmlsbEF0dHJzID0gZ2VuZXJhdGVGaWxsQXR0cmlidXRlcyhjb2xvcnNbaV1bal0pO1xuICAgICAgICAgICAgY29uc3Qgc3Ryb2tlQXR0cnMgPSBnZW5lcmF0ZVN0cm9rZUF0dHJpYnV0ZXMobnVsbCk7XG4gICAgICAgICAgICBjb25zdCBzaGFwZSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInJlY3RcIixcbiAgICAgICAgICAgICAgICB4LFxuICAgICAgICAgICAgICAgIHksXG4gICAgICAgICAgICAgICAgd2lkdGg6IGNlbGxTaXplLFxuICAgICAgICAgICAgICAgIGhlaWdodDogY2VsbFNpemVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkZWZzLnB1c2gocmVuZGVyRGVmKGZpbGxBdHRycykpO1xuICAgICAgICAgICAgc3F1YXJlcy5wdXNoKHJlbmRlclNoYXBlKHNoYXBlLCBmaWxsQXR0cnMuZmlsbCwgc3Ryb2tlQXR0cnMsIG51bGwpKTtcbiAgICAgICAgICAgIGJib3hlcy5wdXNoKHN2Z1V0aWxzLmdldEJvdW5kaW5nQm94KHNoYXBlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHN2Z1N0eWxlID0gbnVsbDtcbiAgICBjb25zdCBiYm94ID0gc3ZnVXRpbHMuY29tcHV0ZUJCb3goYmJveGVzKTtcbiAgICBjb25zdCByZWN0TWF0cml4ID0gc3ZnVXRpbHMuZ2V0VHJhbnNmb3JtTWF0cml4KGJib3gsIHN1cmZhY2VTaXplLCBzdXJmYWNlU2l6ZSwgMCwgZmFsc2UsIHJvdGF0aW9uKTtcbiAgICByZXR1cm4gKGgoXCJzcGFuXCIsIHsgdGl0bGU6IG5hbWUsIGNsYXNzOiBDU1MuY29sb3JSYW1wSXRlbSB9LFxuICAgICAgICBoKFwiZGl2XCIsIHsgc3R5bGU6IG9wYWNpdHlTdHlsZSB9LFxuICAgICAgICAgICAgaChcInN2Z1wiLCB7IHdpZHRoOiBzdXJmYWNlU2l6ZSwgaGVpZ2h0OiBzdXJmYWNlU2l6ZSwgc3R5bGU6IHN2Z1N0eWxlLCB4bWxuczogXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIH0sXG4gICAgICAgICAgICAgICAgaChcImRlZnNcIiwgbnVsbCwgZGVmcyksXG4gICAgICAgICAgICAgICAgaChcImdcIiwgeyB0cmFuc2Zvcm06IHJlY3RNYXRyaXggfSwgc3F1YXJlcykpKSkpO1xufTtcbmZ1bmN0aW9uIHJlbmRlckRlZihhdHRycykge1xuICAgIGNvbnN0IHsgcGF0dGVybiwgbGluZWFyR3JhZGllbnQgfSA9IGF0dHJzO1xuICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICAgIHJldHVybiAoaChcInBhdHRlcm5cIiwgeyBpZDogcGF0dGVybi5pZCwgcGF0dGVyblVuaXRzOiBcInVzZXJTcGFjZU9uVXNlXCIsIHg6IHBhdHRlcm4ueCwgeTogcGF0dGVybi55LCB3aWR0aDogcGF0dGVybi53aWR0aCwgaGVpZ2h0OiBwYXR0ZXJuLmhlaWdodCB9LFxuICAgICAgICAgICAgaChcImltYWdlXCIsIHsgeDogcGF0dGVybi5pbWFnZS54LCB5OiBwYXR0ZXJuLmltYWdlLnksIHdpZHRoOiBwYXR0ZXJuLmltYWdlLndpZHRoLCBoZWlnaHQ6IHBhdHRlcm4uaW1hZ2UuaGVpZ2h0LCBocmVmOiBwYXR0ZXJuLmltYWdlLmhyZWYgfSkpKTtcbiAgICB9XG4gICAgaWYgKGxpbmVhckdyYWRpZW50KSB7XG4gICAgICAgIGNvbnN0IHN0b3BzID0gbGluZWFyR3JhZGllbnQuc3RvcHMubWFwKChzdG9wLCBpbmRleCkgPT4gKGgoXCJzdG9wXCIsIHsga2V5OiBgJHtpbmRleH0tc3RvcGAsIG9mZnNldDogc3RvcC5vZmZzZXQsIFwic3RvcC1jb2xvclwiOiBzdG9wLmNvbG9yIH0pKSk7XG4gICAgICAgIHJldHVybiAoaChcImxpbmVhckdyYWRpZW50XCIsIHsgaWQ6IGxpbmVhckdyYWRpZW50LmlkLCBncmFkaWVudFVuaXRzOiBcInVzZXJTcGFjZU9uVXNlXCIsIHgxOiBsaW5lYXJHcmFkaWVudC54MSwgeTE6IGxpbmVhckdyYWRpZW50LnkxLCB4MjogbGluZWFyR3JhZGllbnQueDIsIHkyOiBsaW5lYXJHcmFkaWVudC55MiB9LCBzdG9wcykpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbmZ1bmN0aW9uIGdldFN2Z1BhdGhGcm9tQ29tbWFuZE9iamVjdHMoY29tbWFuZE9iamVjdHMpIHtcbiAgICByZXR1cm4gY29tbWFuZE9iamVjdHNcbiAgICAgICAgLm1hcCgoY29tbWFuZE9iaikgPT4gYCR7Y29tbWFuZE9iai5jb21tYW5kfSAke2NvbW1hbmRPYmoudmFsdWVzLmpvaW4oXCIgXCIpfWApXG4gICAgICAgIC5qb2luKFwiIFwiKVxuICAgICAgICAudHJpbSgpO1xufVxubGV0IHBhdHRlcm5Db3VudCA9IDA7XG5sZXQgbGluZWFyR3JhZGllbnRDb3VudCA9IDA7XG5mdW5jdGlvbiByZW5kZXJTaGFwZShzaGFwZSwgZmlsbCwgc3Ryb2tlLCB0ZXh0QXR0cnMpIHtcbiAgICBpZiAoc2hhcGUpIHtcbiAgICAgICAgaWYgKHNoYXBlLnR5cGUgPT09IFwiY2lyY2xlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImNpcmNsZVwiLCB7IGZpbGw6IGZpbGwsIFwiZmlsbC1ydWxlXCI6IFwiZXZlbm9kZFwiLCBzdHJva2U6IHN0cm9rZS5jb2xvciwgXCJzdHJva2Utd2lkdGhcIjogc3Ryb2tlLndpZHRoLCBcInN0cm9rZS1saW5lY2FwXCI6IHN0cm9rZS5jYXAsIFwic3Ryb2tlLWxpbmVqb2luXCI6IHN0cm9rZS5qb2luLCBcInN0cm9rZS1kYXNoYXJyYXlcIjogc3Ryb2tlLmRhc2hBcnJheSwgXCJzdHJva2UtbWl0ZXJsaW1pdFwiOiBcIjRcIiwgY3g6IHNoYXBlLmN4LCBjeTogc2hhcGUuY3ksIHI6IHNoYXBlLnIgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFwZS50eXBlID09PSBcImVsbGlwc2VcIikge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwiZWxsaXBzZVwiLCB7IGZpbGw6IGZpbGwsIFwiZmlsbC1ydWxlXCI6IFwiZXZlbm9kZFwiLCBzdHJva2U6IHN0cm9rZS5jb2xvciwgXCJzdHJva2Utd2lkdGhcIjogc3Ryb2tlLndpZHRoLCBcInN0cm9rZS1saW5lY2FwXCI6IHN0cm9rZS5jYXAsIFwic3Ryb2tlLWxpbmVqb2luXCI6IHN0cm9rZS5qb2luLCBcInN0cm9rZS1kYXNoYXJyYXlcIjogc3Ryb2tlLmRhc2hBcnJheSwgXCJzdHJva2UtbWl0ZXJsaW1pdFwiOiBcIjRcIiwgY3g6IHNoYXBlLmN4LCBjeTogc2hhcGUuY3ksIHJ4OiBzaGFwZS5yeCwgcnk6IHNoYXBlLnJ5IH0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hhcGUudHlwZSA9PT0gXCJyZWN0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcInJlY3RcIiwgeyBmaWxsOiBmaWxsLCBcImZpbGwtcnVsZVwiOiBcImV2ZW5vZGRcIiwgc3Ryb2tlOiBzdHJva2UuY29sb3IsIFwic3Ryb2tlLXdpZHRoXCI6IHN0cm9rZS53aWR0aCwgXCJzdHJva2UtbGluZWNhcFwiOiBzdHJva2UuY2FwLCBcInN0cm9rZS1saW5lam9pblwiOiBzdHJva2Uuam9pbiwgXCJzdHJva2UtZGFzaGFycmF5XCI6IHN0cm9rZS5kYXNoQXJyYXksIFwic3Ryb2tlLW1pdGVybGltaXRcIjogXCI0XCIsIHg6IHNoYXBlLngsIHk6IHNoYXBlLnksIHdpZHRoOiBzaGFwZS53aWR0aCwgaGVpZ2h0OiBzaGFwZS5oZWlnaHQgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFwZS50eXBlID09PSBcImltYWdlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImltYWdlXCIsIHsgaHJlZjogc2hhcGUuc3JjLCB4OiBzaGFwZS54LCB5OiBzaGFwZS55LCB3aWR0aDogc2hhcGUud2lkdGgsIGhlaWdodDogc2hhcGUuaGVpZ2h0LCBwcmVzZXJ2ZUFzcGVjdFJhdGlvOiBcIm5vbmVcIiB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNoYXBlLnR5cGUgPT09IFwicGF0aFwiKSB7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gdHlwZW9mIHNoYXBlLnBhdGggIT09IFwic3RyaW5nXCIgPyBnZXRTdmdQYXRoRnJvbUNvbW1hbmRPYmplY3RzKHNoYXBlLnBhdGgpIDogc2hhcGUucGF0aDtcbiAgICAgICAgICAgIHJldHVybiAoaChcInBhdGhcIiwgeyBmaWxsOiBmaWxsLCBcImZpbGwtcnVsZVwiOiBcImV2ZW5vZGRcIiwgc3Ryb2tlOiBzdHJva2UuY29sb3IsIFwic3Ryb2tlLXdpZHRoXCI6IHN0cm9rZS53aWR0aCwgXCJzdHJva2UtbGluZWNhcFwiOiBzdHJva2UuY2FwLCBcInN0cm9rZS1saW5lam9pblwiOiBzdHJva2Uuam9pbiwgXCJzdHJva2UtZGFzaGFycmF5XCI6IHN0cm9rZS5kYXNoQXJyYXksIFwic3Ryb2tlLW1pdGVybGltaXRcIjogXCI0XCIsIGQ6IHBhdGggfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFwZS50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgcmV0dXJuIChoKFwidGV4dFwiLCB7IGZpbGw6IGZpbGwsIFwiZmlsbC1ydWxlXCI6IFwiZXZlbm9kZFwiLCBzdHJva2U6IHN0cm9rZS5jb2xvciwgXCJzdHJva2Utd2lkdGhcIjogc3Ryb2tlLndpZHRoLCBcInN0cm9rZS1saW5lY2FwXCI6IHN0cm9rZS5jYXAsIFwic3Ryb2tlLWxpbmVqb2luXCI6IHN0cm9rZS5qb2luLCBcInN0cm9rZS1kYXNoYXJyYXlcIjogc3Ryb2tlLmRhc2hBcnJheSwgXCJzdHJva2UtbWl0ZXJsaW1pdFwiOiBcIjRcIiwgXCJ0ZXh0LWFuY2hvclwiOiB0ZXh0QXR0cnMuYWxpZ24sIFwidGV4dC1kZWNvcmF0aW9uXCI6IHRleHRBdHRycy5kZWNvcmF0aW9uLCBrZXJuaW5nOiB0ZXh0QXR0cnMua2VybmluZywgcm90YXRlOiB0ZXh0QXR0cnMucm90YXRlLCBcInRleHQtcmVuZGVyaW5nXCI6IFwiYXV0b1wiLCBcImZvbnQtc3R5bGVcIjogdGV4dEF0dHJzLmZvbnQuc3R5bGUsIFwiZm9udC12YXJpYW50XCI6IHRleHRBdHRycy5mb250LnZhcmlhbnQsIFwiZm9udC13ZWlnaHRcIjogdGV4dEF0dHJzLmZvbnQud2VpZ2h0LCBcImZvbnQtc2l6ZVwiOiB0ZXh0QXR0cnMuZm9udC5zaXplLCBcImZvbnQtZmFtaWx5XCI6IHRleHRBdHRycy5mb250LmZhbWlseSwgeDogc2hhcGUueCwgeTogc2hhcGUueSB9LCBzaGFwZS50ZXh0KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBnZW5lcmF0ZUZpbGxBdHRyaWJ1dGVzKGZpbGwpIHtcbiAgICBjb25zdCBhdHRycyA9IHtcbiAgICAgICAgZmlsbDogXCJub25lXCIsXG4gICAgICAgIHBhdHRlcm46IG51bGwsXG4gICAgICAgIGxpbmVhckdyYWRpZW50OiBudWxsXG4gICAgfTtcbiAgICBpZiAoZmlsbCkge1xuICAgICAgICBpZiAoXCJ0eXBlXCIgaW4gZmlsbCAmJiBmaWxsLnR5cGUgPT09IFwicGF0dGVyblwiKSB7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGBwYXR0ZXJuSWQtJHsrK3BhdHRlcm5Db3VudH1gO1xuICAgICAgICAgICAgYXR0cnMuZmlsbCA9IGB1cmwoIyR7aWR9KWA7XG4gICAgICAgICAgICBhdHRycy5wYXR0ZXJuID0ge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIHg6IGZpbGwueCxcbiAgICAgICAgICAgICAgICB5OiBmaWxsLnksXG4gICAgICAgICAgICAgICAgd2lkdGg6IGZpbGwud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBmaWxsLmhlaWdodCxcbiAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogZmlsbC53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBmaWxsLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgaHJlZjogZmlsbC5zcmNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFwidHlwZVwiIGluIGZpbGwgJiYgZmlsbC50eXBlID09PSBcImxpbmVhclwiKSB7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGBsaW5lYXJHcmFkaWVudElkLSR7KytsaW5lYXJHcmFkaWVudENvdW50fWA7XG4gICAgICAgICAgICBhdHRycy5maWxsID0gYHVybCgjJHtpZH0pYDtcbiAgICAgICAgICAgIGF0dHJzLmxpbmVhckdyYWRpZW50ID0ge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIHgxOiBmaWxsLngxLFxuICAgICAgICAgICAgICAgIHkxOiBmaWxsLnkxLFxuICAgICAgICAgICAgICAgIHgyOiBmaWxsLngyLFxuICAgICAgICAgICAgICAgIHkyOiBmaWxsLnkyLFxuICAgICAgICAgICAgICAgIHN0b3BzOiBmaWxsLmNvbG9ycy5tYXAoKHN0b3ApID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogc3RvcC5vZmZzZXQsXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBzdG9wLmNvbG9yICYmIGNyZWF0ZShzdG9wLmNvbG9yKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGZpbGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gY3JlYXRlKGZpbGwpO1xuICAgICAgICAgICAgYXR0cnMuZmlsbCA9IGNvbG9yLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGF0dHJzO1xufVxuZnVuY3Rpb24gZ2VuZXJhdGVTdHJva2VBdHRyaWJ1dGVzKHN0cm9rZSkge1xuICAgIGNvbnN0IHN0cm9rZUF0dHJzID0ge1xuICAgICAgICBjb2xvcjogXCJub25lXCIsXG4gICAgICAgIHdpZHRoOiAxLFxuICAgICAgICBjYXA6IFwiYnV0dFwiLFxuICAgICAgICBqb2luOiBcIjRcIixcbiAgICAgICAgZGFzaEFycmF5OiBcIm5vbmVcIlxuICAgIH07XG4gICAgaWYgKHN0cm9rZSkge1xuICAgICAgICBpZiAoc3Ryb2tlLndpZHRoICE9IG51bGwpIHtcbiAgICAgICAgICAgIHN0cm9rZUF0dHJzLndpZHRoID0gc3Ryb2tlLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJva2UuY2FwKSB7XG4gICAgICAgICAgICBzdHJva2VBdHRycy5jYXAgPSBzdHJva2UuY2FwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJva2Uuam9pbikge1xuICAgICAgICAgICAgc3Ryb2tlQXR0cnMuam9pbiA9IHN0cm9rZS5qb2luLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cm9rZS5jb2xvcikge1xuICAgICAgICAgICAgc3Ryb2tlQXR0cnMuY29sb3IgPSBjcmVhdGUoc3Ryb2tlLmNvbG9yKS50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJva2Uuc3R5bGUpIHtcbiAgICAgICAgICAgIGxldCBkYSA9IG51bGw7XG4gICAgICAgICAgICBpZiAoc3Ryb2tlLnN0eWxlIGluIHN0eWxlVG9EYXNoQXJyYXkpIHtcbiAgICAgICAgICAgICAgICBkYSA9IHN0eWxlVG9EYXNoQXJyYXlbc3Ryb2tlLnN0eWxlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhKSkge1xuICAgICAgICAgICAgICAgIGRhID0gZGEuc2xpY2UoMCk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBkYVtpXSAqPSBzdHJva2Uud2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdHJva2UuY2FwICE9PSBcImJ1dHRcIikge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhLmxlbmd0aDsgaSArPSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYVtpXSAtPSBzdHJva2Uud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGFbaV0gPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFbaV0gPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZGEubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhW2ldICs9IHN0cm9rZS53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYSA9IGRhLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3Ryb2tlQXR0cnMuZGFzaEFycmF5ID0gZGE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0cm9rZUF0dHJzO1xufVxuY29uc3Qgc3R5bGVUb0Rhc2hBcnJheSA9IHtcbiAgICBzb2xpZDogXCJub25lXCIsXG4gICAgc2hvcnRkYXNoOiBbNCwgMV0sXG4gICAgc2hvcnRkb3Q6IFsxLCAxXSxcbiAgICBzaG9ydGRhc2hkb3Q6IFs0LCAxLCAxLCAxXSxcbiAgICBzaG9ydGRhc2hkb3Rkb3Q6IFs0LCAxLCAxLCAxLCAxLCAxXSxcbiAgICBkb3Q6IFsxLCAzXSxcbiAgICBkYXNoOiBbNCwgM10sXG4gICAgbG9uZ2Rhc2g6IFs4LCAzXSxcbiAgICBkYXNoZG90OiBbNCwgMywgMSwgM10sXG4gICAgbG9uZ2Rhc2hkb3Q6IFs4LCAzLCAxLCAzXSxcbiAgICBsb25nZGFzaGRvdGRvdDogWzgsIDMsIDEsIDMsIDEsIDNdXG59O1xuXG5jb25zdCBhcmNnaXNTeW1ib2xTdHlsZXJDb2xvclJhbXBJbnB1dENzcyA9IFwiLnNjcm9sbGVye21heC1oZWlnaHQ6dmFyKC0tc2Nyb2xsZXItbWF4LWhlaWdodCwgMjAwcHgpO292ZXJmbG93LXk6YXV0bzttaW4td2lkdGg6MjAwcHg7b3ZlcmZsb3cteDpoaWRkZW47ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9LmNvbG9yLXJhbXAtaXRlbXtkaXNwbGF5OmlubGluZS1mbGV4O2ZsZXgtZ3JvdzoxfS5jb2xvci1yYW1wLWl0ZW0gc3Zne2Rpc3BsYXk6ZmxleH0uY29sb3ItcGlja2VyLWNvbnRhaW5lcntkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5jb2xvci1waWNrZXItY29udGFpbmVyIGFyY2dpcy1pdGVtLXBhbGV0dGUgLnBhbGV0dGV7Z2FwOjIwcHh9Y2FsY2l0ZS1jb2xvci1waWNrZXItc3dhdGNoe3dpZHRoOjIwMHB4fS5zZWN0aW9ue2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47cGFkZGluZzoxMnB4O2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKX0uY29sb3ItcmFtcC1zZWxlY3Rpb257cGFkZGluZzo0cHggMjBweCA0cHggNHB4O2JvcmRlcjoxcHggc29saWQgbGlnaHRncmF5O2JvcmRlci10b3A6bm9uZX0uYXJjZ2lzLS1ydGwgLmNvbG9yLXJhbXAtc2VsZWN0aW9ue3BhZGRpbmc6NHB4IDRweCA0cHggMjBweDt9LmNvbG9yLXJhbXAtZmxpcHBlciBjYWxjaXRlLWljb257bWFyZ2luOjAgMC41cmVtfVtzbG90PXByZXZpZXddIC5jb2xvci1yYW1wLWl0ZW17aGVpZ2h0OjI0cHh9XCI7XG5cbmNvbnN0IEFyY2dpc1N5bWJvbFN0eWxlckNvbG9yUmFtcElucHV0ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5zZXRJbmxpbmVJbnB1dFJlZiA9IChlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbmxpbmVJbnB1dEVsID0gZWw7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBsYWNlbWVudCA9IFwiYXV0b1wiO1xuICAgICAgICB0aGlzLnBvcG92ZXJQcm9wcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdHJpbmdzID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHVibGljIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBzZXRGb2N1cygpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBhd2FpdCAoKF9hID0gdGhpcy5pbmxpbmVJbnB1dEVsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKSk7XG4gICAgfVxuICAgIGFzeW5jIGNsb3NlKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGF3YWl0ICgoX2EgPSB0aGlzLmlubGluZUlucHV0RWwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbG9zZSgpKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRpc2FibGVkLCBzdHJpbmdzIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBkaXIgPSBnZXRFbGVtZW50RGlyKHRoaXMuZWwpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImFyY2dpcy1zeW1ib2wtc3R5bGVyLWlubGluZS1pbnB1dFwiLCB7IGRpc2FibGVkOiBkaXNhYmxlZCwgaW50bERvbmU6IHN0cmluZ3MuZG9uZSwgaGVhZGluZzogc3RyaW5ncy5yYW1wLCBsYWJlbDogdGhpcy5vcHRpb25zLmhlYWRpbmcsIHBvcG92ZXJQcm9wczogdGhpcy5wb3BvdmVyUHJvcHMsIHJlZjogdGhpcy5zZXRJbmxpbmVJbnB1dFJlZiwgY2xhc3M6IHtcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogZGlyID09PSBcInJ0bFwiXG4gICAgICAgICAgICB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogQ1NTJDIuY29sb3JQaWNrZXJDb250YWluZXIsIHNsb3Q6IFwiY29udGVudFwiIH0sIHRoaXMucmVuZGVyUmFtcHNDb250ZW50KHRoaXMub3B0aW9ucykpLCBoKFwiZGl2XCIsIHsgc2xvdDogXCJwcmV2aWV3XCIgfSwgaChDb2xvclJhbXBJdGVtLCB7IHN0b3BzOiB0aGlzLm9wdGlvbnMuY29sb3JSYW1wU3RvcHMuc2xpY2UoKS5yZXZlcnNlKCksIHN0eWxlOiB0aGlzLm9wdGlvbnMuc3R5bGUsIGxheW91dDogXCJob3Jpem9udGFsXCIsIGhlaWdodDogXCIxMDAlXCIsIHdpZHRoOiBcIjEwMCVcIiB9KSkpKSk7XG4gICAgfVxuICAgIHJlbmRlclJhbXBzQ29udGVudCh7IGFjdGl2ZUNhdGVnb3J5LCBjb2xvclJhbXBzLCBpc1NlbGVjdGVkLCBvbkNhdGVnb3J5Q2hhbmdlLCBvbkZsaXAsIG9uU2VsZWN0LCBzdHlsZSB9KSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBjYXRlZ29yaWVzLCByYW1wcyB9ID0gdGhpcy5nZXRDYXRlZ29yaWVzQW5kQ29sb3JSYW1wc0J5U2VsZWN0ZWRDYXRlZ29yeShhY3RpdmVDYXRlZ29yeSwgY29sb3JSYW1wcyk7XG4gICAgICAgIGNvbnN0IGlzMkQgPSBzdHlsZSA9PT0gXCIyZFwiO1xuICAgICAgICBjb25zdCByYW1wRmxpcEljb24gPSBpczJEID8gXCJyb3RhdGVcIiA6IFwiYXJyb3ctdXAtZG93blwiO1xuICAgICAgICBjb25zdCByYW1wRmxpcExhYmVsID0gaXMyRCA/IHN0cmluZ3Mucm90YXRlQ29sb3JzIDogc3RyaW5ncy5mbGlwQ29sb3JzO1xuICAgICAgICBjb25zdCByYW1wSXRlbVJlbmRlcmVyID0gaXMyRCA/IFJlbGF0aW9uc2hpcFJhbXBDb2xvclJhbXBJdGVtIDogQ29sb3JSYW1wSXRlbTtcbiAgICAgICAgY29uc3QgcmFtcHNQZXJSb3cgPSBpczJEID8gMyA6IDY7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBoKFwiZGl2XCIsIHsgY2xhc3M6IFwic2VjdGlvblwiIH0sIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHRoaXMuc3RyaW5ncy5jYXRlZ29yeSwgaChcImNhbGNpdGUtc2VsZWN0XCIsIHsgd2lkdGg6IFwiZnVsbFwiLCBsYWJlbDogdGhpcy5zdHJpbmdzLmNhdGVnb3J5LCBvbkNhbGNpdGVTZWxlY3RDaGFuZ2U6IG9uQ2F0ZWdvcnlDaGFuZ2UgfSwgY2F0ZWdvcmllcy5tYXAoKGNhdGVnb3J5KSA9PiAoaChcImNhbGNpdGUtb3B0aW9uXCIsIHsgdmFsdWU6IGNhdGVnb3J5LCBsYWJlbDogc3RyaW5ncy5jYXRlZ29yaWVzW2NhdGVnb3J5XSwgc2VsZWN0ZWQ6IGNhdGVnb3J5ID09PSBhY3RpdmVDYXRlZ29yeSB9KSkpKSksIGgoXCJjYWxjaXRlLWJ1dHRvblwiLCB7IGNsYXNzOiBDU1MkNC5jb2xvclJhbXBGbGlwcGVyLCBhcHBlYXJhbmNlOiBcInRyYW5zcGFyZW50XCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgb25GbGlwKCk7XG4gICAgICAgICAgICAgICAgfSwgc2NhbGU6IFwic1wiLCB3aWR0aDogXCJmdWxsXCIgfSwgaChcImNhbGNpdGUtaWNvblwiLCB7IGljb246IHJhbXBGbGlwSWNvbiwgc2NhbGU6IFwic1wiLCBzdHlsZTogaXMyRCA/IHsgdHJhbnNmb3JtOiBcInJvdGF0ZVkoMTgwZGVnKVwiIH0gOiBudWxsIH0pLCByYW1wRmxpcExhYmVsKSksXG4gICAgICAgICAgICBoKFwiZGl2XCIsIHsgY2xhc3M6IHsgW0NTUyQ0LnNjcm9sbGVyXTogdHJ1ZSwgW0NTUyQ0LmNvbG9yUmFtcFNlbGVjdGlvbl06IHRydWUgfSB9LCBoKFwiYXJjZ2lzLWl0ZW0tcGFsZXR0ZVwiLCB7IGl0ZW1zOiByYW1wcywgZXh0cmFJdGVtUHJvcHM6IHsgc3R5bGUgfSwgSXRlbVJlbmRlcmVyOiByYW1wSXRlbVJlbmRlcmVyLCBpdGVtc1BlclJvdzogcmFtcHNQZXJSb3csIHNlbGVjdGVkOiBpc1NlbGVjdGVkLCBvbkFyY2dpc0l0ZW1TZWxlY3Q6IG9uU2VsZWN0IH0pKVxuICAgICAgICBdO1xuICAgIH1cbiAgICBnZXRDYXRlZ29yaWVzQW5kQ29sb3JSYW1wc0J5U2VsZWN0ZWRDYXRlZ29yeShhY3RpdmVDYXRlZ29yeSwgYWxsUmFtcHMpIHtcbiAgICAgICAgY29uc3QgYWN0aXZlVGFncyA9IGNhdGVnb3JpZXNUb1RhZ3NbYWN0aXZlQ2F0ZWdvcnldO1xuICAgICAgICBjb25zdCBhY3RpdmVSYW1wcyA9IGFsbFJhbXBzLmZpbHRlcigoY29sb3JSYW1wKSA9PiBhY3RpdmVDYXRlZ29yeSA9PT0gXCJhbGxcIiB8fCBhY3RpdmVUYWdzLnNvbWUoKHRhZykgPT4gY29sb3JSYW1wLnRhZ3MuaW5kZXhPZih0YWcpID4gLTEpKTtcbiAgICAgICAgY29uc3QgdXNlZFRhZ3NTZXQgPSBuZXcgU2V0KCk7XG4gICAgICAgIGFsbFJhbXBzLmZvckVhY2goKHJhbXApID0+IHJhbXAudGFncy5mb3JFYWNoKCh0YWcpID0+IHVzZWRUYWdzU2V0LmFkZCh0YWcpKSk7XG4gICAgICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBPYmplY3Qua2V5cyhjYXRlZ29yaWVzVG9UYWdzKS5maWx0ZXIoKGNhdGVnb3J5KSA9PiBjYXRlZ29yeSA9PT0gXCJhbGxcIiB8fCBjYXRlZ29yaWVzVG9UYWdzW2NhdGVnb3J5XS5zb21lKCh0YWcpID0+IHVzZWRUYWdzU2V0Lmhhcyh0YWcpKSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjYXRlZ29yaWVzLFxuICAgICAgICAgICAgcmFtcHM6IGFjdGl2ZVJhbXBzXG4gICAgICAgIH07XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTeW1ib2xTdHlsZXJDb2xvclJhbXBJbnB1dC5zdHlsZSA9IGFyY2dpc1N5bWJvbFN0eWxlckNvbG9yUmFtcElucHV0Q3NzO1xuXG5jb25zdCBhcmNnaXNTeW1ib2xTdHlsZXJTZWN0aW9uQ3NzID0gXCI6aG9zdHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYXJjZ2lzLWFwcC1iYWNrZ3JvdW5kKTtwYWRkaW5nOjE2cHggMTJweH06aG9zdChbZGlzYWJsZWRdKXtvcGFjaXR5OnZhcigtLWFyY2dpcy1hcHAtZGlzYWJsZWQtb3BhY2l0eSk7cG9pbnRlci1ldmVudHM6bm9uZX06aG9zdChbZW1iZWRkZWRdKXtwYWRkaW5nOjB9XCI7XG5cbmNvbnN0IEFyY2dpc1N5bWJvbFN0eWxlclNlY3Rpb24gPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZW1iZWRkZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFJlbmRlciBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAvKiBpbnRlbnRpb25hbGx5IHVzaW5nIGF0dHJpYnV0ZSB0byBhdm9pZCBmb2N1c2luZyBjb250YWluZXIgd2hlbiAhZGlzYWJsZWQgKi9cbiAgICAgICAgaChIb3N0LCB7IHRhYmluZGV4OiB0aGlzLmRpc2FibGVkID8gLTEgOiBcIlwiIH0sIGgoXCJzbG90XCIsIG51bGwpKSk7XG4gICAgfVxufTtcbkFyY2dpc1N5bWJvbFN0eWxlclNlY3Rpb24uc3R5bGUgPSBhcmNnaXNTeW1ib2xTdHlsZXJTZWN0aW9uQ3NzO1xuXG5jb25zdCBhcmNnaXNTeW1ib2xTdHlsZXJTeW1ib2xQcmV2aWV3Q3NzID0gXCI6aG9zdHtkaXNwbGF5OmlubGluZS1ibG9ja306aG9zdCguZGFyayl7YmFja2dyb3VuZC1jb2xvcjojZjNmM2YzfVwiO1xuXG5jb25zdCBBcmNnaXNTeW1ib2xTdHlsZXJTeW1ib2xQcmV2aWV3ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgICAgIC8vXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3ID0gZGVib3VuY2UoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgeyBzeW1ib2wgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoIXN5bWJvbCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgLy8gd2UgZHJvcCBzaXplIHRvIHByZXZlbnQgYSBrbm93biByZW5kZXJpbmcgaXNzdWUg4oCTIGh0dHBzOi8vZGV2dG9waWEuZXNyaS5jb20vV2ViR0lTL2FyY2dpcy1qcy1hcGkvaXNzdWVzLzQxNzkwXG4gICAgICAgICAgICBpZiAoc3ltYm9sLnR5cGUgPT09IFwiY2ltXCIgJiYgc3ltYm9sLmRhdGEuc3ltYm9sLnR5cGUgPT09IFwiQ0lNUG9seWdvblN5bWJvbFwiKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHByaW50U3ltYm9sID0gc3ltYm9sLmNsb25lKCk7XG4gICAgICAgICAgICBpZiAocHJpbnRTeW1ib2wudHlwZSA9PT0gXCJwaWN0dXJlLW1hcmtlclwiICYmIG9wdGlvbnMuc2l6ZSAmJiB0eXBlb2Ygb3B0aW9ucy5zaXplID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVuZGVyUHJldmlld0hUTUwgZG9lc24ndCB3b3JrIHdlbGwgd2l0aCBub24tc3F1YXJlIFBNU1xuICAgICAgICAgICAgICAgIC8vIGNoYW5nZSBzeW1ib2wgdG8gdGhlIHNpemUgd2UgbmVlZCBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgcHJpbnRTeW1ib2wud2lkdGggPSAocHJpbnRTeW1ib2wud2lkdGggLyBwcmludFN5bWJvbC5oZWlnaHQpICogb3B0aW9ucy5zaXplO1xuICAgICAgICAgICAgICAgIHByaW50U3ltYm9sLmhlaWdodCA9IG9wdGlvbnMuc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQcmV2aWV3UmVuZGVyID0gZXNyaU1vZHVsZXMuc3ltYm9sVXRpbHMucmVuZGVyUHJldmlld0hUTUwocHJpbnRTeW1ib2wsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5sYXN0UHJldmlld1JlbmRlciA9IGN1cnJlbnRQcmV2aWV3UmVuZGVyO1xuICAgICAgICAgICAgY29uc3QgcHJldmlldyA9IGF3YWl0IGN1cnJlbnRQcmV2aWV3UmVuZGVyO1xuICAgICAgICAgICAgY29uc3QgcHJldmlld0lzT3V0ZGF0ZWQgPSB0aGlzLmxhc3RQcmV2aWV3UmVuZGVyICE9PSBjdXJyZW50UHJldmlld1JlbmRlcjtcbiAgICAgICAgICAgIGlmIChwcmV2aWV3SXNPdXRkYXRlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIChfYSA9IHRoaXMubGFzdFByZXZpZXcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFByZXZpZXcgPSBwcmV2aWV3O1xuICAgICAgICAgICAgdGhpcy5lbC5zaGFkb3dSb290LmFwcGVuZChwcmV2aWV3KTtcbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZFRoZW1lID0gZXNyaU1vZHVsZXMucHJldmlld1N5bWJvbDJELmdldENvbnRyYXN0aW5nQmFja2dyb3VuZFRoZW1lKHN5bWJvbCwgMjQ1KTtcbiAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kVGhlbWUgPSBcImxpZ2h0XCI7XG4gICAgICAgIHRoaXMuY29udHJhc3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgd2F0Y2hTeW1ib2xBbmRPcHRpb25zKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlUHJldmlldygpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiBoKEhvc3QsIHsgY2xhc3M6IHsgZGFyazogdGhpcy5jb250cmFzdCAmJiB0aGlzLmJhY2tncm91bmRUaGVtZSA9PT0gXCJkYXJrXCIgfSB9KTtcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwic3ltYm9sXCI6IFtcIndhdGNoU3ltYm9sQW5kT3B0aW9uc1wiXSxcbiAgICAgICAgXCJvcHRpb25zXCI6IFtcIndhdGNoU3ltYm9sQW5kT3B0aW9uc1wiXVxuICAgIH07IH1cbn07XG5BcmNnaXNTeW1ib2xTdHlsZXJTeW1ib2xQcmV2aWV3LnN0eWxlID0gYXJjZ2lzU3ltYm9sU3R5bGVyU3ltYm9sUHJldmlld0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzQ29sb3JJbnB1dCBhcyBhcmNnaXNfY29sb3JfaW5wdXQsIEFyY2dpc1BvcHVwQ29sb3JQb3BvdmVyIGFzIGFyY2dpc19wb3B1cF9jb2xvcl9wb3BvdmVyLCBBcmNnaXNQb3B1cFN0eWxlclBvcG92ZXIgYXMgYXJjZ2lzX3BvcHVwX3N0eWxlcl9wb3BvdmVyLCBBcmNnaXNTeW1ib2xTdHlsZXJGaWxlVXBsb2FkIGFzIGFyY2dpc19zeW1ib2xfcGlja2VyX2ZpbGVfdXBsb2FkLCBBcmNnaXNTeW1ib2xTdHlsZXJDb2xvclJhbXBJbnB1dCBhcyBhcmNnaXNfc3ltYm9sX3N0eWxlcl9jb2xvcl9yYW1wX2lucHV0LCBBcmNnaXNTeW1ib2xTdHlsZXJTZWN0aW9uIGFzIGFyY2dpc19zeW1ib2xfc3R5bGVyX3NlY3Rpb24sIEFyY2dpc1N5bWJvbFN0eWxlclN5bWJvbFByZXZpZXcgYXMgYXJjZ2lzX3N5bWJvbF9zdHlsZXJfc3ltYm9sX3ByZXZpZXcgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXJjZ2lzLWNvbG9yLWlucHV0XzcuZW50cnkuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBnIGFzIGdldFJlbmRlcmluZ1JlZiwgZiBhcyBmb3JjZVVwZGF0ZSB9IGZyb20gJy4vaW5kZXgtZTNiZjdkYTcuanMnO1xuXG5jb25zdCBhcHBlbmRUb01hcCA9IChtYXAsIHByb3BOYW1lLCB2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IGl0ZW1zID0gbWFwLmdldChwcm9wTmFtZSk7XG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgICBtYXAuc2V0KHByb3BOYW1lLCBbdmFsdWVdKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWl0ZW1zLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTtcbiAgICB9XG59O1xuY29uc3QgZGVib3VuY2UgPSAoZm4sIG1zKSA9PiB7XG4gICAgbGV0IHRpbWVvdXRJZDtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aW1lb3V0SWQgPSAwO1xuICAgICAgICAgICAgZm4oLi4uYXJncyk7XG4gICAgICAgIH0sIG1zKTtcbiAgICB9O1xufTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHBvc3NpYmxlIGVsZW1lbnQgaXNDb25uZWN0ZWQuXG4gKiBUaGUgcHJvcGVydHkgbWlnaHQgbm90IGJlIHRoZXJlLCBzbyB3ZSBjaGVjayBmb3IgaXQuXG4gKlxuICogV2Ugd2FudCBpdCB0byByZXR1cm4gdHJ1ZSBpZiBpc0Nvbm5lY3RlZCBpcyBub3QgYSBwcm9wZXJ0eSxcbiAqIG90aGVyd2lzZSB3ZSB3b3VsZCByZW1vdmUgdGhlc2UgZWxlbWVudHMgYW5kIHdvdWxkIG5vdCB1cGRhdGUuXG4gKlxuICogQmV0dGVyIGxlYWsgaW4gRWRnZSB0aGFuIHRvIGJlIHVzZWxlc3MuXG4gKi9cbmNvbnN0IGlzQ29ubmVjdGVkID0gKG1heWJlRWxlbWVudCkgPT4gISgnaXNDb25uZWN0ZWQnIGluIG1heWJlRWxlbWVudCkgfHwgbWF5YmVFbGVtZW50LmlzQ29ubmVjdGVkO1xuY29uc3QgY2xlYW51cEVsZW1lbnRzID0gZGVib3VuY2UoKG1hcCkgPT4ge1xuICAgIGZvciAobGV0IGtleSBvZiBtYXAua2V5cygpKSB7XG4gICAgICAgIG1hcC5zZXQoa2V5LCBtYXAuZ2V0KGtleSkuZmlsdGVyKGlzQ29ubmVjdGVkKSk7XG4gICAgfVxufSwgMjAwMCk7XG5jb25zdCBzdGVuY2lsU3Vic2NyaXB0aW9uID0gKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgZ2V0UmVuZGVyaW5nUmVmICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIElmIHdlIGFyZSBub3QgaW4gYSBzdGVuY2lsIHByb2plY3QsIHdlIGRvIG5vdGhpbmcuXG4gICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgbm90IHJlYWxseSBleHBvcnRlZCBieSBAc3RlbmNpbC9jb3JlLlxuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGVsbXNUb1VwZGF0ZSA9IG5ldyBNYXAoKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiAoKSA9PiBlbG1zVG9VcGRhdGUuY2xlYXIoKSxcbiAgICAgICAgZ2V0OiAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsbSA9IGdldFJlbmRlcmluZ1JlZigpO1xuICAgICAgICAgICAgaWYgKGVsbSkge1xuICAgICAgICAgICAgICAgIGFwcGVuZFRvTWFwKGVsbXNUb1VwZGF0ZSwgcHJvcE5hbWUsIGVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogKHByb3BOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGVsbXNUb1VwZGF0ZS5nZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgZWxtc1RvVXBkYXRlLnNldChwcm9wTmFtZSwgZWxlbWVudHMuZmlsdGVyKGZvcmNlVXBkYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhbnVwRWxlbWVudHMoZWxtc1RvVXBkYXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXQ6ICgpID0+IHtcbiAgICAgICAgICAgIGVsbXNUb1VwZGF0ZS5mb3JFYWNoKChlbG1zKSA9PiBlbG1zLmZvckVhY2goZm9yY2VVcGRhdGUpKTtcbiAgICAgICAgICAgIGNsZWFudXBFbGVtZW50cyhlbG1zVG9VcGRhdGUpO1xuICAgICAgICB9LFxuICAgIH07XG59O1xuXG5jb25zdCB1bndyYXAgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJyA/IHZhbCgpIDogdmFsKTtcbmNvbnN0IGNyZWF0ZU9ic2VydmFibGVNYXAgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUgPSAoYSwgYikgPT4gYSAhPT0gYikgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZFN0YXRlID0gdW53cmFwKGRlZmF1bHRTdGF0ZSk7XG4gICAgbGV0IHN0YXRlcyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXModW53cmFwcGVkU3RhdGUgIT09IG51bGwgJiYgdW53cmFwcGVkU3RhdGUgIT09IHZvaWQgMCA/IHVud3JhcHBlZFN0YXRlIDoge30pKTtcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcbiAgICAgICAgZGlzcG9zZTogW10sXG4gICAgICAgIGdldDogW10sXG4gICAgICAgIHNldDogW10sXG4gICAgICAgIHJlc2V0OiBbXSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIFdoZW4gcmVzZXR0aW5nIHRoZSBzdGF0ZSwgdGhlIGRlZmF1bHQgc3RhdGUgbWF5IGJlIGEgZnVuY3Rpb24gLSB1bndyYXAgaXQgdG8gaW52b2tlIGl0LlxuICAgICAgICAvLyBvdGhlcndpc2UsIHRoZSBzdGF0ZSB3b24ndCBiZSBwcm9wZXJseSByZXNldFxuICAgICAgICBzdGF0ZXMgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKChfYSA9IHVud3JhcChkZWZhdWx0U3RhdGUpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB7fSkpO1xuICAgICAgICBoYW5kbGVycy5yZXNldC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfTtcbiAgICBjb25zdCBkaXNwb3NlID0gKCkgPT4ge1xuICAgICAgICAvLyBDYWxsIGZpcnN0IGRpc3Bvc2UgYXMgcmVzZXR0aW5nIHRoZSBzdGF0ZSB3b3VsZFxuICAgICAgICAvLyBjYXVzZSBsZXNzIHVwZGF0ZXMgOylcbiAgICAgICAgaGFuZGxlcnMuZGlzcG9zZS5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgfTtcbiAgICBjb25zdCBnZXQgPSAocHJvcE5hbWUpID0+IHtcbiAgICAgICAgaGFuZGxlcnMuZ2V0LmZvckVhY2goKGNiKSA9PiBjYihwcm9wTmFtZSkpO1xuICAgICAgICByZXR1cm4gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgfTtcbiAgICBjb25zdCBzZXQgPSAocHJvcE5hbWUsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gc3RhdGVzLmdldChwcm9wTmFtZSk7XG4gICAgICAgIGlmIChzaG91bGRVcGRhdGUodmFsdWUsIG9sZFZhbHVlLCBwcm9wTmFtZSkpIHtcbiAgICAgICAgICAgIHN0YXRlcy5zZXQocHJvcE5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2IocHJvcE5hbWUsIHZhbHVlLCBvbGRWYWx1ZSkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzdGF0ZSA9ICh0eXBlb2YgUHJveHkgPT09ICd1bmRlZmluZWQnXG4gICAgICAgID8ge31cbiAgICAgICAgOiBuZXcgUHJveHkodW53cmFwcGVkU3RhdGUsIHtcbiAgICAgICAgICAgIGdldChfLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXQocHJvcE5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG93bktleXMoXykge1xuICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRlcy5rZXlzKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXMoXywgcHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzLmhhcyhwcm9wTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KF8sIHByb3BOYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldChwcm9wTmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpO1xuICAgIGNvbnN0IG9uID0gKGV2ZW50TmFtZSwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZUZyb21BcnJheShoYW5kbGVyc1tldmVudE5hbWVdLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBvbkNoYW5nZSA9IChwcm9wTmFtZSwgY2IpID0+IHtcbiAgICAgICAgY29uc3QgdW5TZXQgPSBvbignc2V0JywgKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IHByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2IobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gV2UgbmVlZCB0byB1bndyYXAgdGhlIGRlZmF1bHRTdGF0ZSBiZWNhdXNlIGl0IG1pZ2h0IGJlIGEgZnVuY3Rpb24uXG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBtaWdodCBub3QgYmUgc2VuZGluZyB0aGUgcmlnaHQgcmVzZXQgdmFsdWUuXG4gICAgICAgIGNvbnN0IHVuUmVzZXQgPSBvbigncmVzZXQnLCAoKSA9PiBjYih1bndyYXAoZGVmYXVsdFN0YXRlKVtwcm9wTmFtZV0pKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVuU2V0KCk7XG4gICAgICAgICAgICB1blJlc2V0KCk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCB1c2UgPSAoLi4uc3Vic2NyaXB0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCB1bnN1YnMgPSBzdWJzY3JpcHRpb25zLnJlZHVjZSgodW5zdWJzLCBzdWJzY3JpcHRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uc2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ3NldCcsIHN1YnNjcmlwdGlvbi5zZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZ2V0KSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzLnB1c2gob24oJ2dldCcsIHN1YnNjcmlwdGlvbi5nZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24ucmVzZXQpIHtcbiAgICAgICAgICAgICAgICB1bnN1YnMucHVzaChvbigncmVzZXQnLCBzdWJzY3JpcHRpb24ucmVzZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24uZGlzcG9zZSkge1xuICAgICAgICAgICAgICAgIHVuc3Vicy5wdXNoKG9uKCdkaXNwb3NlJywgc3Vic2NyaXB0aW9uLmRpc3Bvc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bnN1YnM7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHVuc3Vicy5mb3JFYWNoKCh1bnN1YikgPT4gdW5zdWIoKSk7XG4gICAgfTtcbiAgICBjb25zdCBmb3JjZVVwZGF0ZSA9IChrZXkpID0+IHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZXMuZ2V0KGtleSk7XG4gICAgICAgIGhhbmRsZXJzLnNldC5mb3JFYWNoKChjYikgPT4gY2Ioa2V5LCBvbGRWYWx1ZSwgb2xkVmFsdWUpKTtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXRlLFxuICAgICAgICBnZXQsXG4gICAgICAgIHNldCxcbiAgICAgICAgb24sXG4gICAgICAgIG9uQ2hhbmdlLFxuICAgICAgICB1c2UsXG4gICAgICAgIGRpc3Bvc2UsXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBmb3JjZVVwZGF0ZSxcbiAgICB9O1xufTtcbmNvbnN0IHJlbW92ZUZyb21BcnJheSA9IChhcnJheSwgaXRlbSkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gYXJyYXkuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICBhcnJheVtpbmRleF0gPSBhcnJheVthcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgYXJyYXkubGVuZ3RoLS07XG4gICAgfVxufTtcblxuY29uc3QgY3JlYXRlU3RvcmUgPSAoZGVmYXVsdFN0YXRlLCBzaG91bGRVcGRhdGUpID0+IHtcbiAgICBjb25zdCBtYXAgPSBjcmVhdGVPYnNlcnZhYmxlTWFwKGRlZmF1bHRTdGF0ZSwgc2hvdWxkVXBkYXRlKTtcbiAgICBtYXAudXNlKHN0ZW5jaWxTdWJzY3JpcHRpb24oKSk7XG4gICAgcmV0dXJuIG1hcDtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZVN0b3JlIGFzIGMgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgtMDU5NTZjYWIuanMubWFwIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogdjQuMC41OFxuICovXG5pbXBvcnQgeyBjIGFzIGNyZWF0ZVN0b3JlIH0gZnJvbSAnLi9pbmRleC0wNTk1NmNhYi5qcyc7XG5cbmNvbnN0IHBvcHVwU3RvcmUgPSBjcmVhdGVTdG9yZSh7XG4gICAgbGF5ZXI6IG51bGwsXG4gICAgbWFwVmlldzogbnVsbCxcbiAgICBwb3J0YWw6IG51bGwsXG4gICAgY29uZmlnOiBudWxsLFxuICAgIHN0cmluZ3M6IG51bGwsXG4gICAgY3VycmVudExhbmd1YWdlOiBudWxsLFxuICAgIGN1cnJlbnRMYW5ndWFnZUludGw6IG51bGwsXG4gICAgc2VydmljZVR5cGU6IG51bGwsXG4gICAgcG9wdXBUZW1wbGF0ZTogbnVsbCxcbiAgICBsYXllckhhc0F0dGFjaG1lbnQ6IG51bGwsXG4gICAgbGF5ZXJIYXNFVDogbnVsbCxcbiAgICBsYXllckhhc0F0dHJpYnV0ZXM6IG51bGwsXG4gICAgbGF5ZXJIYXNDaGFydHM6IG51bGwsXG4gICAgbGF5ZXJIYXNJbWFnZXM6IG51bGwsXG4gICAgbGF5ZXJIYXNUZXh0OiBudWxsLFxuICAgIGxheWVyRGlzcGxheVR5cGU6IG51bGwsXG4gICAgc3VwcG9ydHNBcmNhZGU6IG51bGwsXG4gICAgbGF5ZXJIYXNSZWxhdGVkUmVjb3JkczogZmFsc2Vcbn0pO1xuLy8gd29ya2Fyb3VuZCBmb3Igc3RhcnRpbmcgYSBwYW5lbCB3aXRoIGEgY2xlYW4gc3RhdGVcbmZ1bmN0aW9uIGNsZWFyUG9wdXBTdGF0ZShwb3B1cFN0YXRlKSB7XG4gICAgcG9wdXBTdGF0ZS5sYXllciA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5tYXBWaWV3ID0gbnVsbDtcbiAgICBwb3B1cFN0YXRlLnBvcnRhbCA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5jb25maWcgPSBudWxsO1xuICAgIHBvcHVwU3RhdGUuc3RyaW5ncyA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5jdXJyZW50TGFuZ3VhZ2UgPSBudWxsO1xuICAgIHBvcHVwU3RhdGUuY3VycmVudExhbmd1YWdlSW50bCA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5zZXJ2aWNlVHlwZSA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5wb3B1cFRlbXBsYXRlID0gbnVsbDtcbiAgICBwb3B1cFN0YXRlLmxheWVySGFzQXR0YWNobWVudCA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5sYXllckhhc0VUID0gbnVsbDtcbiAgICBwb3B1cFN0YXRlLmxheWVySGFzQXR0cmlidXRlcyA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5sYXllckhhc0NoYXJ0cyA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5sYXllckhhc0ltYWdlcyA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5sYXllckhhc1RleHQgPSBudWxsO1xuICAgIHBvcHVwU3RhdGUubGF5ZXJEaXNwbGF5VHlwZSA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5zdXBwb3J0c0FyY2FkZSA9IG51bGw7XG4gICAgcG9wdXBTdGF0ZS5sYXllckhhc1JlbGF0ZWRSZWNvcmRzID0gZmFsc2U7XG59XG5jb25zdCBwb3B1cFN0YXRlID0gcG9wdXBTdG9yZS5zdGF0ZTtcblxuZXhwb3J0IHsgY2xlYXJQb3B1cFN0YXRlIGFzIGMsIHBvcHVwU3RhdGUgYXMgcCB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wb3B1cFN0b3JlLTg1MzgxNDUzLmpzLm1hcCIsIi8qIVxuICogQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAqIHY0LjAuNThcbiAqL1xuaW1wb3J0IHsgZSBhcyBlc2NhcGVSZWdFeHAgfSBmcm9tICcuL2Z1bmN0aW9uYWwtNDRkZThmY2YuanMnO1xuXG4vLyBpbXBvcnQgc3RyaW5nVXRpbCBmcm9tIFwiLi9zdHJpbmdzXCI7XG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHN0b3JhZ2Ugb2YgdmFyaW91cyBmb3JtcyAoY29va2llcywgbG9jYWwgc3RvcmFnZSwgYW5kIHNlc3Npb24gc3RvcmFnZSkuXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZShuYW1lLCBjb29raWUsIHByb3BlcnRpZXMsIHN0cmluZ2lmeSkge1xuICAgIHdyaXRlQ29va2llKG5hbWUsIHN0cmluZ2lmeSA/IEpTT04uc3RyaW5naWZ5KGNvb2tpZSkgOiBjb29raWUsIHByb3BlcnRpZXMpO1xufVxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUsIHBhcnNlKSB7XG4gICAgY29uc3QgY29va2llID0gcmVhZENvb2tpZShuYW1lKTtcbiAgICByZXR1cm4gY29va2llICYmIHBhcnNlID8gSlNPTi5wYXJzZShjb29raWUpIDogY29va2llO1xufVxuZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlSXRlbShuYW1lLCBpdGVtLCBzdHJpbmdpZnkpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldExvY2FsU3RvcmFnZUl0ZW0obmFtZSwgcGFyc2UpIHtcbiAgICBjb25zdCBpdGVtID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWUpO1xuICAgIHJldHVybiBpdGVtICYmIHBhcnNlID8gSlNPTi5wYXJzZShpdGVtKSA6IGl0ZW07XG59XG5mdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0obmFtZSwgaXRlbSwgc3RyaW5naWZ5KSB7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZSwgc3RyaW5naWZ5ID8gSlNPTi5zdHJpbmdpZnkoaXRlbSkgOiBpdGVtKTtcbn1cbmZ1bmN0aW9uIGdldFNlc3Npb25TdG9yYWdlSXRlbShuYW1lLCBwYXJzZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShuYW1lKTtcbiAgICByZXR1cm4gaXRlbSAmJiBwYXJzZSA/IEpTT04ucGFyc2UoaXRlbSkgOiBpdGVtO1xufVxuZnVuY3Rpb24gcmVhZENvb2tpZShuYW1lKSB7XG4gICAgY29uc3QgY29va2llID0gZG9jdW1lbnQuY29va2llO1xuICAgIGNvbnN0IGNvb2tpZU5hbWVSRSA9IG5ldyBSZWdFeHAoYCg/Ol58OyApJHtlc2NhcGVSZWdFeHAobmFtZSl9PShbXjtdKilgKTtcbiAgICBjb25zdCBtYXRjaGVkQ29va2llcyA9IGNvb2tpZS5tYXRjaChjb29raWVOYW1lUkUpO1xuICAgIHJldHVybiBtYXRjaGVkQ29va2llcyA/IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVkQ29va2llc1sxXSkgOiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiB3cml0ZUNvb2tpZShuYW1lLCB2YWx1ZSwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGxldCBleHBpcmVzID0gcHJvcGVydGllcyA9PT0gbnVsbCB8fCBwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9wZXJ0aWVzLmV4cGlyZXM7XG4gICAgaWYgKHR5cGVvZiBleHBpcmVzID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgZGF5c0Zyb21Ub2RheUluTXMgPSBleHBpcmVzICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShEYXRlLm5vdygpICsgZGF5c0Zyb21Ub2RheUluTXMpO1xuICAgICAgICBleHBpcmVzID0gcHJvcGVydGllcy5leHBpcmVzID0gZXhwaXJhdGlvbkRhdGU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZXhwaXJlcyAhPT0gXCJzdHJpbmdcIiAmJiAoZXhwaXJlcyA9PT0gbnVsbCB8fCBleHBpcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBpcmVzLnRvVVRDU3RyaW5nKSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmV4cGlyZXMgPSBleHBpcmVzLnRvVVRDU3RyaW5nKCk7XG4gICAgfVxuICAgIGxldCBjb29raWUgPSBgJHtuYW1lfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSl9YDtcbiAgICBsZXQgcHJvcGVydHk7XG4gICAgZm9yIChwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGNvb2tpZSArPSBgOyAke3Byb3BlcnR5fWA7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvb2tpZSArPSBgPSR7cHJvcGVydHlWYWx1ZX1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZTtcbn1cblxuZXhwb3J0IHsgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtIGFzIGEsIGdldFNlc3Npb25TdG9yYWdlSXRlbSBhcyBiLCBnZXRDb29raWUgYXMgYywgc2V0Q29va2llIGFzIGQsIGdldExvY2FsU3RvcmFnZUl0ZW0gYXMgZywgc2V0TG9jYWxTdG9yYWdlSXRlbSBhcyBzIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0b3JhZ2UtMDM1M2E3NjkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9