/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-schema--818705.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-schema--818705"],{86747:(e,t,a)=>{a.r(t),a.d(t,{arcgis_schema_editor:()=>n});var r=a(81149),i=a(85984),s=a(82218),o=a(90406);a(42577),a(51837),a(69283);const n=class{constructor(e){(0,r.r)(this,e),this.arcgisSchemaEditorListOrderChange=(0,r.c)(this,"arcgisSchemaEditorListOrderChange",7),this.arcgisSchemaEditorDelete=(0,r.c)(this,"arcgisSchemaEditorDelete",7),this.arcgisSchemaEditorInvalidMove=(0,r.c)(this,"arcgisSchemaEditorInvalidMove",7),this.arcgisSchemaEditorTitleInvalid=(0,r.c)(this,"arcgisSchemaEditorTitleInvalid",7),this.prevChangeEventPayload=null,this.prevSchema=null,this.handleExpandCollapseAllClick=()=>{this.isCollapsedAll=!this.isCollapsedAll,this.itemRef.expandOrCollapseAll(this.isCollapsedAll)},this.handleListOrderChange=e=>{const{categorySchema:t,arcgisSchemaEditorListOrderChange:a,uiCategory:r}=this,i=(0,o.g)(r,e);a.emit(Object.assign(Object.assign({},e),{newSchema:i})),this.prevSchema=t},this.handleDeleteClick=e=>{const{arcgisSchemaEditorDelete:t,uiCategory:a}=this,r=(0,o.a)(a,e);t.emit(Object.assign(Object.assign({},e),{newSchema:r})),this.prevSchema=this.categorySchema},this.handleSaveNewTitle=async e=>{const{saveNewTitle:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:r}=this,s=e.path,n=(0,o.c)({targetParentCategory:(0,o.b)(a,s).parentCategory,targetCategory:{path:s,title:e.newTitle}});if(n)return r.emit(Object.assign(Object.assign({},e),{errorCode:n})),!1;const l=this.categorySchema,c=(0,o.d)(a,e),h=await t(Object.assign(Object.assign({},e),{newSchema:c}));if(h){this.prevSchema=l;const{targetCategory:t,parentCategory:r}=(0,o.b)(a,e.path);t.title=e.newTitle,t.path=(0,i.a)(r.path,t)}return h},this.handleSaveNewCategory=async e=>{const{saveNewCategory:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:r}=this,i=e.path,{parentCategory:s,targetCategory:n}=(0,o.b)(a,i),l=(0,o.c)({targetParentCategory:null!=n?n:s,targetCategory:{path:i,title:e.newTitle}});if(l)return r.emit(Object.assign(Object.assign({},e),{errorCode:l})),!1;const c=this.categorySchema,h=(0,o.e)(a,e),g=await t(Object.assign(Object.assign({},e),{newSchema:h}));return g&&(this.prevSchema=c),g},this.isMoveValid=e=>{const{maxDepth:t,arcgisSchemaEditorInvalidMove:a,prevChangeEventPayload:r}=this,{fromCategory:i,toCategory:s,fromItemCategory:n}=e,{fromCategory:l,fromItemCategory:c,toCategory:h,fromIndex:g,toIndex:d}=null!=r?r:{};if(r&&l.path===i.path&&c.path===n.path&&h.path===s.path&&g===e.fromIndex&&d===e.toIndex)return null;this.prevChangeEventPayload=e;const{path:C}=s;if("number"==typeof t&&C&&(0,o.f)(C)>t)return a.emit(Object.assign(Object.assign({},e),{errorCode:"maxDepthExceeded"})),!1;const u=(0,o.c)({targetParentCategory:s,targetCategory:n});return!u||(a.emit(Object.assign(Object.assign({},e),{errorCode:u})),!1)},this.categorySchema=void 0,this.categoryAggregationData=void 0,this.showInputByDefault=!1,this.newCategoryMode=void 0,this.maxDepth=2,this.maxCategories=900,this.canCollapseAll=!0,this.canEditCategory=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.isCollapsedAll=!1,this.uiCategory=void 0,this.canAddCategory=!1,this.canDeleteCategory=!1}async componentWillLoad(){const e=await(0,s.g)(this.el);this.i18n=e[0],this.categorySchemaChangeHandler()}async revertSchema(){this.categorySchema=this.prevSchema}categorySchemaChangeHandler(){const{categorySchema:e,categoryAggregationData:t}=this;this.uiCategory=(0,o.h)(e,t);const a=(0,o.i)(e);this.canAddCategory=a<this.maxCategories,this.canDeleteCategory=!0}render(){const{uiCategory:e,newCategoryMode:t,showInputByDefault:a,canAddCategory:i,canDeleteCategory:s,canEditCategory:o,canCollapseAll:n,i18n:l,isCollapsedAll:c,maxDepth:h,handleExpandCollapseAllClick:g,handleListOrderChange:d,handleSaveNewTitle:C,handleSaveNewCategory:u,isMoveValid:p}=this;return(0,r.h)(r.H,null,n&&(0,r.h)("calcite-button",{iconStart:c?"chevron-down":"chevron-up",appearance:"transparent",onClick:g,class:"expand-collapse-all"},c?l.expandAll:l.collapseAll),(0,r.h)("arcgis-schema-editor-category",{category:e,newCategoryMode:t,showInputByDefault:a,canAddCategory:i,canDeleteCategory:s,canEditCategory:o,i18n:l,maxDepth:h,isMoveValid:p,onListOrderChanged:e=>d(e.detail),onArcgisSchemaEditorInternalDeleteClick:e=>this.handleDeleteClick(e.detail),saveNewTitle:C,saveNewCategory:u,ref:e=>this.itemRef=e}))}get el(){return(0,r.d)(this)}static get watchers(){return{categorySchema:["categorySchemaChangeHandler"]}}};n.style=".expand-collapse-all{margin-bottom:1rem}"},85984:(e,t,a)=>{a.d(t,{C:()=>r,U:()=>i,a:()=>s,g:()=>o});const r="/categories",i="/Categories",s=(e,t,a=!0)=>{const r=null!=e?e:"";return`${r}${r.endsWith("/")?"":"/"}${a?t.title.toLocaleLowerCase():t.title}`};function o(e){var t;let a=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||i}},90406:(e,t,a)=>{a.d(t,{M:()=>y,a:()=>n,b:()=>c,c:()=>p,d:()=>s,e:()=>o,f:()=>l,g:()=>i,h:()=>h,i:()=>u});var r=a(85984);const i=(e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:r,toIndex:i})=>{const s=structuredClone(e),o=c(s,t);let n=o;t!==a&&(n=c(s,a));const[l]=o.targetCategory.categories.splice(r,1);return n.targetCategory.categories.splice(i,0,l),g(s)},s=(e,{newTitle:t,path:a})=>{const r=structuredClone(e);return c(r,a).targetCategory.title=t,g(r)},o=(e,{newTitle:t,path:a})=>{const r=structuredClone(e),i=a.replace(/\/[^/]+$/,"");if(i){const{targetCategory:e}=c(r,i);e.categories.push({title:t,categories:[],count:0,path:null})}else r.categories.push({title:t,categories:[],count:0,path:null});return g(r)},n=(e,{path:t})=>{const a=structuredClone(e),{targetIndex:r,parentCategory:i}=c(a,t);return null==i||i.categories.splice(r,1),g(a)},l=e=>{var t;return null!==(t=null==e?void 0:e.replace(r.C,"").slice(1).split("/").length)&&void 0!==t?t:0},c=(e,t)=>{if(null==t||t===r.C)return{targetCategory:e,targetIndex:1,parentCategory:null};const a=t.slice(1).split("/");let i=0===t.indexOf(r.C)?(0,r.a)("",{title:a.shift()}):"",s=null,o=e,n=0;do{i=(0,r.a)(i,{title:a.shift()}),s=o,n=o.categories.findIndex((e=>e.path===i)),o=o.categories[n]}while(a.length>0&&o.categories.length);return{targetCategory:o,targetIndex:n,parentCategory:s}},h=(e,t)=>{var a,i;return{title:"",path:null,count:null!==(i=null===(a=t.fieldValues.find((e=>e.value===r.C)))||void 0===a?void 0:a.count)&&void 0!==i?i:0,categories:C(null,e,t)}},g=e=>e.categories.map(d),d=e=>({title:e.title,categories:e.categories.map(d)}),C=(e,t,a)=>t.map((t=>{var i,s;const o=(0,r.a)(null!=e?e:r.C,t),n=null===(i=a.fieldValues.find((e=>e.value===o)))||void 0===i?void 0:i.count,l=C(o,null!==(s=t.categories)&&void 0!==s?s:[],a);return{title:t.title,path:o,count:null!=n?n:0,categories:l}})),u=e=>e.reduce(((e,t)=>{var a;return e+1+u(null!==(a=t.categories)&&void 0!==a?a:[])}),0),p=({targetCategory:e,targetParentCategory:t})=>{var a;const r=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();return r?r.length>y?"maxCharacter":t.categories.some((t=>t.title.toLowerCase()===r&&t.path!==e.path))?"destinationHasSameName":null:"emptyTitle"},y=100}}]);