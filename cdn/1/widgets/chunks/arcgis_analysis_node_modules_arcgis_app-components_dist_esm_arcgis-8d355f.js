/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8d355f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8d355f"],{30728:(e,a,i)=>{i.r(a),i.d(a,{arcgis_smart_mapping_panels_predominance:()=>s});var n=i(81149),t=i(9225),l=(i(69283),i(49306),i(89)),r=i(70616),o=i(51837);i(82218),i(42577),i(70464),i(10519),i(7659);const s=class{constructor(e){(0,n.r)(this,e),this.arcgisSmartMappingPanelsPredominanceBackClick=(0,n.c)(this,"arcgisSmartMappingPanelsPredominanceBackClick",7),this.arcgisSmartMappingPanelsPredominanceClose=(0,n.c)(this,"arcgisSmartMappingPanelsPredominanceClose",7),this.arcgisSmartMappingPanelsPredominanceError=(0,n.c)(this,"arcgisSmartMappingPanelsPredominanceError",7),this.valueSymbolNodes=[],this.labelNodes=[],this.inputNodes=[],this.maxCountOtherValues=200,this.popoverSettings={index:null,popoverNode:null},this.handleDone=()=>{(0,t.E)(),this.arcgisSmartMappingPanelsPredominanceClose.emit("save")},this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentWillLoad(){const{mapView:e,modules:a,strings:i}=t.s,n=t.s.layer,l=(0,t.h)(n);return t.s.lastDefault={defaultSymbol:l.defaultSymbol||(0,t.S)(n,e),defaultLabel:l.defaultLabel||i.panels.predominance.other},this.originalRendererJSON=l.toJSON(),this.originalFeatureReduction="featureReduction"in n&&n.featureReduction?a.esriLang.clone(n.featureReduction):void 0,this.originalOrderBy=n.orderBy,this.visualizationOpen=!0,new Promise(((e,a)=>{(0,r.g)({fieldInfos:l.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:t.w.NUMBER})))}).then((a=>{this.predominantCategoryInfos=a.predominantCategoryInfos,e(a.predominantCategoryInfos)})).catch((e=>{this.arcgisSmartMappingPanelsPredominanceError.emit({message:e,type:"error"}),a(e)}))}))}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){t.s.lastDefault=null,t.s.selectedValue=null}render(){var e;const{hideLayerTitle:a,isRTL:i,layer:l,mapImageSublayer:r,strings:s}=t.s,d=a?void 0:null!==(e=null==r?void 0:r.title)&&void 0!==e?e:l.title;return(0,n.h)(n.H,{class:"calcite-match-height"},(0,n.h)("calcite-flow-item",{class:{"flow-item":!0,[o.C.rtl]:i},heading:s.panels.predominance.styleOptions,description:d,closable:(0,t.aa)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsPredominanceBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderTransparency(),this.renderRotation(),this.renderDone(),this.renderCancel()))}renderVisualization(){const{strings:e}=t.s,a=!this.hideTransparency||!this.hideRotation;return(0,n.h)("calcite-block",{class:"predominance-block",heading:e.panels.predominance.predominanceStyle,collapsible:a,open:this.visualizationOpen,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderPredominanceSymbol(),this.renderDrawingOrder(),this.renderValues(),this.renderMsg(),this.renderBackgroundStyle())}renderPredominanceSymbol(){const{layer:e,mapView:a,modules:i}=t.s,l=(0,t.h)(e).uniqueValueGroups[0].classes,r=i.predominanceSchemes.getSchemes({basemap:a.map.basemap,geometryType:(0,t.D)(e),numColors:l.length}),o=(0,t.a9)(r,Math.min(l.length,10))[0].colors;let s=(null==l?void 0:l.length)?l.slice(0,10).map(((e,a)=>(0,t.t)(e.symbol)||new i.esriColor(o[a%o.length]))):[];return(0,n.h)("arcgis-smart-mapping-symbol-button",{type:"predominance-ramp",colors:s,rampType:"discrete",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,n.f)(this.hostElement),this.rotationNode&&(0,n.f)(this.rotationNode)}})}renderDrawingOrder(){const{layer:e,mapImageSublayer:a,strings:i}=t.s;if(a)return null;const l=(0,t.h)(e);return(0,n.h)("calcite-label",{layout:"inline-space-between"},i.panels.predominance.drawingOrder,(0,n.h)("calcite-switch",{scale:"s",checked:l.orderByClassesEnabled,onCalciteSwitchChange:e=>{const a=e.target;(0,t.E)();const i=t.s.layer;(0,t.h)(i).orderByClassesEnabled=a.checked,a.checked?i.orderBy=null:i.orderBy=this.originalOrderBy,(0,t.ab)()}}))}renderValues(){const{layer:e,strings:a}=t.s,i=(0,t.h)(e);return(0,n.h)(n.F,null,(0,n.h)("calcite-label",null,a.panels.predominance.fieldName),(0,n.h)("calcite-list",{class:"top-grey-border","drag-enabled":!0,onCalciteListOrderChange:e=>{let a=Array.from(e.target.children);this.handleSortValues(a)}},i.uniqueValueGroups[0].classes.map(((e,a)=>this.renderValue(e,a)))),(0,n.h)("calcite-list",null,this.renderDefaultValue()))}renderValue(e,a){return(0,n.h)("calcite-list-item",{value:e.values[0].value,key:`values-${e.values[0].value}`,"sort-values":e.values[0].value},this.renderSymbolNode(e,a),this.renderTextNode(e,a),this.renderCountNode(e))}renderSymbolNode(e,a){const{selectedValue:i,strings:l}=t.s,r={symbol:!0,"symbol-is-white":(0,t.aq)(e.symbol)};return(0,n.h)("div",{class:r,slot:"content-start",onClick:()=>this.handleValueSymbolClick(a),role:"button",tabIndex:0,"aria-label":l.panels.predominance.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":i===a,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(a))},ref:e=>{a>-1?this.valueSymbolNodes[a]=e:this.defaultSymbolNode=e,this.createValueSymbol(a,e)}})}renderTextNode(e,a){const{strings:i}=t.s;return(0,n.h)(n.F,null,(0,n.h)("div",{"aria-label":i.panels.predominance.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{e.target.classList.add("hidden");let i=-1===a?this.defaultInputNode:this.inputNodes[a];i.classList.remove("hidden"),i.setFocus()},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden");let i=-1===a?this.defaultInputNode:this.inputNodes[a];i.classList.remove("hidden"),i.setFocus()}},ref:e=>{a>-1?this.labelNodes[a]=e:this.defaultLabelNode=e}},e.label),(0,n.h)("calcite-input",{class:"hidden",slot:"content",tabIndex:0,value:e.label,onFocusout:e=>{const i=e.target;this.handleValueTextChange(a,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(a,i.value)}},ref:e=>{a>-1?this.inputNodes[a]=e:this.defaultInputNode=e}}))}renderCountNode(e){const{strings:a}=t.s,i=this.getPredominantCategoryValue(e.values[0].value);return i&&(0,t.ac)(i.count)?(0,n.h)("div",{slot:"content-end",class:"value-count","aria-label":a.panels.predominance.accessibility.countFor.replace("${value}",e.label)},`${i.count}`):null}renderDefaultValue(){const{layer:e,lastDefault:a,strings:i}=t.s,l=(0,t.h)(e),r=l.defaultSymbol||a.defaultSymbol,o=l.defaultLabel||a.defaultLabel,s=this.getPredominantCategoryValue(void 0);return(0,n.h)("calcite-list-item",{class:"top-grey-border"},(0,n.h)("calcite-checkbox",{class:"checkbox",scale:"s",tabIndex:0,slot:"actions-start",checked:!!l.defaultSymbol,onClick:()=>{l.defaultSymbol?(l.defaultSymbol=void 0,l.defaultLabel=void 0):(l.defaultSymbol=a.defaultSymbol,l.defaultLabel=a.defaultLabel),(0,t.ab)(),(0,n.f)(this.hostElement)}}),this.renderSymbolNode(o,-1),this.renderTextNode({symbol:r,label:o},-1),(0,n.h)("div",{slot:"content-end","aria-label":i.panels.predominance.accessibility.countFor.replace("${value}",o)},""+(s&&(0,t.ac)(s.count)?s.count:0)))}renderMsg(){const{layer:e,lastDefault:a,strings:i}=t.s,l=(0,t.h)(e);return l.uniqueValueGroups[0].classes&&l.uniqueValueGroups[0].classes.length>this.maxCountOtherValues?(0,n.h)("div",null,i.panels.predominance.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):l.uniqueValueGroups[0].classes.length?null:(0,n.h)("div",null,i.panels.predominance.noFeatures.replace("${other}",a.defaultLabel))}renderBackgroundStyle(){const{mapImageSublayer:e}=t.s;return"predominance-size"!==(0,t.g)()||e?null:(0,n.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return null;const{layer:e}=t.s,a=(0,t.a)((0,t.h)(e),"opacity");return(0,n.h)("arcgis-smart-mapping-transparency",{open:!!a,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)})}renderRotation(){if(this.hideRotation)return null;const{layer:e}=t.s,a=(0,t.a)((0,t.h)(e),"opacity"),i=(0,t.a)((0,t.h)(e),"rotation");return(0,n.h)("arcgis-smart-mapping-rotation",{open:!a&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e),ref:e=>this.rotationNode=e})}renderDone(){const{strings:e}=t.s;return(0,n.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancel(){const{strings:e}=t.s;return(0,n.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{originalRendererJSON:e,originalFeatureReduction:a,originalOrderBy:i}=this;t.s.layer.orderBy=i,(0,t.E)(),(0,t.j)(e,a),this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}async createValueSymbol(e,a){var i;const{layer:n,lastDefault:l,modules:r}=t.s,o=(0,t.h)(n);let s;for(s=-1===e?o.defaultSymbol||l.defaultSymbol:o.uniqueValueGroups[0].classes[e].symbol.clone();null===(i=null==a?void 0:a.childNodes)||void 0===i?void 0:i.length;)a.removeChild(a.childNodes[0]);if(s){const e=await r.symbolUtils.renderPreviewHTML(s,{size:(0,t.ar)(s),symbolConfig:"cim"===s.type&&"CIMPolygonSymbol"===s.data.symbol.type?{isSquareFill:!0}:void 0});a.appendChild(e)}}getPredominantCategoryValue(e){if(!this.predominantCategoryInfos)return;const a=this.predominantCategoryInfos.filter((a=>a.value==e));return(null==a?void 0:a.length)?a[0]:void 0}handleSortValues(e){const{layer:a,modules:i}=t.s;(0,t.E)();const l=e.map((e=>e.value)),r=(0,t.h)(a),o=r.uniqueValueGroups[0].classes.filter((e=>l.indexOf(`${e.values[0].value}`)>-1)).map((e=>i.esriLang.clone(e)));o.sort(((e,a)=>l.indexOf(e.values[0].value)-l.indexOf(a.values[0].value))),r.uniqueValueGroups[0].classes=o,(0,t.ab)(),(0,n.f)(this.hostElement)}handleValueSymbolClick(e){var a;(null===(a=this.popoverSettings)||void 0===a?void 0:a.popoverNode)?((-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e]).classList.remove("selected"),this.popoverSettings.index===e?((0,t.E)(),this.popoverSettings.popoverNode=null,this.popoverSettings.index=null):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,a){const{layer:i,modules:n,strings:l}=t.s,r=(0,t.h)(i),o=n.rendererJsonUtils.fromJSON(this.originalRendererJSON);a.length||(a=-1===e?o.defaultLabel||l.panels.predominance.other:o.uniqueValueGroups[0].classes.find((a=>a.values[0].value===r.uniqueValueGroups[0].classes[e].values[0].value)).label),-1===e?r.defaultSymbol&&(r.defaultLabel=a):r.uniqueValueGroups[0].classes[e].label=a,(0,t.ab)();let s=-1===e?this.defaultInputNode:this.inputNodes[e];s.classList.add("hidden");let d=-1===e?this.defaultLabelNode:this.labelNodes[e];d.classList.remove("hidden"),d.innerHTML=a,s.value=a,setTimeout((()=>d.focus()),300)}openSymbolStylerForValue(e){(0,t.E)();const a=-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e];this.popoverSettings.popoverNode=(0,l.c)({referenceElement:this.flowItemNode,heading:t.s.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,l.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,setTimeout((()=>a.focus()),300),a.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,l.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,a.classList.remove("selected")})),t.s.selectedValue=e,(0,l.d)({popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,t.ab)(),(0,n.f)(this.hostElement),this.rotationNode&&(0,n.f)(this.rotationNode)}}),a.classList.add("selected")}get hostElement(){return(0,n.d)(this)}};s.style=":host{width:100%}.flow-item{height:100%}.predominance-block{overflow-x:hidden}.checkbox{margin:0 6.5px}.hidden{display:none}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{min-width:26px;display:flex}.symbol div{margin:auto}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}.top-grey-border{border-top:1px solid #e0e0e0}.list-item-top-grey-border{border-top:1.5px solid #e0e0e0}"},70616:(e,a,i)=>{i.d(a,{a:()=>r,c:()=>l,g:()=>o});var n=i(9225),t=(i(69283),i(10519));function l(e){var a;const{layer:i,mapView:l,selectedFields:r,modules:o}=n.s,d=i;e=e||{};const u=(0,n.m)((0,n.h)(d));return o.PredominanceCreator.createRenderer({layer:d,view:l,fields:s(e.fieldInfos),predominanceScheme:e.predominanceScheme||(0,n.W)(),includeOpacityVariable:!(0,t.i)(e.includeOpacityVariable)||(0,t.i)(e.includeOpacityVariable),includeSizeVariable:!!(0,t.i)(e.includeSizeVariable)&&e.includeSizeVariable,outlineOptimizationEnabled:(0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!(0,n.q)(d),sizeOptimizationEnabled:!(0,t.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled,legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(a=d.featureReduction)||void 0===a?void 0:a.type)}).then((a=>{(0,n.l)(u,a.renderer,{notOpacity:!0});const i=(0,n.g)();if(!(0,t.i)(e.includeOpacityVariable)&&["predominance","predominance-size"].indexOf(i)>-1){const i=(0,n.f)(d),t=r.map((e=>e.field)).sort(),l=i.map((e=>e.field)).sort();if(t.toString()===l.toString()){const i=(0,n.a)((0,n.h)(d),"opacity"),t=(0,n.p)((0,n.h)(d),"opacity");a.renderer.visualVariables=(0,n.n)(a.renderer,"opacity")||[],i&&a.renderer.visualVariables.push(i),a.renderer.authoringInfo.visualVariables=(0,n.o)(a.renderer,"opacity")||[],t&&a.renderer.authoringInfo.visualVariables.push(t);const l=a.renderer.uniqueValueInfos[0].symbol.clone();a.renderer.uniqueValueInfos=(0,n.h)(d).uniqueValueInfos,(0,n.q)(d)&&("predominance-size"===(0,n.g)()&&!0!==e.includeSizeVariable?(0,n.X)(a.renderer,l):"predominance"===(0,n.g)()&&!0===e.includeSizeVariable&&(0,n.Y)(a.renderer,l))}}return Promise.resolve(a)}),(e=>Promise.reject(e)))}function r(e){var a;const{layer:i,mapView:l,modules:r}=n.s,o=i;e=e||{};const d=(0,n.h)(o),u=(0,n.a)(d,"size"),c=(0,n.p)(d,"size"),p=(0,n.m)(d);let h,m,b=e.fieldInfos?e.fieldInfos:d.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:n.w.NUMBER}))),f=!0;if(e.fieldInfos&&(d.uniqueValueGroups[0].classes.forEach(((a,i)=>{a.values[0].value!==e.fieldInfos[i].field&&(f=!1)})),f&&(delete e.fieldInfos,(0,n.R)(e)))){const e=d.clone();return Promise.resolve({renderer:e})}f&&(h=d.uniqueValueInfos.map((e=>e.value)));const y=(0,n.h)(o);m=y.uniqueValueInfos&&y.uniqueValueInfos.length?y.uniqueValueInfos[0].symbol:null;const g=d.defaultSymbol,v=d.defaultLabel,S=d.backgroundFillSymbol;let V=!1;u&&(V=u.minSize.stops?u.minSize.stops[0].size>u.maxSize.stops[0].size:u.minSize>u.maxSize);const N=b[0];return b[0]=b[1],b[1]=N,r.PredominanceCreator.createRenderer({layer:o,view:l,fields:s(b),predominanceScheme:e.predominanceScheme||(0,n.W)(),includeOpacityVariable:(0,t.i)(e.includeOpacityVariable)?e.includeOpacityVariable:!!p.opacityVisVar,includeSizeVariable:(0,t.i)(e.includeSizeVariable)?e.includeSizeVariable:!!u,outlineOptimizationEnabled:(0,t.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!p.sizeOutlineVisVar,sizeOptimizationEnabled:(0,t.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!p.sizeAutoVisVar,legendOptions:void 0,defaultSymbolEnabled:(0,t.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!g,forBinning:"binning"===(null===(a=o.featureReduction)||void 0===a?void 0:a.type)}).then((a=>{if(!e.fieldInfos&&u){const e=(0,n.a)(a.renderer,"size");if(e.minDataValue=u.minDataValue,e.maxDataValue=u.maxDataValue,c){const e=(0,n.p)(a.renderer,"size");e.minSliderValue=c.minSliderValue,e.maxSliderValue=c.maxSliderValue}}if(!(0,t.i)(e.includeOpacityVariable)&&f&&p.opacityVisVar&&p.authOpacityVisVar&&(a.renderer.visualVariables=(0,n.n)(a.renderer,"opacity"),a.renderer.authoringInfo.visualVariables=(0,n.o)(a.renderer,"opacity"),a.renderer.visualVariables.push(p.opacityVisVar),a.renderer.authoringInfo.visualVariables=a.renderer.authoringInfo.visualVariables||[],a.renderer.authoringInfo.visualVariables.push(p.authOpacityVisVar)),(0,n.l)(p,a.renderer,{notOpacity:!0}),h&&a.renderer.uniqueValueInfos.sort(((e,a)=>{const i=h.indexOf(e.value),n=h.indexOf(a.value);return i>-1&&n>-1&&i<n?-1:i>-1&&n>-1&&i>n?1:i>-1?-1:n>-1?1:0})),f&&a.renderer.uniqueValueInfos.forEach(((e,a)=>{e.label=d.uniqueValueInfos[a].label})),m&&a.renderer.uniqueValueInfos&&a.renderer.uniqueValueInfos.length){const e=a.renderer.uniqueValueInfos.slice();e.map(((e,a)=>{let i;f?i=d.uniqueValueInfos[a].symbol:(i=m.clone(),(0,n.r)(i,(0,n.t)(e.symbol))),e.symbol=i})),a.renderer.uniqueValueInfos=e}if(g&&(a.renderer.defaultSymbol=g,a.renderer.defaultLabel=v),S&&(a.renderer.backgroundFillSymbol=S),V){const e=(0,n.a)(a.renderer,"size"),i=e.minSize;e.minSize=e.maxSize,e.maxSize=i}return Promise.resolve(a)}),(e=>Promise.reject(e)))}function o(e){var a;const{layer:i,mapView:t,modules:l}=n.s,r=i;return e=e||{},l.predominantCategories({layer:r,view:t,fields:e.fieldInfos.map((e=>e.field)),forBinning:"binning"===(null===(a=r.featureReduction)||void 0===a?void 0:a.type)})}function s(e){return e.map((e=>({name:e.field,label:d(e.field)})))}function d(e){const a=n.s.fields.filter((a=>a.layerField.name===e));return a.length?a[0].label:""}}}]);