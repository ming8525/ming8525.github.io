"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-8d355f"],{

/***/ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-predominance.entry.js":
/*!*******************************************************************************************************************************************!*\
  !*** ./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/arcgis-smart-mapping-panels-predominance.entry.js ***!
  \*******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_smart_mapping_panels_predominance: () => (/* binding */ ArcgisSmartMappingPanelsPredominance)
/* harmony export */ });
/* harmony import */ var _index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-e3bf7da7.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-e3bf7da7.js");
/* harmony import */ var _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./raster-unique-value-0976ec7f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/raster-unique-value-0976ec7f.js");
/* harmony import */ var _loadModules_b4ac1247_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./loadModules-b4ac1247.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/loadModules-b4ac1247.js");
/* harmony import */ var _commonEnums_fcf13661_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commonEnums-fcf13661.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonEnums-fcf13661.js");
/* harmony import */ var _symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./symbolStyler-04635b2b.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/symbolStyler-04635b2b.js");
/* harmony import */ var _predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./predominance-a1a2d74d.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/predominance-a1a2d74d.js");
/* harmony import */ var _languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./languageUtil-ef0e54b2.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/languageUtil-ef0e54b2.js");
/* harmony import */ var _locale_050b6db9_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./locale-050b6db9.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/locale-050b6db9.js");
/* harmony import */ var _dom_4d367677_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./dom-4d367677.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/dom-4d367677.js");
/* harmony import */ var _index_05956cab_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./index-05956cab.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/index-05956cab.js");
/* harmony import */ var _commonFunctions_b0830e9e_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./commonFunctions-b0830e9e.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/commonFunctions-b0830e9e.js");
/* harmony import */ var _location_e26b539f_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./location-e26b539f.js */ "./extensions/widgets/arcgis/analysis/node_modules/@arcgis/app-components/dist/esm/location-e26b539f.js");
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * v4.0.58
 */













const arcgisSmartMappingPanelsPredominanceCss = ":host{width:100%}.flow-item{height:100%}.predominance-block{overflow-x:hidden}.checkbox{margin:0 6.5px}.hidden{display:none}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{min-width:26px;display:flex}.symbol div{margin:auto}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}.top-grey-border{border-top:1px solid #e0e0e0}.list-item-top-grey-border{border-top:1.5px solid #e0e0e0}";

const ArcgisSmartMappingPanelsPredominance = class {
    constructor(hostRef) {
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisSmartMappingPanelsPredominanceBackClick = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceBackClick", 7);
        this.arcgisSmartMappingPanelsPredominanceClose = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceClose", 7);
        this.arcgisSmartMappingPanelsPredominanceError = (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisSmartMappingPanelsPredominanceError", 7);
        this.valueSymbolNodes = [];
        this.labelNodes = [];
        this.inputNodes = [];
        this.maxCountOtherValues = 200;
        this.popoverSettings = {
            index: null,
            popoverNode: null
        };
        //-------------------------------------------------------------------
        //
        //  Private Methods
        //
        //-------------------------------------------------------------------
        this.handleDone = () => {
            // keep the current settings on the layer
            (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
            this.arcgisSmartMappingPanelsPredominanceClose.emit("save");
        };
        this.hideRotation = false;
        this.hideTransparency = false;
        this.menuOpen = undefined;
        this.showBackButton = undefined;
        this.beforeBack = undefined;
        this.visualizationOpen = false;
    }
    //--------------------------------------------------------------------------
    //
    //  Public Methods
    //
    //--------------------------------------------------------------------------
    async setFocus() {
        var _a;
        (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus();
    }
    //-------------------------------------------------------------------
    //
    //  Lifecycle Methods
    //
    //-------------------------------------------------------------------
    componentWillLoad() {
        const { mapView, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const layer = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.layer;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.lastDefault = {
            defaultSymbol: renderer.defaultSymbol || (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.S)(layer, mapView),
            defaultLabel: renderer.defaultLabel || strings.panels.predominance.other
        };
        this.originalRendererJSON = renderer.toJSON();
        this.originalFeatureReduction =
            "featureReduction" in layer && layer.featureReduction
                ? modules.esriLang.clone(layer.featureReduction)
                : undefined;
        this.originalOrderBy = layer.orderBy;
        this.visualizationOpen = true;
        return new Promise((resolve, reject) => {
            (0,_predominance_a1a2d74d_js__WEBPACK_IMPORTED_MODULE_5__.g)({
                fieldInfos: renderer.uniqueValueGroups[0].classes.map((info) => {
                    return {
                        field: info.values[0].value,
                        simpleFieldType: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.w.NUMBER
                    };
                })
            })
                .then((result) => {
                this.predominantCategoryInfos = result.predominantCategoryInfos;
                resolve(result.predominantCategoryInfos);
            })
                .catch((error) => {
                this.arcgisSmartMappingPanelsPredominanceError.emit({
                    message: error,
                    type: "error"
                });
                reject(error);
            });
        });
    }
    componentDidLoad() {
        requestAnimationFrame(() => { var _a; return (_a = this.flowItemNode) === null || _a === void 0 ? void 0 : _a.setFocus(); });
    }
    disconnectedCallback() {
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.lastDefault = null;
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.selectedValue = null;
    }
    //-------------------------------------------------------------------
    //
    //  Render Methods
    //
    //-------------------------------------------------------------------
    render() {
        var _a;
        const { hideLayerTitle, isRTL, layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const title = hideLayerTitle ? undefined : (_a = mapImageSublayer === null || mapImageSublayer === void 0 ? void 0 : mapImageSublayer.title) !== null && _a !== void 0 ? _a : layer.title;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.H, { class: "calcite-match-height" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { class: {
                "flow-item": true,
                [_languageUtil_ef0e54b2_js__WEBPACK_IMPORTED_MODULE_6__.C.rtl]: isRTL
            }, heading: strings.panels.predominance.styleOptions, description: title, closable: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aa)(this.hostElement), menuOpen: this.menuOpen, beforeBack: this.beforeBack,
            // @ts-ignore
            showBackButton: this.showBackButton, onCalciteFlowItemClose: this.handleDone, onCalciteFlowItemBack: () => this.arcgisSmartMappingPanelsPredominanceBackClick.emit(), ref: (node) => (this.flowItemNode = node) }, this.renderVisualization(), this.renderTransparency(), this.renderRotation(), this.renderDone(), this.renderCancel())));
    }
    renderVisualization() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const hasOtherBlocks = !this.hideTransparency || !this.hideRotation;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-block", { class: "predominance-block", heading: strings.panels.predominance.predominanceStyle, collapsible: hasOtherBlocks, open: this.visualizationOpen, onCalciteBlockOpen: () => (this.visualizationOpen = true), onCalciteBlockClose: () => (this.visualizationOpen = false) }, this.renderPredominanceSymbol(), this.renderDrawingOrder(), this.renderValues(), this.renderMsg(), this.renderBackgroundStyle()));
    }
    renderPredominanceSymbol() {
        const { layer, mapView, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const uniqueValueClasses = renderer.uniqueValueGroups[0].classes;
        const schemes = modules.predominanceSchemes.getSchemes({
            basemap: mapView.map.basemap,
            geometryType: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.D)(layer),
            numColors: uniqueValueClasses.length
        });
        const colorRampsAndSchemes = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a9)(schemes, Math.min(uniqueValueClasses.length, 10));
        const defaultColors = colorRampsAndSchemes[0].colors;
        let colors = (uniqueValueClasses === null || uniqueValueClasses === void 0 ? void 0 : uniqueValueClasses.length)
            ? uniqueValueClasses
                .slice(0, 10)
                .map((uniqueValueClass, idx) => (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.t)(uniqueValueClass.symbol) ||
                new modules.esriColor(defaultColors[idx % defaultColors.length]))
            : [];
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-symbol-button", { type: "predominance-ramp", colors: colors, rampType: "discrete", popoverReferenceElement: this.flowItemNode, onArcgisSmartMappingSymbolButtonSymbolChange: () => {
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            } }));
    }
    renderDrawingOrder() {
        const { layer, mapImageSublayer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if (mapImageSublayer) {
            return null;
        }
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", { layout: "inline-space-between" }, strings.panels.predominance.drawingOrder, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-switch", { scale: "s", checked: renderer.orderByClassesEnabled, onCalciteSwitchChange: (event) => {
                const node = event.target;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                const layer = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.layer;
                const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
                renderer.orderByClassesEnabled = node.checked;
                if (node.checked) {
                    layer.orderBy = null;
                }
                else {
                    layer.orderBy = this.originalOrderBy;
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
            } })));
    }
    renderValues() {
        const { layer, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-label", null, strings.panels.predominance.fieldName), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", { class: "top-grey-border", "drag-enabled": true, onCalciteListOrderChange: (event) => {
                let items = Array.from(event.target.children);
                this.handleSortValues(items);
            } }, renderer.uniqueValueGroups[0].classes.map((uniqueValueClass, index) => {
            return this.renderValue(uniqueValueClass, index);
        })), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list", null, this.renderDefaultValue())));
    }
    renderValue(uniqueValueClass, index) {
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { value: uniqueValueClass.values[0].value, key: `values-${uniqueValueClass.values[0].value}`, "sort-values": uniqueValueClass.values[0].value }, this.renderSymbolNode(uniqueValueClass, index), this.renderTextNode(uniqueValueClass, index), this.renderCountNode(uniqueValueClass)));
    }
    renderSymbolNode(uniqueValueClass, index) {
        const { selectedValue, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const symbolNodeClasses = {
            "symbol": true,
            "symbol-is-white": (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.aq)(uniqueValueClass.symbol)
        };
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: symbolNodeClasses, slot: "content-start", onClick: () => this.handleValueSymbolClick(index), role: "button", tabIndex: 0, "aria-label": strings.panels.predominance.accessibility.editSymbolFor.replace("${value}", uniqueValueClass.label), "aria-haspopup": "true", "aria-expanded": selectedValue === index, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    this.handleValueSymbolClick(index);
                }
            }, ref: (node) => {
                if (index > -1) {
                    this.valueSymbolNodes[index] = node;
                }
                else {
                    this.defaultSymbolNode = node;
                }
                this.createValueSymbol(index, node);
            } }));
    }
    renderTextNode(uniqueValueClass, index) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.F, null, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { "aria-label": strings.panels.predominance.accessibility.editLabelFor.replace("${fieldName}", uniqueValueClass.label), class: "label text-wrap", slot: "content", tabIndex: 0, onClick: (event) => {
                event.target.classList.add("hidden");
                let inputNode = index === -1 ? this.defaultInputNode : this.inputNodes[index];
                inputNode.classList.remove("hidden");
                inputNode.setFocus();
            }, onKeyDown: (event) => {
                if (event.key === " " || event.key === "Enter") {
                    event.preventDefault();
                    event.stopPropagation();
                    event.target.classList.add("hidden");
                    let inputNode = index === -1 ? this.defaultInputNode : this.inputNodes[index];
                    inputNode.classList.remove("hidden");
                    inputNode.setFocus();
                }
            }, ref: (node) => {
                if (index > -1) {
                    this.labelNodes[index] = node;
                }
                else {
                    this.defaultLabelNode = node;
                }
            } }, uniqueValueClass.label), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-input", { class: "hidden", slot: "content", tabIndex: 0, value: uniqueValueClass.label, onFocusout: (event) => {
                const node = event.target;
                this.handleValueTextChange(index, node.value);
            }, onKeyDown: (event) => {
                event.stopPropagation();
                if (event.key === "Escape" || event.key === "Enter") {
                    event.preventDefault();
                    const node = event.currentTarget;
                    this.handleValueTextChange(index, node.value);
                }
            }, ref: (node) => {
                if (index > -1) {
                    this.inputNodes[index] = node;
                }
                else {
                    this.defaultInputNode = node;
                }
            } })));
    }
    renderCountNode(uniqueValueClass) {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const info = this.getPredominantCategoryValue(uniqueValueClass.values[0].value);
        if (!info || !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(info.count)) {
            return null;
        }
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end", class: "value-count", "aria-label": strings.panels.predominance.accessibility.countFor.replace("${value}", uniqueValueClass.label) }, `${info.count}`));
    }
    renderDefaultValue() {
        const { layer, lastDefault, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const defaultSymbol = renderer.defaultSymbol || lastDefault.defaultSymbol;
        const defaultLabel = renderer.defaultLabel || lastDefault.defaultLabel;
        const info = this.getPredominantCategoryValue(undefined);
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-list-item", { class: "top-grey-border" }, (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-checkbox", { class: "checkbox", scale: "s", tabIndex: 0, slot: "actions-start", checked: !!renderer.defaultSymbol, onClick: () => {
                if (renderer.defaultSymbol) {
                    renderer.defaultSymbol = undefined;
                    renderer.defaultLabel = undefined;
                }
                else {
                    renderer.defaultSymbol = lastDefault.defaultSymbol;
                    renderer.defaultLabel = lastDefault.defaultLabel;
                }
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
            } }), this.renderSymbolNode(defaultLabel, -1), this.renderTextNode({
            symbol: defaultSymbol,
            label: defaultLabel
        }, -1), (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "content-end", "aria-label": strings.panels.predominance.accessibility.countFor.replace("${value}", defaultLabel) }, "" + (!info || !(0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ac)(info.count) ? 0 : info.count))));
    }
    renderMsg() {
        const { layer, lastDefault, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        // TODO estimatedValuesMsg
        if (renderer.uniqueValueGroups[0].classes &&
            renderer.uniqueValueGroups[0].classes.length > this.maxCountOtherValues) {
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.panels.predominance.tooManyValues.replace("${count}", this.maxCountOtherValues.toString())));
        }
        else if (!renderer.uniqueValueGroups[0].classes.length) {
            // only otherCategory
            return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", null, strings.panels.predominance.noFeatures.replace("${other}", lastDefault.defaultLabel)));
        }
        else {
            return null;
        }
    }
    renderBackgroundStyle() {
        const { mapImageSublayer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        if ((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.g)() !== "predominance-size" || mapImageSublayer) {
            return null;
        }
        return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-background-symbol", null);
    }
    renderTransparency() {
        if (this.hideTransparency) {
            return null;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "opacity");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-transparency", { open: !!opacityVisVar, onArcgisSmartMappingSymbolTransparencyError: ({ detail }) => this.arcgisSmartMappingPanelsPredominanceError.emit(detail) }));
    }
    renderRotation() {
        if (this.hideRotation) {
            return null;
        }
        const { layer } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const opacityVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "opacity");
        const rotationVisVar = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.a)((0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer), "rotation");
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-smart-mapping-rotation", { open: !opacityVisVar && !!rotationVisVar, onArcgisSmartMappingRotationError: ({ detail }) => this.arcgisSmartMappingPanelsPredominanceError.emit(detail), ref: (node) => (this.rotationNode = node) }));
    }
    renderDone() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.done, onClick: this.handleDone, appearance: "solid", width: "half" }, strings.done));
    }
    renderCancel() {
        const { strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        return ((0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-button", { slot: "footer", label: strings.cancel, onClick: () => {
                const { originalRendererJSON, originalFeatureReduction, originalOrderBy } = this;
                const layer = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.layer;
                layer.orderBy = originalOrderBy;
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.j)(originalRendererJSON, originalFeatureReduction);
                this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel");
            }, appearance: "outline-fill", width: "half" }, strings.cancel));
    }
    async createValueSymbol(index, element) {
        var _a;
        const { layer, lastDefault, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        let symbol;
        if (index === -1) {
            symbol = renderer.defaultSymbol || lastDefault.defaultSymbol;
        }
        else {
            symbol = renderer.uniqueValueGroups[0].classes[index].symbol.clone();
        }
        // remove old symbol if there is one
        while ((_a = element === null || element === void 0 ? void 0 : element.childNodes) === null || _a === void 0 ? void 0 : _a.length) {
            element.removeChild(element.childNodes[0]);
        }
        if (symbol) {
            // add new symbol
            const symbolNode = await modules.symbolUtils.renderPreviewHTML(symbol, {
                size: (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ar)(symbol),
                symbolConfig: 
                //symbol.type === "simple-fill" || ... while CIMs have that shape
                symbol.type === "cim" && symbol.data.symbol.type === "CIMPolygonSymbol"
                    ? { isSquareFill: true }
                    : undefined
            });
            element.appendChild(symbolNode);
        }
    }
    getPredominantCategoryValue(value) {
        if (!this.predominantCategoryInfos) {
            return undefined;
        }
        // no exact match!
        const infos = this.predominantCategoryInfos.filter((info) => info.value == value);
        return (infos === null || infos === void 0 ? void 0 : infos.length) ? infos[0] : undefined;
    }
    handleSortValues(items) {
        const { layer, modules } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const itemValues = items.map((item) => item.value);
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const uniqueValueClasses = renderer.uniqueValueGroups[0].classes
            .filter((uniqueValueClass) => itemValues.indexOf(`${uniqueValueClass.values[0].value}`) > -1)
            .map((uniqueValueClass) => modules.esriLang.clone(uniqueValueClass));
        uniqueValueClasses.sort((a, b) => {
            const aIndex = itemValues.indexOf(a.values[0].value);
            const bIndex = itemValues.indexOf(b.values[0].value);
            return aIndex - bIndex;
        });
        renderer.uniqueValueGroups[0].classes = uniqueValueClasses;
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
    }
    handleValueSymbolClick(index) {
        var _a;
        if ((_a = this.popoverSettings) === null || _a === void 0 ? void 0 : _a.popoverNode) {
            const valueSymbolNode = index === -1 ? this.defaultSymbolNode : this.valueSymbolNodes[index];
            valueSymbolNode.classList.remove("selected");
            if (this.popoverSettings.index === index) {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
                this.popoverSettings.popoverNode = null;
                this.popoverSettings.index = null;
            }
            else {
                this.popoverSettings.index = index;
                this.openSymbolStylerForValue(index);
            }
        }
        else {
            this.popoverSettings.index = index;
            this.openSymbolStylerForValue(index);
        }
    }
    handleValueTextChange(index, newValue) {
        const { layer, modules, strings } = _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s;
        const renderer = (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.h)(layer);
        const originalRenderer = modules.rendererJsonUtils.fromJSON(this.originalRendererJSON);
        if (!newValue.length) {
            if (index === -1) {
                newValue = originalRenderer.defaultLabel || strings.panels.predominance.other;
            }
            else {
                let matchingClass = originalRenderer.uniqueValueGroups[0].classes.find((uvClass) => uvClass.values[0].value === renderer.uniqueValueGroups[0].classes[index].values[0].value);
                newValue = matchingClass.label;
            }
        }
        if (index === -1) {
            if (renderer.defaultSymbol) {
                renderer.defaultLabel = newValue;
            }
        }
        else {
            renderer.uniqueValueGroups[0].classes[index].label = newValue;
        }
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
        let inputNode = index === -1 ? this.defaultInputNode : this.inputNodes[index];
        inputNode.classList.add("hidden");
        let labelNode = index === -1 ? this.defaultLabelNode : this.labelNodes[index];
        labelNode.classList.remove("hidden");
        labelNode.innerHTML = newValue;
        inputNode.value = newValue;
        setTimeout(() => labelNode.focus(), 300);
    }
    openSymbolStylerForValue(index) {
        (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.E)();
        const valueSymbolNode = index === -1 ? this.defaultSymbolNode : this.valueSymbolNodes[index];
        this.popoverSettings.popoverNode = (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_4__.c)({
            referenceElement: this.flowItemNode,
            heading: _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.strings.styler.symbolStyle
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_4__.r)(this.popoverSettings.popoverNode);
            this.popoverSettings.popoverNode = null;
            setTimeout(() => valueSymbolNode.focus(), 300);
            valueSymbolNode.classList.remove("selected");
        });
        this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected", () => {
            (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_4__.r)(this.popoverSettings.popoverNode);
            this.popoverSettings.popoverNode = null;
            valueSymbolNode.classList.remove("selected");
        });
        _raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.s.selectedValue = index;
        (0,_symbolStyler_04635b2b_js__WEBPACK_IMPORTED_MODULE_4__.d)({
            popoverNode: this.popoverSettings.popoverNode,
            onChange: () => {
                (0,_raster_unique_value_0976ec7f_js__WEBPACK_IMPORTED_MODULE_1__.ab)();
                (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.hostElement);
                this.rotationNode && (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.rotationNode);
            }
        });
        valueSymbolNode.classList.add("selected");
    }
    get hostElement() { return (0,_index_e3bf7da7_js__WEBPACK_IMPORTED_MODULE_0__.d)(this); }
};
ArcgisSmartMappingPanelsPredominance.style = arcgisSmartMappingPanelsPredominanceCss;



//# sourceMappingURL=arcgis-smart-mapping-panels-predominance.entry.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvYXJjZ2lzX2FuYWx5c2lzX25vZGVfbW9kdWxlc19hcmNnaXNfYXBwLWNvbXBvbmVudHNfZGlzdF9lc21fYXJjZ2lzLThkMzU1Zi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDOEk7QUFDOFE7QUFDelg7QUFDQTtBQUNxSDtBQUM3RTtBQUNiO0FBQ2hDO0FBQ0g7QUFDRTtBQUNVO0FBQ1A7O0FBRWhDLHVEQUF1RCxXQUFXLFdBQVcsWUFBWSxvQkFBb0Isa0JBQWtCLFVBQVUsZUFBZSxRQUFRLGFBQWEsT0FBTyxzQ0FBc0MsZ0JBQWdCLG1CQUFtQiwyQkFBMkIsNkNBQTZDLFVBQVUsNkNBQTZDLFFBQVEsZUFBZSxhQUFhLFlBQVksWUFBWSxpQkFBaUIseUJBQXlCLFdBQVcsdUJBQXVCLGlCQUFpQiw2QkFBNkIsMkJBQTJCLCtCQUErQjs7QUFFNW1CO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4Qiw2REFBNkQscURBQVc7QUFDeEUseURBQXlELHFEQUFXO0FBQ3BFLHlEQUF5RCxxREFBVztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLG1FQUFhO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw0QkFBNEIsRUFBRSwrREFBaUI7QUFDL0Qsc0JBQXNCLCtEQUFpQjtBQUN2Qyx5QkFBeUIsbUVBQVc7QUFDcEMsUUFBUSwrREFBaUI7QUFDekIscURBQXFELG1FQUFnQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVks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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLG9FQUFjO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsbUVBQWE7QUFDckI7QUFDQSwyQ0FBMkMsNERBQXlCO0FBQ3BFO0FBQ0EscUJBQXFCLCtEQUFpQjtBQUN0QyxTQUFTO0FBQ1Q7QUFDQSxZQUFZLDREQUF5QjtBQUNyQztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxZQUFZLDREQUF5QjtBQUNyQztBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVEsK0RBQWlCO0FBQ3pCLFFBQVEsNERBQXFDO0FBQzdDO0FBQ0E7QUFDQSxnQkFBZ0Isb0VBQWM7QUFDOUIsZ0JBQWdCLHFEQUFXO0FBQzNCLHFDQUFxQyxxREFBVztBQUNoRDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esd0JBQXdCLE9BQU8scURBQVU7QUFDekM7QUFDQTs7QUFFNEY7O0FBRTVGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL2V4dGVuc2lvbnMvd2lkZ2V0cy9hcmNnaXMvYW5hbHlzaXMvbm9kZV9tb2R1bGVzL0BhcmNnaXMvYXBwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNtYXJ0LW1hcHBpbmctcGFuZWxzLXByZWRvbWluYW5jZS5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiB2NC4wLjU4XG4gKi9cbmltcG9ydCB7IHIgYXMgcmVnaXN0ZXJJbnN0YW5jZSwgYyBhcyBjcmVhdGVFdmVudCwgaCwgSCBhcyBIb3N0LCBGIGFzIEZyYWdtZW50LCBmIGFzIGZvcmNlVXBkYXRlLCBkIGFzIGdldEVsZW1lbnQgfSBmcm9tICcuL2luZGV4LWUzYmY3ZGE3LmpzJztcbmltcG9ydCB7IEUgYXMgY2xvc2VQb3BvdmVycywgcyBhcyBzbWFydE1hcHBpbmdTdGF0ZSwgUyBhcyBnZXREZWZhdWx0U3ltYm9sLCB3IGFzIHNpbXBsZUZpZWxkVHlwZXMsIGFhIGFzIGlzVG9wRmxvd0l0ZW0sIEQgYXMgZ2V0R2VvbWV0cnlUeXBlLCB0IGFzIGdldFN5bWJvbENvbG9yLCBhYiBhcyB1cGRhdGVSZW5kZXJlciwgYXEgYXMgaXNTeW1ib2xBbG1vc3RXaGl0ZSwgYWMgYXMgaXNEZWZpbmVkLCBnIGFzIGdldFJlbmRlcmVyVHlwZSwgYSBhcyBnZXRWaXNWYXIsIGFyIGFzIGdldFJlbmRlclByZXZpZXdTaXplLCBoIGFzIGdldFJlbmRlcmVyLCBqIGFzIGFwcGx5UmVuZGVyZXJUb0FsbCwgYTkgYXMgZ2V0Q29sb3JSYW1wc1dpdGhTY2hlbWVzIH0gZnJvbSAnLi9yYXN0ZXItdW5pcXVlLXZhbHVlLTA5NzZlYzdmLmpzJztcbmltcG9ydCAnLi9sb2FkTW9kdWxlcy1iNGFjMTI0Ny5qcyc7XG5pbXBvcnQgJy4vY29tbW9uRW51bXMtZmNmMTM2NjEuanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVTeW1ib2xTdHlsZXJQb3BvdmVyLCByIGFzIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIsIGQgYXMgYnVpbGRTeW1ib2xTdHlsZXJGb3JQcmVkb21pbmFuY2VWYWx1ZSB9IGZyb20gJy4vc3ltYm9sU3R5bGVyLTA0NjM1YjJiLmpzJztcbmltcG9ydCB7IGcgYXMgZ2V0UHJlZG9taW5hbnRDYXRlZ29yaWVzIH0gZnJvbSAnLi9wcmVkb21pbmFuY2UtYTFhMmQ3NGQuanMnO1xuaW1wb3J0IHsgQyBhcyBDU1NfVVRJTElUWSB9IGZyb20gJy4vbGFuZ3VhZ2VVdGlsLWVmMGU1NGIyLmpzJztcbmltcG9ydCAnLi9sb2NhbGUtMDUwYjZkYjkuanMnO1xuaW1wb3J0ICcuL2RvbS00ZDM2NzY3Ny5qcyc7XG5pbXBvcnQgJy4vaW5kZXgtMDU5NTZjYWIuanMnO1xuaW1wb3J0ICcuL2NvbW1vbkZ1bmN0aW9ucy1iMDgzMGU5ZS5qcyc7XG5pbXBvcnQgJy4vbG9jYXRpb24tZTI2YjUzOWYuanMnO1xuXG5jb25zdCBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VDc3MgPSBcIjpob3N0e3dpZHRoOjEwMCV9LmZsb3ctaXRlbXtoZWlnaHQ6MTAwJX0ucHJlZG9taW5hbmNlLWJsb2Nre292ZXJmbG93LXg6aGlkZGVufS5jaGVja2JveHttYXJnaW46MCA2LjVweH0uaGlkZGVue2Rpc3BsYXk6bm9uZX0ubGFiZWx7Zm9udC1zaXplOnZhcigtLWNhbGNpdGUtZm9udC1zaXplLS0xKTtwYWRkaW5nLXRvcDo1cHg7cGFkZGluZy1ib3R0b206NXB4fS5sYWJlbDpmb2N1cywuc3ltYm9sOmZvY3Vze291dGxpbmU6MnB4IHNvbGlkIHZhcigtLWNhbGNpdGUtY29sb3ItYnJhbmQpfS5zZWxlY3RlZHtvdXRsaW5lOjFweCBzb2xpZCB2YXIoLS1jYWxjaXRlLWNvbG9yLWJyYW5kKX0uc3ltYm9se21pbi13aWR0aDoyNnB4O2Rpc3BsYXk6ZmxleH0uc3ltYm9sIGRpdnttYXJnaW46YXV0b30uc3ltYm9sLWlzLXdoaXRle2JhY2tncm91bmQtY29sb3I6I2YzZjNmM30udGV4dC13cmFwe292ZXJmbG93LXdyYXA6YW55d2hlcmV9LnRvcC1ncmV5LWJvcmRlcntib3JkZXItdG9wOjFweCBzb2xpZCAjZTBlMGUwfS5saXN0LWl0ZW0tdG9wLWdyZXktYm9yZGVye2JvcmRlci10b3A6MS41cHggc29saWQgI2UwZTBlMH1cIjtcblxuY29uc3QgQXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VCYWNrQ2xpY2sgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZUJhY2tDbGlja1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VDbG9zZSA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlQ2xvc2VcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlRXJyb3IgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZUVycm9yXCIsIDcpO1xuICAgICAgICB0aGlzLnZhbHVlU3ltYm9sTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5sYWJlbE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuaW5wdXROb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLm1heENvdW50T3RoZXJWYWx1ZXMgPSAyMDA7XG4gICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzID0ge1xuICAgICAgICAgICAgaW5kZXg6IG51bGwsXG4gICAgICAgICAgICBwb3BvdmVyTm9kZTogbnVsbFxuICAgICAgICB9O1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gIFByaXZhdGUgTWV0aG9kc1xuICAgICAgICAvL1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgdGhpcy5oYW5kbGVEb25lID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8ga2VlcCB0aGUgY3VycmVudCBzZXR0aW5ncyBvbiB0aGUgbGF5ZXJcbiAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlQ2xvc2UuZW1pdChcInNhdmVcIik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGlkZVJvdGF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVRyYW5zcGFyZW5jeSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1lbnVPcGVuID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dCYWNrQnV0dG9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJlZm9yZUJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIFB1YmxpYyBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgc2V0Rm9jdXMoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5mbG93SXRlbU5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRGb2N1cygpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGUgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29tcG9uZW50V2lsbExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHsgbWFwVmlldywgbW9kdWxlcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGxheWVyID0gc21hcnRNYXBwaW5nU3RhdGUubGF5ZXI7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5sYXN0RGVmYXVsdCA9IHtcbiAgICAgICAgICAgIGRlZmF1bHRTeW1ib2w6IHJlbmRlcmVyLmRlZmF1bHRTeW1ib2wgfHwgZ2V0RGVmYXVsdFN5bWJvbChsYXllciwgbWFwVmlldyksXG4gICAgICAgICAgICBkZWZhdWx0TGFiZWw6IHJlbmRlcmVyLmRlZmF1bHRMYWJlbCB8fCBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2Uub3RoZXJcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFJlbmRlcmVySlNPTiA9IHJlbmRlcmVyLnRvSlNPTigpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbiA9XG4gICAgICAgICAgICBcImZlYXR1cmVSZWR1Y3Rpb25cIiBpbiBsYXllciAmJiBsYXllci5mZWF0dXJlUmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgPyBtb2R1bGVzLmVzcmlMYW5nLmNsb25lKGxheWVyLmZlYXR1cmVSZWR1Y3Rpb24pXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub3JpZ2luYWxPcmRlckJ5ID0gbGF5ZXIub3JkZXJCeTtcbiAgICAgICAgdGhpcy52aXN1YWxpemF0aW9uT3BlbiA9IHRydWU7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBnZXRQcmVkb21pbmFudENhdGVnb3JpZXMoe1xuICAgICAgICAgICAgICAgIGZpZWxkSW5mb3M6IHJlbmRlcmVyLnVuaXF1ZVZhbHVlR3JvdXBzWzBdLmNsYXNzZXMubWFwKChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogaW5mby52YWx1ZXNbMF0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGVGaWVsZFR5cGU6IHNpbXBsZUZpZWxkVHlwZXMuTlVNQkVSXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucHJlZG9taW5hbnRDYXRlZ29yeUluZm9zID0gcmVzdWx0LnByZWRvbWluYW50Q2F0ZWdvcnlJbmZvcztcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5wcmVkb21pbmFudENhdGVnb3J5SW5mb3MpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VFcnJvci5lbWl0KHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXJyb3JcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRoaXMuZmxvd0l0ZW1Ob2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0Rm9jdXMoKTsgfSk7XG4gICAgfVxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5sYXN0RGVmYXVsdCA9IG51bGw7XG4gICAgICAgIHNtYXJ0TWFwcGluZ1N0YXRlLnNlbGVjdGVkVmFsdWUgPSBudWxsO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBSZW5kZXIgTWV0aG9kc1xuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHsgaGlkZUxheWVyVGl0bGUsIGlzUlRMLCBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gaGlkZUxheWVyVGl0bGUgPyB1bmRlZmluZWQgOiAoX2EgPSBtYXBJbWFnZVN1YmxheWVyID09PSBudWxsIHx8IG1hcEltYWdlU3VibGF5ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hcEltYWdlU3VibGF5ZXIudGl0bGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGxheWVyLnRpdGxlO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgeyBjbGFzczogXCJjYWxjaXRlLW1hdGNoLWhlaWdodFwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGNsYXNzOiB7XG4gICAgICAgICAgICAgICAgXCJmbG93LWl0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbQ1NTX1VUSUxJVFkucnRsXTogaXNSVExcbiAgICAgICAgICAgIH0sIGhlYWRpbmc6IHN0cmluZ3MucGFuZWxzLnByZWRvbWluYW5jZS5zdHlsZU9wdGlvbnMsIGRlc2NyaXB0aW9uOiB0aXRsZSwgY2xvc2FibGU6IGlzVG9wRmxvd0l0ZW0odGhpcy5ob3N0RWxlbWVudCksIG1lbnVPcGVuOiB0aGlzLm1lbnVPcGVuLCBiZWZvcmVCYWNrOiB0aGlzLmJlZm9yZUJhY2ssXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbjogdGhpcy5zaG93QmFja0J1dHRvbiwgb25DYWxjaXRlRmxvd0l0ZW1DbG9zZTogdGhpcy5oYW5kbGVEb25lLCBvbkNhbGNpdGVGbG93SXRlbUJhY2s6ICgpID0+IHRoaXMuYXJjZ2lzU21hcnRNYXBwaW5nUGFuZWxzUHJlZG9taW5hbmNlQmFja0NsaWNrLmVtaXQoKSwgcmVmOiAobm9kZSkgPT4gKHRoaXMuZmxvd0l0ZW1Ob2RlID0gbm9kZSkgfSwgdGhpcy5yZW5kZXJWaXN1YWxpemF0aW9uKCksIHRoaXMucmVuZGVyVHJhbnNwYXJlbmN5KCksIHRoaXMucmVuZGVyUm90YXRpb24oKSwgdGhpcy5yZW5kZXJEb25lKCksIHRoaXMucmVuZGVyQ2FuY2VsKCkpKSk7XG4gICAgfVxuICAgIHJlbmRlclZpc3VhbGl6YXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGhhc090aGVyQmxvY2tzID0gIXRoaXMuaGlkZVRyYW5zcGFyZW5jeSB8fCAhdGhpcy5oaWRlUm90YXRpb247XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYmxvY2tcIiwgeyBjbGFzczogXCJwcmVkb21pbmFuY2UtYmxvY2tcIiwgaGVhZGluZzogc3RyaW5ncy5wYW5lbHMucHJlZG9taW5hbmNlLnByZWRvbWluYW5jZVN0eWxlLCBjb2xsYXBzaWJsZTogaGFzT3RoZXJCbG9ja3MsIG9wZW46IHRoaXMudmlzdWFsaXphdGlvbk9wZW4sIG9uQ2FsY2l0ZUJsb2NrT3BlbjogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSB0cnVlKSwgb25DYWxjaXRlQmxvY2tDbG9zZTogKCkgPT4gKHRoaXMudmlzdWFsaXphdGlvbk9wZW4gPSBmYWxzZSkgfSwgdGhpcy5yZW5kZXJQcmVkb21pbmFuY2VTeW1ib2woKSwgdGhpcy5yZW5kZXJEcmF3aW5nT3JkZXIoKSwgdGhpcy5yZW5kZXJWYWx1ZXMoKSwgdGhpcy5yZW5kZXJNc2coKSwgdGhpcy5yZW5kZXJCYWNrZ3JvdW5kU3R5bGUoKSkpO1xuICAgIH1cbiAgICByZW5kZXJQcmVkb21pbmFuY2VTeW1ib2woKSB7XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIsIG1hcFZpZXcsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgdW5pcXVlVmFsdWVDbGFzc2VzID0gcmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3NlcztcbiAgICAgICAgY29uc3Qgc2NoZW1lcyA9IG1vZHVsZXMucHJlZG9taW5hbmNlU2NoZW1lcy5nZXRTY2hlbWVzKHtcbiAgICAgICAgICAgIGJhc2VtYXA6IG1hcFZpZXcubWFwLmJhc2VtYXAsXG4gICAgICAgICAgICBnZW9tZXRyeVR5cGU6IGdldEdlb21ldHJ5VHlwZShsYXllciksXG4gICAgICAgICAgICBudW1Db2xvcnM6IHVuaXF1ZVZhbHVlQ2xhc3Nlcy5sZW5ndGhcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbG9yUmFtcHNBbmRTY2hlbWVzID0gZ2V0Q29sb3JSYW1wc1dpdGhTY2hlbWVzKHNjaGVtZXMsIE1hdGgubWluKHVuaXF1ZVZhbHVlQ2xhc3Nlcy5sZW5ndGgsIDEwKSk7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRDb2xvcnMgPSBjb2xvclJhbXBzQW5kU2NoZW1lc1swXS5jb2xvcnM7XG4gICAgICAgIGxldCBjb2xvcnMgPSAodW5pcXVlVmFsdWVDbGFzc2VzID09PSBudWxsIHx8IHVuaXF1ZVZhbHVlQ2xhc3NlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdW5pcXVlVmFsdWVDbGFzc2VzLmxlbmd0aClcbiAgICAgICAgICAgID8gdW5pcXVlVmFsdWVDbGFzc2VzXG4gICAgICAgICAgICAgICAgLnNsaWNlKDAsIDEwKVxuICAgICAgICAgICAgICAgIC5tYXAoKHVuaXF1ZVZhbHVlQ2xhc3MsIGlkeCkgPT4gZ2V0U3ltYm9sQ29sb3IodW5pcXVlVmFsdWVDbGFzcy5zeW1ib2wpIHx8XG4gICAgICAgICAgICAgICAgbmV3IG1vZHVsZXMuZXNyaUNvbG9yKGRlZmF1bHRDb2xvcnNbaWR4ICUgZGVmYXVsdENvbG9ycy5sZW5ndGhdKSlcbiAgICAgICAgICAgIDogW107XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXN5bWJvbC1idXR0b25cIiwgeyB0eXBlOiBcInByZWRvbWluYW5jZS1yYW1wXCIsIGNvbG9yczogY29sb3JzLCByYW1wVHlwZTogXCJkaXNjcmV0ZVwiLCBwb3BvdmVyUmVmZXJlbmNlRWxlbWVudDogdGhpcy5mbG93SXRlbU5vZGUsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sQnV0dG9uU3ltYm9sQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbk5vZGUgJiYgZm9yY2VVcGRhdGUodGhpcy5yb3RhdGlvbk5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlckRyYXdpbmdPcmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbWFwSW1hZ2VTdWJsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGlmIChtYXBJbWFnZVN1YmxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1sYWJlbFwiLCB7IGxheW91dDogXCJpbmxpbmUtc3BhY2UtYmV0d2VlblwiIH0sIHN0cmluZ3MucGFuZWxzLnByZWRvbWluYW5jZS5kcmF3aW5nT3JkZXIsIGgoXCJjYWxjaXRlLXN3aXRjaFwiLCB7IHNjYWxlOiBcInNcIiwgY2hlY2tlZDogcmVuZGVyZXIub3JkZXJCeUNsYXNzZXNFbmFibGVkLCBvbkNhbGNpdGVTd2l0Y2hDaGFuZ2U6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgY2xvc2VQb3BvdmVycygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gc21hcnRNYXBwaW5nU3RhdGUubGF5ZXI7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBnZXRSZW5kZXJlcihsYXllcik7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIub3JkZXJCeUNsYXNzZXNFbmFibGVkID0gbm9kZS5jaGVja2VkO1xuICAgICAgICAgICAgICAgIGlmIChub2RlLmNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIub3JkZXJCeSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsYXllci5vcmRlckJ5ID0gdGhpcy5vcmlnaW5hbE9yZGVyQnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwZGF0ZVJlbmRlcmVyKCk7XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlclZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICByZXR1cm4gKGgoRnJhZ21lbnQsIG51bGwsIGgoXCJjYWxjaXRlLWxhYmVsXCIsIG51bGwsIHN0cmluZ3MucGFuZWxzLnByZWRvbWluYW5jZS5maWVsZE5hbWUpLCBoKFwiY2FsY2l0ZS1saXN0XCIsIHsgY2xhc3M6IFwidG9wLWdyZXktYm9yZGVyXCIsIFwiZHJhZy1lbmFibGVkXCI6IHRydWUsIG9uQ2FsY2l0ZUxpc3RPcmRlckNoYW5nZTogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU29ydFZhbHVlcyhpdGVtcyk7XG4gICAgICAgICAgICB9IH0sIHJlbmRlcmVyLnVuaXF1ZVZhbHVlR3JvdXBzWzBdLmNsYXNzZXMubWFwKCh1bmlxdWVWYWx1ZUNsYXNzLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVmFsdWUodW5pcXVlVmFsdWVDbGFzcywgaW5kZXgpO1xuICAgICAgICB9KSksIGgoXCJjYWxjaXRlLWxpc3RcIiwgbnVsbCwgdGhpcy5yZW5kZXJEZWZhdWx0VmFsdWUoKSkpKTtcbiAgICB9XG4gICAgcmVuZGVyVmFsdWUodW5pcXVlVmFsdWVDbGFzcywgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1saXN0LWl0ZW1cIiwgeyB2YWx1ZTogdW5pcXVlVmFsdWVDbGFzcy52YWx1ZXNbMF0udmFsdWUsIGtleTogYHZhbHVlcy0ke3VuaXF1ZVZhbHVlQ2xhc3MudmFsdWVzWzBdLnZhbHVlfWAsIFwic29ydC12YWx1ZXNcIjogdW5pcXVlVmFsdWVDbGFzcy52YWx1ZXNbMF0udmFsdWUgfSwgdGhpcy5yZW5kZXJTeW1ib2xOb2RlKHVuaXF1ZVZhbHVlQ2xhc3MsIGluZGV4KSwgdGhpcy5yZW5kZXJUZXh0Tm9kZSh1bmlxdWVWYWx1ZUNsYXNzLCBpbmRleCksIHRoaXMucmVuZGVyQ291bnROb2RlKHVuaXF1ZVZhbHVlQ2xhc3MpKSk7XG4gICAgfVxuICAgIHJlbmRlclN5bWJvbE5vZGUodW5pcXVlVmFsdWVDbGFzcywgaW5kZXgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZFZhbHVlLCBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgY29uc3Qgc3ltYm9sTm9kZUNsYXNzZXMgPSB7XG4gICAgICAgICAgICBcInN5bWJvbFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJzeW1ib2wtaXMtd2hpdGVcIjogaXNTeW1ib2xBbG1vc3RXaGl0ZSh1bmlxdWVWYWx1ZUNsYXNzLnN5bWJvbClcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIChoKFwiZGl2XCIsIHsgY2xhc3M6IHN5bWJvbE5vZGVDbGFzc2VzLCBzbG90OiBcImNvbnRlbnQtc3RhcnRcIiwgb25DbGljazogKCkgPT4gdGhpcy5oYW5kbGVWYWx1ZVN5bWJvbENsaWNrKGluZGV4KSwgcm9sZTogXCJidXR0b25cIiwgdGFiSW5kZXg6IDAsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2UuYWNjZXNzaWJpbGl0eS5lZGl0U3ltYm9sRm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCB1bmlxdWVWYWx1ZUNsYXNzLmxhYmVsKSwgXCJhcmlhLWhhc3BvcHVwXCI6IFwidHJ1ZVwiLCBcImFyaWEtZXhwYW5kZWRcIjogc2VsZWN0ZWRWYWx1ZSA9PT0gaW5kZXgsIG9uS2V5RG93bjogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVmFsdWVTeW1ib2xDbGljayhpbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF0gPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVmFsdWVTeW1ib2woaW5kZXgsIG5vZGUpO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclRleHROb2RlKHVuaXF1ZVZhbHVlQ2xhc3MsIGluZGV4KSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChGcmFnbWVudCwgbnVsbCwgaChcImRpdlwiLCB7IFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2UuYWNjZXNzaWJpbGl0eS5lZGl0TGFiZWxGb3IucmVwbGFjZShcIiR7ZmllbGROYW1lfVwiLCB1bmlxdWVWYWx1ZUNsYXNzLmxhYmVsKSwgY2xhc3M6IFwibGFiZWwgdGV4dC13cmFwXCIsIHNsb3Q6IFwiY29udGVudFwiLCB0YWJJbmRleDogMCwgb25DbGljazogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgbGV0IGlucHV0Tm9kZSA9IGluZGV4ID09PSAtMSA/IHRoaXMuZGVmYXVsdElucHV0Tm9kZSA6IHRoaXMuaW5wdXROb2Rlc1tpbmRleF07XG4gICAgICAgICAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgaW5wdXROb2RlLnNldEZvY3VzKCk7XG4gICAgICAgICAgICB9LCBvbktleURvd246IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0Tm9kZSA9IGluZGV4ID09PSAtMSA/IHRoaXMuZGVmYXVsdElucHV0Tm9kZSA6IHRoaXMuaW5wdXROb2Rlc1tpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIGlucHV0Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dE5vZGUuc2V0Rm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCByZWY6IChub2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbE5vZGVzW2luZGV4XSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRMYWJlbE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSwgdW5pcXVlVmFsdWVDbGFzcy5sYWJlbCksIGgoXCJjYWxjaXRlLWlucHV0XCIsIHsgY2xhc3M6IFwiaGlkZGVuXCIsIHNsb3Q6IFwiY29udGVudFwiLCB0YWJJbmRleDogMCwgdmFsdWU6IHVuaXF1ZVZhbHVlQ2xhc3MubGFiZWwsIG9uRm9jdXNvdXQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVWYWx1ZVRleHRDaGFuZ2UoaW5kZXgsIG5vZGUudmFsdWUpO1xuICAgICAgICAgICAgfSwgb25LZXlEb3duOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8IGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVZhbHVlVGV4dENoYW5nZShpbmRleCwgbm9kZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcmVmOiAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXROb2Rlc1tpbmRleF0gPSBub2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0SW5wdXROb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0pKSk7XG4gICAgfVxuICAgIHJlbmRlckNvdW50Tm9kZSh1bmlxdWVWYWx1ZUNsYXNzKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLmdldFByZWRvbWluYW50Q2F0ZWdvcnlWYWx1ZSh1bmlxdWVWYWx1ZUNsYXNzLnZhbHVlc1swXS52YWx1ZSk7XG4gICAgICAgIGlmICghaW5mbyB8fCAhaXNEZWZpbmVkKGluZm8uY291bnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKGgoXCJkaXZcIiwgeyBzbG90OiBcImNvbnRlbnQtZW5kXCIsIGNsYXNzOiBcInZhbHVlLWNvdW50XCIsIFwiYXJpYS1sYWJlbFwiOiBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2UuYWNjZXNzaWJpbGl0eS5jb3VudEZvci5yZXBsYWNlKFwiJHt2YWx1ZX1cIiwgdW5pcXVlVmFsdWVDbGFzcy5sYWJlbCkgfSwgYCR7aW5mby5jb3VudH1gKSk7XG4gICAgfVxuICAgIHJlbmRlckRlZmF1bHRWYWx1ZSgpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbGFzdERlZmF1bHQsIHN0cmluZ3MgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgY29uc3QgZGVmYXVsdFN5bWJvbCA9IHJlbmRlcmVyLmRlZmF1bHRTeW1ib2wgfHwgbGFzdERlZmF1bHQuZGVmYXVsdFN5bWJvbDtcbiAgICAgICAgY29uc3QgZGVmYXVsdExhYmVsID0gcmVuZGVyZXIuZGVmYXVsdExhYmVsIHx8IGxhc3REZWZhdWx0LmRlZmF1bHRMYWJlbDtcbiAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuZ2V0UHJlZG9taW5hbnRDYXRlZ29yeVZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtbGlzdC1pdGVtXCIsIHsgY2xhc3M6IFwidG9wLWdyZXktYm9yZGVyXCIgfSwgaChcImNhbGNpdGUtY2hlY2tib3hcIiwgeyBjbGFzczogXCJjaGVja2JveFwiLCBzY2FsZTogXCJzXCIsIHRhYkluZGV4OiAwLCBzbG90OiBcImFjdGlvbnMtc3RhcnRcIiwgY2hlY2tlZDogISFyZW5kZXJlci5kZWZhdWx0U3ltYm9sLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVyLmRlZmF1bHRTeW1ib2wpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdExhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCA9IGxhc3REZWZhdWx0LmRlZmF1bHRTeW1ib2w7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IGxhc3REZWZhdWx0LmRlZmF1bHRMYWJlbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh0aGlzLmhvc3RFbGVtZW50KTtcbiAgICAgICAgICAgIH0gfSksIHRoaXMucmVuZGVyU3ltYm9sTm9kZShkZWZhdWx0TGFiZWwsIC0xKSwgdGhpcy5yZW5kZXJUZXh0Tm9kZSh7XG4gICAgICAgICAgICBzeW1ib2w6IGRlZmF1bHRTeW1ib2wsXG4gICAgICAgICAgICBsYWJlbDogZGVmYXVsdExhYmVsXG4gICAgICAgIH0sIC0xKSwgaChcImRpdlwiLCB7IHNsb3Q6IFwiY29udGVudC1lbmRcIiwgXCJhcmlhLWxhYmVsXCI6IHN0cmluZ3MucGFuZWxzLnByZWRvbWluYW5jZS5hY2Nlc3NpYmlsaXR5LmNvdW50Rm9yLnJlcGxhY2UoXCIke3ZhbHVlfVwiLCBkZWZhdWx0TGFiZWwpIH0sIFwiXCIgKyAoIWluZm8gfHwgIWlzRGVmaW5lZChpbmZvLmNvdW50KSA/IDAgOiBpbmZvLmNvdW50KSkpKTtcbiAgICB9XG4gICAgcmVuZGVyTXNnKCkge1xuICAgICAgICBjb25zdCB7IGxheWVyLCBsYXN0RGVmYXVsdCwgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICAvLyBUT0RPIGVzdGltYXRlZFZhbHVlc01zZ1xuICAgICAgICBpZiAocmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3NlcyAmJlxuICAgICAgICAgICAgcmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3Nlcy5sZW5ndGggPiB0aGlzLm1heENvdW50T3RoZXJWYWx1ZXMpIHtcbiAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2UudG9vTWFueVZhbHVlcy5yZXBsYWNlKFwiJHtjb3VudH1cIiwgdGhpcy5tYXhDb3VudE90aGVyVmFsdWVzLnRvU3RyaW5nKCkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIXJlbmRlcmVyLnVuaXF1ZVZhbHVlR3JvdXBzWzBdLmNsYXNzZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBvbmx5IG90aGVyQ2F0ZWdvcnlcbiAgICAgICAgICAgIHJldHVybiAoaChcImRpdlwiLCBudWxsLCBzdHJpbmdzLnBhbmVscy5wcmVkb21pbmFuY2Uubm9GZWF0dXJlcy5yZXBsYWNlKFwiJHtvdGhlcn1cIiwgbGFzdERlZmF1bHQuZGVmYXVsdExhYmVsKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyQmFja2dyb3VuZFN0eWxlKCkge1xuICAgICAgICBjb25zdCB7IG1hcEltYWdlU3VibGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBpZiAoZ2V0UmVuZGVyZXJUeXBlKCkgIT09IFwicHJlZG9taW5hbmNlLXNpemVcIiB8fCBtYXBJbWFnZVN1YmxheWVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLWJhY2tncm91bmQtc3ltYm9sXCIsIG51bGwpO1xuICAgIH1cbiAgICByZW5kZXJUcmFuc3BhcmVuY3koKSB7XG4gICAgICAgIGlmICh0aGlzLmhpZGVUcmFuc3BhcmVuY3kpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJvcGFjaXR5XCIpO1xuICAgICAgICByZXR1cm4gKGgoXCJhcmNnaXMtc21hcnQtbWFwcGluZy10cmFuc3BhcmVuY3lcIiwgeyBvcGVuOiAhIW9wYWNpdHlWaXNWYXIsIG9uQXJjZ2lzU21hcnRNYXBwaW5nU3ltYm9sVHJhbnNwYXJlbmN5RXJyb3I6ICh7IGRldGFpbCB9KSA9PiB0aGlzLmFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZUVycm9yLmVtaXQoZGV0YWlsKSB9KSk7XG4gICAgfVxuICAgIHJlbmRlclJvdGF0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5oaWRlUm90YXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGF5ZXIgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCBvcGFjaXR5VmlzVmFyID0gZ2V0VmlzVmFyKGdldFJlbmRlcmVyKGxheWVyKSwgXCJvcGFjaXR5XCIpO1xuICAgICAgICBjb25zdCByb3RhdGlvblZpc1ZhciA9IGdldFZpc1ZhcihnZXRSZW5kZXJlcihsYXllciksIFwicm90YXRpb25cIik7XG4gICAgICAgIHJldHVybiAoaChcImFyY2dpcy1zbWFydC1tYXBwaW5nLXJvdGF0aW9uXCIsIHsgb3BlbjogIW9wYWNpdHlWaXNWYXIgJiYgISFyb3RhdGlvblZpc1Zhciwgb25BcmNnaXNTbWFydE1hcHBpbmdSb3RhdGlvbkVycm9yOiAoeyBkZXRhaWwgfSkgPT4gdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VFcnJvci5lbWl0KGRldGFpbCksIHJlZjogKG5vZGUpID0+ICh0aGlzLnJvdGF0aW9uTm9kZSA9IG5vZGUpIH0pKTtcbiAgICB9XG4gICAgcmVuZGVyRG9uZSgpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdzIH0gPSBzbWFydE1hcHBpbmdTdGF0ZTtcbiAgICAgICAgcmV0dXJuIChoKFwiY2FsY2l0ZS1idXR0b25cIiwgeyBzbG90OiBcImZvb3RlclwiLCBsYWJlbDogc3RyaW5ncy5kb25lLCBvbkNsaWNrOiB0aGlzLmhhbmRsZURvbmUsIGFwcGVhcmFuY2U6IFwic29saWRcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuZG9uZSkpO1xuICAgIH1cbiAgICByZW5kZXJDYW5jZWwoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIHJldHVybiAoaChcImNhbGNpdGUtYnV0dG9uXCIsIHsgc2xvdDogXCJmb290ZXJcIiwgbGFiZWw6IHN0cmluZ3MuY2FuY2VsLCBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFJlbmRlcmVySlNPTiwgb3JpZ2luYWxGZWF0dXJlUmVkdWN0aW9uLCBvcmlnaW5hbE9yZGVyQnkgfSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBzbWFydE1hcHBpbmdTdGF0ZS5sYXllcjtcbiAgICAgICAgICAgICAgICBsYXllci5vcmRlckJ5ID0gb3JpZ2luYWxPcmRlckJ5O1xuICAgICAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgICAgICBhcHBseVJlbmRlcmVyVG9BbGwob3JpZ2luYWxSZW5kZXJlckpTT04sIG9yaWdpbmFsRmVhdHVyZVJlZHVjdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VDbG9zZS5lbWl0KFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgfSwgYXBwZWFyYW5jZTogXCJvdXRsaW5lLWZpbGxcIiwgd2lkdGg6IFwiaGFsZlwiIH0sIHN0cmluZ3MuY2FuY2VsKSk7XG4gICAgfVxuICAgIGFzeW5jIGNyZWF0ZVZhbHVlU3ltYm9sKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbGFzdERlZmF1bHQsIG1vZHVsZXMgfSA9IHNtYXJ0TWFwcGluZ1N0YXRlO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGdldFJlbmRlcmVyKGxheWVyKTtcbiAgICAgICAgbGV0IHN5bWJvbDtcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgc3ltYm9sID0gcmVuZGVyZXIuZGVmYXVsdFN5bWJvbCB8fCBsYXN0RGVmYXVsdC5kZWZhdWx0U3ltYm9sO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3ltYm9sID0gcmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3Nlc1tpbmRleF0uc3ltYm9sLmNsb25lKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVtb3ZlIG9sZCBzeW1ib2wgaWYgdGhlcmUgaXMgb25lXG4gICAgICAgIHdoaWxlICgoX2EgPSBlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQuY2hpbGROb2RlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkge1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmNoaWxkTm9kZXNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzeW1ib2wpIHtcbiAgICAgICAgICAgIC8vIGFkZCBuZXcgc3ltYm9sXG4gICAgICAgICAgICBjb25zdCBzeW1ib2xOb2RlID0gYXdhaXQgbW9kdWxlcy5zeW1ib2xVdGlscy5yZW5kZXJQcmV2aWV3SFRNTChzeW1ib2wsIHtcbiAgICAgICAgICAgICAgICBzaXplOiBnZXRSZW5kZXJQcmV2aWV3U2l6ZShzeW1ib2wpLFxuICAgICAgICAgICAgICAgIHN5bWJvbENvbmZpZzogXG4gICAgICAgICAgICAgICAgLy9zeW1ib2wudHlwZSA9PT0gXCJzaW1wbGUtZmlsbFwiIHx8IC4uLiB3aGlsZSBDSU1zIGhhdmUgdGhhdCBzaGFwZVxuICAgICAgICAgICAgICAgIHN5bWJvbC50eXBlID09PSBcImNpbVwiICYmIHN5bWJvbC5kYXRhLnN5bWJvbC50eXBlID09PSBcIkNJTVBvbHlnb25TeW1ib2xcIlxuICAgICAgICAgICAgICAgICAgICA/IHsgaXNTcXVhcmVGaWxsOiB0cnVlIH1cbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChzeW1ib2xOb2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRQcmVkb21pbmFudENhdGVnb3J5VmFsdWUodmFsdWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnByZWRvbWluYW50Q2F0ZWdvcnlJbmZvcykge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICAvLyBubyBleGFjdCBtYXRjaCFcbiAgICAgICAgY29uc3QgaW5mb3MgPSB0aGlzLnByZWRvbWluYW50Q2F0ZWdvcnlJbmZvcy5maWx0ZXIoKGluZm8pID0+IGluZm8udmFsdWUgPT0gdmFsdWUpO1xuICAgICAgICByZXR1cm4gKGluZm9zID09PSBudWxsIHx8IGluZm9zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbmZvcy5sZW5ndGgpID8gaW5mb3NbMF0gOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGhhbmRsZVNvcnRWYWx1ZXMoaXRlbXMpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgY29uc3QgaXRlbVZhbHVlcyA9IGl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS52YWx1ZSk7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCB1bmlxdWVWYWx1ZUNsYXNzZXMgPSByZW5kZXJlci51bmlxdWVWYWx1ZUdyb3Vwc1swXS5jbGFzc2VzXG4gICAgICAgICAgICAuZmlsdGVyKCh1bmlxdWVWYWx1ZUNsYXNzKSA9PiBpdGVtVmFsdWVzLmluZGV4T2YoYCR7dW5pcXVlVmFsdWVDbGFzcy52YWx1ZXNbMF0udmFsdWV9YCkgPiAtMSlcbiAgICAgICAgICAgIC5tYXAoKHVuaXF1ZVZhbHVlQ2xhc3MpID0+IG1vZHVsZXMuZXNyaUxhbmcuY2xvbmUodW5pcXVlVmFsdWVDbGFzcykpO1xuICAgICAgICB1bmlxdWVWYWx1ZUNsYXNzZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgYUluZGV4ID0gaXRlbVZhbHVlcy5pbmRleE9mKGEudmFsdWVzWzBdLnZhbHVlKTtcbiAgICAgICAgICAgIGNvbnN0IGJJbmRleCA9IGl0ZW1WYWx1ZXMuaW5kZXhPZihiLnZhbHVlc1swXS52YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gYUluZGV4IC0gYkluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgcmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3NlcyA9IHVuaXF1ZVZhbHVlQ2xhc3NlcztcbiAgICAgICAgdXBkYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgZm9yY2VVcGRhdGUodGhpcy5ob3N0RWxlbWVudCk7XG4gICAgfVxuICAgIGhhbmRsZVZhbHVlU3ltYm9sQ2xpY2soaW5kZXgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoKF9hID0gdGhpcy5wb3BvdmVyU2V0dGluZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wb3BvdmVyTm9kZSkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVTeW1ib2xOb2RlID0gaW5kZXggPT09IC0xID8gdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSA6IHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF07XG4gICAgICAgICAgICB2YWx1ZVN5bWJvbE5vZGUuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMucG9wb3ZlclNldHRpbmdzLmluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MuaW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5TeW1ib2xTdHlsZXJGb3JWYWx1ZShpbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgdGhpcy5vcGVuU3ltYm9sU3R5bGVyRm9yVmFsdWUoaW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVZhbHVlVGV4dENoYW5nZShpbmRleCwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBsYXllciwgbW9kdWxlcywgc3RyaW5ncyB9ID0gc21hcnRNYXBwaW5nU3RhdGU7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gZ2V0UmVuZGVyZXIobGF5ZXIpO1xuICAgICAgICBjb25zdCBvcmlnaW5hbFJlbmRlcmVyID0gbW9kdWxlcy5yZW5kZXJlckpzb25VdGlscy5mcm9tSlNPTih0aGlzLm9yaWdpbmFsUmVuZGVyZXJKU09OKTtcbiAgICAgICAgaWYgKCFuZXdWYWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZSA9IG9yaWdpbmFsUmVuZGVyZXIuZGVmYXVsdExhYmVsIHx8IHN0cmluZ3MucGFuZWxzLnByZWRvbWluYW5jZS5vdGhlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBtYXRjaGluZ0NsYXNzID0gb3JpZ2luYWxSZW5kZXJlci51bmlxdWVWYWx1ZUdyb3Vwc1swXS5jbGFzc2VzLmZpbmQoKHV2Q2xhc3MpID0+IHV2Q2xhc3MudmFsdWVzWzBdLnZhbHVlID09PSByZW5kZXJlci51bmlxdWVWYWx1ZUdyb3Vwc1swXS5jbGFzc2VzW2luZGV4XS52YWx1ZXNbMF0udmFsdWUpO1xuICAgICAgICAgICAgICAgIG5ld1ZhbHVlID0gbWF0Y2hpbmdDbGFzcy5sYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICBpZiAocmVuZGVyZXIuZGVmYXVsdFN5bWJvbCkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLmRlZmF1bHRMYWJlbCA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyZXIudW5pcXVlVmFsdWVHcm91cHNbMF0uY2xhc3Nlc1tpbmRleF0ubGFiZWwgPSBuZXdWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICBsZXQgaW5wdXROb2RlID0gaW5kZXggPT09IC0xID8gdGhpcy5kZWZhdWx0SW5wdXROb2RlIDogdGhpcy5pbnB1dE5vZGVzW2luZGV4XTtcbiAgICAgICAgaW5wdXROb2RlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIGxldCBsYWJlbE5vZGUgPSBpbmRleCA9PT0gLTEgPyB0aGlzLmRlZmF1bHRMYWJlbE5vZGUgOiB0aGlzLmxhYmVsTm9kZXNbaW5kZXhdO1xuICAgICAgICBsYWJlbE5vZGUuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgbGFiZWxOb2RlLmlubmVySFRNTCA9IG5ld1ZhbHVlO1xuICAgICAgICBpbnB1dE5vZGUudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBsYWJlbE5vZGUuZm9jdXMoKSwgMzAwKTtcbiAgICB9XG4gICAgb3BlblN5bWJvbFN0eWxlckZvclZhbHVlKGluZGV4KSB7XG4gICAgICAgIGNsb3NlUG9wb3ZlcnMoKTtcbiAgICAgICAgY29uc3QgdmFsdWVTeW1ib2xOb2RlID0gaW5kZXggPT09IC0xID8gdGhpcy5kZWZhdWx0U3ltYm9sTm9kZSA6IHRoaXMudmFsdWVTeW1ib2xOb2Rlc1tpbmRleF07XG4gICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlID0gY3JlYXRlU3ltYm9sU3R5bGVyUG9wb3Zlcih7XG4gICAgICAgICAgICByZWZlcmVuY2VFbGVtZW50OiB0aGlzLmZsb3dJdGVtTm9kZSxcbiAgICAgICAgICAgIGhlYWRpbmc6IHNtYXJ0TWFwcGluZ1N0YXRlLnN0cmluZ3Muc3R5bGVyLnN5bWJvbFN0eWxlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nU3R5bGVyUG9wb3ZlckNsb3NlXCIsICgpID0+IHtcbiAgICAgICAgICAgIHJlbW92ZVN5bWJvbFN0eWxlclBvcG92ZXIodGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUpO1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2V0dGluZ3MucG9wb3Zlck5vZGUgPSBudWxsO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB2YWx1ZVN5bWJvbE5vZGUuZm9jdXMoKSwgMzAwKTtcbiAgICAgICAgICAgIHZhbHVlU3ltYm9sTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXR0aW5ncy5wb3BvdmVyTm9kZS5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzU21hcnRNYXBwaW5nU3R5bGVyUG9wb3ZlckRpc2Nvbm5lY3RlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZW1vdmVTeW1ib2xTdHlsZXJQb3BvdmVyKHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlKTtcbiAgICAgICAgICAgIHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlID0gbnVsbDtcbiAgICAgICAgICAgIHZhbHVlU3ltYm9sTm9kZS5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICBzbWFydE1hcHBpbmdTdGF0ZS5zZWxlY3RlZFZhbHVlID0gaW5kZXg7XG4gICAgICAgIGJ1aWxkU3ltYm9sU3R5bGVyRm9yUHJlZG9taW5hbmNlVmFsdWUoe1xuICAgICAgICAgICAgcG9wb3Zlck5vZGU6IHRoaXMucG9wb3ZlclNldHRpbmdzLnBvcG92ZXJOb2RlLFxuICAgICAgICAgICAgb25DaGFuZ2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZW5kZXJlcigpO1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHRoaXMuaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb25Ob2RlICYmIGZvcmNlVXBkYXRlKHRoaXMucm90YXRpb25Ob2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHZhbHVlU3ltYm9sTm9kZS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgfVxuICAgIGdldCBob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbn07XG5BcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2Uuc3R5bGUgPSBhcmNnaXNTbWFydE1hcHBpbmdQYW5lbHNQcmVkb21pbmFuY2VDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1NtYXJ0TWFwcGluZ1BhbmVsc1ByZWRvbWluYW5jZSBhcyBhcmNnaXNfc21hcnRfbWFwcGluZ19wYW5lbHNfcHJlZG9taW5hbmNlIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyY2dpcy1zbWFydC1tYXBwaW5nLXBhbmVscy1wcmVkb21pbmFuY2UuZW50cnkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9