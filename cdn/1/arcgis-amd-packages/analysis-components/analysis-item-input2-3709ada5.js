define(["exports","./index-ef555910","./index2-588b02d9","./utils-793221d4","./analysis-item-browser2-508c9cf3","./analysis-label2-f17c360a"],(function(exports,index,index2,utils,analysisItemBrowser2,analysisLabel2){"use strict";const ItemTypeName={deepLearning:"Deep Learning Package"};const ItemTypeKeyword={AmazonS3:"cloudStore_amazon",AzureBlob:"cloudStore_azure",BigQuery:"bigquery",Snowflake:"snowflake"};const component="analysis-item-input";const HTMLClasses={label:`${component}__label`,buttonContainer:`${component}__buttons-container`,border:`${component}__border`,loaderContainer:`${component}__loader-container`,loader:`${component}__loader`};const analysisItemInputCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.analysis-item-input__border{border:1px solid var(--analysis-ui-border-input);box-shadow:none}.analysis-item-input__buttons-container{display:flex;flex-direction:row;gap:var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.analysis-item-input__label{cursor:pointer;padding-bottom:var(--analysis-half-spacing);margin-block-start:0;margin-block-end:0}.analysis-item-input__loader-container{font-size:var(--calcite-font-size--2)}.analysis-item-input__loader{margin-top:0.5rem}";const AnalysisItemInput=index.proxyCustomElement(class AnalysisItemInput extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisItemInputChange=index.createEvent(this,"analysisItemInputChange",7);this.analysisHelpClick=index.createEvent(this,"analysisHelpClick",7);this.renderInitialMode=()=>{let newItemButton;if(this.newItemMode!==undefined){const props=this.getNewItemButtonProps(this.newItemMode);newItemButton=index.h("calcite-button",{width:"full",appearance:"outline",scale:utils.UIDefaults.Scale,kind:"neutral","icon-start":props.icon,onClick:this.openAddItem},props.label)}return index.h("div",{class:HTMLClasses.buttonContainer},newItemButton,index.h("calcite-button",{width:"full",appearance:"outline",kind:"neutral",scale:utils.UIDefaults.Scale,"icon-start":"select",onClick:this.openItemBrowser},this.selectButtonLabel??this.strings.selectItem))};this.clearSelectedItem=()=>{this.selectedItem=undefined;this.value=undefined;this.analysisItemInputChange.emit()};this.openItemBrowser=()=>{this.itemBrowserElement=document.createElement("analysis-item-browser");this.itemBrowserElement.header=this.strings.selectItem;this.itemBrowserElement.filter=this.filterExpression;this.itemBrowserElement.q=this.q;this.itemBrowserElement.portal=this.portal;this.itemBrowserElement.user=this.user;this.itemBrowserElement.bucketOptions=this.bucketOptions;this.itemBrowserElement.hidePreview=this.hidePreview;this.itemBrowserElement.hideFilters=true;this.itemBrowserElement.hideAddToMap=true;this.itemBrowserElement.selectionMode="single";this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals);this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.onSelectedBrowserItem);document.body.appendChild(this.itemBrowserElement)};this.onSelectedBrowserItem=event=>{if(event.detail!==null){this.value={itemId:event.detail.id};this.analysisItemInputChange.emit()}};this.openAddItem=()=>{if(this.newItemMode===undefined||this.newItemConfig===undefined){return}this.newItemElement=document.createElement("arcgis-new-item");this.newItemElement.allowPublish=false;this.newItemElement.allowedItemTypes=this.itemTypes;this.newItemElement.allowedModes=[this.newItemMode];this.newItemElement.api=4;this.newItemElement.config=this.newItemConfig;this.newItemElement.portal=this.portal;this.newItemElement.user=this.user;const subtypeStepLookup=[[ItemTypeKeyword.AmazonS3,"dataStoreSelectCloudCredentialsAmazonS3"],[ItemTypeKeyword.AzureBlob,"dataStoreSelectCloudCredentialsAzureBlob"],[ItemTypeKeyword.Snowflake,"dataStoreDatabaseCredentialsSnowflake"],[ItemTypeKeyword.BigQuery,"dataStoreDatabaseCredentialsBigQuery"]];for(const[keyword,step]of subtypeStepLookup){if(`typekeywords:${keyword}`===this.itemFilter){this.newItemElement.firstStep=step;break}}this.newItemElement.addEventListener("workflowCancel",this.closeModals);this.newItemElement.addEventListener("workflowComplete",this.onAddItemComplete);document.body.appendChild(this.newItemElement)};this.onAddItemComplete=event=>{if(event.detail.id!==undefined){this.value={itemId:event.detail.id}}else{this.value=undefined;this.selectedItem=undefined}this.analysisItemInputChange.emit();if(this.newItemElement!==undefined){this.newItemElement.isActive=false}};this.closeModals=()=>{if(this.itemBrowserElement!==undefined){this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals);this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals);this.itemBrowserElement.remove();this.itemBrowserElement=undefined}if(this.newItemElement!==undefined){this.newItemElement.removeEventListener("workflowCancel",this.closeModals);this.newItemElement.removeEventListener("workflowComplete",this.onAddItemComplete);this.newItemElement.remove();this.newItemElement=undefined}};this.getNewItemButtonProps=newItemMode=>{if(newItemMode==="file"){return{icon:"upload-to",label:this.strings.addFile}}else if(newItemMode==="dataStore"){return{icon:"plus",label:this.strings.addDataStore}}else{throw new Error("Unsupported new item mode.")}};this.validate=()=>{let isValid;if(this.required&&index2.isEmptyDataItem(this.value)){isValid=false;this.errorMessage=this.strings.requiredInputMessage}else{isValid=true;this.errorMessage=undefined}return isValid};this.renderLoader=()=>{const showLoader=this.isProcessingItem===true;return index.h("div",{class:HTMLClasses.loaderContainer},index.h("calcite-loader",{class:HTMLClasses.loader,hidden:!showLoader,inline:true,label:"loader",scale:utils.UIDefaults.Scale,type:"indeterminate"}),showLoader?this.processingItemMessage??this.strings.queryModelArgsMsg:null)};this.onListItemMouseOver=e=>{const targetElement=e.target;if(targetElement?.localName==="calcite-list-item"){if(this.replaceTooltip===undefined){this.replaceTooltip=document.createElement("calcite-tooltip");this.replaceTooltip.placement="bottom";this.replaceTooltip.innerText=this.replaceTooltipText??this.strings.replaceItem}this.replaceTooltip.referenceElement=targetElement;utils.addOpenableDomElement(document,this.replaceTooltip)}};this.onListItemMouseOut=()=>{utils.removeOpenableDomElement(this.replaceTooltip)};this.onListItemClick=e=>{const targetElement=e.target;if(targetElement?.localName==="calcite-list-item"){this.openItemBrowser()}};this.isProcessingItem=false;this.errorMessage=undefined;this.selectedItem=undefined;this.deepLearningParameters={};this.value=undefined;this.required=false;this.label=undefined;this.itemTypes=[];this.itemFilter=undefined;this.q=undefined;this.sharingLevels=undefined;this.hidePreview=false;this.newItemMode=undefined;this.selectButtonLabel=undefined;this.processingItemMessage=undefined;this.replaceTooltipText=undefined;this.newItemConfig=undefined;this.user=undefined;this.portal=undefined;this.selectedItemIcon=undefined}async loadItemProperties(){if(this.abortController!==undefined){this.abortController.abort()}this.deepLearningParameters=undefined;if(this.selectedItem?.type===ItemTypeName.deepLearning){try{this.abortController=new AbortController;this.isProcessingItem=true;this.deepLearningParameters=await index2.processDeepLearningModelItem(this.selectedItem,this.portal,{signal:this.abortController.signal});this.isProcessingItem=false;this.analysisItemInputChange.emit()}catch(err){if(index2.wasAborted(err)===false){this.isProcessingItem=false;this.errorMessage=this.strings.queryModelArgsErrMsg}}}}async hydrateSelectedItem(newValue){const newItemId=newValue?.itemId;if(newItemId!==this.selectedItem?.id){if(newItemId===undefined){this.selectedItem=undefined}else{const portalItem=index2.getPortalItemMemo(newItemId,this.portal);try{await portalItem.load();this.selectedItem=portalItem}catch(err){this.value=undefined;if(typeof err==="object"&&err!==null){if(err.name==="identity-manager:not-authorized"){this.errorMessage=this.strings.itemPermissionDenied}else if(err.name==="request:server"&&typeof err.details==="object"&&err.details!==null&&err.details.messageCode==="CONT_0001"){this.errorMessage=this.strings.itemNotFound}}}}this.analysisItemInputChange.emit()}}validateOnValueChange(){this.validate()}get hasError(){return this.errorMessage!==undefined}get filterExpression(){return utils.makePortalSearchFilter(this.itemTypes,this.itemFilter)}get bucketOptions(){let options=undefined;if(this.sharingLevels!==undefined){options=[...this.sharingLevels];const orgAdminLevelIndex=options.indexOf("org-admin");if(orgAdminLevelIndex>=0){options.splice(orgAdminLevelIndex,1);if(this.user.role==="org_admin"&&!options.includes("org")){options.push("org")}}}return options}async componentWillLoad(){({strings:this.strings}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)));this.hydrateSelectedItem(this.value)}disconnectedCallback(){this.closeModals();utils.removeOpenableDomElement(this.replaceTooltip);if(this.itemBrowserElement!==undefined){this.itemBrowserElement.remove();this.itemBrowserElement=undefined}}async checkValidity(){const isValid=this.validate();return Promise.resolve(isValid)}render(){const content=index2.isEmptyDataItem(this.value)?this.renderInitialMode():this.renderSelection();return index.h(index.Host,null,this.label!==undefined&&this.label!==""?index.h("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,content,index.h("calcite-input-message",{status:"invalid",scale:utils.UIDefaults.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}renderSelection(){return index.h("div",null,index.h("calcite-list",{selectionMode:"none"},index.h("calcite-list-item",{key:this.selectedItem?.id,value:this.selectedItem?.id,label:this.selectedItem?.title??"",class:HTMLClasses.border,onMouseOver:this.onListItemMouseOver,onMouseOut:this.onListItemMouseOut,onClick:this.onListItemClick},this.selectedItemIcon!==undefined&&index.h("calcite-icon",{icon:this.selectedItemIcon,slot:"content-start"}),index.h("calcite-action",{text:this.strings.removeItem,slot:"actions-end",label:this.strings.removeItem,appearance:"transparent",icon:"x",onClick:this.clearSelectedItem}))),this.renderLoader())}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{selectedItem:["loadItemProperties"],value:["hydrateSelectedItem","validateOnValueChange"]}}static get style(){return analysisItemInputCss}},[1,"analysis-item-input",{selectedItem:[1040],deepLearningParameters:[1040],value:[1040],required:[516],label:[513],itemTypes:[16],itemFilter:[1,"item-filter"],q:[1],sharingLevels:[16],hidePreview:[4,"hide-preview"],newItemMode:[513,"new-item-mode"],selectButtonLabel:[513,"select-button-label"],processingItemMessage:[513,"processing-item-message"],replaceTooltipText:[513,"replace-tooltip-text"],newItemConfig:[16],user:[16],portal:[16],selectedItemIcon:[513,"selected-item-icon"],isProcessingItem:[32],errorMessage:[32],checkValidity:[64]},undefined,{selectedItem:["loadItemProperties"],value:["hydrateSelectedItem","validateOnValueChange"]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-item-input","analysis-item-browser","analysis-label"];components.forEach((tagName=>{switch(tagName){case"analysis-item-input":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisItemInput)}break;case"analysis-item-browser":if(!customElements.get(tagName)){analysisItemBrowser2.defineCustomElement()}break;case"analysis-label":if(!customElements.get(tagName)){analysisLabel2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisItemInput=AnalysisItemInput;exports.defineCustomElement=defineCustomElement}));
