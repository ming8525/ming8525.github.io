define(["exports","./index-ef555910","./index2-588b02d9","./analysis-expression-group2-ce4cdcfd","./utils-793221d4","./analysis-attribute-expression2-a90d2a8c","./analysis-query-builder2-59ad1897","./analysis-query-entry2-a97f8d18","./analysis-query-target-select2-1308b9a9","./analysis-spatial-expression2-5e7137a9"],(function(exports,index,index2,analysisExpressionGroup2,utils,analysisAttributeExpression2,analysisQueryBuilder2,analysisQueryEntry2,analysisQueryTargetSelect2,analysisSpatialExpression2){"use strict";const HTMLClasses={queryModal:"query-modal",tileSelectThirdWidth:"expression-tile-select-w-third",tileSelectGroup:"expression-tile-select-group"};const analysisQueryModalCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}.query-modal{--calcite-modal-width:60rem}.expression-tile-select-group{justify-content:center}.expression-tile-select-w-third{width:33%}";const AnalysisQueryModal=index.proxyCustomElement(class AnalysisQueryModal extends index.H{constructor(){super();this.__registerHost();this.analysisQueryModalAdd=index.createEvent(this,"analysisQueryModalAdd",7);this.analysisQueryModalDismissed=index.createEvent(this,"analysisQueryModalDismissed",7);this.analysisQueryModalError=index.createEvent(this,"analysisQueryModalError",7);this.close=()=>{if(this.containerRef!==undefined){this.containerRef.open=false}};this.onQueryError=event=>{this.analysisQueryModalError.emit(event.detail)};this.onTargetChange=event=>{this.target=event.target.target};this.onSelectExpressionType=event=>{const tile=event.target;this.selectedExpressionType=tile.value};this.onOnboardingNextClick=()=>{this.expressionGroup=this.createDefaultGroup();this.isOnboarding=false};this.onAddClick=()=>{this.analysisQueryModalAdd.emit(this.newValue??this.expressionGroup);this.close()};this.onClose=()=>{this.analysisQueryModalDismissed.emit()};this.onQueryChange=event=>{this.newValue=event.detail};this.selectedExpressionType="attribute";this.isOnboarding=true;this.value=undefined;this.mode=undefined;this.expressionGroup=undefined;this.target=undefined;this.layers=[];this.open=undefined;this.recordsTerm="features";this.options=undefined}async componentWillLoad(){({strings:this.strings}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)));this.isOnboarding=this.value===undefined||typeof this.value!=="string"&&this.value.expressions.length<1;await Promise.allSettled(this.layers.map((layer=>layer.load())))}componentDidRender(){if(this.tooltipRef!==undefined&&this.tooltipRef!==null&&this.spatialExpressionTile!==undefined){this.tooltipRef.referenceElement=this.spatialExpressionTile}}get loadedLayers(){const layers=this.layers.length===0&&this.target!==undefined?[this.target]:this.layers;return layers.filter((layer=>layer.loaded))}createDefaultGroup(){const target=this.target??this.loadedLayers[0];let expressionGroup=new analysisExpressionGroup2.ExpressionGroup(target,"and");if(this.selectedExpressionType==="group"){expressionGroup=expressionGroup.addNewGroup("and")}else if(this.selectedExpressionType==="spatial"){expressionGroup=expressionGroup.addDefaultSpatialExpression(target,this.loadedLayers)}else{expressionGroup=expressionGroup.addDefaultExpression(this.options)}return expressionGroup}render(){return index.h("calcite-modal",{open:this.open,escapeDisabled:true,outsideCloseDisabled:true,ref:ref=>this.containerRef=ref,onCalciteModalClose:this.onClose},index.h("div",{slot:"header"},this.strings.header),index.h("div",{slot:"content"},this.isOnboarding?this.renderOnboardingContent():this.renderQueryBuilder()),index.h("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onClick:this.close},this.strings.cancel),index.h("calcite-button",{slot:"primary",width:"full",onClick:this.isOnboarding?this.onOnboardingNextClick:this.onAddClick},this.isOnboarding?this.strings.next:this.strings.add))}renderOnboardingContent(){const uniqueLayerIds=new Set(this.layers.map(utils.formatLayerUrlAndId));const showTileHTMLClass=this.mode!=="sql"?HTMLClasses.tileSelectThirdWidth:"";return index.h(index.Fragment,null,index.h("analysis-query-target-select",{target:this.target,layers:this.loadedLayers,onAnalysisQueryTargetSelectChange:this.onTargetChange,recordsTerm:this.recordsTerm,disabled:this.mode==="sql"}),index.h("calcite-tile-select-group",{class:HTMLClasses.tileSelectGroup},index.h("calcite-tile-select",{class:showTileHTMLClass,heading:this.getString(this.strings.attributeExpressionTitle,this.strings.expressionTitle),description:this.getString(this.strings.attributeExpressionDescription,this.strings.expressionDescription),checked:this.selectedExpressionType==="attribute"?true:undefined,icon:"list-check",value:"attribute",inputEnabled:true,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),this.mode!=="sql"&&index.h(index.Fragment,null,index.h("calcite-tile-select",{class:showTileHTMLClass,ref:element=>{if(element){this.spatialExpressionTile=element}},heading:this.strings.spatialExpressionTitle,description:this.strings.spatialExpressionDescription,checked:this.selectedExpressionType==="spatial"?true:undefined,icon:"geographic-link-chart-layout",value:"spatial",disabled:uniqueLayerIds.size>1===false,inputEnabled:true,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),uniqueLayerIds.size>1===false&&index.h("calcite-tooltip",{label:this.strings.spatialExpressionTwoLayers,referenceElement:this.spatialExpressionTile,ref:element=>this.tooltipRef=element,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),index.h("calcite-tile-select",{class:showTileHTMLClass,heading:this.strings.expressionGroupTitle,description:this.strings.expressionGroupDescription,checked:this.selectedExpressionType==="group"?true:undefined,icon:"group-form-plus",value:"group",inputEnabled:true,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType})))}renderQueryBuilder(){return index.h("analysis-query-builder",{expressionGroup:this.expressionGroup,layers:this.loadedLayers,mode:this.mode,recordsTerm:this.recordsTerm,onAnalysisQueryChange:this.onQueryChange,onAnalysisQueryError:this.onQueryError,options:this.options})}getString(featureTerm,recordTerm){return this.recordsTerm==="features"?featureTerm:recordTerm}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return analysisQueryModalCss}},[0,"analysis-query-modal",{value:[1025],mode:[513],expressionGroup:[16],target:[1040],layers:[16],open:[4],recordsTerm:[513,"records-term"],options:[16],selectedExpressionType:[32],isOnboarding:[32]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-query-modal","analysis-attribute-expression","analysis-expression-group","analysis-query-builder","analysis-query-entry","analysis-query-target-select","analysis-spatial-expression"];components.forEach((tagName=>{switch(tagName){case"analysis-query-modal":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisQueryModal)}break;case"analysis-attribute-expression":if(!customElements.get(tagName)){analysisAttributeExpression2.defineCustomElement()}break;case"analysis-expression-group":if(!customElements.get(tagName)){analysisExpressionGroup2.defineCustomElement()}break;case"analysis-query-builder":if(!customElements.get(tagName)){analysisQueryBuilder2.defineCustomElement()}break;case"analysis-query-entry":if(!customElements.get(tagName)){analysisQueryEntry2.defineCustomElement()}break;case"analysis-query-target-select":if(!customElements.get(tagName)){analysisQueryTargetSelect2.defineCustomElement()}break;case"analysis-spatial-expression":if(!customElements.get(tagName)){analysisSpatialExpression2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisQueryModal=AnalysisQueryModal;exports.defineCustomElement=defineCustomElement}));
