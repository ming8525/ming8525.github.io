define(["exports","./index-ef555910","./index2-588b02d9","./utils-793221d4","./analysis-item-browser2-508c9cf3","./analysis-item-input2-3709ada5","./analysis-label2-f17c360a"],(function(e,t,i,s,l,a,n){"use strict";const o="half-margin-bot",r="width-100",h="secondary-button",d=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisDataFileInputChange=t.createEvent(this,"analysisDataFileInputChange",7),this.analysisHelpClick=t.createEvent(this,"analysisHelpClick",7),this.renderInitial=()=>{const e=void 0!==this.value&&"portalItemID"in this.value?{itemId:this.value.portalItemID}:void 0,s=this.accept?.map((e=>`.${e}`)).join(",");return t.h(t.Fragment,null,t.h("div",{class:"flex-container"},"item"===this.browseOption?t.h("analysis-item-input",{class:"primary-button",hidden:this.urlSelected||void 0!==this.selectedFile,q:'((typekeywords:"Document" OR type:"Image" OR type:"Layout" OR type:"Desktop Style" OR type:"Project Template" OR type:"Report Template" OR type:"Pro Report" OR type:"Statistical Data Collection" OR type:"360 VR Experience" OR type:"netCDF" OR type:"PDF" OR type:"CSV" OR type:"Administrative Report" OR type:"Raster function template") -type:("Image Service" OR "Explorer Document" OR "Explorer Map" OR "Globe Document" OR "Scene Document"))',label:"",replaceTooltipText:this.strings.replaceData,selectButtonLabel:this.strings.addData,selectedItemIcon:"file",value:e,onAnalysisItemInputChange:this.handleAnalysisItemInputChange,portal:this.portal,user:this.portal?.user}):t.h("div",null,"Placeholder"),t.h("calcite-button",{"data-tooltip-id":"upload",class:`${h} ${o}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile,appearance:"outline","icon-start":"upload-to",kind:"neutral",scale:i.UIDefaults.Scale,label:this.strings.file,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:e=>{this.hiddenFileInput?.click(),e.preventDefault()}}),t.h("calcite-button",{"data-tooltip-id":"url",class:`${h} ${o}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile,appearance:"outline","icon-start":"link",kind:"neutral",scale:i.UIDefaults.Scale,label:this.strings.url,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:this.handleUrlClick}),this.urlSelected&&this.renderUrlInput(),void 0!==this.selectedFile&&this.renderFileSelected(),t.h("input",{accept:s,hidden:!0,type:"file",onInput:this.handleFileInputChange,ref:e=>this.hiddenFileInput=e})),this.renderInputMessage())},this.renderUrlInput=()=>t.h("calcite-input-text",{class:r,value:this.value?.url,scale:i.UIDefaults.Scale,onCalciteInputTextChange:this.handleUrlInputChange},t.h("calcite-action",{slot:"action",icon:"x",scale:i.UIDefaults.Scale,text:this.strings.clear,onClick:this.resetToInitial})),this.renderFileSelected=()=>{const e=this.selectedFile?.itemName;return t.h("calcite-list",{class:r,loading:this.fileUploading},t.h("calcite-list-item",{"data-tooltip-id":"replace",class:"list-item--border",label:e,onCalciteListItemSelect:e=>{this.hiddenFileInput?.click(),e.preventDefault()},onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip},t.h("calcite-icon",{icon:"file",slot:"content-start"}),t.h("calcite-action",{text:this.strings.clear,slot:"actions-end",label:this.strings.clear,appearance:"transparent",icon:"x",onClick:this.resetToInitial,onMouseOver:this.removeTooltip})))},this.renderInputMessage=()=>void 0!==this.errorMessage&&t.h("calcite-input-message",{status:i.UIInputStatus.INVALID,scale:i.UIDefaults.Scale,icon:"exclamationMarkTriangle"},this.errorMessage),this.handleAnalysisItemInputChange=e=>{const t=e.target.selectedItem;void 0!==t?(this.value={portalItemID:t.id},this.itemSelected=!0,this.validate(),this.analysisDataFileInputChange.emit()):this.resetToInitial()},this.handleFileInputChange=async()=>{if(0!==this.hiddenFileInput?.files?.length&&(this.selectedFile={itemName:this.hiddenFileInput?.files?.[0].name??""},void 0!==this.abortController&&this.abortController.abort(),void 0!==this.serviceUrl)){this.errorMessage=void 0,this.fileUploading=!0;try{this.abortController=new AbortController;const e=new FormData;e.append("file",this.hiddenFileInput?.files?.[0]),e.append("f","json");const t=this.apiUrls.upload,s=await i.request(t,{body:e,method:"post",responseType:"json",signal:this.abortController.signal});this.selectedFile=s.data.item,this.value={itemID:s.data.item.itemID},this.fileUploading=!1,this.validate(),this.analysisDataFileInputChange.emit()}catch(e){console.error(e),this.errorMessage=this.strings.uploadFailureMsg,this.selectedFile=void 0,this.fileUploading=!1}}},this.handleUrlClick=()=>{this.urlSelected=!0},this.handleUrlInputChange=e=>{const t=e.target.value;this.value={url:t},this.validate(),this.analysisDataFileInputChange.emit()},this.resetToInitial=()=>{if(void 0!==this.value&&"itemID"in this.value){const e=this.apiUrls.delete,t=new FormData;t.append("itemIds",this.value.itemID),t.append("f","json"),i.request(e,{body:t,method:"post"}).catch((()=>{}))}this.value=void 0,this.selectedFile=void 0,this.urlSelected=!1,this.itemSelected=!1,this.validate(),this.analysisDataFileInputChange.emit()},this.addTooltip=e=>{const t=e.target,i=t?.getAttribute("data-tooltip-id");switch(void 0===this.tooltipElement&&(this.tooltipElement=document.createElement("calcite-tooltip"),this.tooltipElement.placement="bottom"),i){case"upload":this.tooltipElement.innerText=this.strings.uploadData,this.tooltipElement.offsetDistance=14;break;case"url":this.tooltipElement.innerText=this.strings.AddDataFromUrl,this.tooltipElement.offsetDistance=14;break;case"replace":this.tooltipElement.innerText=this.strings.replaceData;break;default:return void(this.tooltipElement=void 0)}this.tooltipElement.referenceElement=t,s.addOpenableDomElement(document,this.tooltipElement)},this.removeTooltip=()=>{s.removeOpenableDomElement(this.tooltipElement)},this.validate=()=>{let e;void 0===this.value||"url"in this.value&&""===this.value.url?e=!0===this.required&&i.isEmptyDataItem(this.value)?this.strings.required:void 0:"url"in this.value&&(e=s.isValidProtocol(this.value.url)&&s.isValidFileExtension(this.value.url,this.accept)?void 0:e??this.strings.invalidUrl),this.errorMessage=e},this.value=void 0,this.label=void 0,this.required=void 0,this.selectionMode=void 0,this.accept=void 0,this.hideUpload=!1,this.serviceUrl=void 0,this.browseOption="item",this.portal=void 0,this.selectedFile=void 0,this.itemSelected=!1,this.urlSelected=!1,this.fileUploading=!1,this.errorMessage=void 0}get apiUrls(){return{delete:`${this.serviceUrl}/uploads/deleteItems`,upload:`${this.serviceUrl}/uploads/upload`}}async onValueChange(e){if(void 0!==e)if("url"in e)this.urlSelected=!0;else if("itemID"in e&&e.itemID!==this.selectedFile?.itemID)try{void 0!==this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const t=await i.request(`${this.serviceUrl}/uploads/${e.itemID}?f=json`,{signal:this.abortController.signal});this.selectedFile=t.data}catch(e){console.error(e),this.errorMessage=this.strings.fileNotFound}else"portalItemID"in e&&(this.itemSelected=!0)}async componentWillLoad(){({strings:this.strings}=await i.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),this.onValueChange(this.value)}disconnectedCallback(){this.abortController?.abort()}async checkValidity(){return this.validate(),Promise.resolve(void 0===this.errorMessage)}render(){return t.h(t.Host,null,!1===i.isEmptyDataItem(this.label)&&t.h("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.renderInitial())}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{value:["onValueChange"]}}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{width:100%}.half-margin-bot{margin-bottom:var(--analysis-half-spacing)}.width-100{width:100%}.primary-button{flex-grow:1}.secondary-button{flex-grow:0;height:1rem}.flex-container{display:flex;gap:0.33rem}.list-item--border{border:1px solid var(--analysis-ui-border-input);box-shadow:none}"}},[1,"analysis-data-file-input",{value:[1040],label:[513],required:[516],selectionMode:[513,"selection-mode"],accept:[16],hideUpload:[4,"hide-upload"],serviceUrl:[1,"service-url"],browseOption:[1,"browse-option"],portal:[16],selectedFile:[32],itemSelected:[32],urlSelected:[32],fileUploading:[32],errorMessage:[32],checkValidity:[64]},void 0,{value:["onValueChange"]}]);function c(){"undefined"!=typeof customElements&&["analysis-data-file-input","analysis-item-browser","analysis-item-input","analysis-label"].forEach((e=>{switch(e){case"analysis-data-file-input":customElements.get(e)||customElements.define(e,d);break;case"analysis-item-browser":customElements.get(e)||l.defineCustomElement();break;case"analysis-item-input":customElements.get(e)||a.defineCustomElement();break;case"analysis-label":customElements.get(e)||n.defineCustomElement()}}))}c(),e.AnalysisDataFileInput=d,e.defineCustomElement=c}));