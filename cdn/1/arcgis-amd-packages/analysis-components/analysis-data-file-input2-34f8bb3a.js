define(["exports","./index-ef555910","./index2-588b02d9","./utils-793221d4","./analysis-item-browser2-508c9cf3","./analysis-item-input2-3709ada5","./analysis-label2-f17c360a"],(function(exports,index,index2,utils,analysisItemBrowser2,analysisItemInput2,analysisLabel2){"use strict";const HTMLClasses={controlMargin:"half-margin-bot",width100:"width-100",flexContainer:"flex-container",primaryButton:"primary-button",secondaryButton:"secondary-button",listItemBorder:"list-item--border"};const PortalFileItemsQuery=`((typekeywords:"Document" OR type:"Image" OR type:"Layout" OR type:"Desktop Style" OR type:"Project Template" OR type:"Report Template" OR type:"Pro Report" OR type:"Statistical Data Collection" OR type:"360 VR Experience" OR type:"netCDF" OR type:"PDF" OR type:"CSV" OR type:"Administrative Report" OR type:"Raster function template") -type:("Image Service" OR "Explorer Document" OR "Explorer Map" OR "Globe Document" OR "Scene Document"))`;const analysisDataFileInputCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{width:100%}.half-margin-bot{margin-bottom:var(--analysis-half-spacing)}.width-100{width:100%}.primary-button{flex-grow:1}.secondary-button{flex-grow:0;height:1rem}.flex-container{display:flex;gap:0.33rem}.list-item--border{border:1px solid var(--analysis-ui-border-input);box-shadow:none}";const AnalysisDataFileInput=index.proxyCustomElement(class AnalysisDataFileInput extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisDataFileInputChange=index.createEvent(this,"analysisDataFileInputChange",7);this.analysisHelpClick=index.createEvent(this,"analysisHelpClick",7);this.renderInitial=()=>{const itemId=this.value!==undefined&&"portalItemID"in this.value?{itemId:this.value.portalItemID}:undefined;const accept=this.accept?.map((extension=>`.${extension}`)).join(",");return index.h(index.Fragment,null,index.h("div",{class:HTMLClasses.flexContainer},this.browseOption==="item"?index.h("analysis-item-input",{class:HTMLClasses.primaryButton,hidden:this.urlSelected||this.selectedFile!==undefined,q:PortalFileItemsQuery,label:"",replaceTooltipText:this.strings.replaceData,selectButtonLabel:this.strings.addData,selectedItemIcon:"file",value:itemId,onAnalysisItemInputChange:this.handleAnalysisItemInputChange,portal:this.portal,user:this.portal?.user}):index.h("div",null,"Placeholder"),index.h("calcite-button",{"data-tooltip-id":"upload",class:`${HTMLClasses.secondaryButton} ${HTMLClasses.controlMargin}`,hidden:this.itemSelected||this.urlSelected||this.selectedFile!==undefined,appearance:"outline","icon-start":"upload-to",kind:"neutral",scale:index2.UIDefaults.Scale,label:this.strings.file,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:event=>{this.hiddenFileInput?.click();event.preventDefault()}}),index.h("calcite-button",{"data-tooltip-id":"url",class:`${HTMLClasses.secondaryButton} ${HTMLClasses.controlMargin}`,hidden:this.itemSelected||this.urlSelected||this.selectedFile!==undefined,appearance:"outline","icon-start":"link",kind:"neutral",scale:index2.UIDefaults.Scale,label:this.strings.url,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:this.handleUrlClick}),this.urlSelected&&this.renderUrlInput(),this.selectedFile!==undefined&&this.renderFileSelected(),index.h("input",{accept,hidden:true,type:"file",onInput:this.handleFileInputChange,ref:el=>this.hiddenFileInput=el})),this.renderInputMessage())};this.renderUrlInput=()=>index.h("calcite-input-text",{class:HTMLClasses.width100,value:this.value?.url,scale:index2.UIDefaults.Scale,onCalciteInputTextChange:this.handleUrlInputChange},index.h("calcite-action",{slot:"action",icon:"x",scale:index2.UIDefaults.Scale,text:this.strings.clear,onClick:this.resetToInitial}));this.renderFileSelected=()=>{const fileName=this.selectedFile?.itemName;return index.h("calcite-list",{class:HTMLClasses.width100,loading:this.fileUploading},index.h("calcite-list-item",{"data-tooltip-id":"replace",class:HTMLClasses.listItemBorder,label:fileName,onCalciteListItemSelect:event=>{this.hiddenFileInput?.click();event.preventDefault()},onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip},index.h("calcite-icon",{icon:"file",slot:"content-start"}),index.h("calcite-action",{text:this.strings.clear,slot:"actions-end",label:this.strings.clear,appearance:"transparent",icon:"x",onClick:this.resetToInitial,onMouseOver:this.removeTooltip})))};this.renderInputMessage=()=>this.errorMessage!==undefined&&index.h("calcite-input-message",{status:index2.UIInputStatus.INVALID,scale:index2.UIDefaults.Scale,icon:"exclamationMarkTriangle"},this.errorMessage);this.handleAnalysisItemInputChange=e=>{const selectedItem=e.target.selectedItem;if(selectedItem!==undefined){this.value={portalItemID:selectedItem.id};this.itemSelected=true;this.validate();this.analysisDataFileInputChange.emit()}else{this.resetToInitial()}};this.handleFileInputChange=async()=>{if(this.hiddenFileInput?.files?.length===0)return;this.selectedFile={itemName:this.hiddenFileInput?.files?.[0].name??""};if(this.abortController!==undefined){this.abortController.abort()}if(this.serviceUrl!==undefined){this.errorMessage=undefined;this.fileUploading=true;try{this.abortController=new AbortController;const formData=new FormData;formData.append("file",this.hiddenFileInput?.files?.[0]);formData.append("f","json");const uploadUrl=this.apiUrls.upload;const uploadResult=await index2.request(uploadUrl,{body:formData,method:"post",responseType:"json",signal:this.abortController.signal});this.selectedFile=uploadResult.data.item;this.value={itemID:uploadResult.data.item.itemID};this.fileUploading=false;this.validate();this.analysisDataFileInputChange.emit()}catch(e){console.error(e);this.errorMessage=this.strings.uploadFailureMsg;this.selectedFile=undefined;this.fileUploading=false}}};this.handleUrlClick=()=>{this.urlSelected=true};this.handleUrlInputChange=e=>{const newValue=e.target.value;this.value={url:newValue};this.validate();this.analysisDataFileInputChange.emit()};this.resetToInitial=()=>{if(this.value!==undefined&&"itemID"in this.value){const deleteUrl=this.apiUrls.delete;const formData=new FormData;formData.append("itemIds",this.value.itemID);formData.append("f","json");index2.request(deleteUrl,{body:formData,method:"post"}).catch((()=>{}))}this.value=undefined;this.selectedFile=undefined;this.urlSelected=false;this.itemSelected=false;this.validate();this.analysisDataFileInputChange.emit()};this.addTooltip=event=>{const targetElement=event.target;const tooltipId=targetElement?.getAttribute("data-tooltip-id");if(this.tooltipElement===undefined){this.tooltipElement=document.createElement("calcite-tooltip");this.tooltipElement.placement="bottom"}switch(tooltipId){case"upload":this.tooltipElement.innerText=this.strings.uploadData;this.tooltipElement.offsetDistance=14;break;case"url":this.tooltipElement.innerText=this.strings.AddDataFromUrl;this.tooltipElement.offsetDistance=14;break;case"replace":this.tooltipElement.innerText=this.strings.replaceData;break;default:this.tooltipElement=undefined;return}this.tooltipElement.referenceElement=targetElement;utils.addOpenableDomElement(document,this.tooltipElement)};this.removeTooltip=()=>{utils.removeOpenableDomElement(this.tooltipElement)};this.validate=()=>{let errorMessage;if(this.value===undefined||"url"in this.value&&this.value.url===""){errorMessage=this.required===true&&index2.isEmptyDataItem(this.value)?this.strings.required:undefined}else if("url"in this.value){errorMessage=utils.isValidProtocol(this.value.url)&&utils.isValidFileExtension(this.value.url,this.accept)?undefined:errorMessage??this.strings.invalidUrl}this.errorMessage=errorMessage};this.value=undefined;this.label=undefined;this.required=undefined;this.selectionMode=undefined;this.accept=undefined;this.hideUpload=false;this.serviceUrl=undefined;this.browseOption="item";this.portal=undefined;this.selectedFile=undefined;this.itemSelected=false;this.urlSelected=false;this.fileUploading=false;this.errorMessage=undefined}get apiUrls(){return{delete:`${this.serviceUrl}/uploads/deleteItems`,upload:`${this.serviceUrl}/uploads/upload`}}async onValueChange(newValue){if(newValue!==undefined){if("url"in newValue){this.urlSelected=true}else if("itemID"in newValue&&newValue.itemID!==this.selectedFile?.itemID){try{if(this.abortController!==undefined){this.abortController.abort()}this.abortController=new AbortController;const response=await index2.request(`${this.serviceUrl}/uploads/${newValue.itemID}?f=json`,{signal:this.abortController.signal});this.selectedFile=response.data}catch(e){console.error(e);this.errorMessage=this.strings.fileNotFound}}else if("portalItemID"in newValue){this.itemSelected=true}}}async componentWillLoad(){({strings:this.strings}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)));this.onValueChange(this.value)}disconnectedCallback(){this.abortController?.abort()}async checkValidity(){this.validate();return Promise.resolve(this.errorMessage===undefined)}render(){return index.h(index.Host,null,index2.isEmptyDataItem(this.label)===false&&index.h("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.renderInitial())}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{value:["onValueChange"]}}static get style(){return analysisDataFileInputCss}},[1,"analysis-data-file-input",{value:[1040],label:[513],required:[516],selectionMode:[513,"selection-mode"],accept:[16],hideUpload:[4,"hide-upload"],serviceUrl:[1,"service-url"],browseOption:[1,"browse-option"],portal:[16],selectedFile:[32],itemSelected:[32],urlSelected:[32],fileUploading:[32],errorMessage:[32],checkValidity:[64]},undefined,{value:["onValueChange"]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-data-file-input","analysis-item-browser","analysis-item-input","analysis-label"];components.forEach((tagName=>{switch(tagName){case"analysis-data-file-input":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisDataFileInput)}break;case"analysis-item-browser":if(!customElements.get(tagName)){analysisItemBrowser2.defineCustomElement()}break;case"analysis-item-input":if(!customElements.get(tagName)){analysisItemInput2.defineCustomElement()}break;case"analysis-label":if(!customElements.get(tagName)){analysisLabel2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisDataFileInput=AnalysisDataFileInput;exports.defineCustomElement=defineCustomElement}));
