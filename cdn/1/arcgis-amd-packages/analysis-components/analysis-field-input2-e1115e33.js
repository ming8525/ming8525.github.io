define(["exports","./index-ef555910","./index2-588b02d9","./analysis-field-select2-eb77dd22","./analysis-label2-f17c360a"],(function(exports,index,index2,analysisFieldSelect2,analysisLabel2){"use strict";const HTMLClasses={analysisPopover:"analysis-popover"};const analysisFieldInputCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing)}";const AnalysisFieldInput=index.proxyCustomElement(class AnalysisFieldInput extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisFieldInputChange=index.createEvent(this,"analysisFieldInputChange",7);this.analysisHelpClick=index.createEvent(this,"analysisHelpClick",7);this.filterOutGeometryFields=fields=>{let filteredFields=fields;if(this.mapLayer!==undefined){filteredFields=fields.filter((field=>[this.mapLayer?.geometryFieldsInfo?.shapeAreaField,this.mapLayer?.geometryFieldsInfo?.shapeLengthField].includes(field.name)===false))}return filteredFields};this.setupPopover=()=>{this.fieldPickListElement=document.createElement("arcgis-field-pick-list");this.fieldPickListElement.className=HTMLClasses.analysisPopover;this.fieldPickListElement.layer=this.mapLayer;this.fieldPickListElement.mapView=this.mapView;this.fieldPickListElement.showDescription=true;this.fieldPickListElement.showFieldName=!this.hideFieldNames;this.fieldPickListElement.dir=this.dir;this.fieldPickListElement.showFieldInfo=this.analysisDataset!==undefined?false:this.showFieldInfo;this.fieldPickListElement.fields=this.filteredPickListFields;if(!this.isMultiSelect){this.fieldPickListElement.heading=this.strings.selectFieldPicklistHeading;this.fieldPickListElement.okBtnText=this.strings.selectOkBtnText}this.fieldPickListElement.showSort=this.showSort;this.fieldPickListElement.heading=this.heading??this.fieldPickListElement.heading;this.fieldPickListElement.filterPlaceholderText=this.filterPlaceholderText;if(this.value!==undefined){this.fieldPickListElement.selectedFields=this.isMultiSelect?this.value:[this.value]}else if(this.isMultiSelect){this.fieldPickListElement.selectedFields=[]}this.fieldPickListElement.multiple=this.isMultiSelect;this.fieldPickListElement.showSelectionAll=true;this.fieldPickListElement.addEventListener("arcgisFieldPickListDismissed",this.arcgisFieldPickListDismissed);this.fieldPickListElement.popoverProps={refElement:this.fieldSelectElement,autoClose:true,popoverWidth:300}};this.arcgisFieldPickListDismissed=event=>{if(event.detail!==null){this.value=this.isMultiSelect?event.detail.selectedFields:event.detail.selectedFields[0];this.analysisFieldInputChange.emit()}this.closeFieldPickList()};this.onAnalysisFieldRemoved=event=>{if(this.value instanceof Array){this.value=this.value.filter((v=>v!==event.detail.value))}else{this.value=undefined}this.validate();this.analysisFieldInputChange.emit()};this.addPopover=()=>{if(this.fieldPickListElement!==undefined){document.body.appendChild(this.fieldPickListElement)}};this.closePopover=()=>{this.fieldPickListElement?.remove();this.fieldPickListElement=undefined};this.openFieldPickList=()=>{this.closeFieldPickList();this.setupPopover();this.addPopover()};this.closeFieldPickList=()=>{if(this.fieldPickListElement!==undefined){this.closePopover();this.validate()}};this.validate=()=>{let errorMessage;if(this.required){errorMessage=index2.isEmptyDataItem(this.value)===true?index2.formatMessage(this.strings.requiredErrorMessage,{label:this.label??this.strings.requiredErrorLabelDefault}):errorMessage}this.errorMessage=errorMessage};this.errorMessage=undefined;this.pickListFields=[];this.loading=false;this.label=undefined;this.required=false;this.readOnly=false;this.mapLayer=undefined;this.analysisDataset=undefined;this.fieldTypes=undefined;this.mapView=undefined;this.showFieldInfo=true;this.selectionMode=undefined;this.usePopupTemplatesInfo=true;this.useValueLabel=false;this.value=undefined;this.selectedFields=undefined;this.placeholderText=undefined;this.showSort=true;this.heading=undefined;this.filterPlaceholderText=undefined;this.hideFieldNames=false;this.useDefaultValue=false;this.allowGeometryFields=false}onReadOnlyChange(){this.readOnly??(this.readOnly=false)}syncSelectedFieldsWithPickListFields(){this.syncSelectedFieldsWithValue();this.analysisFieldInputChange.emit()}syncSelectedFieldsWithValue(){const newValue=this.value;if(Array.isArray(newValue)){const selectedNames=new Set(newValue);this.selectedFields=this.pickListFields.filter((field=>selectedNames.has(field.name)))}else if(newValue!==undefined){this.selectedFields=this.pickListFields.find((field=>field.name===newValue))}}async updatePickListFieldsFromLayer(){await this.loadPickListFieldsFromLayer();this.maybeResetValue()}async updatePickListFieldsFromDataset(){await this.loadPickListFieldsFromDataset();this.maybeResetValue()}get filteredPickListFields(){const fieldTypeSet=new Set(this.fieldTypes);const fields=this.allowGeometryFields===false?this.filterOutGeometryFields(this.pickListFields):this.pickListFields;return fieldTypeSet.size===0?fields:fields.filter((field=>fieldTypeSet.has(field.type)))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)));if(this.mapLayer!==undefined){this.loadPickListFieldsFromLayer()}else if(this.analysisDataset!==undefined){this.loadPickListFieldsFromDataset().then((()=>{if((this.errorMessage===undefined||this.errorMessage==="")&&this.abortController?.signal.aborted!==true){this.maybeResetValue()}}))}}disconnectedCallback(){this.fieldPickListElement?.remove()}async checkValidity(){this.validate();const validity=this.errorMessage===undefined||this.errorMessage==="";return Promise.resolve(validity)}maybeResetValue(){const fieldOptions=this.filteredPickListFields??[];const fieldNames=new Set(fieldOptions.map((option=>option.name)));this.errorMessage=undefined;let shouldReset=true;if(this.isMultiSelect&&Array.isArray(this.value)){const tempValueArr=this.value.filter((fieldName=>fieldNames.has(fieldName)));if(tempValueArr.length!==0){this.value=tempValueArr;this.validate();this.analysisFieldInputChange.emit();shouldReset=false}}else{shouldReset=!fieldNames.has(this.value)}if(shouldReset===true&&this.readOnly===false){if(this.useDefaultValue&&fieldOptions.length>0){this.value=this.isMultiSelect?[fieldOptions[0].name]:fieldOptions[0].name;this.validate();this.analysisFieldInputChange.emit()}else if(this.value!==undefined){this.value=undefined;this.validate();this.analysisFieldInputChange.emit()}}}get isMultiSelect(){return this.selectionMode==="multi"}async loadPickListFieldsFromDataset(){if(this.abortController!==undefined){this.abortController.abort()}if(this.analysisDataset!==undefined){this.loading=true;try{this.abortController=new AbortController;this.pickListFields=await this.analysisDataset.getFields({signal:this.abortController.signal})}catch(error){if(index2.wasAborted(error)===false){this.errorMessage=this.strings.fieldLoadingErrorText}}this.loading=false}else{this.pickListFields=[]}}async loadPickListFieldsFromLayer(){if(this.mapLayer!==undefined){try{this.pickListFields=await index2.fetchLayerFieldsInfo(this.mapLayer,this.usePopupTemplatesInfo)}catch(e){this.errorMessage=this.strings.fieldLoadingErrorText}}else{this.pickListFields=[]}}render(){return index.h(index.Host,null,index.h("analysis-field-select",{errorMessage:this.errorMessage,value:index2.isEmptyDataItem(this.value)===true?undefined:this.value,label:this.label,ref:e=>{this.fieldSelectElement=e},fields:this.pickListFields,useValueLabel:this.useValueLabel,selectionMode:this.selectionMode,onAnalysisSelectFieldClick:this.openFieldPickList,onAnalysisFieldRemove:this.onAnalysisFieldRemoved,placeholderText:this.placeholderText,required:this.required,readOnly:this.readOnly,loading:this.loading}))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}}static get style(){return analysisFieldInputCss}},[1,"analysis-field-input",{label:[513],required:[516],readOnly:[516,"read-only"],mapLayer:[16],analysisDataset:[16],fieldTypes:[16],mapView:[16],showFieldInfo:[4,"show-field-info"],selectionMode:[513,"selection-mode"],usePopupTemplatesInfo:[516,"use-popup-templates-info"],useValueLabel:[516,"use-value-label"],value:[1025],selectedFields:[1040],placeholderText:[513,"placeholder-text"],showSort:[516,"show-sort"],heading:[513],filterPlaceholderText:[513,"filter-placeholder-text"],hideFieldNames:[516,"hide-field-names"],useDefaultValue:[516,"use-default-value"],allowGeometryFields:[516,"allow-geometry-fields"],errorMessage:[32],pickListFields:[32],loading:[32],checkValidity:[64]},undefined,{readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-field-input","analysis-field-select","analysis-label"];components.forEach((tagName=>{switch(tagName){case"analysis-field-input":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisFieldInput)}break;case"analysis-field-select":if(!customElements.get(tagName)){analysisFieldSelect2.defineCustomElement()}break;case"analysis-label":if(!customElements.get(tagName)){analysisLabel2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisFieldInput=AnalysisFieldInput;exports.defineCustomElement=defineCustomElement}));
