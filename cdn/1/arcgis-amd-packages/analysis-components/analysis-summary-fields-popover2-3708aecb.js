define(["exports","./index-ef555910","./index2-588b02d9","./utils-793221d4"],(function(exports,index,index2,utils){"use strict";const HTMLClasses={analysisPopover:"analysis-popover",popoverContent:"popover-content",jsAppFlyout:"js-app-flyout",toggleSelectAllButton:"toggle-select-all-button",rtl:"analysis--rtl",fieldsMessage:"fields-message"};const analysisSummaryFieldsPopoverCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.toggle-select-all-button{margin:0;margin-left:var(--analysis-quarter-spacing);margin-bottom:var(--analysis-quarter-spacing)}.chip-group{margin:var(--analysis-quarter-spacing)}.fields-message{margin:var(--analysis-half-spacing)}:host(.analysis--rtl) .toggle-select-all-button{margin:0;margin-right:var(--analysis-quarter-spacing);margin-top:var(--analysis-quarter-spacing)}";const AnalysisSummaryFieldsPopover=index.proxyCustomElement(class AnalysisSummaryFieldsPopover extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisSummaryFieldSelectionDone=index.createEvent(this,"analysisSummaryFieldSelectionDone",6);this.analysisSummaryFieldPopoverClose=index.createEvent(this,"analysisSummaryFieldPopoverClose",7);this.hasEmptySearchResults=false;this.onSelectionDone=()=>{this.analysisSummaryFieldSelectionDone.emit(this.selection);this.open=false};this.onCalciteListChange=event=>{const selectionMap=event.detail;this.selection=new Set(selectionMap.keys())};this.handleSelectAllClick=()=>{if(this.showSelectAllString){this.selection=new Set(this.fields?.map((field=>field.name)))}else{this.selection=new Set}};this.handleCalciteListFilterChange=event=>{const calciteFilter=event.target;this.hasEmptySearchResults=calciteFilter.filteredData.length===0;this.searchString=calciteFilter.filterText};this.renderMessages=()=>{const{noInputSelected,noFieldsAvailable,noSearchResults}=this.strings;const noInputSelectedMessage=index2.isEmptyDataItem(this.layer)===true&&index.h("calcite-label",{class:HTMLClasses.fieldsMessage},this.noLayersText??index2.formatMessage(this.layerInputLocalizedLabel!==undefined?noInputSelected.withLayerInputLabel:noInputSelected.withoutLayerInputLabel,{layerInputLabel:this.layerInputLocalizedLabel}));const availableFieldsMessage=index2.isEmptyDataItem(this.layer)===false&&this.fields?.length===0&&index.h("calcite-label",{class:HTMLClasses.fieldsMessage},this.noFieldsText??index2.formatMessage(noFieldsAvailable,{layerName:this.layer?.title}));const noSearchResultsMessage=this.noSearchResults&&index.h("calcite-label",{class:HTMLClasses.fieldsMessage},index2.formatMessage(noSearchResults,{searchValue:this.searchString}));return index.h("div",null,noInputSelectedMessage,availableFieldsMessage,noSearchResultsMessage)};this.renderFields=()=>index.h("calcite-pick-list",{class:HTMLClasses.popoverContent,multiple:true,onCalciteListChange:this.onCalciteListChange,filterEnabled:true,onCalciteListFilter:this.handleCalciteListFilterChange},this.shouldDisplaySelectAllButton&&index.h("calcite-button",{class:HTMLClasses.toggleSelectAllButton,appearance:"transparent",round:true,onClick:this.handleSelectAllClick,scale:utils.UIDefaults.Scale},this.showSelectAllString?this.strings.selectAll:this.strings.deselectAll),this.fields?.map((field=>{const{name,alias,type,description}=field;return index.h("calcite-pick-list-item",{selected:this.selection.has(name),key:name,value:name,label:alias,description:this.showFieldDescription?description:`{${name}}`,"data-field-type":type})})),this.renderMessages());this.layer=undefined;this.layerInputLocalizedLabel=undefined;this.noFieldsText=undefined;this.noLayersText=undefined;this.showFieldDescription=false;this.usePopupTemplatesInfo=true;this.allowDateType=false;this.allowStringType=false;this.selection=new Set;this.referenceElement=undefined;this.open=undefined;this.showSelectAllString=true;this.searchString=undefined}async layerChange(){if(this.layer!==undefined){this.fields=await index2.fetchLayerFieldsInfo(this.layer,this.usePopupTemplatesInfo);this.fields=index2.filterFields({fields:this.fields,layer:this.layer,allowNumericType:true,allowOidType:false,allowDateType:this.allowDateType,allowStringType:this.allowStringType,allowBigIntType:true,allowGeometryFields:false})}else{this.fields=[]}}onSelectionChange(){this.showSelectAllString=this.selection.size!==this.fields?.length}get noSearchResults(){return this.searchString!==""&&this.hasEmptySearchResults}get shouldDisplaySelectAllButton(){return(this.fields?.length??0)>0&&!this.noSearchResults}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)));await this.layerChange();this.onSelectionChange()}componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>this.summaryFieldsPopover?.setFocus()))),1);setTimeout((()=>{this.summaryFieldsPopover?.reposition?.()}),utils.UIDefaults.PopoverTimer)}async reposition(){await(this.summaryFieldsPopover?.reposition?.())}render(){const width=this.referenceElement?.offsetWidth;return index.h(index.Host,{dir:this.dir,class:`${HTMLClasses.analysisPopover} ${HTMLClasses.jsAppFlyout} ${this.dir==="rtl"?HTMLClasses.rtl:""}`},index.h("calcite-popover",{style:{width:width!==undefined?`${width}px`:undefined},ref:e=>{this.summaryFieldsPopover=e},autoClose:true,label:this.strings.summaryFieldsPopover,referenceElement:this.referenceElement,placement:"trailing",closable:true,heading:this.strings.addField,open:this.open,focusTrapDisabled:true,onCalcitePopoverClose:()=>this.analysisSummaryFieldPopoverClose.emit()},index.h("calcite-panel",null,this.renderFields(),index.h("calcite-button",{slot:"footer",width:"full",name:"done",scale:"m",onClick:this.onSelectionDone},this.strings.done))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get watchers(){return{layer:["layerChange"],usePopupTemplatesInfo:["layerChange"],selection:["onSelectionChange"]}}static get style(){return analysisSummaryFieldsPopoverCss}},[1,"analysis-summary-fields-popover",{layer:[16],layerInputLocalizedLabel:[1,"layer-input-localized-label"],noFieldsText:[1,"no-fields-text"],noLayersText:[1,"no-layers-text"],showFieldDescription:[4,"show-field-description"],usePopupTemplatesInfo:[516,"use-popup-templates-info"],allowDateType:[516,"allow-date-type"],allowStringType:[516,"allow-string-type"],selection:[1040],referenceElement:[16],open:[1540],showSelectAllString:[32],searchString:[32],reposition:[64]},undefined,{layer:["layerChange"],usePopupTemplatesInfo:["layerChange"],selection:["onSelectionChange"]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-summary-fields-popover"];components.forEach((tagName=>{switch(tagName){case"analysis-summary-fields-popover":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisSummaryFieldsPopover)}break}}))}defineCustomElement();exports.AnalysisSummaryFieldsPopover=AnalysisSummaryFieldsPopover;exports.defineCustomElement=defineCustomElement}));
