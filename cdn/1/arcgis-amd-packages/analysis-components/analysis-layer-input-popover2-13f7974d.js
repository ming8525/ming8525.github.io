define(["exports","./index-ef555910","./index2-588b02d9","./analysis-item-browser2-508c9cf3","./_Uint8Array-190b1a5d","./_baseIsEqual-422e05a5","./isObject-072a0200","./get-4ace6219","./_baseGet-9bd467fe","./_MapCache-84d65af1","./identity-47e9f05a"],(function(exports,index,index2,analysisItemBrowser2,_Uint8Array,_baseIsEqual,isObject,get,_baseGet,_MapCache,identity){"use strict";var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new _Uint8Array.Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?_baseIsEqual.baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,customizer,stack):result)){return false}}}return true}function isStrictComparable(value){return value===value&&!isObject.isObject(value)}function getMatchData(object){var result=_Uint8Array.keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseHasIn(object,key){return object!=null&&key in Object(object)}function hasPath(object,path,hasFunc){path=_baseGet.castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=_baseGet.toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&_Uint8Array.isLength(length)&&_Uint8Array.isIndex(key,length)&&(_MapCache.isArray(object)||_Uint8Array.isArguments(object))}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(path,srcValue){if(_baseGet.isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(_baseGet.toKey(path),srcValue)}return function(object){var objValue=get.get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):_baseIsEqual.baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){return function(object){return _baseGet.baseGet(object,path)}}function property(path){return _baseGet.isKey(path)?baseProperty(_baseGet.toKey(path)):basePropertyDeep(path)}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity.identity}if(typeof value=="object"){return _MapCache.isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}var baseFor=createBaseFor();function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,_Uint8Array.keys)}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!_Uint8Array.isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}var baseEach=createBaseEach(baseForOwn);function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,(function(value,key,collection){setter(accumulator,value,iteratee(value),collection)}));return accumulator}function createAggregator(setter,initializer){return function(collection,iteratee){var func=_MapCache.isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,baseIteratee(iteratee),accumulator)}}var partition=createAggregator((function(result,value,key){result[key?0:1].push(value)}),(function(){return[[],[]]}));const HTMLClasses={analysisPopover:"analysis-popover",fab:"fab",jsAppFlyout:"js-app-flyout",popoverContent:"popover-content",halfMargin:"half-margin",picklistMessage:"pick-list-message"};const analysisLayerInputPopoverCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.fab{justify-content:center;padding:var(--analysis-half-spacing)}.half-margin{margin:var(--analysis-half-spacing)}.pick-list-message{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}";const AnalysisLayerInputPopover=index.proxyCustomElement(class AnalysisLayerInputPopover extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisLayerInputPopoverClose=index.createEvent(this,"analysisLayerInputPopoverClose",7);this.analysisLayerInputPopoverSelectionChange=index.createEvent(this,"analysisLayerInputPopoverSelectionChange",7);this.analysisLayerInputPopoverLayerBrowsed=index.createEvent(this,"analysisLayerInputPopoverLayerBrowsed",7);this.checkForMatchingLayer=()=>{this.calciteFilterSearchTerm=this.picklist?.filterText;this.noSearchedLayersMessageActive=this.picklist?.filteredItems?.length===0&&this.picklist?.filterText.length!==0};this.buildPickListItem=layer=>index.h("calcite-pick-list-item",{key:layer.id,value:layer.id,label:index2.getLayerLabel(layer),description:index2.isFeatureLayer(layer)?index2.isTableLayer(layer)?this.strings.table:this.strings[layer.geometryType]:"",selected:this.selectedLayerIds!==undefined&&this.selectedLayerIds.includes(layer.id),onClick:this.onPickListChange});this.openItemBrowser=()=>{this.itemBrowserElement?.remove();this.itemBrowserElement=document.createElement("analysis-item-browser");this.itemBrowserElement.header=this.strings.heading;this.itemBrowserElement.filter=this.itemBrowserFilter;this.itemBrowserElement.q=this.itemBrowserQ;this.itemBrowserElement.allowedGeometries=this.itemBrowserAllowedGeometries;this.itemBrowserElement.layerFilterType=this.layerFilterType;this.itemBrowserElement.portal=this.portal;this.itemBrowserElement.bucketOptions=this.bucketOptions;this.itemBrowserElement.user=this.user;this.itemBrowserElement.selectionMode=this.selectionMode!=="multi"?"single-sublayer":"multiple-sublayer";this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals);this.itemBrowserElement.addEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap);this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection);this.popoverElement.autoClose=false;this.popoverElement.hidden=true;document.body.appendChild(this.itemBrowserElement)};this.closeModals=()=>{this.popoverElement.autoClose=true;this.popoverElement.hidden=false;if(this.itemBrowserElement!==undefined){this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals);this.itemBrowserElement.removeEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap);this.itemBrowserElement.removeEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection);this.itemBrowserElement.remove();this.itemBrowserElement=undefined}};this.addLayersToMap=(map,layers)=>{const splitTablesLayers=partition(layers,(layer=>index2.isTableLayer(layer)));map.addMany(splitTablesLayers[1]);map.tables.addMany(splitTablesLayers[0])};this.handleItemBrowserAddToMap=e=>{this.addLayersToMap(this.mapView.map,e.detail);this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail);this.open=false};this.handleItemBrowserSelection=e=>{this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail);this.open=false};this.onPickListChange=async()=>{const selectedLayers=await(this.picklist?.getSelectedItems());this.analysisLayerInputPopoverSelectionChange.emit({selectedLayers});if(this.selectionMode!=="multi")this.open=false};this.mapLayers=undefined;this.analysisSessionLayers=[];this.hideBrowseButton=false;this.showNoticeMessage=false;this.noticeMessage=undefined;this.selectionMode=undefined;this.referenceElement=undefined;this.placement="auto";this.open=undefined;this.selectedLayerIds=undefined;this.popoverWidth=undefined;this.user=undefined;this.portal=undefined;this.mapView=undefined;this.itemBrowserAllowedGeometries=undefined;this.itemBrowserFilter="";this.itemBrowserQ="";this.layerFilterType=undefined;this.noSearchedLayersMessageActive=false;this.calciteFilterSearchTerm=undefined}get bucketOptions(){const options=["my","favorites","group","org","all"];if(!(this.portal.isPortal===true&&this.portal.sourceJSON.portalDeploymentType===index2.PortalDeploymentType.Kubernetes)){options.splice(4,0,"living atlas analysis")}return options}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(`.`)))}componentDidLoad(){this.focusTimeoutId=setTimeout((async()=>{await(this.picklist?.setFocus?.("filter"))}),index2.UIDefaults.PopoverTimer);setTimeout((()=>{this.popoverElement?.reposition?.()}),index2.UIDefaults.PopoverTimer)}disconnectedCallback(){if(typeof this.focusTimeoutId!=="undefined")clearTimeout(this.focusTimeoutId);this.closeModals()}async reposition(){await(this.popoverElement?.reposition?.())}render(){const width=this.popoverWidth??this.referenceElement?.getBoundingClientRect().width;const noMatchesFoundMessage=index2.formatMessage(this.strings.noMatchesFound,{searchTerm:this.calciteFilterSearchTerm??""});const noExistingLayers=this.analysisSessionLayers?.length===0&&this.mapLayers?.length===0;const hideBrowse=this.hideBrowseButton===true;return index.h(index.Host,{dir:this.dir,class:`${HTMLClasses.analysisPopover} ${HTMLClasses.jsAppFlyout}`},index.h("calcite-popover",{ref:el=>{this.popoverElement=el},style:{width:width!==undefined?`${width}px`:undefined},autoClose:true,closable:true,heading:this.strings.heading,referenceElement:this.referenceElement??"analysis-layer-input",placement:this.placement,open:this.open,label:"",focusTrapDisabled:true,onCalcitePopoverClose:()=>this.analysisLayerInputPopoverClose.emit()},index.h("calcite-panel",null,index.h("calcite-pick-list",{class:HTMLClasses.popoverContent,multiple:this.selectionMode==="multi",filterEnabled:true,ref:e=>{this.picklist=e},onCalciteListFilter:this.checkForMatchingLayer},index.h("calcite-notice",{open:this.showNoticeMessage,class:HTMLClasses.halfMargin,kind:"warning",scale:index2.UIDefaults.Scale},index.h("div",{slot:"message"},Array.from(new Set(this.noticeMessage))?.map((message=>index.h("p",{innerHTML:message}))))),this.noSearchedLayersMessageActive&&index.h("p",{class:HTMLClasses.picklistMessage},noMatchesFoundMessage),noExistingLayers&&this.noSearchedLayersMessageActive===false?index.h("p",{class:HTMLClasses.picklistMessage},this.strings.noCompatibleLayers):index.h("div",null,index.h("calcite-pick-list-group",{"group-title":this.strings.analysisSessionLayers,hidden:this.analysisSessionLayers?.length===0},(this.analysisSessionLayers??[]).map((layer=>this.buildPickListItem(layer)))),index.h("calcite-pick-list-group",{"group-title":this.strings.mapLayers,hidden:this.mapLayers?.length===0},(this.mapLayers??[]).map((layer=>this.buildPickListItem(layer)))))),!hideBrowse&&index.h("calcite-button",{slot:"footer-actions",appearance:"transparent",width:"full",onClick:this.openItemBrowser},this.strings.browseAnalysisLayers))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return analysisLayerInputPopoverCss}},[1,"analysis-layer-input-popover",{mapLayers:[16],analysisSessionLayers:[16],hideBrowseButton:[516,"hide-browse-button"],showNoticeMessage:[4,"show-notice-message"],noticeMessage:[16],selectionMode:[513,"selection-mode"],referenceElement:[16],placement:[513],open:[1540],selectedLayerIds:[16],popoverWidth:[514,"popover-width"],user:[16],portal:[16],mapView:[16],itemBrowserAllowedGeometries:[16],itemBrowserFilter:[513,"item-browser-filter"],itemBrowserQ:[513,"item-browser-q"],layerFilterType:[1,"layer-filter-type"],noSearchedLayersMessageActive:[32],calciteFilterSearchTerm:[32],reposition:[64]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-layer-input-popover","analysis-item-browser"];components.forEach((tagName=>{switch(tagName){case"analysis-layer-input-popover":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisLayerInputPopover)}break;case"analysis-item-browser":if(!customElements.get(tagName)){analysisItemBrowser2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisLayerInputPopover=AnalysisLayerInputPopover;exports.defineCustomElement=defineCustomElement;exports.hasIn=hasIn}));
