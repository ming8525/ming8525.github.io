define(["exports","./index-ef555910","./index2-588b02d9","./utils-793221d4","./analysis-tree2-21de4d9f","./isObject-072a0200","./isSymbol-765de845"],(function(exports,index,index2,utils,analysisTree2,isObject,isSymbol){"use strict";var reWhitespace=/\s/;function trimmedEndIndex(string){var index=string.length;while(index--&&reWhitespace.test(string.charAt(index))){}return index}var reTrimStart=/^\s+/;function baseTrim(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string}var NAN=0/0;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;function toNumber(value){if(typeof value=="number"){return value}if(isSymbol.isSymbol(value)){return NAN}if(isObject.isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject.isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}var now=function(){return isObject.root.Date.now()};var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max,nativeMin=Math.min;function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject.isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){clearTimeout(timerId);timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}const searchDebounceTimeout=250;const HTMLClasses={noMatchesFoundMessage:"no-matches-found-msg"};const analysisSpatialReferenceSelectorCss=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{overflow-y:hidden;display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input);height:var(--analysis-popover-content-height);min-width:20rem;max-width:27rem}.no-matches-found-msg{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}analysis-tree{flex:1}";const AnalysisSpatialReferenceSelector=index.proxyCustomElement(class AnalysisSpatialReferenceSelector extends index.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisSpatialReferenceValueChange=index.createEvent(this,"analysisSpatialReferenceValueChange",7);this.analysisSpatialReferenceSelectorDismissed=index.createEvent(this,"analysisSpatialReferenceSelectorDismissed",7);this.searchText="";this.performantFilterSpatialReferences=debounce((searchString=>{this.updateSearchResults(searchString)}),searchDebounceTimeout,{leading:false,trailing:true});this.defaultWkid=4326;this.value=undefined;this.hideCategories=undefined;this.searchResults=undefined}async getSRDescription(){if(this.value?.latestWkid!==undefined){return Promise.resolve(index2.getSpatialReferenceDescription(this.value?.latestWkid))}else{return Promise.resolve(undefined)}}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await index2.fetchComponentLocaleStrings(this.hostElement,index.getAssetPath(".")));this.value=this.value??{latestWkid:this.defaultWkid};const filteredSrCategories=this.filterSrCategories(index2.srCategories);this.visibleSrCategories=this.translateSrCategories(filteredSrCategories)}translateSrCategories(untranslatedSrCategories){const translatedSrCategories={};this.recursiveTranslate(untranslatedSrCategories,translatedSrCategories);return translatedSrCategories}recursiveTranslate(obj,translatedObj){Object.keys(obj).forEach((key=>{const translatedKey=this.getTranslatedKey(key);if(typeof obj[key]==="object"){translatedObj[translatedKey]={};this.recursiveTranslate(obj[key],translatedObj[translatedKey])}else{translatedObj[translatedKey]=obj[key]}}))}getTranslatedKey(key){return key in this.strings?this.strings[key]:key}filterSrCategories(obj){const filteredObj={};Object.keys(obj).forEach((key=>{if(this.hideCategories===undefined||this.hideCategories?.includes(key)===false){if(typeof obj[key]==="object"){filteredObj[key]=this.filterSrCategories(obj[key])}else{filteredObj[key]=obj[key]}}}));return filteredObj}setSpatialRef(wkid){this.value={latestWkid:Number(wkid)};this.analysisSpatialReferenceValueChange.emit(this.value)}inputKeyDown(event){if(event.key==="Enter"){this.selectFirstChild(true)}}selectFirstChild(autoFocus){const wkidContainer=this.treeElement;const firstChild=wkidContainer?.shadowRoot?.querySelector("calcite-tree-item:not([has-children]):not([data-key='placeholder'])")||undefined;if(wkidContainer!==undefined&&firstChild!==undefined){firstChild.selected=true;this.setSpatialRef(firstChild.dataset.key??"");if(autoFocus){firstChild.focus()}}}updateSearchResults(searchString){this.searchResults=index2.filterSpatialReferences(searchString)}searchSpatialReferences(event){if(event.target!==null){this.searchText=event.target.value??"";if(this.searchText.length>1){this.performantFilterSpatialReferences(this.searchText)}else{this.searchResults=undefined}}}render(){const noMatchesFoundMessage=index2.formatMessage(this.strings.noMatchesFound,{searchTerm:this.searchText??""});return index.h(index.Host,{dir:this.dir},index.h("calcite-panel",{closable:false,closed:false,onCalcitePanelClose:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},index.h("calcite-input",{onCalciteInputInput:evt=>this.searchSpatialReferences(evt),onKeyDown:evt=>this.inputKeyDown(evt),placeholder:this.strings.searchPlaceholder,scale:utils.UIDefaults.Scale,type:"search",icon:true,autofocus:true}),this.searchText.length>1&&index2.isEmptyDataItem(this.searchResults)&&index.h("p",{class:HTMLClasses.noMatchesFoundMessage},noMatchesFoundMessage),index.h("analysis-tree",{key:"tree",ref:el=>this.treeElement=el,data:this.searchResults!==undefined&&this.searchText.length>0?this.searchResults:this.visibleSrCategories,value:this.value&&`${this.value?.latestWkid}`,onAnalysisTreeValueChange:()=>{this.setSpatialRef(this.treeElement.value)}}),index.h("calcite-button",{appearance:"solid",scale:utils.UIDefaults.Scale,width:"full",slot:"footer-actions",onClick:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},this.strings.done)))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return analysisSpatialReferenceSelectorCss}},[1,"analysis-spatial-reference-selector",{defaultWkid:[1538,"default-wkid"],value:[1040],hideCategories:[16],searchResults:[32],getSRDescription:[64]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-spatial-reference-selector","analysis-tree"];components.forEach((tagName=>{switch(tagName){case"analysis-spatial-reference-selector":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisSpatialReferenceSelector)}break;case"analysis-tree":if(!customElements.get(tagName)){analysisTree2.defineCustomElement()}break}}))}defineCustomElement();exports.AnalysisSpatialReferenceSelector=AnalysisSpatialReferenceSelector;exports.defineCustomElement=defineCustomElement}));
