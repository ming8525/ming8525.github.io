define(["exports","./index2-0f07feca","./shared-components-e09cc192","./store-f16d23c6","./analysis-tool-context-b1931181"],(function(exports,index2,sharedComponents,store,analysisToolContext){"use strict";const analysisToolStandardSettingsCss=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}:host{display:flex;flex-direction:column}.control-spacing{width:100%}.display-block{display:block}";const HTMLClasses={displayBlock:"display-block"};const AnalysisToolStandardSettings=index2.proxyCustomElement(class AnalysisToolStandardSettings extends index2.H{constructor(){super();this.__registerHost();this.__attachShadow();this.analysisToolStandardSettingsHelpClick=index2.createEvent(this,"analysisToolStandardSettingsHelpClick",7);this.mapExtentInputs=[];this.stateContextChanged=false;this.handleExtentChange=(coordinate,value)=>{store.set(store.state.context,["extent",coordinate],value);const extent=store.state.context.extent;if(store.state.mapView?.spatialReference!==undefined){extent.spatialReference=store.state.mapView.spatialReference;store.state.context.extent=this.getContextExtent(extent)}store.state.context={...store.state.context}};this.handleCalciteListChange=async e=>{const[firstValue]=(await(e.target?.getSelectedItems())).values();store.state.settingsSelectedExtentOption=firstValue.value;this.incomingLayerObjects.extentLayer=undefined;this.extentPopover?.remove()};this.setMapExtent=()=>{if(store.state.mapView!==undefined)store.state.context.extent=this.getContextExtent(store.state.mapView.extent);store.state.context={...store.state.context};this.stateContextChanged=true};this.handleLayerInputClose=mode=>{if(mode==="extent"){delete store.state.context.extent;this.incomingLayerObjects.extentLayer=undefined}else if(mode==="spatialReference"){delete store.state.context.outSR;this.incomingLayerObjects.spatialRefLayer=undefined}this.incomingLayerObjects={...this.incomingLayerObjects};store.state.context={...store.state.context}};this.handleLayerInputChange=(event,mode)=>{const selectedLayer=event.target?.selectedLayers;if(mode==="extent"&&selectedLayer?.fullExtent!==undefined){store.state.context.extent=this.getContextExtent(selectedLayer.fullExtent)}else if(selectedLayer!==undefined&&"spatialReference"in selectedLayer){const{wkid,latestWkid,wkt}=selectedLayer?.spatialReference;if(!index2.isEmptyDataItem(wkid)){store.set(store.state.context,"outSR.wkid",wkid)}if(!index2.isEmptyDataItem(latestWkid)){store.set(store.state.context,"outSR.latestWkid",latestWkid)}if(!index2.isEmptyDataItem(wkt)){store.set(store.state.context,"outSR.wkt",wkt)}}store.state.context={...store.state.context}};this.createExtentPopover=e=>{this.extentPopover?.remove();this.extentPopover=document.createElement("calcite-popover");const popoverProps={autoClose:true,dir:this.dir,focusTrapDisabled:true,heading:this.strings.processingExtent,closable:true,open:true,referenceElement:e.target};Object.assign(this.extentPopover,popoverProps);this.extentPopover.addEventListener("calcitePopoverClose",this.extentPopover?.remove);const pickList=document.createElement("calcite-pick-list");pickList.addEventListener("calciteListChange",this.handleCalciteListChange);const pickListItems=[{label:this.strings.default,description:this.strings.defaultText,value:sharedComponents.ExtentOptions.Default},{label:this.strings.coordinates,description:this.strings.coordinatesText,value:sharedComponents.ExtentOptions.Coordinates},{label:this.strings.mapExtent,description:this.strings.mapExtentText,value:sharedComponents.ExtentOptions.MapExtent},{label:this.strings.layer,description:this.strings.layerText,value:sharedComponents.ExtentOptions.Layer}];const itemElements=pickListItems.map((item=>{const itemElement=document.createElement("calcite-pick-list-item");Object.assign(itemElement,item);itemElement.selected=itemElement.value===store.state.settingsSelectedExtentOption;return itemElement}));pickList.append(...itemElements);this.extentPopover.append(pickList);document.body.append(this.extentPopover);setTimeout((()=>requestAnimationFrame((()=>this.extentPopover?.setFocus()))),1)};this.handleSpatialReferenceChange=e=>{store.state.context.outSR={latestWkid:e.detail.latestWkid}};this.hideOutSR=false;this.hideCategories=["Vertical Coordinate Systems"];this.hideExtent=false;this.incomingLayerObjects={}}async validateStandardSettings(){let extentValidity=true;let outSpatialReferenceValidity=true;switch(store.state.settingsSelectedExtentOption){case sharedComponents.ExtentOptions.Layer:const layerInputRef=this.hostElement.shadowRoot?.querySelector(".extent");if(layerInputRef!==null&&layerInputRef!==undefined){extentValidity=await layerInputRef.checkValidity()}break;case sharedComponents.ExtentOptions.Coordinates:const numberInputRefs=this.hostElement.shadowRoot?.querySelectorAll("analysis-number-input");const validityChecks=[];if(numberInputRefs!==null&&numberInputRefs!==undefined){numberInputRefs.forEach((ref=>{validityChecks.push(ref.checkValidity())}));const resolvedValidityChecks=await Promise.all(validityChecks);extentValidity=!resolvedValidityChecks.some((checks=>checks===false))}break}switch(store.state.settingsSelectedOutSpatialRefOption){case sharedComponents.OutSROptions.SameAsLayer:const layerInputRef=this.hostElement.shadowRoot?.querySelector(".spatialReference");if(layerInputRef!==null&&layerInputRef!==undefined){outSpatialReferenceValidity=await layerInputRef.checkValidity()}break;case sharedComponents.OutSROptions.BrowseCS:const spatialReferenceInputRef=this.hostElement.shadowRoot?.querySelector("analysis-spatial-reference-input");if(spatialReferenceInputRef!==null&&spatialReferenceInputRef!==undefined){outSpatialReferenceValidity=await spatialReferenceInputRef.checkValidity()}break}return Promise.resolve(outSpatialReferenceValidity&&extentValidity)}async componentWillLoad(){const incomingLayers={};if(store.state.settingsSelectedExtentOption===sharedComponents.ExtentOptions.Layer&&store.state.mapLevelContext.extentLayer!==undefined)incomingLayers.extentLayer=await store.getEnvSettingsLayer(store.state.mapLevelContext.extentLayer);if(store.state.settingsSelectedOutSpatialRefOption===sharedComponents.OutSROptions.SameAsLayer&&store.state.mapLevelContext.spatialRefLayer!==undefined)incomingLayers.spatialRefLayer=await store.getEnvSettingsLayer(store.state.mapLevelContext.spatialRefLayer);this.incomingLayerObjects=incomingLayers;({strings:this.strings,dir:this.dir}=await index2.fetchComponentLocaleStrings(this.hostElement,index2.getAssetPath(`.`)))}componentDidRender(){if(this.stateContextChanged){setTimeout((()=>requestAnimationFrame((()=>this.mapExtentInputs?.forEach((input=>input.checkValidity()))))),1);this.stateContextChanged=false}}disconnectedCallback(){this.extentPopover?.remove();this.coordinateSystemPopover?.remove()}renderCoordinateConfig(){const{strings}=this;const{extent}=store.state.context;return index2.h("div",null,index2.h("calcite-button",{class:sharedComponents.SharedHTMLClasses.controlSpacing,scale:sharedComponents.UIDefaults.Scale,appearance:"outline",kind:"neutral",width:"full",onClick:this.setMapExtent},strings.setCoordinates),index2.h("calcite-label",null,strings.top,index2.h("analysis-number-input",{ref:el=>{this.mapExtentInputs.push(el)},required:true,label:"",value:extent?.ymax,scale:sharedComponents.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymax",e.target?.value)})),index2.h("calcite-label",null,strings.bottom,index2.h("analysis-number-input",{ref:el=>{this.mapExtentInputs.push(el)},required:true,label:"",value:extent?.ymin,scale:sharedComponents.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymin",e.target?.value)})),index2.h("calcite-label",null,strings.left,index2.h("analysis-number-input",{ref:el=>{this.mapExtentInputs.push(el)},required:true,label:"",value:extent?.xmin,scale:sharedComponents.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmin",e.target?.value)})),index2.h("calcite-label",null,strings.right,index2.h("analysis-number-input",{ref:el=>{this.mapExtentInputs.push(el)},required:true,label:"",value:extent?.xmax,scale:sharedComponents.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmax",e.target?.value)})))}renderLayerInput(mode){let selectedLayer;const mapLayers=store.state.mapLayers;if(mode==="extent"){selectedLayer=this.incomingLayerObjects?.extentLayer}else if(mode==="spatialReference"){selectedLayer=this.incomingLayerObjects?.spatialRefLayer}if(selectedLayer!==undefined){let searchValue;if(index2.isEmptyDataItem(selectedLayer.url)===false){const layerId="layerId"in selectedLayer?selectedLayer.layerId:0;searchValue=`${selectedLayer.url}/${layerId}`}else{searchValue=selectedLayer.title}if(store.findExistingLayer(searchValue)===undefined){mapLayers.push(selectedLayer)}}return index2.h("analysis-layer-input",{class:mode,required:true,descriptionDisplay:"spatialReference",mapLayers,layerFilterType:[analysisToolContext.LayerFilterType.Imagery_All,analysisToolContext.LayerFilterType.Feature_All],selectedLayers:selectedLayer,user:store.state.portal?.user,mapView:store.state.mapView,onAnalysisLayerInputClose:()=>this.handleLayerInputClose(mode),onAnalysisLayerInputChange:e=>this.handleLayerInputChange(e,mode)})}renderChooseSpatialReference(){const wkidValue=store.state.context.outSR?.latestWkid??store.state.context.outSR?.wkid;return index2.h("analysis-spatial-reference-input",{errorMessage:store.state.context.outSR?.wkt!==undefined&&wkidValue===undefined?this.strings.unableToRepopulateOutSR:undefined,dir:this.dir,required:true,onAnalysisSpatialReferenceInputChange:e=>this.handleSpatialReferenceChange(e),value:wkidValue!==undefined?{latestWkid:wkidValue}:undefined,hideCategories:this.hideCategories})}renderOutSR(){const{strings}=this;return index2.h("div",null,index2.h("analysis-label",{label:strings.outputCS,onAnalysisLabelHelpActionClick:event=>this.analysisToolStandardSettingsHelpClick.emit({key:analysisToolContext.AnalysisToolContextKeys.OutSR,parameterName:strings.outputCS,refElement:event.target})}),index2.h("calcite-dropdown",{class:`${HTMLClasses.displayBlock} ${sharedComponents.SharedHTMLClasses.controlSpacing}`,placement:"bottom",scale:sharedComponents.UIDefaults.Scale},index2.h("calcite-button",{class:sharedComponents.SharedHTMLClasses.analysisBorder,alignment:"space-between",appearance:"transparent",kind:"neutral","icon-end":"chevron-down",scale:sharedComponents.UIDefaults.Scale,slot:"trigger",width:"full"},strings[store.state.settingsSelectedOutSpatialRefOption]),index2.h("calcite-dropdown-group",null,index2.h("calcite-dropdown-item",{onClick:()=>{store.state.settingsSelectedOutSpatialRefOption=sharedComponents.OutSROptions.SameAsInput;this.incomingLayerObjects.spatialRefLayer=undefined}},strings.sameAsInput),index2.h("calcite-dropdown-item",{onClick:()=>{store.state.settingsSelectedOutSpatialRefOption=sharedComponents.OutSROptions.BrowseCS;this.incomingLayerObjects.spatialRefLayer=undefined}},strings.browseCS),index2.h("calcite-dropdown-item",{onClick:()=>{store.state.settingsSelectedOutSpatialRefOption=sharedComponents.OutSROptions.SameAsLayer;this.incomingLayerObjects.spatialRefLayer=undefined}},strings.sameAsLayer))),store.state.settingsSelectedOutSpatialRefOption===sharedComponents.OutSROptions.SameAsLayer&&this.renderLayerInput("spatialReference"),store.state.settingsSelectedOutSpatialRefOption===sharedComponents.OutSROptions.BrowseCS&&this.renderChooseSpatialReference())}renderExtent(){const{strings}=this;const{settingsSelectedExtentOption}=store.state;return index2.h("div",null,index2.h("analysis-label",{label:strings.processingExtent,onAnalysisLabelHelpActionClick:event=>this.analysisToolStandardSettingsHelpClick.emit({key:analysisToolContext.AnalysisToolContextKeys.Extent,parameterName:strings.processingExtent,refElement:event.target})}),index2.h("calcite-value-list-item",{class:[sharedComponents.SharedHTMLClasses.controlSpacing,sharedComponents.SharedHTMLClasses.analysisBorder].join(" "),label:strings[settingsSelectedExtentOption],description:strings[`${settingsSelectedExtentOption}Text`],value:settingsSelectedExtentOption,onClick:e=>this.createExtentPopover(e)},index2.h("calcite-action",{slot:"actions-end",icon:"chevron-down",text:""})),settingsSelectedExtentOption===sharedComponents.ExtentOptions.Coordinates&&this.renderCoordinateConfig(),settingsSelectedExtentOption===sharedComponents.ExtentOptions.Layer&&this.renderLayerInput("extent"))}render(){return index2.h(index2.Host,null,!this.hideOutSR&&this.renderOutSR(),!this.hideExtent&&this.renderExtent())}getContextExtent(layerExtent){const{xmin,ymin,xmax,ymax,spatialReference}=layerExtent;const{wkid,latestWkid,wkt}=spatialReference;const newExtent={xmin,ymin,xmax,ymax};if(!index2.isEmptyDataItem(wkid)){store.set(newExtent,"spatialReference.wkid",wkid)}if(!index2.isEmptyDataItem(latestWkid)){store.set(newExtent,"spatialReference.latestWkid",latestWkid)}if(!index2.isEmptyDataItem(wkt)){store.set(newExtent,"spatialReference.wkt",wkt)}return newExtent}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return analysisToolStandardSettingsCss}},[1,"analysis-tool-standard-settings",{hideOutSR:[516,"hide-out-s-r"],hideCategories:[16],hideExtent:[516,"hide-extent"],incomingLayerObjects:[32],validateStandardSettings:[64]}]);function defineCustomElement(){if(typeof customElements==="undefined"){return}const components=["analysis-tool-standard-settings"];components.forEach((tagName=>{switch(tagName){case"analysis-tool-standard-settings":if(!customElements.get(tagName)){customElements.define(tagName,AnalysisToolStandardSettings)}break}}))}defineCustomElement();exports.AnalysisToolStandardSettings=AnalysisToolStandardSettings;exports.defineCustomElement=defineCustomElement}));
