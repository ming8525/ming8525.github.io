define(["exports","./index2-0f07feca","./shared-components-e09cc192","./store-f16d23c6","./analysis-tool-context-b1931181"],(function(t,e,a,s,n){"use strict";const i=e.proxyCustomElement(class extends e.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolStandardSettingsHelpClick=e.createEvent(this,"analysisToolStandardSettingsHelpClick",7),this.mapExtentInputs=[],this.stateContextChanged=!1,this.handleExtentChange=(t,e)=>{s.set(s.state.context,["extent",t],e);const a=s.state.context.extent;void 0!==s.state.mapView?.spatialReference&&(a.spatialReference=s.state.mapView.spatialReference,s.state.context.extent=this.getContextExtent(a)),s.state.context={...s.state.context}},this.handleCalciteListChange=async t=>{const[e]=(await(t.target?.getSelectedItems())).values();s.state.settingsSelectedExtentOption=e.value,this.incomingLayerObjects.extentLayer=void 0,this.extentPopover?.remove()},this.setMapExtent=()=>{void 0!==s.state.mapView&&(s.state.context.extent=this.getContextExtent(s.state.mapView.extent)),s.state.context={...s.state.context},this.stateContextChanged=!0},this.handleLayerInputClose=t=>{"extent"===t?(delete s.state.context.extent,this.incomingLayerObjects.extentLayer=void 0):"spatialReference"===t&&(delete s.state.context.outSR,this.incomingLayerObjects.spatialRefLayer=void 0),this.incomingLayerObjects={...this.incomingLayerObjects},s.state.context={...s.state.context}},this.handleLayerInputChange=(t,a)=>{const n=t.target?.selectedLayers;if("extent"===a&&void 0!==n?.fullExtent)s.state.context.extent=this.getContextExtent(n.fullExtent);else if(void 0!==n&&"spatialReference"in n){const{wkid:t,latestWkid:a,wkt:i}=n?.spatialReference;e.isEmptyDataItem(t)||s.set(s.state.context,"outSR.wkid",t),e.isEmptyDataItem(a)||s.set(s.state.context,"outSR.latestWkid",a),e.isEmptyDataItem(i)||s.set(s.state.context,"outSR.wkt",i)}s.state.context={...s.state.context}},this.createExtentPopover=t=>{this.extentPopover?.remove(),this.extentPopover=document.createElement("calcite-popover");const e={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,heading:this.strings.processingExtent,closable:!0,open:!0,referenceElement:t.target};Object.assign(this.extentPopover,e),this.extentPopover.addEventListener("calcitePopoverClose",this.extentPopover?.remove);const n=document.createElement("calcite-pick-list");n.addEventListener("calciteListChange",this.handleCalciteListChange);const i=[{label:this.strings.default,description:this.strings.defaultText,value:a.ExtentOptions.Default},{label:this.strings.coordinates,description:this.strings.coordinatesText,value:a.ExtentOptions.Coordinates},{label:this.strings.mapExtent,description:this.strings.mapExtentText,value:a.ExtentOptions.MapExtent},{label:this.strings.layer,description:this.strings.layerText,value:a.ExtentOptions.Layer}].map((t=>{const e=document.createElement("calcite-pick-list-item");return Object.assign(e,t),e.selected=e.value===s.state.settingsSelectedExtentOption,e}));n.append(...i),this.extentPopover.append(n),document.body.append(this.extentPopover),setTimeout((()=>requestAnimationFrame((()=>this.extentPopover?.setFocus()))),1)},this.handleSpatialReferenceChange=t=>{s.state.context.outSR={latestWkid:t.detail.latestWkid}},this.hideOutSR=!1,this.hideCategories=["Vertical Coordinate Systems"],this.hideExtent=!1,this.incomingLayerObjects={}}async validateStandardSettings(){let t=!0,e=!0;switch(s.state.settingsSelectedExtentOption){case a.ExtentOptions.Layer:const e=this.hostElement.shadowRoot?.querySelector(".extent");null!=e&&(t=await e.checkValidity());break;case a.ExtentOptions.Coordinates:const s=this.hostElement.shadowRoot?.querySelectorAll("analysis-number-input"),n=[];null!=s&&(s.forEach((t=>{n.push(t.checkValidity())})),t=!(await Promise.all(n)).some((t=>!1===t)))}switch(s.state.settingsSelectedOutSpatialRefOption){case a.OutSROptions.SameAsLayer:const t=this.hostElement.shadowRoot?.querySelector(".spatialReference");null!=t&&(e=await t.checkValidity());break;case a.OutSROptions.BrowseCS:const s=this.hostElement.shadowRoot?.querySelector("analysis-spatial-reference-input");null!=s&&(e=await s.checkValidity())}return Promise.resolve(e&&t)}async componentWillLoad(){const t={};s.state.settingsSelectedExtentOption===a.ExtentOptions.Layer&&void 0!==s.state.mapLevelContext.extentLayer&&(t.extentLayer=await s.getEnvSettingsLayer(s.state.mapLevelContext.extentLayer)),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&void 0!==s.state.mapLevelContext.spatialRefLayer&&(t.spatialRefLayer=await s.getEnvSettingsLayer(s.state.mapLevelContext.spatialRefLayer)),this.incomingLayerObjects=t,({strings:this.strings,dir:this.dir}=await e.fetchComponentLocaleStrings(this.hostElement,e.getAssetPath(".")))}componentDidRender(){this.stateContextChanged&&(setTimeout((()=>requestAnimationFrame((()=>this.mapExtentInputs?.forEach((t=>t.checkValidity()))))),1),this.stateContextChanged=!1)}disconnectedCallback(){this.extentPopover?.remove(),this.coordinateSystemPopover?.remove()}renderCoordinateConfig(){const{strings:t}=this,{extent:n}=s.state.context;return e.h("div",null,e.h("calcite-button",{class:a.SharedHTMLClasses.controlSpacing,scale:a.UIDefaults.Scale,appearance:"outline",kind:"neutral",width:"full",onClick:this.setMapExtent},t.setCoordinates),e.h("calcite-label",null,t.top,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:n?.ymax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>this.handleExtentChange("ymax",t.target?.value)})),e.h("calcite-label",null,t.bottom,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:n?.ymin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>this.handleExtentChange("ymin",t.target?.value)})),e.h("calcite-label",null,t.left,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:n?.xmin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>this.handleExtentChange("xmin",t.target?.value)})),e.h("calcite-label",null,t.right,e.h("analysis-number-input",{ref:t=>{this.mapExtentInputs.push(t)},required:!0,label:"",value:n?.xmax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:t=>this.handleExtentChange("xmax",t.target?.value)})))}renderLayerInput(t){let a;const i=s.state.mapLayers;if("extent"===t?a=this.incomingLayerObjects?.extentLayer:"spatialReference"===t&&(a=this.incomingLayerObjects?.spatialRefLayer),void 0!==a){let t;if(!1===e.isEmptyDataItem(a.url)){const e="layerId"in a?a.layerId:0;t=`${a.url}/${e}`}else t=a.title;void 0===s.findExistingLayer(t)&&i.push(a)}return e.h("analysis-layer-input",{class:t,required:!0,descriptionDisplay:"spatialReference",mapLayers:i,layerFilterType:[n.LayerFilterType.Imagery_All,n.LayerFilterType.Feature_All],selectedLayers:a,user:s.state.portal?.user,mapView:s.state.mapView,onAnalysisLayerInputClose:()=>this.handleLayerInputClose(t),onAnalysisLayerInputChange:e=>this.handleLayerInputChange(e,t)})}renderChooseSpatialReference(){const t=s.state.context.outSR?.latestWkid??s.state.context.outSR?.wkid;return e.h("analysis-spatial-reference-input",{errorMessage:void 0!==s.state.context.outSR?.wkt&&void 0===t?this.strings.unableToRepopulateOutSR:void 0,dir:this.dir,required:!0,onAnalysisSpatialReferenceInputChange:t=>this.handleSpatialReferenceChange(t),value:void 0!==t?{latestWkid:t}:void 0,hideCategories:this.hideCategories})}renderOutSR(){const{strings:t}=this;return e.h("div",null,e.h("analysis-label",{label:t.outputCS,onAnalysisLabelHelpActionClick:e=>this.analysisToolStandardSettingsHelpClick.emit({key:n.AnalysisToolContextKeys.OutSR,parameterName:t.outputCS,refElement:e.target})}),e.h("calcite-dropdown",{class:`display-block ${a.SharedHTMLClasses.controlSpacing}`,placement:"bottom",scale:a.UIDefaults.Scale},e.h("calcite-button",{class:a.SharedHTMLClasses.analysisBorder,alignment:"space-between",appearance:"transparent",kind:"neutral","icon-end":"chevron-down",scale:a.UIDefaults.Scale,slot:"trigger",width:"full"},t[s.state.settingsSelectedOutSpatialRefOption]),e.h("calcite-dropdown-group",null,e.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsInput,this.incomingLayerObjects.spatialRefLayer=void 0}},t.sameAsInput),e.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.BrowseCS,this.incomingLayerObjects.spatialRefLayer=void 0}},t.browseCS),e.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsLayer,this.incomingLayerObjects.spatialRefLayer=void 0}},t.sameAsLayer))),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&this.renderLayerInput("spatialReference"),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.BrowseCS&&this.renderChooseSpatialReference())}renderExtent(){const{strings:t}=this,{settingsSelectedExtentOption:i}=s.state;return e.h("div",null,e.h("analysis-label",{label:t.processingExtent,onAnalysisLabelHelpActionClick:e=>this.analysisToolStandardSettingsHelpClick.emit({key:n.AnalysisToolContextKeys.Extent,parameterName:t.processingExtent,refElement:e.target})}),e.h("calcite-value-list-item",{class:[a.SharedHTMLClasses.controlSpacing,a.SharedHTMLClasses.analysisBorder].join(" "),label:t[i],description:t[`${i}Text`],value:i,onClick:t=>this.createExtentPopover(t)},e.h("calcite-action",{slot:"actions-end",icon:"chevron-down",text:""})),i===a.ExtentOptions.Coordinates&&this.renderCoordinateConfig(),i===a.ExtentOptions.Layer&&this.renderLayerInput("extent"))}render(){return e.h(e.Host,null,!this.hideOutSR&&this.renderOutSR(),!this.hideExtent&&this.renderExtent())}getContextExtent(t){const{xmin:a,ymin:n,xmax:i,ymax:l,spatialReference:o}=t,{wkid:r,latestWkid:c,wkt:d}=o,p={xmin:a,ymin:n,xmax:i,ymax:l};return e.isEmptyDataItem(r)||s.set(p,"spatialReference.wkid",r),e.isEmptyDataItem(c)||s.set(p,"spatialReference.latestWkid",c),e.isEmptyDataItem(d)||s.set(p,"spatialReference.wkt",d),p}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}:host{display:flex;flex-direction:column}.control-spacing{width:100%}.display-block{display:block}"}},[1,"analysis-tool-standard-settings",{hideOutSR:[516,"hide-out-s-r"],hideCategories:[16],hideExtent:[516,"hide-extent"],incomingLayerObjects:[32],validateStandardSettings:[64]}]);function l(){"undefined"!=typeof customElements&&["analysis-tool-standard-settings"].forEach((t=>{"analysis-tool-standard-settings"===t&&(customElements.get(t)||customElements.define(t,i))}))}l(),t.AnalysisToolStandardSettings=i,t.defineCustomElement=l}));