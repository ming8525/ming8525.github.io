define(["exports","./index2-0f07feca","./shared-components-e09cc192","./store-f16d23c6","./analysis-tool-context-b1931181"],(function(e,t,s,a,l){"use strict";const i=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolRasterSettingsHelpClick=t.createEvent(this,"analysisToolRasterSettingsHelpClick",7),this.loadedLayerObjects={},this.inferUIState=async()=>{const{cellSize:e,snapRaster:l,mask:i,resamplingMethod:r,parallelProcessingFactor:n,processorType:o}=a.state.context;if("object"==typeof e&&!t.isEmptyDataItem(e)&&"url"in e){this.selectedCellSizeOption=s.CellSizeOptions.Layer;const t=await a.getEnvSettingsLayer({url:this.removeLayerToken(e.url)});void 0!==t&&(this.loadedLayerObjects.cellSize=t,void 0!==t&&this.isNotAnExistingLayer(t)&&this.browsedLayers.push(t))}else this.selectedCellSizeOption="number"==typeof e?s.CellSizeOptions.Value:e===s.CellSizeOptions.MinOf?s.CellSizeOptions.MinOf:s.CellSizeOptions.MaxOf;if(void 0!==l){const e=await a.getEnvSettingsLayer({url:this.removeLayerToken(l.url)});void 0!==e&&(this.loadedLayerObjects.snapRaster=e,void 0!==e&&this.isNotAnExistingLayer(e)&&this.browsedLayers.push(e))}let c;if(void 0!==this.incomingLayerObjects.maskLayer)c=await a.getEnvSettingsLayer(this.incomingLayerObjects.maskLayer);else if(void 0!==i){const e={...i};"url"in i&&void 0!==i.url&&(e.url=this.removeLayerToken(e.url)),c=await a.getEnvSettingsLayer(e)}void 0!==c&&(this.loadedLayerObjects.mask=c,void 0!==c&&this.browsedLayers.push(c)),void 0!==r&&(this.selectedResamplingMethodOption=r),void 0!==n&&(this.parallelProcessingFactorValue=n),void 0!==o&&(this.selectedProcessorTypeOption=o)},this.isNotAnExistingLayer=e=>{let t=e.url;return"layerId"in e&&(t+=`/${e.layerId??0}`),t=this.removeLayerToken(t),void 0===a.findExistingLayer(t)},this.removeLayerToken=e=>e?.indexOf("?token=")>0?e.slice(0,e.indexOf("?token=")):e,this.renderSnapRasterParameter=()=>{const{strings:e,loadedLayerObjects:s}=this;return t.h("div",null,t.h("analysis-label",{label:e.snapRaster,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.SnapRaster,parameterName:e.snapRaster,refElement:t.target})}),t.h("analysis-layer-input",{layerFilterType:l.LayerFilterType.Imagery_All,mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:s?.snapRaster,user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.SnapRaster)}))},this.renderCellSizeParameter=()=>{const{strings:e,loadedLayerObjects:i,selectedCellSizeOption:r}=this;return t.h("div",null,t.h("analysis-label",{label:e.cellSize,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.CellSize,parameterName:e.cellSize,refElement:t.target})}),t.h("calcite-select",{scale:s.UIDefaults.Scale,class:s.SharedHTMLClasses.controlSpacing,label:e.cellSize,value:r,onCalciteSelectChange:e=>this.handleCalciteSelectChange(e)},t.h("calcite-option",{value:s.CellSizeOptions.MaxOf,selected:r===s.CellSizeOptions.MaxOf},e.maxOf),t.h("calcite-option",{value:s.CellSizeOptions.MinOf,selected:r===s.CellSizeOptions.MinOf},e.minOf),t.h("calcite-option",{value:s.CellSizeOptions.Value,selected:r===s.CellSizeOptions.Value},e.asSpecified),t.h("calcite-option",{value:s.CellSizeOptions.Layer,selected:r===s.CellSizeOptions.Layer},e.fromLayer)),r===s.CellSizeOptions.Value&&t.h("analysis-number-input",{ref:e=>{this.numberInputElement=e},required:!0,value:a.state.context.cellSize,scale:s.UIDefaults.Scale,label:"",min:0,excludeMinValue:!0,numberType:"float",onAnalysisNumberInputChange:e=>a.state.context.cellSize=Number(e.target.value)}),r===s.CellSizeOptions.Layer&&t.h("analysis-layer-input",{ref:e=>{this.layerInputElement=e},required:!0,layerFilterType:l.LayerFilterType.Imagery_All,mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:i?.cellSize,user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.CellSize)}))},this.renderMaskParameter=()=>{const{strings:e,loadedLayerObjects:s}=this;return t.h("div",null,t.h("analysis-label",{label:e.mask,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.Mask,parameterName:e.mask,refElement:t.target})}),t.h("analysis-layer-input",{mapLayers:[...a.state.mapLayers,...this.browsedLayers],selectedLayers:s?.mask,layerFilterType:[l.LayerFilterType.Imagery_All,l.LayerFilterType.Feature_All],user:a.state.portal?.user,mapView:a.state.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,l.AnalysisToolContextKeys.Mask)}))},this.renderResamplingMethodParameter=()=>{const{strings:e,selectedResamplingMethodOption:a}=this;return t.h("div",null,t.h("analysis-label",{label:e.resamplingMethod,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ResamplingMethod,parameterName:e.resamplingMethod,refElement:t.target})}),t.h("calcite-select",{scale:s.UIDefaults.Scale,class:s.SharedHTMLClasses.controlSpacing,label:e.resamplingMethod,value:a,onCalciteSelectChange:e=>this.handleResamplingMethodSelectChange(e)},t.h("calcite-option",{value:s.ResamplingMethodOptions.Nearest,selected:a===s.ResamplingMethodOptions.Nearest},e.nearest),t.h("calcite-option",{value:s.ResamplingMethodOptions.Bilinear,selected:a===s.ResamplingMethodOptions.Bilinear},e.bilinear),t.h("calcite-option",{value:s.ResamplingMethodOptions.Cubic,selected:a===s.ResamplingMethodOptions.Cubic},e.cubic)))},this.renderParallelProcessingFactorParameter=()=>{const{strings:e,parallelProcessingFactorValue:s}=this;return t.h("analysis-string-input",{value:s,label:e.parallelProcessingFactor,required:!1,selectionMode:"single",placeholderText:e.parallelProcessingFactorPlaceholderText,onAnalysisStringInputChange:e=>this.handleParallelProcessingFactorInputChange(e),onAnalysisHelpClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ParallelProcessingFactor,parameterName:e.parallelProcessingFactor,refElement:t.target})})},this.renderProcessorTypeParameter=()=>{const{strings:e,selectedProcessorTypeOption:a}=this;return t.h("div",null,t.h("analysis-label",{label:e.processorType,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:l.AnalysisToolContextKeys.ProcessorType,parameterName:e.processorType,refElement:t.target})}),t.h("calcite-select",{scale:s.UIDefaults.Scale,class:s.SharedHTMLClasses.controlSpacing,label:e.processorType,value:a,onCalciteSelectChange:e=>this.handleProcessorTypeSelectChange(e)},t.h("calcite-option",{value:s.ProcessorTypeOptions.Empty,selected:a===s.ProcessorTypeOptions.Empty},e.automatic),t.h("calcite-option",{value:s.ProcessorTypeOptions.CPU,selected:a===s.ProcessorTypeOptions.CPU},e.CPU),t.h("calcite-option",{value:s.ProcessorTypeOptions.GPU,selected:a===s.ProcessorTypeOptions.GPU},e.GPU)))},this.handleCalciteSelectChange=e=>{this.selectedCellSizeOption=e.target?.selectedOption.value,this.selectedCellSizeOption!==s.CellSizeOptions.MaxOf&&this.selectedCellSizeOption!==s.CellSizeOptions.MinOf||(a.state.context.cellSize=this.selectedCellSizeOption)},this.handleResamplingMethodSelectChange=e=>{this.selectedResamplingMethodOption=e.target?.selectedOption.value,a.state.context.resamplingMethod=this.selectedResamplingMethodOption},this.handleAnalysisLayerInputChange=(e,s)=>{const l=e.target?.selectedLayers;if(void 0!==l){let e;t.isFeatureLayer(l)?e=t.getGPFeatureRecordSetLayerValue(l,a.state.mapView):(t.isImageryLayer(l)||t.isImageryTileLayer(l))&&(e=t.getImageryLayerValue(l)),a.state.context[s]=e}else delete a.state.context[s]},this.handleParallelProcessingFactorInputChange=e=>{this.parallelProcessingFactorValue=e.target?.value,a.state.context.parallelProcessingFactor=this.parallelProcessingFactorValue},this.handleProcessorTypeSelectChange=e=>{this.selectedProcessorTypeOption=e.target?.selectedOption.value,a.state.context.processorType=this.selectedProcessorTypeOption===s.ProcessorTypeOptions.Empty?void 0:this.selectedProcessorTypeOption},this.browsedLayers=[],this.selectedCellSizeOption=s.CellSizeOptions.MaxOf,this.selectedResamplingMethodOption=s.ResamplingMethodOptions.Nearest,this.parallelProcessingFactorValue="",this.selectedProcessorTypeOption=s.ProcessorTypeOptions.Empty,this.incomingLayerObjects={},this.hideCellSize=!1,this.hideResamplingMethod=!1,this.hideMask=!1,this.hideSnapRaster=!1,this.hideParallelProcessingFactor=!1,this.hideProcessorType=!1}async validateRasterSettings(){let e=!0;switch(this.selectedCellSizeOption){case s.CellSizeOptions.Layer:const t=this.layerInputElement;null!=t&&(e=await t.checkValidity());break;case s.CellSizeOptions.Value:const a=this.numberInputElement;null!=a&&(e=await a.checkValidity())}return e}resetUI(){this.loadedLayerObjects={},this.selectedCellSizeOption=s.CellSizeOptions.MaxOf,this.selectedResamplingMethodOption=s.ResamplingMethodOptions.Nearest,this.parallelProcessingFactorValue="",this.selectedProcessorTypeOption=s.ProcessorTypeOptions.Empty;const e=this.hostElement.shadowRoot?.querySelectorAll("analysis-layer-input");return e?.forEach((e=>e.selectedLayerIds=[])),Promise.resolve()}async componentWillLoad(){({strings:this.strings}=await t.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath(".")));const e={};void 0!==a.state.mapLevelContext.maskLayer&&(e.maskLayer=a.state.mapLevelContext.maskLayer),this.incomingLayerObjects=e,await this.inferUIState()}render(){const{hideCellSize:e,hideSnapRaster:s,hideMask:a,hideResamplingMethod:l,hideParallelProcessingFactor:i,hideProcessorType:r}=this;return t.h(t.Host,null,!1===s?this.renderSnapRasterParameter():null,!1===e?this.renderCellSizeParameter():null,!1===a?this.renderMaskParameter():null,!1===l?this.renderResamplingMethodParameter():null,!1===i?this.renderParallelProcessingFactorParameter():null,!1===r?this.renderProcessorTypeParameter():null)}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}:host{display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input)}"}},[1,"analysis-tool-raster-settings",{hideCellSize:[516,"hide-cell-size"],hideResamplingMethod:[516,"hide-resampling-method"],hideMask:[516,"hide-mask"],hideSnapRaster:[516,"hide-snap-raster"],hideParallelProcessingFactor:[516,"hide-parallel-processing-factor"],hideProcessorType:[516,"hide-processor-type"],browsedLayers:[32],selectedCellSizeOption:[32],selectedResamplingMethodOption:[32],parallelProcessingFactorValue:[32],selectedProcessorTypeOption:[32],incomingLayerObjects:[32],validateRasterSettings:[64],resetUI:[64]}]);function r(){"undefined"!=typeof customElements&&["analysis-tool-raster-settings"].forEach((e=>{"analysis-tool-raster-settings"===e&&(customElements.get(e)||customElements.define(e,i))}))}r(),e.AnalysisToolRasterSettings=i,e.defineCustomElement=r}));